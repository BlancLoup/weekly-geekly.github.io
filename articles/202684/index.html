<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Roguelike / RPG in JavaScript (30 lines of code)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After a series of posts about the implementation of unpretentious toys on JavaScript in 30 lines, I decided to try myself in this "competition". After...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Roguelike / RPG in JavaScript (30 lines of code)</h1><div class="post__text post__text-html js-mediator-article">  After a series of posts about the implementation of unpretentious toys on JavaScript in 30 lines, I decided to try myself in this "competition".  After sitting in the evening, it turned out to create a ‚Äúfull-fledged‚Äù Roguelike / RPG (I do not understand genres too much, but something happened in this direction).  At the same time I learned JavaScript (I had never written on it before, somehow I indulge in all C ++). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c9/e91/3af/4c9e913afdd7dc1406b611d939b3dfbe.png" alt="image"><br><br>  Features: <br><ul><li>  Randomly generated world </li><li>  Bleeding character </li><li>  3 types of enemies and the final boss </li><li>  Inventory with potion bottles and store to replenish them </li></ul><br><a name="habracut"></a><br><h5>  About the game </h5><br>  You play as a brave knight who must save the princess from the dragon.  On the way to the dragon cave with a knight, various adventures take place, such as fighting monsters and visiting small settlements.  After battles with monsters, the hero gets gold and life experience.  Gold can be spent on treatment and purchase of healing potions in the shops that are on the way.  Life experience increases the level of the hero, from which his attack and defense grows.  The goal of the game is to comprehensively prepare for the fight with the dragon, and then defeat him and free the princess. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Link to <a href="http://jsfiddle.net/kPZaP/3/embedded/result/">fiddle</a> . <br><br><h5>  Code </h5><br>  As a basis, I took the code from <a href="http://habrahabr.ru/post/202556/">this post</a> , and then ‚Äúdoped‚Äù it to the state I needed. <br><br>  Source code (look at <a href="http://jsfiddle.net/kPZaP/2/">fiddle</a> ): <br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre><code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elid, wi, he, exp, pot, gld, hp, lvl, cur_e, e_sz</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ evs[cur_e][<span class="hljs-number"><span class="hljs-number">8</span></span>]-=lvl*<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(evs[cur_e][<span class="hljs-number"><span class="hljs-number">8</span></span>]&lt;=<span class="hljs-number"><span class="hljs-number">0</span></span>) { alert(<span class="hljs-string"><span class="hljs-string">"Monster defeated and you got "</span></span>+evs[cur_e][<span class="hljs-number"><span class="hljs-number">10</span></span>]+<span class="hljs-string"><span class="hljs-string">"EXP and $"</span></span>+evs[cur_e][<span class="hljs-number"><span class="hljs-number">11</span></span>]); exp+=evs[cur_e][<span class="hljs-number"><span class="hljs-number">10</span></span>];gld+=evs[cur_e][<span class="hljs-number"><span class="hljs-number">11</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(exp&gt;=lvl*<span class="hljs-number"><span class="hljs-number">10</span></span>){exp-=lvl*<span class="hljs-number"><span class="hljs-number">10</span></span>;lvl++;alert(<span class="hljs-string"><span class="hljs-string">"Level Up!"</span></span>)} cur_e++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(cur_e==e_sz) alert(<span class="hljs-string"><span class="hljs-string">"Victory!"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { hp-=<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(<span class="hljs-number"><span class="hljs-number">0</span></span>,evs[cur_e][<span class="hljs-number"><span class="hljs-number">9</span></span>]-lvl*<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hp&lt;=<span class="hljs-number"><span class="hljs-number">0</span></span>) alert(<span class="hljs-string"><span class="hljs-string">"Game Over!"</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> use = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pot&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){pot--;hp+=<span class="hljs-number"><span class="hljs-number">10</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hp&gt;<span class="hljs-number"><span class="hljs-number">100</span></span>)hp=<span class="hljs-number"><span class="hljs-number">100</span></span>} } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nxt = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ cur_e++ }, battle = [<span class="hljs-string"><span class="hljs-string">"Attack"</span></span>,<span class="hljs-string"><span class="hljs-string">"Use Potion +10HP"</span></span>,<span class="hljs-string"><span class="hljs-string">"Skip Battle"</span></span>,hit,use,nxt], canvas=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(elid), ctx=canvas.getContext(<span class="hljs-string"><span class="hljs-string">"2d"</span></span>), evs=[], e_tp=[ [<span class="hljs-string"><span class="hljs-string">"Shop"</span></span>, <span class="hljs-string"><span class="hljs-string">"Wizard provides his services"</span></span>, <span class="hljs-string"><span class="hljs-string">"Buy Potion $20"</span></span>, <span class="hljs-string"><span class="hljs-string">"Full Heal $100"</span></span>, <span class="hljs-string"><span class="hljs-string">"Leave"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gld&gt;=<span class="hljs-number"><span class="hljs-number">20</span></span>){gld-=<span class="hljs-number"><span class="hljs-number">20</span></span>;pot++} }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gld&gt;=<span class="hljs-number"><span class="hljs-number">100</span></span>){gld-=<span class="hljs-number"><span class="hljs-number">100</span></span>;hp=<span class="hljs-number"><span class="hljs-number">100</span></span>} }, nxt ], [<span class="hljs-string"><span class="hljs-string">"Skeleton"</span></span>, <span class="hljs-string"><span class="hljs-string">"A terrible skeleton on your way"</span></span>].concat(battle,<span class="hljs-number"><span class="hljs-number">70</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>), [<span class="hljs-string"><span class="hljs-string">"Goblin"</span></span>, <span class="hljs-string"><span class="hljs-string">"Green goblin wants to get your money"</span></span>].concat(battle,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>), [<span class="hljs-string"><span class="hljs-string">"Slime"</span></span>, <span class="hljs-string"><span class="hljs-string">"What the strange jelly monster?"</span></span>].concat(battle,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>), [<span class="hljs-string"><span class="hljs-string">"Dragon"</span></span>, <span class="hljs-string"><span class="hljs-string">"Omg! It is evil Dragon!"</span></span>,<span class="hljs-string"><span class="hljs-string">"Attack"</span></span>,<span class="hljs-string"><span class="hljs-string">"Use Potion +10HP"</span></span>,<span class="hljs-string"><span class="hljs-string">"-"</span></span>,hit,use,,<span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span> ] ], q=e_tp.length<span class="hljs-number"><span class="hljs-number">-1</span></span>; canvas.width=wi; canvas.height=he; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;e_sz<span class="hljs-number"><span class="hljs-number">-1</span></span>;i++) evs.push( e_tp[<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random()*q)].slice(<span class="hljs-number"><span class="hljs-number">0</span></span>) ); evs.push( e_tp[q].slice(<span class="hljs-number"><span class="hljs-number">0</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> game = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ctx.clearRect(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,wi,he); ctx.fillText(<span class="hljs-string"><span class="hljs-string">"NanoRPG in 30 lines of JavaScript by ripatti"</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>); ctx.fillText(<span class="hljs-string"><span class="hljs-string">"LVL "</span></span>+lvl+<span class="hljs-string"><span class="hljs-string">" HP "</span></span>+hp+<span class="hljs-string"><span class="hljs-string">"/100 EXP "</span></span>+exp+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+lvl*<span class="hljs-number"><span class="hljs-number">10</span></span>+<span class="hljs-string"><span class="hljs-string">" ATK "</span></span>+(lvl*<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">6</span></span>)+ <span class="hljs-string"><span class="hljs-string">" DEF "</span></span>+(lvl*<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>)+<span class="hljs-string"><span class="hljs-string">" Gold $"</span></span>+gld+<span class="hljs-string"><span class="hljs-string">" Potions "</span></span>+pot,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;e_sz;i++) ctx.fillText((i==e_sz<span class="hljs-number"><span class="hljs-number">-1</span></span>||i&lt;=cur_e)?evs[i][<span class="hljs-number"><span class="hljs-number">0</span></span>]:<span class="hljs-string"><span class="hljs-string">"??"</span></span>,i*<span class="hljs-number"><span class="hljs-number">50</span></span>+<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>); ctx.fillText(<span class="hljs-string"><span class="hljs-string">"@"</span></span>,cur_e*<span class="hljs-number"><span class="hljs-number">50</span></span>+<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>); ctx.fillText(evs[cur_e][<span class="hljs-number"><span class="hljs-number">1</span></span>],<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (evs[cur_e].length&gt;<span class="hljs-number"><span class="hljs-number">8</span></span>) ctx.fillText(<span class="hljs-string"><span class="hljs-string">"Enemy HP "</span></span>+evs[cur_e][<span class="hljs-number"><span class="hljs-number">8</span></span>],<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { ctx.strokeRect(i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">120</span></span>,<span class="hljs-number"><span class="hljs-number">110</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>); ctx.fillText(evs[cur_e][i+<span class="hljs-number"><span class="hljs-number">2</span></span>],i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">133</span></span>); } }, <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">5</span></span>&lt;=e.pageX &amp;&amp; e.pageX&lt;i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">115</span></span> &amp;&amp; <span class="hljs-number"><span class="hljs-number">120</span></span>&lt;=e.pageY &amp;&amp; e.pageY&lt;<span class="hljs-number"><span class="hljs-number">140</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hp&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) evs[cur_e][i+<span class="hljs-number"><span class="hljs-number">5</span></span>]() }, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); })(<span class="hljs-string"><span class="hljs-string">"#canvas"</span></span>,<span class="hljs-number"><span class="hljs-number">365</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> </div></div><br><br>  A slightly more readable version in 50 lines (look at <a href="http://jsfiddle.net/kPZaP/3/">fiddle</a> ): <br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elid, wi, he, exp, pot, gld, hp, lvl, cur_e, e_sz</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ evs[cur_e][<span class="hljs-number"><span class="hljs-number">8</span></span>]-=lvl*<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (evs[cur_e][<span class="hljs-number"><span class="hljs-number">8</span></span>]&lt;=<span class="hljs-number"><span class="hljs-number">0</span></span>) { alert(<span class="hljs-string"><span class="hljs-string">"Monster defeated and you got "</span></span>+evs[cur_e][<span class="hljs-number"><span class="hljs-number">10</span></span>]+<span class="hljs-string"><span class="hljs-string">"EXP and $"</span></span>+evs[cur_e][<span class="hljs-number"><span class="hljs-number">11</span></span>]); exp+=evs[cur_e][<span class="hljs-number"><span class="hljs-number">10</span></span>]; gld+=evs[cur_e][<span class="hljs-number"><span class="hljs-number">11</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (exp&gt;=lvl*<span class="hljs-number"><span class="hljs-number">10</span></span>) { exp-=lvl*<span class="hljs-number"><span class="hljs-number">10</span></span>; lvl++; alert(<span class="hljs-string"><span class="hljs-string">"Level Up!"</span></span>) } cur_e++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur_e==e_sz) alert(<span class="hljs-string"><span class="hljs-string">"Victory!"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { hp-=<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(<span class="hljs-number"><span class="hljs-number">0</span></span>,evs[cur_e][<span class="hljs-number"><span class="hljs-number">9</span></span>]-lvl*<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hp&lt;=<span class="hljs-number"><span class="hljs-number">0</span></span>) alert(<span class="hljs-string"><span class="hljs-string">"Game Over!"</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> use = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pot&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){pot--;hp+=<span class="hljs-number"><span class="hljs-number">10</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(hp&gt;<span class="hljs-number"><span class="hljs-number">100</span></span>)hp=<span class="hljs-number"><span class="hljs-number">100</span></span>} } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nxt = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ cur_e++ } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> battle = [<span class="hljs-string"><span class="hljs-string">"Attack"</span></span>, <span class="hljs-string"><span class="hljs-string">"Use Potion +10HP"</span></span>, <span class="hljs-string"><span class="hljs-string">"Skip Battle"</span></span>, hit, use, nxt]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(elid), ctx=canvas.getContext(<span class="hljs-string"><span class="hljs-string">"2d"</span></span>); canvas.width=wi; canvas.height=he; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> evs=[], e_tp=[ [<span class="hljs-string"><span class="hljs-string">"Shop"</span></span>, <span class="hljs-string"><span class="hljs-string">"Wizard provides his services"</span></span>, <span class="hljs-string"><span class="hljs-string">"Buy Potion $20"</span></span>, <span class="hljs-string"><span class="hljs-string">"Full Heal $100"</span></span>, <span class="hljs-string"><span class="hljs-string">"Leave"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gld&gt;=<span class="hljs-number"><span class="hljs-number">20</span></span>){gld-=<span class="hljs-number"><span class="hljs-number">20</span></span>;pot++} }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gld&gt;=<span class="hljs-number"><span class="hljs-number">100</span></span>){gld-=<span class="hljs-number"><span class="hljs-number">100</span></span>;hp=<span class="hljs-number"><span class="hljs-number">100</span></span>} }, nxt ], [<span class="hljs-string"><span class="hljs-string">"Skeleton"</span></span>, <span class="hljs-string"><span class="hljs-string">"A terrible skeleton on your way"</span></span>].concat(battle,<span class="hljs-number"><span class="hljs-number">70</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>), [<span class="hljs-string"><span class="hljs-string">"Goblin"</span></span>, <span class="hljs-string"><span class="hljs-string">"Green goblin wants to get your money"</span></span>].concat(battle,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>), [<span class="hljs-string"><span class="hljs-string">"Slime"</span></span>, <span class="hljs-string"><span class="hljs-string">"What the strange jelly monster?"</span></span>].concat(battle,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>), [<span class="hljs-string"><span class="hljs-string">"Dragon"</span></span>, <span class="hljs-string"><span class="hljs-string">"Omg! It is evil Dragon!"</span></span>,<span class="hljs-string"><span class="hljs-string">"Attack"</span></span>,<span class="hljs-string"><span class="hljs-string">"Use Potion +10HP"</span></span>,<span class="hljs-string"><span class="hljs-string">"-"</span></span>,hit,use,,<span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span> ] ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> q=e_tp.length<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;e_sz<span class="hljs-number"><span class="hljs-number">-1</span></span>;i++) evs.push( e_tp[<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random()*q)].slice(<span class="hljs-number"><span class="hljs-number">0</span></span>) ); evs.push( e_tp[q].slice(<span class="hljs-number"><span class="hljs-number">0</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> game = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ctx.clearRect(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,wi,he); ctx.fillText(<span class="hljs-string"><span class="hljs-string">"NanoRPG in 30 lines of JavaScript by ripatti"</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>); ctx.fillText(<span class="hljs-string"><span class="hljs-string">"LVL "</span></span>+lvl+<span class="hljs-string"><span class="hljs-string">" HP "</span></span>+hp+<span class="hljs-string"><span class="hljs-string">"/100 EXP "</span></span>+exp+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+lvl*<span class="hljs-number"><span class="hljs-number">10</span></span>+<span class="hljs-string"><span class="hljs-string">" ATK "</span></span>+(lvl*<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">6</span></span>)+ <span class="hljs-string"><span class="hljs-string">" DEF "</span></span>+(lvl*<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>)+<span class="hljs-string"><span class="hljs-string">" Gold $"</span></span>+gld+<span class="hljs-string"><span class="hljs-string">" Potions "</span></span>+pot,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;e_sz;i++) ctx.fillText((i==e_sz<span class="hljs-number"><span class="hljs-number">-1</span></span>||i&lt;=cur_e)?evs[i][<span class="hljs-number"><span class="hljs-number">0</span></span>]:<span class="hljs-string"><span class="hljs-string">"??"</span></span>,i*<span class="hljs-number"><span class="hljs-number">50</span></span>+<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>); ctx.fillText(<span class="hljs-string"><span class="hljs-string">"@"</span></span>,cur_e*<span class="hljs-number"><span class="hljs-number">50</span></span>+<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>); ctx.fillText(evs[cur_e][<span class="hljs-number"><span class="hljs-number">1</span></span>],<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (evs[cur_e].length&gt;<span class="hljs-number"><span class="hljs-number">8</span></span>) ctx.fillText(<span class="hljs-string"><span class="hljs-string">"Enemy HP "</span></span>+evs[cur_e][<span class="hljs-number"><span class="hljs-number">8</span></span>],<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { ctx.strokeRect(i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">120</span></span>,<span class="hljs-number"><span class="hljs-number">110</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>); ctx.fillText(evs[cur_e][i+<span class="hljs-number"><span class="hljs-number">2</span></span>],i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">133</span></span>); } }, <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hp&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">5</span></span>&lt;=e.pageX &amp;&amp; e.pageX&lt;i*<span class="hljs-number"><span class="hljs-number">120</span></span>+<span class="hljs-number"><span class="hljs-number">115</span></span> &amp;&amp; <span class="hljs-number"><span class="hljs-number">120</span></span>&lt;=e.pageY &amp;&amp; e.pageY&lt;<span class="hljs-number"><span class="hljs-number">140</span></span>) evs[cur_e][i+<span class="hljs-number"><span class="hljs-number">5</span></span>]() }, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); })(<span class="hljs-string"><span class="hljs-string">"#canvas"</span></span>,<span class="hljs-number"><span class="hljs-number">365</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre></div></div><br><br>  I did not consider the code in html and css, but if anyone is interested: html - 1 line of code, css - 4. <br><br><h5>  Conclusion </h5><br>  Thank you <a href="http://habrahabr.ru/users/agegorin/" class="user_link">agegorin</a> for the <a href="http://habrahabr.ru/post/202556/">race</a> , <a href="http://habrahabr.ru/users/djcomandos/" class="user_link">DjComandos</a> for the <a href="http://habrahabr.ru/post/202476/">snake</a> and <a href="http://habrahabr.ru/users/linoleum/" class="user_link">linoleum</a> for the <a href="http://habrahabr.ru/users/linoleum/" class="user_link">arkanoid</a> .  It was interesting to read the source code and based on this to write something of my own. <br><br><h5>  UPD Roguelike / RPG in 4KB JavaScript Code </h5><br>  Comrade <a href="http://habrahabr.ru/users/shvedovka/" class="user_link">shvedovka</a> offered to make a cyclical game with complication, which I actually did.  In 30 lines it already did not climb at all and I took another restriction: the code should be no more than 4 kilobytes (this agrees with the remark of <a href="http://habrahabr.ru/users/lolmaus/" class="user_link">lolmaus</a> , and I personally like it more).  Having set up a cyclical game, I added a few more events - I filled the game with content for the very limitations. <br><br>  Namely: <br><ul><li>  Arena, where you can, while exercising, exchange money for experience </li><li>  Forge, where you can improve the sword and armor </li><li>  +2 types of enemies - now there are 5 types of them </li></ul><br>  Small changes in the generation of worlds: <br><ul><li>  Some monsters and buildings only appear if you play the game several times. </li><li>  One of the two locations in front of the dragon castle is sure to be a shop. </li></ul><br>  And a lot of small changes in terms of balancing everything.  And yes ... now the princess can really be saved. <br><br>  Link to this version of the game on <a href="http://jsfiddle.net/kPZaP/16/embedded/result/">fiddle</a> .  It turned out pretty hardcore. <br><br>  Well, the <a href="http://jsfiddle.net/kPZaP/16/">code</a> , of course.  The formatting is not quite visual - I pauled a few spaces to fit in 4000 characters.  In principle, the code can be further tightened to cram another event, for example (there was an idea to make something like a casino).  But I'm too lazy to do it. <br><br>  At this work on the game, I think finished. </div><p>Source: <a href="https://habr.com/ru/post/202684/">https://habr.com/ru/post/202684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202674/index.html">We test EntityFramework queries using SQL Server Compact Edition</a></li>
<li><a href="../202676/index.html">Stir, but do not stir or how we made a game for which we are not ashamed</a></li>
<li><a href="../202678/index.html">Drawing under Windows in C ++, or ‚ÄúGuys, I'm crazy too!‚Äù (30+ lines of code)</a></li>
<li><a href="../202680/index.html">Say a word about poor FORTRAN</a></li>
<li><a href="../202682/index.html">A pair of old tasks in Massachusetts</a></li>
<li><a href="../202686/index.html">20 and 1 javascript lotion that I just can't remember</a></li>
<li><a href="../202688/index.html">DataSnap Callback usage example: data request from user during server method call</a></li>
<li><a href="../202690/index.html">New 2GIS</a></li>
<li><a href="../202692/index.html">Adding widescreen permissions to Grand Theft Auto</a></li>
<li><a href="../202694/index.html">Apple re-invented TV!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>