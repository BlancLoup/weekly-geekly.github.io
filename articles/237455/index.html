<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>You cannot upload files to the server in mobile Safari 8.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sad but true. The new version of iOS contains a bug that makes it impossible to send any files to the server from the browser. When you select a file ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>You cannot upload files to the server in mobile Safari 8.0</h1><div class="post__text post__text-html js-mediator-article"> Sad but true.  The new version of iOS contains a bug that makes it impossible to send any files to the server from the browser.  When you select a file in any form on the HTML page and try to send it, the browser sends a request without a file.  It shows that it is waiting for a response to the request, but in fact the answer does not come. <br><br>  Moreover, the bug concerns not only HTML forms.  If you send a file from Javascript by constructing a <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData"><code>FormData</code></a> object (part of the XMLHttpRequest Level 2 API), this results in the same result.  And even if you do the same from a native application that wraps an HTML browser (for example, Apache Cordova), you get the same result. <br><br>  Why the answer does not come.  If the file was simply not sent, we might expect that an empty file would come to the server or the server would return an error that the form was submitted without a file.  However, the server simply does not send any response (even 400 bad request) and does not close the connection.  The thing is, what kind of request sends Safari. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs coffeescript">POST <span class="hljs-regexp"><span class="hljs-regexp">/form/</span></span> HTTP<span class="hljs-regexp"><span class="hljs-regexp">/1.1 Host: 192.168.5.59:8000 Referer: http:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/192.168.5.59:8000/</span></span> Content-Type: multipart<span class="hljs-regexp"><span class="hljs-regexp">/form-data; boundary=----WebKitFormBoundaryGVP84V9BXQSqpZw2 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/</span></span>*;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span> Content-Length: <span class="hljs-number"><span class="hljs-number">134573</span></span> Accept-Language: ru Origin: http:<span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.59</span></span>:<span class="hljs-number"><span class="hljs-number">8000</span></span> Accept-Encoding: gzip, deflate Connection: keep-alive User-Agent: Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (iPhone; CPU iPhone OS <span class="hljs-number"><span class="hljs-number">8</span></span>_0 like Mac OS X) AppleWebKit/<span class="hljs-number"><span class="hljs-number">600.1</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> (KHTML, like Gecko) Version/<span class="hljs-number"><span class="hljs-number">8.0</span></span> Mobile/<span class="hljs-number"><span class="hljs-number">12</span></span>A365 Safari/<span class="hljs-number"><span class="hljs-number">600.1</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> ------WebKitFormBoundaryGVP84V9BXQSqpZw2 Content-Disposition: form-data; name=<span class="hljs-string"><span class="hljs-string">"file"</span></span>; filename=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> Content-Type: image/jpeg ------WebKitFormBoundaryGVP84V9BXQSqpZw2--</code> </pre><br>  From the headers you can see that the request with the file sending should be 134573 bytes in length (Content-Length header), and in fact there is no file body in the request body, which is why the actual length of the request is 176 bytes.  As a result, the server waits for the browser to send the missing 134397 bytes, and the browser thinks that it has already sent the entire request and is waiting for a response from the server.  Neither one nor the other will ever happen and the connection is simply closed by timeout. <br><br>  The bug manifests itself in Safari 8.0 (build 600.1.4) under iOS 8.0 (build 12A365).  Interestingly, under the iOS simulator that comes with Xcode, this bug does not appear, although the build numbers are the same there.  However, on real devices (iPhone 4S, iPhone 5, iPad 3 were checked), the bug is always played.  We hope that the bug will be fixed in the next minor update. <br><br>  <b>If someone wants to see the error himself or try other devices.</b> <br><br>  The debugger in Safari is useless here, because in any case it shows the request body without the contents of the files.  Since  error directly in working with HTTP, making an online example is quite difficult.  I did not think of anything smarter than running netcat and sending requests for it.  Here is the instruction: <br><br>  1) Run <code>netcat -l 8000</code> on a computer in the same wi-fi grid with the device. <br>  2) <a href="http://jsbin.com/">Make the</a> simplest form on <a href="http://jsbin.com/">jsbin</a> or <a href="http://jsfiddle.net/">jsfiddle</a> : <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://192.168.5.59:8000/form/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Where 192.168.5.59 is the ip address of the computer where netcat is running. <br><br>  3) Open the made bin or fiddle on the device.  Choose any file, send. <br>  4) Look at the output of netcat. <br><br>  If the answer is similar to the one in the article, then the bug is present.  If before the last line there is the contents of the file, then no. </div><p>Source: <a href="https://habr.com/ru/post/237455/">https://habr.com/ru/post/237455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237439/index.html">How to unlock iPad 3G locked in iCloud</a></li>
<li><a href="../237441/index.html">History: QuakeLive native Linux downloader</a></li>
<li><a href="../237443/index.html">The keyboard of the new generation - "10th"</a></li>
<li><a href="../237445/index.html">Appeared RTM release (for manufacturers) Ubuntu for smartphones</a></li>
<li><a href="../237447/index.html">V2V, V2I, technology and the possible future of road transport</a></li>
<li><a href="../237459/index.html">How to develop an API with backward compatibility. Yandex Workshop</a></li>
<li><a href="../237461/index.html">Social games. Start and Promotion</a></li>
<li><a href="../237465/index.html">RailsClub 2014: Interview With Kirill Gorin</a></li>
<li><a href="../237467/index.html">Smartphones Sony Xperia Z3 and Z3 Compact went on sale</a></li>
<li><a href="../237469/index.html">I was asked to hack the program at the interview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>