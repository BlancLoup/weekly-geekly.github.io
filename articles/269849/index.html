<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PostgreSQL 9.5: what's new? Part 3. GROUPING SETS, CUBE, ROLLUP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to get acquainted with new features in PostgreSQL 9.5. 
 Part 1. INSERT ... ON CONFLICT DO NOTHING / UPDATE and ROW LEVEL SECURITY 
 Part ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PostgreSQL 9.5: what's new? Part 3. GROUPING SETS, CUBE, ROLLUP</h1><div class="post__text post__text-html js-mediator-article">  We continue to get acquainted with new features in PostgreSQL 9.5. <br>  <a href="http://habrahabr.ru/post/264281/">Part 1. INSERT ... ON CONFLICT DO NOTHING / UPDATE and ROW LEVEL SECURITY</a> <br>  <a href="http://habrahabr.ru/post/266759/">Part 2. TABLESAMPLE</a> <br>  Today we consider multiple groups in one query.  This feature was described in the SQL-99 standard.  It is convenient to use it if you need to make several queries to the same table, differing only in the <b>GROUP BY clause</b> .  For this, <b>GROUPING SETS, ROLLUP, CUBE</b> modifiers are specified as a grouping element after the <b>GROUP BY</b> keyword. <br>  Let's take a closer look at how this works. <br><a name="habracut"></a><br>  Suppose we have a scheme in which there is data on payments, each payment has a type, a city in which this payment was made and the amount of the payment.  The city necessarily has a country and, optionally, a region.  Below are the requests to create such a scheme and fill it with data. <br><div class="spoiler">  <b class="spoiler_title">Creating a schema</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> payment; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> payment_type; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> city; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> state; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> country; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> country ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SERIAL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> state ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SERIAL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, country_id <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> country (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> city ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SERIAL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, state_id <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> state (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>), country_id <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> country (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>), population <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> payment_type ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SERIAL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> payment ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> BIGSERIAL PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, payment_type_id <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> payment_type (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>), city_id <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> city (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>), amount <span class="hljs-built_in"><span class="hljs-built_in">NUMERIC</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> country (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'Russia'</span></span>), (<span class="hljs-string"><span class="hljs-string">'Ukraine'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> state (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, country_id) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'Moscow region'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-string"><span class="hljs-string">'Samara region'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-string"><span class="hljs-string">'Kursk region'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-string"><span class="hljs-string">'Tatarstan'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-string"><span class="hljs-string">'Kiev region'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-string"><span class="hljs-string">'Lugansk region'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-string"><span class="hljs-string">'Lvov region'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-string"><span class="hljs-string">'Odessa region'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); ‚Äì-          ,      <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> city (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, state_id, country_id, population) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'Moscow'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12197596</span></span>), (<span class="hljs-string"><span class="hljs-string">'Dubna'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">75176</span></span>), (<span class="hljs-string"><span class="hljs-string">'Samara'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1171820</span></span>), (<span class="hljs-string"><span class="hljs-string">'Tolyatti'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">719646</span></span>), (<span class="hljs-string"><span class="hljs-string">'Syzran'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">175222</span></span>), (<span class="hljs-string"><span class="hljs-string">'Novokuybyshevsk'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">105007</span></span>), (<span class="hljs-string"><span class="hljs-string">'Kursk'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">435117</span></span>), (<span class="hljs-string"><span class="hljs-string">'Kazan'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1205651</span></span>), (<span class="hljs-string"><span class="hljs-string">'Kiev'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2888470</span></span>), (<span class="hljs-string"><span class="hljs-string">'Irpen'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">39972</span></span>), (<span class="hljs-string"><span class="hljs-string">'Borispol'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">60102</span></span>), (<span class="hljs-string"><span class="hljs-string">'Belaya Tserkov'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">211205</span></span>), (<span class="hljs-string"><span class="hljs-string">'Lugansk'</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">417990</span></span>), (<span class="hljs-string"><span class="hljs-string">'Lisichansk'</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">103459</span></span>), (<span class="hljs-string"><span class="hljs-string">'Severodonetsk'</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">108899</span></span>), (<span class="hljs-string"><span class="hljs-string">'Popasnaya'</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">21765</span></span>), (<span class="hljs-string"><span class="hljs-string">'Lvov'</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">729038</span></span>), (<span class="hljs-string"><span class="hljs-string">'Drogobych'</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">76866</span></span>), (<span class="hljs-string"><span class="hljs-string">'Odessa'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1017022</span></span>), (<span class="hljs-string"><span class="hljs-string">'Izmail'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">72501</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> payment_type (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'Online'</span></span>), (<span class="hljs-string"><span class="hljs-string">'Box office'</span></span>), (<span class="hljs-string"><span class="hljs-string">'Terminal'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> payment (payment_type_id, city_id, amount) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ceil</span></span>(random() * <span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ceil</span></span>(random() * <span class="hljs-number"><span class="hljs-number">20</span></span>), trunc(<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(random() * <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NUMERIC</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10000</span></span>);</code> </pre> <br></div></div><br>  Suppose we want to get statistics on the amount of payments in each city and in each country.  Previously, it was necessary to write a query of the form: <br><pre> <code class="sql hljs">(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), c.country_id, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> city_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id=c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c.country_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c.country_id) <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, p.city_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> p.city_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> p.city_id)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  country_id </th><th>  city_id </th></tr><tr><td>  19794121.93 </td><td>  one </td><td>  Null </td></tr><tr><td>  30138426.57 </td><td>  2 </td><td>  Null </td></tr><tr><td>  2420939.72 </td><td>  Null </td><td>  one </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  2 </td></tr><tr><td>  2357570.54 </td><td>  Null </td><td>  3 </td></tr><tr><td>  2796471.48 </td><td>  Null </td><td>  four </td></tr><tr><td>  2327588.11 </td><td>  Null </td><td>  five </td></tr><tr><td>  2563701.69 </td><td>  Null </td><td>  6 </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  7 </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  eight </td></tr><tr><td>  2509228.24 </td><td>  Null </td><td>  9 </td></tr><tr><td>  2716771.77 </td><td>  Null </td><td>  ten </td></tr><tr><td>  2745394.99 </td><td>  Null </td><td>  eleven </td></tr><tr><td>  2554721.34 </td><td>  Null </td><td>  12 </td></tr><tr><td>  2526112.36 </td><td>  Null </td><td>  13 </td></tr><tr><td>  2818708.34 </td><td>  Null </td><td>  14 </td></tr><tr><td>  2437768.84 </td><td>  Null </td><td>  15 </td></tr><tr><td>  2246483.68 </td><td>  Null </td><td>  sixteen </td></tr><tr><td>  2384795.14 </td><td>  Null </td><td>  17 </td></tr><tr><td>  2437849.05 </td><td>  Null </td><td>  18 </td></tr><tr><td>  2470876.07 </td><td>  Null </td><td>  nineteen </td></tr><tr><td>  2289716.75 </td><td>  Null </td><td>  20 </td></tr></tbody></table><br></div></div><br>  From version 9.5 it is easier to write a similar request like this: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), c.country_id, p.city_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(c.country_id, p.city_id);</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  country_id </th><th>  city_id </th></tr><tr><td>  19794121.93 </td><td>  one </td><td>  Null </td></tr><tr><td>  30138426.57 </td><td>  2 </td><td>  Null </td></tr><tr><td>  2420939.72 </td><td>  Null </td><td>  one </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  2 </td></tr><tr><td>  2357570.54 </td><td>  Null </td><td>  3 </td></tr><tr><td>  2796471.48 </td><td>  Null </td><td>  four </td></tr><tr><td>  2327588.11 </td><td>  Null </td><td>  five </td></tr><tr><td>  2563701.69 </td><td>  Null </td><td>  6 </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  7 </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  eight </td></tr><tr><td>  2509228.24 </td><td>  Null </td><td>  9 </td></tr><tr><td>  2716771.77 </td><td>  Null </td><td>  ten </td></tr><tr><td>  2745394.99 </td><td>  Null </td><td>  eleven </td></tr><tr><td>  2554721.34 </td><td>  Null </td><td>  12 </td></tr><tr><td>  2526112.36 </td><td>  Null </td><td>  13 </td></tr><tr><td>  2818708.34 </td><td>  Null </td><td>  14 </td></tr><tr><td>  2437768.84 </td><td>  Null </td><td>  15 </td></tr><tr><td>  2246483.68 </td><td>  Null </td><td>  sixteen </td></tr><tr><td>  2384795.14 </td><td>  Null </td><td>  17 </td></tr><tr><td>  2437849.05 </td><td>  Null </td><td>  18 </td></tr><tr><td>  2470876.07 </td><td>  Null </td><td>  nineteen </td></tr><tr><td>  2289716.75 </td><td>  Null </td><td>  20 </td></tr></tbody></table><br></div></div><br>  As you can see, the <b>GROUPING SETS</b> as a result of the query returns data as follows: in each row of one of the columns listed in brackets corresponds to the value, while the remaining columns (from the list in brackets) are filled with NULL.  Columns not listed in <b>GROUPING SETS</b> are calculated as usual. <br><br>  To get the full amount (without grouping), you can use the empty grouping - <b>()</b> .  With empty grouping, all fields participating in <b>GROUPING SETS</b> are NULL: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), p.city_id, c.country_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, C.country_id, ());</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  country_id </th><th>  city_id </th></tr><tr><td>  19794121.93 </td><td>  one </td><td>  Null </td></tr><tr><td>  30138426.57 </td><td>  2 </td><td>  Null </td></tr><tr><td>  49932548.5 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2420939.72 </td><td>  Null </td><td>  one </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  2 </td></tr><tr><td>  2357570.54 </td><td>  Null </td><td>  3 </td></tr><tr><td>  2796471.48 </td><td>  Null </td><td>  four </td></tr><tr><td>  2327588.11 </td><td>  Null </td><td>  five </td></tr><tr><td>  2563701.69 </td><td>  Null </td><td>  6 </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  7 </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  eight </td></tr><tr><td>  2509228.24 </td><td>  Null </td><td>  9 </td></tr><tr><td>  2716771.77 </td><td>  Null </td><td>  ten </td></tr><tr><td>  2745394.99 </td><td>  Null </td><td>  eleven </td></tr><tr><td>  2554721.34 </td><td>  Null </td><td>  12 </td></tr><tr><td>  2526112.36 </td><td>  Null </td><td>  13 </td></tr><tr><td>  2818708.34 </td><td>  Null </td><td>  14 </td></tr><tr><td>  2437768.84 </td><td>  Null </td><td>  15 </td></tr><tr><td>  2246483.68 </td><td>  Null </td><td>  sixteen </td></tr><tr><td>  2384795.14 </td><td>  Null </td><td>  17 </td></tr><tr><td>  2437849.05 </td><td>  Null </td><td>  18 </td></tr><tr><td>  2470876.07 </td><td>  Null </td><td>  nineteen </td></tr><tr><td>  2289716.75 </td><td>  Null </td><td>  20 </td></tr></tbody></table><br></div></div><br>  Now let's try to get the amount of payments in the context of cities, regions and countries: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), p.city_id, c.state_id, c.country_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, c.state_id, c.country_id);</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  city_id </th><th>  state_id </th><th>  country_id </th></tr><tr><td>  2420939.72 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  2611787.51 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2357570.54 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2796471.48 </td><td>  four </td><td>  Null </td><td>  Null </td></tr><tr><td>  2327588.11 </td><td>  five </td><td>  Null </td><td>  Null </td></tr><tr><td>  2563701.69 </td><td>  6 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2442654.38 </td><td>  7 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2273408.5 </td><td>  eight </td><td>  Null </td><td>  Null </td></tr><tr><td>  2509228.24 </td><td>  9 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2716771.77 </td><td>  ten </td><td>  Null </td><td>  Null </td></tr><tr><td>  2745394.99 </td><td>  eleven </td><td>  Null </td><td>  Null </td></tr><tr><td>  2554721.34 </td><td>  12 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2526112.36 </td><td>  13 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2818708.34 </td><td>  14 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2437768.84 </td><td>  15 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2246483.68 </td><td>  sixteen </td><td>  Null </td><td>  Null </td></tr><tr><td>  2384795.14 </td><td>  17 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2437849.05 </td><td>  18 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2470876.07 </td><td>  nineteen </td><td>  Null </td><td>  Null </td></tr><tr><td>  2289716.75 </td><td>  20 </td><td>  Null </td><td>  Null </td></tr><tr><td>  19794121.93 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  30138426.57 </td><td>  Null </td><td>  Null </td><td>  2 </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  one </td><td>  Null </td></tr><tr><td>  10045331.82 </td><td>  Null </td><td>  2 </td><td>  Null </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  3 </td><td>  Null </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  four </td><td>  Null </td></tr><tr><td>  8016888.1 </td><td>  Null </td><td>  five </td><td>  Null </td></tr><tr><td>  10029073.22 </td><td>  Null </td><td>  6 </td><td>  Null </td></tr><tr><td>  4822644.19 </td><td>  Null </td><td>  7 </td><td>  Null </td></tr><tr><td>  4760592.82 </td><td>  Null </td><td>  eight </td><td>  Null </td></tr><tr><td>  4930167.96 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr></tbody></table><br></div></div><br>  Strange, we did not make an empty grouping, but received a string in which all fields are NULL.  In fact, this happened because the <b>state_id</b> field <b>was</b> not filled in in Moscow and Kiev, therefore <b>GROUPING SETS</b> rightly did the grouping by <i>state_id = NULL</i> .  This is easily verified by running the following query: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> city_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>);</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th></tr><tr><td>  4930167.96 </td></tr></tbody></table><br></div></div><br>  Yes, our assumption turned out to be true and the amounts coincided. <br><br>  Well, where did this strange line come from, we figured it out, but how to distinguish in the next query, which of the lines <i>contains the</i> full amount, and which group is <i>state_id = NULL</i> ? <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), p.city_id, c.state_id, c.country_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, c.state_id, c.country_id, ());</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  city_id </th><th>  state_id </th><th>  country_id </th></tr><tr><td>  2420939.72 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  2611787.51 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2357570.54 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2796471.48 </td><td>  four </td><td>  Null </td><td>  Null </td></tr><tr><td>  2327588.11 </td><td>  five </td><td>  Null </td><td>  Null </td></tr><tr><td>  2563701.69 </td><td>  6 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2442654.38 </td><td>  7 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2273408.5 </td><td>  eight </td><td>  Null </td><td>  Null </td></tr><tr><td>  2509228.24 </td><td>  9 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2716771.77 </td><td>  ten </td><td>  Null </td><td>  Null </td></tr><tr><td>  2745394.99 </td><td>  eleven </td><td>  Null </td><td>  Null </td></tr><tr><td>  2554721.34 </td><td>  12 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2526112.36 </td><td>  13 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2818708.34 </td><td>  14 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2437768.84 </td><td>  15 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2246483.68 </td><td>  sixteen </td><td>  Null </td><td>  Null </td></tr><tr><td>  2384795.14 </td><td>  17 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2437849.05 </td><td>  18 </td><td>  Null </td><td>  Null </td></tr><tr><td>  2470876.07 </td><td>  nineteen </td><td>  Null </td><td>  Null </td></tr><tr><td>  2289716.75 </td><td>  20 </td><td>  Null </td><td>  Null </td></tr><tr><td>  49932548.5 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr><tr><td>  19794121.93 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  30138426.57 </td><td>  Null </td><td>  Null </td><td>  2 </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  one </td><td>  Null </td></tr><tr><td>  10045331.82 </td><td>  Null </td><td>  2 </td><td>  Null </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  3 </td><td>  Null </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  four </td><td>  Null </td></tr><tr><td>  8016888.1 </td><td>  Null </td><td>  five </td><td>  Null </td></tr><tr><td>  10029073.22 </td><td>  Null </td><td>  6 </td><td>  Null </td></tr><tr><td>  4822644.19 </td><td>  Null </td><td>  7 </td><td>  Null </td></tr><tr><td>  4760592.82 </td><td>  Null </td><td>  eight </td><td>  Null </td></tr><tr><td>  4930167.96 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr></tbody></table><br></div></div><br>  So in fact, the total value will be greater, you say, and you will be right.  Of course, in this query, you can understand that the line with the larger amount is the full amount.  However, if the table had not only positive values, but also negative ones, it would be more difficult to determine the full amount.  Well, or if you use another aggregate function: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(amount), p.city_id, c.state_id, c.country_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, c.state_id, c.country_id, ());</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  avg </th><th>  city_id </th><th>  state_id </th><th>  country_id </th></tr><tr><td>  4841.87944 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  5141.313996062992126 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4850.9681893004115226 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4958.2827659574468085 </td><td>  four </td><td>  Null </td><td>  Null </td></tr><tr><td>  4849.1418958333333333 </td><td>  five </td><td>  Null </td><td>  Null </td></tr><tr><td>  5096.8224453280318091 </td><td>  6 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5208.2182942430703625 </td><td>  7 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4985.5449561403508772 </td><td>  eight </td><td>  Null </td><td>  Null </td></tr><tr><td>  5038.6109236947791165 </td><td>  9 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5135.6744234404536862 </td><td>  ten </td><td>  Null </td><td>  Null </td></tr><tr><td>  5219.3821102661596958 </td><td>  eleven </td><td>  Null </td><td>  Null </td></tr><tr><td>  4903.4958541266794626 </td><td>  12 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5092.9684677419354839 </td><td>  13 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5006.5867495559502664 </td><td>  14 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4964.9059877800407332 </td><td>  15 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4992.1859555555555556 </td><td>  sixteen </td><td>  Null </td><td>  Null </td></tr><tr><td>  4694.4786220472440945 </td><td>  17 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5047.3065217391304348 </td><td>  18 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4883.1542885375494071 </td><td>  nineteen </td><td>  Null </td><td>  Null </td></tr><tr><td>  4945.392548596112311 </td><td>  20 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4993.25485 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr><tr><td>  4990.9535879979828543 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4994.7674129930394432 </td><td>  Null </td><td>  Null </td><td>  2 </td></tr><tr><td>  5141.313996062992126 </td><td>  Null </td><td>  one </td><td>  Null </td></tr><tr><td>  4941.1371470732907034 </td><td>  Null </td><td>  2 </td><td>  Null </td></tr><tr><td>  5208.2182942430703625 </td><td>  Null </td><td>  3 </td><td>  Null </td></tr><tr><td>  4985.5449561403508772 </td><td>  Null </td><td>  four </td><td>  Null </td></tr><tr><td>  5086.8579314720812183 </td><td>  Null </td><td>  five </td><td>  Null </td></tr><tr><td>  5014.53661 </td><td>  Null </td><td>  6 </td><td>  Null </td></tr><tr><td>  4866.4421695257315843 </td><td>  Null </td><td>  7 </td><td>  Null </td></tr><tr><td>  4912.8924871001031992 </td><td>  Null </td><td>  eight </td><td>  Null </td></tr><tr><td>  4940.0480561122244489 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr></tbody></table><br></div></div><br>  Which line corresponds to the average amount of payment in the table, and which - the average amount in Kiev and Moscow? <br>  Fortunately, there is a solution: the new <b>grouping ()</b> function, with the help of it we can find out whether a particular column is participating in a given row in a grouping.  If <b>grouping (column_name)</b> returns 0, then column_name participates in the grouping, if 1 - does not participate: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(amount), p.city_id, c.state_id, c.country_id, <span class="hljs-keyword"><span class="hljs-keyword">grouping</span></span>(c.state_id) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, c.state_id, c.country_id, ());</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  avg </th><th>  city_id </th><th>  state_id </th><th>  country_id </th><th>  grouping </th></tr><tr><td>  4841.87944 </td><td>  one </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5141.313996062992126 </td><td>  2 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4850.9681893004115226 </td><td>  3 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4958.2827659574468085 </td><td>  four </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4849.1418958333333333 </td><td>  five </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5096.8224453280318091 </td><td>  6 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5208.2182942430703625 </td><td>  7 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4985.5449561403508772 </td><td>  eight </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5038.6109236947791165 </td><td>  9 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5135.6744234404536862 </td><td>  ten </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5219.3821102661596958 </td><td>  eleven </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4903.4958541266794626 </td><td>  12 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5092.9684677419354839 </td><td>  13 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5006.5867495559502664 </td><td>  14 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4964.9059877800407332 </td><td>  15 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4992.1859555555555556 </td><td>  sixteen </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4694.4786220472440945 </td><td>  17 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  5047.3065217391304348 </td><td>  18 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4883.1542885375494071 </td><td>  nineteen </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4945.392548596112311 </td><td>  20 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4993.25485 </td><td>  Null </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  4990.9535879979828543 </td><td>  Null </td><td>  Null </td><td>  one </td><td>  one </td></tr><tr><td>  4994.7674129930394432 </td><td>  Null </td><td>  Null </td><td>  2 </td><td>  one </td></tr><tr><td>  5141.313996062992126 </td><td>  Null </td><td>  one </td><td>  Null </td><td>  0 </td></tr><tr><td>  4941.1371470732907034 </td><td>  Null </td><td>  2 </td><td>  Null </td><td>  0 </td></tr><tr><td>  5208.2182942430703625 </td><td>  Null </td><td>  3 </td><td>  Null </td><td>  0 </td></tr><tr><td>  4985.5449561403508772 </td><td>  Null </td><td>  four </td><td>  Null </td><td>  0 </td></tr><tr><td>  5086.8579314720812183 </td><td>  Null </td><td>  five </td><td>  Null </td><td>  0 </td></tr><tr><td>  5014.53661 </td><td>  Null </td><td>  6 </td><td>  Null </td><td>  0 </td></tr><tr><td>  4866.4421695257315843 </td><td>  Null </td><td>  7 </td><td>  Null </td><td>  0 </td></tr><tr><td>  4912.8924871001031992 </td><td>  Null </td><td>  eight </td><td>  Null </td><td>  0 </td></tr><tr><td>  4940.0480561122244489 </td><td>  Null </td><td>  Null </td><td>  Null </td><td>  0 </td></tr></tbody></table><br></div></div><br>  In fact, <b>grouping</b> returns a bitmask for the columns listed in it: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(amount), p.city_id, c.state_id, c.country_id, <span class="hljs-keyword"><span class="hljs-keyword">grouping</span></span>(p.city_id, c.state_id, c.country_id) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, c.state_id, c.country_id, ());</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  avg </th><th>  city_id </th><th>  state_id </th><th>  country_id </th><th>  grouping </th></tr><tr><td>  4841.87944 </td><td>  one </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5141.313996062992126 </td><td>  2 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4850.9681893004115226 </td><td>  3 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4958.2827659574468085 </td><td>  four </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4849.1418958333333333 </td><td>  five </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5096.8224453280318091 </td><td>  6 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5208.2182942430703625 </td><td>  7 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4985.5449561403508772 </td><td>  eight </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5038.6109236947791165 </td><td>  9 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5135.6744234404536862 </td><td>  ten </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5219.3821102661596958 </td><td>  eleven </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4903.4958541266794626 </td><td>  12 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5092.9684677419354839 </td><td>  13 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5006.5867495559502664 </td><td>  14 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4964.9059877800407332 </td><td>  15 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4992.1859555555555556 </td><td>  sixteen </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4694.4786220472440945 </td><td>  17 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  5047.3065217391304348 </td><td>  18 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4883.1542885375494071 </td><td>  nineteen </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4945.392548596112311 </td><td>  20 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  4993.25485 </td><td>  Null </td><td>  Null </td><td>  Null </td><td>  7 </td></tr><tr><td>  4990.9535879979828543 </td><td>  Null </td><td>  Null </td><td>  one </td><td>  6 </td></tr><tr><td>  4994.7674129930394432 </td><td>  Null </td><td>  Null </td><td>  2 </td><td>  6 </td></tr><tr><td>  5141.313996062992126 </td><td>  Null </td><td>  one </td><td>  Null </td><td>  five </td></tr><tr><td>  4941.1371470732907034 </td><td>  Null </td><td>  2 </td><td>  Null </td><td>  five </td></tr><tr><td>  5208.2182942430703625 </td><td>  Null </td><td>  3 </td><td>  Null </td><td>  five </td></tr><tr><td>  4985.5449561403508772 </td><td>  Null </td><td>  four </td><td>  Null </td><td>  five </td></tr><tr><td>  5086.8579314720812183 </td><td>  Null </td><td>  five </td><td>  Null </td><td>  five </td></tr><tr><td>  5014.53661 </td><td>  Null </td><td>  6 </td><td>  Null </td><td>  five </td></tr><tr><td>  4866.4421695257315843 </td><td>  Null </td><td>  7 </td><td>  Null </td><td>  five </td></tr><tr><td>  4912.8924871001031992 </td><td>  Null </td><td>  eight </td><td>  Null </td><td>  five </td></tr><tr><td>  4940.0480561122244489 </td><td>  Null </td><td>  Null </td><td>  Null </td><td>  five </td></tr></tbody></table><br></div></div><br>  So it is not very clear, we will bring the result to the <b>bit (3) type</b> : <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(amount), p.city_id, c.state_id, c.country_id, <span class="hljs-keyword"><span class="hljs-keyword">grouping</span></span>(p.city_id, c.state_id, c.country_id) :: <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, c.state_id, c.country_id, ());</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  avg </th><th>  city_id </th><th>  state_id </th><th>  country_id </th><th>  grouping </th></tr><tr><td>  4841.87944 </td><td>  one </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5141.313996062992126 </td><td>  2 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4850.9681893004115226 </td><td>  3 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4958.2827659574468085 </td><td>  four </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4849.1418958333333333 </td><td>  five </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5096.8224453280318091 </td><td>  6 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5208.2182942430703625 </td><td>  7 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4985.5449561403508772 </td><td>  eight </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5038.6109236947791165 </td><td>  9 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5135.6744234404536862 </td><td>  ten </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5219.3821102661596958 </td><td>  eleven </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4903.4958541266794626 </td><td>  12 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5092.9684677419354839 </td><td>  13 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5006.5867495559502664 </td><td>  14 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4964.9059877800407332 </td><td>  15 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4992.1859555555555556 </td><td>  sixteen </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4694.4786220472440945 </td><td>  17 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  5047.3065217391304348 </td><td>  18 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4883.1542885375494071 </td><td>  nineteen </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4945.392548596112311 </td><td>  20 </td><td>  Null </td><td>  Null </td><td>  011 </td></tr><tr><td>  4993.25485 </td><td>  Null </td><td>  Null </td><td>  Null </td><td>  111 </td></tr><tr><td>  4990.9535879979828543 </td><td>  Null </td><td>  Null </td><td>  one </td><td>  110 </td></tr><tr><td>  4994.7674129930394432 </td><td>  Null </td><td>  Null </td><td>  2 </td><td>  110 </td></tr><tr><td>  5141.313996062992126 </td><td>  Null </td><td>  one </td><td>  Null </td><td>  101 </td></tr><tr><td>  4941.1371470732907034 </td><td>  Null </td><td>  2 </td><td>  Null </td><td>  101 </td></tr><tr><td>  5208.2182942430703625 </td><td>  Null </td><td>  3 </td><td>  Null </td><td>  101 </td></tr><tr><td>  4985.5449561403508772 </td><td>  Null </td><td>  four </td><td>  Null </td><td>  101 </td></tr><tr><td>  5086.8579314720812183 </td><td>  Null </td><td>  five </td><td>  Null </td><td>  101 </td></tr><tr><td>  5014.53661 </td><td>  Null </td><td>  6 </td><td>  Null </td><td>  101 </td></tr><tr><td>  4866.4421695257315843 </td><td>  Null </td><td>  7 </td><td>  Null </td><td>  101 </td></tr><tr><td>  4912.8924871001031992 </td><td>  Null </td><td>  eight </td><td>  Null </td><td>  101 </td></tr><tr><td>  4940.0480561122244489 </td><td>  Null </td><td>  Null </td><td>  Null </td><td>  101 </td></tr></tbody></table><br></div></div><br>  You can also use common grouping and grouping together in a single query using <b>GROUPING SETS</b> : <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(amount), c.country_id, p.payment_type_id, p.city_id, c.state_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c.country_id, p.payment_type_id, <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>(p.city_id, c.state_id, ());</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  avg </th><th>  country_id </th><th>  payment_type_id </th><th>  city_id </th><th>  state_id </th></tr><tr><td>  5024.1955882352941176 </td><td>  one </td><td>  one </td><td>  one </td><td>  Null </td></tr><tr><td>  4871.1540119760479042 </td><td>  one </td><td>  one </td><td>  2 </td><td>  Null </td></tr><tr><td>  4891.0804861111111111 </td><td>  one </td><td>  one </td><td>  3 </td><td>  Null </td></tr><tr><td>  5130.3479896907216495 </td><td>  one </td><td>  one </td><td>  four </td><td>  Null </td></tr><tr><td>  4739.4527586206896552 </td><td>  one </td><td>  one </td><td>  five </td><td>  Null </td></tr><tr><td>  4803.7104 </td><td>  one </td><td>  one </td><td>  6 </td><td>  Null </td></tr><tr><td>  5028.8194375 </td><td>  one </td><td>  one </td><td>  7 </td><td>  Null </td></tr><tr><td>  4903.6742 </td><td>  one </td><td>  one </td><td>  eight </td><td>  Null </td></tr><tr><td>  4931.2117088122605364 </td><td>  one </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  4407.8555056179775281 </td><td>  one </td><td>  2 </td><td>  one </td><td>  Null </td></tr><tr><td>  5068.5559638554216867 </td><td>  one </td><td>  2 </td><td>  2 </td><td>  Null </td></tr><tr><td>  4812.6204093567251462 </td><td>  one </td><td>  2 </td><td>  3 </td><td>  Null </td></tr><tr><td>  4564.1131034482758621 </td><td>  one </td><td>  2 </td><td>  four </td><td>  Null </td></tr><tr><td>  4963.2932530120481928 </td><td>  one </td><td>  2 </td><td>  five </td><td>  Null </td></tr><tr><td>  5153.3501219512195122 </td><td>  one </td><td>  2 </td><td>  6 </td><td>  Null </td></tr><tr><td>  5446.8668965517241379 </td><td>  one </td><td>  2 </td><td>  7 </td><td>  Null </td></tr><tr><td>  5057.8818012422360248 </td><td>  one </td><td>  2 </td><td>  eight </td><td>  Null </td></tr><tr><td>  4917.934422641509434 </td><td>  one </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5146.2380921052631579 </td><td>  one </td><td>  3 </td><td>  one </td><td>  Null </td></tr><tr><td>  5468.14 </td><td>  one </td><td>  3 </td><td>  2 </td><td>  Null </td></tr><tr><td>  4855.5371929824561404 </td><td>  one </td><td>  3 </td><td>  3 </td><td>  Null </td></tr><tr><td>  5137.8994387755102041 </td><td>  one </td><td>  3 </td><td>  four </td><td>  Null </td></tr><tr><td>  4831.1288757396449704 </td><td>  one </td><td>  3 </td><td>  five </td><td>  Null </td></tr><tr><td>  5353.0667682926829268 </td><td>  one </td><td>  3 </td><td>  6 </td><td>  Null </td></tr><tr><td>  5172.241280487804878 </td><td>  one </td><td>  3 </td><td>  7 </td><td>  Null </td></tr><tr><td>  4989.92 </td><td>  one </td><td>  3 </td><td>  eight </td><td>  Null </td></tr><tr><td>  5121.7272005988023952 </td><td>  one </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5224.1245625 </td><td>  2 </td><td>  one </td><td>  9 </td><td>  Null </td></tr><tr><td>  5137.9207142857142857 </td><td>  2 </td><td>  one </td><td>  ten </td><td>  Null </td></tr><tr><td>  5173.0209625668449198 </td><td>  2 </td><td>  one </td><td>  eleven </td><td>  Null </td></tr><tr><td>  4735.6070652173913043 </td><td>  2 </td><td>  one </td><td>  12 </td><td>  Null </td></tr><tr><td>  5248.0194285714285714 </td><td>  2 </td><td>  one </td><td>  13 </td><td>  Null </td></tr><tr><td>  4929.1857978723404255 </td><td>  2 </td><td>  one </td><td>  14 </td><td>  Null </td></tr><tr><td>  5086.2014 102564102564 </td><td>  2 </td><td>  one </td><td>  15 </td><td>  Null </td></tr><tr><td>  4716.9701273885350318 </td><td>  2 </td><td>  one </td><td>  sixteen </td><td>  Null </td></tr><tr><td>  4616.2608383233532934 </td><td>  2 </td><td>  one </td><td>  17 </td><td>  Null </td></tr><tr><td>  4756.9175641025641026 </td><td>  2 </td><td>  one </td><td>  18 </td><td>  Null </td></tr><tr><td>  4698.7787272727272727 </td><td>  2 </td><td>  one </td><td>  nineteen </td><td>  Null </td></tr><tr><td>  5033.8821276595744681 </td><td>  2 </td><td>  one </td><td>  20 </td><td>  Null </td></tr><tr><td>  4947.559810379241517 </td><td>  2 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  5195.4805945945945946 </td><td>  2 </td><td>  2 </td><td>  9 </td><td>  Null </td></tr><tr><td>  5213.8818617021276596 </td><td>  2 </td><td>  2 </td><td>  ten </td><td>  Null </td></tr><tr><td>  5332.2921935483870968 </td><td>  2 </td><td>  2 </td><td>  eleven </td><td>  Null </td></tr><tr><td>  4946.331030303030303 </td><td>  2 </td><td>  2 </td><td>  12 </td><td>  Null </td></tr><tr><td>  5020.5288888888888889 </td><td>  2 </td><td>  2 </td><td>  13 </td><td>  Null </td></tr><tr><td>  5019.8181914893617021 </td><td>  2 </td><td>  2 </td><td>  14 </td><td>  Null </td></tr><tr><td>  4875.5393452380952381 </td><td>  2 </td><td>  2 </td><td>  15 </td><td>  Null </td></tr><tr><td>  5169.0016551724137931 </td><td>  2 </td><td>  2 </td><td>  sixteen </td><td>  Null </td></tr><tr><td>  4605.4601807228915663 </td><td>  2 </td><td>  2 </td><td>  17 </td><td>  Null </td></tr><tr><td>  4930.9780838323353293 </td><td>  2 </td><td>  2 </td><td>  18 </td><td>  Null </td></tr><tr><td>  4985.6017441860465116 </td><td>  2 </td><td>  2 </td><td>  nineteen </td><td>  Null </td></tr><tr><td>  5137.4943046357615894 </td><td>  2 </td><td>  2 </td><td>  20 </td><td>  Null </td></tr><tr><td>  5035.3225511732401398 </td><td>  2 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4654.930718954248366 </td><td>  2 </td><td>  3 </td><td>  9 </td><td>  Null </td></tr><tr><td>  5048.5046242774566474 </td><td>  2 </td><td>  3 </td><td>  ten </td><td>  Null </td></tr><tr><td>  5171.3846739130434783 </td><td>  2 </td><td>  3 </td><td>  eleven </td><td>  Null </td></tr><tr><td>  5042.0059302325581395 </td><td>  2 </td><td>  3 </td><td>  12 </td><td>  Null </td></tr><tr><td>  4997.4288095238095238 </td><td>  2 </td><td>  3 </td><td>  13 </td><td>  Null </td></tr><tr><td>  5071.0994117647058824 </td><td>  2 </td><td>  3 </td><td>  14 </td><td>  Null </td></tr><tr><td>  4941.5018562874251497 </td><td>  2 </td><td>  3 </td><td>  15 </td><td>  Null </td></tr><tr><td>  5110.9062837837837838 </td><td>  2 </td><td>  3 </td><td>  sixteen </td><td>  Null </td></tr><tr><td>  4853.5610857142857143 </td><td>  2 </td><td>  3 </td><td>  17 </td><td>  Null </td></tr><tr><td>  5451.8535625 </td><td>  2 </td><td>  3 </td><td>  18 </td><td>  Null </td></tr><tr><td>  4958.8998816568047337 </td><td>  2 </td><td>  3 </td><td>  nineteen </td><td>  Null </td></tr><tr><td>  4702.7937426900584795 </td><td>  2 </td><td>  3 </td><td>  20 </td><td>  Null </td></tr><tr><td>  5001.3644005920078934 </td><td>  2 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  4871.1540119760479042 </td><td>  one </td><td>  one </td><td>  Null </td><td>  one </td></tr><tr><td>  4904.9742705167173252 </td><td>  one </td><td>  one </td><td>  Null </td><td>  2 </td></tr><tr><td>  5028.8194375 </td><td>  one </td><td>  one </td><td>  Null </td><td>  3 </td></tr><tr><td>  4903.6742 </td><td>  one </td><td>  one </td><td>  Null </td><td>  four </td></tr><tr><td>  5024.1955882352941176 </td><td>  one </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  5068.5559638554216867 </td><td>  one </td><td>  2 </td><td>  Null </td><td>  one </td></tr><tr><td>  4868.3998074074074074 </td><td>  one </td><td>  2 </td><td>  Null </td><td>  2 </td></tr><tr><td>  5446.8668965517241379 </td><td>  one </td><td>  2 </td><td>  Null </td><td>  3 </td></tr><tr><td>  5057.8818012422360248 </td><td>  one </td><td>  2 </td><td>  Null </td><td>  four </td></tr><tr><td>  4407.8555056179775281 </td><td>  one </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5468.14 </td><td>  one </td><td>  3 </td><td>  Null </td><td>  one </td></tr><tr><td>  5045.2698285714285714 </td><td>  one </td><td>  3 </td><td>  Null </td><td>  2 </td></tr><tr><td>  5172.241280487804878 </td><td>  one </td><td>  3 </td><td>  Null </td><td>  3 </td></tr><tr><td>  4989.92 </td><td>  one </td><td>  3 </td><td>  Null </td><td>  four </td></tr><tr><td>  5146.2380921052631579 </td><td>  one </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5012.7593692022263451 </td><td>  2 </td><td>  one </td><td>  Null </td><td>  five </td></tr><tr><td>  4998.6716863905325444 </td><td>  2 </td><td>  one </td><td>  Null </td><td>  6 </td></tr><tr><td>  4684.1941176470588235 </td><td>  2 </td><td>  one </td><td>  Null </td><td>  7 </td></tr><tr><td>  4853.1891176470588235 </td><td>  2 </td><td>  one </td><td>  Null </td><td>  eight </td></tr><tr><td>  5224.1245625 </td><td>  2 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  5163.1096456692913386 </td><td>  2 </td><td>  2 </td><td>  Null </td><td>  five </td></tr><tr><td>  5015.9978440366972477 </td><td>  2 </td><td>  2 </td><td>  Null </td><td>  6 </td></tr><tr><td>  4768.7078978978978979 </td><td>  2 </td><td>  2 </td><td>  Null </td><td>  7 </td></tr><tr><td>  5056.6103405572755418 </td><td>  2 </td><td>  2 </td><td>  Null </td><td>  eight </td></tr><tr><td>  5195.4805945945945946 </td><td>  2 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5089.1325141776937618 </td><td>  2 </td><td>  3 </td><td>  Null </td><td>  five </td></tr><tr><td>  5029.1172686567164179 </td><td>  2 </td><td>  3 </td><td>  Null </td><td>  6 </td></tr><tr><td>  5139.3127164179104478 </td><td>  2 </td><td>  3 </td><td>  Null </td><td>  7 </td></tr><tr><td>  4830.0935588235294118 </td><td>  2 </td><td>  3 </td><td>  Null </td><td>  eight </td></tr><tr><td>  4654.930718954248366 </td><td>  2 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr></tbody></table><br></div></div><br>  You can combine the columns inside the <b>GROUPING SETS</b> into groups <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(amount), c.country_id, p.payment_type_id, p.city_id, c.state_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUPING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SETS</span></span>((p.payment_type_id, c.country_id), ( c.state_id, p.city_id));</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  avg </th><th>  country_id </th><th>  payment_type_id </th><th>  city_id </th><th>  state_id </th></tr><tr><td>  4931.2117088122605364 </td><td>  one </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  4947.559810379241517 </td><td>  2 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  4917.934422641509434 </td><td>  one </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5035.3225511732401398 </td><td>  2 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5121.7272005988023952 </td><td>  one </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5001.3644005920078934 </td><td>  2 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  5141.313996062992126 </td><td>  Null </td><td>  Null </td><td>  2 </td><td>  one </td></tr><tr><td>  4850.9681893004115226 </td><td>  Null </td><td>  Null </td><td>  3 </td><td>  2 </td></tr><tr><td>  4958.2827659574468085 </td><td>  Null </td><td>  Null </td><td>  four </td><td>  2 </td></tr><tr><td>  4849.1418958333333333 </td><td>  Null </td><td>  Null </td><td>  five </td><td>  2 </td></tr><tr><td>  5096.8224453280318091 </td><td>  Null </td><td>  Null </td><td>  6 </td><td>  2 </td></tr><tr><td>  5208.2182942430703625 </td><td>  Null </td><td>  Null </td><td>  7 </td><td>  3 </td></tr><tr><td>  4985.5449561403508772 </td><td>  Null </td><td>  Null </td><td>  eight </td><td>  four </td></tr><tr><td>  5135.6744234404536862 </td><td>  Null </td><td>  Null </td><td>  ten </td><td>  five </td></tr><tr><td>  5219.3821102661596958 </td><td>  Null </td><td>  Null </td><td>  eleven </td><td>  five </td></tr><tr><td>  4903.4958541266794626 </td><td>  Null </td><td>  Null </td><td>  12 </td><td>  five </td></tr><tr><td>  5092.9684677419354839 </td><td>  Null </td><td>  Null </td><td>  13 </td><td>  6 </td></tr><tr><td>  5006.5867495559502664 </td><td>  Null </td><td>  Null </td><td>  14 </td><td>  6 </td></tr><tr><td>  4964.9059877800407332 </td><td>  Null </td><td>  Null </td><td>  15 </td><td>  6 </td></tr><tr><td>  4992.1859555555555556 </td><td>  Null </td><td>  Null </td><td>  sixteen </td><td>  6 </td></tr><tr><td>  4694.4786220472440945 </td><td>  Null </td><td>  Null </td><td>  17 </td><td>  7 </td></tr><tr><td>  5047.3065217391304348 </td><td>  Null </td><td>  Null </td><td>  18 </td><td>  7 </td></tr><tr><td>  4883.1542885375494071 </td><td>  Null </td><td>  Null </td><td>  nineteen </td><td>  eight </td></tr><tr><td>  4945.392548596112311 </td><td>  Null </td><td>  Null </td><td>  20 </td><td>  eight </td></tr><tr><td>  4841.87944 </td><td>  Null </td><td>  Null </td><td>  one </td><td>  Null </td></tr><tr><td>  5038.6109236947791165 </td><td>  Null </td><td>  Null </td><td>  9 </td><td>  Null </td></tr></tbody></table><br></div></div><br>  We now turn to <b>CUBE</b> .  <b>CUBE</b> is something like a multiple <b>GROUPING SETS</b> . <br>  <b>CUBE</b> returns data for all possible combinations of columns listed inside.  That is, for the case of <b>CUBE ( <i>c1, c2, c3</i> )</b> (where c1, c2, c3 are the column names), the following combinations will be returned: <br>  <i>(c1, null, null)</i> <i><br></i>  <i>(null, c2, null)</i> <i><br></i>  <i>(null, null, c3)</i> <i><br></i>  <i>(c1, c2, null)</i> <i><br></i>  <i>(c1, null, c3)</i> <i><br></i>  <i>(null, c2, c3)</i> <i><br></i>  <i>(c1, c2, c3)</i> <i><br></i>  <i>(null, null, null)</i> <br>  Example: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), p.payment_type_id, c.country_id, p.city_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CUBE</span></span>(p.payment_type_id, c.country_id, p.city_id);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  payment_type_id </th><th>  country_id </th><th>  city_id </th></tr><tr><td>  854113.25 </td><td>  one </td><td>  one </td><td>  one </td></tr><tr><td>  813482.72 </td><td>  one </td><td>  one </td><td>  2 </td></tr><tr><td>  704315.59 </td><td>  one </td><td>  one </td><td>  3 </td></tr><tr><td>  995287.51 </td><td>  one </td><td>  one </td><td>  four </td></tr><tr><td>  687220.65 </td><td>  one </td><td>  one </td><td>  five </td></tr><tr><td>  840649.32 </td><td>  one </td><td>  one </td><td>  6 </td></tr><tr><td>  804611.11 </td><td>  one </td><td>  one </td><td>  7 </td></tr><tr><td>  735551.13 </td><td>  one </td><td>  one </td><td>  eight </td></tr><tr><td>  6435231.28 </td><td>  one </td><td>  one </td><td>  Null </td></tr><tr><td>  835859.93 </td><td>  one </td><td>  2 </td><td>  9 </td></tr><tr><td>  863170.68 </td><td>  one </td><td>  2 </td><td>  ten </td></tr><tr><td>  967354.92 </td><td>  one </td><td>  2 </td><td>  eleven </td></tr><tr><td>  871351.7 </td><td>  one </td><td>  2 </td><td>  12 </td></tr><tr><td>  918403.4 </td><td>  one </td><td>  2 </td><td>  13 </td></tr><tr><td>  926686.93 </td><td>  one </td><td>  2 </td><td>  14 </td></tr><tr><td>  793447.42 </td><td>  one </td><td>  2 </td><td>  15 </td></tr><tr><td>  740564.31 </td><td>  one </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  770915.56 </td><td>  one </td><td>  2 </td><td>  17 </td></tr><tr><td>  742079.14 </td><td>  one </td><td>  2 </td><td>  18 </td></tr><tr><td>  775298.49 </td><td>  one </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  709777.38 </td><td>  one </td><td>  2 </td><td>  20 </td></tr><tr><td>  9914909.86 </td><td>  one </td><td>  2 </td><td>  Null </td></tr><tr><td>  16350141.14 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  784598.28 </td><td>  2 </td><td>  one </td><td>  one </td></tr><tr><td>  841380.29 </td><td>  2 </td><td>  one </td><td>  2 </td></tr><tr><td>  822958.09 </td><td>  2 </td><td>  one </td><td>  3 </td></tr><tr><td>  794155.68 </td><td>  2 </td><td>  one </td><td>  four </td></tr><tr><td>  823906.68 </td><td>  2 </td><td>  one </td><td>  five </td></tr><tr><td>  845149.42 </td><td>  2 </td><td>  one </td><td>  6 </td></tr><tr><td>  789795.7 </td><td>  2 </td><td>  one </td><td>  7 </td></tr><tr><td>  814318.97 </td><td>  2 </td><td>  one </td><td>  eight </td></tr><tr><td>  6516263.11 </td><td>  2 </td><td>  one </td><td>  Null </td></tr><tr><td>  961163.91 </td><td>  2 </td><td>  2 </td><td>  9 </td></tr><tr><td>  980209.79 </td><td>  2 </td><td>  2 </td><td>  ten </td></tr><tr><td>  826505.29 </td><td>  2 </td><td>  2 </td><td>  eleven </td></tr><tr><td>  816144.62 </td><td>  2 </td><td>  2 </td><td>  12 </td></tr><tr><td>  768140.92 </td><td>  2 </td><td>  2 </td><td>  13 </td></tr><tr><td>  943725.82 </td><td>  2 </td><td>  2 </td><td>  14 </td></tr><tr><td>  819090.61 </td><td>  2 </td><td>  2 </td><td>  15 </td></tr><tr><td>  749505.24 </td><td>  2 </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  764506.39 </td><td>  2 </td><td>  2 </td><td>  17 </td></tr><tr><td>  823473.34 </td><td>  2 </td><td>  2 </td><td>  18 </td></tr><tr><td>  857523.5 </td><td>  2 </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  775761.64 </td><td>  2 </td><td>  2 </td><td>  20 </td></tr><tr><td>  10085751.07 </td><td>  2 </td><td>  2 </td><td>  Null </td></tr><tr><td>  16602014.18 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  782228.19 </td><td>  3 </td><td>  one </td><td>  one </td></tr><tr><td>  956924.5 </td><td>  3 </td><td>  one </td><td>  2 </td></tr><tr><td>  830296.86 </td><td>  3 </td><td>  one </td><td>  3 </td></tr><tr><td>  1007028.29 </td><td>  3 </td><td>  one </td><td>  four </td></tr><tr><td>  816460.78 </td><td>  3 </td><td>  one </td><td>  five </td></tr><tr><td>  877902.95 </td><td>  3 </td><td>  one </td><td>  6 </td></tr><tr><td>  848247.57 </td><td>  3 </td><td>  one </td><td>  7 </td></tr><tr><td>  723538.4 </td><td>  3 </td><td>  one </td><td>  eight </td></tr><tr><td>  6842627.54 </td><td>  3 </td><td>  one </td><td>  Null </td></tr><tr><td>  712204.4 </td><td>  3 </td><td>  2 </td><td>  9 </td></tr><tr><td>  873391.3 </td><td>  3 </td><td>  2 </td><td>  ten </td></tr><tr><td>  951534.78 </td><td>  3 </td><td>  2 </td><td>  eleven </td></tr><tr><td>  867225.02 </td><td>  3 </td><td>  2 </td><td>  12 </td></tr><tr><td>  839568.04 </td><td>  3 </td><td>  2 </td><td>  13 </td></tr><tr><td>  948295.59 </td><td>  3 </td><td>  2 </td><td>  14 </td></tr><tr><td>  825230.81 </td><td>  3 </td><td>  2 </td><td>  15 </td></tr><tr><td>  756414.13 </td><td>  3 </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  849373.19 </td><td>  3 </td><td>  2 </td><td>  17 </td></tr><tr><td>  872296.57 </td><td>  3 </td><td>  2 </td><td>  18 </td></tr><tr><td>  838054.08 </td><td>  3 </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  804177.73 </td><td>  3 </td><td>  2 </td><td>  20 </td></tr><tr><td>  10137765.64 </td><td>  3 </td><td>  2 </td><td>  Null </td></tr><tr><td>  16980393.18 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  49932548.5 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr><tr><td>  854113.25 </td><td>  one </td><td>  Null </td><td>  one </td></tr><tr><td>  784598.28 </td><td>  2 </td><td>  Null </td><td>  one </td></tr><tr><td>  782228.19 </td><td>  3 </td><td>  Null </td><td>  one </td></tr><tr><td>  2420939.72 </td><td>  Null </td><td>  Null </td><td>  one </td></tr><tr><td>  813482.72 </td><td>  one </td><td>  Null </td><td>  2 </td></tr><tr><td>  841380.29 </td><td>  2 </td><td>  Null </td><td>  2 </td></tr><tr><td>  956924.5 </td><td>  3 </td><td>  Null </td><td>  2 </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  Null </td><td>  2 </td></tr><tr><td>  704315.59 </td><td>  one </td><td>  Null </td><td>  3 </td></tr><tr><td>  822958.09 </td><td>  2 </td><td>  Null </td><td>  3 </td></tr><tr><td>  830296.86 </td><td>  3 </td><td>  Null </td><td>  3 </td></tr><tr><td>  2357570.54 </td><td>  Null </td><td>  Null </td><td>  3 </td></tr><tr><td>  995287.51 </td><td>  one </td><td>  Null </td><td>  four </td></tr><tr><td>  794155.68 </td><td>  2 </td><td>  Null </td><td>  four </td></tr><tr><td>  1007028.29 </td><td>  3 </td><td>  Null </td><td>  four </td></tr><tr><td>  2796471.48 </td><td>  Null </td><td>  Null </td><td>  four </td></tr><tr><td>  687220.65 </td><td>  one </td><td>  Null </td><td>  five </td></tr><tr><td>  823906.68 </td><td>  2 </td><td>  Null </td><td>  five </td></tr><tr><td>  816460.78 </td><td>  3 </td><td>  Null </td><td>  five </td></tr><tr><td>  2327588.11 </td><td>  Null </td><td>  Null </td><td>  five </td></tr><tr><td>  840649.32 </td><td>  one </td><td>  Null </td><td>  6 </td></tr><tr><td>  845149.42 </td><td>  2 </td><td>  Null </td><td>  6 </td></tr><tr><td>  877902.95 </td><td>  3 </td><td>  Null </td><td>  6 </td></tr><tr><td>  2563701.69 </td><td>  Null </td><td>  Null </td><td>  6 </td></tr><tr><td>  804611.11 </td><td>  one </td><td>  Null </td><td>  7 </td></tr><tr><td>  789795.7 </td><td>  2 </td><td>  Null </td><td>  7 </td></tr><tr><td>  848247.57 </td><td>  3 </td><td>  Null </td><td>  7 </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  Null </td><td>  7 </td></tr><tr><td>  735551.13 </td><td>  one </td><td>  Null </td><td>  eight </td></tr><tr><td>  814318.97 </td><td>  2 </td><td>  Null </td><td>  eight </td></tr><tr><td>  723538.4 </td><td>  3 </td><td>  Null </td><td>  eight </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  Null </td><td>  eight </td></tr><tr><td>  835859.93 </td><td>  one </td><td>  Null </td><td>  9 </td></tr><tr><td>  961163.91 </td><td>  2 </td><td>  Null </td><td>  9 </td></tr><tr><td>  712204.4 </td><td>  3 </td><td>  Null </td><td>  9 </td></tr><tr><td>  2509228.24 </td><td>  Null </td><td>  Null </td><td>  9 </td></tr><tr><td>  863170.68 </td><td>  one </td><td>  Null </td><td>  ten </td></tr><tr><td>  980209.79 </td><td>  2 </td><td>  Null </td><td>  ten </td></tr><tr><td>  873391.3 </td><td>  3 </td><td>  Null </td><td>  ten </td></tr><tr><td>  2716771.77 </td><td>  Null </td><td>  Null </td><td>  ten </td></tr><tr><td>  967354.92 </td><td>  one </td><td>  Null </td><td>  eleven </td></tr><tr><td>  826505.29 </td><td>  2 </td><td>  Null </td><td>  eleven </td></tr><tr><td>  951534.78 </td><td>  3 </td><td>  Null </td><td>  eleven </td></tr><tr><td>  2745394.99 </td><td>  Null </td><td>  Null </td><td>  eleven </td></tr><tr><td>  871351.7 </td><td>  one </td><td>  Null </td><td>  12 </td></tr><tr><td>  816144.62 </td><td>  2 </td><td>  Null </td><td>  12 </td></tr><tr><td>  867225.02 </td><td>  3 </td><td>  Null </td><td>  12 </td></tr><tr><td>  2554721.34 </td><td>  Null </td><td>  Null </td><td>  12 </td></tr><tr><td>  918403.4 </td><td>  one </td><td>  Null </td><td>  13 </td></tr><tr><td>  768140.92 </td><td>  2 </td><td>  Null </td><td>  13 </td></tr><tr><td>  839568.04 </td><td>  3 </td><td>  Null </td><td>  13 </td></tr><tr><td>  2526112.36 </td><td>  Null </td><td>  Null </td><td>  13 </td></tr><tr><td>  926686.93 </td><td>  one </td><td>  Null </td><td>  14 </td></tr><tr><td>  943725.82 </td><td>  2 </td><td>  Null </td><td>  14 </td></tr><tr><td>  948295.59 </td><td>  3 </td><td>  Null </td><td>  14 </td></tr><tr><td>  2818708.34 </td><td>  Null </td><td>  Null </td><td>  14 </td></tr><tr><td>  793447.42 </td><td>  one </td><td>  Null </td><td>  15 </td></tr><tr><td>  819090.61 </td><td>  2 </td><td>  Null </td><td>  15 </td></tr><tr><td>  825230.81 </td><td>  3 </td><td>  Null </td><td>  15 </td></tr><tr><td>  2437768.84 </td><td>  Null </td><td>  Null </td><td>  15 </td></tr><tr><td>  740564.31 </td><td>  one </td><td>  Null </td><td>  sixteen </td></tr><tr><td>  749505.24 </td><td>  2 </td><td>  Null </td><td>  sixteen </td></tr><tr><td>  756414.13 </td><td>  3 </td><td>  Null </td><td>  sixteen </td></tr><tr><td>  2246483.68 </td><td>  Null </td><td>  Null </td><td>  sixteen </td></tr><tr><td>  770915.56 </td><td>  one </td><td>  Null </td><td>  17 </td></tr><tr><td>  764506.39 </td><td>  2 </td><td>  Null </td><td>  17 </td></tr><tr><td>  849373.19 </td><td>  3 </td><td>  Null </td><td>  17 </td></tr><tr><td>  2384795.14 </td><td>  Null </td><td>  Null </td><td>  17 </td></tr><tr><td>  742079.14 </td><td>  one </td><td>  Null </td><td>  18 </td></tr><tr><td>  823473.34 </td><td>  2 </td><td>  Null </td><td>  18 </td></tr><tr><td>  872296.57 </td><td>  3 </td><td>  Null </td><td>  18 </td></tr><tr><td>  2437849.05 </td><td>  Null </td><td>  Null </td><td>  18 </td></tr><tr><td>  775298.49 </td><td>  one </td><td>  Null </td><td>  nineteen </td></tr><tr><td>  857523.5 </td><td>  2 </td><td>  Null </td><td>  nineteen </td></tr><tr><td>  838054.08 </td><td>  3 </td><td>  Null </td><td>  nineteen </td></tr><tr><td>  2470876.07 </td><td>  Null </td><td>  Null </td><td>  nineteen </td></tr><tr><td>  709777.38 </td><td>  one </td><td>  Null </td><td>  20 </td></tr><tr><td>  775761.64 </td><td>  2 </td><td>  Null </td><td>  20 </td></tr><tr><td>  804177.73 </td><td>  3 </td><td>  Null </td><td>  20 </td></tr><tr><td>  2289716.75 </td><td>  Null </td><td>  Null </td><td>  20 </td></tr><tr><td>  2420939.72 </td><td>  Null </td><td>  one </td><td>  one </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  one </td><td>  2 </td></tr><tr><td>  2357570.54 </td><td>  Null </td><td>  one </td><td>  3 </td></tr><tr><td>  2796471.48 </td><td>  Null </td><td>  one </td><td>  four </td></tr><tr><td>  2327588.11 </td><td>  Null </td><td>  one </td><td>  five </td></tr><tr><td>  2563701.69 </td><td>  Null </td><td>  one </td><td>  6 </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  one </td><td>  7 </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  one </td><td>  eight </td></tr><tr><td>  19794121.93 </td><td>  Null </td><td>  one </td><td>  Null </td></tr><tr><td>  2509228.24 </td><td>  Null </td><td>  2 </td><td>  9 </td></tr><tr><td>  2716771.77 </td><td>  Null </td><td>  2 </td><td>  ten </td></tr><tr><td>  2745394.99 </td><td>  Null </td><td>  2 </td><td>  eleven </td></tr><tr><td>  2554721.34 </td><td>  Null </td><td>  2 </td><td>  12 </td></tr><tr><td>  2526112.36 </td><td>  Null </td><td>  2 </td><td>  13 </td></tr><tr><td>  2818708.34 </td><td>  Null </td><td>  2 </td><td>  14 </td></tr><tr><td>  2437768.84 </td><td>  Null </td><td>  2 </td><td>  15 </td></tr><tr><td>  2246483.68 </td><td>  Null </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  2384795.14 </td><td>  Null </td><td>  2 </td><td>  17 </td></tr><tr><td>  2437849.05 </td><td>  Null </td><td>  2 </td><td>  18 </td></tr><tr><td>  2470876.07 </td><td>  Null </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  2289716.75 </td><td>  Null </td><td>  2 </td><td>  20 </td></tr><tr><td>  30138426.57 </td><td>  Null </td><td>  2 </td><td>  Null </td></tr></tbody></table><br></div></div><br>  As in <b>GROUPING SETS,</b> you can do grouping inside: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), p.payment_type_id, c.country_id, p.city_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CUBE</span></span>(p.payment_type_id, (c.country_id, p.city_id));</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  payment_type_id </th><th>  country_id </th><th>  city_id </th></tr><tr><td>  854113.25 </td><td>  one </td><td>  one </td><td>  one </td></tr><tr><td>  813482.72 </td><td>  one </td><td>  one </td><td>  2 </td></tr><tr><td>  704315.59 </td><td>  one </td><td>  one </td><td>  3 </td></tr><tr><td>  995287.51 </td><td>  one </td><td>  one </td><td>  four </td></tr><tr><td>  687220.65 </td><td>  one </td><td>  one </td><td>  five </td></tr><tr><td>  840649.32 </td><td>  one </td><td>  one </td><td>  6 </td></tr><tr><td>  804611.11 </td><td>  one </td><td>  one </td><td>  7 </td></tr><tr><td>  735551.13 </td><td>  one </td><td>  one </td><td>  eight </td></tr><tr><td>  835859.93 </td><td>  one </td><td>  2 </td><td>  9 </td></tr><tr><td>  863170.68 </td><td>  one </td><td>  2 </td><td>  ten </td></tr><tr><td>  967354.92 </td><td>  one </td><td>  2 </td><td>  eleven </td></tr><tr><td>  871351.7 </td><td>  one </td><td>  2 </td><td>  12 </td></tr><tr><td>  918403.4 </td><td>  one </td><td>  2 </td><td>  13 </td></tr><tr><td>  926686.93 </td><td>  one </td><td>  2 </td><td>  14 </td></tr><tr><td>  793447.42 </td><td>  one </td><td>  2 </td><td>  15 </td></tr><tr><td>  740564.31 </td><td>  one </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  770915.56 </td><td>  one </td><td>  2 </td><td>  17 </td></tr><tr><td>  742079.14 </td><td>  one </td><td>  2 </td><td>  18 </td></tr><tr><td>  775298.49 </td><td>  one </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  709777.38 </td><td>  one </td><td>  2 </td><td>  20 </td></tr><tr><td>  16350141.14 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  784598.28 </td><td>  2 </td><td>  one </td><td>  one </td></tr><tr><td>  841380.29 </td><td>  2 </td><td>  one </td><td>  2 </td></tr><tr><td>  822958.09 </td><td>  2 </td><td>  one </td><td>  3 </td></tr><tr><td>  794155.68 </td><td>  2 </td><td>  one </td><td>  four </td></tr><tr><td>  823906.68 </td><td>  2 </td><td>  one </td><td>  five </td></tr><tr><td>  845149.42 </td><td>  2 </td><td>  one </td><td>  6 </td></tr><tr><td>  789795.7 </td><td>  2 </td><td>  one </td><td>  7 </td></tr><tr><td>  814318.97 </td><td>  2 </td><td>  one </td><td>  eight </td></tr><tr><td>  961163.91 </td><td>  2 </td><td>  2 </td><td>  9 </td></tr><tr><td>  980209.79 </td><td>  2 </td><td>  2 </td><td>  ten </td></tr><tr><td>  826505.29 </td><td>  2 </td><td>  2 </td><td>  eleven </td></tr><tr><td>  816144.62 </td><td>  2 </td><td>  2 </td><td>  12 </td></tr><tr><td>  768140.92 </td><td>  2 </td><td>  2 </td><td>  13 </td></tr><tr><td>  943725.82 </td><td>  2 </td><td>  2 </td><td>  14 </td></tr><tr><td>  819090.61 </td><td>  2 </td><td>  2 </td><td>  15 </td></tr><tr><td>  749505.24 </td><td>  2 </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  764506.39 </td><td>  2 </td><td>  2 </td><td>  17 </td></tr><tr><td>  823473.34 </td><td>  2 </td><td>  2 </td><td>  18 </td></tr><tr><td>  857523.5 </td><td>  2 </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  775761.64 </td><td>  2 </td><td>  2 </td><td>  20 </td></tr><tr><td>  16602014.18 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  782228.19 </td><td>  3 </td><td>  one </td><td>  one </td></tr><tr><td>  956924.5 </td><td>  3 </td><td>  one </td><td>  2 </td></tr><tr><td>  830296.86 </td><td>  3 </td><td>  one </td><td>  3 </td></tr><tr><td>  1007028.29 </td><td>  3 </td><td>  one </td><td>  four </td></tr><tr><td>  816460.78 </td><td>  3 </td><td>  one </td><td>  five </td></tr><tr><td>  877902.95 </td><td>  3 </td><td>  one </td><td>  6 </td></tr><tr><td>  848247.57 </td><td>  3 </td><td>  one </td><td>  7 </td></tr><tr><td>  723538.4 </td><td>  3 </td><td>  one </td><td>  eight </td></tr><tr><td>  712204.4 </td><td>  3 </td><td>  2 </td><td>  9 </td></tr><tr><td>  873391.3 </td><td>  3 </td><td>  2 </td><td>  ten </td></tr><tr><td>  951534.78 </td><td>  3 </td><td>  2 </td><td>  eleven </td></tr><tr><td>  867225.02 </td><td>  3 </td><td>  2 </td><td>  12 </td></tr><tr><td>  839568.04 </td><td>  3 </td><td>  2 </td><td>  13 </td></tr><tr><td>  948295.59 </td><td>  3 </td><td>  2 </td><td>  14 </td></tr><tr><td>  825230.81 </td><td>  3 </td><td>  2 </td><td>  15 </td></tr><tr><td>  756414.13 </td><td>  3 </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  849373.19 </td><td>  3 </td><td>  2 </td><td>  17 </td></tr><tr><td>  872296.57 </td><td>  3 </td><td>  2 </td><td>  18 </td></tr><tr><td>  838054.08 </td><td>  3 </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  804177.73 </td><td>  3 </td><td>  2 </td><td>  20 </td></tr><tr><td>  16980393.18 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  49932548.5 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr><tr><td>  2420939.72 </td><td>  Null </td><td>  one </td><td>  one </td></tr><tr><td>  2611787.51 </td><td>  Null </td><td>  one </td><td>  2 </td></tr><tr><td>  2357570.54 </td><td>  Null </td><td>  one </td><td>  3 </td></tr><tr><td>  2796471.48 </td><td>  Null </td><td>  one </td><td>  four </td></tr><tr><td>  2327588.11 </td><td>  Null </td><td>  one </td><td>  five </td></tr><tr><td>  2563701.69 </td><td>  Null </td><td>  one </td><td>  6 </td></tr><tr><td>  2442654.38 </td><td>  Null </td><td>  one </td><td>  7 </td></tr><tr><td>  2273408.5 </td><td>  Null </td><td>  one </td><td>  eight </td></tr><tr><td>  2509228.24 </td><td>  Null </td><td>  2 </td><td>  9 </td></tr><tr><td>  2716771.77 </td><td>  Null </td><td>  2 </td><td>  ten </td></tr><tr><td>  2745394.99 </td><td>  Null </td><td>  2 </td><td>  eleven </td></tr><tr><td>  2554721.34 </td><td>  Null </td><td>  2 </td><td>  12 </td></tr><tr><td>  2526112.36 </td><td>  Null </td><td>  2 </td><td>  13 </td></tr><tr><td>  2818708.34 </td><td>  Null </td><td>  2 </td><td>  14 </td></tr><tr><td>  2437768.84 </td><td>  Null </td><td>  2 </td><td>  15 </td></tr><tr><td>  2246483.68 </td><td>  Null </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  2384795.14 </td><td>  Null </td><td>  2 </td><td>  17 </td></tr><tr><td>  2437849.05 </td><td>  Null </td><td>  2 </td><td>  18 </td></tr><tr><td>  2470876.07 </td><td>  Null </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  2289716.75 </td><td>  Null </td><td>  2 </td><td>  20 </td></tr></tbody></table><br></div></div><br>  <b>ROLLUP</b> is the same as <b>CUBE</b> - something like multiple <b>GROUPING SETS</b> , with the difference that <b>ROLLUP</b> generates combinations, removing columns one by one from the end.  Thus, <b>ROLLUP ( <i>c1, c2, c3, c4</i> )</b> will return the following combinations: <br>  <i>(c1, c2, c3, c4)</i> <i><br></i>  <i>(c1, c2, c3, null)</i> <i><br></i>  <i>(c1, c2, null, null)</i> <i><br></i>  <i>(c1, null, null, null)</i> <i><br></i>  <i>(null, null, null, null)</i> <br>  Example: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(amount), p.payment_type_id, c.country_id, p.city_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> payment <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> city <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.city_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLLUP</span></span>(p.payment_type_id, c.country_id, p.city_id);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Query result</b> <div class="spoiler_text"><table border="1"><tbody><tr><th>  sum </th><th>  payment_type_id </th><th>  country_id </th><th>  city_id </th></tr><tr><td>  854113.25 </td><td>  one </td><td>  one </td><td>  one </td></tr><tr><td>  813482.72 </td><td>  one </td><td>  one </td><td>  2 </td></tr><tr><td>  704315.59 </td><td>  one </td><td>  one </td><td>  3 </td></tr><tr><td>  995287.51 </td><td>  one </td><td>  one </td><td>  four </td></tr><tr><td>  687220.65 </td><td>  one </td><td>  one </td><td>  five </td></tr><tr><td>  840649.32 </td><td>  one </td><td>  one </td><td>  6 </td></tr><tr><td>  804611.11 </td><td>  one </td><td>  one </td><td>  7 </td></tr><tr><td>  735551.13 </td><td>  one </td><td>  one </td><td>  eight </td></tr><tr><td>  6435231.28 </td><td>  one </td><td>  one </td><td>  Null </td></tr><tr><td>  835859.93 </td><td>  one </td><td>  2 </td><td>  9 </td></tr><tr><td>  863170.68 </td><td>  one </td><td>  2 </td><td>  ten </td></tr><tr><td>  967354.92 </td><td>  one </td><td>  2 </td><td>  eleven </td></tr><tr><td>  871351.7 </td><td>  one </td><td>  2 </td><td>  12 </td></tr><tr><td>  918403.4 </td><td>  one </td><td>  2 </td><td>  13 </td></tr><tr><td>  926686.93 </td><td>  one </td><td>  2 </td><td>  14 </td></tr><tr><td>  793447.42 </td><td>  one </td><td>  2 </td><td>  15 </td></tr><tr><td>  740564.31 </td><td>  one </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  770915.56 </td><td>  one </td><td>  2 </td><td>  17 </td></tr><tr><td>  742079.14 </td><td>  one </td><td>  2 </td><td>  18 </td></tr><tr><td>  775298.49 </td><td>  one </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  709777.38 </td><td>  one </td><td>  2 </td><td>  20 </td></tr><tr><td>  9914909.86 </td><td>  one </td><td>  2 </td><td>  Null </td></tr><tr><td>  16350141.14 </td><td>  one </td><td>  Null </td><td>  Null </td></tr><tr><td>  784598.28 </td><td>  2 </td><td>  one </td><td>  one </td></tr><tr><td>  841380.29 </td><td>  2 </td><td>  one </td><td>  2 </td></tr><tr><td>  822958.09 </td><td>  2 </td><td>  one </td><td>  3 </td></tr><tr><td>  794155.68 </td><td>  2 </td><td>  one </td><td>  four </td></tr><tr><td>  823906.68 </td><td>  2 </td><td>  one </td><td>  five </td></tr><tr><td>  845149.42 </td><td>  2 </td><td>  one </td><td>  6 </td></tr><tr><td>  789795.7 </td><td>  2 </td><td>  one </td><td>  7 </td></tr><tr><td>  814318.97 </td><td>  2 </td><td>  one </td><td>  eight </td></tr><tr><td>  6516263.11 </td><td>  2 </td><td>  one </td><td>  Null </td></tr><tr><td>  961163.91 </td><td>  2 </td><td>  2 </td><td>  9 </td></tr><tr><td>  980209.79 </td><td>  2 </td><td>  2 </td><td>  ten </td></tr><tr><td>  826505.29 </td><td>  2 </td><td>  2 </td><td>  eleven </td></tr><tr><td>  816144.62 </td><td>  2 </td><td>  2 </td><td>  12 </td></tr><tr><td>  768140.92 </td><td>  2 </td><td>  2 </td><td>  13 </td></tr><tr><td>  943725.82 </td><td>  2 </td><td>  2 </td><td>  14 </td></tr><tr><td>  819090.61 </td><td>  2 </td><td>  2 </td><td>  15 </td></tr><tr><td>  749505.24 </td><td>  2 </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  764506.39 </td><td>  2 </td><td>  2 </td><td>  17 </td></tr><tr><td>  823473.34 </td><td>  2 </td><td>  2 </td><td>  18 </td></tr><tr><td>  857523.5 </td><td>  2 </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  775761.64 </td><td>  2 </td><td>  2 </td><td>  20 </td></tr><tr><td>  10085751.07 </td><td>  2 </td><td>  2 </td><td>  Null </td></tr><tr><td>  16602014.18 </td><td>  2 </td><td>  Null </td><td>  Null </td></tr><tr><td>  782228.19 </td><td>  3 </td><td>  one </td><td>  one </td></tr><tr><td>  956924.5 </td><td>  3 </td><td>  one </td><td>  2 </td></tr><tr><td>  830296.86 </td><td>  3 </td><td>  one </td><td>  3 </td></tr><tr><td>  1007028.29 </td><td>  3 </td><td>  one </td><td>  four </td></tr><tr><td>  816460.78 </td><td>  3 </td><td>  one </td><td>  five </td></tr><tr><td>  877902.95 </td><td>  3 </td><td>  one </td><td>  6 </td></tr><tr><td>  848247.57 </td><td>  3 </td><td>  one </td><td>  7 </td></tr><tr><td>  723538.4 </td><td>  3 </td><td>  one </td><td>  eight </td></tr><tr><td>  6842627.54 </td><td>  3 </td><td>  one </td><td>  Null </td></tr><tr><td>  712204.4 </td><td>  3 </td><td>  2 </td><td>  9 </td></tr><tr><td>  873391.3 </td><td>  3 </td><td>  2 </td><td>  ten </td></tr><tr><td>  951534.78 </td><td>  3 </td><td>  2 </td><td>  eleven </td></tr><tr><td>  867225.02 </td><td>  3 </td><td>  2 </td><td>  12 </td></tr><tr><td>  839568.04 </td><td>  3 </td><td>  2 </td><td>  13 </td></tr><tr><td>  948295.59 </td><td>  3 </td><td>  2 </td><td>  14 </td></tr><tr><td>  825230.81 </td><td>  3 </td><td>  2 </td><td>  15 </td></tr><tr><td>  756414.13 </td><td>  3 </td><td>  2 </td><td>  sixteen </td></tr><tr><td>  849373.19 </td><td>  3 </td><td>  2 </td><td>  17 </td></tr><tr><td>  872296.57 </td><td>  3 </td><td>  2 </td><td>  18 </td></tr><tr><td>  838054.08 </td><td>  3 </td><td>  2 </td><td>  nineteen </td></tr><tr><td>  804177.73 </td><td>  3 </td><td>  2 </td><td>  20 </td></tr><tr><td>  10137765.64 </td><td>  3 </td><td>  2 </td><td>  Null </td></tr><tr><td>  16980393.18 </td><td>  3 </td><td>  Null </td><td>  Null </td></tr><tr><td>  49932548.5 </td><td>  Null </td><td>  Null </td><td>  Null </td></tr></tbody></table><br></div></div><br>  In conclusion, I want to say that, besides the convenience of writing, these queries are potentially (not yet merit), work faster, since to execute a query you need only one table scan instead of several that are performed in the case of <b>UNION ALL</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/269849/">https://habr.com/ru/post/269849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269831/index.html">From 0 to 1. We understand with Redux</a></li>
<li><a href="../269833/index.html">Google is going to combine Chrome OS and Android</a></li>
<li><a href="../269835/index.html">Isolation of virtual servers in apache2 - ugidctl</a></li>
<li><a href="../269839/index.html">Organization of development and operation of large projects</a></li>
<li><a href="../269845/index.html">Intel distributes its libraries</a></li>
<li><a href="../269851/index.html">Is multiprocessing possible in UEFI?</a></li>
<li><a href="../269853/index.html">Seven HTTP / 2 Implementation Tips</a></li>
<li><a href="../269857/index.html">News Digest for iOS Developers</a></li>
<li><a href="../269859/index.html">Meeting with Jon von Tachner in Moscow</a></li>
<li><a href="../269861/index.html">Top 10 Systems Scaling Errors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>