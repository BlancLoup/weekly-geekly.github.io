<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Now I see you: detecting fileless malware</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Attackers are determined to use increasingly sophisticated methods to circumvent protection. Using fileless malware increases stealth and attack effic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Now I see you: detecting fileless malware</h1><div class="post__text post__text-html js-mediator-article">  Attackers are determined to use increasingly sophisticated methods to circumvent protection.  Using fileless malware increases stealth and attack efficiency.  Last year, fileless methods were used in two large-scale campaigns to ransomware ( <a href="https://cloudblogs.microsoft.com/microsoftsecure/2017/06/27/new-ransomware-old-techniques-petya-adds-worm-capabilities/">Petya</a> and <a href="https://cloudblogs.microsoft.com/microsoftsecure/2017/05/12/wannacrypt-ransomware-worm-targets-out-of-date-systems/">WannaCry</a> ). <br><br><img src="https://habrastorage.org/webt/vm/y_/8y/vmy_8y-ztdnwq2a_fl0ykqjdmqw.jpeg"><br><br>  At the core of fileless attacks is a simple idea: if there are already tools on the device that can perform the tasks of an attacker (for example, PowerShell.exe or wmic.exe), then why place special programs on it that can be recognized as malicious?  If an attacker can intercept control of the process, it will be more difficult to detect the attack in the memory space of such a process and use it to call the tools that already exist on the device. <br><a name="habracut"></a><br>  Successful application of this approach using local resources is a complex task.  Among other things, attackers need to solve the persistence problem.  When you turn off the power, the information in memory is not saved, and if the files are not recorded on the disk, the attackers have a question: how to ensure the autorun of their code and maintain control over the compromised system after the reboot? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Misfox: Fileless Network Threats </h2><br>  In April 2016, a client was turned into cyber abuse by a Microsoft incident response team.  The attackers demanded a significant amount from him for not publishing confidential corporate information stolen from compromised client computers.  At the same time, they threatened to ‚Äúcrush‚Äù his network if the client turns to law enforcement agencies.  The situation was difficult. <br><blockquote>  <b>reference</b> <br>  The number of detections of <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description%3FName%3DTrojanDownloader:Win32/Misfox">Misfox by</a> means of Windows Defender Antivirus in the second quarter of 2017, compared with the first quarter of the same year, more than doubled. </blockquote>  The Microsoft incident response team investigated the computers on the network, discovered target implants, and analyzed the degree of compromise.  The client used a well-known third-party anti-virus product that was installed on most computers.  Despite the update with the latest signatures, the antivirus did not detect any of the target implants. <br><br>  Also, Microsoft researchers have learned that attackers twice tried to encrypt files using an ransomware program.  Fortunately, these attempts failed.  As it turned out, the threat to destroy the network was a ‚Äúplan B‚Äù to extract profits from an attack in case ‚Äúplan A‚Äù did not work. <br><br>  Moreover, the researchers also found that the attackers had been secretly present on the network for at least seven months, using two different channels. <br><br><ul><li>  The first of these channels included a backdoor called <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description%3FName%3DTrojan:Win32/Swrort.A">Swrort.A</a> , which was deployed on several computers.  This backdoor was easily detected by the antivirus. </li><li>  The second channel was much more sophisticated and interesting: <br><ul><li>  He did not infect files on the device. </li><li>  He did not leave artifacts on the disk. </li><li>  It could not be detected using the usual file checking methods. </li></ul></li></ul><blockquote>  <b>Is it time to turn off PowerShell?</b> <br>  Not.  PowerShell is a powerful and secure tool that is important to many system and IT infrastructure functions.  Malicious PowerShell scripts used by hackers are a consequence of the introduction of malicious programs and can only be implemented after the initial compromise.  Malicious use of PowerShell is a symptom of an attack that began with other malicious actions, such as exploiting software vulnerabilities, using social engineering techniques or stealing credentials.  Therefore, we must not allow attackers to use PowerShell for their own purposes.  How to provide such protection, read on. </blockquote>  The second tool was a fileless malware called <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description%3FName%3DTrojanDownloader:Win32/Misfox">Misfox</a> .  When running in memory, Misfox did the following: <br><br><ul><li>  Created the registry key that ran the single-line PowerShell cmdlet. </li><li>  Launched a disguised PowerShell script stored in the blob registry.  This masked PowerShell script contained a portable executable file (PE) loader that loaded a PE file from the registry, encoded using the Base64 algorithm. </li></ul><br>  Misfox did not place executable files on the computer, but the script recorded in the registry ensured persistence of the malicious program. <br><br><h2>  Fileless Methods </h2><br>  Misfox is an example of how fileless components can be embedded in a sequence of cyber attacks.  Attackers use different fileless methods that make it difficult to detect malicious implants.  Among them: <br><br><ol><li>  <b>Reflexive DLL Injection</b> <br>  <a href="https://blogs.technet.microsoft.com/mmpc/2017/11/13/detecting-reflective-dll-loading-with-windows-defender-atp/">Reflexive injection of DLLs</a> allows loading DLLs into the process memory without saving them on a local disk.  A malicious DLL can be located on a remote computer controlled by an attacker and delivered via a compromised network channel (for example, via TLS).  It can also be implemented in disguised form, for example, through macros and scripts.  As a result, attackers manage to bypass the monitoring and tracking tools for loading executables in the operating system.  An example of malware using reflective DLL injection is <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description%3FName%3DHackTool:Win32/Mikatz!dha">HackTool: Win32 / Mikatz! Dha</a> . </li><li>  <b>Memory exploits</b> <br>  Attackers use fileless exploits in memory to remotely launch arbitrary code on affected computers.  For example, the threat of <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description%3FName%3DRansom:Win32/Uiwix.A!rsm">UIWIX</a> uses the <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description%3FName%3DRansom:Win32/Uiwix.A!rsm">EternalBlue</a> exploit that was involved in Petya and WannaCry.  According to observations, he installed the DoublePulsar backdoor, which completely fits in the kernel memory (SMB Send Table).  Unlike Petya and Wannacry, UIWIX does not allocate files to disk. </li><li>  <b>Script based methods</b> <br>  Scripting languages ‚Äã‚Äãoffer efficient means for delivering a fully executable payload.  Script files can embed encrypted shellcodes or binary objects, which can be decrypted without writing to disk during execution via .NET objects or directly using the API.  The scripts themselves can be hidden in the registry (as in the case of Misfox).  They can be read from network streams or launched by an attacker manually using the command line without accessing the disk. </li><li>  <b>Save to WMI</b> <br>  In a number of observed cases, attackers used the Windows Management Instrumentation (WMI) repository to save malicious scripts, which were then periodically invoked via WMI bindings.  Expanded examples of the use of such technology are given in <a href="https://www.blackhat.com/docs/us-15/materials/us-15-Graeber-Abusing-Windows-Management-Instrumentation-WMI-To-Build-A-Persistent%2520Asynchronous-And-Fileless-Backdoor-wp.pdf">this article</a> [PDF]. </li></ol><br><h2>  Ways to protect against fileless malware in Microsoft 365 </h2><br>  <a href="https://blogs.windows.com/business/2017/10/23/microsoft-365-security-management-features-available-windows-10-fall-creators-update/%3Focid%3Dcx-blog-mmpc">Microsoft 365</a> includes a new generation of security technologies to protect devices, SaaS applications, email and infrastructure from a wide range of attacks.  The following are components of Microsoft 365 related to Windows that allow you to detect fileless attacks and prevent infection. <br><blockquote>  <b>The board</b> <br>  Along with special means of protection against fileless attacks, Windows 10 includes other security technologies of the new generation to counter attacks in general.  For example, <a href="https://blogs.technet.microsoft.com/mmpc/2017/10/23/making-microsoft-edge-the-most-secure-browser-with-windows-defender-application-guard/">Windows Defender Application Guard</a> allows you to stop the download and launch of malicious programs (both fileless and others) through Microsoft Edge and Internet Explorer.  You can read more about the Microsoft 365 security and management features in the Windows 10 Fall Creators Update <a href="https://blogs.windows.com/business/2017/10/23/microsoft-365-security-management-features-available-windows-10-fall-creators-update/%3Focid%3Dcx-blog-mmpc">here</a> . <br></blockquote><h3>  Windows Defender Antivirus </h3><br>  <a href="https://www.microsoft.com/en-us/windows/windows-defender%3Focid%3Dcx-blog-mmpc">Windows Defender Antivirus (WDAV)</a> blocks the vast majority of malware using common, heuristic and behavioral detection methods, using both local and cloud machine learning models.  Windows Defender Antivirus provides protection against malware due to the following features: <br><br><ul><li>  Detection of attacks using scripts using the <a href="https://blogs.technet.microsoft.com/mmpc/2015/06/09/windows-10-to-offer-application-developers-new-malware-defenses/">AMSI antimalware</a> scan <a href="https://blogs.technet.microsoft.com/mmpc/2015/06/09/windows-10-to-offer-application-developers-new-malware-defenses/">interface</a> , which allows you to check PowerShell scripts and other types even with multiple masking levels. </li><li>  Detection and removal of malware attempting to persist through WMI by scanning the WMI repository ‚Äî both intermittently and when registering anomalous behavior. </li><li>  Detection of reflexive DLL injection using advanced memory checking and behavior monitoring methods. <br></li></ul><br><h3>  Windows Defender Exploit Guard </h3><br>  <a href="https://blogs.technet.microsoft.com/mmpc/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/">Windows Defender Exploit Guard (WDEG)</a> is a new set of functions to protect against intrusion at the host level, which helps to reduce the vulnerable zone by blocking a wide range of attack vectors on the device.  To stop fileless attacks, use the following methods: <br><br><ul><li>  Protection against memory core exploits, such as EternalBlue, with the help of the Hypervisor Code Integrity Service (HVCI), which with high efficiency prevents the introduction of malicious code through vulnerabilities of software running in kernel mode </li><li>  Preventing memory exploits in user mode using <a href="https://docs.microsoft.com/ru-ru/windows/threat-protection/windows-defender-exploit-guard/exploit-protection-exploit-guard">an exploit protection module</a> that includes a number of exploit prevention tools used at the operating system level or at the level of individual applications </li><li>  Protecting (among other things) against various fileless attacks that use scripts, through the rules of <a href="https://docs.microsoft.com/ru-ru/windows/threat-protection/windows-defender-exploit-guard/attack-surface-reduction-exploit-guard">reducing the vulnerable zone (ASR)</a> , which block certain application behavior </li></ul><blockquote>  <b>The board</b> <br>  In addition to technical controls, effective administrative control of staff and processes is also important.  To use fileless techniques on a remote computer using PowerShell scripts and WMI tools, an attacker needs privileged access to such a computer.  Such access can be obtained if insufficiently secure administration methods are used (for example, configuring the execution of a Windows service in the context of a domain administrator account), which can steal credentials.  Read more about securing privileged access <a href="https://docs.microsoft.com/ru-ru/windows-server/identity/securing-privileged-access/securing-privileged-access">here</a> . <br></blockquote><h3>  Windows Defender Application Control </h3><br>  <a href="https://blogs.technet.microsoft.com/mmpc/2017/10/23/introducing-windows-defender-application-control/">Windows Defender Application Control (WDAC)</a> offers a mechanism for implementing strict code integrity policies and allows only trusted applications to run.  To combat fileless attacks, this component puts PowerShell into <a href="https://blogs.msdn.microsoft.com/powershell/2017/11/02/powershell-constrained-language-mode/">restricted language mode</a> , which prevents you from using advanced language tools that can run code that cannot be checked ‚Äî for example, direct .NET scripts, Win32 API call through Add-Type cmdlet, and interaction with COM -objects.  This effectively prevents attacks with reflexive DLL injection through PowerShell. <br><br><h3>  Windows Defender Advanced Threat Protection </h3><br>  <a href="https://www.microsoft.com/ru-ru/WindowsForBusiness/windows-atp">Windows Defender Advanced Threat Protection (WDATP)</a> is an integrated platform for desktop endpoint protection (EPP) and endpoint detection and endpoint detection (EDR).  If the security of the system is already compromised, ATP notifies users of the company about sophisticated attacks of increased complexity on devices and corporate networks, which could not be prevented with the help of other preventive remedies.  To detect such attacks, the service uses detailed data from global security systems, advanced behavioral analysis and machine learning.  It allows you to detect fileless malware in several ways: <br><br><ul><li>  Detection with the help of special tools that register the anomalous memory allocation of hidden attacks using such fileless methods as <a href="https://blogs.technet.microsoft.com/mmpc/2017/11/13/detecting-reflective-dll-loading-with-windows-defender-atp/">reflexive use of DLLs</a> . </li><li> Detecting script-free fileless attacks using <a href="https://blogs.technet.microsoft.com/mmpc/2017/12/04/windows-defender-atp-machine-learning-and-amsi-unearthing-script-based-attacks-that-live-off-the-land/">the AMSI antimalware scan interface</a> , which checks when running PowerShell and other components using scripts, and using machine-learning models. </li></ul><br><h3>  Microsoft Edge Browser </h3><br>  According to <a href="https://www.nsslabs.com/">NSS Labs</a> , an independent security expert, Microsoft Edge browser <a href="https://www.microsoft.com/ru-ru/download/details.aspx%3Fid%3D54773">blocks more phishing sites and malware</a> using social engineering techniques than other browsers.  Microsoft Edge counteracts fileless attacks with <a href="https://blogs.windows.com/msedgedev/2017/02/23/mitigating-arbitrary-native-code-execution/">anti-arbitrary code protection</a> features that block the execution of arbitrary code, including malicious DLLs.  This helps avoid attacks with reflexive DLL injection.  In addition, Microsoft Edge provides a wide range of protection against fileless and other threats through the integration of <a href="https://cloudblogs.microsoft.com/microsoftsecure/2017/10/23/making-microsoft-edge-the-most-secure-browser-with-windows-defender-application-guard/">Windows Defender Application Guard</a> and Windows Defender SmartScreen technology. <br><br>  <b>Zaid Arafeh</b> <br>  <i>Senior Program Manager, Windows Defender Research Team</i> <br>  <a href="https://cloudblogs.microsoft.com/microsoftsecure/2018/01/24/now-you-see-me-exposing-fileless-malware/">Original source</a> </div><p>Source: <a href="https://habr.com/ru/post/352376/">https://habr.com/ru/post/352376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352364/index.html">DotNext 2018 Piter program overview</a></li>
<li><a href="../352366/index.html">Smart face control: machine learning algorithms for efficient data caching on SSD</a></li>
<li><a href="../352368/index.html">MEPhI invites to the information security competition</a></li>
<li><a href="../352372/index.html">"Computer, how is my build doing?" And other magic spells</a></li>
<li><a href="../352374/index.html">Multithreading on ships</a></li>
<li><a href="../352378/index.html">From point A to point Chief</a></li>
<li><a href="../352380/index.html">New old vulnerability: Firefox password manager has been using outdated SHA-1 for 9 years</a></li>
<li><a href="../352382/index.html">Network physics in virtual reality</a></li>
<li><a href="../352384/index.html">Customize Mozilla Thunderbird in a corporate Windows environment</a></li>
<li><a href="../352386/index.html">Donald Knut: this is a turnaround</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>