<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The first Ukrainian SSD drive or the second life of a Swiss computer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unfortunately, a huge number of enterprises in Ukraine work on outdated industrial equipment, made a couple of dozen or more years ago. After the coll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The first Ukrainian SSD drive or the second life of a Swiss computer</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/75d/17a/bd9/75d17abd9884ac117ffc5892256b248a.jpg" align="right">  Unfortunately, a huge number of enterprises in Ukraine work on outdated industrial equipment, made a couple of dozen or more years ago.  After the collapse of the Union and the sale of metal to machines of local development, the enterprises that remained afloat began to acquire in the West used machine tools with numerical programmed control: plasma cutters, wood, metalworking machines, engraving equipment, etc.  But the relatively low cost of such iron has a downside - downtime due to failures, inaccessible parts, the complete lack of support. <br>  This post is about how simple replacing a hard drive in a woodworking machine required creating your own solid-state drive, and what difficulties we had in developing it.  Who cares how the first Ukrainian "Winchester-SSD" was created, please under the cat. <br><br><a name="habracut"></a><br>  Initially, a small background.  A few years ago, the customer turned to the information recovery center of a well-known Kiev company with a faulty notebook Seagate 1.2 GB 1997 disc. <br>  Winchester was used in the machine, so when he did his service, production stopped.  With the restoration of data, no special problems arose, a full copy was made within an hour and the happy client went to Zhytomyr.  But that day he visited Kiev several times.  Several copies on different disks stubbornly did not start on the machine.  Fortunately, the same Seagate ST91351AG was found at the donor disc warehouse, the recovered data was written to it and it all worked. <br>  Approximately a year later the situation repeated itself, but the disc was already searched longer - at that time it wasn‚Äôt even on ebay.  And again the customer was saved by the warehouse of donors accumulated over the years - on the far shelf they found and revived, probably one of the world's last disks of this model. <br><br><img src="https://habrastorage.org/storage2/953/b55/e08/953b55e08307b875c7e15ff77dd5476b.png"><br>  <i>Donor Discs in the Recovery Center</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This time, the client was offered to think about switching to flash, even an IDE Flash module was found, adapters were made to connect it to the machine, a drive passport was replaced.  But the customer decided not to bother, and after the first unsuccessful attempt to boot from it, he refused this idea. <br><br><img src="https://habrastorage.org/storage2/3ae/ea4/91b/3aeea491b75b3f0f40fbd8ac179e5cb0.png"><br>  <i>One of the first adapters</i> <br><br>  A few months ago, the disc came back again.  This time it was obvious that constantly looking for discs more than 15 years old is not an option, and the machine needs to be modernized, transferred to modern media.  As a solution, it was proposed to switch to flash.  There were several reasons for this choice, but the main reason was that solid-state drives are much more resistant to vibrations than hard drives. <br>  This decision marked the beginning of a large series of research and experiments that culminated in the development and production of a working version of its own solid-state drive based on flash memory after two months.  This is not exactly an SSD drive, rather a specialized IDE-to-CompactFlash adapter for industrial equipment with a number of unique features. <br>  But first, an attempt was made to solve the problem, as they say, head on.  We collected several different IDE Flash modules and CompactFlash cards, copied the recovered data onto them, and went to leave for Zhytomyr. <br><br><img src="https://habrastorage.org/storage2/12f/445/54f/12f44554fea55dfff31b020afcca7b94.png"><br>  <i>Our ward - woodworking machine IMA BIMA</i> <br><br>  But none of the flash drives could not boot into the machine.  With any BIOS settings and connection modes, download attempts resulted in a disk read error.  An attempt was made to correct the boot sector, as a result, the error disappeared, but the system hung up immediately after the start. <br>  When it became clear that the cavalry attack did not solve the problem, we disassembled the machine, dismantled the operator panel and industrial computer and took the equipment to our study. <br><br><img src="https://habrastorage.org/storage2/1e8/bb3/098/1e8bb30986881d7f5f7d8b30b2e42fb9.png"><br>  <i>Stand for research</i> <br><br>  Since it was not possible to stop production for any lengthy period, in parallel we assembled our own computer test bench on a 486DX2 processor, with 16 MB of RAM.  Due to this, as well as the fact that we were able to repair the ‚Äúlast‚Äù Seagate ST91351AG, we managed to avoid production downtime during the development of our disk. <br>  The control computer of the machine NUM 1062W, by the way "purebred Swiss", was developed and assembled by NUM in 1998 in the industrial version 486DX2-66 with 24 MB of RAM.  According to the service marks on the machine, it was last serviced in 1999, while still in Germany.  Then preventive measures were carried out, and after that, he worked uninterruptedly until 2010, when the hard drive first failed. <br><br><img src="https://habrastorage.org/storage2/3ed/35c/ab0/3ed35cab026700a3580127497db40de7.png"><br>  <i>"Sistemnik" NUM 1062W</i> <br><br>  The OS / 2 WARP, which is now almost forgotten, is used as the operating system in this industrial computer, and the machine is controlled using special application software. <br>  Much of the research and experimentation was carried out using the protocol analyzer EPOS ATA Analyzer. <br><br><img src="https://habrastorage.org/storage2/df3/d4a/6cb/df3d4a6cbdb3461366c9fd283b275e51.png"><br>  <i>EPOS ATA Analyzer Protocol Analyzer</i> <br><br>  The analyzer is a compact device that is included in the gap between the system under study and the drive with the SATA or PATA interface and intercepts all commands and data they exchange.  The collected information (exchange protocol) is transferred via USB to a separate instrument computer, where it is processed using special software. <br>  The analyzer has repeatedly rescued us in such situations, the more we were surprised when it turned out that some kind of ‚Äúgarbage‚Äù was transmitted over the IDE bus, and not standard ATA commands. <br>  When analyzing such incorrect behavior of the analyzer with a Swiss computer, I had to remind myself of the architecture of 486 compatible motherboards.  The reason was found - the IDE interface controller on the motherboard sent signals with a level of 5V to the bus.  Currently, according to the requirements of the ATA standard, they should have a level of 3.3V, so all modern controllers chips simply could not correctly interpret the commands that were transmitted through the interface. <br>  The solution in this situation seemed obvious.  We took up the development and manufacture of level converter.  Moreover, according to the results of the experiments, we have already managed to launch the operating system from the original Seagate ST91351AG on our test bench.  Test copies on CompactFlash and IDE Flash also loaded OS / 2 WARP on a stand-alone PC. <br>  A couple of weeks we received printed circuit boards and assembled a level converter.  With it, the first data exchange protocols with drives were obtained.  And then it turned out that the problem is not at all in non-standard levels on the bus.  Moreover, as a result of a thorough examination of the motherboard, it turned out that the problem of overvoltage was caused by the faulty chip of the IDE buffer of the controller (74ACT16245DGGE4).  She was replaced and research continued. <br><br><img src="https://habrastorage.org/storage2/c3c/06f/bf4/c3c06fbf48e1a8aa9a00e883378dac63.png"><br>  <i>Idle buffer chip on the motherboard</i> <br><br>  At that time, intermediate results were as follows.  On our OS / 2 test booth, WARP was loaded from both the original Seagate and virtually any hard drive, IDE Flash and CompactFlash.  But only Seagate was still running on the target computer. <br>  The question was definitely not related to a specific disk - this version was discarded one of the first.  The check was made using a disk passport emulator developed on the basis of the ATA Analyzer.  The essence of the emulator is quite simple - when intercepting the IDENTIFY DEVICE command (it gives all disk configuration information - model, serial number, supported modes, etc.), it does not translate the command to the connected disk, but returns the passport we need. <br>  To find out why this Seagate is so special, dozens of protocols were removed and carefully analyzed using an analyzer.  They were almost identical, with a slight adjustment for different platforms - i.e.  the instruction sets and the transmitted data when the disk was initialized on the examined computer and the test bench were the same.  But after a certain point, something incomprehensible was happening, which resulted in the impossibility of booting from any disks on the NUM 1062W. <br><br><img src="https://habrastorage.org/storage2/182/47c/b51/18247cb51874a16c4495e41f8fd0122c.png"><br>  <i>Fragment of one of the protocols</i> <br><br>  We tried more than two dozen disks - the same age as the ill-fated sigate, but none of them allowed the system to boot.  Nevertheless, a large amount of data collected allowed localizing the moment of failure in the download.  This moment was very carefully analyzed at the logical and signal levels. <br>  The problem was in the error of the implementation of the data transfer protocol between the host and the disk.  In fact, at a certain point in time, the IDE controller of the motherboard NUM 1062W formed a condition on the bus that is not described in any version of the ATA standard.  Under the standard, such states should be discarded by any disk, with an error message.  All disks responded correctly to this state, except for the sigate, which ignored it and proceeded to process further commands. <br>  Thus, the complementary errors in the IDE controller and in the disk firmware led to the creation of a unique system of binding the disk to the equipment.  It seems to me that at the development stage of the motherboard, debugging was done with this kind of sigate, and when it turned out that the other disks do not work very well, it became a feature. <br>  Unfortunately, our requests to the computer developer did not bring tangible benefits.  The only thing we could achieve from the Swiss is that such equipment has long been discontinued and is not supported, but if we need service documentation, they are ready to provide it, of course, for a fee.  However, they reported that the documentation does not contain circuit design and wiring diagrams, and they cannot provide such information due to its absence. <br>  When the problem was clearly identified, we began developing a disk emulator directly for a specific machine.  First of all, the layout of the future device was developed.  Its basis was the debug board of the hard disk drive maintenance instrument developed earlier for another project, built on an Atmel microcontroller.  For the first time in this layout, we successfully downloaded NUM 1062W from IDE Flash drives and CompactFlash cards. <br><br><img src="https://habrastorage.org/storage2/1cf/63c/191/1cf63c191bbdf038e74529749bcfd875.png"><br>  <i>Debug layout</i> <br><br>  After that, it was decided to test in "combat conditions" - directly at work.  We went to Zhytomyr to the production site of the customer, there we hooked up the layout of the future drive we developed to the machine.  About a miracle - everything worked, and positive results were obtained for both IDE Flash modules and CompactFlash cards. <br><br><img src="https://habrastorage.org/storage2/ef5/ac1/966/ef5ac19663d943027e4f8534f4be9f76.png"><br>  <i>Testing of the layout in the "combat conditions"</i> <br><br>  After the trial run, several instances of solid-state disks in the 2.5 ‚Äùform factor with an IDE interface were made.  They use industrial CompactFlash card as a carrier.  The first Ukrainian SSD disk is called the Hard Disk Emulator for Industrial Equipment. <br><br><img src="https://habrastorage.org/storage2/1cf/63c/191/1cf63c191bbdf038e74529749bcfd875.png"><br>  <i>Original disk, debug layout, final version of our disk</i> <br><br><img src="https://habrastorage.org/storage2/df0/439/a43/df0439a43e7783a4cf8e9ec9d5e9a04f.png"><br>  <i>The device of our disk</i> <br><br>  In addition, during the testing of the layout in production, it turned out that the control programs for the machine are worn on diskettes.  This creates great inconvenience for employees, because in a production environment, floppy disks ‚Äúdo not live‚Äù for a long time.  According to the customer, one floppy disk is enough to write 3-5 control programs, then it needs to be changed.  Therefore, we proposed to replace the drives with FDD emulators based on USB flash drives.  As a result of this additional upgrade, the IMA BIMA machining center was completely transferred from magnetic storage technologies to modern solid-state media. <br><br><h4>  Results: <br></h4><br>  ‚Ä¢ A non-trivial problem of replacing outdated magnetic drives (HDD and FDD) with modern solid-state flash-based media was solved, which allowed us to extend the life and increase the reliability of operation of a CNC woodworking machine. <br>  ‚Ä¢ The ‚ÄúHDD emulator‚Äù developed by us has a number of special functions, including the possibility of replacing a passport, modifying the protocol on the fly, correcting undocumented data exchange errors.  Thanks to this, it is possible to upgrade practically any industrial equipment and non-standard specialized equipment that use outdated hard drives with an IDE interface. <br><br>  PS We are currently working on creating a counterpart for the SCSI interface, which is widely used, for example, in medical technology.  If the topic is interesting, in the following posts I will try to describe what we are doing in this direction. </div><p>Source: <a href="https://habr.com/ru/post/178099/">https://habr.com/ru/post/178099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178087/index.html">Bread crumbs (breadcrumbs) in asp.net MVC3</a></li>
<li><a href="../178089/index.html">From Excel to MySQL. Small PHP function (fixed)</a></li>
<li><a href="../178091/index.html">AWS AMAZON - how do you optimize resources</a></li>
<li><a href="../178095/index.html">What is ASO and why it is urgently needed by today's developers</a></li>
<li><a href="../178097/index.html">An open letter to Eric Schmidt about banning private drones</a></li>
<li><a href="../178103/index.html">Mathematical model of the engine Lego NXT</a></li>
<li><a href="../178105/index.html">Very fast Windows user switching</a></li>
<li><a href="../178107/index.html">Practice remote work: a look from the inside</a></li>
<li><a href="../178111/index.html">IP PBX based on 3CX Phone System: features and configuration</a></li>
<li><a href="../178117/index.html">Bare-Metal Deployment - or how cloud elasticity is ensured in System Center 2012 SP1 Virtual Machine Manager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>