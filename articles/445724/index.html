<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We repair WSUS clients</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WSUS clients do not want to be updated after changing the server? 
 Then we go to you. (WITH) 

 Everybody had situations when something stopped worki...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We repair WSUS clients</h1><div class="post__text post__text-html js-mediator-article">  <i>WSUS clients do not want to be updated after changing the server?</i> <i><br></i>  <i>Then we go to you.</i>  <i>(WITH)</i> <br><br>  Everybody had situations when something stopped working.  This article focuses on WSUS (more information on WSUS can be found <a href="http://technet.microsoft.com/ru-ru/windowsserver/bb332157.aspx">here</a> and <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BB%25D1%2583%25D0%25B6%25D0%25B1%25D0%25B0_%25D0%25BE%25D0%25B1%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_Windows_Server">here</a> ).  Or rather, how to get WSUS clients (that is, our computers with you) to receive updates again after transferring or restoring an existing update server. <br><br>  <b>So, the situation is as follows.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Dead WSUS server.  More precisely, the RAID controller already produced in 2000.  But this fact did not add joy.  After a brief fuss (with attempts to restore the RAID, ruined by the dying controller), it was decided to <s>send everything to</s> deploy a new WSUS-server. <br><br>  As a result, we got a working WSUS, to which for some reason the clients did not connect. <br>  Moments: WSUS is associated with the FQDN through the internal DNS server, the WSUS server is registered in group policies and distributed to clients via AD, the default settings for the server, before starting all actions, update WSUS itself and synchronize the updates. <br><br>  <b>After analyzing the situation, several key points were identified.</b> <br><br><ol><li>  Clinch client (talking about wuauclt) when trying to connect to the SID of the old WSUS server. </li><li>  The problem with the uninstalled updates downloaded from the old WSUS-server. </li><li>  Parking services affecting the work of wuauclt (talking about wuauserv, bits and cryptsvc).  Parking occurred for various reasons that have not been analyzed in detail. </li></ol><br>  As a result, the entire decision resulted in a small script that is distributed by group policies via AD or with your own hands (and legs).  The script uses the most secure version of the repair and has not brought a single negative result for the past six months of use. <br><a name="habracut"></a><br>  <b>I will describe what is being done (for particularly curious)</b> <br><br>  We park the update server service, clean the WSUS communication link security descriptor, delete existing updates from the previous WSUS, clean the registry from references to the previous WSUS, start the automatic update services (wuauserv), background intelligent transfer service (bits) and cryptography service (cryptsvc), at the very end, we are forcibly knocking on WSUS with zeroing authorization, detecting a new WSUS and generating a report to the server. <br><br>  And as always: you perform all actions described above and below at your own peril and risk.  Please make sure that all the necessary data is saved before executing the script. <br><br>  <b>Script</b> <br><br><pre><code class="plaintext hljs">net stop wuauserv sc sdset wuauserv D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;AU)(A;;CCLCSWRPWPDTLOCRRC;;;PU) del /f /s /q %windir%\SoftwareDistribution\download\*.* REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate" /v AccountDomainSid /f REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate" /v PingID /f REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate" /v SusClientId /f net start wuauserv &amp;&amp; net start bits &amp;&amp; net start cryptsvc wuauclt /resetauthorization /detectnow /reportnow</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/445724/">https://habr.com/ru/post/445724/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445714/index.html">The final program DUMP-2019 is ready. We meet on April 19 in Yekaterinburg</a></li>
<li><a href="../445716/index.html">Allocation of IT costs - is there justice?</a></li>
<li><a href="../445718/index.html">"NoERP" or a new look at data normalization in corporate accounting systems</a></li>
<li><a href="../445720/index.html">Russians will get a digital profile</a></li>
<li><a href="../445722/index.html">Let's play in books - what gamebooks are and which ones are worth trying</a></li>
<li><a href="../445726/index.html">The use of machine learning to analyze a large number of feedback from respondents</a></li>
<li><a href="../445730/index.html">The founders of the theory of distributed systems in the arms of the hydra</a></li>
<li><a href="../445734/index.html">Getting Yandex Direct advertising campaigns using the API in DataFrame (Python)</a></li>
<li><a href="../445736/index.html">Brief history of unusual music formats</a></li>
<li><a href="../445740/index.html">Cat under the hood. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>