<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GymPy - a log program for lovers of iron</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Of the features: PyGTK (hildonize for Nokia N900), self-modifiable code, so as not to mess with config files. 

 By tradition, lyrical introduction. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GymPy - a log program for lovers of iron</h1><div class="post__text post__text-html js-mediator-article"><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/9xSb5OIYzU4%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhiv24MHeBRjrN3ThQ1ZEtGotDNdNw" frameborder="0" allowfullscreen=""></iframe><br><br>  Of the features: PyGTK (hildonize for Nokia N900), self-modifiable code, so as not to mess with config files. <br><a name="habracut"></a><br>  By tradition, lyrical introduction. <br><br>  Going to the gym for the past two years has been more of a social event for me than a focused workout and thoughtful pumping of the right muscle groups.  It so happened that when two or three PhD students from different, but nearby areas of science gather in one place, and the natural aggravation of all three is added to the tongue ‚Äî nothing can stop this stream of consciousness. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But by the will of fate, and, one might say, bad rock, our company fell apart.  A catastrophic lack of time and the possibility of coordinating schedules on the one hand, and old injuries on the other, have led me to go to the gym for the last three months alone.  And honestly, I don‚Äôt even regret it. <br><br>  When the question arose, and it was necessary to make a decision - to give up this ‚Äúbad‚Äù activity or, on the contrary, take it seriously, think over the training program and acquire theoretical knowledge of the subject, it was a combination of circumstances.  Very much in time, my brother ( <a href="https://geektimes.ru/users/akusto/" class="user_link">akusto</a> ) showed a <a href="http://www.bodybuilding.com/fun/wotw56.htm">5x5 training session</a> , which he himself then used for a couple of weeks.  She received first place among the many programs on <em>bodybuilding.com</em> .  Briefly, it can be described as 4 days with 5 sets of 5 repetitions for all major muscle groups with a fixed rest time between exercises and sets.  The last for me was very important.  So how exactly exactly the specified training time gives some underlining and completeness to this action.  Plus, the exercises were chosen from the best rated <em>bodybuilding.com</em> . <br><br>  Strict time requirements and mandatory weight gain each week led to an obvious decision - to write a program that would inform you about the need to start the next exercise and keep the weight of the barbell / dumbbell, which could be increased as needed (according to the training condition, weight need to increase if you were able to complete all 5x5 repetitions). <br><br>  It's time to open your favorite IDE and put in a couple of lines of python.  Since the code turned out to be a bit long for a habr (~ 251 line), it is suggested to follow <a href="http://bpaste.net/show/10709/">this link</a> to get acquainted with the full sheet. <br><br>  Now we will sort in parts. <br><br>  Having connected all used modules (lines 7-14), we create a program class.  This is done mainly only to ensure that functions (which are not yet in the code) have access and use a single namespace variable.  Starting from the 19th line, these most common variables are initialized (to call them global will be a little wrong from the point of view of Computer Science).  The variable <em>self.exercise_list</em> contains a list of exercises that starts on the day of the week.  Each line stores the name of the exercise and the working weight in lbs (pounds; kilograms in the states have not yet taken root), followed by the "x5" symbols.  They were put there not by chance.  It is for these two symbols that I will determine that the preceding number is weight.  Well, symbolically, this indicates that the "5x5" training program is used. <br><br>  In free days of the week, for example on Wednesday (line 36), the variable contains only a line with the name of the day of the week.  Only the name of this day of the week will be displayed if we enable the script on Wednesday. <br><br>  Lines 57-68 set the variables that define the script execution parameters. <br><br>  The following is the main functionality of the script, which we will discuss later. <br><br>  From line 189, the main program execution cycle begins and a class object is created.  Particular attention should be paid to the lines 198-201.  In them we find the path to the <em>pygym.srcfile</em> script being <em>executed</em> and read the Python source code in <em>pygym.src</em> .  This is done so that you can then change the source code and save it for later execution without bothering with storing the configuration file separately.  That is, the code will change itself. <br><br>  All subsequent lines are GTK and hildonize the description of the widgets in the main window, which we create in line 199 and show in 247th.  Then the main GTK loop is executed. <br><br>  Here is such a skeleton.  But we have not figured out what he can do.  Let's look at the functionality of the main program class. <br><br><blockquote><ol><li>  <font color="#ff7700">def</font> create_labels <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#008000">self</font> .  <font>labels</font> = <font>[</font> <font>]</font> </li><li>  <font color="#008000">self</font> .  <font>exlist</font> = <font color="#008000">self</font> .  <font>exercise_list</font> <font>[</font> <font color="#008000">self</font> .  <font>weekday</font> <font>]</font> </li><li>  <font color="#ff7700">for</font> ex <font color="#ff7700">in</font> <font color="#008000">self</font> .  <font>exlist</font> .  <font>split</font> <font>(</font> <font color="#483d8b">' <font color="#000099">\ n</font> '</font> <font>)</font> : </li><li>  <font color="#008000">self</font> .  <font>labels</font> .  <font>append</font> <font>(</font> gtk. <font>Label</font> <font>(</font> ex <font>)</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>ex_vbox</font> .  <font>pack_start</font> <font>(</font> <font color="#008000">self</font> . <font>labels</font> <font>[</font> - <font color="#ff4500">1</font> <font>]</font> , <font color="#008000">True</font> , <font color="#008000">True</font> , <font color="#ff4500">0</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>bold_label</font> <font>(</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>ex_vbox</font> .  <font>show_all</font> <font>(</font> <font>)</font> </li></ol></blockquote><br><br>  The function will display a list of exercises as an array <em>gtk.label</em> .  In line 3 of the list of all exercises of the week, we select the current day <em>self.weekday</em> .  We <em>split a</em> multi-line variable with <em>split</em> into separate lines and add them to the vertical container <em>self.ex_vbox</em> .  We start the <strike>balding</strike> function of highlighting (thickening) the active exercise (or rather, this is an exercise that can be edited at the current moment), and show the vertical container and all its new contents. <br><br><blockquote><ol><li>  <font color="#ff7700">def</font> bold_label <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#ff7700">if</font> <font color="#008000">self</font> .  <font>active_ex</font> <font color="#66cc66">!</font>  = - <font color="#ff4500">1</font> : </li><li>  <font color="#008000">self</font> .  <font>labels</font> <font>[</font> <font color="#008000">self</font> .  <font>active_ex</font> <font>]</font> .  <font>set_markup</font> <font>(</font> <font color="#483d8b">'&lt;b&gt;'</font> + <font color="#008000">self</font> . <font>labels</font> <font>[</font> <font color="#008000">self</font> . <font>active_ex</font> <font>]</font> . <font>get_text</font> <font>(</font> <font>)</font> + <font color="#483d8b">'&lt;/ b&gt;'</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> debold_label <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#008000">self</font> .  <font>labels</font> <font>[</font> <font color="#008000">self</font> .  <font>active_ex</font> <font>]</font> .  <font>set_text</font> <font>(</font> <font color="#008000">self</font> . <font>labels</font> <font>[</font> <font color="#008000">self</font> . <font>active_ex</font> <font>]</font> . <font>get_text</font> <font>(</font> <font>)</font> <font>)</font> </li></ol></blockquote><br><br>  Everything is as it was written - the first function using markup adds <em>bold</em> tags to an active exercise;  the second removes these tags. <br><br><blockquote><ol><li>  <font color="#ff7700">def</font> pause <font>(</font> <font color="#008000">self</font> , pause_time, set_number = <font color="#008000">None</font> <font>)</font> : </li><li>  start_t = <font color="#dc143c">time</font> .  <font color="#dc143c">time</font> <font>(</font> <font>)</font> </li><li>  <font color="#ff7700">while</font> <font>(</font> <font color="#dc143c">time</font> . <font color="#dc143c">time</font> <font>(</font> <font>)</font> -start_t <font color="#66cc66">&lt;</font> pause_time <font>)</font> : </li><li>  temp_t = <font color="#dc143c">time</font> .  <font color="#dc143c">time</font> <font>(</font> <font>)</font> </li><li>  <font color="#ff7700">while</font> <font color="#dc143c">time</font> .  <font color="#dc143c">time</font> <font>(</font> <font>)</font> -temp_t <font color="#66cc66">&lt;</font> <font color="#ff4500">1</font> : </li><li>  <font color="#ff7700">while</font> gtk.  <font>events_pending</font> <font>(</font> <font>)</font> : gtk.  <font>main_iteration</font> <font>(</font> <font>)</font> </li><li>  <font color="#dc143c">time</font> .  <font>sleep</font> <font>(</font> <font color="#008000">self</font> . <font>sleep_time</font> <font>)</font> </li><li>  <font color="#ff7700">if</font> set_number: </li><li>  <font color="#008000">self</font> .  <font>status</font> .  <font>set_text</font> <font>(</font> <font color="#008000">self</font> . <font>excercise</font> . <font>get_text</font> <font>(</font> <font>)</font> + <font color="#483d8b">' <font color="#000099">\ n</font> % 03i seconds left before set #% i'</font> <font color="#66cc66">%</font> <font>(</font> pause_time - </li><li>  <font color="#dc143c">time</font> .  <font color="#dc143c">time</font> <font>(</font> <font>)</font> + start_t, set_number <font>)</font> <font>)</font> </li><li>  <font color="#ff7700">else</font> : </li><li>  <font color="#008000">self</font> .  <font>status</font> .  <font>set_text</font> <font>(</font> <font color="#008000">self</font> . <font>excercise</font> . <font>get_text</font> <font>(</font> <font>)</font> + <font color="#483d8b">' <font color="#000099">\ n</font> % 03i seconds left'</font> <font color="#66cc66">%</font> <font>(</font> pause_time - <font color="#dc143c">time</font> . <font color="#dc143c">time</font> <font>(</font> <font>)</font> + start_t <font>)</font> <font>)</font> </li><li>  <font color="#ff7700">if</font> pause_time <font color="#66cc66">&gt;</font> self.  <font>pause_rep</font> <font color="#ff7700">and</font> <font color="#008000">int</font> <font>(</font> pause_time- <font color="#dc143c">time</font> . <font color="#dc143c">time</font> <font>(</font> <font>)</font> + start_t <font>)</font> == <font color="#008000">self</font> .  <font>pre_ex</font> : </li><li>  <font color="#dc143c">os</font> .  <font>system</font> <font>(</font> <font color="#483d8b">'dbus-send --print-reply --system --dest = com.nokia.mce / com / nokia / mce / request com.nokia.mce.request.req_vibrator_pattern_activate string: "PatternChatAndEmail"&gt; / dev / null '</font> <font>)</font> </li><li>  <font color="#ff7700">if</font> pause_time <font color="#66cc66">&gt;</font> self.  <font>pause_rep</font> : </li><li>  <font color="#dc143c">os</font> .  <font>system</font> <font>(</font> <font color="#483d8b">'dbus-send --print-reply --system --dest = com.nokia.mce / com / nokia / mce / request com.nokia.mce.request.req_vibrator_pattern_activate string: "PatternChatAndEmail"&gt; / dev / null '</font> <font>)</font> </li></ol></blockquote><br><br>  One of the main functions of the program is waiting for a pause and vibration at the most inappropriate moment ... Line 6 is important. If you do not turn it on, the application will simply not respond to clicks and will not update the screen.  This is just an instruction for GTK to check and process all messages and events of the application.  On the 14th and 16th lines, an external program is called that sends a DBus message for a long vibration (about 1 second).  This is a slightly dirty approach, since it would be possible to connect the DBus module and do it all inside the python, without causing any external applications.  But it was just too lazy! <br><br>  And finally, the most delicious - self-modifiable code. <br><br><blockquote><ol><li>  <font color="#ff7700">def</font> weight_change <font>(</font> <font color="#008000">self</font> , button <font>)</font> : </li><li>  <font color="#ff7700">if</font> <font color="#008000">self</font> .  <font>active_ex</font> <font color="#66cc66">&gt;</font> <font color="#ff4500">0</font> : </li><li>  ex = <font color="#008000">self</font> .  <font>labels</font> <font>[</font> <font color="#008000">self</font> .  <font>active_ex</font> <font>]</font> .  <font>get_text</font> <font>(</font> <font>)</font> </li><li>  lmatch = <font color="#dc143c">re</font> .  <font>search</font> <font>(</font> <font color="#483d8b">"([0-9.] *) x5"</font> , ex <font>)</font> </li><li>  <font color="#ff7700">if</font> lmatch: </li><li>  <font color="#ff7700">if</font> button.  <font>get_label</font> <font>(</font> <font>)</font> == <font color="#483d8b">'+'</font> : </li><li>  new_weight = <font color="#008000">self</font> .  <font>weight_increment</font> + <font color="#008000">float</font> <font>(</font> lmatch. <font>group</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <font>)</font> </li><li>  <font color="#ff7700">elif</font> button.  <font>get_label</font> <font>(</font> <font>)</font> == <font color="#483d8b">'-'</font> : </li><li>  new_weight = - <font color="#008000">self</font> .  <font>weight_increment</font> + <font color="#008000">float</font> <font>(</font> lmatch. <font>group</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <font>)</font> </li><li>  <font color="#ff7700">if</font> new_weight == <font color="#008000">int</font> <font>(</font> new_weight <font>)</font> : </li><li>  new_weight = <font color="#483d8b">'% i'</font> <font color="#66cc66">%</font> new_weight </li><li>  <font color="#ff7700">else</font> : </li><li>  new_weight = <font color="#483d8b">'% .1f'</font> <font color="#66cc66">%</font> new_weight </li><li>  new_text = ex <font>[</font> : lmatch.  <font>start</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <font>]</font> + new_weight + ex <font>[</font> lmatch.  <font>end</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> : <font>]</font> </li><li>  <font color="#008000">self</font> .  <font>labels</font> <font>[</font> <font color="#008000">self</font> .  <font>active_ex</font> <font>]</font> .  <font>set_text</font> <font>(</font> new_text <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>bold_label</font> <font>(</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>src</font> = <font color="#dc143c">re</font> .  <font>sub</font> <font>(</font> ex, new_text, <font color="#008000">self</font> . <font>src</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>write_source</font> <font>(</font> <font>)</font> </li><li>  <font color="#ff7700">elif</font> <font color="#008000">self</font> .  <font>active_ex</font> == <font color="#ff4500">0</font> : </li><li>  <font color="#808080">#if self.start.get_property ("visible"):</font> </li><li>  <font color="#ff7700">for</font> ex <font color="#ff7700">in</font> <font color="#008000">self</font> .  <font>labels</font> : </li><li>  ex.  <font>destroy</font> <font>(</font> <font>)</font> </li><li>  <font color="#ff7700">if</font> button.  <font>get_label</font> <font>(</font> <font>)</font> == <font color="#483d8b">'+'</font> : </li><li>  <font color="#008000">self</font> .  <font>weekday</font> = <font>(</font> <font color="#008000">self</font> . <font>weekday</font> + <font color="#ff4500">1</font> <font>)</font> <font color="#66cc66">%</font> 7 </li><li>  <font color="#ff7700">elif</font> button.  <font>get_label</font> <font>(</font> <font>)</font> == <font color="#483d8b">'-'</font> : </li><li>  <font color="#008000">self</font> .  <font>weekday</font> = <font>(</font> <font color="#008000">self</font> . <font>weekday</font> - <font color="#ff4500">1</font> <font>)</font> <font color="#66cc66">%</font> 7 </li><li>  <font color="#008000">self</font> .  <font>create_labels</font> <font>(</font> <font>)</font> </li><li>  <font color="#ff7700">else</font> : </li><li>  hildon  <font>hildon_banner_show_information</font> <font>(</font> button, </li><li>  <font color="#483d8b">'0'</font> , <font color="#483d8b">"Use 'v' or '^' buttons to choose an exercise"</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> write_source <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#808080"># write the source code back</font> </li><li>  f = <font color="#008000">open</font> <font>(</font> <font color="#008000">self</font> . <font>srcfile</font> , <font color="#483d8b">'w'</font> <font>)</font> </li><li>  f.  <font>write</font> <font>(</font> <font color="#008000">self</font> . <font>src</font> <font>)</font> </li><li>  f.  <font>close</font> <font>(</font> <font>)</font> </li></ol></blockquote><br><br>  Here are two functions.  One is called when you press the weight change buttons, the second saves the changed source code.  In the 4th line there is a search for a regular expression of a number with the symbols "x5" at the end.  Perhaps it is a bust to use RE for such a simple case.  But I wanted to show how this can work in the general case for a code of any complexity.  Having found the necessary numbers, we modify them according to the pressed button - we add / subtract from the current weight <em>self.weight_increment</em> .  From the 10th to the 13th lines, we will convert the number to a whole without a dot or into a decimal with one decimal place (or after the dot ... I'm confused).  And we already save the new value, replacing it in the old lines (14).  We substitute this replacement into the source code of the program (17) and save it to a file (18 =&gt; 32).  Lines 19-30 handle the day of the week change event.  That is, the program can be viewed and even run on the execution of not only the current day, but also the programs of other days of the week. <br><br>  Here, perhaps, that's all for today.  Thank you for your attention, you had a PhD weight lifter Vadikus with you. </div><p>Source: <a href="https://habr.com/ru/post/107654/">https://habr.com/ru/post/107654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107648/index.html">Wikileaks have followers.</a></li>
<li><a href="../107650/index.html">Intel Core 2 Processor Cycle Analysis</a></li>
<li><a href="../107651/index.html">How to make everyday objects more useful, and travel by train more exciting</a></li>
<li><a href="../107652/index.html">Porting and preprocessing psto</a></li>
<li><a href="../107653/index.html">Mobile version of Google Instant has appeared.</a></li>
<li><a href="../107655/index.html">About the futility of lengthy design</a></li>
<li><a href="../107658/index.html">Mobile Firefox (aka Fennec) Reaches Version 4.0 Beta 2</a></li>
<li><a href="../107660/index.html">Has it become more convenient for you to read Habr, after the appearance of restrictions on the length of articles,% username%?</a></li>
<li><a href="../107661/index.html">For large-scale introduction of biofuels from algae need at least 10 years of scale</a></li>
<li><a href="../107662/index.html">Agile methodology turns 10 years old</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>