<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kivy. From creation to production one step. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Literally an article ago, by a majority of votes, it was decided to begin a series of lessons on creating an analogue of a native application written ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kivy. From creation to production one step. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/33d/628/491/33d6284916964a4a81ff15ac7ac0ed0d.png" align="left"><br><p>  Literally <a href="https://habrahabr.ru/post/313160/">an article</a> ago, by a majority of votes, it was decided to begin a series of lessons on creating an analogue of a native application written for Android in Java, but using the Kivy + Python framework.  It will be considered: the creation and layout of controllers and widgets, an in-depth study of the Kv-Language UI markup technique, dynamic control of screen elements, a library that provides access to Android Material Design, and much more ... </p><br><p>  Interested, please under the cat! </p><a name="habracut"></a><br><p>  So, after an unsuccessful search of a <s>guinea pig</s> for a suitable application, to the best of complexity (so as not to stretch our tutorial to the scale of Santa Barbara) and not too simple (in order to illuminate as much as possible the technical aspects of Kivy development), according to the habrovich <a href="https://habrahabr.ru/users/t0h6by/">Roman Hvashchevsky</a> , who agreed to speak Java as a consultant to our lessons (sometimes in the articles I will give the listings of the original code written in Java), I was redirected <a href="https://github.com/siacs/Conversations">here</a> - and the choice was made: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/464/9bb/560/4649bb5607fa43b1a70f3ebcc2c67262.jpg"></div><br><table><tbody><tr><td>  Conversations is an instant messaging application for Android using the XMPP / Jabber protocol.  An alternative to programs such as WhatsApp, WeChat, Line, Facebook Messenger, Google Hangouts and Threema. <br></td></tr></tbody></table><br><p>  It is on the basis of this application that our lessons will be built, and <s>closer to the release</s> by the end of the final article we will have our own reptile, fruit-growing tonton of <s>python, toad and fruit</s> Jabber-Python-Kivy - PyConversations and the cherished apk-shechka collected from Python3! </p><br><p>  I hope you stocked up with tea and cigarettes, because we are starting!  As always, you need, if you have not yet acquired, the <a href="https://github.com/HeaTTheatR/CreatorKivyProject">Wizard to create a new project</a> for Kivy applications.  Clone it in your labs, open the root directory of the wizard in the terminal and execute the command: </p><br><pre><code class="bash hljs">python3 main.py PyConversations ///// -repo https://github.com/User/PyConversations -autor Easy -mail gorodage@gmail.com</code> </pre> <br><p>  Naturally, the Kivy framework itself, which you can read about installing <a href="https://kivy.org/">here</a> .  Well, and of course, you already found the wonderful KivyMD library for creating a native interface in the style of Android Material Design by clicking the link in the repository of the New Project Wizard. </p><br><p>  Now go to <s>PornHub</s> <a href="https://github.com/">github</a> and forknite / clone / download the PyConversations turnips, because the project that we have started is not small, and as new articles are released, it will become overgrown with new functions, classes and files.  Otherwise, already in the second article you will <s>smoke bamboo to</s> wonder why nothing works for you. </p><br><p>  So, the project is created: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d49/398/557/d49398557ace404fb6fb6aad5914a74f.png"></div><br><p>  For today's article, I took the first four Activities of the official Conversations application (Activity of new account registration), which we will now create with you: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/202/ae3/5d9/202ae35d9b6c425991db11dfe3c8ebde.png"></div><br><p>  However, before you begin, so that we understand each other, you should familiarize yourself with the basic rules and concepts ... </p><br><h4>  <b>Creating and managing dynamic classes</b> </h4><br><div class="spoiler">  <b class="spoiler_title">Basic presentation of a dynamic class using a simple example:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.boxlayout <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BoxLayout <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StringProperty Builder.load_string(<span class="hljs-string"><span class="hljs-string">''' #: import MDFlatButton kivymd.button.MDFlatButton #    Kivy-Language    python : # from kivymd.button import MDFlatButton # #  kv-      , #  , ,  : #: include your_kv_file.kv # #    ,  Kivy  , #     Activity ‚Äî   . #    Activity    BoxLayout - # ,     . &lt;StartScreen&gt; MDFlatButton: id: button text: 'Press Me' size_hint_x: 1 #    -  0  1 pos_hint: {'y': .5} #     'y'   #  . on_release: #   'root' -     , #            . root.set_text_on_button() '''</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  Builder.load_file('path/to/kv-file'), #   Activity   . class StartScreen(BoxLayout): ''' .''' new_text_for_button = StringProperty() #  Kivy      : # # StringProperty; # NumericProperty; # BoundedNumericProperty; # ObjectProperty; # DictProperty; # ListProperty; # OptionProperty; # AliasProperty; # BooleanProperty; # ReferenceListProperty; # #       #     . # # ,    : # # new_text_for_button = '' # #    - # TypeError: object.__init__() takes no parameters. def set_text_on_button(self): self.ids.button.text = self.new_text_for_button # ids -     Activity #   . # # ,    'button' - self.ids.button - #   ,    #      . #  ,   Properties, #         'on_', #          . def on_new_text_for_button(self, instance, value): print(instance, value) class Program(App): def build(self): ''',    .     Activity.''' return StartScreen(new_text_for_button='This new text') if __name__ in ('__main__', '__android__'): Program().run() #  </span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">We refer to our own attributes and methods inside the Activity:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.boxlayout <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BoxLayout <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StringProperty Builder.load_string(<span class="hljs-string"><span class="hljs-string">''' #: import MDFlatButton kivymd.button.MDFlatButton &lt;StartScreen&gt; MDFlatButton: id: button text: 'Press Me' size_hint_x: 1 pos_hint: {'y': .5} on_release: #    'self'    #       . self.text = root.new_text_for_button '''</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartScreen</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BoxLayout)</span></span></span><span class="hljs-class">:</span></span> new_text_for_button = StringProperty() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_new_text_for_button</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance, value)</span></span></span><span class="hljs-function">:</span></span> print(instance, value) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StartScreen(new_text_for_button=<span class="hljs-string"><span class="hljs-string">'This new text'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Using id controllers and widgets inside the Activity:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.boxlayout <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BoxLayout <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StringProperty Builder.load_string(<span class="hljs-string"><span class="hljs-string">''' #: import MDFlatButton kivymd.button.MDFlatButton &lt;StartScreen&gt; orientation: 'vertical' MDFlatButton: id: button text: 'Press Me' size_hint: 1, 1 pos_hint: {'center_y': .5} on_release: #    id      . #  ,        Python #  ,     Python . button_two.text = 'Id: "button_two: " {}'.format(root.new_text_for_button) MDFlatButton: id: button_two text: 'Id: "button_two: " Old text' size_hint: 1, 1 pos_hint: {'center_y': .5} '''</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartScreen</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BoxLayout)</span></span></span><span class="hljs-class">:</span></span> new_text_for_button = StringProperty() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StartScreen(new_text_for_button=<span class="hljs-string"><span class="hljs-string">'This new text'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Using methods with the 'on_' prefix inside the Activity:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.boxlayout <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BoxLayout <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StringProperty Builder.load_string(<span class="hljs-string"><span class="hljs-string">''' #: import MDFlatButton kivymd.button.MDFlatButton #: import snackbar kivymd.snackbar &lt;StartScreen&gt; orientation: 'vertical' MDFlatButton: id: button text: 'Press Me' size_hint: 1, 1 pos_hint: {'center_y': .5} on_release: button_two.text = 'Id: "button_two: " {}'.format(root.new_text_for_button) MDFlatButton: id: button_two text: 'Id: "button_two: " Old text' size_hint: 1, 1 pos_hint: {'center_y': .5} on_text: #      'text'. snackbar.make(', !     !') '''</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartScreen</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BoxLayout)</span></span></span><span class="hljs-class">:</span></span> new_text_for_button = StringProperty() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StartScreen(new_text_for_button=<span class="hljs-string"><span class="hljs-string">'This new text'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Using attributes and methods from the main class of the application inside the Activity:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.boxlayout <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BoxLayout <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StringProperty Builder.load_string(<span class="hljs-string"><span class="hljs-string">''' #: import MDFlatButton kivymd.button.MDFlatButton &lt;StartScreen&gt; MDFlatButton: #    'app' ‚Äî   - #      , #     , #   kivy.app.App. text: app.string_attribute size_hint_x: 1 pos_hint: {'y': .5} '''</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartScreen</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BoxLayout)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> string_attribute = StringProperty(<span class="hljs-string"><span class="hljs-string">'String from App'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StartScreen() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Using Activity without root class:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder Activity = <span class="hljs-string"><span class="hljs-string">''' &lt;MyScreen@FloatLayout&gt;: Label: text: 'Text 1' BoxLayout: MyScreen: '''</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Builder.load_string(Activity) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Using ids in an Activity without a root class:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder Activity = <span class="hljs-string"><span class="hljs-string">''' #: import MDFlatButton kivymd.button.MDFlatButton #  ,      , #   ,  .    - FloatLayout. &lt;MyScreen@FloatLayout&gt;: Label: id: label_1 text: 'Text 1' BoxLayout: orientation: 'vertical' MyScreen: id: my_screen MDFlatButton: text: 'Press me' size_hint_x: 1 on_press: my_screen.ids.label_1.text = 'New text' '''</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Builder.load_string(Activity) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> </div></div><br><p>  To understand what I‚Äôm going to talk about next, this is still enough, the rest will be explained <s>in a trench</s> along the way.  Well, let's start with the starting Activity of our project.  Open the <i>start_screen.kv</i> file.  In the project tree, it, like all other Activity applications, is located in the <i>libs / uix / kv / activity</i> directory: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/78b/c47/238/78bc472386004e2c8075e2ba48be7492.png"></div><br><p>  And the activity looks like this: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#: kivy 1.9.1 #: import Toolbar kivymd.toolbar.Toolbar #: import NoTransition kivy.uix.screenmanager.NoTransition &lt;StartScreen&gt;: orientation: 'vertical' Toolbar: id: action_bar background_color: app.theme_cls.primary_color #    title: app.title opposite_colors: True #     elevation: 10 #   #   - # left_action_items: [['name-icon', function], ‚Ä¶] #   - # right_action_items: [['name-icon', function], ‚Ä¶] ScreenManager: id: root_manager transition: NoTransition() #   Activity Introduction: id: introduction #     Activity  . on_enter: self._on_enter(action_bar, app) CreateAccount: id: create_account on_enter: self._on_enter(action_bar, app, root_manager) AddAccount: id: add_account on_enter: self._on_enter(action_bar, app) #     Activity. on_leave: action_bar.title = app.data.string_lang_create_account AddAccountOwn: id: add_account_own_provider on_enter: self._on_enter(action_bar, app, root_manager) on_leave: action_bar.title = app.title; action_bar.left_action_items = []</span></span></code> </pre> <br><p>  But more clearly: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/252/7f0/fe4/2527f0fe445044939d6c566cf670d4b8.png"></div><br><p>  Now open the base class Activity StartScreen, which is located on the path <i>libs / uix / kv / activity / baseclass</i> : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/29b/2f3/04e/29b2f304e0324451a134d3ba25c2bd09.png"></div><br><p>  <b>startscreen.py:</b> </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.boxlayout <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BoxLayout <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartScreen</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BoxLayout)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><p>  As you can see, the class is empty, but inherited from the BoxLayout container, which places widgets vertically or horizontally depending on the 'orientation' parameter - 'vertical' or 'horizontal' (by default - 'horizontal').  Here is a more detailed Activity StartScreen diagram: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a94/967/d7e/a94967d7ed884ed1b6d8e63d86484b9e.png"></div><br><p>  The base class of Activity StartScreen, we inherited from BoxLayout, in the markup itself declared its orientation as an <s>unconventional</s> vertical, and placed in its ToolBar container and ScreenManager screen manager.  ScreenManager is also a kind of container in which we place Screen screens with created Activity and then install them on the screen just by calling them by name.  For example: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder Activity = <span class="hljs-string"><span class="hljs-string">''' #: import MDFlatButton kivymd.button.MDFlatButton ScreenManager: Screen: name: 'Screen one' #   MDFlatButton: text: 'I`m Screen one with Button' size_hint: 1, 1 on_release: root.current = 'Screen two' #   Screen: name: 'Screen two' BoxLayout: orientation: 'vertical' Image: source: 'data/logo/kivy-icon-128.png' MDFlatButton: text: 'I`m Screen two with Button' size_hint: 1, 1 on_release: root.current = 'Screen one' '''</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Builder.load_string(Activity) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> <br><p>  Our ScreenManager contains four screens with Activity: Introduction, CreateAccount, AddAccount and AddAccountOwn.  Let's start with the first: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9ef/e48/a94/9efe48a94a484fc9868fbcbf9a891622.png"></div><br><div class="spoiler">  <b class="spoiler_title">Introduction.kv</b> <div class="spoiler_text"><pre> <code class="xml hljs">#: kivy 1.9.1 #: import MDFlatButton kivymd.button.MDFlatButton #  Activity . <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Introduction</span></span></span><span class="hljs-tag">&gt;</span></span>: name: 'Start screen' BoxLayout: orientation: 'vertical' padding: dp(5), dp(20) Image: source: 'data/images/logo.png' size_hint: None, None size: dp(150), dp(150) pos_hint: {'center_x': .5} Label: text: app.data.string_lang_introduction markup: True color: app.data.text_color text_size: dp(self.size[0] - 10), self.size[1] size_hint_y: None valign: 'top' height: dp(250) Widget: BoxLayout: MDFlatButton: text: app.data.string_lang_create_account on_release: app.screen_root_manager.current = 'Create account' MDFlatButton: text: app.data.string_lang_own_provider theme_text_color: 'Primary' on_release: app.delete_textfield_and_set_check_in_addaccountroot () app.screen_root_manager.current = 'Add account own provider'</code> </pre> </div></div><br><p>  This is what this Activity represents on the device screen (I allowed myself some liberties, but, it seemed to me, it would be better): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/22c/27e/fe0/22c27efe01e9464baca2c815e31a67c1.png"></div><br><p>  Here is the original Java: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5a0/185/368/5a0185368e87483ab992c254d2860194.png"></div><br><div class="spoiler">  <b class="spoiler_title">Original Activity Markup in Java</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ScrollView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fillViewport</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/color_background_primary"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/linearLayout"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"256dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Space</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/welcome_header"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/color_text_primary"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/TextSizeHeadline"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textStyle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bold"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/welcome_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/color_text_primary"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/TextSizeBody"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/create_account"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?android:attr/borderlessButtonStyle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"right"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/create_account"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/accent"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/use_own_provider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?android:attr/borderlessButtonStyle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"right"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/use_own_provider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/color_text_secondary"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_above</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/linearLayout"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_centerHorizontal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_centerVertical</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/main_logo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?attr/color_text_secondary"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/fineprint_size"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:maxLines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/free_for_six_month"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_centerHorizontal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ScrollView</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  The following is the Activity Introduction diagram: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8da/da0/41e/8dada041e89e4407af7674ba8c6135d7.png"></div><br><p>  Now I would like to go through the attributes of the widgets: </p><br><pre> <code class="python hljs">BoxLayout: ‚Ä¶ padding: dp(<span class="hljs-number"><span class="hljs-number">5</span></span>), dp(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-comment"><span class="hljs-comment">#      ‚Äî /  /</span></span></code> </pre> <br><pre> <code class="python hljs">Image: ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">#     ,  -  #    0  1 (.1, .5, .01  . .).    #   ,     size_hint #   None,     . # ,   : # # size_hint_x: None # width: 250 # #   # # size_hint_y: None # height: 50 # # ,    Activity,     . #    size_hint   (1, 1), #  ,       . size_hint: None, None size: dp(150), dp(150) #        'x' #   '' ,     # pos, , pos: 120, 90. pos_hint: {'center_x': .5}</span></span></code> </pre> <br><p>  With relative positions and sizes of the widget, you can experiment with the example below: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.lang <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Builder Activity = <span class="hljs-string"><span class="hljs-string">''' FloatLayout: Button: text: "We Will" pos: 100, 100 size_hint: .2, .4 Button: text: "Wee Wiill" pos: 280, 200 size_hint: .4, .2 Button: text: "ROCK YOU!!" pos_hint: {'x': .3, 'y': .6} size_hint: .5, .2 '''</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Builder.load_string(Activity) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__android__'</span></span>): Program().run()</code> </pre> <br><p>  Further by attributes: </p><br><pre> <code class="python hljs">Label: ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment"># ,   markdown    #   as is. #   : # [b][/b] # [i][/i] # [u][/u] # [s][/s] # [font=&lt;str&gt;][/font] # [size=&lt;integer&gt;][/size] # [color=#&lt;color&gt;][/color] # [ref=&lt;str&gt;][/ref] # [anchor=&lt;str&gt;] # [sub][/sub] # [sup][/sup] markup: True # ,  . text_size: dp(self.size[0] - 10), self.size[1] #   : # 'bottom', 'middle', 'center'  'top'. valign: 'top'</span></span></code> </pre> <br><p>  You can experiment with the text enclosing area with the example below: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.label <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Label <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LabelTextSizeTest</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Label( text=<span class="hljs-string"><span class="hljs-string">' ,  \n'</span></span> * <span class="hljs-number"><span class="hljs-number">50</span></span>, text_size=(<span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>), <span class="hljs-comment"><span class="hljs-comment">#     line_height=1.5 ) if __name__ == '__main__': LabelTextSizeTest().run()</span></span></code> </pre> <br><p>  Further on Activity: </p><br><pre> <code class="python hljs">Widget:</code> </pre> <br><p>  In context it is used as an analog in Java: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Space</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><p>  Further: </p><br><pre> <code class="python hljs">BoxLayout: MDFlatButton: text: app.data.string_lang_create_account <span class="hljs-comment"><span class="hljs-comment">#  Activity   'Create account'. on_release: app.screen_root_manager.current = 'Create account' MDFlatButton: text: app.data.string_lang_own_provider #        #   theme_text_color  'Custom' #     - text_color: .7, .2, .2, 1 theme_text_color: 'Primary' on_release: #      . #     , ,  #  ,       #    Activity,    . app.delete_textfield_and_set_check_in_addaccountroot() app.screen_root_manager.current = 'Add account own provider'</span></span></code> </pre> <br><p>  So.  We still have not considered one more question.  Let's go back to the Activity StartScreen markup: </p><br><pre> <code class="python hljs"> Introduction: id: introduction <span class="hljs-comment"><span class="hljs-comment">#     Activity  . on_enter: self._on_enter(action_bar, app)</span></span></code> </pre> <br><p>  That is, as soon as the Activity is displayed, the on_enter event code will be executed.  Let's see what the _on_enter method does in the base Activity class (file <i>libs / uix / kv / activity / baseclass / introduction.py</i> ): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e5e/f5d/8ed/e5ef5d8ed3284ba991a98dd950e17de1.png"></div><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.screenmanager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Screen <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Introduction</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Screen)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_on_enter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance_toolbar, instance_program)</span></span></span><span class="hljs-function">:</span></span> instance_toolbar.left_action_items = [] instance_toolbar.title = instance_program.title</code> </pre> <br><p>  The _on_enter method removes the icon in the ToolBar on the left, setting the value of left_action_items as an empty list, and changes the ToolBar signature to the application name. </p><br><p>  For example, here is the control class from the original Java: </p><br><div class="spoiler">  <b class="spoiler_title">WelcomeActivity</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> eu.siacs.conversations.ui; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.ActionBar; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.ActivityInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> eu.siacs.conversations.R; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WelcomeActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getResources().getBoolean(R.bool.portrait_only)) { setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT); } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ActionBar ab = getActionBar(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ab != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ab.setDisplayShowHomeEnabled(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); ab.setDisplayHomeAsUpEnabled(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.welcome); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Button createAccount = (Button) findViewById(R.id.create_account); createAccount.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(WelcomeActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MagicCreateActivity.class); intent.addFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION); startActivity(intent); } }); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Button useOwnProvider = (Button) findViewById(R.id.use_own_provider); useOwnProvider.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ startActivity(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(WelcomeActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EditAccountActivity.class)); } }); } }</code> </pre> </div></div><br><p>  So.  With this sorted out.  We have an Activity and two usable buttons.  Let's start with the first: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c2e/88a/b9e/c2e88ab9e71646e796333c8d67d57fa1.png"></div><br><p>  When you click on the button, Activity CreateAccount will be displayed: </p><br><pre> <code class="python hljs">MDFlatButton: text: app.data.string_lang_create_account on_release: app.screen_root_manager.current = <span class="hljs-string"><span class="hljs-string">'Create account'</span></span></code> </pre> <br><p>  Activity CreateAccount (Kivy): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/370/697/810/370697810da940c581c0ce4ad841e05d.png"></div><br><p>  Activity CreateAccount (original): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/883/5d0/268/8835d0268c724b89834e24e07b5d5c87.png"></div><br><p>  Let's open the Activity CreateAccount of our project: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/72e/42a/eef/72e42aeef02c4ad3889ff89a9219b505.png"></div><br><div class="spoiler">  <b class="spoiler_title">createaccount.kv</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#: kivy 1.9.1 #: import SingleLineTextField kivymd.textfields.SingleLineTextField #: import snackbar kivymd.snackbar # Activity   . #     'Create account'  Activity. &lt;CreateAccount&gt;: name: 'Create account' BoxLayout: orientation: 'vertical' padding: dp(5), dp(20) Image: source: 'data/images/logo.png' size_hint: None, None size: dp(150), dp(150) pos_hint: {'center_x': .5} Label: text: app.data.string_lang_enter_user_name markup: True color: app.data.text_color text_size: dp(self.size[0] - 10), self.size[1] size_hint_y: None valign: 'top' height: dp(215) Widget: size_hint_y: None height: dp(10) SingleLineTextField: id: username hint_text: 'Username' message: 'username@conversations.im' message_mode: 'persistent' on_text: app.check_len_login_in_textfield(self) Widget: BoxLayout: MDFlatButton: text: app.data.string_lang_next on_release: if username.text == '' or username.text.isspace(): \ snackbar.make(app.data.string_lang_not_valid_username) else: app.screen_root_manager.current = 'Add account'</span></span></code> </pre> </div></div><br><p>  There is nothing new for you here, in the diagram below I will only give what we have not yet discussed: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c94/427/0a8/c944270a8d98495f8adda04c115e58e1.png"></div><br><p>  The header and icon in the ToolBar are set in the base class Activity CreateAccount in the _on_enter method: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.screenmanager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Screen <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateAccount</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Screen)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_on_enter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance_toolbar, instance_program, instance_screenmanager)</span></span></span><span class="hljs-function">:</span></span> instance_toolbar.title = instance_program.data.string_lang_create_account instance_toolbar.left_action_items = [ [<span class="hljs-string"><span class="hljs-string">'chevron-left'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: instance_program.back_screen( instance_screenmanager.previous())] ]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Java's original control class MagicCreateActivity</b> <div class="spoiler_text"><pre> <code class="python hljs">package eu.siacs.conversations.ui; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.ActivityInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.text.Editable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.text.TextWatcher; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.EditText; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.TextView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.security.SecureRandom; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> eu.siacs.conversations.Config; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> eu.siacs.conversations.R; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> eu.siacs.conversations.entities.Account; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> eu.siacs.conversations.xmpp.jid.InvalidJidException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> eu.siacs.conversations.xmpp.jid.Jid; public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MagicCreateActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XmppActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextWatcher</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextView</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mFullJidDisplay</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EditText</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mUsername</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecureRandom</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mRandom</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CHARS</span></span></span><span class="hljs-class"> = "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456780</span></span></span><span class="hljs-class">+-/#$!?"; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PW_LENGTH</span></span></span><span class="hljs-class"> = 10; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">protected</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refreshUiReal</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class"> { } @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">onBackendConnected</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class"> { } @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">protected</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(final Bundle savedInstanceState)</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(getResources</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">.getBoolean</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(R.bool.portrait_only)</span></span></span></span><span class="hljs-class"><span class="hljs-params">)</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setRequestedOrientation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT)</span></span></span><span class="hljs-class">; } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">super</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(savedInstanceState)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setContentView</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(R.layout.magic_create)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mFullJidDisplay</span></span></span><span class="hljs-class"> = </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TextView)</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">findViewById</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(R.id.full_jid)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mUsername</span></span></span><span class="hljs-class"> = </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(EditText)</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">findViewById</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(R.id.username)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mRandom</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecureRandom</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> = </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Button)</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">findViewById</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(R.id.create_account)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setOnClickListener</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(new View.OnClickListener</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params"> { @Override public void onClick</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(View v)</span></span></span></span><span class="hljs-class"><span class="hljs-params"> { String username = mUsername.getText</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">.toString</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">; if </span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(username.contains</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">(</span></span></span></span><span class="hljs-string"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">"@"</span></span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"> || username.length</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"> &lt; </span></span></span><span class="hljs-number"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-class"><span class="hljs-params"> { mUsername.setError</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(getString</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">(R.string.invalid_username)</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; mUsername.requestFocus</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">; } else { mUsername.setError</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(null)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; try { Jid jid = Jid.fromParts</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(username.toLowerCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">, Config.MAGIC_CREATE_DOMAIN, null)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; Account account = xmppConnectionService.findAccountByJid</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(jid)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; if </span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(account == null)</span></span></span></span><span class="hljs-class"><span class="hljs-params"> { account = new Account</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(jid, createPassword</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; account.setOption</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(Account.OPTION_REGISTER, true)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; account.setOption</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(Account.OPTION_DISABLED, true)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; account.setOption</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(Account.OPTION_MAGIC_CREATE, true)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; xmppConnectionService.createAccount</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(account)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; } Intent intent = new Intent</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(MagicCreateActivity.this, EditAccountActivity.class)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; intent.putExtra</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-string"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">"jid"</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">, account.getJid</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">.toBareJid</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">.toString</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; intent.putExtra</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-string"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">"init"</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">, true)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; intent.setFlags</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; Toast.makeText</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(MagicCreateActivity.this, R.string.secure_password_generated, Toast.LENGTH_SHORT)</span></span></span></span><span class="hljs-class"><span class="hljs-params">.show</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">; startActivity</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(intent)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; } catch </span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(InvalidJidException e)</span></span></span></span><span class="hljs-class"><span class="hljs-params"> { mUsername.setError</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(getString</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">(R.string.invalid_username)</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-class"><span class="hljs-params">; mUsername.requestFocus</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">; } } } })</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mUsername</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addTextChangedListener</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(this)</span></span></span><span class="hljs-class">; } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">createPassword</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">builder</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(PW_LENGTH)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(int i = </span></span><span class="hljs-number"><span class="hljs-class"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-class"><span class="hljs-params">; i &lt; PW_LENGTH; ++i)</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">builder</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(CHARS.charAt</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(mRandom.nextInt</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">(CHARS.length</span></span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"> - </span></span></span></span><span class="hljs-number"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-class"><span class="hljs-params">)</span></span></span><span class="hljs-class">; } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">builder</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">; } @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beforeTextChanged</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(CharSequence s, int start, int count, int after)</span></span></span><span class="hljs-class"> { } @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">onTextChanged</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(CharSequence s, int start, int before, int count)</span></span></span><span class="hljs-class"> { } @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">afterTextChanged</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Editable s)</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(s.toString</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">.trim</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">.length</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params"> &gt; </span></span><span class="hljs-number"><span class="hljs-class"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-class"><span class="hljs-params">)</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">try</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mFullJidDisplay</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setVisibility</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(View.VISIBLE)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jid</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jid</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jid</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fromParts</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(s.toString</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">.toLowerCase</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-class"><span class="hljs-params">, Config.MAGIC_CREATE_DOMAIN, null)</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mFullJidDisplay</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setText</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(getString</span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">(R.string.your_full_jid_will_be, jid.toString</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span><span class="hljs-class"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-class"><span class="hljs-params">)</span></span></span><span class="hljs-class">; } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">catch</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(InvalidJidException e)</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mFullJidDisplay</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setVisibility</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(View.INVISIBLE)</span></span></span><span class="hljs-class">; } } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">else</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mFullJidDisplay</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setVisibility</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(View.INVISIBLE)</span></span></span><span class="hljs-class">; } } }</span></span></code> </pre> </div></div><br><p>  ... triggered by the on_enter event (when the Activity was displayed): </p><br><pre> <code class="python hljs">&lt;StartScreen&gt;: ‚Ä¶ ScreenManager: ‚Ä¶ CreateAccount: on_enter: self._on_enter(action_bar, app, root_manager) ‚Ä¶</code> </pre> <br><p>  We are also interested in the on_text event when the value of the text field changes: </p><br><pre> <code class="python hljs">&lt;CreateAccount&gt;: ‚Ä¶ SingleLineTextField: ‚Ä¶ on_text: app.check_len_login_in_textfield(self)</code> </pre> <br><p>  The check_len_login_in_textfield method from the main application class: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9ff/551/520/9ff551520fcc4daca2d1f01160822392.png"></div><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_len_login_in_textfield</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance_textfield)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#       20 . if len(instance_textfield.text) &gt; 20: instance_textfield.text = instance_textfield.text[:20] #        #      . instance_textfield.message = 'username@conversations.im' \ if instance_textfield.text == '' \ else '{}@conversations.im'.format(instance_textfield.text)</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/cb4/396/358/cb439635873b4ad2b4356b95df65812f.png"></div><br><p>  So, if the text field data is correct, we derive the Activity AddAccount: </p><br><pre> <code class="python hljs">MDFlatButton: ‚Ä¶ on_release: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ‚Ä¶ ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: app.screen_root_manager.current = <span class="hljs-string"><span class="hljs-string">'Add account'</span></span></code> </pre> <br><p>  Otherwise, display a message about incorrect data: </p><br><pre> <code class="python hljs">MDFlatButton: ‚Ä¶ on_release: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> username.text == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> username.text.isspace(): \ snackbar.make(app.data.string_lang_not_valid_username) ‚Ä¶</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/781/297/352/781297352bcc4dceae1d46202811eab8.png"></div><br><p>  Well, and finally, we have the last Activity ... </p><br><p>  Original: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/521/f8e/ff1/521f8eff1d604a1b944c76a11146cdc0.png"></div><br><p>  Kivy: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f8f/269/2e9/f8f2692e9fd94005928b0aab1ca2daba.png"></div><br><p>  Yes, this is one Activity.  From the second, when it is displayed on the screen, we simply programmatically remove the ‚Äúextra‚Äù text field. </p><br><pre> <code class="python hljs">&lt;StartScreen&gt;: ‚Ä¶ ScreenManager: ‚Ä¶ AddAccount: id: add_account on_enter: self._on_enter(action_bar, app) on_leave: action_bar.title = app.data.string_lang_create_account AddAccountOwn: id: add_account_own_provider on_enter: self._on_enter(action_bar, app, root_manager) on_leave: action_bar.title = app.title; action_bar.left_action_items = []</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/7ca/c36/181/7cac36181711460dae6e514c0a89e9ea.png"></div><br><p>  In the markup files, we created Activity templates: </p><br><pre> <code class="python hljs">&lt;AddAccount&gt;: name: <span class="hljs-string"><span class="hljs-string">'Add account'</span></span> AddAccountRoot: id: add_account_root</code> </pre> <br><pre> <code class="python hljs">&lt;AddAccountOwn&gt;: name: <span class="hljs-string"><span class="hljs-string">'Add account own provider'</span></span> AddAccountRoot: id: add_account_root</code> </pre> <br><p> ¬´¬ª   Activity AddAccountRoot: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d12/205/4af/d122054af020424bb0663ceccafdd6e8.png"></div><br><div class="spoiler"> <b class="spoiler_title">Activity AddAccountRoot</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#: kivy 1.9.1 #: import progress libs.uix.dialogs.dialog_progress #: import MDFlatButton kivymd.button.MDFlatButton #: import SingleLineTextField kivymd.textfields.SingleLineTextField #: import MDCheckbox kivymd.selectioncontrols.MDCheckbox # Activity     . &lt;AddAccountRoot@BoxLayout&gt;: canvas: Color: rgba: app.data.background Rectangle: size: self.size pos: self.pos orientation: 'vertical' padding: dp(10), dp(10) BoxLayout: id: box canvas: Color: rgba: app.data.rectangle Rectangle: size: self.size pos: self.pos Color: rgba: app.data.list_color Rectangle: size: self.size[0] - 2, self.size[1] - 2 pos: self.pos[0] + 1, self.pos[1] + 1 orientation: 'vertical' size_hint_y: None padding: dp(10), dp(10) spacing: dp(15) height: app.window.height // 2 SingleLineTextField: id: username hint_text: 'Username' on_text: if self.message != '': app.check_len_login_in_textfield(self) SingleLineTextField: id: password hint_text: 'Password' password: True BoxLayout: id: box_check size_hint_y: None height: dp(40) MDCheckbox: id: check size_hint: None, None size: dp(40), dp(40) active: True on_state: if self.active: box.add_widget(confirm_password) else: box.remove_widget(confirm_password) if username.message != '': confirm_password.hint_text = 'Confirm password' Label: text: 'Register new account on server' valign: 'middle' color: app.data.text_color size_hint_x: .9 text_size: self.size[0] - 10, self.size[1] SingleLineTextField: id: confirm_password password: True Widget: Widget: BoxLayout: padding: dp(0), dp(10) MDFlatButton: text: app.data.string_lang_cancel theme_text_color: 'Primary' on_release: if app.screen.ids.root_manager.current == 'Add account own provider': \ app.screen.ids.root_manager.current = 'Start screen'; \ app.screen.ids.action_bar.title = app.title else: \ app.screen.ids.root_manager.current = 'Create account'; app.screen.ids.action_bar.title = app.data.string_lang_create_account MDFlatButton: text: app.data.string_lang_next on_release: instance_progress, instance_text_wait = \ progress(text_wait=app.data.string_lang_text_wait.format(app.data.text_color_hex), \ events_callback=lambda x: instance_progress.dismiss())</span></span></code> </pre> </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/917/fb4/059/917fb405982444d38fd23aea716be46e.png"></div><br><p>    Kivy   <i>canvas</i> .       ,  :      .   Activity      ,      ,    (  ,     ).  . </p><br><p>       : </p><br><pre> <code class="python hljs">MDCheckbox: ‚Ä¶ on_state: <span class="hljs-comment"><span class="hljs-comment"># True/False ‚Äî /  if self.active: box.add_widget(confirm_password) else: box.remove_widget(confirm_password) ‚Ä¶</span></span></code> </pre> <br><p>  Activity AddAccount   ,       : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.screenmanager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Screen <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddAccount</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Screen)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_on_enter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, instance_toolbar, instance_program)</span></span></span><span class="hljs-function">:</span></span> instance_toolbar.title = self.name self.ids.add_account_root.ids.username.focus = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-comment"><span class="hljs-comment">#      . Clock.schedule_once(instance_program.set_text_on_textfields, .5)</span></span></code> </pre> <br><p>   : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_focus_on_textfield</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, instance_textfield=None, focus=True)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> instance_textfield: instance_textfield.focus = focus <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_text_on_textfields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval)</span></span></span><span class="hljs-function">:</span></span> add_account_root = self.screen.ids.add_account.ids.add_account_root field_username = add_account_root.ids.username field_password = add_account_root.ids.password field_confirm_password = add_account_root.ids.confirm_password field_username.text = self.screen.ids.create_account.ids.username.text.lower() field_password.focus = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> password = self.generate_password() field_password.text = password field_confirm_password.text = password Clock.schedule_once( <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: self.set_focus_on_textfield( instance_textfield=field_password, focus=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>), <span class="hljs-number"><span class="hljs-number">.5</span></span> ) Clock.schedule_once( <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: self.set_focus_on_textfield( instance_textfield=field_username), <span class="hljs-number"><span class="hljs-number">.5</span></span> )</code> </pre> <br><p>  !   Activity ,  ,  .    .     .         ,     Kivy  ,      ,   ,  . </p><br><p>  ,          PyConversations      ,   .  See you! </p><br><p> <a href="https://github.com/HeaTTheatR/PyConversations">PyConversations</a>  github. </p><br></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/314236/">https://habr.com/ru/post/314236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314226/index.html">We continue to check Microsoft projects: PowerShell analysis</a></li>
<li><a href="../314228/index.html">Google learned how to filter fake installations on Android</a></li>
<li><a href="../314230/index.html">Corporate Laboratories - Program Update</a></li>
<li><a href="../314232/index.html">My experience with getting PMP</a></li>
<li><a href="../314234/index.html">5 amazing ways to manage time enjoyed by successful people</a></li>
<li><a href="../314240/index.html">Short and simple about difficult - routing in "8-800"</a></li>
<li><a href="../314242/index.html">Deep Learning for Newbies: Recognize Handwritten Numbers</a></li>
<li><a href="../314248/index.html">PayPal will not come to Ukraine in the next 12 months - NBU</a></li>
<li><a href="../314250/index.html">What makes games funny? Comedy and humor in video games. Part two</a></li>
<li><a href="../314252/index.html">ASP.NET Core: Deploying a web app in Azure App Service using Visual Studio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>