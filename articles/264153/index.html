<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Open Data Analysis in R, Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 At the time of this writing, most applications based on open data (on official data.mos.ru/apps and data.gov.ru ) are interactive guide...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Open Data Analysis in R, Part 1</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  At the time of this writing, most applications based on open data (on official <a href="http://data.mos.ru/apps">data.mos.ru/apps</a> and <a href="http://data.gov.ru/">data.gov.ru</a> ) are interactive guides on the infrastructure of a city or settlement with visual visualization and often with the option of choosing the best route.  The purpose of this and subsequent publications is to draw the attention of the community to the discussion of strategies for analyzing open data, including  aimed at forecasting, building statistical models and extracting information not presented explicitly.  The toolkit uses the R language and the RStudio development environment. <br><a name="habracut"></a><br>  As an illustration of the ease of use of R, we consider a small example and visualize on a map the <a href="http://goo.gl/Mo2DJb">register of the attraction of the Criminal Code, Homeowners Association for 2013 in Ulyanovsk</a> .  This data set contains information about the fines of various management companies.  For visualization, the number of oral remarks, the number of fines and fines in rubles for all time presented in dataset were selected.  This data (as well as all others from open sources that I came across) tends to have a lot of omissions, typos, etc.  therefore, <a href="http://goo.gl/fCnQ4H">pre-processed data is</a> loaded into R: <br><br> <code>ulyanovsk.data &lt;- read.csv('./data/formated_tsj.csv') <br></code> <br><br>  For visualization, an interface to google maps and the ggplot2 library are used; for organizing graphs on an output device, use gridExtra: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  library (ggmap) <br>  library (ggplot2) <br>  library (gridExtra) <br></div></div><br>  In dataset there are lat and lon columns, which contain information about latitude and longitude.  We need a map not of the whole Ulyanovsk but only its parts, the coordinates of which are in the sample: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  box &lt;- make_bbox (lon, lat, data = ulyanovsk.data) <br>  ulyanovsk.map &lt;- get_map (location = 'ulyanovsk', zoom = calc_zoom (box)) <br>  p0 &lt;- ggmap (ulyanovsk.map) <br>  p0 &lt;- p0 + ggtitle (‚ÄúPart of the map of Ulyanovsk‚Äù) + theme (legend.position = ‚Äúnone‚Äù) <br></div></div><br>  Apply to the map penalties in rubles (column penalties_rub_total): <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  p1 &lt;- ggmap (ulyanovsk.map) <br>  p1 &lt;- p1 + geom_point (data = ulyanovsk.data, aes (x = lon, y = lat, color = penalties_rub_total, size = penalties_rub_total)) <br>  p1 &lt;- p1 + scale_color_gradient (low = 'yellow', high = 'red') <br>  p1 &lt;- p1 + ggtitle (‚ÄúFines in rubles‚Äù) + theme (legend.position = ‚Äúnone‚Äù) <br></div></div><br>  The number of fines in units: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  p2 &lt;- ggmap (ulyanovsk.map) <br>  p2 &lt;- p2 + geom_point (data = ulyanovsk.data, aes (x = lon, y = lat, color = penalties_total, size = penalties_total)) <br>  p2 &lt;- p2 + scale_color_gradient (low = 'yellow', high = 'red') <br>  p2 &lt;- p2 + ggtitle (‚ÄúNumber of fines‚Äù) + theme (legend.position = ‚Äúnone‚Äù) <br></div></div><br>  Number of oral remarks in pieces: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  p3 &lt;- ggmap (ulyanovsk.map) <br>  p3 &lt;- p3 + geom_point (data = ulyanovsk.data, aes (x = lon, y = lat, color = oral_comments_total, size = oral_comments_total)) <br>  p3 &lt;- p3 + scale_color_gradient (low = 'yellow', high = 'red') <br>  p3 &lt;- p3 + ggtitle (‚ÄúNumber of oral remarks‚Äù) + theme (legend.position = ‚Äúnone‚Äù) <br></div></div><br>  Building it all together: <br><br> <code>grid.arrange(p0, p1, p2, p3, ncol=2) <br></code> <br><br><img src="https://habrastorage.org/files/79b/0b8/4ae/79b0b84ae93f4a679be5c9892953fab7.png"><br><br>  The size of the point and the value of red monotonously increase with the parameter (for example, the more penalties, the more and red the point).  The graphs show that in the surveyed dataset, management companies from the right bank of Ulyanovsk have more fines and comments than from the left bank. <br><br><h4>  Research statistics crash </h4><br>  This section uses data from a <a href="http://fedstat.ru/indicator/data.do%3Fid%3D36230">single interdepartmental information and statistical system</a> .  Dataset contains the death rate from traffic accidents per 100 thousand people by regions of the Russian Federation for 2011-2014: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  accidents &lt;- read.csv ('./ data / accidents.csv') <br>  head (accidents) <br></div></div><br><br><img src="https://habrastorage.org/files/381/a03/634/381a036341d34f4d8d413a1334cf7b64.png"><br><br>  Average for each year by regions: <br><br> <code>apply(accidents[,2:5],2,FUN = mean) <br></code> <br><br>  ## y2011 y2012 y2013 y2014 <br>  ## 21.36942 21.55694 20.18582 20.34727 <br><br>  Histograms: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  library (reshape2) <br>  accidents.melt &lt;- melt (accidents [, 2: 5]) <br>  ggplot (accidents.melt, aes (x = value, fill = variable)) + geom_histogram (alpha = 0.3) <br></div></div><br><br><img src="https://habrastorage.org/files/200/9eb/81b/2009eb81b9e445458e673eeee9deb645.png"><br><br>  The melt function reorganizes datasets in such a way that the value column stores the value of the indicator, in the variable column the year for which the indicator was obtained: <br><br> <code>head(accidents.melt) <br></code> <br><br><img src="https://habrastorage.org/files/419/0fe/03a/4190fe03a16b43cc9af2bf08706d591d.png"><br><br>  It is interesting to compare whether the difference in indicators for different years is statistically significant.  The following model assumptions are accepted: <br><br>  1) The value of the indicator is a random variable obeying the student's distribution <br>  2) Each year has its own distribution parameters, nu is the normality parameter, sigma is the variance, mu is the average <br>  3) The parameters nu, sigma, mu are also random variables with their own year-independent distributions. <br><br>  Formal statement of the problem: using data to establish whether the distribution parameter mu is different for different years.  If we write out the Bayes formula for our case (which I will not give here, in order not to overload the article), then we get a hierarchical model: <br><br>  1) death rate (field value in accidents.melt) ~ t (mu, sigma, nu) <br>  2) mu |  group_id ~ N (mu_hyp, sigma_hyp) <br>  3) sigma |  group_id ~ Unif (a_hyp, b_hyp | group_id) <br>  4) nu |  group_id ~ Exp (lambda_hyp) <br><br>  Where mu |  group_id ~ N (mu_hyp, sigma_hyp) indicates that the mu parameter for the group_id group has a normal distribution with hyper parameters mu_hyp, sigma_hyp. <br>  The variable group_id takes a value depending on the year, 1 for 2011, 2 for 2012, etc .: <br><br> <code>accidents.melt$group_id &lt;- as.numeric(accidents.melt$variable) <br></code> <br><br>  For modeling, R uses an interface to the Jags language and the auxiliary function plotPost from the file DBDA2E-utilities.R, which can be found <a href="https://goo.gl/RWnmzd">here</a> (by John Kruschke): <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  library (rjags) <br>  source ('DBDA2E-utilities.R') <br></div></div><br><br>  The description of the model takes place in the jags language, therefore, first a file or a string variable is created inside R with the model: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  modelString &lt;- ' <br><br>  model { <br><br>  for (i in 1: N) <br>  { <br><br>  y [i] ~ dt (mu [group_id [i]], 1 / sigma [group_id [i]] ^ 2, nu [group_id [i]]) <br><br>  } <br><br>  for (j in 1: NumberOfGroups) <br>  { <br><br>  mu [j] ~ dnorm (PriorMean, 0.01) <br>  sigma [j] ~ dunif (1E-1, 1E + 1) <br>  nuTemp [j] ~ dexp (1/19) <br>  nu [j] &lt;- nuTemp [j] + 1 <br><br>  } <br><br>  } <br><br>  ' <br></div></div><br><br>  After the model is specified, it is passed to the jags along with the data: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  modelJags &lt;- jags.model (file = textConnection (modelString), <br>  data = list (y = accidents.melt $ value, group_id = accidents.melt $ group_id, N = length (accidents.melt), NumberOfGroups = 4, PriorMean = (20)), <br>  n.chains = 8, n.adapt = 1000) <br></div></div><br><br>  Jags uses MCMC and implements a random walk model in our parameter space mu, sigma, nu.  Moreover, the probability that the parameters will take a specific value is proportional to their joint probability, although the joint probability is not considered explicitly.  Thus, jags returns a list of mu, sigma, nu values, so you can estimate their probabilities using histograms.  The following lines launch our model and return the result: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  update (modelJags, 2000) <br>  summary (samplesCoda &lt;- coda.samples (model = modelJags, variable.names = c ('nu', 'mu', 'sigma'), n.iter = 50000, thin = 500)) <br></div></div><br><br>  To answer our question about the value of the mu parameter for different years, we consider histograms of the difference between the values ‚Äã‚Äãof the parameters: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  samplesCodaMatrix &lt;- as.matrix (samplesCoda) <br>  samplesCodaDataFrame &lt;- as.data.frame (samplesCodaMatrix) <br>  samplesCodaDataFrame &lt;- samplesCodaDataFrame [, 1: 4] <br>  plotPost (samplesCodaMatrix [, 1] - samplesCodaMatrix [, 2], cenTend = 'mean', main = '2011 vs. 2012') <br>  plotPost (samplesCodaMatrix [, 1] - samplesCodaMatrix [, 3], cenTend = 'mean', main = '2011 vs. 2013') <br>  plotPost (samplesCodaMatrix [, 1] - samplesCodaMatrix [, 4], cenTend = 'mean', main = '2011 vs. 2014') <br>  plotPost (samplesCodaMatrix [, 2] - samplesCodaMatrix [, 3], cenTend = 'mean', main = '2012 vs. 2013') <br>  plotPost (samplesCodaMatrix [, 2] - samplesCodaMatrix [, 4], cenTend = 'mean', main = '2012 vs. 2014') <br>  plotPost (samplesCodaMatrix [, 3] - samplesCodaMatrix [, 4], cenTend = 'mean', main = '2013 vs. 2014') <br></div></div><br><br><img src="https://habrastorage.org/files/9d2/7b5/4fd/9d27b54fd7204b7c841b707c8cff8ddd.png"><br><img src="https://habrastorage.org/files/8ba/0dd/201/8ba0dd2019c14bdaad8c8757f89881e3.png"><br><img src="https://habrastorage.org/files/0bf/1a4/56f/0bf1a456f0294c6b88a54df4de206aba.png"><br><img src="https://habrastorage.org/files/7f1/bc9/734/7f1bc97349b74a91bfa4e1793ab6a4b9.png"><br><img src="https://habrastorage.org/files/ea9/ec8/913/ea9ec8913be04a94939f8a364bfd181c.png"><br><img src="https://habrastorage.org/files/6e7/2ec/694/6e72ec694ec240bb8f75e7d92e464657.png"><br><br>  The graphs indicate the HDI interval, the values ‚Äã‚Äãin which have a greater probability than the values ‚Äã‚Äãoutside the interval, and the sum of the probabilities of these values ‚Äã‚Äãis 0.95.  It can be seen that the value 0 falls in HDI, which suggests that the mu parameter is the same for all the years represented in the dataset.  There is a controversial point here - the HDI value is selected according to the knowledge of the subject area, i.e.  perhaps for this task a value of 95% is not the most suitable. </div><p>Source: <a href="https://habr.com/ru/post/264153/">https://habr.com/ru/post/264153/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264139/index.html">Introduction to machine learning: where to start learning and how to apply</a></li>
<li><a href="../264141/index.html">Event-oriented Python backtesting step by step. Part 2</a></li>
<li><a href="../264145/index.html">Clouds in the media service, or How Amazon helps process large volumes of video content</a></li>
<li><a href="../264149/index.html">Tabs on top? Development of the new interface Yandex. Browser</a></li>
<li><a href="../264151/index.html">Targeted attacks: China has attacked more than 600 objects in the USA in the last 5 years</a></li>
<li><a href="../264155/index.html">Exchange 2013 transport queue is no longer a single mailing point</a></li>
<li><a href="../264157/index.html">Ignore extra function arguments in C ++.</a></li>
<li><a href="../264159/index.html">Yii 2.0.6</a></li>
<li><a href="../264161/index.html">Large apartment of 20 sq.m. - with augmented reality glasses it is possible</a></li>
<li><a href="../264163/index.html">10 rules of good tone when describing bugs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>