<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing of radio modems LoRa / LoRaWAN RN2483. Part 2, LoRaWAN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The previous part explained how to connect RN2483 modems in LoRa mode. We now turn to the next, more difficult part - connecting to the LoRaWAN networ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing of radio modems LoRa / LoRaWAN RN2483. Part 2, LoRaWAN</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://geektimes.ru/post/281286/">The previous part</a> explained how to connect RN2483 modems in LoRa mode.  We now turn to the next, more difficult part - connecting to the LoRaWAN network. <br><br><h3>  What is LoRaWAN? </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fbc/821/466/fbc8214665cb4bfb94e1c75021ec502b.png"></div><br>  LoRaWAN is a ‚Äúconditionally global‚Äù network consisting of end nodes (nodes) that send data to a hub (gateway).  Each hub has access to the Internet, and sends the received data to the server, which in turn sends them to the subscribed clients.  The network, on the one hand, is ‚Äúglobal‚Äù because  data can be received by any nearby gateway, on the other hand, it is ‚Äúconditionally global‚Äù because  without Internet / Intranet, it will not work anyway (although no one bothers to have its own gateway and server within the organization). <br><br>  The RN2483 modem will be used as a ‚Äúnode‚Äù, a free <a href="https://www.thethingsnetwork.org/">service</a> will be used to connect.  Continued under the cut. <br><a name="habracut"></a><br><h3>  The Things Network </h3><br>  The <a href="https://www.thethingsnetwork.org/">www.thethingsnetwork.org</a> service is an open community whose users can create, register devices and hubs, experiment with how it all works, etc.  As they say, free and without SMS.  We will use them for testing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Anyone can register both node and gateway on the network.  The Things Network is completely free, many enthusiasts buy equipment at their own expense. <br>  Coverage map at the time of this writing is as follows: <br><br><img src="https://habrastorage.org/files/18f/37b/249/18f37b249adb417193d8a3c679287cf0.png"><br><br>  As you can see, the Russian segment of coverage leaves much to be desired, but it is still there.  There is a positive side to this - in London or Amsterdam, the new hub will not surprise anyone, but in Russia there is a chance to be the first. <br><br><h3>  Connection RN2483 to LoRaWAN </h3><br>  Unlike simple p2p connections, everything in LoRaWAN is much more complicated - devices are registered on the network, traffic is encrypted with various keys, and so on.  Since  the network is public and public, data protection issues are very relevant here. <br><br>  There are 2 types of authentication in the LoRaWAN network: <br><br>  - Authentication "by air" ( <b>OTAA</b> , Over-the-Air Activation).  Devices register with the network and get the key needed for operation. <br>  - Activation of <b>ABP</b> (Activation by Personalization).  Settings are pre-registered in the device, additional authentication is not required.  This mode is simpler, but there is a minus - the data is simply sent on the air, there is no guarantee that they were received by the hub. <br><br>  <b>Important</b> : many cheap single-channel hubs support only ABP mode, so the first method may not work. <br><br><h3>  1. Device Registration - OTAA </h3><br>  The first thing to do is to go to <a href="https://staging.thethingsnetwork.org/">staging.thethingsnetwork.org</a> and register an ‚Äúapplication‚Äù.  I called it Raspberry Pi Home.  When registering the application, the user receives the first key, which is useful later. <br><br><img src="https://habrastorage.org/files/b33/8a7/790/b338a779084444d193521ef6ce945d04.png"><br><br>  Next, we see the Devices tab, where you can add our modem (there may be several).  Click "register device" and select the OTAA mode.  A window appears in which you need to enter the device ID. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f23/d56/979/f23d5697934245b7abffe51bb831a4e1.png"></div><br>  This identifier can be obtained by sending the sys get hweui command to the modem.  At this registration is completed, as promised, free of charge and without SMS. <br><br>  Having opened the device parameters, you can see all the keys, you need to register them in the program. <br><br><img src="https://habrastorage.org/files/9f0/8c4/8ff/9f08c48ff5a54bb7a8bc13086b1815ef.png"><br><br>  To simplify the code, I used the <a href="https://github.com/rpp0/python-loranode">python-loranode library</a> , the source code for sending data is shown below.  As you can see, the code has 3 lines appkey, appeui and deveui, which are used for authentication. <br><br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> loranode <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RN2483Controller <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> commands <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-comment"><span class="hljs-comment"># LoRaController OTAA based join and message test if __name__ == "__main__": set_debug_level(Level.DEBUG) port = "COM3" appkey = "58FF3007CAED02xxxxxxxxxxxxxxxxxxxx" appeui = "70B3D57Exxxxxxxxxxxxxx" deveui = "0004A30xxxxxxxxxxx" # Test controller lc = RN2483Controller(port) if lc.test(): printd("[+] Connected to LoRa RN2483 device", Level.INFO) lc.serial_sr(CMD_GET_VERSION) lc.serial_sr(CMD_GET_HWEUI) lc.get_freq() else: printd(clr(Color.YELLOW, "[-] Failed to get version from LoRa device"), Level.WARNING) lc.set_pwr(15) lc.set_adr(False) lc.serial_sr(CMD_SET_SF, "sf7") # sf12, sf7 # Join and send a message if lc.join_otaa(appkey, appeui, deveui): printd("[+] Connected to gateway", Level.INFO) # Data-1 printd("[+] Sending packet #1", Level.INFO) timeStr = time.strftime("%H%M", time.gmtime()) if lc.send(timeStr, ack=False): printd(clr(Color.GREEN, "[+] Send-1 succeeded"), Level.CRITICAL) else: printd(clr(Color.RED, "[+] Send-1 failed"), Level.CRITICAL) time.sleep(15) # Data-2 printd("[+] Sending packet #2", Level.INFO) timeStr = time.strftime("%H%M", time.gmtime()) if lc.send(timeStr, ack=False): printd(clr(Color.GREEN, "[+] Send-2 succeeded"), Level.CRITICAL) else: printd(clr(Color.RED, "[+] Send-2 failed"), Level.CRITICAL) time.sleep(15) del lc exit() del lc printd(clr(Color.RED, "[-] Test failed"), Level.CRITICAL)</span></span></code> </pre> <br></div></div><br>  In this example, packets containing the current time (hhmm) are sent to the server.  This is convenient for controlling which packet was received. <br><br><h3>  2. Device Registration - ABP </h3><br>  Everything is easier here - we register the device as ABP, and we get several keys that need to be registered in the program. <br><br><img src="https://habrastorage.org/files/751/7d9/eb7/7517d9eb74f44a0a8ab6c608c7adc63f.png"><br><br>  The modem sends the data "as is", there is no guarantee that the authentication was successful. <br><br>  To send data, you need to insert the keys nwkskey, appskey, devaddr into the code.  The source code is below. <br><br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> loranode <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RN2483Controller <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> platform <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> commands <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-comment"><span class="hljs-comment"># LoRaController ABP based join and ACK test if __name__ == "__main__": set_debug_level(Level.DEBUG) port = "COM3" nwkskey = "58AA52E96035Axxxxxxxxxxxxxxxxxxxx" appskey = "381B1C9206E9BE9xxxxxxxxxxxxxxxxxxx" devaddr = "B639xxxx" lc = None try: # Test controller lc = RN2483Controller(port) if lc.test(): printd("[+] Connected to LoRa RN2483 device", Level.INFO) lc.serial_sr(CMD_GET_VERSION) lc.serial_sr(CMD_GET_HWEUI) lc.get_freq() else: printd(clr(Color.YELLOW, "[-] Failed to get version from LoRa device"), Level.WARNING) except Exception, e: print "Error: " + str(e) if lc is None: printd(Color.YELLOW, "Error: cannot connect to device") exit() lc.set_adr(False) lc.set_pwr(15) lc.serial_sr(CMD_MAC_PAUSE) lc.serial_sr(CMD_SET_SF, "sf12") # sf12, sf7 lc.serial_sr(CMD_MAC_RESUME) # Join and send a message if lc.join_abp(nwkskey, appskey, devaddr): printd("[+] Connected to gateway", Level.INFO) # Data-1 printd("[+] Sending packet #1", Level.INFO) timeStr = time.strftime("%H%M", time.gmtime()) if lc.send(timeStr, ack=False): printd(clr(Color.GREEN, "[+] Send-1 succeeded"), Level.CRITICAL) else: printd(clr(Color.RED, "[+] Send-1 failed"), Level.CRITICAL) time.sleep(15) # Data-2 printd("[+] Sending packet #2", Level.INFO) timeStr = time.strftime("%H%M", time.gmtime()) if lc.send(timeStr, ack=False): printd(clr(Color.GREEN, "[+] Send-2 succeeded"), Level.CRITICAL) else: printd(clr(Color.RED, "[+] Send-2 failed"), Level.CRITICAL) time.sleep(15) del lc exit() printd(clr(Color.RED, "[-] Test failed"), Level.CRITICAL) del lc</span></span></code> </pre><br></div></div><br><h3>  Testing </h3><br>  The last step, one thing remains - take a laptop (or Arduino or Raspberry Pi) with a modem with you and go (go, fly) to the place where the coverage area of ‚Äã‚Äãthe nearest gateway is located.  I get to the nearest coverage area about half an hour by tram, so the process is not so long and expensive. <br><br>  In case of successful data reception, the packets will be displayed on the server. <br><br><img src="https://habrastorage.org/files/359/4fe/106/3594fe1069394a35a4f06ca59775b5e2.png"><br><br>  The server itself does not do anything with the data; you can configure your own code on the server to process the received data.  This example is only a test, nothing is done with the data, in a real application they can be added to the database, send notifications, etc., it all depends on the task. <br><br><h3>  Why is this necessary? </h3><br>  Ideally, the LoRaWAN network provides the user with a ready-to-use data transfer service that works out of the box. Just connect the device and the data will be sent and processed by the nearest hub (of course, if the user is within the network coverage area).  Applications are quite extensive, from sensors opening the door, temperature or water level in the country, to the gps beacon on an animal or model aircraft. <br><br>  Several videos (in English). <br><br>  LoRa Alliance Introduction: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2Y0bMX3TVi0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  The Things Network Introduction: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VEvopr1FLtw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  However, if we talk about The Things Network, then this is an "amateur" service, which of course does not guarantee a permanent connection.  Whether there are commercial providers LoRaWAN, I still do not know. <br><br><h3>  What to do if there is no coverage? </h3><br>  A quite reasonable question may arise - what to do if the nearest gateway is a couple of days by train or a couple of hours by plane?  This is a plus - you can be the first.  You can create your own gateway and register it on The Things Network server, the issue price varies depending on the functionality - from&gt; 1000EUR for ‚Äúbranded‚Äù multi-channel hubs, up to $ 15 for homemade devices based on SX1276 and Raspberry Pi.  <a href="https://www.loriot.io/lora-gateways.html">There</a> is a comparative table of different routers, those who wish can study it in more detail. <br><br>  The last option will be discussed in the next section. </div><p>Source: <a href="https://habr.com/ru/post/398247/">https://habr.com/ru/post/398247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../398235/index.html">Ask Ethan # 97: Can moons have moons?</a></li>
<li><a href="../398239/index.html">HyperX on Igromir: Answers to Questions</a></li>
<li><a href="../398241/index.html">Asgardia: the first nation to live in space</a></li>
<li><a href="../398243/index.html">How and why music services form playlists.</a></li>
<li><a href="../398245/index.html">Choosing a phono stage - to each his own</a></li>
<li><a href="../398251/index.html">Solving puzzles only helps in solving puzzles</a></li>
<li><a href="../398253/index.html">Review of the game cloud services market</a></li>
<li><a href="../398255/index.html">Xiaomi Redmi Note 4: Affordable SmartPad</a></li>
<li><a href="../398257/index.html">Kick NOW! Trends in crowdfunding, part 1</a></li>
<li><a href="../398259/index.html">Fallout 1.5: Resurrection: game post-apocalypse, as it should be</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>