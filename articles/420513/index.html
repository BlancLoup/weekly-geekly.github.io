<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pirated copy of paid service in 39 lines of Python code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During the execution of the order for the development of the telegram bot I had the need to get a screenshot of the web page with its delivery to the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pirated copy of paid service in 39 lines of Python code</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/2k/pa/4e/2kpa4ew2ifrgrf9ud9smiewelkk.png" alt="image"><br>  During the execution of the order for the development of the telegram bot I had the need to get a screenshot of the web page with its delivery to the user.  Why think about solving a problem when you can find it?  As it turned out, not to pay!  More sweat cut. </p><a name="habracut"></a><br><p>  So, fate pushed me to the service <a href="https://www.url2png.com/">url2png</a> .  It seems to be cool: you register, you get an API token and make yourself requests.  But no matter how. </p><br><p><img src="https://habrastorage.org/webt/du/qy/1q/duqy1qon5sovh3ngem-htbt9pvi.png" alt="image"></p><br><p>  No, well, seriously, VDS for a <strong>few</strong> telegrams bots is cheaper!  And then it became clear to me that I would have to get out with all available means.  It did not take long to wrestle, since such a thing as <a href="https://pypi.org/project/selenium/">Selenium was found</a> .  Selenium requires the installation of a special driver in accordance with the browser used.  I warn you that PhantomJS is no longer supported by Selenium, so google chrome will be used to work in headless mode (when the webdriver starts up, the browser window does not open).  How to configure for this vds?  First of all, you need to install the browser itself.  In the console you need to enter the following commands. </p><br><pre><code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -y chromium-browser</code> </pre> <br><p>  After <a href="https://sites.google.com/a/chromium.org/chromedriver/downloads">this link</a> you need to find out the latest version of chromedriver (2.41 at the moment).  You need to install it with the following commands. </p><br><pre> <code class="hljs perl">wget https:<span class="hljs-regexp"><span class="hljs-regexp">//chromedriver</span></span>.storage.googleapis.com/<span class="hljs-number"><span class="hljs-number">2.41</span></span>/chromedriver_linux64.zip unzip chromedriver_linux64.zip sudo mv chromedriver /usr/bin/chromedriver sudo <span class="hljs-keyword"><span class="hljs-keyword">chown</span></span> root:root /usr/bin/chromedriver sudo <span class="hljs-keyword"><span class="hljs-keyword">chmod</span></span> +<span class="hljs-keyword"><span class="hljs-keyword">x</span></span> /usr/bin/chromedriver</code> </pre> <br><p>  I would also like to note that to debug the telegram bot on your machine will have to install a VPN if you are in Russia.  Now you can start developing the bot.  Libraries will be needed: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">pytelegrambotapi</span></span> selenium validators</code> </pre> <br><p>  You can install them safely using pip.  The beginning of the script looks like this. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- import telebot import os import validators from selenium import webdriver</span></span></code> </pre> <br><p>  First, I created a bot and set up a browser to work in headless mode. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  token = 'token of this bot' bot = telebot.TeleBot(token, threaded = False) #      headless  options = webdriver.ChromeOptions() options.add_argument('--headless') options.add_argument('--disable-gpu') options.add_argument('--disable-dev-shm-usage') options.add_argument('--no-sandbox')</span></span></code> </pre> <br><p>  Then he released a greeting and user assistance. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   /start  /help @bot.message_handler(commands=['start']) def hello_user(message): bot.send_message(message.chat.id, 'Hello, ' + message.from_user.username + "!") @bot.message_handler(commands=['help']) def show_help(message): bot.send_message(message.chat.id, 'To get screenshot of webpage use command /getpng.\nExample: /getpng https://www.google.com')</span></span></code> </pre> <br><p>  The most important thing is to get a screenshot.  Using the validators library, the validation (sorry for the tautology) of the link entered by the user is performed.  Also, using the os module, the screenshot is deleted from the server after sending, in order not to take up space. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     selenium  headless chrome @bot.message_handler(commands=['getpng']) def get_screenshot(message): uid = message.chat.id url = "" try: url = message.text.split(' ')[1] except IndexError: bot.send_message(uid, 'You have not entered URL!') return if not validators.url(url): bot.send_message(uid, 'URL is invalid!') else: photo_path = str(uid) + '.png' driver = webdriver.Chrome(chrome_options = options) driver.set_window_size(1280, 720) driver.get(url) driver.save_screenshot(photo_path) bot.send_photo(uid, photo = open(photo_path, 'rb')) driver.quit() os.remove(photo_path)</span></span></code> </pre> <br><p>  Run the bot and check its work! </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  if __name__ == '__main__': bot.infinity_polling()</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/qd/w9/pt/qdw9pt3xbv14j7zzz_moquujqb4.png" alt="image"></p><br><p>  As you can see, everything works great.  Of course, all sorts of buns can be improved, but I set a goal to build a foundation and reached it.  Actually, the <a href="http://t.me/urltopngbot">link to the bot</a> for those who wish and to the <a href="https://github.com/Stepami/UrlToPngBot/blob/master/UrlToPngBot/UrlToPngBot.py">githab repository</a> for those interested.  In the meantime, all good, see you in the following publications! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/420513/">https://habr.com/ru/post/420513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420503/index.html">JS Developer Day, different cities and communities - one holiday</a></li>
<li><a href="../420505/index.html">Will OpenAI Five win the professional team at The International?</a></li>
<li><a href="../420507/index.html">Reference: global Internet for all and its creators</a></li>
<li><a href="../420509/index.html">Unobvious problem of using assert</a></li>
<li><a href="../420511/index.html">Work as an IT specialist in the Far East - Amur Region</a></li>
<li><a href="../420515/index.html">Diarization based on GMM-UBM model and MAP adaptation algorithm</a></li>
<li><a href="../420517/index.html">Implementation of integer FFT on the FPGA</a></li>
<li><a href="../420519/index.html">Popularization of science</a></li>
<li><a href="../420521/index.html">Now officially: TLS 1.3 is recognized as standard</a></li>
<li><a href="../420523/index.html">Analysis of binary options charts or how I once again proved to myself that freebies do not exist</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>