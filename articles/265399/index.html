<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Riak and Riak Search Yokozuna: First acquaintance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article describes the process of creating a simple repository of simple text documents based on Riak version 2.1.1 and organizing a search for the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Riak and Riak Search Yokozuna: First acquaintance</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/459/f23/cff/459f23cff564449389a03f1f2093226e.png"><br><br>  The article describes the process of creating a simple repository of simple text documents based on Riak version 2.1.1 and organizing a search for them using Riak Search (Yokozuna).  The <a href="https://github.com/basho/riak-erlang-client/">official client for Erlang is</a> used as the client library. <br><br>  To begin with, imagine that we have a huge number of such documents: <br><ul><li>  title - title; </li><li>  body - content; </li><li>  tags - tags; </li><li>  created_at - creation time; </li><li>  smiles - the number of emoticons (plus signs, likes, whatever you want) </li></ul><br>  and a huge number of users who want to change them.  Who cares, let's start. <br><a name="habracut"></a><br>  I mean that readers already have some idea of ‚Äã‚ÄãRiak.  If not, it is better to first read <a href="http://eax.me/riak/">here</a> and <a href="http://habrahabr.ru/post/75202/">here</a> , or, of course, <a href="http://docs.basho.com/riak/latest/">official documentation</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Installation and Initial Setup </h3><br>  Java must be installed on the system to run Riak Search.  You can install Riak itself into OSX through Homebrew, and Erlang, if required, will be installed automatically: <br><pre><code class="bash hljs">brew install riak</code> </pre> <br>  For our learning goals, it makes no sense to deploy a whole cluster, you can limit to only one node, so before starting you will need to perform only the minimum setting.  In the config, you need to activate Riak Search: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">## To enable Search set this 'on'. ## ## Default: off ## ## Acceptable values: ## - on or off search = on</span></span></code> </pre><br>  If Riak is installed using Homebrew, then the config is here - /usr/local/Cellar/riak/2.1.1/libexec/etc/riak.conf <br><br>  You will also need to increase the limit on open files, if this is not done, a warning will be displayed at startup.  In OSX Yosemite, I did this: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> kern.maxfiles=65536 &gt;&gt; /etc/sysctl.conf <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> kern.maxfilesperproc=65536 &gt;&gt; /etc/sysctl.conf sudo sysctl -w kern.maxfiles=65536 sudo sysctl -w kern.maxfilesperproc=65536 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ulimit</span></span> -n 65536 65536 &gt;&gt; ~/.bash_profile <span class="hljs-built_in"><span class="hljs-built_in">ulimit</span></span> -n 65536 65536</code> </pre><br>  Now you can run Riak: <br><pre> <code class="bash hljs">riak console</code> </pre><br>  And you can test from another shell session: <br><pre> <code class="bash hljs">riak-admin <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>  The answer should be something like this: Successfully completed 1 read / write cycle to 'riak@127.0.0.1' <br><br><h4>  More about installation and settings: </h4><br><ul><li>  <a href="http://eax.me/riak-install/">Notes Programmer - Memo by Riak</a> ; </li><li>  <a href="http://docs.basho.com/riak/latest/quickstart/">Riak Docs - Five-Minute Install</a> </li></ul><br><h3>  Riak Data Types </h3><br>  Eventually Consistent repositories to which Riak belongs, allow the emergence of so-called.  Data inconsistent situations where the contents of the same key on different replicas is different.  Depending on the settings, Riak may try to resolve conflicts by using vector clocks or timestamps, or shift the responsibility to determine the correct version of the value to the application, giving it all available versions (siblings).  In a real situation, if your documents will be edited in multi-user mode and replicated to several nodes, merge conflict data can become a very difficult task.  In this case, perhaps the best solution would be to use Riak Data Types (also known as <abbr title="Convergent Replicated Data Types">CRDT</abbr> ).  This technology allows you to describe data using special types that will take on the solution of the problem of cluster data convergence and will free the application from the obligations to resolve conflicts. <br><br>  Riak Data Types, currently, implement the following five types of CRDT: <br><ul><li>  flag - Bit flag.  Available operations - remove, install.  Can only be used inside the map; </li><li>  counter - counter.  Available operations - increase, decrease.  Also can only be used inside the map; </li><li>  register - Any value (stored as a string); </li><li>  set - Set of values.  Available operations - add item, delete item; </li><li>  map - Container for other types.  Allows you to store within yourself flags, counters, registers, sets and nested maps.  Available operations - add a field, delete a field, and also operations for internal fields corresponding to their types </li></ul><br>  In accordance with these types, we will present our documents as a map with the following structure: <br><ul><li>  title - register; </li><li>  tags - set; </li><li>  body - register; </li><li>  created_at - register; </li><li>  smiles - counter </li></ul><br>  Create and activate a bucket-type called documents-type to store our documents: <br><pre> <code class="bash hljs">riak-admin bucket-type create documents-type <span class="hljs-string"><span class="hljs-string">'{"props":{"datatype":"map"}}'</span></span> riak-admin bucket-type activate documents-type</code> </pre><br><h4>  More information on Eventually Consistent, Riak Data Types and CRDT: </h4><br><ul><li>  <a href="http://docs.basho.com/riak/latest/theory/concepts/Eventual-Consistency/">Riak Docs - Eventual Consistency</a> ; </li><li>  <a href="http://docs.basho.com/riak/latest/dev/using/conflict-resolution/">Riak Docs - Conflict Resolution</a> ; </li><li>  <a href="http://docs.basho.com/riak/latest/theory/concepts/crdts/">Riak Docs - Data Types</a> ; </li><li>  <a href="http://hal.upmc.fr/file/index/docid/555588/filename/techreport.pdf">A comprehensive study of</a> <a href="http://hal.upmc.fr/file/index/docid/555588/filename/techreport.pdf"><br></a>  <a href="http://hal.upmc.fr/file/index/docid/555588/filename/techreport.pdf">Convergent and Commutative Replicated Data Types - Shapiro, Pregui√ßa, Baquero, and Zawirski</a> </li></ul><br><h3>  Riak Search </h3><br>  We want to implement a search of our documents by tags, by title, by date of creation and by content.  To do this, we will use the technology Riak Search, codenamed Yokozuna, which is essentially an intermediary between the Riak repository and the <a href="http://lucene.apache.org/solr/">Apache Solr</a> search engine.  Yokuzuna itself launches and monitors on each cluster node a separate JVM process with Solr, passes on to it search queries and changes in data. <br><br>  In order for Solr to know how to index our documents, we need to create a search scheme.  In general, Riak Search has a default scheme for all occasions - <a href="">_yz_default</a> , which is convenient to use during development, but for the working environment it is better to create your own. <br><br>  Since the data structure we have already defined, we will create a scheme immediately.  In the scheme, you need to list the fields of the document, for each of them specify the type, whether it is necessary to build an index on it and store its values, then to return them to the search results.  Also in the scheme it is necessary to include the service fields Riak Search.  It should be noted that when using Riak Data Types, a suffix corresponding to their type is added to the field names.  Thus, we get the following description: <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title_register"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fase"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"body_register"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text_ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tags_set"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"created_at_register"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tdate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">omitNorms</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Under the spoiler, the full contents of the file with the scheme: <br><div class="spoiler">  <b class="spoiler_title">docs_seacrh_schema.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"schedule"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.5"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title_register"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fase"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"body_register"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text_ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tags_set"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"created_at_register"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tdate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">omitNorms</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dynamicField</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ignored"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    Riak Search--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_ed"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_pn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_fpn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_vtag"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_rk"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_rt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_rb"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_err"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uniqueKey</span></span></span><span class="hljs-tag">&gt;</span></span>_yz_id<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uniqueKey</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">types</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.StrField"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sortMissingLast</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tdate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.TrieDateField"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">precisionStep</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"6"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">positionIncrementGap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sortMissingLast</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text_ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.TextField"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">positionIncrementGap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">analyzer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tokenizer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.StandardTokenizerFactory"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.LowerCaseFilterFactory"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.StopFilterFactory"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ignoreCase</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">words</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lang/stopwords_ru.txt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">format</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"snowball"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.SnowballPorterFilterFactory"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Russian"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- less aggressive: &lt;filter class="solr.RussianLightStemFilterFactory"/&gt; --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">analyzer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldtype</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ignored"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stored</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiValued</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.StrField"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- YZ String: Used for non-analyzed fields --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_yz_str"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"solr.StrField"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sortMissingLast</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">types</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">schema</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><h4>  Details on Riak Search: </h4><br><ul><li>  <a href="http://docs.basho.com/riak/latest/dev/using/search/">Riak Docs - Using Search</a> ; </li><li>  <a href="http://docs.basho.com/riak/latest/dev/advanced/search/">Riak Docs - Search Details</a> ; </li><li>  <a href="http://docs.basho.com/riak/latest/dev/search/search-data-types/">Riak Docs - Riak Data Types and Search</a> ; </li><li>  <a href="http://docs.basho.com/riak/latest/dev/advanced/search-schema/">Riak Docs - Search Schema</a> ; </li><li>  <a href="https://cwiki.apache.org/confluence/display/solr/Documents%252C%2BFields%252C%2Band%2BSchema%2BDesign">Apache Solr Reference Guide - Documents, Fields, and Schema Design</a> </li></ul><br><h3>  Access to Riak from Erlang </h3><br>  It's time to finally connect to our node with the help of a client for Erlang: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    : git clone https://github.com/basho/riak-erlang-client.git cd riak-erlang-client/ make cd .. #  REPL: erl -pa riak-erlang-client/ebin riak-erlang-client/deps/*/ebin</span></span></code> </pre><br>  Connect <br><pre> <code class="erlang_repl hljs erlang-repl">{ok, RiakPid} = riakc_pb_socket:start_link(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-number"><span class="hljs-number">8087</span></span>). <span class="hljs-comment"><span class="hljs-comment">%   pong = riakc_pb_socket:ping(RiakPid).</span></span></code> </pre><br>  Create a search schema and index <br><pre> <code class="erlang_repl hljs erlang-repl">{ok, Schema} = file:read_file(<span class="hljs-string"><span class="hljs-string">"docs_search_schema.xml"</span></span>). ok = riakc_pb_socket:create_search_schema(RiakPid, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-schema"</span></span>&gt;&gt;, Schema). ok = riakc_pb_socket:create_search_index(RiakPid, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-index"</span></span>&gt;&gt;, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-schema"</span></span>&gt;&gt;, []).</code> </pre><br>  Create a bucket and assign a search index <br><pre> <code class="erlang_repl hljs ruby">ok = <span class="hljs-symbol"><span class="hljs-symbol">riakc_pb_socket:</span></span>set_search_index(RiakPid, {&lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-type"</span></span><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;</span></span>, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-bucket"</span></span>&gt;&gt;}, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-index"</span></span>&gt;&gt;).</code> </pre><br>  Create a new document <br><pre> <code class="erlang_repl hljs sql">Map = riakc_map:new(). %   -  (register) Map1 = riakc_map:<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>({&lt;&lt;<span class="hljs-string"><span class="hljs-string">"title"</span></span>&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">register</span></span>}, fun(Reg) -&gt; riakc_register:<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(&lt;&lt;<span class="hljs-string"><span class="hljs-string">"DocumentTitle"</span></span>&gt;&gt;, Reg) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Map</span></span>). %   -   (<span class="hljs-keyword"><span class="hljs-keyword">register</span></span>) Map2 = riakc_map:<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>({&lt;&lt;<span class="hljs-string"><span class="hljs-string">"body"</span></span>&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">register</span></span>}, fun(Reg) -&gt; riakc_register:<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Some Document Body"</span></span>&gt;&gt;, Reg) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, Map1). %  -  (<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>) Map3 = riakc_map:<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>({&lt;&lt;<span class="hljs-string"><span class="hljs-string">"tags"</span></span>&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>}, fun(<span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>) -&gt; Set1 = riakc_set:add_element(&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Tag One"</span></span>&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>), Set2 = riakc_set:add_element(&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Tag Two"</span></span>&gt;&gt;, Set1), Set2 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, Map2). %   -  (<span class="hljs-keyword"><span class="hljs-keyword">register</span></span>) Map4 = riakc_map:<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>({&lt;&lt;<span class="hljs-string"><span class="hljs-string">"created_at"</span></span>&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">register</span></span>}, fun(Reg) -&gt; % C   Solr      ISO8601. % https://cwiki.apache.org/confluence/display/solr/Working+<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>+Dates. ISODateFmtStr = <span class="hljs-string"><span class="hljs-string">"~4.10.0B-~2.10.0B-~2.10.0BT~2.10.0B:~2.10.0B:~2.10.0BZ"</span></span>, {{<span class="hljs-keyword"><span class="hljs-keyword">Year</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Month</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Day</span></span>}, {<span class="hljs-keyword"><span class="hljs-keyword">Hour</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Min</span></span>, Sec}} = calendar:universal_time(), ISODate = list_to_binary(io_lib:<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>(ISODateFmtStr, [<span class="hljs-keyword"><span class="hljs-keyword">Year</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Month</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Day</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Hour</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Min</span></span>, Sec])), riakc_register:<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(ISODate, Reg) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, Map3). %         MapOperations = riakc_map:to_op(Map4). ok = riakc_pb_socket:update_type(RiakPid, {&lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-type"</span></span>&gt;&gt;, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-bucket"</span></span>&gt;&gt;}, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"DocumentKey"</span></span>&gt;&gt;, MapOperations).</code> </pre><br>  Find and get the documents <br><pre> <code class="erlang_repl hljs kotlin">%    Riak Client. rr(<span class="hljs-string"><span class="hljs-string">"riak-erlang-client/include/riakc.hrl"</span></span>). %     ,     {ok, Results} = riakc_pb_socket:search(RiakPid, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-index"</span></span>&gt;&gt;, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"title_register:DocumentTitle AND tags_set:\"Tag One\" AND body_register:Some AND created_at_register:[1972-05-20T17:33:18Z TO NOW]"</span></span>&gt;&gt;). %   Docs = Results#search_results.docs. lists:foldr(<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({_Index, Doc}, Acc)</span></span></span></span> -&gt; {_, DocumentId} = lists:keyfind(&lt;&lt;<span class="hljs-string"><span class="hljs-string">"_yz_rk"</span></span>&gt;&gt;, <span class="hljs-number"><span class="hljs-number">1</span></span>, Doc), {ok, {map, Image, _, _, _}} = riakc_pb_socket:fetch_type(RiakPid, {&lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-type"</span></span>&gt;&gt;, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-bucket"</span></span>&gt;&gt;}, DocumentId), Image end, [], Docs).</code> </pre><br>  Change the document <br><pre> <code class="erlang_repl hljs kotlin">riakc_pb_socket:modify_type(RiakPid, <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map)</span></span></span></span> -&gt; %   UpdatedMap1 = riakc_map:update({&lt;&lt;<span class="hljs-string"><span class="hljs-string">"body"</span></span>&gt;&gt;, register}, <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Register)</span></span></span></span> -&gt; riakc_register:<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(&lt;&lt;<span class="hljs-string"><span class="hljs-string">" "</span></span>&gt;&gt;, Register) end, Map), %   UpdatedMap2 = riakc_map:update({&lt;&lt;<span class="hljs-string"><span class="hljs-string">"tags"</span></span>&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>}, <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Set)</span></span></span></span> -&gt; riakc_set:del_element(&lt;&lt;<span class="hljs-string"><span class="hljs-string">"Tag One"</span></span>&gt;&gt;, Set) end, UpdatedMap1), %  <span class="hljs-number"><span class="hljs-number">10</span></span>  UpdatedMap3 = riakc_map:update({&lt;&lt;<span class="hljs-string"><span class="hljs-string">"smiles"</span></span>&gt;&gt;, counter}, <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fun</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Counter)</span></span></span></span> -&gt; riakc_counter:increment(<span class="hljs-number"><span class="hljs-number">10</span></span>, Counter) end, UpdatedMap2), UpdatedMap3 end, {&lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-type"</span></span>&gt;&gt;, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-bucket"</span></span>&gt;&gt;}, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"DocumentKey"</span></span>&gt;&gt;, []). %  riakc_pb_socket:search(RiakPid, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"documents-index"</span></span>&gt;&gt;, &lt;&lt;<span class="hljs-string"><span class="hljs-string">"body_register:\"\""</span></span>&gt;&gt;).</code> </pre><br>  Delete the document <br><pre> <code class="erlang_repl hljs pgsql">riakc_pb_socket:<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>(RiakPid, {&lt;&lt;"documents-type"&gt;&gt;, &lt;&lt;"documents-bucket"&gt;&gt;}, &lt;&lt;"DocumentKey"&gt;&gt;). %  riakc_pb_socket:<span class="hljs-keyword"><span class="hljs-keyword">search</span></span>(RiakPid, &lt;&lt;"documents-index"&gt;&gt;, &lt;&lt;"body_register:\"\""&gt;&gt;).</code> </pre><br><h4>  More information on working with the client library: </h4><br><ul><li>  <a href="">Riak Protocol Buffers Client Introduction</a> </li><li>  <a href="http://docs.basho.com/riak/latest/dev/using/data-types/">Riak Docs - Using Data Types</a> </li><li>  <a href="http://docs.basho.com/riak/latest/dev/using/basics/">Riak Docs - The Basics</a> </li></ul><br>  That's all for now.  If this article is useful, then next time I will write about how to do this for all of this web-interface based on cowboy. </div><p>Source: <a href="https://habr.com/ru/post/265399/">https://habr.com/ru/post/265399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265389/index.html">How to feed cats. Manual for programmers leading other programmers</a></li>
<li><a href="../265391/index.html">Ruby on Rails and interaction with REST Qiwi Shop</a></li>
<li><a href="../265393/index.html">Why do routine work when it can be charged to a car?</a></li>
<li><a href="../265395/index.html">Development of browser online games on meteor</a></li>
<li><a href="../265397/index.html">RailsClub 2015: Interview with Sam Pippen</a></li>
<li><a href="../265401/index.html">Scaling up to 24 controllers in the new ETERNUS DX storage system</a></li>
<li><a href="../265403/index.html">Autumn online courses from Computer Science Center and Academic University</a></li>
<li><a href="../265405/index.html">Android client application architecture</a></li>
<li><a href="../265409/index.html">How to create interactive tabs in an email</a></li>
<li><a href="../265411/index.html">Vscale: create the first server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>