<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determine the location of the phone ... without GPS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Looking through the Java ME Development hub, I came across the topic of Spb Transport J2ME , where the author uses cartographic services, and one of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determine the location of the phone ... without GPS</h1><div class="post__text post__text-html js-mediator-article">  Looking through the Java ME Development hub, I came across the topic of <a href="http://habrahabr.ru/post/143367/">Spb Transport J2ME</a> , where the author uses cartographic services, and one of the TODOs is GPS support (to improve usability).  The problem is that the phone with a built-in GPS-receiver is a relatively small amount.  I hope this post will help not only the author of that topic, but also to someone else, he himself filled a lot of cones in his time.  So let's get started. <br><br>  To determine the location of the user (phone, as you like), you can use several methods: <br>  - by GPS.  The method is the most accurate.  Among the shortcomings: a relatively long start, consumes a lot of energy, not too many devices with a built-in receiver. <br>  - on operator's towers.  Medium in accuracy.  Energy eats a little.  Of the minuses: not all phones have data available. <br>  - by IP.  Least accurate.  Actually this is the biggest minus. <br>  - according to operator's CB-messages <br><a name="habracut"></a><br>  So, we need a more or less acceptable accuracy in determining the location (for the city it is about 150-300 meters (this is somewhere 1.5-2 minutes on foot), outside the city, respectively, 2-5 km or more, as lucky) we need to cover as many devices as possible, and it would be nice to quickly update the coordinates. <br>  The most appropriate is to determine the location through the data of the cellular operator. <br><br><h5>  Services: </h5>  To convert these networks and get the coordinates, we will need a database of cell phone towers.  There are many resources in the network, I used the time-tested GoogleMaps, Yandex.Locator, location-api.com and opencellid.org (for greater accuracy and reliability, we use everything at once).  plus, as a bonus, Yandex in the API has a method for determining the location based on the signal strength, but more on that later. <br>  Each of the services has a well documented API (except GoogleMaps).  API accepted parameters: MCC (country code), MNC (network operator code), LAC (cell code), CellID (tower identifier). <br>  The API will return coordinates for this dataset. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Data: </h5>  Obtaining the above-mentioned data is not a trivial task, because each of the manufacturers considered it an honor to invent their own bicycle.  As a result, for each brand there is a set of keys to call System.getProperty (key), which are not so easy to find. <br>  There are also a number of other unpleasant moments.  For example, on Siemens, these networks cannot be obtained without patching the firmware.  SonyEricsson returns data in a HEX representation.  Nokia refuses to issue LAC to uncertified (that is, almost all) midlets. <br><br><h5>  Decision: </h5>  I wrote a class sorting out known keys and retrieving network data from these keys.  Then the keys were sent to the services API, the coordinates were obtained and the average value was derived, which I consider the most plausible (for the year of use I don‚Äôt recall cases of very large errors).  If the phone allows you to get the signal strength, we use the Yandex bonus: we get the coordinates Taking into account the signal strength and WITHOUT, we get the delta of these values, apply it to all the results from the API, display the average result.  Oddly enough, the last decision was a double-edged sword.  With a uniform attenuation of the signal, the accuracy is twice as large as the usual method, but if it is a dense urban development or hilly terrain, where the signal is unevenly distributed, in this case the accuracy drops quite strongly. <br><br>  As a result, it is possible to determine the location on the phones of Siemens, SonyEricsson, Samsung (for example, s5230), Huawei and others.  The loading time of coordinates and addresses is about 10-15 seconds. <br><div class="spoiler">  <b class="spoiler_title">An example from a demo (the add-in uses the Location class, in which coordinates are determined and addresses are loaded for them)</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.microedition.lcdui.Display; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.microedition.lcdui.Form; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.microedition.midlet.MIDlet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> loc.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloWorld</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MIDlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ Display display; Form form; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ display = Display.getDisplay(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Form(<span class="hljs-string"><span class="hljs-string">"NetMonitor"</span></span>); display.setCurrent(form); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).start(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    if (!Location.reallyNull(Location.lac)) { //   Location.getData(); //  Location.getCoordinates(); //      if (!Location.reallyNull(SystemUtil.signal())) { form.append((": ") + "\n : " + String.valueOf(Location.mcc) + " \n : " + String.valueOf(Location.mnc) + " \n : " + String.valueOf(Location.lac) + " \n C: " + String.valueOf(Location.cid) + " \n : " + SystemUtil.signal() + " \n"); } // else { form.append(": " + "\n : " + String.valueOf(Location.mcc) + " \n : " + String.valueOf(Location.mnc) + " \n : " + String.valueOf(Location.lac) + " \n : " + String.valueOf(Location.cid) + " \n"); } } //    String txt = SystemUtil.nativeDigitSupport(); if (!Location.reallyNull(txt)) { form.append(txt + "\n"); } txt = SystemUtil.operatorName(); if (!Location.reallyNull(txt)) { form.append(txt + "\n"); } txt = SystemUtil.serviceProvider(); if (!Location.reallyNull(txt)) { form.append(txt + "\n"); } txt = SystemUtil.traffic(); if (!Location.reallyNull(txt)) { form.append(txt + "\n"); } txt = SystemUtil.gid1(); if (!Location.reallyNull(txt)) { form.append(txt + "\n"); } txt = SystemUtil.gid2(); if (!Location.reallyNull(txt)) { form.append(txt + "\n"); } // form.append(": ".concat(String.valueOf(Location.getStreet().concat(" \n")))); form.append(": ".concat(String.valueOf(Location.getCity().trim().concat(" \n")))); form.append(": ".concat(String.valueOf(Location.getArea().concat(" \n")))); form.append(": ".concat(String.valueOf(Location.getCountry().concat(" \n")))); form.append(": ".concat(String.valueOf(Location.getLongitude().concat(" \n")))); form.append(": ".concat(String.valueOf(Location.getLatitude().concat(" \n")))); form.append("  ..: ".concat(String.valueOf(Location.getElevation().concat("  \n")))); //   String sens = System.getProperty("microedition.sensor.version"); if (sens != null &amp;&amp; sens.length() != 0 &amp;&amp; !sens.equals("null")) { sens = SensorApi.getSensor(3); if (sens != null &amp;&amp; sens.length() != 0 &amp;&amp; !sens.equals("null") &amp;&amp; !sens.equals("0")) { form.append("  : " + String.valueOf(sens) + " \n"); } } } public void pauseApp() { } public void destroyApp(boolean flag) { } }</span></span></code> </pre> <br></div></div><br><br>  Well, the source code with the demo <br>  <a href="http://goo.gl/lPkON">goo.gl/lPkON</a> </div><p>Source: <a href="https://habr.com/ru/post/146579/">https://habr.com/ru/post/146579/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146573/index.html">Rovio released a "new" game</a></li>
<li><a href="../146574/index.html">Packages, systems, modules, libraries - WHAT?</a></li>
<li><a href="../146575/index.html">Shimi Personal Music Robot</a></li>
<li><a href="../146577/index.html">Android UI constructor in IntelliJ IDEA 12</a></li>
<li><a href="../146578/index.html">Firefox 14 for Android is much better</a></li>
<li><a href="../146581/index.html">Access to images in isolated storage</a></li>
<li><a href="../146582/index.html">Habravstrecha in St. Petersburg!</a></li>
<li><a href="../146583/index.html">Thoughts before bed: fractal mixing algorithm</a></li>
<li><a href="../146587/index.html">Scripts on the knee - tame klipper Part 1</a></li>
<li><a href="../146588/index.html">One Time Secret - burn after reading</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>