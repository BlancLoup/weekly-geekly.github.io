<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calendar functions in MySQL and MariaDB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As practice shows, many systems using calendars are usually built in the form of static tables that list the dates and their correspondence to work, w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calendar functions in MySQL and MariaDB</h1><div class="post__text post__text-html js-mediator-article"><p>  As practice shows, many systems using calendars are usually built in the form of static tables that list the dates and their correspondence to work, weekends, holidays.  Usually, problems start when the system works without programmer intervention for a long time and the filled calendar simply ends.  For the next project, I decided to slightly optimize this situation and wrote a calendar that is created or recalculated automatically, for example, by the built-in timer. </p><a name="habracut"></a><br><p>  I don‚Äôt know how many people have information about the presence in MariaDB (MySQL) of a built-in iterator that returns values ‚Äã‚Äãover a given range.  If anyone knows, you can read <a href="https://mariadb.com/kb/en/mariadb/sequence/">the link</a> . </p><br><p>  The principle is simple.  It is the same as the usual For loop, to which the beginning, end and step are transmitted.  This iterator has a fantastic speed and allows for the computation of sequences. </p><br><p>  Let's start with the simple. </p><br><p>  As we all know, a regular calendar consists of working days and weekends, as well as official public holidays and days for which these holidays will be rescheduled if they fell on a weekend.  The transfer of holidays usually occurs by order of the government of the Russian Federation in the middle of the current year. </p><br><p>  Create 2 tables.  Periodic annual holidays and weekend transfers. </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">UNSIGNED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'        '</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> <span class="hljs-string"><span class="hljs-string">'utf8_unicode_ci'</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">'    '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span>=<span class="hljs-string"><span class="hljs-string">'utf8_unicode_ci'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> ROW_FORMAT=<span class="hljs-keyword"><span class="hljs-keyword">COMPACT</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">UNSIGNED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'        '</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> <span class="hljs-string"><span class="hljs-string">'utf8_unicode_ci'</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span> TINYINT(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">UNSIGNED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'    (0/1)'</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-string"><span class="hljs-string">`IDX_hdate`</span></span> (<span class="hljs-string"><span class="hljs-string">`hdate`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-string"><span class="hljs-string">`IDX_hdate_remap`</span></span> (<span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">'    '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span>=<span class="hljs-string"><span class="hljs-string">'utf8_unicode_ci'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre> <br><p>  Fill the table with periodic holidays </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-01-01'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-01-07'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-02-23'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-03-08'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-05-01'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">'   '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-05-09'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-06-12'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays_periodic`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'1970-11-04'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-01-01'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-02-24'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-01-07'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-05-08'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-02-23'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-03-08'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-05-01'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">'   '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-05-09'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-06-12'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-11-04'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-11-06'</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-01-02'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-05-03'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-01-03'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-03-07'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-02-20'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-02-22'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-05-01'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-05-02'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-06-12'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-06-13'</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-01-02'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-01-03'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-01-04'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-01-05'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`holidays`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_remap`</span></span>, <span class="hljs-string"><span class="hljs-string">`hcomment`</span></span>, <span class="hljs-string"><span class="hljs-string">`hdate_workday`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-01-06'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><p>  Note that in the <strong>holidays</strong> table there is a <em>hdate_workday</em> field, used if the transfer is made from a weekend that is reassigned by the worker.  For example, February 20, 2016 falls on Saturday, but according to the position of the government, this day is postponed to February 22 and is designated as a working day.  Those.  There is a working Saturday, after which there is 3 days of rest. </p><br><p>  We have the initial data, now the magic is SEQUENCE.  Create a calendar table </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`calendar_byholiday`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">UNSIGNED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`cdate`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`holiday`</span></span> TINYINT(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-string"><span class="hljs-string">`IDX_cdate`</span></span> (<span class="hljs-string"><span class="hljs-string">`cdate`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span>=<span class="hljs-string"><span class="hljs-string">'utf8_unicode_ci'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> ROW_FORMAT=<span class="hljs-keyword"><span class="hljs-keyword">COMPACT</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre> <br><p>  To fill the table, create a stored procedure. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> DEFINER=<span class="hljs-string"><span class="hljs-string">`root`</span></span>@<span class="hljs-string"><span class="hljs-string">`%`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> <span class="hljs-string"><span class="hljs-string">`rebuild_calendar_byholiday`</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DETERMINISTIC</span></span> CONTAINS <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SECURITY</span></span> DEFINER <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> PastWeek <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> DaysLimit <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">365</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> YearDIFF <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">#           SET PastWeek=DATE_SUB(CURDATE(),INTERVAL 1 WEEK); #     TRUNCATE TABLE calendar_byholiday; #     SEQUENCE  1  365 #      00:00      holidays INSERT INTO calendar_byholiday (cdate,holiday) SELECT DATE (PastWeek + INTERVAL s.seq DAY) AS cdate, IF(DAYOFWEEK(DATE (PastWeek + INTERVAL s.seq DAY)) &gt;= 2 AND DAYOFWEEK(DATE (PastWeek + INTERVAL s.seq DAY)) &lt;= 6,0,1) as holiday FROM (SELECT seq FROM seq_0_to_365) s LIMIT DaysLimit ; #       SET YearDIFF = YEAR(CURDATE()) - 1970; #       UPDATE calendar_byholiday c, holidays_periodic hp SET c.holiday = 1 WHERE c.cdate=DATE_ADD(hp.hdate,INTERVAL YearDIFF YEAR); #        UPDATE calendar_byholiday c, holidays h SET c.holiday = 1 WHERE (c.cdate=h.hdate OR c.cdate=h.hdate_remap) AND h.hdate_workday=0; #       . UPDATE calendar_byholiday c, holidays h SET c.holiday = 0 WHERE c.cdate=h.hdate AND h.hdate_workday=1; END</span></span></code> </pre> <br><p>  Next, just make a simple request. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">call</span></span> rebuild_calendar_byholiday(); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> calendar_byholiday;</code> </pre> <br><p>  Many will probably say "so what? Where is the magic?"  And the magic is that the depth of the calendar can be adjusted by changing only one parameter DaysLimit, as well as the maximum value in the cycle. </p><br><pre> <code class="sql hljs">FROM (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> seq <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> seq_0_to_365) s <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> DaysLimit;</code> </pre> <br><p>  Creating a calendar by time takes just a penny. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">call</span></span> rebuild_calendar_byholiday(); <span class="hljs-comment"><span class="hljs-comment">/*  : 0  : 0 : 0  1 : 0,032 sec. */</span></span></code> </pre> <br><p>  But what a calendar without date-casting functions.  The usual operations in the calendar imply the determination of the dates following the search after a certain time interval.  For example, the previous working day, the first day of the quarter, the last working day of the month, etc.  Below, I have put together my own practices and Best Practices from the date processing network. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> DEFINER=<span class="hljs-string"><span class="hljs-string">`root`</span></span>@<span class="hljs-string"><span class="hljs-string">`%`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-string"><span class="hljs-string">`date_transform`</span></span>( <span class="hljs-string"><span class="hljs-string">`InDate`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-string"><span class="hljs-string">`Method`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>, <span class="hljs-string"><span class="hljs-string">`Units`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">`Duration`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> SIGNED ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DETERMINISTIC</span></span> CONTAINS <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SECURITY</span></span> DEFINER <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> ReturnDate DATETIME; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> LastQuarterDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> LastYearDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ReturnDate=InDate; CASE WHEN Method = 2 THEN <span class="hljs-comment"><span class="hljs-comment">#    SELECT CASE WHEN WEEKDAY(InDate - INTERVAL 1 DAY) = 5 THEN (InDate - INTERVAL 2 DAY) WHEN WEEKDAY(InDate - INTERVAL 1 DAY) = 6 THEN (InDate - INTERVAL 3 DAY) ELSE (InDate - INTERVAL 1 DAY) END INTO ReturnDate; WHEN Method = 3 THEN #    SELECT (InDate - INTERVAL DAYOFMONTH(InDate)-1 DAY) INTO ReturnDate; WHEN Method = 4 THEN #    SELECT STR_TO_DATE(CONCAT(EXTRACT(YEAR FROM InDate),'-',(QUARTER(InDate)-1)*3+1,'-01'),'%Y-%m-%d') INTO ReturnDate; WHEN Method = 5 THEN #    SELECT STR_TO_DATE(CONCAT(EXTRACT(YEAR FROM InDate),'-01-01'),'%Y-%m-%d') INTO ReturnDate; WHEN Method = 6 THEN #    SELECT LAST_DAY(InDate) INTO ReturnDate; WHEN Method = 7 THEN #    SELECT CASE WHEN MOD(MONTH(InDate),3) != 0 THEN LAST_DAY(DATE_ADD(InDate,INTERVAL (3-MOD(MONTH(InDate),3)) MONTH)) ELSE LAST_DAY(InDate) END INTO ReturnDate; WHEN Method = 8 THEN #    SELECT STR_TO_DATE(CONCAT(EXTRACT(YEAR FROM InDate),'-12-31'),'%Y-%m-%d') INTO ReturnDate; WHEN Method = 9 THEN #     SELECT CASE WHEN WEEKDAY(LAST_DAY(InDate)) = 5 THEN DATE_SUB(LAST_DAY(InDate),INTERVAL 1 DAY) WHEN WEEKDAY(LAST_DAY(InDate)) = 6 THEN DATE_SUB(LAST_DAY(InDate),INTERVAL 2 DAY) ELSE LAST_DAY(InDate) END INTO ReturnDate; WHEN Method = 10 THEN #     SELECT CASE WHEN MOD(MONTH(InDate),3) != 0 THEN LAST_DAY(DATE_ADD(InDate,INTERVAL (3-MOD(MONTH(InDate),3)) MONTH)) ELSE LAST_DAY(InDate) END INTO LastQuarterDate; SELECT CASE WHEN WEEKDAY(LAST_DAY(LastQuarterDate)) = 5 THEN DATE_SUB(LAST_DAY(LastQuarterDate),INTERVAL 1 DAY) WHEN WEEKDAY(LAST_DAY(LastQuarterDate)) = 6 THEN DATE_SUB(LAST_DAY(LastQuarterDate),INTERVAL 2 DAY) ELSE LAST_DAY(LastQuarterDate) END INTO ReturnDate; WHEN Method = 11 THEN #     SELECT STR_TO_DATE(CONCAT(EXTRACT(YEAR FROM InDate),'-12-31'),'%Y-%m-%d') INTO LastYearDate; SELECT CASE WHEN WEEKDAY(LAST_DAY(LastYearDate)) = 5 THEN DATE_SUB(LAST_DAY(LastYearDate),INTERVAL 1 DAY) WHEN WEEKDAY(LAST_DAY(LastYearDate)) = 6 THEN DATE_SUB(LAST_DAY(LastYearDate),INTERVAL 2 DAY) ELSE LAST_DAY(LastYearDate) END INTO ReturnDate; WHEN Method = 12 THEN #  SELECT DATE_SUB(InDate,INTERVAL WEEKDAY(InDate) DAY) INTO ReturnDate; WHEN Method = 13 THEN #  SELECT DATE_SUB(InDate,INTERVAL WEEKDAY(InDate)-1 DAY) INTO ReturnDate; WHEN Method = 14 THEN #  SELECT DATE_SUB(InDate,INTERVAL WEEKDAY(InDate)-2 DAY) INTO ReturnDate; WHEN Method = 15 THEN #  SELECT DATE_SUB(InDate,INTERVAL WEEKDAY(InDate)-3 DAY) INTO ReturnDate; WHEN Method = 16 THEN #  SELECT DATE_SUB(InDate,INTERVAL WEEKDAY(InDate)-4 DAY) INTO ReturnDate; WHEN Method = 17 THEN #  SELECT DATE_SUB(InDate,INTERVAL WEEKDAY(InDate)-5 DAY) INTO ReturnDate; WHEN Method = 18 THEN #  SELECT DATE_SUB(InDate,INTERVAL WEEKDAY(InDate)-6 DAY) INTO ReturnDate; ELSE #   BEGIN END; END CASE; SELECT CASE WHEN Units='minute' THEN ReturnDate + INTERVAL Duration MINUTE WHEN Units='hour' THEN ReturnDate + INTERVAL Duration HOUR WHEN Units='day' THEN ReturnDate + INTERVAL Duration DAY WHEN Units='week' THEN ReturnDate + INTERVAL Duration WEEK WHEN Units='month' THEN ReturnDate + INTERVAL Duration MONTH WHEN Units='year' THEN ReturnDate + INTERVAL Duration YEAR WHEN Units='workday' THEN get_workday_offset(ReturnDate,Duration) ELSE ReturnDate END INTO ReturnDate; RETURN ReturnDate; END</span></span></code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> DEFINER=<span class="hljs-string"><span class="hljs-string">`root`</span></span>@<span class="hljs-string"><span class="hljs-string">`%`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-string"><span class="hljs-string">`get_workday_offset`</span></span>( <span class="hljs-string"><span class="hljs-string">`InDate`</span></span> DATETIME, <span class="hljs-string"><span class="hljs-string">`Offset`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> DATETIME <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DETERMINISTIC</span></span> CONTAINS <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SECURITY</span></span> DEFINER <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> ReturnDate DATETIME <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Offset</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">Offset</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>; CASE WHEN Offset &lt; 0 THEN <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> InDate <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ReturnDate; ELSE <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> cdate <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ReturnDate <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> calendar_byholiday <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> cdate &gt;= InDate <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> holiday=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Offset</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span>; RETURN ReturnDate; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br><p>  Actually what is it for?  It is necessary to calculate various periodicals in the events.  For example, you need to understand what day is the 6th working day from the beginning of the month in January 2017. </p><br><pre> <code class="sql hljs">MariaDB [db]&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> date_transform(<span class="hljs-string"><span class="hljs-string">'2017-01-26'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">'workday'</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>); +<span class="hljs-comment"><span class="hljs-comment">--------------------------------------------+ | date_transform('2017-01-26',3,'workday',6) | +--------------------------------------------+ | 2017-01-16 00:00:00 | +--------------------------------------------+ 1 row in set (0.01 sec)</span></span></code> </pre> <br><p>  Or what date was Monday for December 15, 2016. </p><br><pre> <code class="sql hljs">MariaDB [db]&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> date_transform(<span class="hljs-string"><span class="hljs-string">'2016-12-15'</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); +<span class="hljs-comment"><span class="hljs-comment">-------------------------------------+ | date_transform('2016-12-15',12,0,0) | +-------------------------------------+ | 2016-12-12 00:00:00 | +-------------------------------------+ 1 row in set (0.00 sec)</span></span></code> </pre> <br><p>  Etc.  Accordingly, the function is easily called from normal requests and is quite flexible.  The format of the request is as follows: </p><br><p>  date_transform (DATETIME, ModifyID, Units, Offset) </p><br><p>  Where <br>  DATETIME - date or date with time </p><br><p>  ModifyID: </p><br><pre> <code class="hljs 1c">id;name <span class="hljs-number"><span class="hljs-number">1</span></span>;  <span class="hljs-number"><span class="hljs-number">2</span></span>;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">9</span></span>;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">10</span></span>;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">11</span></span>;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-number"><span class="hljs-number">13</span></span>; <span class="hljs-number"><span class="hljs-number">14</span></span>; <span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-number"><span class="hljs-number">17</span></span>; <span class="hljs-number"><span class="hljs-number">18</span></span>;</code> </pre> <br><p>  Units: </p><br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">minute</span></span> <span class="hljs-built_in"><span class="hljs-built_in">hour</span></span> <span class="hljs-built_in"><span class="hljs-built_in">day</span></span> week <span class="hljs-built_in"><span class="hljs-built_in">month</span></span> <span class="hljs-built_in"><span class="hljs-built_in">year</span></span> workday</code> </pre> <br><p>  Offset: SIGNED INT </p><br><p>  If Offset is specified as a negative number, the calculation will be performed backwards. </p><br><p>  In the function of bringing dates, the calculation of the last working days of the week, month, year is done independently of the calendar, i.e.  for the global calendar.  If you need a binding to a local calendar with holidays, it is better to use a 'workday' offset with a negative value. </p><br><p>  I hope someone this material will help in the development. </p><br><p>  ¬© Aborche 2016 <br><img src="http://aborche.com/pics/aborchelogo.jpg" alt="Aborche"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/318022/">https://habr.com/ru/post/318022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318012/index.html">Intel Software Guard Extensions tutorial. Part 3, Design for Intel SGX</a></li>
<li><a href="../318014/index.html">Huawei router + hypervisor in one package. Starting from scratch</a></li>
<li><a href="../318016/index.html">Consumer psychology - free book and lecture with HSE</a></li>
<li><a href="../318018/index.html">Entertaining tasks and an excerpt from the book "Career Programmer"</a></li>
<li><a href="../318020/index.html">How not to write too much. No magic</a></li>
<li><a href="../318024/index.html">Interface designer on Habr√© - the results of my first year</a></li>
<li><a href="../318026/index.html">How to write your own ‚Äúsandbox‚Äù: an example of the simplest ‚Äúsandbox‚Äù. Part II</a></li>
<li><a href="../318028/index.html">Lord of Wi-Fi: Aruba ClearPass</a></li>
<li><a href="../318030/index.html">New Year's Release SBM 11.2</a></li>
<li><a href="../318032/index.html">Agile in work with outsourcing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>