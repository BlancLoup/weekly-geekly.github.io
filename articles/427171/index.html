<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Security leaving you</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I attended the Messaging, Malware and Mobile Anti-Abuse Working Group meeting (m3aawg.org) in Brooklyn, New York. I expected better weather to wander ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Security leaving you</h1><div class="post__text post__text-html js-mediator-article"><p>  I attended the Messaging, Malware and Mobile Anti-Abuse Working Group meeting (m3aawg.org) in Brooklyn, New York.  I expected better weather to wander around the city, enjoy the conference, and a wide selection of food in the area.  I was so sure of the clearness of the sky that I did not even take anything from the rain with me.  And it rained all week.  This forced me to stay in my hotel room with free WiFi and my working laptop.  I decided to spend this time researching Node.js and their related packages available at <a href="https://www.npmjs.com/">https://www.npmjs.com</a> . </p><br><p>  There are thousands of packages from users available for download and installation into your project.  I searched NPM for popular package names such as file, backup, download, or upload.  The last search query showed me a project called <a href="https://github.com/blueimp/jQuery-File-Upload">jQuery file upload</a> from a Blueimp user.  His description seemed interesting enough to download and explore it. </p><a name="habracut"></a><br><blockquote>  File upload widget for jQuery, with support for multiple file selection, drag &amp; drop, progress indicator, validation and preview of images, audio and video.  It supports cross-domain requests, a partial and renewable mechanism for downloading files with a resize of images on the client side.  It works in any server platform (PHP, Python, Ruby on Rails, Java, Node.js, Go, etc.), which supports standard file upload via an HTML form. </blockquote><p>  I started looking at the source of the package and focused my attention on a couple of PHP files in the server / php directory.  The files were called upload.php and UploadHandler.php.  Upload.php called UploadHandler.php, where the main file upload code was located.  I also noticed that the files were uploaded to the files / directory in the root of the web server.  I wrote a simple command with curl and a primitive PHP script that confirmed to me that I can upload the file to the server and then use it to execute commands on the server. </p><br><pre><code class="bash hljs">$ curl -F <span class="hljs-string"><span class="hljs-string">"files=@shell.php"</span></span> http://example.com/jQuery-File-Upload-9.22.0/server/php/index.php</code> </pre> <br><p>  Where the shell.php file contains: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $cmd=$_GET[<span class="hljs-string"><span class="hljs-string">'cmd'</span></span>]; system($cmd);<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><p>  Opening a page in the browser with the cmd = id parameter from the test server returned the user id from which the server process was launched to me.  I assumed that this vulnerability did not go unnoticed and a quick search on Google confirmed to me that other projects that used this code or its derivatives were vulnerable.  There were also some videos showing how to attack similar software packages. </p><br><p>  I notified the jQuery File Upload author and began documenting what I found to assign a CVE number.  Soon the next day, the somewhat embarrassed author replied to me, asking for more information, since he could not reproduce the vulnerability in his test environment. </p><br><p>  After comparing our test configurations via email, we found that Apache developers have turned off support for .htaccess files since version 2.3.9.  It turns out that this was done <a href="httpd.apache.org/docs/current/en/howto/htaccess.html">to improve performance</a> so that the server does not have to check this file every time it accesses the appropriate directory.  Moreover, this change was also made to <a href="httpd.apache.org/docs/2.4/misc/security_tips.html">prevent users from overriding the security settings</a> that were configured on the server. </p><br><p>  Thus, Apache had good intentions when disabling .htaccess, but their changes also put some developers and their projects at risk, in particular, if they were counting on the security settings made in .htaccess. </p><br><p>  In the case of this library, in order to properly handle this situation and fix the CVE-2018-9206 file loading vulnerability, the developer <a href="https://github.com/blueimp/jQuery-File-Upload/commit/aeb47e51c67df8a504b7726595576c1c66b5dc2f">modified the code so</a> that it only allowed downloading image files. </p><br><h3 id="eta-problema-bolshe-chem-odnogo-proekta">  This problem is more than one project. </h3><br><p>  It is also worth noting here that due to changes in Apache, some of the 7,800 other projects may be vulnerable to the problem with downloading files. </p><br><p><img src="https://habrastorage.org/webt/-g/ki/4d/-gki4dbjtpslaemnlr0axoqhc48.png"></p><br><p>  Most of these forks still carry the original vulnerability in their code.  In some cases, the vulnerability remains even after the developer has edited the original Blueimp code to embed it in his project, so the projects are still vulnerable to my example of an attack with minor variations. </p><br><p>  This means that if any of these projects is used in production, then it is vulnerable to the vulnerability of downloading a file and its subsequent execution.  Discovering opportunities for data theft from applications, malware injection, deface, and other harm. </p><br><p>  Unfortunately, there is no way to accurately determine how many projects forked from the original jQuery File Upload are still actively supported and apply changes made in the main project.  It is also not possible to determine exactly where forked projects are used in production, if any.  Moreover, the old versions of the project were also vulnerable to problems with downloading files, up to 2010. </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  The Internet relies on a variety of security mechanisms to keep our systems, data, and transactions safe and secure.  If one of these mechanisms suddenly disappears, it could jeopardize the safety of users and developers counting on it. </p><br><p>  It is a good idea for developers to look at the changes in the systems and libraries on which they base their project.  In this article, the security mechanism that Apache has removed has influenced not only the Blueimp Jquery file upload, but also all its forks and branches.  The vulnerability has affected many projects that depend on it, ranging from stand-alone web applications and ending with plug-ins to WordPress and other CMS. </p><br><ul><li>  <a href="https://github.com/blueimp/jQuery-File-Upload/pull/3514">Original bug report</a> </li><li>  <a href="https://nvd.nist.gov/vuln/detail/CVE-2018-9206">Record CVE-2018-9206</a> </li><li>  <a href="https://www.zdnet.com/article/zero-day-in-popular-jquery-plugin-actively-exploited-for-at-least-three-years/">Article on ZDNet</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/427171/">https://habr.com/ru/post/427171/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427159/index.html">We collect Mikrotik firewall logs into the database</a></li>
<li><a href="../427163/index.html">New material will help make thermal solar power plants more efficient.</a></li>
<li><a href="../427165/index.html">How to develop integration tests for Atlassian Jira Server (jira-func-test-plugin)</a></li>
<li><a href="../427167/index.html">What can DSS - or old songs about the main thing</a></li>
<li><a href="../427169/index.html">Tesla quietly removed the option of full autopilot</a></li>
<li><a href="../427173/index.html">Is telephony cheaper than free?</a></li>
<li><a href="../427175/index.html">Sunsheds Or what if you are a plant in the shower</a></li>
<li><a href="../427177/index.html">Egocentric daffodils are inferior in their productivity to humble leaders.</a></li>
<li><a href="../427179/index.html">Palm reborn from the ashes with a new gadget</a></li>
<li><a href="../427183/index.html">The first introvert in a shaking world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>