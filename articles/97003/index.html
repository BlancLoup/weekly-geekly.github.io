<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hyper-V and storage devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As I promised, I continue to ‚Äúevangelize‚Äù and write another article about Hyper-V. At this time, it will be about the work of Hyper-V with storage dev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hyper-V and storage devices</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/9f/48/9f48c155afd86876470f9b402b0a3651.jpg" alt="image"></div><br>  As I promised, I continue to ‚Äúevangelize‚Äù and write another article about Hyper-V.  At this time, it will be about the work of Hyper-V with storage devices - that is, hard drives and all sorts of external storage systems. <br><a name="habracut"></a><br><br><h4>  Where can virtual machines store data? </h4><br>  Virtual machine disks can be stored both on the server‚Äôs local hard disks and on external storage systems (SAN). <br><img src="https://habrastorage.org/storage/habraeffect/5f/37/5f37d8190d390da4ee48e1c6bde1b1b5.png" width="320" height="240"><br>  The diagram uses DAS.  On disk Disk2 mounted on the host system as a disk Y :, a file VM1.vhd was created, which, in turn, is mounted on a virtual machine and used as a disk C :.  And Disk3 connects to the virtual machine directly, and in the guest OS you can work with it as with the D: drive.  In the host OS, Disk3 is in the Offline state, and it will not be possible to enter it. <br>  Now let's see what options are available when using SAN. <br><img src="https://habrastorage.org/storage/habraeffect/42/91/4291e8dd79c8ca171c5e8e4de80cd27c.png" width="320" height="240"><br>  The most "classic" version - LUN 1 is presented to the server, mounted on the host OS, for example, as a Z: drive, a VHD is already being created on it, which, in turn, is used by the virtual machine.  Something like a fairy tale - ‚Äúa needle in an egg, an egg in a duck, a duck in a hare, etc.‚Äù <br>  The second option - LUN 2 is presented to the server, but in the host OS it is not mounted, but connected as a pass-through disk to the virtual machine. <br>  In addition, if the SAN is based on the iSCSI protocol, the LUN can be mounted inside a virtual machine using a software iSCSI initiator running inside the guest OS.  Unfortunately, FibreChannel-LUNs can not be connected in this way - Hyper-V does not have virtual FC-HBA. <br><br><h4>  Virtual Controllers </h4><br>  Let's start with the fact that a virtual machine, just like a real computer, has its own virtual hard disks and virtual hard disk controllers.  These controllers are only two types: IDE and SCSI.  What is the difference between them? <br>  Firstly, unlike the IDE, the SCSI controller is a fully synthetic device, and therefore requires integration of its components for its operation.  Therefore, it can be used only in those guest OS that support them (I remind you that this is only MS Windows, as well as RHEL and SLES).  For the same reason, the guest operating system can only be loaded from an IDE device.  The main difference between virtual IDEs and SCSI controllers is the number of devices that can work through this controller.  IDE controllers in a virtual machine can have two, and a maximum of two virtual disks can be connected to each.  There are four SCSI controllers, and up to 64 virtual disks can be connected to each controller, that is, the entire virtual machine can have 260 virtual disks (4 IDE + 4 * 64 SCSI).  We must also remember that although real SCSI disks work faster than IDE - this is not quite true for a virtual environment.  In the Hyper-V R2 environment, with the integration components installed, virtual IDE and SCSI disks work equally fast, and performance is determined only by the physical disk subsystem. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Virtual disks </h4><br>  Now let's see what the hard drives of virtual machines themselves can be.  To begin with, Hyper-V supports both virtual hard disks represented as .VHD files and direct connection of disks to a virtual machine (the so-called pass-through-disks). <br>  Virtual disks are special format files (.vhd).  This format was originally developed by Connectix, and then, after its acquisition by Microsoft, it began to be used in virtualization products from MS ‚Äî VirtualPC, Virtual Server, and now Hyper-V.  At the moment, in Windows 7 and Windows Server 2008 R2, VHD files are supported at the OS level and can be mounted on the system as disks.  Moreover, the OS itself can be installed on the VHD and boot from it.  The VHD format is now fully open, and there are many third-party software (for example, from Paragon) that allows you to work with VHDs, and also VHDs are supported on some Citrix products.  Virtual disks come in three types: fixed-size, dynamic, and differential. <br>  <b>Dynamic virtual disks</b> are a VHD file that increases in size as you write to it.  Dynamic disk during operation can be compressed by removing unused blocks that remain when deleting data from the VHD.  The use of dynamic disks allows the most efficient use of disk space, but it is not recommended to use them in production-environment due to a possible performance drop. <br>  <b>Fixed-sized virtual disks</b> are a file containing a set of blocks, presented to the virtual machine as a disk.  The size of the virtual disk is set when it is created, and a VHD file of the appropriate size is created on the server‚Äôs hard disk.  The creation process may take some time, depending on the size of the disk.  The use of fixed-size discs is preferable to dynamic for two reasons.  First, because the dynamic disk expands gradually, the VHD file may become fragmented, which will affect performance.  A fixed-size VHD immediately takes up all the space it needs, and therefore is not fragmented during operation.  Secondly, there may be a situation that the space on the physical disk will end, and the dynamic disks will have no place to "grow", and this may lead to malfunctions of the virtual machines. <br>  <b>Differential disk</b> - always has a ‚Äúparent‚Äù VHD.  Reading at the same time can be carried out both from the ‚Äúparent‚Äù and from the differential VHD itself, but the record goes only to the differential VHD, the ‚Äúparent‚Äù remains unchanged.  These are, for example, AVHD disks created during virtual machine snapshots.  Learn more about snapshots - see my previous article.  Also, differential VHDs can be used in a test environment when you need to raise several virtual machines with approximately the same contents of hard disks (for example, from an installed OS).  The use of differential disks in a production-environment is not recommended firstly because of reduced performance (instead of reading from one VHD, you have to read several), and secondly because of reduced reliability (damage to the parental VHD causes damage to all differential). <br>  The maximum size of virtual disks, both fixed and dynamic, is 2 terabytes (or 2,040 gigabytes). <br>  <b>Pass-through disks</b> are the connection of physical disks directly to a virtual machine without creating VHD files.  These can be either partitions on local hard drives or presented to the LUN server from an external storage system (SAN).  For a host OS, after mounting to a virtual machine, the disk switches to the ‚ÄúOffline‚Äù state, that is, direct access to the disk is terminated.  Mount mounted VHDs cannot be used as pass-through disks, nor do they support snapshots at the virtual machine level. <br>  The size of pass-through-disks is not limited to 2 terabytes. <br>  Sometimes questions arise: what is better to use - VHD or pass-through-drives?  Some people think that VHDs are slower, but this is not true.  Studies have shown that in Winodws Server 2008 R2 VHD and pass-through-drives work at the same speed.  More information about the measurements you can read the <a href="http://download.microsoft.com/download/0/7/7/0778C0BB-5281-4390-92CD-EC138A18F2F9/WS08_R2_VHD_Performance_WhitePaper.docx">official document</a> . <br><br>  <i>At this point I‚Äôll probably finish; the next article will talk about the work of virtual machines with a network.</i>  <i>If there are any questions on the topic of the article - as usual, you are welcome in the comments.</i> </div><p>Source: <a href="https://habr.com/ru/post/97003/">https://habr.com/ru/post/97003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96991/index.html">Available to order kit to build your own tablet with a touchscreen OLED display</a></li>
<li><a href="../96993/index.html">eRoll - eBooks reader concept</a></li>
<li><a href="../96994/index.html">Anti-aliasing in Windows is about as in MakOsi</a></li>
<li><a href="../96995/index.html">Acquaintance with cloud hosting Slidebar.ru</a></li>
<li><a href="../96999/index.html">Video and slides of reports from AgileDays in Yekaterinburg</a></li>
<li><a href="../97007/index.html">Ampersands in string constants</a></li>
<li><a href="../97008/index.html">Star Iron Kit</a></li>
<li><a href="../97011/index.html">New features for vectorization and paralleling in Intel¬Æ Parallel Composer</a></li>
<li><a href="../97012/index.html">Time for Coded UI Tests</a></li>
<li><a href="../97013/index.html">life :) Belarus started selling Android phone. $ 23 contract per month</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>