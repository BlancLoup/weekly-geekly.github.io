<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Home mini climate control do-it-yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear habrovchane. I want to share my little experience in creating a home climate control with a web-based informer based on an Arduino boar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Home mini climate control do-it-yourself</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear habrovchane.  I want to share my little experience in creating a home climate control with a web-based informer based on an Arduino board using TSOP, IR, DHT22 and Electrolux floor-standing air conditioners and some other components. <br><br><img src="https://habrastorage.org/storage2/bb8/c9a/660/bb8c9a660b477c4dc55e9fd75d1496b1.jpg"><br><br>  So, if you are interested in my implementation, welcome to Habrakat (ready to fill the sketch in the same place). <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Introduction. </h4><br>  On the eve of the summer, I thought about the need to purchase an air conditioner, but since the layout of the house and apartment does not allow the use of a split system, I had to take a floor air conditioner.  Yes, I understood that there would be hemorrhoids with a tube output, so in the introduction I will briefly talk about tuning the air conditioner ligament and my window.  Everything is quite simple, there are 2 tubes, one pulls the air, the second takes it outside (hot).  Cold air comes out of the central part of the air conditioner. <br><br>  In order to bring the tube I needed: <br>  ‚Ä¢ Plexiglas the size of 1 casement of my window (double-glazed windows) plus openings for pipes. <br>  ‚Ä¢ 4 mounts for plexiglass installation <br>  ‚Ä¢ tube for air vent (picked up foil) 2 pcs. <br>  ‚Ä¢ air conditioning <br><br>  The bottom line is that in Plexiglas there are 2 holes for our tubes, which take in and out the air.  This was done to prevent air sparseness (I read about it in different forums, but did not notice it myself, but I won‚Äôt be any worse).  I fixed the tube with the output of hot air in our plexiglass at a slight angle up and to the left, the tube of the air intake at a slight angle down and to the right so that the air flows do not intersect.  The plexiglass mounts were made outside the window, the idea for this was looking at the installed mosquito net in the next window section (living on the lower floors bore mosquitoes, plus during the flowering of the poplars my grid became terry, but the fluff did not fall into the apartment). <br><br><img src="https://habrastorage.org/storage2/694/2bb/d28/6942bbd28bf39b2270dc4b3090a22ffc.png" height="300"><br><br>  The picture above seems to understand how it is attached, where the tubes are located, etc.  If you have questions, ask in the comments.  And so, now we have an air conditioner, which is located near the window, tubes are inserted into Plexiglas from the air conditioner and brought out to the street (the only inconvenience is that the window is constantly open, but it is blocked by plexiglass, not aesthetically pleasing, but to drill the supporting wall, holes in diameter ~ 20cm 2 pieces on the street there is no desire).  We now turn to the logic of our system. <br><br><h4>  Logical part </h4><br><br><img src="https://habrastorage.org/storage2/af9/52c/dc3/af952cdc3b66973f8c306e35f7011f3a.jpg" width="600"><br><br>  In my case, the air conditioner is Electrolux EACM-14EZ / N3, which has several modes + IR remote control.  The first and main one is, of course, cooling (hi, Cap).  The second, but no less useful, is the dehumidification of air (not humidification, namely dehumidification).  The second is very useful, especially in the heat, because the heat is easier to carry in the drier air (as well as cold), and recently I had a humidity of 75-80% in the apartment (at least I was told by a hygrometer donated at work ).  To humidify the air, I use a cheap humidifier, which simply heats the water to the boiling point and that's it, the connection description is not there yet, because I have not completed it yet, but I will publish it, the fact is that it does not have any IR type interfaces, etc. , therefore it is necessary to disassemble it, solder your controller with a relay, but let us return to the main topic.  For me and my wife, the temperature in the room is ideally 22-24 degrees (well, in extreme cases, 25 but with sufficiently low humidity). <br><br><img src="https://habrastorage.org/storage2/1fd/92c/140/1fd92c140bae696eb04b29015308ef91.jpg" width="600"><br><br>  Therefore, we highlight the following logic: <br>  ‚Ä¢ Turn on the cooling system in case of t&gt; 25 degrees <br>  ‚Ä¢ Turn off the cooling system at t &lt;22 degrees <br>  ‚Ä¢ Turn on the dehumidification mode when h&gt; 60% <br>  ‚Ä¢ Turn off the dehumidification mode when h &lt;40% <br>  ‚Ä¢ If 22 &lt;t &lt;25 and 40 &lt;h &lt;60 - we turn on the automatic mode (the condo alternately turns on dehumidification and cooling itself, or we manage the shift through the controller, for example, for 5 minutes of each type) <br><br>  In total, we have 4 IR teams: <br>  ‚Ä¢ Turn on the condo for maximum cooling (fan for maximum, temperature 16 or 18 degrees depending on the model) <br>  ‚Ä¢ Switch on the condo for maximum drainage (fan for maximum) <br>  ‚Ä¢ Enable condo in automatic mode. <br>  ‚Ä¢ Turn off the condo <br><br>  It seems to be understandable here.  Personally, I chose for myself the option with 4 teams, when in the case of the intersection of the rules, just an automatic mode is turned on (you can of course write your alternate switching system, but for now, that‚Äôs enough for me). <br><br><h4>  Start of implementation </h4><br><br><img src="https://habrastorage.org/storage2/e25/447/730/e25447730acb1cd2514d54590bc127f0.jpg" width="600"><br>  <i>Our arduino with an ethernet shield in the collection.</i> <br><br>  We write the command console air conditioner.  For this, I used the ready-made library for arduino, the PSTN connected to it and the remote from kondeya itself.  We download the library from the githab (by the way, the last version solved the problem with the long package, it was increased to 100, before that some teams did not fit, because there was a limit of 50, and often met a lot of angry reviews, although it was fixed in 2 seconds).  The advantage of this library is that there is a rather convenient logger of incoming signals to our PSTN in the demo and this is in Serial. <br><br><img src="https://habrastorage.org/storage2/0b4/d53/e79/0b4d53e795601793ab1c63f40c6e8b49.jpg" width="600"><br>  <i>Here is the TSOP and the IR LED in front of it.</i> <br><br>  Pinout TSOP22 (for most others, as far as I know, everything is identical): <br><br><img src="https://habrastorage.org/storage2/5d1/c7f/386/5d1c7f3868c1e0239d18d5c68584152f.jpg" height="400"><br><br>  Both raw data (that is, not processed) and ready-made packet packets by type (for example, NEC, RC5, etc.) are displayed if they are determined, which can be sent directly from the library in a short form.  My air conditioner does not have a generally accepted standard of packages (by the way, like the TV, but the console from online using the NEC protocol), so we will use the so-called raw data.  First, we connect our PSTN sensor as shown in the picture below (ignore the LED) and fill in our Parser firmware from the Arduino demo library (IRrecvDump). <br><br><img src="https://habrastorage.org/storage2/57e/744/932/57e744932dcbafb75ec95ab3d9b5fb8b.jpg"><br>  <i>TSOP wiring diagram</i> <br><br>  The first time I had a bug: the packages went on their own.  He did this in the room and suggested that something could fonit.  Came out with a laptop on the balcony - the background continued.  Honestly, I didn‚Äôt understand what the problem was, but I went to the nearest electronics store and bought 2 new vehicles (the first one was buggy, was sent from China), having connected such a glitch and the packages were displayed only when the button was pressed on the remote.  To record the signal, we connect the arduino to the computer, after connecting everything in the picture above, open the port monitor, specifying the required com port.  We bring the remote and press the button with the desired command.  The monitor displays all the necessary information.  I used custom firmware to immediately generate code that would be more convenient for copy-paste to insert into the sketch, nothing complicated, but since  formatted hard, forgot to save this sketch.  The demo from the library is more than enough and not much different. <br>  As a result, we received packages for sending, for example, to turn on the air conditioner for a maximum of me: <br><br><pre><code class="cpp hljs">Raw periods: +<span class="hljs-number"><span class="hljs-number">2650</span></span> <span class="hljs-number"><span class="hljs-number">-2650</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-2000</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-650</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-650</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-650</span></span> +<span class="hljs-number"><span class="hljs-number">800</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-750</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-650</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-650</span></span> +<span class="hljs-number"><span class="hljs-number">800</span></span> <span class="hljs-number"><span class="hljs-number">-650</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-700</span></span> +<span class="hljs-number"><span class="hljs-number">700</span></span> <span class="hljs-number"><span class="hljs-number">-2000</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-1950</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-number"><span class="hljs-number">-2000</span></span> +<span class="hljs-number"><span class="hljs-number">750</span></span>    : <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TurnColdOn[<span class="hljs-number"><span class="hljs-number">68</span></span>] = {<span class="hljs-number"><span class="hljs-number">2650</span></span>,<span class="hljs-number"><span class="hljs-number">2650</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">2000</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">650</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">650</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">650</span></span>,<span class="hljs-number"><span class="hljs-number">800</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">650</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">650</span></span>,<span class="hljs-number"><span class="hljs-number">800</span></span>,<span class="hljs-number"><span class="hljs-number">650</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">700</span></span>,<span class="hljs-number"><span class="hljs-number">2000</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">1950</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">2000</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span>}; irsend.sendRaw(TurnColdOn,<span class="hljs-number"><span class="hljs-number">68</span></span>,<span class="hljs-number"><span class="hljs-number">38</span></span>);</code> </pre> <br><br>  Regarding the Raw periods - where the "+" is where we burn the specified number of microseconds, where the "-" we do not burn the specified number of microseconds.  For those who will, for example, use AVR type controllers, there is a delay function with microseconds indicated.  Used approximately like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;util/delay.h&gt; _delay_us(  );</span></span></span></span></code> </pre><br><br>  Thus we collect all the necessary commands.  Now we connect our DHT22 to the Arduino, IR LED and write our sketch that carries the main logic.  In this version, I, unfortunately, use a fully wired data transmission system, I ordered the NF24L01 sensors, but how many they still will come from your favorite China is unknown, for more details see the list of what is planned to be improved in the last part of the article in the TODO section.  Also for the implementation of the project, Ethernet Shield was used (a counterpart from the Middle Kingdom in the region of 9-15 dollars (I took 9)). <br><br><img src="https://habrastorage.org/storage2/67f/01a/1a4/67f01a1a420b00a0988d3b481ee0780c.jpg" width="600"><br>  <i>In the photo debug temperature sensor</i> <br><br>  As a result of the collection we will have the following scheme: <br><br><img src="https://habrastorage.org/storage2/b77/b37/a09/b77b37a092401bdb8dbc5e6aba2d0fa0.png"><br><br>  Some people recommend placing a pull-up pull-up resistor of 10 kŒ© between the Vcc and Data pins, but it works without it, and I don‚Äôt see any real sense, to be honest, they don‚Äôt cause any measurement. <br><br><h4>  Basic implementation (code) </h4><br><br><img src="https://habrastorage.org/storage2/4e0/bb9/d80/4e0bb9d80ce4a313672381c26dc980c3.jpg"><br>  <i>The entire system is assembled during testing.</i> <br><br>  Our DHT22 is connected to 2 analog pins, IR LED to 3 (the one with pwm). <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;dht.h&gt; #include &lt;SPI.h&gt; #include &lt;Ethernet.h&gt; #include &lt;IRremote.h&gt; #define DHT22_PIN 2 dht DHT; byte mac[] = {0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED }; byte gateway[] = {192, 168, 1, 1 }; byte subnet[] = {255, 255, 255, 0 }; IPAddress ip(192, 168, 1, 220); float MAX_TEMP = 25.0; float MIN_TEMP = 22.0; int MAX_HUMID = 60; int MIN_HUMID = 40; int last_condey_status = 0; unsigned int TurnCondeyOff[68] = {2700,2600,750,700,700,700,700,700,750,700,750,700,750,650,750,700,700,700,750,700,750,650,750,700,700,700,750,700,700,700,700,700,750,700,700,700,750,650,750,700,750,700,700,700,750,650,750,700,700,700,750,650,750,700,750,700,750,700,700,2000,750,2000,750,1950,750,2000,750}; unsigned int TurnCondeyMaxOn[68] = {2650,2650,750,2000,750,700,700,700,700,700,750,700,700,700,750,650,750,700,750,700,700,700,700,700,750,700,700,700,750,650,750,700,700,700,750,700,700,700,750,700,700,700,750,650,800,700,700,750,700,650,750,700,700,700,750,650,800,650,750,700,700,2000,750,1950,750,2000,750}; unsigned int TurnCondeyWaterOn[68] = {2650,2650,750,2000,750,700,700,700,700,700,750,700,700,700,750,650,750,700,750,700,700,700,700,700,750,700,700,700,750,650,750,700,700,700,750,700,700,700,750,700,700,700,750,650,800,700,700,750,700,650,750,700,700,700,750,650,800,650,750,700,700,2000,750,1950,750,2000,750}; unsigned int TurnCondeyAuto[68] = {2650,2650,750,2000,750,700,700,700,700,700,750,700,700,700,750,650,750,700,750,700,700,700,700,700,750,700,700,700,750,650,750,700,700,700,750,700,700,700,750,700,700,700,750,650,800,700,700,750,700,650,750,700,700,700,750,650,800,650,750,700,700,2000,750,1950,750,2000,750}; IRsend irsend; int dht_status = 0; char serverName[] = "myserver.ru"; byte server[] = {192, 168, 1, 5 }; EthernetClient client; void setup() { Serial.begin(9600); Serial.print("LIBRARY VERSION: "); Serial.println(DHT_LIB_VERSION); delay(1000); Serial.println("Try to configure Ethernet using DHCP..."); // start the Ethernet connection: if(Ethernet.begin(mac) == 0) { Serial.println("Failed to configure Ethernet using DHCP. Using manual config."); Ethernet.begin(mac, ip, gateway); } PrintIPtoSerial(); } void loop() { Serial.println("status,\tHumidity (%),\tTemperature (C)"); // READ DATA int chk = DHT.read22(DHT22_PIN); switch (chk) { case DHTLIB_OK: dht_status = 200; Serial.print("OK,\t"); break; case DHTLIB_ERROR_CHECKSUM: dht_status = 501; Serial.print("Checksum error,\t"); break; case DHTLIB_ERROR_TIMEOUT: dht_status = 504; Serial.print("Time out error,\t"); break; default: dht_status = 500; Serial.print("Unknown error,\t"); break; } // DISPLAY DATA Serial.print(DHT.humidity, 1); Serial.print(",\t"); Serial.println(DHT.temperature, 1); SendDataToServer(dht_status, DHT.temperature, DHT.humidity); WorkWithCondey(DHT.temperature, DHT.humidity); Serial.println(); delay(1000); } boolean SendDataToServer(int d_stat, float temp, int humidity) { if (client.connect(server, 80)) { char buf[80]; int temp1 = (temp - (int)temp) * 100; int humidityl = (humidity - (int)humidity) * 100; Serial.println("Sending information to weather server"); // Make a HTTP request: sprintf(buf, "GET /meteo.php?S=%d&amp;T=%0d.%d&amp;H=%0d.%d&amp;CS=%d HTTP/1.1", (int)d_stat, (int)temp, abs(temp1), (int)humidity, abs(humidityl), last_condey_status); client.println(buf); client.println("Host: myserver.ru"); client.println("Connection: close"); client.println(); client.stop(); return true; } else { // if you didn't get a connection to the server: Serial.println("Connection to weather server failed"); client.stop(); return false; } } void WorkWithCondey(float temp, int humidity) { int status = 0; if(temp &gt; MAX_TEMP) { status=1; } if(temp &lt; MIN_TEMP) { status=0; } if(humidity &gt; MAX_HUMID) { status = status+3; } if(humidity &lt; MIN_HUMID) { status = status; } String condey_text_status = ""; if(status != last_condey_status) { last_condey_status = status; if(status == 0) { irsend.sendRaw(TurnCondeyOff,68,38); } if(status == 1) { irsend.sendRaw(TurnCondeyMaxOn,68,38); } if(status == 3) { irsend.sendRaw(TurnCondeyWaterOn,68,38); } if(status == 4) { irsend.sendRaw(TurnCondeyAuto,68,38); } } Serial.print("Condition status: "); Serial.println(status); } void PrintIPtoSerial() { Serial.print("My Local IP address: "); Serial.println(Ethernet.localIP()); }</span></span></span></span></code> </pre><br></div></div><br>  This code looks at the temperature sensor, sends data to my server (also sends the latest status of the air conditioner until it is processed, but may be useful), also the WorkWithCondey function is called which checks the sensor data and decides whether or not the condo is turned on and which mode.  On the server side, I have a simple php script that accepts a get request with data (only from local ips from the allowed list).  He saves this data to the database (while mongodb), and writes the data to a file, this file is available on the Internet, and I wrote a small C # program that reads this data and outputs it in On Screen Display (OSD) mode, i.e.  text on top of all windows with no background.  What I plan to optimize in this whole scheme, see the section here.  If you use my code, do not forget to replace myserver.ru with your data. <br><br>  Information after casting the sketch: <br> <code>Binary sketch size: 22 034 bytes (of a 32 256 byte maximum) - 68% used</code> <br> <br><div class="spoiler">  <b class="spoiler_title">And that's what the output port com</b> <div class="spoiler_text">  LIBRARY VERSION: 0.1.05 <br>  Try to configure Ethernet using DHCP ... <br>  My Local IP address: 192.168.1.107 <br>  status, Humidity (%), Temperature ¬© <br>  OK 67.5, 26.2 <br>  Sending information to weather server <br>  Condition status: 4 <br><br>  status, Humidity (%), Temperature ¬© <br>  OK 67.4, 26.3 <br>  Sending information to weather server <br>  Condition status: 4 <br><br>  status, Humidity (%), Temperature ¬© <br>  OK 67.4, 26.3 <br>  Sending information to weather server <br>  Condition status: 4 <br><br>  status, Humidity (%), Temperature ¬© <br>  OK 67.4, 26.3 <br>  Sending information to weather server <br>  Condition status: 4 <br><br>  status, Humidity (%), Temperature ¬© <br>  OK 67.4, 26.4 <br>  Sending information to weather server <br>  Condition status: 4 <br><br>  status, Humidity (%), Temperature ¬© <br>  OK 67.3, 26.3 <br>  Sending information to weather server <br>  Condition status: 4 <br><br>  status, Humidity (%), Temperature ¬© <br>  OK 67.3, 26.4 <br>  Sending information to weather server <br>  Condition status: 4 <br><br>  status, Humidity (%), Temperature ¬© <br>  OK 67.2, 26.4 <br>  Sending information to weather server <br>  Condition status: 4 <br></div></div><br>  As can be seen from the log, we have the status of the air conditioner "4".  If you look at the source code, then under status 4, the automatic conditioner conditioner condition works for us, which is understandable, because the humidity according to logs is 67.2% and the temperature is 26.4 degrees.  If you bring the sensor to the airflow of the air conditioner, the status changes to 0, i.e.  air conditioner is disabled. <br><br><h4>  Total </h4><br><img src="https://habrastorage.org/storage2/71d/9ea/bf8/71d9eabf8f478fa3874fad87abd9fde2.jpg" width="600"><br>  <i>The entire system is assembled on the shelf from where it controls the air conditioner.</i> <br><br>  We have arduino, ethernet shield, ir led, tsop sensor, air conditioning - and it all works automatically.  While I was experiencing it for 2 days (at the weekend), several bugs in the sketch were fixed, it seems there are no failures yet. <br><br><h4>  TODO! </h4><br>  So, the list of what is planned to be implemented: <br>  1. Change the data file to Memcache, so as not to torment the file system.  Keep the last 5 entries in the memcache just in case <br>  2. Change the database from MongoDB to Mysql (or something else, there is simply no point in the monge, it stood, but there were no other bases, and it was too lazy to bet) <br>  3. To write to the database to use the queue (or Apache MQ or other analogues). <br>  4. Divide the system into 3 parts: arduino with ezernt and RL24L01, board with temperature sensor (2313 tyinka) and RF24L01, infrared LED board (2313) and RF24L01.  This is necessary to reduce the size, so that it is unnecessary to connect everything only to the Arduine, and work through the air. <br>  5. Come up with another air exchange, but so far there is not even thought how to do it better (advise in the comments, I will be very happy). <br>  6. In connection with the birth of the child (he was only one month old) I ordered a feast sensors (Ik presence sensor), I do not know how well it will work.  When a child (well, in general when finding a person in the room) you need not to include a condo.  Plus, the corresponding status will be sent to the script that people are in the room. <br>  7. Modify a cheap humidifier so that it can be connected to this system.  There will go the board with NF24L01, 2313 mink and a simple relay.  Since  This humidifier has only two modes: On and Off, and then from the button :) <br><br>  NF24L01: <br><img src="https://habrastorage.org/storage2/705/85b/d08/70585bd08a53d153be7bdfcaf75e75fe.jpg" width="300"><br><br>  PIR Sensor: <br><img src="https://habrastorage.org/storage2/d42/b32/fbf/d42b32fbf42e55706b1e42a8587e78bc.jpg" width="300"><br><br><h4>  Thanks </h4><br>  Habra - for the platform, where I can share my personal experience, and add knowledge <br>  <a href="https://geektimes.ru/users/dihalt/" class="user_link">DIHALT</a> - for interesting articles, thanks to which I joined DIY <br>  <a href="http://playground.arduino.cc/Main/DHTLib">arduino playground</a> - for the library to work with DHT sensors <br>  <a href="https://github.com/shirriff/Arduino-IRremote">shirriff</a> - for the library for working with IR signals <br>  China - for cheap components and sensors <br>  You, dear reader, for what I read to the end :) <br>  And of course, my wife for a son and a magic kick in the ass for the realization of this idea. <br><br><h4>  Files </h4><br>  <a href="http://yadi.sk/d/XBZfiVRV6I2yq">My sketch above (just in case)</a> <br>  <a href="http://playground.arduino.cc/Main/DHTLib">Library for DHT22 (Arduino site)</a> <br>  <a href="http://yadi.sk/d/Uwz4GOPA6I2L6">Datasheet on dht22</a> <br>  <a href="http://yadi.sk/d/7GBDnmwq6I2I4">Datasheet on TSOP31256 which i use</a> <br>  <a href="">Library for working with IR (github)</a> <br><br>  <b>Upd.</b>  Added photos, added and updated connection diagrams.  Added datasheet.  Updated sketch code (small fix).  Corrected a link to the library DHT22 &amp; DHT11. <br>  <b>Upd.</b>  <b>2</b> - Updated the final arduino connection scheme.  (Resistors added, thanks for the <a href="https://geektimes.ru/users/siorinex/" class="user_link">Siorinex</a> hint) <br><br>  I hope you liked the article, leave feedback and suggestions in the comments.  I will be glad to constructive criticism.  And I agree right away, an article for newbies from a newbie in this business.  On the weekend I will shoot a video of how it all works with a full description and demonstration. </div><p>Source: <a href="https://habr.com/ru/post/184966/">https://habr.com/ru/post/184966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184956/index.html">Parsing a CSV file with bash and awk</a></li>
<li><a href="../184958/index.html">Drawings in SVG format. Part 1 - Draft Standard</a></li>
<li><a href="../184960/index.html">Self build cURL for iOS and Android</a></li>
<li><a href="../184962/index.html">Travel book tester</a></li>
<li><a href="../184964/index.html">Setting up your own GIT / SVN / Mercurial server based on SCM Manager for Tomcat under Debian</a></li>
<li><a href="../184968/index.html">Rovnix bootkit update. Article translation</a></li>
<li><a href="../184970/index.html">Driver for PostgreSQL on Node.js</a></li>
<li><a href="../184972/index.html">Instead of passwords tattoo and ... pills</a></li>
<li><a href="../184974/index.html">Please support the symbol of domestic currency</a></li>
<li><a href="../184978/index.html">1C + offline maps on Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>