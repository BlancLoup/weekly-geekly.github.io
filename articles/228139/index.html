<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we stopped being afraid of Ogre and started making a game on it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How to make mistakes. 2011 
 As the name implies, back in 2011 we made the third mistake, choosing Ogre3D as the basis for the game engine. The third,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we stopped being afraid of Ogre and started making a game on it</h1><div class="post__text post__text-html js-mediator-article"><h4>  How to make mistakes.  2011 </h4><br>  As the name implies, back in 2011 we made the third mistake, choosing Ogre3D as the basis for the game engine.  The third, because the first mistake was the decision to make the game, and the second was to make it on your engine.  Fortunately, these were the very mistakes that the fascinating story begins with.  This is an adventure in which we have gone almost the entire way of the development of game engines, as the embryo goes through all stages of evolution. <br>  Of course, like all novice developers, we had little idea what we were going to do and why.  We were driven by the desire to tell your story, create your own fictional world, your universe, and on the wave of MMO popularity, the natural urge was to make your MMO with blackjack and everything owed.  The urge happened back in 2010, and by 2011 the first version of dizdoc was ready.  The earth was formless and empty, and darkness over the abyss, and the Spirit of Fallout, soared above us. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/26d/686/f1a/26d686f1ac05a4372a3c3d38c6e1f5b5.jpg"><br><br>  We went through trial and error, collecting all the jambs and rakes along the way.  Like most projects, we started with the simplest.  In terms of graphics (and I will only talk about the graphic part), the first version of the engine allowed using only a diffuse map and stencil shadows. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/706/7b4/c6a/7067b4c6af651bd1d5e4b20ca56a37d4.jpg" alt="image"><br><br><h6>  2011  One of the first screenshots </h6><br><br>  Technologically, the graphics then we strongly focused on games like Torchlight.  But the soul demanded more, because in parallel with the development of the graphic part of the engine was an artistic search. <br><br>  By the fall of 2012, in terms of graphics, we have grown to use normal maps and speculators.  The influence of DOOM 3 was strong on immature minds of novice developers. <br><img src="https://habrastorage.org/getpro/habr/post_images/23d/6cb/a47/23d6cba470b80d8fff579d4cfa2be4e6.jpg"><br><h6>  2012  To DOOM 3 as to Mars. </h6><br><br><h4>  How to choose between a pipe and a jug.  2013 </h4><br>  In the winter of 2013, the team has grown into a beautiful 3d-maker and a charming graphics programmer.  The fantasies of the leading artist found a foothold, and the engine began to grow with graphic innovations.  There was a gloss texture (it is also a power factor specular map, it is glossiness, it is shininess), cascading textural shadows, DoF (depth of field effect), RIM lighting and a bunch of glitches.  During this period, communications problems of various specialists began to emerge especially clearly.  The same things for developers with different backgrounds were called quite differently, and required repeated pronouncement. <br>  Increasingly, hot battles began to be started on the trajectory of the development of the engine.  In conditions of limited budget and time, one had to choose between programming the gameplay part and the visual part.  So, RIM appeared as a compromise between the desire of the artist to see more obvious metal, the desire of the three-man to have reflections for this and the current capabilities of the engine.  The question of switching to a ready-made engine began to get more acute: Unity3D became more and more functional and popular, rumors about human licensing schemes for UDK began to appear. <br><habracut><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/8c8/99a/ffd8c899a7c1cf6ccd9e06e44d65bd78.jpg"><br><h6>  The beginning of 2013  The picture became a little more fun, but not much. </h6><br><br><img src="https://habrastorage.org/getpro/habr/post_images/410/7c5/e8f/4107c5e8f3b02be8e0094f18bebba8d0.jpg"><br><h6>  The end of 2013.  The picture has become even more fun. </h6><br><br><h4>  How to run into trouble.  2013 </h4><br>  In the autumn of 2013.  We first went on a kickstarter.  Evidence of this sad experience flashed even on Habr√©.  We covered the campaign during the first week, since it became obvious that it would not take off.  MMOs at this point began to irritate the gamers, the next ‚ÄúWoW clone‚Äù (by no means it was not planned to play the game, but it wasn‚Äôt possible to convince gamers of this).  As a work on the bugs, it was decided that we now make an RPG single with a cooperative passage. <br><img src="https://habrastorage.org/getpro/habr/post_images/706/515/362/7065153622c31d494e9dffa2cc84670a.jpg"><br><h6>  The end of 2013.  Screenshot from presentation scene .. </h6><br><br><h4>  How to gain freedom.  2014 </h4><br>  The fantasy of a leading artist required large and complex spaces.  The realization of these fantasies and the leading 3D artist required the ability to operate not with five light sources, but with a much larger number of them. <br>  The limit of 5 (actually 8, but the FPS sagged on the fifth) was due to the use of forward render (direct render) <br>  Direct rendering is a standard rendering method that most engines use.  Each object received by the video card passes the full rendering path.  In this case, the vertex and pixel shaders are considered for each light source separately, even for those pixels that may later overlap with others.  Each additional light source creates an additional iteration of calculations over the entire geometry.  And with eight light sources in the scene, about 9 million triangles are drawn from 1 million visible triangles.  This led to very low FPS at any difficult locations ... <br><br>  The ghost of Kruzis with his hundreds of light bulbs kept me awake at night.  It was decided to switch to deferred render (deferred render or deferred rendering).  With a deferred render, a set of ‚Äúfinal‚Äù images is formed without calculating the shadows: an image of color, an image of depth and an image of normals.  Knowing the position of the light sources, the depth of the pixels and the normal, you can calculate the shading. <br>  Compared to forward-rendering, we got a few goodies: <br>  1) Increasing FPS due to the fact that geometry is rendered only once <br>  2) Ability to work with multiple light sources: adding a new light source has little effect on performance. <br>  3) Acceleration of some types of post-processing, more efficient implementation of soft particles and the ability to add screen-space reflection processing.  Soft particles, as well as post-processing effects (DOF, SSR, SSAO) require depth and normal maps.  Direct rendering does not give these maps, and they have to be rendered separately.  With deferred lighting, these cards are served to us on a silver platter. <br><br>  Disadvantages: <br>  1) Translucency.  Translucent objects can not be drawn in the deferred lighting, because  It will require that one pixel of each texture (normal, diffuse, etc.) contain information about several overlapping objects.  There are many different ways to solve the problem, but most often one is used - all translucent objects are rendered separately using direct rendering. <br>  2) Aliasing.  With deferred lighting, fsaa is disabled and all triangles are drawn with pronounced aliasing.  Various methods are used to solve this problem, for example, FXAA <br>  3) Increased memory bandwidth requirement of the video card. <br><br>  We considered three options for the implementation of deferred lighting: <br><h6>  Option A: </h6><br><img src="https://habrastorage.org/getpro/habr/post_images/da4/4e6/ac5/da44e6ac51dae681bcfd81cb08ae5606.jpg"><br>  The calculation of lighting is divided into two stages: <br>  1. At the first stage, the whole opaque geometry is drawn in 4 textures.  (diffuse, specular, glossiness, normal, depth map and glow map) <br>  -diffuse, specular, glossiness are taken directly from the geometry textures, <br>  -Normals are extracted from the normal map stretched on the geometry and converted into the coordinates of the camera space. <br>  - The glow card is obtained by adding self-irradiation maps, RIM lighting, ambient diffuse lighting + weak backlight from the camera side. <br>  2. Using the normal, depth, diffuse, specular and gloss maps, the diffuse and specular luminescence of each point for each light source is calculated and incrementally added to the luminance map.  In the same pass, each point on the screen is checked into shadow maps. <br><br>  This is a standard option for deferred lighting, implemented in most games. <br><br><h6>  Option B: </h6><br><img src="https://habrastorage.org/getpro/habr/post_images/e02/5e2/979/e025e29793b6480effe491ddd3c413a3.jpg"><br>  Calculation of lighting is divided into 3 stages: <br>  1. At the first, all opaque geometry is rendered in 1 texture (normal, depth and gloss maps are rendered) <br>  2. Two maps are rendered according to the normal, depth and gloss maps: diffuse and specular lighting for each light source. <br>  3. At the third stage, the final image is rendered: the whole opaque geometry is drawn once again, but the illumination of each point is calculated with diffusion and specular by multiplying the diffuse illumination by the diffuse card + the specular illumination product by the specular card + rome illumination + self-emitting map + light from cameras. <br><br>  The advantages of this method are: <br>  1) Fewer video card bandwidth requirements. <br>  2) Less computational operations for each light source, since  some operations go from the second stage to the third. <br>  3) The third stage can already be released with fsaa on, which increases the picture quality. <br><br>  The disadvantage of this method is to render all geometry once or twice.  However, the second time you can render on the ready z-buffer, prepared at the first stage. <br><br><h6>  Option B: </h6><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e0/63f/c2b/3e063fc2b8050df97c00285906e175d0.jpg"><br><br>  Calculation of lighting is divided into 3 stages: <br>  1. At the first stage, all opaque geometry is drawn in 4 textures (diffuse, specular, glossiness, normal, depth map and glow map (as the sum of self-irradiation maps added, RIM illumination, ambient diffuse illumination + weak backlight from the camera)). <br>  2. Two maps are rendered according to the normal, depth and gloss maps: diffuse and specular lighting for each light source. <br>  3. At the third stage, the final image is rendered: the illumination of each point is calculated by multiplying the diffuse illumination by the diffuse map + the specular illumination product by the specular map of the self-irradiation map ... <br><br>  This option is a mixture of the first two options.  Compared with option A, we get a gain in speed due to the peculiarity of option B: instead of four samples from the texture, there is only one. <br><br>  Now we have implemented the first version of the postponed meeting.  All channels that are used to draw the final image can be displayed in debug mode. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/119/9df/679/1199df6797ad0c9a7af6bb75ad88ab59.jpg"><br><br>  After rendering the final image post-processing is done: here we have the effect of depth of field and color correction is done.  At the same stage, reflections are drawn using the SSR technology. <br><br>  SSR (Screen Space Reflection) is an algoritm of creating realistic reflections in a scene using data that has already been rendered on the screen.  Briefly: from the camera the beam starts up to intersection with the scene.  Using the normal at the intersection point, the reflection is considered.  Along this ray of reflection, a depth map is traced until, until it hits any geometry, the luminosity of the found point is taken as a result and multiplied by the specular of the reflecting point and recorded into the luminosity of the reflecting point. <br>  Two Screen Space Reflections algorithms are now implemented: <br>  1) Tracing occurs in camera coordinates - slow, but giving the correct picture. <br>  2) Tracing occurs in texture coordinates - fast but gives an error at low angles. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f21/24c/f02/f2124cf02407698c9e0d3e6474332ac4.jpg"><br><h6>  2014  Presentation diorama with reflections included. </h6><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd7/dd1/97d/bd7dd197de4d3a1bc52387068efaef36.jpg"><br><h6>  2014  Presentation diorama with reflections included. </h6><br><br>  We use our game and network engines.  Graphics engine - Ogre3D, Physical - Bullet.  Scripting: Lua, C # (Mono).  During development, we had to finish Ogre3D heavily and debug its bundle with Blender ... There are plans to contact Ogra developers and offer to include our improvements in the following Ogra builds. <br><br><habracut text=""><br>  Used programming languages: C ++, PHP, Lua, C #, Python, Java, Groovy, Cg, GLSL, HLSL. </habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/228139/">https://habr.com/ru/post/228139/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228123/index.html">Online Store Migration: Testing Your Shop on a Different Platform</a></li>
<li><a href="../228125/index.html">Reactive programming for Android</a></li>
<li><a href="../228131/index.html">The infrastructure processing queues in the social network My World</a></li>
<li><a href="../228135/index.html">Ribs.js - nested attributes, computed fields and binding for Backbone.js</a></li>
<li><a href="../228137/index.html">Charles Herzfield: Director of DARPA and the Godfather of ARPANET</a></li>
<li><a href="../228141/index.html">Mojolicious Documentation: Lost Chapters</a></li>
<li><a href="../228145/index.html">Bare Fridays # 1</a></li>
<li><a href="../228147/index.html">How to make money on an indie game</a></li>
<li><a href="../228149/index.html">Office 365 Cloud Business Apps</a></li>
<li><a href="../228151/index.html">My implementation of "smart home"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>