<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Migrating an outdated information system to the CUBA platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The rapid development of technologies and software development tools leads to the fact that the technologies underlying the information system, lose t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Migrating an outdated information system to the CUBA platform</h1><div class="post__text post__text-html js-mediator-article"><p> <a href="https://habrahabr.ru/company/haulmont/blog/324226/"><img src="https://habrastorage.org/files/6d2/705/126/6d27051263df4f1c915071e742c57976.png"></a> </p><br><p>  The rapid development of technologies and software development tools leads to the fact that the technologies underlying the information system, lose their relevance and become a heavy burden.  Take, for example, some development of a company for automating processes, written in Visual Basic 6.0 or Delphi 7, which, to put it mildly, does not combine with the new trends ‚Äúall on the web, everything in the clouds‚Äù, and does not correspond to the ambitions of the developers. </p><br><p>  The problem of transferring old IP to new technologies, reaching the leadership, traditionally rests on money: ‚Äúlet's live and so on ...‚Äù.  For developers, in turn, already transferring the data model and the template programming of standard screens causes a negative.  At the same time, it is often complicated by the requirement to preserve the health of the old IS at the stage of developing and implementing a new one.  One way or another, in my experience, the product either dies completely, causing torture of both programmers and users, or the understanding still comes that updating the IP is an urgent need. </p><br><p>  Based on the problems described, as well as the increasing requests as a platform vendor to help migrate legacy systems to <a href="https://www.cuba-platform.com/">CUBA</a> , we decided to add a mechanism that would make this process as easy as possible for programmers and cheap for management. </p><br><p>  <i>Under the cat step by step instructions on how to upgrade an outdated system with minimal effort to transfer the data model and standard CRUD screens.</i> </p><br><a name="habracut"></a><br><p>  To demonstrate the migrator, which since version 2.1 is presented in CUBA Studio, we have prepared step-by-step instructions on how to upgrade an outdated system, minimizing efforts to transfer the data model and standard CRUD screens.  Since <a href="https://blogs.msdn.microsoft.com/lightswitch/2016/10/14/lightswitch-update/">Microsoft officially stopped supporting LightSwitch</a> , a popular tool for the rapid development of corporate information systems, we chose the <a href="https://msdn.microsoft.com/en-us/library/ee256749.aspx">LightSwitch Vision Clinic demo application</a> and transferred it to the CUBA platform and posted it on <a href="https://github.com/cuba-platform/cuba-vision-clinic">GitHub</a> with a <a href="https://github.com/cuba-platform/cuba-vision-clinic/wiki">detailed description of the</a> actions taken.  If you have a need or experience in software upgrading, we invite you to follow the suggested example. </p><br><p>  We will use the migrator built into <a href="https://www.cuba-platform.com/development-tools">CUBA Studio</a> for reverse engineering.  It extracts metadata from the old database and uses them to automatically: </p><br><p>  1. Generate a data model based on the existing database </p><br><p>  2. Update the database to create the necessary CUBA Platform system tables, </p><br><p>  3. Generate a standard CRUD UI. </p><br><p>  Thus, the main routine takes on CUBA Studio.  However, business logic and screen design, which is different from the standard one, must be manually transferred to the new application. </p><br><p>  If you are just curious to see what we got in the end, scroll to the section <a href="https://habr.com/ru/company/haulmont/blog/324226/">Can I run the application without MSSQL?</a> </p><br><p></p><h3>  A couple of words about the original application </h3><br><p>  Now that is the legacy application that we have chosen as a victim for migration.  We downloaded a demo application for an abstract eye clinic <a href="https://msdn.microsoft.com/en-us/library/ee256749.aspx">from the official Microsoft website</a> .  It is written in the Microsoft Lightswitch development environment, which Microsoft officially <a href="https://blogs.msdn.microsoft.com/lightswitch/2016/10/14/lightswitch-update/">discontinued</a> several months ago. </p><br><p>  In fact, this is a standard 3-layer application that demonstrates the main pieces of LightSwitch: the creation of a data model, screen scaffolding and calculated attributes of entities.  The VisionClinic example stores data simultaneously in 2 different databases connected to each other.  To simplify, we merged these two bases into one. </p><br><p>  CUBA system tables will be created in the same database.  These changes will not affect the tables used by the old LightSwitch application, so it can be run on the same database instance. </p><br><p><img src="https://habrastorage.org/files/042/417/6e9/0424176e9b484f86a4e93752e6f52fd8.png"></p><br><p>  <i>Note: Legacy DB can be connected to CUBA application as <a href="https://doc.cuba-platform.com/manual-6.3/data_store.html">an additional datastore</a> .</i>  <i>In this case, the old database will remain completely unchanged, and the Cuban tables will be stored separately.</i> </p><br><p>  This is what the Lightswitch UI looks like.  We liked the Products list screen the most - it is a bit more complicated than the rest: </p><br><p><img src="https://habrastorage.org/files/e6b/c8d/482/e6bc8d482a6745c48cfa395bdd12699b.png"></p><br><p>  In general, this is the classic layout of the enterprise screen: the top is the main menu, the screens open as new tabs in the same window.  If you want, you can create it yourself <a href="https://msdn.microsoft.com/en-us/library/ee256749.aspx">according to the instructions</a> , or just <a href="https://code.msdn.microsoft.com/windowsdesktop/Visual-Studio-LightSwitch-c8e92df4">download it</a> .  We only need a database from the entire application.  How to install it is described in detail in the appropriate section. </p><br><p></p><h3>  CUBA based application </h3><br><p>  Looking ahead, I will say that we want to get in the end.  We will create a fully functional Java application, traditionally consisting of 3 layers, with a full-fledged web client, repeating the UI and business logic of the original Lightswitch application.  As already mentioned, the application will not change the structure of existing tables, so that both applications will be able to work in parallel on the same database instance. </p><br><p>  The screenshot below shows the same product screen, but already in the CUBA application, you can compare: </p><br><p><img src="https://habrastorage.org/files/726/f75/47f/726f7547f2164475a6b15b27f607bd59.png"></p><br><p></p><h3>  Step 1. Install the Environment and Database </h3><br><p>  1. Download and install the CUBA platform according <a href="https://doc.cuba-platform.com/manual-6.4-ru/setup.html">to the Installation Instructions</a> from the platform documentation. </p><br><p>  2. Download and install MS SQL Server 2012+ from the <a href="https://www.microsoft.com/en-US/download/details.aspx%3Fid%3D43351">official site</a> .  Skip this step if you already have a server installed. </p><br><p>  3. Run the <a href="">create-db.sql script</a> on the MS SQL DB instance to create the VisionClinic database. </p><br><p>  4. Run the <a href="">insert-data.sql script</a> on the newly created VisionClinic database to fill it with test data. </p><br><p>  5. Enable SQL Server and Windows Authentication mode and log on as the <i>sa</i> user, as shown <a href="https://msdn.microsoft.com/en-us/library/ms188670.aspx">here</a> .  Remember the password for <i>sa</i> , it will be needed to connect to the database from the CUBA application. </p><br><p></p><h3>  Step 2. Creating a project on CUBA </h3><br><p>  1. Launch the CUBA Studio server (1) and open the Studio in the browser (2). </p><br><p><img src="https://habrastorage.org/files/efd/746/8cd/efd7468cdb23492fa4b0327d154cf40e.png"></p><br><p>  2. Create a new project (1), enter the <i>vision-clinic</i> in the project name field (2) and click OK. </p><br><p><img src="https://habrastorage.org/files/bf1/164/bec/bf1164bec22c4f888baabf9060375880.png"></p><br><p>  3. In the <b>Project properties</b> section we establish a connection to the VisionClinic database and fill in the following fields: </p><br><ul><li>  Database type - <i>Microsoft SQL Server 2012</i> , here indicate your installed version (1) </li><li>  Database URL - <i>localhost</i> , or domain name / IP of the computer with installed SQL Server (2) </li><li>  Database name - <i>visionclinic</i> , this name was created when the <a href="">create-db.sql</a> script was <a href="">executed</a> in step 1, paragraph 3 (3) </li><li>  Database user and Database password - use your login parameters for the sa in the SQL server, or another user with administrator rights (4) </li></ul><br><p><img src="https://habrastorage.org/files/354/787/1c2/3547871c252747f68f1886d7331e3894.png"></p><br><p>  4. Click <b>Test connection</b> (1) and check if Studio has connected to the database we need.  After receiving the message <b>Connection successful</b> (2), click OK (3) to save the entered parameters. </p><br><p><img src="https://habrastorage.org/files/6e2/e69/164/6e2e6916440f41cc84e3bf5d92967dc8.png"></p><br><p></p><h3>  Step 3. Migrator - Data Model and CRUD UI Generation </h3><br><p>  In this step, we will generate a data model (that is, an entity) based on the structure of the existing database, and a simple user interface for data manipulation. </p><br><p>  1. Go to the DATA MODEL tab and click on the Generate model link. </p><br><p>  2. CUBA Studio will request a database update to create its own tables, necessary for the operation of the platform, such as: security settings, state auditing, dynamic attributes, etc.  Confirm the update. </p><br><p><img src="https://habrastorage.org/files/c0a/287/998/c0a28799895e417d880b7752bd7757e5.png"></p><br><p>  3. The GENERATE MODEL FROM DATABASE window appears.  Here we will configure the mapping of database tables and their columns to entities and their fields. </p><br><p>  4. Click on the Settings button in the top panel to configure general mapping parameters.  In our demo application, both frameworks allow you to track who created or modified an entry in the database, so we link the predefined Cuban fields createTs, createdBy, updateTs, updatedBy with the corresponding system columns in the existing database, which are in almost all its tables: Created (1), CreatedBy (2), Modified (3), ModifiedBy (4). </p><br><p>  RowVersion (5) is another system column that is used in Lightswitch for optimistic locking.  Unfortunately, it cannot be tied to the version column used in the platform for the same purpose, since the types of these fields do not match.  To support optimistic locking in the CUBA application, you can create another field, but since we decided not to change anything in the table structure, we simply remove this column from the mapping and click OK. </p><br><p><img src="https://habrastorage.org/files/d71/5c2/29e/d715c229efbc4efabd64012f2d0eef6c.png"></p><br><p>  5, Click on the Show tables button in the top panel and select the tables by which entities will be created in the new application.  Select everything with the Select all button and remove the selection from sysdiagrams (1), this is the MS SQL service table in which the database schema is stored, we do not need it for migration.  Click Next (2). </p><br><p><img src="https://habrastorage.org/files/e24/e2f/750/e24e2f7505884b9f8c8fc5f1d61d9de8.png"></p><br><p>  6. At this stage, you can configure mapping more subtly, at the level of individual entities and their fields.  For example, CUBA provides that the names of all entities should be in the singular, since Studio generates the main UI strings based on them, such as screen names and menu item headers.  Therefore, we rename the entities, removing the inheritance of the plural from everywhere.  Select the Appointments table, click on the Edit mapping button, edit the class name and save the changes by clicking OK. </p><br><p><img src="https://habrastorage.org/files/cbc/337/960/cbc3379609a5439a80724d6d31bd0e71.png"></p><br><p> 7. Repeat this step for other entities that have a plural in the name: InvoiceDetails, Invoices, and Patients. </p><br><p>  8. Also at this stage, you can specify for the entity its Instance Name - a string representation of the entity (record) to which it will be represented in the UI, for example, in table cells or drop-down lists.  Select the Product table, click Edit mapping, select the ProductName attribute in the Instance name field and click OK. </p><br><p><img src="https://habrastorage.org/files/0d7/2ec/a77/0d72eca7743f46d0ae26c18e6799262b.png"></p><br><p>  9. All these parameters can be corrected later, so it‚Äôs not scary if we missed something or got it wrong somewhere.  Click Next. </p><br><p>  10. Now you can automatically create CRUD-screens for entities that provide access to data.  The CUBA platform offers several standard screen templates: </p><br><ul><li>  Browser - a screen for viewing a list of records from the database, by default it includes a data filter and pagination is supported; </li><li>  Editor - a screen for viewing and editing a single entry; </li><li>  Browser and Editor - just means that both screens will be created; </li><li>  Single screen - embeds the editor in the browser screen, so the list of all entries is displayed on the left, and the details of the selected entry are displayed on the right. </li></ul><br><p>  <i>Note: Starting from version 6.4, the platform supports the creation of custom screen templates.</i>  <i>Also, any screen can be subsequently edited in Studio and IDE.</i> </p><br><p>  11. Select the following templates and click Next: </p><br><p><img src="https://habrastorage.org/files/f39/575/b8e/f39575b8e6dd480b88ea2c573e42c4ad.png"></p><br><p>  We do not see any scripts on the screen of database update scripts.  Everything as we planned, the original table remains unchanged.  Click Save and wait for the platform to generate the data model and CRUD screens. </p><br><p></p><h3>  Step 4. First launch </h3><br><p>  Starting from this stage, we can already start the application and look at the newly created standard UI. </p><br><p>  1. Run the CUBA application with the Run - Start application command in the main menu. </p><br><p><img src="https://habrastorage.org/files/388/608/471/3886084714404368b49259cbede2cdd3.png"></p><br><p>  2. Click the Web client link in the lower left corner of Studio and go to the application that opens in a new browser tab. </p><br><p><img src="https://habrastorage.org/files/6ce/82c/6a6/6ce82c6a60bf45189bd2f500075ce555.png"></p><br><p>  3. The default login and password is admin / admin, confirm and enter the application. </p><br><p><img src="https://habrastorage.org/files/de1/5f9/19c/de15f919cef84abe95a58950b873084b.png"></p><br><p>  4. The screens we created are available from the Application menu at the top of the application. </p><br><p><img src="https://habrastorage.org/files/824/181/083/824181083b3e4d6d934915dd5e0f016b.png"></p><br><p>  5. Open the Products screen and see how it looks with the standard markup of the single screen template. </p><br><p><img src="https://habrastorage.org/files/af9/e5f/c8e/af9e5fc8e73f4e81b63fc14570aa42c3.png"></p><br><p>  Of course, it will take some time to transfer business logic and interface design, but at this stage we already have the first version of the cross-platform application, completely based on open-source technologies. </p><br><p></p><h3>  Further development </h3><br><p>  What to do with the application further, here you have complete freedom of choice.  The CUBA Platform does not prohibit changing the generated application code, as well as the source code of the platform itself.  You can also integrate any third-party technologies from the Java world into the application. </p><br><p>  For example, you may have noticed that on the standard Product view screen there is not enough information about discounts, a table of similar products and images.  Using the platform and CUBA Studio, you can easily bring the screen to the kind that it had in the original LightSwitch application. </p><br><p>  The source code for the augmented <a href="">Product entity</a> and <a href="">the Product screen descriptor</a> can be viewed in a project on GitHub.  I want to note that all changes in the entity declaration and screen descriptor were created in the CUBA Studio visual editor. </p><br><p><img src="https://habrastorage.org/files/748/b94/e05/748b94e05eac420684d93c1ae4e93523.png"></p><br><p>  All manual changes in the code are registered in the <a href="">screen controller</a> .  You can also see an example of creating calculated attributes in the source code of the Product entity (see <a href="">method Product # getCurrentPrice</a> ). </p><br><p></p><h3>  Can I run an application without MSSQL? </h3><br><p>  By default, our application on GitHub is configured for use with the lightweight HyperSQL Database.  Therefore, simply by tilting it from the repository, you can start it, and when you start it, Studio will create the required database itself.  True, this database will be empty, and you will have to fill it yourself through the user interface of the application. </p><br><p>  If you want to change the type of database used in CUBA Studio, this is implemented quite straightforwardly: to migrate to another DBMS, open the project settings in the Project Properties section and select the database type from the drop-down list.  Studio will create new scripts to create and update the database, and you can run the application from any selected database. </p><br><p><img src="https://habrastorage.org/files/5b7/1f9/2c4/5b71f92c43a64b729feea689b498a7b4.png"></p><br><p>  Summarizing, if you have a need or experience in software upgrading, we invite you to evaluate the tool and, possibly, suggest options for improving the migration mechanism.  We will be happy to receive feedback on our <a href="https://www.cuba-platform.ru/support/">support forum</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/324226/">https://habr.com/ru/post/324226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324216/index.html">Configuring web form functionality in MyTaskHelper: condition actions (triggers)</a></li>
<li><a href="../324218/index.html">How to create a product in 11 days</a></li>
<li><a href="../324220/index.html">NodeJS framework with Laravel syntax (and no noodles in code)</a></li>
<li><a href="../324222/index.html">Security defects that PVS-Studio team fixed this week: release N2</a></li>
<li><a href="../324224/index.html">Information for administrators of SED "Appeals of citizens"</a></li>
<li><a href="../324228/index.html">We write Java Stream API on the knee in a couple of minutes</a></li>
<li><a href="../324230/index.html">How to motivate users to stick to your product forever: Pope Gregory Framework</a></li>
<li><a href="../324232/index.html">Preparing a springboard for the react-application</a></li>
<li><a href="../324234/index.html">Security Week 11: 38 infected smartphones, FBI crying for encryption, Google again patched up Chrome</a></li>
<li><a href="../324236/index.html">MIPT launched an online course on innovative project management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>