<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Offline-first app with Hoodie & React. Part Two: Authorization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our goal is to write an offline-first application - SPA that loads and retains full functionality in the absence of an Internet connection. In the fir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Offline-first app with Hoodie & React. Part Two: Authorization</h1><div class="post__text post__text-html js-mediator-article"><p>  Our goal is to write an offline-first application - SPA that loads and retains full functionality in the absence of an Internet connection.  In the <a href="https://habrahabr.ru/post/309166/">first part of the</a> story, we learned how to use the browser database.  Today we will set up synchronization with the server database and connect the authorization.  As a result, we will be able to edit our data on different devices, even offline, with subsequent synchronization when a connection appears. </p><a name="habracut"></a><br><h2>  Couchdb </h2><br><p>  Yes, on the server we need this particular database.  Currently, <a href="https://github.com/pouchdb/pouchdb-server">Pouchdb-Server is</a> being actively developed, which based on <a href="https://github.com/google/leveldb">LevelDB</a> simulates the <a href="http://couchdb.apache.org/">CouchDB</a> API.  Hoodie works with it by default; this is done to make installation easier for beginners.  But he is even cheese for development purposes.  Maybe I was just lucky, but I spent 3 days trying to get Hoodie for the first time and bumping into strange errors, 3 days of issues and pull-request.  And on the verge of disappointment I decided to establish a normal CouchDB and all my problems were over.  Therefore, I suggest you immediately put the latter, unless you also want to make a feasible contribution to the opensource. </p><br><p>  In most distributions CouchDB put regular means. </p><br><div class="spoiler">  <b class="spoiler_title">If you are using debian too</b> <div class="spoiler_text"><p> Here is the <a href="http://verbally.flimzy.com/install-couchdb-1-6-1-debian-8-2-jessie/">instruction</a> that I used.  However, the database was constantly falling until I deleted <code>/etc/init.d/coucdb</code> and did not give it under the supervision of a supervisord, here‚Äôs the config file: </p><br><pre> <code class="hljs pgsql">[program:couchdb] <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>=couchdb environment=HOME=/usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/var/lib/couchdb command=/usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/bin/couchdb autorestart=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> stdout_logfile=<span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span> stderr_logfile=<span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span></code> </pre> </div></div><br><p>  Putting the base we create the admin: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">curl</span></span> -X PUT <span class="hljs-variable"><span class="hljs-variable">$HOST</span></span>/_config/admins/username -d <span class="hljs-string"><span class="hljs-string">'"password"'</span></span></code> </pre> <br><p>  And turn on CORS: </p><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -g <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-cors-<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>-couchdb <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-cors-<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>-couchdb -u username -p <span class="hljs-keyword"><span class="hljs-keyword">password</span></span></code> </pre> <br><p>  Now it only remains to correct the command to start the server in <code>package.json</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"server"</span></span>: <span class="hljs-string"><span class="hljs-string">"hoodie --port 8000 --dbUrl 'http://username:password@127.0.0.1:5984'"</span></span></code> </pre> <br><p>  I hope you did it all :) </p><br><h2>  Authorization </h2><br><p>  In AppBar, we will have an authorization icon with a context menu.  Therefore, we will render it into a separate component and will use it in <code>App.js</code> instead of <code>AppBar</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> NavBar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./NavBar'</span></span> &lt;NavBar account={hoodie.account} /&gt;</code> </pre> <br><p>  There we pass <code>hoodie.account</code> which provides us with an API for authorization: </p><br><ul><li> <code>hoodie.account.SignUp({username, password)}</code> </li> <li> <code>hoodie.account.SignIn({username, password)}</code> </li> <li> <code>hoodie.account.SingOut()</code> </li> </ul><br><p>  And events that you can subscribe to: </p><br><ul><li> <code>hoodie.account.on('signin', callback)</code> </li> <li> <code>hoodie.account.on('signout', callback)</code> </li> </ul><br><p>  And here is the component itself: </p><br><div class="spoiler">  <b class="spoiler_title">NavBar.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AppBar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/AppBar'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlatButton <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/FlatButton'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> IconButton <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/IconButton'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> IconMenu <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/IconMenu'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MenuItem <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/MenuItem'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KeyIcon <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/svg-icons/communication/vpn-key'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AccountIcon <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/svg-icons/action/account-circle'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AuthDialog <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./AuthDialog'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NavBar</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { <span class="hljs-attr"><span class="hljs-attr">isSignedIn</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.account.isSignedIn(), <span class="hljs-attr"><span class="hljs-attr">openedDialog</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> } } signOutCallback = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({<span class="hljs-attr"><span class="hljs-attr">isSignedIn</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}) signInCallback = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({<span class="hljs-attr"><span class="hljs-attr">isSignedIn</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.account.on(<span class="hljs-string"><span class="hljs-string">'signout'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.signOutCallback) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.account.on(<span class="hljs-string"><span class="hljs-string">'signin'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.signInCallback) } componentWillUnmount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.account.off(<span class="hljs-string"><span class="hljs-string">'signout'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.signOutCallback) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.account.off(<span class="hljs-string"><span class="hljs-string">'signin'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.signInCallback) } render () { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> authMenu; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.isSignedIn) { authMenu = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;IconMenu iconButtonElement={&lt;IconButton&gt;&lt;AccountIcon </span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/&gt;&lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">IconButton&gt;} targetOrigin={{horizontal: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'right'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, vertical: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'top'</span></span></span></span><span class="hljs-function"><span class="hljs-params">}} anchorOrigin={{horizontal: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'right'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, vertical: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'top'</span></span></span></span><span class="hljs-function"><span class="hljs-params">}} &gt; &lt;MenuItem primaryText=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Sign Out"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> onTouchTap={(</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.account.signOut()} /&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">IconMenu</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { authMenu = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;IconMenu iconButtonElement={&lt;IconButton&gt;&lt;KeyIcon </span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/&gt;&lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">IconButton&gt;} targetOrigin={{horizontal: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'right'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, vertical: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'top'</span></span></span></span><span class="hljs-function"><span class="hljs-params">}} anchorOrigin={{horizontal: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'right'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, vertical: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'top'</span></span></span></span><span class="hljs-function"><span class="hljs-params">}} &gt; &lt;MenuItem primaryText=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Sign Up"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> onTouchTap={(</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({<span class="hljs-attr"><span class="hljs-attr">openedDialog</span></span>: <span class="hljs-string"><span class="hljs-string">'signup'</span></span>})} /&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">primaryText</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Sign In"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onTouchTap</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.setState({openedDialog: 'signin'})} /&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">IconMenu</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;AppBar title=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Action Loop"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> showMenuIconButton={</span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params">} iconElementRight={authMenu} </span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/&gt; &lt;AuthDialog account={this.props.account} action={this.state.openedDialog} handleClose={() =&gt; this.setState({openedDialog: null})} /</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ) } }</span></span></span></span></span></span></code> </pre> </div></div><br><p>  In <code>state</code> , we have the current authorization status for drawing the icon and menu.  And the currently open dialogue (registration, entry, or <code>null</code> - if everything is closed).  In <code>componentDidMount</code> we subscribe to entry and exit events.  And in the <code>render</code> display the desired icon in accordance with the status of authorization.  It remains to draw an authorization dialog: </p><br><div class="spoiler">  <b class="spoiler_title">AuthDialog.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dialog <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/Dialog'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlatButton <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/FlatButton'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TextField <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'material-ui/TextField'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthDialog</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, }; } handleConfirm = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> account = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.account; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> username = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.username.trim(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.password.trim(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!username || !password) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.action == <span class="hljs-string"><span class="hljs-string">'signup'</span></span>) { account.signUp({username, password}) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> account.signIn({username, password}) }) .catch(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { account.signIn({username, password}) .catch(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error) } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.handleClose(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearState(); } handleCancel = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.handleClose(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clearState(); } handleSubmit = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleConfirm(); } clearState = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }) } render () { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buttons = [ &lt;FlatButton label="Cancel" primary={true} onTouchTap={this.handleCancel} /&gt;, &lt;FlatButton label="Submit" type="submit" primary={true} keyboardFocused={true} onTouchTap={this.handleConfirm} /&gt; ]; return ( &lt;div&gt; &lt;Dialog title={this.props.action == 'signup' ? 'Sign Up' : 'Sign In'} actions={buttons} modal={false} open={this.props.action !== null} onRequestClose={this.handleCancel} contentStyle={{maxWidth: 400}} &gt; &lt;form onSubmit={this.handleSubmit}&gt; &lt;TextField name="username" floatingLabelText="Username" onChange={(e) =&gt; this.setState({username: e.target.value})} /&gt; &lt;TextField name="password" floatingLabelText="Password" onChange={(e) =&gt; this.setState({password: e.target.value})} /&gt; &lt;/form&gt; &lt;/Dialog&gt; &lt;/div&gt; ); } }</code> </pre> </div></div><br><p>  Registration and login dialogs have identical form fields, so we merge them into one.  The logic of the component is elementary: we either enter or register with <code>handleConfirm</code> or register first and then enter. </p><br><p>  It remains to reload the loops themselves when logging in.  Add a reaction to events in <code>App.js</code> : </p><br><pre> <code class="javascript hljs"> componentDidMount() { hoodie.store.on(<span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadLoops); hoodie.account.on(<span class="hljs-string"><span class="hljs-string">'signin'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadLoops) hoodie.account.on(<span class="hljs-string"><span class="hljs-string">'signout'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadLoops) } componentWillUnmount() { hoodie.store.off(<span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadLoops); hoodie.account.off(<span class="hljs-string"><span class="hljs-string">'signin'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadLoops) hoodie.account.off(<span class="hljs-string"><span class="hljs-string">'signout'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadLoops) }</code> </pre> <br><h2>  the end </h2><br><p>  So, authorization is ready.  The biggest challenge of this part was probably the installation of CouchDB.  Now our application will retain its functionality when the connection is broken, and when it appears it is synchronized.  However, if you completely close the site, open it without the Internet will not work.  We will fix this in the next, final part. </p><br><p>  "The code for this part is available here: <a href="https://github.com/imbolc/action-loop">https://github.com/imbolc/action-loop</a> under the part2 tag. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/309572/">https://habr.com/ru/post/309572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309560/index.html">JETPLOW Architecture - NSA backdoor in my coffee stand</a></li>
<li><a href="../309564/index.html">Centralized backup policy management</a></li>
<li><a href="../309566/index.html">Security Week 36: Nexus 5X vulnerability, crypto-fiber posting pictures, attacking Linux servers via Redis</a></li>
<li><a href="../309568/index.html">Laravel 5.3: Preparation for development (for beginners)</a></li>
<li><a href="../309570/index.html">About the Internet of things and the semiconductor industry in the region where they drink camel milk. The first day</a></li>
<li><a href="../309574/index.html">Integration of Intel AMT settings in the management console</a></li>
<li><a href="../309576/index.html">Welcome to the Python-Meetup September 22</a></li>
<li><a href="../309578/index.html">New statistics Y Combinator will tell startups the direction of development</a></li>
<li><a href="../309580/index.html">The analysis of data from the Eastron SDM220 electric meter by means of ThingSpeak</a></li>
<li><a href="../309582/index.html">Opinion Habr: disable or not a large site owed 450 000 rubles?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>