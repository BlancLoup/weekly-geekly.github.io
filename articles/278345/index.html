<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MSLibrary. Capture and verify phone numbers using regular expressions, for iOS and not only ... Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The reason for the emergence of a series of articles, the first of which was presented to your attention, was a great analytical and practical materia...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MSLibrary. Capture and verify phone numbers using regular expressions, for iOS and not only ... Part 1</h1><div class="post__text post__text-html js-mediator-article">  The reason for the emergence of a series of articles, the first of which was presented to your attention, was a great analytical and practical material that has accumulated in the process of working on the MSLibrary for iOS library.  The <a href="https://habrahabr.ru/users/mslibrary/" class="user_link">MSLibrary</a> library includes many classes, and even more functions and macros designed to simplify the routine work of developers, significantly reduce development time and code size.  But, everything has its time, we will tell about the library a little later. <br><br>  So, capture and verification of phone numbers using regular expressions.  It would seem, what is there to talk about?  Who knows how, he writes himself, and who does not know how to copy one of the many ready-made solutions, scattered in the vast World Wide Web.  The only question is what he will write and what will be copied and how will this code correspond to the tasks set, as well as to the current international, industry and corporate standards?  Any solution, even the simplest, is good only if the developer is fully aware of his work and is absolutely sure of it. <br><a name="habracut"></a><br><blockquote><h3>  <i>Any solution, even the simplest, is good only if the developer is fully aware of his work and is absolutely sure of it.</i> </h3></blockquote><br>  In fact, the topic of the article is divided into two already in the title.  Capture is the ability to understand that a set of digits and characters to be tracked can be a telephone number.  And verification is a test of whether this set meets certain pre-set conditions.  It is easy to verify that these tasks are different by looking at the above example: <br><br><pre> + 1 (408) - 996 - 10 - 10 = 1234
 +14089961010; ext = 1234
</pre><br>  In the first case, someone tried to record the phone in the manner in which he was used to doing it, and in the second, the phone was recorded in accordance with the international standard <a href="https://tools.ietf.org/html/rfc3986">RFC 3966</a> .  The problem is that if we try to use both of these entries to dial a phone number, for example, in an iOS application, then, unfortunately, we will not get anything good.  In the first case, the system will not understand anything at all, and in the second, instead of the extension number ‚Äú1234‚Äù, the system will dial completely different numbers (this is a very convincing experiment, you can try. The code is given below). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">A simple code for a phone call from an iOS application.</b> <div class="spoiler_text"><pre><code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *telString =<span class="hljs-string"><span class="hljs-string">@"tel:+14089961010;ext=1234"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> *urlString = [<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> URLWithString: telString ]; [[<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> sharedApplication] openURL:urlString];</code> </pre> <br></div></div><br>  In essence, both tasks (capture and verification) are solved by the same methods, the only difference is in the applied regular expressions. <br><br>  The first step is to look at what is written in <a href="https://tools.ietf.org/html/rfc3986">RFC 3966</a> , which governs this issue.  And it is written there in a highly simplified form the following: <br><br><h4>  Simplified structure of telephone-uri in accordance with RFC 3966 </h4><br><blockquote><pre>  telephone-uri = "tel:" telephone-subscriber </pre><br><ul><li><pre>  telephone-subscriber = global-number </pre></li><li><pre>  global-number = global-number-digits * par </pre></li><li><pre>  par = extension |  isdn-subaddress |  parameter </pre></li><li><pre>  isdn-subaddress = "; isub =" 1 * uric </pre></li><li><pre>  extension = "; ext =" 1 * phonedigit </pre></li><li><pre>  global-number-digits = "+" * phonedigit DIGIT * phonedigit </pre></li><li><pre>  parameter = ";"  pname ["=" pvalue] </pre></li><li><pre>  pname = 1 * (alphanum | "-") </pre></li><li><pre>  pvalue = 1 * paramchar </pre></li><li><pre>  paramchar = param-unreserved |  unreserved |  pct-encoded </pre></li><li><pre>  unreserved = alphanum |  mark </pre></li><li><pre>  mark = "-" |  "_" |  "."  |  "!"  |  "~" |  "*" "'" |  "(" | ")" </pre></li><li><pre>  param-unreserved = "[" |  "]" |  "/" |  ":" |  "&amp;" |  "+" |  "$" </pre></li><li><pre>  phonedigit = DIGIT |  [visual-separator] </pre></li><li><pre>  visual-separator = "-" |  "."  |  "(" | ")" </pre></li><li><pre>  alphanum = ALPHA |  Digit </pre></li><li><pre>  reserved = ";"  |  "/" |  "?"  |  ":" |  "@" |  "&amp;" |  "=" |  "+" |  "$" |  "," </pre></li><li><pre>  uric = reserved |  unreserved </pre></li></ul></blockquote><br>  where ALPHA and DIGIT, as follows from another document, are <a href="https://tools.ietf.org/html/rfc2396">RFC 2396</a> : <br><blockquote><ul><li><pre>  DIGIT = "0" |  "1" |  "2" |  "3" |  "4" |  "5" |  "6" |  "7" |  "8" |  "9" </pre></li><li><pre>  ALPHA = lowalpha |  upalpha </pre></li><li><pre>  lowalpha = "a" |  "b" |  "c" |  "d" |  "e" |  "f" |  "g" |  "h" |  "i" |  "j" |  "k" |  "l" |  "m" |  "n" |  "o" |  "p" |  "q" |  "r" |  "s" |  "t" |  "u" |  "v" |  "w" |  "x" |  "y" |  "z" </pre></li><li><pre>  upalpha = "A" |  "B" |  "C" |  "D" |  "E" |  "F" |  "G" |  "H" |  "I" |  "J" |  "K" |  "L" |  "M" |  "N" |  "O" |  "P" |  "Q" |  "R" |  "S" |  "T" |  "U" |  "V" |  "W" |  "X" |  "Y" |  "Z" </pre></li></ul></blockquote><br>  Schematically telephone-uri can be represented as follows: <br><br><pre> <code class="xml hljs">telephone-uri =    [  ]</code> </pre>  <sub><b>rice</b></sub>  <sub><b>one</b></sub> <br><br>  From RFC 3966, it follows that: <br><br><ul><li><pre>  proper phone number = global-number-digits </pre></li><li><pre>  some optional addition = extension |  isdn-subaddress |  parameter </pre></li></ul><br>  Where: <br><br><ul><li><pre>  extension - extension phone number </pre></li><li><pre>  isdn-subaddress - ISDN subaddress </pre></li><li><pre>  parameter - some other optional parameters </pre></li></ul><br>  Since in real life, when working with mobile applications, in particular with iOS applications, and with most sites, there is only an extension telephone number, the telephone-uri scheme will change as follows: <br><br><pre> <code class="xml hljs">telephone-uri = global-number-digits [extension]</code> </pre>  <sub><b>rice</b></sub>  <sub><b>2</b></sub> <br><br>  or by substituting the corresponding values ‚Äã‚Äãfor global-number-digits and extension: <br><br><pre> <code class="xml hljs">telephone-uri = "+" *phonedigit DIGIT *phonedigit [";ext=" 1*phonedigit]</code> </pre>  <sub><b>rice</b></sub>  <sub><b>3</b></sub> <br><br>  where phonedigit consists of the digits "[0-9]" and a limited range of visual delimiters <br><br><pre>  "-" |  "."  |  "(" | ")" </pre><br><br>  Here, it would seem, it is possible to proceed to the consideration of regular expressions implementing this scheme.  but ... Many authors rightly note that not any set of numbers is a telephone number.  There is a generally accepted international practice that defines the structure of telephone numbers.  Yes, there really is, and we will consider it briefly now. <br><br><h4>  International structure of telephone numbers </h4><br>  In accordance with existing practice, the following groups can be distinguished, which together make up the telephone number of the global-digits number: <br><br>  global-number-digits <br><br><ul><li><pre>  "+" Is a sign indicating that the international country code is located after it </pre></li><li><pre>  country_code - one-three-digit country code, for example: 7, or 44 or 374 </pre></li><li><pre>  area_code - a three-digit region code, for example: 800 </pre></li><li><pre>  exchange - a three-digit station number, for example: 555 </pre></li><li><pre>  subscriber_number - four-digit subscriber number, for example: 1234 </pre></li></ul><br>  extension <br><ul><li><pre>  extension is an extension number, for example: 5678 (optional) </pre></li></ul><br>  In this case, the structure of the phone number will look like this: <br><br><pre> <code class="xml hljs">telephonNumber = "+" country_code [visual-separator] area_code [visual-separator] exchange [visual-separator] subscriber_number [visual-separator] [";ext=" extension]</code> </pre>  <sub><b>rice</b></sub>  <sub><b>four</b></sub> <br><br>  Thus, if we implement a regular expression that takes into account the standard RFC 3966 and the International Telephone Number Structure, in other words, it corresponds to the diagrams shown in Fig.  3 and fig.  4, the following telephone number entries are quite valid: <br><br><pre> +14089961010; ext = 1234
 +1 (408) 996-1010; ext = 1234
 + 1-408-996-10-10; ext = 1234
 +1.408.996.1010; ext = 1234
</pre><br><br>  and the following will be valid only on the basis of the RFC 3966 standard, since the visual separators (visual separator) are outside the structure defined by the International Standards for Telephone Numbers: <br><br><pre> +1 (4089) 96-1010; ext = 1234
 + 1-408996-10-10; ext = 1234
 +1.408996.1010; ext = 1234
</pre><br><br>  In real life, the user can dial the phone number either according to the pattern specified in the application or on the site, or as he thinks is correct (that is, as he pleases).  And the application, in turn, will process the resulting string in accordance with the standards laid down in it.  What is not always the same. <br><br><blockquote><h3>  <i>In real life, the user can dial the phone number either according to the pattern specified in the application or on the site, or as he thinks is correct (that is, as he pleases).</i>  <i>And the application, in turn, will process the resulting string in accordance with the standards laid down in it.</i>  <i>What is not always the same.</i> </h3></blockquote><br><br><h4>  Corporate WEB telephone dialing standards </h4><br>  Why web?  Because in iOS, and practically in all other systems, and, of course, on websites, the easiest way to make a phone call is to use a well-known html scheme: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tel:1-408-996-1010"</span></span></span><span class="hljs-tag">&gt;</span></span>1-408-996-1010<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  <sub><b>rice</b></sub>  <sub><b>five</b></sub> <br><br>  At the beginning of the article, a sample of the code for implementing this scheme in Objective-C has already been given, however, for a more elegant presentation, it is worth repeating: <br><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *telString =<span class="hljs-string"><span class="hljs-string">@"tel:+14089961010"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> *urlString = [<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> URLWithString: telString ]; [[<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> sharedApplication] openURL:urlString];</code> </pre>  <sub><b>rice</b></sub>  <sub><b>6</b></sub> <br><br>  Let us turn to corporate standards: <br><br>  What do Google <a href="https://developers.google.com/web/fundamentals/native-hardware/click-to-call/">experts</a> say about this? <br><blockquote>  Always supply the phone number using the international dialing format: the plus sign (+), country code, area code and number.  If you‚Äôre not absolutely necessary, it‚Äôs a good idea. </blockquote><br>  That is, it is necessary to put the "+" sign in front of the country code and "it may be a good idea" to separate the segments (groups) of the telephone number with visual separators in the form of hyphens "-".  Which, in general, is in complete agreement with RFC 3966 and the International Telephone Numbers Structure, in other words, corresponds to the diagrams shown in Fig.  3 and fig.  4. However, there is one significant BUT.  Visual separators are limited to one character, a hyphen "-".  This of course does not mean that the browser will inadequately respond to brackets or dots as visual separators, but this requires careful verification, the Google document guarantees only a hyphen.  In addition, this section of the manual does not say anything about the format of the extension.  Since the article is mainly devoted to iOS applications, we will not delve into the specifics of the work of Google software, you can experiment and tell about the results. <br><br>  Apple is even more laconic, in the <a href="https://developer.apple.com/library/iOS/featuredarticles/iPhoneURLScheme_Reference/PhoneLinks/PhoneLinks.html">Phone Links</a> section, about the permissible format of a phone number, we find this phrase: <br><blockquote>  For more information about the URL URL scheme, see RFC 2806 and RFC 2396. </blockquote><br>  Formally, everything is correct, why repeat, if there are international standards?  But the fact is that Apple‚Äôs corporate standards, as well as Google‚Äôs, only meet parts of these international standards, which, by the way, are often advisory in nature. <br><br><blockquote><h3>  <i>Corporate standards correspond only to parts of international standards, which, by the way, are often advisory in nature.</i> </h3></blockquote><br><h4>  What can and can not be used in the phone number for the iOS application </h4><br>  Experiments have shown that the system responds adequately to all four types of visual separators regulated in RFC 3966, namely: <br><br><ul><li><pre>  visual-separator = "-" |  "."  |  "(" | ")" </pre></li></ul><br>  Moreover, the separators can be located in arbitrary locations and, moreover, can be unpaired.  As an example, the following phone number entries will be processed by the code shown in Fig.  6, equally and adequately: <br><br><pre> +14089961010
 +1(408)996-1010
 + 1-408-996-10-10
 +1.408.996.1010
 +1 (4089) 96-1010
 + 1-408996-10-10
 +1.408996.1010
 + 1-4 (0899 (6-10-10
 +1.40) 8996.10 (10
</pre><br><br>  The situation is different with extension dialing.  As mentioned at the beginning of the article, the system does not respond correctly to the prefix of the additional code "; ext =" proposed in RFC 3966.  Native, that is, natural for the system are two characters: ";"  and ",". <br><br>  In the first case, when the system encounters a separator ";" in the telephone number, the dialing stops and the extension numbers appear on the screen.  When you click on them, the set continues. <br><br>  In the second case, when the system encounters a separator "," in the phone number, dialing stops at this place and automatically continues after a short pause of approximately 2 seconds.  Visual separator "," may not be single, for example, ",,,,".  In this case, the length of the pause increases in proportion to the number of characters. <br><br>  In the case of a separator of the form "; ext =", regulated by RFC 3966, the following occurs: the system accepts the ";"  for the breakpoint before dialing the extension number, and interprets the ext characters as digits from which the extension number begins. <br><br><hr><br>  So, we have considered the theoretical and practical prerequisites and can go to the second part of the article, that is, in fact, to regular expressions for capturing and verifying telephone numbers. <br><br>  We hope that the material was useful to you, the <a href="https://habrahabr.ru/users/mslibrary/" class="user_link">MSLibrary</a> for iOS team <br><br>  Other articles: <br>  <a href="https://habrahabr.ru/post/278359/"><b>Capturing and verifying phone numbers using regular expressions, for iOS and not only ... Part 2</b></a> <br>  <a href="https://habrahabr.ru/post/279441/"><b>Implementing multiple selection of conditions using bitmasks, for iOS and not only ...</b></a> <br>  <a href="https://habrahabr.ru/post/279563/"><b>SIMPLE: remove unnecessary characters from the string, for iOS and not only ...</b></a> <br>  <a href="https://habrahabr.ru/post/280286/"><b>Creating and compiling cross-platform (universal) libraries in Xcode</b></a> </div><p>Source: <a href="https://habr.com/ru/post/278345/">https://habr.com/ru/post/278345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278335/index.html">SSLv2 DROWN Vulnerability Can Decrypt TLS Traffic</a></li>
<li><a href="../278337/index.html">Email, social networks, instant messengers: What does the media influence and how to choose them</a></li>
<li><a href="../278339/index.html">Microsoft can integrate the Linux subsystem in the new release of Windows 10</a></li>
<li><a href="../278341/index.html">Why Habr died. What to do and where to run</a></li>
<li><a href="../278343/index.html">Chapter 21. Part 1 - Creating objects and data output objects. PowerShell in depth - Don Jones, Richard Siddaway</a></li>
<li><a href="../278347/index.html">Oracle IaaS and PaaS - all for you</a></li>
<li><a href="../278349/index.html">Interesting ways to use Go channels (translation)</a></li>
<li><a href="../278351/index.html">How to create objects in PowerShell</a></li>
<li><a href="../278353/index.html">No, "Habr" does not die</a></li>
<li><a href="../278359/index.html">MSLibrary. Capturing and verifying phone numbers using regular expressions, for iOS and not only ... Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>