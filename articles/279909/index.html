<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make content recommendations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When dealing with the media, we at Relap.io often come across a mass of misconceptions that everyone believes in, because this has happened historical...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make content recommendations</h1><div class="post__text post__text-html js-mediator-article"><br>  When dealing with the media, we at <a href="https://relap.io/">Relap.io</a> often come across a mass of misconceptions that everyone believes in, because this has happened historically.  The site has blocks like ‚ÄúRead also‚Äù or ‚ÄúHottest‚Äù, etc.  In short, all that constitutes the binding of the article and seeks to complement the dear reader's UX.  We will tell you what misconceptions the media have that make content recommendations and dispel them in numbers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ee/2cc/724/8ee2cc72442456f3fee9799dcceedb88.jpg" alt="HAbr1" width="943" height="530"><br><br><a name="habracut"></a><br><h2>  <strong>Recommend by tags</strong> </h2><br>  The biggest and most popular misconception.  Most often, the media make recommendations at the end of an article by tags.  So does Look At Me and RBC, for example.  There is material with tags: tractor, Putin, cheese.  Texts about a tractor, about Putin and cheese are displayed to him.  At first glance, it is logical: <br><img src="https://habrastorage.org/getpro/habr/post_images/235/1d9/e3a/2351d9e3ae20bba577440278657a48ca.png" alt="village" width="1000" height="843"><br>  Such a mechanic of recommendations in real life would have looked like this.  You go to the grocery store.  And put in the basket of butter.  A consultant with sweaty palms palms comes up to you and says: ‚ÄúOh, I see you have taken butter and that means you need butter.  Take five more types of creamy rustic and sunflower and goat butter. ‚Äù  The maximum that can happen out of the ordinary is that you will be offered a transmission if you have read something about cars.  And this will already be considered rocket science. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But there are situations where you can recommend for tags: for example, a website with reviews of products - here you can assume that a person will want to read several reviews of similar pressure cookers or phones.  But you shouldn‚Äôt trust the editor who puts down the tags: different people perceive texts differently, and if the editors have more than one, the variety of tags describing more or less the same thing is amazing. <br><br>  It is better to rely on the machine and isolate keywords from the text automatically.  In this case, we get only those words (and even better are stable phrases, collocations, but this is a slightly different story) that are important for a specific text, and not a list of names / trademarks, which are likely to be found in a million articles on completely different topics. . <br><br>  The simplest (and, in many cases, very effective) way to isolate keywords from text is to use <em>tf-idf</em> and its many variants. <br><br>  <strong><em>tf-idf</em> - <em>term frequency-inverse document frequency</em></strong> .  We see which words and how often are used in the document and give more weight to those words that are rarely found in the corpus.  In other words, even if the word "cash" is found only once in the text, it is much more likely to be a significant tag than, for example, the word "Carnival" (except when we index the site for trading sebulcaria). <br>  For those who do not remember, the reverse frequency of the body ( <em>idf</em> ) is calculated as <br><br><img src="http://tex.s2cms.ru/svg/%5Ctextsf%7Bidf%20%7D%28t_i%2CD%29%20%3D%20%5Clog%5Cfrac%7B%7CD%7C%7D%7B%7C%5C%7Bd%5Cin%20D%3A%20t_i%5Cin%20d%5C%7D%7C%7D%2C"><br><br>  Where <img src="http://tex.s2cms.ru/svg/%5Cinline%20D" alt="inline_formula">  - body itself (many documents <img src="http://tex.s2cms.ru/svg/%5Cinline%20d" alt="inline_formula">  ), but <img src="http://tex.s2cms.ru/svg/%5Cinline%20t_i" alt="inline_formula">  - term.  Taking a logarithm of a relationship is not necessary in general, any monotonous function will do (in Wikipedia you can look at numerous variants of this formula), the main thing is to ‚Äúpunish‚Äù for the word being too popular.  Logarithm makes sense to use if the case is large enough. <br>  The frequency of the term is even simpler: <br><br><img src="http://tex.s2cms.ru/svg/%5Ctextsf%7Btf%7D%28t_i%2Cd%29%20%3D%20%5Cfrac%7Bn_i%7D%7B%5Csum_kn_k%7D%2C"><br><br>  Where <img src="http://tex.s2cms.ru/svg/%5Cinline%20n_i" alt="inline_formula">  the number of occurrences of a term in the document <img src="http://tex.s2cms.ru/svg/%5Cinline%20d" alt="inline_formula">  , and the denominator sum is just the total number of words in the document. <br>  To rank words by importance, we simply multiply these two numbers: <br><br><img src="http://tex.s2cms.ru/svg/%5Ctextsf%7Btfi-df%7D%28t_i%2Cd%2CD%29%3D%5Ctextsf%7Btf%7D%28t_i%2Cd%29%5Ccdot%20%5Ctextsf%7Bidf%7D%28t_i%2CD%29."><br><br>  It is easy to see that the inverse frequency is calculated over the whole body, and the frequency of the term depends on the document that we want to analyze.  In the case of the Russian language, it would be nice (actually necessary) to bring all the words in the text to dictionary forms or at least lemmatize, but this is not the case at this point (those interested can begin acquaintance with the process with <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B5%25D0%25BC%25D0%25BC%25D0%25B5%25D1%2580_%25D0%259F%25D0%25BE%25D1%2580%25D1%2582%25D0%25B5%25D1%2580%25D0%25B0">Porter‚Äôs algorithm</a> ). <br><br>  If you calculate a corpus and rank the words in each document by descending value <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Ctextsf%7Btf-idf%7D" alt="inline_formula">  then the first few words will give a fairly adequate idea of ‚Äã‚Äãthe content of the document.  Such words can be used as tags, but, as we have said, you should not do this in news sites - after all, one news of traffic jams due to snowfall is quite enough.  Remember, as the highway xxx was stuck in traffic in 2012 - there is no need. <br><br><h2>  Shocking truth </h2><br>  The world is a little more complicated.  In fact, everything works like this: the user comes to the site, watches the dollar rate, a review of the new iPhone and photos of pandas.  So, another person who has already watched the dollar and the iPhone will most likely want to look at the pandas, however strange that may sound.  This is called collaborative filtering.  There are clusters of users and patterns that can be used to maximize the reader‚Äôs involvement in your content. <br><br><blockquote>  <strong><strong>Test results</strong></strong> <br><br>  According to the results of A / V tests, collaborative filtering, with no additional settings, gives 20-30% more clicks than selection by tags.  And this means that no one should make ‚ÄúRead also‚Äù blocks based on tags. </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/6c0/e3b/f74/6c0e3bf74bbb0e0ce5de939be64989b0.png" alt="image"><br>  Collaborative filtering is to some extent a continuation of the idea of ‚Äã‚Äãusing <em>tf-idf</em> to isolate meaningful information, but instead of the frequency of words, we use differently weighted ‚Äúvoices‚Äù of readers.  By voice, we understand some actions: viewing the page, scraping it to the end, something else - a set of events depends solely on the imagination of mathematicians and the programmer‚Äôs free time (who writes the code, all this magnificence takes into account). <br><br>  Just counting the number of events is wrong, so we again calculate the weight of votes.  Since readers do not rate (moreover, they do not even know or do not think that by reading an article about the mushroom that grew on the edge near the village council, they help to collect statistics on the reader's preferences of the Bulletin Bulletin Bulletin of readers), we need to determine the "importance" votes using only anonymous and fairly limited information. <br><br>  The importance of the reader‚Äôs voice depends on how active it is, however, with a negative sign: the more articles a user reads over a period of time (for example, 12 hours), the cheaper his voice is.  The weight of the vote is a decreasing function of the number of articles read on the resource.  Moreover, it makes sense to put a cut-off on top: a person who has read more than 100 articles on the same site for one day is either the editor of this site, or a maniac or bot, and most likely we do not need his recommendations. <br><br>  Weights can be calculated like this: <br><br><img src="http://tex.s2cms.ru/svg/w_i%20%3D%20%5Cfrac%7B1.0%20%7D%7B%5Clog%281.0%20%2B%20v_i%29%7D%2C"><br><br>  Where <img src="http://tex.s2cms.ru/svg/%5Cinline%20w_i" alt="inline_formula">  voice weight <img src="http://tex.s2cms.ru/svg/%5Cinline%20i" alt="inline_formula">  th user, and <img src="http://tex.s2cms.ru/svg/%5Cinline%20v_i" alt="inline_formula">  number of votes of this user.  Again, no one forces us to use logarithms ‚Äî any monotonically decreasing function of <img src="http://tex.s2cms.ru/svg/%5Cinline%20v_i" alt="inline_formula">  will come down, you can also get rid of one in the denominator: strictly speaking, readers with zero votes should not be taken into account either (the column "against all" was removed from the ballots).  Here you can add something else: for example, not just count the number of articles read, but take into account the time spent reading them, the assessment given (if such information exists), anything. <br><br><br><h2>  <strong>Recommend content from the same section.</strong> </h2><br>  The second incarnation of the previous fallacy is to segment recommendations by sections. <br>  Imagine that the consultant of the butter department takes you hostage with the words: ‚ÄúToday you will buy only butter, oh yeah, you will buy a lot of butter!‚Äù You shout out the doors with a cry and never return to this store. <br><br><blockquote>  <strong>Test results</strong> <br><br>  We showed segmented recommendations to one group of users: a person reads news from the ‚ÄúSociety‚Äù section - we recommend him articles only from the ‚ÄúSociety‚Äù section.  Another group received recommendations from the entire site (cross-segment recommendations).  The CTR of the widget with recommendations without sections is 2 times higher, the failure rate is 16% lower and the time spent on the site was 23% higher.  There is no point in restricting the reader to a single section.  Be diverse in your recommendations. </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/01f/c0f/e76/01fc0fe76f1c86580b4700301568c5fa.png" alt="image"><br>  It is easy to see that both collaborative filtering and automatic calculation of tags within one segment will work worse - after all, by breaking the site content into segments and calculating recommendations within each segment, we simply apply the same approach on a smaller sample.  Moreover, we get a distorted picture of user activity. <br><br>  In the end, when ranking users, we are interested in how active a person is online, and not how many articles about the weather he / she reads per day.  Well, about the correlation of interests in this case, you can forget: we are not interested in conditional transition probabilities from one section to another (or rather, we are interested, but do not collect statistics for their calculation), so do not lock your recommendations in the section cells, they do not like. <br><br><br><h2>  <strong>Recommend popular</strong> </h2><br>  To recommend popular news means to recommend unnecessary news that everyone has already seen.  Popular are materials that many people have watched.  That is how popular is becoming popular.  Every time you want to make such a block on your site, remember this sentence, because this is how it works.  This is the news that everyone saw. <br><br><blockquote>  <strong>Test results</strong> <br><br>  In the A / B tests, we compared popular and collaborative filtering.  CTR widget with collaborative filtering is 7 times higher.  This does not mean that our algorithms are so cool.  This means that the block is popular on the site - sucks and does not need anyone at all.  We understand that the ‚ÄúPopular‚Äù block on the site is a must have for most media, but it's time to say goodbye to this delusion. </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/66d/9f1/78a/66d9f178a35d903b73b096df2765fd2c.png" alt="image"><br>  Popular news needs some time to turn into a button accordion and recommend something that many people are interested in right now is not a bad idea.  You just need to clearly understand - when the reader's interest begins to fade, otherwise we would still see only "Labutyens" and the like when trying to find fresh jokes on YouTube - but what?  This video scored a billion views, so it is good! <br><br>  As it is easy to guess, the decreasing function of the age of the event will help us just as the decreasing function of the number of actions performed by the user helped weed out bots and maniacs.  However, in the case of the age of views, the weight of each voice should decrease much faster: there are many users and a thousand views in the morning does not mean that someone wants to read about the morning traffic jams for lunch.  An inverse relationship to the logarithm of views works well when weighting the votes of one user, to determine the popularity of the negative degree of age works better: <img src="http://tex.s2cms.ru/svg/%5Cinline%20w_%7Bij%7D%20%3D%20%5Cfrac%7B1%7D%7Bt%5E%5Calpha%7D" alt="inline_formula">  where <img src="http://tex.s2cms.ru/svg/%5Cinline%20w_%7Bij%7D" alt="inline_formula">  voice weight <img src="http://tex.s2cms.ru/svg/%5Cinline%20i" alt="inline_formula">  for the article <img src="http://tex.s2cms.ru/svg/%5Cinline%20j" alt="inline_formula">  , <img src="http://tex.s2cms.ru/svg/%5Cinline%20t" alt="inline_formula">  elapsed time since reading <img src="http://tex.s2cms.ru/svg/%5Cinline%20%5Calpha%20%3E%200" alt="inline_formula">  some kind of constant.  News needs to be ranked according to <img src="http://tex.s2cms.ru/svg/%5Cinline%20r_j%20%3D%20%5Csum_iw_%7Bij%7D" alt="inline_formula">  and do it quite often, otherwise the relevance of the recommendations will be lost. <br><br>  If you look at the last formula for more than three seconds, it is easy to come to the conclusion that the actual amount of weights is not so important, the speed with which it grows is important.  Therefore, it is even better not to rank the news according to the ‚Äútotality of merit,‚Äù but according to the speed of the collection of these same merits.  Actually, if we take this speed carefully, then we can learn how to predict the virality of the post and do other cosmic things (with the proviso, however, that in this case virality is still not predicted, but detected at an early stage). <br><br><br><h2>  <strong>Do not set a time limit</strong> </h2><br>  Why news publications recommend the news six months ago, it is difficult to understand.  Such an approach generates wild examples of the type of this: <br><img src="https://habrastorage.org/getpro/habr/post_images/e89/a24/09e/e89a2409e5f96b54328e0d1cc1adf470.png" alt="snob" width="1000" height="919"><br>  Media thinks the user wants to know what was on the subject before.  No, he does not want!  He is not interested, and no one is interested. <br><br><blockquote>  <strong>Test results</strong> <br><br>  During the tests on the news media, we found out the most optimal age of news that should be recommended to visitors.  Three options were tested: 72, 48 and 24 hours from the moment of publication.  The test sample was 2.7 million readers, the test was carried out a month.  Most of our colleagues bet for 24 hours, because it seemed to them that the news very quickly became obsolete, and no one would read yesterday's news.  Slightly less people believed in 48 hours.  Apparently, because not everyone has time to read the actual for the day and, most likely, they missed something for yesterday and want to catch up.  Nobody believed in 72 hours ... Yes, they won 72 hours.  In this range, users find the most interesting materials and blocks, collected from such news, clickable by 4.2% more than 48 hours and 10.9% more than 24 hours.  This is probably due to the fact that people do not have time (or simply do not want) to consume the entire amount of information generated by the media.  Therefore, the news released the day before yesterday, they are still relevant.  The exceptions are breaking news. </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/185/48c/16f/18548c16fd3bb6aa0051af61cf8ea2aa.png" alt="image"><br>  Not to be unsubstantiated, let's look at the statistics of page visits on a relatively large sample (but smaller than that described in the previous paragraph), for example, one million events (page transitions) and look at the age of the articles being read. <br><br>  At first, let's just see how many different pages are in our sample (all events are collected on one big news site. The following is obtained: <br><table><tbody><tr><th>  Age (hours) </th><th>  Number of pages </th></tr><tr><td>  0-24 </td><td>  719 </td></tr><tr><td>  24-48 </td><td>  841 </td></tr><tr><td>  48-72 </td><td>  581 </td></tr><tr><td>  72-96 </td><td>  368 </td></tr><tr><td>  96-120 </td><td>  238 </td></tr><tr><td>  120-144 </td><td>  73 </td></tr><tr><td>  144-168 </td><td>  85 </td></tr><tr><td>  168-192 </td><td>  147 </td></tr><tr><td>  192-216 </td><td>  141 </td></tr><tr><td>  216-240 </td><td>  110 </td></tr><tr><td>  &gt; 240 </td><td>  8152 </td></tr><tr><td>  Total </td><td>  11455 </td></tr></tbody></table><br>  It is quite obvious that there are many old URLs, but it is also obvious that it is necessary to consider not just the visited URLs, but the distribution of traffic.  Look at the number of visits: <br><table><tbody><tr><th>  Article age (hours) </th><th>  Number of events </th></tr><tr><td>  0-24 </td><td>  771 435 </td></tr><tr><td>  24-48 </td><td>  130,431 </td></tr><tr><td>  48-72 </td><td>  26,233 </td></tr><tr><td>  72-96 </td><td>  21,536 </td></tr><tr><td>  96-120 </td><td>  5,214 </td></tr><tr><td>  120-144 </td><td>  673 </td></tr><tr><td>  144-168 </td><td>  287 </td></tr><tr><td>  168-192 </td><td>  965 </td></tr><tr><td>  192-216 </td><td>  1 001 </td></tr><tr><td>  216-240 </td><td>  1,642 </td></tr><tr><td>  &gt; 240 </td><td>  40 583 </td></tr><tr><td>  Total </td><td>  1000 000 </td></tr></tbody></table><br><br>  As expected, more than 90% of traffic comes from articles published in the last 72 hours. <br><br>  These are 5 universal rules for all media.  In addition, each site has its own behavioral patterns.  Depending on them, algorithms are configured.  The same set of laws and prohibitions could be formulated for any of our sites. <br><br>  We are very pleased if this article has helped in the work of your editorial staff and interface design.  If you have questions, crazy hypotheses and ideas that you want to implement with us - write to lab@relap.io <br><br>  If you want to use our technologies, engage readers and generally automate content recommendations on the site, we will be happy to help.  Write to support@relap.io <br><br>  Ask questions.  We will answer them in the comments. <br></div><p>Source: <a href="https://habr.com/ru/post/279909/">https://habr.com/ru/post/279909/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279895/index.html">Many-sided GOST R 34.11-94</a></li>
<li><a href="../279897/index.html">Moving from Windows to Linux Ubuntu 14.04 LTS with Jetbrains IntelliJ Idea 14.1.5</a></li>
<li><a href="../279903/index.html">Scaling Wix to 100 million users. Start</a></li>
<li><a href="../279905/index.html">Percona Server Upgrade to 5.7 on Ubuntu 14.04</a></li>
<li><a href="../279907/index.html">NetApp ONTAP Cloud: Amazon & Azure</a></li>
<li><a href="../279911/index.html">NetApp ONTAP: SnapMirror for SVM</a></li>
<li><a href="../279915/index.html">MongoDB tree storage</a></li>
<li><a href="../279917/index.html">Stop abusing arrays in PHP</a></li>
<li><a href="../279919/index.html">How to use named constructors in PHP</a></li>
<li><a href="../279921/index.html">When to use static methods</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>