<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Snake and coconut</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I love Python. No, really, this is an excellent language, suitable for a wide range of tasks: here you will be working with the operating system, web ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Snake and coconut</h1><div class="post__text post__text-html js-mediator-article"><p>  I love Python.  No, really, this is an excellent language, suitable for a wide range of tasks: here you will be working with the operating system, web frameworks for every taste, and libraries for scientific computing and data analysis.  But besides Python, I like functional programming.  And the python in this regard is not bad: there are closures, anonymous functions and in general, the functions here are first class objects.  It would seem, what more could you ask for?  And here I accidentally stumbled upon <strong>Coconut</strong> - a functional language compiled in Python.  All fans of Python and OP I ask under the cat. </p><a name="habracut"></a><br><p>  What?  Functional language compiled in Python?  But why, after all, functional features and so full, but if you want additional <del>  perversions </del>  , that is, the module toolz.functoolz?  But let's consider a simple task: we need to add the squares of the numbers from a certain list. </p><br><pre><code class="python hljs">l = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code> </pre> <br><h2 id="vozmozhnye-resheniya">  Possible solutions </h2><br><p>  Imperative decision "in the forehead": </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum_imp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> s = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lst: s += n**<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s</code> </pre> <br><p>  Using map and reduce (looks creepy): </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reduce <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> operator <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> add <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum_map_reduce</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reduce(add, map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> n: n**<span class="hljs-number"><span class="hljs-number">2</span></span>, lst))</code> </pre> <br><p>  Using list generators (pythonic-way): </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum_list_comp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum([n**<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lst])</code> </pre> <br><p>  The last option is not so bad.  But in such cases you want to write something in the spirit </p><br><pre> <code class="hljs perl">sum_s<span class="hljs-string"><span class="hljs-string">qr(lst)</span></span> = lst |&gt; <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>(n -&gt; n**<span class="hljs-number"><span class="hljs-number">2</span></span>) |&gt; sum</code> </pre> <br><p>  Yes, just like in OCaml, only without strict typing (we have a dynamic language).  And what if I tell you that with Coconut we can really do that?  Use it to write </p><br><pre> <code class="hljs perl">sum_s<span class="hljs-string"><span class="hljs-string">qr(lst)</span></span> = lst |&gt; <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>$(n -&gt; n**<span class="hljs-number"><span class="hljs-number">2</span></span>) |&gt; sum</code> </pre> <br><p>  and get a complete solution to the task without function calls (from_functions (from_functions))). </p><br><h2 id="fichi">  Features </h2><br><p>  The authors of the language write that it adds the following features to Python: </p><br><ul><li>  Pattern matching </li><li>  Algebraic data types </li><li>  Destructuring assignment </li><li>  Partial application (I know about partial, but more details below) </li><li>  Lazy lists (the same head :: tail from Okamla) </li><li>  Composition of functions </li><li>  Improved lambda expression syntax </li><li>  Infix notation for functions </li><li>  Pipelines </li><li>  Optimization of tail recursion (Guido‚Äôs opinion is known about this, but sometimes you want it) </li><li>  Parallel execution </li></ul><br><p>  It is also worth noting that the language can work in the interpreter mode, compiled into Python source codes and used as a core for Jupyter Notebook (I haven‚Äôt checked it myself yet, but the developers write what they can). </p><br><p>  And now we‚Äôll dwell on some possibilities in more detail.  All examples were tested on Coconut 1.2.1. </p><br><h3 id="sintaksis-lyambda-vyrazheniy">  Lambda expression syntax </h3><br><p>  I‚Äôm sure that it‚Äôs not the pain of lambda expressions in python that pains me.  I even think that she was specially created to be used as little as possible.  Coconut makes the definition of an anonymous function exactly as I would like it to be: </p><br><pre> <code class="python hljs">(x -&gt; x*<span class="hljs-number"><span class="hljs-number">2</span></span>)(a) <span class="hljs-comment"><span class="hljs-comment">#  ,  (lambda x: x*2)(a)</span></span></code> </pre> <br><h3 id="kompoziciya-funkciy">  Composition of functions </h3><br><p>  The composition of functions here looks almost like in Haskel: </p><br><pre> <code class="python hljs">(f .. g .. h)(x) <span class="hljs-comment"><span class="hljs-comment">#  ,   f(g(h(x)))</span></span></code> </pre> <br><h3 id="chastichnoe-primenenie">  Partial application </h3><br><p>  The functools module has a partial function that allows you to create functions with fixed arguments.  It has a significant drawback: positional arguments must be substituted strictly in order.  For example, we need a function that raises numbers to the fifth power.  Logically, we should use partial (we just want to take a function and fix one of the arguments!), But this will not give any gain (pow in both cases is used to distract from the fact that it is an embedded operation): </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> operator <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pow <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">partial5</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: partial(pow(x, <span class="hljs-number"><span class="hljs-number">5</span></span>)), lst) <span class="hljs-comment"><span class="hljs-comment">#  ! def lambda5(lst): return map(lambda x: pow(x, 5), lst) #   </span></span></code> </pre> <br><p>  What can Coconut have to offer?  Here's what: </p><br><pre> <code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coco5</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span></span> = map$(pow$(?, <span class="hljs-number"><span class="hljs-number">5</span></span>), lst)</code> </pre> <br><p>  The <strong>$</strong> symbol immediately after the function name indicates its partial use, <strong>eh?</strong>  used as a placeholder. </p><br><h3 id="payplayny">  Pipelines </h3><br><p>  Another simple concept that is often used in functional languages ‚Äã‚Äãand even in the well-known bash.  In total there are 4 types of pipelines: </p><br><table><tbody><tr><td>  Pipeline </td><td>  Title </td><td>  Usage example </td><td>  Explanation </td></tr><tr><td>  |&gt; </td><td>  simple straight </td><td>  x |&gt; f </td><td>  f (x) </td></tr><tr><td>  &lt;| </td><td>  simple reverse </td><td>  f &lt;|  x </td><td>  f (x) </td></tr><tr><td>  | *&gt; </td><td>  multiargument straight </td><td>  x | *&gt; f </td><td>  f (* x) </td></tr><tr><td>  &lt;* | </td><td>  multiargument reverse </td><td>  f &lt;* |  x </td><td>  f (* x) </td></tr></tbody></table><br><h3 id="sopostavlenie-s-obrazcom-i-algebraicheskie-tipy">  Pattern Matching and Algebraic Types </h3><br><p>  In the simplest case, the pattern matching looks like this: </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">match</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br><p>  Guard and block else may be missing.  In this form, pattern matching is not very interesting, so consider an example from the documentation: </p><br><pre> <code class="python hljs">data Empty() data Leaf(n) data Node(l, r) Tree = (Empty, Leaf, Node) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tree</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> = 0 @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addpattern</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(depth)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tree</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(n)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> = 1 @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addpattern</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(depth)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tree</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(l, r)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> = 1 + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([depth</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(l)</span></span></span></span><span class="hljs-function"><span class="hljs-params">, depth</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(r)</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span></code> </pre> <br><p>  As you might guess, Tree is a type-sum that includes different types of nodes in a binary tree, and the depth function is intended for recursively calculating the depth of a tree.  The addpattern decorator allows you to dispatch using a template. <br>  For cases when the result should be calculated depending on the first suitable template, the keyword <strong>case is</strong> entered.  Here is an example of its use: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">classify_sequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">''' '''</span></span> out = <span class="hljs-string"><span class="hljs-string">""</span></span> case value: match (): out += <span class="hljs-string"><span class="hljs-string">""</span></span> match (_,): out += <span class="hljs-string"><span class="hljs-string">""</span></span> match (x,x): out += <span class="hljs-string"><span class="hljs-string">" "</span></span>+str(x) match (_,_): out += <span class="hljs-string"><span class="hljs-string">""</span></span> match _ <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> (tuple, list): out += <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> TypeError() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> out</code> </pre> <br><h3 id="parallelnoe-vypolnenie">  Parallel execution </h3><br><p>  Coconut's parallel_map and concurrent_map are just wrappers over ProcessPoolExecutor and ThreadPoolExecutor from concurrent.futures.  Despite their simplicity, they provide a simplified interface for multiprocess / multithreaded execution: </p><br><pre> <code class="hljs mel">parallel_map(<span class="hljs-keyword"><span class="hljs-keyword">pow</span></span>$(<span class="hljs-number"><span class="hljs-number">2</span></span>), range(<span class="hljs-number"><span class="hljs-number">100</span></span>)) |&gt; list |&gt; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> concurrent_map(get_data_for_user, all_users) |&gt; list |&gt; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span></code> </pre> <br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  I have always been jealous that in .Net there is F #, under JVM - Scala, Clojure, about the number of functional languages ‚Äã‚Äãcompiled into JS, I‚Äôm generally silent.  I finally found something similar for Python.  I‚Äôm almost sure that Coconut will not get wide distribution, even though I would like to.  After all, functional programming allows you to solve many problems concisely and elegantly.  Often, even without losing the readability of the code. </p><br><p>  ‚Üí <a href="http://coconut-lang.org/">Language site</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/322000/">https://habr.com/ru/post/322000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321982/index.html">Its WEB application, with MVC and registry</a></li>
<li><a href="../321986/index.html">How was the frame rendered in the 1998 Thief game</a></li>
<li><a href="../321992/index.html">DDoS attacks: attack and defense</a></li>
<li><a href="../321996/index.html">Neural Network Based Interview Robot</a></li>
<li><a href="../321998/index.html">Using Tarantool in a .NET project on Windows</a></li>
<li><a href="../322008/index.html">Create a development application using Android Studio</a></li>
<li><a href="../322010/index.html">RDPPatcher sells access to your computer at a low price.</a></li>
<li><a href="../322012/index.html">Public data management: preparation and delivery</a></li>
<li><a href="../322016/index.html">My is an idea, yours is a program, or three real stories about how the author of the idea and the developer shared a startup in court.</a></li>
<li><a href="../322018/index.html">Convenient memo and 8 references to documentation in accordance with GOST 34 (automated systems)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>