<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a blog on symfony 2.8 lts [Part 3]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Navigation in parts of the manual  Part 1 - Configuring Symfony2 and Templates 
 Part 2 - Contact page: validators, forms, and email 
 Part 4 - Commen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a blog on symfony 2.8 lts [Part 3]</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/post/302438/"><img src="https://habrastorage.org/files/8e4/2af/1d1/8e42af1d1d1f4d6f8acdf78bd722788b.jpg"></a> <br><a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">Navigation in parts of the manual</b> <div class="spoiler_text"><blockquote>  <a href="https://habrahabr.ru/post/301760/">Part 1 - Configuring Symfony2 and Templates</a> <br>  <a href="https://habrahabr.ru/post/302032/">Part 2 - Contact page: validators, forms, and email</a> <br>  <a href="https://habrahabr.ru/post/302602/">Part 4 - Comment Model, Repository and Migrations of Doctrine 2</a> <br>  <a href="https://habrahabr.ru/post/303114/">Part 5 - Twig Extensions, Sidebar (sidebar) and Assetic</a> <br>  <a href="https://habrahabr.ru/post/303578/">Part 6 - Modular and Functional Testing</a> <br></blockquote><br></div></div><br><br><h4>  Overview </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Doctrine 2 is a good example of the object-relational mapping (ORM) mechanism for PHP 5.3+, which allows you to work with the database as transparently as possible, using ordinary PHP objects as an intermediate layer.  The basis is a very powerful layer of abstraction from the database (DBAL).  The main task of ORM is to link two concepts: PHP objects and records in a relational database.  One of the key features of Doctrine is the ability to write queries in its own object-oriented language, somewhat resembling SQL, called Doctrine Query Language (DQL).  In addition to small differences from SQL, it allows you to significantly enhance the degree of abstraction between objects and database rows, which allows you to create powerful and flexible queries, while maintaining integrity. <br><br>  In addition to Doctrine 2, we will also familiarize yourself with the concept of Data Fixture.  Data fictures are a mechanism for populating databases for developing and testing suitable test data.  At the end of this chapter, you will define a blog model, update the database to reflect the new model, and create several data fixtures. <br><br>  Project on <a href="">Github</a> <br><br><blockquote>  You can find out how to install the part of the manual you need in the description of the repository by the <a href="https://github.com/AntoscencoVladimir/symfony-blog">link</a> .  (For example, if you want to start with this lesson without going through the previous one) <br></blockquote><br><h4>  Doctrine 2: Model </h4><br>  In order for our blog to function, we need to think about how we will store the data.  Doctrine 2 provides the ORM library specifically for this purpose.  It allows you to use various DBMS including <b>MySQL</b> , <b>PostgreSQL</b> and <b>SQLite</b> .  We will use <b>MySQL</b> , but it can easily be replaced with another DBMS. <br><blockquote>  <b><i>The note</i></b> <br><br>  If you are not familiar with ORM, we will reveal the basic principles.  <a href="https://ru.wikipedia.org/wiki/ORM">The definition from Wikipedia</a> reads: <br>  ORM (English Object-Relational Mapping, Russian object-relational mapping) is a programming technology that links databases with the concepts of object-oriented programming languages, creating a "virtual object database." <br><br>  ORM facilitates the transfer of data from a relational database, such as MySQL to PHP objects, which we can manipulate.  This allows us to encapsulate the necessary functionality that we need in the table through a class.  Provide a user table, it probably has fields: <b>username</b> , <b>password</b> , <b>first_name</b> , <b>last_name</b> , <b>email</b> and <b>job</b> .  With ORM, this becomes a class with <b>username</b> , <b>password</b> , <b>first_name</b> , etc. properties, which allows us to call methods such as <b>getUsername ()</b> and <b>setPassword ()</b> .  ORM went much further, it also allows you to get related tables, while we retrieve the user object or later.  Now suppose that our user has several friends associated with him.  This will be the friends table, with the primary key for the user table.  Now, using ORM, we can call the <b>$ user-&gt; getFriends ()</b> method to return objects from the friends table.  ORM is also involved in saving data, so that we can create objects in PHP, call the <b>save ()</b> method and ORM will save the data to the database.  Since we use the Doctrine 2 ORM library, you will learn much more about its capabilities as you go through the tutorial. <br></blockquote><br><br><blockquote>  <b><i>Note</i></b> <br><br>  While this guide will use the Doctrine 2 ORM library, you can select the Doctrine 2 ODM library.  There are several variations of this library, including implementations for <a href="https://www.mongodb.com/">MongoDB</a> and <a href="http://couchdb.apache.org/">CouchDB</a> .  See the <a href="http://www.doctrine-project.org/projects.html">Doctrine Projects</a> page for more information. <br>  You can also see <a href="http://symfony.com/doc/current/bundles/DoctrineMongoDBBundle/index.html">this article</a> , which explains how to install ODM with symfony 2. <br></blockquote><br><br><h4>  Database </h4><br><br>  <b>Database creation</b> <br><br>  If you are going through the manual from the first part, you should already have the database parameters specified.  If you missed the first part, then update the database_ * values ‚Äã‚Äãin the parameters file located in <code>app/config/parameters.yml</code> <br><br>  Create a database using the Doctrine 2 command. This command only creates a database and does not create any tables in the database.  If a database with the same name already exists, an error message will be displayed, and the existing database will be left unchanged. <br><pre> <code class="bash hljs">$ php app/console doctrine:database:create</code> </pre><br><br><h4>  Essence Blog </h4><br><br>  We'll start by creating the Blog Entity class.  We already talked about the entities in the previous section when we created the entity Inquiry.  Since an entity is intended to store data, it makes sense to use a single entity to present a blog entry.  When we define an entity, we do not say that the data will automatically be mapped to the base.  We saw this in our Inquiry Entity where the data actually stored was just sent by email to the webmaster. <br>  Create a new <code>src/Blogger/BlogBundle/Entity/Blog.php</code> and paste in the following: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Entity/Blog.php namespace Blogger\BlogBundle\Entity; class Blog { protected $title; protected $author; protected $blog; protected $image; protected $tags; protected $comments; protected $created; protected $updated; }</span></span></code> </pre><br><br>  As you can see, this is a simple PHP class.  It does not expand parent and has no access methods.  Each property is declared as <b>protected</b> so we are not able to access them when working with an object of this class.  We could prescribe getters and setters for these properties, but in Doctrine 2 there is a team that performs this task for us. <br>  Before running this command, we need to tell Doctrine 2 how the blog entity should be displayed in the database.  The information is listed as metadata using Doctrine 2 mappings.  Metadata can be defined in various formats including: <b>YAML</b> , <b>PHP</b> , <b>XML</b> and <b>Annotations</b> .  We will use <i>annotations</i> in this tutorial.  It is important to note that not all properties in the object should be saved, so we will not provide metadata for them.  This gives us the opportunity to select only those elements that we require in order for Doctrine 2 to map them to the database.  Replace the content of the Blog entity located at <code>src/Blogger/BlogBundle/Entity/Blog.php</code> <div class="spoiler">  <b class="spoiler_title">as follows:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Entity/Blog.php namespace Blogger\BlogBundle\Entity; use Doctrine\ORM\Mapping as ORM; /** * @ORM\Entity * @ORM\Table(name="blog") */ class Blog { /** * @ORM\Id * @ORM\Column(type="integer") * @ORM\GeneratedValue(strategy="AUTO") */ protected $id; /** * @ORM\Column(type="string") */ protected $title; /** * @ORM\Column(type="string", length=100) */ protected $author; /** * @ORM\Column(type="text") */ protected $blog; /** * @ORM\Column(type="string", length=20) */ protected $image; /** * @ORM\Column(type="text") */ protected $tags; protected $comments; /** * @ORM\Column(type="datetime") */ protected $created; /** * @ORM\Column(type="datetime") */ protected $updated; }</span></span></code> </pre><br></div></div><br>  First, we import and define the Doctrine 2 ORM Mappings namespace.  This allows us to use annotations to describe entity metadata.  Metadata contains information about how properties should be displayed in the database. <br><br><blockquote>  <b><i>The note</i></b> <br><br>  We used only a small fraction of the 2 mapping types provided by Doctrine.  A complete list of mapping types can be found on <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/basic-mapping.html">the Doctrine 2 website</a> .  Other types of comparisons will be discussed later in this guide. <br></blockquote><br><br>  Looking more carefully, you may have noticed that the <b>$ comments</b> property does not describe metadata.  This is because we do not need to save, it will simply provide a set of comments related to the blog post.  Think about it abstracting from the database.  The following code will show more clearly. <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Create a blog object. $blog = new Blog(); $blog-&gt;setTitle("symblog - A Symfony2 Tutorial"); $blog-&gt;setAuthor("dsyph3r"); $blog-&gt;setBlog("symblog is a fully featured blogging website ..."); // Create a comment and add it to our blog $comment = new Comment(); $comment-&gt;setComment("Symfony2 rocks!"); $blog-&gt;addComment($comment);</span></span></code> </pre><br>  The above code snippet demonstrates the normal behavior you expect from a blog and class comments.  The internal <b>$ blog-&gt; addComment ()</b> method can be implemented as follows. <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Blog</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Comment $comment)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[] = $comment; } }</code> </pre><br>  The addComment method simply adds a new comment object to the blog property <b>$ comments</b> .  Getting comments is also fairly simple. <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Blog</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments; } }</code> </pre><br>  As you can see, the <b>$ comments</b> property is just a list of <i>Comment</i> objects.  Doctrine 2 does not change how it works.  Doctrine 2 will be able to automatically populate the <b>$ comments</b> property with objects associated with the <i>blog</i> object. <br>  Now that we‚Äôve talked about how to match entity properties in Doctrine 2, we can generate access methods using the following command in the console. <br><pre> <code class="bash hljs">$ php app/console doctrine:generate:entities Blogger</code> </pre><br>  You will be notified that the Blog Entity has been updated with access methods.  Every time we make changes to the ORM metadata of our entity classes, we can run this command to generate any additional access methods.  This command will not make changes to access methods already present in the entity, so your existing accesses will never be overridden by this command.  This is important because you can later change some of the methods. <br><br><blockquote>  <b><i>The note</i></b> <br><br>  While we use annotations in our entity, you can convert the mapping information to other supported mapping formats using the <i>doctrine: mapping: convert</i> command.  For example, the following command converts the entity mappings above to the yml format. <br><br><pre> <code class="bash hljs">$ php app/console doctrine:mapping:convert --namespace=<span class="hljs-string"><span class="hljs-string">"Blogger\BlogBundle\Entity\Blog"</span></span> yaml src/Blogger/BlogBundle/Resources/config/doctrine</code> </pre><br><br>  And it will create a file in <code>src/Blogger/BlogBundle/Resources/config/doctrine/Blogger.BlogBundle.Entity.Blog.orm.yml</code> which will contain the blog entity mappings in the yml format. <br></blockquote><br><br>  Now we are ready to create a Blog entity view in the database.  There are 2 ways we can achieve this.  We can use Doctrine 2 schema commands to update the database or more powerful Doctrine 2 migrations. Now we will use the schema commands.  Doctrine migrations will be covered in the next section of this guide. <br><br><h4>  Creating a blog table </h4><br><br>  To create a blog table, we can use the following command. <br><br><pre> <code class="bash hljs">$ php app/console doctrine:schema:create</code> </pre><br><br>  This will trigger actions to generate a database schema for the blog entity.  You can also pass the --dump-sql option to dump the SQL.  If you look at the database, you will see that the blog table was created with the fields to which we mapped. <br><br><blockquote>  <b><i>The board</i></b> <br><br>  We used a number of Symfony2 console commands.  You can get help on any command by entering the option --help.  For example, to see help for the doctrine: schema: create command type: <br><br><pre> <code class="bash hljs">$ php app/console doctrine:schema:create --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span></code> </pre><br><br>  Background information will display usage methods as well as available options.  Most commands are executed with several options that can extend it. <br></blockquote><br><br><h4>  Model and display.  Write a blog entry. </h4><br><br>  Now we have the essence of Blog and an updated database for its presentation, we can begin to integrate the model into the display.  We will start by creating the show page of our blog. <br><br>  <i>Show Blog Route</i> <br><br>  We'll start by creating a route for blog show action.  The blog will identify the post by unique ID, so this ID must be presented in the URL.  Update the BloggerBlogBundle route, located <code>src/Blogger/BlogBundle/Resources/config/routing.yml</code> following: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># src/Blogger/BlogBundle/Resources/config/routing.yml BloggerBlogBundle_blog_show: path: /{id} defaults: { _controller: "BloggerBlogBundle:Blog:show" } requirements: methods: GET id: \d+</span></span></code> </pre><br><br>  Since the post ID must be in the URL, we defined the id of the placeholder.  This means that URLs like <a href="http://localhost:8000/1">http: // localhost: 8000/1</a> and <a href="http://localhost:8000/my-blog">http: // localhost: 8000 / my-blog</a> will correspond to this route.  However, we know that the blog <b>id</b> should be an integer (it is defined this way in the entity mapping) so we can add a constraint that determines that this route will only match if the <b>id</b> parameter contains an integer.  This is achieved using the <b>id: \ d +</b> route requirement.  Now only the first example URL will match, but <a href="http://localhost:8000/my-blog">http: // localhost: 8000 / my-blog</a> is gone.  You can also see how the appropriate route will perform the showAction, Blogger \ BlogBundle \ Blog controller method.  This controller has yet to be created. <br><br><h4>  ShowAction method </h4><br><br>  Glue connecting Model and display - this is the controller, this is the place where we will begin to create the page.  We could add the showAction method to our existing Page controller, but since this page is dedicated to displaying blog entities, it would be better to add them to our own Blog controller. <br>  Create a new file located in <code>src/Blogger/BlogBundle/Controller/BlogController.php</code> and paste the following. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Controller/BlogController.php namespace Blogger\BlogBundle\Controller; use Symfony\Bundle\FrameworkBundle\Controller\Controller; /** * Blog controller. */ class BlogController extends Controller { /** * Show a blog entry */ public function showAction($id) { $em = $this-&gt;getDoctrine()-&gt;getManager(); $blog = $em-&gt;getRepository('BloggerBlogBundle:Blog')-&gt;find($id); if (!$blog) { throw $this-&gt;createNotFoundException('Unable to find Blog post.'); } return $this-&gt;render('BloggerBlogBundle:Blog:show.html.twig', array( 'blog' =&gt; $blog, )); } }</span></span></code> </pre><br>  We created a new controller for the <i>Blog</i> entity and defined the <i>showAction</i> method, and also set the id parameter in the BloggerBlogBundle_blog_show route rule, it will be inserted as an argument to the <i>showAction</i> method.  If we defined more parameters in the route rule, they would also be inserted as arguments, separated by commas. <br>  Next, we need to retrieve the Blog Entity from the database.  We first use another helper method of the <b>Symfony \ Bundle \ FrameworkBundle \ Controller \ Controller</b> class to get the Doctrine2 Manager.  The job of the <i>Manager</i> is to process, extract and save objects to and from the database.  Next, we use the Manager object to get the Doctrine 2 Repository for the BloggerBlogBundle: Blog entity.  The syntax shown here is just abbreviations that can be used in Doctrine 2 instead of indicating the full name of the Blogger \ BlogBundle \ Entity \ Blog entity.  Together with the repository object, we call the <b>find ()</b> method and pass in the <b>$ id</b> argument.  This method will receive an object by its primary key. <br>  And at the end we check that the entity was found and pass it to the display.  If the entity is not found, then a createNotFoundException will be returned.  This will form a 404 Not Found answer. <br><br><blockquote>  <b><i>The note</i></b> <br><br>  The repository object provides access to a number of useful helper methods, including <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Return entities where 'author' matches 'dsyph3r' $em-&gt;getRepository('BloggerBlogBundle:Blog')-&gt;findBy(array('author' =&gt; 'dsyph3r')); // Return one entity where 'slug' matches 'symblog-tutorial' $em-&gt;getRepository('BloggerBlogBundle:Blog')-&gt;findOneBySlug('symblog-tutorial');</span></span></code> </pre><br></blockquote><br>  We will create our own custom classes in the repository in the next part, when we need more complex database queries. <br><br><h4>  Display </h4><br><br>  We created the showAction method for the Blog controller and can focus on the display of the Blog entity.  As indicated in the showAction method, the BloggerBlogBundle template will be displayed <b>: Blog: show.html.twig</b> .  Let's create this <code>src/Blogger/BlogBundle/Resouces/views/Blog/show.html.twig</code> and insert the following. <br><pre> <code class="php hljs">{<span class="hljs-comment"><span class="hljs-comment"># src/Blogger/BlogBundle/Resouces/views/Blog/show.html.twig #} {% extends 'BloggerBlogBundle::layout.html.twig' %} {% block title %}{{ blog.title }}{% endblock %} {% block body %} &lt;article class="blog"&gt; &lt;header&gt; &lt;div class="date"&gt;&lt;time datetime="{{ blog.created|date('c') }}"&gt;{{ blog.created|date('l, F j, Y') }}&lt;/time&gt;&lt;/div&gt; &lt;h2&gt;{{ blog.title }}&lt;/h2&gt; &lt;/header&gt; &lt;img src="{{ asset(['images/', blog.image]|join) }}" alt="{{ blog.title }} image not found" class="large" /&gt; &lt;div&gt; &lt;p&gt;{{ blog.blog }}&lt;/p&gt; &lt;/div&gt; &lt;/article&gt; {% endblock %}</span></span></code> </pre><br>  As you might expect, we will start by extending the main Blogger BlogBundle main template.  Next, we will override the page title for our blog.  This will be useful for SEO since the title of the blog page is more descriptive than the default title.  Finally, we will override the body block to display the content of the Blog entity.  We use the asset function again to display the image in a blog.  Blog images should be placed in the <b>web / images</b> directory.  Download images can be on the <a href="https://github.com/AntoscencoVladimir/symfony-blog/tree/master/web/images">link</a> . <br><br><h4>  CSS </h4><br><br>  In order to make a visual design, we need to add some styles.  Add styles below to <code>src/Blogger/BlogBundle/Resouces/public/css/blog.css. <br></code> <code>src/Blogger/BlogBundle/Resouces/public/css/blog.css. <br></code> <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.date</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#ccc</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">24px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#666</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">30px</span></span> } <span class="hljs-selector-class"><span class="hljs-selector-class">.blog</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.blog</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">190px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">float</span></span>: left; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#ccc</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">10px</span></span> <span class="hljs-number"><span class="hljs-number">10px</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.blog</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.meta</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">clear</span></span>: left; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.blog</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.snippet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.continue</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align</span></span>: right; } <span class="hljs-selector-class"><span class="hljs-selector-class">.blog</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.meta</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-style</span></span>: italic; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">12px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#666</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.blog</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.meta</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">p</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">1.2em</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.blog</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.large</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">min-height</span></span>: <span class="hljs-number"><span class="hljs-number">165px</span></span>; }</code> </pre><br><br><blockquote>  <b><i>The note</i></b> <br><br>  If you do not use the symbolic link method to access the bundle‚Äôs assets in the web folder, you must re-run the assets installation command. <br><pre> <code class="bash hljs">$ php app/console assets:install web</code> </pre><br></blockquote><br>  Since we created the controller and the display for the showAction method, let's take a look at the page.  Enter <a href="http://localhost:8000/1">http: // localhost: 8000/1</a> into your browser.  This is not the page you expected to see? <br><br><img src="https://habrastorage.org/files/f52/8bb/c08/f528bbc0843b449c9f92b8ad179e8981.png"><br><br>  Symfony generated a <i>404 Not Found</i> response.  This happened because we have no data in the database, i.e.  An entity with an <b>id</b> of <i>1</i> cannot be found.  You can simply insert a row into the blog table of your database, but we will use the method much better: <i>Data Fixtures</i> . <br><br><h4>  Data patterns </h4><br><br>  We can use fixtures to populate a database with some simple test data.  For this we use doctrine-fixtures-bundle and data-fixtures.  The Doctrine Fixtures extension does not ship with symfony2, we have to manually install it.  Fortunately, this is an easy task.  Open the composer.json file located in the project root and insert the following: <br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">// ... "doctrine/doctrine-fixtures-bundle": "dev-master", "doctrine/data-fixtures" : "dev-master" }</span></span></code> </pre><br>  Next update the libraries with the command. <br><pre> <code class="php hljs">$ composer update</code> </pre><br><br>  This will update all the libraries from Github and install them in the necessary directories. <br>  Now let's register the DoctrineFixturesBundle in the kernel located in <br> <code>app/AppKernel.php <br></code> <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/AppKernel.php public function registerBundles() { $bundles = array( // ... new Doctrine\Bundle\FixturesBundle\DoctrineFixturesBundle(), // ... ); // ... }</span></span></code> </pre><br><h4>  Blog Fiction </h4><br><br>  Now we are ready to define fixtures for our blog.  Create the <code>src/Blogger/BlogBundle/DataFixtures/ORM/BlogFixtures.php</code> and paste <div class="spoiler">  <b class="spoiler_title">following:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/DataFixtures/ORM/BlogFixtures.php namespace Blogger\BlogBundle\DataFixtures\ORM; use Doctrine\Common\DataFixtures\FixtureInterface; use Doctrine\Common\Persistence\ObjectManager; use Blogger\BlogBundle\Entity\Blog; class BlogFixtures implements FixtureInterface { public function load(ObjectManager $manager) { $blog1 = new Blog(); $blog1-&gt;setTitle('A day with Symfony2'); $blog1-&gt;setBlog('Lorem ipsum dolor sit amet, consectetur adipiscing eletra electrify denim vel ports.\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi ut velocity magna. Etiam vehicula nunc non leo hendrerit commodo. Vestibulum vulputate mauris eget erat congue dapibus imperdiet justo scelerisque. Nulla consectetur tempus nisl vitae viverra. Cras el mauris eget erat congue dapibus imperdiet justo scelerisque. Nulla consectetur tempus nisl vitae viverra. Cras elementum molestie vestibulum. Morbi id quam nisl. Praesent hendrerit, orci sed elementum lobortis, justo mauris lacinia libero, non facilisis purus ipsum non mi. Aliquam sollicitudin, augue id vestibulum iaculis, sem lectus convallis nunc, vel scelerisque lorem tortor ac nunc. Donec pharetra eleifend enim vel porta.'); $blog1-&gt;setImage('beach.jpg'); $blog1-&gt;setAuthor('dsyph3r'); $blog1-&gt;setTags('symfony2, php, paradise, symblog'); $blog1-&gt;setCreated(new \DateTime()); $blog1-&gt;setUpdated($blog1-&gt;getCreated()); $manager-&gt;persist($blog1); $blog2 = new Blog(); $blog2-&gt;setTitle('The pool on the roof must have a leak'); $blog2-&gt;setBlog('Vestibulum vulputate mauris eget erat congue dapibus imperdiet justo scelerisque. Na. Cras elementum molestie vestibulum. Morbi id quam nisl. Praesent hendrerit, orci sed elementum lobortis.'); $blog2-&gt;setImage('pool_leak.jpg'); $blog2-&gt;setAuthor('Zero Cool'); $blog2-&gt;setTags('pool, leaky, hacked, movie, hacking, symblog'); $blog2-&gt;setCreated(new \DateTime("2011-07-23 06:12:33")); $blog2-&gt;setUpdated($blog2-&gt;getCreated()); $manager-&gt;persist($blog2); $blog3 = new Blog(); $blog3-&gt;setTitle('Misdirection. What the eyes see and the ears hear, the mind believes'); $blog3-&gt;setBlog('Lorem ipsumvehicula nunc non leo hendrerit commodo. Vestibulum vulputate mauris eget erat congue dapibus imperdiet justo scelerisque.'); $blog3-&gt;setImage('misdirection.jpg'); $blog3-&gt;setAuthor('Gabriel'); $blog3-&gt;setTags('misdirection, magic, movie, hacking, symblog'); $blog3-&gt;setCreated(new \DateTime("2011-07-16 16:14:06")); $blog3-&gt;setUpdated($blog3-&gt;getCreated()); $manager-&gt;persist($blog3); $blog4 = new Blog(); $blog4-&gt;setTitle('The grid - A digital frontier'); $blog4-&gt;setBlog('Lorem commodo. Vestibulum vulputate mauris eget erat congue dapibus imperdiet justo scelerisque. Nulla consectetur tempus nisl vitae viverra.'); $blog4-&gt;setImage('the_grid.jpg'); $blog4-&gt;setAuthor('Kevin Flynn'); $blog4-&gt;setTags('grid, daftpunk, movie, symblog'); $blog4-&gt;setCreated(new \DateTime("2011-06-02 18:54:12")); $blog4-&gt;setUpdated($blog4-&gt;getCreated()); $manager-&gt;persist($blog4); $blog5 = new Blog(); $blog5-&gt;setTitle('You\'re either a one or a zero. Alive or dead'); $blog5-&gt;setBlog('Lorem ipsum dolor sit amet, consectetur adipiscing elittibulum vulputate mauris eget erat congue dapibus imperdiet justo scelerisque.'); $blog5-&gt;setImage('one_or_zero.jpg'); $blog5-&gt;setAuthor('Gary Winston'); $blog5-&gt;setTags('binary, one, zero, alive, dead, !trusting, movie, symblog'); $blog5-&gt;setCreated(new \DateTime("2011-04-25 15:34:18")); $blog5-&gt;setUpdated($blog5-&gt;getCreated()); $manager-&gt;persist($blog5); $manager-&gt;flush(); } }</span></span></code> </pre><br><br></div></div><br><br>  The fixture file demonstrates a number of important features when using Doctrine 2, including how to save objects to the database. <br>  Let's see how we create one blog entry. <br><br><pre> <code class="php hljs">$blog1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Blog(); $blog1-&gt;setTitle(<span class="hljs-string"><span class="hljs-string">'A day in paradise - A day with Symfony2'</span></span>); $blog1-&gt;setBlog(<span class="hljs-string"><span class="hljs-string">'Lorem ipsum dolor sit d us imperdiet justo scelerisque. Nulla consectetur...'</span></span>); $blog1-&gt;setImage(<span class="hljs-string"><span class="hljs-string">'beach.jpg'</span></span>); $blog1-&gt;setAuthor(<span class="hljs-string"><span class="hljs-string">'dsyph3r'</span></span>); $blog1-&gt;setTags(<span class="hljs-string"><span class="hljs-string">'symfony2, php, paradise, symblog'</span></span>); $blog1-&gt;setCreated(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTime()); $blog1-&gt;setUpdated(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getCreated()); $manager-&gt;persist($blog1); <span class="hljs-comment"><span class="hljs-comment">// .. $manager-&gt;flush();</span></span></code> </pre><br>  We start by creating a Blog object and defining its property values.  At the moment, Doctrine 2 does not know anything about the entity object.  This will happen only when we call <b>$ manager-&gt; persist ($ blog1)</b> , with this we instruct Doctrine 2 to start managing this entity object.  The <b>$ manager</b> object here is an instance of the <i>Manager</i> object that we saw earlier when retrieving objects from the database.  It is important to note that while Doctrine 2 is currently aware of an entity object, it is still not stored in the database.  To do this, you need to call <b>$ manager-&gt; flush ().</b> The <i>flush</i> method makes Doctrine 2 begin to interact with the database and use all the entities it manages.  For best performance, you should group the Doctrine 2 commands and perform all actions at once.  We created each object, asked Doctrine 2 to start managing them, and then performed the necessary operations. <br><br><h4>  Fixture loading </h4><br><br>  Now we are ready to load fixtures into the database. <br><pre> <code class="bash hljs">$ php app/console doctrine:fixtures:load</code> </pre><br><br>  To the question whether to continue the execution of the command, we answer: <b>yes</b> <br><br>  If we take a look at <a href="http://localhost:8000/1">http: // localhost: 8000/1,</a> we will see a blog entry. <br><br><img src="https://habrastorage.org/files/781/4b2/e75/7814b2e75bc04d34a553d037a6dd8532.png"><br><br>  Try changing the id in the URL to 2. You should see the following entry. <br><br>  If you go to the URL <a href="http://localhost:8000/100">http: // localhost: 8000/100</a> you will see a 404 Not Found error.  This happened, as expected, since there is no <i>Blog</i> entity with an id of 100. Now try <a href="http://localhost:8000/symfony2-blog">typing http: // localhost: 8000 / symfony2-blog</a> Why is there no 404 Not Found error?  This is due to the fact that the showAction method was not called.  The URL does not match any routes in the application due to the <b>\ d +</b> requirement that we set in the BloggerBlogBundle_blog_show route.  That is why you see no route found for the exception "GET / symfony2-blog". <br><br><h4>  Time stamp </h4><br><br>  Finally, in this part, we look at the 2 properties of timestamps in essence Blog: created and updated.  The functionality for these 2 members is commonly referred to as Timestampable behavior.  These properties contain the time when the record was created and the time it was last updated.  Since we don‚Äôt want to manually set these fields every time we create or update a record, we can use Doctrine 2 for this purpose. <br>  Doctrine 2 comes with an Event System that provides Lifecycle Callbacks.  We can use these callback events to register our entities, receive notifications of events during the entire lifetime of the object.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A few examples of events that we can be notified of before an update occurs, after being saved and deleted. </font><font style="vertical-align: inherit;">To use Lifecycle Callbacks in our entity, we need to register an entity for them. </font><font style="vertical-align: inherit;">This is done using metadata, in essence. </font><font style="vertical-align: inherit;">Update Blog Entity</font></font><code>src/Blogger/BlogBundle/Entity/Blog.php</code> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Entity/Blog.php // .. /** * @ORM\Entity * @ORM\Table(name="blog") * @ORM\HasLifecycleCallbacks */ class Blog { // .. }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, let's add a method to the Blog entity that logs the PreUpdate event. </font><font style="vertical-align: inherit;">We will also add a constructor to set default values ‚Äã‚Äãfor the created and updated properties.</font></font><br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Entity/Blog.php // .. /** * @ORM\Entity * @ORM\Table(name="blog") * @ORM\HasLifecycleCallbacks */ class Blog { // .. public function __construct() { $this-&gt;setCreated(new \DateTime()); $this-&gt;setUpdated(new \DateTime()); } /** * @ORM\PreUpdate */ public function setUpdatedValue() { $this-&gt;setUpdated(new \DateTime()); } // .. }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We registered the Blog entity to be notified of the preUpdate event to set the updated property value. </font><font style="vertical-align: inherit;">Now, when you remove the fixtures from the table, and also remove from each object</font></font><br><br><pre> <code class="php hljs">setCreated(); setUpdated();</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the file </font><font style="vertical-align: inherit;">and rerun the task of loading the fixtures, you will see that the created and updated properties are set automatically.</font></font><br> <code>src/Blogger/BlogBundle/DataFixtures/ORM/BlogFixtures.php <br></code> <br><br><font style="vertical-align: inherit;"></font><br><br><blockquote>  <b><i>The note</i></b> <br><br>    timestampable    ,     . <a href="https://github.com/stof/StofDoctrineExtensionsBundle">StofDoctrineExtensionsBundle</a>    Doctrine 2 ,  Timestampable, Sluggable  Sortable. <br>      .       . <br></blockquote><br><br><h4>  Conclusion </h4><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We looked at a number of concepts for working with models, in Doctrine 2. We considered Data Fixtures, which provided us with an easy way to get test data for developing and testing our application. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next we look at the extension of the model, adding an entity for comments. </font><font style="vertical-align: inherit;">We will start creating the home page and apply the user repository for this. </font><font style="vertical-align: inherit;">We will also introduce the concept of Doctrine Migrations and how forms interact with Doctrine 2 so that we can post comments on the blog. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources and supporting materials: </font></font><br><br> <a href="https://symfony.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://symfony.com/ </font></font></a> <br> <a href="http://tutorial.symblog.co.uk/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://tutorial.symblog.co.uk/ </font></font></a> <br> <a href="http://twig.sensiolabs.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://twig.sensiolabs.org/ </font></font></a> <br> <a href="http://www.doctrine-project.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.doctrine-project.org/ </font></font></a> <br> <a href="http://odiszapc.ru/doctrine/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: / /odiszapc.ru/doctrine/</font></font></a> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Post Scriptum</font></font></b> <div class="spoiler_text"><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Thank you all for the attention and comments made on the project, if you have any difficulties or questions, unsubscribe in the comments or private messages, add to friends. </font></font></blockquote><br></div></div><br><blockquote>  <a href="https://habrahabr.ru/post/301760/">Part 1 - Configuring Symfony2 and Templates</a> <br>  <a href="https://habrahabr.ru/post/302032/">Part 2 - Contact page: validators, forms, and email</a> <br>  <a href="https://habrahabr.ru/post/302602/">Part 4 - Comment Model, Repository and Migrations of Doctrine 2</a> <br>  <a href="https://habrahabr.ru/post/303114/">Part 5 - Twig Extensions, Sidebar (sidebar) and Assetic</a> <br>  <a href="https://habrahabr.ru/post/303578/">Part 6 - Modular and Functional Testing</a> <br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, if you like the guide, you can put a star to </font></font><a href="https://github.com/AntoscencoVladimir/symfony-blog"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the project repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or subscribe.</font></font> Thank. </div><p>Source: <a href="https://habr.com/ru/post/302438/">https://habr.com/ru/post/302438/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302424/index.html">The final release of the browser Vivaldi 1.2</a></li>
<li><a href="../302426/index.html">Broadcaster for MacBook. Facebook Edition</a></li>
<li><a href="../302428/index.html">Model-View in QML. Part Four: C ++ Models</a></li>
<li><a href="../302430/index.html">Habrahabr articles citation graph</a></li>
<li><a href="../302432/index.html">We use HTML and WebBrowser control as a UI for ordinary windows applications in C #</a></li>
<li><a href="../302442/index.html">Deployer - convenient and flexible application deployment</a></li>
<li><a href="../302448/index.html">‚ÄúNo longer means better‚Äù: counterintuitive case from Google</a></li>
<li><a href="../302456/index.html">Haordic Organization Visa (Part 3)</a></li>
<li><a href="../302458/index.html">We write our malware. Part 1: Learn to write a completely ‚Äúundetectable‚Äù keylogger</a></li>
<li><a href="../302460/index.html">Migrating HipChat Server data from self-hosted VM to Amazon EC2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>