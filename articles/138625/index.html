<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sort: key vs cmp</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When sorting in Python 2, there are at least two ways to sort this ‚Äúcustomize‚Äù sorting: these are the key and cmp parameters. The first was added only...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sort: key vs cmp</h1><div class="post__text post__text-html js-mediator-article"> When sorting in Python 2, there are at least two ways to sort this ‚Äúcustomize‚Äù sorting: these are the <code>key</code> and <code>cmp</code> parameters.  The first was added only in Python 2.4, and the second was removed in Python 3.0.  These facts seem to suggest that <code>key</code> indeed better.  Who does not agree with this or not sure - please under the cat. <br><a name="habracut"></a><br>  First, a small digression to the documentation, so that everything does not look too messy. <br><br>  For sorting in Python, one usually uses either built-in `sorted`, or` list.sort`.  Actually a challenge <pre> <code class="python hljs">sorted(iterable, **kwargs)</code> </pre>  <a href="">equivalent to</a> code <pre> <code class="python hljs">lst = list(iterable); lst.sort(**kwargs); lst</code> </pre>  so let's focus on `list.sort` later. <br><br>  `list.sort` accepts three optional parameters:` key` is a function (actually any callable object) that accepts a list item and returns an object that will be used in the comparison during sorting instead of the original list item;  `cmp` is a function that takes two elements of the list and returns -1, 0 or 1 depending on the relationship between the parameters passed;  `reversed` - if` True`, then the list will be sorted in reverse order. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, what to use if, for example, you need to sort the list of objects by the `id` field?  Look at the `cmp` and` key` approaches: <br><br><pre> <code class="hljs python">lst.sort(cmp=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x, y: cmp(x[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], y[<span class="hljs-string"><span class="hljs-string">'id'</span></span>])) <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre> <br><pre> <code class="hljs python">lst.sort(key=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]) <span class="hljs-comment"><span class="hljs-comment"># , , </span></span></code> </pre> <br>  Not to be unfounded about the speed, a couple of tests: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>lst = [{<span class="hljs-string"><span class="hljs-string">'id'</span></span>: x, <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">1000</span></span>)] &gt;&gt;&gt; random.shuffle(lst) &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with_cmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> ... lst.sort(cmp=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x, y: cmp(x[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], y[<span class="hljs-string"><span class="hljs-string">'id'</span></span>])) ... &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with_key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> ... lst.sort(key=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]) ... &gt;&gt;&gt; timeit.timeit(<span class="hljs-string"><span class="hljs-string">'with_cmp(lst[:])'</span></span>, setup=<span class="hljs-string"><span class="hljs-string">'from __main__ import with_cmp, lst'</span></span>, number=<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-number"><span class="hljs-number">2.7731389999389648</span></span> &gt;&gt;&gt; timeit.timeit(<span class="hljs-string"><span class="hljs-string">'with_key(lst[:])'</span></span>, setup=<span class="hljs-string"><span class="hljs-string">'from __main__ import with_key, lst'</span></span>, number=<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-number"><span class="hljs-number">0.55310797691345215</span></span></code> </pre><br>  Why such a big difference?  The fact is that if the `key` parameter is present, its value is applied to all list items only once at the beginning of sorting ( <a href="">sorts</a> ), while` cmp` values ‚Äã‚Äãare used for each comparison!  Given that the team-grade ( <a href="http://habrahabr.ru/company/infopulse/blog/133303/">parsing algorithm</a> ), which is used in Python, has an average score of nlog (n), we can assume that in our example lambda from `cmp` was called several times more often. <br><br>  In fact, you can (and should) do it even faster - using not the slow Python function, but the native one written in C. The <a href="http://docs.python.org/library/operator.html">operator</a> library helps a lot.  Here's what the results from <a href="http://docs.python.org/library/operator.html">operator.itemgetter</a> will look like (there are still <a href="http://docs.python.org/library/operator.html">docs.python.org/library/operator.html#operator.attrgetter</a> , <a href="http://docs.python.org/library/operator.html">methodcalled</a> and many other tasty <a href="http://docs.python.org/library/operator.html">things</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> operator <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> itemgetter &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with_op</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> ... lst.sort(key=itemgetter(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)) ... &gt;&gt;&gt; timeit.timeit(<span class="hljs-string"><span class="hljs-string">'with_op(lst[:])'</span></span>, setup=<span class="hljs-string"><span class="hljs-string">'from __main__ import with_op, lst, itemgetter'</span></span>, number=<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-number"><span class="hljs-number">0.4054520057716877</span></span></code> </pre> <br>  Total, <s>20</s> 7x increase in speed in comparison with the first option - not bad, right? <br><br>  Understood with speed, about clarity.  I do not think that the use of `key` \` cmp` should be a matter of taste, for the latter is a great example of the <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">abstraction that flows</a> .  Everything is fine as long as the function-value of the `cmp` parameter uses built-in` cmp`, which hides the details of the sorting mechanism, but what will you do when you are asked to predict the output of the following code: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numeric_compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x - y &gt;&gt;&gt; sorted([<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>], cmp=numeric_compare)</code> </pre> <br>  Of course, you remember that `cmp` should return -1, 0 or 1, but what exactly?  If `x` is greater than` y`, should it be 1 or -1?  If you return 2, will there be an error or 2 will be interpreted as 1?  Of course, it is possible to find answers to questions in half a minute, but why search?  I think it is better to use a better abstraction, that is, the `key` parameter. <br><br>  Warning questions, I agree that there are probably rare examples of tasks where the `key` is not enough.  But these are exceptions, and there are also recipes for them (for example, one such is <a href="http://wiki.python.org/moin/HowTo/Sorting">Sorting Mini-HOW TO: cmp_to_key</a> ). <br><br>  Thanks for attention. <br><hr><br>  PS Problem.  Why does the following code behave so strangely: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>ls = [(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)] &gt;&gt;&gt; ls.sort(key=reversed) &gt;&gt;&gt; ls [(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)] &gt;&gt;&gt; ls.sort(key=reversed) &gt;&gt;&gt; ls [(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)]</code> </pre>  Answer: <br>  <font color="#ffffff">`reversed` returns an object of type` &lt;type 'reversed'&gt; `for which rich-comparsion methods are undefined.</font>  <font color="#ffffff">Therefore, `list.sort` uses the` id` of objects that are constantly changing for comparison.</font>  <font color="#ffffff">Use `operator.itemgetter (slice (None, None, -1))` instead of `reversed`.</font> </div><p>Source: <a href="https://habr.com/ru/post/138625/">https://habr.com/ru/post/138625/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138617/index.html">Communicator Huawei Honor - impressions of use</a></li>
<li><a href="../138619/index.html">MVC Application: Mail</a></li>
<li><a href="../138620/index.html">Combining mobile and fixed communications: how it works from the inside</a></li>
<li><a href="../138622/index.html">Citrix XenServer Free 5.6 Security or "... you need to find a different hypervisor"</a></li>
<li><a href="../138623/index.html">NFC tags from metro maps</a></li>
<li><a href="../138627/index.html">Django Meetup - March 1 in Moscow</a></li>
<li><a href="../138628/index.html">Black holes and gold mines on the web development market</a></li>
<li><a href="../138629/index.html">Development of a WEB project on Node.JS: Part 2</a></li>
<li><a href="../138630/index.html">Embedded Systems: Windows Special Purpose</a></li>
<li><a href="../138631/index.html">Be the center of attention!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>