<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ReactJS 15.0.2 Tutorial</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We will create a simple but realistic comment module for the blog, a simplified analogue of the real-time comment module offered by resources such as ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ReactJS 15.0.2 Tutorial</h1><div class="post__text post__text-html js-mediator-article"><p>  We will create a simple but realistic comment module for the blog, a simplified analogue of the real-time comment module offered by resources such as Disqus, LiveFyre and Facebook. </p><br><p>  We will provide: </p><br><ul><li>  View to display all comments </li><li>  Form to enter and send comments </li><li>  Reserve for the future, to connect this back-end </li></ul><br><p>  Will also be implemented: </p><br><ul><li>  <strong>Optimistic commenting:</strong> comments appear on the page before they are stored on the server, which will visually speed up our module </li><li>  <strong>Live updates:</strong> comments from other users appear on the page in real time. </li><li>  <strong>Markdown formatting:</strong> users can use markdown markup to format text </li></ul><br><h2>  Final version </h2><br><p>  <a href="https://github.com/reactjs/react-tutorial">GitHub link</a> </p><a name="habracut"></a><br><h2>  Server startup </h2><br><p>  Before proceeding to the manual, we need to start the server.  It is a simple API that we will use to receive and store data.  We have already written it for you in several interpreted languages, it has the minimum necessary functionality.  You can <a href="https://github.com/reactjs/react-tutorial/">read the source code</a> or <a href="">download a zip archive</a> containing everything you need. </p><br><h2>  Getting started </h2><br><p>  In this guide, we will try to implement everything as simple as possible.  In the <a href="">archive</a> that we mentioned above, you will find an HTML file in which we will continue to work.  Open the <strong><em>public / index.html</em></strong> file in your code editor.  It should look like this: </p><br><pre><code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- index.html --&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>React Tutorial<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/react/15.0.2/react.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/react/15.0.2/react-dom.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/babel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"scripts/example.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/babel"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//      script,  scripts/example.js //       . </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  All the JavaScript code from the manual we will write in the script tag.  Since we have not implemented live-reloading, you will have to refresh the project page in the browser every time after saving changes.  You can track your results by opening the <a href="http://localhost:3000/">http: // localhost: 3000</a> link in your browser (after starting the server).  When you open the link for the first time, without any code changes, you will see the final version of our comment module.  In order to get started, you must remove the first script tag that loads the code for the final version of the project <strong><em>"scripts / example.js"</em></strong> . </p><br><p>  <em>Note: We use jQuery in our project to simplify the code of our future ajax requests, but this is <strong>NOT a</strong> required library for React to work.</em> </p><br><h2>  Your first component </h2><br><p>  React is a modular, composable framework.  Our project consists of several components located in the following structure: </p><br><ul><li>  CommentBox <br><ul><li>  CommentList <br><ul><li>  Comment </li></ul></li><li>  CommentForm </li></ul></li></ul><br><p>  Create a <strong><em>CommentBox</em></strong> component that will be a regular <strong><em><code>&lt;div&gt;</code></em></strong> tag at the output: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial1.js var CommentBox = React.createClass({ render: function() { return ( &lt;div className="commentBox"&gt; Hello, world! I am a CommentBox. &lt;/div&gt; ); } }); ReactDOM.render( &lt;CommentBox /&gt;, document.getElementById('content') );</span></span></code> </pre> <br><p>  Note that the names of HTML elements begin with a small letter, while the names of React classes are large. </p><br><h2>  JSX Syntax </h2><br><p>  The first thing that catches your eye is the XML-like syntax in the submitted JavaScript code.  We use a simple precompiler that produces pure javascript at the output: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial1-raw.js var CommentBox = React.createClass({displayName: 'CommentBox', render: function() { return ( React.createElement('div', {className: "commentBox"}, "Hello, world! I am a CommentBox." ) ); } }); ReactDOM.render( React.createElement(CommentBox, null), document.getElementById('content') );</span></span></code> </pre> <br><p>  It is not necessary to use precompilers; you can write in pure JavaScript, but in our guide we will use the JSX syntax, in our opinion, it is simpler and clearer.  You can read more about it on the page of the <a href="https://facebook.github.io/react/docs/jsx-in-depth.html">JSX Syntax article</a> . </p><br><h2>  What happens in the code </h2><br><p>  We pass a JavaScript object with several methods to <em>React.createClass ()</em> to create a new React component.  The most important of the passed methods is called <em>render</em> , it returns the React tree of components, which will eventually be converted to HTML. </p><br><p>  <code>&lt;div&gt;</code> tags are not real DOM nodes, this is an implementation of React <code>&lt;div&gt;</code> components.  You can consider them as markers or pieces of data that React knows how to process.  React is safe in terms of <strong>XSS</strong> vulnerabilities. </p><br><p>  You do not need to return HTML code.  You can return the component tree that you (or someone else) have created.  This approach makes React <strong>composable: a</strong> key sign of a frontend's maintainable and well-designed architecture. </p><br><p>  <em>ReactDOM.render ()</em> creates an instance of the root component, runs the framework, and inserts the markup into the DOM element passed in with the second argument. </p><br><p>  The <em>ReactDom</em> object contains methods for working with the DOM, while the <em>React</em> object contains the root methods used in other libraries, such as <a href="http://facebook.github.io/react-native/">React Native</a> . </p><br><p>  The call to <em>ReactDOM.render</em> should be made after the declaration of all components.  <strong>It is important.</strong> </p><br><h2>  Combined components </h2><br><p>  Create a skeleton for <strong><em>CommentList</em></strong> and <strong><em>CommentForm</em></strong> , which will be the usual <code>&lt;div&gt;</code> .  Add these two components to your file, leaving <strong><em>CommentBox</em></strong> and <strong><em>ReactDOM.render</em></strong> in the previous example in place: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial2.js var CommentList = React.createClass({ render: function() { return ( &lt;div className="commentList"&gt; Hello, world! I am a CommentList. &lt;/div&gt; ); } }); var CommentForm = React.createClass({ render: function() { return ( &lt;div className="commentForm"&gt; Hello, world! I am a CommentForm. &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  Next, make changes to the <strong><em>CommentBox</em></strong> component to use our new components (lines marked "// new"): </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial3.js var CommentBox = React.createClass({ render: function() { return ( &lt;div className="commentBox"&gt; //new start &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList /&gt; &lt;CommentForm /&gt; //new end &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  Notice how we mix the HTML tags and components that we created.  HTML components are standard React components, as well as those that we announced, but with only one difference.  The JSX preprocessor will automatically rewrite HTML tags in <strong><em>React.createElement (tagName)</em></strong> expressions and leave everything else alone.  This is necessary to prevent clogging of the global namespace. </p><br><h2>  Use of details </h2><br><p>  Create a <strong><em>Comment</em></strong> component that will depend on the data passed by the parent component.  The data transferred from the parent is available as a property in the child component.  Access to properties through <strong><em>this.props</em></strong> .  Using the details, we can read the data transferred to the <strong><em>Comment</em></strong> from <strong><em>CommentList</em></strong> , and display the markup: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial4.js var Comment = React.createClass({ render: function() { return ( &lt;div className="comment"&gt; &lt;h2 className="commentAuthor"&gt; {this.props.author} &lt;/h2&gt; {this.props.children} &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  By enclosing a javascript expression in braces inside JSX, you can add text or React components to the tree.  We get access to the named attributes passed to the component as keys in <em>this.props</em> and to any nested elements, for example <strong>this.props.children</strong> . </p><br><h2>  Component Properties </h2><br><p>  Now that we have the <strong><em>Comments</em></strong> component announced, we will pass the name of the author and the text of the comment to it.  This will allow us to reuse the same code for each comment.  Now add some comments to the <strong><em>CommentList</em></strong> component: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial5.js var CommentList = React.createClass({ render: function() { return ( &lt;div className="commentList"&gt; //new start &lt;Comment author="Pete Hunt"&gt;This is one comment&lt;/Comment&gt; &lt;Comment author="Jordan Walke"&gt;This is *another* comment&lt;/Comment&gt; //new end &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  Notice how we passed the data from the parent <strong><em>CommentList</em></strong> component to the child <strong><em>Comment</em></strong> components.  For example, we passed <em>Pete Hunt</em> (via an attribute) and <em>This is one connent</em> (via an XML-like child node) on the first <strong><em>Comment</em></strong> .  As mentioned earlier, the <strong><em>Comment</em></strong> component accesses these properties through <em>this.props.author</em> and <em>this.props.children</em> . </p><br><h2>  Add Markdown Markup </h2><br><p>  Markdown is a convenient way to format text.  For example, text wrapped in asterisks will be underlined at the exit. </p><br><p>  In this tutorial, we use the third-party <strong>marked</strong> library, which converts Markdown markup to pure HTML.  We have already connected this library earlier in our HTML file, so that we can start using it.  Let's convert the comment text with the markdown markup and display it: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial6.js var Comment = React.createClass({ render: function() { return ( &lt;div className="comment"&gt; &lt;h2 className="commentAuthor"&gt; {this.props.author} &lt;/h2&gt; {marked(this.props.children.toString())} // new &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  All we have done here is called the <strong>marked</strong> library.  Now it is necessary to convert <em>this.props.children</em> from a React-like text to a regular string that the <strong>marked</strong> will understand, so we specifically call the <strong><em>toString ()</em></strong> function for this. </p><br><p>  But there is a problem!  Our processed components look like this in the browser: " <code>&lt;p&gt;</code> This is <code>&lt;em&gt;</code> another <code>&lt;/em&gt;</code> comment <code>&lt;/p&gt;</code> ".  We need to convert all tags into markup for HTML text. </p><br><p>  So React protects you from XSS attacks.  Below is a way to get around this: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial7.js //new start var Comment = React.createClass({ rawMarkup: function() { var rawMarkup = marked(this.props.children.toString(), {sanitize: true}); return { __html: rawMarkup }; }, //new end render: function() { return ( &lt;div className="comment"&gt; &lt;h2 className="commentAuthor"&gt; {this.props.author} &lt;/h2&gt; &lt;span dangerouslySetInnerHTML={this.rawMarkup()} /&gt; //new &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  This is a special API that intentionally complicates working with pure HTML, but we will make an exception for <strong>marked</strong> . </p><br><p>  <strong>Attention !:</strong> using similar exceptions, you completely rely on the security of the <strong>marked</strong> library.  To do this, we pass the second argument <em>senitize: true</em> , which includes clearing any HTML tags. </p><br><h2>  We connect the data model </h2><br><p>  Up to this point, we inserted comments directly from the code.  Now we will try to convert the JSON object into a sheet of comments.  Next we will take them from the server, but for now we will add these lines to our code: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial8.js var data = [ {id: 1, author: "Pete Hunt", text: "This is one comment"}, {id: 2, author: "Jordan Walke", text: "This is *another* comment"} ];</span></span></code> </pre> <br><p>  Now we need to pass this object to <strong><em>CommentList</em></strong> , while respecting modularity.  Let's change <strong><em>CommentBox</em></strong> and <strong><em>RenderDOM.render ()</em></strong> to transfer data to the <strong><em>CommentList</em></strong> component using the <em>props</em> method: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial9.js var CommentBox = React.createClass({ render: function() { return ( &lt;div className="commentBox"&gt; &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList data={this.props.data} /&gt; //new &lt;CommentForm /&gt; &lt;/div&gt; ); } }); ReactDOM.render( &lt;CommentBox data={data} /&gt;, //new document.getElementById('content') );</span></span></code> </pre> <br><p>  Now the data is available in the <strong><em>CommentList</em></strong> component, let's try to dynamically display comments: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial10.js var CommentList = React.createClass({ render: function() { //new start var commentNodes = this.props.data.map(function(comment) { return ( &lt;Comment author={comment.author} key={comment.id}&gt; {comment.text} &lt;/Comment&gt; ); }); //new end return ( &lt;div className="commentList"&gt; {commentNodes} // new &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  Done! </p><br><h2>  Getting comments from the server </h2><br><p>  Let's replace the comments wired in the code with the data from the server.  To do this, replace the <em>data</em> attribute with a <em>url</em> , as shown below: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial11.js ReactDOM.render( &lt;CommentBox url="/api/comments" /&gt;, // new document.getElementById('content') );</span></span></code> </pre> <br><p>  <strong>Attention.</strong>  At this stage, the code does not work. </p><br><h2>  Reactive state </h2><br><p>  Until now, based on their parameters, each component has drawn itself once, <em>props are</em> unchanged - this means that they are transmitted from the parent and it remains their owner.  To organize the interaction, we add a variable property to the component.  <em>this.state</em> is private to the component and can be changed by calling <em>this.setState ()</em> .  After updating the property, the component will redraw itself. </p><br><p>  <em>The render ()</em> methods are written declaratively, like the functions of <em>this.props</em> and <em>this.state</em> . <br>  React ensures that the data on the server and in the user interface. </p><br><p>  When the server sends data, we need to change the comments in the interface.  Add a component with comments to the <strong><em>CommentBox</em></strong> component as a separate parameter: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial12.js var CommentBox = React.createClass({ //new start getInitialState: function() { return {data: []}; }, //new end render: function() { return ( &lt;div className="commentBox"&gt; &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList data={this.state.data} /&gt; // new &lt;CommentForm /&gt; &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  <em>getInitialState ()</em> is executed once during the component's life cycle and sets the initial state of the component. </p><br><h3>  Update Status </h3><br><p>  After creating the component, we want to get JSON from the server and update the data in the component to display it in the interface.  For asynchronous requests to the server, we will use jQuery.  The data is already on the server (stored in comments.json) that you started at the very beginning.  When data is received from the server, <em>this.state.data</em> will contain: </p><br><pre> <code class="javascript hljs">[ {<span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Pete Hunt"</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"This is one comment"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-string"><span class="hljs-string">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Jordan Walke"</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"This is *another* comment"</span></span>} ]</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial13.js var CommentBox = React.createClass({ getInitialState: function() { return {data: []}; }, //new start componentDidMount: function() { $.ajax({ url: this.props.url, dataType: 'json', cache: false, success: function(data) { this.setState({data: data}); }.bind(this), error: function(xhr, status, err) { console.error(this.props.url, status, err.toString()); }.bind(this) }); }, //new end render: function() { return ( &lt;div className="commentBox"&gt; &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList data={this.state.data} /&gt; &lt;CommentForm /&gt; &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  The <em>componentDidMount</em> method is automatically called by React after the <em>component</em> is initially drawn.  The <em>this.setState ()</em> method is responsible for the dynamic update.  We will replace the old comments array with a new one from the server and our interface will automatically update itself.  Because of this, we will need to make minor edits to add a real-time update.  For simplicity, we will use the technology of <em>polling</em> (Frequent requests), but in the future you can easily use WebSockets or any other technology. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial14.js var CommentBox = React.createClass({ loadCommentsFromServer: function() { // new $.ajax({ url: this.props.url, dataType: 'json', cache: false, success: function(data) { this.setState({data: data}); }.bind(this), error: function(xhr, status, err) { console.error(this.props.url, status, err.toString()); }.bind(this) }); }, // new getInitialState: function() { return {data: []}; }, componentDidMount: function() { //new start this.loadCommentsFromServer(); setInterval(this.loadCommentsFromServer, this.props.pollInterval); //new end }, render: function() { return ( &lt;div className="commentBox"&gt; &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList data={this.state.data} /&gt; &lt;CommentForm /&gt; &lt;/div&gt; ); } }); ReactDOM.render( &lt;CommentBox url="/api/comments" pollInterval={2000} /&gt;, // new document.getElementById('content') );</span></span></code> </pre> <br><p>  Here we moved the AJAX request to a separate method and initiate its call after the component is first loaded and every 2 seconds after.  Now try to open our comments page in the browser and make changes to the <em>comments.json</em> file (in the root directory of your server);  within 2 seconds you will see the changes on the page. </p><br><h2>  Add new comments </h2><br><p>  Now it's time to create a comment form.  Our <strong><em>CommentForm</em></strong> component should prompt the user for the name and text of the comment, then send a request to the server to further save the comment. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial15.js var CommentForm = React.createClass({ render: function() { return ( //new start &lt;form className="commentForm"&gt; &lt;input type="text" placeholder="Your name" /&gt; &lt;input type="text" placeholder="Say something..." /&gt; &lt;input type="submit" value="Post" /&gt; &lt;/form&gt; //new end ); } });</span></span></code> </pre> <br><h3>  Controlled Components </h3><br><p>  In a traditional DOM, the <em>input</em> element is drawn and then the browser already sets its value.  As a result, the DOM value will be different from the component value.  It's bad when the value in the view is different from the value in the component.  In React, a component must always correspond to the representation and not only at the moment of its initialization. </p><br><p>  Therefore, we will use <em>this.state</em> to store user input.  We declare the initial <em>state</em> with two properties, <em>author</em> and <em>text,</em> and assign them the value of the empty string.  In our <code>&lt;input&gt;</code> element, we assign the <em>value of</em> the <em>state</em> <em>value to the</em> value parameter, and hang the <em>onChange</em> handler on it.  This <code>&lt;input&gt;</code> element with the value attribute set is called a monitored component.  You can read more about the controlled components in the <a href="https://facebook.github.io/react/docs/forms.html">Forms article</a> . </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial16.js var CommentForm = React.createClass({ //new start getInitialState: function() { return {author: '', text: ''}; }, handleAuthorChange: function(e) { this.setState({author: e.target.value}); }, handleTextChange: function(e) { this.setState({text: e.target.value}); }, //new end render: function() { return ( &lt;form className="commentForm"&gt; //new start &lt;input type="text" placeholder="Your name" value={this.state.author} onChange={this.handleAuthorChange} /&gt; &lt;input type="text" placeholder="Say something..." value={this.state.text} onChange={this.handleTextChange} /&gt; //new end &lt;input type="submit" value="Post" /&gt; &lt;/form&gt; ); } });</span></span></code> </pre> <br><h4>  Developments </h4><br><p>  React event handlers use the <em>camelCase</em> naming convention.  We hung <em>onChange</em> handlers on two <code>&lt;input&gt;</code> elements.  Now that the user has entered data in the <code>&lt;input&gt;</code> field, the event handler makes a callback and modifies the value of the component.  Subsequently, the <em>input</em> value will be updated to reflect the current value of the component. </p><br><h4>  Form submission </h4><br><p>  Let's make the form interactive.  After the user submits the form, we need to clear it, send a request to the server and update the list of comments.  To get started, get the form data and clean it up. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial17.js var CommentForm = React.createClass({ getInitialState: function() { return {author: '', text: ''}; }, handleAuthorChange: function(e) { this.setState({author: e.target.value}); }, handleTextChange: function(e) { this.setState({text: e.target.value}); }, //new start handleSubmit: function(e) { e.preventDefault(); var author = this.state.author.trim(); var text = this.state.text.trim(); if (!text || !author) { return; } // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">     this.setState({author: '', text: ''}); }, //new end render: function() { return ( &lt;form className="commentForm" onSubmit={this.handleSubmit}&gt; // new &lt;input type="text" placeholder="Your name" value={this.state.author} onChange={this.handleAuthorChange} /&gt; &lt;input type="text" placeholder="Say something..." value={this.state.text} onChange={this.handleTextChange} /&gt; &lt;input type="submit" value="Post" /&gt; &lt;/form&gt; ); } });</span></span></code> </pre> <br><p>  We hang the <em>onSubmit</em> handler on the form, which will clear it when the form is filled with the correct data and sent. </p><br><p>  Call <em>preventDefault ()</em> to prevent the browser from submitting a default form. </p><br><h4>  Callbacks as parameters </h4><br><p>  When a user sends a comment, we need to update the comment sheet to add a new one.  It makes sense to implement all this logic in the <strong><em>CommentBox</em></strong> , since <strong><em>CommentBox</em></strong> manages the list of comments. </p><br><p>  We need to pass from the child component to the parent.  We will do this through our parent <em>render</em> method, passing a new callback ( <em>handleCommentSubmit</em> ) to the child, associating it with the child component's <em>onCommentSubmit</em> event.  Each time an event occurs, the callback function is called: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial18.js var CommentBox = React.createClass({ loadCommentsFromServer: function() { $.ajax({ url: this.props.url, dataType: 'json', cache: false, success: function(data) { this.setState({data: data}); }.bind(this), error: function(xhr, status, err) { console.error(this.props.url, status, err.toString()); }.bind(this) }); }, //new start handleCommentSubmit: function(comment) { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">        }, //new end getInitialState: function() { return {data: []}; }, componentDidMount: function() { this.loadCommentsFromServer(); setInterval(this.loadCommentsFromServer, this.props.pollInterval); }, render: function() { return ( &lt;div className="commentBox"&gt; &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList data={this.state.data} /&gt; &lt;CommentForm onCommentSubmit={this.handleCommentSubmit} /&gt; // new &lt;/div&gt; ); } });</span></span></code> </pre> <br><p>  Now, when the <strong><em>CommentBox</em></strong> component <strong><em>has</em></strong> provided access to the callback function of the <strong><em>CommentForm</em></strong> component via the <em>onCommentSubmit</em> parameter, the <em>CommentForm</em> component can call the callback function when the user submits the form: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial19.js var CommentForm = React.createClass({ getInitialState: function() { return {author: '', text: ''}; }, handleAuthorChange: function(e) { this.setState({author: e.target.value}); }, handleTextChange: function(e) { this.setState({text: e.target.value}); }, handleSubmit: function(e) { e.preventDefault(); var author = this.state.author.trim(); var text = this.state.text.trim(); if (!text || !author) { return; } this.props.onCommentSubmit({author: author, text: text}); // new this.setState({author: '', text: ''}); }, render: function() { return ( &lt;form className="commentForm" onSubmit={this.handleSubmit}&gt; &lt;input type="text" placeholder="Your name" value={this.state.author} onChange={this.handleAuthorChange} /&gt; &lt;input type="text" placeholder="Say something..." value={this.state.text} onChange={this.handleTextChange} /&gt; &lt;input type="submit" value="Post" /&gt; &lt;/form&gt; ); } });</span></span></code> </pre> <br><p>  Now that we have a callback function, we just have to send the data to the server and update the comment sheet: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial20.js var CommentBox = React.createClass({ loadCommentsFromServer: function() { $.ajax({ url: this.props.url, dataType: 'json', cache: false, success: function(data) { this.setState({data: data}); }.bind(this), error: function(xhr, status, err) { console.error(this.props.url, status, err.toString()); }.bind(this) }); }, handleCommentSubmit: function(comment) { //new start $.ajax({ url: this.props.url, dataType: 'json', type: 'POST', data: comment, success: function(data) { this.setState({data: data}); }.bind(this), error: function(xhr, status, err) { console.error(this.props.url, status, err.toString()); }.bind(this) }); //new end }, getInitialState: function() { return {data: []}; }, componentDidMount: function() { this.loadCommentsFromServer(); setInterval(this.loadCommentsFromServer, this.props.pollInterval); }, render: function() { return ( &lt;div className="commentBox"&gt; &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList data={this.state.data} /&gt; &lt;CommentForm onCommentSubmit={this.handleCommentSubmit} /&gt; &lt;/div&gt; ); } });</span></span></code> </pre> <br><h2>  Optimization: optimistic updates </h2><br><p>  Our application is ready, but waiting for the completion of the request to the server and the appearance of your comment on the page makes it visually slow.  We can immediately add our comment to the list, not waiting for the server request to complete, and this will occur almost instantly. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// tutorial21.js var CommentBox = React.createClass({ loadCommentsFromServer: function() { $.ajax({ url: this.props.url, dataType: 'json', cache: false, success: function(data) { this.setState({data: data}); }.bind(this), error: function(xhr, status, err) { console.error(this.props.url, status, err.toString()); }.bind(this) }); }, handleCommentSubmit: function(comment) { //new start var comments = this.state.data; // Optimistically set an id on the new comment. It will be replaced by an // id generated by the server. In a production application you would likely // not use Date.now() for this and would have a more robust system in place. comment.id = Date.now(); var newComments = comments.concat([comment]); this.setState({data: newComments}); //new end $.ajax({ url: this.props.url, dataType: 'json', type: 'POST', data: comment, success: function(data) { this.setState({data: data}); }.bind(this), error: function(xhr, status, err) { this.setState({data: comments}); // new console.error(this.props.url, status, err.toString()); }.bind(this) }); }, getInitialState: function() { return {data: []}; }, componentDidMount: function() { this.loadCommentsFromServer(); setInterval(this.loadCommentsFromServer, this.props.pollInterval); }, render: function() { return ( &lt;div className="commentBox"&gt; &lt;h1&gt;Comments&lt;/h1&gt; &lt;CommentList data={this.state.data} /&gt; &lt;CommentForm onCommentSubmit={this.handleCommentSubmit} /&gt; &lt;/div&gt; ); } });</span></span></code> </pre> <br><h2>  Congratulations! </h2><br><p>  You have created a comment module in a few simple steps.  Learn <a href="https://facebook.github.io/react/docs/why-react.html">more about why using React</a> , or go straight to learning about the <a href="https://facebook.github.io/react/docs/top-level-api.html">API</a> and start writing code!  Good luck! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/282874/">https://habr.com/ru/post/282874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282858/index.html">MikroTik and 192.168.0.0/24</a></li>
<li><a href="../282860/index.html">Site protection against hacker attacks - Nemesida WAF</a></li>
<li><a href="../282862/index.html">Snow cooling system. White Datacenter Project</a></li>
<li><a href="../282866/index.html">ELK on Docker</a></li>
<li><a href="../282870/index.html">Voice control of the smart home on the Z-wave via Siri</a></li>
<li><a href="../282876/index.html">The digest of interesting materials for the mobile developer # 151 (April 25-May 3)</a></li>
<li><a href="../282878/index.html">Validation: inside entities or outside?</a></li>
<li><a href="../282884/index.html">My experience setting up an environment for web development</a></li>
<li><a href="../282886/index.html">Attackers use a set of exploits for cyber attacks on Android users</a></li>
<li><a href="../282890/index.html">Sasha Goldshtein, the guru of .NET Performance, will speak at the .NET conference in St. Petersburg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>