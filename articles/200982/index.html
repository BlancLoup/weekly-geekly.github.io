<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Auto provisioning for grandstream or take out and put the soul into the GXP1165</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Until recently, we used Fanvil products as VoIP devices. And in general, everyone was happy. There is a management from a single point, the quality of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Auto provisioning for grandstream or take out and put the soul into the GXP1165</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/fa8/34e/f49/fa834ef498625fa0cc315885564522b6.jpg" alt="image"><br>  Until recently, we used Fanvil products as VoIP devices.  And in general, everyone was happy.  There is a management from a single point, the quality of communication is satisfactory, but there was a feeling of some kind of incompleteness or even understatement (understand how you want :))) In general, the search for the ‚Äúideal phone‚Äù in the background, but it continued all the time.  And then Grandstream GXP1165 fell into my hands.  Having a more eminent manufacturer, this model is in the same price category as the Chinese Fanvil.  It has all the necessary functions and has a more intuitive notation on the buttons and ports of connection.  In addition, for some time, one of the decisive factors when choosing an IP phone for me is the function of auto provisioning.  This grandstream model promised it.  This will be further discussed. <br><a name="habracut"></a><br>  My experience with auto provisioning was <a href="http://habrahabr.ru/post/151596/">based</a> on the Chinese products already mentioned.  And I naively thought that with Grandstream everything would look about the same.  In general, it happened.  But I did not expect <b>how much</b> everything will turn out.  In order not to be unsubstantiated, I will bring two pieces of settings from one and another device.  Settings are obtained by exporting a file. <br>  <b>Fanvil:</b> <br><pre><code class="bash hljs">Static IP :192.168.1.179 Static NetMask :255.255.255.0 Static GateWay :192.168.1.1 Default Protocol :2 Primary DNS :202.96.134.133 Alter DNS :202.96.128.68 DHCP Mode :1 DHCP Dns :1 Domain Name : Host Name :VOIP Pppoe Mode :0 HTL Start Port :10000 HTL Port Number :200 SNTP Server :209.81.9.7</code> </pre> <br>  Now hold on.  A piece of settings from the <b>grandstream config</b> : <br><pre> <code class="bash hljs">P335=2 P90=0 P91=0 P212=1 P92=0 P93=0 P338=0 P1339=0 P94=0 P2340=0 P95=0 P2341=0 P2342=0 P96=97 P2343=0 P97=1 P99=0 P10=168 P11=0 P2346=0 P2347=0 P12=160 P13=255 P2348=0 P14=255</code> </pre><br>  BUT!  How do you ?!  Impressed?  In truth, I deceived you a little.  The working configuration of the phone looks different.  But then you can imagine my confusion when I saw the configuration I downloaded from the device. <br>  Immediately visible are the pros and cons of one and the other fellow.  The Chinese have made settings more close to human understanding.  But Americans gaining a good amount of documentation.  In the end, it helped me. <br>  You can create a configuration file for grandstream in two ways.  With the help of <a href="http://www.grandstream.com/support/tools">utilities</a> on the manufacturer's website (there are tools for Windows and for Linux) and manually, via an XML file.  With the first method I did not work out.  Therefore, I will describe the second. <br>  As you already understood, the names of the configuration fields are encrypted and finding their description is not that difficult, but I had to surf the Internet.  Something took <a href="http://www.voip-info.org/wiki/view/Grandstream%2BConfiguration%2BTool">here</a> , something <a href="">here</a> and in general it turned out such a file. <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gs_provision</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mac</span></span></span><span class="hljs-tag">&gt;</span></span>000a91547c9c<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mac</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Admin Password --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P2</span></span></span><span class="hljs-tag">&gt;</span></span>PasswordQWER<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P3</span></span></span><span class="hljs-tag">&gt;</span></span>Grandstream<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- SIP Registration. 0-no,1-yes --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P31</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P31</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Register Expiration (in minutes. default 1 hour, max 45 days) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P32</span></span></span><span class="hljs-tag">&gt;</span></span>60<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P32</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Authenticate password --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P34</span></span></span><span class="hljs-tag">&gt;</span></span>SIPassword<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P34</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- SIP User ID --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P35</span></span></span><span class="hljs-tag">&gt;</span></span>111<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P35</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Authenticate ID --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P36</span></span></span><span class="hljs-tag">&gt;</span></span>111<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P36</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P40</span></span></span><span class="hljs-tag">&gt;</span></span>5561<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P40</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- SIP Server --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P47</span></span></span><span class="hljs-tag">&gt;</span></span>sip.address.ru:5561<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P47</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- DNS Mode. 0-A Record, 1-SRV, 2-NAPTR/SRV, 3-Use Configured IP --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P103</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P103</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Time Format 0-12, 1-24 --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P122</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P122</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P148</span></span></span><span class="hljs-tag">&gt;</span></span>Grandstream Provisioning<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P148</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P237</span></span></span><span class="hljs-tag">&gt;</span></span>config.address.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P237</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Account Name. Cannot be empty. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P270</span></span></span><span class="hljs-tag">&gt;</span></span>TestConfig<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P270</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Account 1 --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Account Active (In Use). 0-no, 1-yes --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P271</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P271</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Enable Phonebook. 0(Disabled)/1(HTTP)/2(TFTP)/3(HTTPS) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P330</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P330</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Phone Book XML Server Path --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P331</span></span></span><span class="hljs-tag">&gt;</span></span>config.address.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P331</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Phone Book Download Interval (in minutes) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P332</span></span></span><span class="hljs-tag">&gt;</span></span>5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P332</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Remove Manually-edited entries on Download. Possible values: 0(No)/1(Yes) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P333</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P333</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- XML FILE ENCRYPTION --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P1349</span></span></span><span class="hljs-tag">&gt;</span></span>password123<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P1349</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P1362</span></span></span><span class="hljs-tag">&gt;</span></span>ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P1362</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Degree Unit. auto - Automatic, f - Fahrenheit, c - Celsius. Default is auto --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P1379</span></span></span><span class="hljs-tag">&gt;</span></span>c<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">P1379</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gs_provision</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This config allows you to register the device on a SIP server running on a non-standard port 5561. Also included are minor features like weather display in Celsius and settings for the path to the address book.  Parameters that are not specified will be set by default. <br>  The finished file must be encrypted. <br><pre> <code class="bash hljs">openssl enc -e -aes-256-cbc -k password123 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> basefile.xml -out cfg000d91447b9b.xml</code> </pre><br>  The file name should be of the form cfg [macaddress] .xml.  We will distribute the file via HTTP, so we simply post it in / var / www / <i>(Installing apache as apt-get install apache2, sorry, I will not describe :))</i> <br>  Further, by analogy with Fanvil-s, we automate this process. <br>  Create a users file with the following contents: <br><pre> <code class="bash hljs">000a91547c9c 111 SIPassword User Grand</code> </pre>  <i>Please note mac address should be written in small letters.</i> <i><br></i> <br>  ... and bash file that will take settings from users <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash uspath=/opt/neoflex/gxp1165 usfile=(`cat $uspath/users`) macdir=/var/www/ a=0 #macaddrr b=1 #number c=2 #pass d=3 #2name e=4 #1name while [ ${usfile[$a]} ] do dfile=$macdir'cfg'${usfile[$a]} cat &lt;&lt;EOF &gt;&gt;$dfile &lt;?xml version="1.0" encoding="UTF-8" ?&gt; &lt;gs_provision version="1"&gt; &lt;mac&gt;${usfile[$a]}&lt;/mac&gt; &lt;config version="1"&gt; &lt;!-- Admin Password --&gt; &lt;P2&gt;PasswordQWER&lt;/P2&gt; &lt;P3&gt;DisplayTest&lt;/P3&gt; &lt;!-- SIP Registration. 0 - no, 1 - yes --&gt; &lt;P31&gt;1&lt;/P31&gt; &lt;!-- Register Expiration (in minutes. default 1 hour, max 45 days) --&gt; &lt;P32&gt;60&lt;/P32&gt; &lt;!-- Authenticate password --&gt; &lt;P34&gt;${usfile[$c]}&lt;/P34&gt; &lt;!-- SIP User ID --&gt; &lt;P35&gt;${usfile[$b]}&lt;/P35&gt; &lt;!-- Authenticate ID --&gt; &lt;P36&gt;${usfile[$b]}&lt;/P36&gt; &lt;P40&gt;5561&lt;/P40&gt; &lt;!-- SIP Server --&gt; &lt;P47&gt;sip.server.ru:5561&lt;/P47&gt; &lt;!-- DNS Mode. 0 - A Record, 1 - SRV, 2 - NAPTR/SRV, 3 - Use Configured IP. Default is 0 --&gt; &lt;P103&gt;0&lt;/P103&gt; &lt;!-- Time Format --&gt; &lt;P122&gt;1&lt;/P122&gt; &lt;P148&gt;Grandstream Provisioning&lt;/P148&gt; &lt;!-- HTTP Firmware Update Server --&gt; &lt;P192&gt;config.server.ru&lt;/P192&gt; &lt;P237&gt;config.server.ru&lt;/P237&gt; &lt;!-- Account Name. Cannot be empty. --&gt; &lt;P270&gt;${usfile[$d]} ${usfile[$e]}&lt;/P270&gt; &lt;!-- Account 1 --&gt; &lt;!-- Account Active (In Use). 0 - no, 1 - yes --&gt; &lt;P271&gt;1&lt;/P271&gt; &lt;!-- Enable Phonebook0(Disabled)/1(HTTP)/2(TFTP)/3(HTTPS) --&gt; &lt;P330&gt;1&lt;/P330&gt; &lt;!-- Phone Book XML Server Path --&gt; &lt;P331&gt;sip.server.ru&lt;/P331&gt; &lt;!-- Phone Book Download Interval (in minutes) --&gt; &lt;P332&gt;60&lt;/P332&gt; &lt;!-- Remove Manually-edited entries on Download. Possible values: 0 (No) / 1 (Yes) --&gt; &lt;P333&gt;1&lt;/P333&gt; &lt;!-- XML FILE ENCRYPTION --&gt; &lt;P1349&gt;password&lt;/P1349&gt; &lt;P1362&gt;ru&lt;/P1362&gt; &lt;!-- Update Interval.Default is 15 --&gt; &lt;P1378&gt;60&lt;/P1378&gt; &lt;!-- Degree Unit. auto - Automatic, f - Fahrenheit, c - Celsius. Default is auto --&gt; &lt;P1379&gt;c&lt;/P1379&gt; &lt;/config&gt; &lt;/gs_provision&gt; EOF openssl enc -e -aes-256-cbc -k password -in $dfile -out $dfile.xml rm $dfile a=`expr $a + 5` b=`expr $b + 5` c=`expr $c + 5` d=`expr $d + 5` e=`expr $e + 5` done</span></span></code> </pre><br>  Everything.  At the output of / var / www / we get the encrypted XML nickname cfg000a91547c9c.xml <br>  In the settings of the device itself, it is enough to set the path to the configuration server and password to decrypt the config file. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c06/669/fa4/c06669fa4d03f08367dc39529d5a706f.png" alt="image"><br>  At the bottom, press the "Save and apply" button and send it to the reboot using the "Restart" button in the upper right corner of the screen. <br><br>  But on this I did not calm down.  In the process of digging in the documentation I came across a description of the address book settings for the phone.  And I, without hesitation, zababahal a script that generates phonebook.xml collecting it from sip configs. <br>  <i>Important!</i>  <i>My callerid parameter looks like SecondName FirsName &lt;111&gt;.</i>  <i>That is, all extensions must have a callerid field and exactly with three values.</i> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash a=0 b=1 c=2 book=phonebook.xml echo | sed -n '/callerid\=/p' /etc/asterisk/sip*.conf| sed s'/callerid\=//'g | sed s'/&lt;/ /'g | sed s'/&gt;//'g | sed s'/;//'g &gt;&gt; tmp.file spisok=(`cat tmp.file`) echo '&lt;?xml version="1.0" encoding="UTF-8"?&gt;' &gt;&gt; $book echo "&lt;AddressBook&gt;" &gt;&gt; $book while [ ${spisok[a]} ];do cat &lt;&lt;EOF &gt;&gt;$book &lt;Contact&gt; &lt;LastName&gt;${spisok[a]}&lt;/LastName&gt; &lt;FirstName&gt;${spisok[b]}&lt;/FirstName&gt; &lt;Phone&gt; &lt;phonenumber&gt;${spisok[c]}&lt;/phonenumber&gt; &lt;accountindex&gt;1&lt;/accountindex&gt; &lt;downloaded&gt;0&lt;/downloaded&gt; &lt;/Phone&gt; &lt;Groups&gt; &lt;groupid&gt;2&lt;/groupid&gt; &lt;/Groups&gt; &lt;/Contact&gt; EOF a=`expr $a + 3` b=`expr $b + 3` c=`expr $c + 3` done echo "&lt;/AddressBook&gt;" &gt;&gt;$book cp phonebook.xml /var/www/ rm tmp.file</span></span></code> </pre><br>  If the path to the address book is registered correctly, then after the reboot the directory will be pulled up on the device.  You can verify this by pressing the button with the phone book on the phone case or in the settings via the web interface. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/7a2/249/6ea/7a22496eaa78d91e54beb9efeafa9772.jpg" alt="image"><br><br>  But that was not enough for me.  So.  The final chord. <br>  Perhaps the only drawback of the device is the meager selection of ringtones.  Only three and those ugly ones.  But!  Ringtones can pour their own! <br>  <i>A method for Linux is described.</i>  <i>Wilita for Windows is <a href="">here</a> .</i> <br>  Download and unpack the utility. <br><pre> <code class="bash hljs">wget http://www.grandstream.com/sites/default/files/Resources/linux_music_ring_tone_gen.zip unzip linux_music_ring_tone_gen.zip</code> </pre><br>  Rename sox.linux to just sox and assign rights. <br><pre> <code class="bash hljs">mv sox.linux sox chmod 755 sox</code> </pre><br>  Read the readme. <br>  <i>./sox sound.wav ring1.ring</i> <br>  It's simple.  At the entrance to the wav file at the output ring1.ring.  Files can be no more than three - ring1.ring, ring2.ring and ring3.ring respectively.  Size no more than 100 Kb, the authors themselves recommend no more than 70 Kb for each file.  The resulting ring-s need to change the extension to .bin and fill for example the same place where the config files are. <br>  <i>To fill ringtones in the config file is a field <code>.      .</code></i> <i><code>.      .</code> <br></i>  <i>Everything.</i>  <i>We start up the phone in reboot and use the command tail -f /var/log/apache/access.log to see what happens.</i>  <i>It will look something like this.</i> <i><br></i> <pre> <i><code class="bash hljs">192.168.0.16 -- [05/Nov/2013:17:15:52 +0400] <span class="hljs-string"><span class="hljs-string">"GET /language.txt HTTP/1.1"</span></span> 404 480 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span> 192.168.0.16 -- [05/Nov/2013:17:16:10 +0400] <span class="hljs-string"><span class="hljs-string">"GET /cfg000a91547c9c HTTP/1.0"</span></span> 200 1787 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span> 192.168.0.16 -- [05/Nov/2013:17:16:14 +0400] <span class="hljs-string"><span class="hljs-string">"GET /cfg000a91547c9c.xml HTTP/1.0"</span></span> 200 1849 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span> 192.168.0.16 -- [05/Nov/2013:17:16:32 +0400] <span class="hljs-string"><span class="hljs-string">"GET /gxp1160fw.bin HTTP/1.0"</span></span> 404 537 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span> 192.168.0.16 -- [05/Nov/2013:17:16:36 +0400] <span class="hljs-string"><span class="hljs-string">"GET /gxp1160fw.bin HTTP/1.0"</span></span> 404 537 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span> 192.168.0.16 -- [05/Nov/2013:17:16:38 +0400] <span class="hljs-string"><span class="hljs-string">"GET /ring1.bin HTTP/1.0"</span></span> 200 65847 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span> 192.168.0.16 -- [05/Nov/2013:17:16:39 +0400] <span class="hljs-string"><span class="hljs-string">"GET /ring2.bin HTTP/1.0"</span></span> 200 39388 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span> 192.168.0.16 -- [05/Nov/2013:17:16:42 +0400] <span class="hljs-string"><span class="hljs-string">"GET /ring3.bin HTTP/1.0"</span></span> 404 533 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Grandstream Model HW GXP1165 SW 1.0.5.26 DevId 000a91547c9c"</span></span></code></i> </pre></div><p>Source: <a href="https://habr.com/ru/post/200982/">https://habr.com/ru/post/200982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200966/index.html">How to create a product concept and write TK for electronics development</a></li>
<li><a href="../200972/index.html">Free COLT licenses for Open-Source projects</a></li>
<li><a href="../200976/index.html">How to help children learn foreign languages? Take advantage of mobile applications, of course!</a></li>
<li><a href="../200978/index.html">ReactOS: Autumn Marathon</a></li>
<li><a href="../200980/index.html">A little about independent game developers</a></li>
<li><a href="../200984/index.html">CheckPoint: installation, initial setup and organization of a cluster of two firewall modules</a></li>
<li><a href="../200986/index.html">A simple way to get the left subdomain to your project, or "fable about what happens if you do not read the license agreement"</a></li>
<li><a href="../200990/index.html">YouTube Center</a></li>
<li><a href="../200992/index.html">Retouching old photos in Corel PaintShop Photo Pro</a></li>
<li><a href="../200994/index.html">Autumn Sale 2013 on Steam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>