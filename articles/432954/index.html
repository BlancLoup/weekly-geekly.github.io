<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>And back into space: how the unicorn Stellarium visited</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For all the time of its existence, people have made a tremendous amount of effort to study almost the entire area of ‚Äã‚Äãthe starry sky. To date, we hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>And back into space: how the unicorn Stellarium visited</h1><div class="post__text post__text-html js-mediator-article">  For all the time of its existence, people have made a tremendous amount of effort to study almost the entire area of ‚Äã‚Äãthe starry sky.  To date, we have considered hundreds of thousands of asteroids, comets, nebulae and stars, galaxies and planets.  To see all this beauty on your own, it‚Äôs not necessary to leave the house and buy a telescope for yourself.  You can install on the computer Stellarium - a virtual planetarium, and look at the night sky, lying comfortably on the couch ... But is it comfortable?  To find out the answer to this question, check Stellarium for errors in the computer code. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b8/c8b/129/4b8c8b12983537442bfea4700cadca97.png"></div><br><a name="habracut"></a><br><h2>  A little about the project ... </h2><br>  As <a href="https://ru.wikipedia.org/wiki/Stellarium">described</a> on Wikipedia, <a href="https://stellarium.org/">Stellarium</a> is an open source virtual planetarium that is available for Linux, Mac OS X, Microsoft Windows, Symbian, Android and iOS platforms, and MeeGo.  The program uses OpenGL and Qt technologies to create a realistic sky in real time.  With Stellarium it is possible to see what can be seen with an average and even large telescope.  The program also provides observations of solar eclipses and the movement of comets. <br><br>  Stellarium was created by French programmer Fabian Chereau, who launched the project in the summer of 2001.  Other prominent developers include Robert Spearman, Johannes Hajdozik, Matthew Gates, Timothy Reeves, Bogdan Marinov and Johan Meeris, who are responsible for the artwork. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  ... and about the analyzer </h2><br>  The project was analyzed using the PVS-Studio static code analyzer.  It is a tool for identifying errors and potential vulnerabilities in source code of programs written in C, C ++ and C # languages ‚Äã‚Äã(in a short time and in Java!).  Works on Windows, Linux and macOS.  It is designed for those who need to improve the quality of their code. <br><br>  To conduct the analysis was simple enough.  First, I <a href="https://github.com/Stellarium">downloaded</a> the Stellarium project from GitHub, and then installed all the packages needed for building.  Since the project is built using Qt Creator, I used a compiler launch tracking system that is built into the <a href="https://www.viva64.com/ru/m/0033/">Standalone</a> analyzer version.  You can also view the finished analysis report. <br><br>  New readers and users of <b><i>Stellarium</i></b> may have wondered: why does the unicorn appear in the title of the article, and how is it associated with code analysis?  I answer: I am one of the developers of PVS-Studio, and the unicorn is our favorite naughty mascot.  So up! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfc/8f2/aab/bfc8f2aaba0bf61f3b40d4d0765dd027.png"></div><br>  I hope that thanks to this article, readers will learn something new, and the developers of Stellarium will be able to eliminate some of the errors and improve the quality of the code. <br><br>  Bring yourself a coffee with an air croissant and make yourself comfortable, because we turn to the most interesting - a review of the analysis results and analysis of errors! <br><br><h2>  Suspicious conditions </h2><br>  For more pleasure from reading, I suggest not looking directly at the analyzer warning, but try here and further to find the errors yourself. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QZipReaderPrivate::scanFiles() { .... <span class="hljs-comment"><span class="hljs-comment">// find EndOfDirectory header int i = 0; int start_of_directory = -1; EndOfDirectory eod; while (start_of_directory == -1) { const int pos = device-&gt;size() - int(sizeof(EndOfDirectory)) - i; if (pos &lt; 0 || i &gt; 65535) { qWarning() &lt;&lt; "QZip: EndOfDirectory not found"; return; } device-&gt;seek(pos); device-&gt;read((char *)&amp;eod, sizeof(EndOfDirectory)); if (readUInt(eod.signature) == 0x06054b50) break; ++i; } .... }</span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v654/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v654/">V654</a> The condition 'start_of_directory == - 1' of loop is always true.  qzip.cpp 617 <br><br>  Could you find a bug?  If yes, then praise. <br><br>  The error lies in the condition of the <i>while loop</i> .  It is always true, since the variable <i>start_of_directory</i> does not change in the body of the loop.  Most likely, the cycle will not last forever, since it contains <i>return</i> and <i>break</i> , but this code looks strange. <br><br>  It seems to me that in the code they forgot to make the <i>start_of_directory = pos</i> assignment in the place where the signature is being checked.  Then the <i>break</i> statement is probably superfluous.  In this case, the code can be rewritten as: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> start_of_directory = <span class="hljs-number"><span class="hljs-number">-1</span></span>; EndOfDirectory eod; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (start_of_directory == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = device-&gt;size() - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)) - i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt; <span class="hljs-number"><span class="hljs-number">65535</span></span>) { qWarning() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"QZip: EndOfDirectory not found"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } device-&gt;seek(pos); device-&gt;read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)&amp;eod, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readUInt(eod.signature) == <span class="hljs-number"><span class="hljs-number">0x06054b50</span></span>) start_of_directory = pos; ++i; }</code> </pre> <br>  However, I'm not sure that the code should be exactly like that.  It is best that the project developers themselves analyze this part of the program and make the necessary edits. <br><br>  Another weird condition: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StelProjectorCylinder</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StelProjector { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersectViewportDiscontinuityInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3d&amp; capN, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> capD)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capN, capD)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cap.intersects(cap1) &amp;&amp; cap.intersects(cap2) &amp;&amp; cap.intersects(cap2); } };</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v501/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v501/">V501</a> cap.intersects (cap2) 'operator'.  StelProjectorClasses.hpp 175 <br><br>  As you probably already guessed, the error lies in the last line of the function: the programmer made a typo, and in the end it turned out that the function returns the result regardless of the <i>cap3</i> value. <br><br>  This type of error is extremely common: in almost every verified project we encountered typos related to names such as <i>name1</i> and <i>name2</i> and the like.  As a rule, such errors are related to copy-paste. <br><br>  This copy of the code is a vivid example of another common error pattern, about which we even conducted a separate mini-study.  My colleague Andrei Karpov called it the ‚Äú <a href="https://www.viva64.com/ru/b/0260/">last line effect</a> ‚Äù.  If you are not familiar with this material yet, then I suggest opening the tab in the browser to read later, but for now let's continue. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> BottomStelBar::updateText(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> updatePos) { .... updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location-&gt;text() != newLocation || updatePos) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fov-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fps-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (updatePos) { .... } }</code> </pre> <br>  <b>PVS-Studio warnings:</b> <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v560/">V560</a> A part of the conditional expression is always true: updatePos.  StelGuiItems.cpp 732 </li><li>  <a href="https://www.viva64.com/ru/w/v547/">V547</a> Expression 'updatePos' is always true.  StelGuiItems.cpp 831 </li><li>  <a href="https://www.viva64.com/ru/w/v763/">V763</a> Parameter 'updatePos' is always rewritten in function body before being used.  StelGuiItems.cpp 690 </li></ul><br>  The value of the <i>updatePos</i> parameter <i>is</i> always overwritten before it is used, i.e.  the function will work the same way, regardless of the value passed to it. <br><br>  Looks weird, right?  In all places where the <i>updatePos</i> parameter is <i>involved</i> , it is <i>true</i> .  This means that the <i>if (location-&gt; text ()! = NewLocation || updatePos)</i> and <i>if (updatePos) conditions</i> will always be true. <br><br>  Another snippet: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> LandscapeMgr::onTargetLocationChanged(StelLocation loc) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pl &amp;&amp; flagEnvironmentAutoEnabling) { QSettings* conf = StelApp::getInstance().getSettings(); setFlagAtmosphere(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_atmosphere"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagFog(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_fog"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagLandscape(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } .... }</code> </pre> <br>  <b>PVS-Studio warnings:</b> <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v792/">V792</a> The 'toBool' function of the left operand.  Perhaps, it is better to use '&amp;&amp;'.  LandscapeMgr.cpp 782 </li><li>  <a href="https://www.viva64.com/ru/w/v792/">V792</a> The 'toBool' function of the left operand.  Perhaps, it is better to use '&amp;&amp;'.  LandscapeMgr.cpp 783 </li></ul><br>  The analyzer detected a suspicious expression in the arguments of the <i>setFlagAtmosphere</i> and <i>setFlagFog functions</i> .  Indeed: on both sides of the bit operator <i>&amp; there</i> are values ‚Äã‚Äãof type <i>bool</i> .  Instead of the <i>&amp;</i> operator, use the <i>&amp;&amp;</i> operator, and now I will explain why. <br><br>  Yes, the result of this expression will always be correct.  Before using the bitwise "and" both operands will rise to the type <i>int</i> .  In C ++, this conversion is <a href="">unambiguous</a> : false is converted to 0, and true is converted to 1. Therefore, the result of this expression will be the same as if the <i>&amp;&amp;</i> operator was used. <br><br>  But there is a nuance.  When calculating the result of the <i>&amp;&amp;</i> operation, the so-called ‚Äúlazy evaluation‚Äù is used.  If the value of the left operand is <i>false</i> , then the right value is not even calculated, because the logical ‚Äúand‚Äù will return <i>false</i> in any case.  This is done to save computational resources and allows you to write more complex structures.  For example, you can check that the pointer is not null, and, if so, dereference it for additional verification.  Example: <i>if (ptr &amp;&amp; ptr-&gt; foo ())</i> . <br><br>  Such a "lazy calculation" is not performed using the bitwise operator <i>&amp;</i> : the expression <i>conf-&gt; value ("...", true) .toBool ()</i> will be calculated every time, regardless of the value of <i>pl-&gt; hasAtmosphere ()</i> . <br><br>  In rare cases, this is done on purpose.  For example, if the calculation of the right operand has ‚Äúside effects‚Äù, the result of which is used later.  It is also not very good to do this, because it complicates the understanding of the code and complicates the care of it.  In addition, the order of evaluation of the operands <i>&amp; is</i> not defined, so in some cases of using such "tricks" you can get undefined behavior. <br><br>  If you want to save side effects - do it on a separate line and save the result in a separate variable.  People who will work with this code in the future will be grateful to you :) <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/301/5a6/971/3015a69710bc07f948b5233dac04fc87.png"></div><br>  Go to the next topic. <br><br><h2>  Wrong work with memory </h2><br>  Let's start the topic of dynamic memory with this fragment: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/************ Basic Edge Operations ****************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/* __gl_meshMakeEdge creates one edge, * two vertices, and a loop (face). * The loop consists of the two new half-edges. */</span></span> GLUEShalfEdge* __gl_meshMakeEdge(GLUESmesh* mesh) { GLUESvertex* newVertex1 = allocVertex(); GLUESvertex* newVertex2 = allocVertex(); GLUESface* newFace = allocFace(); GLUEShalfEdge* e; <span class="hljs-comment"><span class="hljs-comment">/* if any one is null then all get freed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( newVertex1 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newVertex2 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newFace == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex1 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex1); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex2 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex2); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newFace != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newFace); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } e = MakeEdge(&amp;mesh-&gt;eHead); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } MakeVertex(newVertex1, e, &amp;mesh-&gt;vHead); MakeVertex(newVertex2, e-&gt;Sym, &amp;mesh-&gt;vHead); MakeFace(newFace, e, &amp;mesh-&gt;fHead); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e; }</code> </pre> <br>  <b>PVS-Studio warnings:</b> <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v773/">V773</a> The function of the newVertex1 pointer.  A memory leak is possible.  mesh.c 312 </li><li>  The 'newVertex2' pointer.  A memory leak is possible.  mesh.c 312 </li><li>  <a href="https://www.viva64.com/ru/w/v773/">V773</a> The function of the newFace pointer.  A memory leak is possible.  mesh.c 312 </li></ul><br>  The function allocates memory for several structures and passes it to pointers <i>newVertex1</i> , <i>newVertex2</i> (interesting names, right?) And <i>newFace</i> .  If one of them turns out to be zero, then all the memory reserved within the function is released, after which the control flow leaves the function. <br><br>  What happens if the memory for all three structures is allocated correctly, and the function <i>MakeEdge (&amp; mesh-&gt; eHead)</i> returns <i>NULL</i> ?  The control flow reaches the second <i>return</i> . <br><br>  Since the pointers <i>newVertex1</i> , <i>newVertex2</i> and <i>newFace</i> are local variables, they will cease to exist after exiting the function.  But the release of the memory that belonged to them will not happen.  It will remain reserved, but we will no longer have access to it. <br><br>  Such situations are called ‚Äúmemory leak‚Äù.  A typical scenario with such an error: with a long program running, it begins to consume more and more RAM, until its complete exhaustion. <br><br>  It should be noted that in this example, the third <i>return is</i> not an error.  The <i>MakeVertex</i> and <i>MakeFace functions</i> transfer the addresses of the allocated memory to other data structures, thereby delegating responsibility for its release. <br><br>  The next flaw is in the method that takes 90 lines.  For convenience, I cut it, leaving only problem areas. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AstroCalcDialog::drawAngularDistanceGraph() { .... QVector&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; xs, ys; .... }</code> </pre> <br>  Only one line left.  I'll give you a hint: this is the only mention of <i>xs</i> and <i>ys</i> objects. <br><br>  <b>PVS-Studio warnings:</b> <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v808/">V808</a> 'xs' object of 'QVector' type created but not used.  AstroCalcDialog.cpp 5329 </li><li>  <a href="https://www.viva64.com/ru/w/v808/">V808</a> 'ys' object of 'QVector' type created but not used.  AstroCalcDialog.cpp 5329 </li></ul><br>  The <i>xs</i> and <i>ys</i> vectors are created, but not used anywhere.  It turns out that every time you use the <i>drawAngularDistanceGraph</i> method, <i>you</i> unnecessarily create and delete an empty container.  I think this ad remains in the code after refactoring.  This, of course, is not an error, but it is worth removing the extra code. <br><br><h2>  Strange type conversions </h2><br>  Another example after a little formatting looks like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SatellitesDialog::updateSatelliteData() { .... <span class="hljs-comment"><span class="hljs-comment">// set default buttonColor = QColor(0.4, 0.4, 0.4); .... }</span></span></code> </pre> <br>  In order to understand what the error is, you will have to look at the prototypes of the constructors <a href="http://doc.qt.io/archives/qt-4.8/qcolor.html">of the Qcolor class</a> : <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7d/84e/798/f7d84e79849bca96f7a27016aec0e9d3.png"></div><br>  <b>PVS-Studio warnings:</b> <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v674/">V674</a> The literal '0.4' of 'double' type is being implicitly casting the 'int' type while calling the 'QColor' function.  Inspect the first argument.  SatellitesDialog.cpp 413 </li><li>  <a href="https://www.viva64.com/ru/w/v674/">V674</a> The literal '0.4' of 'double' type is being implicitly casting the 'int' type while calling the 'QColor' function.  Inspect the second argument.  SatellitesDialog.cpp 413 </li><li>  <a href="https://www.viva64.com/ru/w/v674/">V674</a> The literal '0.4' of 'double' type is being implicitly casting the 'int' type while calling the 'QColor' function.  Inspect the third argument.  SatellitesDialog.cpp 413 </li></ul><br>  The <i>Qcolor</i> class <i>does</i> not have constructors that take a <i>double</i> type, so the arguments in the example will be implicitly converted to an <i>int</i> .  This causes the <i>buttonColor</i> object's <i>r</i> , <i>g</i> , <i>b</i> <i>fields</i> to be <i>0</i> . <br><br>  If the programmer intended to create an object from <i>double</i> values, he should use another constructor. <br><br>  For example, you could use a constructor that accepts <i>Qrgb</i> by writing: <br><br><pre> <code class="cpp hljs">buttonColor = QColor(QColor::fromRgbF(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  It could have been done differently.  In Qt, real values ‚Äã‚Äãin the range [0.0, 1.0] or integer in the range [0, 255] are used to designate RGB colors. <br><br>  Therefore, the programmer could translate the values ‚Äã‚Äãfrom real to integer by writing this: <br><br><pre> <code class="cpp hljs">buttonColor = QColor((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  or simply <br><br><pre> <code class="cpp hljs">buttonColor = QColor(<span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>);</code> </pre> <br>  Are you bored?  Do not worry: ahead of us are waiting for more interesting mistakes. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/aa0/297/f18aa02975f89e9e6cc7c661706fc608.png"></div><br>  <font color="#999999"><i>"Unicorn in space."</i></font>  <font color="#999999"><i>View from Stellarium.</i></font> <br><br><h2>  Other errors </h2><br>  Finally, I left you a few more tasty things :) Let's get down to one of them. <br><br><pre> <code class="cpp hljs">HipsTile* HipsSurvey::getTile(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> order, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pix) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (order == orderMin &amp;&amp; !allsky.isNull()) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * order)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (pix % nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = (pix / nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> s = allsky.width() / nbw; QImage image = allsky.copy(x, y, s, s); .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v634/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v634/">V634</a> The operation of the '*' operation is higher than that of the '&lt;&lt;' operation.  It's possible that parentheses should not be used in the expression.  StelHips.cpp 271 <br><br>  Well, could you find a mistake?  Consider the expression <i>(12 * 1 &lt;&lt; (2 * order))</i> .  The analyzer reminds that the operation ' <i>*</i> ' has a higher priority than the operation of the bit shift ' <i>&lt;&lt;</i> '.  It is easy to understand that multiplying <i>12</i> by <i>1 is</i> meaningless, and brackets around <i>2 * order are</i> not needed. <br><br><pre> <code class="cpp hljs"> ,    : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span> * order));     &lt;i&gt;<span class="hljs-number"><span class="hljs-number">12</span></span> &lt;/i&gt;     .</code> </pre> <br>  Note.  Additionally, I want to note that if the value of the right operand ' <i>&lt;&lt;</i> ' is greater than or equal to the number of bits of the left operand, the result is undefined.  Since numeric literals have <i>int</i> type by default, which occupies <i>32</i> bits, the value of the <i>order</i> parameter should not exceed <i>15</i> .  Otherwise, the evaluation of the expression may result in undefined behavior. <br><br>  We continue.  The method given below is quite confusing, but I am sure that the sophisticated reader will cope with the detection of an error :) <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdBoth) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdNegative) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdPositive) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v779/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v779/">V779</a> Unreachable code detected.  It is possible that an error is present.  qcustomplot.cpp 19512. <br><br>  The point is that all <i>if ... else</i> branches have a <i>return</i> .  Therefore, the control flow never reaches the last two lines. <br><br>  By and large, this example will run normally and work correctly.  But the presence of an unreachable code is itself a signal.  In this case, it points to the wrong structure of the method, which greatly complicates the readability and clarity of the code. <br><br>  This code snippet should be refactored to produce a tidier function.  For example: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (inSignDomain) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdBoth: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdNegative: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdPositive: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  The last error in our review will be the one I liked the most.  The problem location code is short and simple: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Noticed something suspicious?  Not everyone can :) <br><br>  <b>PVS-Studio warning:</b> <a href="https://www.viva64.com/ru/w/v603/">V603</a> The object was not used.  If you wish to call the constructor, 'this-&gt; Plane :: Plane (....)' should be used.  Plane.cpp 29 <br><br>  The programmer expected that some of the object's fields would be initialized inside the nested constructor, but it turned out like this: when the <i>Plane</i> constructor is called <i>(Vec3f &amp; v1, Vec3f &amp; v2, Vec3f &amp; v3)</i> , an unnamed temporary object is created inside it, which is immediately deleted.  As a result, the part after the object remains uninitialized. <br><br>  To make the code work properly, you should use a convenient and secure C ++ 11 feature - a delegating constructor: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f&amp; v1, Vec3f&amp; v2, Vec3f&amp; v3) : Plane(v1, v2, v3, SPolygon::CCW) { distance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; sDistance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; }</code> </pre> <br>  But if you use the compiler for older versions of the language, you can write this: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Plane::Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Or so: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  I note that the last two methods are <a href="https://www.viva64.com/ru/w/v603/">very dangerous</a> .  Therefore, you should be very careful and well understand how such methods work. <br><br><h2>  Conclusion </h2><br>  What conclusions can be made about the quality of the Stellarium code?  To be honest, there were not very many mistakes.  Also in the whole project I did not find a single error in which the code is tied to indefinite behavior.  For the opensource project, the quality of the code was high, for which I take off my hat to the developers.  You guys are great!  It was pleasant and interesting for me to review your project. <br><br>  What about the planetarium itself - I use it often enough.  Unfortunately, living in the city, I very rarely enjoy the clear night sky, and Stellarium allows me to be anywhere in the world without getting up from the couch.  It is really comfortable! <br><br>  I especially like the ‚ÄúConstellation art‚Äù mode.  The form of huge figures covering the whole sky in a strange dance is breathtaking. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/613/3d5/107/6133d51079ac983aa11a017acd1945ee.png"></div><br>  <font color="#999999"><i>"Strange dance."</i></font>  <font color="#999999"><i>View from Stellarium.</i></font> <br><br>  It is natural for us, earthlings, to err, and there is nothing shameful in the fact that these errors leak into the code.  For this, code analysis tools such as PVS-Studio are being developed.  If you are one of the earthlings - <strike>like to</strike> offer to <a href="https://www.viva64.com/ru/pvs-studio-download/">download and try it yourself</a> . <br><br>  I hope that you were interested in reading my article, and you learned something new and useful for yourself.  And I wish the developers to fix the errors found as soon as possible. <br><br>  Subscribe to our channels and follow the news from the world of programming! <br><br><ul><li>  <a href="https://vk.com/pvsstudio_rus">VK</a> : <a href="https://vk.com/pvsstudio_rus">@pvsstudio_rus</a> </li><li>  Telegram: <a href="https://t.me/pvsstudio_rus">@pvsstudio_rus</a> </li><li>  Instagram: <a href="https://www.instagram.com/pvsstudio_rus/">@pvsstudio_rus</a> </li><li>  Twitter: <a href="https://twitter.com/pvsstudio_rus">@pvsstudio_rus</a> </li><li>  YouTube: <a href="https://www.youtube.com/c/PVSStudioTool">@PVSStudioTool</a> </li></ul><br><p> <a href="https://www.viva64.com/en/b/0597/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: George Gribkov.  <a href="https://www.viva64.com/en/b/0597/">Into Space Again: How the Unicorn Visited Stellarium</a> </div><p>Source: <a href="https://habr.com/ru/post/432954/">https://habr.com/ru/post/432954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432940/index.html">50 shades of token</a></li>
<li><a href="../432942/index.html">Patterns and antipatterns Corutin in Kotlin</a></li>
<li><a href="../432944/index.html">Forced PostgreSQL Query Optimization</a></li>
<li><a href="../432946/index.html">Unity - 2D game development pitfalls</a></li>
<li><a href="../432948/index.html">Smart clouds, smart enterprises: how AI transforms the cloud computing industry</a></li>
<li><a href="../432956/index.html">Id Monsters: How Doom Was Created</a></li>
<li><a href="../432958/index.html">The new quantum paradox clarifies in which case our ideas about reality are wrong</a></li>
<li><a href="../432960/index.html">Why consumers are not afraid of identity theft</a></li>
<li><a href="../432964/index.html">On power, either good or nothing: a new legislative initiative in the Russian Federation</a></li>
<li><a href="../432966/index.html">Encryption downloader for STM32</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>