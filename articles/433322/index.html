<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JSON API - we work according to the specification</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, web development has split. Now we are not all full-stack programmers - we are front-end and back-end vendors. And the most difficult in this...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JSON API - we work according to the specification</h1><div class="post__text post__text-html js-mediator-article">  Recently, web development has split.  Now we are not all full-stack programmers - we are front-end and back-end vendors.  And the most difficult in this, as elsewhere, is the problem of interaction and integration. <br><br>  Frontend with backend interact through API.  And on what kind of API it is, how good or bad the backend and the frontend have agreed among themselves, the whole result of the development depends.  If we all begin to discuss how to make a padzhinatsiyu, and spend on reworking it all day, then we can not get to the business objectives. <br><br>  In order not to slip and not build holivars about the names of variables, we need a good specification.  Let's talk about what it should be, so that all life is easier.  At the same time we will become experts in cycling sheds. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/o4/me/1u/o4me1uwmahvlwsnvqxyf_rzwa1i.jpeg"><br><a name="habracut"></a><br>  Let's start from afar - with a problem that we solve. <br><br>  Long ago, in 1959, <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D1%2580%25D0%25BA%25D0%25B8%25D0%25BD%25D1%2581%25D0%25BE%25D0%25BD,_%25D0%25A1%25D0%25B8%25D1%2580%25D0%25B8%25D0%25BB_%25D0%259D%25D0%25BE%25D1%2580%25D1%2582%25D0%25BA%25D0%25BE%25D1%2582">Cyril Parkinson</a> (not to be confused with the disease, this is a writer and an economic figure) came up with several interesting laws.  For example, that costs grow with income, etc.  One of them is called the Law of Triviality: <br><br><blockquote>  The time spent discussing the item is inversely proportional to the amount in question. <br></blockquote><br>  Parkinson was an economist, so he explained his laws in economic terms, something like this.  If you come to the board of directors and say that you need $ 10 million to build a nuclear power plant, this issue is likely to be discussed much less than allocating 100 pounds for a bicycle shed for employees.  Because everyone knows how to build a bicycle shed, everyone has an opinion, everyone feels important and wants to participate, and the nuclear power plant is something abstract and distant, nobody has seen 10 million either - there are fewer questions. <br><br>  In 1999, the law of Parkinson's triviality appeared in programming, which was then actively developed.  In programming, this law was met mainly in English-language literature and sounded like a metaphor.  It was called <strong>The Bikeshed effect</strong> (the effect of a bicycle shed), but the essence is the same - we are ready to discuss the bicycle shed and want to discuss it much longer than the construction of a power station. <br><br>  Danish developer Poul-Henning Kamp, who participated in the creation of FreeBSD, introduced this term to programming.  During the design process, the team discussed for a very long time how the sleep function should work.  This is a quote from the <a href="http://phk.freebsd.dk/sagas/bikeshed.html">letter</a> Poul-Henning Kamp (the development was then conducted in e-mail correspondence): <br><br><blockquote>  It would be a good idea to make it to go to sleep (1). * We have around here. <br></blockquote><br>  In this letter, he says that there are a lot of much more important unsolved problems: ‚ÄúLet's not do the bicycle shed, we'll do something about it and go ahead!‚Äù <br><br>  So Poul-Henning Kamp in 1999 introduced the term bikeshed effect into English-language literature, which can be rephrased as: <br><br><blockquote>  The amount of noise generated by a change in a code is inversely proportional to the complexity of the change. <br></blockquote><br>  The simpler we add or change, the more opinions we have to listen to.  I think many have met with this.  If we solve a simple question, for example, how to name variables, - for a machine, it makes no difference - this question will cause a huge number of holivars.  And serious, really important for business problems are not discussed and go as a background. <br><br>  What do you think is more important: how do we communicate between the backend and the frontend, or the business tasks that we do?  Everyone thinks differently, but any customer, a person who is waiting for you to bring him money, will say: ‚ÄúDo me our business tasks already!‚Äù He absolutely does not care how you will transfer data between the backend and the front-end.  He may not even know what a backend and a frontend are. <br><br>  I would like to summarize the introduction with the statement: The <strong>API is a bicycle shed.</strong> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1cJVwn44iSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em><a href="http://alexey-avdeev.com/jsonapi-work-according-to-specification/">Link</a></em> <em>to the presentation of the report</em> <br><br>  <strong>About Speaker:</strong> Alexey Avdeev ( <a href="https://habr.com/ru/users/avdeev/" class="user_link">Avdeev</a> ) works for Neuron.Digital, a company that deals with neurons and makes a cool frontend for them.  Alexey also pays attention to OpenSource, and advises everyone.  Engaged in the development of a long time - since 2002, he found the ancient Internet, when computers were large, the Internet was small, and the absence of JS did not bother anyone, and everyone made up sites on the tables. <br><br><h2>  How to deal with bike sheds? <br></h2><br>  After the distinguished Cyril Parkinson derived the law of triviality, he was much discussed.  It turns out that the effect of a bike shed here can easily be avoided: <br><br><ol><li>  <strong>Do not listen to advice.</strong>  I think, so an idea for yourself - if you don‚Äôt listen to advice, you can do it all, especially in programming, and especially if you are a novice developer. <br></li><li>  <strong>Do as you wish.</strong>  ‚ÄúI am an artist, I see it so!‚Äù - no bikeshed effect, everything is done, but very strange things appear at the exit.  This is often found in freelancing.  Surely you are faced with tasks that had to be completed by another developer and the implementation of which caused you to be perplexed. <br></li><li>  <strong>Ask yourself is it important?</strong>  If not, you can simply not discuss, but this is a matter of personal consciousness. <br></li><li>  <strong>Use objective criteria.</strong>  About this point, I just will speak in the report.  To avoid the effect of a bicycle shed, you can use criteria that objectively say which is better.  They exist. <br></li><li>  <strong>Do not talk about what you do not want to listen to advice.</strong>  In our company, beginning backend developers are introverts, so it happens that they do something that they don‚Äôt tell others.  As a result, we meet surprises.  This method works, but in programming it is not the best option. <br></li><li>  If you do not care about the problem, you can simply <strong>let go of it or choose any of the proposed options that</strong> have arisen during the holivar process. <br></li></ol><br><h2>  Anti-bikeshedding tool <br></h2><br>  I want to tell you about the <strong>objective tools</strong> to solve the problem of a bicycle shed.  To demonstrate what an anti-bikeshedding tool is, I‚Äôll tell you a little story. <br><br>  Imagine that we have a novice backend developer.  He recently came to the company, and he was assigned to design a small service, for example, a blog, for which he needed to write a REST protocol. <br><br><img src="https://habrastorage.org/webt/zn/9m/uk/zn9muk80uvsd_yuragws16ms70c.png">  <em>Roy Fielding, author of REST</em> <br><br>  In the photo, Roy Fielding, who in 2000 defended his thesis ‚ÄúArchitectural styles and design of network software architectures‚Äù and thus introduced the term REST.  Moreover, he invented HTTP and, in fact, is one of the founders of the Internet. <br><br>  REST is a set of architectural principles that say how to design REST protocols, REST API, RESTful services.  These are rather abstract and complex architectural principles.  I am sure that none of you have ever seen an API made entirely according to all RESTful principles. <br><br><h2>  REST architecture requirements <br></h2><br>  I will cite several requirements for <a href="https://ru.wikipedia.org/wiki/REST">REST</a> protocols, to which I will later refer and rely.  There are quite a few of them; in Wikipedia you can read about it in more detail. <br><br>  1. <strong>Model client-server.</strong> <br>  The most important principle of REST, that is our interaction with the backend.  By REST, the backend is a server, the front-end is a client, and we communicate in a client-server format.  Mobile devices are also a client.  Developers for hours, refrigerators, and other services are also developing the client side.  The RESTful API is the server that the client is accessing. <br><br>  2. <strong>Lack of condition.</strong> <br>  The server must be missing a state, that is, everything that is needed for a response comes in the request.  When a session is stored on the server, and different answers come up depending on this session, this is a violation of the REST principle. <br><br>  3. <strong>Uniform interface.</strong> <br>  This is one of the key basic principles on which the REST API should be built.  It includes the following: <br><br><ul><li>  Resource identification is how we should build URLs.  By REST, we are accessing the server for some kind of resource. </li><li>  Manipulate resources through presentation.  The server returns us a view that is different from what is in the database.  It doesn't matter if you store information in MySQL or PostgreSQL - we have a presentation. </li><li>  ‚ÄúSelf-describing‚Äù messages ‚Äî that is, the message contains an id, links where you can get this message again ‚Äî everything you need to work with this resource again. </li><li>  Hypermedia is a link to the following actions with a resource.  It seems to me that no REST API does it, but it is described by Roy Fielding. </li></ul><br>  There are 3 more principles that I do not cite, because they are not important for my story. <br><br><h2>  RESTful blog <br></h2><br>  Let's return to the novice backend developer who was asked to make a service for a RESTful blog.  Below is an example of a prototype. <br><br><img src="https://habrastorage.org/webt/op/wi/6l/opwi6l_tbihj0tvef8tu4feyoo4.png"><br><br>  This is a site where there are articles, you can comment on them, the article and comments have an author - a standard story.  Our novice backend developer will do the RESTful API for this blog. <br><br>  With all the blog data we work on the principle of <a href="https://ru.wikipedia.org/wiki/CRUD">RUD</a> . <br><img src="https://habrastorage.org/webt/4i/rk/hm/4irkhm7dcicexgmqomprfdraisu.png"><br>  It should be possible to create any resource, read, update and delete.  Let's try to ask our backend developer to build a RESTful AP I based on the CRUD principle.  That is, write methods to create articles, get a list of articles or a separate article, update and delete. <br><br>  Let's see how he could do it. <br><img src="https://habrastorage.org/webt/m2/i2/ua/m2i2uadak8sdzbge_pvqlnpu55s.png"><br><br>  <strong>Here everything is wrong regarding all REST principles</strong> .  The most interesting thing is that it works.  I actually got APIs that looked something like this.  For the customer, this is a bicycle shed, for developers, an excuse to talk and argue, and for a novice developer, this is just a huge, brave new world, where he stumbles, falls, breaks his head every time.  He has to redo time after time. <br><img src="https://habrastorage.org/webt/k1/nj/lm/k1njlm8egbrcguim8am6juym76s.png"><br><br>  This is a REST option.  According to the principles of resource identification, we work with resources ‚Äî with articles (articles) and use the HTTP methods proposed by Roy Fielding.  He could not use his previous work in his next work. <br><br>  To update articles, many use the PUT method; it has a slightly different semantics.  The PATCH method updates the fields that were transferred, and PUT simply replaces one article with another.  In semantics, PATCH is merge, and PUT is replace. <br><br>  Our novice backend developer dropped, he was picked up and said: ‚ÄúEverything is in order, do this,‚Äù and he honestly redid it.  But further it is waited by a huge big way through thorns <br><br>  <strong>Why so right?</strong> <br><br><ul><li>  because Roy Fielding said so; </li><li>  because it is REST; </li><li>  because these are the architectural principles on which our profession is built now. </li></ul><br>  However, this ‚Äúbicycle shed‚Äù will work the previous way.  Computers communicated before REST, and everything worked.  But now the industry has a standard. <br><br><h2>  Remove the article <br></h2><br>  Consider an example of deleting an article.  Suppose there is a normal, resource method DELETE / articles, which deletes an article by id.  HTTP contains headers.  The Accept header accepts the type of data that the client wants to receive in response.  Our junior wrote a server that returns 200 OK, Content-Type: application / json, and passes an empty body: <br><br> <code>01. <b><font color="#c6e90e">DELETE /articles/</font></b> 1 /1.1 <br> 02. Accept: <b><font color="#c6e90e">application/json</font></b></code> <br> <br> <code>01. HTTP/1.1 200 OK <br> 02. Content-Type: <b><font color="#c6e90e">application/json</font></b> <br> 03. null <br></code> <br>  There is a very <strong>common mistake - empty body</strong> .  It seems to be all logical - the article is deleted, 200 OK, the application / json header is present, but the client is likely to fall.  He throws an error, because the empty body is not valid.  If you have ever tried to parse an empty string, you have come across the fact that any json parser stumbles and falls on this. <br><br>  How can I fix this situation?  Most probably the best option is to pass on json.  If we said: ‚ÄúAccept, give us json‚Äù, the server says: ‚ÄúContent-Type, I give you json‚Äù, give json.  An empty object, an empty array - put something there - it will be a solution, and it will work. <br><br>  There is still a solution.  In addition to 200 OK, there is a response code 204 - no content.  With it you can not transfer the body.  Not everyone knows about this. <br><br>  So I brought to the media types. <br><br><h3>  MIME types <br></h3><br>  Media types are like a file extension, only on the web.  When we transfer data, we must inform or request which type we want to receive in response. <br><br><ul><li>  By default, this text / plain is just text. </li><li>  If nothing is specified, then the browser is likely to keep in mind application / octet-stream ‚Äî just a bit stream. </li></ul><br>  You can simply specify a specific type: <br><br><ul><li>  application / pdf; </li><li>  image / png; </li><li>  application / json; </li><li>  application / xml; </li><li>  application / vnd.ms-excel. </li></ul><br>  Content-Type and Accept headers are and are important. <br><br><blockquote>  The API and client must pass the Content-Type and Accept headers. <br></blockquote><br>  If your API is built on JSON, always pass Accept: application / json and Content-Type application / json. <br><br>  An example of file types. <br><img src="https://habrastorage.org/webt/jd/v_/aa/jdv_aarpo9qnevtro5ddqbgw5ic.png"><br><br>  Media types are similar to these file types, only on the Internet. <br><br><h3>  Response codes <br></h3><br>  The next example of the adventures of our junior developer is the response codes. <br><br><img src="https://habrastorage.org/webt/o4/tc/ci/o4tcci6wnmokubjjdecsy5vwclm.png"><br><br>  The funniest answer ticker is 200 OK.  Everybody loves him - it means that everything went right.  I even had a case - I received <strong>errors 200 OK</strong> .  In fact, something fell on the server, in response, an HTML page comes up in response, with an error in the HTML.  I requested application json with code 200 OK, and thought how to work with it?  You go by the response, look for the word "error", you think that this is a mistake. <br><br>  This works, however in HTTP there are many other codes that can be used, and according to REST, Roy Fielding recommends using them.  For example, the creation of an entity (article) can be answered: <br><br><ul><li>  <strong>201 Created</strong> - successful code.  The article is created, in response, you must return the created article. </li><li>  <strong>202 Accepted</strong> means that the request has been accepted, but its result will be later.  These are long-running operations.  On Accepted, you can not return any body.  That is, if you do not give the Content-Type in the answer, then the body also may not be.  Or Content-Type text / plane - everything, no questions.  An empty string is valid text / plane. </li><li>  <strong>204 No Content</strong> - the body may be completely absent. </li><li>  <strong>403 Forbidden</strong> - you can not create this article. </li><li>  <strong>404 Not Found</strong> - you climbed somewhere wrong, there is no such way, for example. </li><li>  <strong>409 Conflict</strong> - an extreme case that few people use.  It is needed if you are generating a id on the client and not on the backend, but at this time someone has already managed to create this article.  Conflict is the right answer in this case. </li></ul><br><h3>  Create entity <br></h3><br>  The following example: we create an entity, speak Content-Type: application / json, and pass this application / json.  This is done by the client - our front end.  Suppose we create this very article: <br><br> <code>01. POST /articles /1.1 <br> 02. Content-Type: application/json <br> 03. { "id": 1, "title": " JSON API"}</code> <br> <br>  In response, the code may come: <br><br><ul><li>  422 Unprocessable Entity - unhandled entity.  Everything seems to be great - semantics, there is code; </li><li>  403 Forbidden; </li><li>  500 Internal Server Error. </li></ul><br>  But it is absolutely incomprehensible what exactly happened: which entity is unworkable, why can't I go there, and what happened to the server in the end? <br><br><h3>  Return errors <br></h3><br>  Be sure to (and this junior do not know) in return, return errors.  This is semantic and correct.  By the way, Fielding did not write about this, that is, it was invented later and built on top of REST. <br><br>  The backend may return an array with errors in response, there may be several of them. <br><br> <code>01. HTTP/1.1 422 Unprocessable Entity <br> 02. Content-Type: application/json <br> 03. <br> 04. { "errors": [{ <br> 05.   "status": "422", <br> 06. <b><font color="#c6e90e">"title": "Title already exist",</font></b> <br> 07. }]}</code> <br> <br>  Each error can have its own status and title.  This is great, but it is already at the agreement level over REST.  This can be our anti-bikeshedding tool to stop arguing and make a good, right API right away. <br><br><h2>  Add padzhinatsiyu <br></h2><br>  The next example: designers come to our beginning backend developer and say: ‚ÄúWe have a lot of articles, we need a padjina.  We drew this one. ‚Äù <br><img src="https://habrastorage.org/webt/fn/6l/9t/fn6l9tjzotvgzehwpbezkd0vcf4.png"><br><br>  Consider it in more detail.  First of all, 336 pages catch your eye.  When I saw this, I thought how to get this figure at all.  Where to get 336, because the list of articles comes to me at the request of the list of articles.  For example, there are 10 thousand of them, that is, I need to download all the articles, divide by the number of pages and find out this number.  For a very long time I will load these articles, I need a way to get the number of records quickly.  But if our API gives the list, then where is the number of records generally shoved, because in response comes an array of articles.  It turns out that since the number of entries is not put anywhere, then it should be added to each article so that each article says: ‚ÄúAnd there are so many of us all!‚Äù. <br><br>  However, there is an agreement on top of the REST API that solves this problem. <br><br><h3>  List request <br></h3><br>  In order for the API to be extensible, you can immediately use GET-parameters for padzhinatsii: the size of the current page and its number, so that exactly that piece of the page we requested is returned.  It's comfortable.  In response, you can not immediately give an array, but add additional nesting.  For example, the data key will contain an array, the data we requested, and the meta key, which was not there before, will contain a total number. <br><br> <code>01. GET /articles? <b><font color="#c6e90e">page[size]=30&amp;page[number]=2</font></b> <br> 02. Content-Type: application/json <br></code> <br> <code>01. HTTP/1.1 200 OK <br> 02. { <br> 03.   "data": [{ "id": 1, "title": "JSONAPI"}, ...], <br> 04.   "meta": { <b><font color="#c6e90e">"count": 10080</font></b> } <br> 05. } <br></code> <br>  Thus, the API can return additional information.  In addition to count there may be some other information - it is expandable.  Now, if the junior didn‚Äôt do it right away, but only after he was asked to make a padjinija, then he <strong>made an incompatible change back</strong> , broke the API, and all clients have to be redone - this is usually very painful. <br><br>  Padzhinatsiya is different.  I offer several lifehacks that you can use. <br><br><h4>  [offset] ... [limit] <br></h4><br> <code>01. GET /articles? <b><font color="#c6e90e">page[offset]=30&amp;page[limit]=30</font></b> <br> 02. Content-Type: application/json <br></code> <br> <code>01. HTTP/1.1 200 OK <br> 02. { <br> 03.   "data": [{ "id": 1, "title": "JSONAPI"}, ...], <br> 04.   "meta": { "count": 10080 } <br> 05. } <br></code> <br>  For those who work with databases, perhaps already on the subcortex [offset] ... [limit].  Using it instead of page [size] ... page [number] will be easier.  This is a slightly different approach. <br><br><h4>  Cursor Padjination <br></h4><br> <code>01. GET /articles? <b><font color="#c6e90e">page[published_at]=1538332156</font></b> <br> 02. Content-Type: application/json</code> <br> <br> <code>01. HTTP/1.1 200 OK <br> 02. { <br> 03.    "data": [{ "id": 1, "title": "JSONAPI"}, ...], <br> 04.    "meta": { "count": 10080 } <br> 05. }</code> <br> <br>  Cursor Padjination uses a pointer to the entity with which you want to start loading records.  For example, it is very convenient when you use padzhinatsiya or podgruzku in lists that often change.  Let's say in our blog constantly write new articles.  The third page now is not the same third page, which will be in a minute, but going to the fourth page, we will get part of the records from the third page on it, because the entire list will move. <br><br>  This problem is solved by cursor padzhinatsiya.  We say: ‚ÄúLoad the articles that go after the article published at this time‚Äù - there can be no shift technologically, and this is cool. <br><br><h2>  Problem n +1 <br></h2><br>  The next problem that our junior developer will definitely encounter is the N + 1 problem (backenders will understand).  Suppose you need to display a list of 10 articles.  We upload a list of articles, each article has an author, and for each article you need to download the author.  We send: <br><br><ul><li>  1 request for a list of articles; </li><li>  10 requests to get the authors of each article. </li></ul><br>  Total: 11 requests to display a small list. <br><br><h3>  Add links <br></h3><br>  On the backend, this problem is solved in all ORMs ‚Äî you just have to remember to append this connection.  These connections can be used on the frontend.  This is done as follows: <br><br> <code>01. GET /articles? <b><font color="#c6e90e">include =author</font></b> <br> 02. Content-Type: application/json <br></code> <br>  You can use a special GET parameter, call it include (as on the backend), saying which links we need to load along with the articles.  Suppose we download articles, and we want together with articles to immediately get more of their author.  The answer is: <br><br> <code>01. /1.1 200  <br> 02. { "data": [{ <br> 03.  { attributes: { "id": 1, "title": "JSON API" }, <br> 04.  { relationships: { <br> 05. <b><font color="#c6e90e">"author": { "id": 1, "name": "Avdeev" } }</font></b> <br> 06.  }, ... <br> 07. }]}</code> <br> <br>  Data has transferred its own article attributes and added the relationships key.  In this key, we put all the links.  Thus, in one request, we received all the data that we had received before with 11 requests.  This is a cool life hack, which well solves the problem with N + 1 on the frontend. <br><br><h2>  Data duplication problem <br></h2><br>  Suppose you need to display 10 articles with the author, all the articles have one author, but the object with the author is very large (for example, a very long last name that occupies a megabyte).  One author is included in the answer 10 times, and 10 inclusions of the same author in response will take 10 MB. <br><br>  Since all objects are the same, the problem that one author is included 10 times (10 MB) is solved with the help of normalization, which is used in databases.  Normalization can also be used at the front end in working with the API - this is very cool. <br><br> <code>01. /1.1 200  <br> 02. { "data": [{ <br> 03. "id": "1‚Ä≥, <b><font color="#c6e90e">"type": "article",</font></b> <br> 04. "attributes": { "title": "JSON API" }, <br> 05. "relationships": { ... } <br> 06.  "author": { "id": 1, <b><font color="#c6e90e">"type": "people"</font></b> } } <br> 07. }, ... ] <br> 08. }</code> <br> <br>  We mark all entities with some type (this is the type of representation, the type of resource).  Roy Fielding introduced the concept of a resource, that is, they requested articles - they received an ‚Äúarticle‚Äù.  In relationships, we place a link to the type of people, that is, we still have the resource people somewhere.  And the resource itself, we take in a separate key included, which lies on the same level with data. <br><br> <code>01. /1.1 200  <br> 02. { <br> 03. "data": [ ... ], <br> 04. <b><font color="#c6e90e">"included":</font></b> [{ <br> 05.  "id": 1, "type": "people", <br> 06.  "attributes": { "name": "Avdeev" } <br> 07. }] <br> 08. }</code> <br> <br>  Thus, all related entities in a single copy fall into the special key included.  We store only links, and the entities themselves are stored in included. <br><br>  Request size has decreased.  This is a life hack, about which the beginner backender does not know.  He will know this later when he needs to break the API. <br><br><h3>  Not all resource fields needed <br></h3><br>  The following life hack can be applied when not all resource fields are needed.  This is done with the help of a special GET parameter, in which the attributes that need to be returned are listed separated by commas.  For example, the article is large, and the content field may have megabytes, but we only need to display a list of titles - we do not need content in the answer. <br><br> <code>GET /articles <b><font color="#c6e90e">?fields[article]=title /1.1</font></b></code> <br> <br> <code>01. /1.1 200 OK <br> 02. { "data": [{ <br> 03.  "id": "1‚Ä≥, "type": "article", <br> 04.  "attributes": { <b><font color="#c6e90e">"title": " JSON API"</font></b> }, <br> 05.  }, ... ] <br> 06. }</code> <br> <br>  If you need, for example, also the date of publication, you can write ‚Äúpublished date‚Äù through a comma.  In response, two fields will come to attributes.  This is an agreement that can be used as an anti-bikeshedding tool. <br><br><h3>  Search by articles <br></h3><br>  Often we need searches and filters.  There are agreements for this - special GET-filters filters: <br><br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?filters[search]=api</font></b> HTTP/1.1</code> - search; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?fiIters[from_date]=1538332156</font></b> HTTP/1.1</code> - download articles from a specific date; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?filters[is_published]=true</font></b> HTTP/1.1</code> - download articles that are only published; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?fiIters[author]=1</font></b> HTTP/1.1</code> - download articles with the first author. <br><br><h3>  Sort articles <br></h3><br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=title</font></b> /1.1</code> - by title; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=published_at</font></b> HTTP/1.1</code> - by date of publication; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=-published_at</font></b> HTTP/1.1</code> - by the date of publication in the opposite direction; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=author,-publisbed_at</font></b> HTTP/1.1</code> - first by author, then by date of publication in the opposite direction, if articles are from one author. <br><br><h2>  Need to change URLs <br></h2><br>  Solution: hypermedia, which I have already mentioned, can be done as follows.  If we want the object (resource) to be self-describing, the client could understand by hypermedia what can be done with it, and the server could develop independently of the client, then you can add links to the list of articles, to the article itself using special keys links : <br><br> <code><code>01. GET /articles /1.1 <br> 02. { <br> 03. "data": [{ <br> 04.  ... <br> 05. <b><font color="#c6e90e">"links": { "self": "http://localhost/articles/1"</font></b></code> }, <br> 06.  "relationships": { ... } <br> 07. }], <br> 08. <b><font color="#c6e90e">"links": { "self": " <code>http://localhost/articles</code> " }</font></b> <br> 09. } <br></code> <br>  Or related, if we want to tell the client how to upload a comment on this article: <br><br> <code><code>01. ... <br> 02. "relationships": { <br> 03. "comments": { <br> 04.  "links": { <br> 05. <b><font color="#c6e90e">"self": "http://localhost/articles/l/relationships/comments</font></b></code> ", <br> 06. <b><font color="#c6e90e">"related": " <code>http://localhost/articles/l/comments</code> "</font></b> <br> 07.  } <br> 08. } <br> 09. }</code> <br>  The client sees that there is a link, follows it, loads a comment.  If there is no link, then there are no comments.  This is convenient, but so few do.  Fielding came up with the principles of REST, but not all of them entered our industry.  We mainly use two or three. <br><br>  In 2013, all life hacking, which I told you about, Steve Klabnik combined into the JSON API specification and registered as a <a href="http://www.iana.org/assignments/media-types/application/vnd.api%2Bjson">new media type over JSON</a> .  So our junior backend developer, gradually evolving, came to the JSON API. <br><br><h2>  JSON API <br></h2><br>  On the site <a href="http://jsonapi.org/implementations/">http://jsonapi.org/implementations/</a> everything is described in detail: there is even a list of 170 different implementations of specifications for 32 programming languages ‚Äã‚Äã- and these are just added to the catalog.  Already written libraries, parsers, serializers, etc. <br><br>  Since this specification is open source, everything is invested in it.  I, among other things, wrote something myself.  I am sure there are many such people.  You can join this project yourself. <br><br><h4>  Pros JSON API <br></h4><br>  JSON API specification solves a number of problems - a <strong>common convention for everyone</strong> .  Once there is a general agreement, we <strong>do not argue within the team</strong> - the bike shed is documented.  We have an agreement on what materials to make a bicycle shed and how to paint it. <br><br>  Now, when a developer does something wrong and I see it, I do not start the discussion, but I say: ‚ÄúNot according to the JSON API!‚Äù And show it in place in the specification.  They hate me in the company, but they gradually get used to it, and everyone started to like the JSON API.  New services by default we do for this specification.  We have a date key, we are ready to add meta, include keys.  For filters, there is a reserved GET parameter filters.  We do not argue how to name the filter - we use this specification.  It describes how to make a URL. <br><br>  Since we do not argue, but we do business tasks, the <strong>development productivity is higher</strong> .  We have described the specifications, the developer read the backend, made the API, we screwed it up - the customer is happy. <br><br>  <strong>Popular problems have already been solved</strong> , for example, with padzhinatsii.  There are many tips in the specification. <br><br>  Since this is JSON (thanks to Douglas Crockford for this format), it is laconic XML, it is quite <strong>easy to read and understand</strong> . <br><br>  The fact that this <strong>Open Source</strong> can be a plus and a minus, but I love Open Source. <br><br><h4>  Cons JSON API <br></h4><br>  The object has grown (date, attributes, included, etc.) - the <strong>frontend needs to parse answers:</strong> be able to iterate over arrays, walk around the object, and know how reduce works.  Not all novice developers know these complex things.  There are serializers / deserializers libraries, you can use them.  In general, this is just working with data, but the objects are large. <br><br>  And the <strong>back</strong> pain begins: <br><br><ul><li>  Control nesting - include can be reached very far; </li><li>  The complexity of queries to the database - they are sometimes built automatically, and are very heavy; </li><li>  Security - you can get into the jungle, especially if you connect some kind of library; </li><li>  The specification is hard to read.  She is in English, and this scared away some, but gradually everyone got used to it; </li><li>  Not all libraries implement the specification well - this is an Open Source problem. </li></ul><br><h4>  JSON API Pitfalls <br></h4><br>  A little hardcore. <br><br>  <strong>The number of relationships in the issue is not limited.</strong>  If we do include, we request articles, adding comments to them, then in response we will receive all the comments of this article.  There are 10,000 comments - get all 10,000 comments: <br><br> <code>GET /articles/1?include=comments /1.1</code> <br> <br> <code>01. ... <br> 02. "relationships": { <br> 03. "comments": { <br> 04.  "data": <b><font color="#c6e90e">[0 ... ‚àû]</font></b> <br> 05. } <br> 06. }</code> <br> <br>  Thus, in response to our request, 5 MB was actually received: ‚ÄúIn the specification this is written - it is necessary to correctly reformulate the request: <br><br> <code>GET /comments? <b><font color="#c6e90e">filters[article]=1&amp;</font></b> page[size]=30 HTTP/1.1</code> <br> <br> <code>01. { <br> 02. "data": <b><font color="#c6e90e">[0 ... 29]</font></b> <br> 03. }</code> <br> <br>  We ask for comments with a filter on the article, say: ‚Äú30 stuff, please‚Äù and we get 30 comments.  This is the ambiguity. <br><br>  <strong>The same things can be ambiguously formulated</strong> : <br><br>  ‚óè <code>GET /articles/1 <b><font color="#c6e90e">?include=comments</font></b> HTTP/1.1</code> - we request an article with comments; <br>  ‚óè <code>GET /articles/1/comments HTTP/1.1</code> - we request comments on the article; <br>  ‚óè <code>GET /comments <b><font color="#c6e90e">?filters[article]=1</font></b> HTTP/1.1</code> - we request comments with a filter on the article. <br><br>  This is the same thing - the same data, which is obtained in different ways, there is some ambiguity.  This reef is not immediately visible. <br><br>  <strong>One-to-many polymorphic links</strong> very quickly emerge into REST. <br><br> <code>01. GET /comments?include=commentable /1.1 <br> 02. <br> 03. ... <br> 04. "relationships": { <br> 05. <b><font color="#c6e90e">"commentable"</font></b> : { <br> 06.  "data": { "type": "article", "id": "1‚Ä≥ } <br> 07. } <br> 08. }</code> <br> <br>  On the back end there is a commentable polymorphic link - it comes out in REST.  So it should happen, but it can be disguised.  In JSON API you will not disguise - it will come out. <br><br>  <strong>Complicated "many to many" links with additional parameters</strong> .  Also all the link tables come out: <br><br> <code>01. GET /users?include <b><font color="#c6e90e">=users_comments</font></b> /1.1 <br> 02. <br> 03. ... <br> 04. "relationships": { <br> 05. "users_comments": { <br> 06.  "data": [{ "type": "users_comments", "id": "1‚Ä≥ }, ...] <br> 07. }, <br> 08. }</code> <br> <br><h2>  Swagger <br></h2><br>  Swagger is an online documentation tool. <br><br>  Suppose our backend developer was asked to write documentation for his API, and he wrote it.  This is easy if the API is simple.  If this is the JSON API, Swagger is not so easy to write. <br><br>  <strong>Example:</strong> Swagger Animal Store.  Each method can be opened, see the response and examples. <br><br><img src="https://habrastorage.org/webt/ul/lj/yk/ulljykpo7bhyw85r9ru69k2nuxe.png"><br><br>  This is an example of a Pet model.  Here is a cool interface, everything is easy to read. <br><br><img src="https://habrastorage.org/webt/i9/rg/ir/i9rgirjcdxgm16ogmtopu6dnjrq.png"><br><br>  And this is how the creation of the JSON API model looks like: <br><br><img src="https://habrastorage.org/webt/ty/14/kn/ty14knt_laxzsr2ozusbo0xkk0c.png"><br><br>  This is not so great.  We need data, in data something with relationships, included contains 5 types of model, etc.  Swagger can be written, Open API is a powerful thing, but difficult. <br><br><h2>  Alternative <br></h2><br>  There is the OData specification, which appeared a bit later - in 2015.  This is ‚ÄúThe best way to REST‚Äù, as the official website assures.  As follows: <br><br>  <code>01. GET http://services.odata.org/v4/TripRW/People HTTP/1.1</code> - GET request; <br>  <code>02. OData-Version: 4.0</code> - special header with version; <br>  <code>03. OData-MaxVersion: 4.0</code> - second special header with version <br><br>  The answer is: <br><br> <code>01. HTTP/1.1 200 OK <br> 02. Content-Type: application/json; odata.metadata=minimal <br> 03. OData-Version: 4.0 <br> 04. { <br> 05. '@odata.context': 'http://services.odata.org/V4/ <br> 06. '@odata.nextLink' : 'http://services.odata.org/V4/ <br> 07. 'value': [{ <br> 08.  '@odata.etag': 1W/108D1D5BD423E51581‚Ä≤, <br> 09.  'UserName': 'russellwhyte', <br> 10.  ... <br></code> <br>  Here is the extended application / json and object. <br><br>  We did not use OData, first, because it is the same as the JSON API, but it is not concise.  There are huge objects there and it seems to me that everything is much worse read.  OData is also released in Open Source, but it‚Äôs more complicated. <br><br><h2>  What's up with GraphQL? <br></h2><br>  Naturally, when we were looking for a new API format, we ran into this hyip. <br><br>  ‚óè <strong>High entry threshold.</strong> <br><br>  From the point of view of the frontend, everything looks cool, but a new developer will not be able to write GraphQL, because you first need to study it.  It's like SQL - you can't immediately write SQL, you need to at least read what it is, go through the tutorials, that is, the input threshold increases. <br><br>  ‚óè <strong>Big bang effect.</strong> <br><br>  If there was no API in the project, and we began to use GraphQL, after a month we realized that it does not suit us, it will be too late.  Have to write crutches.  With JSON API or with OData, you can evolve - the simplest RESTful, progressively improving, turns into a JSON API. <br><br>  ‚óè <strong>Hell on the back end.</strong> <br><br>  GraphQL causes a hell on the backend - straightforwardly one-on-one, like a fully implemented JSON API, because GraphQL has full control over requests, and this is a library, and you will need to solve a bunch of questions: <br><br><ul><li>  nesting control; </li><li>  recursion; </li><li>  frequency limitation; </li><li>  access control. </li></ul><br><h2>  Instead of conclusions <br></h2><br>  I recommend to stop arguing about the bike shed, and take the anti-bikeshedding tool as a specification and just make the API according to a good specification. <br><br>  To find your standard for solving the problem of a bicycle shed, you can look at these links: <br><br>  ‚óè <a href="http://jsonapi.org/">http://jsonapi.org</a> <br>  ‚óè <a href="http://www.odata.org/">http://www.odata.org</a> <br>  ‚óè <a href="https://graphgl.org/">https://graphgl.org</a> <br>  ‚óè <a href="http://xmlrpc.scripting.com/">http://xmlrpc.scripting.com</a> <br>  ‚óè <a href="https://www.jsonrpc.org/">https://www.jsonrpc.org</a> <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contacts Speaker Alexey Avdeev: </font></font></strong> <a href="https://alexey-avdeev.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alexey-avdeev.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and profile on </font></font><a href="https://github.com/avdeev"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colleagues, we </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opened the reception of reports</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on </font></font><a href="https://frontendconf.ru/moscow-rit/2019"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frontend Conf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will be held on May 27 and 28 in the framework of </font></font><a href="https://ritfest.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RIT ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Our program committee began work to assemble a classroom program over the next three months. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do you have a story to tell? </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Want to share your experience with the community? </font><font style="vertical-align: inherit;">Can your report make the life of many front-end fans better? </font><font style="vertical-align: inherit;">Are you an expert in a narrow but important topic and want to share your knowledge? </font></font><a href="https://conf.ontico.ru/lectures/propose/%3Fconference%3Dfc2019-rit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apply now</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Follow the progress of preparation through the </font></font><a href="http://eepurl.com/bb99tn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newsletter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and ideas, who should be invited, what topic to talk about, write directly to the comments on the article.</font></font><br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/433322/">https://habr.com/ru/post/433322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433306/index.html">Visual studio 2019</a></li>
<li><a href="../433308/index.html">Transferring PBX configuration to 3CX PBX Express service</a></li>
<li><a href="../433316/index.html">Design Digest: onboarding, feedback, search for ideas and decision making</a></li>
<li><a href="../433318/index.html">garbage.collect ()</a></li>
<li><a href="../433320/index.html">Grid Layout as the basis of modern layouts</a></li>
<li><a href="../433324/index.html">Build a Dream Bundle with Webpack</a></li>
<li><a href="../433330/index.html">Solving Japanese Crosswords with SAT Solver</a></li>
<li><a href="../433332/index.html">Python support in Azure Functions</a></li>
<li><a href="../433334/index.html">XAML Behaviors for WPF is now open source</a></li>
<li><a href="../433336/index.html">Implementation of the Babylon Library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>