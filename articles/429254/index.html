<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>On the question of Bezier curves and speed Arduino, part two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We will go by - and on 


 In my previous post I showed how you can improve the speed of calculating points on the Bezier curve (KB) by: 



1. Transf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>On the question of Bezier curves and speed Arduino, part two</h1><div class="post__text post__text-html js-mediator-article"><h3>  We will go by - and on </h3><br><img src="https://habrastorage.org/webt/hx/vp/j2/hxvpj2li3y68iwtzbikjgddqauy.jpeg"><br><br>  In my previous post I showed how you can improve the speed of calculating points on the Bezier curve (KB) by: <br><br><ol><li>  Transformations of calculation formulas - acceleration ~ 3 times. </li><li>  There is almost no transition from the PT numbers to the FT - there is almost no acceleration, but it allows to carry out 3. </li><li>  Replacing the division operation by multiplication and shift - an acceleration of another 40%. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Sad retreat</b> <div class="spoiler_text">  - I made an inaccuracy in the last formula, it was still possible to speed up the calculations a bit more by folding another constant expression and, excluding multiplication, instead of 502, get 410 cycles per calculation cycle.  Unfortunately, none of the readers of the previous post mentioned this to me in the comments ... but I hoped for it, which means that I could not interest my readers enough to read my opuses correctly (that is, carefully).  Okay, let's try one more time. </div></div><br><a name="habracut"></a><br>  At the end of the post, I said that you can make the calculations even faster, but what ‚Äúthe boy said - the boy did‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let me remind you once again the resulting formula for calculating the point on the KB <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mrow" id="MJXp-Span-2"><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-6"><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mn" id="MJXp-Span-8">1</span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">d</span><span class="MJXp-mo" id="MJXp-Span-13" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-14"><span class="MJXp-mo" id="MJXp-Span-15" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mn" id="MJXp-Span-16">1</span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">d</span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-23"><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0.333em; margin-right: 0.333em;">=&gt;</span><span class="MJXp-mn" id="MJXp-Span-27">2</span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mn" id="MJXp-Span-29">2</span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-31" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="42.465ex" height="2.66ex" viewBox="0 -832 18283.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-3D" x="744" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-28" x="1800" y="0"></use><g transform="translate(2190,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-31" x="2864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2217" x="3587" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-61" x="4310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-6E" x="4839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-64" x="5440" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2B" x="6185" y="0"></use><g transform="translate(7186,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-31" x="7663" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-29" x="8163" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2217" x="8775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-61" x="9498" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-6E" x="10027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-64" x="10628" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2B" x="11373" y="0"></use><g transform="translate(12374,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-28" x="12945" y="0"></use><g transform="translate(13334,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-32" x="15169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2217" x="15892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-32" x="16614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2B" x="17115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-29" x="17893" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1">  = (1 * and + 1) * and +  (=> 2 * 2 +) </script></p>  The next increase in speed is related to the peculiarity of the task - we don‚Äôt need to calculate the KB value for a different value of the ‚Äúi‚Äù parameter, but to find a series of values ‚Äã‚Äãwhen this parameter changes (in this case, an increase) by a known, moreover, fixed value (in our case one), which allows us to use the method described below.  In my time, this was called the difference calculation method (if memory doesn‚Äôt change me, at least it was called so in lectures), the entire Internet is at your disposal, maybe (even for sure) there is another name. <br><br>  Consider the case of P = A * and (=&gt; 1 *), and suppose that we know the value of P0 for some argument u0.  Then the value at the next argument u0 + 1 can be calculated as  =  * (0 + 1) =  * 0 +  = 0 +  (=&gt; 1+).  Without losing any accuracy, we were able to replace the multiplication operation with an addition operation, which is much faster. <br><br>  Now a more complex example is P = A * and * and (=&gt; 2 *), we consider by analogy P = A * (and + 1) * (and + 1) = A * (and * and + 2 * and + 1) = A * and * and + 2 * A * and + A = P0 + 2 * A * and + A (=&gt; 2 * 2 +).  At first glance, we did not win anything, but if we calculate in advance A '= 2 * A, then we get (=&gt; 1 * 2 +), the gain is also quite possible.  But we will not stop on what has been achieved and on the resulting expression A '* and apply the method already known to us, then we will get two operations on two variables:  =  + ' + ;  A '= A' + A (=&gt; 3+).  If we also take into account that the initial value of A 'can be made more on A, then in general there are only two additions instead of two multiplications.  Yes, we had to make two additional variables, but this is a classic exchange - we pay with memory for the time. <br><br>  It gives only to calculate the correct initial values, but this is done only once at the beginning of the iterations, and if the initial value of the parameter and = 0, then P = 0 is generally trivial, A '= A.  Let's test our method at several iterations (this is completely unnecessary, a correctly applied mathematics cannot give a wrong answer), but it will allow us to better understand what is happening.  so <br>  iteration 0: and = 0;  P = 0 (true);  A '= A;  A "= 2 * A; <br>  iteration 1: and = 1;  P = 0 + A '= 0 + A = A (true);  A '= A' + A '' = A + 2 * A = 3 * A; <br>  iteration 2: and = 2;  P = A + 3 * A = 4 * A (true);  A '= 3 * A + 2 * A = 5 * A; <br>  iteration 3: and = 3;  P = 9 * A (true);  A '= 7 * A and so on. <br><br>  We note the connection of the formulas obtained with the Newton method for calculating the value of a function in a neighborhood of a certain point with a known value.  Moreover, given that our function has a second order and all derivatives, starting from the third, are equal to zero, we can safely replace the sign of approximate equality with the exact one.  The only difference from this method is that we constantly move the point relative to which we are building a new neighborhood, in order to avoid performing multiplication operations in the original formulation. <br><br>  Rewrite our original expression for KB in expanded form <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-32"><span class="MJXp-mrow" id="MJXp-Span-33"><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-36"><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mn" id="MJXp-Span-38">1</span><span class="MJXp-mo" id="MJXp-Span-39" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">d</span><span class="MJXp-mo" id="MJXp-Span-43" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">d</span><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-48"><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mn" id="MJXp-Span-50">1</span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">d</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-56"><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="34.292ex" height="2.298ex" viewBox="0 -780.1 14764.7 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-3D" x="744" y="0"></use><g transform="translate(1800,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-31" x="2475" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2217" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-61" x="3920" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-6E" x="4450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-64" x="5050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2217" x="5796" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-61" x="6519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-6E" x="7048" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-64" x="7649" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2B" x="8394" y="0"></use><g transform="translate(9395,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-31" x="9872" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2217" x="10594" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-61" x="11317" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-6E" x="11847" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMATHI-64" x="12447" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429254/&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjapipxNu4--zjYYAiZ7WWtZVfCqQ#MJMAIN-2B" x="13193" y="0"></use><g transform="translate(14194,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)"></text></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-2">  = 1 * and * and + 1 * and +  </script></p> , then to calculate using this method we need 2+ for the first addend (and two variables), 1+ for the second (and one variable) and 2+ to add everything together (=&gt; 5+).  It can be expected that even this (wrong) approach will give a gain compared to 2 * 2 +, but everything is much better.  Obviously, the addition operation is additive (thank you, captain), so you can group the terms and replace the constant terms with new expressions, which gives the following algorithm: <br><br>  1. initial values ‚Äã‚Äã = ;  A '= A1 + B1;  A "= 2 * A1; <br>  2. at the next step,  =  +  ';  A '= A' + A '' (=&gt; 2+), which is undoubtedly faster than the Horner scheme. <br><br>  We implement our algorithm in the form of a program (this is not as trivial as it may seem, since I forgot to simplify the need for shifts, but not too difficult ... for 20 minutes), we get the computational complexity (=&gt; 2 + 1 &gt;&gt;) and measure speed - it turned out 140 (increase in speed by 3 times) cycles per cycle, but this is almost an ideal result.  What we have to do to get the ideal (in some sense) option is to pay attention to the dimension of the operands in the formulas.  Now we carry out all operations on long (32-bit) integers, and this may be unnecessary in some places.  If we reduce the digit capacity of the operands to the minimum necessary, we can get an interest gain of 20-25, but this will require us to go to an assembler (C does not have the means suitable for such operations) and careful analysis of the data of the original problem.  Whether it is done by the reader, we have already accelerated the calculations by more than 1900/140 = 13 times compared with the ‚Äúnaive‚Äù approach. <br><br>  The last remark to the implementation of the algorithm - we still exclude the division operation by replacing it with multiplication by a constant, which we take into account when forming the initial data and shifting by a constant multiple of 8. This can be done in various ways with slightly different execution time, leaving similar experiments to the inquisitive reader . <br><br>  However, quite unexpectedly, one problem arose - we clearly see two addition operations over 32 bit numbers, which should take 4 + 4 = 8 clocks, set another 8 * 3 * 2 = 48 clocks for operand transfers, 4 clocks for receiving the shift result, 4 tact for calling the procedure of calculation and return and 4 cycles for organizing the cycle - it is not clear where another 60 cycles come from.  Previously, we simply did not notice this against the background of hundreds of computation bars, but now we can pay attention.  Redundant clocks were easily found - unnecessary debugging operations remained in the cycle, if you cleaned up everything neatly, then only 120 clocks remain and the purpose of each one is understandable (well, not so much that would be completely understandable, but still).  Next, we find out the time for the empty cycle - 22 clocks, I wonder what they are doing there all this time, but oh well, and clear the actual calculation time, which will be 98 clocks.  Note that the estimate of the resulting acceleration of work changes: instead of 1900/140 = 13, we get (1900-50) / (140-40) = 19 times, which makes no practical sense, since the cycle is still necessary, but allows us to raise even more self-esteem. <br><br>  And the last remark - as it is not difficult to see, we began to search for and eliminate fleas only when we dealt with large deer-beetles and their (fleas) existence became obvious and, moreover, significant.  I strongly recommend exactly this approach (and in this recommendation I am not alone) when optimizing programs in terms of speed. <br><br>  Well, in conclusion about the note "in a certain sense" - if it is a question of sequentially calculating the coordinates of the next point on the KB when the parameter (personifying time) changes, then the proposed algorithm (after all the optimizations) cannot be improved.  But if the task is reformulated and, for example, set a goal to simply build a design bureau on the screen (without reference to time), then there is a very promising method, the key word Brezenheim, but ‚Äúthis is a completely different story‚Äù, to which I will dedicate a separate post (maybe someday, if the older sister does not mind). </div><p>Source: <a href="https://habr.com/ru/post/429254/">https://habr.com/ru/post/429254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429244/index.html">Greedy Dwarf: As I wrote market analytics in Lineage 2</a></li>
<li><a href="../429246/index.html">Summer Internship at Mars IS: An Inside Look</a></li>
<li><a href="../429248/index.html">Tips polyglot: how to learn any language without tears and curses</a></li>
<li><a href="../429250/index.html">One hundred digital accounting recipes</a></li>
<li><a href="../429252/index.html">Static analysis of mobile applications</a></li>
<li><a href="../429256/index.html">How to grow a forest on Actionscript3 / Flash in a few * lines of code</a></li>
<li><a href="../429258/index.html">How to create a reliable game mechanics, using only Excel: modeling and optimization solutions</a></li>
<li><a href="../429260/index.html">Our way to the centralized storage of logs</a></li>
<li><a href="../429262/index.html">We invite you to the autumn DIYorDIE Meetup November 17</a></li>
<li><a href="../429264/index.html">Lithium-Ion UPS Time: Fire Hazard or a Safe Step into the Future?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>