<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ext4 Features</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a translation of that part of the article on KernelNewbies, which describes the features of the Ext4 file system. The last section of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ext4 Features</h1><div class="post__text post__text-html js-mediator-article">  <i>This article is a translation of that part of the <a href="http://kernelnewbies.org/Ext4">article</a> on KernelNewbies, which describes the features of the Ext4 file system.</i>  <i>The last section of the article, on the use of Ext4, has already been <a href="http://habrahabr.ru/blogs/linux/58121/">published</a> on Habr√©.</i> <br><br>  <b>Ext4</b> is the result of the evolution of Ext3, the most popular file system in Linux.  In many aspects, Ext4 represents a bigger step forward than Ext3 than Ext3 was relative to Ext2.  The most significant improvement in Ext3 compared to Ext2 was journaling, while Ext4 assumes changes in important data structures, such as, for example, data files. <br><br>  This allowed us to create a file system with a more advanced design, more productive and stable and with an extensive set of functions. <br><a name="habracut"></a><br><h2>  1. Compatibility </h2><br>  Any existing Ext3 file system can be converted to Ext4 by a simple procedure consisting of running a couple of commands in read-only mode.  This means that you can improve performance and capacity and improve the capabilities of your existing file system without reformatting and without reinstalling the OS and programs.  If you want to take advantage of Ext4 in a production-based system, you can also update the file system.  This procedure is safe and does not put your data at risk (in this case, of course, it is recommended to make a backup of important data. However, this should be done even if you are not going to change the file system). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Ext4 will only use new structures for new data, while old ones will remain unchanged.  If necessary, they can be read and modified.  This certainly means that, once changing the file system to Ext4, it will no longer be possible to return Ext3. <br><br>  It is also possible to mount the Ext3 file system as Ext4 without using the new data format, which will allow later to mount it again as Ext3.  In this case, of course, you can not take advantage of the many advantages of Ext4. <br><br><h2>  2. Larger file and file system size </h2><br>  Today, the maximum size of the Ext3 file system is 16 terabytes, and the file size is limited to 2 terabytes.  Ext4 adds 48-bit block addressing, which means that the maximum size of this file system is one exabyte, and files can be up to 16 terabytes.  1 EB (exabyte) = 1,048,576 TB (terabyte), 1 EB = 1024 PB (petabyte), 1 PB = 1024 TB, 1 TB = 1024 GB.  Why 48-bit and not 64-bit?  There were a number of restrictions that would have to be removed in order to make Ext4 fully 64-bit, and there was no such task before Ext4.  The data structures in Ext4 were designed taking into account the required changes, so one day in the future support for 64 bits in Ext4 will appear.  In the meantime, you have to be content with one exabyte. <br><br>  Note: The code for creating file systems larger than 16 terabytes at the time of this writing is not contained in any of the stable releases of e2fsprogs.  In the future it will be added. <br><br><h2>  3. Scalable Subdirectories </h2><br>  Currently, one Ext3 directory cannot contain more than 32,000 subdirectories.  Ext4 removes this restriction and allows you to create an unlimited number of subdirectories. <br><br><h2>  4. Extents </h2><br>  Traditional Unix-derived file systems, such as Ext3, use an indirect block mapping scheme to track each block responsible for storing file data.  This approach is not effective for large files, especially when deleting and truncating such files, because the map of correspondence contains one record for each separate block.  In large files, there are many blocks, their matching cards are large, and they are processed slowly. <br><br>  In modern file systems, a different approach is used, based on the so-called extents.  An extent is basically a set of consecutive physical blocks.  He seems to be telling us: "This data is in the following n blocks."  For example, a file of 100 megabytes in size may be stored in a single extent of the same size, instead of being split into 25600 4-kilobyte blocks, addressed by indirect mapping.  Huge files can be divided into several extents. <br><br>  Through the use of extents, performance is improved, and fragmentation is also reduced, since extents facilitate continuous data placement. <br><br><h2>  5. Multi-block distribution </h2><br>  If in Ext3 you need to write new data to disk, a special block allocation mechanism determines which free blocks will be used for this.  The problem is that in Ext3 this mechanism distributes in one go only one block (4 kilobytes).  This means that if you need to record, say, the previously mentioned 100 megabytes of data, you will need to refer to the distribution mechanism 25600 times (we are talking about some 100 megabytes!).  Not only is it inefficient, it also does not allow to optimize the distribution policy, since the corresponding mechanism does not have a clue about the actual amount of data to be recorded, but knows only one and only one block. <br><br>  Ext4 uses a multi-block allocation mechanism (multiblock allocator, mballoc) which allows you to distribute any number of blocks with a single call and avoid huge overhead.  Due to this, the performance grows significantly, which is especially noticeable with deferred distribution (see below) using extents.  This feature does not affect the format of the data. <br><br>  It can also be noted that the Ext4 block allocation and inode mechanism also received other improvements, which are described <a href="http://ols.fedoraproject.org/OLS/Reprints-2008/kumar-reprint.pdf">in</a> detail <a href="http://ols.fedoraproject.org/OLS/Reprints-2008/kumar-reprint.pdf">in this document</a> . <br><br><h2>  6. Deferred distribution </h2><br>  <a href="http://en.wikipedia.org/wiki/Allocate-on-flush">Deferred distribution</a> is a way to improve performance without affecting the data format and is present in modern file systems such as XFS, ZFS, btrfs, and Reiser 4. <br><br>  The essence of this method is to delay the allocation of blocks as much as possible - in contrast to the approach used in traditional file systems (such as Ext3, reiser3, etc.): allocate blocks immediately, at the earliest opportunity.  For example, if a process writes by a write () call, the file system will allocate blocks for writing immediately ‚Äî even if the data is not yet written to disk, but will be kept in the cache for some time.  The disadvantages of this approach, for example, are that if a process continuously writes to a growing file, successive write () calls continuously allocate data blocks, and it is not known whether the file will grow further. <br><br>  When using deferred allocation, blocks are not immediately allocated when writing to write ().  Instead, the distribution is postponed until the file is written from the cache to disk.  Thanks to this, the mechanism is able to optimize the distribution process.  The greatest gain is obtained when using the two previously mentioned features - extents and multi-block distribution, because often there is a situation when the final file is written to disk in the form of extents distributed using mballoc.  This gives a significant performance boost, and sometimes greatly reduces data fragmentation. <br><br><h2>  7. Fast fsck </h2><br>  Fsck is a very slow operation, especially for its first stage, checking all inodes in the file system. <br><br>  In Ext4, after the inode-table of each group, a list of unused inodes is stored (provided with a checksum for reliability), so fsck will not check such inodes.  The result is a reduction in the scan time from 2 to 20 times, depending on the number of inodes used (see <a href="http://kerneltrap.org/Linux/Improving_fsck_Speeds_in_Ext4">http://kerneltrap.org/Linux/Improving_fsck_Speeds_in_Ext4</a> ). <br><br>  The fact that the list of unused inodes is made up by fsck, not Ext4, will be well seen if you run fsck to build a list of unused inodes, and when only the next start of fsck runs faster (fsck is still needed when you convert Ext3 to Ext4). <br><br>  In addition, the fsck acceleration is influenced by another feature - ‚Äúflexible groups of blocks‚Äù; they also speed up other file operations. <br><br><h2>  8. Journal checksums </h2><br>  The log is the most frequently used part of the disk, as a result of which the blocks of which it is composed become especially sensitive to equipment failures.  Moreover, attempting to recover from a damaged log can lead to even more massive data damage.  Ext4 calculates checksums of log data, which allows to determine the fact of their damage.  This has one more advantage: thanks to checksums, you can turn the Ext3 two-phase journal fixing system into a single-phase one, which speeds up file operations in some cases by up to 20%, thus both reliability and performance are improved at the same time. <br><br>  Note: the part responsible for performance - asynchronous logging - is now disabled by default, and will be enabled in a later release, when it can be achieved with reliable operation. <br><br><h2>  9. Mode without logging </h2><br>  Journaling ensures the integrity of the file system by logging all changes occurring on the disk.  But it also introduces additional overhead for disk operations.  In some special situations, journaling and the benefits it provides may be redundant.  Ext4 allows you to disable logging, which results in a <a href="http://git.kernel.org/%3Fp%3Dlinux/kernel/git/torvalds/linux-2.6.git%3Ba%3Dcommit%3Bh%3D0390131ba84fd3f726f9e24fc4553828125700bb">small performance boost</a> . <br><br><h2>  10. Online defragmentation </h2><br>  This feature is still in development and will be included in one of the future releases. <br><br>  Although deferred and multi-block distribution and extents help reduce file system fragmentation, it can still grow over time. <br><br>  For example: you create three files in one directory and they are located on the disk one after the other.  Then, once you decide to update the second file, and at the same time the file becomes somewhat larger - so that there is not enough space for it.  There are no other solutions besides separating the non-enclosing file fragment and placing it on another place of the disk or allocating the file a consecutive larger disk area in another place, far from the first two files, which will cause the disk head to move if the application needs to read all files in the directory (for example, the file manager will create thumbnails for image files). <br><br>  In addition, the file system can only take care of certain types of fragmentation and it cannot know, for example, that it should keep all the files that are required when loading, next to each other, because it simply does not know which of them are required when loading.  To solve this problem, Ext4 will support online defragmentation. <br><br>  There is also an e4defrag utility that allows you to defragment both individual files and the entire file system. <br><br><h2>  11. Improvements related to inode </h2><br>  Larger inodes, nanosecond timestamps, fast extended attributes, inodes reservations ... <br><br><ul><li>  Larger inodes: Ext3 supports custom size inodes (by specifying the -I parameter with mkfs), but the default inode size is 128 bytes.  In Ext4, it will be 256 bytes.  This was required to accommodate several additional fields (such as nanosecond timestamps and inode versions), and the remaining inode space will be used to store those extended attributes that are small enough to fit there.  This will make access to such attributes much faster and improve the performance of applications using them by 3‚Äì7 times. </li><li>  The essence of inode reservation is to allocate several inodes when creating a directory, in anticipation that they will be used in the future.  This improves performance because newly created files in this directory will be able to use reserved inodes.  Therefore, creating and deleting files is more efficient. </li><li>  Nanosecond timestamps (nanosecond timestamps) mean that inodes such as, for example, the modification time get nanosecond accuracy (in Ext3 it was equal to a second). </li></ul><br><br><h2>  12. Sustainable redistribution </h2><br>  This feature, already available in Ext3 in the latest kernel versions and emulated by glibc in file systems that do not support it, allows applications to pre-allocate disk space by reporting their needs to the file system.  That, in turn, allocates the required number of blocks and data structures, but they are empty until the application actually writes to them. <br><br>  This is exactly what P2P applications do, for example, allocating space for data that will appear there only after hours or days.  However, this is implemented much more efficiently - at the file system level and with a universal API. <br><br>  There are several applications to this: firstly, to prevent the same applications (such as P2P) from being executed by inefficiently filling files with zeros - the necessary blocks will be allocated at once. <br><br>  Secondly, to reduce fragmentation - again, because the blocks are allocated only once, as continuously as possible. <br><br>  Third, to ensure that the application will have as much space as it needs, which is especially important for real-time applications, since the file system may suddenly overflow during an important operation. <br><br>  This feature is available through the libc posix_fallocate () interface. <br><br><h2>  13. The ‚Äúbarrier‚Äù mechanism is enabled by default. </h2><br>  This is an option that ensures the integrity of the file system at the cost of some performance loss (it can be disabled using the ‚Äúmount -o barrier = 0‚Äù, it is recommended to do this when measuring performance). <br><br>  Excerpt <a href="http://lwn.net/Articles/283161/">from the LWN article</a> : ‚ÄúThe file system code must be absolutely sure before creating a record of the [journal] that all information about the transaction has been placed in the journal.  Just making a record in the right order is not enough;  modern drives have a large cache and change the write order to optimize performance.  Therefore, the file system must explicitly tell the disk to write all log data to media before creating a commit record;  if a commit record is first created, the log may be corrupted.  The blocking system of input-output of the kernel provides such an opportunity due to the use of the mechanism of ‚Äúbarriers‚Äù (barriers);  in other words, the ‚Äúbarrier‚Äù forbids the recording of any blocks sent after it, until such time as everything that was sent before the ‚Äúbarrier‚Äù will be transferred to the carrier.  With the use of ‚Äúbarriers,‚Äù the file system can guarantee that everything that is on the disk is complete at any time. ‚Äù </div><p>Source: <a href="https://habr.com/ru/post/58183/">https://habr.com/ru/post/58183/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../58176/index.html">Sites allowed to close without trial</a></li>
<li><a href="../58177/index.html">Film distributors take creative</a></li>
<li><a href="../58178/index.html">Five and a half myths about SharePoint</a></li>
<li><a href="../58180/index.html">Sales of Microsoft products fell for the first time in 23 years</a></li>
<li><a href="../58182/index.html">Tetris as a lifestyle</a></li>
<li><a href="../58184/index.html">How can an outpost block Habr's work?</a></li>
<li><a href="../58185/index.html">Customize forms using SharePoint Designer</a></li>
<li><a href="../58188/index.html">Status bar for dwm</a></li>
<li><a href="../58191/index.html">Creating a team of programmers. Where to start?</a></li>
<li><a href="../58192/index.html">How do you think Medvedev's activity in the network is an element of political technology?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>