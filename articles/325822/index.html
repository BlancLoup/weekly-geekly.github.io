<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sandbox technology. Check Point SandBlast. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the topic of network sandboxes. In the previous module, I have already given a small ‚Äúsad‚Äù statistics targeted attacks. Summarizing the ab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sandbox technology. Check Point SandBlast. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1c9/92e/823/1c992e823ab945e6bc03ae45462ece95.png"><br>  We continue the topic of network sandboxes.  In the previous <a href="https://habrahabr.ru/company/tssolution/blog/325246/">module,</a> I have already given a small ‚Äúsad‚Äù statistics targeted attacks.  Summarizing the above, we can draw several main conclusions: <br><br><ul><li>  99% of malware were seen only once.  For this reason, signature protection is simply powerless. </li><li>  Mail is a hacker's favorite tool.  As a rule, malware is delivered as files or as links to files. </li><li>  Contrary to popular opinion, not only exe, flash and java files can be infectious.  Those.  banning this type of files, you are still not protected.  The malware can be hidden in authorized documents such as: doc, excel, pdf, powerpoint, archives, and so on. </li></ul><br><a name="habracut"></a><br><img src="https://habrastorage.org/files/3b0/11f/3a1/3b011f3a18c6438dbe9ed0de6326ed0a.png"><br>  In this regard, a relatively new type of remedies appeared ... <br><br>  <b>Sandbox</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The current day is probably the only way to deal with zero-day attacks.  What actually is the task of the classic sandbox?  Next, there will be a lot of pictures from the presentation and, as usual, the video at the end (both theoretical and practical). <br><br><img src="https://habrastorage.org/files/b9d/be9/885/b9dbe9885a9843bca0511ae303f64680.png"><br>  Sandbox task is very simple: <br><br><ul><li>  Open file (even infected) </li><li>  Analyze activity (changes in the registry, changes in network activity, file system activity, launch of system processes, etc.) </li><li>  Block or skip file </li></ul><br>  Naturally, all actions take place in a virtual machine in specially prepared images.  It would seem that here it is a victory over zero-day attacks.  But not everything is so simple. <br><br>  <b>Sandbox circumvention technologies</b> <br><br>  As soon as the sandboxes were announced as a new means of protection, the so-called ‚ÄúArms Race‚Äù began.  Hackers began to write more intelligent malware: <br><br><img src="https://habrastorage.org/files/d72/085/f7e/d72085f7e6f94bdd84b9693493fa2e27.png"><br><ul><li>  For example, the malware could go into hibernation and not start immediately so that the sandbox could skip this file further into the network.  Sandbox developers immediately responded and began to speed up time in virtual machines.  To which hackers responded using their own timers inside the malware (usually running some kind of ‚Äúmore‚Äù calculation inside the program), i.e.  stopped looking at the system clock. <br><br></li><li>  Then, malware began to try to find the sandbox, i.e.  determine where they started.  Sandboxes began to try to hide the fact of their presence by emulating a physical CPU.  But the malware quickly learned to identify this emulation. <br><br></li><li>  Newer versions of malware began to try to find a person at the computer, i.e.  try to determine that they are not launched by a robot.  These were various sensors of mouse movement, keyboard presses, etc.  Sandboxes began to imitate human behavior.  But it is very difficult.  Malware has become quite easy to identify a ‚Äúvirtual‚Äù person.  For example, one of the malicious programs was packed into a doc format document, where in the middle of the document a picture with a naked woman was inserted.  Any healthy person while viewing the document lingered on this picture.  The sandbox didn‚Äôt do this and simply scrolled the file, imitating human behavior.  Thus, the malware easily determined that it was opened by a robot, i.e.  sandbox. </li></ul><br>  This ‚Äúarms race‚Äù is still ongoing. <br><br>  <b>Check Point SandBlast</b> <br><br>  In connection with the problems voiced above, recently a new sandbox technology was introduced - CheckPoint SandBlast. <br><br><img src="https://habrastorage.org/files/07f/e18/74e/07fe1874e5dd4f3ea2c07a546e2b53ec.png"><br><br>  This technology provides a very wide range of protection means: <br><br><ol><li>  Threat Emulation - file emulation technology </li><li>  Threat Extraction - file cleaning technology </li><li>  Zero Phishing - Phishing Protection </li><li>  Endpoint Forensics - IS Incident Investigation Module </li><li>  Zero Ransomware - protection from cryptographers </li></ol><br>  In this article and lab, we will focus on Threat Emulation (i.e. file emulation) and Threat Extraction (i.e. file cleanup). <br><br>  <b>Features of Threat Emulation</b> <br><br>  What is the feature of Check Point emulation technology?  How does she cope with the previously voiced "arms race"?  Let's take a look at the work of the Threat Emulation module using the example of a typical life cycle of almost all malware. <br><br><img src="https://habrastorage.org/files/102/6b6/674/1026b667415248f89d4c2029218fce9d.png"><br><ol><li>  The first thing that begins the process of delivering malware is with any <b>software vulnerability</b> .  There are thousands of these vulnerabilities, it all depends on the software you use (it could be a browser, acrobat reader, email client, etc.).  Most of these vulnerabilities are unknown even to software vendors themselves, otherwise they would have released a patch (which they periodically do), but this is almost always after someone took advantage of this vulnerability. <br><br></li><li>  In order to use these vulnerabilities, you need special <b>exploits</b> .  Those.  mini-programs that perform a certain sequence of actions can get a certain level of access to the victim's system.  There are very few exploits and new ones appear extremely rarely. <br><br></li><li>  An exploit can carry within itself the so-called <b>shellcode</b> (i.e., another mini program that will be executed directly on the victim's computer).  Typically, this shellcode is used to download additional malware, or to create malware directly on the victim‚Äôs computer using ‚Äúavailable tools‚Äù.  A little later, consider how this happens. <br><br></li><li>  Shellcods use various <b>protection bypass techniques.</b> <br><br></li><li>  As a result, we get a huge number of possible variations of malware.  Which will also have different sandbox traversal techniques. </li></ol><br>  Classic (traditional) sandboxes start working at this stage.  Such sandboxes are also called <b>OS Level</b> .  At the same time, it is likely that the sandbox will not be able to cope with such a number of malware types. <br><br>  The checkpoint approach is more logical in this case.  It is much more reasonable to intercept malicious programs where there are the least of their options and the likelihood of determining them to strive for 100%.  This is a stage of exploits. <br><br>  The checkpoint at the processor level sees the execution of the exploit and allows you to lock the file before executing or downloading additional modules.  This revolutionary approach ( <b>CPU Level</b> ) became possible after the appearance of Intel Haswell processors, where such monitoring is allowed at the hardware level.  Moreover, checkpoint supports the classic sandbox mode, i.e.  OS Level. <br><br>  Let's now see how the collection of the necessary shellcod actually looks like. <br><br><img src="https://habrastorage.org/files/07c/9d3/f70/07c9d3f70ddc4ee98a01acd8fea29430.png"><br>  Let's start with the fact that transferring a malicious file entirely to the victim‚Äôs computer is very primitive, because  in this case, various antiviruses or IPSs can determine the attack.  Therefore, hackers invented a rather interesting way.  They began to collect malicious code directly on the victim's computer using already running processes.  This method was called <b>ROP</b> , i.e.  <b>return oriented programming</b> .  On this slide you can see how the code is collected for the malware.  Presented here is the work of Adobe Reader in hex form.  The necessary functions are highlighted and the so-called gadget is assembled.  It is this process (improper use of the program) that allows you to see and prevent Threat Emulation.  We will not consider ROP in detail, because  This is a very complex topic and deserves a separate series of articles. <br><br>  <b>Traditional sandbox problems</b> <br><br>  Now let's look at the main problems of traditional sandboxes. <br><br><img src="https://habrastorage.org/files/8bc/e08/9bd/8bce089bd25c44bf8bf574820c92d3b7.png"><br><br>  The main problem of sandboxes is that not only infected files come to analysis, but also ordinary, clean files (this also applies to Threat Emulation).  After that the emulation process takes place.  This process is not instantaneous and can take from 1 to 30 minutes.  At the same time, no one eliminates false positives, when a normal file will be mistaken for malicious and discarded.  As a result, we have a bunch of irritated users who do not want to wait for their files. <br><br>  As a result, most sandboxes are configured in bypass mode, i.e.  source files reach users while emulation is in progress.  And this is the usual detection, not blocking.  This is unacceptable in the case of cryptographers, since  then it will be too late. <br><br>  Threat Extraction technology is designed to solve this problem. <br><br>  <b>Benefits of Threat Extraction</b> <br><br>  This technology is designed for instant cleaning of files and sending it to the user.  At this time, the source file is emulated using the Threat Emulation module. <br><br><img src="https://habrastorage.org/files/03b/67e/fa5/03b67efa54d040dd9bd692f402e97853.png"><br><br>  There are two main ways to clean incoming files: <br><br><ol><li>  The first is the conversion of the source file to pdf.  In fact, there is a ‚Äúprintout‚Äù of the file on the virtual printer.  The user receives a pdf document with no dangerous content.  In 90% of cases this is enough for the user to read the document. </li><li>  The second way is to clear all active content from the source file.  All macros are cut out and the output is a completely sterile file with the original extension preserved (doc, ppt, etc.). </li></ol><br>  I highly recommend to pay attention to the first method, since  in this case, the malware does not have the slightest chance of survival.  It is safer to just print the file on real paper. <br><br>  In addition, the user still retains the ability to get the source file if false positives still occur, or if the source document contains important macros (well, for example an excel file with macros).  If you take for example files that were received by mail, then the user will be provided with already cleared files with a link to the source file. <br><br><img src="https://habrastorage.org/files/e74/855/f13/e74855f1315f468589d8554d69c4e173.png"><br><br>  If you click on this link, the user will be taken to a special portal, where he will have the opportunity to request the source file.  At the same time, he will be warned about its possible harmfulness.  Whether the user will receive this file already depends on the settings.  You can issue these files manually after a more thorough analysis by information security administrators. <br><br>  <b>Check Point SandBlast Product Line</b> <br><br><img src="https://habrastorage.org/files/8cf/40d/214/8cf40d214d7c45c7a8c791d5a458fec9.png"><br>  If we consider the CheckPoint SandBlast product line, we can distinguish 4 areas.  It: <br><br><ol><li>  Network devices to protect the perimeter or any segments </li><li>  Agents to protect endpoint workstations </li><li>  Cloud protection for Office 365 (Gmail support is expected soon) </li><li>  And a specialized API that allows you to use the cloud checkpoint third-party applications and manufacturers </li></ol><br>  In this case, as can be seen from the picture, each solution has a different functionality.  In this part we will focus on the first option, i.e.  network level security.  There are three deployment options for network level security: <br><br><img src="https://habrastorage.org/files/440/332/10c/44033210c394417fb09128d7f22696e0.png"><br><ol><li>  Using the cloud sandbox.  The NGTX license is activated on the existing CheckPoint Gateway.  Files are sent to emulate to the cloud.  In my opinion this is the most optimal and economical option.  However, in some companies it is forbidden to send your own files to the external network, even for analysis. <br><br></li><li>  Local sandbox.  A separate piece of hardware is used - SandBlast Applince.  In this case, the Check Point Gateway with NGTX licenses sends the file to your SandBlast device, where the files are checked. <br><br></li><li> Local sandbox in inline mode.  It is suitable if you do not have a Check Point Gateway. </li></ol><br>  Now we can move to the lab and in practice try out the Threat Emulation and Threat Extraction solutions. <br><br>  <b>Video Course for the second part</b> <br><br>  All the above theory.  part can be viewed in video format: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/0kfw92tqYRM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  In addition, there are three laboratory works: <br><br>  <b>Lab ‚Ññ3</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/FeSCMOlbeZY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  In the course of this tutorial, we will configure the Threat Emulation blade (the cloud version) and try to simulate the passage of infected files through the gateway.  Then we will again analyze the logs and block the download of malicious files for the Win7 user. <br><br>  <b>Lab ‚Ññ4</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6DRMOWRzYbk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  This time we will consider a variant of local emulation, i.e.  without sending files to the cloud.  We will also try checking email messages, for this we set up Check Point as MTA, i.e.  mail transfer agent.  Then we will try to send the infected file by mail and make sure that it is blocked.  And of course, let's analyze the logs. <br><br>  <b>Lab ‚Ññ5</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/x9AqxgoBQgM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  As we saw in the last lesson, file emulation is a very effective means of protection, but it takes some time!  Especially for those who do not like to wait until the files are emulated, there is a technology called Extraction.  During the lesson, we will activate it and try to mail the infected file again.  As a result, we need to get the already cleaned, or rather converted, document in pdf format. <br><br>  To be continued‚Ä¶ </div><p>Source: <a href="https://habr.com/ru/post/325822/">https://habr.com/ru/post/325822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325812/index.html">Around the noise. Chat bot: empty HYIP or new era?</a></li>
<li><a href="../325814/index.html">Battle for adults: how to exclude children's channels from advertising on Youtube 24/7?</a></li>
<li><a href="../325816/index.html">Moxy Strategies (Part 1)</a></li>
<li><a href="../325818/index.html">Quick Start: Overview of Core Deep Learning Framework</a></li>
<li><a href="../325820/index.html">Interview with Global Marketing Programs Manager at JetBrains by Michael Vinck</a></li>
<li><a href="../325824/index.html">Management of risks. Part 1</a></li>
<li><a href="../325826/index.html">Where is the "Lock Button"?</a></li>
<li><a href="../325828/index.html">Extract audio data from a wav file to UWP</a></li>
<li><a href="../325830/index.html">What is Apache Ignite / GridGain for, using the example .NET & C #</a></li>
<li><a href="../325836/index.html">Kotlin + Rx2: A reactive and functional approach to the development of mobile applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>