<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Notes for building effective Django-ORM requests in busy projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is written, because Another holivar appeared in the comments on SQL vs ORM in High-Load Project (HL) 

 Preamble 
 In the note you can find, in pla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Notes for building effective Django-ORM requests in busy projects</h1><div class="post__text post__text-html js-mediator-article">  It is written, because  Another holivar appeared in the comments on SQL vs ORM in High-Load Project (HL) <br><br><h4>  Preamble </h4><br>  In the note you can find, in places, banal things.  Most of them are available in the documentation, but a modern person often likes to miss everything superficially.  And many simply did not have the opportunity to test themselves in HL projects. <br>  Reading the article, remember: <br><ul><li>  You can never implement an HL project based on just one ORM manipulation. </li><li>  Never put complicated things on the shoulders of the database.  You need it to store info, not count factorials! </li><li>  If you cannot implement the idea that interests you using simple ORM tools, do not use ORM to directly solve the problem.  And the more so do not climb into a lower level, crutches break.  Find a more elegant solution. </li><li>  Sorry for the mockingly humorous tone of the article.  Otherwise boring :) </li><li>  All information is based on Django version 1.3.4. </li><li>  Keep it simple! </li></ul><br>  And-and-and yes, the article will show the errors in understanding ORM, which I encountered in more than three years of working with Django. <br><a name="habracut"></a><br><br><h4>  ORM not understood </h4><br>  I'll start with the classic mistake that haunted me for a long time.  In terms of beliefs in the Uruguayan monkey tribe.  I strongly believed in the omnipotence of Django ORM, namely in <br><pre><code class="django hljs"><span class="xml"><span class="xml">Klass.objects.all()</span></span></code> </pre> <br>  eg: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">all_result = Klass.objects.all() result_one = all_result.filter(condition_field=1) result_two = all_result.filter(condition_field=2)</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In my dreams, thinking went like this: <br><ul><li>  I chose all that I was interested in, by one query on the first line. </li><li>  In the second line, I will no longer have a request, but will work with the result obtained on the first condition. </li><li>  In the third line, I also will not have a query to the database, and I will have an output of interest to me with the second condition based on the results of the first query. </li></ul><br>  You, probably, already guess that magic monkeys do not exist and in this case we have three requests.  But, I will disappoint you.  In this case, we still have two requests, and to be even more precise, then there is not a single request based on the results of the work of this script (but in the future, of course, we will not be doing so).  Why, you ask? <br>  I explain in order.  Let us prove that in this code there are three requests: <br><ul><li>  The first line, in the calculations, is analogous <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>;</code> </pre><br></li><li>  The second line, in the calculations, analog <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> condition_field=<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br></li><li>  The third line, in the calculations, is an analog <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> condition_field=<span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br></li></ul><br>  Hooray!  We proved that we have three requests.  But the main phrase is ‚Äúin calculations‚Äù.  In fact, we come to the second part - proof that we have only two requests. <br>  For this problem we will be helped by the following understanding of ORM (in 2 sentences): <br><ul><li>  So far we have not calculated anything - we are only forming a query using ORM tools.  As soon as we started to calculate, we calculate by the received generated query. <br></li></ul><br>  So, in the first line we designated the variable <b>all_result</b> with the query of interest - select all. <br>  In the second and third line, we refine our request for a sample of additional.  conditions.  Well, therefore, received 2 requests.  What should prove <br>  Attentive readers (why did you look at the previous paragraphs again?) Should have already guessed that we didn‚Äôt make any requests.  And in the second and third lines, we just as easily formed a query that interests us, but we didn‚Äôt contact the database with it. <br>  So we were engaged in nonsense.  And the calculations will begin, for example, from the first line of the subordinate code: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result_one: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> result.id</code> </pre><br><br><h5>  Not always necessary functions and reasonable samples. </h5><br>  Let's try to play with the templates, and the favorite function of some <b>__unicode __ ()</b> . <br>  You know - cool feature!  In any place, at any time and under any circumstances we can get the name that interests us.  Super!  And it's super as long as we have in the output does not appear <b>ForeignKey</b> .  As soon as it appears, count everything is gone. <br>  Consider a small example.  We have news in one line.  There are regions to which these news are attached: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">class RegionSite(models.Model): name = models.CharField(verbose_name="", max_length=200,) def __unicode__(self): return "%s" % self.name class News(models.Model): region = models.ForeignKey(RegionSite, verbose_name="") date = models.DateField(verbose_name="", blank=True, null=True, ) name = models.CharField(verbose_name="", max_length=255) def __unicode__(self): return "%s (%s)" % (self.name, self.region)</span></span></code> </pre><br>  We need to display the 10 latest news, with the name as defined in <b>News .__ unicode __ ()</b> <br>  Uncover sleeves, and write: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">news = News.objects.all().order_by("-date")[:10]</span></span></code> </pre><br>  In the template: <br><pre> <code class="django hljs"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> n </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> news %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ n }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  And here we dug ourselves a hole.  If this is not news or not 10 - but 10 thousand, then be prepared for the fact that you will receive 10 000 requests + 1. And all because of the <b>muddling ForeignKey</b> . <br>  An example of an extra 10 thousand queries (and say thank you for having a small model - so all the fields and values ‚Äã‚Äãof the model would be chosen, be it 10 or 50 fields): <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">-- </span></span></code> </pre><br>  Why it happens?  All up to genital is simple.  Every time you get the name of the news, we have a request to the <b>RegionSite</b> to return its <b>__unicode __ ()</b> value, and substitute in brackets to display the name of the region of the news. <br>  Similarly, a bad situation begins when we, for example, in a template using ORM, are trying to get to the value we need, for example: <br><pre> <code class="django hljs"><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{ subgroup.group.megagroup.name }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  You will not believe what a hard request may be there :) I‚Äôm not even saying that you may have dozens of such samples in the template! <br>  We are not so easy to take us - we sobbed and took advantage of the following excellent ORM feature - <b>.values ‚Äã‚Äã()</b> . <br>  Our line of code in the magic-keyboard way turns into: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">news = News.objects.all().values("name", "region__name").order_by("-date")[:10]</span></span></code> </pre><br>  A pattern: <br><pre> <code class="django hljs"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> n </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> news %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ n.name }}</span></span><span class="xml"><span class="xml"> (</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ n.region__name }}</span></span><span class="xml"><span class="xml">) </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Note the double underscore.  It will be useful to us soon.  (For those who do not know - double underscore, as if the connection between the models, if you speak roughly) <br>  With such uncomplicated manipulations, we got rid of 10 thousand requests and left only one.  By the way, yes, it will work out with JOIN and with the fields selected by us! <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`news_news`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> (<span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`region_id`</span></span> = <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br>  We are happy to madness!  After all, we have just become ORM-optimizers :) Fig something there!  I will tell you :) This optimization is optimization until we have 10 thousand news.  But we can even faster! <br>  To do this, take into account our prejudices in the number of requests and urgently increase the number of requests 2 times!  Namely, let's prepare the data: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">regions = RegionSite.objects.all().values("id", "name") region_info = {} for region in regions: region_info[region["id"]] = region["name"] news = News.objects.all().values("name", "region_id").order_by("-date")[:10] for n in news: n["name"] = "%s (%s)" % (n["name"], region_info[n["region_id"]])</span></span></code> </pre><br>  And then the output in the template of our freshly variable is: <br><pre> <code class="django hljs"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> n </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> news %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ n.name }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Yes, I understand ... With these lines we violated the concept of MVT.  But this is just an example that can be easily converted into strings that do not violate the MVT standards. <br>  What have we done? <br><ol><li>  We have prepared data on regions and entered information about them in the dictionary: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span></code> </pre><br></li><li>  Chose from the news all that interests us + pay attention to the single underscore. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span>, <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`region_id`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`news_news`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br>  It was with a single underscore that we chose the direct value of the bundle in the database. </li><li>  Python tied two models. </li></ol><br>  Believe me, on a single ForeignKey you will hardly notice a gain in speed (especially if there are few selectable fields).  However, if your model has a connection through foridzhn with more than one model - this is where the celebration of this decision begins. <br>  Continue izgolyatsya over double and single underscore. <br>  Consider a simple example to the banality: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">item.group_id vs. item.group.id</span></span></code> </pre><br>  Not only when building queries, but when processing the results, you can run into this feature. <br>  Example: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">for n in News.objects.all(): print n.region_id</span></span></code> </pre><br>  The request will be only one - when selecting news <br>  Example 2: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">for n in News.objects.all(): print n.region.id</span></span></code> </pre><br>  Requests will be 10 thousand + 1, because  in each iteration we will have our id request.  It will be similar to: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  This is the difference due to one sign. <br>  Many advanced dzhangovody now poke a finger in a voodoo doll with my code.  And at the same time they ask me a question - what are you doing in a blizzard with the preparation of data, and where are the <b>values_list ("id", flat = True)</b> ? <br>  Consider a wonderful example showing the need for accuracy in working with <b>value_list</b> : <br><pre> <code class="django hljs"><span class="xml"><span class="xml">regions_id = RegionSite.objects.filter(id__lte=10).values_list("id", flat=True) for n in News.objects.filter(region__id__in=regions_id): print n.region_id</span></span></code> </pre><br>  With these code lines, we: <br><ol><li>  Prepare a list of regions of interest to us id-schnick of regions for some abstract condition. </li><li>  The resulting result is inserted into our news request and we get: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`region_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`date`</span></span>, <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`news_news`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`news_news`</span></span>.<span class="hljs-string"><span class="hljs-string">`region_id`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> U0.<span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> U0 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> U0.<span class="hljs-string"><span class="hljs-string">`id`</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span> )</code> </pre></li></ol><br>  Request in request!  Uuuuh, I love :) Especially choose 10 thousand news with nested select with IN (10 thousand aids) <br>  You certainly understand what this means?  :) If not, then understand - nothing, absolutely nothing good! <br>  The solution to this issue is also simple to genius.  Recall the beginning of our article - no query appears without calculating a variable.  And we make a remark, for example, on the second line of the code: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">for n in News.objects.filter(region__id__in=list(regions_id)):</span></span></code> </pre><br>  And with this solution we get 2 simple requests.  Without investment. <br>  You have not yet captured the spirit of the padl, ORM reserved for us?  Then drop even deeper.  Consider the code: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">regions_id = list(News.objects.all().values_list("region_id", flat=True)) print RegionSite.objects.filter(id__in=regions_id)</span></span></code> </pre><br>  With these two lines, we select the list of regions for which we have news.  Everything in this code is great, except for one moment, namely the resulting request: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span></code> </pre><br>  Ahaha, ORM, stop it!  What are you doing! <br>  Not only that he from all the news (I have 256 in their example, sort of) he chose the regions id and just substituted them, so he also took from somewhere limit 21. About the limit everything is simple - this is how the print of a large number of array values ‚Äã‚Äã(I I did not find another excuse), but with the meanings there is clearly an ambush. <br>  The solution, as in the previous example, is simple: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">print RegionSite.objects.filter(id__in=set(regions_id)).values("id", "name")</span></span></code> </pre><br>  By removing the extra elements via <b>set (),</b> we received a completely adequate request, as expected: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`seo_regionsite`</span></span>.<span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span></code> </pre><br>  Everyone is happy, everyone is happy. <br>  Looking slightly over the historically written code, I‚Äôll highlight another pattern you should be aware of.  And again the code example: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">region = RegionSite.objects.get(id=1) t = datetime.datetime.now() for i in range(1000): list(News.objects.filter(region__in=[region]).values("id")[:10]) # list(News.objects.filter(region__id__in=[region.id]).values("id")[:10]) # list(News.objects.filter(region__in=[1]).values("id")[:10]) # list(News.objects.filter(region__id__in=[1]).values("id")[:10]) print datetime.datetime.now() - t</span></span></code> </pre><br>  Each of the iteration lines was sequentially included (so that only one worked).  Total we can get the following approximate numbers: <br><ul><li>  1 line - 6.362800 s </li><li>  2 line - 6.073090 sec. </li><li>  3 line - 6.431563 sec </li><li>  4 line - 6.126252 sec </li></ul><br>  The differences are minimal, but visible.  Preferred 2 and 4 options (I mostly use 4m).  The main loss of time is how quickly we create the query.  Trivial, but significant, I think.  Every reader will make conclusions on their own. <br>  And we will finish the article with a scary word - a <b>transaction</b> . <br>  Special case: <br><ul><li>  You have InnoDB </li><li>  You need to update the data in the table in which customers do not write, but only read (for example, a list of products) </li></ul><br>  Update / insert is done once or twice. <br><ol><li>  Prepare 2 dictionaries - to insert data and update data </li><li>  Each of the dictionaries throw in its function </li><li>  <b>PROFIT!</b> </li></ol><br>  An example of a real update feature: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">@transaction.commit_manually def update_region_price(item_prices): """     """ from idea.catalog.models import CatalogItemInfo try: for ip in item_prices: CatalogItemInfo.objects.filter( item__id=ip["item_id"], region__id=ip["region_id"] ).update( kost=ip["kost"], price=ip["price"], excharge=ip["excharge"], zakup_price=ip["zakup_price"], real_zakup_price=ip["real_zakup_price"], vendor=ip["vendor"], srok=ip["srok"], bonus=ip["bonus"], rate=ip["rate"], liquidity_factor=ip["liquidity_factor"], fixed=ip["fixed"], ) except Exception, e: print e transaction.rollback() return False else: transaction.commit() return True</span></span></code> </pre><br><br>  An example of a real add function: <br><pre> <code class="django hljs"><span class="xml"><span class="xml">@transaction.commit_manually def insert_region_price(item_prices): """     """ from idea.catalog.models import CatalogItemInfo try: for ip in item_prices: CatalogItemInfo.objects.create(**ip) except Exception, e: print e transaction.rollback() return False else: transaction.commit() return True</span></span></code> </pre><br>  Knowing these moments, you can build effective applications using Django ORM, and not get into the SQL code. <br><br><h5>  Answers on questions: </h5><br>  <b>Since such a dance has gone, then write when it is worth using ORM, and when it is not.</b>  (c) <a href="https://habrahabr.ru/users/lvo/" class="user_link">lvo</a> <br>  I think that ORM should be used whenever it is simple.  It is not necessary to fold on the shoulders of ORM, and even more so the base requests of the type: <pre> <code class="django hljs"><span class="xml"><span class="xml">User.objects.values('username', 'email').annotate(cnt=Count('id')).filter(cnt__gt=1).order_by('-cnt')</span></span></code> </pre><br>  Especially on HL-production.  Get for yourself a separate system server in which so be izgolaytes. <br>  If you are not able to write with simple ‚ÄúORM requests‚Äù, then change the algorithm for solving the problem. <br>  For example, the client in IM has filtering by characteristics, using regularizers.  Cool, flexible stuff, until there are so many visitors to the site.  Changed the approach, instead of the standard Client-ORM-Base-ORM-Client, rewrote to the Client-MongoDB-Python-Client.  Data in MongoDB is generated by means of the ORM on the system server.  As it was said before - HL cannot be achieved by ORM manipulations alone. <br><br>  <b>I wonder why Django.</b>  <b>What are the advantages of this framework (and its ORM) compared to other frameworks / technologies.</b>  (c) <a href="https://habrahabr.ru/users/anjensan/" class="user_link">anjensan</a> <br>  Historically.  Python began to study with Django.  And the knowledge in the technology of its use I bring to the maximum.  Now in a parallel study of Pyramid.  I can while compare only with PHP, and their frameworks, CMS.  Probably I will say a common phrase - <b>I spent my time inefficiently when I wrote in PHP</b> . <br>  Now I can name a couple of serious flaws in Django 1.3.4: <br><ol><li>  Constant connection / disconnection with the base (corrected in older versions) </li><li>  The speed of the template-processor.  According to the tests found in the network, it is sufficiently small.  Need to change :) </li></ol><br>  In general, there is one cool technique, how to increase the speed of the generation of the template-processor. <br>  Never pass variables to a template through <b>locals ()</b> - with volumetric functions and intermediate variables - you will get a silent slowly moving dying monster :) <br><br>  <b>What kind of programmer is it that makes it difficult to write a SQL query?</b>  (c) <a href="https://habrahabr.ru/users/andreynikishaev/" class="user_link">andreynikishaev</a> <br>  A programmer who values ‚Äã‚Äãhis time on the program code, and not on the means of interaction between the Base-Code data processing.  You need to know SQL - very often I work directly with the database console.  But in the code - ORM.  ORM is easier and faster subject to change, or addition.  And also, if you write reasonably light queries, it is easy to read and understand. <br><br>  <b>Sorry, everyone!</b>  (Blah blah ... waiting for comments, suggestions, questions, suggestions) </div><p>Source: <a href="https://habr.com/ru/post/175727/">https://habr.com/ru/post/175727/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175715/index.html">SharePoint Webinar: Automate Document and Information Management</a></li>
<li><a href="../175717/index.html">Blind Deconvolution - automatic recovery of blurred images</a></li>
<li><a href="../175719/index.html">Stylish CSS switch without javascript</a></li>
<li><a href="../175723/index.html">Sale RPG hits on GOG: Baldur's Gate, Neverwinter Nights and more</a></li>
<li><a href="../175725/index.html">Functional Connected Lists</a></li>
<li><a href="../175731/index.html">CubieBoard is expensive, Raspberry Pi is rather weak, or where can I get SoC with a GPIO better and cheaper</a></li>
<li><a href="../175733/index.html">Recycling CRT Monitors and TVs</a></li>
<li><a href="../175735/index.html">Finch is a console client for instant messaging.</a></li>
<li><a href="../175737/index.html">The new skype-trojan turns a computer into a slave who mines Bitcoin</a></li>
<li><a href="../175739/index.html">French intelligence forced Wikipedia sysop to delete article</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>