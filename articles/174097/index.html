<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configurable authorization in Asp.Net MVC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habrayuzer! I would like to share with the community my little development experience on the ASP.NET MVC framework. Namely, a very important part o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configurable authorization in Asp.Net MVC</h1><div class="post__text post__text-html js-mediator-article">  Hi Habrayuzer!  I would like to share with the community my little development experience on the ASP.NET MVC framework.  Namely, a very important part of user authentication in the application.  As well as the implementation of a security system based on roles. <br>  This article will most likely be useful to novice programmers using ASP.NET MVC as a development platform.  But it is also possible for ‚Äúexperienced‚Äù (experienced) users to find some ideas for themselves.  Criticism, suggestions and the like are welcome.  All interested in asking under the cat. <br><a name="habracut"></a><br>  So, our goal is to write custom (custom) authentication, with a small role-based security system.  It will not require changes or additions to the application domain model.  The main requirement is any hint at users and the role system.  We will not consider and even use the standard security system based on membership providers.  It seems to me not at all convenient.  Its main disadvantage is the need for a specific data scheme, which is often difficult to associate with the application domain. <br><br><h3>  A bit of theory. </h3><br>  Let's start with a small theoretical part.  In the ASP.NET MVC platform, there are several types of authentication provided out of the box. <br><br><ul><li>  Windows Authentication (Windows Authentication) - one example is users added to the AD tree.  All checks are done directly by AD, using IIS, through a special provider.  This authentication is often used for enterprise applications; </li><li>  Password Authentication (Password Authentication) - a centralized authentication service offered by Microsoft; </li><li>  Form Authentication - form authentication data is suitable for applications accessible via the Internet. It works through client redirection, to the specified html page, with an authorization form.  On the form, the client enters their credentials and sends them to the server, where they are processed by application-specific logic.  This is the kind of authentication we will write. </li></ul><br>  In a client-side form authentication, it stores an encrypted cookie set.  The cookie is transmitted in requests to the server, indicating that the user is authorized.  To create such an encrypted set, in standard form authentication, use the Encript method in the System.Web.Security.FormAuthentication class.  Decrypt is used for decoding.  What is the FormAuthentication class good for?  In that its encoding and decoding methods encrypt and sign data using the server's server keys.  Without these keys, the information from the cookie cannot be read or modified, and we do not need to reinvent the wheel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Project implementation </h3><br>  Let's start by creating a user identification class that will be available through the security information of the current Http HttpContext.User.Identity request. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-comment"><span class="hljs-comment">//TAccount -     . //TRole -  . public abstract class AbstractIdentity&lt;TAccount, TRole&gt;: MarshalByRefObject, IIdentity { protected AbstractIdentity() { Id = long.MinValue; } private bool _isInitialized = false; public long Id { get; set; } public string Name { get; set; } public string AuthenticationType { get { return String.Format("CustomizeAuthentication_{0}", typeof(TAccount).Name); } } public string[] Role { get; set; } public TRole[] Roles { get; set; } public bool IsAuthenticated { get { return Id != long.MinValue; } } public bool CheckRole(TRole role) { return Role.All(r =&gt; r.Equals(role.ToString())); } public void SetAccount(TAccount account) { Id = GetId(account); Name = GetName(account); Roles = GetRole(account); Role = Roles.Select(c=&gt;c.ToString()).ToArray(); InitializeMoreFields(account); _isInitialized = true; } protected virtual void InitializeMoreFields(TAccount account) { } protected abstract long GetId(TAccount account); protected abstract string GetName(TAccount account); protected abstract TRole[] GetRole(TAccount account); public string Serialize() { if (!_isInitialized) throw new AccountNotSetException(); using (var stream = new MemoryStream()) { var formatter = new XmlSerializer(GetType()); formatter.Serialize(stream, this); return Encoding.UTF8.GetString(stream.ToArray()); } } public static TIdenty Deserialize&lt;TIdenty&gt;(string value) where TIdenty : AbstractIdentity&lt;TAccount, TRole&gt; { using (var stream = new MemoryStream(Encoding.UTF8.GetBytes(value))) { var formatter = new XmlSerializer(typeof(TIdenty)); return (TIdenty)formatter.Deserialize(stream); } } }</span></span></code> </pre> <br></div></div><br>  Next, we implement an abstract HTTP authentication module.  In which we subscribe to the AuthenticateRequest event, which occurs after passing the user's authentication.  In the implementation of the signed method, we decade the cookie by creating and writing the user to the current HTTP request. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//TIdenty -      //TAccount -     . //TRole -  . public abstract class AbstractAutentificationModule&lt;TIdenty, TAccount, TRole&gt; : IHttpModule where TIdenty : AbstractIdentity&lt;TAccount, TRole&gt; { public void Init(HttpApplication context) { context.AuthenticateRequest += OnAuthenticateRequest; } private static void OnAuthenticateRequest(object sender, EventArgs e) { var application = (HttpApplication)sender; var context = application.Context; if (context.User != null &amp;&amp; context.User.Identity.IsAuthenticated) return; var cookieName = FormsAuthentication.FormsCookieName; var cookie = application.Request.Cookies[cookieName.ToUpper()]; if (cookie == null) return; try { var ticket = FormsAuthentication.Decrypt(cookie.Value); var identity = AbstractIdentity&lt;TAccount, TRole&gt;.Deserialize&lt;TIdenty&gt;(ticket.UserData); var principal = new GenericPrincipal(identity, identity.Role); context.User = principal; Thread.CurrentPrincipal = principal; } catch {} } public void Dispose() {} }</span></span></code> </pre><br></div></div><br>  Implementing an abstract authorization service.  Records data of the authorized user in the cookie.  Add it to the HTTP request. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//TAccount -     . public interface IAuthorizeService&lt;in TAccount&gt; { void SignIn(TAccount account, bool createPersistentCookie); void SignOut(); } //TIdenty -     //TAccount -     . //TRole -  . public abstract class AbstractAuthorizeService&lt;TIdentity, TAccount, TRole&gt; : IAuthorizeService&lt;TAccount&gt; where TIdentity : AbstractIdentity&lt;TAccount, TRole&gt;, new() { private const int TICKET_VERSION = 1; private const int EXPIRATION_MINUTE = 60; public void SignIn(TAccount account, bool createPersistentCookie) { var accountIdentity = CreateIdentity(account); var authTicket = new FormsAuthenticationTicket(TICKET_VERSION, accountIdentity.Name, DateTime.Now, DateTime.Now.AddMinutes(EXPIRATION_MINUTE), createPersistentCookie, accountIdentity.Serialize()); CreateCookie(authTicket); HttpContext.Current.User = new GenericPrincipal(accountIdentity, accountIdentity.Role); } private TIdentity CreateIdentity(TAccount account) { var accountIdentity = new TIdentity(); accountIdentity.SetAccount(account); return accountIdentity; } private void CreateCookie(FormsAuthenticationTicket ticket) { var authCookie = new HttpCookie(FormsAuthentication.FormsCookieName, FormsAuthentication.Encrypt(ticket)) { Expires = DateTime.Now.Add(FormsAuthentication.Timeout), }; HttpContext.Current.Response.Cookies.Add(authCookie); } public void SignOut() { FormsAuthentication.SignOut(); } }</span></span></code> </pre><br></div></div><br>  Do not forget about the security system.  To do this, we implement the authentication attribute, to which we will transfer the roles and rules necessary for accessing the controller method.  Since attributes do not support Generic, we delegate the creation of rules to another class (RuleFactory). <br>  The IRule interface describes an authentication verification rule. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRule</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Check</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IIdentity user</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//     //TIdenty -     //TAccount -     . //TRole -  . internal class Rule&lt;TIdentity, TAccount, TRole&gt; : IRule where TIdentity : AbstractIdentity&lt;TAccount, TRole&gt; { private readonly Func&lt;TIdentity, bool&gt; _check; public Rule(Func&lt;TIdentity, bool&gt; check) { if (check == null) throw new ArgumentNullException("check"); _check = check; } public bool Check (IIdentity user) { return _check((TIdentity) user); } } //  //TIdenty -     //TAccount -     . //TRole -  . public class RuleFactory&lt;TIdentity, TAccount, TRole&gt; where TIdentity : AbstractIdentity&lt;TAccount, TRole&gt; { public IRule Create(Func&lt;TIdentity, bool&gt; rule) { return new Rule&lt;TIdentity, TAccount, TRole&gt; (rule); } } //  public abstract class AbstractAutintificateAttribute : AuthorizeAttribute { private readonly ICollection&lt;IRule&gt; _rules = new List&lt;IRule&gt; (); private readonly bool _isNotSimpleAuthentication; protected AbstractAutintificateAttribute(bool isNotSimpleAuthentication) { _isNotSimpleAuthentication = isNotSimpleAuthentication; } protected void AddRule(IRule rule) { if (rule == null) throw new ArgumentNullException ("rule"); _rules.Add (rule); } protected override bool AuthorizeCore(HttpContextBase httpContext) { if (httpContext == null) throw new ArgumentNullException("httpContext"); if (httpContext.User == null || !httpContext.User.Identity.IsAuthenticated) return false; var isAuthorize = false; isAuthorize |= _rules.Any(rule =&gt; rule.Check(httpContext.User.Identity)); isAuthorize |= httpContext.Request.IsAuthenticated &amp;&amp; !_isNotSimpleAuthentication; return isAuthorize; } protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext) { var context = filterContext.HttpContext; var appPath = context.Request.ApplicationPath == "/" ? string.Empty : context.Request.ApplicationPath; var loginUrl = FormsAuthentication.LoginUrl; var path = HttpUtility.UrlEncode(context.Request.Url.PathAndQuery); var url = String.Format("{0}{1}?ReturnUrl={2}", appPath, loginUrl, path); if (!filterContext.IsChildAction) filterContext.Result = new RedirectResult(url); } }</span></span></code> </pre><br></div></div><br>  For ease of use in their projects, we implement a basic abstract controller.  Which will provide convenient access to the current user. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//TIdenty -     //TAccount -     . //TRole -  . public abstract class AbstractController&lt;TIdenty, TAccount, TRole&gt; : Controller where TIdenty : AbstractIdentity&lt;TAccount, TRole&gt; { protected AbstractController() { _user = new Lazy&lt;TIdenty&gt;(() =&gt; HttpContext.User.Identity as TIdenty); } private readonly Lazy&lt;TIdenty&gt; _user; protected TIdenty CurrentUser { get { return _user.Value; } } }</span></span></code> </pre><br></div></div><br><h3>  Use example </h3><br>  Basically, all the implementation for a specific project is to prescribe the necessary generic types. <br>  The first thing we will start with in all projects is the implementation of the identification class. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExampleIdentity</span></span> : <span class="hljs-title"><span class="hljs-title">AbstractIdentity</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Account</span></span>, <span class="hljs-title"><span class="hljs-title">Role</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  .     protected override long GetId(Account account) { return account.Id; } //  .   () protected override string GetName(Account account) { return account.Login; } //  .     protected override Role[] GetRole(Account account) { return new []{ account.Role }; } // .        .     protected override void InitializeMoreFields(Account account) { Email = account.Email; } }</span></span></code> </pre><br></div></div><br>  Implementation of the Authentication Module <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExampleAutintificateModule</span></span> : <span class="hljs-title"><span class="hljs-title">AbstractAutentificationModule</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ExampleIdentity</span></span>, <span class="hljs-title"><span class="hljs-title">Account</span></span>, <span class="hljs-title"><span class="hljs-title">Role</span></span>&gt; { }</code> </pre><br>  We are not forgetting to add your authorization module to Web.config, and change the authentication type there. <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.web</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpModules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remove</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FormsAuthentication"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FormsAuthentication"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Example.Infrostructure.ExampleAutintificateModule"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">httpModules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authentication</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Forms"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--loginUrl     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">forms</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loginUrl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/User/Login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timeout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2880"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authentication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.web</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.webServer</span></span></span><span class="hljs-tag">&gt;</span></span> .... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">runAllManagedModulesForAllRequests</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remove</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FormsAuthentication"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FormsAuthentication"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Example.Infrostructure.ExampleAutintificateModule"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.webServer</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  An example of an authorization service. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExampleAuthorizeService</span></span> : <span class="hljs-title"><span class="hljs-title">AbstractAuthorizeService</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ExampleIdentity</span></span>, <span class="hljs-title"><span class="hljs-title">Account</span></span>, <span class="hljs-title"><span class="hljs-title">Role</span></span>&gt; { }</code> </pre><br></div></div><br>  Basic controller for the current project <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExampleController</span></span> : <span class="hljs-title"><span class="hljs-title">AbstractController</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ExampleIdentity</span></span>, <span class="hljs-title"><span class="hljs-title">Account</span></span>, <span class="hljs-title"><span class="hljs-title">Role</span></span>&gt; { }</code> </pre><br></div></div><br>  Well, we implement the attribute with the rules of authentication <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  public class ExampleRuleFactory : RuleFactory&lt;ExampleIdentity, Account, Role&gt; { } //     . public class ExampleAuthintificationAtribute : AbstractAutintificateAttribute { private readonly ExampleRuleFactory _ruleFactory = new ExampleRuleFactory(); public ExampleAuthintificationAtribute(params Role[] allowedRole) : base(allowedRole.Any()) { //    ,        AddRule(_ruleFactory.Create(account =&gt; allowedRole.Intersect(account.Roles).Any())); //  ,      AddRule(_ruleFactory.Create(account =&gt; account.Roles.Any(c=&gt;c == Role.Admin))); } }</span></span></code> </pre><br></div></div><br><h3>  Conclusion </h3><br>  For convenience, I created a nugget-package library, which can be installed with the following command: <br><pre> <code class="cs hljs">Install-Package MvcCustomizableFormAuthentication</code> </pre><br>  The repository with the project is on <a href="https://github.com/nomit007/MvcCustomizableFormAuthentication">github</a> , there is an example of a working application. <br>  Thank you all for your time.  Waiting for advice, criticism, suggestions. <br>  <b>PS</b> Unforgettable about unit testing. </div><p>Source: <a href="https://habr.com/ru/post/174097/">https://habr.com/ru/post/174097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174085/index.html">IBM has come up with an ionic transistor</a></li>
<li><a href="../174089/index.html">Online broadcast via Nginx-RTMP: several ready-made recipes</a></li>
<li><a href="../174091/index.html">JSonCmp - we compare in JavaScript correctly</a></li>
<li><a href="../174093/index.html">Dropbox: New Albums Feature</a></li>
<li><a href="../174095/index.html">New in 2013 already in Russia</a></li>
<li><a href="../174099/index.html">SharePoint 2013 Application Development with TypeScript</a></li>
<li><a href="../174103/index.html">Ruby on Rails Application Development in Visual Studio</a></li>
<li><a href="../174109/index.html">Writing a SOAP client in C ++ using gSOAP</a></li>
<li><a href="../174111/index.html">Setting up IPTV Beeline via WiFi using Mikrotik routers</a></li>
<li><a href="../174115/index.html">Splitting a continuous data stream into structural units</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>