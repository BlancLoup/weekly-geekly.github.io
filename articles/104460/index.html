<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Displaying the status of servers from Zabbix to the desktop</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Zabbix monitoring system provides excellent monitoring capabilities for servers running AIX, Linux, * BSD, Windows, Mac OS X, network equipment, W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Displaying the status of servers from Zabbix to the desktop</h1><div class="post__text post__text-html js-mediator-article"> The <a href="http://www.zabbix.org/">Zabbix</a> monitoring system provides excellent monitoring capabilities for servers running AIX, Linux, * BSD, Windows, Mac OS X, network equipment, Web applications, as well as any piece of hardware that supports SNMP or at least responds to ping.  Zabbix is ‚Äã‚Äãfree and is licensed under the GPL.  The server part of the system is installed only under * nix. <br>  You can configure sending notifications to email, jabber, sms when unwanted events occur, such as server crashes, excessive CPU usage, lack of disk space, etc.  There is also a web interface with beautiful graphs and a network map. <br>  But the sysadmin, as you know, is a lazy creature.  Therefore, in order not to constantly climb into the web interface, it is advisable to bring some graphics and a network map directly to his desktop. <br><br><img src="http://itolimp.no-ip.org/misc/desktop.png" alt="Handyman table"><br><br>  In this article, we consider Windows XP / 7 as a client machine, but by briefly finishing the script, you can also use it in Linux. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  <b>Principle of operation:</b> <br>  Zabbix creates the necessary graphics and network map that we want to display on the screen.  The PHP script calls Zabbix once a minute, receives these images from it and generates one of them for the desktop.  The picture is placed on a web server.  Another script on the client machine periodically downloads this image and sets it as wallpaper. <br><br>  <b>Step 0. Install and configure Zabbix.</b> <br>  This question is already chewed in the <a href="http://www.zabbix.com/documentation/">documentation</a> , we will not dwell on it. <br>  The article uses version 1.8.2.  In earlier versions, other image addresses are used, so if you have Zabbix 1.4 or 1.6, you will need to make adjustments to the script. <br><br>  <b>Step 1. Create the necessary graphics and network maps in Zabbix.</b> <br>  This step also should not cause difficulties. <br>  Charts can be created on the <i>Configuration - Hosts</i> page, network maps - in <i>Maps</i> . <br><br>  <b>Step 2. We write a script that generates a desktop background image.</b> <br>  We use PHP, the extension with .URL to get images, the gd library and ImageMagick for working with images. <br>  You must first create a user in Zabbix, under which the script will log into the system. <br>  The script will also receive a graph of the download of the WAN interface of the router from <a href="http://www.cacti.net/">cacti</a> and the image from the webcam in the server room.  The graph in cacti seems more visual than the Zabbix graph. <br>  The result of the script will be a BMP file. <br><br>  The script does not claim to universality, but it is easy to remake to fit your needs.  Be sure to change the values ‚Äã‚Äãof the constants at the beginning of the file to the settings for your system. <br><br><blockquote> <code><font color="#000000">&lt;?php</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">// ,     !</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">//1.    </font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'TMP_PATH'</font> <font color="#339933">,</font> <font color="#0000ff">'/usr/local/share/zabbix/php/tmp/'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//2. URL - Zabbix</font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'ZABBIX_URL'</font> <font color="#339933">,</font> <font color="#0000ff">'http://monitoring.local/'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//3.   Zabbix</font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'ZABBIX_USER'</font> <font color="#339933">,</font> <font color="#0000ff">'mon'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//4.   Zabbix</font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'ZABBIX_PW'</font> <font color="#339933">,</font> <font color="#0000ff">'qwerty'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//5.   Cacti</font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'CACTI_URL'</font> <font color="#339933">,</font> <font color="#0000ff">'http://monitoring.local/cacti/'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//6.   Cacti</font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'CACTI_USER'</font> <font color="#339933">,</font> <font color="#0000ff">'admin'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//7.   Cacti</font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'CACTI_PW'</font> <font color="#339933">,</font> <font color="#0000ff">'qwerty'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//8.     </font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'WALLPAPER_WIDTH'</font> <font color="#339933">,</font> <font color="#cc66cc">1280</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//9.     </font> &lt;br/&gt; <br> <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'WALLPAPER_HEIGHT'</font> <font color="#339933">,</font> <font color="#cc66cc">1024</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//10. ,       .</font> &lt;br/&gt; <br> <font color="#666666">//    .</font> &lt;br/&gt; <br> <font color="#000088">$resources</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">// </font> &lt;br/&gt; <br> <font color="#000088">$resources</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'url'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'http://monitoring.local/map.php?noedit=1&amp;sysmapid=2'</font> <font color="#339933">,</font> <font color="#0000ff">'x'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">280</font> <font color="#339933">,</font> <font color="#0000ff">'y'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">// </font> &lt;br/&gt; <br> <font color="#000088">$resources</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'url'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'http://monitoring.local/chart2.php?graphid=494&amp;width=1138&amp;period=86400'</font> <font color="#339933">,</font> <font color="#0000ff">'x'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">26</font> <font color="#339933">,</font> <font color="#0000ff">'y'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">400</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//-</font> &lt;br/&gt; <br> <font color="#000088">$resources</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'url'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'http://192.168.4.18/axis-cgi/jpg/image.cgi?resolution=320x240'</font> <font color="#339933">,</font> <font color="#0000ff">'x'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">960</font> <font color="#339933">,</font> <font color="#0000ff">'y'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">690</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#666666">//  cacti</font> &lt;br/&gt; <br> <font color="#000088">$resources</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'url'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'http://monitoring.local/cacti/graph_image.php?local_graph_id=5&amp;rra_id=0&amp;view_type=tree&amp;graph_start='</font> <font color="#339933">.</font> <font color="#009900">(</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-</font> <font color="#cc66cc">86400</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">'&amp;graph_end='</font> <font color="#339933">.</font> <font color="#990000">time</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#0000ff">'x'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">357</font> <font color="#339933">,</font> <font color="#0000ff">'y'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">690</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">// </font> &lt;br/&gt; <br> <font color="#666666">//    ,    ,   .</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000088">$error</font> <font color="#339933">=</font> <font color="#009900">false</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">//""   Zabbix</font> &lt;br/&gt; <br> <font color="#000088">$ch</font> <font color="#339933">=</font> <font color="#990000">curl_init</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_URL <font color="#339933">,</font> ZABBIX_URL <font color="#339933">.</font> <font color="#0000ff">'/index.php'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_POST <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_POSTFIELDS <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'form'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'1'</font> <font color="#339933">,</font> <font color="#0000ff">'form_refresh'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'1'</font> <font color="#339933">,</font> <font color="#0000ff">'name'</font> <font color="#339933">=&gt;</font> ZABBIX_USER <font color="#339933">,</font> <font color="#0000ff">'password'</font> <font color="#339933">=&gt;</font> ZABBIX_PW <font color="#339933">,</font> <font color="#0000ff">'enter'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'Enter'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_RETURNTRANSFER <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_FOLLOWLOCATION <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_COOKIEJAR <font color="#339933">,</font> <font color="#0000ff">"./cookie.txt"</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#666666">//   </font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_COOKIEFILE <font color="#339933">,</font> <font color="#0000ff">"./cookie.txt"</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000088">$t</font> <font color="#339933">=</font> <font color="#990000">curl_exec</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_close</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">//""   cacti.   ,     cacti</font> &lt;br/&gt; <br> <font color="#000088">$ch</font> <font color="#339933">=</font> <font color="#990000">curl_init</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_URL <font color="#339933">,</font> CACTI_URL <font color="#339933">.</font> <font color="#0000ff">'/graph_image.php'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_POST <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_POSTFIELDS <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'action'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'login'</font> <font color="#339933">,</font> <font color="#0000ff">'login_username'</font> <font color="#339933">=&gt;</font> CACTI_USER <font color="#339933">,</font> <font color="#0000ff">'login_password'</font> <font color="#339933">=&gt;</font> CACTI_PW <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_RETURNTRANSFER <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_FOLLOWLOCATION <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_COOKIEJAR <font color="#339933">,</font> <font color="#0000ff">"./cookie.txt"</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_COOKIEFILE <font color="#339933">,</font> <font color="#0000ff">"./cookie.txt"</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000088">$t</font> <font color="#339933">=</font> <font color="#990000">curl_exec</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_close</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">// </font> &lt;br/&gt; <br> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$resources</font> <font color="#b1b100">as</font> <font color="#000088">$k</font> <font color="#339933">=&gt;</font> <font color="#000088">$res</font> <font color="#009900">)</font> &lt;br/&gt; <br> <font color="#009900">{</font> &lt;br/&gt; <br> <font color="#000088">$ch</font> <font color="#339933">=</font> <font color="#990000">curl_init</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_URL <font color="#339933">,</font> <font color="#000088">$res</font> <font color="#009900">[</font> <font color="#0000ff">'url'</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_RETURNTRANSFER <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_COOKIEJAR <font color="#339933">,</font> <font color="#0000ff">"./cookie.txt"</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_setopt</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#339933">,</font> CURLOPT_COOKIEFILE <font color="#339933">,</font> <font color="#0000ff">"./cookie.txt"</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000088">$file</font> <font color="#339933">=</font> <font color="#990000">curl_exec</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$file</font> <font color="#009900">)</font> <font color="#990000">file_put_contents</font> <font color="#009900">(</font> TMP_PATH <font color="#339933">.</font> <font color="#0000ff">'temp_img'</font> <font color="#339933">.</font> <font color="#000088">$k</font> <font color="#339933">.</font> <font color="#0000ff">'.tmp'</font> <font color="#339933">,</font> <font color="#000088">$file</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#b1b100">else</font> <font color="#000088">$error</font> <font color="#339933">=</font> <font color="#009900">true</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">curl_close</font> <font color="#009900">(</font> <font color="#000088">$ch</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#009900">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">// ""   </font> &lt;br/&gt; <br> <font color="#000088">$wp</font> <font color="#339933">=</font> <font color="#990000">imagecreatetruecolor</font> <font color="#009900">(</font> WALLPAPER_WIDTH <font color="#339933">,</font> WALLPAPER_HEIGHT <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$error</font> <font color="#009900">)</font> &lt;br/&gt; <br> <font color="#009900">{</font> &lt;br/&gt; <br> <font color="#666666">//  </font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">//  </font> &lt;br/&gt; <br> <font color="#000088">$bg</font> <font color="#339933">=</font> <font color="#990000">imagecolorallocate</font> <font color="#009900">(</font> <font color="#000088">$wp</font> <font color="#339933">,</font> <font color="#cc66cc">58</font> <font color="#339933">,</font> <font color="#cc66cc">110</font> <font color="#339933">,</font> <font color="#cc66cc">165</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">imagefill</font> <font color="#009900">(</font> <font color="#000088">$wp</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$bg</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">// </font> &lt;br/&gt; <br> <font color="#000088">$images</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$resources</font> <font color="#b1b100">as</font> <font color="#000088">$k</font> <font color="#339933">=&gt;</font> <font color="#000088">$res</font> <font color="#009900">)</font> &lt;br/&gt; <br> <font color="#009900">{</font> &lt;br/&gt; <br> <font color="#000088">$im</font> <font color="#339933">=</font> imagecreatefromfile <font color="#009900">(</font> TMP_PATH <font color="#339933">.</font> <font color="#0000ff">'temp_img'</font> <font color="#339933">.</font> <font color="#000088">$k</font> <font color="#339933">.</font> <font color="#0000ff">'.tmp'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$im</font> <font color="#009900">)</font> &lt;br/&gt; <br> <font color="#009900">{</font> &lt;br/&gt; <br> <font color="#000088">$error</font> <font color="#339933">=</font> <font color="#009900">true</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#b1b100">break</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#009900">}</font> &lt;br/&gt; <br> <font color="#990000">imagecopy</font> <font color="#009900">(</font> <font color="#000088">$wp</font> <font color="#339933">,</font> <font color="#000088">$im</font> <font color="#339933">,</font> <font color="#000088">$res</font> <font color="#009900">[</font> <font color="#0000ff">'x'</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#000088">$res</font> <font color="#009900">[</font> <font color="#0000ff">'y'</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#990000">imagesx</font> <font color="#009900">(</font> <font color="#000088">$im</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#990000">imagesy</font> <font color="#009900">(</font> <font color="#000088">$im</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">imagedestroy</font> <font color="#009900">(</font> <font color="#000088">$im</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#009900">}</font> &lt;br/&gt; <br> <font color="#990000">imagepng</font> <font color="#009900">(</font> <font color="#000088">$wp</font> <font color="#339933">,</font> TMP_PATH <font color="#339933">.</font> <font color="#0000ff">'temp_fin.png'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#009900">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$error</font> <font color="#009900">)</font> &lt;br/&gt; <br> <font color="#009900">{</font> &lt;br/&gt; <br> <font color="#666666">//  ,     </font> &lt;br/&gt; <br> <font color="#000088">$bg</font> <font color="#339933">=</font> <font color="#990000">imagecolorallocate</font> <font color="#009900">(</font> <font color="#000088">$wp</font> <font color="#339933">,</font> <font color="#cc66cc">192</font> <font color="#339933">,</font> <font color="#cc66cc">192</font> <font color="#339933">,</font> <font color="#cc66cc">192</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#990000">imagefill</font> <font color="#009900">(</font> <font color="#000088">$wp</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#000088">$bg</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#009900">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">//  PNG   BMP   ImageMagick</font> &lt;br/&gt; <br> <font color="#000088">$imgk</font> <font color="#339933">=</font> <font color="#000000">new</font> Imagick <font color="#009900">(</font> TMP_PATH <font color="#339933">.</font> <font color="#0000ff">'temp_fin.png'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#000088">$imgk</font> <font color="#339933">-&gt;</font> <font color="#004000">pingImage</font> <font color="#009900">(</font> TMP_PATH <font color="#339933">.</font> <font color="#0000ff">'temp_fin.png'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#000088">$imgk</font> <font color="#339933">-&gt;</font> <font color="#004000">readImage</font> <font color="#009900">(</font> TMP_PATH <font color="#339933">.</font> <font color="#0000ff">'temp_fin.png'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#000088">$imgk</font> <font color="#339933">-&gt;</font> <font color="#004000">setImageCompression</font> <font color="#009900">(</font> imagick <font color="#339933">::</font> <font color="#004000">COMPRESSION_NO</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#000088">$imgk</font> <font color="#339933">-&gt;</font> <font color="#004000">setImageFormat</font> <font color="#009900">(</font> <font color="#0000ff">"bmp"</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#000088">$imgk</font> <font color="#339933">-&gt;</font> <font color="#004000">writeImage</font> <font color="#009900">(</font> TMP_PATH <font color="#339933">.</font> <font color="#0000ff">'wp.bmp'</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#666666">//          php.net</font> &lt;br/&gt; <br> <font color="#000000">function</font> imagecreatefromfile <font color="#009900">(</font> <font color="#000088">$path</font> <font color="#009900">)</font> &lt;br/&gt; <br> <font color="#009900">{</font> &lt;br/&gt; <br> <font color="#000088">$info</font> <font color="#339933">=</font> <font color="#339933">@</font> <font color="#990000">getimagesize</font> <font color="#009900">(</font> <font color="#000088">$path</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$info</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000088">$functions</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> &lt;br/&gt; <br> IMAGETYPE_GIF <font color="#339933">=&gt;</font> <font color="#0000ff">'imagecreatefromgif'</font> <font color="#339933">,</font> &lt;br/&gt; <br> IMAGETYPE_JPEG <font color="#339933">=&gt;</font> <font color="#0000ff">'imagecreatefromjpeg'</font> <font color="#339933">,</font> &lt;br/&gt; <br> IMAGETYPE_PNG <font color="#339933">=&gt;</font> <font color="#0000ff">'imagecreatefrompng'</font> <font color="#339933">,</font> &lt;br/&gt; <br> IMAGETYPE_WBMP <font color="#339933">=&gt;</font> <font color="#0000ff">'imagecreatefromwbmp'</font> <font color="#339933">,</font> &lt;br/&gt; <br> IMAGETYPE_XBM <font color="#339933">=&gt;</font> <font color="#0000ff">'imagecreatefromwxbm'</font> <font color="#339933">,</font> &lt;br/&gt; <br> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$functions</font> <font color="#009900">[</font> <font color="#000088">$info</font> <font color="#009900">[</font> <font color="#cc66cc">2</font> <font color="#009900">]</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">function_exists</font> <font color="#009900">(</font> <font color="#000088">$functions</font> <font color="#009900">[</font> <font color="#000088">$info</font> <font color="#009900">[</font> <font color="#cc66cc">2</font> <font color="#009900">]</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#000088">$functions</font> <font color="#009900">[</font> <font color="#000088">$info</font> <font color="#009900">[</font> <font color="#cc66cc">2</font> <font color="#009900">]</font> <font color="#009900">]</font> <font color="#009900">(</font> <font color="#000088">$path</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#009900">}</font> &lt;br/&gt; <br> <font color="#000000">?&gt;</font></code> </blockquote> <br><br>  <b>Step 3. Add the script to cron.</b> <br>  It is advisable to store the script in a directory that is not published on the site.  Otherwise, the script can be run from the browser, and the cookie file can be dragged off. <br>  Add the script to cron: <br> <code># echo "*/1 * * * * root /usr/local/bin/php /usr/local/share/zabbix/get_image.php &gt; /dev/null 2&gt;&amp;1" &gt;&gt; /etc/crontab</code> <br>  Zabbix, by default, updates the data every 30 seconds, so you can update the image once a minute. <br><br>  <b>Step 4. Install the automatic wallpaper change script on the client machine.</b> <br>  Create a VBS script: <br>  <b><i>For Windows XP</i></b> <br><blockquote> <code><font color="#000080">Dim</font> res&lt;br/&gt; <br> <font color="#000080">Set</font> oXMLHTTP = CreateObject( <font color="#800000">"MSXML2.XMLHTTP"</font> ) &lt;br/&gt; <br> oXMLHTTP. <font color="#000080">Open</font> <font color="#800000">"GET"</font> , <font color="#800000">"http://monitoring.local/tmp/wp.bmp"</font> , 0 <font color="#008000">'  &lt;br/&gt; <br></font> oXMLHTTP.Send&lt;br/&gt; <br> <font color="#000080">On</font> <font color="#000080">Error</font> <font color="#000080">Goto</font> 0 &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000080">Set</font> oADOStream = CreateObject( <font color="#800000">"ADODB.Stream"</font> ) &lt;br/&gt; <br> oADOStream.Mode = 3 &lt;br/&gt; <br> oADOStream. <font color="#000080">Type</font> = 1 &lt;br/&gt; <br> oADOStream. <font color="#000080">Open</font> &lt;br/&gt; <br> oADOStream.Write oXMLHTTP.responseBody &lt;br/&gt; <br> oADOStream.SaveToFile <font color="#800000">"C:\\wp.bmp"</font> , 2 <font color="#008000">'  &lt;br/&gt; <br></font> <font color="#000080">Set</font> oXMLHTTP = <font color="#000080">Nothing</font> &lt;br/&gt; <br> <font color="#000080">Set</font> oADOStream = <font color="#000080">Nothing</font> &lt;br/&gt; <br> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000080">Dim</font> WshShell&lt;br/&gt; <br> <font color="#000080">Set</font> WshShell = WScript.CreateObject( <font color="#800000">"Wscript.Shell"</font> )&lt;br/&gt; <br> WshShell.RegWrite <font color="#800000">"HKCU\Control Panel\Desktop\Wallpaper"</font> , <font color="#800000">""</font> <font color="#800000">"C:\\wp.bmp"</font> <font color="#800000">""</font> &lt;br/&gt; <br> WshShell.Run <font color="#800000">"%windir%\System32\RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters"</font> , 1, <font color="#000080">True</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#000080">Set</font> WshShell = <font color="#000080">Nothing</font></code> </blockquote> <br><br>  <i><b>Windows Vista / Windows 7</b></i> <br>  Here the situation is more complicated.  To change the wallpaper you need to call the WinAPI function.  VBScript cannot do this, so we will have to write a small program in C ++. <br>  The idea is taken <a href="http://shovellingwater.wordpress.com/2010/04/07/windows-7-time-dependant-desktop-background/">from here</a> . <br>  At the end of the article there is a link to the compiled exe-schnick, but just in case I cite the source code: <br><blockquote> <code><font color="#339900">#include &lt;windows.h&gt;</font> &lt;br/&gt; <br> <font color="#339900">#include &lt;stdio.h&gt;</font> &lt;br/&gt; <br> <font color="#339900">#include &lt;iostream&gt;</font> &lt;br/&gt; <br> <font color="#0000ff">int</font> main <font color="#008000">(</font> <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> <font color="#000040">**</font> argv <font color="#008000">)</font> &lt;br/&gt; <br> <font color="#008000">{</font> &lt;br/&gt; <br> <font color="#0000ff">if</font> <font color="#008000">(</font> argc <font color="#000080">==</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#0000ff">return</font> <font color="#0000dd">1</font> <font color="#008080">;</font> &lt;br/&gt; <br> SystemParametersInfo <font color="#008000">(</font> SPI_SETDESKWALLPAPER, <font color="#0000dd">0</font> , <font color="#008000">(</font> PVOID <font color="#008000">)</font> argv <font color="#008000">[</font> <font color="#0000dd">1</font> <font color="#008000">]</font> , SPIF_UPDATEINIFILE <font color="#000040">|</font> SPIF_SENDCHANGE <font color="#008000">)</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#0000ff">return</font> <font color="#0000dd">0</font> <font color="#008080">;</font> &lt;br/&gt; <br> <font color="#008000">}</font> &lt;br/&gt; <br></code> </blockquote><br>  Now you need to replace the line in the VBS script for Windows XP <br> <code>WshShell.Run "%windir%\System32\RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters", 1, True</code> <br>  on <br> <code>WshShell.Run "C:\wallpaper.exe C:\wp.bmp", 1, True</code> <br> <br>  <b>Step 5. Add the VBS script to the task scheduler</b> <br>  It is necessary to run the script once a minute. <br><br>  <b>Done!</b> <br><br>  Project files - <a href="">zabbix_wallpaper.zip</a> . </div><p>Source: <a href="https://habr.com/ru/post/104460/">https://habr.com/ru/post/104460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../104452/index.html">Take a screenshot of the site yourself and give it to others</a></li>
<li><a href="../104454/index.html">Mad Driver. Second Championship ON-UP</a></li>
<li><a href="../104455/index.html">Canobuvosti, 57th edition</a></li>
<li><a href="../104458/index.html">HTML5 for web designers. Part 3: Multimedia</a></li>
<li><a href="../104459/index.html">Announcement of the announcement of improvements Nigma-mathematics</a></li>
<li><a href="../104461/index.html">Nitrified ...</a></li>
<li><a href="../104465/index.html">Seventeenth - 17 fixes</a></li>
<li><a href="../104466/index.html">New feature in Gmail Labs - improved video chat</a></li>
<li><a href="../104468/index.html">Your customers don't have to say so</a></li>
<li><a href="../104469/index.html">Robokassa's little surprises</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>