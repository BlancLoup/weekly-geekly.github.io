<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flask Mega-Tutorial, Part 3: Forms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the third article in the series, where I describe my experience of writing a Python web application using the Flask mic framework. 

 The purp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flask Mega-Tutorial, Part 3: Forms</h1><div class="post__text post__text-html js-mediator-article">  This is the third article in the series, where I describe my experience of writing a Python web application using the Flask mic framework. <br><br>  The purpose of this guide is to develop a fairly functional microblog application, which I decided to call microblog, in the absence of originality. <br><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text">  <a href="http://habrahabr.ru/post/193242/">Part 1: Hello, World!</a> <br>  <a href="http://habrahabr.ru/post/193260/">Part 2: Templates</a> <br>  <a href="http://habrahabr.ru/post/194062/">Part 3: Forms</a> <br>  <a href="http://habrahabr.ru/post/196810/">Part 4: Database</a> <br>  <a href="http://habrahabr.ru/post/222983/">Part 5: User Login</a> <br>  <a href="http://habrahabr.ru/post/223375/">Part 6: Profile Page and Avatars</a> <br>  <a href="http://habrahabr.ru/post/223783/">Part 7: Unit Testing</a> <br>  <a href="http://habrahabr.ru/post/230643/">Part 8: Subscribers, Contacts and Friends</a> <br>  <a href="http://habrahabr.ru/post/230897/">Part 9: Pagination</a> <br>  <a href="http://habrahabr.ru/post/234613/">Part 10: Full Text Search</a> <br>  <a href="http://habrahabr.ru/post/234737/">Part 11: Email Support</a> <br>  <a href="http://habrahabr.ru/post/234785/">Part 12: Reconstruction</a> <br>  <a href="http://habrahabr.ru/post/236753/">Part 13: Date and Time</a> <br>  <a href="http://habrahabr.ru/post/236861/">Part 14: I18n and L10n</a> <br>  <a href="http://habrahabr.ru/post/237065/">Part 15: Ajax</a> <br>  <a href="http://habrahabr.ru/post/237317/">Part 16: Debugging, Testing, and Profiling</a> <br>  <a href="http://habrahabr.ru/post/237489/">Part 17: Deploying to Linux (even to Raspberry Pi!)</a> <br>  <a href="http://habrahabr.ru/post/237517/">Part 18: Deploying to Heroku Cloud</a> <br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Brief repetition </h4><br>  In the previous section, we defined a simple template for the home page and used imaginary objects as prototypes of things that we don‚Äôt have yet.  For example, users or records. <br><br>  In this article we are going to fill one of the gaps that exist in our application.  We will consider working with forms. <br><br>  Forms are one of the most basic blocks in any web application.  Using forms will allow users to leave entries in the blog, as well as login to the application. <br><br>  To follow this part, your microblog application must be the way we left it at the end of the previous one.  Please make sure the application is installed and working. <br><a name="habracut"></a><br><br><h4>  Configuration </h4><br>  For form processing, we will use the <code>Flask-WTF</code> extension, which is a wrapper <code>WTForms</code> and integrates perfectly with Flask applications. <br><br>  Many Flask extensions require some configuration, so we will create a configuration file inside our microblog root folder, so it will be easily available for editing if needed.  This is where we begin (the config.py file): <br><pre> <code class="python hljs">CSRF_ENABLED = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> SECRET_KEY = <span class="hljs-string"><span class="hljs-string">'you-will-never-guess'</span></span></code> </pre><br><br>  It's simple, these are the two settings that our <code>Flask-WTF</code> extension needs.  <code>CSRF_ENABLED</code> activates the prevention of fake cross-site requests.  In most cases, you will want to enable this option, which will make your application more secure. <br><br>  <code>SECRET_KEY</code> needed only when <code>CSRF</code> enabled.  It is used to create a cryptographic token that is used during form validation.  When you write your application, make sure that your secret key is difficult to find. <br><br>  Now we have a config, and we need to tell Flask to read and use it.  We can do this right after the Flask application object is created.  (file app / __ init__.py): <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask app = Flask(__name__) app.config.from_object(<span class="hljs-string"><span class="hljs-string">'config'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> views</code> </pre><br><br><h4>  Login form </h4><br>  In <code>Flask-WTF</code> forms are represented as subclass objects of the <code>Form</code> class.  The subclass of forms simply defines the form fields as variables in a class. <br><br>  We will create a login form that will be used with the identification system.  The login mechanism that we will support in our application is not a standard username / password type - we will use OpenID as logins.  The advantage of OpenID is that the authorization is passed by the OpenID provider, so we do not need to check passwords, which will make our site more secure for our users. <br><br>  OpenID login only requires one line called OpenID.  We will also drop the 'Remember me' checkbox into a form so that the user can set a cookie in his browser, which will remember their login when they return. <br><br>  Let's write our first form (file app / forms.py): <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask.ext.wtf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Form <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wtforms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TextField, BooleanField <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wtforms.validators <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Required <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Form)</span></span></span><span class="hljs-class">:</span></span> openid = TextField(<span class="hljs-string"><span class="hljs-string">'openid'</span></span>, validators = [Required()]) remember_me = BooleanField(<span class="hljs-string"><span class="hljs-string">'remember_me'</span></span>, default = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre><br><br>  I am sure that the class speaks for itself.  We imported the <code>Form</code> class and two field classes that we need, <code>TextField</code> and <code>BooleanField</code> . <br><br>  The imported <code>Required</code> is a validator, a function that can be attached to a field, to validate the data sent by the user.  The <code>Required</code> validator simply checks that the field was not sent empty.  <code>Flask-WTF</code> has a lot of validators, we will use some new ones in the future. <br><br><h4>  Form templates </h4><br>  We also need an HTML template that contains a form.  The good news is that the <code>LoginForm</code> class that we just created knows how to render form fields in HTML, so we just need to concentrate on the layout.  Here is our login template: (app / templates / login.html file): <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- extend from base layout --&gt;</span></span> {% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Sign In<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"login"</span></span></span><span class="hljs-tag">&gt;</span></span> {{form.hidden_tag()}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> Please enter your OpenID:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {{form.openid(size=80)}}<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{form.remember_me}} Remember Me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sign In"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br><br>  Notice that we again use the <code>base.html</code> template through the inheritance operator, extending it.  We will do this with all of our templates, ensuring that the layout is consistent across all pages. <br><br>  There are several interesting differences between the usual HTML form and our template.  The template expects an instance of the form class that we just assigned to the <code>form</code> template argument.  We will take care of sending this template argument in the future when we write the view function that returns this template. <br><br>  The template parameter <code>form.hidden_tag()</code> will be replaced with a hidden field to prevent CSRF, included in our settings file.  This field must be in all of your forms if CSRF is enabled. <br><br>  The fields of our form are given by the form object, you just have to refer to the <code>{{form.field_name}}</code> argument in the place of the template where the field is to be inserted.  Some fields can take arguments.  In our case, we ask the form to create our openid field with a width of 80 characters. <br><br>  Since we have not defined the submit button in the form class, we must define it as a regular field.  The send field does not carry any data, so there is no need to define it in the form class. <br><br><h4>  Form submissions </h4><br>  The final step before we can see our form will be the writing of the view function that gives the template. <br><br>  In fact, this is quite simple, since we only have to transfer the form object to the template.  Here is our new view function (file app / views.py): <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_template, flash, redirect <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> forms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LoginForm <span class="hljs-comment"><span class="hljs-comment">#   index    @app.route('/login', methods = ['GET', 'POST']) def login(): form = LoginForm() return render_template('login.html', title = 'Sign In', form = form)</span></span></code> </pre><br><br>  We imported our <code>LoginForm</code> class, created an instance of it and sent it to a template.  This is all you need to draw the form fields. <br><br>  We will not pay attention to the import of <code>flash</code> and <code>redirect</code> .  We use them a little later. <br><br>  Another innovation is the method arguments in the <code>route</code> decorator.  Here we tell Flask that the view function accepts a <code>GET</code> and <code>POST</code> request.  Without this, the view will only accept <code>GET</code> requests.  We want to receive <code>POST</code> requests which will give the form with the data entered by the user. <br><br>  At this stage you can launch the application and look at your form in the browser.  After launch, open the address we associated with the login view function: <a href="http://localhost:5000/login">http: // localhost: 5000 / login</a> <br><br>  We have not yet programmed the part that receives the data, so clicking on the submit button will have no effect. <br><br>  Getting form data <br>  Another area where <code>Flask-WTF</code> facilitates our work is the processing of submitted data.  This is a new version of our <code>login</code> view function, which validates and saves form data (app / views.py file): <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@app.route('/login', methods = ['GET', 'POST']) def login(): form = LoginForm() if form.validate_on_submit(): flash('Login requested for OpenID="' + form.openid.data + '", remember_me=' + str(form.remember_me.data)) return redirect('/index') return render_template('login.html', title = 'Sign In', form = form)</span></span></code> </pre><br><br>  The <code>validate_on_submit</code> method does all the processing.  If you call the method when the form is submitted to the user (that is, before the user has the opportunity to enter data there), then he will return <code>False</code> , in which case you know that you must draw the template. <br><br>  If <code>validate_on_submit</code> is called together as part of the form <code>validate_on_submit</code> request, it will collect all the data, run any validators attached to the fields, and if everything is OK, it returns <code>True</code> , which indicates the data is valid.  This means that the data is safe to be included in the application. <br><br>  If at least one field fails validation, then the function will return <code>False</code> and this will again cause the form to be drawn to the user, thereby making it possible to correct the errors.  Later we will learn to show error messages when validation fails. <br><br>  When <code>validate_on_submit</code> returns <code>True</code> , our view function calls two new functions imported from Flask.  The <code>Flash</code> feature is a quick way to display a message on the next page presented to the user.  In this case, we will use this for debugging as long as we do not have the infrastructure necessary for logging, instead, we will simply display a message that will show the sent data.  Also, <code>flash</code> extremely useful on the production server to provide user feedback. <br><br>  Flash messages will not automatically appear on our page, our templates should display messages in the form that is suitable for the layout of our site.  We will add messages to the base template, so all our templates inherit this functionality.  This is the updated base template (app / templates / base.html file): <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> {% if title %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>{{title}} - microblog<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> {% else %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>microblog<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> {% endif %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>Microblog: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/index"</span></span></span><span class="hljs-tag">&gt;</span></span>Home<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">&gt;</span></span> {% with messages = get_flashed_messages() %} {% if messages %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {% for message in messages %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>{{ message }} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> {% endfor %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {% endif %} {% endwith %} {% block content %}{% endblock %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  I hope the way to display messages does not require explanations. <br><br>  Another new feature we used in our login view is <code>redirect</code> .  This function redirects the client web browser to another page, instead of the requested one.  In our presentation function, we used a redirect to the main page developed in the previous sections.  Keep in mind that flash messages will be displayed even if the function ends with redirection. <br><br>  Great time to start the application and check how the forms work.  Try sending a form with an empty openid field to see how the <code>Required</code> validator stops the transfer process. <br><br><h4>  Improving field validation </h4><br>  With the application in its current state, forms submitted with incorrect data will not be accepted.  Instead, the form will again be given to the user for correction.  This is exactly what we need. <br><br>  What we missed is that the user is notified of what is wrong with the form.  Fortunately, <code>Flask-WTF</code> also facilitates this task. <br><br>  When a field fails validation, <code>Flask-WTF</code> adds a visual error message to the form object.  These messages are available in the template, so we just need to add some logic to display them. <br><br>  This is our login template with field validation messages (app / templates / login.html file): <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- extend base layout --&gt;</span></span> {% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Sign In<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"login"</span></span></span><span class="hljs-tag">&gt;</span></span> {{form.hidden_tag()}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> Please enter your OpenID:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {{form.openid(size=80)}}<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {% for error in form.errors.openid %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: red;"</span></span></span><span class="hljs-tag">&gt;</span></span>[{{error}}]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> {% endfor %}<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{form.remember_me}} Remember Me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sign In"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br><br>  The only change we made was to add a loop that renders any error messages added by the validator to the right of the openid field.  As a rule, any fields with validators attached will have errors added as <code>form.errors._</code> .  In our case, we use <code>form.errors.openid</code> .  We display these messages in red to draw the user's attention to them. <br><br><h4>  OpenID interaction </h4><br>  In fact, we will be faced with the fact that many people do not even know that they already have a couple of OpenID.  It is not well known that a number of large service providers on the Internet support OpenID authentication for their users.  For example, if you have a Google account, then you also have OpenID with it.  As well as in Yahoo, AOL, Flickr and many other services. <br><br>  To make it easier for the user to log into our site with one of the frequently used OpenIDs, we will add links to some of them, so that the user does not need to enter OpenID manually. <br><br>  Let's start by defining the list of OpenID providers we want to submit.  We can do this in our configuration file (config.py file): <br><pre> <code class="python hljs">OPENID_PROVIDERS = [ { <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Google'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span>: <span class="hljs-string"><span class="hljs-string">'https://www.google.com/accounts/o8/id'</span></span> }, { <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Yahoo'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span>: <span class="hljs-string"><span class="hljs-string">'https://me.yahoo.com'</span></span> }, { <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'AOL'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span>: <span class="hljs-string"><span class="hljs-string">'http://openid.aol.com/&lt;username&gt;'</span></span> }, { <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Flickr'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span>: <span class="hljs-string"><span class="hljs-string">'http://www.flickr.com/&lt;username&gt;'</span></span> }, { <span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'MyOpenID'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span>: <span class="hljs-string"><span class="hljs-string">'https://www.myopenid.com'</span></span> }]</code> </pre><br><br>  Now let's see how we use this list in our login view function: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@app.route('/login', methods = ['GET', 'POST']) def login(): form = LoginForm() if form.validate_on_submit(): flash('Login requested for OpenID="' + form.openid.data + '", remember_me=' + str(form.remember_me.data)) return redirect('/index') return render_template('login.html', title = 'Sign In', form = form, providers = app.config['OPENID_PROVIDERS'])</span></span></code> </pre><br><br>  Here we get the settings by searching them by key in <code>app.config</code> .  Next, the list is added to the <code>render_template</code> call as a template argument. <br><br>  As you guessed, we need to take another step to end this.  Now we need to specify how we would like to display links to these providers in our login template (file app / templates / login.html): <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- extend base layout --&gt;</span></span> {% extends "base.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">set_openid</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">(openid, pr)</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ u = openid.search(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'&lt;username&gt;'</span></span></span><span class="actionscript">) </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">if</span></span></span><span class="actionscript"> (u != </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">-1</span></span></span><span class="actionscript">) { </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">// openid requires username user = prompt('Enter your ' + pr + ' username:') openid = openid.substr(0, u) + user } form = document.forms['login']; form.elements['openid'].value = openid } </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Sign In<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"login"</span></span></span><span class="hljs-tag">&gt;</span></span> {{form.hidden_tag()}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> Please enter your OpenID, or select one of the providers below:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> {{form.openid(size=80)}} {% for error in form.errors.openid %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: red;"</span></span></span><span class="hljs-tag">&gt;</span></span>[{{error}}]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> {% endfor %}<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> |{% for pr in providers %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:set_openid('{{pr.url}}', '{{pr.name}}');"</span></span></span><span class="hljs-tag">&gt;</span></span>{{pr.name}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> | {% endfor %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{form.remember_me}} Remember Me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sign In"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br><br>  The template turned out to be somewhat long due to all these changes.  Some OpenIDs include usernames, for them we need to have some javascript magic that asks for a username and then creates OpenID.  When a user clicks on an OpenID provider link and (optionally) enters a username, the OpenID for that provider is inserted into the text field. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/28e/474/42e/28e47442e5989eec16bfc7158009255d.jpg"><br>  <i>screenshot of our login page after clicking on the Google OpenID link</i> <br><br><h4>  Final words </h4><br>  Although we have made great progress with our login forms, in reality we have not done anything to log users into our system.  Everything we did was related to the GUI of the login process.  This is because before we can make real logins, we need to have a database where we can record our users. <br><br>  In the next part, we will raise and launch our database, and later we will complete our login system, so stay tuned for updates in the following articles. <br><br>  The microblog application in its current state is available for download here: <br>  <a href="">microblog-0.3.zip</a> <br><br>  Note that the zip file does not contain the flask virtual environment.  Create it yourself, following the instructions in the first part, before you can run the application. <br><br>  If you have any questions or comments, then freely leave them below. <br><br>  Miguel </div><p>Source: <a href="https://habr.com/ru/post/194062/">https://habr.com/ru/post/194062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194050/index.html">How Google Adwords considers cost per click, and how to reduce it</a></li>
<li><a href="../194052/index.html">Paypal. Have waited</a></li>
<li><a href="../194054/index.html">Another article about caching web traffic</a></li>
<li><a href="../194056/index.html">Connecting SlidingMenu to the Support Library and avoiding potential problems</a></li>
<li><a href="../194058/index.html">Transmitting "hidden" radio signal</a></li>
<li><a href="../194064/index.html">3D printing of human organs</a></li>
<li><a href="../194068/index.html">Tradinno: the world's largest walking robot</a></li>
<li><a href="../194070/index.html">Past, Present, and Future of Virtualization at ZeroNights 2013</a></li>
<li><a href="../194072/index.html">PluggableJs - a simple and convenient way to connect javascript on certain pages</a></li>
<li><a href="../194082/index.html">How to stop being scared and love shopping on Amazon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>