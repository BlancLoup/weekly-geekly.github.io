<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the keyboard for non-standard input under iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The standard library provides for UITextField and UITextView several different types of keyboards, among which are the usual, Email, URL (differ from ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the keyboard for non-standard input under iOS</h1><div class="post__text post__text-html js-mediator-article"><a href=""><img src="https://habrastorage.org/storage2/8fe/bed/bf6/8febedbf6ef12c361a6faf6f3ab3c77a.png" align="left"></a>  The standard library provides for <code>UITextField</code> and <code>UITextView</code> several different types of keyboards, among which are the usual, Email, URL (differ from the usual several characters) and Phone (digital).  For most life situations, this is enough, but not always. <br><br>  Imagine that an application has an input field that can accept numbers and arithmetic expressions. <br><br>  Phone keypad will not be enough for us - there is no full stop, no all operations characters, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, everything you need is on a regular keyboard, but in this case 95% of it will not be used (recall, we only need numbers + symbols of arithmetic operations). <br><br>  The conclusion suggests itself: you need to write your keyboard, <s>well, you know what</s> ! <br><br><a name="habracut"></a><br><br>  So, what characters do we need?  ".0123456789% + - √ó √∑", and for the collection, add "‚Üµ" (return) and "‚Üê" (backspace).  Draw a layout: <br><br><img src="https://habrastorage.org/storage2/9f7/d08/35e/9f7d0835e7b26e723a7e8fadfee1caa6.png"><br><br>  OK, it looks pretty good.  Now you need to tie this section to the text input field. <br><br>  Since the days of iOS 3, interface components that allow input (such as <code>UITextField</code> and <code>UITextView</code> ) have wonderful <code>inputView</code> and <code>inputAccessoryView</code> . <br><br>  The view lying in <code>inputAccessoryView</code> is shown above the keyboard (of course, when the latter is on the screen).  This is usually a toolbar with a pair of buttons and / or an input field. <br><br>  But <code>inputView</code> intended just to override the standard keyboard.  In other words, if you assign an object of the <code>UIView</code> class <code>UIView</code> this property, then at the moment when the text field becomes <code>firstResponder</code> , it is not the keyboard that is shown, but the very <code>UIView</code> object that lies in the <code>inputView</code> .  It is shown in the same place (bottom, hehe) and with the same animations as a regular keyboard.  Moreover, notifications like <code>UIKeyboardWillShowNotification</code> will be sent!  Solid pluses. <br><br>  But what about the cons?  I have them. <br><br>  The main disadvantage of any non-standard input is how to organize the connection between the keyboard and the text field.  You can come up with a lot of solutions, but, of course, it would be ideal to make your input ‚Äúnative‚Äù, as transparent as possible for use (for example, some shamanism with the <code>UITextInputTraits</code> protocol and the <code>UIKeyboardType</code> extension).  Unfortunately, I didn‚Äôt really think about it, although when I have time, I‚Äôll definitely try to finish it. <br><br>  One of the most obvious decisions is the delegate.  Our keyboard will simply tell your delegate which button is down.  And by the way about the buttons.  And why not hardcode the keyboard, but make it dynamically configurable?  Indeed, why not?  Let's get for this protocol Datasource. <br><br>  So, we have as a result one class and two protocols: keyboard, delegate, datasource. <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//KHKeyboard.h #import &lt;UIKit/UIKit.h&gt; #import "KHKeyboardDatasource.h" #import "KHKeyboardDelegate.h" @interface KHKeyboard : UIView @property (nonatomic, assign) id&lt;KHKeyboardDatasource&gt; datasource; @property (nonatomic, assign) id&lt;KHKeyboardDelegate&gt; delegate; @end //KHKeyboardDelegate.h #import &lt;UIKit/UIKit.h&gt; @class KHKeyboard; @protocol KHKeyboardDelegate &lt;NSObject&gt; @optional - (void)keyPressedInKeyboard:(KHKeyboard *)keyboard atIndex:(NSInteger)index; @end //KHKeyboardDatasource.h #import &lt;UIKit/UIKit.h&gt; @class KHKeyboard; @protocol KHKeyboardDatasource &lt;NSObject&gt; @required - (NSInteger)numberOfKeysInKeyboard:(KHKeyboard *)keyboard; - (UIButton *)buttonForKeyInKeyboard:(KHKeyboard *)keyboard atIndex:(NSInteger)index; @end</span></span></code> </pre><br>  With the delegate, everything is clear - the pressed button is determined by the index.  Datasource is designed to configure our keyboard: it reports the number of buttons, and also provides <code>UIButton</code> objects (the actual buttons).  Configuring the returned button, do not forget to set the <code>frame</code> property - it determines the position of the button on our view. <br><br>  Initialization: <br><pre> <code class="cpp hljs">self.rects = [NSArray arrayWithObjects: [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], [NSValue valueWithCGRect:CGRectMake(<span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)], nil]; self.titles = [NSArray arrayWithObjects: @<span class="hljs-string"><span class="hljs-string">"7"</span></span>, @<span class="hljs-string"><span class="hljs-string">"8"</span></span>, @<span class="hljs-string"><span class="hljs-string">"9"</span></span>, @<span class="hljs-string"><span class="hljs-string">"√ó"</span></span>, @<span class="hljs-string"><span class="hljs-string">"‚Üê"</span></span>, @<span class="hljs-string"><span class="hljs-string">"4"</span></span>, @<span class="hljs-string"><span class="hljs-string">"5"</span></span>, @<span class="hljs-string"><span class="hljs-string">"6"</span></span>, @<span class="hljs-string"><span class="hljs-string">"√∑"</span></span>, @<span class="hljs-string"><span class="hljs-string">"%"</span></span>, @<span class="hljs-string"><span class="hljs-string">"1"</span></span>, @<span class="hljs-string"><span class="hljs-string">"2"</span></span>, @<span class="hljs-string"><span class="hljs-string">"3"</span></span>, @<span class="hljs-string"><span class="hljs-string">"+"</span></span>, @<span class="hljs-string"><span class="hljs-string">"‚Üµ"</span></span>, @<span class="hljs-string"><span class="hljs-string">"0"</span></span>, @<span class="hljs-string"><span class="hljs-string">"."</span></span>, @<span class="hljs-string"><span class="hljs-string">"‚àí"</span></span>, nil]; KHKeyboard *keyboard = [[[KHKeyboard alloc] init] autorelease]; keyboard.datasource = self; keyboard.delegate = self; self.textField.inputView = keyboard;</code> </pre><br>  Configure datasource: <br><pre> <code class="cpp hljs">- (NSInteger)numberOfKeysInKeyboard:(KHKeyboard *)keyboard { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [self.rects count]; } - (UIButton *)buttonForKeyInKeyboard:(KHKeyboard *)keyboard atIndex:(NSInteger)index { NSString *title = [self.titles objectAtIndex:index]; CGRect rect = [(NSValue *)[self.rects objectAtIndex:index] CGRectValue]; UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom]; button.frame = rect; [button setTitle:title forState:UIControlStateNormal]; [button setUserInteractionEnabled:NO]; [button setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal]; [button setTitleColor:[UIColor blackColor] forState:UIControlStateHighlighted]; [button setReversesTitleShadowWhenHighlighted:YES]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index == <span class="hljs-number"><span class="hljs-number">14</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// return key [button setBackgroundImage:[UIImage imageNamed:@"button_normal_2.png"] forState:UIControlStateNormal]; [button setBackgroundImage:[UIImage imageNamed:@"button_highlighted_2.png"] forState:UIControlStateHighlighted]; } else if (index == 15) { // "0" key [button setBackgroundImage:[UIImage imageNamed:@"button_normal_1.png"] forState:UIControlStateNormal]; [button setBackgroundImage:[UIImage imageNamed:@"button_highlighted_1.png"] forState:UIControlStateHighlighted]; } else { [button setBackgroundImage:[UIImage imageNamed:@"button_normal.png"] forState:UIControlStateNormal]; [button setBackgroundImage:[UIImage imageNamed:@"button_highlighted.png"] forState:UIControlStateHighlighted]; } [button.titleLabel setFont:[UIFont boldSystemFontOfSize:16]]; return button; }</span></span></code> </pre><br>  And the lonely delegate: <br><pre> <code class="cpp hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)keyPressedInKeyboard:(KHKeyboard *)keyboard atIndex:(NSInteger)index { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index == <span class="hljs-number"><span class="hljs-number">14</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// return key [self.textField resignFirstResponder]; } else if (index == 4) { // backspace key NSInteger length = [self.textField.text length]; if (length == 0) { return; } else { NSString *newValue = [self.textField.text substringToIndex:length - 1]; self.textField.text = newValue; } } else { NSString *value = [self.titles objectAtIndex:index]; NSMutableString *newValue = [NSMutableString stringWithFormat:@"%@%@", self.textField.text, value]; self.textField.text = newValue; } }</span></span></code> </pre><br>  The result can be seen in the screenshot at the beginning of the article, as well as on <a href="https://github.com/khour/KHKeyboardDemo">github</a> . <br><br>  This, in principle, could be completed, but some questions remain. <br><br>  For example, this implementation is well suited if the input field that requires a custom keyboard is only one.  And if there are several?  It is necessary to somehow determine which of them is the <code>firstResponder</code> at the moment. <br><br>  Alternatively, you can follow the already mentioned notifications about the appearance of the keyboard (do not forget that they do not disappear anywhere).  The <code>object</code> property of an <code>NSNotification</code> class <code>NSNotification</code> will contain the control that caused the keyboard.  Therefore, we save it and use it later in <code>keyPressedInKeyboard:atIndex:</code> <br><br>  I would be very grateful for any practical suggestions and tips for improving and unifying this product. </div><p>Source: <a href="https://habr.com/ru/post/139937/">https://habr.com/ru/post/139937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139931/index.html">Nginx module to combat DDoS</a></li>
<li><a href="../139933/index.html">Draw your button in QGraphicsScene in PyQt4</a></li>
<li><a href="../139934/index.html">Quick brown fox jumps over the lazy dog</a></li>
<li><a href="../139935/index.html">Petition: Return the RSS icon to the default Firefox installation</a></li>
<li><a href="../139936/index.html">Homeless router</a></li>
<li><a href="../139940/index.html">We protect the site from attacks on the example of HabraHabra</a></li>
<li><a href="../139947/index.html">Using RF Modules</a></li>
<li><a href="../139948/index.html">About cross-platform "E1 Euphrates"</a></li>
<li><a href="../139949/index.html">Accelerate checking your iOS / Mac applications in iTunesConnect from week to one day</a></li>
<li><a href="../139950/index.html">Implementing tools to create OVAL¬Æ content in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>