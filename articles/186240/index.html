<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMB and NTFS permissions. Debriefing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why do you need a server in most cases? Active Directory, RDS, print server and a bunch of small and large services. The most noticeable role for all,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMB and NTFS permissions. Debriefing</h1><div class="post__text post__text-html js-mediator-article">  Why do you need a server in most cases?  Active Directory, RDS, print server and a bunch of small and large services.  The most noticeable role for all, perhaps, is the file server.  With him, people, in contrast, from other roles work most consciously.  They remember in what folder what is lying, where are the scans of documents, where are their reports, where are the faxes, where is the general folder, where everything can be accessed, where only one department can access, another, and they don‚Äôt even know about some <br><br>  I want to talk about access to network and local folders on the server. <br><a name="habracut"></a><br>  Access to shared resources on the server is, as everyone knows, through the SMB protocol already 3.0.  Network access to folders can be limited by SMB and NTFS permissions.  SMB permissions work only when accessing a shared folder over a network and have no effect on the availability of a folder locally.  NTFS permissions work both over the network and locally, providing much more flexibility in creating access rights.  SMB and NTFS permissions do not work separately, but complement each other, according to the principle of the most restrictive rights. <br><br>  In order to share the folder in Server 2012 in the <a href="http://technet.microsoft.com/library/jj635726.aspx">SMB Share Cmdlets group</a> , the New-SMBShare cmdlet has appeared.  Using this cmdlet as an example, we will see all the features available when creating a public folder, except for cluster configurations (this is a separate large topic). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Creating a new shared folder looks very simple: <br><pre><code class="cs hljs">net share homefolder=s:\ivanivanov /grant:<span class="hljs-string"><span class="hljs-string">"admin"</span></span>,full /grant:<span class="hljs-string"><span class="hljs-string">"folderowner"</span></span>,change /grant:<span class="hljs-string"><span class="hljs-string">"manager"</span></span>,read /cache:programs /remark:<span class="hljs-string"><span class="hljs-string">"Ivanov"</span></span></code> </pre>  or <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-smbshare homefolder s:\ivanivanov ‚Äìcachingmode programs ‚Äìfullaccess admin ‚Äìchangeaccess folderowner ‚Äìreadaccess manager ‚Äìnoaccess all ‚Äìfolderenumerationmode accessbased -description <span class="hljs-string"><span class="hljs-string">"Ivanov"</span></span></code> </pre><br><h4>  We understand: </h4><br><pre> <code class="cs hljs">-name</code> </pre>  The name of the shared folder on the network may differ from the name of the folder on the local computer.  Has a limit of 80 characters, you can not use the names of pipe and mailslot. <br><br><pre> <code class="cs hljs">-path</code> </pre>  The path to the local folder to be shared.  The path must be complete, from the root of the disk. <br><br><pre> <code class="cs hljs">-cachingmode</code> </pre>  setting autonomy of files in a shared folder. <br><br><div class="spoiler">  <b class="spoiler_title">What is an offline file?</b> <div class="spoiler_text">  A standalone file is a copy of a file located on the server.  This copy is located on the local computer and allows you to work with the file without connecting to the server.  When connected, changes are synchronized.  Synchronized in both directions: if you made changes to your offline file - the next time you connect, the file on the server will be changed;  if someone made changes on the server, then your local copy will be changed.  If the changes occurred in both files at once - we get a synchronization error and have to choose which version to save.  For collaboration, I would not use this opportunity, but if for each user to make a ball and restrict access for others to read, without the possibility of writing, we get the following buns: <br><ul><li>  Work does not depend on the network - the switch may burn, the server may reboot, the wire may break or the access point may be turned off - the user works with his copy, without noticing that you have some kind of failure there, when the network connection is restored, his work goes to the server. </li><li>  The user can work anywhere: in the country, on the bus, on the plane - in those places where a VPN connection is unavailable for some reason. </li><li>  Even if the user works through a VPN, but the connection is either very slow, or is constantly disconnected - it‚Äôs easier to work with a standalone copy and synchronize the changes than to try to do something on the server. </li><li>  The user himself can choose what and when to synchronize, if given the opportunity. </li></ul><br></div></div><br>  Accepts the following values: <br><ul><li>  none - the files are not accessible offline, access to the server requires access to the server </li><li>  manual - users choose the files that will be available offline </li><li>  programs - everything in the folder is accessible offline (documents and programs (files with the extension * .exe, * .dll)) </li><li>  documents - documents are available, there is no program </li><li>  branchcache - caching instead of the user's local computer occurs on BranchCache servers, users choose offline files themselves </li></ul><br><pre> <code class="cs hljs">-noaccess, -readaccess, -changeaccess, -fullaccess</code> </pre>  share permissions. <br><br>  These permissions have one big advantage - they are very simple. <br><br>  -noaccess secretary, steward - the secretary and the supply manager have nothing to do in the general folders of the accounting department <br>  -readaccess auditor - the auditor checking the work of the accounting department can see the names of files and subfolders in the shared folder, open files for reading, run programs. <br>  -changeaccess accountant - accountants in their shared folder can create files and subfolders, modify existing files, delete files and subfolders <br>  -fullaccess admin - fullaccess is readaccess + changeaccess plus the ability to change permissions. <br><br>  When creating a shared folder, the most restrictive rule is automatically applied - the ‚ÄúEveryone‚Äù group is given the right to read. <br><br>  These permissions apply only to users who have access to the shared folder over the network.  When logging into the system locally, for example, in the case of a terminal server, both the secretary and the farm manager will see whatever they wish in the accounting department.  This is fixed by NTFS permissions.  SMB permissions apply to all files and folders on a share.  More fine-tuning access rights is also provided by NTFS permissions. <br><br><pre> <code class="cs hljs">-concurrentuserlimit</code> </pre>  With this option, you can limit the maximum number of connections to a shared folder.  In principle, you can also use it to restrict access to a folder, complementing NTFS permissions, you just need to be sure of the required number of connections. <br><br><pre> <code class="cs hljs">-description</code> </pre>  A description of the share that is visible in the network environment.  Description is a very good thing that many people neglect. <br><br><pre> <code class="cs hljs">-encryptdata</code> </pre>  encryption <br><br>  In SMB to version 3.0, the only way to protect traffic from a file server to a client was VPN.  How to implement it depended completely on the preferences of the system administrator: SSL, PPTP, IPSEC tunnels or something else.  In Server 2012, encryption works out of the box, on a regular LAN or through untrusted networks, without requiring any special infrastructure solutions.  It can be enabled both for the entire server and for individual shared folders.  The encryption algorithm in SMB 3.0 is <a href="http://tools.ietf.org/html/rfc5084">AES-CCM</a> , the hash algorithm instead of HMAC-SHA256 is <a href="http://www.ietf.org/rfc/rfc4493.txt">AES-CMAC</a> .  The good news is that SMB 3.0 supports hardware AES ( <a href="http://www.intel.ru/content/www/ru/ru/architecture-and-technology/advanced-encryption-standard--aes-/data-protection-aes-general-technology.html">AES-NI</a> ), the bad news is that Russia does not support AES-NI. <br><br>  What threatens the inclusion of encryption?  The fact that only clients that support SMB 3.0, that is, Windows 8, can work with encrypted public folders. Again, the reason is the maximum allowable restriction of user rights.  It is assumed that the administrator knows what he is doing and, if necessary, will give access to clients with a different version of SMB.  But since SMB 3.0 uses new encryption and hashing algorithms, client traffic with a different version of SMB will not be encrypted, you need a VPN.  The command will help all clients go to the file server with encryption enabled. <pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-smbserverconfiguration ‚Äìrejectunencryptedaccess $<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  In the default configuration (unencrypted traffic to encrypted shared folders is prohibited), if you try to access the client folder with an SMB version lower than 3.0 on the client, we will get an ‚ÄúAccess error‚Äù.  On the server, event 1003 will be added to the Microsoft-Windows-SmbServer / Operational log in which you can find the IP address of the client trying to gain access. <br><br>  Encryption of SMB and EFS are different things that are not related to each other, that is, it can be used on FAT and ReFS volumes. <br><br><pre> <code class="cs hljs">-folderenumerationmode</code> </pre>  This is an Access-Based Enumeration.  With Access-Based Enumeration enabled, users who do not have access to a shared folder will simply not see it on the file server and there will be fewer questions why I do not have access to this or that folder.  The user sees their available folders and does not try to climb into the affairs of others.  The default is off. <br><ul><li>  accessbased - enable </li><li>  unrestricted - turn off </li></ul><br><pre> <code class="cs hljs">-temporary</code> </pre>  This key creates a temporary shared folder, access to which will be terminated after the server is restarted.  By default, permanent shared folders are created. <br><br><h4>  NTFS permissions </h4><br>  With the help of NTFS permissions, we can further differentiate the rights in the folder.  We can prohibit a certain group from changing a specific file, leaving the possibility of editing the entire main file;  in the same folder, one user group may have the rights to change one file and will not be able to view other files being edited by another user group and vice versa.  In short, NTFS permissions allow us to create a very flexible access system, the main thing is not to get confused in it.  In addition, NTFS permissions work both when accessing a folder over a network, complementing sharing permissions, as well as locally accessing files and folders. <br><br>  There are six basic (basic) permissions, which are a combination of 14 additional (advanced) permissions. <br><br><h5>  Basic permissions </h5><br>  <b>Full access (fullcontrol)</b> - full access to a folder or file, with the ability to change access rights and audit rules for folders and files <br><br>  <b>Modify (modify)</b> - the right to read, modify, view the contents of a folder, delete folders / files and run executable files.  Includes Read and Execute (readandexecute), Write (write) and Delete (delete). <br><br>  <b>Reading and execution (readandexecute)</b> - the right to open folders and files for reading, without the possibility of writing.  It is also possible to launch executable files. <br><br>  <b>Folder contents list (listdirectory)</b> - the right to view the contents of the folder <br><br>  <b>Read (read)</b> - the right to open folders and files for reading, without the possibility of writing.  Includes Folder Content / Data Reading (readdata), Reading Attributes (readattributes), Reading Optional Attributes (readextendedattributes) and Reading Permissions (readpermissions) <br><br>  <b>Write (write)</b> - the right to create folders and files, modify files.  Includes Creating Files / Writing Data (writedata), Creating Folders / Writing Data (appenddata), Writing Attributes (writeattributes) and Writing Optional Attributes (writeextendedattributes) <br><br><h5>  Additional permissions </h5><br>  I put only 1 of the 14 permissions on the folder and watched what happened.  In the real world, in most cases, the basic permissions are enough, but I was interested in the behavior of folders and files with the most reduced permissions. <br><br>  <b>Traverse folders / file execution (traverse)</b> - the right to run and read files, regardless of the permissions of the folder.  The user will not have access to the folder, (what remains in the folder will remain a mystery), but files in the folder will be accessible via a direct link (full, relative or UNC path).  You can put on the folder Traverse folders, and on the file any other permissions that the user needs to work.  Create and delete files in the folder the user will not work. <br><br>  <b>Folder content / Read data (readdata)</b> - the right to view the contents of the folder without the possibility of change.  You cannot open and open files in the folder you are viewing. <br><br>  <b>Reading Attributes (readattributes)</b> - the right to view the attributes ( <a href="http://msdn.microsoft.com/ru-ru/library/system.io.fileattributes(v%3Dvs.110).aspx">FileAttributes</a> ) of a folder or file. <br>  You cannot view the contents of a folder or files or change any attributes. <br><br>  <b>Reading additional attributes (readextendedattributes)</b> - the right to view additional attributes of a folder or file. <br><br>  The only thing I could find from the additional attributes is that they are used for backward compatibility with OS / 2 applications.  ( <a href="http://books.google.ru/books%3Fid%3DCdxMRjJksScC">Windows Internals, Part 2: Covering Windows Server 2008 R2 and Windows 7</a> ).  I know nothing more about them. <br><br>  <b>Creating files / writing data (writedata)</b> - allows the user to create files in a folder to which he does not have access.  You can copy files to a folder and create new files in a folder.  You can not view the contents of the folder, create new folders and modify existing files.  The user will not be able to change any file, even if he is the owner of this file - only to create. <br><br>  <b>Create folders / add data (appenddata)</b> - allows the user to create subfolders in the folder and add data to the end of the file without changing the existing content. <br><br><div class="spoiler">  <b class="spoiler_title">Check</b> <div class="spoiler_text">  With the creation of subfolders, everything is clear: <pre> <code class="cs hljs">ni c:\testperms\testappend ‚Äìitemtype directory</code> </pre>  will work as expected - it will create a subfolder of testappend in the inaccessible for the user folder testperms.  Let's try to add a line to the end of the file - we will emulate some kind of logging. <pre> <code class="cs hljs">newevent &gt;&gt; c:\testperms\user.log   .</code> </pre><br>  Hmm ... In CMD does not work.  And if so. <pre> <code class="cs hljs">ac c:\testperms\user.log newevent ac :      <span class="hljs-string"><span class="hljs-string">"C:\testperms\user.log"</span></span>.</code> </pre><br>  And on the conveyor? <pre> <code class="cs hljs"><span class="hljs-string"><span class="hljs-string">"newevent"</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>-file c:\testperms\user.log -append <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>-file :      <span class="hljs-string"><span class="hljs-string">"C:\testperms\user.log"</span></span>.</code> </pre><br>  And so does not work. <br><br>  Starting a black magic session: use the File class, the <a href="http://msdn.microsoft.com/ru-ru/library/system.io.file.appendtext.aspx">AppendText</a> method.  Get the log object. <br><pre> <code class="cs hljs">$log = [io.file]::appendtext(<span class="hljs-string"><span class="hljs-string">"c:\testperms\user.log"</span></span>)    <span class="hljs-string"><span class="hljs-string">"AppendText"</span></span>  <span class="hljs-string"><span class="hljs-string">"1"</span></span> : <span class="hljs-string"><span class="hljs-string">"     "</span></span>c:\testperms\user.log<span class="hljs-string"><span class="hljs-string">"."</span></span></code> </pre> <br>  I think that <a href="http://msdn.microsoft.com/ru-ru/library/system.io.file.appendalltext.aspx">it</a> is not worth trying the <a href="http://msdn.microsoft.com/ru-ru/library/system.io.file.appendalltext.aspx">AppendAllText</a> <br><pre> <code class="cs hljs">$log = [io.file]::appendalltext(<span class="hljs-string"><span class="hljs-string">"c:\testperms\user.log"</span></span>,<span class="hljs-string"><span class="hljs-string">"newevent"</span></span>)    <span class="hljs-string"><span class="hljs-string">"AppendAllText"</span></span>  <span class="hljs-string"><span class="hljs-string">"2"</span></span> : <span class="hljs-string"><span class="hljs-string">"     "</span></span>c:\testperms\user.log<span class="hljs-string"><span class="hljs-string">"."</span></span></code> </pre><br>  The point, in principle, is clear.  Only the rights to write data to the file are not enough for the methods listed above, they need to write to the file.  But along with this, we will give the opportunity to change the file, and not just add records, that is, we open the potential to destroy the entire contents of the file. <br><br>  We need to revise the concept: let's not get the log object, but create a new one in which we will set all the parameters of interest to us.  We need something where we can explicitly specify access rights.  We need a <a href="http://msdn.microsoft.com/ru-ru/library/system.io.filestream.aspx">FileStream</a> , and <a href="http://msdn.microsoft.com/ru-ru/library/ms143396.aspx">FileStream Constructor</a> will help us more specifically <a href="http://msdn.microsoft.com/ru-ru/library/ms143396.aspx">(String, FileMode, FileSystemRights, FileShare, Int32, FileOptions)</a> .  The following parameters are needed: <br><ul><li>  File path is understandable </li><li>  How to open a file - open the file and find the end of the file </li><li>  File Permissions - Data Acquisition </li><li>  Access for other FileStream objects - not needed </li><li>  Buffer size - default 8 bytes </li><li>  Additional options - no </li></ul><br>  It turns out like this: <br><pre> <code class="cs hljs">$log = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> io.filestream(<span class="hljs-string"><span class="hljs-string">"c:\testperms\user.log"</span></span>,[io.filemode]::append,[security.accesscontrol.filesystemrights]::appenddata,[io.fileshare]::none,<span class="hljs-number"><span class="hljs-number">8</span></span>,[io.fileoptions]::none)</code> </pre><br>  Works!  The object of the log we created, we will try to <a href="http://msdn.microsoft.com/ru-ru/library/system.io.filestream.write.aspx">write</a> something there.  The FileStream.Write method accepts incoming values ‚Äã‚Äãin bytes.  We overtake the event we want to write, into bytes ‚Äî <a href="http://msdn.microsoft.com/ru-ru/library/system.text.encoding.aspx">the Encoding class</a> , the <a href="http://msdn.microsoft.com/ru-ru/library/t9a3kf7c.aspx">GetEncoding</a> method (we don‚Äôt need krakozyabry at the output) and <a href="http://msdn.microsoft.com/ru-ru/library/ds4kkd55.aspx">GetBytes</a> (actually, conversion) <br><pre> <code class="cs hljs">$<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> = <span class="hljs-string"><span class="hljs-string">"  ."</span></span> $eventbytes = [text.encoding]::getencoding(<span class="hljs-string"><span class="hljs-string">"windows-1251"</span></span>).getbytes($<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>)</code> </pre><br>  FileStream.Write Parameters: <br>  What to write;  where to start writing;  the number of bytes to write <br>  We write down: <br><pre> <code class="cs hljs">$log.write($eventbytes,<span class="hljs-number"><span class="hljs-number">0</span></span>,$eventbytes.count)</code> </pre><br>  We are checking. <br><pre> <code class="cs hljs">gc c:\testperms\user.log gc :      <span class="hljs-string"><span class="hljs-string">"C:\testperms\user.log "</span></span>.</code> </pre><br>  Everything is normal, the user does not have rights to view written.  Log on as administrator. <br><pre> <code class="cs hljs">gc c:\testperms\user.log   .</code> </pre><br>  Everything is working. <br><br>  The folder in which the file is located in addition to the permission to create folders / record data must also be given permission to the contents of the folder / read data.  The file is only enough Create folders / dozapis data with disabled inheritance.  Fully protect the user (and the user may be an attacker) from the files in which he should write something will not work, but on the other hand, except for the list of files in the folder, the user will not see and can not do. <br><br>  The conclusion from this is simple: in batch files to implement secure logging of something does not work, PowerShell saves the ability to work with. NET objects. </div></div><br>  <b>Write attributes (writeattributes)</b> - allow the user to change the attributes of a file or folder.  It seems simple.  But just to answer the question: ‚ÄúPhotos of my cats occupy almost the entire place in my profile and I have no place for business correspondence.  I would like to compress the folder with cats, but they require administrative rights from me.  You said that I have the right to change the attributes of folders.  Is this an attribute?  Why can't I change it? ‚Äù <br><br>  Yes, the user with the right to write attributes can change almost all the visible attributes of files and folders, except for the compression and encryption attributes.  Technically, the user is given the right to perform the <a href="http://msdn.microsoft.com/en-us/library/aa365535(v%3Dvs.85).aspx">SetFileAttributes</a> function.  And file compression is performed by the <a href="http://msdn.microsoft.com/en-us/library/aa364592(v%3Dvs.85).aspx">DeviceIOControl</a> function, which needs to pass the FSCTL_SET_COMPRESSION parameter and file compression is not its only job.  Using this function, we can manage all devices and their resources in the system and, probably, giving the user this right to perform this function means to make it an administrator. <br><br>  With encryption, the story is similar: the <a href="http://msdn.microsoft.com/en-us/library/aa364021(v%3Dvs.85).aspx">EncryptFile</a> function, which is exactly responsible for encryption, requires that the user has the rights to the contents of the folder / read data, create files / write data, read attributes, write attributes, and synchronize to an object.  Without them, nothing happens. <br><br>  <b>Write extended attributes (writextendedattributes)</b> .  Well, these are the ones that are used for backward compatibility with OS / 2 applications, yeah.  Well, and in the extended attributes of the file C: \ Windows \ system32 \ services.exe, recently began to write Trojans ( <a href="http://www.symantec.com/connect/blogs/trojanzeroaccessc-hidden-ntfs-ea">ZeroAccess.C</a> ).  Maybe you should turn them off at the top level?  I can‚Äôt give an answer to this question, theoretically - maybe worth it, almost in production - I haven't tried. <br><br>  <b>Delete subfolders and files.</b>  <b>(deletesubdirectoriesandfiles)</b> An interesting resolution that applies only to folders.  The point is to allow the user to delete subfolders and files in the parent folder without giving permission to Delete. <br><br>  Suppose there is a catalog of products in which users enter data.  There is a parent folder Catalog, inside the subfolders alphabetically, from A to Z, inside them there are some names.  Names change every day, something is added, something changes, something becomes outdated and outdated information needs to be deleted.  But it will not be very good if someone for parking or malicious intent will crash the entire K directory, which is very possible if users have the Delete right.  If you take away the Delete right from users, then the administrator can safely change work, because he will carry out requests to delete one name or another all day. <br><br>  This is where the Delete subfolders and files are enabled.  On all letters of the alphabet, inheritance is disabled and the right to Delete subfolders and files is added to users.  As a result, users cannot delete any letters in the catalog folder, but inside letters they can delete anything. <br><br>  <b>Delete (delete).</b>  Everything is simple here.  Removal is removal.  Does not work without the right Reading. <br><br>  <b>Reading permissions</b> gives the user the right to view permissions on a folder or file.  No permission - the user does not see permission on the Security tab <br><br>  <b>Change permissions (changepermissions)</b> - allows the user to change permissions, in fact makes the user the administrator of the folder.  You can use, for example, to delegate authority to tech support.  Without the right to read permissions does not make any sense.  Changing permissions does not imply a change of ownership of the folder. <br><br>  <b>Change of owner (takeownership)</b> - for starters, who is the owner.  The owner is the user who created the file or folder. <br><br>  The owner‚Äôs peculiarity is that he has full access to the created folder, he can distribute permissions to his created folder, but what is more important - no one can deprive the owner of the right to change permissions to his folder or file.  If Vasya created a folder, gave Petya full access, and Petya entered and slammed user access to the folder in general and Vasya in particular, then Vasya can easily restore the status quo, as he is the owner of the folder.  Petya will not be able to change the owner of the folder, even if he has the Change of Owner permission.  Moreover, even Vasya cannot change the owner, despite the fact that he created the folder.  The change of ownership right applies only to the Administrators or Domain Administrators group. <br><br>  But if Petya inside the Vasina folder created the file and did not give Vasya access to it, Vasya can only think and guess what is so secret inside this file.  Vasya will not be able to change file permissions, because Peter is the owner of the file.  Vasya will not be able to change the owner of the file either - changing the owner of subcontainers and objects is also a privilege of the Administrators group to which Vasya does not belong.      ‚Äì       . <br><br><h4>  </h4><br>  CMD        icacls.  PowerShell  NTFS-   : <br><br>  ,       <br><pre> <code class="cs hljs">$acl = <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-acl c:\testperms</code> </pre><br>        <a href="http://msdn.microsoft.com/ru-ru/library/system.security.accesscontrol.filesystemaccessrule.aspx">System.Security.AccessControl.FileSystemAccessRule</a> .    : <br><ul><li> /  ‚Äì    ACL </li><li>  ‚Äì ACE ( ,   ) </li><li>   ‚Äì  GUI       .      3 : none (   ), containerinherit (   ), objectinherit (   ).   . </li><li>            (  GUI) ‚Äì  3 : none ( ), inheritonly (ACE      ), nopropagateinherit (     ). </li><li>  ‚Äì  (allow)   (deny) </li></ul><br>        : <br><pre> <code class="cs hljs">$permission = ‚Äúcontoso.com\admin‚Äù,‚Äùfullcontrol‚Äù,‚Äùcontainerinherit,objectinherit‚Äù,‚Äùnone‚Äù,‚Äùallow‚Äù</code> </pre><br>   ACE     <br><pre> <code class="cs hljs">$ace = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> security.accesscontrol.filesystemaccessrule $permission</code> </pre><br>    ACE   <br><pre> <code class="cs hljs">$acl.setaccessrule($ace) $acl | <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-acl c:\testperms</code> </pre><br><h4>    </h4><br>    SMB  NTFS ,         .  : <br><table><tbody><tr><td>  Type of </td><td> SMB- </td><td> NTFS- </td></tr><tr><td>    (Public) </td><td>  ‚Äì / </td><td>  ‚Äì  </td></tr><tr><td>  Black box.    , ,  ‚Äì  . </td><td>  ‚Äì / <br>  ‚Äì / </td><td>  ‚Äì ,     . ,       ‚Äì    ,                  (       , ,   ).    . <br><br>  ‚Äì . </td></tr><tr><td>  Applications </td><td>  ‚Äì  </td><td>  ‚Äì ,   ,   . <br><br> ,         .    , ,      (  SysInternals Suite)   . <br></td></tr><tr><td>   </td><td>   ‚Äì /    </td><td>   ‚Äì    . </td></tr></tbody></table><br>   Windows ‚Äì  .    ‚Äì       90% .       :   ,  ,      ‚Äì     ,      . <br><br> ,      . <br><br>   : <br>  <a href="http://msdn.microsoft.com/ru-ru/ms348103.aspx">MSDN</a> <br> <a href="http://technet.microsoft.com/">Technet</a> </div><p>Source: <a href="https://habr.com/ru/post/186240/">https://habr.com/ru/post/186240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186228/index.html">Trends in web design: a flat interface and long shadows</a></li>
<li><a href="../186230/index.html">Creating a native extension library for OpenFL (Haxe)</a></li>
<li><a href="../186232/index.html">Windows Azure cloud services and killer asterisk</a></li>
<li><a href="../186236/index.html">Inequality condition coding style</a></li>
<li><a href="../186238/index.html">A camera the size of a tennis ball shoots a stabilized video in flight</a></li>
<li><a href="../186242/index.html">Part 1. How to connect a smartphone to the car or the history of the creation of OBD Car Doctor</a></li>
<li><a href="../186244/index.html">Mail.Ru rating: count more and better</a></li>
<li><a href="../186246/index.html">Co-founder of Pirate Bay creates a mobile instant messenger protected from wiretapping</a></li>
<li><a href="../186248/index.html">The court ordered the Secret Service to publish the case of Aaron Schwartz</a></li>
<li><a href="../186250/index.html">Video for a startup with their own hands. Without experience and budget</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>