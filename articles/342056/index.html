<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Birds Detection with Azure ML Workbench</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you ever thought that biologists, among other things, have a number of important tasks? They need to analyze huge amounts of information to track...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Birds Detection with Azure ML Workbench</h1><div class="post__text post__text-html js-mediator-article">  Have you ever thought that biologists, among other things, have a number of important tasks?  They need to analyze huge amounts of information to track population dynamics, identify rare species and assess their impact.  Under the cut, we want to tell you about the project for the identification of the red-legged moevas on photos taken with surveillance cameras.  You will learn more about data markup, learning the model on the Azure Machine Learning Workbench using Microsoft Cognitive Toolkit (CNTK) and Tensorflow, and deploying a web prediction service. <br><br><img src="https://habrastorage.org/webt/py/m7/f5/pym7f52dnmq38wmu7c9hyybf4xc.jpeg"><br><a name="habracut"></a><br>  <i>The article is a translation of the material <a href="https://www.microsoft.com/developerblog/2017/10/24/bird-detection-with-azure-ml-workbench/">Bird Detection with Azure ML Workbench</a> .</i> <br><br><h2>  Data </h2><br>  The video below is provided by Abram Fleischman (State University of San Jose) and <a href="http://conservationmetrics.com/">Conservation Metrics, Inc.</a>  It captures the natural habitat of the red-legged moev, a species of bird for which a detection tool is needed.  Using various equipment, including mountaineering equipment, biologists install cameras on the rocks to take pictures both during the day and at night. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/nt__1605oTM&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhd_Pt-zr_6VWJhgAafzCWQfZOPGQ"></iframe><br><br>  Photographs were used to train the model, and image markup was performed using the <a href="https://github.com/CatalystCode/VoTT">Visual Object Tagging Tool (VOTT)</a> .  The data markup took about 20 hours, during which time about 12,000 bounding boxes were noted. <br><br><img src="https://habrastorage.org/webt/jn/gp/3b/jngp3bwsgis3bmpx8-aajnhll6q.jpeg"><br><br>  Marked data is available in the <a href="https://github.com/olgaliak/detection-amlworkbench/tree/master/assets">repository on GitHub</a> . <br><br><h4>  Whence the data </h4><br>  This data was collected by Dr. <a href="https://rachaelorben.dunked.com/red-legged-kittiwake-incubation">Rachel Orben</a> (University of Oregon), Abram Fleischman (State University at San Jose) and Conservation Metrics, Inc.  as part of a major project to study the early breeding period of the red-legged warrior, determine the impact of the factor of accessibility to food and analyze the non-breeding period in the Bering Sea (Alaska). <br><br><h2>  Object detection </h2><br>  Learn more about object detection technologies in <a href="https://blog.athelas.com/a-brief-history-of-cnns-in-image-segmentation-from-r-cnn-to-mask-r-cnn-34ea83205de4">the blog post about convolutional neural networks (CNN)</a> .  Faster R-CNN (Region proposals with Nevus Neural Network) - a relatively new approach (the first <a href="https://arxiv.org/abs/1506.01497">document</a> on this method was published in 2015).  It is widely used by the machine learning community and is now embedded in the most popular deep neural network (DNN) frameworks, including PyTorch, CNTK, Tensorflow, Caffe, and others. <br><br><img src="https://habrastorage.org/webt/no/vl/bx/novlbxlvrgbyrp2ryjwpmqbjonm.jpeg"><br><br>  In this article, we will look at the object detection API using the Faster R-CNN algorithm in the CNTK and Tensorflow frameworks. <br><br><h2>  Azure Machine Learning Workbench </h2><br>  We used the recently announced <a href="https://azure.microsoft.com/en-us/blog/diving-deep-into-what-s-new-with-azure-machine-learning/">Azure Machine Learning Workbench</a> platform to train the model and create web prediction services.  It is a set of analytical tools and allows data managers to prepare data, run machine learning experiments, and deploy models in the cloud environment (see the documentation in the <a href="https://docs.microsoft.com/en-us/azure/machine-learning/preview/quickstart-installation">Installation and Setup</a> section). <br><br>  Since we have to work with images, we used the <a href="https://en.wikipedia.org/wiki/MNIST_database">MNIST</a> handwritten classification patterns in CNTK and Tensorflow - the tool to start the experiment. <br><br><img src="https://habrastorage.org/webt/sx/0l/jg/sx0ljgmheanpa6exu4bevtcdzr0.jpeg"><br><br>  As a rule, deep neural network (DNN) training is performed efficiently using a graphics processor (GPU), which significantly speeds up the execution of a number of operations on matrices.  To train the models, we deployed virtual machines for processing and analyzing data from the GPU and used the Docker remote runtime environment available in the Azure ML Workbench (see the ‚Äú <a href="https://docs.microsoft.com/fi-fi/azure/machine-learning/preview/how-to-use-gpu">Details</a> ‚Äù section and additional information on <a href="https://docs.microsoft.com/en-us/azure/machine-learning/preview/experiment-execution-configuration">target platforms</a> ). <br><br><img src="https://habrastorage.org/webt/ts/zg/io/tszgio65kvuhac2er8sudwxjsgc.jpeg"><br><br>  Azure ML records the results of each task (experiment) in the <a href="https://docs.microsoft.com/en-us/azure/machine-learning/preview/how-to-use-run-history-model-metrics">execution log</a> .  Since various combinations of model parameters were used in the experiments, this possibility turned out to be quite useful: the available visualization tools help to choose the model with the best performance.  Note that you need to add a tool using the <a href="https://docs.microsoft.com/en-us/azure/machine-learning/preview/reference-logging-api">Azure ML logging API</a> to the training / assessment code in order to track the metrics you need (for example, classification accuracy). <br><br><h2>  Image Marking and Export </h2><br>  We used the <a href="https://github.com/CatalystCode/VoTT/releases">VOTT utility</a> (available for Windows and MacOS) to mark up and export data to CNTK and Tensorflow Pascal formats, respectively. <br><br>  This is a tool with a convenient interface for identification, which allows you to mark the necessary areas on images and video.  To work with it, you need to collect images into a folder, then launch VOTT, specify a set of image data and go to the markup of areas. <br><br><img src="https://habrastorage.org/webt/jd/xv/xp/jdxvxpr_c3qu8d53fgk9n4pftiq.jpeg"><br><br>  When finished, click Object Detection, then Export Tags to export to CNTK and Tensorflow. <br><br><img src="https://habrastorage.org/webt/ki/f9/zk/kif9zkbbadl6z0jg579hime5wci.jpeg"><br><br>  In Tensorflow, the export format is VOC Pascal, so we converted the data into TFRecords format for use in training and evaluation.  More details will be given below. <br><br><h2>  CNTK Bird Detection Training </h2><br>  As indicated in the previous section, we used the popular <a href="https://docs.microsoft.com/en-us/cognitive-toolkit/object-detection-using-faster-r-cnn">Faster R-CNN</a> algorithm in the bird detection model.  In this section, we will focus on two aspects of our approach: <br><br><ol><li>  Use the Azure ML Workbench to start learning on remote VMs. </li><li>  Configure hyperparameters through the Azure ML Workbench. </li></ol><br><h4>  Using the Azure ML Workbench for training on a remote VM </h4><br>  Configuring the hyperparameters is the main stage of the process of building ready-to-use machine learning models (or deep learning), provided that the first draft of the model showed good results.  Here the problem lies in the effective implementation and simplification of the process through the Azure ML Workbench. <br><br>  Setting up the parameters requires a large number of learning experiments, which usually takes a very long time.  One of the approaches is based on training on a powerful local computer or cluster.  However, our approach is aimed at learning in the cloud using Docker containers on remote (virtual) machines.  The main advantage is that now we can produce the required number of containers for parallel configuration of parameters.  In accordance with <a href="https://docs.microsoft.com/en-us/azure/machine-learning/preview/tutorial-classifying-iris-part-2">this documentation for Azure ML,</a> you must register each virtual machine as the target of the calculations for the experiment.  Please note that there are restrictions on the password characters, for example, using the "*" symbol in the password will cause an error. <br><br><pre><code class="hljs rust">az ml computetarget attach --name <span class="hljs-string"><span class="hljs-string">"my_dsvm"</span></span> --address <span class="hljs-string"><span class="hljs-string">"my_dsvm_ip_address"</span></span> --username <span class="hljs-string"><span class="hljs-string">"my_name"</span></span> --password <span class="hljs-string"><span class="hljs-string">"my_password"</span></span> --<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">remotedocker</span></span></span></span></code> </pre> <br>  After the command is executed, the files <code>myvm.compute</code> and <code>myvm.rucomfig</code> will be created in the <code>aml_config</code> folder.  Since our task is more suitable for a machine with a GPU, it is necessary to make the following changes: <br><br><h4>  In myvm.compute </h4><br><pre> <code class="hljs objectivec">baseDockerImage: microsoft/mmlspark:plus-gpu<span class="hljs-number"><span class="hljs-number">-0.7</span></span><span class="hljs-number"><span class="hljs-number">.91</span></span> nvidiaDocker: <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><h4>  In myvm.runconfig </h4><br><pre> <code class="hljs objectivec">EnvironmentVariables: <span class="hljs-string"><span class="hljs-string">"STORAGE_ACCOUNT_NAME"</span></span>: <span class="hljs-string"><span class="hljs-string">"STORAGE_ACCOUNT_KEY"</span></span>: Framework: Python PrepareEnvironment: <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br>  We used Azure storage to store training data, pre-trained models, and model checkpoints.  Storage credentials are listed as <code>EnvironmentVariables</code> .  Ensure that the right packages are included in <code>conda_dependencies.yml</code> . <br><br>  Now we can execute the command to start preparing the machine. <br><br><pre> <code class="hljs swift">az ml experiment ‚Äì<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> prepare myvm</code> </pre> <br>  Then we will train the object detection model. <br><br><pre> <code class="hljs pgsql">az ml experiment submit ‚Äìc Detection/FasterRCNN/run_faster_rcnn.py .. .. .. Evaluating Faster R-CNN model <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> images. Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rois <span class="hljs-keyword"><span class="hljs-keyword">before</span></span> non-maximum suppression: <span class="hljs-number"><span class="hljs-number">8099</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rois <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> non-maximum suppression: <span class="hljs-number"><span class="hljs-number">1871</span></span> AP <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kittiwake = <span class="hljs-number"><span class="hljs-number">0.7544</span></span> Mean AP = <span class="hljs-number"><span class="hljs-number">0.7544</span></span></code> </pre><br><h4>  Configure hyperparameters through Azure ML Workbench </h4><br>  Using Azure ML and Workbench, you can easily record hyperparameters and other performance metrics while running multiple containers in parallel (for more information, see the ‚Äú <a href="https://docs.microsoft.com/en-us/azure/machine-learning/preview/how-to-use-run-history-model-metrics">Logging Information</a> ‚Äù section in the documentation). <br><br>  The first approach you should try is to use different pre-trained base models.  At the time of this writing, the CNTK Faster R-CNN API method supported two basic models: <a href="https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf">AlexNet</a> and <a href="https://arxiv.org/pdf/1409.1556.pdf">VGG16</a> .  We can use these trained models to highlight image features.  Despite the fact that these basic models were trained on other data sets, such as <a href="http://www.image-net.org/">ImageNet</a> , at the low and medium level, the characteristics of images are the same in different applications and, therefore, are generally available.  This phenomenon is known as the ‚Äútransfer of learning.‚Äù <br><br>  AlexNet has five convolutional CONV layers, while VGG16 has twelve.  The number of parameters to be trained in VGG16 is 138 million, which is almost three times more than AlexNet;  As a base model, we used VGG16 here.  The following are the VGG16 hyperparameters optimized for best performance on the estimated set. <br><br>  In Detection / FasterRCNN / FasterRCNN_config.py: <br><br><pre> <code class="hljs pgsql"># Learning parameters __C.CNTK.L2_REG_WEIGHT = <span class="hljs-number"><span class="hljs-number">0.0005</span></span> __C.CNTK.MOMENTUM_PER_MB = <span class="hljs-number"><span class="hljs-number">0.9</span></span> # The learning rate multiplier <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> bias weights __C.CNTK.BIAS_LR_MULT = <span class="hljs-number"><span class="hljs-number">2.0</span></span></code> </pre><br>  In Detection / utils / configs / VGG16_config.py: <br><br><pre> <code class="hljs markdown"><span class="hljs-strong"><span class="hljs-strong">__C.MODEL.E2E_LR_FACTOR = 1.0 __</span></span>C.MODEL.RPN<span class="hljs-emphasis"><span class="hljs-emphasis">_LR_</span></span>FACTOR = 1.0 <span class="hljs-emphasis"><span class="hljs-emphasis">__C.MODEL.FRCN_</span></span>LR_FACTOR = 1.0</code> </pre><br>  Azure ML Workbench greatly simplifies the visualization and comparison of different configurations of parameters. <br><br><img src="https://habrastorage.org/webt/4s/kk/ng/4skkngvgm-uh9x0j9eqtndlmjju.jpeg"><br><br><h4>  mAP using the base model VGG16 </h4><br><pre> <code class="hljs pgsql">Evaluating Faster R-CNN model <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> images. Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rois <span class="hljs-keyword"><span class="hljs-keyword">before</span></span> non-maximum suppression: <span class="hljs-number"><span class="hljs-number">6998</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rois <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> non-maximum suppression: <span class="hljs-number"><span class="hljs-number">2240</span></span> AP <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kittiwake = <span class="hljs-number"><span class="hljs-number">0.8204</span></span> Mean AP = <span class="hljs-number"><span class="hljs-number">0.8204</span></span></code> </pre><br>  For implementation instructions, see <a href="https://github.com/olgaliak/detection-amlworkbench/tree/master/CNTK_faster-rcnn">the GitHub repository</a> . <br><br><h2>  Learning a bird detection model with Tensorflow </h2><br>  Recently, Google introduced a powerful <a href="https://research.googleblog.com/2017/06/supercharge-your-computer-vision-models.html">set of APIs</a> for object detection.  We used their animal recognition training documentation using the Google <a href="https://cloud.google.com/blog/big-data/2017/06/training-an-object-detector-using-cloud-machine-learning-engine">Cloud Machine Learning Engine</a> cloud-based machine learning technology, which inspired us to develop a project to train a model for detecting moevs on the Azure ML Workbench.  The Tensorflow Object Discovery API contains many pre-trained <a href="">models</a> on the <a href="http://mscoco.org/">COCO data set</a> .  In our experiments, we used the ResNet-101 ( <a href="https://arxiv.org/abs/1512.03385">deep residual network</a> , 101 layer) as the base model and used the <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/samples/configs/faster_rcnn_resnet101_pets.config">configuration of the</a> animal recognition example to begin setting up the object detection training. <br><br>  <a href="https://github.com/olgaliak/detection-amlworkbench/tree/master/Tensorflow-Object-Detection">This repository</a> contains scripts used to train object detection models using the Azure ML Workbench and Tensorflow. <br><br><h4>  Training preparation </h4><br>  <b>Step 1.</b> Prepare the data in TF Records format, which is required for the Tensorflow Object Discovery API.  For this approach, you need to convert the standard output of the <a href="https://github.com/olgaliak/VoTT/releases">VOTT</a> tool.  See the <a href="https://github.com/olgaliak/detection-amlworkbench/blob/master/Tensorflow-Object-Detection/create_pascal_tf_record.py">create_pascal_tf_record.py</a> universal converter for <a href="https://github.com/olgaliak/detection-amlworkbench/blob/master/Tensorflow-Object-Detection/create_pascal_tf_record.py">details</a> . <br><br><pre> <code class="hljs kotlin">python create_pascal_tf_record.py --label_map_path=/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/pascal_label_map.pbtxt --data_dir=/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/ --output_path=/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>/pascal_train.record --<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>=train python create_pascal_tf_record.py --label_map_path=/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/pascal_label_map.pbtxt --data_dir=/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/ --output_path=/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>/pascal_val.record --<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">val</span></span></code> </pre><br>  <b>Step 2.</b> Create a package of code Tensorflow Object Detection and Slim for further installation in the Docker image that is used for experimentation.  Below are the steps from the Tensorflow <a href="">documentation</a> on object detection: <br><br><pre> <code class="hljs mel"># From tensorflow/models/research/ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> setup.py sdist (cd slim &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> setup.py sdist)</code> </pre><br>  Then move the created tar files to a place available for experimentation (for example, in <code>conda_dependancies.yaml</code> storage) and place the link in <code>conda_dependancies.yaml</code> for the experiment. <br><br><pre> <code class="hljs xml">dependencies: -python=3.5.2 -tensorflow-gpu -pip: #... More dependencies here‚Ä¶ #TF Object Detection -<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://olgalidata.blob.core.windows.net/tfobj/object_detection-0.1_3.tar.gz"</span></span></span><span class="hljs-tag">&gt;</span></span>https:///object_detection-0.1.tar.gz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> -<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://olgalidata.blob.core.windows.net/tfobj/slim-0.1.tar.gz"</span></span></span><span class="hljs-tag">&gt;</span></span>https://<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://olgalidata.blob.core.windows.net/tfobj/object_detection-0.1_3.tar.gz"</span></span></span><span class="hljs-tag">&gt;</span></span>/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://olgalidata.blob.core.windows.net/tfobj/slim-0.1.tar.gz"</span></span></span><span class="hljs-tag">&gt;</span></span>/slim-0.1.tar.gz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>Step 3.</b> In the experiment script add import. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> object_detection.train <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> training_module</code> </pre> <br>  Then call the learning procedure in your code using the training_module (_) function. <br><br><h4>  The process of learning and assessment </h4><br>  Detection of the Tensorflow Object Detection API implies the launch of training and evaluation (checking the current performance of the model) by executing two separate <a href="">commands</a> from the command line.  When running several experiments, it is advisable to periodically run an evaluation (for example, every 100 iterations) to analyze the model‚Äôs ability to recognize objects in hidden data. <br><br>  In the case of Tensorflow Object Detection AP, we added <a href="https://github.com/olgaliak/models/blob/master/research/object_detection/train_eval.py">train_eval.py</a> , which demonstrates an approach to continuous learning and evaluation. <br><br><pre> <code class="hljs lua"> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Total number of training steps {}"</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(train_config.num_steps)) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Evaluation will run every {} steps"</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(FLAGS.eval_every_n_steps)) train_config.num_steps = current_step <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> current_step &lt;= total_num_steps: <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Training steps # {0}"</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(current_step)) trainer.train(create_input_dict_fn, model_fn, train_config, master, task, FLAGS.num_clones, worker_replicas, FLAGS.clone_on_cpu, ps_tasks, worker_job_name, is_chief, FLAGS.train_dir) tf.reset_default_graph() evaluate_step() tf.reset_default_graph() current_step = current_step + FLAGS.eval_every_n_steps train_config.num_steps = current_step</code> </pre><br>  To establish several hyperparameters of the model and assess their impact on the model, we divided the data into training, validation (customizable) and test <a href="https://en.wikipedia.org/wiki/Training,_test_and_validation_sets">sets</a> : 160 images, 54 and 55 images, respectively. <br><br><h4>  Comparing Runs </h4><br>  The Tensorflow object detection framework provides users with various parameter settings, allowing you to choose the best option for a specific data set. <br><br>  In this exercise, we will do several runs and see which one provides the best model performance.  As the target metric, we will use the detection accuracy of the object, which is usually defined as mAP (Mean Average Precision).  In each run, we use <code>azureml.logging</code> to get information about the maximum mAP and identify learning iterations.  In addition, we build a ‚ÄúmAP and iteration‚Äù graph and then save it to the output folder for display in Azure ML Workbench. <br><br><h4>  TensorBoard event integration with Azure ML Workbench </h4><br>  <a href="https://www.tensorflow.org/get_started/summaries_and_tensorboard">TensorBoard</a> is a powerful tool for debugging and visualizing deep neural networks (DNN).  The Tensorflow Object Detection API already provides summary metrics for accuracy.  In this project, we integrated the final Tensorflow events used by TensorBoard for visualization with the Azure ML Workbench. <br><br><pre> <code class="hljs scala">&lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"pl-k"</span></span>&gt;from&lt;/span&gt; tensorboard.backend.event_processing &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"pl-k"</span></span>&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>&lt;/span&gt; event_accumulator &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"pl-k"</span></span>&gt;from&lt;/span&gt; azureml.logging &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"pl-k"</span></span>&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>&lt;/span&gt; get_azureml_logger ea = event_accumulator.<span class="hljs-type"><span class="hljs-type">EventAccumulator</span></span>(eval_path, ...) df = pd.<span class="hljs-type"><span class="hljs-type">DataFrame</span></span>(ea.<span class="hljs-type"><span class="hljs-type">Scalars</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">'Precision</span></span>/mAP@<span class="hljs-number"><span class="hljs-number">0.5</span></span>IOU')) max_vals = df.loc[df[<span class="hljs-string"><span class="hljs-string">"value"</span></span>].idxmax()] #<span class="hljs-type"><span class="hljs-type">Plot</span></span> chart of how mAP changers as training progresses fig = plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), dpi=<span class="hljs-number"><span class="hljs-number">75</span></span>) plt.plot(df[<span class="hljs-string"><span class="hljs-string">"step"</span></span>], df[<span class="hljs-string"><span class="hljs-string">"value"</span></span>]) plt.plot(max_vals[<span class="hljs-string"><span class="hljs-string">"step"</span></span>], max_vals[<span class="hljs-string"><span class="hljs-string">"value"</span></span>], <span class="hljs-string"><span class="hljs-string">"g+"</span></span>, mew=<span class="hljs-number"><span class="hljs-number">2</span></span>, ms=<span class="hljs-number"><span class="hljs-number">10</span></span>) fig.savefig(<span class="hljs-string"><span class="hljs-string">"./outputs/mAP.png"</span></span>, bbox_inches=<span class="hljs-symbol"><span class="hljs-symbol">'tigh</span></span>t') # <span class="hljs-type"><span class="hljs-type">Log</span></span> to <span class="hljs-type"><span class="hljs-type">AML</span></span> <span class="hljs-type"><span class="hljs-type">Workbench</span></span> best mAP of the run <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> corresponding iteration <span class="hljs-type"><span class="hljs-type">N</span></span> run_logger = get_azureml_logger() run_logger.log(<span class="hljs-string"><span class="hljs-string">"max_mAP"</span></span>, max_vals[<span class="hljs-string"><span class="hljs-string">"value"</span></span>]) run_logger.log(<span class="hljs-string"><span class="hljs-string">"max_mAP_interation#"</span></span>, max_vals[<span class="hljs-string"><span class="hljs-string">"step"</span></span>])</code> </pre><br>  For details, see the <a href="https://github.com/olgaliak/detection-amlworkbench/blob/master/Tensorflow-Object-Detection/misc/results_logger.py">results_logger.py</a> code. <br><br>  Here is an analysis of several training runs conducted using the Azure ML Workbench experiment framework. <br><br>  <b>Run # 1</b> uses the stochastic gradient descent method, data augmentation is disabled (for an overview of the possibilities of gradient optimization, see <a href="http://ruder.io/optimizing-gradient-descent/index.html">this</a> blog entry). <br><br>  The execution log in Azure ML Workbench provides details on each run: <br><br><img src="https://habrastorage.org/webt/n0/n2/dv/n0n2dvn_dhykm7qms0jx4n81omm.jpeg"><br><br>  In this case, we see that the maximum mAP value was 93.37% at approximately 3,500 iterations.  Accordingly, a re-training of the model for the training data occurs, and the performance on the test set begins to fall. <br><br>  <b>Run 2</b> uses Adam's advanced optimization algorithm.  All other options are the same. <br><br><img src="https://habrastorage.org/webt/5q/13/rb/5q13rbnvdzrvmze85hshejrlxya.jpeg"><br><br>  Here, the mAP value of 93.6% is achieved much faster than in run 1.  Apparently, the retraining of the model occurs much earlier, since the value of accuracy on the estimated set decreases rapidly. <br><br>  <b>Run 3</b> adds data augmentation to the learning configuration.  For subsequent runs, we will leave the Adam optimization algorithm. <br><br><pre> <code class="hljs">data_augmentation_options{ random_horizontal_flip{} }</code> </pre><br><img src="https://habrastorage.org/webt/az/1a/4s/az1a4s-uzkbmppko-xwizcrbb24.jpeg"><br><br>  Random horizontal display of images allowed to improve the mAP performance from 93.6 in run No. 2 to 94.2%.  It also requires more iterations to retrain the model. <br><br>  <b>Run 4</b> contains more data augmentation parameters. <br><br><pre> <code class="hljs">data_augmentation_options{ random_horizontal_flip{} random_pixel_value_scale{} random_crop_image{} }</code> </pre><br>  The following are interesting results: <br><br><img src="https://habrastorage.org/webt/bk/jf/7i/bkjf7iyosq8i9aludpkilrjuphi.jpeg"><br><br>  Despite the fact that the mAP value is not maximal (91.1%), after 7,000 iterations, no retraining takes place.  At the same time, it is logical to continue learning this model in order to understand whether the value of the mAP can be increased. <br><br>  Here is a brief overview of the learning process using the Azure ML Workbench: <br><br><img src="https://habrastorage.org/webt/ok/ly/kh/oklykhylafsvri3tzd7-3n8aelq.jpeg"><br><br>  Azure ML Workbench allows users to simultaneously compare runs (below are the runs Nos. 1, 3 and 4): <br><br><img src="https://habrastorage.org/webt/m0/rx/u1/m0rxu1iugz1shdqlpruwgby0r38.jpeg"><br><br>  In addition, we can build graphs with the results of assessments on the desired image (s) and also use them when comparing values.  Events TensorBoard already contain all the necessary data. <br><br><img src="https://habrastorage.org/webt/nl/l6/wn/nll6wn97sy3epuxtna1n4kguvx4.jpeg"><br><br>  Thus, the detection of objects based on ResNet allows us to achieve the best results even on small data sets.  The Azure ML Workbench has a useful infrastructure that provides a single area for performing experiments and comparing results. <br><br><h2>  Deploying a web services evaluator </h2><br>  After developing the object detection model and classification with sufficient performance, we proceed to deploying the model as a hosted web service in such a way as to be able to connect to the bird watching application.  We‚Äôll show how this can be done using the built-in Azure ML tools, and how to perform a custom deployment. <br><br><h2>  Web services using Azure ML CLI </h2><br>  Azure ML provides extensive support for operationalizing the model on local computers or the Azure cloud platform. <br><br><h4>  Install Azure ML CLI </h4><br>  Before deploying the model as a web service, you must run SSH on the VM you are using. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ssh</span></span> @</code> </pre> <br>  In this example, we are using a VM to process and analyze Azure data on which the Azure CLI is installed.  When using another VM, install the Azure CLI using: <br><br><pre> <code class="hljs sql">pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> azure-cli pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> azure-cli-ml</code> </pre><br>  Log in using: <br><br><pre> <code class="sql hljs">az login</code> </pre> <br><h4>  Environment preparation </h4><br>  First, register the environment provider with: <br><br><pre> <code class="hljs objectivec">az provider <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> -n Microsoft.MachineLearningCompute</code> </pre> <br>  When deploying a web service on a local computer, first of all you need to prepare the environment: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">az</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ml</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">env</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-l</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Azure region, eg eastus2]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-n</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[environment name]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-g</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[resource group]</span></span></code> </pre> <br>  This step will create a resource group, storage account, Azure Container Registry (ACR), and Application Insights account. <br><br>  Set up the environment as shown: <br><br><pre> <code class="hljs sql">az ml env <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> -n [environment <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>] -g [<span class="hljs-keyword"><span class="hljs-keyword">resource</span></span> <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>]</code> </pre> <br>  Create a model management account: <br><br><pre> <code class="hljs sql">az ml account modelmanagement <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> -l [Azure region, eg eastus2] -n [your <span class="hljs-keyword"><span class="hljs-keyword">account</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>] -g [<span class="hljs-keyword"><span class="hljs-keyword">resource</span></span> <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>] <span class="hljs-comment"><span class="hljs-comment">--sku-instances [number of instances, eg 1] --sku-name [Pricing tier for example S1]</span></span></code> </pre> <br>  Now you can begin to deploy the model!  You can create a service with: <br><br><pre> <code class="hljs mel">az ml service create realtime --model-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> [model <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>/folder path] -f [scoring <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> eg score.py] -n [your service name] -r [runtime <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the Docker <span class="hljs-keyword"><span class="hljs-keyword">container</span></span> eg spark-py or <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>] -c [conda dependencies <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> additional <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> packages]</code> </pre> <br>  Please note that currently nvidia-docker is not available for prediction.  Be sure to change the Conda dependencies to remove any references related to the GPU, such as tensorflow-gpu. <br><br>  After deploying the service, you can view information about how to use the web service with: <br><br><pre> <code class="hljs pgsql">az ml service <span class="hljs-keyword"><span class="hljs-keyword">usage</span></span> realtime -i [your service <span class="hljs-type"><span class="hljs-type">name</span></span>]</code> </pre> <br>  For example, you can test a service using the <code>curl</code> command: <br><br><pre> <code class="hljs erlang-repl">curl -X POST -H <span class="hljs-string"><span class="hljs-string">"Content-Type:application/json"</span></span> --data !! YOUR DATA HERE !! http://<span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span>:<span class="hljs-number"><span class="hljs-number">32769</span></span>/score</code> </pre> <br><h2>  Alternative deployment of evaluating web service </h2><br>  Another way to deploy a web service for prediction is to create your own instance of a <a href="https://sanic.readthedocs.io/en/latest/index.html">Sanic</a> web server. Sanic ‚Äî  - Python 3.5+,   Flask,      -.    ,    CNTK  Faster R-CNN   ,         . <br><br>    - Sanic.       ( <a href="https://github.com/olgaliak/detection-amlworkbench/blob/master/CNTK_faster-rcnn/Detection/app.py">app.py</a> ),   -  ,      .    API   ,  HTTP     . <br><br><pre> <code class="hljs pgsql">app = Sanic(__name__) Config.KEEP_ALIVE = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.set_model() @app.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) async def test(request): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text(<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.server_running()) @app.route(<span class="hljs-string"><span class="hljs-string">'/predict'</span></span>, methods=["POST",]) def post_json(request): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">json</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.predict(request)) app.run(host= <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, port=<span class="hljs-number"><span class="hljs-number">80</span></span>) print (<span class="hljs-string"><span class="hljs-string">'exiting...'</span></span>) sys.<span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br>     -,   ,         . <br><br>  <a href="https://github.com/olgaliak/detection-amlworkbench/blob/master/CNTK_faster-rcnn/Detection/predict.py">predict.py</a> ,    ,     ,             JSON. <br><br><pre> <code class="python hljs">regressed_rois, cls_probs = evaluate_single_image(eval_model, img_path, cfg) bboxes, labels, scores = filter_results(regressed_rois, cls_probs, cfg)</code> </pre><br>  JSON ‚Äî          ,   : <br><br><pre> <code class="javascript hljs">[{<span class="hljs-string"><span class="hljs-string">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kittiwake"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.963"</span></span>, <span class="hljs-string"><span class="hljs-string">"box"</span></span>: [<span class="hljs-number"><span class="hljs-number">246</span></span>, <span class="hljs-number"><span class="hljs-number">414</span></span>, <span class="hljs-number"><span class="hljs-number">285</span></span>, <span class="hljs-number"><span class="hljs-number">466</span></span>]},...]</code> </pre> <br> ,       -,      .    Docker,          . <br><br><pre> <code class="hljs objectivec">cd <span class="hljs-built_in"><span class="hljs-built_in">CNTK_faster</span></span>-rcnn/Detection</code> </pre> <br>   Docker   Dockerfile,         Docker: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> hsienting/dl_az <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> ./ /app <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> run.sh /app/ RUN chmod +x /app/run.sh ENV STORAGE_ACCOUNT_NAME ENV STORAGE_ACCOUNT_KEY ENV AZUREML_NATIVE_SHARE_DIRECTORY /cmcntk ENV TESTIMAGESCONTAINER data EXPOSE <span class="hljs-number"><span class="hljs-number">80</span></span> ENTRYPOINT ["/app/run.sh"]</code> </pre><br>      Docker, : <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">docker</span></span> build -t cmcntk .</code> </pre> <br>   Docker cmcntk   ,        .       -  cmcntk       (   ,    ).      80    80     Docker cncntk. <br><br><pre> <code class="hljs ruby">docker run -v /<span class="hljs-symbol"><span class="hljs-symbol">:/cmcntk</span></span> -p <span class="hljs-number"><span class="hljs-number">80</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">80</span></span> -it <span class="hljs-symbol"><span class="hljs-symbol">cmcntk:</span></span>latest</code> </pre> <br>     -    curl: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">curl</span></span> -X POST http://localhost/predict -H <span class="hljs-string"><span class="hljs-string">'content-type: application/json'</span></span> -d <span class="hljs-string"><span class="hljs-string">'{"filename": ""}'</span></span></code> </pre><br><h2>    </h2><br>    .  What's next?     ?      API?      Conservation Metrics            . <br><br><h4>  Problem </h4><br>  ,     ,  -        .  Including: <br><ul><li>       (  ),      . </li><li>          CORS (      ),      / . </li></ul><br><h3>  Decision </h3><br>      API,    <a href="https://azure.microsoft.com/en-us/services/api-management/">Azure API</a> .            CORS   API. <br><br><h4>   Azure API </h4><br>  : <br><ol><li>  - <a href="https://ms.portal.azure.com/">https://ms.portal.azure.com/#create/hub</a> </li><li>      ¬´API management¬ª ( API). </li><li>     . </li></ol><br>  Configuration: <br><ul><li>   API. </li></ul><br><img src="https://habrastorage.org/webt/u8/6k/ik/u86kik9ookpdsmvu-fu2t56oxdk.jpeg"><br><br>   API: <br><br><img src="https://habrastorage.org/webt/xm/zf/3y/xmzf3yj0j9hqzqhdn8hb7oao1w8.png"><br><br>  ,   API.   ¬´+Add API¬ª (+ API),    ¬´Blank API¬ª ( API).  API ,  Web service URL  API   , API URL suffix  ,     URL-   API,    Products     API-,        . <br><br>   API   ¬´Inbound processing¬ª (  )    ¬´Code View¬ª ( )       (   CORS    URL-): <br><br><pre> <code class="hljs markdown"> <span class="hljs-bullet"><span class="hljs-bullet">* *</span></span></code> </pre><br>     API URL Suffix,       API,        API. <br><br>         <a href="https://manage.windowsazure.com/"></a>  Azure, ,       <a href=""></a>    (  API   CORS). <br><br><h4>   </h4><br>    -   : <br><br><ol><li>    /         Azure. </li><li>      Azure API       . </li><li>     (   )  . </li></ol><br> <a href="https://github.com/olgaliak/detection-amlworkbench/tree/master/sample-visualization">  GitHub</a> . <br><br><h4>     API </h4><br>       API  ¬´¬ª API,   ,         Ocp-Apim-Subscription-Key.        API,      API. <br><br>    : <br><br><ol><li>   ¬´Publisher Portal¬ª ( ) API. </li><li>      . </li><li>   ,    . </li></ol><br>                <code>Ocp-Apim-Subscription-Key</code> : <br><br><pre> <code class="hljs cs">&lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-keyword"</span></span>&gt;export&lt;/span&gt; &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-keyword"</span></span>&gt;<span class="hljs-keyword"><span class="hljs-keyword">async</span></span>&lt;/span&gt; &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-function"</span></span>&gt;&lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-keyword"</span></span>&gt;function&lt;/span&gt; &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-title"</span></span>&gt;cntk&lt;/span&gt;(&lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-params"</span></span>&gt;filename&lt;/span&gt;) &lt;/span&gt;{ &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-keyword"</span></span>&gt;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>&lt;/span&gt; fetch(&lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'/tensorflow/'</span></span>&lt;/span&gt;, { method: &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'post'</span></span>&lt;/span&gt;, headers: { Accept: &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>&lt;/span&gt;, &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>&lt;/span&gt;: &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>&lt;/span&gt;, &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'Cache-Control'</span></span>&lt;/span&gt;: &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'no-cache'</span></span>&lt;/span&gt;, &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'Ocp-Apim-Trace'</span></span>&lt;/span&gt;: &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'true'</span></span>&lt;/span&gt;, &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-string"</span></span>&gt;<span class="hljs-string"><span class="hljs-string">'Ocp-Apim-Subscription-Key'</span></span>&lt;/span&gt;: , }, body: &lt;span <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-built_in"</span></span>&gt;JSON&lt;/span&gt;.stringify({ filename, }), }) }</code> </pre><br><h4>   </h4><br>              . <br><br>         .       - ‚Äî      , : <br><br><pre> <code class="hljs javascript">&lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"xml"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-tag"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">body</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-tag"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">canvas</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-attribute"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">id</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">=</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-value"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'myCanvas'</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-tag"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">canvas</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-tag"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">script</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">const</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> imageUrl = </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-string"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">"some image URL"</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; cntk(imageUrl).then(labels =&gt; { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">const</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> canvas = </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-built_in"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">document</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">.getElementById(</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-string"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'myCanvas'</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">) </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">const</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> image = </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-built_in"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">document</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">.createElement(</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-string"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'img'</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">); image.setAttribute(</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-string"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'crossOrigin'</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-string"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'Anonymous'</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">); image.onload = () =&gt; { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">if</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> (canvas) { </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">const</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> canvasWidth = </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-number"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">850</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">const</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> scale = canvasWidth / image.width; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">const</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> canvasHeight = image.height * scale; canvas.width = canvasWidth; canvas.height = canvasHeight; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-keyword"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">const</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ctx = canvas.getContext(</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-string"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'2d'</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">); </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-comment"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">// render image on convas and draw the square labels</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ctx.drawImage(image, </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-number"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">0</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-number"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">0</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, canvasWidth, canvasHeight); ctx.lineWidth = </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-number"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">5</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; labels.forEach((label) =&gt; { ctx.strokeStyle = label.color || </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-string"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'black'</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; ctx.strokeRect(label.x, label.y, label.width, label.height); }); } }; image.src = imageUrl; }); </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-tag"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">script</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-tag"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">body</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"hljs-tag"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hljs-title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">html</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/span&gt;</span></span></code> </pre><br>      ,      : <br><br><img src="https://habrastorage.org/webt/bd/mz/_0/bdmz_0aatzj73a_fs1kwwacqaci.jpeg"><br><br>           .       <a href="https://github.com/olgaliak/detection-amlworkbench/tree/master/sample-visualization">   GitHub</a> . <br><br><h2>  Conclusion </h2><br>         , : <br><br><ul><li>  ; </li><li>     CNTK/Tensorflow   Azure ML Workbench; </li><li>     Azure ML Workbench; </li><li>     - ; </li><li>      . </li></ul><br><h2>  Resources </h2><br><ul><li> <a href="https://github.com/olgaliak/detection-amlworkbench">  GitHub</a> . </li><li> <a href="https://docs.microsoft.com/en-us/azure/machine-learning/preview/quickstart-installation"></a>    Azure Machine Learning Workbench. </li><li>  GitHub: <a href="https://github.com/Microsoft/CNTK/tree/master/Examples/Image/Detection">   Microsoft Cognitive Toolkit.</a> </li><li>  GitHub: <a href="https://github.com/tensorflow/models/tree/master/research/object_detection">   Tensorflow Object Detection API.</a> </li><li>  : <a href="https://www.microsoft.com/ru-ru/learning/course.aspx%3Fcid%3D20773">Analyzing Big Data with Microsoft R</a> ( <a href="https://www.microsoft.com/ru-ru/learning/exam-70-773.aspx"></a> ), <a href="https://www.microsoft.com/ru-ru/learning/course.aspx%3Fcid%3D20774">Perform Cloud Data Science with Azure Machine Learning</a> ( <a href="https://www.microsoft.com/ru-ru/learning/exam-70-774.aspx"></a> )  <a href="https://www.microsoft.com/ru-ru/learning/course.aspx%3Fcid%3D20775">Performing Data Engineering on Microsoft HD Insight</a> ( <a href="https://www.microsoft.com/ru-ru/learning/exam-70-775.aspx"></a> ). </li></ul><br><hr><br>  We remind you that <a href="https://azure.microsoft.com/ru-ru/free/%3Fwt.mc_id%3DAID570629_QSG_BLOG_139069">you can try Azure for free</a> . </div><p>Source: <a href="https://habr.com/ru/post/342056/">https://habr.com/ru/post/342056/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342044/index.html">Python code generation with Hy</a></li>
<li><a href="../342046/index.html">How to get a DUNS number for free</a></li>
<li><a href="../342048/index.html">Automated workshop - 1. Example ‚ÄúDisplay‚Äù, development of OA and UA</a></li>
<li><a href="../342052/index.html">Normal reset</a></li>
<li><a href="../342054/index.html">Why do we need algorithms and patterns</a></li>
<li><a href="../342058/index.html">We design microservice architecture taking into account failures</a></li>
<li><a href="../342060/index.html">Centralized backup of Mikrotik devices using a bash script</a></li>
<li><a href="../342064/index.html">$ mol_app_life: DIY God Simulator</a></li>
<li><a href="../342066/index.html">Adaptive layout</a></li>
<li><a href="../342070/index.html">Cybersecurity Gap: Next Generation Training</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>