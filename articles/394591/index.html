<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick guide to creating fragment-based navigation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In recent years, it was possible to observe the use of various approaches to building navigation in Android applications. Someone uses only activities...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick guide to creating fragment-based navigation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8a0/f15/e42/8a0f15e42d0e48b293c4f1bb26b04413.jpg"><br><br>  In recent years, it was possible to observe the use of various approaches to building navigation in Android applications.  Someone uses only activities (Activity), someone mixes them with fragments (Fragment) and / or with modified views (Custom View). <br><br>  One of the ways to implement navigation in an application is based on the ‚ÄúOne activity - many fragments‚Äù philosophy.  With this approach, each application screen consists of numerous fragments, with all or most of them contain one activity each.  This solution simplifies the implementation of navigation and improves performance, which has a positive effect on the impression of using the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, we will look at several typical approaches to implementing navigation in Android, and then we will talk about the approach using fragments, comparing it with other approaches.  The demo application, which illustrates the article as an example, can be downloaded from <a href="https://github.com/beczesz/FragmentNavigationPatternDemo">GitHub</a> . <br><a name="habracut"></a><br><h3>  <font color="#018bc7">World Activity</font> </h3><br>  A typical Android application that uses activity has a tree structure (more precisely, the structure of a directed graph), in which the activity, which is initialized when the application starts, is the ‚Äúroot‚Äù.  When using the application, the operating system supports the operation of the back stack.  A simple example: <br><br><img src="https://habrastorage.org/files/d3b/7c7/f71/d3b7c7f714f14e0191415688db460796.jpg"><br><br>  Activity A1 is the entry point of the application (this can be the splash screen or main menu), from which the user can go to A2 or A3.  To organize the interaction between activities, you can use <code><a href="http://developer.android.com/training/basics/intents/result.html"></a> startActivityForResult()</code>  <code><a href="http://developer.android.com/training/basics/intents/result.html"></a> startActivityForResult()</code> , or make common, globally accessible business logic. <br><br>  If you want to add a new activity, you need to perform the following steps: <br><br><ul><li>  Set the activity itself. </li><li>  Register it in <i>AndroidManifest.xml</i> . </li><li>  Open it from another activity using <i>startActivity ()</i> . </li></ul><br>  Of course, the above scheme describes a very simplified approach.  Everything can be much more complicated if you need to <a href="http://stackoverflow.com/questions/4164143/manipulate-the-back-of-the-activity-stack-in-android">manipulate the transition stack backwards</a> .  Or if you want to use the same activity several times: for example, the user will switch between different training screens, each of which will be based on the same activity. <br><br>  Fortunately, we have tools such as <a href="http://developer.android.com/guide/components/tasks-and-back-stack.html">tasks</a> and guidelines for <a href="http://developer.android.com/training/implementing-navigation/temporal.html">working properly with the transition back stack</a> .  However, with the advent of API level 11, fragments were introduced ... <br><br><h3>  <font color="#018bc7">World of fragments</font> </h3><br>  As stated in the official <a href="http://developer.android.com/guide/components/fragments.html">documentation from Google</a> , ‚Äúfragments were introduced in Android 3.0 (API level 11) primarily to create more dynamic and flexible interfaces adapted for large screens, for example, tablets.  They have a much larger screen area than smartphones, respectively, more space for combining and rearranging interface elements.  Thanks to the fragments, you will not have to manage complex changes in the hierarchy of views when creating such interfaces.  By dividing the structure of activity into fragments, you get the opportunity to change its display during the execution of the program, protecting the changes controlled by the activity in the transition stack back. ‚Äù <br><br>  This new tool allowed developers to create interfaces consisting of several separate sections, as well as reuse components in other activities.  Someone likes it, <a href="https://corner.squareup.com/2014/10/advocating-against-android-fragments.html">some don't</a> .  Today, there is a lot of debate about whether to use fragments, but everyone will probably agree that the complexity of development and applications has increased with their appearance, so developers should be well-versed in the proper use of fragments. <br><br><h3>  <font color="#018bc7">Fullscreen snippets as a nightmare</font> </h3><br>  Increasingly, it was possible to find applications in which not part of the screen consists of several fragments, but the entire screen is one fragment placed in activity.  You can even stumble upon crafts in which each activity contains one full-screen fragment, and nothing more.  That is, the activities act exclusively as a container for these fragments.  This approach, in addition to the obvious design error, has another problem.  Take a look at the diagram: <br><br><img src="https://habrastorage.org/files/1af/776/2f3/1af7762f3b9a4585a09891b941ee04c0.jpg"><br><br>  How will A1 interact with F1?  Yes, A1 completely controls F1, because it was she who created it.  For example, A1 might, during creation, pass F1 some bundle, or call its public methods. <br><br>  And how will F1 interact with A1?  Here it is already somewhat more complicated, but you can get out of the situation with the help of the callback / observer technique, in which A1 subscribes to F1, and he notifies his subscriber. <br><br>  Well, what about the interaction between A1 and A2?  This task is solved, for example, using <code>startActivityForResult()</code> . <br><br>  And now the question is: how will F1 and F2 interact with each other?  Even in this case, we may have a public component that contains business logic, which you can use to transfer data.  But this does not always help create a beautiful design.  Suppose F2 has to transfer some data to F1.  When using the callback-technique, F2 can notify A2, it generates some kind of result, A1 gets it and notifies F1. <br><br>  With this approach, you will have to use a lot of template code, which will quickly become a source of bugs, pain and irritation.  And what if we get rid of all these activities, leaving only one of them, putting the rest of the fragments in it? <br><br><h3>  <font color="#018bc7">Method of creating fragment-based navigation</font> </h3><br>  The approach that will be described causes a lot of controversy ( <a href="http://stackoverflow.com/questions/12154505/one-activity-and-all-other-fragments">Example 1</a> , <a href="https://www.reddit.com/r/androiddev/comments/2wsb9w/single_activity_multiple_fragments_architecture/">Example 2</a> ).  Let's look at a specific example. <br><br><img src="https://habrastorage.org/files/552/299/d69/552299d6908449fea4d2e1a6a0660401.jpg"><br><br>  Now we have the only activity left that performs the role of a container.  It contains several fragments that make up the tree structure.  Navigation between them is done using the <code>FragmentManager</code> , which has its own backward transition stack.  Please note that there is no <code>startActivityForResult()</code> , but we can still implement the callback / observer technique.  Let's look at the advantages and disadvantages of this approach. <br><br><h4>  <font color="#018bc7">Benefits:</font> </h4><br><br><h4>  <font color="#018bc7">1. The AndroidManifest.xml file is cleaner and easier to maintain.</font> </h4><br>  Since there is only one activity left, we no longer need to update the manifest each time a new screen is added.  Fragments do not need to declare, in contrast to activities.  At first glance, this is a trifle, but if the application is large and contains several dozen activities, the manifest file will become much more readable. <br><br>  Take a look at the manifest of our sample application containing several screens.  It has very simple content: <br><br><pre> <code class="java hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; <span class="hljs-keyword"><span class="hljs-keyword">package</span></span>=<span class="hljs-string"><span class="hljs-string">"com.exarlabs.android.fragmentnavigationdemo.ui"</span></span> &gt; &lt;application android:name= <span class="hljs-string"><span class="hljs-string">".FragmentNavigationDemoApplication"</span></span> android:allowBackup=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:icon=<span class="hljs-string"><span class="hljs-string">"@mipmap/ic_launcher"</span></span> android:label=<span class="hljs-string"><span class="hljs-string">"@string/app_name"</span></span> android:supportsRtl=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:theme=<span class="hljs-string"><span class="hljs-string">"@style/AppTheme"</span></span>&gt; &lt;activity android:name=<span class="hljs-string"><span class="hljs-string">"com.exarlabs.android.fragmentnavigationdemo.ui.MainActivity"</span></span> android:label=<span class="hljs-string"><span class="hljs-string">"@string/app_name"</span></span> android:screenOrientation=<span class="hljs-string"><span class="hljs-string">"portrait"</span></span> android:theme=<span class="hljs-string"><span class="hljs-string">"@style/AppTheme.NoActionBar"</span></span> &gt; &lt;intent-filter&gt; &lt;action android:name=<span class="hljs-string"><span class="hljs-string">"android.intent.action.MAIN"</span></span> /&gt; &lt;category android:name=<span class="hljs-string"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span> /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt; &lt;/manifest&gt;</code> </pre><br><h4>  <font color="#018bc7">2. Centralized navigation control</font> </h4><br>  After reviewing the application code, you may notice that there is no <code>NavigationManager</code> in it.  In our case, it is embedded in each fragment.  This dispatcher can be used as a center for collecting logs, managing the transition back stack, etc.  Therefore, navigation schemes can be separated from business logic and not distributed across implementations of different screens. <br><br>  Imagine that we need to display a screen on which the user can select several people from the list.  You may need to use filters like age, place of residence or gender. <br><br>  When using several activities, I would have to write: <br><br><pre> <code class="java hljs">Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(); intent.putExtra(<span class="hljs-string"><span class="hljs-string">"age"</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>); intent.putExtra(<span class="hljs-string"><span class="hljs-string">"occupation"</span></span>, <span class="hljs-string"><span class="hljs-string">"developer"</span></span>); intent.putExtra(<span class="hljs-string"><span class="hljs-string">"gender"</span></span>, <span class="hljs-string"><span class="hljs-string">"female"</span></span>); startActivityForResult(intent, <span class="hljs-number"><span class="hljs-number">100</span></span>);</code> </pre><br>  Next you need to set <code>onActivityResult</code> and process the result: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resultCode, Intent data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onActivityResult(requestCode, resultCode, data); }</code> </pre><br>  The problem is that all these arguments are ‚Äúsuperfluous‚Äù and not obligatory.  Therefore, you need to make sure that the activity handles all possible cases when filters are not used.  Later, when some kind of refactoring is done and one of the filters is no longer needed, you will have to find all the places in the code from which this activity starts, and make sure that all filters are working correctly. <br><br>  In addition, it is better to make the result (list of people) come in the form of _List_, and not in the serialized form, which will need to be deserialized. <br><br>  If we use fragment-based navigation, then everything becomes simpler.  It is enough to write the <code>startPersonSelectorFragment()</code> method in <code>NavigationManager</code> with all the necessary arguments for the implementation of callbacks. <br><br><pre> <code class="java hljs">mNavigationManager.startPersonSelectorFragment(<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-string"><span class="hljs-string">"developer"</span></span>, <span class="hljs-string"><span class="hljs-string">"female"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonSelectorFragment.OnPersonSelectedListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPersonsSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Person&gt; selection)</span></span></span><span class="hljs-function"> </span></span>{ [<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> something] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } });</code> </pre><br>  Or with <a href="https://github.com/orfjackal/retrolambda">RetroLambda</a> : <br><br><pre> <code class="java hljs">mNavigationManager.startPersonSelectorFragment(<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-string"><span class="hljs-string">"developer"</span></span>, <span class="hljs-string"><span class="hljs-string">"female"</span></span>, selection -&gt; [<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> something]);</code> </pre><br><h4>  <font color="#018bc7">3. Improving screen interaction</font> </h4><br>  Between activities, only bundles containing primitives or serialized data can be transferred.  And thanks to fragments, it is possible to implement a callback method, when F1, for example, can receive arbitrary objects from F2.  See previous examples of callback implementations that return _List_. <br><br><h4>  <font color="#018bc7">4. Creating a fragment costs less than creating activities</font> </h4><br>  This becomes apparent when using a navigation panel (drawer) containing several menu items that should be displayed on each page. <br><br>  If your navigation is built on activities alone, then each page should inflate and initialize the panel, which consumes a lot of resources. <br><br>  The following diagram shows several root fragments (FR *), which are full-screen.  You can access them directly from the panel, and you can access it only when one of the root fragments is displayed.  The part of the scheme on the right side of the dotted line is an example of an arbitrary navigation scheme. <br><br><img src="https://habrastorage.org/files/3f5/f64/13f/3f5f6413f30e4d1d8267f5983d55b3dc.jpg"><br><br>  Since the panel is located inside the container, we have only one copy of it.  Therefore, the panel should be visible at each stage of navigation; it <a href="http://stackoverflow.com/questions/19451715/same-navigation-drawer-in-different-activities">does not need to be ‚Äúinflated‚Äù and initialized again</a> .  It's not entirely clear how this works?  Analyze the sample application, it demonstrates the use of the panel. <br><br><h4>  <font color="#018bc7">disadvantages</font> </h4><br>  Starting to implement fragment-based navigation, it would be very unpleasant to delve into the development and face some unforeseen, intractable problems associated with the additional complexity of using fragments, third-party libraries and different versions of the OS.  And if you have to refactor all that we have already written? <br><br>  Indeed, it is necessary to solve problems associated with <a href="http://developer.android.com/about/versions/android-4.2.html">nested fragments</a> , as well as with third-party libraries, also using fragments, like <a href="https://www.shinobicontrols.com/">ShinobiControls</a> , <a href="http://developer.android.com/reference/android/support/v4/view/ViewPager.html">ViewPagers</a> and <a href="http://developer.android.com/reference/android/support/v4/app/FragmentStatePagerAdapter.html">FragmentStatePagerAdapters</a> . <br><br>  It must be said that it may take a lot of time to gain sufficient experience to cope with difficulties.  True, their presence is most often caused by an incomplete understanding of the features of working with fragments, and not by the viciousness of the idea itself.  Perhaps you already have enough experience and you will not face any problems at all. <br><br>  So the only drawback worth mentioning is the lack of good libraries, which would reflect all the complex scenarios from complex applications, whose navigation is built on fragments. <br><br><h3>  <font color="#018bc7">Conclusion</font> </h3><br>  In this article we looked at one of the approaches to the implementation of navigation in Android applications.  A comparison was made with the traditional approach, which implies the use of activities, which revealed a number of advantages in comparison with the ‚Äúclassics‚Äù. <br><br>  In case you haven‚Äôt seen the sample application yet, welcome to <a href="https://github.com/beczesz/FragmentNavigationPatternDemo">GitHub</a> .  You can freely fork or supplement it with more successful and visual solutions. </div><p>Source: <a href="https://habr.com/ru/post/394591/">https://habr.com/ru/post/394591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../394581/index.html">A crisis. The popularity of pirated software has grown in Russia for the first time.</a></li>
<li><a href="../394583/index.html">How we achieved energy savings in lighting and developed more energy with a luxmeter</a></li>
<li><a href="../394585/index.html">How to make a keyboard - Matrix</a></li>
<li><a href="../394587/index.html">Facebook users prefer to watch videos without sound</a></li>
<li><a href="../394589/index.html">Crowdfunding for the smallest (part 1)</a></li>
<li><a href="../394595/index.html">As astronauts on the ISS, the BEAM module was inflated: time-lapse video</a></li>
<li><a href="../394597/index.html">World record of wireless data transmission: 6 Gbit / s at 37 kilometers</a></li>
<li><a href="../394599/index.html">Stable version of Krita 3.0 editor with animation support</a></li>
<li><a href="../394601/index.html">Hyperloop trains will make vibranium</a></li>
<li><a href="../394603/index.html">Discovered planet closest to us, capable of supporting life</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>