<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Replacing ctags for perl in mooedit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the mooedit editor there is a plugin for outputting source names. It uses the standard ctags , which with Perl work, to put it mildly, is not a fou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Replacing ctags for perl in mooedit</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://sourceforge.net/projects/mooedit/">mooedit</a> editor <a href="https://sourceforge.net/projects/mooedit/">there</a> is a plugin for outputting source names.  It uses the standard <a href="http://ctags.sourceforge.net/">ctags</a> , which with Perl work, to put it mildly, is not a fountain.  <i>Ctags</i> only finds function names, but I would like more: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e53/3b1/1db/e533b11db3339e44cd636c10324253fb.png" width="482" height="230"><br><br><a name="habracut"></a><br>  First, let's try to see how the <i>ctags</i> call for Perl happens and think about how to replace the utility for this case.  After looking at <b>moo / plugins / ctags / ctags-doc.c</b> , it becomes clear that the call in our case is this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">ctags -u --fields=afksS --excmd=number -f <span class="hljs-string"><span class="hljs-string">'_'</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span></code> </pre> <br><br>  There is no explicit indication that Perl is here.  Therefore, we will catch the situation using the <i>file</i> utility.  Create a file <b>~ / bin / ctags</b> , which will be called instead of the system <i>ctags</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash FILE=`file $6 2&gt;&amp;1` RX='Perl.*' if [[ "$FILE" =~ $RX ]] ; then ~/bin/perltags $6 &gt; $5 else /usr/bin/ctags "$@" fi</span></span></code> </pre> <br><br>  Now you need to think what it will be like <b>~ / bin / perltags</b> .  In principle, the <i>pltags</i> and <i>perltags</i> utilities are familiar to <i>vim</i> users, but they also did not satisfy me at all.  <a href="http://search.cpan.org/~osfameron/Perl-Tags-0.28/bin/perl-tags">Perl-tags</a> utility was found in CPAN.  But to be used with <i>mooedit,</i> you would still have to modify it with a file, so (and just for fun) decided to write your <i>own</i> . <br><br>  First, let's deal with the format.  After running <i>ctags, the</i> editor expects these lines: <br><br><pre> <code class="dos hljs">  _;" kind</code> </pre> <br><br>  <b>kind</b> (in the terminology of offal mooedit) is a type of name ( <b>f</b> is a function, <b>v</b> is a variable, etc). <br><br>  Two characters ( <b>; "</b> ) are added to the tail of the line number - this is not a typo; without them, the editor simply drops (apparently, a bit after <i>--excmd = number</i> ). <br><br>  With this like everything, now you need to understand what exactly is parsit.  We don‚Äôt need a deep analysis of the source code, but we don‚Äôt need to disassemble the source code - not comme il faut.  Therefore we take <a href="">PPI</a> , and after some time appears <div class="spoiler">  <b class="spoiler_title">Here is such a script:</b> <div class="spoiler_text"><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl # ------------------------------------------------------------------------------ use 5.010; use strict; use PPI; my %variables; my %scheduled; my %subs; # ------------------------------------------------------------------------------ die "Usage: $0 file\n" unless $ARGV[0]; my $doc = PPI::Document-&gt;new( $ARGV[0] ); die "'$ARGV[0]', PPI::Document error!\n" unless $doc; # ------------------------------------------------------------------------------ my @tokens = $doc-&gt;children; foreach my $token ( @tokens ) { given ( $token-&gt;class ) { process_statement( $token ) when 'PPI::Statement'; process_variable( $token ) when 'PPI::Statement::Variable'; process_sub( $token ) when 'PPI::Statement::Sub'; process_scheduled( $token ) when 'PPI::Statement::Scheduled'; } } print_names( \%variables, 'v' ); print_names( \%subs, 'f' ); print_names( \%scheduled, 'p' ); # ------------------------------------------------------------------------------ sub add_name { my ( $list, $token, $content ) = @_; # $content    ,    -, ,    my $name = $token-&gt;content; $list-&gt;{$name} = () unless exists $list-&gt;{$name}; $list-&gt;{$name}-&gt;{ $token-&gt;line_number } = $content; } # ------------------------------------------------------------------------------ sub print_names { my ( $list, $type ) = @_; foreach my $name ( sort { my $an = $a =~ /^[\$\%\@](.+)$/ ? $1 : $a; my $bn = $b =~ /^[\$\%\@](.+)$/ ? $1 : $b; lc $an cmp lc $bn; } keys $list ) { foreach my $line ( sort { $a &lt;=&gt; $b } keys $list-&gt;{$name} ) { print "$name:$line\t$ARGV[0]\t$line;\"\t$type\n"; } } } # ------------------------------------------------------------------------------ # @EXPORT = qw(aaa), @EXPORT_OK = qw(bbb); # ------------------------------------------------------------------------------ sub process_statement { my ( $tok ) = @_; my @tokens = $tok-&gt;children; return unless $#tokens &gt; 0; foreach my $token ( @tokens ) { add_name( \%variables, $token, $tok-&gt;content ) if $token-&gt;class eq 'PPI::Token::Symbol'; } } # ------------------------------------------------------------------------------ # sub aaa($$$); # sub aaa{}; # ------------------------------------------------------------------------------ sub process_sub { my ( $tok ) = @_; my @tokens = $tok-&gt;children; return unless $#tokens &gt; 1; shift @tokens; foreach my $token ( @tokens ) { next if $token-&gt;class eq 'PPI::Token::Whitespace' or $token-&gt;class eq 'PPI::Token::Comment' or $token-&gt;class eq 'PPI::Token::Pod'; #     'sub'   PPI::Token::Word: return unless $token-&gt;class eq 'PPI::Token::Word'; add_name( \%subs, $token, $tok-&gt;content ); last; } } # ------------------------------------------------------------------------------ # my $aaa; # our ($aaa, $bbb); # ------------------------------------------------------------------------------ sub process_variable { my ( $tok ) = @_; my @tokens = $tok-&gt;children; foreach my $token ( @tokens ) { #    -   : process_variable( $token ), next if $token-&gt;class eq 'PPI::Structure::List'; process_variable( $token ), next if $token-&gt;class eq 'PPI::Statement::Expression'; add_name( \%variables, $token, $tok-&gt;content ) if $token-&gt;class eq 'PPI::Token::Symbol'; } } # ------------------------------------------------------------------------------ # BEGIN {}; CHECK, UNITCHECK, INIT, END # ------------------------------------------------------------------------------ sub process_scheduled { my ( $tok ) = @_; my @tokens = $tok-&gt;children; return unless $#tokens &gt; 0; add_name( \%scheduled, $tokens[0], $tok-&gt;content ); } # ------------------------------------------------------------------------------</span></span></code> </pre> </div></div><br><br>  What he can do: <br><ul><li>  Finding function names, including ads </li><li>  Find the names of global variables, including their occurrences in expressions </li><li>  Find blocks BEGIN, END etc </li></ul><br>  Each name is appended with the number of the found string (for orientation), and from the window of the plug-in you can go through all the entries of the tags, and not just the first one.  Moreover, functions, variables and blocks do not fall into the general list, but are grouped together: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a73/2bc/f28/a732bcf289770d8fc0dad77e07420a24.png" width="812" height="420"></div><p>Source: <a href="https://habr.com/ru/post/208754/">https://habr.com/ru/post/208754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208736/index.html">Why subscribers leave you</a></li>
<li><a href="../208744/index.html">Virgin Galactic conducted the third supersonic flight, reaching a new height</a></li>
<li><a href="../208746/index.html">LXC (Linux Containers) - is everything really good?</a></li>
<li><a href="../208748/index.html">How to use Memcached with Ruby on Rails in Ubuntu 12.04 LTS</a></li>
<li><a href="../208752/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 91 (January 5 - 11, 2014)</a></li>
<li><a href="../208756/index.html">Code Reuse in Go with an Example</a></li>
<li><a href="../208760/index.html">The programmer is preparing to receive investments: a step by step guide</a></li>
<li><a href="../208764/index.html">Extraction of "knowledge" or classification into one if</a></li>
<li><a href="../208766/index.html">Dropbox crash</a></li>
<li><a href="../208768/index.html">Get rid of extra $ watch'erov</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>