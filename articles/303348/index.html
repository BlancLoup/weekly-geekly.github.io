<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of code style in development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day,% username% 

 I want to share my successful experience in the implementation of automatic verification of code styles in a project and tell ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of code style in development</h1><div class="post__text post__text-html js-mediator-article">  Good day,% username% <br><br>  I want to share my successful experience in the implementation of automatic verification of code styles in a project and tell what rakes they attacked.  Publish opensource community tools that were created to solve the problem <br><br>  A little bit about our project: PHP site, lies in the git repository of 2Gb, consists of 20k php files, the age of the project is 10 years, currently we have 15 developers.  For code review, use <a href="https://ru.atlassian.com/software/bitbucket/server">atlassian stash</a> .  All development is carried out within the framework of separate branches, which, after passing the code review, are poured into the master and deployed to the prod <br><a name="habracut"></a><br>  For a start, the question is: why?  Why even follow the code styles? <br>  The answer for me is simple: the code is written once, and then read by dozens of people over the years.  Consequently, the cost of maintaining the code is many times the cost of writing.  And if so, then it is worth spending a little time and formatting the code according to no one standard. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first thing that came across: what standard to choose?  We did this - we created our own standard, inherited from symfony, and we make changes there according to our idea of ‚Äã‚Äãbeauty.  We simply threw out some rules as impossible in our project for old classes (for example, the fact that any class must be inside the namespace).  Good phpcs is a good opportunity to customize code styles <br><br>  Second: how to check the code?  What are the utilities for this?  After a brief search, we stopped at phpcs, as there is native support in phpstorm <br><br>  Third: what to check?  Our whole project is huge, it was written over a decade by many generations of developers.  Errors in the styles there are simply Nemer.  Therefore, they decided that it is necessary to check only those strings that were changed by the developer within the framework of this task. <br><br>  Third: how to actually check the code? <br>  There were different options <br><ul><li>  As you know, git supports server hooks.  You can check the styles on the server side and keep them from running until errors are corrected.  But I didn‚Äôt like this approach, since it‚Äôs not very convenient to push buttons with git in the console :) Plus, it‚Äôs impossible to make a workaround when it‚Äôs impossible to correct any errors in styles for some reason (for example, you need to rename the name of the method that used in 100,500 files) <br></li><li>  After some thoughts, it was decided that the ideal option would be when the robot would unsubscribe itself in a pull request about the found errors in the styles that the developer already had to correct.  At the same time, at the first stage, we allowed some errors not to be corrected, if this required essentially refactoring, we modified the check rules that were convenient for us.  So the tool was born - <a href="https://github.com/WhoTrades/phpcs-stash">phpcs-stash</a> <br></li></ul><br><br>  A little bit about the architecture of the tool: <br>  1) When pushing to some branch, the webhook jerks the phpcs-stash and transfers the name of the branch where the push was made <br>  2) phpcs-stash requests the stash with all the reviews (pull requests) from this branch, goes through all the files (pulls them from the API as well), checks the styles, unsubscribes where it found an error.  If there are no errors, adjust the review.  The robot is unsubscribed only in modified lines. <br>  The result looks like this: <br><img src="https://habrastorage.org/files/c62/d96/683/c62d966833d4485a900d6a6f18922438"><br>  3) When re-pushing, the robot re-checks all reviews, deletes comments about the corrected errors <br><br>  For lovers of pictures: <br><img src="https://habrastorage.org/getpro/habr/post_images/142/bd7/c65/142bd7c650824e2ca8717d6ae24d925e.png"><br><br>  With this approach, we still have the opportunity to customize native integration between stash and jira (for example: do not allow the task to be closed if the code review is not approved by the robot).  And there is a great opportunity to analyze what errors happen most often, which would refine the verification rules <br><br>  Since the verification system is not aware of anything other than the atlassian stash, it was decided to make it oriented in open source.  Initially, it was done only for PHP, but the guys from the neighboring department liked it and they did support verification of C ++ code <br><br>  For quick feedback, use phpstorm, which can integrate with phpcs.  It looks like this: <br><img src="https://habrastorage.org/files/0d3/d85/abf/0d3d85abff1049af95cff4dc36595b8b.png"><br><br>  What's next? <br><br>  There is an idea to make the checker interactive: so that you can respond to the robot's comment ‚Äúcorrect‚Äù, and the robot would correct the error itself if it can be corrected (for example, the missing space).  But, unfortunately, I did not find tools that can fix styles in a particular string.  If the community prompts, I will be glad <br><br>  References: <br><ul><li>  phpcs-stash - <a href="https://github.com/WhoTrades/phpcs-stash">https://github.com/WhoTrades/phpcs-stash</a> </li><li>  Atlasis Stash REST API - <a href="https://developer.atlassian.com/stash/docs/latest/reference/rest-api.html">https://developer.atlassian.com/stash/docs/latest/reference/rest-api.html</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/303348/">https://habr.com/ru/post/303348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303338/index.html">Generating passwords for Road Rash 1 and 2 games</a></li>
<li><a href="../303340/index.html">Entertaining C #</a></li>
<li><a href="../303342/index.html">Algorithm for calculating the real roots of polynomials</a></li>
<li><a href="../303344/index.html">The book "A good interface is an invisible interface"</a></li>
<li><a href="../303346/index.html">SQL Server 2016 Stretch Database</a></li>
<li><a href="../303350/index.html">Responsible approach to measuring relative humidity</a></li>
<li><a href="../303352/index.html">Proper use of require in node.js</a></li>
<li><a href="../303354/index.html">Music as a startup, or why iTunes is evil</a></li>
<li><a href="../303358/index.html">Russia's place in the global digital transformation</a></li>
<li><a href="../303360/index.html">We work with a budget institution. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>