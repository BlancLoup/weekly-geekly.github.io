<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>XKB: reconfigure the keys for a loved one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One fine day bothers you to press Shift to get the ~ character instead of ` . 
 Bothers to reach Esc, while using the CapsLock key to use RARE. 
 Both...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>XKB: reconfigure the keys for a loved one</h1><div class="post__text post__text-html js-mediator-article">  One fine day bothers you to press Shift to get the <b>~</b> character instead of <b>`</b> . <br>  Bothers to reach Esc, while using the CapsLock key to use RARE. <br>  Bothers to move the brush down and press it with a weak little finger, or, God forbid, reach for it with your thumb. <br>  It bothers to climb PgUp, PgDn, Home and End, moving your hand each time just to squander the page down. <br>  Bothers every time you make a typo, look at the keyboard with anger in search of the Backspace button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/947/6d5/1c0/9476d51c0d4ee22c1cffe45cb253208f.jpg"><br><br>  Today we will learn how to permanently get rid of these torments. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Why is this all about? </h3><br>  To press less keys.  To stretch your fingers less to those keys that are often pressed.  To hands less tired.  To make it easier to remember what is where.  To print faster in the end. <br><br>  Many layouts for printing (Dvorak, Colemak, etc.) greatly improve the location of the keys, putting them closer to those places where you need to reach less.  But they completely forget about modifiers, specials.  characters and command keys (Enter, Backspace, Tab, Esc, Delete).  And we will think about how to improve the status quo. <br><br>  The article will go from the simplest changes to more interesting and deep tuning.  And, as in the end of good films, I will leave the reader to think about what to do next, and I will not give a ready-made recipe for everything.  In the end, there are no ideal and universal solutions, and there are no comrades for the keyboard layout. <br><a name="habracut"></a><br><h3>  First steps cripples </h3><br>  Standard layout needs to be modified by itself.  This can be done in many ways.  I don‚Äôt think that someone is using exotic ibus, Fcitx, SCIM or UIM, so I‚Äôll assume that everyone has a standard X Keyboard extension, XKB.  It is worth noting that in the future on the desktop Wayland, XKB, is likely to remain responsible for the keyboard, as well as in Xorg.  If suddenly there are brave souls who are already working with XWayland, share your impressions of whether what I have described works for you.  I can‚Äôt say anything about Canonical‚Äôs alternative Wayland Mir, except that they are unlikely to take on rewriting the keyboard interaction subsystem. <br><br>  The first thing that comes to mind is to use some kind of graphical utilities.  To be honest, I missed this step, and immediately used xmodmap.  Below, I will tell you what is wrong with this approach and how to do it correctly. <br><br>  Xmodmap allows, for example, swapping <b>;</b>  and <b>:,</b> this is especially useful for those who program in a modern language that no longer requires a mandatory semicolon at the end of a line.  Even in JavaScript, this is no longer necessary.  And this simple command helps: <br><pre><code class="hljs ruby">$ xmodmap -e <span class="hljs-string"><span class="hljs-string">"keycode 47 = colon semicolon Cyrillic_zhe Cyrillic_ZHE"</span></span></code> </pre> <br>  You need to run it from .xsession or .xinitrc.  The last two arguments in quotes will help not to lose the letter  and <b></b> when exchanging. <br><br>  But such, for example, swaps <b>~</b> and <b>`</b> : <br><pre> <code class="hljs ruby">$ xmodmap -e <span class="hljs-string"><span class="hljs-string">"keycode 49 = asciitilde grave Cyrillic_io Cyrillic_IO"</span></span></code> </pre><br><h3>  Switch Layouts </h3><br>  Do you often have to use Alt?  If suddenly not, and I, I noticed, have to do it only in rich menu interfaces, such as Gimp or LibreOffice, then it can be used as a right Alt switch, known as AltGr: <br><pre> <code class="hljs mel">$ setxkbmap -<span class="hljs-keyword"><span class="hljs-keyword">layout</span></span> us,ru -option grp:<span class="hljs-keyword"><span class="hljs-keyword">toggle</span></span></code> </pre><br><h3>  Esc vs CapsLock </h3><br>  Many who often use Vim, or use vi combinations in the console, and those who swear little on the forums, prefer to have Escape on the CapsLock key: <br><pre> <code class="hljs ruby"> $ xmodmap -e <span class="hljs-string"><span class="hljs-string">"clear lock"</span></span> $ xmodmap -e <span class="hljs-string"><span class="hljs-string">"keycode 0x42 = Escape"</span></span></code> </pre><br>  The same can be done a little easier: <br><pre> <code class="hljs pgsql"> setxkbmap -<span class="hljs-keyword"><span class="hljs-keyword">option</span></span> caps:<span class="hljs-keyword"><span class="hljs-keyword">escape</span></span></code> </pre><br>  Or even like this, keeping CapsLock in place of the old Escape in case of correspondence in a raised voice: <br><pre> <code class="hljs pgsql"> setxkbmap -<span class="hljs-keyword"><span class="hljs-keyword">option</span></span> caps:swapescape</code> </pre><br>  Whence these mysterious parameters, we will find out a little later. <br><br><h3>  Little flowers </h3><br>  Probably, I will surprise you if I say that what we did before was not entirely correct.  setxkbmap is still nothing, but xmodmap appeared before XKB, and lives only for compatibility.  Moreover, he knows nothing about half the keys, his syntax and principle of operation is more than mysterious, he translates keycode and keysym, and in some cases back.  There is no point in understanding this, because at some point he will die off, and all your tricks will need to be repeated, only with the help of another utility, and you will become frustrated and in spite of everything you will start typing with two index fingers. <br><br>  So, it all works up to one beautiful moment, until you begin to understand that there are a lot of necessary keys, and the fingers that lie on the home line (ASDF JKL;) do not reach everyone. <br>  For example, I often use the key with the designation Win, which is a mod4 modifier.  It is located on my keyboard is not very convenient, namely, between the left Alt and Ctrl. <br><br><h3>  The right way </h3><br>  Do it all right with xkbcomp.  The name of the utility, as well as man to it, give little information about what it does.  Allegedly translates textual descriptions of the keyboard layout into a binary format.  In fact, it also loads them.  Let's try to understand how to do what we have already done, only with its help. <br><br>  Remember, many people on the Internet advise you to modify the files contained in / usr / share / X11 / xkb / symbols, namely us, pc and ru.  Do not do this.  These are files that affect the entire system at once.  For other users (if you suddenly have one), and if you are messing with something there, then typing, even the login and password, is more difficult.  You don‚Äôt even need to put the modified files there, and you don‚Äôt need to write anything in evdev.xml. <br><br>  <b>Important:</b> if you suddenly do something wrong, then rebooting the X will help you.  There is a simpler way, you can run the setxkbmap command without parameters, and it will reset almost all of your settings to the default layout. <br><br>  First of all, we need to know the current layout settings, we need to do this before all the manipulations: <br><pre> <code class="hljs mel">$ setxkbmap -<span class="hljs-keyword"><span class="hljs-keyword">layout</span></span> us,ru -<span class="hljs-keyword"><span class="hljs-keyword">print</span></span></code> </pre><br>  At the output we get something like this: <br><pre> <code class="hljs pgsql">xkb_keymap { xkb_keycodes { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "evdev+aliases(qwerty)" }; xkb_types { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "complete" }; xkb_compat { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "complete" }; xkb_symbols { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc+us+ru:2+inet(evdev)" }; xkb_geometry { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc(pc104)" }; };</code> </pre><br>  Let's write all this into a file, and follow the <a href="http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html">instructions of the XDG</a> , and put it in ~ / .config / xkb / my. <br><br>  In this file, we are most interested in the xkb_symbols line, the rest will remain unchanged.  Let's expand the curly braces, and change this line to the following: <br><pre> <code class="hljs pgsql">xkb_keymap { xkb_keycodes { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "evdev+aliases(qwerty)" }; xkb_types { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "complete" }; xkb_compat { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "complete" }; xkb_geometry { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc(pc104)" }; xkb_symbols "my" { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc+us+ru:2+inet(evdev)" key &lt;AC10&gt; { [ colon, semicolon ] }; key &lt;TLDE&gt; { [ asciitilde, grave ] }; }; };</code> </pre><br>  Well, cross your fingers, and load this configuration: <br><pre> <code class="hljs perl">$ xkbcomp $HOME/.config/xkb/<span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $DISPLAY</code> </pre><br>  We try.  If when you press the key on which you have the letter , the symbol is printed:, but not;, and when you press Y, a tilde is printed ~, and with Shift everything happens the other way around, then we are on the right track. <br><br>  It is worth noting that there is no need to bother with Cyrillic_zhe Cyrillic_ZHE, everything works and so. <br><br>  Go ahead.  What did we do?  We ran setxkbmap -option with a parameter.  Let's see what it changes. <br><pre> <code class="hljs pgsql">$ setxkbmap -print | grep symbols xkb_symbols { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc+us+ru:2+inet(evdev)" }; $ setxkbmap -<span class="hljs-keyword"><span class="hljs-keyword">option</span></span> caps:<span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> $ setxkbmap -print | grep symbols xkb_symbols { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc+us+ru:2+inet(evdev)+capslock(escape)" };</code> </pre><br>  Great, now it seems clear that the layout is changing by including some options. <br>  In our my file, we add the following line to the xkb_symbols section, immediately after the already existing include: <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "capslock(escape)"</code> </pre><br>  It should be noted that the semicolon after the include is not needed, in contrast to the semicolon in other places of this configuration file. <br>  If you look closely, you get the understanding that these two ways of recording are identical: <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc+us+ru:2+inet(evdev)" <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "capslock(escape)"</code> </pre><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc+us+ru:2+inet(evdev)+capslock(escape)"</code> </pre><br>  In this case, the first is much more visual. <br><br>  What does this mean?  We load our layout, we say that we have qwerty (xkb_keycodes), that we have 104 keys (xkb_geometry), and we redefine characters.  At the same time, in the symbols section we include entirely several configuration files, pc, us, ru.  Where do they lie, can I look at them?  Naturally, they all lie in / usr / share / X11 / xkb / symbols.  Seeing them is useful, especially if you are thinking of doing something more ambitious than we have already done. <br>  Well, where are those files that determine that CapsLock and Escape need to be swapped?  Yes there.  It looks like this: <br><pre> <code class="hljs objectivec">partial hidden modifier_keys xkb_symbols <span class="hljs-string"><span class="hljs-string">"swapescape"</span></span> { key &lt;<span class="hljs-built_in"><span class="hljs-built_in">CAPS</span></span>&gt; { [ Escape ] }; key &lt;ESC&gt; { [ Caps_Lock ] }; }; partial hidden modifier_keys xkb_symbols <span class="hljs-string"><span class="hljs-string">"escape"</span></span> { key &lt;<span class="hljs-built_in"><span class="hljs-built_in">CAPS</span></span>&gt; { [ Escape ] }; };</code> </pre><br>  What is partial?  This is a piece of the layout, which can be included in another layout.  In some configuration files, generous authors even added comments.  But not all. <br><br>  Why we simply do not do the partial, and we do not include it?  To my shame, I am ready to admit that I tried to do it by descriptions, but it did not work out for me. <br><br><div class="spoiler">  <b class="spoiler_title">How to do it in theory</b> <div class="spoiler_text">  You do not need to put the whole xkb_keymap into the layout file, you only need to section xkb_symbols: <br><br><pre> <code class="hljs pgsql"> xkb_symbols "my" { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "pc+us+ru:2+inet(evdev)" key &lt;AC10&gt; { [ colon, semicolon ] }; key &lt;TLDE&gt; { [ asciitilde, grave ] }; };</code> </pre><br><br>  The download should go with the command: <br><pre> <code class="hljs perl">setxkbmap -I$HOME/.config/xkb <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">print</span></span> | xkbcomp - $DISPLAY</code> </pre><br>  Alas, the output of setxkbmap does not change from any parameters, except in one case: <br><pre> <code class="hljs perl">setxkbmap -I$HOME/.config/xkb -symbols <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">print</span></span></code> </pre><br>  But, alas, in the case of the transfer of this output to xkbcomp, it gives an error. <br><br>  Some even advise instead of $ DISPLAY to write $ {DISPLAY %%. *} <br></div></div><br>  <b>PS</b> Habrayuzer <a href="https://habrahabr.ru/users/kodx/" class="user_link">kodx</a> found out <a href="http://habrahabr.ru/post/222285/">how to do it right</a> . <br><br><h3>  Berries </h3><br>  I don't want to just escape to CapsLock.  I want to control too. <br>  How?  How is this possible?  It's time for magic. <br><br>  First, let's make it so that when you click on CapsLock, you get LCTL by adding this to the xkb_symbols section: <br><pre> <code class="hljs sql"> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> &lt;CAPS&gt; { [ Control_L ] }; <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> &lt;LCTL&gt; { [ Caps_Lock ] };</code> </pre><br>  The second line is needed in order to get rid of the bad habit of pressing the old left Ctrl.  You can slightly soften it: <br><pre> <code class="hljs sql"> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> &lt;LCTL&gt; { [ VoidSymbol ] };</code> </pre><br>  Now we need a <a href="https://github.com/alols/xcape">xcape's eye</a> , which allows us to assign a second action to the modifier.  So, if it is pressed in combination with some alphanumeric key, it works as a modifier, and if it is pressed and released alone, it works somehow differently, as we want.  To battle! <br><pre> <code class="hljs ruby">$ xcape -t <span class="hljs-number"><span class="hljs-number">1000</span></span> -e <span class="hljs-string"><span class="hljs-string">"Control_L=Escape"</span></span></code> </pre><br>  xcape is demonized <s>by the action of a woodpecker's eye</s> .  It is also worth noting the interesting parameter -t 1000. No, he does not call the terminator, he says that if we pressed the left Ctrl and kept it pressed for more than 1000 ms, then Escape will not work.  Excellent option for indecisive. <br><br>  Among the shortcomings of this approach, we can call the fact that Escape will work not by pressing, but by releasing the key.  To some, this delay is not terrible, but to someone it will be critical.  And someone will compromise. <br><br><h3>  Bonus </h3><br>  For any useful, but rare characters, there is such a thing as <a href="http://en.wikipedia.org/wiki/Compose_key">Compose Key</a> , which, after pressing and releasing it, allows you to type some sequence that corresponds to some Unicode character, which will appear on the screen.  For example, the sequence of clicks "Compose oo" will display the symbol <b>¬∞</b> .  And ‚ÄúCompose cccp‚Äù will issue <b>‚ò≠</b> .  Funny?  There are a lot of characters, and the combinations are chosen so that it is easy to fill them in, and in most cases the order of pressing is not important, for example, ‚ÄúCompose e =‚Äù and ‚ÄúCompose = e‚Äù both give out <b>‚Ç¨</b> .  A full list of standard combinations can be found <a href="">here</a> , and you can also assign your own ones in the ~ / .XCompose file. <br>  And you can make the right Ctrl work as a Compose by adding the following line to our file: <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "compose(rctrl)"</code> </pre><br><h3>  On the road </h3><br>  I deliberately do not publish my config entirely, so that the reader wants to experiment.  Here are a couple of ideas for you on the road: <br>  - by pressing <b>F</b> , make <b>HJKL</b> work like normal arrows; <br>  - make the left half of the keyboard shift the register only with the right shift, and the right half with the left.  This is very useful for hands, although not familiar ( <a href="http://habrahabr.ru/post/222285/">hint</a> in the comments); <br>  - make it so that the left Shift does not have to be clamped, but that it was enough to press and release once and then, for example, press the <b>5</b> key, so that the <b>%</b> symbol is typed (hint: Latch); <br>  - hang two different modifiers on one key <br><br>  Come up, share.  I will be glad to hear interesting ideas. <br><br>  PS If suddenly someone says that then you sit down to someone else for the keyboard, and everything is not right at once, then I will say this: when transferring from Bentley to help a friend bring a Lada to the house, you also swear.  All the more pleasant to sit back in Bentley. <br><br>  Print with pleasure and take care of yourself! </div><p>Source: <a href="https://habr.com/ru/post/222285/">https://habr.com/ru/post/222285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222275/index.html">Jelastic 2 will have access via SSH</a></li>
<li><a href="../222277/index.html">CARDIAC - do-it-yourself computer paper</a></li>
<li><a href="../222279/index.html">May habor competition: we make our own GLONASS</a></li>
<li><a href="../222281/index.html">12 lessons from project management and startup startups</a></li>
<li><a href="../222283/index.html">Video from the ISS in HD quality in real time: High Definition Earth Viewing</a></li>
<li><a href="../222287/index.html">Hardware Number Sorter Verilog</a></li>
<li><a href="../222291/index.html">The future of Unreal Tournament starts today: open source, free and cross-platform</a></li>
<li><a href="../222293/index.html">Firefox OS 1.3 has been released: improvements in graphics, audio, dual-SIM support</a></li>
<li><a href="../222295/index.html">Secrets of buttons in Android. Part 3: Buttons in the main menu</a></li>
<li><a href="../222297/index.html">Organizational report on the conference ‚ÄúJust Sell IT! Effective IT Sales ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>