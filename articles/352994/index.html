<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Better way To Code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: 
 I am neither a professional programmer nor a professional translator, but the appearance of the tool described in the article f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Better way To Code</h1><div class="post__text post__text-html js-mediator-article"> <i>From the translator:</i> <i><br></i>  <i>I am neither a professional programmer nor a professional translator, but the appearance of the tool described in the article from the creator of the popular library <code>D3.js</code> made a strong impression on me.</i> <i><br><br></i>  <i>I was surprised to find that on Habr√©, and indeed on the Russian-language Internet, they have unjustly ignored this tool for more than a year.</i>  <i>Therefore, I decided that I was simply obliged to contribute to the development of the art of programming, in JavaScript in particular.</i> <i><br></i> <br>  Meet d3.express, an integrated research environment. <br>  <i>(since January 31, 2018 d3.express is called Observable and lives on <a href="https://beta.observablehq.com/">beta.observablehq.com</a> )</i> <br><br>  If you have ever had to blunt your code or understand someone else's, then you are not alone.  This article is for you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For the last eight years I have been developing tools for visualizing information.  The most successful result of my efforts was the js-library <a href="https://d3js.org/">D3</a> .  However, the danger of such a long development of tools is that you forget <i>why you are doing this</i> : the tool becomes an end in itself, the benefits of its use fade into the background. <br><br>  The purpose of the visualization tool is to build visualizations.  But what is the purpose of visualization?  A word to <a href="http://redactor.in.ua/ru/actual/502.Manifest_vizualizatsii_informatsii">Ben Shneiderman</a> (Per Ben Shneiderman): <br><blockquote>  "The result of the visualization is <a name="habracut"></a>  enlightenment, not pictures ¬ª </blockquote>  Visualization is the key.  The key to <i>insight</i> .  A way to think, understand, reveal and convey something about this world.  If we see in visualization only the task of finding visual decoding, then we ignore a host of other tasks: finding meaningful data, cleaning it, transforming it into effective structures, statistical analysis, modeling, explaining our investigations ... <br><br>  These tasks are often solved with code.  Alas, programming is damn hard!  The name itself already suggests incomprehensibility.  The word "programming" ( <i>"Code"</i> ) comes from <i>machine code</i> : low-level instructions executed by the processor.  Since then, the code has become more friendly, but there is still a long way to go. <cut></cut><br><br><img src="https://habrastorage.org/webt/fm/1v/gm/fm1vgmha1yv_3xi_lt5oaohz5sk.gif"><br>  <i>Ghost in the Shell (1995)</i> <br><br>  As a prime example, here is the Bash team for generating a <a href="https://bl.ocks.org/mbostock/5562380">background</a> California <a href="https://bl.ocks.org/mbostock/5562380">population density map</a> .  It only returns a simplified geometry.  A few more commands are needed to get the SVG. <br><br><img src="https://habrastorage.org/webt/ey/xt/ua/eyxtua1wvaotd8h5axcqeff3eza.png"><br><br>  This is not a machine code.  From the point of view of the machine, this is a very high-level programming.  On the other hand, this cannot be called human language: strange punctuation marks, incomprehensible abbreviations, nesting levels.  And two languages: JavaScript clumsily woven into Bash. <br><br>  Bret Victor gives us this brief <a href="https://youtu.be/ef2jpjTEB5U%3Ft%3D8m21s">definition of programming</a> : <br><blockquote>  Programming is the blind manipulation of symbols. </blockquote>  By ‚Äúblind,‚Äù he means the impossibility of seeing the results of our manipulations.  We can edit the program, restart it and see the result.  But programs are complex and dynamic, we do not have the ability to directly, directly observe the results of our editing. <br><br>  By ‚Äúcharacters‚Äù he means that we do not directly manipulate the output of our program, but instead work with abstractions.  These abstractions can be effective, but they can also be complex in terms of control.  In the definition of Donald Norman, this is the <a href="https://www.interaction-design.org/literature/book/the-glossary-of-human-computer-interaction/gulf-of-evaluation-and-gulf-of-execution">abyss of assessment and the abyss of execution</a> ( <i>Gulf of Evaluation and Gulf of Execution</i> ). <br><br>  But it is obvious that some scripts are easier to read than others.  One of the symptoms of a non-human code is ‚Äúspaghetti‚Äù: code without structure and modularity, where in order to understand one part of the program, you must understand the entire program.  This is often caused by a <i>shared mutable state</i> .  Where part of the structure is modified by different parts of the program, it is very difficult to guess what its meaning is. <br><br>  Well, in fact, how do we know what exactly the program does?  If we cannot track all the states of the environment in our heads, reading the code is not enough.  We use logs, debuggers and tests, but these tools are limited.  A debagger, for example, can only show a few values ‚Äã‚Äãat a specific point in time.  We continue to experience tremendous difficulties in understanding the code, and can be perceived as a miracle if something basically works. <br><br>  Despite these problems, we still write code for countless applications, more than ever.  Why?  Maybe we are masochists?  (Maybe) We can't swap?  (Partially.) Is there really no better solution? <br><br>  In general, this critical definition is not.  The code is often the best tool in our arsenal, because it is the most <i>complete (general)</i> of what we have;  the code has almost unlimited expressiveness.  Alternatives to code, as well as high-level software interfaces and languages, feel fine in specific areas.  But these alternatives sacrifice <i>universality</i> for the sake of better efficiency in these areas. <br><br>  If you cannot define a domain ( <i>constrain the domain</i> ), then most likely you will not be able to find a viable alternative to the code.  There is no universal substitution, at least as long as people mostly think and communicate through language.  It is very difficult to determine the field of science.  Science is fundamental: to study the world, to derive meaning from empirical observations, to model systems, to calculate quantitative values. <br><br>  The tool for promoting discoveries must be able to express new, original thoughts.  As we do not use phrasal patterns to compose a written word, we cannot be limited to graphical templates for visualization or a limited list of formulas for statistical analysis.  We need more than a configuration.  We need a composition of primitives in the formation of our own design. <br><br>  If our goal is to help people gain insight from observation, we need to consider the problem of <i>how people write code</i> .  What Victor said about <a href="http://worrydream.com/KillMath/">mathematics</a> can also be applied to the code: <br><blockquote>  The whole arsenal for understanding and predicting the quantitative indicators of our world should not be limited to ridiculous (freakish) tricks on manipulating abstract symbols. </blockquote>  Improving our ability to program is not only making workflows more convenient or efficient.  This is to enable people to better understand their world. <br><br><h4>  Introducing the Observable </h4><br>  If we can‚Äôt get rid of the code, can we at least make it easier for people, with our sacroslike fingers and bounded-size brains? <br><br>  To clarify this issue, I am building an integrated research environment called <b>Observsable</b> .  It serves to analyze data, to understand systems and algorithms, to train and present various programming techniques, as well as to share interactive, visual explanations.  In order to make visualization easier and, in turn, easier to make our discoveries, we must first make the programming process easier. <br><br>  I cannot claim to make the programming process <i>easier</i> .  The ideas we want to express, explore, and explain can be irreducibly complex.  But reducing the cognitive load when programming, we can make an analysis of quantitative phenomena available for a wider audience. <br><br><h3>  1. Reactivity </h3><br>  The first principle of Observable is reactivity.  Instead of issuing commands to change the overall state, each part of the state in the reactive program determines how it is calculated, and the environment controls their assessment;  the runtime propagates the received state.  Instead of issuing commands to change the general state, each part of the state in the reactive program determines how it is calculated, and the environment itself controls their assessment.  The medium itself propagates the derived state.  If you write formulas in Excel, you perform reactive programming. <br><br>  Here is a simple notepad in Observable to illustrate reactive programming.  A bit like the developer console in the browser besides the fact that our work is saved automatically and we can visit here in the future or share the work with others.  And it is also reactive. <br><br><img src="https://habrastorage.org/webt/g9/-i/cq/g9-icq6sl7njn-fx2mpda3h8ots.gif"><br><br>  in imperative programming, <code>c=a+b</code> sets c to <code>a+b</code> .  This is an <i>assignment of value</i> .  If <code>a</code> or <code>b</code> change, <code>c</code> remains in the same value until we perform the new assignment of the value for <code>c</code> .  In reactive programming, <code>c=a+b</code> is a variable description.  This means that c is always <code>a+b</code> , even if <code>a</code> or <code>b</code> changes.  The environment itself maintains the current value <code>c</code> . <br><br>  As programmers, we now only care about the current state.  The environment itself manages state changes.  This may seem like a minor thing here, but in large programs it removes a significant burden. <br><br>  The research environment should do more than add up a few numbers, let's try working with the data.  To download the data ‚Äî Apple‚Äôs <a href="">multi-year</a> stock price statistics ‚Äî we‚Äôll use <a href="">d3.csv</a> .  It uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a> to load a file from GitHub and then parse it to give us an array of objects. <br><br><img src="https://habrastorage.org/webt/30/5s/db/305sdbopinknj1ljkgko5vfxcai.png"><br><br>  require ('d3') and data request are asynchronous.  The imperative code could be a <a href="http://callbackhell.com/">problem</a> , but here we clearly noticed: cells that refer to "d3" are not calculated until the data is loaded. <br><br>  Reactivity means that we can write most asynchronous code as if it were synchronous. <br><br>  What does the data look like?  Let's get a look: <br><br><img src="https://habrastorage.org/webt/x6/pi/rm/x6pirmej8csaxspapdy65nyrzzk.png"><br><br>  d3.csv is conservative and does not infer data types such as numbers and strings, so all fields are strings.  We need more accurate types.  We can convert the ‚Äúclose‚Äù field to a number by applying the operator (+) to it and immediately see the effect: the purple line becomes a green number. <br><br><img src="https://habrastorage.org/webt/47/mp/tf/47mptfjn-o-25dqhyb-qsboiwvk.png"><br><br>  To parse the date you need a little more work, since JavaScript does not natively support this format. <br><br>  Imagine we have a function parseTime, which parses the string and returns the ‚ÄúDate‚Äù entity.  What happens if we call her? <br><br><img src="https://habrastorage.org/webt/hf/uf/gi/hfufgiu2rslti99wrqhvkzf1wqm.png"><br><br>  Oops!  Threw an error.  But the error is both local and temporary: other cells are not affected and it will disappear when we define parseTime.  Therefore, notepads in Observable are not only reactive, they are also structured.  Global errors no longer exist. <br><br>  When defining parseTime, we again see the effect: the data is reloaded, parsed, and displayed.  We still manipulate abstract symbols, but at least we do it less blindly. <br><br><img src="https://habrastorage.org/webt/ml/mg/hr/mlmghr3m5m96y6o1qvoutih-fsi.png"><br><br>  Now we can query the data, say, to calculate the time range: <br><br><img src="https://habrastorage.org/webt/e1/ay/b1/e1ayb1frcinlzlexvgmwsd7y3xu.png"><br><br>  Oh, we forgot to give the name of the data!  Let's fix: <br><br><img src="https://habrastorage.org/webt/r5/_s/ls/r5_slsxvtg7ejx0o8g3_jm-gxy4.png"><br><br>  Here we find another ‚Äúhuman‚Äù feature: cells can be written in any order. <br><br><h4>  Visual output </h4><br>  As in the developer console, the result of the execution of the cell in Observable is immediately visible under the code.  But unlike the console, Observable cells can display graphical user interfaces!  Let's visualize our data on a simple line chart. <br><br>  First, we define the size of the graphic: width, height, and margin. <br><br><img src="https://habrastorage.org/webt/bo/uz/vb/bouzvby4vav0yzyapwzonnkg688.png"><br><br>  Now the <a href="https://github.com/d3/d3-scale">scale</a> : time for x and linear for y. <br><br><img src="https://habrastorage.org/webt/eo/bg/gq/eobggqi_tendcgixg7gbqb62xjq.png"><br><br>  Finally, the SVG element.  Since this definition is more complicated than our previous cells, we can use curly braces ({and}) to define it as a block, not an expression: <br><br><img src="https://habrastorage.org/webt/xv/yj/sq/xvyjsq0wwuzn9dhgozctxd-ldiq.png"><br><br>  DOM.svg is a method for easily calling <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS">document.createElementNS</a> .  It returns a new SVG node with a certain width and height.  Let's extend it to use <a href="https://github.com/d3/d3-selection">d3-selection</a> to manipulate the DOM: <br><img src="https://habrastorage.org/webt/gz/-x/8q/gz-x8qobopjf846vimjpjx7hfc0.png"><br><br>  I cannot show the code and the chart at the same time due to the limited screen size, so let's first look at the chart as it is assembled.  This gives the sensation of visual feedback that you get as the three main components of the chart are determined: the x, y axes and lines. <br><br><img src="https://habrastorage.org/webt/wh/5w/wf/wh5wwfa9m7r8vxwa0vbzl63wddy.gif"><br><br>  This animation was made by entering each line of code in order (except for return, as it is needed to see everything): <br><br><img src="https://habrastorage.org/webt/wm/2l/vg/wm2lvgsd0zobmx4ig0bqes_mnma.png"><br><br>  This is a simple graph, but the topology of the program becomes more complex.  Here is a directed acyclic link graph, itself made in Observable, using <a href="">GraphViz</a> : <br><br><img src="https://habrastorage.org/webt/lm/_y/vp/lm_yvpiz0z5blebgvxrnwwca_tm.png"><br><br>  Node 93 is an SVG element.  A few observations: It is now very easy to make this schedule responsive.  The width, height, and margin objects are constants, but if they were dynamic, the axes and the graph itself would be updated automatically.  In a similar way, it is also easy to make a graph dynamically redefining data (data).  We will see this soon with a streaming example. <br><br>  But let's take a closer look at the reactive code.  In imperative programming, the definition of variables is spread over the entire code, rather than being done in one place.  For example, we can collect scaling for the x scale immediately after the page loads, but defer the definition of the <a href="">domain</a> until data is received. <br><br><img src="https://habrastorage.org/webt/tp/dp/jf/tpdpjfdchbbmwrx0l912ufloxc8.png"><br><br>  Such a fragmented definition can be shuffled with other data and affect the purity of the code.  It also encourages reuse: self-contained, statusless definitions are easier to copy / import into other documents. <br><br>  You can create any DOM - HTML, canvas, WebGL, use any libraries you like. <br><br>  Here is a chart made using <a href="https://vega.github.io/vega-lite/">Vega Lite</a> : <br><br><img src="https://habrastorage.org/webt/va/rx/ok/varxokwzudrom0fcd7bmrej82hq.png"><br><br><h4>  Animation </h4><br>  How about a canvas?  Let's say we need a globe.  We can <a href="https://github.com/d3/d3-fetch">load the</a> <a href="https://github.com/topojson/world-atlas">borders of the countries of the world</a> and apply an <a href="">orthogonal projection</a> . <br><br><img src="https://habrastorage.org/webt/b-/j0/kp/b-j0kp5-wum66ftrk5nd6tfgxbk.png"><br>  ( <i><a href="">Mesh</a> , if interested, is a combined border, represented as a broken line. I use the mesh method, because this dataset contains polygons, and it is a little faster and more beautiful for rendering such objects.</i> ) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38c/f3e/ccd/38cf3eccd8f27e6e137b863142054a7a.png" alt="image"><br><br>  A powerful feature of reactive programming is that we can quickly replace a <i>static</i> definition, such as a fixed-size orthogonal projection, with a <i>dynamic</i> definition, such as a rotating projection.  The environment itself will redraw the canvas whenever the projection changes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/667/97d/d52/66797dd52aa995978315c784aad787fd.png" alt="image"><br><br>  Dynamic variables in Obsesrvable are implemented as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators">generators</a> , functions that return multiple values.  For example, a while-true loop generator produces an infinite stream of values.  The medium retrieves a new value from each active generator up to sixty times per second. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a3e/4c1/e19/a3e4c1e192708a4a51e77265865742f1.gif" alt="image"><br>  <i>(looks better at 60 FPS)</i> <br><br>  Defining our canvas creates a new canvas every time it starts.  This may be acceptable, but we can get better performance by reprocessing the canvas.  The previous value of the variable is displayed as <code>this</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ede/f43/ee8/edef43ee8e7dc221dc7c5b6c025f9154.png" alt="image"><br><br>  Oh!  Using the old <code>canvas</code> we blur our globe: <br><img src="https://habrastorage.org/getpro/habr/post_images/1df/e1b/d9d/1dfe1bd9d5247d5aeee2f9dc8dabde97.gif" alt="image"><br><br>  The glitch is easily fixed by cleaning the <code>canvas</code> before redrawing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e3/8d9/346/4e38d934637a322753081b17435cb877.png" alt="image"><br><br>  So, by making it a bit more complicated, you can improve performance, and the resulting animation has a slight overhead compared to vanilla JavaScript. <br><br><h4>  Interaction </h4><br>  If generators are good for animation scenarios, how about interaction?  Generators to help again!  Only now our generators are asynchronous, returning promises that are allowed whenever a new input appears. <br><br>  To make the rotation interactive, let's first define the input range.  Then we connect it to the generator, which gives the current value of the input whenever it changes.  We could implement this generator manually, but there is a convenient built-in method called <code>Generators.input</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/496/1a0/c59/4961a0c5938a0782e130dc98a03379e8.gif" alt="image"><br><br>  Now we substitute the value as the longitude for rotating the interactive globe: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/adf/71d/fb8/adf71dfb8a95e17378557dddbea2ab68.png" alt="image"><br><br>  This is a brief definition of the user interface.  But we can still reduce it by folding the definitions of <code>range</code> and <code>angle</code> into one cell, using the Observable <code>viewof</code> operator.  It shows the input to the user, but for the code, it represents the current value. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/331/2d7/247/3312d72475cdd236c8d7ffd07d3243d2.png" alt="image"><br><br>  The ability to display arbitrary DOMs and expose arbitrary values ‚Äã‚Äãto code makes the Observable interfaces very, well ... bright.  You are not limited to sliders and drop-down menus.  Here is the Cubehelix color picker, implemented as a table of sliders, one for each color channel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c19/126/cd2/c19126cd264088efad1e30544dd77e7f.png" alt="image"><br><br>  When you drag the slider, its value is updated at the corresponding output, and then the generator displays the current color. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c6b/f0f/663/c6bf0f663550dd94d3fbb91128d5e79e.png" alt="image"><br><br>  We can create any graphical interfaces that we want.  And we can design smart programming interfaces to present their values ‚Äã‚Äãto the code.  This allows you to quickly create powerful interfaces for exploring data.  Here is a bar chart showing the behavior of a few hundred stocks over a five year period.  (I shortened the code, but it looks like <a href="https://bl.ocks.org/mbostock/3048450">this</a> .) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ea/981/de7/8ea981de7e824292f2decba01af490ec.png" alt="image"><br><br>  In other environments, a histogram like this may be a visual dead end.  You can look at it, but to check the base values ‚Äã‚Äãyou need to separately request data in the code.  In Obsesrvable, we can quickly complete the visualization, and show the selection interactively.  Then we can see the data under the cursor by direct manipulation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a24/e69/fd4/a24e69fd43ac7f8e9d7094f96ebd4bd9.gif" alt="image"><br><br>  The default object inspector is used here, but you can do anything online, for example, live totals, real-time statistics, or even associated visualizations. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e66/c66/53a/e66c6653aaeb4ae4bd47a257ad7fecfe.png" alt="image"><br><br>  To show that this is not magic, the code for adapting the <a href="https://github.com/d3/d3-brush">d3-brush</a> to Obsesrvable is given above.  Upon the <code>brush</code> event, we calculate the new filtered data, set it as the value of the SVG node, and send the input event. <br><br><h4>  Animated transitions </h4><br>  By default, reactions occur instantaneously: when the value of a variable changes, the runtime recalculates derived variables and immediately updates the display.  But such urgency is not always required and sometimes it is useful to animate transitions for a <a href="https://bost.ocks.org/mike/constancy/">sense of the reality of an object</a> .  Here, for example, we can follow the columns as they are re-sorted: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/728/67a/337/72867a337c63b2566cdd501545f826ee.gif" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Understanding the implementation of this diagram requires familiarity with D3, namely: </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyed data</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step transition</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but even if this code is opaque, it hopefully demonstrates that today's open source libraries are easily used in Obsesrvable.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed2/557/1e7/ed25571e71ddb019ec12a674f683bffc.png" alt="image"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2. Visibility </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The visual output of the program helps to better perceive the current state of the program. </font></font><a href="https://en.wikipedia.org/wiki/Interactive_programming"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interactive programming</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> helps to more thoroughly analyze the behavior of the program by typing: changing, deleting, reordering and observing what is happening. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, by removing the binding forces in the comments in the graph below, we better understand their contribution to the overall arrangement of the figures. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/390/a55/273/390a55273ff372ccda051de75c0a6d21.gif" alt="image"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Watch </font></font><a href="https://www.youtube.com/watch%3Fv%3D8Qam4frEmm8%26feature%3Dyoutu.be"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on </font><font style="vertical-align: inherit;">how I play with it.)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> You must have seen similar toys ‚Äî for example, </font></font><a href="https://medium.com/%40sharoz"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steve Haroz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> has a great sandbox for d3-force. </font><font style="vertical-align: inherit;">Here you do not need to create a user interface for playback; </font><font style="vertical-align: inherit;">it comes free with interactive programming!</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algorithm Visualization </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A more detailed approach to studying the behavior of the program is to supplement the code to display the internal state. Generators also help here. We can take a normal function like this to sum up an array of numbers: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d70/a45/2b6/d70a452b66820aba7b162dc768cf002d.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And turn it into a generator that produces a local state at run time, in addition to the normal return value at the end: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ec/a81/8dd/5eca818dd944f13c97fdc94264db2335.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then, to understand the behavior, we can visualize or check the internal state . This approach provides a clear separation between our implementation of the algorithm and its study, rather than the implementation of the visualization code directly inside the algorithm. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/69f/dbc/6e9/69fdbc6e9efe861a5e460793faef1033.gif" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As an example, let's look at the hierarchical </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25BF%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0_%25D0%25BA%25D1%2580%25D1%2583%25D0%25B3%25D0%25BE%25D0%25B2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packing</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> structure </font><a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25BF%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0_%25D0%25BA%25D1%2580%25D1%2583%25D0%25B3%25D0%25BE%25D0%25B2"><font style="vertical-align: inherit;">of circles </font></a></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b3/474/6b3/9b34746b3015e25f81a082c6ad484f4e.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have a set of circles that we want to pack in as little space as possible without overlapping, like a cluster of penguins in Antarctica. Our task is to place the circles one by one until all the circles are placed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we want the circles to be packed as tightly as possible, it is rather obvious that each circle we place must touch at least one ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">actually two</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) circles that we have already placed. But if we randomly select an existing circle as a tangent circle, we will spend a lot of time putting the new circle in the middle of the pack, where it will overlap other circles. Ideally, we only consider circles that are outside the package. But how can we effectively determine which circles are outside?</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c83/00c/e46/c8300ce46f776551f63c37368ef45c7e.gif" alt="image"><br><br> <a href="https://dl.acm.org/citation.cfm%3Fdoid%3D1124772.1124851"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wang's algorithm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supports the "external chain", shown here in red, which represents these outer circles. When placing a new circle, he chooses a circle in the front chain, which is closest to the beginning. A new circle is located next to this circle and its neighbor on the front chain. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If this placement does not overlap with any other circle in the front chain, the algorithm proceeds to the next circle. If it overlaps, then we cut the front chain between the tangent circles and the overlapping circle, and the overlapping circle becomes a new touching circle. We repeat this process until there is an overlap.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/922/1de/4cd/9221de4cd146df8bd4cdc27428190c74.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/14d/38c/439/14d38c4394082569cb1310a5b4d9634f.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I find this animation fascinating. If you look closely, you will see brief moments when a large circle is squeezed out of the package when the front chain is cut. This is not only pleasing to the eye, but also extremely useful for identifying a </font></font><a href="https://github.com/d3/d3-hierarchy/issues/74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">long-standing error</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the implementation of D3, where very rarely it would overlap the wrong side of the front chain and the circles would overlap. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After we have assembled our circles, we need to calculate the circumference for packing so that the circular packing can be repeated along the hierarchy. The usual way to do this is to scan the front chain for a circle that is furthest from the origin. This is quite a decent assumption, but not accurate. Fortunately, there is a simple extension of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Welzl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> algorithm ( </font><i><font style="vertical-align: inherit;">Welzl</font></i><font style="vertical-align: inherit;"> ) to calculate</font></font><a href="https://en.wikipedia.org/wiki/Smallest-circle_problem"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smallest closed circle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in linear time. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e5d/f96/bea/e5df96bea30962212e6e0c41850cac3f.gif" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To see how the Welz algorithm works, suppose we already know the outer circle for some circles and want to include a new circle in it. If the new circle is inside the current circle, we can move on to the next circle. If the new circle is outside the vicious circle, we must expand the circle. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d8/b11/568/9d8b115680b593080fd041be2e40e6e9.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/238/a3f/cfd238a3f8331ecad4624b974659ac41.png" alt="image"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the circle is outside a closed circle (left), it should touch the new outer circle (right).</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> However, we know something about this new circle: it is the only circle that is outside the outer circle and, therefore, it must touch the new outer circle. And if we know how to find one touching circle for the outer circle, we can find others recursively!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a bit of geometry, I am a bit of a hack, of course. We also need to calculate the </font></font><a href="https://en.wikipedia.org/wiki/Boundary_case"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boundary cases</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for recursion: outer circles for one, two, or three tangent circles. (This is the problem of </font></font><a href="http://bl.ocks.org/mbostock/751fdd637f4bc2e3f08b"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apollonius</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) Geometry also dictates that there can be no more than three tangent circles, or the environment already contains all the circles, so we know that our recursive approach will eventually end. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is a more complete overview of the recursive algorithm showing the stack:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/773/5c5/812/7735c58128c74a0e0fc2cc84ff29d77c.gif" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The left one is the uppermost level, where the set of contiguous circles is empty. </font><font style="vertical-align: inherit;">The algorithm is repeated every time a new circle is outside the circle. </font><font style="vertical-align: inherit;">During recursion, this new circle must be placed on a set of circles in contact with it. </font><font style="vertical-align: inherit;">So, from left to right, there are zero, one, two, and three adjoining circles painted in black. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to explaining how the algorithm works, this animation gives a sense of time that the algorithm spends at different levels of recursion. </font><font style="vertical-align: inherit;">Since it processes the circles in a random order, the spanning circle expands quickly to bring the final answer closer. </font><font style="vertical-align: inherit;">But whenever he repeats, he must reinstall all previous circles to make sure that they fit into the new surrounding circle.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3. Reusability </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One way to write less code is to reuse it. 440,000 or so packages published in npm indicate the popularity of this approach. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But libraries are an example of active reuse: they must be intentionally designed for reuse. And this is a significant burden. It's hard enough to develop an effective overall abstraction! (Contact any open source developer.) Implementing a ‚Äúone-off‚Äù code, as is usually the case in the D3 examples, is simpler because you only need to consider a specific task, not an abstract class of tasks.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I find out if we can have better passive reuse in Observable. Where, using the structure of reactive documents, we can more easily reconfigure the code, even if this code was not specifically designed for reuse. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For starters, you can consider de facto notebooks as libraries. Let's say, in one laptop, I implement a custom color scale: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/719/a29/70e/719a2970efc7eaab960c93b9087d9671.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In another notebook, I can </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this color scale and use it. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/286/58d/ba4/28658dba4a3b2fc7ffd34e6a336b3dca.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Import is also useful if you have created many notebooks for researching ideas and want to combine them into one unit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More interestingly, Observable allows you to rebuild variable definitions during import. Here I define stream from real-time data via WebSocket. (</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">again, the details of this code are not critical, for simplicity you can imagine an imaginary library ...</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/de5/d7d/2d0/de5d7d2d002c7a7440be503091e09450.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This data set has the same shape as our previous line graph: an array of objects with time and value. Can we reuse this schedule? Aha The operator </font></font><code>with</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allows you to enter local variables in the imported variables, replacing the original definitions. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7a/57d/3ed/d7a57d3ed57e9a059b065021089f41b7.gif" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can not only insert our dynamic data into a previously static diagram, but also, if necessary, scale the coordinate axes. Here we change the axle domains </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the appropriate sizes for this data. the axis </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">now shows the last sixty seconds or so. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e96/db2/429/e96db2429b066bc0b7d1d37cd0f2448c.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adding new definitions </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the operator</font></font><code>with</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the graph now smoothly slides at 60 FPS, and the axis is </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">already distractingly not twitching:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1db/1be/391/1db1be3913004e7059b85669077c1d66.gif" alt="image"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Portability </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observable notebooks work in a browser, not in a desktop application or in the cloud; There is a server to save your scripts, but all calculations and rendering occur locally in the client. What does it mean to have a research environment on the web? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The web environment encompasses web standards, including vanilla JavaScript and DOM. It works with open source code, be it code snippets that you find on the Internet or in libraries published in npm. This minimizes the specialized knowledge necessary for productive work in a new environment. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a new syntax in Observable for reactivity, but I tried to keep it as small and familiar as possible, for example, using generators. These are four forms of variable definition:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ff/5c1/4df/4ff5c14df60c8233bad53f5926e0cd46.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The standard library is also minimal and not tied to the platform. You should be able to bring your existing code and knowledge to the Observable and vice versa, pick up your code and knowledge from the Observable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The web environment first allows your code to work everywhere, because it works in a browser. No need to install anything. It becomes easier for another to repeat and check your analysis. In addition, your code for the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">study</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can gracefully go into the code for an </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explanation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . You do not need to start from scratch when you want to share your ideas.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c0/a58/326/0c0a583262a8253d3548d21650ecd4c1.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It's great that reporters and scientists share data and code. But the code on GitHub is not always easy to run: you need to play the necessary environment, operating system, application, packages, etc. If your code is already running in the browser, then it runs in any other browser. And that's the beauty of the Internet! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating more portable code for analysis can have an impact on our communication style. Once again I will quote </font></font><a href="http://worrydream.com/ExplorableExplanations/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Victor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An active reader asks questions, considers alternatives, questions assumptions, and even questions the author's credibility. </font><font style="vertical-align: inherit;">The active reader is trying to summarize concrete examples and come up with concrete examples for generalizations. </font><font style="vertical-align: inherit;">An active reader does not passively absorb information, but uses the arguments of the author as a springboard for critical thinking and deep understanding.</font></font></blockquote><br>  PS <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you want to help me develop Observable, this is great! </font><font style="vertical-align: inherit;">Please contact me. </font><font style="vertical-align: inherit;">You can find my email address on my </font></font><a href="https://github.com/mbostock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github profile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and connect with me on </font></font><a href="https://twitter.com/mbostock"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <a href="https://beta.observablehq.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beta.observablehq.com</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Thanks for reading!</font></font></div><p>Source: <a href="https://habr.com/ru/post/352994/">https://habr.com/ru/post/352994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352984/index.html">Security Week 12: card games, hand-driven malware and a healthy approach to leaks</a></li>
<li><a href="../352986/index.html">Messengers, it's time to take the next step.</a></li>
<li><a href="../352988/index.html">Self-Managed Virtual Infrastructures: VMware Updates vRealize Suite</a></li>
<li><a href="../352990/index.html">Massive attack on cisco</a></li>
<li><a href="../352992/index.html">Thymeleaf Tutorial: Chapter 20. Appendix C: Markup Selector Syntax</a></li>
<li><a href="../352996/index.html">Why put up a management interface or attack on a Cisco Smart Install on the Internet</a></li>
<li><a href="../352998/index.html">The path of the IT-manager (part # 2)</a></li>
<li><a href="../353002/index.html">Mass Attack on Cisco Equipment</a></li>
<li><a href="../353006/index.html">Parsing tasks from Odnoklassniki on JPoint 2018</a></li>
<li><a href="../353008/index.html">Overview of cases of interesting Big Data implementations in financial sector companies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>