<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Subsoil payphone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guinea pigs in the MGTS office 

 Long time I wanted to write this article, but only after a series of articles about phreaking and hacking payphones ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Subsoil payphone</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/165/6b2/2fd/1656b22fdc866a03d76a5577aed12844.jpg"><br>  <b>Guinea pigs in the MGTS office</b> <br><br>  Long time I wanted to write this article, but only after a series of articles about phreaking and hacking payphones passed through not so long ago, I decided to do it.  It stirred in me those long-forgotten notes.  The very ones through which I began to study electronics, programming, and became who I am now.  In the post <a href="http://habrahabr.ru/post/191450/">‚ÄúRise and fall of the novice fricker‚Äù</a> in the comments began a discussion of the design features of payphones, so I decided to publish here a revised and updated article ‚Äúthe guts of a payphone‚Äù.  We understand that the payphone inside.  Do not forget that the article 2006 release! <br><a name="habracut"></a><br><h4>  We understand the device payphone </h4><br>  Probably every phreaker, from beginner to experienced, wants to look inside the payphone.  And not just to look, but also to tell him about why a piece of hardware is needed, about the intricacies of the protection system.  The task is almost not solvable.  It is possible, of course, to rest against a payphone, but to understand how it functions is very difficult.  When I worked at Hacker magazine, taking advantage of the opportunity of a journalist, I contacted MGTS about writing a payphone.  And, lo and behold!, The telephone company MGTS provided us with this opportunity and consulted us in detail on how it works.  Now we will debunk many rumors or, on the contrary, we will confirm some of them. <br><br><h4>  Meeting and meeting </h4><br>  We met with the MGTS press secretary and were taken to the MGTS office with courtyards.  Over the years, I can not remember the geography of the place (it was 2006!).  In my opinion it was M. Baumanskaya.  And then we were met by MGTS employees.  We went up to the second floor, where almost all generations of payphones, which were installed in Moscow, hang in the hall. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/d80/34a/324/d8034a3247c293949264018ee3d2412a.jpg"><br>  <b>Walk of Fame</b> <br><br>  Then we came to the office, and saw the workplace of telephone <s>pirates of</s> workers, which is given in the article zahodnik.  Initially, they refused to show and tell me about the internal parts of the payphone, but I was persistent and said that such was the arrangement of the meeting and in the end they broke down and the excursion into the depths began! <br><br><h4>  Guinea pig </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/3b1/a26/d84/3b1a26d8497ae056071861a80614f195.png"><br>  <b>Object to be opened</b> <br><br>  A private payphone in many cities turns out to be not as simple as it seems.  In a sense, this is a full-fledged computer, which implements all the anti-grip and anti-vandal achievements of technical progress: a shock-resistant body;  molded card reader, which is quite difficult to break;  various systems of protection against opening, both program, and hardware.  To open a payphone on the right, it has a combination lock, the code of which for each payphone is its own.  The payphone detects penetration by the built-in opening sensors and calls back to the PBX, reporting it.  At the same time, installers must type a secret password on the keypad of the payphone, which will tell the PBX that it has been opened authorized.  If this is not done, the automatics will call the police squad to the place and the person who has encroached on the payphone will be detained.  The coin acceptor works in a similar way, the only difference is that instead of a combination lock, a regular turnkey lock is used. <br><br>  And so, we are opening authorized, first acquaintance. <br><br><h5>  We open and what is there? </h5><br>  The payphone consists of two parts: the front and the body of the filling.  Run through the base nodes, after opening: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/229/2ed/12d2292ed13a6537ee12bf940e40252c.png"><br>  <b>Open payphone</b> <br><br><h6>  So, the points: </h6><br>  <b>1. Code lock</b> <br>  Used to open a payphone As in a safe, twist-twirl - I want to confuse. <br>  <b>2.Cash lock</b> <br>  Opens cashier for uncle stuffing.  The same parsley, as in the opening lock. <br>  <b>3. Card reader wire</b> <br>  Used to connect the card reader to the motherboard of a payphone. <br>  <b>4. Hole for coins</b> <br>  This money rushes <br>  <b>5. Coin return compartment</b> <br>  Drop down here or left coins fall <br>  <b>6. Capacity of collection</b> <br>  Used to store received money <br>  <b>7. Flex line connection</b> <br>  I need to communicate with the PBX (I'm afraid, for years I don‚Äôt remember what I had in mind when I wrote this). <br><hr><br><br>  Continue familiarity with the giblets, go to the insides of the front <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1c/283/1eb/b1c2831ebc4a31fd4331e0483af9a6f3.png"><br>  <b>The insides of the front</b> <br><br>  <b>1. Crypto switch</b> <br>  With its help, check whether the real card Below I‚Äôll stop a little more detailed what it is.  It looks like a normal full-size SIM card <br>  <b>2. Keyboard connector</b> <br>  The plume from Claudia is inserted into it. <br>  <b>3. Card reader</b> <br>  Card poke point <br>  . Details of the reader will be disassembled below. <br>  <b>4. Communication board</b> <br>  Connects payphone with PBX.  Instead, it may be a GSM modem <br>  <b>5. Display Connector</b> <br>  It connects LCD display <br>  <b>6. Integrated clock</b> <br>  Internal timer, it checks the date of the card and the time of the call to the PBX. Below you can see the cylinder - this is a battery. <br>  <b>7. Processor</b> <br>  Payphone brain <br>  <b>8. Payphone opening sensor</b> <br>  If you open a payphone with a friend, then a picena will come <br>  <b>9. Description of the location of elements</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/098/d0a/c9b/098d0ac9bb5a42f01212ccc74feea87c.png"><br>  The layout of the connectors, chips, etc. <br><hr><br><br>  The interior of the main body <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ca/41a/7ce/6ca41a7ce957e9349958b8b6d98d828d.png"><br>  <b>Gut body</b> <br><br>  <b>1. Coin Acceptor Controller</b> <br>  Detects which money fell <br>  <b>2. Sound controller with speaker</b> <br>  Sounds when an error or in the future will call <br>  <b>3. Coin acceptor</b> <br>  Swallows coins and determines their denomination. <br>  <b>4. Preliminary storage of coins</b> <br>  First, the coins go to the preliminary storage, then poured into the collector <br>  <b>5. The mechanism of return of coins</b> <br>  On this slide, the coins fall back to the user. <br>  <b>6. Sticker description</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/23b/811/344/23b81134414ca767e96dc93340e5448c.png"><br><br><h4>  Main nodes </h4><br>  So, in general, we looked at what a payphone looks like.  Now let's go through its main nodes, and find out what they are for.  It should be noted that I am not a developer of this device. I wrote it down from the words of the engineers, as I understood it, I was looking for something myself on the Internet, so this information may not be entirely correct.  I will be glad if someone corrects me. <br><br><h5>  Modem </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/3b0/20a/53b/3b020a53bce5a7c5f89537f2e5b879b0.png"><br>  <b>Modem bay</b> <br><br>  Each Moscow payphone has a modem that communicates with an exchange in the evening or at opening.  The modem uses a 73M2921 chip, providing an exchange rate of up to 9600 bps.  Above the modem is a switching card with a line.  Usually, this is just a line matching fee, however, if there is no possibility to bring a telephone line to the payphone, the GSM modem may well be. <br><br><h5>  CPU </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/bfc/42e/df0/bfc42edf06f9496ec83a8f5cf564ba93.png"><br>  <b>P51XAG30KFA processor</b> <br><br>  The basis of the payphone is the central processor <b>P51XAG30KFA</b> .  This is a 16-bit processor capable of addressing up to one megabyte of program memory, a clone of the most common architecture C51.  Early versions of payphones were also made on the C51-architecture of younger models.  The continuation of the tradition is most likely due to the portability of the codes, which makes it possible not to rewrite the firmware to each payphone. <br><br><h5>  Cryptography </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/7ad/8d7/535/7ad8d75354ad1171a2782c7b95f085fa.png"><br>  <b>Crypto Security Chip</b> <br><br>  All the protection systems in the payphone are able to bypass even the beginner flicker, except for one - the built-in cryptographic protection.  The payphone has a cryptographic key that identifies the payphone card.  By direct emulation of a payphone card, it is almost impossible to bypass this place of protection.  At this stage, all the emulators made according to the hacking rules described on the Internet break off. <br>  The principle of operation is quite simple.  A payphone card is a Non-rewritable ROM, which stores its serial number and rewritable (you can change the bits set to one to zero, all).  Part of the katochka is occupied by some dump, which <a href="http://habrahabr.ru/users/m0n5ter/" class="user_link">m0n5ter</a> says in its article <br><br><blockquote>  The second measure of protection was that some code was stored in the non-rewritable part of the memory card, generated on the basis of the serial number and the original face value of the card (perhaps something else).  The algorithm for the formation of this code has remained a mystery to us.  This code did not allow us to achieve complete perfection and to generate fresh dumps on the fly in the microcontroller each time; we had to flash dumps from the actual used cards.  Then we hoped that by collecting a sufficient number of memory dumps of cards, we could calculate the hashing algorithm.  But, as I have already written, these hopes were not destined to come true. </blockquote><br><br>  This crypto switch and verifies that the dump in the rewritable part corresponds to the serial number.  It is almost impossible to calculate the keys (we know the price for this ‚Äúimpossible‚Äù :))) (say hello to <a href="http://habrahabr.ru/users/darksimpson/" class="user_link">darksimpson</a> ;))) <br><br>  <i>Note</i> : In fact, there is still one ambush system - this is a check of the pulse durations, which gives the card and the quality of the fronts.  It is technically sooo hard to emulate. <br><br><h5>  Card reader </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/f32/9da/40e/f329da40ef68cc0a96948733f4b585b3.png"><br>  <b>Card reader</b>  <b>The orange bar is a wire detector.</b> <br><br>  The subject of many rumors in phreaking circles is the card reader.  From the rumors it was confirmed only that there is a sensor of the output wires, which is easy to get along if you solder the emulator chip directly to the pads of the payphone card.  There is no other emulator recognition system in the card reader. <br><br><h5>  Server </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/293/c36/ffd/293c36ffd248daf6845782d0c80461b1.jpg"><br>  <b>MGTS servers</b> <br><br>  Each payphone in normal operation mode calls back to the telephone node and transmits information about the calls, the telephone cards used in it, and about its working capacity.  He does this at night, when the telephone network is least loaded.  With this operation, various settings and modifications of the soft part can be performed in the payphone.  At this stage, emulators are often detected and tracked where the calls were made.  When calls are made in Russia, it is easy to calculate the person using this emulator.  If the payphone does not ring off, it means that it is either faulty, or it is simply not there.  The next day, the master goes to the payphone to figure out the reason for his ‚Äúsilence‚Äù. <br><br><h5>  Myths about eternal cards </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/6bd/c5d/7d4/6bdc5d7d477f9d38ad4b0b2478dbf5ed.jpg"><br>  <b>Installer Card</b> <br><br>  Each installer is given such a card with the signature ‚Äúfor official use‚Äù.  At one time there were rumors that this card was everlasting.  Unfortunately, no, the card is not eternal.  It contains a very large number of units, but they are eventually exhausted.  The card is recycled, and a new one is issued to the monter. <br><br><h4>  Fricker youth </h4><br>  To my credit, the dream of waving a payphone encouraged me to study electronics and program microcontrollers.  Has reduced to many interesting people, and even got to work in the "Hacker".  I never broke a payphone (no regrets), although there were many attempts.  But I got a huge experience.  I even made a PCB as thick as a card, but the truth was a little wrong with the long <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd2/d25/8f9/cd2d258f9c108bd7b40508331b0ab86e.jpg"><br>  <b>Printed circuit board</b> <br><br>  As a result, the pads are located just in the metal card reader, but it was possible to shove it.  One of the experiments of that time was this.  The cards have pins: data, clock and reset (plus power).  So, the primary readout comes from the data card, and then the pin goes to the empty card using the toggle switch (of course, the other pins are connected in parallel).  Everything was mounted in a box.  I remember probably doing the day three (shkoloshnikom was still). <br>  February.  Frost minus 30 for sure!  Night, moment of truth!  Stuck in a handkerchief, the reading was successful.  There was then no wire gauges, no checks on the fronts (there would be hells of fronts because of the capacity of the wires), no current consumed (we feed two cards! And! Drum roll: switch the toggle switch! And ... <br><br>  I almost put in the pants.  Then I learned that there is a buzzer in the payphone.  What has a very powerful.  Night, <s>street lantern,</s> yelling a payphone and next to it a cupcake with some kind of box from which wires go to the payphone.  The funny thing is that thanks to the drops of solder, my card is stuck in the bowels of the payphone.  And then he didn‚Äôt guess to take the pliers with him and took this device with his teeth from a steel card reader.  How they did not leave their lips - I do not know. <br><br>  Oh, romance.  Now it's so nice to remember the phreaking youth.  Albeit not very effective, although how to look. <br><br><h4>  Total </h4><br>  The conclusion in the magazine was very naive, but fun. <div class="spoiler">  <b class="spoiler_title">Conclusion from the magazine:</b> <div class="spoiler_text">  Unfortunately, within one article I can tell you about all the intricacies of a payphone device, the topic is quite extensive and excites the minds of many hackers around the world.  As far as possible I will try to cover it in my lj-community (ru_radio_electr), as well as share information on soap.  One thing I can say for sure: phreaking in the form of manufacturing emulators has died.  According to MGTS, the last emulator was recorded 3 years ago.  Cryptography is not defeated by one small controller.  To do this, you just need to be a genius.  Of course, nothing is impossible, but for inexperienced people it will be an impossible task, and for professionals this is simply not interesting.  I recommend to leave the idea of ‚Äã‚Äãmaking a payphone card emulator and look for easier ways to make free calls. <br></div></div><br><br>  I can only say, thanks to <b>MGTS</b> and in general to telephone networks for our happy childhood!  And a <b>big human thanks to the MGTS company</b> , which did give a glimpse into the depths of what we wanted to break.  These and other photos in full size can be found <a href="https://picasaweb.google.com/101198126153122968625/ZJLhML%3Fauthuser%3D0%26feat%3Ddirectlink">here.</a> <br>  To be fair, the original article lives <a href="http://www.xakep.ru/magazine/xa/095/xa_095.pdf">here</a> (30th p. PDF, 71 megabytes!). <br><br>  ZY  <a href="http://habrahabr.ru/users/dihalt/" class="user_link">DIHALT</a> can rightly accuse me of necropolitanism, but on the other hand, lately I don‚Äôt want to post junk at all (and you can write so much: RFID, a computer in oil, and much more).  Since the inspiration of that time has passed, and there is already no inspiration to write.  This article is just like a continuation of phreaking articles from different authors.  They inspired me to the feat. <br><br>  <b>ZZY</b>  <b>Remember, the best thanks to the author for the post: left a comment!</b> </div><p>Source: <a href="https://habr.com/ru/post/194166/">https://habr.com/ru/post/194166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194142/index.html">Database connection pools - why and why</a></li>
<li><a href="../194150/index.html">How we built a simulator: an invaluable experience</a></li>
<li><a href="../194154/index.html">D-Link IP Security Hole? No, this is ‚ÄúFeature‚Äù!</a></li>
<li><a href="../194160/index.html">UNIX early history</a></li>
<li><a href="../194162/index.html">Free Month at CodeSchool by NewRelic</a></li>
<li><a href="../194168/index.html">OpenZFS: a truly open source ZFS successor</a></li>
<li><a href="../194172/index.html">Skype app store will be closed on October 21</a></li>
<li><a href="../194176/index.html">The history of personal computers in advertising. Part 3: 1990s</a></li>
<li><a href="../194180/index.html">Github visualizes changing the code of 3D models</a></li>
<li><a href="../194182/index.html">AI do it yourself. Are you ready to start?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>