<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Amelisa. Offline and realtime engine for React and Mongo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wrote recently a data synchronization engine with first-class offline support. For example, you can go offline, change data, close the browser, open t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Amelisa. Offline and realtime engine for React and Mongo</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bcf/c20/1a6/bcfc201a6a49445780d45a32a6b0294a.png" align="left"><br>  Wrote recently a data synchronization engine with first-class offline support.  For example, you can go offline, change data, close the browser, open the browser, open the site (go online) and the data is lost without loss.  Also during online data between the client and the server are synchronized in real time.  I want to tell you what the idea was, what kind of solutions / technologies there are and to whom it might be useful. <br><br><br clear="all"><br><br><a name="habracut"></a><br><h2>  Problem </h2><br>  Web application requirements are on the rise.  Previously, everyone was happy with static pages, but now users want the comments under the pictures of the seals to be updated right away, the likes are wound up in front of you, event notifications come without waiting for the page to reload.  With the growing popularity of mobile devices, the concept of <a href="http://offlinefirst.org/">Offline First has</a> emerged, with the idea that the application should take into account instability or lack of a network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The web is a distributed environment.  And synchronization of data in a distributed asynchronous environment is not an easy task.  Everything is facilitated by the fact that for most applications there are no strict requirements for the reliability of the displayed data.  It is not so important if some commentary for a picture with a cat does not come from the server or if two users see a slightly different number of likes. <br>  Usually, in such cases, the implementation of a real-time is screwed to an already existing REST-API, where the server somehow knows what data the client is interested in at a given time (subscription) and when changing this data in the database, sends patches with updates to the client via a WebSocket connection, or some ready-made solution is used.  Let's take a closer look, which is now popular to use to work with data on the web. <br><br><h2>  Solutions </h2><br>  <a href="https://facebook.github.io/flux">Flux</a> is a methodology (and implementation) for working with data from Facebook.  The main idea is one-pointedness.  How exactly the data is obtained from the server is not included in the area of ‚Äã‚Äãinterest Flux.  If you wish, you can make Flux-stor realtime. <br><br>  <a href="https://github.com/reactjs/redux">Redux</a> is the newest and most popular Flux-like library.  It differs from Flux in simplicity (there is no dispatcher, one way itp). <br><br>  <a href="https://facebook.github.io/relay">Relay</a> is a new framework from Facebook, replacing the Flux methodology.  Each React component can request data from the server that it needs.  This is done using the <a href="https://facebook.github.io/graphql">GraphQL</a> language.  Such an abstract query language can be a good solution if you have many different data sources (databases), but you also need to describe how it is converted into database query languages ‚Äã‚Äãfor the entire data schema.  Relay allows you to request only a part of the document and resolves situations when several components have requested the same data, which is useful when you have a large number of components.  Subscriptions should <a href="https://github.com/facebook/relay/issues/541">appear</a> soon. <br><br>  <a href="http://netflix.github.io/falcor">Falcor</a> is a Netflix engine.  It has a single interface for working with local and remote data.  Also interesting is the concept of paths. <br><br>  <a href="https://www.meteor.com/">Meteor</a> was a kind of revolutionary and strongly promoted the idea of ‚Äã‚Äãisomorphic api for working with data and real-time.  Subscriptions are made directly to Mongo requests, and the patches from the data exchange are operations from Mongo oplog.  Meteor is not even a framework, but rather a platform, with its package manager. <br><br>  <a href="https://www.firebase.com/">Firebase</a> - realtime BAAS.  An interesting and quite popular paid service that solves the problem of real-time in web applications. <br><br>  <a href="https://github.com/janmonschke/diffsync">Diffsync</a> uses the <a href="https://github.com/janmonschke/diffsync">diffs</a> algorithm for JSON objects, similar to what Git does for strings.  Then, the client and server exchange these diffs.  This can work well if your application is not high collaborative. <br><br>  In order to fully insure yourself against inaccuracy and data loss, it is not enough to exchange patches, you need a more serious approach.  There are two conflict resolution techniques for distributed asynchronous systems - <a href="https://en.wikipedia.org/wiki/Operational_transformation">OT</a> and <a href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type">CRDT</a> .  Data is presented as a state and log of operations.  The state is the result of the sequential application of all operations from the log and has its own version.  Typically, the minimum state entity is a document and document-oriented databases are used as storage.  The transaction log can be stored in the same or another repository.  In addition, certain metadata is stored along with the state - state version, timestamp, data type, and so on.  CRDT also has a state-based version, which is used, for example, in <a href="http://docs.basho.com/riak/latest">Riak</a> .  But to transfer, with each change, the entire document (state) is not as effective as just one operation, so op-based CRDT is usually used on this web. <br><br>  <a href="https://github.com/share/ShareJS">ShareJS</a> is the most popular OT implementation.  I already <a href="https://habrahabr.ru/post/206324">wrote</a> about her.  You can add that the main advantages of ShareJS are operations on strings, arrays, numbers (this is useful if you are doing a collaboration editor, for example), as well as having a common JSON data type implementation and the ability to subscribe to Mongo requests.  For OT, a source of truth is needed, where operations are actually converted.  This is usually a server.  Implementing a full-fledged offline for OT is an extremely difficult task (I don‚Äôt know any implementation).  I must say that OT is actively used by Google in services such as Docs, Wave.  We, in the <a href="http://decisionmapper.com/">company</a> where I work, use ShareJS (as part of the <a href="http://derbyjs.com/">DerbyJS</a> framework) for a single year, and the flight is normal. <br><br>  All the engines / libraries described above do not have full support for offline, because this requires equal distributed replicas of data, as in Git, global versions of states and so on.  There are different approaches here, but the most interesting, in my opinion, is CRDT.  Solutions in this area look like this: <br><br>  <a href="http://hood.ie/">Hoodie</a> - Offline First framework tied to CouchDB.  In the new version on the client will use <a href="http://pouchdb.com/">PouchDB</a> .  CouchDB stores the entire history of document states, which is used for offline.  You can draw an analogy with Git - with offline, the history of states is divided into two branches: server and client, and when online they merzhatsya.  Something similar to state-based CRDT.  CouchDB - by and large key-value storage, there is also a basic implementation of requests, but not as rich as, for example, in Mongo. <br><br>  <a href="https://github.com/gritzko/swarm">Swarm</a> is a CRDT engine developed by our <a href="https://twitter.com/gritzko">Siberian</a> <a href="https://github.com/abalandin">scientists</a> .  It has many data types - key-value, strings, arrays, and so.  Swarm is not tied to any database and, accordingly, does not support subscription for requests.  The implementation of subscriptions to queries in general (without a link to a specific database) is not a trivial matter. <br>  Victor has very <a href="https://www.youtube.com/watch%3Fv%3DBfzjuhX4wJ0%26feature%3Dyoutu.be%26t%3D6h31m10s">interesting</a> <a href="https://www.youtube.com/watch%3Fv%3DuyZKWyciSXY">reports</a> and <a href="https://radiojs.ru/2015/11/radiojs-33">interviews</a> . <br><br>  A common point for all solutions is that if there is a server part, then it is written in Javascript and requires NodeJS.  This is due to the fact that a significant part of the code between the client and the server is reused. <br><br>  Surely there are still interesting solutions, about which I do not know or did not remember.  Share in the comments, we will discuss. <br><br><h2>  Amelisa </h2><br>  The idea was to combine CRDT offline capabilities and Mongo-query subscriptions.  Wrap it in an isomorphic <a href="https://github.com/derbyjs/racer">Racer</a> -like api and integrate with React.  Add insights from ShareJS for access control, scaling and so on. <br>  Compared to SwarmJS, I had to sacrifice a variety of data types.  Unlike ShareJS and its generic JSON data type (including operations on objects, arrays, strings, and numbers), in Amelisa each document is an ordinary key-value (operation on objects). <br>  From <a href="https://github.com/RickWong/react-transmit">Transmit</a> , an idea was taken of how to implement server-side rendering for a tree of components, each of which subscribes to data in isolation.  The difficulty here is that the input data for the underlying components is not known, until the overlying data receives data from the database and is rendered. <br>  There is also the similarity of join'ov and the ability to mix Mongo-query subscriptions with data fetches from regular url (REST-api, third-party services, etc.). <br>  Read more about the features in the <a href="http://amelisajs.com/">documentation</a> .  Although at the moment it leaves much to be desired, and it may be easier to look at <a href="https://github.com/amelisa/amelisa-crud-example">an example of a CRUD application</a> that has authorization based on the <a href="https://github.com/amelisa/amelisa-auth">Amelisa Auth</a> module and basic access control.  For the most daring - <a href="https://github.com/amelisa/amelisa">source code</a> . <br><br>  Most likely, Amelisa will be interesting in those projects where offline and data synchronization is needed, but there is no requirement to do collaborative editors and so on.  A good use-case can be a todo-list application that runs on the phone as a native or web application and on the desktop as a web application.  At the same time, the user does not want to think online or offline to view his task list for today, mark completed or add new ones.  And at the moment when it will be online, the data is synchronized between all devices. <br>  Also in the requirements for Amelisa can include React, Mongo, NodeJS. <br><br>  Currently working on stabilization and integration with <a href="https://facebook.github.io/react-native">React Native</a> .  We are also writing a mobile application that uses Amelisa and very soon it should go into production.  The best way to follow the news is to <a href="https://twitter.com/amelisajs">follow Amelisa</a> on <a href="https://twitter.com/amelisajs">Twitter</a> . <br></div><p>Source: <a href="https://habr.com/ru/post/277645/">https://habr.com/ru/post/277645/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277631/index.html">Kilometers of logs and recovery of databases on MS SQL</a></li>
<li><a href="../277635/index.html">Get websocket data using swift and populate UITableView (node.js server)</a></li>
<li><a href="../277637/index.html">Automatic work with SMS on the modem ZTE-MF823</a></li>
<li><a href="../277639/index.html">Implementing a MODBUS RTU server using the Fastwel interface module and CoDeSys software</a></li>
<li><a href="../277643/index.html">Load testing - product quality assurance stage</a></li>
<li><a href="../277649/index.html">50 shades of paranoia or how to store passwords without saving</a></li>
<li><a href="../277653/index.html">Installing a Django project on a VPS (centOS 7) [For Beginners]</a></li>
<li><a href="../277655/index.html">Access MySQL data from a UWP application without using services</a></li>
<li><a href="../277657/index.html">Your cloud hosting in 5 minutes. Part 0: Virtualization</a></li>
<li><a href="../277663/index.html">What we should build LVM (principle of operation, performance, Thin Provision)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>