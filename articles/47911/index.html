<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unix Recovery Legend</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now there are a lot of thoughts about what awaits us in the future, in 2009, and even after. But why not for a moment return to the past and admire ho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unix Recovery Legend</h1><div class="post__text post__text-html js-mediator-article">  Now there are a lot of thoughts about what awaits us in the future, in 2009, and even after.  But why not for a moment return to the past and admire how the hardcore unixoids of that time got out, restoring the system? <br><br>  This is a translation of the <a href="http://www.ee.ryerson.ca/~elf/hack/recovery.html">article by</a> <a href="http://www.wolczko.com/">Mario Wolczko</a> published in Usenet in 1986. <br><br><a name="habracut"></a><br>  Has it ever happened that you left a terminal logged in, just to go back and see how a (supposed) friend wrote <b>rm -rf ~ / * in it</b> and stands near the keyboard: - Lend me a five until Thursday, or I press enter . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Without a doubt, this person does not understand what kind of injury he can inflict, and perceives everything as a nice joke. <br><br>  It was a quiet environment.  To be precise - Wednesday October 1st, 3:15 pm British Daylight Time.  Peter, my colleague, walked away from his terminal and told me: - Mario, I have a small problem with sending mail. <br><br>  Understanding that such a message could confuse anyone, I decided to walk to his terminal to see what was wrong. <br><br>  There was a strange error message in the terminal, something like this (I don‚Äôt remember all the details): <b>cannot access / foo / bar for userid 147</b> <br><br>  At first I thought: who has userid 147?  The sender of the message, the recipient or something else?  Then I switched to another, already logged terminal, and dialed <br><pre>  grep 147 / etc / passwd </pre><br>  just to get an answer <br><pre>  / etc / passwd: No such file or directory. </pre><br>  Immediately I suggested that something is not.  All confirmed in response to <br><pre>  ls / etc </pre><br>  I got <br><pre>  ls: not found. </pre><br>  I advised Peter that it would be a good idea not to touch anything now, and went to look for our system administrator. <br><br>  When I came to his office, his door was ajar, and within 10 seconds I realized what the problem was.  James, our manager, sat with his head in his hands, hands between his knees, like a man whose world had just collapsed.  Our newly appointed system programmer, Neil, stood behind him and watched his terminal intently and sluggishly on his screen.  And I looked at the top of the screen: <br><pre>  # cd &lt;br/&gt; # rm -rf * </pre><br>  Oh, shit, I thought.  And this explains everything. <br><br>  I don‚Äôt even remember what happened next;  my memory is blurred.  I only remember that we tried <b>ls</b> (again), <b>ps</b> , <b>who</b> and maybe a few more commands - all is useless.  The next thing I remember: I‚Äôm at my terminal again (multi-window graphic terminal), dialing <br><pre>  cd / &lt;br/&gt; echo * </pre><br>  I have to thank David Korn, because he has made <b>echo</b> embedded inside the shell;  Needless to say, the binary file <b>/ bin / echo</b> for a company with all <b>/ bin has</b> been removed.  What became clear in the next few minutes is that <b>/ dev</b> , <b>/ etc</b> and <br>  <b>/ lib</b> disappeared inseparably, but fortunately, Neil interrupted <b>rm</b> at a time when she was somewhere between <b>/ news</b> and <b>/ tmp</b> ;  <b>/ usr</b> and <br>  <b>/ users</b> left untouched. <br><br>  In the meantime, James got to our cabinet with cassettes and pulled out something with the inscription that it was a backup of the root file system, made four weeks ago.  The question was in the air: - How can we restore the contents of the tape? <br><br>  After all, we lost not only <b>/ etc / restore</b> - all the device files of the tape drive controller were erased.  Where does <b>mknod</b> live?  Right, <b>/ etc.</b>  How about recovering any of them over Ethernet from another VAX?  Understandably, <b>/ bin / tar</b> was gone, and <b>rcp</b> people from Berkeley carefully put in <br>  <b>/ bin</b> in the 4.3 distribution.  In addition, for the network we need at least <b>/ etc / hosts</b> .  We found the <b>cpio</b> version in <b>/ usr / local</b> , but, unfortunately, it is useless without a tape drive controller. <br><br>  Alternatively, we could pull out the boot tape and rebuild the root filesystem, but neither James nor Neil had ever done this before, and we were not sure that this was what we needed - a completely reformatted disk and the loss of all our user files (we back up user files every Thursday; according to Murphy's law, everything should have happened on Wednesday). <br>  Another solution is to borrow a disk from another VAX, boot from it, and only then figure it out;  but then you would have to call a DEC-engineer - this is at best.  We had many users in the throes of completing their PhD theses, and the loss of possibly weekly work was unthinkable. <br><br>  So what to do?  The next idea was to write a program that would create a device descriptor for a tape drive controller, but we all know where <b>cc</b> , <b>as</b> and <b>ld</b> live.  Or, maybe, make the minimum view of <b>/ etc / passwd</b> , <b>/ etc / hosts</b> , etc., so that <b>/ usr / bin / ftp</b> can work.  By luck, I was still open in one of my <b>gnuemacs</b> windows - we could use it to create <b>passwd</b> and everything else, but the first step is to create a directory to put them there.  Of course, <b>/ bin / mkdir</b> was removed, the same thing happened with <b>/ bin / mv</b> , so we could not rename <b>/ tmp</b> to <b>/ etc.</b>  However, this was clearly the right line of attack. <br><br>  Alasdair, our local UNIX guru, who turned out to be a VAX assembler, joined us by that time.  So our plan was this: <br><ol><li>  write a program in assembler that could either rename <b>/ tmp</b> to <b>/ etc</b> or create <b>/ etc</b> ; </li><li>  assemble it on another VAX, make <b>uuencode</b> ; </li><li>  write it to a uu-encoded file using my GNU, and make a <b>uudecode</b> (some clever person <b>thought</b> to put <b>uudecode</b> in <b>/ usr / bin</b> ). </li></ol><br>  It remains to run the program.  Another miracle: the terminal, which was used to damage, was still superuser after <b>su</b> (just remember that <b>su</b> is in <b>/ bin</b> ), so we at least have a chance that it will work. <br><br>  And now, we are already on the charming path to success.  Spending just an hour, we concocted about a dozen lines in assembler to create <b>/ etc.</b>  The cropped binary file was only 76 bytes long, so we converted it to HEX (reads a little better than the <b>uuencode</b> output), and recorded it using my editor.  If you ever have such a problem, here is the HEX for the future: <pre>  &lt;br/&gt;
 070100002c0000000000000000000000 &lt;br/&gt;
 00000000000000000000000000000000 &lt;br/&gt;
 dd8fff010000dd8f27000000fb02ef0700 &lt;br/&gt;
 0000fb01ef070000000000bc8f88000400 &lt;br/&gt;
 00bc012f65746300 </pre><br><br>  I had an improvised program (and what, someone did not have?) To convert ASCII HEX to binary code, and the output of <b>/ usr / bin / sum</b> coincided with our original binary file.  But stop, wait a second - how do you set permissions to execute without <b>/ bin / chmod</b> ?  For a few seconds, a thought formed (which, as usual, completes a couple of minutes of thought) brought a solution to the problem: you need to write a binary file on top of an existing file for which I am the owner.  That's good. <br><br>  We returned to the terminal with superuser privileges, carefully remembered to set the umask to 0 (so that I could create files inside using my GNU), and started the binary file.  Now we had <b>/ etc</b> , with write access for everyone.  Now there were only a few steps left: you had to create <b>passwd</b> , <b>hosts</b> , <b>services</b> , <b>protocols</b> , (etc), after which <b>ftp</b> was ready to go.  Then we restored the contents of <b>/ bin</b> over the network (it's incredible how terribly you miss <b>ls</b> after just a few short hours without it) and took the files from <b>/ etc.</b>  The key file was <b>/ etc / rrestore</b> , with its help we restored <b>/ dev</b> from backup tapes.  Here and the fairy tale is over. <br><br>  And now we ask ourselves the question: what is the moral of this story?  Well, for starters, remember well the eternal words: <strong>do not panic</strong> .  After all, at first we just wanted to restart the computer and try everything as a single-user, but, unfortunately, the system would not have found <b>/ etc / init</b> and <b>/ bin / sh</b> at startup.  Common thinking saved us from such actions. <br><br>  The next thing to remember is that the UNIX utilities can be used for purposes that are not really typical for them.  Even without my <b>gnuemacs,</b> we could survive using, say, <b>/ usr / bin / grep</b> as a replacement for <b>/ bin / cat</b> . <br><br>  And the last thing.  It is unbelievable how much a huge part of the system can be removed without finally destroying it.  Despite the fact that no one would be able to log in ( <b>/ bin / login</b> ?), And almost all the necessary commands were gone, everything else looked fine.  Naturally, some things cannot remain alive without, say, <b>/ etc / termcap</b> , <b>/ dev / kmem</b> or <b>/ etc / utmp</b> , but, ultimately, everything works in peace and harmony. <br><br>  I leave the question: being in the same situation, with the ability to think, given the experience acquired now, could this problem be solved more easily? <br></div><p>Source: <a href="https://habr.com/ru/post/47911/">https://habr.com/ru/post/47911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../47899/index.html">Red search engine</a></li>
<li><a href="../47900/index.html">Windows 7 Beta 7000 appeared on torrents.</a></li>
<li><a href="../47906/index.html">OCZ NIA. Thought control and what they eat it with. Overview</a></li>
<li><a href="../47908/index.html">We organize relevant search across heterogeneous data using Sphinx</a></li>
<li><a href="../47910/index.html">Scrum and XP: advanced notes</a></li>
<li><a href="../47913/index.html">Do I need a website with promising ideas of service mini-startups?</a></li>
<li><a href="../47914/index.html">ICQ, Jabber, email and spam</a></li>
<li><a href="../47915/index.html">Frequent programming errors in Bash (continued)</a></li>
<li><a href="../47917/index.html">Almost 90% of UK homes take digital TV</a></li>
<li><a href="../47918/index.html">Filling the site with materials. Cry from the heart.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>