<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hell of a bare iron programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! It's a shame few articles devoted to the hellish programming of the wonderful programming language of Hell, and even more so there are no th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hell of a bare iron programming</h1><div class="post__text post__text-html js-mediator-article">  Good day!  It's a shame few articles devoted to the <s>hellish programming of the</s> wonderful <s>programming</s> language of Hell, and even more so there are no them programming on it for microcontrollers.  But the language itself is even positioned as a language of embedded systems ... Maybe it is very difficult? <br><br>  I will try in this small note to give a classic example of the LED blinking program, but in Hell, so that everyone could repeat. <br><a name="habracut"></a><br>  As a motherboard, I use some kind of Chinese motherboard with a stm32f407vet6 processor, its LED is connected on port A to pin PA6.  As a programming environment, I will use gnat for <a href="http://libre.adacore.com/">arm</a> under ubuntu, st-link v2 is connected for uploading and the st-link package is installed (you need to build and install it from <a href="">stlink.git</a> ), but you can use any other programmer (for example, SEGGER) . <br><br>  Fortunately, stm32f4xx is also included in the supported processors, so all you need to do is create a project file with the version of target and runtime.  Well, write our own program.  To make life easier, I used the svd2ada program to automatically generate peripheral description files from the svd file for my processor.  Svd description can be taken from the standard package, and the program svd2ada is on <a href="http://github.com/AdaCore/svd2ada">GitHub</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All source code is available on <a href="https://github.com/oam2oam/ada-led-stm32">GitHub</a> . <br><br>  So - the actual program below: <br><br><pre><code class="hljs delphi"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> STM32F40x; use STM32F40x; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> STM32F40x.RCC; use STM32F40x.RCC; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> STM32F40x.GPIO; use STM32F40x.GPIO; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Ada.Real_Time; use Ada.Real_Time; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Led_Pin</span></span></span><span class="hljs-function"> :</span></span> constant := <span class="hljs-number"><span class="hljs-number">6</span></span>; Port : ODR_Field renames GPIOA_Periph.ODR.ODR; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> --  clock <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GPIO-A RCC_Periph.AHB1ENR.GPIOAEN := <span class="hljs-number"><span class="hljs-number">1</span></span>; --  PA6 GPIOA_Periph.MODER.ARR(Led_Pin) := <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">#01</span></span>#; GPIOA_Periph.OTYPER.OT.ARR(Led_Pin) := <span class="hljs-number"><span class="hljs-number">0</span></span>; GPIOA_Periph.OSPEEDR.ARR(Led_Pin) := <span class="hljs-number"><span class="hljs-number">0</span></span>; --     loop Port.Arr (Led_Pin) := Port.Arr (Led_Pin) xor <span class="hljs-number"><span class="hljs-number">1</span></span>; delay <span class="hljs-keyword"><span class="hljs-keyword">until</span></span> Clock + To_Time_Span(<span class="hljs-number"><span class="hljs-number">1.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> loop; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> main;</code> </pre> <br>  First, how to collect all this and run ... <br><br>  Below are all the commands for bash in the project directory, all utilities are installed in / opt / gnat / bin <br><br>  Step 1. Set the paths so that the toolchain we need is called <br><br><pre> <code class="hljs pgsql">export <span class="hljs-type"><span class="hljs-type">PATH</span></span>=/opt/gnat/bin:$<span class="hljs-type"><span class="hljs-type">PATH</span></span></code> </pre> <br>  Step 2. Putting the executable file. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">gprbuild</span></span> -P step1.gpr</code> </pre> <br>  Step 3. Create a bootable binary for st-flash: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">arm-eabi-objcopy</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-O</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">binary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bin</span></span></code> </pre> <br>  Step 4. Download our firmware via st-link2 connected via USB <br><br><pre> <code class="hljs pgsql">st-flash <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> main.bin <span class="hljs-number"><span class="hljs-number">0x8000000</span></span></code> </pre> <br>  If everything went well, then you can admire the flashing LED ... <br><br>  Now for some explanation.  For this target board, all the necessary initialization code has already been written, and the processor frequency is set to 168 MHz, so we had very little code to write.  Port string: ODR_Field renames GPIOA_Periph.ODR.ODR is introduced for code readability.  The Funcion Clock returns the current time (precision - microseconds). <br><br>  In addition, for Ada-programs there is practically no need for an operating system (this is how the OS itself is) for the implementation of tasks, synchronization tools, etc. <br><br>  All the richness of the Hell language for this processor is not available, since a special profile is defined for the compiler - namely, Pragma Profile (Ravenscar).  This profile introduces a number of restrictions to ensure that your program is guaranteed to work in such an environment. <br><br>  However, these limitations can be artificially circumvented, but the main advantage of this language feature is that if you write a program within this profile, then most likely it will work ... <br><br>  That's all, write in the comments that is not clear, I will try to answer.  In the next article I will try to give the full development cycle of an interesting application on Ada for the same microprocessor starting with the description and analysis of the system on aadl and ending with automatic proof using SPARK. </div><p>Source: <a href="https://habr.com/ru/post/351062/">https://habr.com/ru/post/351062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351052/index.html">Why should ignore the history of the founders of successful startups</a></li>
<li><a href="../351054/index.html">How to make a good UI animation great</a></li>
<li><a href="../351056/index.html">Where digital engineers will come from</a></li>
<li><a href="../351058/index.html">Guide to SEO javascript sites. Part 2. Problems, experiments and recommendations</a></li>
<li><a href="../351060/index.html">We write Telegram-bot on Go to search Wikipedia</a></li>
<li><a href="../351068/index.html">Program for digitizing graphs, drawings, drawings: algorithms for the project ‚ÄúTutor: Mathematics‚Äù</a></li>
<li><a href="../351070/index.html">Unexpected earnings difficulties on the Internet</a></li>
<li><a href="../351072/index.html">Password change: 10 steps to good implementation</a></li>
<li><a href="../351074/index.html">How to quickly write and roll out in the production of machine learning algorithm</a></li>
<li><a href="../351078/index.html">Performance and runtime at the JPoint 2018 conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>