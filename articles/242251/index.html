<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Algorithms for eliminating false and redundant data in the GPS stream</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Development of electronics based on GPS / GLONASS technologies is one of our favorite topics on Habr√©. We have already written a review article on thi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Algorithms for eliminating false and redundant data in the GPS stream</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bfc/3d3/f96/bfc3d3f963744e009193c40e6946513c.png"><br><br>  Development of electronics based on GPS / GLONASS technologies is one of our favorite topics on Habr√©.  We have already written a <a href="http://habrahabr.ru/company/promwad/blog/202722/">review article</a> on this topic, talked about the <a href="http://habrahabr.ru/company/promwad/blog/180689/">ERA-GLONASS system</a> and even <a href="http://habrahabr.ru/company/promwad/blog/223635/">determined our location</a> via cellular networks. <br><br>  This time, our post is designed to answer the specific practical question: "How to reduce the amount of data flow from navigation and communication terminals without losing information?".  This topic is very relevant, because wireless services make up a significant part of the financial costs of servicing transport monitoring systems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin, let's see what is the path of preparation and collection of information on the terminals before sending data to the server. <br><a name="habracut"></a><br>  The figure below shows a flowchart of this process: <br><br><img src="https://habrastorage.org/files/e26/659/8fb/e266598fb87b4c9eb4cdb089eb840580.png"><br><br>  The stage of the point formation, from the moment of receiving the coordinates from the GPS receiver to the moment of transfer to the server, can be divided into three preparatory parts: stabilization, filtering and thinning. <br><br>  Stabilization and filtering are optional steps, they are needed to correct the imperfect reception quality of the GPS signal.  Often, the stabilization problem can be solved by the accelerometer installed on the device, as well as by the algorithm for averaging points.  In this way, we get rid of the so-called "stars" in the vehicle stops and can become attached to a static position when the vehicle is at rest. <br><br>  Filtering is designed to track physically impossible coordinate throws.  Such a situation arises in short-term critical reception conditions (for example, under power lines). <br><br>  And, finally, decimation of points or decimation is the most common and logical stage in the task of reducing the amount of transmitted data, we will consider it in this article. <br><br><h4>  1. Thinning points or decimation in navigation systems </h4><br>  Suppose that each navigation point contains information about the location of the vehicle, information obtained from sensors installed on board and any statuses characterizing the state of the system.  Usually, information from the GPS receiver arrives every second, i.e.  every second we have a generated data set, which without the decimation algorithm would have to be transmitted completely.  This information is for the most part redundant. <br><br>  If the vehicle was moving relatively evenly along some part of the road, then we will not lose important data if we drop intermediate points.  At the same time, we will save points in areas where there were dramatic changes in navigation parameters.  Below is an example of thinning points on this principle: <br><br><img src="https://habrastorage.org/files/e76/486/9a6/e764869a6bee403f964da911dcd8e1cd.png"><br><br>  In this example, we saved 72% of the data in the case of an average degree of thinning and as much as 96% in the case of severe conditions of thinning!  As you can see, this simple method gives a huge advantage in saving memory. <br><br>  But in real conditions, when the navigation data is supplemented with information from the onboard sensors, the algorithm is a bit more complicated, as it becomes necessary to transmit data also on system events.  Therefore, all the thinning criteria can be divided into groups according to priorities: system events (‚Äúinterruptions‚Äù) and information on the vehicle navigation characteristics. <br><br>  System events include the following: power on / off, connection establishment / loss with satellites, etc. Obviously, system interrupts take precedence over general information.  The relationship between priority and importance of information can be represented by the following flowchart: <br><br><img src="https://habrastorage.org/files/b20/bcc/fdb/b20bccfdb1bf418f82f55749cb916b6e.png"><br><br>  When one of the conditions is met, the packet is passed on to check the remaining conditions or is sent to a non-linear buffer.  If none of the conditions are met, then the packet is dropped from the stream. <br><br>  An example implementation of the thinning algorithm in the C language may be as follows: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TIME_LIMIT 60 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//sec #define HDOP_LIMIT 400 #define DISTANCE_LIMIT 300 //m #define SPEED_LIMIT 4000//km/h #define COURSE_LIMIT 9000 //deg GPS_DATA previous_sample; int GPS_decimator(GPS_DATA * sample) { if (sample-&gt;time.sec + sample-&gt;time.min*60 + sample-&gt;time.hour*3600 - previous_sample.time.sec - previous_sample.time.min*60 - previous_sample.time.hour*3600 &gt; TIME_LIMIT) { return 1; } if (sample-&gt;hdop &gt; HDOP_LIMIT) { return 0; } double UTMNorthing; double UTMEasting; double GPS_passed_northing; double GPS_passed_easting; char UTMZone[4]; double la; modf(sample-&gt;la/100,&amp;la); la += ((sample-&gt;la)-la*100)/60; double lo; modf(sample-&gt;lo/100,&amp;lo); lo += ((sample-&gt;lo)-lo*100)/60; //convert coordinates to UTM LLtoUTM(la, lo, &amp;UTMNorthing, &amp;UTMEasting, UTMZone); double pla; modf(previous_sample.la/100,&amp;pla); pla += ((previous_sample.la)-pla*100)/60; double plo; modf(previous_sample.lo/100,&amp;plo); plo += ((previous_sample.lo)-plo*100)/60; //convert coordinates to UTM LLtoUTM(pla, plo, &amp;GPS_passed_northing, &amp;GPS_passed_easting, UTMZone); if (sqrt(pow(UTMNorthing-GPS_passed_northing,2)+pow(UTMEasting-GPS_passed_easting,2)) &gt;= DISTANCE_LIMIT) { return 1; } if ((previous_sample.speed - sample-&gt;speed)*(previous_sample.speed - sample-&gt;speed) &gt;= SPEED_LIMIT*SPEED_LIMIT) { return 1; } if ((previous_sample.course - sample-&gt;course)*(previous_sample.course - sample-&gt;course) &gt;= COURSE_LIMIT*COURSE_LIMIT) { return 1; } return 0; }</span></span></span></span></code> </pre> <br>  <a href="">The application</a> contains a full listing of the program (cpp-file, 17 KB).  The example of the program is purely demonstrative in nature and has not been used in real projects. <br><br><h4>  2. Using the optimal data transfer protocol </h4><br>  The second way to reduce the amount of transmitted data is to use the optimal data transfer protocol.  To begin with, we distinguish two main types of protocols: text and binary or binary. <br><br>  <b>The text protocol</b> , for example, is NMEA, which is used in GPS receivers.  In the simplest case, the transfer of an RMC string of this protocol may be sufficient to transmit navigation information. <br><br>  <i>The main features of the text protocol:</i> <br><ul><li>  convenient for visual perception; </li><li>  one package contains one waypoint; </li><li>  integrity is guaranteed by checksum; </li><li>  has a fixed number of fields in the package; </li><li>  data is transmitted in the clear; </li><li>  all numerical data must be converted to text and back; </li><li>  the protocol does not imply saving the number of bytes in the packet. </li></ul><br>  <i>An example of using a text protocol:</i> <br><br><img src="https://habrastorage.org/files/f5f/962/6ca/f5f9626ca2e34581967d8acd1dbaf4b6.jpg"><br><br><blockquote>  In the photo: a <a href="http://promwad.ru/portfolio/personalnyy-gps-navigator-s-elektronnym-kompasom">personal GPS navigator with an electronic compass</a> - a long-standing project of the Promwad engineering team, one of the first experiences in the field of navigation.  This simple device returns the user to the starting point or pre-marked place on the coordinate system. <br><br>  The project used the text protocol NMEA.  The hardware platform of the navigator was built on the basis of electronic components with optimal parameters in order to ensure a low cost price of the device (at the level of 30 USD for a batch of 10,000 pieces).  As a result, we had to solve interesting problems of optimizing algorithms for calculating distances and directions. <br><br>  The GPS module of the navigator sent the coordinates in NMEA format to the Freescale MC9S08QE8 microcontroller, using them to determine the distance and motion vector to a given point.  Since  The memory size of the microcontroller was extremely limited, we implemented the transformation of coordinates into integer form, while the calculation error remained within acceptable limits.  More information about this development can be found in the <a href="http://promwad.ru/sites/default/files/portfolio/download/caseStudy-personal-gps-navigation-device-ru.pdf">PDF file with the technical description of the project</a> . </blockquote><br><br>  The second type, the <b>binary protocol</b> , has only one drawback - it is inconvenient for visual perception without the use of special tools.  Its use with the same number of parameters as in the text version allows saving more than twice the amount of data from one package. <br><br>  Using the binary protocol, you can transfer several waypoints at once, and in this way we speed up the process of transferring data from the buffer memory and save additional bytes for the transport packet headers. <br><br>  The binary protocol also allows you to authenticate devices on the data collection server and transmit various service information bilaterally.  Of course, some of these things can be transmitted using a text protocol, but this is not appropriate. <br><br>  Another great feature that a binary protocol gives is variable packet lengths.  Due to this, devices with different configurations of peripheral sensors can operate in one system.  Each packet has an indivisible part consisting of a header and navigation information ‚Äî the part that is the identification part, and additional fields with information received from the sensors.  Moreover, at any time moment only necessary data can be added. <br><br>  At first glance it may seem that with this approach problems may arise with the method of storing these packets in a non-volatile buffer, but this is easily solved by the information storage algorithm, more precisely, by choosing the structure of the stored data.  So different models of the device can work in one system, without violating the general concept. <br><br><h4>  Total </h4><br>  Field tests and years of operation of transport monitoring systems have shown that the thinning method is a very successful approach to reducing traffic volumes and does not distort the original track with a proper selection of thinning parameters. <br><br>  Regarding protocols, both text and binary are widely used in the development of monitoring systems.  As a rule, text protocols are used on simpler monitoring devices with a minimal fixed set of interface sensors.  These protocols are easy to recognize and recognize their data. <br><br>  More professional models are supplied with binary protocols, which allows to increase the security and reliability of data, and most importantly - to reduce the amount of data transfer and save money on system maintenance.  Also, the use of a binary data transfer protocol provides greater opportunities for interaction between mobile navigation and mobile terminals with a monitoring center (for example, you can organize interactive remote work with the device). <br><br>  We will continue to publish navigation articles, so join the <a href="http://habrahabr.ru/company/promwad/blog/">Promwad blog</a> subscribers. </div><p>Source: <a href="https://habr.com/ru/post/242251/">https://habr.com/ru/post/242251/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242233/index.html">How to restore a retro sound? The work of audio archaeologists from Southampton</a></li>
<li><a href="../242235/index.html">As a formal management, the whole department ruined.</a></li>
<li><a href="../242241/index.html">Getting unique content from video blogs</a></li>
<li><a href="../242243/index.html">ASP.NET vNext Likbez</a></li>
<li><a href="../242247/index.html">The first browser specifically for developers: soon</a></li>
<li><a href="../242253/index.html">As a Windows driver crafty breaks sound in Linux or painful bug searches</a></li>
<li><a href="../242255/index.html">Ilya Grigorik on the implementation of HTTP / 2</a></li>
<li><a href="../242257/index.html">Startup, Westing, Cliff: Shares in Business and Rights of Participants</a></li>
<li><a href="../242261/index.html">Effective Django. Part 2</a></li>
<li><a href="../242263/index.html">We restore the old clock "Electronics-7"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>