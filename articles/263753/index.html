<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search for similar groups and public Vkontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently managed to crank up an interesting thing. For all Vkontakte groups with the number of subscribers from 5,000 to 10,000 (~ 100,000 groups), a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search for similar groups and public Vkontakte</h1><div class="post__text post__text-html js-mediator-article">  Recently managed to crank up an interesting thing.  For all Vkontakte groups with the number of subscribers from 5,000 to 10,000 (~ 100,000 groups), a full graph was constructed in which the weight of the ribs equaled the intersection of the groups' audiences. <br><br><img src="https://habrastorage.org/files/07b/abc/b6e/07babcb6ec244be08d9cf5e7df81c409.png"><br><a name="habracut"></a><br>  First, such a graph looks beautiful: <br><br><img src="https://habrastorage.org/files/e3c/f97/074/e3cf970746a44c39bd29dfcefa825cb3.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Secondly, it can be used to quickly select groups of a given topic.  For example, you need to find a group about knitting.  For the keyword "knitting" we find one suitable group, <a href="https://vk.com/club71197950">Knitting - Knitting online-</a> , for example.  We deduce the groups with which it is associated: <br><br>  Knitting - Knitting online-: <br>  6.04% <a href="https://vk.com/club75577569">Corporation ‚ÄúYARK‚Äù</a> <br>  5.90% <a href="https://vk.com/club65805953">Mamochkin channel - for creative moms (HOOK!)</a> <br>  3.40% <a href="https://vk.com/club87484544">Knitting.</a>  <a href="https://vk.com/club87484544">In this world everything is connected ...))</a> <br>  3.01% <a href="https://vk.com/club53371463">YARN CHEAP. FLISS. ELASTIC BANDS FOR WEAVING BRACELETS</a> <br>  2.35% <a href="https://vk.com/club59200218">Spaghetti Yarn Spagetti</a> <br>  1.87% <a href="https://vk.com/club58678379">Eesti l√µng yarn shop (Kauni, Kauni)</a> <br>  1.73% <a href="https://vk.com/club44159519">* Crochet art *</a> <br>  1.70% <a href="https://vk.com/club57231027">Yarn Kauni (Kauni) - the legend of Estonia.</a>  <a href="https://vk.com/club57231027">Knitting.</a> <br>  1.66% <a href="https://vk.com/club7663754">¬´Lace motifs¬ª - knitting and needlework</a> <br>  1.54% <a href="https://vk.com/club33108116">Turkish yarn in stock and to order (Ukraine)</a> <br><br>  And we repeat until you get bored or until new names cease to appear. <br><br>  Knitting.  In this world everything is connected ...: <br>  8.88% <a href="https://vk.com/club75577569">Corporation</a> YARK <br>  3.06% <a href="https://vk.com/club65805953">Mamochkin channel - for creative mothers (HOOK!)</a> <br>  2.58% <a href="https://vk.com/club53371463">YARN CHEAP. FLISS. ELASTIC BANDS FOR WOOL BRACELETS</a> <br>  2.30% <a href="https://vk.com/club71197950">Knitting - Knitting online-</a> <br>  2.14% <a href="https://vk.com/club40561560">Online Store Yarn "Openwork"</a> <br>  1.94% <a href="https://vk.com/club57231027">Yarn Kauni (Kauni) - the legend of Estonia.</a>  <a href="https://vk.com/club57231027">Knitting.</a> <br>  1.85% <a href="https://vk.com/club86306132">Store yarn - ·É¶ YOUR YARN ·É¶</a> <br>  1.76% <a href="https://vk.com/club5084903">Yarn</a> <br>  1.72% <a href="https://vk.com/club73587182">Openwork world: connected with love!</a> <br>  1.55% <a href="https://vk.com/club58678379">Yesti l√µng yarn shop (Kauni, Kauni)</a> <br><br>  Corporation "Yarn": <br>  7.54% <a href="https://vk.com/club87484544">Knitting.</a>  <a href="https://vk.com/club87484544">In this world everything is connected ...))</a> <br>  4.01% <a href="https://vk.com/club65805953">Mamochkin channel - for creative moms (HOOK!)</a> <br>  3.47% <a href="https://vk.com/club71197950">Knitting - Knitting online-</a> <br>  3.20% <a href="https://vk.com/club53371463">YARN CHEAP. FLISS. ELASTIC BANDS FOR WEAVING BRACELETS</a> <br>  2.72% <a href="https://vk.com/club40561560">Online Store Yarn "Openwork"</a> <br>  2.67% <a href="https://vk.com/club5084903">Yarn</a> <br>  2.11% <a href="https://vk.com/club37664558">"Madame Vyazalkina" Yarn (Handicraft Products)</a> <br>  2.00% <a href="https://vk.com/club57231027">Yarn Kauni (Kauni) - the legend of Estonia.</a>  <a href="https://vk.com/club57231027">Knitting.</a> <br>  1.85% <a href="https://vk.com/club58678379">Shop of yarn Eesti l√µng (Kauni, Kauni)</a> <br>  1.82% <a href="https://vk.com/club59200218">Spaghetti Yarn Spagetti</a> <br><br>  "Madame Vyazalkina" Yarn (handicraft goods): <br>  2.49% <a href="https://vk.com/club5084903">Yarn</a> <br>  2.37% YARK <a href="https://vk.com/club75577569">Corporation</a> <br>  1.42% <a href="https://vk.com/club58678379">Yesti l√µng yarn shop (Kauni, Kauni)</a> <br>  1.39% <a href="https://vk.com/club57231027">Yarn Kauni (Kauni) - the legend of Estonia.</a>  <a href="https://vk.com/club57231027">Knitting.</a> <br>  1.32% <a href="https://vk.com/club53371463">YARN CHEAP. FLISS. ELASTIC BANDS FOR WOOLING</a> <br>  1.26% <a href="https://vk.com/club38116251">Store yarn and goods for needlework KUDEL</a> <br>  1.24% <a href="https://vk.com/club12443394">Knitted hats and not only.</a> <br>  1.21% <a href="https://vk.com/club60959851">HOBBY &amp; HOME |</a>  <a href="https://vk.com/club60959851">NEEDLEWORK</a> <br>  1.18% <a href="https://vk.com/club40561560">Online Store Yarn "Openwork"</a> <br>  1.15% <a href="https://vk.com/club59200218">Spaghetti Yarn Spagetti</a> <br><br>  A similar result can be achieved by correctly selecting keywords for the search: ‚Äúknitting‚Äù, ‚Äúyarn‚Äù, ‚Äúneedlework‚Äù, ‚Äúcrochet‚Äù.  But they are not always easy to invent. <br><br>  To construct such a graph, several unobvious technical solutions were used, which I would like to talk about. <br><br>  To get the full list of groups of a given size, the wonderful site <a href="http://allsocial.ru/">allsocial.ru was downloaded</a> .  I wonder how they collect this data?  Just go to all indices: <a href="https://vk.com/club1">vk.com/club1</a> , <a href="https://vk.com/club2">vk.com/club2</a> , ...?  Only medium-sized groups with subscribers from 5,000 to 10,000 people were taken for two reasons: huge public institutions like MDK would be pumped up, but, more importantly, membership in them does not carry a special signal, such groups are connected with everything. <br><br>  To get a list of group subscribers in the API of VKontakte, there is a special method.  But it allows you to receive 1000 users at a time and only 3 times per second.  And it was necessary to pump about 1 000 000 000 users, which is dofig.  It turns out that it will be necessary to wait 3-4 days if the VC responds to each request instantly.  This is, on the whole, tolerable, but the following remark in the documentation confused: <br><blockquote>  In addition to restrictions on the frequency of calls, there are also quantitative restrictions on calling methods of the same type.  For obvious reasons, we do not provide information on exact limits. </blockquote><br>  In our case, this remark is annoying, because 1,000,000 requests will have to be made.  Here comes the coolest method <a href="https://vk.com/dev/execute">execute</a> .  Big respect for him guys from VK.  Does anyone else have such a thing?  The bottom line is that through execute, you can send programs to the Contact in a special VKScript language, push several requests to the API and, possibly, some logic.  In my case, the program looked like this: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ API.groups.getMembers(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, offset=<span class="hljs-number"><span class="hljs-number">0</span></span>, count=<span class="hljs-number"><span class="hljs-number">1000</span></span>), API.groups.getMembers(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, offset=<span class="hljs-number"><span class="hljs-number">1000</span></span>, count=<span class="hljs-number"><span class="hljs-number">1000</span></span>), API.groups.getMembers(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, offset=<span class="hljs-number"><span class="hljs-number">2000</span></span>, count=<span class="hljs-number"><span class="hljs-number">1000</span></span>), API.groups.getMembers(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, offset=<span class="hljs-number"><span class="hljs-number">3000</span></span>, count=<span class="hljs-number"><span class="hljs-number">1000</span></span>), API.groups.getMembers(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, offset=<span class="hljs-number"><span class="hljs-number">4000</span></span>, count=<span class="hljs-number"><span class="hljs-number">1000</span></span>), API.groups.getMembers(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, offset=<span class="hljs-number"><span class="hljs-number">5000</span></span>, count=<span class="hljs-number"><span class="hljs-number">1000</span></span>), ... ];</code> </pre> <br>  Inside the program there can be no more than 25 calls to the API.  That is, the number of requests is reduced to 40,000, theoretically a ban could be bypassed.  Each such request was not executed at all instantly, but about 5-6 seconds, so I had to wait anyway.  Yes, it would be possible to start downloading in several streams, but even it was dumb.  After two and a half days, everything worked out and took about 10GB on my disk. <br><br>  Now the question is how to stuff these 10GB into RAM and how to calculate the pairwise intersection of the audiences for 100,000 groups.  It is saved by the fact that each user usually consists of a small number of groups (99% of users are less than 15 groups).  You can write out what contributions each user makes to the intersections and then add these contributions.  Let, for example, there are two users: A and B, and three groups 1, 2 and 3. And consists in all three, B - only in 1 and 3. And contributes to three intersections: (1, 2), (1 , 3) and (2, 3), B - into one: (1, 3).  We add up, we get that 1 and 3 intersect by two users, the other groups one by one.  If you technically ignore users who are in 15 groups and more, you will have to write out about 500,000,000 intersections, which is much better than deciding to the forehead, where you need to calculate 100,000 * 100,000 intersections. <br><br>  Fine, there was only a problem with RAM.  Fortunately, the described algorithm fits well with the Map-Reduction paradigm, so the <a href="https://github.com/alexanderkuk/analyze-vk-groups/blob/master/main.py">nano-hadup of 50 lines</a> was written <a href="https://github.com/alexanderkuk/analyze-vk-groups/blob/master/main.py">down</a> and the calculation looked like this: write out the groups and users who have two columns in them: <br><br><pre> <code class="bash hljs">group user 3953835 10 2065169 100001643 2112714 100001643 ...</code> </pre><br>  It turns out a file on ~ 9GB, sort it with a unix-like grade by the second column, look where Pavel Durov is: <br><pre> <code class="bash hljs">group user 2226515 1 37110020 1 38354466 1 43453499 1 60140141 1 60615047 1 64980878 1 1019652 10 ...</code> </pre><br>  We read the file, group the stream by the second column, keep in memory only the list of user groups, if there are less than 15 groups, write out all the matchings to another file: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> target 10000 10027193 9980615 9997141 9974 9976553 ...</code> </pre><br>  Since the threshold is chosen correctly, the file is not too large - ~ 9GB.  We sort it by two columns: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> target 10000 100000 10000 100000 10000 10009982 10000 100100 10000 100100 10000 10019194 10000 10019194 10000 1002 10000 1002 10000 1002 ...</code> </pre><br>  Then the file is read, grouped in two columns and immediately considered the intersection.  For groups of 10,000 and 100,000, for example, the count of 2 users.  This can be said right away; nothing is stored in the memory. <br><br>  Further, the edges are filtered by some reasonable threshold, so that there are not very many of them left.  The result can be seen in Gefi.  There are two secrets: in order for everything to work for not painfully long, you need to turn off edge drawing, for installation you need to download OpenOrd, he laid my graph at ~ 100,000 vertices in ~ 5 minutes. <br><br>  Such an approach can theoretically be used in any task where there are two related entities: sites and users, a query and issue results, for example. </div><p>Source: <a href="https://habr.com/ru/post/263753/">https://habr.com/ru/post/263753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263741/index.html">Angular.js persistent storage</a></li>
<li><a href="../263745/index.html">Microsoft Research grant for Azure cloud resources for research from Russia opened</a></li>
<li><a href="../263747/index.html">Switching audio tracks in Flash using Wowza2 RTMP server</a></li>
<li><a href="../263749/index.html">Inventing a bike on Scala - your ORM Framework, WebServer (RESTful and MVC)</a></li>
<li><a href="../263751/index.html">Secret constructor std :: shared_ptr</a></li>
<li><a href="../263755/index.html">Cybercriminals revived Darkode forum</a></li>
<li><a href="../263757/index.html">Skills of .NET-developer of Russia and the USA, what's the difference?</a></li>
<li><a href="../263759/index.html">Android found vulnerabilities that allow access to a smartphone via MMS</a></li>
<li><a href="../263761/index.html">GNS3 in the cloud</a></li>
<li><a href="../263763/index.html">How does this mysterious HTC Dot View work?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>