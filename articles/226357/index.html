<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of cloud data backup based on Android Backup Service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to touch on such an important topic for Android developer as cloud backup of data using the example of using Android Bac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of cloud data backup based on Android Backup Service</h1><div class="post__text post__text-html js-mediator-article">  In this article, I would like to touch on such an important topic for Android developer as cloud backup of data using the example of using Android Backup Service.  This service allows you to store application data for free on a remote cloud storage.  According to the <a href="http://developer.android.com/guide/topics/data/backup.html">documentation</a> , it allows you to restore data when you reinstall the application, update the device and at the factory reset settings.  All that is required of the user is that he had ticks in ‚ÄúData backup‚Äù and ‚ÄúAuto-restore‚Äù in Settings / Restore and reset. <br><a name="habracut"></a><br><h4>  Implementation </h4><br>  Before implementation, you need to register your application directly in the <a href="http://developer.android.com/google/backup/signup.html">Android Backup Service</a> .  The key obtained during registration is used in the manifest, see below. <br><br>  The easiest way to interact with BackupManager is to inherit from the BackupAgentHelper class. <br>  In this class we use two helpers: <br><ol><li>  <a href="http://developer.android.com/reference/android/app/backup/SharedPreferencesBackupHelper.html">SharedPreferencesBackupHelper</a> for SharedPreferences backup </li><li>  <a href="http://developer.android.com/reference/android/app/backup/FileBackupHelper.html">FileBackupHelper</a> for <a href="http://developer.android.com/reference/android/app/backup/FileBackupHelper.html">backing</a> up files from internal storage. </li></ol><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheBackupAgent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BackupAgentHelper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// DatabaseHelper.DATABASE_NAME ‚Äì     . FileBackupHelper fileBackupHelper = new FileBackupHelper(this, "../databases/" + DatabaseHelper.DATABASE_NAME); addHelper(DatabaseHelper.DATABASE_NAME, fileBackupHelper); //  ,     ,     .     ,         PreferenceManager(PreferenceManager.getDefaultSharedPreferences(context)) SharedPreferencesBackupHelper helper = new SharedPreferencesBackupHelper(this, SharedPreferenceHelper.PREFERENCES, getPackageName() + "_preferences"); addHelper("prefs", helper); } //   .        ,   . public static void requestBackup(Context context) { BackupManager bm = new BackupManager(context); bm.dataChanged(); } }</span></span></code> </pre> <br><br>  You'd be surprised, but basically that's all.  Finally, simply specify the path to the agent backup class in the manifest and additional attributes with the talking name.  Also in the meta-data is written the key obtained during the registration of the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="java hljs">&lt;application android:name=<span class="hljs-string"><span class="hljs-string">". MyApplication "</span></span> android:allowBackup=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:restoreAnyVersion=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:backupAgent=<span class="hljs-string"><span class="hljs-string">".util.TheBackupAgent"</span></span> &lt;meta-data android:name=<span class="hljs-string"><span class="hljs-string">"com.google.android.backup.api_key"</span></span> android:value=<span class="hljs-string"><span class="hljs-string">"AEdPqrEAAAAIDaYEVgU6DJnyJdBmU7KLH3kszDXLv_4DIsEIyQ"</span></span> /&gt; &lt;/application&gt;</code> </pre><br><br>  Since there is no beautiful solution for determining the application stop in Android, I suggest, as one of the lazy ways, to request a backup at the start of the application. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TheBackupAgent.requestBackup(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre><br><br><h4>  Testing. </h4><br>  Do not forget to carefully watch the logs.  If you specify incorrect file paths or prefs, you will be informed. <br>  The algorithm is quite simple: <br><ol><li>  Enter data / settings in the application. </li><li>  We request a backup for the adb shell application bmgr backup your.package.name. </li><li>  We start backup manager adb shell bmgr run. </li><li>  Delete, set again, PROFIT. </li></ol><br><h4>  Conclusion </h4><br>  According to personal feelings and googling, this service does not work stably on all devices, however, the implementation of this functionality takes almost no effort and is therefore recommended for use in applications with a database or SharedPreferences by default. </div><p>Source: <a href="https://habr.com/ru/post/226357/">https://habr.com/ru/post/226357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226343/index.html">Gamification or gamification</a></li>
<li><a href="../226345/index.html">Recover Apple Key Aluminum after Fluid</a></li>
<li><a href="../226347/index.html">About seals, dogs, machine learning and deep learning</a></li>
<li><a href="../226351/index.html">As we built the first prototype</a></li>
<li><a href="../226355/index.html">Master or work?</a></li>
<li><a href="../226359/index.html">Sharp Infrared Range Finder</a></li>
<li><a href="../226361/index.html">Create Shaman Tambourines</a></li>
<li><a href="../226363/index.html">No cards. We pay bracelets, jackets, sounds and phones</a></li>
<li><a href="../226365/index.html">Monitoring Oracle Database via ODBC in Zabbix</a></li>
<li><a href="../226367/index.html">SteamBoy - a portable console for running video games from Steam (and not only)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>