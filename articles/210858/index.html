<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Disabling ASLR when debugging third-party iOS apps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article provides a simple short tutorial on how to patch a third-party iOS application to disable ASLR during debugging. It is assumed that the r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Disabling ASLR when debugging third-party iOS apps</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4ff/a0c/309/4ffa0c309cea47739d7cd3a356092a17.png" align="left">  This article provides a simple short tutorial on how to patch a third-party iOS application to disable ASLR during debugging.  It is assumed that the reader has: <br><br><ol><li>  iOS 7.0-7.0.4 device with <a href="http://evasi0n.com/">evasi0n jailbreak</a> and computer with Mac OS X 10.9.4 installed by XCode 5.1.1 and <a href="http://sourceforge.net/projects/machoview/">MacOView</a> 2.4 (most likely for other versions will work too, but I have not tried it) </li><li>  some experience in debugging third-party iOS apps, well, it‚Äôs advisable to know what <a href="http://en.wikipedia.org/wiki/Address_space_layout_randomization">ASLR is</a> and why you need to disable it </li></ol><br>  Well, let's get started. <a name="habracut"></a><br><br>  To begin, select the executable file in which we will debug and in which we need to disable ASLR.  Let it be the demon <code>/usr/sbin/absd</code> , which is responsible for authorization in some Apple services.  Of course, <code>absd</code> here solely for example, in fact, you can take any executable file. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We use <code>scp</code> to copy our executable file to the computer (hereinafter, <code>192.168.1.112</code> is the IP address of our iOS device): <br><br><pre> <code class="bash hljs">$ scp root@192.168.1.112:/usr/sbin/absd ./</code> </pre><br>  <b>WARNING!</b>  <u>Before you do something with absd, be sure to save a copy somewhere!</u> <br><br>  Then we will use the <code>codesign</code> utility from XCode and extract the plist with the list of entitlements from our executable file (I don‚Äôt know how it is in Russian, can a ‚Äúlist of rights‚Äù?): <br><br><pre> <code class="bash hljs">$ codesign -d --entitlements - absd &gt; absd.entitlements</code> </pre><br>  After that, open the executable file in MachOView and find the Mach header for the architecture of interest.  In the case of fat binary, there will be several such headers - one for each architecture;  if we are not fat binary, there will be only one header.  In the header, find the <code>MH_PIE</code> flag and note the corresponding offset.  In MachOView it all looks like this: <br><br><img src="https://habrastorage.org/files/14f/dff/69c/14fdff69c8624c9b85a54e6f5a8c8de7.png"><br><br>  The flag needs to be reset, but in MachOView this cannot be done, so we will open the executable file in any HEX editor, go over the corresponding offset and reset the flag.  Then rewrite the executable file with the retained entitlements: <br><br><pre> <code class="bash hljs">$ codesign -s - --entitlements absd.entitlements -f absd</code> </pre><br>  and copy it back to the device <br><br><pre> <code class="bash hljs">$ scp ./absd root@192.168.1.112:/usr/sbin/absd</code> </pre><br>  That's all.  Now if you call a daemon - for example, logging in to iMessage - and drive it under debugging in lldb, we will see <br><br><img src="https://habrastorage.org/files/a26/339/ab2/a26339ab26654f41943359c3fad2b5f2.png"><br><br>  (if you are sitting on gdb instead of lldb, use the <a href="http://lldb.llvm.org/lldb-gdb.html">appropriate commands</a> ).  As you can see from the screenshot, no more ASLR!  That's the whole manual - simple and short, as I promised at the beginning of the article. <br><br>  <b>PS</b> Just in case: the author is aware that the method proposed in the article is not always the most optimal.  The author is also aware of alternative ways to disable ASLR, and maybe they will be discussed in the following articles.  But just today - an article about the Mach-header patching. <br><br>  Happy debugging! </div><p>Source: <a href="https://habr.com/ru/post/210858/">https://habr.com/ru/post/210858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210846/index.html">Russian domain space: results of 2013</a></li>
<li><a href="../210850/index.html">Benefits of Cloud Hosting - Infographics</a></li>
<li><a href="../210852/index.html">New Garmin: for dogs, thrill-seekers and motorists</a></li>
<li><a href="../210854/index.html">Google has provided a tool to transfer Chrome applications to Android</a></li>
<li><a href="../210856/index.html">About the performance of Thin Provision in LVM2</a></li>
<li><a href="../210860/index.html">Work with a basket. ImageCMS Cart API</a></li>
<li><a href="../210862/index.html">Video recordings of the Happu New Front-End conference reports: On the frontend in a new way</a></li>
<li><a href="../210864/index.html">How to read a patent in one minute</a></li>
<li><a href="../210866/index.html">PHDays CTF Quals Summary</a></li>
<li><a href="../210868/index.html">MEGA released a client for Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>