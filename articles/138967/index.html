<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We collect your Bluetooth machine running on Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the last session, as usual, I carefully prepared for exams (that is, I did not know what to do), and as a lucky chance, I had a radio-controlled ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We collect your Bluetooth machine running on Android</h1><div class="post__text post__text-html js-mediator-article">  At the last session, as usual, I carefully prepared for exams (that is, I did not know what to do), and as a lucky chance, I had a radio-controlled machine, large and beautiful, although clearly designed for children.  After playing for about ten minutes, I wanted to upgrade it, namely, instead of an uncomfortable joystick with a range of 3 meters, use a bluetooth communicator.  And it is more convenient, and the range is greater, and further improvements are clearly visible, which, as well as the process of screwing the communicator to a children's typewriter, will be discussed in this article. <br><br><img src="https://habrastorage.org/storage2/b65/a30/79f/b65a3079f9fa2a5b0dae61373e9c5ef9.jpg"><br><br><a name="habracut"></a><br><h4>  Select components </h4><br>  In the past, my friends and I <a href="http://habrahabr.ru/blogs/study/120367/">wrote</a> our own firmware for Lego Mindstorms NXT robots, which supports remote control of the robot via bluetooth from the Android-communicator.  For experiments, the Olimex SAM7 debug board with ARM7 on board was then purchased, which this time can be used as a control controller. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As the chassis we use the toy car body. <br><br>  Need a bluetooth module.  I wanted to get the result quickly, so the module was chosen from the only <a href="http://www.sparkfun.com/datasheets/Wireless/Bluetooth/BTM112_wATcommands.pdf">BTM-112</a> available in the store at the time, although it turned out to be <a href="http://habrahabr.ru/blogs/DIY/125214/">relatively</a> expensive. <br><br>  In addition, it turned out that the control from the board cannot go directly to the motors, we need an amplifying controller (more on that later). <br><br>  In total, our components are: <br><ul><li>  Typewriter </li><li>  Controller Olimex SAM7 </li><li>  Bluetooth module BTM-112 </li><li>  Controller for controlling motors L298N </li></ul>  Now we have everything we need. <br><br><h4>  Connect bluetooth with control board </h4><br>  To begin with, we will configure the delivery of commands to the control unit.  The connection scheme of the bluetooth module and the controller is simple: in fact, it is a UART with some control legs, that is, you just need to connect the module to the integrated UART controller. <br><br>  The software component is not much more complicated.  When connected, the module writes a string of the form <code>"CONNECT RE:MO:TE:BT:MA:CC xxx \r\n"</code> , and when disconnected, it is <code>"DISCONNECT xxx \r\n"</code> .  The task of the driver is to monitor the flow of characters and, if the connection is now active, transfer the stream to the control application.  As a result, the driver is a state machine whose state switching means switching the handler function. <br><br><h4>  Remote control </h4><br>  As promised, remote control is carried out using an Android-based communicator. <br><br>  Our past Android application (which controlled Lego Mindstorms NXT, also via bluetooth) tracked the slope of the communicator with an accelerometer and sent the appropriate control commands to the NXT.  So the simplest solution was to add a machine control protocol to an existing application.  The protocol itself is rather primitive: a fixed command length, a fixed header, followed by control along the X and Y axes. <br><br>  So, at this stage, we can ‚Äústeer‚Äù our handkerchief, although the motors are not connected yet, so the indication of movements is made by the built-in LEDs (video, unfortunately, no, at this moment took only a photo), but there is still progress, it is visible and it warms the soul. <br><br><img src="https://habrastorage.org/storage2/96b/daf/81f/96bdaf81f1d39c463f4d460dda52ab6c.jpg"><br><br><h4>  Connect control board with motors </h4><br>  Initially, I thought that I could use the control from the old board (sewn into the machine itself), but it turned out that it could not be used in its pure form, since the control of the motors was firmly linked to the radio part.  Controlling the motors directly from the legs of the head controller will not work either, due to the low output power of the chip.  Unfortunately, I have no experience in this field (after all, I am a programmer, not a circuit designer), so I had to resort to the help of my acquaintances.  On the advice, I took the L298N amplifier chip (redundant for my needs, but working out of the box) and assembled the <a href="http://www.learn-c.com/l298.pdf">reference circuit</a> . <br><br>  Let me remind you that the prepared machine is for children, and its control is a bit lame;  when I started to deal with motors, I understood one of the reasons.  For the mechanism of rotation is not used the servo, and the usual electric motor, which can be in one of three states (off, forward and backward).  Thus, it is not necessary to dream of a smooth turn. <br><br>  In general, the functional scheme is simple, one motor is used as an engine, the second motor is used as a steering wheel (it has a lock at a certain angle of rotation). <br>  To control each motor, the voltage must be applied to the corresponding control legs (positive or negative voltage or zero).  The voltage is measured between two points (control input feet), that is, I need to apply voltage to a pair of control legs something like this: <br><table><tbody><tr><th></th><th>  forward </th><th>  reverse </th><th colspan="2">  off </th></tr><tr><td>  <b>PIN1</b> </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td></tr><tr><td>  <b>PIN2</b> </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td></tr></tbody></table>  Since the Android application transmits smooth control, the state of the motors changes to overcome a given threshold. <br>  The code is very simple, I will not give it here, but at the end of the post there are links to the source code of the entire project. <br><br><h4>  Total </h4><br>  Movie with a working machine: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/iULK06tYsBY%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhjYYR2hH24tQNWVkZJtNwQeh7Codg" frameborder="0" allowfullscreen=""></iframe><br><br>  Clearly, there are drawbacks: <br><ul><li>  Discrete left / right control, forward / backward.  Now the motors are controlled by GPIO, but the lines selected for control can be reassigned under the PWM controller.  Thus, the turns and acceleration will be smooth. </li><li>  Dear amp.  Everything is simple, replaced with a cheaper chip or circuit with several transistors. </li><li>  Modest opportunities.  Once the control is carried out using a smartphone, it is possible to expand the functionality in comparison with a simple control panel. </li></ul><br><h4>  Where to look </h4><br>  All code is publicly available. <br>  The firmware for the Olimex board is <a href="http://code.google.com/p/embox/">here</a> . <br>  The Android application code is <a href="http://code.google.com/p/robobot/">here</a> , the compiled version on the <a href="http://market.android.com/details%3Fid%3Dorg.embox.robobot">Android Market</a> . </div><p>Source: <a href="https://habr.com/ru/post/138967/">https://habr.com/ru/post/138967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138959/index.html">If we want replicable science, the program code must be open.</a></li>
<li><a href="../138960/index.html">Unusual WebKit bug with CSS selector</a></li>
<li><a href="../138962/index.html">Simple audio DAC with USB connection (sound card)</a></li>
<li><a href="../138964/index.html">‚ÄúAnatomy of anonymous attacks‚Äù - how does Anonymous work?</a></li>
<li><a href="../138965/index.html">Preview of 2 smartphones of a new line - Sony Xperia P and Sony Xperia U</a></li>
<li><a href="../138968/index.html">Greeting</a></li>
<li><a href="../138972/index.html">Nokia at MWC 2012: everything we surprised at - in one post</a></li>
<li><a href="../138973/index.html">Preview of HTC smartphones from the new One family</a></li>
<li><a href="../138974/index.html">RuCenter: ‚ÄúSo that we will not spam you, send a notarized letter in triplicate‚Äù</a></li>
<li><a href="../138977/index.html">Open Web Device - HTML5 smartphone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>