<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web Framework in Japanese - Amon2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 
 In an interview with Japanese Tokuhiro Matsuno, the following phrase was heard: 
 ‚ÄúSome applications of our company are used by over a million...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web Framework in Japanese - Amon2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8b1/5c5/487/8b15c5487d60da0edb9fb09654b40092.png"><br><br><h5>  Intro </h5><br>  In <a href="http://pragmaticperl.com/issues/11/pragmaticperl-11-%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25B2%25D1%258C%25D1%258E-%25D1%2581-tokuhiro-matsuno.html">an interview with Japanese Tokuhiro Matsuno, the</a> following phrase was heard: <br><blockquote>  ‚ÄúSome applications of our company are used by <b>over a million people</b> .  It all <b>works on Amon2</b> . ‚Äù </blockquote><br><br>  I did not find any information about this web framework in Russian.  And I decided to try what it is for Amon2, purely for myself, and maybe someone will be interested. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Installation </h4><br>  Lets get a handle with Debian GNU / Linux 7.3 (wheezy) <br>  Go‚Ä¶ <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># curl -L http://cpanmin.us | perl - Amon2 ................ Building and testing Amon2-6.00 ... OK Successfully installed Amon2-6.00 78 distributions installed Successfully installed Amon2-6.00</span></span></code> </pre> <br>  Everything!  Installation completed. <br><br>  Out of the box we got: <br><ul><li>  Built on PSGI / Plack </li><li>  no XS deps. </li><li>  Thin </li><li>  Easy to learn </li><li>  CLI support </li><li>  Stable </li><li>  Secure options by default </li><li>  <a href="http://xslate.org/">Xslate templates</a> </li></ul><br><br><h4>  Creation of the frame </h4><br><br><pre> <code class="bash hljs">adduser dotcloud su - dotcloud amon2-setup.pl BBS</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Everything is going well, until ...</b> <div class="spoiler_text">  - Running flavor: Basic - [main] Loading asset: jQuery <br>  [main] Loading asset: Bootstrap <br>  [main] Loading asset: ES5Shim <br>  [main] Loading asset: MicroTemplateJS <br>  [main] Loading asset: StrftimeJS <br>  [main] Loading asset: SprintfJS <br>  [main] Loading asset: MicroLocationJS <br>  [main] Loading asset: MicroDispatcherJS <br>  [main] Loading asset: XSRFTokenJS <br>  [Flavor :: Basic] writing tmpl / index.tx <br>  [Flavor :: Basic] writing tmpl / include / layout.tx <br>  [Flavor :: Basic] writing tmpl / include / pager.tx <br>  [Flavor :: Basic] writing lib / BBS.pm <br>  [Flavor :: Basic] writing lib / BBS / Web.pm <br>  [Flavor :: Basic] writing lib / BBS / Web / Plugin / Session.pm <br>  [Flavor :: Basic] writing lib / BBS / Web / Dispatcher.pm <br>  [Flavor :: Basic] writing lib / BBS / Web / View.pm <br>  [Flavor :: Basic] writing lib / BBS / Web / ViewFunctions.pm <br>  [Flavor :: Basic] writing lib / BBS / DB.pm <br>  [Flavor :: Basic] writing lib / BBS / DB / Schema.pm <br>  [Flavor :: Basic] writing lib / BBS / DB / Row.pm <br>  [Flavor :: Basic] writing script / bbs-server <br>  [Flavor :: Basic] writing Build.PL <br>  [Flavor :: Basic] writing minil.toml <br>  [Flavor :: Basic] writing builder / MyBuilder.pm <br>  [Flavor :: Basic] writing cpanfile <br>  [Flavor :: Basic] writing static // js / jquery-2.0.3.min.js <br>  [Flavor :: Basic] writing static // bootstrap / fonts / glyphicons-halflings-regular.eot <br>  [Flavor :: Basic] writing static // bootstrap / css / bootstrap-theme.min.css <br>  [Flavor :: Basic] writing static // bootstrap / fonts / glyphicons-halflings-regular.woff <br>  [Flavor :: Basic] writing static // bootstrap / fonts / glyphicons-halflings-regular.ttf <br>  [Flavor :: Basic] writing static // bootstrap / css / bootstrap.min.css <br>  [Flavor :: Basic] writing static // bootstrap / js / bootstrap.min.js <br>  [Flavor :: Basic] writing static // bootstrap / fonts / glyphicons-halflings-regular.svg <br>  [Flavor :: Basic] writing static // bootstrap / js / bootstrap.js <br>  [Flavor :: Basic] writing static // bootstrap / css / bootstrap.css <br>  [Flavor :: Basic] writing static // bootstrap / css / bootstrap-theme.css <br>  [Flavor :: Basic] writing static // js / es5-shim.min.js <br>  [Flavor :: Basic] writing static // js / micro_template.js <br>  [Flavor :: Basic] writing static // js / strftime.js <br>  [Flavor :: Basic] writing static // js / sprintf-0.7-beta1.js <br>  [Flavor :: Basic] writing static // js / micro-location.js <br>  [Flavor :: Basic] writing static // js / micro_dispatcher.js <br>  [Flavor :: Basic] writing static // js / xsrf-token.js <br>  [Flavor :: Basic] writing static / img / .gitignore <br>  [Flavor :: Basic] writing static / robots.txt <br>  [Flavor :: Basic] writing static / js / main.js <br>  [Flavor :: Basic] writing static / css / main.css <br>  [Flavor :: Basic] writing db / .gitignore <br>  [Flavor :: Basic] writing config / development.pl <br>  [Flavor :: Basic] writing config / production.pl <br>  [Flavor :: Basic] writing config / test.pl <br>  [Flavor :: Basic] writing sql / mysql.sql <br>  [Flavor :: Basic] writing sql / sqlite.sql <br>  [Flavor :: Basic] writing t / Util.pm <br>  [Flavor :: Basic] writing t / 00_compile.t <br>  [Flavor :: Basic] writing t / 01_root.t <br>  [Flavor :: Basic] writing t / 02_mech.t <br>  [Flavor :: Basic] writing t / 03_assets.t <br>  [Flavor :: Basic] writing t / 06_jshint.t <br>  [Flavor :: Basic] writing xt / 01_pod.t <br>  [Flavor :: Basic] writing xt / 02_perlcritic.t <br>  [Flavor :: Basic] writing .gitignore <br>  [Flavor :: Basic] writing .proverc <br>  [Flavor :: Basic] writing static / 500.html <br>  [Flavor :: Basic] writing static / 504.html <br>  [Flavor :: Basic] writing static / 503.html <br>  [Flavor :: Basic] writing static / 502.html <br>  [Flavor :: Basic] writing static / 404.html <br>  There is no git command. <br>  - </div></div><br><br><pre> <code class="bash hljs">Setup script was <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>! You are ready to run the skelton. You need to install the dependencies by: &gt; carton install And <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>, run your application server: &gt; carton <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> perl -Ilib script/bbs-server --------------------------------------------------------------</code> </pre><br><br>  It seems everything is ok, but there is not enough carton and it is recommended to enter some more commands. <br>  We put it <br><pre> <code class="bash hljs">cpan Carton <span class="hljs-comment"><span class="hljs-comment">#   carton install #     BBS!   !</span></span></code> </pre><br>  We get the following file and directory structure: <br><br><pre> <code class="bash hljs">builder Build.PL config cpanfile cpanfile.snapshot db lib <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> minil.toml script sql static t tmpl xt</code> </pre><br><br><h4>  Creating a web application </h4><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> db vim sqlite.sql</code> </pre><br><br>  File sqlite.sql with the following content: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">member</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> sessions ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">72</span></span>) PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, session_data <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> entry ( entry_id <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> AUTOINCREMENT, <span class="hljs-keyword"><span class="hljs-keyword">body</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> );</code> </pre><br><br>  Create a database: <br><br><pre> <code class="bash hljs">sqlite3 development.db &lt; sqlite.sql</code> </pre><br><br>  Further <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> config/ vim development.pl</code> </pre><br><br>  We stick this config into it: <br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> File::Spec; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> File::Basename <span class="hljs-string"><span class="hljs-string">qw(dirname)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $basedir = File::Spec-&gt;rel2abs(File::Spec-&gt;catdir(dirname(__FILE_<span class="hljs-number"><span class="hljs-number">_</span></span>), <span class="hljs-string"><span class="hljs-string">'..'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $dbpath = File::Spec-&gt;catfile($basedir, <span class="hljs-string"><span class="hljs-string">'db'</span></span>, <span class="hljs-string"><span class="hljs-string">'development.db'</span></span>); +{ <span class="hljs-string"><span class="hljs-string">'DBI'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">"dbi:SQLite:dbname=$dbpath"</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, +{ <span class="hljs-string"><span class="hljs-string">sqlite_unicode =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, } ], };</code> </pre><br><br>  Trying to test run the web server. <br><br><pre> <code class="bash hljs"> perl -Ilib script/bbs-server Can<span class="hljs-string"><span class="hljs-string">'t locate Teng/Schema/Declare.pm in @INC (you may need to install the Teng::Schema::Declare module) (@INC contains: script/../lib lib /etc/perl /usr/local/lib/perl/5.18.1 /usr/local/share/perl/5.18.1 /usr/lib/perl5 /usr/share/perl5 /usr/lib/perl/5.18 /usr/share/perl/5.18 /usr/local/lib/site_perl .) at script/../lib/BBS/DB/Schema.pm line 6. BEGIN failed--compilation aborted at script/../lib/BBS/DB/Schema.pm line 6. Compilation failed in require at script/../lib/BBS.pm line 7. BEGIN failed--compilation aborted at script/../lib/BBS.pm line 7. Compilation failed in require at /usr/share/perl/5.18/parent.pm line 20. BEGIN failed--compilation aborted at script/../lib/BBS/Web.pm line 5. Compilation failed in require at script/bbs-server line 9. BEGIN failed--compilation aborted at script/bbs-server line 9.</span></span></code> </pre><br><br>  And breaks off. <br>  Good set <br><pre> <code class="bash hljs">cpan Teng::Schema::Declare cpan Module::Functions cpan Plack::Middleware::ReverseProxy cpan Plack::Handler::Starlet</code> </pre><br><br>  Finally saw the cherished: <br><br><pre> <code class="bash hljs">dotcloud@debian:~/BBS$ perl -Ilib script/bbs-server BBS: http://127.0.0.1:5000/</code> </pre><br><br>  If you go to this address, you can see the following unearthly beauty: <br><br><img src="http://habrastorage.org/storage3/729/2e9/737/7292e97370c5acf9ca7d44710e561882.gif"><br><br>  Now it remains to make BBS - a bulletin board ( <s>grandma bibisihu - do you know this?</s> ) <br><br><pre> <code class="bash hljs">vim lib/BBS/DB/Schema.pm</code> </pre><br>  And post there the following: <br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> BBS::DB::Schema; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> strict; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> warnings; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> utf8; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Teng::Schema::Declare; base_row_class <span class="hljs-string"><span class="hljs-string">'BBS::DB::Row'</span></span>; table { name <span class="hljs-string"><span class="hljs-string">'sessions'</span></span>; pk <span class="hljs-string"><span class="hljs-string">'id'</span></span>; columns <span class="hljs-string"><span class="hljs-string">qw(session_data)</span></span>; }; table { name <span class="hljs-string"><span class="hljs-string">'entry'</span></span>; pk <span class="hljs-string"><span class="hljs-string">'entry_id'</span></span>; columns <span class="hljs-string"><span class="hljs-string">qw(entry_id body)</span></span>; }; <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><br>  Further: <br><br><pre> <code class="bash hljs">vim lib/BBS/Web/Dispatcher.pm</code> </pre><br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> BBS::Web::Dispatcher; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> strict; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> warnings; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Amon2::Web::Dispatcher::Lite; any <span class="hljs-string"><span class="hljs-string">'/'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($c) = @_; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> @entries = $c-&gt;db-&gt;search( <span class="hljs-string"><span class="hljs-string">entry =&gt;</span></span> { }, { <span class="hljs-string"><span class="hljs-string">order_by =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'entry_id DESC'</span></span>, <span class="hljs-string"><span class="hljs-string">limit =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>, } ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $c-&gt;render( <span class="hljs-string"><span class="hljs-string">"index.tx"</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">entries =&gt;</span></span> \@entries, } ); }; post <span class="hljs-string"><span class="hljs-string">'/post'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($c) = @_; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $body = $c-&gt;req-&gt;param(<span class="hljs-string"><span class="hljs-string">'body'</span></span>)) { $c-&gt;db-&gt;insert( <span class="hljs-string"><span class="hljs-string">entry =&gt;</span></span> +{ <span class="hljs-string"><span class="hljs-string">body =&gt;</span></span> $body, } ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $c-&gt;redirect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); }; <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><br>  And rule template <br><br><pre> <code class="bash hljs">vim tmpl/index.tx</code> </pre><br><br><pre> <code class="html hljs xml">: cascade "include/layout.tx" : override content -&gt; { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"&lt;: uri_for('/post') :&gt;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"body"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Send"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">entries</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span><span class="hljs-tag">&gt;</span></span> $entry { :&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">:</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">entry.entry_id</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag">&gt;</span></span>. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">:</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">entry.body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">:</span></span></span><span class="hljs-tag"> } </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> : }</code> </pre><br><br>  Run: <br><br><pre> <code class="bash hljs">perl -Ilib script/bbs-server</code> </pre><br><br>  And if necessary, we reinstall the following packages. <br><br><pre> <code class="bash hljs">cpan Router::Simple cpan Router::Simple::Sinatraish cpan DBD::SQLite</code> </pre><br><br>  HOORAY! <br>  Grandma Bibisikha - works! <br><br><img src="http://habrastorage.org/storage3/6df/d06/e6a/6dfd06e6ad5dcd32ef55954aa63a544e.gif"><br><br>  It remains to put all this on nginx <br><br><h4>  Install nginx as a frontend </h4><br><br><h5>  First, we do the init file, and not to run from root </h5><br><br><pre> <code class="bash hljs">vim /etc/init.d/plackup</code> </pre><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh PORT=5000 WORKERS=4 AMON_DIR="/home/dotcloud/BBS" AMON_APP="$AMON_DIR/script/bbs-server" AMON_USER="dotcloud" AMON_MODE="development" website="cc_Website" plackup="/usr/local/bin/plackup " PID=$AMON_DIR/logs/plackup.$website.pid plackup_args="-E $AMON_MODE -p $PORT -s Starman --pid=$PID --workers $WORKERS -D" U=`id -un` if [ $U = root ]; then WRPERM=`find $AMON_DIR/ ! -user $AMON_USER | wc -l` if [ "$WRPERM" != 0 ]; then echo Fixing file ownership on $AMON_DIR chown -R $AMON_USER.nginx $AMON_DIR fi cd / su $AMON_USER -s /bin/sh $0 "$@" exit elif [ $U != $AMON_USER ]; then echo "Should be run under $AMON_USER or root" exit 1 fi lockfile=$AMON_DIR/logs/plackup.$website start() { [ -x $plackup ] || exit 5 [ -f $AMON_APP ] || exit 6 echo -n $"Starting $website: " $plackup $plackup_args -a $AMON_APP 2&gt;&amp;1 &gt; /dev/null retval=$? if [ $retval -eq 0 ]; then echo OK touch $lockfile else failure $"Unable to start" fi echo return $retval } stop() { echo -n $"Stopping $website: OK" if [ -f $PID ]; then kill `cat $PID` &gt; /dev/null retval=$? [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile echo return $retval fi failure $"pid $PID not found" echo return 1 } restart() { stop start } case "$1" in start) $1 ;; stop) $1 ;; restart) $1 ;; *) echo $"Usage: $0 {start|stop|restart}" exit 2 esac</span></span></code> </pre><br><br>  Add config to nginx <br><br><pre> <code class="perl hljs">vim /etc/nginx/conf.d/virtual.conf</code> </pre><br><br><pre> <code class="bash hljs">upstream amon { server 127.0.0.1:5000; } server { listen *:80; location / { try_files /empty @backend; } location @backend { proxy_set_header Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>; proxy_set_header X-Forwarded-Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; proxy_set_header X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; proxy_set_header X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; proxy_set_header X-Forwarded-Proto <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>; proxy_pass http://amon; } }</code> </pre><br><br>  All is ready! <br><br><h4>  Conclusion </h4><br><br>  As a conclusion, I will cite, again, a quote from the very interview that started it all: <br><div class="spoiler">  <b class="spoiler_title">Tell me about Amon2.</b>  <b class="spoiler_title">How is it different from other Perl frameworks for the web?</b> <div class="spoiler_text">  Amon2 is a very simple, reliable, general-purpose web framework. <br><br>  Differences from Mojolicious <br><br>  Mojolicious is not bad, and I like the approach itself.  Unfortunately, there is no backward compatibility.  In Amon2, on the contrary.  It seems to me that you can break backward compatibility only with the change of name.  When I decide to seriously change something, I will release Amon3. <br><br>  Differences from Catalyst <br><br>  Catalyst is dependent on Moose, but Amon2 is not.  This is because I want my applications to load quickly. <br><br>  Differences from Dancer <br><br>  Virtually no differences between Amon2 and Dancer, including Dancer2. <br><br></div></div><br><br>  Author of a modest man, of course. <br><br>  And now my IMHO: <br><ol><li>  The framework is really very lightweight. </li><li>  Written by Japanese, with their thoroughness and perfectionism.  This is felt in the code. </li><li>  Miyagawa, who wrote plackup, has two replica boots on it. <br>  After all, it is used and recommended just such a bunch plackup + Amon2 </li><li>  I hope that the framework, which is used by ‚Äúmore than a million people‚Äù according to the author‚Äôs statement, will not be abandoned just like that, but will develop further. </li><li>  The framework is relatively new and modern, but there is already a huge number of modules on cpan </li><li>  Overall left a good impression. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/122611/">https://habr.com/ru/post/122611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122603/index.html">Cut the Rope came to Android</a></li>
<li><a href="../122604/index.html">Qik Desktop</a></li>
<li><a href="../122607/index.html">Reflections on the restoration of the damaged image</a></li>
<li><a href="../122609/index.html">The Synaptic Package Manager will be removed from the standard Ubuntu 11.10 distribution.</a></li>
<li><a href="../122610/index.html">The winners of the fifth annual free photo contest are announced.</a></li>
<li><a href="../122612/index.html">Photocell bikini</a></li>
<li><a href="../122614/index.html">Review Yota Many</a></li>
<li><a href="../122615/index.html">Google cow</a></li>
<li><a href="../122616/index.html">Full IP-KVM for all deductible servers</a></li>
<li><a href="../122617/index.html">Integration of sites and social networks: ergonomic aspects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>