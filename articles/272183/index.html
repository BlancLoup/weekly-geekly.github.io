<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco IOS shellcode: All-in-one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 This post is a response to a recent publication on the Habrahabr resource from the Russian representative office of Cisco. 

 The author is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco IOS shellcode: All-in-one</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/dac/718/501/dac7185011fa47a08c264608100977c8" alt="image"><br><br>  Hello! <br><br>  This post is a response to a recent <a href="http://habrahabr.ru/company/cisco/blog/272093/">publication</a> on the Habrahabr resource from the Russian representative office of Cisco. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The author is the same ‚Äúimmature‚Äù and ‚Äúbeginner‚Äù researcher from Digital Security, mentioned in the article by a Cisco representative. <br><br>  Strangely, the representation of such a well-known company allows itself to use such a low syllable in the official blog, and also gives comments based on superficial conclusions and not on technical details.  Let's see what our research center did, and what Cisco experts couldn‚Äôt or didn‚Äôt want to figure out. <br><a name="habracut"></a><br><h4>  Comments on the article </h4><br><blockquote>  We must immediately say that there is no talk of any kind of vulnerability of network equipment! </blockquote><br>  The equipment is loaded with ‚Äúforeign‚Äù firmware - no verification of the legitimacy of the image.  Is this not a vulnerability?  Any attacker will be delighted with this opportunity. <br><br><blockquote>  A successful attacker requires a Cisco router administrator account (and not a switch, as some media outlets wrote) or physical access to equipment. </blockquote><br>  Nobody canceled the remote code execution class vulnerabilities, and you can do the same thing without physical access. <br><br><blockquote>  You will be surprised if someone tells you that someone, having obtained the login and password of the PC administrator, reinstalled the OS on it or installed malware?  Most likely no.  This is a fairly obvious threat, often implemented in practice. </blockquote><br>  Very weak script.  Why isn't the NSA script mentioned ?!  After all, it is possible so: the transported device on the transport node is removed by a third party.  Further, the third party modifies the firmware on the system (KNOWING DEFAULT LOGIN AND PASSWORD), embedding the malicious functionality.  Then it blows all the settings ‚Äúto zero‚Äù, as if the device never turned on.  As a result, the customer receives the device, completely unaware that its firmware is not original, but ‚Äústretched‚Äù, and under certain conditions the piece of hardware will cease to be its equipment, will fall under the control of the ‚Äúoutsider‚Äù. <br><br><blockquote>  To identify the SYNful Knock, several fairly simple mechanisms and recommendations were proposed. </blockquote><br>  The mechanisms and recommendations are excellent, but they already work after the device was under the control of an intruder, and he could dispose of it at his own discretion inside a foreign company.  That is, this is all for IDENTIFICATION.  This is all POSTFACTUM. <br><br>  Meanwhile, to this day you can upload a modified image, and there is no doubt that a new version will be released.  And the manufacturer will simply release a new scanner and new signatures. <br><br>  The stories about how using a potentially modified image to check it for modification using the verify command look strange to the point of ridiculous.  Please note: in a modified image, you can correct the code responsible for checking your checksum. <br><br><blockquote>  According to the currently available information, SYNful Knock did not cause serious damage, and its distribution area (number of affected network devices) was limited and amounted to 163 devices according to Shadowserver (out of ten million devices sold this generation) as of September 20, 2015. </blockquote><br>  An interesting game with numbers.  Device device is different.  It's one thing when a device of this class is in a small company, and quite another if it is used by a major player from the telecom industry.  That is, by impact and profit these are completely different stories, as you understand. <br><br>  Plus, it should be borne in mind that the published information from ShadowServer describes only those devices to which it was possible to connect from the outside and detect that they are infected.  Consequently, the mass of devices controlled by the attacker (s), having access to the internal network, for example, through any other device or PC infected with ‚Äústandard‚Äù malicious software, has not been covered. <br><br><blockquote>  knowingly, Cisco has implemented a digital signature mechanism for ROMMON updates and IOS operating system images, but on previous-generation platforms, verification needs to be activated manually </blockquote><br>  Our experience with Cisco hardware research shows that not all devices can be upgraded, for example, ROMMON.  It is simply not available on the manufacturer‚Äôs website.  For some "iron", ROMMON was just now being laid out - perhaps this is precisely due to the increase in incidents related to infection.  And in order to enable customers to update ROMMON, it was provided for download. <br><br><blockquote>  Therefore, when any researcher or company categorically declares that they ‚Äúhacked iOS‚Äù, this is either a sign of incompetence and a misunderstanding that we have many different modifications of our underlying operating system, or a banal desire to embellish and advertise for loud news. </blockquote><br>  The author of the article was frightened by the news <a href="http://www.cnews.ru/news/top/2015-11-27_rossiyane_nauchilis_atakovat_lyuboj_kommutator">headlines</a> and did not wait for the publication of technical slides and videos from the speech with the ZeroNights 2015 ‚ÄúCisco IOS shellcode: all-in-one‚Äù.  This is also stated in the presentation: <br><br><img src="https://habrastorage.org/files/db6/364/015/db63640150f24eb1b40196e9fb5a4d89.png" alt="image"><br><br>  As you can see, the slide does not contradict the above.  Moreover, the leitmotif of the second part of the study was just a conversation about how the researcher ‚Äúdeals‚Äù with the existing variety of hardware platforms, processor architectures and operating systems of Cisco.  The study noted that although Cisco IOS binary images can be seriously different, you can always find architectural features that remain unchanged from image to image, a kind of ‚Äúinvariants‚Äù.  In this case, the ‚ÄúTcl‚Äù subsystem has become such an ‚Äúinvariant‚Äù, which is equally designed and functions regardless of the OS version and hardware architecture. <br><br>  Although the direct object of study was Cisco IOS (PowerPC), the proposed approach to implementing portable between shell-code images can be extended to another processor architecture or another Cisco IOS XE OS family. <br><br><blockquote>  But let's face it.  The vulnerability in the Tcl interpreter has been known for a long time and even has its CVE identifier.  That is, a statement about the found vulnerabilities are frank lies, made only for their own PR. </blockquote><br>  Let's face it and say that the author is not aware of the content of the report, because he did not attend it.  In a study of general vulnerabilities in Cisco equipment were not affected, but only mentioned casually! <br><br>  The study is devoted to the portable Tcl-based shell code for Cisco equipment, which can be used in conjunction with any binary vulnerability that allows arbitrary code to be executed, and the mentioned vulnerability in the Tcl interpreter has only an indirect relationship to it (perhaps, only Tcl "in the title).  We do not doubt that the difference between the terms "vulnerability" and "shell code" is obvious to a specialist. <br><br>  If we touch upon the issue of privilege escalation, then it should be noted that the shell code has direct access to physical memory and can modify both the Cisco IOS code itself and various control structures, including elevation of privileges. <br><br><blockquote>  In other words, from the point of view of a security specialist who works at an enterprise and who is interested in information about the security of its network equipment, it‚Äôs worth exploring not only the press releases of the researchers, but also information about the elimination of the hole and about the restrictions on its use, which the manufacturer gives . </blockquote><br>  It's like that.  However, we did not talk about vulnerabilities.  Everyone understands that there are and will be vulnerabilities, and we were not very interested in making a report about a number of common vulnerabilities at the international ZeroNights conference.  We talked about what you can do after the exploitation of a vulnerability in Cisco equipment. <br><br><blockquote>  If you go to it, you can see constantly updated information about various vulnerabilities in different products of different versions. <br></blockquote><br>  The key word ‚Äúconstantly‚Äù;) <br><br><blockquote>  Moreover, when Cisco PSIRT specialists, on their own initiative, contacted Digital Security about a recent report by ZeroNights about an allegedly discovered vulnerability in Cisco equipment, Digital Security representatives could not answer and provide details of their research. </blockquote><br>  Yes, we contacted after the news and got the answer that no vulnerabilities in the Cisco equipment were considered and the slides will be available for everyone soon. <br><br>  Here is a study presentation (video will be available later): <br><br><div class="slideshow"><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.slideshare.net/slideshow/embed_code/55738179&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg7vXEc9WeDmIBL6OausEePAqTzEA" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></div><br><br><h4>  About Cisco device infection </h4><br>  We did not raise this topic at all in our study - this is a separate topic.  The only thing I would like to note: when talking about vulnerabilities, the manufacturer concentrates on a huge amount of equipment, OS and architectures, but when it comes to protecting against modifying the firmware image, it instantly forgets about it, mentioning Trust Anchor technology, Secure Boot, which is far from everywhere. <br><br>  How to determine if you have a Trust Anchor, Secure Boot is a separate quest.  Some official <a href="https://www.cisco.com/web/about/doing_business/trust-center/docs/trust-anchor-image-signing-secure-boot-report-final.pdf">documents</a> from Cisco say one thing, and other sources ( <a href="http://tools.cisco.com/ITDIT/CFN/jsp/index.jsp">Cisco Feature Navigator service</a> ) declare another.  Who to believe? <br><br>  Our experience with Cisco equipment, which is now used in companies (and not on shelves in stores), over the past few years shows that in most cases a checksum is used to verify the legitimacy of the image.  Naturally, it is very easy to fake (recalculate) the checksum of the modified image.  On a number of devices where the image has a digital signature, digital certificates are in the same place, and it is easy for an attacker to add his certificate there. <br><br>  Also attentive / sophisticated reader may think about TPM (Trusted Platform Module).  But Cisco does not transport it to a number of countries because of cryptography, including Russia.  And we honestly tried to find out what kind of equipment supports TPM.  It turned out that his number is negligible. <br><br>  Of course, Cisco equipment is evolving, new security mechanisms are being introduced.  But the updates concern only the latest models, and the situation with the bulk of "iron", which is actively used in companies, remains the same.  It turns out, as with the Android OS: in the latest version, everything is fine, well, let the rest be updated.  The problem is that updating the entire fleet of network equipment is not so easy (and not cheap).  This is not an OS on the phone.  And we clearly see such a problem with our customers. <br><br><h4>  Conclusion </h4><br>  Of course, we, as researchers, can only be pleased by the fact that our work provokes an active response from Cisco and the publication of security articles.  However, I would like to hope that the vendor‚Äôs experts will not limit themselves to emotional feedback, but will direct their energy towards improving the safety of their own products. </div><p>Source: <a href="https://habr.com/ru/post/272183/">https://habr.com/ru/post/272183/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272173/index.html">Air Datepicker, easy and beautiful date selection</a></li>
<li><a href="../272175/index.html">Critically dangerous vulnerabilities in popular 3G and 4G modems or how to build Big Brother</a></li>
<li><a href="../272177/index.html">Business processes: how not to automate mess</a></li>
<li><a href="../272179/index.html">Rational approximation to pi</a></li>
<li><a href="../272181/index.html">Mail.Ru Group educational projects: 4 years, 1206 students, 101 teachers</a></li>
<li><a href="../272185/index.html">Announcement of laboratory works with Windows Camp // Labs and useful links for developers</a></li>
<li><a href="../272187/index.html">Not all cookies are equally useful.</a></li>
<li><a href="../272189/index.html">Feature javascript protocol or generation of random password in the browser tab</a></li>
<li><a href="../272191/index.html">Welcome to TechDay in Moscow on December 10</a></li>
<li><a href="../272193/index.html">How to calculate the time for testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>