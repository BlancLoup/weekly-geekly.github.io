<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The interaction of the circuit in Proteus with the outside world</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I think many of those who are somehow connected with the development of electronic devices have heard at least once about the Proteus s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The interaction of the circuit in Proteus with the outside world</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  I think many of those who are somehow connected with the development of electronic devices have heard at least once about the <a href="http://www.labcenter.com/index.cfm">Proteus</a> software package from Labcenter Electronics.  Whatever the extensive library of components available for modeling, the "life" of the circuit is limited to the emulator window, with rare exceptions.  There are already several models that I can, for example, write some data to a file or even be presented to the system as USB devices, but for now they can solve a small class of problems. <br><br><h4>  Task </h4><br>  When working on a course project, in which it is necessary to develop a system for radio control of the aircraft, it became necessary to connect the model with a PC.  Since one of the simplest interfaces for communication with a PC is <a href="http://ru.wikipedia.org/wiki/RS-232">RS-232</a> , it was chosen (the usb-uart adapter was used). <br><br>  So how to debug this system at the very beginning, when quite serious errors have not yet been found that can lead to failure of electronic components, and not to bother with frequent firmware microcontroller (s)? <br><a name="habracut"></a><br>  Quite a convenient solution is Proteus.  But then a new problem appears - connection with the PC. <br><img src="https://habrastorage.org/storage2/2d9/929/131/2d99291318aadff0443ca9d9cef96e97.png" align="right">  The component library contains the COMPIM model, which allows you to connect a circuit to a PC's COM port, which allows you to process requests coming from devices connected to this COM port as if they were connected to an emulated device.  You can of course through another COM port connect to the one that is connected to the circuit, but this requires 2x COM ports and an external null modem cable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Immediately comes to mind the idea of ‚Äã‚Äãvirtual com ports.  For example, <a href="http://com0com.sourceforge.net/">com0com</a> , which creates 2 virtual COM ports, the input and output of which is redirected into each other.  And for those who for some reason are working on virtual machines, it may be useful to redirect com ports with VM tools. <br><br>  But <s>we are not looking for easy ways.</s>  by chance I came across <a href="http://www.electronicslab.ph/forum/index.php%3Ftopic%3D10649.0">an article</a> about creating my own digital models for Proteus.  It tells how to bring all the logic of the model to the dynamic library.  Then I thought that this would at least allow me to solve my problem, and as a maximum I would greatly expand the capabilities of the emulator by adding my own devices.  Which can have interfaces uart, i2c, spi, etc. (from the scheme side) and practically any for communication with the outside world (at least 3D GUI) <br><br><h4>  Steps to create a model </h4><br><h5>  Creating a graphic image of the model </h5><br>  Add a rectangle, another rectangle, text, conclusions (using Device Pins), we get: <br><img src="https://habrastorage.org/storage2/eae/687/fae/eae687faeccade413242791b0549d3bd.png" alt="image"><br>  described in detail in <a href="http://www.electronicslab.ph/forum/index.php%3Ftopic%3D10649.0">that article</a> or <a href="http://kazus.ru/forums/showthread.php%3Ft%3D13198">here</a> <br><br><h5>  Program development </h5><br>  To interact with the model, I decided to use the named pipes of Windows.  Perhaps the solution will seem strange, but the idea is to provide the interface as close as possible to the interface of the real device.  The choice fell on named pipes, since working with them and COM ports is almost identical to working with regular files. <br><br>  But even if we have a communication channel with the "outside world", then how to implement the exchange on the uart interface? <br>  We need to remember its frame format: <br><img src="https://habrastorage.org/storage2/1b4/af0/986/1b4af09869cbd1c5f4d940ef753f8d27.png"><br>  The logic of generating / parsing a signal of this type is allocated to a separate class. <br>  The main for the proteus model will be two methods: <br>  making the initial setup: <br><pre><code class="cpp hljs">VOID PIPEUARTMODEL::setup (IINSTANCE *instance, IDSIMCKT *dsimckt) { uart = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uart(); logger = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logger(instance); pipe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipe(<span class="hljs-string"><span class="hljs-string">"\\\\.\\pipe\\uart"</span></span>, logger); <span class="hljs-comment"><span class="hljs-comment">//   dsimckt ckt = dsimckt; //    txd = instance-&gt;getdsimpin("TXD", true); rxd = instance-&gt;getdsimpin("RXD", true); //   txd txd-&gt;setstate(SHI); // 2  ckt-&gt;setcallback(1, this, rxd_event); ckt-&gt;setcallback(2, this, txd_event); }</span></span></code> </pre> <br>  and that jerked by callback <br><pre> <code class="cpp hljs">VOID PIPEUARTMODEL::callback(ABSTIME time, EVENTID eventid) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (eventid) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> rxd_event: uart-&gt;rxBit(ishigh(rxd_pin_state)); <span class="hljs-comment"><span class="hljs-comment">//    if (uart-&gt;rxC) { pipe-&gt;rxd_queue.push(uart-&gt;rxD); //  pipe uart-&gt;rxC = 0; } //      ckt-&gt;setcallback(time + 1000000000000 / uart_baudrate, this, rxd_event); break; case txd_event: if ((uart-&gt;txC) &amp;&amp; (!pipe-&gt;txd_queue.empty())) { uart-&gt;txD = pipe-&gt;txd_queue.front(); //  uart pipe-&gt;txd_queue.pop(); } txd-&gt;setstate(time, 1, uart-&gt;txBit() ? SHI : SLO); //   ckt-&gt;setcallback(time + 1000000000000 / uart_baudrate, this, txd_event); break; } }</span></span></code> </pre> <br><br><h5>  Testing </h5><br>  An example of how my model works with Virtual Terminal: <br><img src="https://habrastorage.org/storage2/39f/1c2/421/39f1c2421101923796eee17181865d9a.png"><br>  There is still to check how convenient this solution will be, but at first glance, it completely suits me. <br><br>  I hope the presented recipes will help solve many of your problems. <br><br><h4>  List of sources </h4><ol><li>  <a href="http://kazus.ru/forums/showthread.php%3Ft%3D13198">A pretty good Proteus system description and model creation guide.</a> </li><li>  <a href="http://easyelectronics.ru/tag/rs232">easyelectronics.ru/tag/rs232</a> </li><li>  <a href="http://code.google.com/p/jc-proteus-models/">A page on google code where you can get all the sources</a> </li><li>  <a href="">Compiled dll and library for Proteus</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/135914/">https://habr.com/ru/post/135914/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135904/index.html">Project management system with blackjack and addons</a></li>
<li><a href="../135908/index.html">Django Admin Bootstrap Theme</a></li>
<li><a href="../135909/index.html">Comprehensive course on site development: prerequisites, dreams and plans</a></li>
<li><a href="../135912/index.html">Super cheap camera with control - do it yourself</a></li>
<li><a href="../135913/index.html">Unicode for Dummies</a></li>
<li><a href="../135915/index.html">Backdoor in Active Directory # 2</a></li>
<li><a href="../135916/index.html">Manual: Pyramid for People - Table of Contents</a></li>
<li><a href="../135917/index.html">New C ++ World Map from Alenacpp</a></li>
<li><a href="../135919/index.html">Simple minimalist implementation of complex JavaScript applications</a></li>
<li><a href="../135920/index.html">Generating a list of IPv4 addresses on TCL and some number systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>