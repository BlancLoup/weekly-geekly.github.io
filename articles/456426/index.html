<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BASS - framework for automatic synthesis of antivirus signatures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. There is less than ten days before the start of the course ‚ÄúReverse Engineering‚Äù , in this connection we want to share one more interesting tra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BASS - framework for automatic synthesis of antivirus signatures</h1><div class="post__text post__text-html js-mediator-article">  Hello.  There is less than ten days before the start of the course <a href="https://otus.pw/zQDQT/">‚ÄúReverse Engineering‚Äù</a> , in this connection we want to share one more interesting translation on the topic.  Go! <br><br><img src="https://habrastorage.org/webt/ff/sk/na/ffsknagvtnwxc02g9xpjlu-0p1i.png"><br><br><h2>  Short review </h2><br><img src="https://habrastorage.org/webt/hi/fs/gs/hifsgsy2jdczl7lk9n3zj1luisy.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The picture of threats is changing rapidly - new cyber attacks constantly appear, and old ones become more sophisticated.  Under these conditions, security specialists face ever more complex tasks.  Every day they have to process and analyze millions of samples of previously unknown and completely new malware, develop effective antivirus signatures to describe entire families of malicious programs, ensure the scalability of tools as the number of samples for analysis increases.  At the same time, it is necessary to take into account the limited resources for automation tools for malware analysis.  To help IT professionals cope with these diverse challenges, Talos offers a new open source platform called BASS. <a name="habracut"></a><br><br>  BASS (reads ‚Äúbs‚Äù) is a framework for automatically generating antivirus signatures based on samples from previously formed clusters of malicious code.  It is designed to reduce the consumption of resources by the ClamAV core by increasing the share of template-based signatures relative to hash signatures, as well as to simplify the work of analysts who develop signature-based signatures.  Due to the support of Docker containers, the framework scales well. <br><br>  It is worth noting that so far only the alpha version of BASS is available and much remains to be finalized.  This project has open source code, and we are actively working on it, so we will be glad to receive any feedback from the community and recommendations for improving it.  BASS source code is available <a href="https://github.com/Cisco-Talos/bass">here</a> . <br><br>  The BASS project was announced in 2017 at the <a href="https://recon.cx/2017/montreal/">REcon</a> conference in Montreal, Canada. <br><br><h2>  Relevance </h2><br>  Talos specialists receive more than 1.5 million unique samples daily.  Most of them belong to known threats and are immediately eliminated by a malware scanner (ClamAV).  However, after scanning, a lot of files remain that still need further analysis.  We run them in a sandbox and perform dynamic analysis, which allows them to be divided into malicious and safe ones.  We process the malicious samples selected at this stage in order to create ClamAV signatures based on them, which will help to filter out these threats at an earlier stage, during the scan. <br><br><img src="https://habrastorage.org/webt/5f/oh/6o/5foh6op04xmtrj7-7wuhy0ifkfm.jpeg"><br><br>  For three months, from February to April 2017, 560,000 new signatures were added to the ClamAV database, an increase of 9,500 signatures per day.  We received a significant part of them automatically in the form of hash signatures.  Such signatures have one major drawback compared to template-based or bytecode signatures (these are two other types supported by the ClamAV kernel): one hash signature corresponds to only one file.  In addition, the increase in the number of hash signatures leads to the fact that the ClamAV database takes up more memory.  That is why we prefer template-based signatures.  They are much easier and faster to manage than byte-code, and at the same time they allow you to describe entire file clusters. <br><br><h2>  Bass </h2><br>  The BASS framework is designed to facilitate the creation of ClamAV signatures based on templates.  It automatically generates them, processing segments of binary executable code. <br><br><img src="https://habrastorage.org/webt/ce/jt/ew/cejtew2tpxdzibmmqztxp88tija.jpeg"><br><br>  BASS takes clusters of malicious code as a basis, but does not include the means of creating them.  Due to this technology remains comfortable and flexible.  We intentionally made the input interface universal so that it was easy to adapt to new sources of clusters.  Now we use several such sources, including clusters based on indicators of compromise (IoC) from our sandbox, structural hashing (when we have a deliberately malicious executable file and we are looking for additional samples that are similar to it in structure) and malware obtained from spam campaigns. <br><br>  At the first stage, the malicious instances pass through the ClamAV kernel unpackers.  It can unpack archives of various formats and compressed executable files (for example, UPX), as well as extract embedded objects (such as EXE files inside Word documents).  The resulting artifacts are carefully analyzed, information is being collected.  Now for the next stage, filtering, we use their sizes and the UNIX magic string. <br><br>  Then the cluster of malicious code is filtered.  If the files do not meet the BASS requirements (while the platform only works with executable PE files, but it is not difficult to add support for the ELF and MACH-O binary files), they are removed from the cluster or, if there are too few objects, the cluster is rejected completely. <br><br>  The filtered cluster proceeds to the signature generation stage.  First, the binary files are disassembled.  To do this, we use IDA Pro, but it can easily be replaced with another disassembler with similar capabilities, for example, radare2. <br><br><img src="https://habrastorage.org/webt/cz/ah/gl/czahglwn1x_oflib8pokrduqeso.jpeg"><br><br>  After disassembling, it is necessary to identify the common code in the samples in order to generate signatures on its basis.  This step is important for two reasons.  First, the signature creation algorithm requires significant computational resources and works best with short code segments.  Secondly, it is preferable to obtain signatures from code samples that are similar not only syntactically, but also semantically.  To compare the code, we use the BinDiff utility.  Again, it is also easy to replace, and in the future we may integrate other utilities into the framework for comparison. <br><br>  If the cluster is small, BinDiff compares each executable file with all the others.  Otherwise, the scope of the comparison is reduced, otherwise the process may take too long.  Based on the results obtained, a graph is constructed, where the vertices denote functions, and the edges denote their similarities.  To find a good general function, it suffices to find a connected subgraph with a high general similarity index. <br><br><img src="https://habrastorage.org/webt/uz/tk/nt/uztkntwexposekzfrzoskpmfotq.jpeg"><br><br>  The subgraph ∆í1, ∆í2, 4, ∆í6 with high rates of vertex similarity (see figure above) is an excellent candidate for the role of a common function. <br><br>  As soon as several such candidates are recruited, we associate them with the white list in order to avoid creating signatures based on ordinary functions of libraries that are statically associated with the sample.  To do this, the functions are sent to a copy of <a href="https://github.com/McGill-DMaS/Kam1n0-Plugin-IDA-Pro">Kam1n0</a> , the database of which we previously filled with functions from obviously clean samples.  If a clone of any function is found, the procedure for selecting a subgraph is repeated in order to select the most suitable of the remaining ones.  If the check reveals nothing, the set of functions is passed to the next stage. <br><br>  Then the signature generation itself begins.  Pattern-based ClamAV signatures are designed to identify subsequences in binary data.  Therefore, we apply to all extracted functions the search algorithm of the largest common subsequence for them (LCS, Longest Common Subsequence). <br><br>  From a computational point of view, this algorithm is quite expensive even for two samples and noticeably heavier for several, so we use its heuristic variant, described by <a href="https://static.googleusercontent.com/media/www.zynamics.com/en/downloads/blichmann-christian--diplomarbeit--final.pdf">Christian Blichmann</a> .  The result might look something like this: <br><br><img src="https://habrastorage.org/webt/zb/9_/il/zb9_ilfd2g0rcqw1nw1h5iblsi4.jpeg"><br><br>  Finally, before publishing the signature, you need to test it.  We automatically check the signature using our test set for false positives.  For greater accuracy, we use Sigalyzer - a new feature of our <a href="https://github.com/Cisco-Talos/CASC">CASC IDA Pro ClamAV</a> plug-in <a href="https://github.com/Cisco-Talos/CASC">for generating and analyzing signatures</a> (it will be updated later).  Sigalyzer marks sections of a binary file that match the ClamAV signature that worked for it.  Thus, a visual visual representation of the signature is formed. <br><br><h2>  Architecture </h2><br>  BASS is implemented as a Docker container cluster.  The framework is written in Python and interacts with all the necessary tools through web services.  The architecture was created by analogy with the <a href="https://www.zynamics.com/vxclass.html">VxClass</a> project, which also generated ClamAV signatures using IDA Pro and BinDiff, but would later be closed and, unlike BASS, inaccessible to the general public. <br><br><img src="https://habrastorage.org/webt/wg/ma/x2/wgmax2n6nevnscpmjx_lijw9kmq.jpeg"><br><br><h2>  Restrictions </h2><br>  BASS works exclusively with binary executables, since the signature is generated from the sample code.  In addition, it analyzes only executable files x86 and x86_64.  Support for other architectures may appear in the future. <br><br>  So far, BASS does not cope well with file viruses, which embed small and very unlike each other code snippets into infected objects, and with backdoors, mostly consisting of non-malicious binary code (often stolen), which is complemented by malicious functions.  We are struggling with these shortcomings by working to optimize the clustering stage. <br><br>  And once again we want to remind you that BASS is at the stage of alpha testing, and so far not everything works smoothly.  But we hope that we will benefit the community by developing this framework as an open source project, and we will welcome any ideas and criticism. <br><br><h2>  application </h2><br>  <i>The difference between the largest common substring and the largest common subsequence</i> <br><br>  The following illustration shows the difference between the largest common substring and the largest common subsequence.  The largest common subsequence is indicated in our publication by the English abbreviation LCS. <br><br><img src="https://habrastorage.org/webt/ul/ww/a8/ulwwa8nqjhgoblgtzgq_kkaygfc.jpeg"><br><br>  That's all.  And already on June 20, it will be possible to get acquainted in detail with the program of the course at <a href="https://otus.pw/2zkI/">the open door</a> , which will be held in the webinar mode. </div><p>Source: <a href="https://habr.com/ru/post/456426/">https://habr.com/ru/post/456426/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456414/index.html">Protection against fires in data centers, or how data integrity is ensured</a></li>
<li><a href="../456416/index.html">The book "Agile for all"</a></li>
<li><a href="../456418/index.html">A brief history of cheating in video games</a></li>
<li><a href="../456422/index.html">The announcement of the new version of Styled Components v5: Fangs</a></li>
<li><a href="../456424/index.html">Utreexo: compress UTXO Bitcoin set</a></li>
<li><a href="../456428/index.html">How to implement a BI-approach to data analysis: practical recommendations</a></li>
<li><a href="../456430/index.html">The eternal question of technical duty</a></li>
<li><a href="../456432/index.html">Security Week 25: Evernote Vulnerability and Hundreds of Hacked Online Stores</a></li>
<li><a href="../456434/index.html">Professions of the future: "Who will you work on Mars?"</a></li>
<li><a href="../456436/index.html">A short JS task for Monday</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>