<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We raise the price monitoring service of competitors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anyone who works in e-commerce sooner or later faces the need to be first among competitors. One of the most effective tools in this matter is price m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We raise the price monitoring service of competitors</h1><div class="post__text post__text-html js-mediator-article">  Anyone who works in e-commerce sooner or later faces the need to be first among competitors.  One of the most effective tools in this matter is price management.  The results of marketing research show that among those consumers who are willing to change the supplier of industrial equipment and tools, one-third cites low price as a decisive factor in choosing a new supplier.  On the Internet there are a lot of different services, but for one reason or another they did not fit. <br><a name="habracut"></a><br>  <b>Ways to get information about competitor prices</b> <br><br><ol><li>  The easiest and most effective way to monitor prices at the moment is <a href="https://pricelabs.yandex.ru/dashboard/">pricelab</a> .  But in it you can check only those products that are already participating in Yandex.Market.  That is, your main competitor must be in Yandex.Market, the product you are interested in must also be unloaded, and you yourself must unload your product. <br>  What are the disadvantages that this entails?  Considering the fact that in Yandex.Market the price of a click is proportional to the price of <a href="https://ru.wikipedia.org/wiki/SKU">SKU</a> , many will not place specialized products with a high price in it, and it will be unprofitable to place such goods themselves. <br>  We have implemented a small script for price monitoring with pricelab, but some key positions are not downloaded in pricelab. </li><li>  Agree with a competitor‚Äôs employee.  This is not entirely correct and honest way.  Therefore, immediately rejected. </li><li>  Parsing competitor site.  This is a popular method and it goes almost for nothing.  Below it will be described it. </li></ol><br>  <b>Instruments</b> <br><br><ol><li>  Database. </li><li>  Algorithm parsing. </li></ol><br>  Historically, the online store is at 1C-Bitrix, so the price monitoring was written in php.  But this is the wrong approach, so the algorithm for parsing on Node.js will be described below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, take the <a href="https://ru.wikipedia.org/wiki/IPhone_6">iphone</a> product in different stores and we will monitor its price. <br><br>  Create a table of competitors: <br><br><div class="spoiler">  <b class="spoiler_title">competitors</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> panda.competitors ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">INNODB</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci;</code> </pre> <br></div></div><br>  Next, we need a URL for products and a list of elements in the HTML document.  Create a table of lists of elements: <br><br><div class="spoiler">  <b class="spoiler_title">competitors_selector</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> panda.competitors_selector ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, competitor_id <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, selector <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, use_status <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'unused'</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">INNODB</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci;</code> </pre><br></div></div><br>  Create a table that will store url, prices, etc .: <br><br><div class="spoiler">  <b class="spoiler_title">competitors_data</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> panda.competitors_data ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, competitor_id <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, sku <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, competitor_url <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, competitor_price <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, competitor_response_ms <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, competitor_price_status <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'created'</span></span>, last_update_unixtime <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">INNODB</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci;</code> </pre><br></div></div><br><br>  An example of filling the competitors table: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/b68/940/0e0b68940260bb6482ce06940037f0da.jpg" alt="image"><br><br>  An example of filling the competitors_selector table: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e62/a88/0ac/e62a880ac4b84a08b107d91ea92ec40d.jpg" alt="image"><br><br>  An example of filling the competitors_data table: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bbf/4a1/058/bbf4a10589176733408d62c2ec20a57b.jpg" alt="image"><br><br>  The data from competitors_selector is populated based on selectors: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/32e/706/f05/32e706f0571a9c430b6c174cd00d84ff.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/816/11a/8b4/81611a8b4c3edf0a3c3386ee5a0817a5.jpg" alt="image"><br><br>  At the moment, every self-respecting online store uses <a href="https://www.w3.org/TR/microdata/">microdata</a> .  There is a huge number of parsers in various programming languages.  Since we decided what we are writing on Node.js, we will use the excellent <a href="https://www.npmjs.com/package/semantic-schema-parser">semantic-schema-parser</a> module.  The module itself fits in 149 lines and under the hood it has an excellent <a href="https://www.npmjs.com/package/cheerio">cheerio</a> content <a href="https://www.npmjs.com/package/cheerio">parser</a> .  We will slightly modify the module by adding the $ object to the callback. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a93/8df/33d/a938df33d805e6b935bc66c9b5443f25.jpg" alt="image"><br><br>  But do not forget that many online stores still do not use <a href="https://www.w3.org/TR/microdata/">microdata</a> .  The competitors_selector data comes into play here.  In the request options, we put a maximum of 5 redirects, a user-agent as a yandex bot, and a timeout of 2 seconds. <br><br>  To download html use the library <a href="https://www.npmjs.com/package/needle">needle</a> .  To simplify the formation of queries to the database, we use the <a href="https://www.npmjs.com/package/templayed">templayed</a> template <a href="https://www.npmjs.com/package/templayed">engine</a> . <br><br>  Queries to the database: <br><br><div class="spoiler">  <b class="spoiler_title">resetSelectorsStatus.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> competitors_selector <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> use_status = <span class="hljs-string"><span class="hljs-string">'unuse'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">selectcSelectors.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> competitors_selector</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">selectcURLs.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> competitors_data</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">updateCompetitorData.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> competitors_data <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> competitor_price = <span class="hljs-string"><span class="hljs-string">'{{price}}'</span></span> ,competitor_response_ms = {{response_ms}} ,last_update_unixtime = {{response_time}} ,competitor_price_status = <span class="hljs-string"><span class="hljs-string">'{{status}}'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = {{<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>}}</code> </pre><br></div></div><br>  The parsing algorithm is as follows: <br><br><ol><li>  Reset selector. </li><li>  We form object from DOM selectors. <br><br><pre> <code class="javascript hljs">{:[<span class="hljs-string"><span class="hljs-string">'selector1'</span></span>,<span class="hljs-string"><span class="hljs-string">'selector2'</span></span>]}</code> </pre> <br></li><li>  Download HTML. </li><li>  Analyzing microdata. </li><li>  If the microdata does not have the necessary data, then analyze the selectors. </li><li>  If the data is not defined, then set it to null. </li></ol><br>  The Scraping class code is shown below.  The code uses a bicycle to simultaneously analyze the url asynchronously.  Initially, the idea was: <br><br><ol><li>  Aggregate competitors from competitors_data. </li><li>  Set the number of simultaneous asynchronous requests. </li><li>  We interrogate each competitor through timeout. </li></ol><br>  But for now the implementation is as follows: <br><br><div class="spoiler">  <b class="spoiler_title">Full code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> needle = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'needle'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mysql = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mysql'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> templayed = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'templayed'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> schema = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"semantic-schema-parser"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Scraping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.    _this = this; _this.DB = mysql.createConnection({ host : 'localhost', user : '******************', password : '******************', database : 'panda' }); _this.querys = {}; _this.selectors = {};//dom   Scraping'a _this.rows = null;//  url _this.workers = 5;//    _this.needleOptions = { follow_max : 5 //  5  ,headers:{'User-Agent': 'Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots) '} ,open_timeout: 2000 // if we don't get our response headers in 5 seconds, boom. } this.run = function(){ _this.DB.connect(); _this.queryLoad(); _this.resetSelectorsStatus(); } //--------------------// //   { ()} this.queryLoad = function(){ _this.querys['selectcSelectors'] = fs.readFileSync('sql/selectcSelectors.sql', 'utf8'); _this.querys['resetSelectorsStatus'] = fs.readFileSync('sql/resetSelectorsStatus.sql', 'utf8'); _this.querys['selectcURLs'] = fs.readFileSync('sql/selectcURLs.sql', 'utf8'); _this.querys['updateCompetitorData'] = fs.readFileSync('sql/updateCompetitorData.sql', 'utf8'); }; //--------------------// //   this.resetSelectorsStatus = function(callback){ _this.DB.query( _this.querys['resetSelectorsStatus'], function(err, rows) { _this.selectcSelectors(); }); } //--------------------// //---- DOM  this.selectcSelectors = function(callback){ _this.DB.query( _this.querys['selectcSelectors'] , function(err, rows) { if (!err){ rows.forEach(function(item, i, arr) { if (!_this.selectors[item.competitor_id]){_this.selectors[item.competitor_id]=[];} _this.selectors[item.competitor_id].push({id:item.id,selector:item.selector}); }); _this.selectcURLs(); } }); } //--------------------// this.selectcURLs = function(callback){ _this.DB.query( _this.querys['selectcURLs'] , function(err, rows) { if (!err){ _this.rows = rows; _this.workersTask(); } }); } //--------------------// this.workersTask = function(){ __this = this; __this.worker = []; for (var i = 0; i &lt; _this.workers; i++) { __this.worker[i] = { id:i ,status: 'run' ,allTask : function(){ var status = {}; status['run'] = 0; status['iddle'] = 0; __this.worker.forEach(function(item){ if(item.status==='run'){status['run']++;} else{status['iddle']++;} }); return status; } ,timeStart : new Date().valueOf() ,func: function(){ _this.parseData(__this.worker[this.id]) } } __this.worker[i].func(); } } //--------------------// this.parseData = function(worker){ __this = this; var count = _this.rows.length; var startTime = new Date().valueOf(); if(count &gt; 0 ){ var row = _this.rows.shift();//    rows     var URL = row.competitor_url; needle.get(URL, _this.needleOptions, function(err, res){ if (err) {worker.func(); return;} var timeRequest = ( new Date().valueOf() ) - startTime; schema.parseContent(res.body, function(schemaObject, $){ price = _this.parseBody(schemaObject,$,row); status = ( price!='NULL' ) ? 'active' : 'error'; //console.log(res.statusCode, 'timeout:'+timeRequest, 'price:'+price, worker.id, URL, row.id); _this.updateCompetitorData({ id : row.id ,status:status ,response_time:( new Date().valueOf() ) ,response_ms:timeRequest ,price:price }); worker.func(); }); }); }else{ worker.status = 'idle'; if(worker.allTask().run===0){ console.log('  ,  '); _this.DB.end();//   ; } } } _this.parseBody = function(schemaObject,$,row){ var price; schemaObject.elems.forEach(function(elemsItem, i) { if(!elemsItem.product)return; elemsItem.product.forEach(function(productItem, i) { if(!productItem.price)return; price = ( productItem.price['content'] ) ? productItem.price['content'] : ( productItem.price['text'] ) ? productItem.price['text'] : null; price = price.replace(/[^.\d]+/g,"").replace( /^([^\.]*\.)|\./g, '$1' ); price = Math.floor(price); }); }); if( (!price) &amp;&amp; (_this.selectors[row.competitor_id]) ){ _this.selectors[row.competitor_id].forEach(function(selector){ price_text = $(selector.selector).text(); if (price_text){ price = price_text.replace(/[^.\d]+/g,"").replace( /^([^\.]*\.)|\./g, '$1' ); price = Math.floor(price); //     selector   //-------------------------------------------------// return; } }); } if(!price){price = 'NULL'}; return price; } //--------------------// _this.updateCompetitorData = function(data){ query = templayed( _this.querys['updateCompetitorData'] )(data); _this.DB.query( query , function(err, rows) {}); } //--------------------// _this.run(); }</span></span></code> </pre><br></div></div><br>  As a result, we obtain the following data: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d3/1d5/675/6d31d5675feef0689e1907087c790d54.jpg" alt="image"><br><br>  The image shows that you can track the most expensive and cheapest price of a competitor, the server response time.  Now you can send it into pricing, for revising the pricing policy. <br><br>  Summing up, I would like to say that with the use of microdata the parsing of the names of goods, prices and categories is greatly simplified.  But there is still a big fly in the ointment: <br><br><ul><li>  Not all online stores use microdata. </li><li>  Not all microdata are valid (a vivid example is ozone). </li><li>  Not all online stores use data on price, name, category in microdata. </li><li>  Some stores in microdata use the text field instead of content, or vice versa. </li></ul><br>  Those stores that do not use microdata use not class id as selectors, which is correct from the layout point of view, but complicates parsing (for example, in the document we can have 7 elements with price = class, and prices will only be in 4, 5, 6, 10).  Also, the price does not always exist in a convenient format: <br><br><pre> <code class="php hljs">&lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price_break</span></span></span><span class="hljs-class">"&gt;&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ins</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">num</span></span></span><span class="hljs-class">"&gt;2980&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ins</span></span></span><span class="hljs-class">&gt;&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ins</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rub</span></span></span><span class="hljs-class">"&gt; .&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ins</span></span></span><span class="hljs-class">&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br>  At the moment, with the advent of microdata, parsing has become much easier. <br><br>  In the next article I will try to show how the algorithm of automatic matching of the competitor's url card and the card in the online store is implemented. </div><p>Source: <a href="https://habr.com/ru/post/328734/">https://habr.com/ru/post/328734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328720/index.html">Google I / O co-browsing at the Avito office</a></li>
<li><a href="../328722/index.html">Logging, interfaces and allocations in Go</a></li>
<li><a href="../328726/index.html">Search for devices on the network by SSDP using Poco</a></li>
<li><a href="../328728/index.html">Theory of cone antennas BowTie</a></li>
<li><a href="../328732/index.html">Let there be a movie with Xamarin.Forms</a></li>
<li><a href="../328738/index.html">Linux staff monitoring: when demand creates supply</a></li>
<li><a href="../328740/index.html">Genetic Advisor for Options Trading</a></li>
<li><a href="../328742/index.html">Data-driven Production Approach / Stock Filters</a></li>
<li><a href="../328744/index.html">MyTaskHelper online database designer: create relational databases without programming knowledge</a></li>
<li><a href="../328746/index.html">We order translations and copywriting - the results of the project for 2 years</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>