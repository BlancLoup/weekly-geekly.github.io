<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Jasmine DRY: Do you write tests correctly?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the interim between the retraining from the Back-end programmer to the Front-end, I had to write code for the RoR application (yes, and there were ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Jasmine DRY: Do you write tests correctly?</h1><div class="post__text post__text-html js-mediator-article">  In the interim between the retraining from the Back-end programmer to the Front-end, I had to write code for the RoR application (yes, and there were tests).  The peculiar atmosphere of the Rubist community seemed interesting to me, they are very strict about writing code, and if you write badly, your <s>fingers</s> may not be forgiven.  After all, the <b>code should be as simple and readable</b> . <br><br>  The same rule applies to tests (as for me, they should be an order of magnitude simpler than the code itself).  In addition, the tests have their own golden rule - <b>One Expectation per Test</b> .  No need to write a bunch of <i>expect / assert / should</i> calls in one test, just stop doing it!  And do not forget that tests are also code, and <i>copy-paste</i> is bad practice. <br><a name="habracut"></a><br><h4>  What is a bad test </h4><br>  Understanding the 3.0 version of Knockout.js, I decided to look at the tests in the hope of finding at least some mention of the <i>after</i> property inside the binding.  Honestly, I was outraged by the complexity of the written tests. <br><br><div class="spoiler">  <b class="spoiler_title">Bad test</b> <div class="spoiler_text"><pre><code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'Binding: Checked'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ beforeEach(jasmine.prepareTestNode); it(<span class="hljs-string"><span class="hljs-string">'Triggering a click should toggle a checkbox\'s checked state before the event handler fires'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ testNode.innerHTML = <span class="hljs-string"><span class="hljs-string">"&lt;input type='checkbox' /&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clickHandlerFireCount = <span class="hljs-number"><span class="hljs-number">0</span></span>, expectedCheckedStateInHandler; ko.utils.registerEventHandler(testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"click"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ clickHandlerFireCount++; expect(testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>].checked).toEqual(expectedCheckedStateInHandler); }) expect(testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>].checked).toEqual(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); expectedCheckedStateInHandler = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ko.utils.triggerEvent(testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"click"</span></span>); expect(testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>].checked).toEqual(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); expect(clickHandlerFireCount).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); expectedCheckedStateInHandler = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ko.utils.triggerEvent(testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"click"</span></span>); expect(testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>].checked).toEqual(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); expect(clickHandlerFireCount).toEqual(<span class="hljs-number"><span class="hljs-number">2</span></span>); }); });</code> </pre> <br></div></div><br>  If you do not take into account that all the directives ( <i>describe</i> and <i>it</i> ) are part of specs, then it is impossible to understand the meaning of the test from the header ( <i>it triggering a click should ...</i> ).  It turns out after all nonsense, both in the title and in the test itself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is a list of questions that help me create understandable and simple specs: <br><ol><li>  What are test data? </li><li>  What is the testing context? </li><li>  What cases need to cover? </li><li>  How can these cases be grouped? </li></ol><br>  For the above example: <br><ol><li>  Checkbox </li><li>  User clicks on checkbox </li><li>  Cases: <ol><li>  The state changes until the click handler is called. </li><li>  The state changes to marked if the checkbox was not checked. </li><li>  The state changes to unchecked if the checkbox has been checked. </li></ol></li></ol><br><br>  Now everything is the same in English only: <br><br><div class="spoiler">  <b class="spoiler_title">Just readable test</b> <div class="spoiler_text"><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'Binding: Checked'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ beforeEach(jasmine.prepareTestNode); describe(<span class="hljs-string"><span class="hljs-string">"when user clicks on checkbox"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ beforeEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ testNode.innerHTML = <span class="hljs-string"><span class="hljs-string">"&lt;input type='checkbox' /&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox = testNode.childNodes[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stateHandler = jasmine.createSpy(<span class="hljs-string"><span class="hljs-string">"checked handler"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox.checked = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ko.utils.registerEventHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox, <span class="hljs-string"><span class="hljs-string">"click"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stateHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox.checked); }.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); ko.utils.triggerEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox, <span class="hljs-string"><span class="hljs-string">"click"</span></span>); }) it (<span class="hljs-string"><span class="hljs-string">"changes state before event handler is triggered"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ expect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stateHandler).toHaveBeenCalledWith(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }) it (<span class="hljs-string"><span class="hljs-string">"marks checkbox if it's not marked"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ expect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox.checked).toBe(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) }) it (<span class="hljs-string"><span class="hljs-string">"unmarks checkbox if it's marked"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox.checked = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ko.utils.triggerEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox, <span class="hljs-string"><span class="hljs-string">"click"</span></span>); expect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkbox.checked).toBe(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }) }) })</code> </pre><br></div></div><br>  <i>Setup</i> is complex, tests are simple.  The ideal variant is the test in which there is one call of f-tsija <i>expect function</i> . <br><br><h4>  Less code, more tests </h4><br>  When I first met <i>Jasmine,</i> I realized that she was not perfect, but not finding the possibility of creating group specs, I rushed in panic for help to <i>Google</i> .  To my great disappointment, he also did not know the answer that would suit me.  I had to dig in the dark depths of <i>Jasmine</i> myself and find a solution. <br><br>  Let's imagine that there is <i>JavaScript</i> ++, in which there are 2 classes <i>Array</i> and <i>Set</i> with a common interface ( <i>size</i> and <i>contains</i> ).  Now you need to cover them with tests, without duplicating the code!  Define common tests for our collections: <br><pre> <code class="javascript hljs">sharedExamplesFor(<span class="hljs-string"><span class="hljs-string">"collection"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ beforeEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sourceItems = [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.describedClass(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sourceItems); }) it (<span class="hljs-string"><span class="hljs-string">"returns proper size"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ expect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.collection.size()).toBe(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sourceItems.length); }) <span class="hljs-comment"><span class="hljs-comment">// another specs it ("returns true if contains item", function () { expect(this.collection.contains(this.sourceItems[0])).toBe(true); }) })</span></span></code> </pre><br>  By analogy to the <i>Rspec</i> , I would like to be able to connect the specs using one of the methods: <br><ul><li>  <i>itBehavesLike</i> - performs tests in a nested context </li><li>  <i>itShouldBehaveLike</i> - performs tests in a nested context </li><li>  <i>includeExamples</i> - runs tests in current context </li><li>  <i>includeExamplesFor</i> - executes tests in current context </li></ul><br>  <i><b>Note</b> : itShouldBehaveLike and includeExamplesFor - exist only to improve the readability of tests</i> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// array_spec.js describe("Array", function () { beforeEach(function () { this.describedClass = Array; }) itBehavesLike("collection"); //another specs }) // set_spec.js describe("Set", function () { beforeEach(function () { this.describedClass = Set; }) itBehavesLike("collection"); //another specs });</span></span></code> </pre><br>  I also usually create a <i>context</i> function (elias for <i>describe</i> ) to improve the readability of the spec. <br><br><div class="spoiler">  <b class="spoiler_title">The source code of the shared spec implementation</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">// spec_helper.js var sharedExamples = {}; window.sharedExamplesFor = function (name, executor) { sharedExamples[name] = executor; }; window.itBehavesLike = function (sharedExampleName) { jasmine.getEnv().describe("behaves like " + sharedExampleName, sharedExamples[sharedExampleName]); }; window.includeExamplesFor = function (sharedExampleName) { var suite = jasmine.getEnv().currentSuite; sharedExamples[sharedExampleName].call(suite); }; window.context = window.describe; window.includeExamples = window.includeExamplesFor; window.itShouldBehaveLike = window.itBehavesLike;</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/207794/">https://habr.com/ru/post/207794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207780/index.html">The Mail.Ru Cloud License Agreement changed</a></li>
<li><a href="../207784/index.html">Merge sort and AS3. Overtaking the native Vector.sort (Array.NUMERIC)</a></li>
<li><a href="../207786/index.html">Metaclasses in Objective-C</a></li>
<li><a href="../207788/index.html">BI: the problem of choosing a solution and an example of one failure</a></li>
<li><a href="../207792/index.html">Set the time interval on the watch face. Javascript</a></li>
<li><a href="../207796/index.html">98-year-old negatives found in the Antarctic</a></li>
<li><a href="../207798/index.html">The digest of news from the world of mobile development for the last week ‚Ññ35 (December 23-29, 2013)</a></li>
<li><a href="../207800/index.html">Development of Windows 8.1 applications on XAML / –° #. Part 5. Pop-ups and panels</a></li>
<li><a href="../207806/index.html">New Year's Eve Creative</a></li>
<li><a href="../207812/index.html">The best of the world of PHP for 2013 + competition from the company JetBrains! The digest of interesting materials ‚Ññ32</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>