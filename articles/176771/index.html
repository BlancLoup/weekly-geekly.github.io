<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Terevaka - a high level framework on Lua for mobile platforms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dear friends, today I will tell you about the high level framework on Lua for mobile platforms of its own design. As you have probably guessed from th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Terevaka - a high level framework on Lua for mobile platforms</h1><div class="post__text post__text-html js-mediator-article">  Dear friends, today I will tell you about the high level framework on Lua for mobile platforms of its own design.  As you have probably guessed from the name, this framework uses another low-level framework for drawing graphics and for interacting with the system.  The quality of it is MOAI.  For a minimum familiarization with it, I recommend reading my previous article <a href="http://habrahabr.ru/post/176765/">habrahabr.ru/post/176765</a> <br><br>  First of all, what tasks should the new framework perform? <br>  First, the problems with the fragmentation of screens.  And secondly (ta-dam), I wanted to have some kind of, even the simplest, graphical interface editor.  Third, the framework had to define the architecture and file structure of the application as a whole.  I want to say that the code turned out a bit (less than 600 lines), so even if the framework does not suit you, as it is, it will be easy to deal with its work and sharpen it for your needs. <br>  Warning: the framework is sharpened under the landscape of the application, so if you need portrait mode, you will most likely have to spend some time on revision. <br><a name="habracut"></a><br><br>  Let's go back to the fragmentation of the screens. <br>  To solve the problem of fragmentation, the application needs to take into account: <br><ul><li>  Different screen sizes </li><li>  Different permissions </li><li>  Different proportions </li></ul><br>  In order to solve all these three tasks in one fell swoop, Corona SDK or Gideros suggest choosing the scaling policy of the entire application.  The most adequate of these modes is the so-called letterbox.  This is when the application is uniformly scaled to fit the screen, but there are black bars along the edges in case of a mismatch of proportions. <br>  In MOAI, as such, there is no mode, but there are snapshots of how to implement this in a few lines by manipulating the viewport parameters. <br>  It is clear that such a half-measure cannot satisfy a really good application.  The screens of mobile devices are already small, so that even their area is eaten by black stripes. <br>  Obviously, we cannot do without an elastic layout (we solve the problem of dimensions / proportions). <br>  As for the different screen resolutions, this is easily solved by a set of different graphics or its scaling.  However, in Android / iOS, these mechanisms work in different ways, so you have to implement it yourself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Sprite graphics editor </h3><br>  A graphical editor was written using PyQt.  It is quite simple and can only manipulate sprites, I mean pictures. <br>  MOAI supports text display, but neither the graphics editor nor Terevaka can display it.  In practice, this means that if you need to apply text on top of the button, then you need to do it programmatically after the button sprite is loaded (or put the text directly on the button sprite, lol). <br>  Nevertheless, the graphic editor is a powerful tool, since it allows not only to place elements graphically, but also to separate the view from the program logic. <br>  The graphical editor stores the project file in a JSON file and exports the layer to the internal representation of Terevaka (Lua file) on the principle of one file - one layer. <br><br>  Layers are of two types: elastic and scalable. <br>  Elastic layer when displaying places elements depending on the sides of the binding.  Those.  If you want the element to follow the upper right corner when scaling, you need to specify the coordinates relative to this angle. <br>  Example layer in editor: <br><img src="https://habrastorage.org/storage2/e93/011/68f/e9301168fc7dce2c0c8a2fca2b63c1a1.png"><br>  Iphone 3.5 Inch: <br><img src="https://habrastorage.org/storage2/670/e53/001/670e5300144d8992b508f0c28b454f95.png"><br>  Iphone 4 inch: <br><img src="https://habrastorage.org/storage2/02c/41e/889/02c41e8897e53c12dea0985567bf3542.png"><br>  IPad: <br><img src="https://habrastorage.org/storage2/a3b/4b6/1da/a3b4b61da7d2545bf291953f0da4ac76.png"><br><br>  A scalable layer is a different type of layer that scales proportionally, like letterbox.  For example, the main menu makes sense to do it with the help of a scalable layer, but the background, however, is better done on the whole screen. <br>  Example layer in editor: <br><img src="https://habrastorage.org/storage2/076/596/040/07659604058831bde0556ea48d932752.png"><br>  Iphone 3.5 Inch: <br><img src="https://habrastorage.org/storage2/787/242/5b7/7872425b7b4ff7a9a223cbb14bd94bf6.png"><br>  Iphone 4 Inch: <br><img src="https://habrastorage.org/storage2/591/beb/280/591beb2801fe373ca16010425ee1ba03.png"><br>  IPad: <br><img src="https://habrastorage.org/storage2/b62/4ba/47b/b624ba47ba5a46040a43da9c73e16b93.png"><br>  In the editor, the proportions of the scalable layer are fixed 427x320.  These are the proportions of the iPad, reduced to the size of the iphone.  You can choose more convenient parameters for yourself, but you need to remember about the resolution of the graphics that will be used in the designer and directly in the application.  For myself, I use 853x640 (I need to change the parameter directly in the source code of the graphical editor) and upload retina to the editor.  In the application itself, as a rule, I use even higher resolution textures so that the graphics match the large retina screens, and during the layer loading I specify the dpiMultiplier parameter so that the sprites load in the right size. <br>  The reason why I use hard-coded 427x320 portions is that it's easy to get confused with sizes / resolutions, so who understands what's what, will figure out how to adapt it for your own case. <br><br>  So, combining approaches, you can quickly create flexible graphics. <br>  Files with layers are stored in the ./res/layout/ directory by analogy with Android. <br><br><h3>  Fragmentation of screen resolutions </h3><br>  Different screen resolutions are supported by a double set of graphics. <br>  A set of graphics with the usual resolution is stored in ./res/drawable-mdpi/, and the retina is stored in ./res/drawable-xhdpi/.  If the screen resolution does not match one of these, then the most suitable set will be taken and scaled.  Directories ./res/drawable-ldpi and ./res/drawable-hdpi are not yet supported by the engine. <br>  The important point is that when loading a layer, it is advisable to use packed sprites in one texture in order to optimize the amount of memory consumed.  The framework supports MOAI format, which can convert paid TexturePacker. <br>  Warning: do not use texture wrapping in TexturePacker with removal of empty areas, as there is a bug in the exporter in MOAI format and the graphics will eventually float. <br><br><h3>  miscellanea </h3><br>  To get a sprite from a layer, use the findPropById function (again, the analogy with Android) <br>  To handle clicking on the sprite, it is enough to attach a special callback (see an example in terevaka-samples). <br>  For other various usage examples, see the terevaka-samples project.  To run the example, copy tereavaka to the example folder, or better yet, make a symlink into it. <br>  To test the application under different screens, you do not need a lot of different devices at all - use launch profiles.  The finished profiles are in the directory ./terevaka/profiles. <br>  To run with a profile, use the moai ./terevaka/profiles/ipad.lua main.lua command, where ipad.lua is the ipad profile.  The profile is usually 3-4 lines, you can easily create your own profiles. <br>  Sprites for ui builder need to be saved in mdpi resolution. <br><br><h3>  Summary </h3><br>  Initially, the project began as the selection of some common code from the code of my new game.  In an attempt to structure, both the code itself and its requirements led to the emergence of the framework, and then, using my old ideas, and the graphic designer to it.  In addition, MOAI itself had to be refined, but thanks to the quick response of its developers, all changes have already been made to the main repository. <br>  Also - this is a demonstrative experience that you should not be afraid to write your libraries, if you clearly understand the requirements for them, and also if you write in the scripting language :) <br><br><h3>  Links </h3><br>  Terevaka: <a href="https://github.com/Nepherhotep/terevaka">github.com/Nepherhotep/terevaka</a> <br>  Samples: <a href="https://github.com/Nepherhotep/terevaka-samples">github.com/Nepherhotep/terevaka-samples</a> <br>  UI Builder: <a href="https://github.com/Nepherhotep/terevaka-ui-builder">github.com/Nepherhotep/terevaka-ui-builder</a> <br>  Official MOAI: <a href="https://github.com/moai/moai-dev">github.com/moai/moai-dev</a> <br>  My fork: <a href="https://github.com/Nepherhotep/moai-dev">github.com/Nepherhotep/moai-dev</a> </div><p>Source: <a href="https://habr.com/ru/post/176771/">https://habr.com/ru/post/176771/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176759/index.html">Small storage for small files</a></li>
<li><a href="../176763/index.html">Class methods in ruby</a></li>
<li><a href="../176765/index.html">A brief introduction to the MOAI Framework</a></li>
<li><a href="../176767/index.html">The Basics of Native Extension in Java for AIR</a></li>
<li><a href="../176769/index.html">Live broadcast: a practical course on the font. Lecture cycle. Lecture number 2</a></li>
<li><a href="../176775/index.html">The meaning and quality of life of the programmer</a></li>
<li><a href="../176779/index.html">Esboza - vector editor online & framework (Part Two)</a></li>
<li><a href="../176785/index.html">A simple client for tracking habr / freelance for OS X</a></li>
<li><a href="../176787/index.html">18-step gaussgan</a></li>
<li><a href="../176793/index.html">Notebook Stand. How it was</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>