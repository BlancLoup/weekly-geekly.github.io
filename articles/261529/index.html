<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to replace a homogeneous background with a transparent imagemagick</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It happens that pictures with a uniform background are uploaded to the site and there is a need to automatically replace it (background) with a transp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to replace a homogeneous background with a transparent imagemagick</h1><div class="post__text post__text-html js-mediator-article">  It happens that pictures with a uniform background are uploaded to the site and there is a need to automatically replace it (background) with a transparent one. <br><br>  Often this feature is needed for photos of products in the online store, pictures that are superimposed on the corporate background and other photos that do not spoil the design of the site.  Cutting each photo manually with Photoshop is pretty sad, but there are php methods with which you can ‚Äúput it on stream‚Äù. <br> <a href="http://habrahabr.ru/company/io/blog/261529/"><img src="https://habrastorage.org/getpro/habr/post_images/784/7dc/7a5/7847dc7a55de720a1f9dd8b5e2605fad.jpg" alt="image"></a> <br><a name="habracut"></a><br><h4>  How it works </h4><br>  The function searches pixel by pixel where the uniform color ends.  After all coordinates are calculated - the function simply cuts out everything that is outside. <br><br>  Replacing a white background with a transparent one is possible only if the output image is saved in <a href="https://onthe.io/learn%2B%25D0%259A%25D0%25B0%25D0%25BA%2B%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0%25D1%2582%25D1%258C%2B%25D1%2581%2BPNG">PNG</a> or <a href="https://onthe.io/learn%2B%25D0%259A%25D0%25B0%25D0%25BA%2B%25D0%25B8%25D1%2581%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258C%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2582%25D1%258C%2B%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%2BGIF">GIF</a> format.  New <a href="https://onthe.io/learn%2B%25D0%25A7%25D1%2582%25D0%25BE%2B%25D1%2582%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B5%2BWebP">WebP</a> and <a href="https://onthe.io/learn%2B%25D0%25A7%25D1%2582%25D0%25BE%2B%25D1%2582%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B5%2B%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%2BBPG">BPG</a> formats with transparency support will do. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/afb/935/520/afb935520f54a1792802bf26a0cbb2fa.jpg" alt="image"><br><br>  Before removing the background it is always better to resize the big picture.  If you do this after - the boundaries can be distorted. <br><br><h4>  Background replacement, example on bash </h4><br>  ImageMagick has a -trim operator to remove the background.  He cuts a picture by a given color: <br><br><pre><code class="bash hljs">convert image.jpg -quality 100 image.png convert image.png -fuzz 20% -fill white -draw <span class="hljs-string"><span class="hljs-string">"color 5,5 floodfill"</span></span> -quality 100 image.png convert image.png -transparent white image.png convert image.png -define convolve:scale=<span class="hljs-string"><span class="hljs-string">"100!,100%"</span></span> -morphology Convolve <span class="hljs-string"><span class="hljs-string">"Log:0x2"</span></span> image.png</code> </pre> <br>  Before cropping, standard JPEG is converted to PNG.  In <a href="https://onthe.io/learn%2B%25D0%25A1%25D0%25B6%25D0%25B0%25D1%2582%25D0%25B8%25D0%25B5%2B%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D0%25B8%25D0%25BD%25D0%25BE%25D0%25BA%2B%25D1%2581%2B%25D0%25BF%25D0%25BE%25D1%2582%25D0%25B5%25D1%2580%25D1%258F%25D0%25BC%25D0%25B8%2B%25D0%25B8%2B%25D0%25B1%25D0%25B5%25D0%25B7">lossy</a> jpeg the background will not be uniform.  Neighboring pixels are usually slightly different in color.  For example: white, light gray, light blue.  The fuzz argument is set to&gt; 0 to allow functions to consider adjacent colors the same. <br><br><h4>  Background replacement, PHP example </h4><br>  An example of cropping a white background in the picture (input file: image.jpg, output - trimmed.png): <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(<span class="hljs-string"><span class="hljs-string">'image.jpg'</span></span>); $type=pathinfo(<span class="hljs-string"><span class="hljs-string">'image.jpg'</span></span>, PATHINFO_EXTENSION); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($type==<span class="hljs-string"><span class="hljs-string">'jpg'</span></span>) { $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); } $image-&gt;borderImage(<span class="hljs-string"><span class="hljs-string">'#ffffff'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $image-&gt;trimImage(<span class="hljs-number"><span class="hljs-number">0</span></span>); $image-&gt;setImagePage(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); $image-&gt;writeImage(<span class="hljs-string"><span class="hljs-string">'trimmed.png'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  The borderImage operator draws a 1x1 frame around the picture in the background color, after which the trimImage operator cuts it along with the frame. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e3/0d5/d18/4e30d5d1813f9e4417e8118e61bbaa30.jpg" alt="image"><br><br>  Attention!  The trimImage operator works if Imagick is compiled with <a href="https://onthe.io/learn%2B10%2B%25D0%25BA%25D0%25BB%25D1%258E%25D1%2587%25D0%25B5%25D0%25B2%25D1%258B%25D1%2585%2B%25D1%2584%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B9%2BImageMagick">ImageMagick</a> version 6.2.9 or later. <br><br><h4>  How to make the background uniform </h4><br>  In a similar way, you can replace a non-uniform background with a homogeneous background when converting from <a href="https://onthe.io/learn%2B10%2B%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B8%25D0%25BB%2B%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D1%258B%2B%25D1%2581%2BJPEG">JPEG</a> to PNG: <br><br><pre> <code class="php hljs">convert image.jpg -fill none -fuzz <span class="hljs-number"><span class="hljs-number">1</span></span>% -draw <span class="hljs-string"><span class="hljs-string">'matte 0,0 floodfill'</span></span> -flop -draw <span class="hljs-string"><span class="hljs-string">'matte 0,0 floodfill'</span></span> -flop image.png</code> </pre><br>  In this example, each pixel of the background will be filled with one color ‚Äî a pixel with coordinates (0; 0). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/868/e9b/1c4/868e9b1c44507b45b8b581a055ae4025.jpg" alt="image"><br><h4>  Many code examples </h4><br>  How background cropping works using the Imagick library can be checked <a href="http://i.onthe.io/remove_image_background">here</a> .  The online tool replaces any uniform background with a transparent one, as with this <a href="http://i.onthe.io/remove_image_background%3Fr%3Dccde14f1f514ac240abe6a674eb972b5">apple</a> .  Here is <a href="http://i.onthe.io/remove_image_background%3Fr%3D365d9c5b6e374a103662316fff46e2a1">an example</a> with a black background and complex shapes for trim (hair).  Of course, there may be a small <a href="http://i.onthe.io/remove_image_background%3Fr%3D72804f90be6102db1b0897ae632567e2">white frame</a> .  But <a href="http://i.onthe.io/remove_image_background%3Fr%3Df2a849f975e179d9a2250abdb6a681a9">it looks</a> pretty decent.  Even the <a href="http://i.onthe.io/remove_image_background%3Fr%3D92722105859b66cc45b87c3c83c1dee9">cat's mustache</a> cuts out with a bang. <br><br><h4>  Abstract </h4><br><ol><li>  You can use the operator to remove the plain background from the image. <br>  -trim or the trimImage command. </li><li>  You can check how background removal works with Imagick <a href="http://i.onthe.io/remove_image_background">here</a> . </li><li>  The output image must be saved in any of the formats with transparency support: PNG, GIF, WebP, BPG. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/261529/">https://habr.com/ru/post/261529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261517/index.html">Does XMPP suck?</a></li>
<li><a href="../261519/index.html">Acronis Backup Russia - First Look</a></li>
<li><a href="../261521/index.html">Setting tasks and calculating labor costs for the development of documentation in an IT company</a></li>
<li><a href="../261525/index.html">How to control response time or how fast your website loads?</a></li>
<li><a href="../261527/index.html">Mobile app design: why we work in @ 1x</a></li>
<li><a href="../261531/index.html">Push notifications via Telegram</a></li>
<li><a href="../261533/index.html">Implementing the infrastructure of the Internet of things for a smart office - the experience of Microsoft Technology Center</a></li>
<li><a href="../261535/index.html">Automatic reorganization of arrays in the memory of the graphics accelerator</a></li>
<li><a href="../261537/index.html">Manage dependencies in iOS applications correctly: Typhoon modularity</a></li>
<li><a href="../261539/index.html">Alt key for mouse gestures, as well as various important fixes in Vivaldi 1.0.212.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>