<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Three-storey C ++ templates in the implementation of an embedded asynchronous HTTP server with a human face</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our team specializes in C ++ projects. And from time to time we had to create HTTP entry points to C ++ components. What used different tools. There w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Three-storey C ++ templates in the implementation of an embedded asynchronous HTTP server with a human face</h1><div class="post__text post__text-html js-mediator-article">  Our team specializes in C ++ projects.  And from time to time we had to create HTTP entry points to C ++ components.  What used different tools.  There were good old CGIs and various embedded libraries, both third-party and self-written.  It all worked, but there was always the feeling that such things should be made simpler, and faster, and more productive. <br><br>  As a result, we decided that it was time to stop looking around and we had to try to do something of our own, with <s>preference and courtesans</s> cross-platform, asynchronous, performance and human attitude towards the end user.  As a result, we have a small C ++ 14 <a href="">RESTinio</a> library that allows you to run an HTTP server inside a C ++ application with just a few lines of code.  Here, for example, the simplest server that answers ‚ÄúHello, World‚Äù to all requests: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;restinio/all.hpp&gt; int main() { restinio::run( restinio::on_this_thread() .port(8080) .address("localhost") .request_handler([](auto req) { return req-&gt;create_response().set_body("Hello, World!").done(); })); return 0; }</span></span></span></span></code> </pre> <br>  In the RESTinio implementation, C ++ templates are actively used, and I would like to talk a bit today. <br><a name="habracut"></a><br><h1>  Literally a couple of common words about RESTinio </h1><br>  RESTinio is a small OpenSource project that is distributed under the BSD-3-CLAUSE license.  RESTinio has been actively developing since the spring of 2017.  During this time, we have made several public releases, gradually filling RESTinio with functionality.  The most recent release took place today.  This is a release of version 0.4, in which we, perhaps, realized the minimum of functionality that we wanted to have. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      RESTinio uses several third-party components.  To work with the network, we use Asio (standalone version of Asio), for parsing the HTTP protocol, we use http-parser from Node.js.  Also inside is used fmtlib, and for testing - the library Catch2. <br><br>  Despite the fact that RESTinio has not yet reached version 1.0, we are very careful about the quality and stability of RESTinio.  For example, our colleague participated <a href="https://habrahabr.ru/company/mailru/blog/335384/">in the Mail.ru-shnom HighloadCup contest</a> with a solution based on RESTinio.  This decision reached the final from the 45th place and took 44th place in the final.  I can be mistaken, but among the finalists there were only two or three solutions that were built on the basis of universal HTTP frameworks.  One of them was exactly the <a href="https://bitbucket.org/ngrodzitski/highloadcup2017">solution based on RESTinio</a> . <br><br>  In general, if we talk about performance, the speed of RESTinio was not the number one priority in development.  Although we paid attention to performance, it was nonetheless more important for us to get a solution that is convenient to use.  At the same time, <a href="https://bitbucket.org/sobjectizerteam/restinio-benchmark">RESTinio doesn't look so bad in synthetic benchmarks</a> . <br><br>  However, in this article I would like to talk not so much about the RESTinio library itself and its capabilities (for more information, see this information <a href="">here</a> ).  How much about how such an important feature of the C ++ language is used in its implementation, as templates. <br><br><h1>  Why templates? </h1><br>  RESTinio code is built on templates.  So, in the example shown above, templates are not visible, although they are everywhere there: <br><br><ul><li>  restinio :: run () function; </li><li>  the restinio :: on_this_thread () function is template; </li><li>  the request_handler () method is also template; </li><li>  and even the create_response () method is template. </li></ul><br>  Why is RESTinio so actively using templates?  Probably the most serious were the following two reasons: <br><br>  First, we wanted RESTinio to customize widely.  But so that customization has a minimal cost at run-time.  It seems to us that the templates are simply out of competition. <br><br>  Secondly, some of us, apparently, were bitten by Alexandrescu strongly.  And it still affects, although a lot has passed since then. <br><br>  Well, we also liked the consequence of the fact that a good part of RESTinio is sample code: the library turned out to be header-only.  It just so happens that in the current C ++ it is much easier to connect the header-only library to your (or to someone else's) project than the one you need to compile.  Taki zoo assembly systems and dependency management systems in C ++ delivers.  And the header-only libraries in these zoos feel much better.  Even if you have to pay for this increase in compile time, but this is a topic for a completely different conversation ... <br><br><h2>  Customization on templates in simple examples </h2><br>  Above, we said that templates allow customizing RESTinio.  Let's show what is meant by this on a couple-three simple examples. <br><br><h3>  Give the answer in chunked encoding mode </h3><br>  As mentioned above, the create_response () method is a template.  This method is parameterized by the method of forming the HTTP response.  The default is restinio_controlled_output_t.  This method independently calculates the value of the HTTP Content-Length header and initiates writing the response to the socket after the programmer has completely created the entire response and calls the done () method. <br><br>  But RESTinio supports several more methods: user_controlled_output_t and chunked_output_t.  For example, using chunked_output_t mode would look something like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> handler = [&amp;](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> resp = req-&gt;create_response&lt;restinio::<span class="hljs-keyword"><span class="hljs-keyword">chunked_output_t</span></span>&gt;(); resp .append_header(restinio::http_field::server, <span class="hljs-string"><span class="hljs-string">"MyApp Embedded Server"</span></span>) .append_header_date_field() .append_header(restinio::http_field::content_type, <span class="hljs-string"><span class="hljs-string">"text/plain; charset=utf-8"</span></span>); resp.flush(); <span class="hljs-comment"><span class="hljs-comment">//   . for(const auto &amp; part : fragments) { resp.append_chunk(make_chunk_from(part)); resp.flush(); //    . } return resp.done(); //  . };</span></span></code> </pre> <br>  It is noteworthy that create_response () returns a response_builder_t &lt;Output_Type&gt; object, whose public API depends on Output_Type.  So, response_builder_t &lt;restinio_controlled_output_t&gt; does not have a public flush () method, and only response_builder_t &lt;user_controlled_output_t&gt; has a public set_content_length () method. <br><br><h3>  Turn on logging </h3><br>  At the very beginning of the article, we showed the simplest single-threaded HTTP server.  Which works as a ‚Äúblack box‚Äù, without any debug seals or diagnostic logging.  Let's make it so that the HTTP server that is started logs all actions that occur to it to the standard output stream.  To do this, we need a little trick with the templates: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;restinio/all.hpp&gt; int main() { struct my_traits : public restinio::default_single_thread_traits_t { using logger_t = restinio::single_threaded_ostream_logger_t; }; restinio::run( restinio::on_this_thread&lt;my_traits&gt;() .port(8080) .address("localhost") .request_handler([](auto req) { return req-&gt;create_response().set_body("Hello, World!").done(); })); return 0; }</span></span></span></span></code> </pre> <br>  What did we do here? <br><br>  We defined our own property class (traits) for the HTTP server, in which we set the type of logger we need.  Then they forced RESTinio to use this property class when constructing an HTTP server inside restinio :: run ().  As a result, an HTTP server is created inside restino :: run (), which logs all events through a logger, which is implemented by the single_threaded_ostream_logger_t type. <br><br>  If we run a modified example and issue a simple request to our server (like wget localhost: 8080), we will see something like this: <br><br><pre> <code class="hljs pgsql">[<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">29.612</span></span>] TRACE: starting <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">29.612</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: init accept #<span class="hljs-number"><span class="hljs-number">0</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">29.612</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> started <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: accept <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">45930</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> socket #<span class="hljs-number"><span class="hljs-number">0</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">45930</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> request [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> reading request [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] received <span class="hljs-number"><span class="hljs-number">141</span></span> bytes [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] request received (#<span class="hljs-number"><span class="hljs-number">0</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> / [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] append response (#<span class="hljs-number"><span class="hljs-number">0</span></span>), flags: { final_parts, connection_keepalive }, bufs count: <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] sending resp data, buf count: <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> request [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> reading request [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] outgoing data was sent: <span class="hljs-number"><span class="hljs-number">76</span></span> bytes [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] should keep alive [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> request [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.423</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> reading request [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.424</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] EOF <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> request, <span class="hljs-keyword"><span class="hljs-keyword">close</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.424</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">close</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00.424</span></span>] TRACE: [<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] destructor <span class="hljs-keyword"><span class="hljs-keyword">called</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">16.402</span></span>] TRACE: closing <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> [<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">16.402</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> closed <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span></code> </pre><br>  What have we done?  In fact, we corrected one parameter in the HTTP server properties and got additional functionality.  Which was not at all in the first case, when we used the default properties for the HTTP server.  Moreover, by ‚Äúgenerally‚Äù we understand precisely ‚Äúin general‚Äù.  Let's explain with an example. <br><br>  In the RESTinio code, logging of server operations is scattered.  Here, say: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ep = m_acceptor.local_endpoint(); m_logger.trace( [&amp;]{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt::format( <span class="hljs-string"><span class="hljs-string">"closing server on {}"</span></span>, ep ); } ); m_acceptor.close(); m_logger.info( [&amp;]{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt::format( <span class="hljs-string"><span class="hljs-string">"server closed on {}"</span></span>, ep ); } ); }</code> </pre> <br>  There is a call to the logger with the transfer of the lambda function, which is responsible for the formation of a message for the log.  But if restinio :: null_logger_t is used as a logger (and this is the default), then trace (), info () and the like do nothing in null_logger_t: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null_logger_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Message_Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Message_Builder &amp;&amp; )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Message_Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Message_Builder &amp;&amp; )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Message_Builder &gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">warn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Message_Builder &amp;&amp; )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{} ...</code> </pre> <br>  Therefore, the normal compiler simply throws out all calls to the logger and does not generate any code for logging.  "Do not use - do not pay" in its pure form. <br><br><h3>  Choose regex-engine for express-router </h3><br>  We will demonstrate another example of customization through templates using an express router, which is in RESTinio.  Express router is made in RESTinio based on JavaScript framework <a href="https://expressjs.com/">Express</a> .  Using an express router greatly simplifies working with URLs to select the appropriate handler.  Especially when inside the URL, the handler needs the parameters. <br><br>  Here is a small example that shows how, by means of an express router, to hang up handlers for GET requests of the form / measure /: id and / measures /: year /: month /: day: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;restinio/all.hpp&gt; using my_router_t = restinio::router::express_router_t&lt;&gt;; auto make_request_handler() { auto router = std::make_unique&lt;my_router_t&gt;(); router-&gt;http_get(R"(/measure/:id(\d+))", [](auto req, auto params) { return req-&gt;create_response() .set_body( fmt::format("Measure with id={} requested", restinio::cast_to&lt;unsigned long&gt;(params["id"]))) .done(); }); router-&gt;http_get(R"(/measures/:year(\d{4})/:month(\d{2})/:day(\d{2}))", [](auto req, auto params) { return req-&gt;create_response() .set_body( fmt::format("Request measures for a date: {}.{}.{}", restinio::cast_to&lt;int&gt;(params["year"]), restinio::cast_to&lt;short&gt;(params["month"]), restinio::cast_to&lt;short&gt;(params["day"]))) .done(); }); router-&gt;non_matched_request_handler([](auto req) { return req-&gt;create_response(404, "Unknown request") .connection_close() .done(); }); return router; } int main() { struct my_traits : public restinio::default_single_thread_traits_t { using request_handler_t = my_router_t; }; restinio::run( restinio::on_this_thread&lt;my_traits&gt;() .port(8080) .address("localhost") .request_handler(make_request_handler())); return 0; }</span></span></span></span></code> </pre> <br>  In order to parse URLs from requests, the express router needs some kind of regular expression implementation.  The default is std :: regex, but std :: regex, at the moment, unfortunately, cannot boast of excellent performance.  For example, PCRE / PCRE2 is much faster than std :: regex. <br><br>  Therefore, in RESTinio, you can specify a different regular expression implementation for express_router_t.  Ask how?  Correct: through the template parameter.  For example, to use PCRE2 instead of std :: regex: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;restinio/all.hpp&gt; #include &lt;restinio/router/pcre2_regex_engine.hpp&gt; using my_router_t = restinio::router::express_router_t&lt; restinio::router::pcre2_regex_engine_t&lt;&gt;&gt;;</span></span></span></span></code> </pre> <br>  And the attentive reader may notice that pcre2_regex_engine_t is also a template.  This time pcre2_regex_engine_t is content with default parameters.  But we can fix it easily ... <br><br>  pcre2_regex_engine_t is parametrized by its own class of properties specific for PCRE2.  At the moment, in the properties for pcre2_regex_engine_t, you can set parameters such as options for compiling a regular expression, options for pcre2_match, as well as an important parameter such as max_capture_groups.  This parameter defines the maximum number of fragments extracted from a string.  By default, max_capture_groups is 20, which means that pcre2_regex_engine_t will immediately allocate space for 20 fragments.  In our case, this is too much, because  The maximum number of elements in lines with a URL for our short example is three.  Let's make the settings specific to our particular case: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;restinio/all.hpp&gt; #include &lt;restinio/router/pcre2_regex_engine.hpp&gt; struct my_pcre2_traits : public restinio::router::pcre2_traits_t&lt;&gt; { static constexpr int max_capture_groups = 4; // +1     URL. }; using my_router_t = restinio::router::express_router_t&lt; restinio::router::pcre2_regex_engine_t&lt;my_pcre2_traits&gt;&gt;;</span></span></span></span></code> </pre> <br><br><h1>  And about Traits </h1><br>  We have already shown examples of using property classes (i.e. traits) to control the behavior of certain entities.  But in general, Traits define all the behavior of an HTTP server in RESTinio.  For under the hood, the restinio :: run () functions shown above hide the creation of an instance of the restinio :: http_server_t template class.  And the Traits template parameter just determines the parameters of the HTTP server. <br><br>  If you look at the large top, then the following type names must be defined in Traits: <br><br>  <b>timer_manager_t</b> .  Defines the type that the HTTP server will use to count timeouts related to server connections.  In RESTinio, the default is asio_timer_manager_t, which uses the standard Asio timers mechanism.  There is also so_timer_manager_t, which uses the <a href="https://habrahabr.ru/post/304386/">SObjectizer</a> timers mechanism.  There is also null_timer_manager_t, which does nothing at all and which is useful for benchmarking. <br><br>  <b>logger_t</b> .  Defines the logging mechanism for the internal HTTP server activity.  The default is null_logger_t, i.e.  by default, the HTTP server does not log anything.  There is a regular implementation of a very simple ostream_logger_t logger, useful for debugging. <br><br>  <b>request_handler_t</b> .  Specifies the type of HTTP request handler.  The default is default_request_handler_t, which is just std :: function &lt;request_handling_status_t (request_handle_t)&gt;.  But the user can specify another type if this type provides operator () with the required signature.  For example, the express router discussed above defines its own type of request handler, which must be specified as request_handler_t in the HTTP Traits server. <br><br>  <b>strand_t</b> .  Specifies the type of so-called.  strand to protect Asio shnyh offal when working in multithreaded mode.  The default is asio :: strand &lt;asio :: executor&gt;, which allows you to safely start the HTTP server on several working threads at once.  For example: <br><br><pre> <code class="cpp hljs">restinio::run( restinio::on_thread_pool(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread::hardware_concurrency()) .port(<span class="hljs-number"><span class="hljs-number">8080</span></span>) .address(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>) .request_handler(make_request_handler()));</code> </pre> <br>  If the HTTP server runs in single-threaded mode, you can avoid additional overhead by defining Traits :: strand_t as restinio :: noop_strand_t (which is done in restinio :: default_single_thread_traits_t). <br><br>  <b>stream_socket_t</b> .  Specifies the type of socket with which RESTinio will work.  The default is asio :: ip :: tcp :: socket.  But to work with HTTPS, this parameter must be specified as restinio :: tls_socket_t. <br><br>  In general, even in its core, the central class of the http_server_t, RESTinio uses policy based design on C ++ templates.  It is therefore not surprising that the echoes of this approach are also found in many other parts of RESTinio. <br><br><h1>  Well, what is the three-story without CRTP? </h1><br>  The title of the article mentions three-story patterns, but so far it has been a question of how widely patterns are used in RESTinio.  Examples of the same three-story has not yet been.  Need to eliminate this omission;) <br><br>  There is such a tricky thing in C ++ as <a href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">CRTP (which stands for Curiously recurring template pattern)</a> .  Here with the help of this thing in RESTinio work with server parameters is implemented. <br><br>  Before you start the HTTP server, it needs to set several required parameters (+ you can still set several optional parameters).  For example, in this example, the port and the address that the HTTP server should listen to, the request handler, as well as timeouts for various operations are set: <br><br><pre> <code class="cpp hljs">restinio::run( restinio::on_this_thread() .port(<span class="hljs-number"><span class="hljs-number">8080</span></span>) .address(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>) .request_handler(server_handler()) .read_next_http_message_timelimit(<span class="hljs-number"><span class="hljs-number">10</span></span>s) .write_http_response_timelimit(<span class="hljs-number"><span class="hljs-number">1</span></span>s) .handle_request_timeout(<span class="hljs-number"><span class="hljs-number">1</span></span>s));</code> </pre> <br>  In fact, there is nothing particularly complicated here: the on_this_thread function constructs and returns a server_settings object, which is then further modified by calling setter methods. <br><br>  However, saying ‚Äúthere is nothing particularly difficult‚Äù we are a little cunning, since on_this_thread returns an instance of this type: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Traits&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_on_this_thread_settings_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">basic_server_settings_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">run_on_this_thread_settings_t</span></span>&lt;Traits&gt;, Traits&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base_type_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">basic_server_settings_t</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">run_on_this_thread_settings_t</span></span>&lt;Traits&gt;, Traits&gt;; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base_type_t</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">base_type_t</span></span>; };</code> </pre> <br>  Those.  we are already seeing CRTP ears.  But it is even more interesting to look into the definition of basic_server_settings_t: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Derived, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Traits&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">basic_server_settings_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">socket_type_dependent_settings_t</span></span>&lt;Derived, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Traits::<span class="hljs-keyword"><span class="hljs-keyword">stream_socket_t</span></span>&gt; { ... };</code> </pre> <br>  Here you can see another template that is used as the base type.  By itself, it does not represent anything interesting: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Settings, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Socket&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">socket_type_dependent_settings_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> : ~<span class="hljs-keyword"><span class="hljs-keyword">socket_type_dependent_settings_t</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; };</code> </pre> <br>  But it can be specialized for various combinations of Settings and Socket.  For example, to support TLS: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Settings&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">socket_type_dependent_settings_t</span></span></span><span class="hljs-class">&lt;Settings, tls_socket_t&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: ~<span class="hljs-keyword"><span class="hljs-keyword">socket_type_dependent_settings_t</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">socket_type_dependent_settings_t</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">socket_type_dependent_settings_t</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">socket_type_dependent_settings_t</span></span> &amp;&amp; ) = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-function">Settings &amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tls_context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(asio::ssl::context context )</span></span></span><span class="hljs-function"> &amp; </span></span>{...} <span class="hljs-function"><span class="hljs-function">Settings &amp;&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tls_context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(asio::ssl::context context )</span></span></span><span class="hljs-function"> &amp;&amp; </span></span>{...} asio::ssl::<span class="hljs-function"><span class="hljs-function">context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tls_context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{...} ... };</code> </pre> <br>  And if all this is put together, for example, in this situation: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">my_pcre2_traits</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> restinio::router::<span class="hljs-keyword"><span class="hljs-keyword">pcre2_traits_t</span></span>&lt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> max_capture_groups = <span class="hljs-number"><span class="hljs-number">4</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">my_router_t</span></span> = restinio::router::<span class="hljs-keyword"><span class="hljs-keyword">express_router_t</span></span>&lt; restinio::router::<span class="hljs-keyword"><span class="hljs-keyword">pcre2_regex_engine_t</span></span>&lt;my_pcre2_traits&gt;&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">my_traits_t</span></span> = restinio::<span class="hljs-keyword"><span class="hljs-keyword">single_thread_tls_traits_t</span></span>&lt; restinio::<span class="hljs-keyword"><span class="hljs-keyword">asio_timer_manager_t</span></span>, restinio::<span class="hljs-keyword"><span class="hljs-keyword">single_threaded_ostream_logger_t</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">my_router_t</span></span>&gt;; ... restinio::run( restinio::on_this_thread&lt;<span class="hljs-keyword"><span class="hljs-keyword">my_traits_t</span></span>&gt;() .address(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>) .request_handler(server_handler()) .read_next_http_message_timelimit(<span class="hljs-number"><span class="hljs-number">10</span></span>s) .write_http_response_timelimit(<span class="hljs-number"><span class="hljs-number">1</span></span>s) .handle_request_timeout(<span class="hljs-number"><span class="hljs-number">1</span></span>s) .tls_context(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(tls_context)));</code> </pre> <br>  Then there is certainly a template sitting on a template and a template chasing.  What becomes especially well noticeable in the compiler error messages, if you accidentally grieve somewhere ... <br><br><h1>  Conclusion </h1><br>  We can hardly be mistaken if we say that the attitude towards C ++ templates among practitioners of C ++ programmers is very different: someone uses templates everywhere, someone from time to time, someone categorically against.  An even more ambiguous attitude towards C ++ templates from the regulars of relevant forums / resources, especially among those who do not develop C ++ professionally, but has an opinion.  Therefore, surely many who read the article will have a question: ‚ÄúWas it worth it?‚Äù <br><br>  In our opinion, yes.  Although, for example, we are not greatly confused by the time for compiling C ++ code.  By the way, compiling RESTinio + Asio has quite a normal speed.  This is when Catch2 is added to this, then yes, the compile time increases significantly.  And we are not afraid of error messages from the C ++ compiler, especially since from year to year these same messages become more and more sane. <br><br>  In any case, C ++ is programmed very differently.  And everyone can use the style that suits him best.  Starting from wrappers over purely shared libraries (like <a href="https://github.com/cesanta/mongoose/">mongoose</a> or <a href="https://github.com/civetweb/civetweb">civetweb</a> ) or C ++ libraries written in a Java-like ‚ÄúC with classes‚Äù (as it happens, say, in <a href="https://pocoproject.org/">POCO</a> ).  And ending actively using C ++ templates <a href="https://github.com/ipkn/crow">CROW</a> , <a href="http://www.boost.org/doc/libs/1_66_0/libs/beast/doc/html/index.html">Boost.Beast</a> and <a href="">RESTinio</a> . <br><br>  We generally hold the opinion that in the modern world, if there are such competitors as Rust, Go, D and, not to mention C # and Java, C ++ doesn‚Äôt have too many serious and objective advantages.  And C ++ templates are perhaps one of the few competitive advantages of C ++ that can justify the use of C ++ in a specific application.  And if so, then what's the point of abandoning C ++ templates or limiting yourself to using them?  We do not see such a meaning, therefore, we will use patterns in the implementation of RESTinio as actively as common sense allows us (well, or its absence, here which side to look at). </div><p>Source: <a href="https://habr.com/ru/post/345788/">https://habr.com/ru/post/345788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345776/index.html">Keyboard Response Comparison</a></li>
<li><a href="../345778/index.html">Pygest # 21. Releases, articles, interesting projects, packages and libraries from the world of Python [January 1, 2018 - January 17, 2018]</a></li>
<li><a href="../345780/index.html">Kubernetes success stories in production. Part 6: BlaBlaCar</a></li>
<li><a href="../345784/index.html">Overview of rounding implementations in Go</a></li>
<li><a href="../345786/index.html">Blog RuVDS. Digest of posts and our results of the year</a></li>
<li><a href="../345790/index.html">In memory of 2017: the best posts in our blog for the year</a></li>
<li><a href="../345792/index.html">Frontend 2017: the most important</a></li>
<li><a href="../345794/index.html">The whole truth about the new office "Informzaschity", and How we survived the move</a></li>
<li><a href="../345800/index.html">Wonderful Premine in DAG cryptocurrency</a></li>
<li><a href="../345802/index.html">Simple PHP Task Scheduler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>