<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tricky quaternions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guess the riddle: sits in four dimensions and turns up complex numbers? 

 Hint: This is a vector with a scalar. And the real matrix. And he came up w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tricky quaternions</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b89/38d/627/b8938d6271dde9f633d24a04c1eeec86.jpg"><br><br>  Guess the riddle: sits in four dimensions and turns up complex numbers? <br><br>  Hint: This is a vector with a scalar.  And the real matrix.  And he came up with Hamilton. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Did not help?  Well, you, it's elementary!  This is a quaternion!  Quaternions are used to record rotations in robotics, game engines, modeling software, and in general everywhere where problems with Euler angles or matrices are not needed.  If you are frightened by the confusion above with different views of the quaternion, then you can be calm.  Quaternions are very easy to use and their internal structure may be needed only in very rare cases where fine optimization is needed.  The rest of the time, using quaternions, you can turn anything and anything, and it will interpolate smoothly and beautifully without <a href="http://habrahabr.ru/post/183116/">hinged locks</a> . <br><a name="habracut"></a><br>  What is a quaternion?  It is easiest to understand it if it is divided into two parts: a vector and rotation around it.  Imagine that you are inside a sphere.  You can reach out and touch the inside of the sphere.  This will be a vector.  Now, if you rotate the sphere by rotating the brush, you will get the second component of the quaternion.  Quaternion is the final rotation, which is obtained from the initial position. <br><br>  Quaternion has a cunning internal structure.  It can be written with the help of four numbers: x, y, z for the vector and w for the rotation.  The difficulty lies in the fact that in addition to them there are still three imaginary units, such that: i <sup>2</sup> = j <sup>2</sup> = k <sup>2</sup> = ijk = ‚àí1.  The whole entry looks like this: q = w + x * i + y * j + z * k <br><br>  Because of the units, the addition-multiplication of quaternions by hand is rather dreary, but, fortunately, they are not particularly important in programming.  All operations are usually performed on quaternions as a whole, and only those four numbers are rarely used.  In addition, many libraries have special constructors that allow you to get quaternion from more understandable structures, for example, <a href="http://docs.unity3d.com/Documentation/ScriptReference/Quaternion.Euler.html">Quaternion.Euler</a> in Unity3d or <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.quaternion.createfromyawpitchroll.aspx">Quaternion.CreateFromYawPitchRoll</a> in XNA. <br><br>  In working with quaternions, they most often have to multiply them.  This is a very useful operation, since multiplying one quaternion by another results in the first rotation, turned on the second.  It is important to remember that multiplication of quaternions is noncommutative, which means that the order of the operands is important.  That is, q <sub>1</sub> * q <sub>2</sub> is not the same as q <sub>2</sub> * q <sub>1</sub> .  In the picture below you can see the difference.  Left: Quaternion.Euler (60, 0, 60) * Quaternion.Euler (0, 60, 0), right: Quaternion.Euler (0, 60, 0) * Quaternion.Euler (60, 0, 60).  The colored lines show the paths of the local axes of each airplane. <br><br><img src="https://habrastorage.org/storage2/243/3fe/a70/2433fea70baecfc8db74951e5e25a75d.png"><br><br>  In practice, working with quaternions looks like this: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rightTurn = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     car.rotation = car.rotation*rightTurn; // </span></span></code> </pre> <br>  In the example above, the car type is turning to the right in local coordinates.  If the car travels on an inclined plane, or even upside down, then it will still correctly turn to the right place.  The rightTurn variable can be used any number of times, like this, for example, a 360-degree rotation looks like: <br><br><pre> <code class="cs hljs">car.rotation = car.rotation*rightTurn*rightTurn*rightTurn*rightTurn;</code> </pre><br>  By default, the quaternion uses global coordinate axes to count the rotation.  When one quaternion is multiplied by another quaternion, then for the second quaternion the first quaternion becomes the reference point. <br><br>  If you suddenly wanted to model the movement on a variety of convex surfaces like in Super Mario Galaxy using Euler angles, then you would have to puzzle for a long time.  This is because they were invented to indicate the specific orientation of the object in space, and not for animation.  With quaternions, everything is much simpler, and they interpolate remarkably along the shortest paths, while Euler angles start to wriggle because of the hierarchy of turns and often get stuck in the hinged lock, about which I wrote <a href="http://habrahabr.ru/post/183116/">in this article</a> .  On the animation below you can see how much their spherical interpolation differs.  Quaternions on the left, Euler angles on the right. <br><br><img src="https://habrastorage.org/storage2/bb8/eb5/ea1/bb8eb5ea12f085a8f065281ee222a4a4.gif"><br><br>  If you are still interested in how quaternions look inside, then you can look at the table below. <br><table><tbody><tr><th>  w </th><th>  x </th><th>  y </th><th>  z </th><th>  Rotation </th></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  no rotation </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  180 ¬∞ around the x axis </td></tr><tr><td>  sqrt (0.5) </td><td>  sqrt (0.5) </td><td>  0 </td><td>  0 </td><td>  90 ¬∞ around the x axis </td></tr><tr><td>  sqrt (0.5) </td><td>  -sqrt (0.5) </td><td>  0 </td><td>  0 </td><td>  -90 ¬∞ around the x-axis </td></tr></tbody></table><br>  The values ‚Äã‚Äãin the table are obtained from the following formula: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">w, x, y, z</span></span>] = [cos(alpha/<span class="hljs-number"><span class="hljs-number">2</span></span>), sin(alpha/<span class="hljs-number"><span class="hljs-number">2</span></span>)*vx, sin(alpha/<span class="hljs-number"><span class="hljs-number">2</span></span>)*vy, sin(alpha/<span class="hljs-number"><span class="hljs-number">2</span></span>)*vz]</code> </pre><br>  Where <i>alpha</i> is the angle of rotation, and <i>vx, vy, vz</i> is the vector of the axis of rotation. <br><br>  The result of the addition of quaternions is an intermediate rotation.  The addition of quaternions is elementary, it is enough just to add their components.  Take, for example, q <sub>1</sub> = 1 + 0i + 0j + 0k (zero rotation from the table above) and q <sub>2</sub> = 0 + 1i + 0j + 0k (180 ¬∞ around the X axis).  Their sum is q <sub>3</sub> = 1 + 1i + 0j + 0k, that is, 90 ¬∞ around the X axis. Unfortunately, in Unity3d the addition operator is not implemented for quaternions. <br><br>  If you want to learn more about quaternions, then I advise you to start with the <a href="http://en.wikipedia.org/wiki/Quaternion">English Wikipedia</a> .  You can also delve into <a href="http://www.wolframalpha.com/input/%3Fi%3Dquaternion%2B1%2B%252B%2B1i%2B%252B%2B0j%2B%252B%2B0k">Wolfram | Alpha</a> , it gives tons of passing information and generally can do a lot.  You can also look at the difference between Euler angles and quaternions in the interactive demonstration on the links below. <br><br><div class="spoiler">  <b class="spoiler_title">Video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/SKh831EqR7Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br>  <a href="http://basmanovdaniil.github.io/Quaternions/">WebGL</a> |  <a href="">Windows</a> |  <a href="">Linux</a> |  <a href="">Mac</a> |  <a href="https://github.com/BasmanovDaniil/Quaternions">Sources on GitHub</a> <br>  Use the mouse to rotate the scene, AD, WS and QE - rotate around the axes, Esc - exit, the other buttons are indicated on the screen. <br>  For Linux users: Make the Quaternions file executable with ‚Äúchmod + x Quaternions‚Äù and run. </div><p>Source: <a href="https://habr.com/ru/post/183908/">https://habr.com/ru/post/183908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183898/index.html">Computer vision system developed at MIT allows successful interviews</a></li>
<li><a href="../183900/index.html">Using Scala in enterprise projects</a></li>
<li><a href="../183902/index.html">Torchlight is free to download to GOG.COM for two days.</a></li>
<li><a href="../183904/index.html">Report on the online conference RuHaxe # 1</a></li>
<li><a href="../183906/index.html">Real-time debug of Android and iOS applications on Unity</a></li>
<li><a href="../183910/index.html">Survival Instructions for a full-time system administrator</a></li>
<li><a href="../183912/index.html">Python guide. We write a great code</a></li>
<li><a href="../183920/index.html">Android again "ran away" from smartphones and tablets</a></li>
<li><a href="../183922/index.html">Big Brother, as 95% saw him in central television coverage</a></li>
<li><a href="../183924/index.html">Russian Code Cup 2013 - analysis of qualifying round tasks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>