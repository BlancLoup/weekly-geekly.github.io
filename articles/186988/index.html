<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Difficult in the obvious: how we made the call interface to Yandex.Shell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we want to talk about how they created such, as sometimes it seems, an obvious thing, like the call interface in Yandex.Shell . To our surprise,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Difficult in the obvious: how we made the call interface to Yandex.Shell</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/yandex/blog/186988/"><img src="https://habrastorage.org/getpro/habr/post_images/5d4/989/ca6/5d4989ca60d776ab37a88c5ced280b16.png" alt="image" align="right"></a>  Today we want to talk about how they created such, as sometimes it seems, an obvious thing, like the call interface in <a href="https://play.google.com/store/apps/details%3Fid%3Dru.yandex.shell">Yandex.Shell</a> .  To our surprise, during our work, we realized how long no one had seriously thought about the fact that in most of the phones it had not functionally improved for many years.  And the world for this time has gone forward.  It is time to take a retrospective look at how it was created, what tasks we faced and what solutions we came to. <br><br>  The short and understandable English word ‚Äúdialer‚Äù has yet to acquire a harmonious, non-hearing Russian equivalent.  If you look in the dictionary, then as a translation you will be offered a furious ‚Äúdialer‚Äù.  However, the words ‚Äúdialer‚Äù, ‚Äúdialer‚Äù and ‚Äúdialer‚Äù got accustomed in a living language.  As part of our internal cuisine, we are accustomed to use the last option, and we will stick to it in this post. <br><br>  We came to the idea that we need to create our own dealer for our shell, starting from the fact that nothing really new appeared in this segment for a long time.  The native and third-party dealers that existed at that time in iPhones and Androids were very convincing and beautiful.  But in terms of functionality, all of them are not far removed from what we have already seen in ordinary mobile phones of the pre-smartphone era.  It was necessary not only to endow our dealer with a complete set of usual expected functions, such as the list of favorites, call log or T9, but also to go significantly further, namely, to introduce into it developments that have not yet been encountered in the market. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our advantage in achieving this goal was that, unlike its counterparts, Yandex.Dayler was created initially sharpened for Russia and other countries of Yandex presence, which enabled us to take into account the interests and behavioral peculiarities of ‚Äúour‚Äù users.  In addition, long-developed custom services are the strength of Yandex, and it is through them that we expected to improve the functionality of our dealer. <br><br>  But first things first. <br><a name="habracut"></a><br><h4>  Infinite address book </h4><br>  One of our first tasks was the need to minimize the number of clicks the user needs to call the organization he needs.  Indeed, calls to various organizations, including those unknown to the user, have been and remain one of the most popular scenarios for using the phone. <br><br>  The formulated task assumes a complete rethinking of the user's stereotype.  Until now, the call to the right organization meant a whole range of sequential actions.  Consider a small example.  If I need to call the nearest pharmacy, what actions will I have to take?  There are various options, but obviously, they will somehow include: <br><br>  - positioning (for a start, where am I?); <br>  - search for pharmacies in a given area; <br>  - choice of pharmacy; <br>  - search for her contact information; <br>  - copying or manually transferring a phone number; <br>  - actually call. <br><br>  Probably, each of us has long ago developed more or less familiar scenarios for the accomplishment of all these actions.  Here, elementary search (both mobile and desktop), maps, navigator, and a lot of other things come to our aid.  The problem is that for all these services everything connected with making a call is a function at best secondary.  And because of this, the path from the emergence of the need to call the pharmacy to, directly, the call is quite long and thorny. <br>  Now, if the phone of the pharmacy were of the same level of accessibility as any number in our address book ... You already understood that the idea to implement and / or load ready-made reference information from the cloud into the dialer itself was in the air. <br><br>  We decided that from now on the list of contacts will no longer be limited to personal contacts of the user.  As the user enters a name or a name, in addition to his own contacts, he is now replaced with tips that match the search criteria based on the most popular requests from Yandex users.  These prompts are issued instantly since they are already downloaded to the phone.  When you select one of the prompts, the user is given the appropriate list of the nearest organizations from the extensive Yandex.Reference base, taking into account his current location. <br><br>  The user can immediately call any of the found organizations, or pre-examine its card.  A card is usually as informative as possible: with a telephone, an address, position on a map and a website.  Any of these contacts can be instantly, in one click, use or add an organization card to your own contacts. <br>  All the way from the idea to the call comes down, in fact, to one point - to decide on the choice of a specific pharmacy.  And all that a machine can do, let the machine do. <br><br>  Let us return to our pharmacy example and see how this path is now traversed. <br><br>  1. Go to the dealer, tab "Contacts". <br><br>  2. We start to type the word "pharmacy".  You don‚Äôt have to type for a long time, because after the ‚Äúan‚Äù the prompt gives out not only the word ‚Äúpharmacy‚Äù, but also some of the most popular queries related to the word ‚Äúpharmacies‚Äù. <br><br><img width="300" height="533" src="https://habrastorage.org/getpro/habr/post_images/53e/63d/a54/53e63da54f3ffcd088e204f61e8eea4a.png"><br><br>  3. Select the desired hint.  We fall into the list of suitable pharmacies, sorted by distance from our location. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c75/6cd/cd3/c756cdcd3e5950854fe851eabe926e08.png"><br><br>  4. We call. <br><br>  Or do not call.  And go to the contact card to use any other means of communication or add this card to your contacts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5dd/0ab/fb9/5dd0abfb97a84ef506a5cbeaff769cb9.png"><br><br>  Connecting a powerful database such as Yandex.Seeber to the diler made the user's address book interactive, localized by location and, in fact, endless.  Once having mastered the possibilities of an endless address book, the user gradually begins to change the stereotype of behavior in favor of a simple two-two rules: ‚Äúif you want to call, go to the dealer‚Äù.  Not in the search widget, not in the browser, not in the cards, but immediately to the dealer.  It's so natural. <br><br><h4>  Definition of unknown numbers </h4><br>  Appetite comes with eating.  And this possibility - the definition of unknown numbers - is closely related to the previous one.  Realizing the advantages of integrating the address book with the Yandex.Directory, we wanted more, and in the first place - automatic identification of the identity of an unknown number during a call.  It is difficult to overestimate the demand for this function among users.  A call comes in from an unknown number, the dialer intercepts the number, finds it in the directory and displays the name of the calling organization. <br><br>  However, in this case, we are faced with an unsolvable problem.  Without embedding our shell in the system, we cannot replace or make any changes to the standard incoming call window.  In some dilers, this problem is solved (or rather, it is bypassed) with the help of its own window of the incoming call, which emerges over the standard one.  However, this is a very unreliable approach, bad for stability.  And stability for us is the factor that we could not sacrifice in any way. <br><br>  Therefore it was necessary for a while to abandon the idea of ‚Äã‚Äãloading data about the caller from the Directory.  But nothing prevented us from embodying the very same idea - identifying unknown numbers - but already in the call log. <br>  The diler has its own call log.  In addition to standard features (call consolidation, duration, etc.), we added the definition of numbers to it.  If the number is unknown, but is found in the Yandex.Manager, the corresponding journal entry takes on a more pleasant and informative look.  A detailed card of such a determined number can be quickly, in two clicks, added to your own contacts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/395/f23/fc0/395f23fc0d78c378126ced633e6e73f2.png"><br><br>  We are talking, of course, about all types of calls: incoming, missed and outgoing, regardless of whether you were looking for these numbers using the infinite address book or just typed from the keyboard. <br><br><h4>  Logos of mobile operators </h4><br>  The next thing that seemed worthy of our implementation is help in identifying mobile operators.  For so many users in the post-Soviet space, it is crucial to know which operators call the numbers, because this directly affects the cost of the call.  Or, say, your friend has two numbers from different operators, and he asked to call him exclusively on Megaphone. <br><br>  And since few people can name all the codes of all mobile operators by heart, we decided to introduce this small but pleasant addition.  The dialer determines the mobile operator for all mobile phones (if possible) and inserts the icon of the corresponding operator in front of the number (for example, in the contact card). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f5/f27/ae9/4f5f27ae9aa4db08aaca9c92a9db2eaa.png"><br><br><h4>  Transliterated Search </h4><br>  The next problem that can be solved with the help of our dealer is rooted in the past.  At the time when the first phones appeared, in the address book of which contacts could be entered not only in Latin, but also Cyrillic.  Today, this problem is exacerbated by several other factors. <br><br>  Unfortunately, the way in which contacts exist in our address books does not always depend only on us.  Some of the contacts we enter ourselves, others are inherited from email accounts, and others from social networks.  Some contacts were added yesterday, others are stored from those glorious times of the beginning of the century, when we bought our first Nokia 3310. Not every user takes the trouble to combine contacts from different accounts.  Not everyone can say with certainty how one or another of his contacts is recorded - in Cyrillic or Latin. <br><br>  We decided that the user should no longer think about the layout of one or another contact ‚Äî the transliterated search should ensure the ‚Äúfindability‚Äù of any contact and with any input method.  Search results are displayed instantly and regardless of which layout is used for typing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e12/7fa/b2b/e127fab2b2f5b7d4c9a72d6cfd24f2f9.png"><br><br><h4>  Search for diminutive names </h4><br>  Having dealt with transliteration, we turned to another thing in which users are willingly confused.  For the same reasons described above, user contacts can be entered either by full name or by diminutive ones.  We taught the dealer to look for contacts in both ways.  On request [Vanya] he will find all Ivanov, on request [Ekaterina] - all Cats.  The best job search will illustrate a screenshot. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ae/5c7/644/4ae5c7644ab0d3fb1738a790893f19d1.png"><br><br>  As the inquisitive reader has already realized, combining the last two possibilities, we get that, on the request of [Vova], all of Vladimir will be found, which should have been proved. <br><br>  Both of these functions (transliterated search and search by diminutive names) were not implemented in the aforementioned iPhone and Android dilers, simply because the problem itself did not lie for their creators on the surface due to their irrelevance for the American and European markets.  And the implementation of these functions, especially search by diminutive names, for all supported locales would be very problematic.  We were content with the names used in Russia and tried to make support for this functionality for most of them. </div><p>Source: <a href="https://habr.com/ru/post/186988/">https://habr.com/ru/post/186988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186962/index.html">Technopark Mail.Ru from the inside</a></li>
<li><a href="../186968/index.html">Google fixed a vulnerability that allowed to get full remote access to Glass</a></li>
<li><a href="../186976/index.html">HideOut: games with augmented reality</a></li>
<li><a href="../186978/index.html">Radioastron rips templates</a></li>
<li><a href="../186980/index.html">STM32F4Discovery - we connect the camera via DCMI interface</a></li>
<li><a href="../186990/index.html">Parse "Opposition - Military Chronicle" (1996-1997, Doc)</a></li>
<li><a href="../186992/index.html">Good morning</a></li>
<li><a href="../186994/index.html">New API HeadHunter and termination of support for API 1.0</a></li>
<li><a href="../186998/index.html">Why you should not overclock the timer Windows or megawatts wasted</a></li>
<li><a href="../187002/index.html">Meet IBM Tivoli Netcool / OMNIbus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>