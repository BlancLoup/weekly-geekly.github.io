<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to Claims-based identity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing applications on the Microsoft stack to obtain information about the current user, quite often (more precisely, almost always) you can ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to Claims-based identity</h1><div class="post__text post__text-html js-mediator-article"> When developing applications on the Microsoft stack to obtain information about the current user, quite often (more precisely, almost always) you can find such sections of code or wrappers over them: <br><br> <code>HttpContext.User.Identity.Name <br> HttpContext.User.IsInRole(...) <br></code> <br><br>  or 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>Thread.CurrentPrincipal.Identity.Name <br> Thread.CurrentPrincipal.IsInRole(...) <br></code> <br><br>  The purpose of these calls may be the need to make a decision on the authorization of a call to a function or method, display information about the current user, and so on. <br><a name="habracut"></a><br>  User information appeared in these classes in various ways: reading data from the database, Forms authentication, NTLM token, Kerberos token.  In each case, the task was to obtain information about the user, its authentication and additional information. <br><br>  In the ‚Äúpre-cloud times‚Äù this was quite enough for most applications.  If this was not enough, then different kinds of custom frameworks were created, but at the head of the corner there was often the main question: does the user have a specific role?  Up to a certain point, this was enough until the user repository was one; there was no need to interact with business partners and so on.  With the advent of clouds, distributed systems, SaaS applications and other buns without which it is difficult to imagine a modern web, this model was not enough if, for example, you wanted to allow employees of your partner access to certain functions of your CRM.  The same often raises the question of the development and evolution of the application, for example: initially you planned to use two groups of users, User and Administrator, and in your code generously created authorization <br>  view attributes: <br><br> <code>[Authorize("Administrators")] <br> public ActionResult DoSomeHardcoreAdminStuff() <br> { <br> ... <br> } <br></code> <br><br>  a year later, the business decided that it would be nice to have several different groups of users with different levels of access and everything else (well, to understand all the drama of this situation) to delineate the rights for administrators to SystemAdministrator and SecurityAdministrator.  And this is not the limit, since these requirements are limited only by the imagination of the business. <br><br>  From the point of view of the developer, it all poured into the zoo of technology and crutches.  Each application authenticated users in its own way.  The user could authenticate using OAuth, Forms, Windows or anything else.  In each case, you had to write your own authentication and authorization logic, and if you had Api, then you also had to draw a bicycle for it. <br><br>  In response to this, in 2008 Microsoft saw the light of the first release of the Windows Identity Foundation (WIF) and introduced the concept of Claims-based identity.  The purpose of this framework is to provide an abstract mechanism for expressing your requirements for the user without going into details of how this works. <br><br>  In short, the idea of ‚Äã‚ÄãWIF can be described with a fairly simple life example: <br>  You turned 18 and you decided to go to the movies.  Adult movies.  But, unfortunately, did not have time to get a passport or any other identity card so far (well, or just was lazy).  You are going and going to the passport office, after some time you get a passport and, presenting your passport, you can safely buy yourself the coveted ticket and go to the session.  And this is how it looks from the point of view of WIF: <br><br><img src="https://habrastorage.org/storage2/605/0ee/827/6050ee827d9fd5125b0d34f347c33a2f.png"><br><br>  Subject, that is, you go to the Identity provider (passport office) and on the basis of the Certificate of birth Token receive PassportToken.  Then, along with this PassportToken, you go to the Relying party (cinema) and, after confirming your age, get access to the service. <br><br>  The main ideas that can be learned from this example are: <br><br>  1. To authorize you, as a visitor to an adult session, the cinema does not need to drive its customer base or go anywhere.  He needs only your identity card which he trusts (passport, military ID, rights). <br><br>  2. The passport office does not know where you will present your passport.  (From the point of view of WIF, it should know a little bit, but it is not necessary). <br><br>  3. With a passport you can buy yourself a good whiskey after going to the movies, take a mortgage or something else in any institution that trusts the documents issued by the state.  an institution. <br><br>  Someone has already worked with protocols such as OAuth, WS-Trust and WS-Fed, SAML-P, and this interaction scheme will be familiar to them.  In short, you receive user information from a trusted identity provider (Identity provider) in the form of a token of a specific format and use it to make any decisions in your application.  In a degenerate case, such as Forms authentication, you yourself are the certifying party and use this information yourself.  WIF allows such scenarios.  WIF is flexible enough to support all sorts of scenarios. <br><br>  WIF allows you to ‚Äúoutsource‚Äù the authentication process to a trusted party and minimizes the need for developer intervention in the authentication and authorization process.  All credentials that are presented to your application are cast to the ClaimsPrincipal and ClaimsIdentity types.  These types are very similar to the standard * Principal and * Identity, they also implement the IPrincipal and IIdentity interfaces, but have an additional property that is a collection of all the statements that are available to you about the current user.  Moreover, for compatibility, various existing ways of working with IIdentity and IClaimsPrincipal are supported, for example: <br><br> <code>[PrincipalPermission(SecurityAction.Demand, Role = "Administrators")] <br> static void CheckAdministrator() <br> { <br> Console.WriteLine("User is an administrator"); <br> } <br></code> <br><br>  For this, it is enough that the user has a role type statement (you can configure the type of statements to be used as roles) with the value ‚ÄúAdministrators‚Äù. <br><br>  In an ASP.NET MVC application, this might look like this: <br><br> <code>[ClaimsAuthorize(ClaimTypes.Role, "Administrators")] <br> public ActionResult DoSomeHardcoreAdminStuff() <br> { <br> ... <br> } <br></code> <br><br>  Or so: <br><br> <code>[ClaimsAuthorize(ClaimTypes.Permission, "DoSomeHardcoreAdminStuff")] <br> public ActionResult DoSomeHardcoreAdminStuff() <br> { <br> ... <br> } <br></code> <br><br>  There are also more complex scenarios for checking access to a particular resource, or simply getting the user's age, his postal address, and home phone number. <br><br>  As a result of all these transformations, the Role based security approach is no longer imposed on your application and you are free to choose how, on the basis of what and where to carry out the necessary checks, and also, in some cases, completely get rid of the mechanisms for storing user information within the application.  Among other things, you do not care about how the user is authenticated, be it a standard login-password pair or a clever smart card.  This is the task of your Identity Provider. <br><br>  Currently, there are two main solutions for Microsoft's platforms for this approach: ADFS (Active Directory Federation Services) and Azure ACS.  If neither of them is suitable for you, then you are free to write your own service yourself, the benefit is to put a template with an example out of the box to the studio.  There is also an open source server IdentityServer on the basis of which you can develop your own product. <br><br>  Some facts: <br><br>  Out of the box, WIF supports the following protocols: <br>  1. WS-Federation <br>  2. WS-Trust <br>  3. WS-Security <br>  4. WS-SecurityPolicy <br>  5. WS-Addressing <br><br>  Support for the SAML-P protocol is in the CTP state.  Information about the RTM version yet.  There is also OAuth2 extensions. <br><br>  SAML1.1 and SAML2 credentials are supported as standard.  But there are already quite developed libraries that add support for SWT and even JWT (Json Web Token). <br><br>  This was a very small excursion into what happens in the System.Security namespace.  As part of the introductory post I would not like to go into details <br>  By the way, in .Net 4.5 Claims-based identity and WIF become king of the hill.  All * Principal types will be inherited from ClaimsPrincipal, the Kerberos tokens inside will contain a set of assertions and much more tasty.  If someone is interested in this topic, write your wishes in the comments, as time will be sure to try to write. <br><br>  Useful links: <br>  1. <a href="http://msdn.microsoft.com/en-us/security/aa570351.aspx">msdn.microsoft.com/en-us/security/aa570351.aspx</a> - page on MSDN. <br>  2. <a href="http://claimsid.codeplex.com/">claimsid.codeplex.com</a> - code examples and free book. <br>  3. <a href="http://leastprivilege.com/">leastprivilege.com</a> - Dominick Baier's blog. <br>  4. <a href="https://github.com/thinktecture/Thinktecture.IdentityServer">github.com/thinktecture/Thinktecture.IdentityServer</a> - open source Identity Server. <br><br>  Ps.  Thanks to <a href="https://habrahabr.ru/users/xaoccps/" class="user_link">XaocCPS</a> for the review. </div><p>Source: <a href="https://habr.com/ru/post/145306/">https://habr.com/ru/post/145306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145298/index.html">Easy setup .htaccess for production</a></li>
<li><a href="../145300/index.html">Bitcasa Reincarnation</a></li>
<li><a href="../145301/index.html">Samsung Electronics becomes a platinum member of the Linux Foundation</a></li>
<li><a href="../145302/index.html">GitHabr: Its collective Habrahabr with blackjacks</a></li>
<li><a href="../145304/index.html">Posters on IT subjects</a></li>
<li><a href="../145307/index.html">The latest Windows Azure technology will be highlighted at the Meet Windows Azure event, see online.</a></li>
<li><a href="../145308/index.html">WebSphere Application Server application server topologies for high availability</a></li>
<li><a href="../145309/index.html">Fundamentals of the approach to the construction of universal intelligence. Part 1</a></li>
<li><a href="../145310/index.html">Time in phones: what and how it works</a></li>
<li><a href="../145311/index.html">New line from Lenovo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>