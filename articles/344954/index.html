<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Time is money. As we taught Yandeks.Taksi accurately calculate the cost of the trip</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Any of us before buying a product or service tries to find out the exact price. It is clear that sometimes stories happen when the final cost greatly ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Time is money. As we taught Yandeks.Taksi accurately calculate the cost of the trip</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/h-/ae/rr/h-aerr-6wkdwajkunnuzpxs53ku.png"><br>  Any of us before buying a product or service tries to find out the exact price.  It is clear that sometimes stories happen when the final cost greatly exceeds the planned one.  And if with repair of the car or apartment it already became habitual, in other cases the difference between expectation and reality is rather annoying. <br><br>  Until recently, the cost of travel in a taxi was also floating.  Even online services calculated the amount only approximately - the final cost was formed only at the end of the journey.  The fare typically includes three components: the cost of landing (sometimes with kilometers and / or minutes included), the cost per kilometer, and the cost per minute.  Of course, it was possible to calculate the approximate price for a trip before, but in the end it could change due to the fact that, for example, the driver stayed in a traffic jam on the way.  It is clear that passengers did not always like it. <br><br>  It seems that there is nothing easier than using the data of the router in Yandex.Navigator and the data of traffic jams so that Yandex.Taxi from the very beginning would calculate the exact price that would not change at the end of the trip.  But in fact, the cost is influenced by a huge number of factors, not just the tariff.  It is important not just to be able to count it.  On the one hand, the cost should be attractive to the user, and taking into account not only the current situation on the road, but also, for example, traffic jams, which are not on the route yet, but which will soon arise.  On the other hand, the price should be such that drivers do not lose in earnings, even if the path from point A to point B is longer or longer than planned.  In this article, we will describe how you solved the problem and how you looked for a balanced algorithm that benefits all participants of the Yandex.Taxi platform. <br><a name="habracut"></a><br><h2>  Route and time </h2><br>  In order to be able to calculate a balanced trip cost, we had to learn how to accurately predict the length and duration of the route.  Let's see how our router works at all. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is a rather complicated system that builds a route from one point to another on the basis of another simpler system - a road graph.  The graph looks as natural as you probably imagine it to be: each road corresponds to one or several edges, and the intersections and branching of the roads are located at the vertices.  This graph is directional (as the roads are also directional). <br><br><img src="https://habrastorage.org/webt/ys/l8/q9/ysl8q9bjolucp21u8vh1cl4tvn4.png"><br><h5>  <sub><sup>This is what a road graph looks like in the area of ‚Äã‚Äãthe Moscow office of Yandex</sup></sub> </h5><br>  The most important characteristic of the edges of the graph is the average speed of movement along them at the moment.  It depends on the current traffic situation and the rules of the road (for example, speed limits).  Every second we receive tens of thousands of impersonal signals ‚Äî GPS tracks ‚Äî from users of Yandex geoservices, aggregate them, and then, by filtering and interpolating, we make the signal better and less noisy.  At the final stage, we calculate the current edge speed in real time (for more details on how Traffic jams work, see <a href="https://yandex.ru/company/technologies/yaprobki/">here</a> ). <br><br>  The address ‚Äî the ‚Äútop‚Äù of the virtual graph ‚Äî consists of the edge of the road graph and the direction of motion along it: <img src="https://habrastorage.org/webt/mq/qs/q2/mqqsq2_jiq2tvkzqotlax2i0mfc.png"><br>  What happens when you book a trip in the app?  We send a request to the router in order to find the best route from the landing point (A) to the destination (B), which is specified in the order.  The router, in turn, projects a point A onto the graph in order to find its ‚Äúaddress‚Äù ‚Äîa combination of an edge and a direction.  The same thing happens with point B. And the first feature of the system is already manifested here: the process of determining the shortest path occurs not in the original, ‚Äúnatural‚Äù road graph, but in a certain ‚Äúvirtual‚Äù one.  Its vertices are no longer intersections, but the very "addresses", and the edges - not the streets, but "maneuvers", that is, transitions from one "address" to another. <br><br><img src="https://habrastorage.org/webt/js/uu/pz/jsuupz6yrwnngrzlawgfoxppqtw.png"><br><h5>  <sub><sup>Representation of the same trajectory of movement in the road (left) and virtual (right) graphs</sup></sub> </h5><br><br><img src="https://habrastorage.org/webt/ew/oe/re/ewoeremelwkxgvpp79uxxbv09hc.png"><br><h5>  <sub><sup>A straight line movement can also consist of virtual graph maneuvers: for convenience, the long road turns into several edges when digitizing.</sup></sub> </h5><br>  As we remember, our task is to find the optimal route, while, of course, the final ‚Äúphysical‚Äù route will be completely unimportant whether we built it in a ‚Äúnatural‚Äù graph or a ‚Äúvirtual‚Äù one.  But first you need to decide what is optimality.  On the one hand, it is obvious that in the city it is the fastest way from A to B. On the other hand, sometimes a difficult route through small streets and bypassing major highways, although it saves 2 minutes, but due to the large number of turns it turns out to be significantly "More expensive" for the motorist.  Therefore, to begin with, we defined a function that sets the ‚Äúcost‚Äù of the maneuver and decided to optimize it using machine learning. <br><br>  The simplest example of such a function is the length of the edges that make up the maneuver, divided by the average speed of movement along these edges, the so-called ‚Äúgeometric time‚Äù.  This metric is good in its simplicity, but it often does not take into account a number of features of a particular maneuver.  Take for example the left turn.  Obviously, to make it from a secondary road at an adjustable intersection is not at all the same thing as turning onto a ramp, moving along a highway.  The characteristics of each individual situation can significantly increase the time to complete the entire maneuver, and in order to take them into account, we decided to describe each maneuver with a set of attributes: the length of its edges, the geometric travel time, functional classes of roads, the presence of a dedicated public transport strip, and so on.  Here, ‚Äúsigns of the future‚Äù naturally arose: for example, we can calculate in advance the time for passing a maneuver, taking into account traffic jams that will arise by the time we approach this maneuver. <br><br>  As a result, we got more than 70 different signs affecting the ‚Äúcost‚Äù of the route, and their number is constantly growing, because we are constantly adding new signals that can become signs and help in our task. <br><br>  Another feature of our approach is that we have divided the original task into two: building a route and specifying the travel time on it.  We called these models ‚Äúroute‚Äù and ‚Äútime‚Äù, respectively, and it is worth telling in more detail how they differ from each other and why we need two models. <br><br>  The route model is used to select the optimal path from point A to point B from a variety of options, based on the length of the route and travel time on it.  The catch here is that the routing model must produce an answer very, very quickly, because after it, the system needs time to use these calculations in a further process chain.  Say, 100 milliseconds for a calculation of 1000 maneuvers is too much, you need an order of magnitude less.  The route model should be as cost-effective as possible in terms of computation, so it takes into account a reduced set of features.  But when we already have an optimal route - we want to know the time to travel through it as precisely as possible, and here we are not so connected by speed, we can afford 100 milliseconds. <br><br>  For this, there is a time model, the only task of which is the specification of the travel time for an already chosen route.  The time model takes into account the full set of features for each maneuver, as well as user request parameters from the application: the current local time and various route macro-characteristics ‚Äî for example, the over-run ratio (the ratio of the actual route from A to B to the distance between these points in a straight line).  At the exit, the time model gives the updated travel time. <br><br>  To summarize: our initial task ‚Äúhow to most accurately build a route and predict the time to travel on it‚Äù has been reduced to several steps.  First, we moved from a ‚Äúnatural‚Äù graph with vertices-intersections and edges-streets to a ‚Äúvirtual‚Äù graph, the edges of which are maneuvers, that is, transitions from ‚Äúaddress‚Äù to ‚Äúaddress‚Äù.  Each of these maneuvers we described with a set of more than 70 signs.  Secondly, in order to optimize the operation of the router, we decided that there will be two predictive models: the route one, which is quick but rough, chooses the right route from the set of possible ones, and the time one, which specifies the travel time by the optimal route.  Now how these models work. <br><br><h2>  Models </h2><br>  Despite the fact that both the route and time models are very different from each other, they, in fact, have a similar task - to calculate the time of travel along the route.  The key difference is in the complexity of the calculations used, that is, in quantitative rather than qualitative factor.  At the same time, since the models have the same task, then the approach from the point of view of their training is the same.  We can take only one model ‚Äî the time model ‚Äî and then remove ‚Äúall unnecessary‚Äù from it (for example, unnecessary features) and thus obtain a more lightweight route model. <br><br>  This approach turned out to be advantageous not only because it unified the machine learning method, but also for other reasons, including because the training of the time model is a classical task, as they say, ‚Äúfrom the textbook‚Äù.  We have a huge base of travel histories, that is, there are a lot of ‚Äúroute-time‚Äù pairs that can be used as a sample for some kind of machine learning method.  It is more difficult to train the route model, because we cannot force all drivers to ride along all the variants of routes from point A to point B in order to compare which one is faster.  As a result, at the first stage, we focused precisely on training the time model. <br><br>  The first idea was simply to use a linear model over the sum of signs of maneuvers along the route, and to take the actual travel time as the learning goal.  This approach has a characteristic of the problem - linearity itself.  Indeed, the time calculated in this way for a route consisting, for example, of two maneuvers, is equal to the sum of times calculated for each of the maneuvers separately.  There were no difficulties with the interpretation of various signs, which is always pleasant: if the weight with a sign is large, then the sign is significant. <br><br>  Nevertheless, despite a lot of advantages, the very first attempts to train this model turned out to be disappointing: the results were slightly better than ‚Äúgeometric time‚Äù because we lost a lot of information embedded in categorical (that is, unnumbered) signs of maneuvers - for example, the functional class of roads , the shape of the ribs, the level of the road above the ground and others remained "overboard". <br><br>  Here is how the price of the trip is calculated at the time of booking: <br><br><img src="https://habrastorage.org/webt/fn/9a/iz/fn9aizgcjsx9qodam6s6jum1pns.png"><br>  As we know, taking into account categorical variables is always a difficult task, it was not for nothing that the whole CatBoost was <a href="https://habrahabr.ru/company/yandex/blog/333522/">invented</a> .  And yet we tried to solve this problem by using a technique similar to N-way-split, which is used in decision trees. <br><br>  We take into account that, according to the classification of People‚Äôs Maps, the roads are divided into 9 <a href="https://yandex.ru/support/nmaps/cat_road_rul2.html">functional classes</a> , and there are also 5 types of design features: two carriageways, a roundabout, a congress, a backup, a U-turn.  In addition, on the road or there is a traffic light or it is not - these are two more values.  Total we have 9x5x2 = 90 combinations.  Now for each such combination of categorical signs, we will separately take into account the remaining signs, that is, we will initially divide our sample into 90 independent fragments.  Because of this fragmentation, we in total received several thousand signs, because in essence we examined each of them 90 times - for each separate combination.  Even with the large training samples, such ‚Äúanimation‚Äù led to the fact that the model began to quickly retrain.  Partially, this problem was solved by L1-regularization (it, unlike L2, is able to level the influence of the signs, zeroing the weight of them), but in the end, by the totality of problems, the approach had to be considered a dead end.  True, there were some good news: such a time model could already be used as a route one, because it had linearity in individual maneuvers, which means we were moving in the right direction. <br><br>  And yet, the problem remained: how to cope with so many signs?  Yandex has <a href="https://yandex.ru/company/technologies/matrixnet/">Matrixnet</a> , a machine learning algorithm based on gradient boosting of decision trees, which successfully copes with hundreds and even thousands of attributes.  To begin with, we tried the ‚Äúhead on‚Äù approach and trained the Matriksnet on pairs of ‚Äúroute - real travel time‚Äù.  Such a method immediately gave a good result, and further work on increasing the number of features and fine-tuning the algorithm hyper parameters helped to get a noticeable increase in the quality of prediction.  But, despite the instantaneous ‚Äúexhaust‚Äù, caused simply by the power of Matrixnet, there were also disadvantages: <br><br><ul><li>  It became difficult to interpret the results, because in the case of gradient boosting over trees, we are working, in fact, with a black box.  It is no longer possible to simply interpret various signs depending on their weights. </li><li>  The linearity disappeared from the model - it‚Äôs impossible to split the route into 2 pieces, apply the model to them, add up and get the same number as for the entire route. </li><li>  This model could not be used as a route one, because we trained it on the routes as a whole, and not on individual maneuvers. </li></ul><br>  That is, for our tasks, the use of Matriksnet "in the forehead" did not fit.  As a result, we were left with two different models, each of which was good in its own way, but also something bad.  In this paradigm ‚Äî the linear (and threatened to retrain) route model and the time model based on Matrixnet ‚Äî we tried to develop for a while, but the soul wanted some kind of universal solution.  And it was found. <br><br><h2>  "Linear MatrixNet" </h2><br>  As it usually happens, the idea, when it came to my head, turned out to be simple to tears: to apply Matrixnet to individual maneuvers, not to the whole route, but to take the following difference as a function of the error: sum of time values ‚Äã‚Äãby route maneuvers minus target travel time . <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><mi>m</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>T</mi><mi>r</mi></msub><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><mi>m</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>m</mi><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>m</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>u</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>s</mi></mrow></msub><mi>F</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>f</mi><mi>m</mi></msub><mo stretchy=&quot;false&quot;>)</mo><msup><mo stretchy=&quot;false&quot;>)</mo><mn>2</mn></msup><mo>,</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.436ex" height="3.021ex" viewBox="0 -987.6 25159.8 1300.8" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-75" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6D" x="1292" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6C" x="2420" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-69" x="2719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6D" x="3064" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-69" x="3943" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-74" x="4288" y="0"></use><g transform="translate(4650,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-69" x="805" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6E" x="1150" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-72" x="1751" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6F" x="2202" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-75" x="2688" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-74" x="3260" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-65" x="3622" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-73" x="4088" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMAIN-28" x="8442" y="0"></use><g transform="translate(8832,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-54" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-72" x="826" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMAIN-2212" x="10058" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-73" x="11308" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-75" x="11778" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6D" x="12350" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6C" x="13479" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-69" x="13777" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6D" x="14123" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-69" x="15001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-74" x="15347" y="0"></use><g transform="translate(15708,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-69" x="1232" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6E" x="1577" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6D" x="2178" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-61" x="3056" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6E" x="3586" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-65" x="4186" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-75" x="4653" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-76" x="5225" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-65" x="5711" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-72" x="6177" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-73" x="6629" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-46" x="21297" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMAIN-28" x="22047" y="0"></use><g transform="translate(22436,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-66" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMATHI-6D" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMAIN-29" x="23648" y="0"></use><g transform="translate(24037,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMAIN-32" x="550" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/344954/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjEXDxCzlFGFpfKvVqF1FM5QM7pwQ#MJMAIN-2C" x="24881" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><mi>m</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>r</mi><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>T</mi><mi>r</mi></msub><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><mi>m</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>m</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>u</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>s</mi></mrow></msub><mi>F</mi><mo stretchy="false">(</mo><msub><mi>f</mi><mi>m</mi></msub><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>,</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> \ sum \ limits_ {r \ in routes} (T_r - \ sum \ limits_ {m \ in maneuvers} F (f_m)) ^ 2, </script></p><br>  where T is Target, f are attributes, F is an optimized function. <br><br>  Although this function is very similar to the task of ranking in the search (optimization of search results as a whole), there was no such a tool of the Matrixnet among the finished ones, so we had to implement it ourselves. <br><br>  After some agony of picking the right pace of training and the number of trees, we managed to get a model that almost did not lose to the ‚Äúpure‚Äù Matrixnet in quality, but it was linear.  This made it possible to use it as a routing model, and also opened up access to the easy use of categorical features by digitizing them and using CatBoost. <br><br><h2>  results </h2><br>  The whole story took a lot of time, but ultimately we got a model that simultaneously met all the requirements for speed and gave the necessary accuracy in estimating time.  It was this last characteristic that made it possible to accurately calculate the cost of a taxi ride in advance, and not to change it at the end of the journey. <br><br>  The last question - what results did we get, is there anything to compare with?  Of course, a complete answer would require a discussion of a variety of factors and quite serious analytics.  But we can give some very simple estimates. <br><br><img src="https://habrastorage.org/webt/yu/ms/gv/yumsgvhba-pueutduz7qtexqxdu.png" width="387"><img src="https://habrastorage.org/webt/vp/ve/sb/vpvesbefnobl0wysjdqy65xjbdg.png" width="387"><br><h5>  <sub><sup>"It was - it became."</sup></sub>  <sub><sup>On the left - the old version of the application with an approximate calculation of the cost of the trip.</sup></sub>  <sub><sup>On the right - the current version with the exact price of the trip in different fares.</sup></sub> </h5><br>  Obviously, showing the exact price of a trip in the Yandex.Taxi application even at the time of booking is in itself a significant advantage, which makes the service transparent for users, so here we took little risk.  The only thing that turned out to be difficult is to explain that if a person arrives at the wrong point B, which he indicated when ordering, then the whole trip is recalculated using a taximeter, because in such cases our calculations are meaningless.  But that's another story.  Since there are not many such cases, the majority of our users appreciated not just the display of the final price before the trip, but also the fact that it did not change at the end of the trip, even if the taxi was in a traffic jam or the driver was driving around.  And of course, they began to point out point B more often, realizing that only in this case they get such a calculation. <br><br>  As we said at the beginning, if our algorithms worked poorly and made the price good only for the user, this could lead to a significant loss of earnings for drivers and, as a result, to their outflow.  After the price began to appear even before the trip, the number of orders began to grow actively - many people for whom the exact cost is critical, it became psychologically easier to use Yandex.Taxi.  The increase in orders has led to a significant increase in the utilization of taxi cars - that is, to share for the work shift, when the driver is carrying a passenger or driving to order, and not wasting time.  It also happened due to the fact that growth has improved the work of other service technologies - for example, a chain of orders.  This is an algorithm that begins to look for the next client before the driver takes the previous one - and is looking for him in the area where the driver will soon arrive with the passenger. <br><br><img src="https://habrastorage.org/webt/hy/yr/8_/hyyr8_ulaf_c14anhtm_x-_2in4.png"><br><h5>  <sub><sup>The growth of recycling machines in Moscow and the region.</sup></sub> </h5><br>  Thanks to the increase in recycling, the most important indicator for a driver is earn per hour, the average earnings per shift hour: according to our estimates, by about 15‚Äì22% on average in Russia.  Although some cities turned out to be real champions, this indicator grew even more there. <br><br>  Ahead of us are waiting for many small and major improvements of the model, such as connecting CatBoost, about which we will definitely tell. </div><p>Source: <a href="https://habr.com/ru/post/344954/">https://habr.com/ru/post/344954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344942/index.html">How to ask questions in IRC</a></li>
<li><a href="../344944/index.html">Aliexpress brain</a></li>
<li><a href="../344946/index.html">Check Point Video & Webinars</a></li>
<li><a href="../344950/index.html">Does Ketchapp clone games?</a></li>
<li><a href="../344952/index.html">Winter internship for mobile developers at Redmadrobot</a></li>
<li><a href="../344956/index.html">For those who were afraid, but still ready to try. (Excel)</a></li>
<li><a href="../344960/index.html">Phone number without a passport</a></li>
<li><a href="../344962/index.html">Git bottom to top</a></li>
<li><a href="../344964/index.html">FAQ on integration with ESIA</a></li>
<li><a href="../344966/index.html">HyperRAM: Using a HyperBus Memory Interface Chip</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>