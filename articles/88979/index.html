<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Struts 2 on Google App Engine. Recipes customization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To use one of the most convenient web frameworks for java on the popular Google AppEngine cloud platform, you need to perform a number of actions. Thi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Struts 2 on Google App Engine. Recipes customization</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e83/567/a5a/e83567a5a7b8807c0d08e8dfcb87be98.png" alt="image"><br><br>  To use <a href="http://struts.apache.org/2.x/">one of the most convenient web frameworks for java</a> on the popular <a href="http://code.google.com/appengine/">Google AppEngine</a> cloud platform, you need to perform a number of actions.  This article appeared as a result of my lengthy experiments.  I would be glad if you share your experience with your favorite frameworks on the GAE platform in comments :-) <br><br><h5>  Used libraries </h5><br>  I usually use the following set of libraries: <br><ul><li>  commons-fileupload-1.2.1.jar </li><li>  commons-io-1.3.2.jar </li><li>  commons-logging-1.0.4.jar </li><li>  commons-logging-api-1.1.jar </li><li>  freemarker-2.3.13.jar </li><li>  ognl-2.6.11.jar </li><li>  struts2-core-2.1.6.jar </li><li>  xwork-2.1.2.jar </li></ul><br>  I use IntelliJ Idea 9 and it builds dependencies automatically after I specify using Struts 2 when creating a project.  It is also possible to deploy applications on a cloud platform through a special IDE menu, and in general, AppEngine support is at a very good level. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, you need to bypass or adapt to the limitations of the cloud platform, because Appengine denies direct access to threads, file and many other resources. <br><br><a name="habracut"></a><br><h5>  Configure Ognl SecurityManager </h5><br>  You need to create a listbox that configures Ognl SecurityManager when the application starts: <br><blockquote><ol><li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li></li><li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li></li><li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li></li><li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li></li><li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li> <code><font color="black"><font color="#008000">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { // } }</font></font></code> </li> <li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> <li> <code><font color="black">package su.mvc.util; import ognl.OgnlRuntime; import javax.servlet.ServletContextEvent; import javax.servlet.ServletContextListener; <font color="#0000ff">public</font> <font color="#0000ff">class</font> GaeContextListener implements ServletContextListener { <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextInitialized(ServletContextEvent servletContextEvent) { OgnlRuntime.setSecurityManager( <font color="#0000ff">null</font> ); } <font color="#0000ff">public</font> <font color="#0000ff">void</font> contextDestroyed(ServletContextEvent servletContextEvent) { <font color="#008000">//</font> } }</font></code> </li> </ol></blockquote><br><br>  And then connect it in the web.xml application deployment descriptor: <br><blockquote> <code><a href=""></a></code> <ol><li>  <font color="#0000ff">&lt;?</font>  <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= "1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= "UTF-8"</font> ?  <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">web-app</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">= "http://java.sun.com/xml/ns/javaee"</font> </li><li>  <font color="#ff0000">xmlns: xsi</font> <font color="#0000ff">= "http://www.w3.org/2001/XMLSchema-instance"</font> </li><li>  <font color="#ff0000">xsi: schemaLocation</font> <font color="#0000ff">= "http://java.sun.com/xml/ns/javaee</font> java.sun.com/xml/ns/javaee/web-app_2_5.xsd" </li><li>  <font color="#ff0000">version</font> <font color="#0000ff">= "2.5"</font> <font color="#0000ff">&gt;</font> </li><li></li><li>  <font>&lt;! - Listeners -&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">listener</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">listener-class</font> <font color="#0000ff">&gt;</font> su.mvc.util.GaeContextListener <font color="#0000ff">&lt;/</font> <font color="#800000">listener-class</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">listener</font> <font color="#0000ff">&gt;</font> </li><li>  <font>&lt;! - ... -&gt;</font> </li><li></li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">web-app</font> <font color="#0000ff">&gt;</font> </li></ol></blockquote><br><br><h5>  Type conversion Test and Key </h5><br>  The following types are widely used in Appengine: <br><ul><li>  <b>com.google.appengine.api.datastore.Text</b> for managing large text data </li><li>  <b>com.google.appengine.api.datastore.Key is</b> used as an <a href="https://habrahabr.ru/users/id/" class="user_link">Id</a> for entities.  Unfortunately, AppEngine allows you to work correctly with entity relationships only if Key is used as <a href="https://habrahabr.ru/users/id/" class="user_link">Id</a> </li></ul><br>  To use these types on web forms, you must define a direct and inverse conversion of these types to a string: <br><blockquote><ol><li>  package su.mvc.util.converters; </li><li></li><li>  import com.google.appengine.api.datastore.Text; </li><li>  import ognl.DefaultTypeConverter; </li><li></li><li>  import java.util.Map; </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">class</font> TextConverter extends DefaultTypeConverter { </li><li>  @Override </li><li>  <font color="#0000ff">public</font> Object convertValue (Map map, Object o, Class toType) { </li><li>  <font color="#0000ff">if</font> (toType == Text. <font color="#0000ff">class</font> ) { </li><li>  <font color="#2B91AF">String</font> <font color="#0000ff">value</font> = (( <font color="#2B91AF">String</font> []) o) [0]; </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">new</font> Text ( <font color="#0000ff">value</font> ); </li><li>  } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (toType == <font color="#2B91AF">String</font> . <font color="#0000ff">class</font> ) { </li><li>  Text text = (Text) o; </li><li>  <font color="#0000ff">return</font> text.getValue (); </li><li>  } </li><li></li><li>  <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; </li><li>  } </li><li>  } </li></ol></blockquote><br><br><blockquote><ol><li>  package su.mvc.util.converters; </li><li></li><li>  import com.google.appengine.api.datastore.Key; </li><li>  import com.google.appengine.api.datastore.KeyFactory; </li><li>  import ognl.DefaultTypeConverter; </li><li></li><li>  import java.util.Map; </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">class</font> KeyConverter extends DefaultTypeConverter { </li><li>  @Override </li><li>  <font color="#0000ff">public</font> Object convertValue (Map map, Object o, Class toType) { </li><li>  <font color="#0000ff">if</font> (toType == Key. <font color="#0000ff">class</font> ) { </li><li>  <font color="#2B91AF">String</font> s = (( <font color="#2B91AF">String</font> []) o) [0]; </li><li>  <font color="#0000ff">return</font> KeyFactory.stringToKey (s); </li><li>  } <font color="#0000ff">else</font> <font color="#0000ff">if</font> (toType == <font color="#2B91AF">String</font> . <font color="#0000ff">class</font> ) { </li><li>  Key k = (Key) o; </li><li>  <font color="#0000ff">return</font> KeyFactory.keyToString (k); </li><li>  } </li><li></li><li>  <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; </li><li>  } </li><li>  } </li></ol></blockquote><br><br>  It remains to declare the created converters in the xwork-conversion.properties file: <br><br><blockquote><ol><li>  com.google.appengine.api.datastore.Text = su.mvc.util.converters.TextConverter </li><li>  com.google.appengine.api.datastore.Key = su.mvc.util.converters.KeyConverter </li></ol></blockquote><br><br><h5>  Using Convention Plugin </h5><br>  My favorite Convention Convention plugin is used to implement the Convention-Over-Configuration concept and significantly reduces the time to configure the application.  Unfortunately, when working with Struts 2, you <b>will have to forget</b> about this plugin. <br><br><h5>  Patch Freemarker on TextBlock </h5><br>  Even if you do not use Freemarker to implement the UI, you must patch the Freemarker when using the Strass JSP tags.  To do this, you need to create a class in your application <b>freemarker.core.TextBlock with the</b> following content: <br><blockquote> <code><a href="http://groups.google.com/group/google-appengine-java/browse_thread/thread/186c3fc515e6f6ae"></a> <a href="http://www.visigoths.org/"></a> <font color="black"><font color="#008000">//</font> <br> <font color="#008000">//Workaround for groups.google.com/group/google-appengine-java/browse_thread/thread/186c3fc515e6f6ae</font> <br> <font color="#008000">//</font> <br> <br> <font color="#008000">/*</font> <br> <font color="#008000">* Copyright (c) 2003 The Visigoth Software Society. All rights</font> <br> <font color="#008000">* reserved.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* Redistribution and use in source and binary forms, with or without</font> <br> <font color="#008000">* modification, are permitted provided that the following conditions</font> <br> <font color="#008000">* are met:</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* 1. Redistributions of source code must retain the above copyright</font> <br> <font color="#008000">*  notice, this list of conditions and the following disclaimer.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* 2. Redistributions in binary form must reproduce the above</font> <br> <font color="#008000">copyright</font> <br> <font color="#008000">*  notice, this list of conditions and the following disclaimer in</font> <br> <font color="#008000">*  the documentation and/or other materials provided with the</font> <br> <font color="#008000">*  distribution.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* 3. The end-user documentation included with the redistribution, if</font> <br> <font color="#008000">*  any, must include the following acknowledgement:</font> <br> <font color="#008000">*    "This product includes software developed by the</font> <br> <font color="#008000">*    Visigoth Software Society (http://www.visigoths.org/)."</font> <br> <font color="#008000">*  Alternately, this acknowledgement may appear in the software</font> <br> <font color="#008000">itself,</font> <br> <font color="#008000">*  if and wherever such third-party acknowledgements normally</font> <br> <font color="#008000">appear.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* 4. Neither the name "FreeMarker", "Visigoth", nor any of the names</font> <br> <font color="#008000">of the</font> <br> <font color="#008000">*  project contributors may be used to endorse or promote products</font> <br> <font color="#008000">derived</font> <br> <font color="#008000">*  from this software without prior written permission. For written</font> <br> <font color="#008000">*  permission, please contact visigo...@visigoths.org.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* 5. Products derived from this software may not be called</font> <br> <font color="#008000">"FreeMarker" or "Visigoth"</font> <br> <font color="#008000">*  nor may "FreeMarker" or "Visigoth" appear in their names</font> <br> <font color="#008000">*  without prior written permission of the Visigoth Software</font> <br> <font color="#008000">Society.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</font> <br> <font color="#008000">* WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</font> <br> <font color="#008000">* OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</font> <br> <font color="#008000">* DISCLAIMED. IN NO EVENT SHALL THE VISIGOTH SOFTWARE SOCIETY OR</font> <br> <font color="#008000">* ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</font> <br> <font color="#008000">* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</font> <br> <font color="#008000">* LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</font> <br> <font color="#008000">* USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</font> <br> <font color="#008000">* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</font> <br> <font color="#008000">* OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</font> <br> <font color="#008000">* OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font> <br> <font color="#008000">* SUCH DAMAGE.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">====================================================================</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* This software consists of voluntary contributions made by many</font> <br> <font color="#008000">* individuals on behalf of the Visigoth Software Society. For more</font> <br> <font color="#008000">* information on the Visigoth Software Society, please see</font> <br> <font color="#008000">* www.visigoths.org</font> <br> <font color="#008000">*/</font> <br> <br> package freemarker.core; <br> <br> import java.io.IOException; <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">* A TemplateElement representing a block of plain text.</font> <br> <font color="#008000">* @version $Id: TextBlock.java,v 1.17 2004/01/06 17:06:42 szegedia</font> <br> <font color="#008000">Exp $</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">public</font> final <font color="#0000ff">class</font> TextBlock extends TemplateElement { <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">char</font> [] EMPTY_CHAR_ARRAY = <font color="#0000ff">new</font> <font color="#0000ff">char</font> [0]; <br> <font color="#0000ff">static</font> final TextBlock EMPTY_BLOCK = <font color="#0000ff">new</font> TextBlock <br> (EMPTY_CHAR_ARRAY, <font color="#0000ff">false</font> ); <br> <font color="#008000">// We're using char[] instead of String for storing the text block because</font> <br> <font color="#008000">// Writer.write(String) involves copying the String contents to a char[]</font> <br> <font color="#008000">// using String.getChars(), and then calling Writer.write(char[]). By</font> <br> <font color="#008000">// using Writer.write(char[]) directly, we avoid array copying on each</font> <br> <font color="#008000">// write.</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">char</font> [] text; <br> <font color="#0000ff">private</font> final boolean unparsed; <br> <br> <font color="#0000ff">public</font> TextBlock( <font color="#2B91AF">String</font> text) { <br> <font color="#0000ff">this</font> (text, <font color="#0000ff">false</font> ); <br> } <br> <br> <font color="#0000ff">public</font> TextBlock( <font color="#2B91AF">String</font> text, boolean unparsed) { <br> <font color="#0000ff">this</font> (text.toCharArray(), unparsed); <br> } <br> <br> <font color="#0000ff">private</font> TextBlock( <font color="#0000ff">char</font> [] text, boolean unparsed) { <br> <font color="#0000ff">this</font> .text = text; <br> <font color="#0000ff">this</font> .unparsed = unparsed; <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">* Simply outputs the text.</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> accept(Environment env) <br> throws IOException <br> { <br> env.getOut().write(text); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#2B91AF">String</font> getCanonicalForm() { <br> <font color="#2B91AF">String</font> text = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> ( <font color="#0000ff">this</font> .text); <br> <font color="#0000ff">if</font> (unparsed) { <br> <font color="#0000ff">return</font> <font color="#A31515">"&lt;#noparse&gt;"</font> + text + <font color="#A31515">"&lt;/#noparse&gt;"</font> ; <br> } <br> <font color="#0000ff">return</font> text; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#2B91AF">String</font> getDescription() { <br> <font color="#2B91AF">String</font> s = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> (text).trim(); <br> <font color="#0000ff">if</font> (s.length() == 0) { <br> <font color="#0000ff">return</font> <font color="#A31515">"whitespace"</font> ; <br> } <br> <font color="#0000ff">if</font> (s.length() &gt; 20) { <br> s = s.substring(0,20) + <font color="#A31515">"..."</font> ; <br> s = s.replace( <font color="#A31515">'\n'</font> , <font color="#A31515">' '</font> ); <br> s = s.replace( <font color="#A31515">'\r'</font> , <font color="#A31515">' '</font> ); <br> } <br> <font color="#0000ff">return</font> <font color="#A31515">"text block ("</font> + s + <font color="#A31515">")"</font> ; <br> } <br> <br> TemplateElement postParseCleanup(boolean stripWhitespace) { <br> <font color="#0000ff">if</font> (text.length == 0) <font color="#0000ff">return</font> <font color="#0000ff">this</font> ; <br> <font color="#0000ff">int</font> openingCharsToStrip = 0, trailingCharsToStrip=0; <br> boolean deliberateLeftTrim = deliberateLeftTrim(); <br> boolean deliberateRightTrim = deliberateRightTrim(); <br> <font color="#0000ff">if</font> (!stripWhitespace || text.length == 0 ) { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> ; <br> } <br> <font color="#0000ff">if</font> (parent.parent == <font color="#0000ff">null</font> &amp;&amp; previousSibling() == <font color="#0000ff">null</font> ) <font color="#0000ff">return</font> <br> <font color="#0000ff">this</font> ; <br> <font color="#0000ff">if</font> (!deliberateLeftTrim) { <br> trailingCharsToStrip = trailingCharsToStrip(); <br> } <br> <font color="#0000ff">if</font> (!deliberateRightTrim) { <br> openingCharsToStrip = openingCharsToStrip(); <br> } <br> <font color="#0000ff">if</font> (openingCharsToStrip == 0 &amp;&amp; trailingCharsToStrip == 0) { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> ; <br> } <br> <font color="#0000ff">this</font> .text = substring(text, openingCharsToStrip, text.length - trailingCharsToStrip); <br> <font color="#0000ff">if</font> (openingCharsToStrip &gt; 0) { <br> <font color="#0000ff">this</font> .beginLine++; <br> <font color="#0000ff">this</font> .beginColumn = 1; <br> } <br> <font color="#0000ff">if</font> (trailingCharsToStrip &gt;0) { <br> <font color="#0000ff">this</font> .endColumn = 0; <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> ; <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">* Scans forward the nodes on the same line to see whether there</font> <br> <font color="#008000">is a</font> <br> <font color="#008000">* deliberate left trim in effect. Returns true if the left trim</font> <br> <font color="#008000">was present.</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">private</font> boolean deliberateLeftTrim() { <br> boolean result = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">for</font> (TemplateElement elem = <font color="#0000ff">this</font> .nextTerminalNode(); <br> elem != <font color="#0000ff">null</font> &amp;&amp; elem.beginLine == <font color="#0000ff">this</font> .endLine; <br> elem = elem.nextTerminalNode()) <br> { <br> <font color="#0000ff">if</font> (elem instanceof TrimInstruction) { <br> TrimInstruction ti = (TrimInstruction) elem; <br> <font color="#0000ff">if</font> (!ti.left &amp;&amp; !ti.right) { <br> result = <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">if</font> (ti.left) { <br> result = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">int</font> lastNewLineIndex = lastNewLineIndex(); <br> <font color="#0000ff">if</font> (lastNewLineIndex &gt;=0 || beginColumn == 1) { <br> <font color="#0000ff">char</font> [] firstPart = substring(text, 0, lastNewLineIndex + 1); <br> <font color="#0000ff">char</font> [] lastLine = substring(text, 1+lastNewLineIndex); <br> <font color="#0000ff">if</font> (trim(lastLine).length == 0) { <br> <font color="#0000ff">this</font> .text = firstPart; <br> <font color="#0000ff">this</font> .endColumn = 0; <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">int</font> i =0; <br> <font color="#0000ff">while</font> (Character.isWhitespace(lastLine [i])) { <br> i++; <br> } <br> <font color="#0000ff">char</font> [] printablePart = substring(lastLine, i); <br> <font color="#0000ff">this</font> .text = concat(firstPart, printablePart); <br> } <br> } <br> } <br> } <br> } <br> <font color="#0000ff">if</font> (result) { <br> } <br> <font color="#0000ff">return</font> result; <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">* Checks for the presence of at or rt directive on the</font> <br> <font color="#008000">* same line. Returns true if the right trim directive was</font> <br> <font color="#008000">present.</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">private</font> boolean deliberateRightTrim() { <br> boolean result = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">for</font> (TemplateElement elem = <font color="#0000ff">this</font> .prevTerminalNode(); <br> elem != <font color="#0000ff">null</font> &amp;&amp; elem.endLine == <font color="#0000ff">this</font> .beginLine; <br> elem = elem.prevTerminalNode()) <br> { <br> <font color="#0000ff">if</font> (elem instanceof TrimInstruction) { <br> TrimInstruction ti = (TrimInstruction) elem; <br> <font color="#0000ff">if</font> (!ti.left &amp;&amp; !ti.right) { <br> result = <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">if</font> (ti.right) { <br> result = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">int</font> firstLineIndex = firstNewLineIndex() +1; <br> <font color="#0000ff">if</font> (firstLineIndex == 0) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#0000ff">if</font> (text.length &gt; firstLineIndex <br> &amp;&amp; text[firstLineIndex-1] == <font color="#A31515">'\r'</font> <br> &amp;&amp; text[firstLineIndex] == <font color="#A31515">'\n'</font> ) <br> { <br> firstLineIndex++; <br> } <br> <font color="#0000ff">char</font> [] trailingPart = substring(text, firstLineIndex); <br> <font color="#0000ff">char</font> [] openingPart = substring(text, 0, firstLineIndex); <br> <font color="#0000ff">if</font> (trim(openingPart).length ==0) { <br> <font color="#0000ff">this</font> .text = trailingPart; <br> <font color="#0000ff">this</font> .beginLine++; <br> <font color="#0000ff">this</font> .beginColumn=1; <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">int</font> lastNonWS = openingPart.length -1; <br> <font color="#0000ff">while</font> (Character.isWhitespace(text[lastNonWS])) { <br> lastNonWS--; <br> } <br> <font color="#0000ff">char</font> [] printablePart = substring(text, 0,lastNonWS+1); <br> <font color="#0000ff">if</font> (trim(trailingPart).length == 0) { <br> <font color="#008000">// THIS BLOCK IS HEINOUS! THERE MUST BE A BETTER WAY! REVISIT (JR)</font> <br> boolean trimTrailingPart = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">for</font> (TemplateElement te = <font color="#0000ff">this</font> .nextTerminalNode(); <br> te != <font color="#0000ff">null</font> &amp;&amp; te.beginLine == <font color="#0000ff">this</font> .endLine; <br> te = te.nextTerminalNode()) <br> { <br> <font color="#0000ff">if</font> (te.heedsOpeningWhitespace()) <br> { <br> trimTrailingPart = <font color="#0000ff">false</font> ; <br> } <br> <font color="#0000ff">if</font> (te instanceof TrimInstruction &amp;&amp; ((TrimInstruction) te).left) { <br> trimTrailingPart = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <font color="#0000ff">if</font> (trimTrailingPart) trailingPart = EMPTY_CHAR_ARRAY; <br> } <br> <font color="#0000ff">this</font> .text = concat(printablePart, trailingPart); <br> } <br> } <br> } <br> } <br> <font color="#0000ff">return</font> result; <br> } <br> <font color="#008000">/*</font> <br> <font color="#008000">private String leftTrim(String s) {</font> <br> <font color="#008000">int i =0;</font> <br> <font color="#008000">while (i&lt;s.length()) {</font> <br> <font color="#008000">if (!Character.isWhitespace(s.charAt(i)))</font> <br> <font color="#008000">break;</font> <br> <font color="#008000">++i;</font> <br> <font color="#008000">}</font> <br> <font color="#008000">return s.substring(i);</font> <br> <font color="#008000">}</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> firstNewLineIndex() { <br> <font color="#2B91AF">String</font> content = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> (text); <br> <font color="#0000ff">int</font> newlineIndex1 = content.indexOf( <font color="#A31515">'\n'</font> ); <br> <font color="#0000ff">int</font> newlineIndex2 = content.indexOf( <font color="#A31515">'\r'</font> ); <br> <font color="#0000ff">int</font> result = newlineIndex1 &gt;=0 ? newlineIndex1 : newlineIndex2; <br> <font color="#0000ff">if</font> (newlineIndex1 &gt;=0 &amp;&amp; newlineIndex2 &gt;=0) { <br> result = <font color="#2B91AF">Math</font> .min(newlineIndex1, newlineIndex2); <br> } <br> <font color="#0000ff">return</font> result; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> lastNewLineIndex() { <br> <font color="#2B91AF">String</font> content = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> (text); <br> <font color="#0000ff">return</font> <font color="#2B91AF">Math</font> .max(content.lastIndexOf( <font color="#A31515">'\r'</font> ), content.lastIndexOf <br> ( <font color="#A31515">'\n'</font> )); <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">* figures out how many opening whitespace characters to strip</font> <br> <font color="#008000">* in the post-parse cleanup phase.</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> openingCharsToStrip() { <br> <font color="#0000ff">int</font> newlineIndex = firstNewLineIndex(); <br> <font color="#0000ff">if</font> (newlineIndex == -1 &amp;&amp; beginColumn != 1) { <br> <font color="#0000ff">return</font> 0; <br> } <br> ++newlineIndex; <br> <font color="#0000ff">if</font> (text.length &gt; newlineIndex) { <br> <font color="#0000ff">if</font> (newlineIndex &gt;0 &amp;&amp; text[newlineIndex-1] == <font color="#A31515">'\r'</font> &amp;&amp; text[newlineIndex] == <font color="#A31515">'\n'</font> ) { <br> ++newlineIndex; <br> } <br> } <br> <font color="#0000ff">if</font> ( <font color="#0000ff">new</font> <font color="#2B91AF">String</font> (text).substring(0, newlineIndex).trim().length() &gt;0) { <br> <font color="#0000ff">return</font> 0; <br> } <br> <font color="#008000">// We look at the preceding elements on the line to see if we should</font> <br> <font color="#008000">// strip the opening newline and any whitespace preceding it.</font> <br> <font color="#0000ff">for</font> (TemplateElement elem = <font color="#0000ff">this</font> .prevTerminalNode(); <br> elem != <font color="#0000ff">null</font> &amp;&amp; elem.endLine == <font color="#0000ff">this</font> .beginLine; <br> elem = elem.prevTerminalNode()) <br> { <br> <font color="#0000ff">if</font> (elem.heedsOpeningWhitespace()) <br> { <br> <font color="#0000ff">return</font> 0; <br> } <br> } <br> <font color="#0000ff">return</font> newlineIndex; <br> } <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">* figures out how many trailing whitespace characters to strip</font> <br> <font color="#008000">* in the post-parse cleanup phase.</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">int</font> trailingCharsToStrip() { <br> <font color="#2B91AF">String</font> content = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> (text); <br> <font color="#0000ff">int</font> lastNewlineIndex = lastNewLineIndex(); <br> <font color="#0000ff">if</font> (lastNewlineIndex == -1 &amp;&amp; beginColumn != 1) { <br> <font color="#0000ff">return</font> 0; <br> } <br> <font color="#2B91AF">String</font> substring = content.substring(lastNewlineIndex +1); <br> <font color="#0000ff">if</font> (substring.trim().length() &gt;0) { <br> <font color="#0000ff">return</font> 0; <br> } <br> <font color="#008000">// We look at the elements afterward on the same line to see if weshould</font> <br> <font color="#008000">// strip any whitespace after the last newline</font> <br> <font color="#0000ff">for</font> (TemplateElement elem = <font color="#0000ff">this</font> .nextTerminalNode(); <br> elem != <font color="#0000ff">null</font> &amp;&amp; elem.beginLine == <font color="#0000ff">this</font> .endLine; <br> elem = elem.nextTerminalNode()) <br> { <br> <font color="#0000ff">if</font> (elem.heedsTrailingWhitespace()) <br> { <br> <font color="#0000ff">return</font> 0; <br> } <br> } <br> <font color="#0000ff">return</font> substring.length(); <br> } <br> <br> boolean heedsTrailingWhitespace() { <br> <font color="#0000ff">if</font> (isIgnorable()) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i=0; i&lt;text.length; i++) { <br> <font color="#0000ff">char</font> c = text[i]; <br> <font color="#0000ff">if</font> (c== <font color="#A31515">'\n'</font> || c== <font color="#A31515">'\r'</font> ) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#0000ff">if</font> (!Character.isWhitespace(c)) { <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> boolean heedsOpeningWhitespace() { <br> <font color="#0000ff">if</font> (isIgnorable()) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = text.length -1; i&gt;=0; i--) { <br> <font color="#0000ff">char</font> c = text[i]; <br> <font color="#0000ff">if</font> (c == <font color="#A31515">'\n'</font> || c == <font color="#A31515">'\r'</font> ) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#0000ff">if</font> (!Character.isWhitespace(c)) { <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> boolean isIgnorable() { <br> <font color="#0000ff">if</font> (text == <font color="#0000ff">null</font> || text.length == 0) { <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">if</font> (!isWhitespace()) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#008000">// trick here</font> <br> boolean atTopLevel = <font color="#0000ff">true</font> ; <br> TemplateElement prevSibling = previousSibling(); <br> TemplateElement nextSibling = nextSibling(); <br> <font color="#0000ff">return</font> ((prevSibling == <font color="#0000ff">null</font> &amp;&amp; atTopLevel) || nonOutputtingType(prevSibling)) <br> &amp;&amp; ((nextSibling == <font color="#0000ff">null</font> &amp;&amp; atTopLevel) || nonOutputtingType(nextSibling)); <br> } <br> <br> <font color="#0000ff">private</font> boolean nonOutputtingType(TemplateElement element) { <br> <font color="#0000ff">return</font> (element instanceof Macro || <br> element instanceof Assignment || <br> element instanceof AssignmentInstruction || <br> element instanceof PropertySetting || <br> element instanceof LibraryLoad || <br> element instanceof Comment); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">char</font> [] substring( <font color="#0000ff">char</font> [] c, <font color="#0000ff">int</font> <font color="#0000ff">from</font> , <font color="#0000ff">int</font> to) { <br> <font color="#0000ff">char</font> [] c2 = <font color="#0000ff">new</font> <font color="#0000ff">char</font> [to - <font color="#0000ff">from</font> ]; <br> System.arraycopy(c, <font color="#0000ff">from</font> , c2, 0, c2.length); <br> <font color="#0000ff">return</font> c2; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">char</font> [] substring( <font color="#0000ff">char</font> [] c, <font color="#0000ff">int</font> <font color="#0000ff">from</font> ) { <br> <font color="#0000ff">return</font> substring(c, <font color="#0000ff">from</font> , c.length); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">char</font> [] trim( <font color="#0000ff">char</font> [] c) { <br> <font color="#0000ff">if</font> (c.length == 0) { <br> <font color="#0000ff">return</font> c; <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> <font color="#2B91AF">String</font> (c).trim().toCharArray(); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">char</font> [] concat( <font color="#0000ff">char</font> [] c1, <font color="#0000ff">char</font> [] c2) { <br> <font color="#0000ff">char</font> [] c = <font color="#0000ff">new</font> <font color="#0000ff">char</font> [c1.length + c2.length]; <br> System.arraycopy(c1, 0, c, 0, c1.length); <br> System.arraycopy(c2, 0, c, c1.length, c2.length); <br> <font color="#0000ff">return</font> c; <br> } <br> <br> boolean isWhitespace() { <br> <font color="#0000ff">return</font> text == <font color="#0000ff">null</font> || trim(text).length == 0; <br> } <br> <br> }</font> <br></code> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/88979/">https://habr.com/ru/post/88979/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../88966/index.html">Easter eggs in PHP</a></li>
<li><a href="../88972/index.html">Code Like a Pythonista: Idiomatic Python (part0)</a></li>
<li><a href="../88973/index.html">Want ‚Äúholy war‚Äù - get: curly braces</a></li>
<li><a href="../88975/index.html">Features of cross-domain scripting on subdomains with XML in Opera and some other</a></li>
<li><a href="../88976/index.html">Once again about time, money, freedom, health and other resources of the individual, as well as about its two halves</a></li>
<li><a href="../88981/index.html">The girl returned the phone from repair with porn</a></li>
<li><a href="../88983/index.html">DevConf :: ASP.NET () - an event that should not be missed</a></li>
<li><a href="../88985/index.html">Firefox screen space distribution at high resolution</a></li>
<li><a href="../88993/index.html">About the page "Access to publication is limited"</a></li>
<li><a href="../88995/index.html">Very interesting concept of a wireless keyboard</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>