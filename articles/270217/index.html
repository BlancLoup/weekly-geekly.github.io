<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Play Services Research: Place Picker & Autocomplete</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Place Picker widget and Autocomplete component are powerful features of Google Play services. In this article we will look at them in detail, as well ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Play Services Research: Place Picker & Autocomplete</h1><div class="post__text post__text-html js-mediator-article">  Place Picker widget and Autocomplete component are powerful features of Google Play services.  In this article we will look at them in detail, as well as how to implement them in applications. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/256/167/e11/256167e1185944a9747dc58abf26443b.png" alt="image" align="left"><br>  With the release of Play Services 7.0, Google has made some very useful features available for implementation in our applications - two of which include the Place Picker UI and the Autocomplete component.  Both of them can help to significantly improve existing solutions in your application, or even help you implement similar functions in your future applications.  In any case, providing native and clean solutions in such frequently used functions will greatly help to improve the quality of the usage experience your application offers. <br><br>  Taking into account the fact that I have not had the opportunity to implement any of these functions since their release, I decided that it was already time to take a closer look at them. <br><a name="habracut"></a><br>  Together with this article, I created an application that allowed an experiment with these functions - you can find the code on github at the <a href="https://github.com/hitherejoe/Pickr">link</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Customization </h1><br>  Since you are still reading this here, I believe that you want to try these components in person.  So, before you put your java-hat on and write code, you need to start by adding the play-services-location dependency to your build.gradle file. <br><br> <code>compile 'com.google.android.gms:play-services-location:8.1.0'</code> <br> <br>  <b>Note:</b> In the event that you are not familiar with the format used, you only need to declare the dependency of the play service you will use.  For more information, I recommend reading <a href="https://developers.google.com/android/guides/setup">this manual</a> . <br><br>  In addition, you will also need to register an API key when using location services, which can be done in the following <a href="https://developers.google.com/places/android-api/signup">guide</a> .  Once you have completed the registration, you will need to add the API key and the play services version to your manifest file, as shown below: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.google.android.geo.API_KEY"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"YOUR_API_KEY"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.google.android.gms.version"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@integer/google_play_services_version"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><h1>  Place picker </h1><br>  The place picker is a user interface component that provides the ability to interact with an interactive map based on the current geographical location of the device.  This map can be used to select nearby locations in one of two ways: <br><br><ul><li>  <b>Selection of the current location</b> - The user can move the map displayed on the screen to select a location if the automatically selected one does not suit him. </li><li>  <b>Selecting a place nearby</b> - The user can choose a place from the list of places located near his current location; this list can be opened by dragging from the bottom of the map. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Selection on the map</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/077/5f2/3cb/0775f23cbb06073d59429b4265f0c5af.png" alt="image"></div></div><br><div class="spoiler">  <b class="spoiler_title">Select from the list</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/91d/fbb/f4a/91dfbbf4a03e12d4e5925c17eb474186.png" alt="image"></div></div><br>  The obvious question is, ‚ÄúWhy do we use it?‚Äù <br><br><ul><li>  <b>Development time is significantly reduced</b> - Components are ready straight-out-of-the-box, which means that all functions (map, locations, life cycle, network requests, etc.) are completely controlled by the widget.  Compared to how this can be done manually, time is simply enormous. </li><li>  <b>Consistent experience of use</b> - Using this component not only by Google, but also by third-party developers (like you) makes the user experience much easier, since they already know this component, which eliminates the extra time to learn how to work with it. </li></ul><br><br><h3>  Operational process </h3><br>  So now we know what we are dealing with, everything looks as if we are ready to begin.  There are several important operations that are always present in the Place Picker life cycle, which we will now review. <br><br><ul><li>  Opening Place Picker using the startActivityForResult () method, the moment when we catch the selected place returned by our activity. </li><li>  The next step is to decide the initial location on the map.  If the place is provided in advance - we use it, otherwise the current position of the device will be selected. </li><li>  Whether the user chooses a place on the map or from a list of places nearby, or will close the place picker without making a choice. </li><li>  As soon as the selection is made, the place picker is completed and the result (selected location) is returned to our activity. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Operational process Place Picker</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/bae/416/b45/bae416b452aa724b436a07e80d18e25f.png" alt="image"></div></div><br><br><h3>  Implementation </h3><br>  First we need to create a new builder instance using the IntentBuilder from the Place Picker class. <br><br><pre> <code class="java hljs">PlacePicker.IntentBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlacePicker.IntentBuilder();</code> </pre><br>  Using this builder, we can set the initial boundaries of the dogma latitude that will be used by the place picker instance.  As mentioned earlier, if the initial value is not set then by default our place picker will use the current position of the device as <code>LatLngBounds</code> . <br><br><pre> <code class="java hljs">builder.setLatLngBounds(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LatLngBounds(...));</code> </pre><br>  Once this is done, we start the picker using the <code>startActivityForResult()</code> method, passing an instance of the place picker and the request code as parameters to our builder.  As mentioned earlier, the selected place ( <i>Place</i> ) from Place Picker is returned to our activity in <code>onActivityResult</code> , where we use the request code <b>PLACE_PICKER_REQUEST</b> to filter the results. <br><br><pre> <code class="java hljs">startActivityForResult(builder.build(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), PLACE_PICKER_REQUEST);</code> </pre><br>  When the <code>startActivityForResult</code> method is <code>startActivityForResult</code> , the place picker widget in the new activity will be opened.  Here the user will make a choice using the current position or location based on the recommendations.  As soon as the place picker is closed, our <code>onActivityResult</code> will be called: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resultCode, Intent data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requestCode == PLACE_PICKER_REQUEST) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultCode == RESULT_OK) { Place selectedPlace = PlacePicker.getPlace(data, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Do something with the place } } }</span></span></code> </pre><br>  As shown above, we retrieve our selected place ( <i>Place</i> ) when activity returns it to us.  We do this as follows: <br><br><pre> <code class="java hljs">Place selectedPlace = PlacePicker.getPlace(data, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  In this place, if the user uses the <i>back</i> button to exit the picker widget without selecting a location, then the result will not be returned. <br><br>  <b>Note</b> : You will need to give your application the following rights - <a href="https://developer.android.com/reference/android/Manifest.permission.html">ACCESS_FINE_LOCATION</a> in order to use the <i>Place Picker</i> widget. <br><br><h3>  Themes </h3><br><br>  To stay in the same theme with your application, by default the Place Picker widget will use the colors of your application: <br><ul><li>  <i>colorPrimary</i> - Will be used as the text and arrow color <i>back</i> in the action bar of the application. </li><li>  <i>colorPrimaryDark</i> - This will be used as the background color for the action bar. </li></ul><br>  Be careful and check back the set color attributes of the theme. <br><br><h3>  Beacon Signals </h3><br>  With the release of play services 7.8, the place picker widget can also use signals from nearby beacons to determine the current location of the device.  This works thanks to the <code>PlaceId</code> detected beacon ( <i>beacon</i> ) along with the other detected signals that are available to the device (network, wifi, etc.).  Based on the collected geo-data, a list of recommendations will be built for displaying to the user as 'Places nearby' in the Place Picker component. <br><br><h1>  Place Autocomplete </h1><br>  Place Autocomplete is a new component that can be used to return a list of recommended places nearby based on a search query, where the result is offset from the current location of the device.  Previously, to achieve this result, it was necessary to call the API of sites directly, but now the same can be done by wrapping GoogleApiClient automatically. <br><br>  To begin, we must create a new instance of the GoogleApiClient class.  For this we will use GoogleApiClient builder, where we also need to specify that we want to use the Places API: <br><br><pre> <code class="java hljs">mGoogleApiClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GoogleApiClient.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .enableAutoManage(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .addApi(Places.GEO_DATA_API) .build();</code> </pre><br>  As a result of the search query, the current location will query the Auto Complete API using this instance. <br><br>  Since RxJava is currently part of my workflow, I decided to implement this with observables.  I suggest you look at the <a href="">completed class</a> to understand the code: <br><br><ul><li>  We are starting to use the Places API to retrieve a list of auto-complete predictions based on the provided search queries and latitude-longitude boundaries. </li></ul><br><pre> <code class="java hljs">PendingResult&lt;AutocompletePredictionBuffer&gt; results = Places.GeoDataApi.getAutocompletePredictions( mGoogleApiClient, query, bounds, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  <b>Note</b> : Providing an <code>LatLngBounds</code> instance does not limit the results to these bounds.  The results will be shifted within the limits provided, which means that places nearby will be given higher priority. <br><br>  The <code>PendingResult</code> method <code>PendingResult</code> used to retrieve data from Google Play Services by accessing the API.  We do this using the <code>await()</code> method to give the <code>PendingResult</code> some time to return data to us. <br><br><pre> <code class="java hljs">AutocompletePredictionBuffer autocompletePredictions = results.await(<span class="hljs-number"><span class="hljs-number">60</span></span>, TimeUnit.SECONDS);</code> </pre><br>  As soon as we wait for the result, we can check the status of our DataBuffer to check the success of the request: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Status status = autocompletePredictions.getStatus(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!status.isSuccess()) { autocompletePredictions.release(); subscriber.onError(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (AutocompletePrediction place : autocompletePredictions) { subscriber.onNext( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutocompletePlace( place.getPlaceId(), place.getDescription() )); } autocompletePredictions.release(); subscriber.onCompleted(); }</code> </pre><br>  If the request is completed successfully, we return a set of <i>AutocompletePrediction</i> objects, which in theory are the minimal Place object.  Since this will not be enough to display useful information to the user, we use <code>placeId</code> to get the complete Place object with the API.  This is done by binding queries to our <i>observable</i> stream, where we get place in this way: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> PendingResult&lt;PlaceBuffer&gt; placeResult = Places.GeoDataApi.getPlaceById(mGoogleApiClient, id); placeResult.setResultCallback(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResultCallback&lt;PlaceBuffer&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PlaceBuffer places)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!places.getStatus().isSuccess()) { places.release(); subscriber.onError(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(...)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { subscriber.onNext( PointOfInterest.fromPlace(places.get(<span class="hljs-number"><span class="hljs-number">0</span></span>))); places.close(); subscriber.onCompleted(); } } });</code> </pre><br>  <b>Note</b> : Do not forget to call <code>release</code> for a <i>PlaceBuffer</i> instance. <br><br>  These results Place will then be returned to the <i>activity</i> and displayed as a result of the recyclerview search.  Then it works like the <i>Place Picker</i> example, when autocomplete predictions are selected from the list, it returns to the <i>MainActivity</i> and displays it in the list of saved Places. <br><br><h3>  findings </h3><br>  I hope that from this article you can conclude how demonstrated services are easy to implement and configure, and I hope you will use them in your applications. <br><br>  Although the standard <code>MapView</code> is still used in many different situations (mainly for fine tuning and increased functionality, Place Picker will be useful when you do not need any advanced features. The same applies to the Autocomplete component , again, you can independently implement an API call to get recommendations based on geodata, but using <code>GoogleApiClient</code> is much easier. Saying this, I believe that the components provided in Play Services will be enough to solve more  The challenges of everyday tasks. </div><p>Source: <a href="https://habr.com/ru/post/270217/">https://habr.com/ru/post/270217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270207/index.html">Metronome IM and Jappix: a multi-functional Jabber, without difficulty in setting up</a></li>
<li><a href="../270209/index.html">Ansible 2.0 b2. Overview of innovations</a></li>
<li><a href="../270211/index.html">Monstrous frankenstek</a></li>
<li><a href="../270213/index.html">Office as Platform: how was a Notegram project for OneNote created?</a></li>
<li><a href="../270215/index.html">Event-oriented Python backtesting step by step. Part 5 (and last)</a></li>
<li><a href="../270219/index.html">Unity Cloud Build or how to build an iOS build on Windows</a></li>
<li><a href="../270223/index.html">Download and convert video to Rutube: from crutches to meta-programming</a></li>
<li><a href="../270225/index.html">Double cycle KCS. Just about knowledge management.</a></li>
<li><a href="../270227/index.html">Translation: how gitLab uses unicorn and unicorn-worker-killer</a></li>
<li><a href="../270229/index.html">Visual Studio Online: Continuous Integration and Testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>