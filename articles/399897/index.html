<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why do you need to navigate the shopping center in Vkontakte, Telegram and Facebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is still difficult to say why I went with a girl to Ikea on March 6. Before the holiday there was a bunch of people inside. The girl needed some tr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why do you need to navigate the shopping center in Vkontakte, Telegram and Facebook</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/10b/bc7/ea4/10bbc7ea44e44f459256e738addaacd4.png"><br><p><br>  It is still difficult to say why I went with a girl to Ikea on March 6.  Before the holiday there was a bunch of people inside.  The girl needed some trifle, in my opinion, a candlestick.  In order not to push in the queues, I decided to install the Ikea application, saying ‚Äúright now we will find this damn thing like clockwork.‚Äù </p><a name="habracut"></a><br><p>  Heavy application through the local wifi was installed slowly.  Vayfay himself constantly lost.  I was sweating and swearing, but it was not put.  We found this trifle, but spent too much nerves. </p><br><p>  The company in which I work, just made navigation terminals for Ikea in Khimki.  Therefore, after the holidays, the developers came and complained to this difficult and unpleasant situation.  Hoped that there is some simple way to search. <br>  The developers explained that indoor mobile navigation (indoor navigation) is developing towards iBeacon beacons, which do not work without an application.  So, the application will need to download anyway. </p><br><p>  I have nothing against applications, but it's silly to put them for the sake of any nonsense.  Well, if suddenly my hand disappears from the mall, then I can install the application to immediately find a pharmacy.  But for the candlestick - it is unlikely. </p><br><p>  The idea stalled until we noticed the noise around the chatbot.  And it seemed to us that here it is - a great decision!  The bot does not need to be installed, and it works like one big search field.  In general, eat coconuts - chew bananas, enter requests - get answers. </p><br><p>  There was a small question - how to connect, known from Yandex.Maps and 2Gis, navigation interface with a text bot.  All of us use navigators: I opened the application, determined my location by GPS, poked into the right house and follow the route.  If you make a mistake somewhere, the program will correct you and tell you where to turn to return to the route.  Everything is thoughtful and convenient.  And in the bot there is nothing of this. </p><br><div class="spoiler">  <b class="spoiler_title">Messengers that the bot is currently working on</b> <div class="spoiler_text"><p>  Vkontakt seemed to us the most obvious base for the bot - it has the largest audience in Russia and the overwhelming majority have its application in the phone.  And the fact that VKontakte rolled out the Callback API was very helpful.  At this API, we made the first bot (now the bot is working in the Telegram and is doing the Facebook version with might and main). </p></div></div><br><h3 id="kak-ponimat-gde-chelovek-nahoditsya-esli-bot-ne-mozhet-ispolzovat-datchiki-telefona">  How to understand where a person is, if the bot can not use the sensors of the phone? </h3><br><p>  Familiar navigation interfaces quite accurately know where the phone is (and its owner), thanks to the satellites.  Inside the premises, the satellites do not work, but there are beacons iBeacon, which determine the coordinates of the phone.  In order for the beacons to work, you need a prepared application and Bluetooth 4.0.  But popular messengers do not work with iBeacon and are unlikely to ever be. </p><br><p>  Therefore, we don't know a damn thing about the coordinates of the user. </p><br><p>  And to know where the user is, you need to build routes.  That is, if a person asks us where ‚ÄúNike‚Äù is, then we will show him where Nike is on the map, but we won‚Äôt tell you how to get there.  And without a route, indor navigation is not really a very useful thing. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/files/7de/6eb/fe8/7de6ebfe8a5f47148b179bb1531b3665.jpg" height="80%" width="80%"></div>  <sub>The letter "A" bot showed me the place that I was looking for.</sub>  <sub>I have a smartphone with a large screen and all the inscriptions read well.</sub>  <sub>But, if I am standing somewhere far from anchor tenants, I still can‚Äôt navigate - you need a route</sub> <p></p><br><p>  Then we presented how a person would ask the route from his friend in the same messenger.  A friend also does not have access to the sensors, so you have to somehow explain without coordinates.  Most likely, a person would say what shops are around him.  A friend would say: ‚ÄúFace the% brand_name%.  Go left up the escalator and climb on it.  There you will see on the left. " </p><br><p>  We did the same thing - that is, we build routes not between the user and the object, but between the objects.  Of course, the bot cannot explain the route indefinitely (‚ÄúYou will see there on the left‚Äù), but it can neatly navigate past the shops with clues he knows. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/35c/3db/386/35c3db3863654f4797fb37c657c69e3b.png" height="50%" width="50%"></div><br><p>  <sub>I stand at Auchan and I need to go to Chalcedony (I wonder why?).</sub>  <sub>In the request, I use a comma to make the bot understand that these are different shops</sub> </p><br><p>  Such a system of route formation, by the way, also speeds up the process - the coordinates of the stores are already in memory and there is no need to calculate the coordinates of the phone (for ordinary systems, such as Yandex.Card, it takes a few seconds).  Plus, the last time I checked, the beacons could sometimes give an error of 10 meters.  For a mall this is essential </p><br><h3 id="kak-pokazyvat-neskolko-podhodyaschih-pod-zapros-pomescheniy-naprimer-chto-pokazyvat-na-zapros-tualet">  How to show a few suitable premises for a request?  For example, what to show on the query "toilet"? </h3><br><p>  Toilet - Alpha and Omega Indore-Navigation.  In any shopping center where our navigators stand, the toilet is in the top 2 search queries.  Because: </p><br><ol><li>  They all need.  And need, usually, quickly and abruptly. </li><li>  They are made in the darkest hole of the shopping center, behind an iron door with a long corridor. </li><li>  They forget to hang the navigation signs. </li><li>  They do not change their location, unlike ATMs, which are also super popular. </li></ol><br><p>  Searching for a toilet is a great task for the bot.  And by all indications, the bot will handle the application better.  At least, because in case of extreme need, I don‚Äôt want to install the application at all.  As a maximum, because in the dark holes of the shopping center may not be beacons. </p><br><div class="spoiler">  <b class="spoiler_title">Are navigation applications and bot competitors?</b> <div class="spoiler_text"><p>  If you look at the tasks, then everything looks as if the applications and the bot really compete.  There and there navigation.  There and there is a shopping search, a route and tips.  It all looks about the same. </p><br><p>  But we believe that the bot still does not compete with the application, because the input conditions are different.  Applications (we are talking about applications like Navigine) are simply created for thoughtful shopping, and the bot is for spontaneous and quick search. </p><br><p>  If you are going to have a good shopping, buy clothes for the whole family or participate in some bonus programs, put the application.  If you went to the mall for the first time to buy socks, then it is better to go to the bot.  As a result, the application should work with a loyal audience, and the bot with the rest. </p></div></div><br><p>  Usually in a shopping center there is not one toilet and on the map they are all called the same.  It is also impossible to poke into the map and choose the one you need - the bot sends ordinary pictures.  Then how to explain to a person where the object he needs is?  Now we fully list all the relevant objects, and mark the first five with large icons on the map. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a93/c49/61f/a93c4961ff5c4ffa89eb11f99062b9b1.jpg" height="50%" width="50%"></div><br><p>  <sub>Such a sheet is now sent by the bot to the request ‚ÄúClothing‚Äù.</sub>  <sub>It is clear that in any shopping center there will be such a sheet, not only in Peter Raduga - the SEC for which we did the search</sub> </p><br><p> The solution raises questions and when there are many floors in the room - many pictures come.  And if Facebook has a ‚Äúcarousel‚Äù built in for these cases, then Vkontakte and Telegram send sheets: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7bd/ae0/af8/7bdae0af83254de08fe9dcc9e4ebdc0d.jpg" height="50%" width="50%"></div><br><p>  <sub>The same request "Clothing", only in the high-rise shopping mall "Family."</sub>  <sub>Such answers will come to 4 floors</sub> </p><br><p>  Opinions in the team were divided.  Some say that this is necessary, let users write requests more precisely, others say that it is not necessary and let the answer come compactly.  If you have thoughts on this subject, then tell us in the comments. </p><br><p>  Further, how do we guide a person to the desired object from the category?  It seems to be obvious that the request should be like to other stores.  You write ‚ÄúAuchan, toilet‚Äù, and the bot leads you to the bathroom closest to Auchan. </p><br><p>  But there are toilets for men, women, for the disabled and children.  Sometimes different types of toilets are on different floors (yes, yes).  Then we need not just to lead the person to the nearest toilet, but also to determine his gender, children and disability. </p><br><p>  Sometimes under one category combines several not very similar premises.  The category ‚Äúeat‚Äù unites all restaurants, cafes and coffee houses of the shopping center, how can we find out what the user likes and wants. </p><br><p>  Vkontakte allows us to determine the gender, but Telegram does not.  About children and disability, in the context of the toilet, taste preferences, dreams and desires of the user, we can only guess at all. </p><br><h3 id="kak-vsemu-etomu-nauchit-cheloveka">  How to teach all this man? </h3><br><p>  In the bot, everything works wrong, this is not a cozy Yandex.Maps.  And all this we need to teach the user.  We pushed off from what our bot can do: </p><br><ol><li>  Show one point for a specific query. </li><li>  Show route between points with hints. </li><li>  Show a bunch of points on a categorical request. </li></ol><br><p>  Right on these points we conduct training: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3f6/710/b91/3f6710b912d548b2a3d4c71084b20626.png" height="50%" width="50%"></div><br><p>  The main problem of the tutorial in the text interface is that it is long and people do not always reach the end.  On the other hand, if you do not give a tutorial, the user will leave even faster.  In general, standard tutorial problems.  It is difficult to come up with any tricks here, and we could not find suitable examples for the bot. </p><br><h3 id="s-kakimi-trudnostyami-my-stolknulis-pohodu">  What difficulties did we encounter? </h3><br><div class="spoiler">  <b class="spoiler_title">Difficulty 1</b> <div class="spoiler_text"><p>  People write the names of the stores, as God put them in his head, with errors and errors.  In addition, there are well-established names of some brands (McDuck, Sber), transliterated names (Zara, Insiti) and incomprehensible names (L'occitane is read loxitan). </p><br><p>  <strong>As decided:</strong> <br>  We took the algorithm for calculating the distance Damerau - Levenshteyn.  Who does not know, it allows you to calculate how much you need to do operations to turn one word (phrase, sentence) into another. </p><br><p>  We modified the algorithm and added a search for a substring and a search for subsequences from the <a href="https://fuzzystring.codeplex.com/">FuzzyString</a> library.  Completed the search for transliteration of words using the <a href="https://github.com/nick-buhro/Translit">library</a> .  The result is a <a href="https://habrahabr.ru/post/114997/">fuzzy search</a> algorithm. </p><br><p>  It is clear that no fuzzy search will combine L'Occitane and Loxitan.  For this we use a dictionary of synonyms.  He keeps folklore names: "Mac", "McDuck" for McDonald's and the like.  Add to the database, search by keyword, in order to find McDonalds by BigTasties. </p><br><p>  In general, it looks like this: </p><br><ol><li>  A person enters a query, for example, "Lapsitan" (apparently heard with the edge of his ear). </li><li>  Next, the bot is looking for a modified algorithm Damerau - Levenshteyna. <br>  a.  By name. <br>  b.  By synonyms. <br>  c.  By keywords. </li><li>  In case of failure, a search is performed for a substring and / or a subsequence. <br>  a.  By name. <br>  b.  By synonyms. <br>  c.  By keywords. <br>  In our case, the bot will find L'Occitane already at step 2-b, you can check. </li></ol></div></div><br><div class="spoiler">  <b class="spoiler_title">Difficulty 2</b> <div class="spoiler_text"><p>  We had problems with restrictions on the number of requests to the API.  Vkontakte has 3 requests per second.  Quite seriously, considering that even to pretend that the bot read the message is also a request to the API. </p><br><p>  <strong>As decided:</strong> </p><br><p>  Vkontakt itself proposes to circumvent this restriction by the execute method, which allows you to pack 25 requests into one. </p><br><p>  So we did, but so far the Vkontakte bot does not pass the load test.  Therefore, we are now implementing the request processing queue, which should help. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Difficulty 3</b> <div class="spoiler_text"><p>  Vkontakte user received the text of the route, but the picture did not come.  Vkontakte explained to us: "It looks like you just stumbled upon a problem server." </p><br><p>  <strong>As decided:</strong> </p><br><p>  Tech support offered us ‚Äúnext time, add the https = 1 parameter to the request or transfer the latest version of the API‚Äù.  The next time was not yet, but I hope someone will blow on the water. </p></div></div><br><h3 id="kak-nas-podderzhat">  How to support us? </h3><br><p>  Use a bot and subscribe to our group in Vkontakte or to our bot in Telegram.  Moreover, the New Year holidays on the nose, come in handy. </p><br><p>  So far there are three shopping centers: Columbus in Moscow, Peter Rainbow in St. Petersburg and Family in Perm.  Be sure to write to the shopping centers that you want to see directly in the bot (in the choice of shopping centers).  So we will quickly agree with these shopping centers and add them to the database. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/399897/">https://habr.com/ru/post/399897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../399887/index.html">Review-thinking or why laptops are waiting for oblivion</a></li>
<li><a href="../399889/index.html">Pain in the hands when working at the computer. Part 5. Carpal tunnel syndrome</a></li>
<li><a href="../399891/index.html">Ask Ethan # 112: Should You Be Afraid of the End of the Universe?</a></li>
<li><a href="../399893/index.html">POST-codes in the smartphone? - already reality</a></li>
<li><a href="../399895/index.html">Startup blast</a></li>
<li><a href="../399899/index.html">Elektroovtsy ate people: the possible consequences of the development of AI for the labor market</a></li>
<li><a href="../399903/index.html">Car Digest: What to read, watch and listen to the New Year holidays</a></li>
<li><a href="../399905/index.html">Find my car: autoblockchain HashCoins against hijackings and "not a bit, not beautiful" ads</a></li>
<li><a href="../399907/index.html">Installing FreeRTOS for Stm32vlDiscovery</a></li>
<li><a href="../399909/index.html">Mathematics of Biological Switches</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>