<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of declarative programming in Lua</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lua is a powerful, fast, easy, extensible and embedded scripting programming language. Luah is convenient to use for writing business logic applicatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of declarative programming in Lua</h1><div class="post__text post__text-html js-mediator-article">  Lua is a powerful, fast, easy, extensible and embedded scripting programming language.  Luah is convenient to use for writing business logic applications. <br><br>  Separate parts of application logic are often conveniently described in a <a href="http://en.wikipedia.org/wiki/Declarative_programming">declarative style</a> .  The declarative programming style differs from the much more imperative imperative in that it describes, first of all, <b>what is</b> something and not exactly how it is created.  Writing code in a declarative style often allows you to hide unnecessary implementation details. <br><br>  Lua is a <a href="http://en.wikipedia.org/wiki/Multi-paradigm">multi</a> - <a href="http://en.wikipedia.org/wiki/Multi-paradigm">paradigm programming language</a> .  One of Lua's strengths is good support for declarative style.  In this article, I will briefly describe the basic declarative means provided by the language of Lua. <br><a name="habracut"></a><br><h3>  Example </h3><br>  As a naive example, let's take the code for creating a dialog box with a text message and an imperative button: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><font color="#b1b100">function</font> build_message_box <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_dialog <font color="#66cc66">=</font> gui_builder:dialog <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:set_title <font color="#66cc66">(</font> <font color="#ff0000">"Message Box"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_label <font color="#66cc66">=</font> gui_builder:label <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_label:set_font_size <font color="#66cc66">(</font> <font color="#cc66cc">20</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_label:set_text <font color="#66cc66">(</font> <font color="#ff0000">"Hello, world!"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:add <font color="#66cc66">(</font> my_label <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_button <font color="#66cc66">=</font> gui_builder:button <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_button:set_title <font color="#66cc66">(</font> <font color="#ff0000">"OK"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:add <font color="#66cc66">(</font> my_button <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">return</font> my_dialog&lt;br/&gt; <br> <font color="#b1b100">end</font></code> </blockquote> <br>  In a declarative style, this code could look like this: <br><br><blockquote> <code>build_message_box <font color="#66cc66">=</font> gui:dialog <font color="#ff0000">"Message Box"</font> &lt;br/&gt; <br> <font color="#66cc66">{</font> &lt;br/&gt; <br> gui:label <font color="#ff0000">"Hello, world!"</font> <font color="#66cc66">{</font> font_size <font color="#66cc66">=</font> <font color="#cc66cc">20</font> <font color="#66cc66">}</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> gui:button <font color="#ff0000">"OK"</font> <font color="#66cc66">{</font> <font color="#66cc66">}</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> <font color="#66cc66">}</font></code> </blockquote> <br>  Much more visible.  But how to make it work? <br><br><h3>  The basics </h3><br>  To understand what's the matter, you need to know about some features of the language of the Loa.  I will superficially talk about the most important for understanding this article.  More information can be found at the links below. <br><br><h4>  Dynamic typing </h4><br>  It is important to remember that Lua is a language with dynamic typing.  This means that a type in a language is not associated with a variable, but with its value.  The same variable can take values ‚Äã‚Äãof different types: <br><br><blockquote> <code>a <font color="#66cc66">=</font> <font color="#ff0000">"the meaning of life"</font> <font color="#808080">--&gt;  ,</font> &lt;br/&gt; <br> a <font color="#66cc66">=</font> <font color="#cc66cc">42</font> <font color="#808080">--&gt;  </font></code> </blockquote> <br><h4>  Tables </h4><br>  Tables (table) - the main means of data composition in Lua.  A table is a record and an array and a dictionary and set and object. <br><br>  For programming on Lois it is very important to know this type of data well.  I will briefly discuss only the most important details for understanding. <br><br>  Tables are created using the ‚Äútable constructor‚Äù - a pair of curly braces. <br><br>  Create an empty table t: <br><br><blockquote> <code>t <font color="#66cc66">=</font> <font color="#66cc66">{</font> <font color="#66cc66">}</font></code> </blockquote> <br>  We write in the table t the string ‚Äúone‚Äù by key 1 and the number 1 by key ‚Äúone‚Äù: <br><br><blockquote> <code>t <font color="#66cc66">[</font> <font color="#cc66cc">1</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#ff0000">"one"</font> &lt;br/&gt; <br> t <font color="#66cc66">[</font> <font color="#ff0000">"one"</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#cc66cc">1</font></code> </blockquote> <br>  The contents of the table can be specified when creating it: <br><br><blockquote> <code>t <font color="#66cc66">=</font> <font color="#66cc66">{</font> <font color="#66cc66">[</font> <font color="#cc66cc">1</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#ff0000">"one"</font> , <font color="#66cc66">[</font> <font color="#ff0000">"one"</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#cc66cc">1</font> <font color="#66cc66">}</font></code> </blockquote> <br>  A table in Lua can contain keys and values ‚Äã‚Äãof all types (except nil).  But most often positive keys are used as keys (array) or strings (record / dictionary).  The language provides special tools for working with these types of keys.  I will focus only on the syntax. <br><br>  <b>First:</b> when creating a table, you can omit the positive integer keys for successive elements.  In this case, the elements receive the keys in the same order in which they are specified in the table constructor.  The first implicit key is always one.  Explicitly specified keys are ignored when issuing implicit ones. <br><br>  The following two recording forms are equivalent: <br><br><blockquote> <code>t <font color="#66cc66">=</font> <font color="#66cc66">{</font> <font color="#66cc66">[</font> <font color="#cc66cc">1</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#ff0000">"one"</font> , <font color="#66cc66">[</font> <font color="#cc66cc">2</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#ff0000">"two"</font> , <font color="#66cc66">[</font> <font color="#cc66cc">3</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#ff0000">"three"</font> <font color="#66cc66">}</font> &lt;br/&gt; <br> t <font color="#66cc66">=</font> <font color="#66cc66">{</font> <font color="#ff0000">"one"</font> , <font color="#ff0000">"two"</font> , <font color="#ff0000">"three"</font> <font color="#66cc66">}</font></code> </blockquote> <br>  <b>Secondly:</b> When using string literals as keys, quotation marks and square brackets can be omitted if the literal satisfies the <a href="http://www.lua.org/manual/5.1/manual.html">constraints imposed on the identifiers</a> . <br><br>  When creating a table, the following two recording forms are equivalent: <br><br><blockquote> <code>t <font color="#66cc66">=</font> <font color="#66cc66">{</font> <font color="#66cc66">[</font> <font color="#ff0000">"one"</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#cc66cc">1</font> <font color="#66cc66">}</font> &lt;br/&gt; <br> t <font color="#66cc66">=</font> <font color="#66cc66">{</font> one <font color="#66cc66">=</font> <font color="#cc66cc">1</font> <font color="#66cc66">}</font></code> </blockquote> <br>  Similarly, for indexing when writing ... <br><br><blockquote> <code>t <font color="#66cc66">[</font> <font color="#ff0000">"one"</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#cc66cc">1</font> &lt;br/&gt; <br> t.one <font color="#66cc66">=</font> <font color="#cc66cc">1</font></code> </blockquote> <br>  ... And while reading: <br><br><blockquote> <code><font color="#b1b100">print</font> <font color="#66cc66">(</font> t <font color="#66cc66">[</font> <font color="#ff0000">"one"</font> <font color="#66cc66">]</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> t.one <font color="#66cc66">)</font></code> </blockquote> <br><h4>  Functions </h4><br>  Functions in Lua are <a href="http://en.wikipedia.org/wiki/First-class_value">first class values</a> .  This means that the function can be used in all cases as a string: assign it to a variable, store it in a table as a key or value, transfer it as an argument or return value to another function. <br><br>  Functions in Lua can be created dynamically anywhere in the code.  At the same time, not only its arguments and global variables are available inside the function, but also local variables from external scopes.  Functions in Lua, in fact, are <a href="http://www.lua.org/pil/6.1.html">closures</a> . <br><br><blockquote> <code><font color="#b1b100">function</font> make_multiplier <font color="#66cc66">(</font> coeff <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> value <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> value <font color="#66cc66">*</font> coeff&lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">local</font> x5 <font color="#66cc66">=</font> make_multiplier <font color="#66cc66">(</font> <font color="#cc66cc">5</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> x5 <font color="#66cc66">(</font> <font color="#cc66cc">10</font> <font color="#66cc66">)</font> <font color="#66cc66">)</font> <font color="#808080">--&gt; 50</font></code> </blockquote> <br>  It is important to remember that the ‚Äúdeclaration of a function‚Äù in Lua is actually syntactic sugar that hides the creation of a value of the ‚Äúfunction‚Äù type and assigns it to a variable. <br><br>  The following two ways to create a function are equivalent.  A new function is created and assigned to the global variable mul. <br><br>  With sugar: <br><br><blockquote> <code><font color="#b1b100">function</font> mul <font color="#66cc66">(</font> lhs, rhs <font color="#66cc66">)</font> <font color="#b1b100">return</font> lhs <font color="#66cc66">*</font> rhs <font color="#b1b100">end</font></code> </blockquote> <br>  Sugarless: <br><br><blockquote> <code>mul <font color="#66cc66">=</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> lhs, rhs <font color="#66cc66">)</font> <font color="#b1b100">return</font> lhs <font color="#66cc66">*</font> rhs <font color="#b1b100">end</font></code> </blockquote> <br><h4>  A function call without parentheses </h4><br>  In Lua, you can not put parentheses when calling a function <b>with a single argument</b> , if this argument is a <b>string literal</b> or <b>a table constructor</b> .  This is very useful when writing code in a declarative style. <br><br>  String literal: <br><br><blockquote> <code>my_name_is <font color="#66cc66">=</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> name <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> <font color="#ff0000">"Use the force,"</font> , name <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> my_name_is <font color="#ff0000">"Luke"</font> <font color="#808080">--&gt; Use the force, Luke</font></code> </blockquote> <br>  Sugarless: <br><br><blockquote> <code>my_name_is <font color="#66cc66">(</font> <font color="#ff0000">"Luke"</font> <font color="#66cc66">)</font></code> </blockquote> <br>  Table Designer: <br><br><blockquote> <code>shopping_list <font color="#66cc66">=</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> items <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> <font color="#ff0000">"Shopping list:"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">for</font> name, qty <font color="#b1b100">in</font> <font color="#b1b100">pairs</font> <font color="#66cc66">(</font> items <font color="#66cc66">)</font> <font color="#b1b100">do</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> <font color="#ff0000">"*"</font> , qty, <font color="#ff0000">"x"</font> , name <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> shopping_list&lt;br/&gt; <br> <font color="#66cc66">{</font> &lt;br/&gt; <br> milk <font color="#66cc66">=</font> <font color="#cc66cc">2</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> bread <font color="#66cc66">=</font> <font color="#cc66cc">1</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> apples <font color="#66cc66">=</font> <font color="#cc66cc">10</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> <font color="#66cc66">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#808080">--&gt; Shopping list:</font> &lt;br/&gt; <br> <font color="#808080">--&gt; * 2 x milk</font> &lt;br/&gt; <br> <font color="#808080">--&gt; * 1 x bread</font> &lt;br/&gt; <br> <font color="#808080">--&gt; * 10 x apples</font></code> </blockquote> <br>  Sugarless: <br><br><blockquote> <code>shopping_list <font color="#66cc66">(</font> &lt;br/&gt; <br> <font color="#66cc66">{</font> &lt;br/&gt; <br> milk <font color="#66cc66">=</font> <font color="#cc66cc">2</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> bread <font color="#66cc66">=</font> <font color="#cc66cc">1</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> apples <font color="#66cc66">=</font> <font color="#cc66cc">10</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> <font color="#66cc66">}</font> &lt;br/&gt; <br> <font color="#66cc66">)</font></code> </blockquote> <br><h4>  Call chains </h4><br>  As I mentioned, a function in Lua can return another function (or even itself).  The returned function can be called immediately: <br><br><blockquote> <code><font color="#b1b100">function</font> chain_print <font color="#66cc66">(</font> ... <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> ... <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> chain_print&lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> chain_print <font color="#66cc66">(</font> <font color="#cc66cc">1</font> <font color="#66cc66">)</font> <font color="#66cc66">(</font> <font color="#ff0000">"alpha"</font> <font color="#66cc66">)</font> <font color="#66cc66">(</font> <font color="#cc66cc">2</font> <font color="#66cc66">)</font> <font color="#66cc66">(</font> <font color="#ff0000">"beta"</font> <font color="#66cc66">)</font> <font color="#66cc66">(</font> <font color="#cc66cc">3</font> <font color="#66cc66">)</font> <font color="#66cc66">(</font> <font color="#ff0000">"gamma"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#808080">--&gt; 1</font> &lt;br/&gt; <br> <font color="#808080">--&gt; alpha</font> &lt;br/&gt; <br> <font color="#808080">--&gt; 2</font> &lt;br/&gt; <br> <font color="#808080">--&gt; beta</font> &lt;br/&gt; <br> <font color="#808080">--&gt; 3</font> &lt;br/&gt; <br> <font color="#808080">--&gt; gamma</font></code> </blockquote> <br>  In the example above, you can omit the parentheses around string literals: <br><br><blockquote> <code>chain_print <font color="#66cc66">(</font> <font color="#cc66cc">1</font> <font color="#66cc66">)</font> <font color="#ff0000">"alpha"</font> <font color="#66cc66">(</font> <font color="#cc66cc">2</font> <font color="#66cc66">)</font> <font color="#ff0000">"beta"</font> <font color="#66cc66">(</font> <font color="#cc66cc">3</font> <font color="#66cc66">)</font> <font color="#ff0000">"gamma"</font></code> </blockquote> <br>  For clarity, I give the equivalent code without the "frills": <br><br><blockquote> <code><font color="#b1b100">do</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> tmp1 <font color="#66cc66">=</font> chain_print <font color="#66cc66">(</font> <font color="#cc66cc">1</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> tmp2 <font color="#66cc66">=</font> tmp1 <font color="#66cc66">(</font> <font color="#ff0000">"alpha"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> tmp3 <font color="#66cc66">=</font> tmp2 <font color="#66cc66">(</font> <font color="#cc66cc">2</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> tmp4 <font color="#66cc66">=</font> tmp3 <font color="#66cc66">(</font> <font color="#ff0000">"beta"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> tmp5 <font color="#66cc66">=</font> tmp4 <font color="#66cc66">(</font> <font color="#cc66cc">3</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> tmp5 <font color="#66cc66">(</font> <font color="#ff0000">"gamma"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font></code> </blockquote> <br><h4>  Methods </h4><br>  Objects in Lua are most often implemented using tables. <br><br>  The methods usually hide the function values ‚Äã‚Äãthat are obtained by indexing the table by a string key identifier. <br><br>  Lua provides special syntactic sugar for declaring and invoking methods - the colon.  The colon hides the first argument of the method, self, the object itself. <br><br>  The following three recording forms are equivalent.  A global variable myobj is created, into which a table-object is written with a single method foo. <br><br>  With a colon: <br><br><blockquote> <code>myobj <font color="#66cc66">=</font> <font color="#66cc66">{</font> a_ <font color="#66cc66">=</font> <font color="#cc66cc">5</font> <font color="#66cc66">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">function</font> myobj:foo <font color="#66cc66">(</font> b <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> self.a_ + b <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> myobj:foo <font color="#66cc66">(</font> <font color="#cc66cc">37</font> <font color="#66cc66">)</font> <font color="#808080">--&gt; 42</font></code> </blockquote> <br>  Without a colon: <br><br><blockquote> <code>myobj <font color="#66cc66">=</font> <font color="#66cc66">{</font> a_ <font color="#66cc66">=</font> <font color="#cc66cc">5</font> <font color="#66cc66">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">function</font> myobj.foo <font color="#66cc66">(</font> self, b <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> self.a_ + b <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> myobj.foo <font color="#66cc66">(</font> myobj, <font color="#cc66cc">37</font> <font color="#66cc66">)</font> <font color="#808080">--&gt; 42</font></code> </blockquote> <br>  Sugar free: <br><br><blockquote> <code>myobj <font color="#66cc66">=</font> <font color="#66cc66">{</font> <font color="#66cc66">[</font> <font color="#ff0000">"a_"</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#cc66cc">5</font> <font color="#66cc66">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> myobj <font color="#66cc66">[</font> <font color="#ff0000">"foo"</font> <font color="#66cc66">]</font> <font color="#66cc66">=</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> self, b <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">print</font> <font color="#66cc66">(</font> self <font color="#66cc66">[</font> <font color="#ff0000">"a_"</font> <font color="#66cc66">]</font> + b <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> myobj <font color="#66cc66">[</font> <font color="#ff0000">"foo"</font> <font color="#66cc66">]</font> <font color="#66cc66">(</font> myobj, <font color="#cc66cc">37</font> <font color="#66cc66">)</font> <font color="#808080">--&gt; 42</font></code> </blockquote> <br>  <b>Note:</b> As you can see, when calling a method without using a colon, myobj is mentioned twice.  The following two examples are obviously <b>not</b> equivalent in the case when get_myobj () is executed with side effects. <br><br>  With a colon: <br><br><blockquote> <code>get_myobj <font color="#66cc66">(</font> <font color="#66cc66">)</font> :foo <font color="#66cc66">(</font> <font color="#cc66cc">37</font> <font color="#66cc66">)</font></code> </blockquote> <br>  Without a colon: <br><br><blockquote> <code>get_myobj <font color="#66cc66">(</font> <font color="#66cc66">)</font> .foo <font color="#66cc66">(</font> get_myobj <font color="#66cc66">(</font> <font color="#66cc66">)</font> , <font color="#cc66cc">37</font> <font color="#66cc66">)</font></code> </blockquote> <br>  For the code to be equivalent to the variant with a colon, a temporary variable is needed: <br><br><blockquote> <code><font color="#b1b100">do</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> tmp <font color="#66cc66">=</font> get_myobj <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> tmp.foo <font color="#66cc66">(</font> tmp, <font color="#cc66cc">37</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font></code> </blockquote> <br>  When calling methods through the colon, you can also omit the parentheses if the method is passed a single explicit argument - a string literal or a table constructor: <br><br><blockquote> <code>foo:bar <font color="#ff0000">""</font> &lt;br/&gt; <br> foo:baz <font color="#66cc66">{</font> <font color="#66cc66">}</font></code> </blockquote> <br><h3>  Implementation </h3><br>  Now we know almost everything that is needed in order for our declarative code to work.  Let me remind you what it looks like: <br><br><blockquote> <code>build_message_box <font color="#66cc66">=</font> gui:dialog <font color="#ff0000">"Message Box"</font> &lt;br/&gt; <br> <font color="#66cc66">{</font> &lt;br/&gt; <br> gui:label <font color="#ff0000">"Hello, world!"</font> <font color="#66cc66">{</font> font_size <font color="#66cc66">=</font> <font color="#cc66cc">20</font> <font color="#66cc66">}</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> gui:button <font color="#ff0000">"OK"</font> <font color="#66cc66">{</font> <font color="#66cc66">}</font> <font color="#66cc66">;</font> &lt;br/&gt; <br> <font color="#66cc66">}</font></code> </blockquote> <br><h4>  What is written there? </h4><br>  I will give an equivalent implementation without declarative "frills": <br><br><blockquote> <code><font color="#0000ff">do</font> &lt;br/&gt; <br> local tmp_1 <font color="#000080">=</font> gui <font color="#008080">:</font> label <font color="#008000">(</font> <font color="#FF0000">"Hello, world!"</font> <font color="#008000">)</font> &lt;br/&gt; <br> local label <font color="#000080">=</font> tmp_1 <font color="#008000">(</font> <font color="#008000">{</font> font_size <font color="#000080">=</font> <font color="#0000dd">20</font> <font color="#008000">}</font> <font color="#008000">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> local tmp_2 <font color="#000080">=</font> gui <font color="#008080">:</font> button <font color="#008000">(</font> <font color="#FF0000">"OK"</font> <font color="#008000">)</font> &lt;br/&gt; <br> local button <font color="#000080">=</font> tmp_2 <font color="#008000">(</font> <font color="#008000">{</font> <font color="#008000">}</font> <font color="#008000">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> local tmp_3 <font color="#000080">=</font> gui <font color="#008080">:</font> dialog <font color="#008000">(</font> <font color="#FF0000">"Message Box"</font> <font color="#008000">)</font> &lt;br/&gt; <br> build_message_box <font color="#000080">=</font> tmp_3 <font color="#008000">(</font> <font color="#008000">{</font> label, button <font color="#008000">}</font> <font color="#008000">)</font> &lt;br/&gt; <br> end</code> </blockquote> <br><h4>  Gui object interface </h4><br>  As we can see, all the work is done by the gui object - the ‚Äúconstructor‚Äù of our build_message_box () function.  The outlines of its interface are now visible. <br><br>  We describe them in pseudocode: <br><br><blockquote><pre> gui: label (title: string)
   =&gt; function (parameters: table): [gui_element]

 gui: button (text: string)
   =&gt; function (parameters: table): [gui_element]
   
 gui: dialog (title: string) 
   =&gt; function (element_list: table): function
</pre></blockquote><br><h4>  Declarative method </h4><br>  In the interface of the gui object, a pattern is clearly visible - a method that takes a portion of the arguments and returns a function that takes the remaining arguments and returns the final result. <br><br>  For simplicity, we will assume that we build a declarative model on top of the existing gui_builder API, mentioned in the imperative example at the beginning of the article.  Let me remind the example code: <br><br><blockquote> <code><font color="#b1b100">function</font> build_message_box <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_dialog <font color="#66cc66">=</font> gui_builder:dialog <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:set_title <font color="#66cc66">(</font> <font color="#ff0000">"Message Box"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_label <font color="#66cc66">=</font> gui_builder:label <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_label:set_font_size <font color="#66cc66">(</font> <font color="#cc66cc">20</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_label:set_text <font color="#66cc66">(</font> <font color="#ff0000">"Hello, world!"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:add <font color="#66cc66">(</font> my_label <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_button <font color="#66cc66">=</font> gui_builder:button <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_button:set_title <font color="#66cc66">(</font> <font color="#ff0000">"OK"</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:add <font color="#66cc66">(</font> my_button <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">return</font> my_dialog&lt;br/&gt; <br> <font color="#b1b100">end</font></code> </blockquote> <br>  Let's try to imagine what the gui: dialog () method might look like: <br><br><blockquote> <code><font color="#b1b100">function</font> gui:dialog <font color="#66cc66">(</font> title <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> element_list <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#808080">--  build_message_box():</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_dialog <font color="#66cc66">=</font> gui_builder:dialog <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:set_title <font color="#66cc66">(</font> title <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">for</font> i <font color="#66cc66">=</font> <font color="#cc66cc">1</font> , #element_list <font color="#b1b100">do</font> &lt;br/&gt; <br> my_dialog:add <font color="#66cc66">(</font> &lt;br/&gt; <br> element_list <font color="#66cc66">[</font> i <font color="#66cc66">]</font> <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">return</font> my_dialog      &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font></code> </blockquote> <br>  The situation with [gui_element] has cleared up.  This is a constructor function that creates the corresponding dialog element. <br><br>  The build_message_box () function creates a dialog, calls constructor functions for child elements, and then adds these elements to the dialog.  The constructor functions for the dialog elements are obviously very similar in structure to build_message_box ().  The methods for generating the gui object will also be similar. <br><br>  The following generalization suggests itself: <br><br><blockquote> <code><font color="#b1b100">function</font> declarative_method <font color="#66cc66">(</font> method <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> self, name <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> data <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> method <font color="#66cc66">(</font> self, name, data <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font></code> </blockquote> <br>  Now gui: dialog () can be written more clearly: <br><br><blockquote> <code>gui.dialog <font color="#66cc66">=</font> declarative_method <font color="#66cc66">(</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> self, title, element_list <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_dialog <font color="#66cc66">=</font> gui_builder:dialog <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> my_dialog:set_title <font color="#66cc66">(</font> title <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">for</font> i <font color="#66cc66">=</font> <font color="#cc66cc">1</font> , #element_list <font color="#b1b100">do</font> &lt;br/&gt; <br> my_dialog:add <font color="#66cc66">(</font> &lt;br/&gt; <br> element_list <font color="#66cc66">[</font> i <font color="#66cc66">]</font> <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">return</font> my_dialog      &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> <font color="#66cc66">)</font></code> </blockquote> <br>  The implementation of the gui: label () and gui: button () methods became obvious: <br><br><blockquote> <code>gui.label <font color="#66cc66">=</font> declarative_method <font color="#66cc66">(</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> self, text, parameters <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_label <font color="#66cc66">=</font> gui_builder:label <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> my_label:set_text <font color="#66cc66">(</font> text <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">if</font> parameters.font_size <font color="#b1b100">then</font> &lt;br/&gt; <br> my_label:set_font_size <font color="#66cc66">(</font> parameters.font_size <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">return</font> my_label&lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> gui.button <font color="#66cc66">=</font> declarative_method <font color="#66cc66">(</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> self, title, parameters <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">return</font> <font color="#b1b100">function</font> <font color="#66cc66">(</font> gui_builder <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#b1b100">local</font> my_button <font color="#66cc66">=</font> gui_builder:button <font color="#66cc66">(</font> <font color="#66cc66">)</font> &lt;br/&gt; <br> &lt;br/&gt; <br> my_button:set_title <font color="#66cc66">(</font> title <font color="#66cc66">)</font> &lt;br/&gt; <br> <font color="#808080">--  ,      .</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#b1b100">return</font> my_button&lt;br/&gt; <br> <font color="#b1b100">end</font> &lt;br/&gt; <br> <font color="#b1b100">end</font> <font color="#66cc66">)</font></code> </blockquote> <br><h3>  What have we got? </h3><br>  The problem of improving the readability of our naive imperative example has been successfully solved. <br><br>  As a result of our work, we, in fact, implemented using Lua's own domain-specific declarative language for describing the ‚Äútoy‚Äù user interface <a href="http://en.wikipedia.org/wiki/Domain-specific_language">(DSL)</a> . <br><br>  Due to the peculiarities of the Lua, the implementation was cheap and quite flexible and powerful. <br><br>  In real life, of course, everything is somewhat more complicated.  Depending on the problem to be solved, our mechanism may require quite serious improvements. <br><br>  For example, if users will write in our micro-language, we will need to place the executable code in the <a href="http://lua-users.org/wiki/ScriptSecurity">sandbox</a> .  Also, you will need to seriously work on the understandability of error messages. <br><br>  The described mechanism is not a panacea, and it should be applied wisely like any other.  But, nevertheless, even in such a simple form, declarative code can greatly increase the readability of the program and make life easier for programmers. <br><br>  A fully working example can be found <a href="http://gist.github.com/249973">here</a> . <br><br><h3>  Additional reading </h3><ul><li>  <a href="http://www.lua.org/manual/5.1/">Lua Programming Manual</a> ( <a href="http://www.lua.ru/doc/">Translation</a> ) </li><li>  <a href="http://www.lua.org/pil/">Programming in Lua</a> </li><li>  <a href="http://penlight.luaforge.net/FAQ/">Lua Unofficial Frequently Asked Questions</a> </li><li>  <a href="http://www.lua.org/gems/">Lua Programming Gems</a> </li><li>  <a href="http://lua-users.org/wiki">Lua Users Wiki</a> </li><li>  <a href="http://www.lua.org/history.html">The history of Lua</a> is an article from 2001, in which, in particular, the sources of the declarative syntax in Lua are clearly visible. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/77413/">https://habr.com/ru/post/77413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../77404/index.html">The king is good, and the boyars are bad. Small business and everything, everything, everything ...</a></li>
<li><a href="../77405/index.html">Comrades! You all know that the K Desktop Environment is no longer there. How to call this blog now?</a></li>
<li><a href="../77406/index.html">The best questions of the Kiev-Sydney Wave Marathon. The choice of Lars Rasmussen</a></li>
<li><a href="../77407/index.html">Can you distinguish science from pseudoscience?</a></li>
<li><a href="../77409/index.html">5 tips for getting positive feedback</a></li>
<li><a href="../77414/index.html">We read big texts in Firefox</a></li>
<li><a href="../77415/index.html">Can bloggers overthrow the government?</a></li>
<li><a href="../77416/index.html">Webmoney and the transition to Linux</a></li>
<li><a href="../77418/index.html">Linux Mint 8 x64 RC1 released!</a></li>
<li><a href="../77421/index.html">Improved plug and tee</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>