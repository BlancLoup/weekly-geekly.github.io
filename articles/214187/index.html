<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Removing disks from a live raid on adaptec 6805</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task: 
 Extract 2 hard drives from raid-10 at the logical level (i.e., without physically removing from the server) to assemble raid-1 from them, tran...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Removing disks from a live raid on adaptec 6805</h1><div class="post__text post__text-html js-mediator-article"><h4>  Task: </h4><br>  Extract 2 hard drives from raid-10 at the logical level (i.e., without physically removing from the server) to assemble raid-1 from them, transfer the system there and prepare everything you can to reboot, thus minimizing the time and number of downtime. <br><br><h4>  What is the difficulty? </h4><br>  In the 5 series of adaptek the question was solved by two teams: <br>  1. Zafeili disk: <code>arcconf setstate 1 device 0 0 ddd</code> <br>  2. Translated to Ready status: <code>arcconf setstate 1 device 0 0 rdy</code> <br>  3. We do with disks what we want. <br><br>  In the 6 series so does not roll.  Regardless of whether failover is enabled or not, the disks return to the Present state and nothing can be done with them (I think it is clear that the raid itself will be Degraded until Rebuild passes). <br>  An attempt to contact the official tech support was unsuccessful - I received an answer, but I had a feeling that I was using a homemade piece of hardware, and not a server that could not be jerked back and forth: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  After you ran the ‚Äúarcconf setstate 1 device 0 0 ddd‚Äù command, was the system rebooted?  If not, then reboot and initialize both disks in the controller BIOS.  There you can immediately create a RAID-1. <br><br>  To erase the meta-data on the disk under Arcconf, you can initialize the disk with the "arcconf task" command.  For example: arcconf task start 1 device 0 0 initialize <br><br>  After that, the drive must be accessible to create other logical drives. <br><br>  However, if you throw two disks out of RAID-10, it remains in the ‚ÄúDegraded‚Äù status.  If one of the remaining errors in the disk array fails, the entire array may collapse.  So maybe just back up all the data, then just delete the RAID-10 array and create two separate RAID-1s. </blockquote><br><br>  I thought and resolved the issue with a queue of experiments, after which I was able to complete the task. <br><br><a name="habracut"></a><br><br><h4>  Description: </h4><br>  We have logical device with raid-10 on 4 disks <br><pre> <code class="bash hljs"> Logical device segment information -------------------------------------------------------- Group 0, Segment 0 : Present (0,0) J0VV3R8N Group 0, Segment 1 : Present (0,1) J0VV3ZBN Group 1, Segment 0 : Present (0,2) J0VV3YEN Group 1, Segment 1 : Present (0,3) J0VX2WXN</code> </pre><br><br>  It is necessary to pull out of it 2 hards (one from different groups) and make raid-1 of them <br><br><h4>  Decision: </h4><br>  1. Make sure failover is enabled <br><pre> <code class="bash hljs">arcconf failover 1 on</code> </pre><br><br>  2. Feilim 2 disks from different groups <br><pre> <code class="bash hljs">arcconf setstate 1 device 0 0 ddd arcconf setstate 1 device 0 2 ddd</code> </pre><br>  Disks will become Inconsistent in logicaldevice and Failed in physicaldevice <br><br>  3. We translate these discs into ready status <br><pre> <code class="bash hljs">arcconf setstate 1 device 0 0 rdy arcconf setstate 1 device 0 2 rdy</code> </pre><br>  The disks will become Missing in logicaldevice and Ready in physicaldevice <br><br>  4. We wait until failover starts rebuilding <br><pre> <code class="bash hljs">Group 0, Segment 0 : Rebuilding (0,0) J0VV3R8N</code> </pre><br>  They will be able to rebuild in turn, including, as soon as we see the state of Rebuilding in one of them, we are doing point 5 immediately, then for the next. <br><br>  5. Feilim and very quickly proceed to point 6. <br><pre> <code class="bash hljs">arcconf setstate 1 device 0 0 ddd arcconf setstate 1 device 0 2 ddd</code> </pre><br>  Disks will become Inconsistent in logicaldevice and Failed in physicaldevice <br><br>  6. We transfer disks in the status Ready and very quickly we pass to point 7 <br><pre> <code class="bash hljs">arcconf setstate 1 device 0 0 rdy arcconf setstate 1 device 0 2 rdy</code> </pre><br>  The disks will become Missing in logicaldevice and Ready in physicaldevice <br><br>  7. Disable failover and very quickly go to step 8. <br><pre> <code class="bash hljs">arcconf failover 1 off</code> </pre><br><br>  8. Initializing the disks <br><pre> <code class="bash hljs">arcconf task start 1 device 0 0 initialize arcconf task start 1 device 0 2 initialize</code> </pre><br><br>  <b>Hooray, we can concoct from them raid-1</b> <br><pre> <code class="bash hljs">arcconf CREATE 1 LOGICALDRIVE MAX 1 0 0 0 2</code> </pre><br><br>  The reader may have questions, for which we performed the same actions 2 times and why failover was not immediately disabled. <br>  Again, the 6th series of adapters does not allow you to safely remove disks from the raid with failover disabled after the command: <br>  <code>arcconf setstate 1 device 0 0 rdy</code> we would get the status of the disk in the logicaldrive Present, and the status of the raid Degraded, while the disk in the physicaldrive would be in the status Online, not Ready. <br>  And why, starting from point 5, we do everything quickly?  It's simple, the controller after a few seconds has time to recover, and change the status <br>  drives, so you need to have time to execute commands before he does it. <br><br>  I could not find a ready-made solution, I had to reinvent my own, I hope someone will be useful - I‚Äôm not the only one using the 6th series of adaptecs. <br><br>  <b>UPD.</b>  Upgrade 10 servers, everything went well.  The only edit is that you manage to pull only one hard out of the raid at a time, then you need to repeat the actions and pull out the 2nd one.  If you managed to pull out the disk, but the persistent controller tries to reuse it, just push it into JBOD, remove the 2nd disk, remove the 1st disk from JBOD and you can create 1 raid on 2 free disks. </div><p>Source: <a href="https://habr.com/ru/post/214187/">https://habr.com/ru/post/214187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214177/index.html">Game development. The path from the idea on the napkin to the Kickstarter campaign</a></li>
<li><a href="../214179/index.html">Unrecognized MySQL bug: inability to add the first record to the composite VIEW</a></li>
<li><a href="../214181/index.html">Autospeed Cisco SPA504g and Asterisk. Part 1. Building and Configuring Asterisk + MySQL</a></li>
<li><a href="../214183/index.html">Ways to use PostgreSQL more efficiently</a></li>
<li><a href="../214185/index.html">"BillGates" Linux Botnet - where did it come from?</a></li>
<li><a href="../214189/index.html">ArnoldC: a programming language from Schwarzenegger quotes</a></li>
<li><a href="../214191/index.html">Open classes in ruby, notes for pythonists</a></li>
<li><a href="../214197/index.html">Win32 / Corkow Banking Trojan Analysis</a></li>
<li><a href="../214201/index.html">The most interesting from the world of web design. Digest number 1 of February 2014</a></li>
<li><a href="../214205/index.html">Free Microsoft Exam Voucher</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>