<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We create an original gift with the help of chemistry, physics and electronics: part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous part ( http://habrahabr.ru/blogs/DIY/111610/ ) the first step towards the creation of the device, the actual growth of the crystal, wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We create an original gift with the help of chemistry, physics and electronics: part 2</h1><div class="post__text post__text-html js-mediator-article">  In the previous part ( <a href="http://habrahabr.ru/blogs/DIY/111610/">http://habrahabr.ru/blogs/DIY/111610/</a> ) the first step towards the creation of the device, the actual growth of the crystal, was considered.  In this part we will consider the physical embodiment of the device itself and its electrical circuit. <br><a name="habracut"></a><br><h4>  Step 2: create the construction </h4><br><br>  The long and dreary part is over, now everything will go faster.  After I received my crystal, I wondered ‚Äúwhere can I get a suitable glass cylinder in which the crystal can be concluded?‚Äù The answer was found in the store ‚Äúeverything for the home‚Äù, in the form of an excellent cylindrical stack for vodka costing 20 rubles per piece. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/731/7ea/4a4/7317ea4a4438f58006757f0dc6b2344e.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      She attracted me for two reasons: firstly, she was without patterns, engravings and the correct form - an even glass cylinder.  Secondly, it was rather thick-walled, which has a good effect on the strength of the structure. <br><br>  The final construction to which we must come is shown below. <br><br><img src="https://habrastorage.org/storage/habraeffect/01/05/0105f87c50aad4513c497665cf0eb325.png" alt="image"><br><br><br>  In principle, if you have grown a fist-sized crystal, or you simply do not like such stacks, you can choose any suitable transparent container.  The main thing is to be able to seal it in consequence to prevent the weathering of the crystal. <br>  Now our task is to find a plastic insert hollow inside, on which a crystal can be placed, and inside it a control circuit with a battery.  I stopped at a plastic rosin box, which ideally entered the glass. <br>  In the center of it we make a hole under the LED (in more detail on the choice of the LED I will focus on the part devoted to electronics), insert it there and seal it from the inside with a hot-melt gun.  On the same glue, we plant a crystal outside a plastic stand, directly above the LED. <br>  Making sure that everything is exactly as it should be, we proceed to the final stage of this step - we lubricate the outer surface of the stand with a sealant of a suitable color (I chose the black stand, respectively, and the black sealant) and insert it inside the glass.  After the sealant hardens, you will have a completely sealed glass with a crystal inside, which can be highlighted by supplying power to the LED terminals. <br>  I did not fill the crystal with anything, having stopped at the variant with a varnish and a hermetic vessel, but if you really want to be sure that the crystal will be stored for centuries, you can pour it with some kind of transparent organic composition (oil, for example).  True, this will require you to properly seal, so that the device does not suddenly begin to leak. <br><br>  We turn to the most interesting step - the development of electronics. <br><br><h4>  Step 3: develop electronics </h4><br><br>  After performing the above steps, we should have got a blank, to which, in principle, you can add a battery and a switch, and get the finished product.  But such a souvenir will not stand out among the heaps of various "little things", sold for 50 rubles a bucket.  Our goal at this step is to develop the electrical circuit of the device, which will firstly fit into our stand, secondly, it will not consume much current in idle mode (you can, of course, bring the switch out, but for me this really spoils the impression), and thirdly, it will provide what we wanted from the very beginning: a smooth increase in the glow of the crystal, when it is taken in hand, and the extinction after it is put in place. <br>  In fact, we face two tasks: <br>  1) Determine the touch to the device person <br>  2) Control the brightness of the LED. <br><br>  An excellent solution to the first task is the implementation of a capacitive sensor.  Despite the sonorous name, it is very simple and requires, in fact, only the sensor itself (in the form of a simple piece of foil, wire, or pad on a printed circuit board), 1-2 pins of a microcontroller and a resistor with resistance from mega-ohms and above. <br><br>  Let's turn to the theory.  Suppose we have a series connection of a resistor and a capacitor, described in the wikipedia article "RC-circuit" <br><br><img src="https://habrastorage.org/storage/habraeffect/8a/27/8a27813820a8eb82188d295d51bc0e9e.png" alt="image"><br><br>  Suppose that initially Vin = 0 and the capacitor is discharged.  Vc, therefore, is also zero.  When a non-zero voltage Vin is applied, the voltage across the capacitor increases according to the following law: <br><br><img src="https://habrastorage.org/storage/habraeffect/0f/1c/0f1c0560ddd12525e6c0de42b15c6078.png" alt="image"><br><br>  Where T = RC. <br>  Suppose now that instead of a condenser, we have a regular metal plate, or a strip of foil.  According to the laws of physics, it also has a certain, albeit very small, capacity of the order of a few picofarads.  It is easy to calculate that the time for which such a plate will be charged with a resistor of 1 MOM is 10 ^ 6 * 10 ^ (- 12) = 10 ^ (- 6) c.  A very small value, however, for a microcontroller operating at a frequency of 10 MHz, will have time to pass as many as 10 clock cycles. <br>  Now imagine that the plates touched man.  Its capacity is two orders of magnitude higher than the capacity of the plate and is about 100-200 picofarads.  Consequently, the time during which the plate is charged will increase significantly. <br><br>  Below is the model of the sensor in the Proteus system. <br>  Capacitor C1 acts as the own capacitance of our sensor plate, C2 together with the switch SW1 is the capacity of the touching person. <br><br><img src="https://habrastorage.org/storage/habraeffect/ac/8a/ac8a996659d39602c587f13332eb7065.png" alt="image"><br><br>  As we can see, the circuit is extremely simple and uses only two pins of the microcontroller.  Moreover, if necessary, you can build a sensor on one pin, alternately switching it from output to input, but in this case I decided not to save the legs of the microcircuit. <br><br>  The sensor polling algorithm is also very simple and follows from the above: <br><br>  1) PB.4 we set to the output, and feed there 0. This will discharge the sensor. <br>  2) PB.3 is set to the input by disabling the tightening (this is important! Pulling up the power supply will keep the sensor charged at all times, but we don‚Äôt need it). <br>  3) We adjust the timer of the microcontroller to the frequency we need.  The frequency is selected according to the following criterion: it must be large enough to capture the charge time and distinguish the ‚Äúempty‚Äù sensor from the active, but at the same time small enough so that the timer does not overflow with the active sensor.  Since in our device the microcontroller will work from the built-in clock generator to save space, its maximum frequency will be equal to 9.6 MHz, which is quite suitable according to the above criteria.  Therefore, the timer will run without a prescaler, at the frequency of the microcontroller. <br>  4) Turn on the timer <br>  5) We display a logical unit in PB.4, thereby starting the process of charging tanks <br>  6) Check the value on PB.3 until the log appears there.  one. <br>  7) Stop the timer. <br>  8) Display in PB.4 log.  0 to discharge the sensor. <br><br>  The resulting timer value is the number by which we will determine whether the sensor is empty or not.  But comparing it directly with an approximate value is wrong.  This will make the circuit very dependent on environmental conditions.  For the sensor to work correctly, it is necessary to perform a calibration at startup, that is, to perform the described algorithm, and write the received timer value into an internal variable, SensorLow, considering it to be the value corresponding to the inactive sensor. <br>  In the process of polling the sensor, it will be necessary to perform all the steps described, and compare the obtained value, say, with SensorLow + N, where N is the sensitivity threshold of our sensor. <br><br>  Regarding the brightness control of the LED, this is easily achieved with the help of PWM (pulse-width modulation), in which instead of a constant voltage level the load is applied to rectangular pulses with an adjustable duty cycle.  As a result, the average voltage value equals the logic level value multiplied by the duty cycle value.  This technique is widely known, so I will not dwell on its detailed description. <br><br>  A few words about the choice of LED and power source. <br>  From the battery we need a long service life "on the shelf" (with low consumption), supply voltage 3-5 volts, for powering the controller and the LED, and a relatively high current with a fully lit LED - 10-15 mA. <br>  A lithium CR2450 battery with a voltage of 3.0 volts, with a capacity of approximately 610 mAh, capable of delivering large (up to 30 mA) currents and stored up to 10 years is ideal for these purposes. <br>  The cost of such a battery is about 100 rubles. <br><br><img src="https://habrastorage.org/storage/habraeffect/9e/7c/9e7cd285902bdc9dedf8623d31004c91.png" alt="image"><br><br>  The LED I chose blue, the color of the crystal, with a lens size of 5 mm, but everything is in your hands, you can experiment with different colors and shades.  The main condition for the LED - the battery voltage should be enough to open it. <br>  The voltage drop on my blue LED is about 2.7 volts, which means that when the battery is ‚Äúslackened‚Äù by only 0.3 volts, the diode will not light up.  There are LEDs with an even higher voltage drop, for such a lithium battery is no longer suitable. <br>  However, a blessing in disguise - the high voltage drop across my LED made it possible to connect it without an additional resistor.  As a result, the complete electrical circuit looks like this: <br><br><img src="https://habrastorage.org/storage/habraeffect/5e/b9/5eb9fe3db65ab844ff2ce3f6f915c9e3.png" alt="image"><br><br>  Extremely simple - a small 8-pin microcontroller ATTiny13, one mega-ohm resistor, one LED and a strip of foil as a sensor, which I pasted on the outer side of the plastic stand and connected to the circuit with a thin wire.  Power pins and controller lands are not indicated on the diagram. <br>  We are almost there, it remains to write the firmware, which the next step is devoted to (in the next article). <br><br>  <a href="http://habrahabr.ru/blogs/DIY/111610/">Part 1</a> <br>  <a href="http://habrahabr.ru/blogs/DIY/111671/">Part 3</a> </div><p>Source: <a href="https://habr.com/ru/post/111627/">https://habr.com/ru/post/111627/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111619/index.html">App Engine Relationship Modeling</a></li>
<li><a href="../111620/index.html">Thin clients (linux) from obsolete computers</a></li>
<li><a href="../111621/index.html">Nvidia will receive from Intel $ 1.5 billion over 5 years</a></li>
<li><a href="../111622/index.html">Video Resident Evil 2 on PlayStation Phone is online</a></li>
<li><a href="../111623/index.html">[Translation] Building Latex Documents with Waf</a></li>
<li><a href="../111628/index.html">Droider Chart. Issue 34</a></li>
<li><a href="../111632/index.html">Do you have a lot of startup ideas? - Forget it!</a></li>
<li><a href="../111635/index.html">All new!</a></li>
<li><a href="../111636/index.html">Infographics: Censorship on the Internet. It seems to you that the Internet is independent</a></li>
<li><a href="../111637/index.html">6-week Google Chrome update cycle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>