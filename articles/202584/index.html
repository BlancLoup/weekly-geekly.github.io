<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Elegant Go Web Server (Graceful Restart)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I am going to describe Graceful Restart on Go. Graceful Restart is important for Go web applications. Go has one drawback. In Go, ther...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Elegant Go Web Server (Graceful Restart)</h1><div class="post__text post__text-html js-mediator-article">  In this article I am going to describe Graceful Restart on Go.  Graceful Restart is important for Go web applications.  Go has one drawback.  In Go, there is no way to reload the code during execution.  Therefore, developers on Go encounter a problem that is not found in servers written in Java, .NET, or PHP.  If you need to update the server code written on Go, then the server process must be stopped and a new process started.  This reduces the availability of the server when the code is updated. <br><br>  In the previous article I described the <a href="http://habrahabr.ru/post/197570/">Balancer on Go in 200 lines</a> .  On the basis of the balancer, you can ensure high availability during the application update, but how then to update the balancer itself.  Using a balancer can often just be superfluous.  If your server is running on Mac OS X or Linux, then there is another way to update the server code and process all requests received at the time of restarting the server.  This method is Graceful Restart. <br><a name="habracut"></a><br>  The essence of Graceful Restart is that in unix / linux systems, open files and sockets are accessible to spawned processes.  It is enough for them to know the value of the file descriptor (the file descriptor is an integer) in order to get access to the file or socket opened by the ancestor. <br><br>  Here is a list of problems that need to be addressed to implement Graceful Restart on Go. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  In Go, all open files are automatically closed at the end of the process (close-on-exec) </li><li>  It is necessary to do something with the old keep-alive connections opened in the ancestor. </li></ol><br>  The first problem is solved in two ways.  Using fnctl, you can remove the syscall.FD_CLOEXEC flag, or syscall.Dup creates a copy of the file descriptor, without the syscall.FD_CLOEXEC flag.  These calls are not available in the Windows Go implementation, so this technique works on Mac OS X and Linux.  In this example, I use syscall.Dup.  This is easier than the first approach. <br><br>  I solve the second problem by setting Timeout for connections in 10 seconds and turning off the server 11 seconds after Graceful Restart.  The second problem can also be solved in two other ways: a net.Listner wrapper to calculate the number of open connections and the predetermination of <a href="http://golang.org/src/pkg/net/">func (c * conn) serve ()</a> , which is quite difficult in Go.  Other behavior may be desirable.  For example, what would the old process after Graceful Restart report an error and close the connections. <br><br>  It is important to understand that after Graceful Restart, part of the web browsers will be connected to the old server thanks to keep-alive.  New connections will be established with the new server.  For clarity, which server processed which request I was in response from the server to indicate the PID of the process. <br><br><h5>  grace1.go </h5><br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"flag"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"net"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> <span class="hljs-string"><span class="hljs-string">"os/exec"</span></span> <span class="hljs-string"><span class="hljs-string">"syscall"</span></span> <span class="hljs-string"><span class="hljs-string">"time"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FD *<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = flag.Int(<span class="hljs-string"><span class="hljs-string">"fd"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Server socket FD"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PID <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = syscall.Getpid() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> listener1 net.Listener <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file1 *os.File = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exit1 <span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stop1 = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fo1, err := os.Create(fmt.Sprintf(<span class="hljs-string"><span class="hljs-string">"pid-%d.log"</span></span>, PID)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(err) } log.SetOutput(fo1) log.Println(<span class="hljs-string"><span class="hljs-string">"Grace1 "</span></span>, PID) flag.Parse() s := &amp;http.Server{Addr: <span class="hljs-string"><span class="hljs-string">":8080"</span></span>, ReadTimeout: <span class="hljs-number"><span class="hljs-number">10</span></span> * time.Second, WriteTimeout: <span class="hljs-number"><span class="hljs-number">10</span></span> * time.Second, } http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, DefHandler) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/stop"</span></span>, StopHandler) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/restart"</span></span>, RestartHandler) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/grace"</span></span>, GraceHandler) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/think"</span></span>, ThinkHandler) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> *FD != <span class="hljs-number"><span class="hljs-number">0</span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"Starting with FD "</span></span>, *FD) file1 = os.NewFile(<span class="hljs-keyword"><span class="hljs-keyword">uintptr</span></span>(*FD), <span class="hljs-string"><span class="hljs-string">"parent socket"</span></span>) listener1, err = net.FileListener(file1) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalln(<span class="hljs-string"><span class="hljs-string">"fd listener failed: "</span></span>, err) } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"Virgin Start"</span></span>) listener1, err = net.Listen(<span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, s.Addr) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalln(<span class="hljs-string"><span class="hljs-string">"listener failed: "</span></span>, err) } } err = s.Serve(listener1) log.Println(<span class="hljs-string"><span class="hljs-string">"EXITING"</span></span>, PID) &lt;-exit1 log.Println(<span class="hljs-string"><span class="hljs-string">"EXIT"</span></span>, PID) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DefHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"def handler %d %s"</span></span>, PID, time.Now().String()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThinkHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span></span></span> { time.Sleep(<span class="hljs-number"><span class="hljs-number">5</span></span> * time.Second) fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"think handler %d %s"</span></span>, PID, time.Now().String()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span></span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"StopHandler"</span></span>, req.Method) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stop1){ fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"stopped %d %s"</span></span>, PID, time.Now().String()) } stop1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span> fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"stop %d %s"</span></span>, PID, time.Now().String()) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { listener1.Close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> file1 != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { file1.Close() } exit1&lt;<span class="hljs-number"><span class="hljs-number">-1</span></span> }() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RestartHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span></span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"RestartHandler"</span></span>, req.Method) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stop1){ fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"stopped %d %s"</span></span>, PID, time.Now().String()) } stop1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span> fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"restart %d %s"</span></span>, PID, time.Now().String()) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { listener1.Close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> file1 != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { file1.Close() } cmd := exec.Command(<span class="hljs-string"><span class="hljs-string">"./grace1"</span></span>) err := cmd.Start() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalln(<span class="hljs-string"><span class="hljs-string">"starting error:"</span></span>, err) } exit1&lt;<span class="hljs-number"><span class="hljs-number">-1</span></span> }() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraceHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span></span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"GraceHandler"</span></span>, req.Method) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stop1){ fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"stopped %d %s"</span></span>, PID, time.Now().String()) } stop1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span> fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"grace %d %s"</span></span>, PID, time.Now().String()) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"GoodBye"</span></span>) }() listener2 := listener1.(*net.TCPListener) file2, err := listener2.File() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalln(err) } fd1 := <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(file2.Fd()) fd2, err := syscall.Dup(fd1) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalln(<span class="hljs-string"><span class="hljs-string">"Dup error:"</span></span>, err) } listener1.Close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> file1 != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { file1.Close() } cmd := exec.Command(<span class="hljs-string"><span class="hljs-string">"./grace1"</span></span>, fmt.Sprint(<span class="hljs-string"><span class="hljs-string">"-fd="</span></span>, fd2)) err = cmd.Start() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalln(<span class="hljs-string"><span class="hljs-string">"grace starting error:"</span></span>, err) } log.Println(<span class="hljs-string"><span class="hljs-string">"sleep11"</span></span>, PID) time.Sleep(<span class="hljs-number"><span class="hljs-number">10</span></span> * time.Second) log.Println(<span class="hljs-string"><span class="hljs-string">"exit after sleep"</span></span>, PID) exit1&lt;<span class="hljs-number"><span class="hljs-number">-1</span></span> }() }</code> </pre> <br><br>  Run this program without <b>go run</b> . <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> build grace1.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> ./grace1</code> </pre><br><br>  Now that the server is running, we have the following handlers <br><br>  <a href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a> - default handler <br>  <a href="http://127.0.0.1:8080/restart">http://127.0.0.1:8080/restart</a> - normal server restart <br>  <a href="http://127.0.0.1:8080/grace">http://127.0.0.1:8080/grace</a> - Graceful server restart <br>  <a href="http://127.0.0.1:8080/think">http://127.0.0.1:8080/think</a> - handler with delay <br><br>  In order to check how it all works, I wrote another program on Go.  She makes successive requests to the server, if there is no error, then the letter <b>g</b> is displayed on the screen, if the error is <b>E.</b>  After each request, the program falls asleep for 10ms. <br><br><h5>  bench1.go </h5><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"time"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { nerr := <span class="hljs-number"><span class="hljs-number">0</span></span> ngood := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10000</span></span>; i++ { resp, err := http.Get(<span class="hljs-string"><span class="hljs-string">"http://127.0.0.1:8080/"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-comment"><span class="hljs-comment">// error print("E") nerr++ }else{ print("g") ngood++ resp.Body.Close() } time.Sleep(10 * time.Millisecond) } println() println("Good:", ngood, "Error", nerr) }</span></span></code> </pre><br><br>  If you restart the server under load, then bench1.go gives the following picture. <br><br><pre> <code class="bash hljs">gggggggggggggggggggggggggggggggggggggggggggggggggggggggEEEEEgggggggggggggggggggg gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg gggggggggggggggggggggggggggggggggEEggggggggggggggggggggggggggggggggggggggggggggg ggggggggggggggggggggggggggggggggggggggggggggggggEEgggggggggggggggggggggggggggggg ggggggggggggggggggggggggEggggggggggggggggggggggggggggggggggggggggggggggggggggggg gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg gggEEggggggggggggggggggEgggggggggggggggggggEggggggggggggggggEEgggggggggggggggggE gggggggggggggggggggggEEgggggggggggggggggEggggggggggggggggggggEggggggggggggggggEE gggggggggggggggggEEgggggggggggggggggEEggggggggggggggggggEgggggggggggggggEEgggggg</code> </pre><br><br>  One or several letters, E, symbolizes the error and inaccessibility of the server during the restart.  (I have repeatedly overloaded the server, so the letters E are often found) <br><br>  If to use Graceful Restart I did not observe errors in general. </div><p>Source: <a href="https://habr.com/ru/post/202584/">https://habr.com/ru/post/202584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202570/index.html">US Senate Bitcoin Hearings: Department of Justice Reports and SECs</a></li>
<li><a href="../202572/index.html">3D print show in Paris first hand</a></li>
<li><a href="../202574/index.html">Why don't airplanes fly by themselves?</a></li>
<li><a href="../202578/index.html">Javascript pong</a></li>
<li><a href="../202582/index.html">Identifying virtuals on Wikipedia</a></li>
<li><a href="../202588/index.html">Work with data in Yaml</a></li>
<li><a href="../202592/index.html">The history of creating a cross-platform mobile application</a></li>
<li><a href="../202594/index.html">Configuring Network Access for Hyper-V Virtual Machines from Different Subnets</a></li>
<li><a href="../202596/index.html">Programming in equations</a></li>
<li><a href="../202598/index.html">About bitcoins and money</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>