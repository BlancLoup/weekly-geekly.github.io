<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing Lock's on Alawar Sites</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction  Today we will talk about locks and show our implementation. Each developer has repeatedly encountered a problem when it is necessary to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing Lock's on Alawar Sites</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4>  Today we will talk about locks and show our implementation.  Each developer has repeatedly encountered a problem when it is necessary to ensure single-threaded use of a resource. <br><br>  Often, to ensure such a lock, a scheme is used to create a special file, the presence of which determines whether a particular resource is busy. <br><br>  This approach is quite simple to implement, but has several disadvantages.  Among the shortcomings can be identified: <br><ul><li>  lack of 100% guarantee of blocking with a large number of threads; </li><li>  locking works within a single server; </li><li>  and the most unpleasant - if the process that put the lock for some reason did not remove it, the other processes will not be able to access this resource until manually or in some other way this lock is removed. </li></ul><br><h4>  When do we need locks? </h4>  Each time the needs are different, mostly they are reduced to the exclusion of simultaneous repeated actions, ensuring consistent work with some resource, ensuring uniform load. <br><a name="habracut"></a><br><h4>  How to make yourself? </h4>  To implement the correct locks, you need to understand the principles of <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D1%2582%25D0%25BE%25D0%25BC%25D0%25B0%25D1%2580%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BE%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">atomicity</a> and <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F_%2528%25D0%25B7%25D0%25BD%25D0%25B0%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%2529">transactionality</a> .  We will not describe them in this article, since  There is already a lot of information on these topics on the Internet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      During implementation, we identified the main operations when working with locks: <br><ul><li>  take a lock for a certain time </li><li>  unlock after a specified time </li><li>  extend lock </li><li>  work case when the lock was intercepted </li></ul><br>  In fact, it is not very important what will be used as a provider of locks, these can be files, mysql, memcache, or any other tool convenient for you. <br><br>  Redis was closer to us, so we implemented our own blocking mechanism, which does not have the disadvantages listed above, on Redis. <br><br><h4>  How are locks made with us </h4>  Today we present our implementation ‚Äúas is‚Äù with additional comments on almost every line and an example of usage. <br><br>  Our implementation is used in a project on the Yii framework and uses it to connect to Redis via the Rediska library.  But the focus on Yii, as in Rediska, is small, so this code can be used in any PHP project. <br><br>  So, let's get down to the most interesting: <br><br><h5>  Base lock class </h5><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *    * */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *       * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $key )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $key; } <span class="hljs-comment"><span class="hljs-comment">/** *  true,       * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $timeWait -        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $maxExecuteTime -       * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $key, $timeWait = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $maxExecuteTime = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3600</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lock_Exception(<span class="hljs-string"><span class="hljs-string">'Not defined method getLock'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *     - * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentProcessId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $myProcessId = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $myProcessId === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) { $uname = posix_uname(); $mypid = getmypid(); $myProcessId = $uname[<span class="hljs-string"><span class="hljs-string">'nodename'</span></span>] . <span class="hljs-string"><span class="hljs-string">'_'</span></span> . $mypid; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $myProcessId; } <span class="hljs-comment"><span class="hljs-comment">/** *   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $delayAfter -          * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">releaseLock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $key, $delayAfter = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lock_Exception(<span class="hljs-string"><span class="hljs-string">'Not defined method releaseLock'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $timeProlongate -      * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool -   false,     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prolongate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $key, $timeProlongate )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lock_Exception(<span class="hljs-string"><span class="hljs-string">'Not defined method prolongate'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lock_Exception</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Exception</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timeout_Lock_Exception</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lock_Exception</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LostLock_Timeout_Lock_Exception</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timeout_Lock_Exception</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br><h5>  RedisLock class </h5>  In this class, locking is done using Redis: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *      Redis * */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RedisLock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    noSQL  * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $key )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   lock@      return 'lock@'.$key; } /** *  true,       * * @param string $key -   * @param float $timeWait -        * @param float $maxExecuteTime -       * @param integer $policy -   : * 0 -     ,      , * 1 -   10,    * @return bool */ static public function getLock( $key, $timeWait = 0, $maxExecuteTime = 3600, $policy = 0 ) { /** * ,     */ $timeStop = microtime(true) + $timeWait; //     Yii    Redis   Rediska $rediska = Yii::app()-&gt;rediskaConnection-&gt;connect(); while ( true ) { $currentTime = microtime(true); if ( $policy == 0 ) { /** *  ,     */ $expireAt = $rediska-&gt;getFromHash( self::getKey($key), 'expireAt' ); /** *  ,     ,     , *         */ if ( $expireAt &gt; $timeStop ) { return false; } /** *     ,     ,    */ elseif ( $expireAt &gt; $currentTime ) { usleep( 1000000 * intval($expireAt - $currentTime) ); $currentTime = microtime(true); } } elseif ( $policy == 1 ) { /** *  ,     */ $expireAt = $rediska-&gt;getFromHash( self::getKey($key), 'expireAt' ); while ( $expireAt &gt; $timeStop || $expireAt &gt; $currentTime ) { usleep( 10000 ); /** *  ,     */ $expireAt = $rediska-&gt;getFromHash( self::getKey($key), 'expireAt' ); $currentTime = microtime(true); if ( $currentTime &gt;= $timeStop ) { return false; } } } $getLock = false; /** *     *  getConnectionByKeyName    ,      Redis */ $transaction = $rediska-&gt;transaction( $rediska-&gt;getConnectionByKeyName( self::getKey($key) ) ); $transaction-&gt;watch( self::getKey($key) ); $arData = $rediska-&gt;getHash( self::getKey($key) ); //     $daddy = isset($arData['daddy']) ? $arData['daddy'] : ''; //     $expireAt = isset($arData['expireAt']) ? $arData['expireAt'] : 0; /** *    ,     ,     *         */ if ( $daddy != self::getCurrentProcessId() &amp;&amp; $expireAt &lt; $currentTime ) { $transaction-&gt;setToHash( self::getKey($key), array( 'daddy' =&gt; self::getCurrentProcessId(), 'expireAt' =&gt; $currentTime + $maxExecuteTime ) ); $transaction-&gt;expire( self::getKey($key), ceil($currentTime + $maxExecuteTime), true ); try { $transaction-&gt;execute(); $getLock = 1; } catch ( Rediska_Transaction_Exception $e ) { /** *     */ $getLock = false; } } else { $getLock = false; $transaction-&gt;discard(); } /** *      */ if ( $getLock != 1 ) { // HSETNX $getLock = $rediska-&gt;setToHash( self::getKey($key), 'daddy', self::getCurrentProcessId(), false ); } /** *    */ if ( $getLock == 1 ) { /** *  ,     */ $rediska-&gt;setToHash(self::getKey($key), 'expireAt', $currentTime + $maxExecuteTime); $rediska-&gt;expire(self::getKey($key), ceil($currentTime + $maxExecuteTime), true); return true; } else { /** *       ,       */ if ( $timeStop &gt; $currentTime ) { usleep(20000); } /** *  ,    */ else { return false; } } } } /** *   * * @param string $key -   * @param float $delayAfter -          * @return bool */ static public function releaseLock( $key, $delayAfter = 0 ) { $currentTime = microtime(true); $rediska = Yii::app()-&gt;rediskaConnection-&gt;connect(); $transaction = $rediska-&gt;transaction( $rediska-&gt;getConnectionByKeyName( self::getKey($key) ) ); $transaction-&gt;watch( self::getKey($key) ); $arData = $rediska-&gt;getHash( self::getKey($key) ); if ( is_array($arData) &amp;&amp; isset($arData['daddy']) &amp;&amp; isset($arData['expireAt']) ) { $daddy = $arData['daddy']; $expireAt = $arData['expireAt']; } else { $daddy = false; $expireAt = 0; } /** *          ,     */ if ( $daddy == self::getCurrentProcessId() ) { $transaction-&gt;setToHash(self::getKey($key), 'expireAt', $currentTime + $delayAfter); $transaction-&gt;expire(self::getKey($key), ceil($currentTime + $delayAfter), true); $transaction-&gt;deleteFromHash( self::getKey($key), 'daddy' ); /** *     */ try { $transaction-&gt;execute(); $result = true; } catch (Rediska_Transaction_Exception $e) { $result = false; } } else { $transaction-&gt;discard(); $result = false; } //       if ( $expireAt &lt; $currentTime ) { if ( $result ) { /** *  ,     */ throw new Timeout_Lock_Exception('Timeout Lock on release'); } else { /** *       */ throw new LostLock_Timeout_Lock_Exception('Timeout Lock and it was lost before release'); } } return $result; } /** *     * * @param string $key -   * @param float $timeProlongate -      * @return bool -   false,     */ static public function prolongate( $key, $timeProlongate ) { $rediska = Yii::app()-&gt;rediskaConnection-&gt;connect(); $transaction = $rediska-&gt;transaction( $rediska-&gt;getConnectionByKeyName( self::getKey($key) ) ); $transaction-&gt;watch( self::getKey($key) ); $arData = $rediska-&gt;getHash( self::getKey($key) ); $daddy = $arData['daddy']; $expireAt = $arData['expireAt']; $currentTime = microtime(true); $result = false; if ( $daddy == self::getCurrentProcessId() ) { $transaction-&gt;setToHash( self::getKey($key), 'expireAt', $currentTime + $timeProlongate ); $transaction-&gt;expire(self::getKey($key), ceil($currentTime + $timeProlongate), true); try { $transaction-&gt;execute(); $result = true; } catch (Rediska_Transaction_Exception $e) { $result = false; } } else { $transaction-&gt;discard(); $result = false; } if ( $expireAt &lt; $currentTime ) { if ( $result ) { throw new Timeout_Lock_Exception('Timeout Lock on prolongate'); } else { throw new LostLock_Timeout_Lock_Exception('Timeout Lock and Lost them on prolongate'); } } return $result; } }</span></span></code> </pre><br><h5>  Usage example </h5>  Suppose we have a script that generates reports.  And this script does not make sense to run simultaneously in several threads, because  as a result, they all will produce the same result, but each will require a large amount of resources during the work.  We know that this script will work on average in 40-50 minutes, so we will make a small margin and set the lock for 60 minutes. <br><pre> <code class="php hljs"> $lockKey = <span class="hljs-string"><span class="hljs-string">'cron-report'</span></span>; $timeWait = <span class="hljs-number"><span class="hljs-number">0</span></span>; $timeLock = <span class="hljs-number"><span class="hljs-number">3600</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( RedisLock::getLock( $lockKey, $timeWait, $timeLock ) ) { <span class="hljs-comment"><span class="hljs-comment">//  ,     ... //          ,     try { RedisLock::releaseLock( $lockKey, 0 ); echo 'Ok'; } catch ( Timeout_Lock_Exception $e ) { //   //     ,      ,             echo 'Timeout_Lock_Exception ' . ( $endTime - $currentTime ); } catch ( LostLock_Timeout_Lock_Exception $e ) { //   //     ,      ,               echo 'LostLock_Timeout_Lock_Exception' . ( $endTime - $currentTime ); } }</span></span></code> </pre><br>  We hope that our implementation will be useful to you. <br><br>  We are waiting for your questions and comments. </div><p>Source: <a href="https://habr.com/ru/post/158799/">https://habr.com/ru/post/158799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158785/index.html">Tor? I2p? Maybe something else?</a></li>
<li><a href="../158787/index.html">Testing in Yandex. HTML Elements Framework: What is missing in the Page Object, and how to fix it</a></li>
<li><a href="../158789/index.html">What every designer in a startup should understand</a></li>
<li><a href="../158795/index.html">Sony Mobile is recognized as the manufacturer of the year by xda-developers.com</a></li>
<li><a href="../158797/index.html">Buildy: HTML5 sandbox for adults</a></li>
<li><a href="../158801/index.html">Black and white laser and LED printing</a></li>
<li><a href="../158805/index.html">‚ÄúNot a single remote control‚Äù or ‚ÄúHow to turn an android-smartphone into a remote control for LG Smart TV‚Äù</a></li>
<li><a href="../158807/index.html">Skype gives out a month of free calls around the world.</a></li>
<li><a href="../158809/index.html">About the dangers of cell phones</a></li>
<li><a href="../158811/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>