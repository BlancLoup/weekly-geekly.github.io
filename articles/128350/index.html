<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search text by subdirectories</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During the work of the administrator there are questions, the solution of which is periodically postponed for seemingly insignificant, but sometimes t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search text by subdirectories</h1><div class="post__text post__text-html js-mediator-article">  During the work of the administrator there are questions, the solution of which is periodically postponed for seemingly insignificant, but sometimes they surprise with unexpectedly found answers.  I hasten to share one such question with a simple answer (windows files, the solution is linux, so the bias is more towards linux). <br><br>  The question was: to bypass all text files in subdirectories and display the values ‚Äã‚Äãof text strings by a regular expression.  (It is clear that no explorer or windows-commander will help here). <br><br>  Circumstances: <br>  Many logs in text files.  The log values ‚Äã‚Äãare mainly the registry hives FireFox, FlashPlayer, office, etc. in JSON format.  Scripts were written in JavaScript + WMI and placed in Active Directory in the autoload of the computer and the user.  Here are some registry keys that were of primary interest: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      HKLM \ Software \ Macromedia \ FlashPlayer <br>  HKLM \ Software \ Macromedia \ FlashPlayerActiveX <br>  HKLM \ Software \ Macromedia \ FlashPlayerPlugin <br>  HKLM \ Software \ Microsoft \ Windows \ CurrentVersion \ Uninstall <br>  HKLM \ Software \ Mozilla.org <br>  HKLM \ Software \ Mozilla <br>  HKLM \ Software \ MozillaPlugins <br><br><a name="habracut"></a><br>  Logs were created in text files in the following format <b>\\ serverlog \ logs $ \ [Date] \ [computer name] \ [path to the registry hive without forbidden special characters] .txt</b> .  An example of the name of such a file is " <b>\\ serverlegs \ logs $ \ regToFile.ANSI \ 2011-09-13 \ regToFile- [12-143057] [2011-09-03] \ [HKCU] [SOFTWARE] [Macromedia] [FlashPlayer]. txt</b> ".  An example of its content: <br><br><pre> [
  {"path": "HKLM \\ SOFTWARE \\ Macromedia \\ FlashPlayer", "type": "folder"},
  {"path": "HKLM \\ SOFTWARE \\ Macromedia \\ FlashPlayer", "type": "REG_SZ", "name": "CurrentVersion", "value": "9,0,45,0"},
  {"path": "HKLM \\ SOFTWARE \\ Macromedia \\ FlashPlayer \\ SafeVersions", "type": "folder"},
  {"path": "HKLM \\ SOFTWARE \\ Macromedia \\ FlashPlayer \\ SafeVersions", "type": "REG_DWORD", "name": "6.0", "value": 88},
  {"path": "HKLM \\ SOFTWARE \\ Macromedia \\ FlashPlayer \\ SafeVersions", "type": "REG_DWORD", "name": "7.0", "value": 65},
  {"path": "HKLM \\ SOFTWARE \\ Macromedia \\ FlashPlayer \\ SafeVersions", "type": "REG_DWORD", "name": "8.0", "value": 33},
  {"path": "HKLM \\ SOFTWARE \\ Macromedia \\ FlashPlayer \\ SafeVersions", "type": "REG_DWORD", "name": "9.0", "value": 45}
 ]
</pre><br><br>  There are more than one hundred machines in the domain and the number of files has quickly grown.  Having such a set of logs, I sometimes want to make up on the fly some picture of the contents of files in the following form: <br><br><img src="https://habrastorage.org/storage1/db077188/afc3a00d/4d729bd5/11e08e2c.jpg"><br><br>  But it turned out that if the log files are scattered in subdirectories, then it is impossible to execute the (windows) find command on them, it does not look for it in subdirectories.  Mount the network directory with logs in Ubuntu ( <b>sudo mount -t cifs -o user = &lt;domain \\ username&gt;, password = &lt;domain_password&gt;, iocharset = utf8 // serverlogs / logs $ / / media / serverlogs /</b> ).  Attempt to linux at first did not bring success.  The find command has the same problems there!  But linux is so good that its console is admin-oriented, although the interface is not friendly at all.  In man it is written that the find command has the option <b>-exec</b> .  This is just a super option.  It would seem that we only need to substitute the <b>grep</b> command in this key and we get the coveted result ... But here we are in for a slight disappointment!  Log files were written to UNICODE (maybe my architectural error?), And grep doesn‚Äôt understand UNICODE (but UTF-8 understands).  We develop the idea further: there is the <b>iconv</b> command, which can convert encodings on the fly.  This is where her opportunity came in handy.  Additionally, use the "pipeline" and get a command of this type: <br><br> <code><b>time find /media/serverlogs/regToFile.ANSI/ -name "*.txt" -exec iconv -f UNICODE -t UTF-8 {} \; | grep 'Macromedia\\\\FlashPlayer.*CurrentVersion'</b></code> <br> <br>  A little bit of explanation: <br>  [ <b>time</b> ] - <i>displays the time spent on the execution of the command</i> . <br>  [ <b>find /media/server03-logs/regToFile.ANSI/ -name "* .txt"</b> ] - <i>output all files of type * .txt that are in subdirectories [/media/serverlogs/regToFile.ANSI/]</i> <br>  [ <b>-exec iconv -f UNICODE -t UTF-8 {} \;</b>  ] - <i>convert the contents of the found file (one at a time) from the UNICODE encoding to UTF-8</i> <br>  [ <b>| |</b>  <b>grep 'Macromedia \\\\ FlashPlayer. * CurrentVersion'</b> ] - <i>find the line Macromedia \\\\ FlashPlayer. * CurrentVersion in the converted text</i> <br><br>  The desired result is achieved and looks like the picture above.  I think that I am not the only one who had such a problem.  If someone comes in handy, I will be happy. <br><br>  PS <br>  After analyzing the comments, man grep -r and help on ‚ÄúSystem.FileSystemObject‚Äù. OpenAsTextStream () came to the conclusion that the problem was ‚Äúhidden‚Äù in this very method of OpenAsTextStream ().  It has a format parameter.  If it is -1, the file is opened in UNICODE mode, and if it is 0, then in ASCII mode (but not ANSI !, and utf-8).  I had -1.  That was the root of the problem.  I installed it at 0 and it started working with grep -r (on linux) and findstr on windows.  It is strange, of course, that they do not understand UNICODE.  Well, what if I want to do something with the found string before displaying it on the screen, I will use find -exec. <br><br>  To display the found lines: <br><br>  JavaScript -&gt; "System.FileSystemObject" .OpenAsTextStream (ForAppending, TristateFalse);  (TristateFalse for UTF-8 !!!!) <br>  Windows: <br>  cd &lt;rootPath&gt; <br>  findstr / s "text" * .txt <br><br>  Linux: <br>  grep -r "text" &lt;rootPath&gt; <br><br>  Continuing the topic of the search, I converted the files with the UNICODE format logs to the UTF-8 format (in the linux / bash console): <br><br> <code>time find /media/serverlogs/ -name "*.txt" -exec iconv -f=UNICODE -t=UTF-8 {} -o {}.utf8 \; -exec echo {} \;</code> <br> <br>  I pay attention that for output of the name of the converted file to the console it is necessary to use the <b>‚Äìexec</b> key two times.  Combining commands with the &amp;&amp; method in the same key -exec will fail.  The -exec key accepts only one command. </div><p>Source: <a href="https://habr.com/ru/post/128350/">https://habr.com/ru/post/128350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128345/index.html">We program SSRAM on FPGA</a></li>
<li><a href="../128346/index.html">Free Wi-Fi will appear in the Moscow metro</a></li>
<li><a href="../128347/index.html">Making Doodle Jump to HTML5</a></li>
<li><a href="../128348/index.html">Captcha brotherhood</a></li>
<li><a href="../128349/index.html">XNA Draw or write a particle system. Part II: Shaders</a></li>
<li><a href="../128351/index.html">Copy-paste without intermediaries</a></li>
<li><a href="../128352/index.html">MarkitUp! - Easy jQuery editor</a></li>
<li><a href="../128355/index.html">Help make web browsers better</a></li>
<li><a href="../128359/index.html">Web Symbols</a></li>
<li><a href="../128361/index.html">Symbian Sunrise and Sunset</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>