<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Profiler for Entity Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings 

 I will continue a series of articles about programming. This time, I want to tell you about the free profiler I wrote for the Entity Fram...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Profiler for Entity Framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f3c/3be/a1f/f3c3bea1fcedb7d975612d893eb44a26.png"><br><br>  Greetings <br><br>  I will continue a <a href="http://habrahabr.ru/users/Diaver/topics/">series of articles</a> about programming.  This time, I want to tell you about the free profiler I wrote for the Entity Framework (hereinafter EF) from version 4 to version 6, as well as some of the solutions I applied, such as decompiling .NET code on the fly, a form for exception handling and so on. <br>  Nuget package for EF6: <a href="https://www.nuget.org/packages/EFlogger-For6/">https://www.nuget.org/packages/EFlogger-For6/</a> <br>  Nuget package for EF4 - 5: <a href="https://www.nuget.org/packages/EFlogger-For4/">https://www.nuget.org/packages/EFlogger-For4/</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Details under the cut. <br><a name="habracut"></a><br><h5>  Introduction </h5><br>  When I started studying EF, I faced the question of profiling the queries generated by EF.  After some searching, I found out with displeasure that EF does not provide standard tools, so I had to use, in my opinion, the extremely inconvenient program to use SQL Server Profiler or buy an expensive enough third-party <a href="http://www.hibernatingrhinos.com/products/efprof">Entity Framework Profiler 2.0</a> tool for $ 389.00, <s>and I'm greedy</s> . <br><br>  With the advent of EF version 6, the situation with command logging has changed.  A mechanism has appeared that allows you to add your interceptor: <br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//     IDbCommandInterceptor DbInterception.Add(new LogFormatter());</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogFormatter</span></span> : <span class="hljs-title"><span class="hljs-title">IDbCommandInterceptor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Stopwatch _stopwatch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stopwatch(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NonQueryExecuting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DbCommand command, DbCommandInterceptionContext&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; interceptionContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   _stopwatch.Restart(); } public void NonQueryExecuted(DbCommand command, DbCommandInterceptionContext&lt;int&gt; interceptionContext) { //   _stopwatch.Stop(); //   Log(command, interceptionContext); } public void ReaderExecuting(DbCommand command, DbCommandInterceptionContext&lt;DbDataReader&gt; interceptionContext) { _stopwatch.Restart(); } public void ReaderExecuted(DbCommand command, DbCommandInterceptionContext&lt;DbDataReader&gt; interceptionContext) { _stopwatch.Stop(); Log(command, interceptionContext); } public void ScalarExecuting(DbCommand command, DbCommandInterceptionContext&lt;object&gt; interceptionContext) { _stopwatch.Restart(); } public void ScalarExecuted(DbCommand command, DbCommandInterceptionContext&lt;object&gt; interceptionContext) { _stopwatch.Stop(); Log(command, interceptionContext); } private void Log&lt;TResult&gt;(DbCommand command, DbCommandInterceptionContext&lt;TResult&gt; interceptionContext) { Logger.Log(command, _stopwatch.ElapsedMilliseconds, interceptionContext.Exception); } }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Logger</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DbCommand command, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elapsedMilliseconds, Exception exception</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   Trace  Trace.WriteLine(string.Format("Command:{0}, Elapsed Milliseconds:{1}", command.CommandText, elapsedMilliseconds)); } }</span></span></code> </pre><br>  For the 4th version of EF, I did not find a similar logging mechanism. <br><br><h5>  My decision </h5><br>  The idea to write my own profiler, which repeats the functionality of a paid one, I have been carrying for a long time.  The initial version was based on the EF 6th interceptor mechanism, but unfortunately in EF 4th, this mechanism does not work. <br>  After a brief googling, a great library was found for EF profiling in ASP MVC applications called <a href="http://miniprofiler.com/">MiniProfiler</a> .  Based on it, it was decided to make your application. <br><br><h5>  What happened </h5><br>  The system was as simple as possible to use and integrate.  You can pick up binaries with a project example on the wordpress-e site I created at <a href="http://ef-logger.com/">http://ef-logger.com/</a> <br>  Nuget package for EF6: <a href="https://www.nuget.org/packages/EFlogger-For6/">https://www.nuget.org/packages/EFlogger-For6/</a> <br>  The main application window: <br><img src="https://habrastorage.org/getpro/habr/post_images/481/3e0/156/4813e0156b74bf05ad9ed78376588e5a.png"><br><br><h5>  Using </h5><br>  1. Pick up the archive with <a href="http://ef-logger.com/download/">binaries and project example</a> <br><img src="https://habrastorage.org/getpro/habr/post_images/9a3/0ee/058/9a30ee058b5b9b92a0e1f58d2f971cc0.png"><br>  2. Connect the EFlogger.EntityFramework4.dll library for EF 4-5 version and EFlogger.EntityFramework6.dll for EF 6th version <br>  3. Initialize the profiler by running a static method. <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  EF 6-  EFloggerFor6.Initialize(); //   EF  4-  6- EFloggerFor4.Initialize();</span></span></code> </pre><br>  4. Run the EFlogger.exe application. <br><br><h5>  API </h5><br>  An example for the library EFlogger.EntityFramework6.dl, in the case of using EFlogger.EntityFramework4.dl the static class will be called EFloggerFor4 <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// EFloggerFor6.Initialize(); //  IP       "127.0.0.1" EFloggerFor6.SetProfilerClientIP(‚Äú192.168.10.50‚Ä≥); //      EFloggerFor6.WriteMessage(‚ÄúText message‚Äù); //     (     ) EFloggerFor6.StartSendToClient(); //     EFloggerFor6.StopSendToClient(); //     EFlogger.log  EFloggerFor6.StartSaveToLogFile(); //     EFlogger.log  EFloggerFor6.StopSaveToLogFile(); //       ,   EFloggerFor6.ClearLog(); //    EFloggerFor6.DisableDecompiling(); //       Stack Trace-a EFloggerFor6.ExcludeAssembly(‚ÄúMyAssemly‚Äù);</span></span></code> </pre><br><br><h5>  How it all works </h5><br>  The implementation mechanism in EF version 4 is very different from version 6 EF. <br>  There are no established DbProviderFactory substitution mechanisms in EF 4, so you have to replace the standard factory with your own one through reflection. <br>  The process itself looks like this: <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      DbProviderFactories.GetFactoryClasses(); //   DbProviderFactories Type type = typeof(DbProviderFactories); DataTable table = null; //  DataSet   _configTable  _providerTable object setOrTable = (type.GetField("_configTable", BindingFlags.NonPublic | BindingFlags.Static) ?? type.GetField("_providerTable", BindingFlags.NonPublic | BindingFlags.Static)).GetValue(null); var set = setOrTable as DataSet; if (set != null) table = set.Tables["DbProviderFactories"]; table = (DataTable)setOrTable; //     DataTable    foreach (DataRow row in table.Rows.Cast&lt;DataRow&gt;().ToList()) { DbProviderFactory factory; try { factory = DbProviderFactories.GetFactory(row); } catch (Exception) { continue; } var profType = EFProviderUtilities.ResolveFactoryType(factory.GetType()); if (profType != null) { DataRow profiled = table.NewRow(); profiled["Name"] = row["Name"]; profiled["Description"] = row["Description"]; profiled["InvariantName"] = row["InvariantName"]; profiled["AssemblyQualifiedName"] = profType.AssemblyQualifiedName; table.Rows.Remove(row); table.Rows.Add(profiled); } }</span></span></code> </pre><br>  To integrate into EF 6th version, you can use the regular service substitution mechanism: <br><pre> <code class="cs hljs">DbConfiguration.Loaded += (_, a) =&gt; a.ReplaceService&lt;DbProviderServices&gt;((s, k) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EFProfiledDbProviderServices());</code> </pre><br><br><h5>  Decompilation </h5><br>  EFlogger on the fly decompiles the code and displays the body of the method that generated this or that request.  Libraries from the free <a href="http://habrahabr.ru/post/113500/">ILSpy</a> reflector are used for this.  To decompose a method, you must first find it by going up the Stack Trace and eliminate unnecessary calls to third-party libraries: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> StackFrame outStackFrame</span></span></span><span class="hljs-function">)</span></span> { outStackFrame = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frames = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StackTrace(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).GetFrames(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (frames == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methods = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-comment"><span class="hljs-comment">//     foreach (StackFrame t in frames) { //   var method = t.GetMethod(); //         var assembly = method.Module.Assembly.GetName().Name; if (ShouldExcludeType(method) || AssembliesToExclude.Contains(assembly) || MethodsToExclude.Contains(method.Name)) continue; //            ,           if (outStackFrame == null) { outStackFrame = t; } methods.Add(method.DeclaringType.FullName + ":" + method.Name); } return string.Join("\r\n", methods); }</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMethodBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">StackFrame stackFrame</span></span></span><span class="hljs-function">)</span></span> { MethodBase methodBase = stackFrame.GetMethod(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Decompiler.GetSourceCode(methodBase.Module.FullyQualifiedName, methodBase.DeclaringType.Name, methodBase.Name); }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Decompiler</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ICSharpCode.Decompiler; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ICSharpCode.Decompiler.Ast; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ICSharpCode.Decompiler.Ast.Transforms; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Mono.Cecil; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Common</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Decompiler</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSourceCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pathToAssembly, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> className, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> methodName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assemblyDefinition = AssemblyDefinition.ReadAssembly(pathToAssembly); TypeDefinition assembleDefenition = assemblyDefinition.MainModule.Types.First(type =&gt; type.Name == className); MethodDefinition methodDefinition = assembleDefenition.Methods.First(method =&gt; method.Name == methodName); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringWriter(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> plainTextOutput = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlainTextOutput(output); DecompileMethod(methodDefinition, plainTextOutput); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output.ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Exception in decompling. \r\n Message:{0}, \r\n Inner Exception:{1}, \r\n StackTrace:{2}"</span></span>,exception.Message, exception.InnerException, exception.StackTrace); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecompileMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MethodDefinition method, ITextOutput output</span></span></span><span class="hljs-function">)</span></span> { AstBuilder codeDomBuilder = CreateAstBuilder(currentType: method.DeclaringType, isSingleMember: <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method.IsConstructor &amp;&amp; !method.IsStatic &amp;&amp; !method.DeclaringType.IsValueType) { AddFieldsAndCtors(codeDomBuilder, method.DeclaringType, method.IsStatic); RunTransformsAndGenerateCode(codeDomBuilder, output); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { codeDomBuilder.AddMethod(method); RunTransformsAndGenerateCode(codeDomBuilder, output); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> AstBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateAstBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModuleDefinition currentModule = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span><span class="hljs-function"><span class="hljs-params">, TypeDefinition currentType = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isSingleMember = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentModule == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) currentModule = currentType.Module; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DecompilerSettings(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isSingleMember) { settings = settings.Clone(); settings.UsingDeclarations = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AstBuilder( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DecompilerContext(currentModule) { CurrentType = currentType, Settings = settings }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFieldsAndCtors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AstBuilder codeDomBuilder, TypeDefinition declaringType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isStatic</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> field <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> declaringType.Fields) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.IsStatic == isStatic) codeDomBuilder.AddField(field); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ctor <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> declaringType.Methods) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ctor.IsConstructor &amp;&amp; ctor.IsStatic == isStatic) codeDomBuilder.AddMethod(ctor); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunTransformsAndGenerateCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AstBuilder astBuilder, ITextOutput output, IAstTransform additionalTransform = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { astBuilder.GenerateCode(output); } } }</code> </pre></div></div><br>  An example of a working draft decompilation on Yandex files: <a href="http://yadi.sk/d/AzBGet5-Nwns2">yadi.sk/d/AzBGet5-Nwns2</a> <br><br><h5>  Exception Handling Window </h5><br>  It's no secret that applications periodically fall, this can happen for a variety of reasons and the developer‚Äôs task is to show some sane window for an error message. <br>  My form option looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/3d3/eee/38a/3d3eee38a2e65486bd9d2d383ca4442f.png"><br><br>  The form prompts the user to add information about the error, steps to reproduce, and your email to respond. <br>  When you click on the Send button, the developer receives an email with all the data. <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">STAThread</span></span>] [STAThread] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { SetupLogger(); <span class="hljs-comment"><span class="hljs-comment">//     if (!Debugger.IsAttached) { //     Application.ThreadException += (sender, e) =&gt; HandleError(e.Exception); AppDomain.CurrentDomain.UnhandledException += (sender, e) =&gt; HandleError((Exception)e.ExceptionObject); } Application.EnableVisualStyles(); Application.SetCompatibleTextRenderingDefault(false); Application.Run(new MainForm()); } private static void HandleError(Exception exception) { try { //     try/catch         new ErrorHandlerController(exception).Run(); } catch (Exception e) { MessageBox.Show("Error processing exception. Please send log file EFlogger.log to developer: " + Settings.Default.ProgrammerEmail + " \r\n Exception:" + e); //      Logger.Error(e); if (MessageBox.Show("Attach debugger? \n Only for developer!!!", "Debugging...", MessageBoxButtons.YesNo, MessageBoxIcon.Question) == DialogResult.Yes) { Debugger.Launch(); throw; } } finally { //      Windows       Environment.Exit(1); } } //new ErrorHandlerController(exception).Run(); public void Run() { //    string exceptionInfoText = string.Format( "An unexpected error occurred: {0}" + Environment.NewLine + "Time: {1} " + Environment.NewLine + "{2}" + Environment.NewLine + "InnerException: \n {3}" + Environment.NewLine + "InnerException StackTrace: \n {4}" + Environment.NewLine, _exception.Message, DateTime.Now, _exception, _exception.InnerException, _exception.InnerException != null ? _exception.InnerException.StackTrace : string.Empty ); //      Program.Logger.Error(exceptionInfoText); _view.ExceptionInfoText = exceptionInfoText; //  ,   ShowDialog,         _view.ShowDialog(); }</span></span></code> </pre><br>  An example of a working draft with an error handling form can be <a href="http://yadi.sk/d/7y4i_cz7NwtE3">collected</a> on Yandex files: <a href="http://yadi.sk/d/7y4i_cz7NwtE3">yadi.sk/d/7y4i_cz7NwtE3</a> <br><br><h5>  Networking </h5><br>  You can read the details of the network interaction between the connected library and the profiler from my previous article: <a href="http://habrahabr.ru/post/220285/">Networking via TCP in C #</a> <br><br><h5>  A bit of humor </h5><br>  During the testing of a tool on a friend‚Äôs <s>experimental</s> tool, such an incredible generated query was found (very large and strange): <br><div class="spoiler">  <b class="spoiler_title">Request</b> <div class="spoiler_text">  Command text: <br><pre> SELECT 
     [Project238]. [C4] AS [C1], 
     [Project238]. [Name] AS [Name], 
     [Project238]. [Name1] AS [Name1], 
     [Project238]. [C2] AS [C2], 
     [Project238]. [C3] AS [C3], 
     [Project238]. [C1] AS [C4]
     FROM (SELECT 
         [GroupBy1]. [A1] AS [C1], 
         [GroupBy1]. [K1] AS [Name], 
         [GroupBy1]. [K2] AS [Name1], 
         [GroupBy1]. [K3] AS [C2], 
         [GroupBy1]. [K4] AS [C3], 
         1 AS [C4]
         FROM (SELECT 
             [Project237]. [Name] AS [K1], 
             [Project237]. [Name1] AS [K2], 
             [Project237]. [C1] AS [K3], 
             [Project237]. [C2] AS [K4], 
             COUNT (1) AS [A1]
             FROM (SELECT 
                 [Extent2]. [Name] AS [Name], 
                 [Extent3]. [Name] AS [Name1], 
                 DATEPART (year, [Join3]. [C11]) AS [C1], 
                 DATEPART (month, [Join3]. [C12]) AS [C2]
                 FROM [OccupationHistory] AS [Extent1]
                 INNER JOIN [Division] AS [Extent2] ON [Extent1]. [DivisionID] = [Extent2]. [Id]
                 INNER JOIN [Position] AS [Extent3] ON [Extent1]. [PositionID] = [Extent3]. [Id]
                 CROSS JOIN (SELECT [UnionAll59]. [C1] AS [C11], [UnionAll118]. [C1] AS [C12]
                     FROM (SELECT 
                         [UnionAll58]. [C1] AS [C1]
                         FROM (SELECT 
                             [UnionAll57]. [C1] AS [C1]
                             FROM (SELECT 
                                 [UnionAll56]. [C1] AS [C1]
                                 FROM (SELECT 
                                     [UnionAll55]. [C1] AS [C1]
                                     FROM (SELECT 
                                         [UnionAll54]. [C1] AS [C1]
                                         FROM (SELECT 
                                             [UnionAll53]. [C1] AS [C1]
                                             FROM (SELECT 
                                                 [UnionAll52]. [C1] AS [C1]
                                                 FROM (SELECT 
                                                     [UnionAll51]. [C1] AS [C1]
                                                     FROM (SELECT 
                                                         [UnionAll50]. [C1] AS [C1]
                                                         FROM (SELECT 
                                                             [UnionAll49]. [C1] AS [C1]
                                                             FROM (SELECT 
                                                                 [UnionAll48]. [C1] AS [C1]
                                                                 FROM (SELECT 
                                                                     [UnionAll47]. [C1] AS [C1]
                                                                     FROM (SELECT 
                                                                         [UnionAll46]. [C1] AS [C1]
                                                                         FROM (SELECT 
                                                                             [UnionAll45]. [C1] AS [C1]
                                                                             FROM (SELECT 
                                                                                 [UnionAll44]. [C1] AS [C1]
                                                                                 FROM (SELECT 
                                                                                     [UnionAll43]. [C1] AS [C1]
                                                                                     FROM (SELECT 
                                                                                         [UnionAll42]. [C1] AS [C1]
                                                                                         FROM (SELECT 
                                                                                             [UnionAll41]. [C1] AS [C1]
                                                                                             FROM (SELECT 
                                                                                                 [UnionAll40]. [C1] AS [C1]
                                                                                                 FROM (SELECT 
                                                                                                     [UnionAll39]. [C1] AS [C1]
                                                                                                     FROM (SELECT 
                                                                                                         [UnionAll38]. [C1] AS [C1]
                                                                                                         FROM (SELECT 
                                                                                                             [UnionAll37]. [C1] AS [C1]
                                                                                                             FROM (SELECT 
                                                                                                                 [UnionAll36]. [C1] AS [C1]
                                                                                                                 FROM (SELECT 
                                                                                                                     [UnionAll35]. [C1] AS [C1]
                                                                                                                     FROM (SELECT 
                                                                                                                         [UnionAll34]. [C1] AS [C1]
                                                                                                                         FROM (SELECT 
                                                                                                                             [UnionAll33]. [C1] AS [C1]
                                                                                                                             FROM (SELECT 
                                                                                                                                 [UnionAll32]. [C1] AS [C1]
                                                                                                                                 FROM (SELECT 
                                                                                                                                     [UnionAll31]. [C1] AS [C1]
                                                                                                                                     FROM (SELECT 
                                                                                                                                         [UnionAll30]. [C1] AS [C1]
                                                                                                                                         FROM (SELECT 
                                                                                                                                             [UnionAll29]. [C1] AS [C1]
                                                                                                                                             FROM (SELECT 
                                                                                                                                                 [UnionAll28]. [C1] AS [C1]
                                                                                                                                                 FROM (SELECT 
                                                                                                                                                     [UnionAll27]. [C1] AS [C1]
                                                                                                                                                     FROM (SELECT 
                                                                                                                                                         [UnionAll26]. [C1] AS [C1]
                                                                                                                                                         FROM (SELECT 
                                                                                                                                                             [UnionAll25]. [C1] AS [C1]
                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                 [UnionAll24]. [C1] AS [C1]
                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                     [UnionAll23]. [C1] AS [C1]
                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                         [UnionAll22]. [C1] AS [C1]
                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                             [UnionAll21]. [C1] AS [C1]
                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                 [UnionAll20]. [C1] AS [C1]
                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                     [UnionAll19]. [C1] AS [C1]
                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                         [UnionAll18]. [C1] AS [C1]
                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                             [UnionAll17]. [C1] AS [C1]
                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                 [UnionAll16]. [C1] AS [C1]
                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                     [UnionAll15]. [C1] AS [C1]
                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                         [UnionAll14]. [C1] AS [C1]
                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                             [UnionAll13]. [C1] AS [C1]
                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                 [UnionAll12]. [C1] AS [C1]
                                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                                     [UnionAll11]. [C1] AS [C1]
                                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                                         [UnionAll10]. [C1] AS [C1]
                                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                                             [UnionAll9]. [C1] AS [C1]
                                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                                 [UnionAll8]. [C1] AS [C1]
                                                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                                                     [UnionAll7]. [C1] AS [C1]
                                                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                                                         [UnionAll6]. [C1] AS [C1]
                                                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                                                             [UnionAll5]. [C1] AS [C1]
                                                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                                                 [UnionAll4]. [C1] AS [C1]
                                                                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                                                                     [UnionAll3]. [C1] AS [C1]
                                                                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                                                                         [UnionAll2]. [C1] AS [C1]
                                                                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                                                                             [UnionAll1]. [C1] AS [C1]
                                                                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                                                                 convert (datetime, '2001-01-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable1]
                                                                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                                                                 convert (datetime, '2001-02-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable2]) AS [UnionAll1]
                                                                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                                                                             convert (datetime, '2001-03-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable3]) AS [UnionAll2]
                                                                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                                                                         convert (datetime, '2001-04-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable4]) AS [UnionAll3]
                                                                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                                                                     convert (datetime, '2001-05-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable5]) AS [UnionAll4]
                                                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                                                 convert (datetime, '2001-06-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable6]) AS [UnionAll5]
                                                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                                                             convert (datetime, '2001-07-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable7]) AS [UnionAll6]
                                                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                                                         convert (datetime, '2001-08-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable8]) AS [UnionAll7]
                                                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                                                     convert (datetime, '2001-09-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable9]) AS [UnionAll8]
                                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                                 convert (datetime, '2001-10-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable10]) AS [UnionAll9]
                                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                                             convert (datetime, '2001-11-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable11]) AS [UnionAll10]
                                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                                         convert (datetime, '2001-12-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable12]) AS [UnionAll11]
                                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                                     convert (datetime, '2002-01-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable13]) AS [UnionAll12]
                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                 convert (datetime, '2002-02-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable14]) AS [UnionAll13]
                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                             convert (datetime, '2002-03-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable15]) AS [UnionAll14]
                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                         convert (datetime, '2002-04-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable16]) AS [UnionAll15]
                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                     convert (datetime, '2002-05-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable17]) AS [UnionAll16]
                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                 convert (datetime, '2002-06-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable18]) AS [UnionAll17]
                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                             SELECT 
                                                                                                                                                                                             convert (datetime, '2002-07-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable19]) AS [UnionAll18]
                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                         SELECT 
                                                                                                                                                                                         convert (datetime, '2002-08-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable20]) AS [UnionAll19]
                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                     SELECT 
                                                                                                                                                                                     convert (datetime, '2002-09-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable21]) AS [UnionAll20]
                                                                                                                                                                             UNION ALL
                                                                                                                                                                                 SELECT 
                                                                                                                                                                                 convert (datetime, '2002-10-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable22]) AS [UnionAll21]
                                                                                                                                                                         UNION ALL
                                                                                                                                                                             SELECT 
                                                                                                                                                                             convert (datetime, '2002-11-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable23]) AS [UnionAll22]
                                                                                                                                                                     UNION ALL
                                                                                                                                                                         SELECT 
                                                                                                                                                                         convert (datetime, '2002-12-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable24]) AS [UnionAll23]
                                                                                                                                                                 UNION ALL
                                                                                                                                                                     SELECT 
                                                                                                                                                                     convert (datetime, '2003-01-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable25]) AS [UnionAll24]
                                                                                                                                                             UNION ALL
                                                                                                                                                                 SELECT 
                                                                                                                                                                 convert (datetime, '2003-02-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable26]) AS [UnionAll25]
                                                                                                                                                         UNION ALL
                                                                                                                                                             SELECT 
                                                                                                                                                             convert (datetime, '2003-03-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable27]) AS [UnionAll26]
                                                                                                                                                     UNION ALL
                                                                                                                                                         SELECT 
                                                                                                                                                         convert (datetime, '2003-04-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable28]) AS [UnionAll27]
                                                                                                                                                 UNION ALL
                                                                                                                                                     SELECT 
                                                                                                                                                     convert (datetime, '2003-05-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable29]) AS [UnionAll28]
                                                                                                                                             UNION ALL
                                                                                                                                                 SELECT 
                                                                                                                                                 convert (datetime, '2003-06-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable30]) AS [UnionAll29]
                                                                                                                                         UNION ALL
                                                                                                                                             SELECT 
                                                                                                                                             convert (datetime, '2003-07-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable31]) AS [UnionAll30]
                                                                                                                                     UNION ALL
                                                                                                                                         SELECT 
                                                                                                                                         convert (datetime, '2003-08-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable32]) AS [UnionAll31]
                                                                                                                                 UNION ALL
                                                                                                                                     SELECT 
                                                                                                                                     convert (datetime, '2003-09-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable33]) AS [UnionAll32]
                                                                                                                             UNION ALL
                                                                                                                                 SELECT 
                                                                                                                                 convert (datetime, '2003-10-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable34]) AS [UnionAll33]
                                                                                                                         UNION ALL
                                                                                                                             SELECT 
                                                                                                                             convert (datetime, '2003-11-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable35]) AS [UnionAll34]
                                                                                                                     UNION ALL
                                                                                                                         SELECT 
                                                                                                                         convert (datetime, '2003-12-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable36]) AS [UnionAll35]
                                                                                                                 UNION ALL
                                                                                                                     SELECT 
                                                                                                                     convert (datetime, '2004-01-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable37]) AS [UnionAll36]
                                                                                                             UNION ALL
                                                                                                                 SELECT 
                                                                                                                 convert (datetime, '2004-02-01 00: 00: 00.000', 121) AS [C1]
                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable38]) AS [UnionAll37]
                                                                                                         UNION ALL
                                                                                                             SELECT 
                                                                                                             convert (datetime, '2004-03-01 00: 00: 00.000', 121) AS [C1]
                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable39]) AS [UnionAll38]
                                                                                                     UNION ALL
                                                                                                         SELECT 
                                                                                                         convert (datetime, '2004-04-01 00: 00: 00.000', 121) AS [C1]
                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable40]) AS [UnionAll39]
                                                                                                 UNION ALL
                                                                                                     SELECT 
                                                                                                     convert (datetime, '2004-05-01 00: 00: 00.000', 121) AS [C1]
                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable41]) AS [UnionAll40]
                                                                                             UNION ALL
                                                                                                 SELECT 
                                                                                                 convert (datetime, '2004-06-01 00: 00: 00.000', 121) AS [C1]
                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable42]) AS [UnionAll41]
                                                                                         UNION ALL
                                                                                             SELECT 
                                                                                             convert (datetime, '2004-07-01 00: 00: 00.000', 121) AS [C1]
                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable43]) AS [UnionAll42]
                                                                                     UNION ALL
                                                                                         SELECT 
                                                                                         convert (datetime, '2004-08-01 00: 00: 00.000', 121) AS [C1]
                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable44]) AS [UnionAll43]
                                                                                 UNION ALL
                                                                                     SELECT 
                                                                                     convert (datetime, '2004-09-01 00: 00: 00.000', 121) AS [C1]
                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable45]) AS [UnionAll44]
                                                                             UNION ALL
                                                                                 SELECT 
                                                                                 convert (datetime, '2004-10-01 00: 00: 00.000', 121) AS [C1]
                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable46]) AS [UnionAll45]
                                                                         UNION ALL
                                                                             SELECT 
                                                                             convert (datetime, '2004-11-01 00: 00: 00.000', 121) AS [C1]
                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable47]) AS [UnionAll46]
                                                                     UNION ALL
                                                                         SELECT 
                                                                         convert (datetime, '2004-12-01 00: 00: 00.000', 121) AS [C1]
                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable48]) AS [UnionAll47]
                                                                 UNION ALL
                                                                     SELECT 
                                                                     convert (datetime, '2005-01-01 00: 00: 00.000', 121) AS [C1]
                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable49]) AS [UnionAll48]
                                                             UNION ALL
                                                                 SELECT 
                                                                 convert (datetime, '2005-02-01 00: 00: 00.000', 121) AS [C1]
                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable50]) AS [UnionAll49]
                                                         UNION ALL
                                                             SELECT 
                                                             convert (datetime, '2005-03-01 00: 00: 00.000', 121) AS [C1]
                                                             FROM (SELECT 1 AS X) AS [SingleRowTable51]) AS [UnionAll50]
                                                     UNION ALL
                                                         SELECT 
                                                         convert (datetime, '2005-04-01 00: 00: 00.000', 121) AS [C1]
                                                         FROM (SELECT 1 AS X) AS [SingleRowTable52]) AS [UnionAll51]
                                                 UNION ALL
                                                     SELECT 
                                                     convert (datetime, '2005-05-01 00: 00: 00.000', 121) AS [C1]
                                                     FROM (SELECT 1 AS X) AS [SingleRowTable53]) AS [UnionAll52]
                                             UNION ALL
                                                 SELECT 
                                                 convert (datetime, '2005-06-01 00: 00: 00.000', 121) AS [C1]
                                                 FROM (SELECT 1 AS X) AS [SingleRowTable54]) AS [UnionAll53]
                                         UNION ALL
                                             SELECT 
                                             convert (datetime, '2005-07-01 00: 00: 00.000', 121) AS [C1]
                                             FROM (SELECT 1 AS X) AS [SingleRowTable55]) AS [UnionAll54]
                                     UNION ALL
                                         SELECT 
                                         convert (datetime, '2005-08-01 00: 00: 00.000', 121) AS [C1]
                                         FROM (SELECT 1 AS X) AS [SingleRowTable56]) AS [UnionAll55]
                                 UNION ALL
                                     SELECT 
                                     convert (datetime, '2005-09-01 00: 00: 00.000', 121) AS [C1]
                                     FROM (SELECT 1 AS X) AS [SingleRowTable57]) AS [UnionAll56]
                             UNION ALL
                                 SELECT 
                                 convert (datetime, '2005-10-01 00: 00: 00.000', 121) AS [C1]
                                 FROM (SELECT 1 AS X) AS [SingleRowTable58]) AS [UnionAll57]
                         UNION ALL
                             SELECT 
                             convert (datetime, '2005-11-01 00: 00: 00.000', 121) AS [C1]
                             FROM (SELECT 1 AS X) AS [SingleRowTable59]) AS [UnionAll58]
                     UNION ALL
                         SELECT 
                         convert (datetime, '2005-12-01 00: 00: 00.000', 121) AS [C1]
                         FROM (SELECT 1 AS X) AS [SingleRowTable60]) AS [UnionAll59]
                     INNER JOIN (SELECT 
                         [UnionAll117]. [C1] AS [C1]
                         FROM (SELECT 
                             [UnionAll116]. [C1] AS [C1]
                             FROM (SELECT 
                                 [UnionAll115]. [C1] AS [C1]
                                 FROM (SELECT 
                                     [UnionAll114]. [C1] AS [C1]
                                     FROM (SELECT 
                                         [UnionAll113]. [C1] AS [C1]
                                         FROM (SELECT 
                                             [UnionAll112]. [C1] AS [C1]
                                             FROM (SELECT 
                                                 [UnionAll111]. [C1] AS [C1]
                                                 FROM (SELECT 
                                                     [UnionAll110]. [C1] AS [C1]
                                                     FROM (SELECT 
                                                         [UnionAll109]. [C1] AS [C1]
                                                         FROM (SELECT 
                                                             [UnionAll108]. [C1] AS [C1]
                                                             FROM (SELECT 
                                                                 [UnionAll107]. [C1] AS [C1]
                                                                 FROM (SELECT 
                                                                     [UnionAll106]. [C1] AS [C1]
                                                                     FROM (SELECT 
                                                                         [UnionAll105]. [C1] AS [C1]
                                                                         FROM (SELECT 
                                                                             [UnionAll104]. [C1] AS [C1]
                                                                             FROM (SELECT 
                                                                                 [UnionAll103]. [C1] AS [C1]
                                                                                 FROM (SELECT 
                                                                                     [UnionAll102]. [C1] AS [C1]
                                                                                     FROM (SELECT 
                                                                                         [UnionAll101]. [C1] AS [C1]
                                                                                         FROM (SELECT 
                                                                                             [UnionAll100]. [C1] AS [C1]
                                                                                             FROM (SELECT 
                                                                                                 [UnionAll99]. [C1] AS [C1]
                                                                                                 FROM (SELECT 
                                                                                                     [UnionAll98]. [C1] AS [C1]
                                                                                                     FROM (SELECT 
                                                                                                         [UnionAll97]. [C1] AS [C1]
                                                                                                         FROM (SELECT 
                                                                                                             [UnionAll96]. [C1] AS [C1]
                                                                                                             FROM (SELECT 
                                                                                                                 [UnionAll95]. [C1] AS [C1]
                                                                                                                 FROM (SELECT 
                                                                                                                     [UnionAll94]. [C1] AS [C1]
                                                                                                                     FROM (SELECT 
                                                                                                                         [UnionAll93]. [C1] AS [C1]
                                                                                                                         FROM (SELECT 
                                                                                                                             [UnionAll92]. [C1] AS [C1]
                                                                                                                             FROM (SELECT 
                                                                                                                                 [UnionAll91]. [C1] AS [C1]
                                                                                                                                 FROM (SELECT 
                                                                                                                                     [UnionAll90]. [C1] AS [C1]
                                                                                                                                     FROM (SELECT 
                                                                                                                                         [UnionAll89]. [C1] AS [C1]
                                                                                                                                         FROM (SELECT 
                                                                                                                                             [UnionAll88]. [C1] AS [C1]
                                                                                                                                             FROM (SELECT 
                                                                                                                                                 [UnionAll87]. [C1] AS [C1]
                                                                                                                                                 FROM (SELECT 
                                                                                                                                                     [UnionAll86]. [C1] AS [C1]
                                                                                                                                                     FROM (SELECT 
                                                                                                                                                         [UnionAll85]. [C1] AS [C1]
                                                                                                                                                         FROM (SELECT 
                                                                                                                                                             [UnionAll84]. [C1] AS [C1]
                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                 [UnionAll83]. [C1] AS [C1]
                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                     [UnionAll82]. [C1] AS [C1]
                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                         [UnionAll81]. [C1] AS [C1]
                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                             [UnionAll80]. [C1] AS [C1]
                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                 [UnionAll79]. [C1] AS [C1]
                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                     [UnionAll78]. [C1] AS [C1]
                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                         [UnionAll77]. [C1] AS [C1]
                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                             [UnionAll76]. [C1] AS [C1]
                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                 [UnionAll75]. [C1] AS [C1]
                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                     [UnionAll74]. [C1] AS [C1]
                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                         [UnionAll73]. [C1] AS [C1]
                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                             [UnionAll72]. [C1] AS [C1]
                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                 [UnionAll71]. [C1] AS [C1]
                                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                                     [UnionAll70]. [C1] AS [C1]
                                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                                         [UnionAll69]. [C1] AS [C1]
                                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                                             [UnionAll68]. [C1] AS [C1]
                                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                                 [UnionAll67]. [C1] AS [C1]
                                                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                                                     [UnionAll66]. [C1] AS [C1]
                                                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                                                         [UnionAll65]. [C1] AS [C1]
                                                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                                                             [UnionAll64]. [C1] AS [C1]
                                                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                                                 [UnionAll63]. [C1] AS [C1]
                                                                                                                                                                                                                                                 FROM (SELECT 
                                                                                                                                                                                                                                                     [UnionAll62]. [C1] AS [C1]
                                                                                                                                                                                                                                                     FROM (SELECT 
                                                                                                                                                                                                                                                         [UnionAll61]. [C1] AS [C1]
                                                                                                                                                                                                                                                         FROM (SELECT 
                                                                                                                                                                                                                                                             [UnionAll60]. [C1] AS [C1]
                                                                                                                                                                                                                                                             FROM (SELECT 
                                                                                                                                                                                                                                                                 convert (datetime, '2001-01-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable61]
                                                                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                                                                 convert (datetime, '2001-02-28 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable62]) AS [UnionAll60]
                                                                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                                                                             convert (datetime, '2001-03-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable63]) AS [UnionAll61]
                                                                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                                                                         convert (datetime, '2001-04-30 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable64]) AS [UnionAll62]
                                                                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                                                                     convert (datetime, '2001-05-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable65]) AS [UnionAll63]
                                                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                                                 convert (datetime, '2001-06-30 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable66]) AS [UnionAll64]
                                                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                                                             convert (datetime, '2001-07-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable67]) AS [UnionAll65]
                                                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                                                         convert (datetime, '2001-08-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable68]) AS [UnionAll66]
                                                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                                                     convert (datetime, '2001-09-30 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable69]) AS [UnionAll67]
                                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                                 convert (datetime, '2001-10-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable70]) AS [UnionAll68]
                                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                                             convert (datetime, '2001-11-30 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable71]) AS [UnionAll69]
                                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                                         convert (datetime, '2001-12-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable72]) AS [UnionAll70]
                                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                                     convert (datetime, '2002-01-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable73]) AS [UnionAll71]
                                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                                 convert (datetime, '2002-02-28 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable74]) AS [UnionAll72]
                                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                                             SELECT 
                                                                                                                                                                                                             convert (datetime, '2002-03-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable75]) AS [UnionAll73]
                                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                                         SELECT 
                                                                                                                                                                                                         convert (datetime, '2002-04-30 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable76]) AS [UnionAll74]
                                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                                     SELECT 
                                                                                                                                                                                                     convert (datetime, '2002-05-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable77]) AS [UnionAll75]
                                                                                                                                                                                             UNION ALL
                                                                                                                                                                                                 SELECT 
                                                                                                                                                                                                 convert (datetime, '2002-06-30 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable78]) AS [UnionAll76]
                                                                                                                                                                                         UNION ALL
                                                                                                                                                                                             SELECT 
                                                                                                                                                                                             convert (datetime, '2002-07-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                             FROM (SELECT 1 AS X) AS [SingleRowTable79]) AS [UnionAll77]
                                                                                                                                                                                     UNION ALL
                                                                                                                                                                                         SELECT 
                                                                                                                                                                                         convert (datetime, '2002-08-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                         FROM (SELECT 1 AS X) AS [SingleRowTable80]) AS [UnionAll78]
                                                                                                                                                                                 UNION ALL
                                                                                                                                                                                     SELECT 
                                                                                                                                                                                     convert (datetime, '2002-09-30 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                     FROM (SELECT 1 AS X) AS [SingleRowTable81]) AS [UnionAll79]
                                                                                                                                                                             UNION ALL
                                                                                                                                                                                 SELECT 
                                                                                                                                                                                 convert (datetime, '2002-10-31 00: 00: 00.000', 121) AS [C1]
                                                                                                                                                                                 FROM (SELECT 1 AS X) AS [SingleRowTable82]) AS [UnionAll80]
                                                                                                                                                                         UNION ALL
                                                                                                                                                                             SELECT 
                                                                                                                                                                             convert (datetime, '2002-11-30 00: 00: 00.000', 121) AS [C1]<font></font>
                                                                                                                                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable83]) AS [UnionAll81]<font></font>
                                                                                                                                                                    UNION ALL<font></font>
                                                                                                                                                                        SELECT <font></font>
                                                                                                                                                                        convert(datetime, '2002-12-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable84]) AS [UnionAll82]<font></font>
                                                                                                                                                                UNION ALL<font></font>
                                                                                                                                                                    SELECT <font></font>
                                                                                                                                                                    convert(datetime, '2003-01-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable85]) AS [UnionAll83]<font></font>
                                                                                                                                                            UNION ALL<font></font>
                                                                                                                                                                SELECT <font></font>
                                                                                                                                                                convert(datetime, '2003-02-28 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable86]) AS [UnionAll84]<font></font>
                                                                                                                                                        UNION ALL<font></font>
                                                                                                                                                            SELECT <font></font>
                                                                                                                                                            convert(datetime, '2003-03-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable87]) AS [UnionAll85]<font></font>
                                                                                                                                                    UNION ALL<font></font>
                                                                                                                                                        SELECT <font></font>
                                                                                                                                                        convert(datetime, '2003-04-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable88]) AS [UnionAll86]<font></font>
                                                                                                                                                UNION ALL<font></font>
                                                                                                                                                    SELECT <font></font>
                                                                                                                                                    convert(datetime, '2003-05-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable89]) AS [UnionAll87]<font></font>
                                                                                                                                            UNION ALL<font></font>
                                                                                                                                                SELECT <font></font>
                                                                                                                                                convert(datetime, '2003-06-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable90]) AS [UnionAll88]<font></font>
                                                                                                                                        UNION ALL<font></font>
                                                                                                                                            SELECT <font></font>
                                                                                                                                            convert(datetime, '2003-07-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable91]) AS [UnionAll89]<font></font>
                                                                                                                                    UNION ALL<font></font>
                                                                                                                                        SELECT <font></font>
                                                                                                                                        convert(datetime, '2003-08-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable92]) AS [UnionAll90]<font></font>
                                                                                                                                UNION ALL<font></font>
                                                                                                                                    SELECT <font></font>
                                                                                                                                    convert(datetime, '2003-09-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable93]) AS [UnionAll91]<font></font>
                                                                                                                            UNION ALL<font></font>
                                                                                                                                SELECT <font></font>
                                                                                                                                convert(datetime, '2003-10-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable94]) AS [UnionAll92]<font></font>
                                                                                                                        UNION ALL<font></font>
                                                                                                                            SELECT <font></font>
                                                                                                                            convert(datetime, '2003-11-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable95]) AS [UnionAll93]<font></font>
                                                                                                                    UNION ALL<font></font>
                                                                                                                        SELECT <font></font>
                                                                                                                        convert(datetime, '2003-12-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable96]) AS [UnionAll94]<font></font>
                                                                                                                UNION ALL<font></font>
                                                                                                                    SELECT <font></font>
                                                                                                                    convert(datetime, '2004-01-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable97]) AS [UnionAll95]<font></font>
                                                                                                            UNION ALL<font></font>
                                                                                                                SELECT <font></font>
                                                                                                                convert(datetime, '2004-02-29 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable98]) AS [UnionAll96]<font></font>
                                                                                                        UNION ALL<font></font>
                                                                                                            SELECT <font></font>
                                                                                                            convert(datetime, '2004-03-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable99]) AS [UnionAll97]<font></font>
                                                                                                    UNION ALL<font></font>
                                                                                                        SELECT <font></font>
                                                                                                        convert(datetime, '2004-04-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable100]) AS [UnionAll98]<font></font>
                                                                                                UNION ALL<font></font>
                                                                                                    SELECT <font></font>
                                                                                                    convert(datetime, '2004-05-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable101]) AS [UnionAll99]<font></font>
                                                                                            UNION ALL<font></font>
                                                                                                SELECT <font></font>
                                                                                                convert(datetime, '2004-06-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable102]) AS [UnionAll100]<font></font>
                                                                                        UNION ALL<font></font>
                                                                                            SELECT <font></font>
                                                                                            convert(datetime, '2004-07-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable103]) AS [UnionAll101]<font></font>
                                                                                    UNION ALL<font></font>
                                                                                        SELECT <font></font>
                                                                                        convert(datetime, '2004-08-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable104]) AS [UnionAll102]<font></font>
                                                                                UNION ALL<font></font>
                                                                                    SELECT <font></font>
                                                                                    convert(datetime, '2004-09-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable105]) AS [UnionAll103]<font></font>
                                                                            UNION ALL<font></font>
                                                                                SELECT <font></font>
                                                                                convert(datetime, '2004-10-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable106]) AS [UnionAll104]<font></font>
                                                                        UNION ALL<font></font>
                                                                            SELECT <font></font>
                                                                            convert(datetime, '2004-11-30 00:00:00.000', 121) AS [C1]<font></font>
                                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable107]) AS [UnionAll105]<font></font>
                                                                    UNION ALL<font></font>
                                                                        SELECT <font></font>
                                                                        convert(datetime, '2004-12-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable108]) AS [UnionAll106]<font></font>
                                                                UNION ALL<font></font>
                                                                    SELECT <font></font>
                                                                    convert(datetime, '2005-01-31 00:00:00.000', 121) AS [C1]<font></font>
                                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable109]) AS [UnionAll107]<font></font>
                                                            UNION ALL<font></font>
                                                                SELECT <font></font>
                                                                convert(datetime, '2005-02-28 00:00:00.000', 121) AS [C1]<font></font>
                                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable110]) AS [UnionAll108]<font></font>
                                                        UNION ALL<font></font>
                                                            SELECT <font></font>
                                                            convert(datetime, '2005-03-31 00:00:00.000', 121) AS [C1]<font></font>
                                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable111]) AS [UnionAll109]<font></font>
                                                    UNION ALL<font></font>
                                                        SELECT <font></font>
                                                        convert(datetime, '2005-04-30 00:00:00.000', 121) AS [C1]<font></font>
                                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable112]) AS [UnionAll110]<font></font>
                                                UNION ALL<font></font>
                                                    SELECT <font></font>
                                                    convert(datetime, '2005-05-31 00:00:00.000', 121) AS [C1]<font></font>
                                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable113]) AS [UnionAll111]<font></font>
                                            UNION ALL<font></font>
                                                SELECT <font></font>
                                                convert(datetime, '2005-06-30 00:00:00.000', 121) AS [C1]<font></font>
                                                FROM ( SELECT 1 AS X ) AS [SingleRowTable114]) AS [UnionAll112]<font></font>
                                        UNION ALL<font></font>
                                            SELECT <font></font>
                                            convert(datetime, '2005-07-31 00:00:00.000', 121) AS [C1]<font></font>
                                            FROM ( SELECT 1 AS X ) AS [SingleRowTable115]) AS [UnionAll113]<font></font>
                                    UNION ALL<font></font>
                                        SELECT <font></font>
                                        convert(datetime, '2005-08-31 00:00:00.000', 121) AS [C1]<font></font>
                                        FROM ( SELECT 1 AS X ) AS [SingleRowTable116]) AS [UnionAll114]<font></font>
                                UNION ALL<font></font>
                                    SELECT <font></font>
                                    convert(datetime, '2005-09-30 00:00:00.000', 121) AS [C1]<font></font>
                                    FROM ( SELECT 1 AS X ) AS [SingleRowTable117]) AS [UnionAll115]<font></font>
                            UNION ALL<font></font>
                                SELECT <font></font>
                                convert(datetime, '2005-10-31 00:00:00.000', 121) AS [C1]<font></font>
                                FROM ( SELECT 1 AS X ) AS [SingleRowTable118]) AS [UnionAll116]<font></font>
                        UNION ALL<font></font>
                            SELECT <font></font>
                            convert(datetime, '2005-11-30 00:00:00.000', 121) AS [C1]<font></font>
                            FROM ( SELECT 1 AS X ) AS [SingleRowTable119]) AS [UnionAll117]<font></font>
                    UNION ALL<font></font>
                        SELECT <font></font>
                        convert(datetime, '2005-12-31 00:00:00.000', 121) AS [C1]<font></font>
                        FROM ( SELECT 1 AS X ) AS [SingleRowTable120]) AS [UnionAll118] ON (((DATEPART (year, [UnionAll59].[C1])) = (DATEPART (year, [UnionAll118].[C1]))) OR ((DATEPART (year, [UnionAll59].[C1]) IS NULL) AND (DATEPART (year, [UnionAll118].[C1]) IS NULL))) AND (((DATEPART (month, [UnionAll59].[C1])) = (DATEPART (month, [UnionAll118].[C1]))) OR ((DATEPART (month, [UnionAll59].[C1]) IS NULL) AND (DATEPART (month, [UnionAll118].[C1]) IS NULL))) ) AS [Join3]<font></font>
                WHERE ([Extent1].[StartDate] &lt;= [Join3].[C12]) AND ((CASE WHEN ([Extent1].[EndDate] IS NOT NULL) THEN [Extent1].[EndDate] ELSE GetDate() END) &gt;= [Join3].[C11])<font></font>
            ) AS [Project237]<font></font>
            GROUP BY [Project237].[Name], [Project237].[Name1], [Project237].[C1], [Project237].[C2]<font></font>
        ) AS [GroupBy1]<font></font>
    ) AS [Project238]<font></font>
    ORDER BY [Project238].[C2] ASC, [Project238].[C3] ASC, [Project238].[Name] ASC, [Project238].[Name1] ASC; <font></font>
  Method Name:GetEmployeesCount; <font></font>
 Class Name:CompanyEmployees.Data.ReportBuilder; <font></font>
 Elapsed Miliseconds:336<font></font>
</pre></div></div><br><h5>  Afterword </h5><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I am sure there are still many bugs, but I will try to correct all errors as quickly as possible. Also, I want to ask advice from a respected Habr community how to deal with this profiler, on the one hand, I want to make a free product, but at the same time make some money. Currently, I am thinking about making the profiler completely free for personal use and paid for companies, but again at a minimum price of 20-30 bucks. Well, or just leave it free with a Donate button.</font></font><br><br>  Thank you all for your attention.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope this tool will be useful. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS: For all questions, bug reports, etc. you can write to the e-mail: developer@ef-logger.com or st.glushak@gmail.com. </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, the author is looking for a side job, for a mortgage. </font><font style="vertical-align: inherit;">Thank you for understanding. </font></font></s> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuget package for EF6: </font></font><a href="https://www.nuget.org/packages/EFlogger-For6/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.nuget.org/packages/EFlogger-For6/</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nuget package for EF4-5: </font></font><a href="https://www.nuget.org/packages/EFlogger-For4/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.nuget.org/packages/EFlogger-For4/</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Updated: Added poll:</font></font></div><p>Source: <a href="https://habr.com/ru/post/221681/">https://habr.com/ru/post/221681/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221669/index.html">Consulo + .NET plugin, two months later</a></li>
<li><a href="../221673/index.html">Chromium Transmission Integration</a></li>
<li><a href="../221675/index.html">VPN: past, present, future</a></li>
<li><a href="../221677/index.html">Sol 610: Mars Live Panorama and Curiosity</a></li>
<li><a href="../221679/index.html">Do not keep activities</a></li>
<li><a href="../221683/index.html">IT guy on vacation: add some astronomy?</a></li>
<li><a href="../221689/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 107 (April 27 - May 3, 2014)</a></li>
<li><a href="../221693/index.html">We are friends with virt-manager with a remote system on top of tls</a></li>
<li><a href="../221697/index.html">Chronicles of repair or as IT-Schniki store opened: MadRobots goes offline</a></li>
<li><a href="../221703/index.html">Learning Derby 0.6, example # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>