<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing a MODBUS RTU server using the Fastwel interface module and CoDeSys software</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes the integration of the Fastwel programmable logic controller CPM713 from the MODBUS TCP protocol with the Weintek operator pane...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing a MODBUS RTU server using the Fastwel interface module and CoDeSys software</h1><div class="post__text post__text-html js-mediator-article">  This article describes the integration of the Fastwel programmable logic controller CPM713 from the MODBUS TCP protocol with the Weintek operator panel supporting the serial version of the MODBUS RTU / ASCII protocol using the NIM742 interface module and the CoDeSys ready-made library of the adapted Fastwel environment. <br><br>  Industrial protocols based on Ethernet networks are becoming increasingly popular.  The use of this technology in industrial systems has the advantages, for example, the possibility of flexible modernization and scaling of the system, ease of building architecture and low cost of creating networks [1].  However, the introduction of new technologies in the field of automated process control systems is quite slow, so many devices use traditional industrial networks based on serial buses. <br><br>  When creating automated systems, it is often necessary to establish communication between devices that support various data exchange protocols or various modifications of the same protocol. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, the Fastwel CPM713 controller uses MODBUS TCP on the basis of Ethernet networks for data transfer [2].  When working with this controller, the task arose of transmitting and receiving data from the MT6100i operator panel of Weintek, which supports the serial MODBUS RTU / ASCII protocol (Fig. 1). <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/acd/9d5/61f/acd9d561f44742fd8ce33816274941ec.jpg"><br>  <i>Figure 1. Integrating the Fastwel I / O controller with the Weintek operator panel</i> <br><br>  The use of seamless integration is always a higher priority than the use of third-party gateways.  Therefore, to solve this problem, an NIM742 interface module from Fastwel was taken, which allows you to connect devices with an RS-232C interface and work with them through the CPM713 user program. <br><br>  The NIM742 module together with the CPM713 controller user program implements the work of the Modbus RTU slave node.  NIM742 is connected to a common line of modules and communicates with the CPM713 controller over the FBUS bus (Fig.2).  To enable NIM742 to work with the MODBUS RTU protocol, the CoDeSys FastwelModbusServer.lib library, included in the Fastwel adaptation package, is used. <br><br><img src="https://habrastorage.org/files/a62/151/211/a62151211c494e9594b009d754de0da5.jpg"><br>  <i>Figure 2. CPM71x controller with connected modules</i> <br><cut><br><h4>  Connecting devices </h4><br>  The following components and accessories were used to configure and program the CPM713 controller and the NIM742 interface module: <br><br>  ‚Ä¢ ACS00019 configuration cable included with controller, <br>  ‚Ä¢ free software package CoDeSys from 3S Smart Software Solutions with the adaptation package Fastwel CoDeSys Adaptation for working with Fastwel. <br><br>  To work with the Weintek MT6100i operator panel, you need: <br><br>  ‚Ä¢ connection cables for configuration, which are also included in the delivery, <br>  ‚Ä¢ free software for configuring EasyBuilder 8000. <br><br>  The interface module is connected to the operator panel with a connecting cable.  This cable can be made independently using the information on the assignment of contacts presented in the instruction manual for the Weintek panel (Fig. 3).  For communication with the NIM742 module, the operator panel‚Äôs COM3 [RS-232] port was used, using a three-pin data connection: TxD (transmit), RxD (receive) and GND (ground). <br><br><img src="https://habrastorage.org/files/c51/31a/db2/c5131adb29004f6ca0333d3d775ccf96.png"><br>  <i>Figure 3. Pin assignment of the Weintek 6100i panel connector female SUB-D COM3 [RS-232]</i> <br><br>  Figure 4 shows the wiring diagram for connecting the contacts of the NIM742 module to the COM3 port of the operator panel [3, 4].  When connecting, it must be borne in mind that the TxD data interface contact of the interface module must be connected to the RxD data receiving contact of the operator panel, and the RxD data contact, respectively, to the TxD panel. <br><br><img src="https://habrastorage.org/files/13c/cad/c53/13ccadc536bb4a1fb0838746eed3c193.png"><br>  <i>Figure 4. Connection of the NIM742 module to the COM3 port of the operator panel.</i> <br><br>  Thus, for communication between the operator panel and the NIM742 module, it is necessary to connect the TxD and RxD contacts with the 8th and 7th contacts of the SUB-D connector, and connect the module's ground with the 5th contact (Fig. 5). <br><br><img src="https://habrastorage.org/files/33a/b02/eea/33ab02eeabf241f2b9a323ab282c18eb.jpg"><br>  <i>Figure 5. Connection diagram of the NIM742 and the Weintek MT6100i operator panel.</i> <br><br><h4>  Setting the operator panel </h4><br>  The operator panel screen form is created and configured using the free software EasyBuilder8000.  When creating a new project, you must specify the model of the Weintek panel used (Fig. 6). <br><br><img src="https://habrastorage.org/files/4d3/cbc/36d/4d3cbc36d0684e488d046794c97884db.png"><br>  <i>Figure 6. Creating a new project in EasyBuilder8000</i> <br><br>  Next, when creating a project, you need to edit the system settings and specify the list of devices with which the operator panel is associated (Fig. 7).  In our case, this will be a Modbus RTU slave [5]. <br><br><img src="https://habrastorage.org/files/62c/7ca/731/62c7ca7316c1485ca438a22fa003b668.jpg"><br>  <i>Figure 7. Project system settings</i> <br><br>  The following parameters are configured for the client we are using: PLC location, communication type, COM port, speed and mode of operation (Fig. 8).  This data will also be indicated in the PLC work program. <br><br><img src="https://habrastorage.org/files/d19/f71/d3e/d19f71d3ea644345947bba4ba1111bd5.png"><br>  <i>Figure 8. New Device Settings</i> <br><br>  After entering all the communication parameters, you need to add on-screen controls and displays: bit indicators, switches, digital indicators, etc.  Figure 9 shows the appearance of the finished test project. <br><br><img src="https://habrastorage.org/files/bff/5cf/84e/bff5cf84e8644b6b9f6cf373b6aa3186.png"><br>  <i>Figure 9. Test panel screen project</i> <br><br>  These display and control elements are associated with MODBUS variables.  The addressing of the Modbus RTU variables is specified in the Weintek Panel Connection Guide to the PLC (Fig. 10). <br><br><img src="https://habrastorage.org/files/c16/ea2/802/c16ea280295446a4af0cc2c92c4ca54d.png"><br>  <i>Figure 10. Modbus variable address table</i> <br><br>  The MODBUS protocol supports four types of variables: <br><br>  ‚Ä¢ discrete input (Discrete Input, 1 bit); <br>  ‚Ä¢ discrete output (Coil, 1 bit); <br>  ‚Ä¢ analog input (input register, 16 bit); <br>  ‚Ä¢ analog output (Holding Register, 16 bit). <br><br>  To access a specific variable, you must also specify the address on the MODBUS network. <br><br>  Depending on the type of variable, functions with codes 0x, 1x, 3x, 4x are used to access the data.  The code 0x corresponds to the Coil type, which is the output variable for writing the value to the bit variable.  The 1x address reads the state of the Discrete Input bit variable.  The 3x address corresponds to the Input Register and is used to read the state of the analog variable.  The 4x address records the Holding Register analog variable. <br><br>  Thus, the address of the first switch will be 0x1 (Fig. 11), the second 0x2, and so on.  The addresses of all elements of the working screen of the mimic are presented in table 1. <br><br><img src="https://habrastorage.org/files/30f/44b/a33/30f44ba33e484b168c205a2297e3a970.png"><br>  <i>Fig.</i>  <i>11. Setting addresses to the elements of the working mnemonic scheme</i> <br><br>  Table 1. The address of the elements of the screen work scheme: <br><br><img src="https://habrastorage.org/files/f0a/7ae/3fb/f0a7ae3fb5fd498b9e12b00a08e21a69.jpg"><br><br><h4>  PLC program </h4><br>  The test project for CPM713 is based on a ready-made example for FastwelModbusServer.lib, which is part of the CoDeSys adaptation for Fastwel.  This library realizes high speed of work, is universal and easy to implement, therefore when organizing data exchange via Modbus RTU protocol, it is recommended to use it.  FastwelModbusServer.lib implements the functionality of the slave MODBUS RTU / ASCII network through the controller ports available to the user program.  Including, for the organization of access to the MODBUS RTU network through the port of the NIM742 module. <br><br>  To organize data exchange between the user application and I / O modules, you need to add the I / O system configuration according to the physical connection to the controller.  In the test project, we used only the NIM742 module, and the controller configuration is shown in Figure 12. <br><br><img src="https://habrastorage.org/files/c39/178/0df/c391780df92f4874b2d3eb7918988193.png"><br>  <i>Fig.</i>  <i>12. List of used modules</i> <br><br>  The FastwelModbusServer library has a single function FwModbusServerInit (), which is designed to initialize and configure the server.  When calling this function, the user sets the communication parameters of the network node and describes the data areas that will be displayed on the address space of the MODBUS server.  The server is initialized only from the OnInit system event handler, which initializes the Modbus server once, after power on and before the main user program is started. <br><br>  The parameters of data exchange through the COM port are specified in the function itself in the field of defining local variables (Fig. 13).  Here Port is the port number, BaudRate is the data rate, StopBit is the length of the stop bit, Parity is the check bit mode, ByteSize is the number of bits in a frame, NodeAddress is the device address in the Modbus network. <br><br><img src="https://habrastorage.org/files/2a8/2d1/326/2a82d13269e14423b49b71a4f2caeabb.png"><br>  <i>Fig.</i>  <i>13. Setting the parameters of the COM port</i> <br><br>  The data exchanged between the main program and the operator panel is specified in the user data types PLC_PRG_IN (what is received over the network) and PLC_PRG_OUT (what is sent to the network).  These variables are an array of four variables of the WORD type, the DWORD double word and the real number REAL (Fig. 14). <br><br><img src="https://habrastorage.org/files/ed9/56b/cf2/ed956bcf249c44a7a90e92e2cb87d844.png"><br>  <i>Fig.</i>  <i>14. Variables for Modbus communication</i> <br><br>  After the screen form and program have been loaded into the appropriate devices, the operator panel in master mode polls the CPM713 controller.  The operating screen of the operator panel in the execution mode is shown in Figure 15. <br><br><img src="https://habrastorage.org/files/98f/0c0/5da/98f0c05da45d4fca82a1484c0ab9b9ee.png"><br>  <i>Fig.</i>  <i>15. The operator screen of the operator panel in the execution mode</i> <br><br>  Further, if necessary, using the CoDeSys tools, you can collect data received by the CPM713 controller over the MODBUS TCP network and redirect them to the operator panel using the MODBUS RTU protocol.  Thus, using the CoDeSys tools and the NIM742 interface module, seamless integration of the MODBUS RTU and MODBUS TCP protocols can be created. <br><br>  Literature <br><br>  1. Orlov, S. Ethernet and industrial networks / Sergey Orlov // Journal of network solutions / LAN.  - 2013. - ‚Ññ 9. - p. 24-31 <br>  2. FASTWEL I / O distributed input / output system.  Manual.  <a href="">ftp.prosoft.ru/pub/Hardware/Fastwel/Fastwel_IO/Version2/Doc/FIO_UM.pdf</a> . <br>  3. Fastwel I / O I / O I / O modules.  Programmer's Guide.  <a href="">ftp.prosoft.ru/pub/Hardware/Fastwel/Fastwel_IO/Version2/Doc/FIO_Modules_CoDeSys_Adaptation_UM.pdf</a> . <br>  4. Weintek MT-600/8000 series MT-607i, MT-8070iH / MT-6070iH.  Installation Instruction <br>  5. User Guide EasyBuilder8000. </cut></div><p>Source: <a href="https://habr.com/ru/post/277639/">https://habr.com/ru/post/277639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277625/index.html">Blockchain application stack</a></li>
<li><a href="../277629/index.html">Write code that is easy to remove and not add</a></li>
<li><a href="../277631/index.html">Kilometers of logs and recovery of databases on MS SQL</a></li>
<li><a href="../277635/index.html">Get websocket data using swift and populate UITableView (node.js server)</a></li>
<li><a href="../277637/index.html">Automatic work with SMS on the modem ZTE-MF823</a></li>
<li><a href="../277643/index.html">Load testing - product quality assurance stage</a></li>
<li><a href="../277645/index.html">Amelisa. Offline and realtime engine for React and Mongo</a></li>
<li><a href="../277649/index.html">50 shades of paranoia or how to store passwords without saving</a></li>
<li><a href="../277653/index.html">Installing a Django project on a VPS (centOS 7) [For Beginners]</a></li>
<li><a href="../277655/index.html">Access MySQL data from a UWP application without using services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>