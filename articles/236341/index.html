<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn to cook Log4j + Logstash + ElasticSearch + Kibana 3 + Auth (Google OAuth2 / BasicAuth / CAS Authentication)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task 
 Setting up a convenient tool for processing and receiving logs. 

 Conditions 


1. MIT or Apache 2.0 license 
2. The ability to receive and pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn to cook Log4j + Logstash + ElasticSearch + Kibana 3 + Auth (Google OAuth2 / BasicAuth / CAS Authentication)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/24a/70d/781/24a70d781f034b46aa35ff10e2c9b7de.png"><br><h4>  Task </h4><br>  Setting up a convenient tool for processing and receiving logs. <br><br><h4>  Conditions </h4><br><ol><li>  MIT or Apache 2.0 license </li><li>  The ability to receive and process multi-line messages </li><li>  Easy to set up and use </li><li>  Ability to work with logs from Log4j </li></ol><br><br><h4>  Decision </h4><br>  Logstash + ElasticSearch + Kibana 3. <br><a name="habracut"></a><br><h4>  Implementation </h4><br><h5>  First, let's deploy Logstash + ElasticSearch + Kibana 3 on our server: </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,   7   java -version # ,         Logstash cd /srv #     mkdir slog #   cd slog #   Logstash,      http://logstash.net/ curl -O https://download.elasticsearch.org/logstash/logstash/logstash-1.4.2.tar.gz # tar.gz tar zxvf logstash-1.4.2.tar.gz #     Logstash cd logstash-1.4.2 #  Logstash  bin/logstash -e 'input { stdin { } } output { stdout {} }' #        .    ,   (Ctrl + C).</span></span></code> </pre> <br><br>  Now we will configure the configuration file for Logstash, detail <a href="http://habrahabr.ru/post/165059/">here.</a> <br>  The file can be saved anywhere, for example, I save in <i>logstash / conf / main.conf</i> . <br>  My version of the configuration file: <br><pre> <code class="bash hljs">input { log4j { mode =&gt; <span class="hljs-string"><span class="hljs-string">"server"</span></span> host =&gt; <span class="hljs-string"><span class="hljs-string">"logstash_server_ip"</span></span> port =&gt; logstash_server_port <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"log4j"</span></span> } } output { elasticsearch { embedded =&gt; <span class="hljs-string"><span class="hljs-string">"true"</span></span> } }</code> </pre><br>  More details: <br><br>  <a href="http://logstash.net/docs/1.4.2/inputs/log4j">input</a> <br>  <i>mode</i> - Type of service, server / client <br>  <i>host</i> - the IP address of the server to which the log4j logs will transmit <br>  <i>port</i> = <i>logstash_server_port</i> - port for exchange of logs <br>  <i>type</i> - type of messages to denote logs. <br>  <a href="http://logstash.net/docs/1.4.2/outputs/elasticsearch">output</a> <br>  <i>embedded</i> - Do I need to run my own elasticsearch service or will I need to establish a connection to an existing one <br><br><h5>  Now we will configure the transfer of logs from Log4j: </h5><br>  For this, we will use the Logstash plugin for Log4j, and the SocketAppender from Log4j. <br><br>  Add the settings in Log4j: <br><br>  <i>logstash_server_port</i> - the port that we will specify in the Logstash settings for the exchange of logs <br>  <i>logstash_server_ip</i> - ip address of the server where Logstash is located <br><div class="spoiler">  <b class="spoiler_title">xml</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appender</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LOGSTASH"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.log4j.net.SocketAppender"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"port"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logstash_server_port"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remoteHost"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logstash_server_ip"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appender</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appender-ref</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LOGSTASH"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">properties</b> <div class="spoiler_text"><pre> <code class="bash hljs">log4j.rootLogger=logstash log4j.appender.logstash=org.apache.log4j.net.SocketAppender log4j.appender.logstash.port=logstash_server_port log4j.appender.logstash.remoteHost=logstash_server_ip</code> </pre><br></div></div><br><h5>  Now we try to start the system: </h5><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      Logstash cd /srv/slog/logstash-1.4.2/ #     : bin/logstash agent -f conf/main.conf #        ,      web bin/logstash agent -f conf/main.conf web</span></span></code> </pre><br>  At the end of the launch, a similar message will be displayed on the screen: <br><pre> <code class="bash hljs">Using milestone 1 input plugin <span class="hljs-string"><span class="hljs-string">'log4j'</span></span>. This plugin should work, but would benefit from use by folks like you. Please <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> us know <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you find bugs or have suggestions on how to improve this plugin. For more information on plugin milestones, see http://logstash.net/docs/1.4.2/plugin-milestones {:level=&gt;:warn}</code> </pre><br>  Which says that the Log4j plugin is in test state. <br><br>  Now go to the visual part. <br><pre>  http: // logstash_server_ip: 9292 </pre><br>  <i>logstash_server_ip</i> - server ip address <br>  <i>9292</i> is the default port, it can be changed in the configuration file. <br><br>  The standard Kibana view seemed to me not very convenient, but you can customize it for yourself.  Personally, I took the option from <a href="http://habrahabr.ru/company/maxifier/blog/216201/">this</a> article as a basis and made the presentation more convenient, in my opinion. <br><br><div class="spoiler">  <b class="spoiler_title">Here is my option</b> <div class="spoiler_text"><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Home dashboard dark"</span></span>, <span class="hljs-string"><span class="hljs-string">"services"</span></span>: { <span class="hljs-string"><span class="hljs-string">"query"</span></span>: { <span class="hljs-string"><span class="hljs-string">"idQueue"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"list"</span></span>: { <span class="hljs-string"><span class="hljs-string">"0"</span></span>: { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#7EB26D"</span></span>, <span class="hljs-string"><span class="hljs-string">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"pin"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"lucene"</span></span>, <span class="hljs-string"><span class="hljs-string">"enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"query"</span></span>: <span class="hljs-string"><span class="hljs-string">"priority: \"INFO\""</span></span> }, <span class="hljs-string"><span class="hljs-string">"1"</span></span>: { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#E24D42"</span></span>, <span class="hljs-string"><span class="hljs-string">"query"</span></span>: <span class="hljs-string"><span class="hljs-string">"priority: \"ERROR\""</span></span>, <span class="hljs-string"><span class="hljs-string">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"pin"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"lucene"</span></span>, <span class="hljs-string"><span class="hljs-string">"enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-string"><span class="hljs-string">"2"</span></span>: { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#6ED0E0"</span></span>, <span class="hljs-string"><span class="hljs-string">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"pin"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"lucene"</span></span>, <span class="hljs-string"><span class="hljs-string">"enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"query"</span></span>: <span class="hljs-string"><span class="hljs-string">"priority: \"WARN\""</span></span> } }, <span class="hljs-string"><span class="hljs-string">"ids"</span></span>: [ 0, 1, 2 ] }, <span class="hljs-string"><span class="hljs-string">"filter"</span></span>: { <span class="hljs-string"><span class="hljs-string">"idQueue"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"list"</span></span>: { <span class="hljs-string"><span class="hljs-string">"0"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"time"</span></span>, <span class="hljs-string"><span class="hljs-string">"field"</span></span>: <span class="hljs-string"><span class="hljs-string">"@timestamp"</span></span>, <span class="hljs-string"><span class="hljs-string">"from"</span></span>: <span class="hljs-string"><span class="hljs-string">"now-6h"</span></span>, <span class="hljs-string"><span class="hljs-string">"to"</span></span>: <span class="hljs-string"><span class="hljs-string">"now"</span></span>, <span class="hljs-string"><span class="hljs-string">"mandate"</span></span>: <span class="hljs-string"><span class="hljs-string">"must"</span></span>, <span class="hljs-string"><span class="hljs-string">"active"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: 0 } }, <span class="hljs-string"><span class="hljs-string">"ids"</span></span>: [ 0 ] } }, <span class="hljs-string"><span class="hljs-string">"rows"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Filtering"</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-string"><span class="hljs-string">"150px"</span></span>, <span class="hljs-string"><span class="hljs-string">"editable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"collapse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"collapsable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"panels"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"error"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"filtering"</span></span>, <span class="hljs-string"><span class="hljs-string">"span"</span></span>: 12 }, { <span class="hljs-string"><span class="hljs-string">"loading"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"error"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"sizeable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"span"</span></span>: 12, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-string"><span class="hljs-string">"150px"</span></span>, <span class="hljs-string"><span class="hljs-string">"editable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"query"</span></span>, <span class="hljs-string"><span class="hljs-string">"query"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"pinned"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"history"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"priority: \"WARN\""</span></span>, <span class="hljs-string"><span class="hljs-string">"priority: \"ERROR\""</span></span>, <span class="hljs-string"><span class="hljs-string">"priority: \"INFO\""</span></span>, <span class="hljs-string"><span class="hljs-string">"@&amp;~(HHH.+)"</span></span>, <span class="hljs-string"><span class="hljs-string">"@&amp;~(foo.+)"</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"level:\"WARN\""</span></span>, <span class="hljs-string"><span class="hljs-string">"level:\"ERROR\""</span></span>, <span class="hljs-string"><span class="hljs-string">"level:\"INFO\""</span></span> ], <span class="hljs-string"><span class="hljs-string">"remember"</span></span>: 10 } ], <span class="hljs-string"><span class="hljs-string">"notice"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, { <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Graph"</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-string"><span class="hljs-string">"200px"</span></span>, <span class="hljs-string"><span class="hljs-string">"editable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"collapse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"collapsable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"panels"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"span"</span></span>: 12, <span class="hljs-string"><span class="hljs-string">"editable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"group"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"default"</span></span> ], <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"histogram"</span></span>, <span class="hljs-string"><span class="hljs-string">"mode"</span></span>: <span class="hljs-string"><span class="hljs-string">"count"</span></span>, <span class="hljs-string"><span class="hljs-string">"time_field"</span></span>: <span class="hljs-string"><span class="hljs-string">"@timestamp"</span></span>, <span class="hljs-string"><span class="hljs-string">"value_field"</span></span>: null, <span class="hljs-string"><span class="hljs-string">"auto_int"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"resolution"</span></span>: 99, <span class="hljs-string"><span class="hljs-string">"interval"</span></span>: <span class="hljs-string"><span class="hljs-string">"5m"</span></span>, <span class="hljs-string"><span class="hljs-string">"fill"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"linewidth"</span></span>: 3, <span class="hljs-string"><span class="hljs-string">"timezone"</span></span>: <span class="hljs-string"><span class="hljs-string">"browser"</span></span>, <span class="hljs-string"><span class="hljs-string">"spyable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"zoomlinks"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"bars"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"stack"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"points"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"lines"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"legend"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"x-axis"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"y-axis"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"percentage"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"interactive"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"queries"</span></span>: { <span class="hljs-string"><span class="hljs-string">"mode"</span></span>: <span class="hljs-string"><span class="hljs-string">"all"</span></span>, <span class="hljs-string"><span class="hljs-string">"ids"</span></span>: [ 0, 1, 2 ] }, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Events over time"</span></span>, <span class="hljs-string"><span class="hljs-string">"intervals"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"auto"</span></span>, <span class="hljs-string"><span class="hljs-string">"1s"</span></span>, <span class="hljs-string"><span class="hljs-string">"1m"</span></span>, <span class="hljs-string"><span class="hljs-string">"5m"</span></span>, <span class="hljs-string"><span class="hljs-string">"10m"</span></span>, <span class="hljs-string"><span class="hljs-string">"30m"</span></span>, <span class="hljs-string"><span class="hljs-string">"1h"</span></span>, <span class="hljs-string"><span class="hljs-string">"3h"</span></span>, <span class="hljs-string"><span class="hljs-string">"12h"</span></span>, <span class="hljs-string"><span class="hljs-string">"1d"</span></span>, <span class="hljs-string"><span class="hljs-string">"1w"</span></span>, <span class="hljs-string"><span class="hljs-string">"1M"</span></span>, <span class="hljs-string"><span class="hljs-string">"1y"</span></span> ], <span class="hljs-string"><span class="hljs-string">"options"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"tooltip"</span></span>: { <span class="hljs-string"><span class="hljs-string">"value_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"cumulative"</span></span>, <span class="hljs-string"><span class="hljs-string">"query_as_alias"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-string"><span class="hljs-string">"scale"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"y_format"</span></span>: <span class="hljs-string"><span class="hljs-string">"none"</span></span>, <span class="hljs-string"><span class="hljs-string">"grid"</span></span>: { <span class="hljs-string"><span class="hljs-string">"max"</span></span>: null, <span class="hljs-string"><span class="hljs-string">"min"</span></span>: 0 }, <span class="hljs-string"><span class="hljs-string">"annotate"</span></span>: { <span class="hljs-string"><span class="hljs-string">"enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"query"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: 20, <span class="hljs-string"><span class="hljs-string">"field"</span></span>: <span class="hljs-string"><span class="hljs-string">"_type"</span></span>, <span class="hljs-string"><span class="hljs-string">"sort"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"_score"</span></span>, <span class="hljs-string"><span class="hljs-string">"desc"</span></span> ] }, <span class="hljs-string"><span class="hljs-string">"pointradius"</span></span>: 5, <span class="hljs-string"><span class="hljs-string">"show_query"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"legend_counts"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"zerofill"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"derivative"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ], <span class="hljs-string"><span class="hljs-string">"notice"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, { <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Events"</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-string"><span class="hljs-string">"150px"</span></span>, <span class="hljs-string"><span class="hljs-string">"editable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"collapse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"collapsable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"panels"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"All events"</span></span>, <span class="hljs-string"><span class="hljs-string">"error"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"span"</span></span>: 12, <span class="hljs-string"><span class="hljs-string">"editable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"group"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"default"</span></span> ], <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"table"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: 100, <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: 5, <span class="hljs-string"><span class="hljs-string">"offset"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"sort"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@timestamp"</span></span>, <span class="hljs-string"><span class="hljs-string">"desc"</span></span> ], <span class="hljs-string"><span class="hljs-string">"style"</span></span>: { <span class="hljs-string"><span class="hljs-string">"font-size"</span></span>: <span class="hljs-string"><span class="hljs-string">"9pt"</span></span> }, <span class="hljs-string"><span class="hljs-string">"overflow"</span></span>: <span class="hljs-string"><span class="hljs-string">"min-height"</span></span>, <span class="hljs-string"><span class="hljs-string">"fields"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@timestamp"</span></span>, <span class="hljs-string"><span class="hljs-string">"priority"</span></span>, <span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"host"</span></span> ], <span class="hljs-string"><span class="hljs-string">"highlight"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"level"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sortable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"header"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"paging"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"spyable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"queries"</span></span>: { <span class="hljs-string"><span class="hljs-string">"mode"</span></span>: <span class="hljs-string"><span class="hljs-string">"all"</span></span>, <span class="hljs-string"><span class="hljs-string">"ids"</span></span>: [ 0, 1, 2 ] }, <span class="hljs-string"><span class="hljs-string">"field_list"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"Stable"</span></span>, <span class="hljs-string"><span class="hljs-string">"trimFactor"</span></span>: 300, <span class="hljs-string"><span class="hljs-string">"normTimes"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"all_fields"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"localTime"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"timeField"</span></span>: <span class="hljs-string"><span class="hljs-string">"@timestamp"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"notice"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ], <span class="hljs-string"><span class="hljs-string">"editable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"failover"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span>: { <span class="hljs-string"><span class="hljs-string">"interval"</span></span>: <span class="hljs-string"><span class="hljs-string">"day"</span></span>, <span class="hljs-string"><span class="hljs-string">"pattern"</span></span>: <span class="hljs-string"><span class="hljs-string">"[logstash-]YYYY.MM.DD"</span></span>, <span class="hljs-string"><span class="hljs-string">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"NO_TIME_FILTER_OR_INDEX_PATTERN_NOT_MATCHED"</span></span>, <span class="hljs-string"><span class="hljs-string">"warm_fields"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-string"><span class="hljs-string">"style"</span></span>: <span class="hljs-string"><span class="hljs-string">"dark"</span></span>, <span class="hljs-string"><span class="hljs-string">"panel_hints"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"pulldowns"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"query"</span></span>, <span class="hljs-string"><span class="hljs-string">"collapse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"notice"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"query"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"pinned"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"history"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"remember"</span></span>: 10, <span class="hljs-string"><span class="hljs-string">"enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"filtering"</span></span>, <span class="hljs-string"><span class="hljs-string">"collapse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"notice"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ], <span class="hljs-string"><span class="hljs-string">"nav"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"timepicker"</span></span>, <span class="hljs-string"><span class="hljs-string">"collapse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"notice"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"Stable"</span></span>, <span class="hljs-string"><span class="hljs-string">"time_options"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"5m"</span></span>, <span class="hljs-string"><span class="hljs-string">"15m"</span></span>, <span class="hljs-string"><span class="hljs-string">"1h"</span></span>, <span class="hljs-string"><span class="hljs-string">"6h"</span></span>, <span class="hljs-string"><span class="hljs-string">"12h"</span></span>, <span class="hljs-string"><span class="hljs-string">"24h"</span></span>, <span class="hljs-string"><span class="hljs-string">"2d"</span></span>, <span class="hljs-string"><span class="hljs-string">"7d"</span></span>, <span class="hljs-string"><span class="hljs-string">"30d"</span></span> ], <span class="hljs-string"><span class="hljs-string">"refresh_intervals"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"5s"</span></span>, <span class="hljs-string"><span class="hljs-string">"10s"</span></span>, <span class="hljs-string"><span class="hljs-string">"30s"</span></span>, <span class="hljs-string"><span class="hljs-string">"1m"</span></span>, <span class="hljs-string"><span class="hljs-string">"5m"</span></span>, <span class="hljs-string"><span class="hljs-string">"15m"</span></span>, <span class="hljs-string"><span class="hljs-string">"30m"</span></span>, <span class="hljs-string"><span class="hljs-string">"1h"</span></span>, <span class="hljs-string"><span class="hljs-string">"2h"</span></span>, <span class="hljs-string"><span class="hljs-string">"1d"</span></span> ], <span class="hljs-string"><span class="hljs-string">"timefield"</span></span>: <span class="hljs-string"><span class="hljs-string">"@timestamp"</span></span>, <span class="hljs-string"><span class="hljs-string">"now"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"filter_id"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-string"><span class="hljs-string">"loader"</span></span>: { <span class="hljs-string"><span class="hljs-string">"save_gist"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"save_elasticsearch"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"save_local"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"save_default"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"save_temp"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"save_temp_ttl_enable"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"save_temp_ttl"</span></span>: <span class="hljs-string"><span class="hljs-string">"30d"</span></span>, <span class="hljs-string"><span class="hljs-string">"load_gist"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"load_elasticsearch"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"load_elasticsearch_size"</span></span>: 20, <span class="hljs-string"><span class="hljs-string">"load_local"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"hide"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-string"><span class="hljs-string">"refresh"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br></div></div><br><h5>  Authentication: </h5><br>  The disadvantage of this system is the absence of any authentication, due to the fact that it was designed for internal networks.  But this is quickly resolved by <a href="https://github.com/fangli/kibana-authentication-proxy">this</a> fork from github. <br><br>  In order to use it first we need to install node.js on our server.  Personally, I used <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-run-a-node-js-app-on-centos-6-4-64bit">this</a> tutorial. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   cd /usr/src #  http://nodejs.org/download/.       # http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz #  wget http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz #  tar zxf node-v0.10.4.tar.gz #    node.js cd node-v0.10.4 #  ./configure #      make make install #     node.js #       . #        cd /srv/slog #  : git clone https://github.com/fangli/kibana-authentication-proxy cd kibana-authentication-proxy/ git submodule init git submodule update npm install #    Kibana    cd kibana &amp;&amp; git checkout master &amp;&amp; git pull #    config.js . #   nano ,      nano /srv/slog/kibana-authentication-proxy/config.js</span></span></code> </pre><br><br>  For the initial launch, you need to edit the following settings: <i>es_host / es_port</i> <br>  In them we set the connection settings for ElasticSearch.  If in the previous case we used the built-in ElasticSearch for the built-in Kibana, then now we need to configure it on a separate custom Kibana.  To do this, edit our <i>main.conf</i> file by adding the ElasticSearch port settings: <br><br>  <i>elasticsearch_server_port</i> - port on which elasticsearch will be available <br>  Final version: <br><pre> <code class="bash hljs">input { log4j { mode =&gt; <span class="hljs-string"><span class="hljs-string">"server"</span></span> host =&gt; <span class="hljs-string"><span class="hljs-string">"logstash_server_ip"</span></span> port =&gt; logstash_server_port <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"log4j"</span></span> } } output { elasticsearch { embedded =&gt; <span class="hljs-string"><span class="hljs-string">"true"</span></span> embedded_http_port =&gt; elasticsearch_server_port } }</code> </pre><br><br>  Now we change settings in <i>config.js</i> <br><br>  <i>"Es_host"</i> : logstash_server_ip <br>  <i>"Es_port"</i> : elasticsearch_server_port <br><br>  Now authentication.  This fork allows you to configure one of 3 authentications: Google OAuth2 / Basic Authentication / CAS Authentication. <br><br>  For example, let's configure Basic Authentication: <br><pre> <code class="bash hljs"> <span class="hljs-string"><span class="hljs-string">"enable_basic_auth"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"basic_auth_users"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"user"</span></span>: <span class="hljs-string"><span class="hljs-string">"admin"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"admin"</span></span>}, ],</code> </pre><br><br><h5>  Run: </h5><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   Logstash + ElasticSearch #  web          cd /srv/slog/logstash-1.4.2/ bin/logstash agent -f conf/main.conf #   Logstash     . cd /srv/slog/kibana-authentication-proxy/ node app.js</span></span></code> </pre><br>  The default port for this Kibana fork is <i>9201</i> <br>  So now it is available at: <br><pre>  http: // logstash_server_ip: 9201. </pre><br><br><h4>  Result </h4><br><img src="https://habrastorage.org/files/cd6/0ea/a6c/cd60eaa6c57f4bfba83567c20d827427.png"><br><br><img src="https://habrastorage.org/files/2b6/2e7/3fc/2b62e73fcff64078a7a4f059349dcda7.png"><br><br>  <b>UPD:</b> After updating Logstash to version 1.5. * The recipe does not work, there will be time - I will post an updated version. </div><p>Source: <a href="https://habr.com/ru/post/236341/">https://habr.com/ru/post/236341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236329/index.html">We automate assembly of system</a></li>
<li><a href="../236331/index.html">Microsoft released a set of updates, September 2014</a></li>
<li><a href="../236333/index.html">Statements by the Free Software Foundation and Defective By Design regarding the latest Apple press conference.</a></li>
<li><a href="../236335/index.html">News from the world of Node: DataCollection.js, Supererror, Readability</a></li>
<li><a href="../236337/index.html">First look at the design of the new standard WordPress theme "Twenty Fifteen"</a></li>
<li><a href="../236343/index.html">WebStorm 9 EAP v.2 released - what was added this time?</a></li>
<li><a href="../236347/index.html">JSOC: how to measure availability of the Security Operation Center?</a></li>
<li><a href="../236349/index.html">Learning how to learn: a brief overview of course materials</a></li>
<li><a href="../236351/index.html">A strange git bug, almost costing 10 hours of work</a></li>
<li><a href="../236353/index.html">A fly in the ointment fly Linux Mint: or how I overcame the brightness</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>