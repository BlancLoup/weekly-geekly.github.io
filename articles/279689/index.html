<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>2.3 Working with custom data streams</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translator: This article is the eighth in the translation cycle of the official SFML library guide. Past article can be found here. This series of art...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>2.3 Working with custom data streams</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bc7/94a/b37/bc794ab377be444f8090426e56ae38bd.png"><br><br>  <i>Translator: This article is the eighth in the translation cycle of the official SFML library guide.</i>  <i>Past article can be found <a href="https://habrahabr.ru/post/279653/" title="Previous article: Threads">here.</a></i>  <i>This series of articles aims to provide people who do not know the original language the opportunity to get acquainted with this library.</i>  <i>SFML is a simple and cross-platform multimedia library.</i>  <i>SFML provides a simple interface for developing games and other multimedia applications.</i>  <i>The original article can be found <a href="http://www.sfml-dev.org/tutorials/2.3/system-stream.php" title="Original article: User data streams">here</a> .</i>  <i>Let's start.</i> <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table of contents:</b> <div class="spoiler_text">  0.1 Introduction <br><br>  1. Getting Started 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/278977/" title="Go to the article: SFML and Visual Studio">SFML and Visual Studio</a> </li><li>  <a href="https://habrahabr.ru/post/279069/" title="Go to Article: SFML and Code :: Blocks (MinGW)">SFML and Code :: Blocks (MinGW)</a> </li><li>  <a href="https://habrahabr.ru/post/279107/" title="Go to Article: SFML and Linux">SFML and Linux</a> </li><li>  <a href="https://habrahabr.ru/post/279147/" title="Go to Article: SFML and Xcode (Mac OS X)">SFML and Xcode (Mac OS X)</a> </li><li>  <a href="https://habrahabr.ru/post/279279/" title="Go to Article: Compiling SFML with CMake">Compiling SFML with CMake</a> </li></ol><br>  2. System Module <br><br><ol><li>  <a href="https://habrahabr.ru/post/279347/" title="Go to article: Processing Time">Processing time</a> </li><li>  <a href="https://habrahabr.ru/post/279653/" title="Go to article: Streams">Streams</a> </li><li>  <a href="https://habrahabr.ru/post/279689/" title="Go to article: Working with custom data streams">Work with custom data streams</a> </li></ol><br>  3. Window Module <br><br><ol><li>  <a href="https://habrahabr.ru/post/279957/" title="Go to Article: Opening and Managing Windows">Opening and managing windows</a> </li><li>  <a href="https://habrahabr.ru/post/280153/" title="Go to article: Event Handling">Event handling</a> </li><li>  Work with the keyboard, mouse and joysticks </li><li>  Using OpenGL </li></ol><br>  4. Graphics Module <br><br><ol><li>  Drawing 2D objects </li><li>  Sprites and textures </li><li>  Text and Fonts </li><li>  Forms </li><li>  Designing your own objects using arrays of vertices </li><li>  Position, Rotation, Scale: Transform Objects </li><li>  Adding special effects with shaders </li><li>  2D camera control and view </li></ol><br>  5. Audio module <br><br><ol><li>  Playing sounds and music </li><li>  Audio recording </li><li>  Custom audio streams </li><li>  Spitalization: sounds in 3D </li></ol><br>  6. Network module <br><br><ol><li>  Socket communication </li><li>  Use and Expansion Packages </li><li>  Web requests using HTTP </li><li>  File Transfer Using FTP </li></ol><br></div></div><br><h2>  Introduction </h2><br>  SFML has resource classes (images, fonts, sounds, etc.).  In many programs, these resources will be loaded from files using the <code>loadFromFile</code> function.  In some situations, resources will be directly packed into an executable file or into a large data file and will be loaded from memory using the <code>loadFromMemory</code> function.  These functions can satisfy almost any need, but not all. <br><br>  You may want to download files from an unusual place, such as a compressed / encrypted archive, or, for example, from a remote network folder.  For these special situations, SFML provides a third function: <code>loadFromStream</code> .  This function reads data using the abstract <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1InputStream.php" title="Documentation for sf :: InputStream">sf :: InputStream</a> interface, which allows you to have your own implementation of a stream class that will work with SFML. <br><br>  This article will explain how to write and use your own thread classes. <br><br><h2>  Standard C ++ threads? </h2><br>  Like many other languages, C ++ already contains a data flow class: <code>std::istream</code> .  In fact, there are two such classes: <code>std::istream</code> is only a front-end solution, an abstract interface to data obtained from <code>std::streambuf</code> . <br><br>  Unfortunately, these classes are not user friendly - solving a non-trivial task using these classes can become very difficult.  The <a href="http://www.boost.org/doc/libs/1_49_0/libs/iostreams/doc/index.html" title="Boost.Iostreams">Boost.Iostreams</a> library <a href="http://www.boost.org/doc/libs/1_49_0/libs/iostreams/doc/index.html" title="Boost.Iostreams">aims</a> to provide a simple interface for standard streams, but Boost is a big dependency. <br><br>  For this reason, SFML provides its own stream class, which we hope is simpler and faster than the ones listed above. <br><br><h2>  InputStream </h2><br>  The <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1InputStream.php" title="Documentation for sf :: InputStream">sf :: InputStream</a> class declares four virtual functions: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputStream</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~InputStream() {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Int64 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* data, Int64 size</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Int64 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seek</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Int64 position</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Int64 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tell</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Int64 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; };</code> </pre><br>  <b>read</b> should extract size bytes from the stream and copy them to the provided address.  Returns the number of bytes read, or -1 if an error occurred. <br><br>  <b>seek</b> should change the current position in the stream.  The argument is the absolute number of bytes to move (the count comes from the beginning of the data area, not from the current position).  Returns the new position or -1 if an error occurred. <br><br>  <b>tell</b> must return the current position (the number of bytes from the beginning of the data area) in the stream or -1 in case of an error. <br><br>  <b>getSize</b> should return the size (in bytes) of the data block contained in the stream, or -1 if an error occurs. <br><br>  To create your own working thread, you must include in your thread class an implementation of each of these four functions that will meet the requirements described above. <br><br><h2>  FileInputStream and MemoryInputStream </h2><br>  Two new classes have been added to SFML 2.3, providing streams for managing the new audio module.  <code>sf::FileInputStream</code> provides a stream for reading a file, <code>sf::MemoryInputStream</code> is used to read a stream of data from memory.  Both classes are based on <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1InputStream.php" title="Documentation for sf :: InputStream">sf :: InputStream</a> and can be used polymorphically. <br><br><h2>  Using InputStream </h2><br>  Using a custom stream class is simple: instantiate it and pass it as an argument to the <code>loadFromStream</code> (or <code>openFromStream</code> ) function of the object you want to initialize as a stream. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sf</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::FileStream</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">stream</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.open</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span>"); <span class="hljs-selector-tag"><span class="hljs-selector-tag">sf</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::Texture</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">texture</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">texture</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.loadFromStream</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">stream</span></span>);</code> </pre><br><h2>  Examples </h2><br>  If you need a demonstration of working code, and you do not want to get lost in the implementation details, you can take a look at the <code>sf::FileInputStream</code> and <code>sf::MemoryInputStream</code> . <br><br>  Do not forget to check the forum and wiki.  There is a chance that another user has already written a class that meets your needs.  If you have written a new class and consider that it may be useful to other users, do not hesitate to share it! <br><br><h2>  Common Misconceptions </h2><br>  Some resource classes do not load completely after calling <code>loadFromStream</code> .  Instead, they continue to read data from the data source for as long as required.  For this reason, the <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Music.php" title="Documentation on sf :: Music">sf :: Music</a> class reads audio primitives through the stream during their playback, and the <a href="http://www.sfml-dev.org/documentation/2.3/classsf_1_1Font.php" title="Documentation for sf :: Font">sf :: Font</a> class loads glyphs when the need arises. <br><br>  As a result, the stream you use to download a music or font, as well as the data source, must exist for as long as these resources are used.  Destruction of the source of information or class of data flow leads to indefinite behavior (the program can complete its execution, damage the data, or nothing can happen). <br><br>  Another common misconception is that the function returns an invalid value, i.e.  values ‚Äã‚Äãthat SFML is not expected to return in this situation.  For example, for <code>sf::FileInputStream</code> you could write a search function as follows: <br><br><pre> <code class="hljs ruby">sf::Int64 FileInputStream::seek(sf::Int64 position) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> std::fseek(m_file, position, SEEK_SET); }</code> </pre><br>  However, this code is not correct, because <code>std::fseek</code> returns zero on success, while SFML expects a new position in the stream to return. <br><br>  Next article: <a href="https://habrahabr.ru/post/279957/" title="Go to Article: Opening and Managing Windows">Opening and managing windows</a> . </div><p>Source: <a href="https://habr.com/ru/post/279689/">https://habr.com/ru/post/279689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279675/index.html">Track updates from MongoDB Oplog to Sharded Cluster using Scala and Akka Streams</a></li>
<li><a href="../279679/index.html">QNX RTOS: Qnet - transparent inter-tasking network interaction</a></li>
<li><a href="../279681/index.html">New home for repository or history of moving to GitLab</a></li>
<li><a href="../279685/index.html">The digest of interesting materials for the mobile # 145 developer (March 14-20)</a></li>
<li><a href="../279687/index.html">Distribution of applications. Part 1: Creating a Formula for Homebrew</a></li>
<li><a href="../279695/index.html">Yet another instructions for obtaining the Let's Encrypt ssl certificate</a></li>
<li><a href="../279699/index.html">Security Receivers demonstrate full-featured exploit for Android</a></li>
<li><a href="../279701/index.html">We use Yii2 migrations for working with multiple databases</a></li>
<li><a href="../279703/index.html">How to create the perfect pull request</a></li>
<li><a href="../279705/index.html">Is there a visible border on the web?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>