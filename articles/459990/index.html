<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Immersion in the Move - Libra blockchain programming language from Facebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Next, we will examine in detail the main characteristics of the Move language and what are its key differences with another, already popular language ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Immersion in the Move - Libra blockchain programming language from Facebook</h1><div class="post__text post__text-html js-mediator-article">  Next, we will examine in detail the main characteristics of the Move language and what are its key differences with another, already popular language for smart contracts - Solidity (on the Ethereum platform).  The material is based on the study of the available on-line 26-page whitepaper. <br><br><h3>  Introduction </h3><br>  Move is the bytecode executable language that is used to perform user transactions and smart contracts.  Pay attention to two points: <br><br><ol><li>  While Move is a bytecode language that can be directly executed on a Move virtual machine, Solidity (the smart contract language in Ethereum) is a higher level language that is first compiled into a byte code before execution in EVM (Ethereum Virtual Machine ). </li><li>  Move can be used not only for the implementation of smart contracts, but also for user transactions (more on this later), while Solidity is a language for smart contracts only. </li></ol><a name="habracut"></a><br>  <i>Translation is done by the INDEX Protocol project team.</i>  <i>Previously, we have already translated a <a href="https://habr.com/ru/post/457050/">lot of material describing the Libra project</a> , now it‚Äôs time for a little more detail to look at the Move language.</i>  <i>Translation is made together with <a href="https://habr.com/ru/users/coolsiu/" class="user_link">coolsiu</a></i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A key feature of Move is the ability to define custom resource types with semantics based on linear logic: a resource can never be copied or implicitly deleted, only moved.  Functionally, this is similar to the features of the Rust language.  Values ‚Äã‚Äãin Rust can only be assigned to one name at a time.  Assigning a value to another name makes it unavailable under the previous name. <br><br><img src="https://habrastorage.org/webt/np/px/97/nppx97owkfkamua9ccpc1aovkrg.png"><br><br>  For example, the following code snippet will generate an error: <i>Use of moved value 'x'.</i>  This is because in Rust there is no garbage collection.  When variables go out of scope, the memory to which they refer is also freed.  Simply put, there can be only one ‚Äúowner‚Äù of data.  In this example, <i>x</i> is the original owner, and then <i>y</i> becomes the new owner.  <a href="http://squidarth.com/rc/rust/2018/05/31/rust-borrowing-and-ownership.html">Read more about this behavior here</a> . <br><br><h3>  Representation of digital assets in open systems </h3><br>  There are two properties of physical assets that are difficult to digitize: <br><br><ul><li>  <b>Rarity</b> (Deficiency, in the original - scarcity).  The number of assets (emission) in the system must be controlled.  It is necessary to prohibit the duplication of existing assets, and the creation of new ones is a privileged operation. </li><li>  <b>Access control</b> .  The system member must be able to protect assets using access control policies. </li></ul><br>  These two characteristics, which are natural for physical assets, must also be realized for digital objects if we want to consider them as assets.  For example, a rare metal has a natural shortage, and only you have access to it (holding, for example) and you can sell it or spend it. <br><br>  To illustrate how we came to these two properties, let's start with the following sentences: <br><br><h4>  Sentence No. 1: The simplest rule without deficiency and access control </h4><br><img src="https://habrastorage.org/webt/it/ar/vy/itarvy-z1ns775gm4oxu2isimxe.png"><br><br><ul><li>  <i>G [K]: = n</i> indicates the update of the number available on the key <i>K</i> in the global state of the blockchain with the new value <i>n</i> . </li><li>  <i>transaction ‚ÄúAlice, 100‚Äù</i> means setting the balance of Alice's account to 100. </li></ul><br>  The above solution has several serious problems: <br><br><ul><li>  Alice can receive an unlimited amount of coins simply by sending the <i>transaction ‚ÄúAlice, 100‚Äù.</i> </li><li>  The coins that Alice sends to Bob are useless, since Bob could send himself an unlimited amount of coins using the same technique. </li></ul><br><h4>  Suggestion number 2: We consider the deficit </h4><br><img src="https://habrastorage.org/webt/_1/s4/08/_1s408pxxtmawws6dw_vddgzr-m.png"><br><br>  Now we monitor the situation so that the number of <i>Ka</i> coins is at least equal to <i>n</i> before the transfer transaction.  Nevertheless, although this solves the problem of shortage, there is no information about who can send Alice‚Äôs coins (so far everyone can do it, the main thing is not to violate the quantity limitation rule). <br><br><h4>  Proposal # 3: Combining Deficit and Access Control </h4><br><img src="https://habrastorage.org/webt/yi/so/hh/yisohh7xhtgmzt8aparwsxdccfc.png"><br><br>  We solve this problem by using the <i>verify_sig</i> digital signature <i>mechanism</i> before checking the balance, which means that Alice uses her private key to sign a transaction and confirm that she is the owner of her coins. <br><br><h3>  Programming languages ‚Äã‚Äãblockchain </h3><br>  The existing blockchain languages ‚Äã‚Äãencounter the following problems (all of them were resolved in the Move (note: <i>unfortunately, the author appeals only to Ethereum in his comparisons, so it‚Äôs worth taking them only in this context. For example, most of the following are also solved in EOS</i> )): <br><br>  <b>Indirect asset representation</b> .  An asset is encoded using an integer, but an integer value is not the same as an asset.  In fact, there is no type or value representing bitcoin / broadcast / &lt;Any Coin&gt;!  This makes it difficult and error-prone to write programs that use assets.  Patterns such as transferring assets to / from procedures or storing assets in structures require special language support. <br><br>  <b>Lack of non-expanding</b> .  A language represents only one deficient asset.  In addition, the means of protection against shortages are rigidly sewn directly into the semantics of the language itself.  The developer, if he wants to create a user asset, must carefully control all aspects of the resource.  These are the problems of Ethereum smart contracts. <br><br>  Users release their assets, ERC-20 standard tokens, using whole numbers to determine both value and total emissions.  Whenever new tokens are created, the smart contract code must independently verify compliance with the emission rules.  In addition, the indirect presentation of assets leads, in some cases, to serious errors - duplication, double spending, or even total loss of assets. <br><br>  <b>Lack of flexible access control</b> .  The only access control policy currently used is a signature scheme using asymmetric cryptography.  As well as protection against shortages, access control policies are deeply rooted in the semantics of language.  But how to extend the language to allow programmers to define their own access control policies is often a very non-trivial task. <br><br>  This is also true for Ethereum, where smart contracts do not have native cryptography support for access control.  Developers must manually prescribe access control, for example, using the onlyOwner modifier. <br><br>  Despite the fact that I am a big fan of Ethereum, I believe that the properties of assets should initially be natively supported by the language for security purposes.  In particular, transferring Ether to a smart contract involves dynamic dispatching, which has led to the emergence of a new class of errors, known as re-entrancy vulnerabilities.  Dynamic scheduling here means that the code execution logic will be determined at runtime (dynamic) and not at compile time (static). <br><br>  Thus, in Solidity, when contract A calls contract function B, contract B may run code that was not provided by contract developer A, which could lead to <a href="https://consensys.github.io/smart-contract-best-practices/known_attacks/">re-entry vulnerabilities</a> (contract A randomly performs the function of contract B to withdraw money before the actual deduction account balances). <br><br><h3>  Basics of the design of the language Move </h3><br><h4>  First Order Resources </h4><br>  Speaking high level, the interaction between modules / resources / procedures in the Move language is very similar to the relationship between classes / objects and methods in OOP languages. <br>  The modules in Move are similar to smart contracts in other blockchains.  The module declares resource types and procedures that define rules for creating, destroying, and updating declared resources.  But all this is just conventions (‚Äú <i>jargon</i> ‚Äù) in Move.  We will illustrate this point a little later. <br><br><h4>  Flexibility </h4><br>  Move adds Libra flexibility through scripts.  Each transaction in Libra includes a script, which is actually the main transaction procedure.  The script can perform either one specified action, for example, payments for a specified list of recipients, or reuse other resources ‚Äî for example, by calling a procedure in which the common logic is specified.  This is why Move transaction scripts offer more flexibility.  The script can use both one-time and repetitive behaviors, while Ethereum can only execute repetitive scenarios (by calling one method the smart contract method).  The reason why it is called ‚Äúmultiple‚Äù is that the functions of a smart contract can be performed several times.  (note: <i>here the moment is very thin. On the one hand, transaction scripts in the form of pseudo-bytecode exist in Bitcoin. On the other hand, as I understand it, Move expands this language, in fact, to the level of a full-fledged language of smart contracts</i> ). <br><br><h4>  Security </h4><br>  The executable Move format is a byte-code, which, on the one hand, is a language of a higher level than assembler, but lower level than the source code.  The byte code is checked in the on-chain for the presence of resources, types and memory security using the byte-code verifier, and then executed by the interpreter.  This approach allows Move to provide security that is specific to source code, but without the compilation process and the need to add a compiler to the system.  Making Move bytecode code is a really good solution.  There is no need to compile it from source, as in the case of Solidity, you do not need to worry about possible failures or attacks on the compiler infrastructure. <br><br><h4>  Verifiability </h4><br>  We aim to perform as easy checks as possible, since all of this goes on-chain (note: <i>online, in the process of performing each transaction, so any delay will slow down the entire network</i> ), but initially the language design is ready for use and off-chain static verification tools.  Although it is more preferable, but so far the development of verification tools (as a separate toolkit) has been postponed for the future, and now only dynamic verification in the on-chain is supported. <br><br><h4>  Modularity </h4><br>  Move modules provide data abstraction and localize critical operations on resources.  The encapsulation provided by the module, combined with the protection provided by the Move type system, ensures that the properties set for the module types cannot be violated by code outside the module.  This is a fairly thoughtful design of abstraction, meaning that the data inside the contract can be changed only as part of the execution of the contract, but not from the outside. <br><br><img src="https://habrastorage.org/webt/rm/co/qe/rmcoqelz3bad4ltayox-u9rpxq0.png"><br><br><h3>  Move overview </h3><br>  The sample transaction script demonstrates that malicious or careless actions of a programmer outside a module cannot compromise the security of a module‚Äôs resources.  Next, we will look at examples of how modules, resources, and procedures are used to program the Libra blockchain. <br><br><h4>  Peer-to-Peer Payments </h4><br><img src="https://habrastorage.org/webt/1a/hr/hh/1ahrhhw3rd4ky7jpfsvzxeohi0e.png"><br><br>  The amount of coins specified in the amount will be transferred from the balance of the sender to the recipient. <br>  There are a few new points here (highlighted in red): <br><br><ul><li>  <b>0x0</b> : address of the account where the module is stored </li><li>  <b>Currency</b> : module name </li><li>  <b>Coin</b> : resource type </li><li>  The coin value returned by the procedure is a resource value of type 0x0.Currency.Coin </li><li>  <b>move ()</b> : value cannot be used again </li><li>  <b>copy ()</b> : value can be used later </li></ul><br>  Parse the code: in the first step, the sender calls the procedure named <i>withdraw_from_sender</i> from the module stored in <i>0x0.Currency</i> .  At the second stage, the sender transfers funds to the recipient by moving the value of the coin resource to the deposit procedure of the <i>0x0.Currency</i> module. <br><br>  Here are three examples of errors in the code that will be rejected by checks: <br>  <b>Duplication of funds by changing the call <i>move (coin)</i> to <i>copy (coin)</i></b> .  Resources can only be moved.  Attempting to duplicate the amount of a resource (for example, by calling <i>copy (coin)</i> in the example above) will result in an error during the bytecode check. <br><br>  <b>Reuse funds by specifying <i>move (coin)</i> twice</b> .  Adding the line <i>0x0.Currency.deposit (copy (some_other_payee), move (coin))</i> for example above allows the sender to ‚Äúspend‚Äù coins twice - the first time with the payee, and the second with <i>some_other_payee</i> .  This is undesirable behavior, impossible with a physical asset.  Fortunately, Move will reject this program. <br><br>  <b>Loss of funds due to failure to <i>move (coin)</i></b> .  If you do not move a resource (for example, deleting a line containing <i>move (coin)</i> ), a bytecode check error will be triggered.  This protects Move programmers from accidental or malicious loss of funds. <br><br><h3>  Currency module </h3><br><img src="https://habrastorage.org/webt/p1/gx/rh/p1gxrhzyyl4cmlmlq5rcr4yhzmc.png"><br><br>  Each account can contain 0 or more modules (shown as rectangles) and one or more resource values ‚Äã‚Äã(shown as cylinders).  For example, an account at <i>0x0</i> contains a module <i>0x0.Currency</i> and a resource value of type <i>0x0.Currency.Coin</i> .  The account at <i>0x1</i> has two resources and one module;  The account at <i>0x2</i> has two modules and one resource value. <br><br>  Some moments: <br><br><ul><li>  The atomic transaction script is either completely executed or not. </li><li>  A module is a long-lived piece of code, globally accessible. </li><li>  The global state is structured as a hash table, where the key is the address of the account </li><li>  Accounts can contain no more than one resource value of this type and no more than one module with a given name (an account at <i>0x0</i> cannot contain an additional resource <i>0x0.Currency.Coin</i> or another module named <i>Currency</i> ) </li><li>  The address of the declared module is part of the type ( <i>0x0.Currency.Coin</i> and <i>0x1.Currency.Coin</i> are separate types that cannot be used interchangeably) </li><li>  Programmers can store several instances of this type of resource in their account, defining their custom resource - ( <i>resource TwoCoins {c1: 0x0.Currency.Coin, c2: 0x0.Currency.Coin}</i> ) </li><li>  You can refer to a resource by its name without conflict, for example, you can refer to two resources using <i>TwoCoins.c1</i> and <i>TwoCoins.c2</i> . </li></ul><br><h4>  Coin Resource Announcement </h4><br><img src="https://habrastorage.org/webt/az/79/8o/az798o2jkg9ft5tkiisy5fitk2o.png"><br>  Module named <i>Currency</i> and type of resource named <i>Coin</i> <br><br>  Some moments: <br><br><ul><li>  <i>Coin</i> is a structure with one field of type <i>u64</i> (64-bit unsigned integer) </li><li>  Only <i>Currency</i> module procedures can create or destroy <i>Coin</i> values. </li><li>  Other modules and scripts can only record or reference a value field through the open procedures provided by the module. </li></ul><br><h4>  Implementation of the deposit </h4><br><img src="https://habrastorage.org/webt/52/uj/nw/52ujnwxqzafegglfjqrsckqwy50.png"><br><br>  This procedure takes the <i>Coin</i> resource as input and combines it with the <i>Coin</i> resource stored in the recipient‚Äôs account: <br><br><ol><li>  Destroys the input Coin resource and records its value. </li><li>  Getting a link to a unique Coin resource stored on the recipient account. </li><li>  Change the value of the Coin quantity by the value passed in the parameter when calling the procedure. </li></ol><br>  Some moments: <br><br><ul><li>  <i>Unpack, BorrowGlobal</i> - embedded procedures </li><li>  <i>Unpack &lt;T&gt;</i> is the only way to remove a resource of type T. The procedure takes a resource at the input, destroys it, and returns the value associated with the resource fields. </li><li>  <i>BorrowGlobal &lt;T&gt;</i> takes the address as input and returns a link to a unique instance of T published (owned) to that address. </li><li>  <i>&amp; mut Coin</i> is a link to a <i>Coin</i> resource. </li></ul><br><h4>  Implementing withdraw_from_sender </h4><br><img src="https://habrastorage.org/webt/af/6s/h_/af6sh_tc_6jpvlwzgka0by5cnjo.png"><br><br>  This procedure: <br><br><ol><li>  Gets a link to a unique <i>Coin</i> resource linked to the sender's account. </li><li>  Reduces the value of the resource <i>Coin</i> by reference to the specified amount </li><li>  Creates and returns a new <i>Coin</i> resource with an updated balance. </li></ol><br>  Some moments: <br><br><ul><li>  <i>Deposit</i> can be called by anyone, but <i>withdraw_from_sender</i> has access only to coins of the calling account </li><li>  <i>GetTxnSenderAddress</i> is similar to <i>msg.sender</i> in Solidity </li><li>  <i>RejectUnless</i> is similar to <i>require</i> in Solidity.  If this check fails, the execution of the transaction is stopped and all changes are rolled back. </li><li>  <i>Pack &lt;T&gt;</i> is also a built-in procedure that creates a new T resource. </li><li>  Like <i>Unpack &lt;T&gt;</i> , <i>Pack &lt;T&gt;</i> can only be called inside a module, where the resource <i>T is</i> described. </li></ul><br><h3>  Conclusion </h3><br>  We analyzed the main features of the Move language, compared it with Ethereum, and also familiarized ourselves with the basic syntax of the scripts.  In conclusion, I highly recommend looking through the <a href="https://developers.libra.org/docs/assets/papers/libra-move-a-language-with-programmable-resources.pdf">original white paper</a> .  It includes many details regarding the principles of designing a programming language, as well as many useful links. </div><p>Source: <a href="https://habr.com/ru/post/459990/">https://habr.com/ru/post/459990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459978/index.html">Node.js developer tools. Remote procedure call on web sockets</a></li>
<li><a href="../459980/index.html">High tech Nigerian letters</a></li>
<li><a href="../459982/index.html">Roslyn Analyzers. How to write code quickly and accurately</a></li>
<li><a href="../459984/index.html">We create infrastructure as code with GitLab and Ansible</a></li>
<li><a href="../459988/index.html">Dog ate on neural networks</a></li>
<li><a href="../459992/index.html">GOST R 57100-2016. What was it?</a></li>
<li><a href="../459994/index.html">Study: Linux is still the most popular OS in the cloud</a></li>
<li><a href="../459996/index.html">Germany. Munich. Advanced Immigration guide</a></li>
<li><a href="../46/index.html">Idea. Tags</a></li>
<li><a href="../460/index.html">Who is mr. Yakutsky?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>