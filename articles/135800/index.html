<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Getting rid of PGP in the mutt mailbox</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my paranoid view, whenever possible, all communication by mail and IM should be encrypted. (Not because I have something to hide, but simply becaus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Getting rid of PGP in the mutt mailbox</h1><div class="post__text post__text-html js-mediator-article">  In my paranoid view, whenever possible, all communication by mail and IM should be encrypted.  (Not because I have something to hide, but simply because I see no reason to show my messages to Pete's neighbor, regardless of where he works - anywhere, with the provider, or in the special service.) For mail, this is PGP / GPG for IM it is OTR.  But this encryption is designed to protect messages in the process of transmission over the network, and not on the screw in the mailbox / IM logs.  There is no use to the screw from it, some troubles - slow search in messages (if in your MUA the search generally works in encrypted letters), inability to process the mailbox with simple scripts, etc.  If there is a need to encrypt data on your screw, then for this there are other, more suitable and universal means than PGP for a part of the letters. <br><br>  Since PGP is required only during transmission over the network, it would be an ideal solution to encrypt / decrypt messages at the time of reception / transmission, i.e.  using a local POP3 / SMTP relay server.  In this case, all mail clients (MUA) would automatically receive "PGP support", and at the same time they themselves did not know anything about PGP, and worked with unencrypted emails.  Under Windows, there is such a server - <a href="http://sites.inka.de/tesla/gpgrelay.html">GPGrelay</a> .  Under * NIX I could not find an analogue.  There is a <a href="http://www.snafu.priv.at/mystuff/kuvert/">kuvert</a> utility that can automatically encrypt outgoing mail, but I did not find utilities for decrypting incoming mail. <br><br>  But the motto of the mutt is not in vain ‚ÄúAll mail clients suck.  This one just sucks less. ‚ÄùI managed with his flexibility, a small auxiliary script for qmail, and such and such a mother to solve this seemingly banal task. <br><a name="habracut"></a><br><h4>  Sending letters </h4><br>  It's all simple.  Mutt is responsible for encrypting sent messages, as usual.  Thus, I see / control which messages are encrypted and which are not.  And in order for an unencrypted version of the sent message to remain in my mailbox, it is enough to add to ~ / .muttrc: <br> <code>set fcc_clear=yes</code> <br> <br><h4>  Receive letters </h4><br>  And here there are difficulties.  In mutt, there is a decrypt-save function that correctly decrypts a letter (including attachments), saves the decrypted letter to the specified mailbox, and removes the encrypted original.  (By the way, do not confuse it with decode-save, which does almost the same thing, only worse - at least it seems that it doesn‚Äôt support attachments. Interestingly, by default in mutt decode-save is hung on Esc + s, and the best decrypt-save not assigned to any combination of buttons.) With its help, you can create a hook that will automatically decrypt the message at the time of opening, replacing the encrypted version in the current box with an unencrypted version - add it to ~ / .muttrc: <br> <code>message-hook '~h"Content-Type: multipart/encrypted"' 'push &lt;decrypt-save&gt;\cu^&lt;Enter&gt;&lt;sync-mailbox&gt;&lt;Enter&gt;' <br></code>  This approach has several features / disadvantages: <br><ul><li>  It is impossible to delete only one encrypted letter, so that at the moment of opening the encrypted letter, all the letters marked for deletion in this box are deleted, which can be an unpleasant surprise in some situations. </li><li>  As usual in mutt, at the time of marking the current letter for deletion, it proceeds to the next letter in this box.  If this encrypted letter was the only new letter, then everything will work perfectly - the next letter will be exactly his unencrypted copy, so that when entering this letter you will see it.  If there were several new letters in the box, and all are encrypted, then opening the first one will cause an avalanche of automatic transitions to the next letters with their automatic decryption, but outwardly everything will work as expected - as a result, the letter that you opened will open.  But if among the new letters there are encrypted and not encrypted mixed, then entering the first encrypted letter you suddenly instead of it will open the first unencrypted. </li><li>  Unlike the Windows GPGrelay (which, when decrypted, can optionally add information to the letter that it was encrypted / signed), the decrypt-save function does not modify the letter in any way.  Thus, after automatic decryption and deletion of the original letter, we will not be able to find out if it was encrypted and correctly signed. </li></ul>  To solve the last problem, I wrote a short script <a href="http://powerman.name/download/addgpginfo/">addgpginfo</a> .  He receives a letter on STDIN, if it was encrypted or encrypted and signed, he adds non-standard GPG headers to the letter: with full information about encryption / signature, and then launches the program specified by the parameters, giving it a modified letter to STDIN.  I developed it for use in ~ / .qmail, but in theory this approach should work with any similar programs like procmail.  For example, if you have in ~ / .qmail: <br> <code>./Maildir/</code> <br>  then you write instead: <br> <code>|addgpginfo qmail-local "$USER" "$HOME" "$LOCAL" "" "nodeliver" "$HOST" "$SENDER" ./Maildir/</code> <br> <br>  For reasons of paranoia, it would be necessary to add the deletion of possible GPGs in it: headers from incoming letters (so that no one could send you an unsigned letter on behalf of someone else‚Äôs name, in which he wrote that it was allegedly correctly signed).  And for compatibility reasons, rename the GPG header: to X-GPG :.  But this is the little things.  In order for addgpginfo to work, it is necessary that you have gpg-agent running with the option - write-env-file, and running Xs ($ DISPLAY can be passed to it as a parameter if you don‚Äôt have ": 0"). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The result looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/ec3/826/ee2/ec3826ee2ada8729da9df2df7ff11ab3.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/135800/">https://habr.com/ru/post/135800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135794/index.html">Classical mechanics: about diffusions "on the fingers"</a></li>
<li><a href="../135795/index.html">Artificial intelligence in CAM-systems for solving problems of automating the creation of control programs</a></li>
<li><a href="../135796/index.html">Social Internet services as tools for creating social media</a></li>
<li><a href="../135797/index.html">Groovy implicit type casting features</a></li>
<li><a href="../135798/index.html">Backup Time Machine do it yourself</a></li>
<li><a href="../135801/index.html">Future couchdb</a></li>
<li><a href="../135803/index.html">We release a hexadecimal calendar through the Russian KickStarter</a></li>
<li><a href="../135804/index.html">Next-generation PlayStation 4 and Xbox may be introduced in June</a></li>
<li><a href="../135805/index.html">Jan. 16 Mandriva may be declared bankrupt</a></li>
<li><a href="../135806/index.html">Time lamp</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>