<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SystemD sucks, long live SystemD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It seems that systemd is an apple of contention in the Linux community. As if there is no neutral point of view on systemd. Fundamentally opposing opi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SystemD sucks, long live SystemD</h1><div class="post__text post__text-html js-mediator-article">  It seems that <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a> is an apple of contention in the Linux community.  As if there is no neutral point of view on systemd.  Fundamentally opposing opinions suggest that you should either love him or desire destruction.  I want to suggest a certain middle ground.  To begin with, let's discuss the dreadful properties of systemd. <br><br><h1>  Bad and nightmarish </h1><br><h2>  <a href="http://man7.org/linux/man-pages/man1/systemd-escape.1.html">systemd-escape</a> </h2><br>  The fact that a <a href="http://man7.org/linux/man-pages/man1/systemd-escape.1.html">systemd-escape</a> exists by itself clearly indicates something terribly wrong.  If you have never seen or used this command in business, consider yourself lucky. <br><a name="habracut"></a><br>  In practice, the <a href="https://stackoverflow.com/questions/23935637/systemd-string-escaping">command is used like this</a> : <br><br><pre><code class="bash">/bin/bash -c 'while true; do \
    /usr/bin/etcdctl set my-container \
        "{\"host\": \"1\", \"port\": $(/usr/bin/docker port my-container 5000 | cut -d":" -f2)}" \
    --ttl 60; \
    sleep 45; \
done'</code></pre><br>
 ,        ,  ,    cloud-init  CoreOS,     . Escape-        .<br>
<br>
     <code>ExecStart</code>   ,  systemd    ,        .  ,       ,      systemd.     systemd      <code>shlex</code>  Python  <code>Shellwords</code>  Ruby,          , <code>systemd-escape</code>:<br>
<br>
<pre><code class="bash">$ man systemd-escape | head
SYSTEMD-ESCAPE(1)                                            systemd-escape                                            SYSTEMD-ESCAPE(1)

NAME
       systemd-escape - Escape strings for usage in system unit names

SYNOPSIS
       systemd-escape [OPTIONS...] [STRING...]

DESCRIPTION
       systemd-escape may be used to escape strings for inclusion in systemd unit names.</code></pre><br>
       SystemD:<br>
<br>
<pre><code class="bash">$ systemd-escape 'while true;do /usr/bin/etcdctl set my-container "{\"host\": \"1\", \"port\": $(/usr/bin/docker port my-container 5000 | cut -d":" -f2)}" --ttl 60;sleep 45;done'
while\x20true\x3bdo\x20-usr-bin-etcdctl\x20set\x20my\x2dcontainer\x20\x22\x7b\x5c\x22host\x5c\x22:\x20\x5c\x221\x5c\x22\x2c\x20\x5c\x22port\x5c\x22:\x20\x24\x28-usr-bin-docker\x20port\x20my\x2dcontainer\x205000\x20\x7c\x20cut\x20\x2dd\x22:\x22\x20\x2df2\x29\x7d\x22\x20\x2d\x2dttl\x2060\x3bsleep\x2045\x3bdone</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/53d/1d8/59e/53d1d859ee17a143afeb26755862d172.gif"><br>
<br>
,          while  Bash,      ,      .<br>
<br>
<h2> </h2><br>
    , journald <a href="https://www.reddit.com/r/linux/comments/1y6q0l/systemds_binary_logs_and_corruption/">     </a>.    ,       : <code>tail</code>, <code>cat</code>, <code>less</code>  <code>grep</code>  .       .        ,    <code>vim</code>  <code>less</code>   .          ,   .<br>
<br>
         ,        .                .    /,    ,       <code>journalctl</code>,       .<br>
<br>
     - ,        systemd.              ,  <code>journald</code>   .<br>
<br>
<h1></h1><br>
    ,    systemd.  ,    ,   <i></i>  Linux  systemd.<br>
<br>
<h2></h2><br>
   ,   <a href="">init- SysV  ZooKeeper</a>,   169   ,        .<br>
<br>
<pre><code class="bash"># for some reason these two options are necessary on jdk6 on Ubuntu
#   accord to the docs they are not necessary, but otw jconsole cannot
#   do a local attach
...</code></pre><br>
     systemd:<br>
<br>
<pre><code class="bash">[Unit]
Description=ZooKeeper

[Service]
Type=simple
Restart=always
RestartSec=5
EnvironmentFile=/etc/sysconfig/zookeeper
ExecStart=/usr/bin/java -cp ${ZK_CLASSPATH} ${JVM_FLAGS} org.apache.zookeeper.server.quorum.QuorumPeerMain ${ZOO_CFG_FILE}

[Install]
WantedBy=multi-user.target</code></pre><br>
       . ,    ,    :<br>
<br>
<pre><code class="bash">ZK_CLASSPATH=/opt/zookeeper:/opt/zookeeper/lib:/etc/zookeeper
JVM_FLAGS=-Xmx=2g
ZOO_CFG_FILE=/etc/zookeeper/zoo.cfg</code></pre><br>
‚Ä¶ <i> </i>.  .<br>
<br>
          ,      ,   , ,      <code>syslog-ng</code>  <code>rsyslog</code>.   ,   .<br>
<br>
<h2>  </h2><br>
     -  <a href="http://supervisord.org/">supervisord</a>  ,   .      systemd <i>    ,     </i>.  ,   init         ,     .      segfault     ,       .<br>
<br>
  systemd:<br>
<br>
<pre><code class="bash">[Service]
...
Restart=always
RestartSec=1</code></pre><br>
  ,      ,        .    <code>stop</code>  ,      ,      ,      . , systemd <i>  </i>,      ,        .<br>
<br>
<h2> </h2><br>
    init- SysV,          ?  ,       A   B,    C?    :<br>
<br>
<pre><code class="bash">while true ; do
  if pgrep serviceB ; then
    start_service
    break
  else
    sleep 1
  fi
done</code></pre><br>
   A   C    init-  C     while      A.    ,   .<br>
<br>
  systemd:<br>
<br>
<pre><code class="bash">[Unit]
Description=Service A
After=serviceB.service
Before=serviceC.service</code></pre><br>
 <i> </i>.     . systemd          ,     <code>serviceA</code>   <code>serviceB</code>,   <code>serviceC</code>.   ,   drop-in ,     .  ,              .<br>
<br>
<h3>:    </h3><br>
systemd     <a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html"><i></i>   </a>:<br>
<br>
<pre><code class="bash">[Unit]
Description=Service A
ConditionPathExists=/etc/sysconfig/serviceA</code></pre><br>
 Service A      <code>/etc/sysconfig/serviceA</code>.    ,      .<br>
<br>
<h3>: </h3><br>
 systemd       ,    Linux   systemd  <i></i> ,    init-.    systemd  ,   ,   .<br>
<br>
<h2> </h2><br>
  , systemd         ,  . ,     <code>rsyslog</code>   <code>cloud-final</code>.   , <code>cloud-final</code>     <code>cloud-init</code>.<br>
<br>
   <code>rsyslog.service</code>   <code>/usr/lib/systemd/system/rsyslog.service</code>,       .   drop-in   <code>/etc/systemd/system/rsyslog.service.d/after-cloudinit.conf</code>:<br>
<br>
<pre><code class="bash">[Unit]
After=cloud-final.service</code></pre><br>
     ,     <code>.conf</code>.      ,       .   drop-in ,  rsyslog  ,  <code>cloud-final.service</code>  /.<br>
<br>
<b>:</b>  <a href="https://twitter.com/AhmetAlpBalkan/status/820050899456303105">  </a>,  systemd      .     , ,       ,    , , <code>%02d-%s.conf</code>.<br>
<br>
<h3> </h3><br>
,         ?   :<br>
<br>
<pre><code class="bash">[Service]
ExecStartPre=</code></pre><br>
       ,      <code>ExecStartPre</code>   .       <code>ExecStartPre</code>   ,         ,     .<br>
<br>
<h2> </h2><br>
  systemd        ,   .          ,       .      :<br>
<br>
<pre><code class="bash">$ sudo journalctl -u rsyslog.service</code></pre><br>
    <code>less</code>    <code>rsyslog.service</code>.       :<br>
<br>
<pre><code class="bash">$ sudo journalctl -u rsyslog.service -f</code></pre><br>
    <code>tail -f</code>  .<br>
<br>
         ,       <code>logrotate</code>,      .<br>
<br>
 <code>rsyslog</code>  <code>syslog-ng</code>  ,   ,            syslog,                 syslog.<br>
<br>
<h1>   </h1><br>
     .          systemd,     :<br>
<br>
<ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html">systemd.exec</a></li>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">systemd.service</a></li>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">systemd.unit</a></li>
</ul><br>
      <a href="https://www.freedesktop.org/software/systemd/man/systemd.mount.html"> </a>, <a href="https://www.freedesktop.org/software/systemd/man/systemd.timer.html"></a>    ,   systemd.          <code>systemctl</code>  <code>journalctl</code>,   :<br>
<br>
<ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemctl.html">systemctl</a></li>
<li><a href="https://www.freedesktop.org/software/systemd/man/journalctl.html">journalctl</a></li>
</ul><br>
,       ¬´systemd ¬ª,    ,     systemd.    systemd        ,            systemd.</div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325792/">https://habr.com/ru/post/325792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325782/index.html">The book "Programming in Python"</a></li>
<li><a href="../325784/index.html">Web application security: practical cases</a></li>
<li><a href="../325786/index.html">Why we created a replacement for the old document search systems</a></li>
<li><a href="../325788/index.html">PWA, ‚ÄúOminous Valley‚Äù and stable work offline</a></li>
<li><a href="../325790/index.html">Look at yourself through Zuckerberg‚Äôs eyes and help his rivals.</a></li>
<li><a href="../325796/index.html">How to reduce the time to launch applications for iOS</a></li>
<li><a href="../325798/index.html">Kinetics of large clusters</a></li>
<li><a href="../325802/index.html">Working in the cloud on Hyper-V, part 4: creating backup copies of a virtual machine</a></li>
<li><a href="../325804/index.html">Who are you in a startup: hipster, hustler, hacker or analyst</a></li>
<li><a href="../325806/index.html">Y Combinator 2017 Startup School: ‚ÄúWhy?‚Äù (Part One)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>