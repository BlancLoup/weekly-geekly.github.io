<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Preparing ASP.NET Core: more about working with a modular framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue our column on the topic ASP.NET Core by another publication from Dmitry Sikorsky ( DmitrySikorsky ) - the head of the company ‚ÄúYubreinians...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Preparing ASP.NET Core: more about working with a modular framework</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>We continue our column on the topic ASP.NET Core by another publication from Dmitry Sikorsky ( <a href="https://habrahabr.ru/users/dmitrysikorsky/" class="user_link">DmitrySikorsky</a> ) - the head of the company ‚ÄúYubreinians‚Äù from Ukraine.</i>  <i>This time, Dmitry continues to talk about his experience in developing a modular cross-platform framework based on ASP.NET Core.</i>  <i>Previous articles from the column can always be read on the link <a href="http://habrahabr.ru/search/%3Fq%3D%255B%2523aspnetcolumn%255D%26target_type%3Dposts">#aspnetcolumn</a> - Vladimir Yunev</i> </blockquote>  In the <a href="https://habrahabr.ru/company/microsoft/blog/278247/">previous article,</a> I already talked about ExtCore - a small framework for developing modular and extensible applications on ASP.NET Core.  In this article I will try to stop in more detail on the process of developing an application based on it. <br><br><h3>  Main application </h3><br>  First of all, create a new empty project on ASP.NET Core 1.0: <br><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/33e/61f/eee/33e61feeed8c422bb3141dc457b2570b.png"></div><a name="habracut"></a><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/acf/78b/b13/acf78bb13f2f43c7867f5768f1a4b679.png"></div><br>  As a result, we get a ready-to-use project.  It remains only to delete the Project_Readme.html file.  Now our solution browser should look something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/e69/4cf/f7c/e694cff7c5594c148ebe6ddf5ced2572.png"></div><br><br><blockquote> <a href="https://github.com/ExtCore/ExtCore-Sample"><img title="aspnetcolumngithub" alt="aspnetcolumngithub" src="https://habrastorage.org/files/e5a/eff/108/e5aeff1080f44ada899062dee76a3e24.png" width="240" align="right" height="88"></a>  <b>Tip!</b>  You can try everything yourself or by downloading the source code from GitHub <a href="https://github.com/ExtCore/ExtCore-Sample">https://github.com/ExtCore/ExtCore-Sample</a> . </blockquote>  To connect the ExtCore framework to our project, you need to add links to the NuGet packages ExtCore.Infrastructure and ExtCore.WebApplication in project.json.  Also, since in this example we will work with the database, we will add links to the ExtCore.Data extension components: (ExtCore.Data, ExtCore.Data.Abstractions, ExtCore.Data.EntityFramework.Sqlite, ExtCore.Data. Models.Abstractions).  (We will also need links to packages familiar to MVC applications, like Microsoft.AspNet.Mvc.) As a result, our project.json should look like this: <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"commands"</span></span>: { <span class="hljs-string"><span class="hljs-string">"web"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Server.Kestrel"</span></span> }, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"EntityFramework.Sqlite"</span></span>: <span class="hljs-string"><span class="hljs-string">"7.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExtCore.Data"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-alpha7"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExtCore.Data.Abstractions"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-alpha7"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExtCore.Data.EntityFramework.Sqlite"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-alpha7"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExtCore.Data.Models.Abstractions"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-alpha7"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExtCore.Infrastructure"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-alpha7"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExtCore.WebApplication"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-alpha7"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Diagnostics"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Diagnostics.Entity"</span></span>: <span class="hljs-string"><span class="hljs-string">"7.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Mvc"</span></span>: <span class="hljs-string"><span class="hljs-string">"6.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Mvc.TagHelpers"</span></span>: <span class="hljs-string"><span class="hljs-string">"6.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Server.Kestrel"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.Extensions.Configuration.Abstractions"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.Extensions.Configuration.Json"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.VisualStudio.Web.BrowserLink.Loader"</span></span>: <span class="hljs-string"><span class="hljs-string">"14.0.0-rc1-final"</span></span> }, <span class="hljs-string"><span class="hljs-string">"exclude"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"wwwroot"</span></span> ], <span class="hljs-string"><span class="hljs-string">"frameworks"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dnx451"</span></span>: { }, <span class="hljs-string"><span class="hljs-string">"dnxcore50"</span></span>: { } }, <span class="hljs-string"><span class="hljs-string">"publishExclude"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"**.user"</span></span>, <span class="hljs-string"><span class="hljs-string">"**.vspscc"</span></span> ], <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-*"</span></span>, <span class="hljs-string"><span class="hljs-string">"webroot"</span></span>: <span class="hljs-string"><span class="hljs-string">"wwwroot"</span></span> }</code> </pre> <br>  Now it only remains to inherit the Startup class from ExtCore.WebApplication.Startup: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> : <span class="hljs-title"><span class="hljs-title">ExtCore</span></span>.<span class="hljs-title"><span class="hljs-title">WebApplication</span></span>.<span class="hljs-title"><span class="hljs-title">Startup</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IHostingEnvironment hostingEnvironment, IApplicationEnvironment applicationEnvironment, IAssemblyLoaderContainer assemblyLoaderContainer, IAssemblyLoadContextAccessor assemblyLoadContextAccessor, ILibraryManager libraryManager</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">hostingEnvironment, applicationEnvironment, assemblyLoaderContainer, assemblyLoadContextAccessor, libraryManager</span></span></span><span class="hljs-function">)</span></span> { IConfigurationBuilder configurationBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"config.json"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.configurationRoot = configurationBuilder.Build(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.ConfigureServices(services); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder applicationBuilder, IHostingEnvironment hostingEnvironment</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hostingEnvironment.IsEnvironment(<span class="hljs-string"><span class="hljs-string">"Development"</span></span>)) { applicationBuilder.UseBrowserLink(); applicationBuilder.UseDeveloperExceptionPage(); applicationBuilder.UseDatabaseErrorPage(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { applicationBuilder.UseExceptionHandler(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Configure(applicationBuilder, hostingEnvironment); } }</code> </pre><br>  In the Startup class constructor, we initialize the configurationRoot variable defined in the ExtCore.WebApplication.Startup base class.  This is necessary to provide the ExtCore framework with access to configuration parameters (in our case, the only source of configuration parameters is the config.json file).  For example, the ExtCore.Data extension thus gets the Data: DefaultConnection: ConnectionString parameter (a database connection string).  You can also configure other extensions (including your own). <br><br>  Let's create a config.json file in the project root: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"Data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"DefaultConnection"</span></span>: { <span class="hljs-string"><span class="hljs-string">"ConnectionString"</span></span>: <span class="hljs-string"><span class="hljs-string">"Data Source=../db.sqlite"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"Extensions"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Path"</span></span>: <span class="hljs-string"><span class="hljs-string">"artifacts\\bin\\Extensions"</span></span> } }</code> </pre><br>  The Extensions: Path parameter defines the path that the folder with extensions (relative to the application root) is located in the file system. <br><br>  That's all, at this moment we can build and run our application.  We will get a 404 error and this will be correct, since we do not yet have routes or controllers. <br><br><h3>  Extensions </h3><br>  Now let's create 2 extensions.  The first extension (ExtensionA) on its only page (the main page of our application) will simply display a list of all available extensions.  We will also test the use of static content in the form of resources on the example of a CSS file.  The second extension (ExtensionB) will display the records described by the model from the database.  It's simple. <br><br><h4>  ExtensionA Extension </h4><br>  Create another WebApplication.ExtensionA project (note that this time it is a class library): <br><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/5e0/4d8/e37/5e04d8e37a0449f49d6489d70ecffa35.png"></div><br>  To conveniently separate projects in a solution related to various extensions, move our project to the solution folder with the name ExtensionA, after creating it. <br>  First of all, let's edit project.json again.  Add a link to ExtCore.Infrastructure (contains a description of the IExtension interface; in addition, ExtCore loads and uses only those assemblies that have a link to this package) and to Microsoft.AspNet.Mvc.  In this extension, we will use the view and the CSS file added as resources (I described this in more detail in the previous article referenced above), so you must also add the appropriate entry.  This is what should work: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"ExtCore.Infrastructure"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-alpha7"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Mvc"</span></span>: <span class="hljs-string"><span class="hljs-string">"6.0.0-rc1-final"</span></span> }, <span class="hljs-string"><span class="hljs-string">"frameworks"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dnx451"</span></span>: { }, <span class="hljs-string"><span class="hljs-string">"dnxcore50"</span></span>: { } }, <span class="hljs-string"><span class="hljs-string">"resource"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Styles/**"</span></span>, <span class="hljs-string"><span class="hljs-string">"Views/**"</span></span> ], <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-*"</span></span> }</code> </pre><br>  Next, we implement the IExtension interface: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExtensionA</span></span> : <span class="hljs-title"><span class="hljs-title">IExtension</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IConfigurationRoot configurationRoot; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Extension A"</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetConfigurationRoot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationRoot configurationRoot</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.configurationRoot = configurationRoot; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder applicationBuilder</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterRoutes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IRouteBuilder routeBuilder</span></span></span><span class="hljs-function">)</span></span> { routeBuilder.MapRoute(name: <span class="hljs-string"><span class="hljs-string">"Extension A"</span></span>, template: <span class="hljs-string"><span class="hljs-string">""</span></span>, defaults: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { controller = <span class="hljs-string"><span class="hljs-string">"ExtensionA"</span></span>, action = <span class="hljs-string"><span class="hljs-string">"Index"</span></span> }); } }</code> </pre><br>  In the RegisterRoutes method, we add a route for the main page of our application. <br>  Now we will add a controller with a single Index method, which will transmit to the view a set of names of all extensions loaded by ExtCore, for which the ExtensionManager class is used: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExtensionAController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.View(ExtensionManager.Extensions.Select(e =&gt; e.Name)); } }</code> </pre><br>  In turn, the view displays this set as follows: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in this.Model) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>@item<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The last thing to do is add the typography.css style file to the Styles folder.  Above, in the project.json file, we indicated that the entire contents of the Styles and Views folders will be added to the assembly as resources.  ExtCore will detect these resources and make it possible to use them in a manner similar to the use of physical files.  That is, we will be able to include our CSS file in any extension in this way: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Styles.typography.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  It should only be borne in mind that the tree structure of the file system is transformed into a "flat" structure of text names (the register matters!). <br><br>  Our extension ExtensionA is ready.  To test it, it is enough to either add a link to it in the project.json of the main application, or compile it as a dll file and copy it to the folder with extensions (we previously specified it in config.json). <br><br><h4>  ExtensionB </h4><br>  Here we need as many as 4 new projects: WebApplication.ExtensionB, WebApplication.ExtensionB.Data.Abstractions, WebApplication.ExtensionB.Data.EntityFramework.Sqlite and WebApplication.ExtensionB.Data.Models.  As in the first extension, group them in the solution folder (called ExtensionB). <br><br>  <b>WebApplication.ExtensionB</b> <br>  In this project we will post the implementation of the IExtension interface, the controller, the view models and the views. <br>  The implementation of the IExtension interface is similar to that of the previous extension.  Let's go straight to the controller: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExtensionBController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IStorage storage; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtensionBController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStorage storage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.storage = storage; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.View(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndexViewModelBuilder().Build(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.storage.GetRepository&lt;IItemRepository&gt;().All())); } }</code> </pre><br>  Since in this extension we need to get some records from the database, we will use the ExtCore.Data extension features for this.  In the controller's constructor, we will request the available implementation of the IStorage interface (which was previously detected and registered by the ExtCore.Data extension) from the ASP.NET DI built-in.  Next, we will already request our own implementation of our own IItemRepository interface for a specific storage (in our case, this is a SQLite database) and call the All method to get all the records.  Next, convert the models from the database to the view models for display in the view. <br>  Instead of using representations as resources, in this extension we will use precompiled representations.  To do this, add the RazorPreCompilation class to the / Compiler / PreProcess folder: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RazorPreCompilation</span></span> : <span class="hljs-title"><span class="hljs-title">RazorPreCompileModule</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnablePreCompilation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BeforeCompileContext context</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>  This will give us the opportunity to use our own (that is, declared inside our extension) classes for species models.  (For more on precompiled views, see the previous article.) <br>  <b>WebApplication.</b>  <b>ExtensionB.</b>  <b>Data.</b>  <b>Abstractions</b> <br>  This project contains a single repository interface for working with models of the Item type (see below): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IItemRepository</span></span> : <span class="hljs-title"><span class="hljs-title">IRepository</span></span> { <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Item&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">All</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br>  In our example, the interface describes only one method to get all the records. <br>  <b>WebApplication.</b>  <b>ExtensionB.</b>  <b>Data.</b>  <b>EntityFramework.</b>  <b>Sqlite</b> <br>  In this project, we will implement the IItemRepository interface for a specific repository ‚Äî the SQLite database: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ItemRepository</span></span> : <span class="hljs-title"><span class="hljs-title">RepositoryBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Item</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IItemRepository</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;Item&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">All</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dbSet.OrderBy(i =&gt; i.Name); } }</code> </pre><br>  Since the extension does not work directly with a specific implementation, but uses only abstractions, we can simultaneously support several types of storages and add new ones without having to change the code of the extension itself. <br>  Also, registration of the models used in the extension and storage settings takes place here.  To do this, use a class that implements the interface IModelRegistrar: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ModelRegistrar</span></span> : <span class="hljs-title"><span class="hljs-title">IModelRegistrar</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterModels</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModelBuilder modelbuilder</span></span></span><span class="hljs-function">)</span></span> { modelbuilder.Entity&lt;Item&gt;(etb =&gt; { etb.HasKey(e =&gt; e.Id); etb.Property(e =&gt; e.Id); etb.ForSqliteToTable(<span class="hljs-string"><span class="hljs-string">"Items"</span></span>); } ); } }</code> </pre><br>  <b>WebApplication.ExtensionB.Data.Models</b> <br>  In this project, we describe our only model - Item: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Item</span></span> : <span class="hljs-title"><span class="hljs-title">IEntity</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  Each model must implement the ExtCore.Data.Models.Abstractions.IEntity interface. <br>  Let's test the work of our new extension exactly as we did with ExtensionA. <br><br><h3>  Running and testing </h3><br>  Our application with two extensions is ready.  Running it, we should see something like this: <br><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/127/959/b1f/127959b1f688447a89ad5bc0b5e87afd.png"></div><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/221/9d3/5b1/2219d35b1a614d11928ac475fbde58ab.png"></div><br><h3>  findings </h3><br>  At the moment, we (I and a few interested guys) are actively developing this project and several others are already based on it.  We will be very happy ideas, advice and criticism.  Thank! <br><br>  Link to sources: <a href="https://github.com/ExtCore/ExtCore-Sample">https://github.com/ExtCore/ExtCore-Sample</a> . <br><br><h3>  To authors </h3><br>  Friends, if you are interested in supporting the column with your own material, please write to me at <a href="">vyunev@microsoft.com</a> to discuss all the details.  We are looking for authors who can interestingly tell about ASP.NET and other topics. <br><br><img align="right" width="250" src="https://habrastorage.org/files/afc/bc1/126/afcbc1126db747c8977cf60207b9c6fa.jpg"><h3>  about the author </h3><br>  <b>Sikorsky Dmitry Alexandrovich</b> <br>  Jubreynians Company ( <a href="http://ubrainians.com/">http://ubrainians.com/</a> ) <br>  Owner, Head <br>  <a href="https://habrahabr.ru/users/dmitrysikorsky/" class="user_link">DmitrySikorsky</a> </div><p>Source: <a href="https://habr.com/ru/post/279985/">https://habr.com/ru/post/279985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279973/index.html">We are friends with Scala and Android using Macroid</a></li>
<li><a href="../279975/index.html">A look into the future: on the road to digital communism</a></li>
<li><a href="../279977/index.html">Development of service for downloading albums</a></li>
<li><a href="../279979/index.html">Five steps to optimize the performance of the application for Android</a></li>
<li><a href="../279983/index.html">IBM will help eliminate the effects of cyber attacks</a></li>
<li><a href="../279987/index.html">How to become a leader in the ranking of Gartner</a></li>
<li><a href="../279989/index.html">NetApp MetroCluster (MCC)</a></li>
<li><a href="../279991/index.html">Mobius Announcement 2016: Mobile Development Conference</a></li>
<li><a href="../279995/index.html">Your main desktop environment in linux for 2016 is NOT READING servers</a></li>
<li><a href="../279997/index.html">I decided to write my own language of hardware synthesis, for Minecraft and what came of it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>