<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL Server in Microsoft Azure Cloud: PaaS vs IaaS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The path to hosting a SQL Server in any cloud, be it Microsoft or another, must begin with careful planning. Architectural decisions made at an early ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL Server in Microsoft Azure Cloud: PaaS vs IaaS</h1><div class="post__text post__text-html js-mediator-article"> The path to hosting a SQL Server in any cloud, be it Microsoft or another, must begin with careful planning.  Architectural decisions made at an early stage of a project may in a completely unexpected way affect the future of a project, and this may not always be obvious-solvable problems.  Planning also includes deciding whether the SQL Server should be placed in the IaaS model (virtual machine) or in the PaaS model (as SQL Azure DB).  The difference between the models lies in both the technological plan and the price, for example the levels of service agreements (SLA) of both models, the influence of latency both at an early stage, and at the stage of project publication, automation and much more. <br><br>  In this article, we will try to understand not only what technological differences exist between IaaS and PaaS in Microsoft Azure, but also about where such a difference can arise, where problems can arise in PaaS, which can be not met in IaaS, and architecture these solutions, and what Azure SQL DB Premium is and when to use it. <br><a name="habracut"></a><br>  <b>Table of contents:</b> <br>  Choose between IaaS and Azure SQL DB <br>  IaaS Way: general description and architecture <br>  PaaS Way: general description, architecture and possible problems <br>  PaaS Way: Security <br>  Azure SQL DB SLA - what's the difference from a SQL Server SLA in a virtual machine? <br>  PaaS Way: High Availabiliy <br>  How to choose Azure SQL DB usage mode?  Premium level - guaranteed high performance of SQL Server as a service <br><br>  <b>Choose between</b> <b>IaaS</b> <b>and</b> <b>Azure</b> <b>SQL</b> <b>DB</b> <b>(</b> <b>PaaS</b> <b>)</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In any data management solution using the SQL Server platform, there are three options for hosting this platform: <br>  Locally, in its own infrastructure <br>  On the Azure virtual machine (IaaS) <br>  As a service (Azure SQL DB) <br><br>  Placement of a local subject is not considered, since it is circumvented up and down.  Considering the other two options, we will start right away from the decision tree, after which we will begin to delve into the details. <br><img src="https://habrastorage.org/getpro/habr/post_images/4e5/9eb/ee8/4e59ebee82ae70d8fb244b38c9eebd11.png"><br><br>  The first step depends on whether a completely new solution is being developed or an existing one is being migrated.  As is often said, it is easier to rewrite it rather than deal with the migration of an existing one, and here it can be the first architectural solution.  If we have a new project, and it does not yet have a backend on data management, then we can immediately go in the direction of PaaS - this approach will allow us to save a lot of time for managing and deploying infrastructure. <br><br>  In the case of migration, there is a fork in front of us - since Azure SQL DB in terms of functionality is very different from a full-fledged SQL Server, we need to analyze our code base and database and see if the changes are necessary and how critical they are.  This is a very important fork - if we miss a data type that is not supported by Azure SQL DB, then we will lose a lot of time and effort.  With databases, <a href="http://sqlazuremw.codeplex.com/"><u></u></a><u><a href="http://sqlazuremw.codeplex.com/">sqlazuremw.codeplex.com</a></u> can help <a href="http://sqlazuremw.codeplex.com/"><u></u></a><u><a href="http://sqlazuremw.codeplex.com/">us</a></u> , which can analyze the database and say that it is not supported from it in Azure SQL DB.  And, if at this step there is a need to make major changes to our solution, or there will be functionality that is not supported in Azure SQL DB, but we need it, then the decision tree is broken and we need to use a local SQL Server or install it on a virtual machine (IaaS). <br><br>  If we are developing a new solution or have the opportunity to make non-critical changes to the project being migrated, then the next question we face is the limit on the size of the database in Azure SQL DB, which is 500 GB.  Is this enough for us?  What will be the projected growth?  If we understand that we do not break through this ceiling, then we can safely use Azure SQL DB.  If we understand that someday there may be a situation in which we will have 501 GB, proceed to the next step. <br><br>  Is it possible to redesign the architecture or implement sharding on its own?  There are situations and projects when this can not be done - for various reasons, from legacy-code to problems with time.  Azure SQL DB does not have a built-in sharding mechanism, so its implementation falls on the client‚Äôs shoulders.  If we are ready to take on this, then nothing prevents us from using Azure SQL DB.  If not, we are again logging on to SQL Server on a virtual machine or locally. <br><br>  Let's look at the differences and architecture of both solutions. <br><br>  <b>IaaS way</b> <br><br>  The method of placing a SQL Server in a virtual machine is not fundamentally different from installing it locally, but the devil is in the small things and the small things related to a complex discipline - optimization.  Thesis: <br><br>  On a virtual machine, we can put a <b>full-fledged SQL Server</b> .  The word "full" is important here, since there are functional differences between SQL Server and Azure SQL DB, despite common parents; <br>  <b>The</b> virtual machine <b>image</b> <b>lies on</b> <b>Microsoft</b> <b>Azure</b> <b>Storage</b> , which imposes optimization constraints - in order to improve disk performance, you need, for example, to merge them into a raid.  A virtual machine in Microsoft Azure does not have disks by default, which can be combined into a raid - when it is created, it receives two disks, and one disk (D :) is temporary, as it is located on the server disk on which the machine is currently running, and the second (C :) is placed as a blob on Microsoft Azure Storage, and all I / O requests go through the caching layer.  For this reason, C: performance will always be less than D :, but D: will be cleared during every system operation on the virtual machine (due to transfer to other physical resources).  To create a raid, you need to create and connect empty data disks (on the portal, Powershell and many more) to the machine. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/63b/0b1/525/63b0b1525182fdfdfa6c177a8984276c.png"><br><br>  In Microsoft Azure, <b>ready-made optimized images of</b> <b>SQL</b> <b>Server</b> (2008 R2 - 2014) are already available, which can be used with both a separately paid license and having brought your license (under License Mobility &amp; Software Assurance). <br>  <b>Standardized iron.</b>  In any cloud, you get standardized equipment, and you need to understand that it most often does not have a highly tuned performance. <br><br>  <b>PaaS way</b> <br><br>  The paaS approach is strikingly different from IaaS by the presence of a larger number of developer abstractions from infrastructure, constraints, and architectural delights.  At the very bottom, at the level of infrastructure and equipment, this is, of course, the same standardized equipment, so if you use the Shared-mode of Azure SQL DB, then in the presence of disturbed neighbors, performance can subside in a completely unexpected way.  There is also a set of Soft / Hard restrictions, which is done with an understandable purpose - if we administer the SQL Server on the virtual machine, and we deal with performance and architecture problems, in general, again, then PaaS is fully managed by the vendor, and you need to do so so that the solution is highly scalable and fault tolerant, and restless users with a high seasonal load do not put anything infrastructural. <br><br>  At the same time, as mentioned above, sharding and other solutions must be made by the developer - there are no embedded tools in Azure SQL DB yet. <br><br>  In order to better understand what Azure SQL DB is and how it works, consider its architecture. <br><br>  The first thing you need to understand is that when we create an Azure SQL DB server, in fact, there are three servers that, in general, are not servers at all - these are replicas, the request from the client to which passes through the TDS entry point.  If we compare it with a traditional solution, then in the case of its IP server we lead to the server, in the case of Azure SQL DB - IP leads to the infrastructure. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/685/2de/7fc/6852de7fc2e0ff5b88da2a1ff2c4f467.png"><br><br>  The request is sent via TDS to the service layer.  The service layer is the gateway between the client and the platform layer, and here are the high-level services provided by our Azure SQL DB ‚Äî deploying resources, billing consumed resources, query routers, and more. <br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/917/88a/5ee/91788a5ee175934794f4d75407789dd4.png"><br><br>  Next, the query is routed to the platform layer on which the infrastructure services are running ‚Äî something that provides the immediate functionality of SQL Server as a service.  This is the last layer of abstraction above the infrastructure, below - only the equipment. <br>  As you can see from the picture, the architecture of the Azure SQL DB solution is much more complicated than hosting a SQL Server in a virtual machine.  Load balancing and replication also work on each layer, and it all works automatically without human intervention. <br>  With this architecture, the approach to solving problems arises in some way from what we are used to.  There are fewer tools for diagnostics; therefore, it is important to understand why a particular problem occurs.  If we talk about the most common problems, the causes of their occurrence can be placed on the layers of Azure SQL DB.  The first level of problems arises already at the level of TDS communications.  Here we have a greater latency than it is in local deployment, and various kinds of fluctuations - mostly occurring even before entering the Azure SQL DB infrastructure, that is, on the network backbones that are not related to Microsoft.  This point is important, since the request can return with a timeout, and this needs to be covered by the development and planning of the retry logic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/047/8cb/e44/0478cbe44bdce76c45f55bdbf46db0ba.png"><br><br>  When the request has already arrived at the infrastructure, it is checked by internal means, and the login passes through one gateway along with other requests for this equipment.  A connection opens further, however, a timeout may also occur here if the operation is not performed on time - and this should also be decided by the retry logic. <br>  While Azure SQL DB is running, there is a constant likelihood of problems at the platform layer level - just here all the limitations imposed by the vendor on Azure SQL DB are valid, and, if they are exceeded, the corresponding error will be returned to the client.  We cannot do anything here, the only option is to handle these errors on the client side (the list of errors is <a href="http://msdn.microsoft.com/en-us/library/ff394106.aspx"><u></u></a><u><a href="http://msdn.microsoft.com/en-us/library/ff394106.aspx">msdn.microsoft.com/en-us/library/ff394106.aspx</a></u> ). <br>  Summarizing the use of Azure SQL DB, we need to understand and handle the following situations: <br><br>  <b>The client should not be far</b> from Azure SQL DB in terms of geography.  If the client is located with us locally, we must understand that we will have constant fluctuations of the network backbones, and implement the appropriate handling of these fluctuations and situations with the occurrence of timeout errors.  A good option seems to be placing the client in the cloud as close to Azure SQL DB as possible. <br>  In Azure SQL DB there are <b>restrictions</b> that are not just introduced.  If we want to work comfortably, we should not take as much as they give, but take as much as we need, and take into account that the connection pool is not rubber. <br>  <b>Features multi-tenancy.</b>  Nowhere will they give us performance guarantees, where resources are shared between customers.  Here, in the case of Azure SQL DB, a Premium mode occurs in which we are given reserved resources that we can freely use and be sure that no one will take them away if they are left unused. <br><br>  We looked at how the architecture of our PaaS solution differs from the IaaS solution.  As already mentioned, the PaaS architecture is more technologically sophisticated, since the client should be provided with fault tolerance, rapid deployment and much more in automatic mode, and at the same time it should be provided for a large number of clients.  However, with the increasing complexity of the architecture, there are also more complex troubleshooting problems, limitations and differences with standard SQL Server. <br>  Let's now look at another important aspect - the security of Azure SQL DB.  About security of virtual machines, and, therefore, SQL Server in them, it is written here: <a href="http://blogs.msdn.com/b/albe/archive/2014/04/21/azure.aspx"><u></u></a><u><a href="http://blogs.msdn.com/b/albe/archive/2014/04/21/azure.aspx">blogs.msdn.com/b/albe/archive/2014/04/21/azure.aspx</a></u> <br><br>  <b>PaaS</b> <b>Way</b> <b>: Security</b> <br><br>  Azure SQL DB has a set of differences from the local SQL Server, and the most significant ones concern security issues.  Given the implementation features of any software product that is provided as a service (that is, in fact, provides a serious level of abstraction from a large number of infrastructure tasks), it is necessary to clearly understand how SQL Azure works in order to have an idea of ‚Äã‚Äãwhy this or that functionality can not yet supported. <br><br>  As already written, SQL Azure Databases uses the standard SQL Server Tabular Data Stream (TDS) protocol, but only encrypted communications are allowed.  In SQL Server 2008, a new tool was introduced: transparent data encryption (TDE), which allows you to fully encrypt data with minimal effort.  However, at the moment, SQL Azure Databases does not support encryption at the database level.  It should be noted that currently Azure SQL DB is available only through TCP connections and only through port 1433. Therefore, you need to consider the ADO.NET encryption capabilities and certificates.  And, for example, the properties of the connection Encrypt = True and TrustServerCertificate = False will protect the transmitted data and help prevent man-in-the-middle attacks.  The second means of protecting Azure SQL DB, and, in general, the main one is the Azure SQL DB firewall, which initially blocks all access to the server.  Attempts to connect to the appropriate settings will fail.  To get started with the Azure SQL DB server, you need to log in to the Azure SQL DB portal and define the firewall settings for accessing your server.  Azure SQL Firewall can be managed through the Azure SQL DB portal or directly in the main database using stored procedures such as sp_set_firewall_rule and sp_delete_firewall_rule. <br><br>  As with any SQL Server implementation, managing user accounts is another aspect that needs to be tightly controlled. <br>  There is a list of differences between SQL Server and SQL Azure Databases in the security context: <br>  Microsoft SQL Server supports Windows Integrated authentication using access parameters from Active Directory;  SQL Azure Databases only supports SQL Server Authentication. <br>  Microsoft SQL Server and SQL Azure Databases use the same authorization model based on users and the roles created in each database and associated with user logins. <br>  Microsoft SQL Server has standard server-level roles such as serveradmin, securityadmin and dbcreator.  There are no such roles in SQL Azure Databases.  Instead, SQL Azure Databases has the role of loginmanager (creating logins) and dbmanager (creating and managing databases).  These roles can be associated with users in the master database. <br>  Access to SQL Server and Azure SQL DB is via the Tabular Data Stream (TDS) application-level protocol, which is protected by SSL, via TCP / 1433.  Using SSL is optional for Microsoft SQL Server and optional for Azure SQL DB. <br>  In SQL Server, IP-based access control must be performed at the host or network level using firewalls.  Azure SQL DB has a built-in firewall that restricts all access to the Azure SQL DB server until the clients of the computers that have access rights are defined.  The firewall gives access based on the IP address of each request. <br>  SQL Server provides real-time encryption of all stored data at the page level using the functionality of Transparent Data Encryption (TDE).  TDE is <b>not supported</b> in Azure SQL DB. <br>  Azure SQL DB has built-in DDOS protection.  There is none in SQL Server. <br>  Azure SQL DB is automatically patched and updated <b>without</b> downtime.  SQL Server needs to be updated, and this can lead to downtime. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/52f/c68/d7e/52fc68d7e7eaf4a1aaef853cdfb4dffc.png"><br><br>  So, there are differences in security, and they should be foreseen.  Sometimes a blocker is the absence of TDE, sometimes it is not as such - it all depends on the decision.  And the next block I propose to look at the differences in SLA. <br><br>  <b>Azure SQL DB SLA - what's the difference from a SQL Server SLA in a virtual machine?</b> <br><br>  SLA is an indispensable part of any commercial deployment.  Azure SQL DB SLA is more granular than a SQL Server SLA on a virtual machine, from the standpoint that the SLA is provided directly to the Azure SQL DB service, and not to the underlying infrastructure and virtual machine (but not SQL Server) in the case of IaaS.  This is fundamentally important.  The SLA on Azure SQL DB is 99.9%, which means 10 hours of downtime per calendar year, which are spent on servicing the service.  About customer service warn in advance. <br><br>  <b>PaaS Way:</b> <b>High</b> <b>Availability</b> <br><br>  Azure SQL DB is initially laid out under High Availability, and all components of the architecture are fault tolerant.  It is important to understand that the standard for SQL Servr concept of HA to Azure SQL DB is not applicable (again due to architectural differences).  Inside Azure SQL DB, there are mechanisms that replicate all the records in three replicas across different servers, which ensures 99.9% SLA.  In this case, one replica is primary ‚Äî a write operation is performed on it and, if it is confirmed, everything is replicated synchronously to secondary replicas. <br><br>  If we want to replicate Azure SQL DB on our own, no one bothers to do this with, for example, Data Sync. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0b/a16/105/c0ba161052f48cd89fe5622da5aa8639.png"><br><br><br>  <b>How to choose Azure SQL DB mode?</b> <br><br>  Starting from April 2014, Azure SQL DB modes of operation are changing - the old Web / Business modes are canceled, the main focus of which was concentrated around the database size, while the new Basic / Standard / Premium modes are focused entirely on performance guarantees.  The figure shows a simple decision tree on which of the new modes in which conditions to use.  It is necessary, however, to understand that, despite the provision of a certain level of performance with Basic / Standard modes, the Premium mode differs in elevated values ‚Äã‚Äãof all indicators - starting from the fact that the base in the Premium mode can be up to 500 GB and ending with the fact that the iron resources are much more than in Basic / Standard, therefore, if you plan to deploy a solution in Azure SQL DB that is very resource intensive and, above all, to peaks of use, using the Premium mode is much more preferable. <br><br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/884/08c/493/88408c493804352a74986ec6334ed73a.png"><br><br>  Separate consideration requires Premium mode.  ,    ,  ,      .  ,    ,     Azure SQL Database <a href="http://msdn.microsoft.com/ru-ru/library/azure/dn741336"><u>Benchmark</u></a> <br> (  ,     OLTP.          Azure SQL DB Benchmark   Database Throughput Units (DTU). DTU         CPU,    R/W.  ,  DTU     ,   .  Azure SQL DB Benchmark   Transaction Rate,       ,         (basic ‚Äî  , standard ‚Äî  ,  premium        ),  ,     . <br>        Premium. ,     Basic,   1 DTU, Premium  P3  800 DTU,  ,  ,    800 ,       . <br><br>      Azure SQL DB      ‚Äî <a href="http://msdn.microsoft.com/en-US/library/azure/dn741340.aspx"><u></u></a><u><a href="http://msdn.microsoft.com/en-US/library/azure/dn741340.aspx">msdn.microsoft.com/en-US/library/azure/dn741340.aspx</a></u> <br><br>  <b>Summary</b> <br><br> SQL Azure Databases ‚Äì SQL Server   PaaS.   ,   ,    SQL Server (       ,   ), SQLAD   ,            ,     ,              .  ,   (IaaS  PaaS)     , ,    ,   ,     . <br><br></div><p>Source: <a href="https://habr.com/ru/post/221219/">https://habr.com/ru/post/221219/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221203/index.html">Indikt - a new word in working with local data</a></li>
<li><a href="../221205/index.html">Digest KolibriOS # 4: and spring is not a hindrance</a></li>
<li><a href="../221209/index.html">Keyboards: separate, with even columns and half reversal</a></li>
<li><a href="../221213/index.html">Demo: Incremental Parser for Web IDE</a></li>
<li><a href="../221215/index.html">Inheritance of HTML files in xslt-style</a></li>
<li><a href="../221221/index.html">Hello MongoDB (open remote access)</a></li>
<li><a href="../221225/index.html">Personal experience: running and sleeping with medgadzhet Basis B1</a></li>
<li><a href="../221229/index.html">Spying Math: Punishment for Spyware</a></li>
<li><a href="../221231/index.html">Windows internals. The second volume is on sale!</a></li>
<li><a href="../221239/index.html">High-precision active controlled copy of the human body. The concept of prototyping an artificial mechanostat system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>