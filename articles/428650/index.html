<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Loyalty system or how to live for free</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, habrovchane. In connection with the big panic of the previous article I will present you the second version. It's all simple, without snot. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Loyalty system or how to live for free</h1><div class="post__text post__text-html js-mediator-article">  Good day, habrovchane.  In connection with the big panic of the <a href="https://habr.com/post/427905/">previous article I</a> will present you the second version.  It's all simple, without snot.  Loyalty system - one big hole.  After some experiments, we came to the conclusion that a large number of sites that use such a system are completely devoid of logic when trying to use it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ui/xn/hh/uixnhhmsliz0oh9fr970u0idhqo.jpeg" alt="image"></div><a name="habracut"></a><br>  Of course, someone could introduce at least a simple, but protection, and someone imagines the Internet in this form: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/43c/9b0/d71/43c9b0d712b4de1d0fb362e174efd55d.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, many hacker attacks occur almost in this form.  This is only in the movies they will show you a bunch of gadgets of the future, the functionality of which does not make sense in the present. <br><br>  Let's get down to business.  For example, I will take several systems where there may be a massive karzh. <br><br>  Let's start with <b>OBI</b> . <br><br>  I will say right away that for me it has been little studied.  Their vague rules about using bonuses put me in various doubts.  First, they have several bonus programs.  One of them can be paid only in three cities of Russia, on the other - in all.  At the same time, bonuses do not apply to all, but only up to 50% of the value of the goods.  But at half the price to build a house is already good. <br><br>  In general, OBI also has an application where you can log in our card and pay by generating a bar code. <br><br>  Go to the registration page with a faint touch of a magic wand: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6a/a7/8l/6aa78lj04dkguptu46ht6ulvpwq.png" alt="image"></div><br>  We get on the registration form is <s>not</s> our card: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cd/u7/h1/cdu7h1rl__q_jq1uclgvhlhvc4u.png" alt="image"></div><br>  Well, fill it.  By the way, here the system of calculating cards is the same as in the "Crossroads".  In order to be clearly stated - <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%259B%25D1%2583%25D0%25BD%25D0%25B0">Algorithm Moon</a> .  I filled all the data, indicated a random card number.  In the process through the sniffer caught the registration request. <br>  I repeated it several hundred times in a cycle.  There were no errors.  The site quite efficiently processed my requests and gave an answer in json: <br><br> <code><b>"data":{"registration":null},"errors":[{"message":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0438 \u0444\u043e\u0440\u043c\u044b.","type":"validation","locations":{"path":"\/work\/obiclub.ru\/app\/GraphQL\/Mutation\/Frontend\/RegistrationMutation.php","line":109},"safe":true,"validation":{"cardnum":["\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043a\u0430\u0440\u0442\u044b. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0441\u0442\u044c \u0432\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445."]}}]}</b></code> <br> <br>  The variable <b>cardnum</b> was the following text, which translated from <s>Greek</s> Unicode means - <br><blockquote>  ‚ÄúWrong card number.  Check the correctness of the entered data ¬ª </blockquote><br>  It is interesting that for all my requests from one IP there was no blocking.  Moreover, the session lives for a very long time.  Checked after a day - the answer was.  Could at least zero cookies, enter the captcha, and then a solid "feyspalm."  Write software is not difficult, only he will fall under <br>  <b>Uk</b>  <b>RF.</b>  <b>v.273</b> , and this is already dangerous! <br><br>  Well, the house we built.  It would be necessary to fill our car and ride around the city.  I could give an example here with the most popular gas stations, but in view of some considerations I will not do that.  The system is the same for everyone, but the approach to it is different, so I will demonstrate it at the simplest, little-known gas station. <br><br>  <b>AZS-ETALON.RU</b> .  Attracted my attention to what is in my city.  The principle of operation is similar - there is a loyalty card;  there is a site where we register the card;  There is an application through authorization in which you can pay at the checkout.  Well, it's funny at all. <br><br>  Moving to the card registration form - <u><a href="http://lk.azs-etalon.ru/registration.php">lk.azs-etalon.ru/registration.php</a></u> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vg/bb/8k/vgbb8kimxzermvyszygfiegun4o.png" alt="image"></div><br>  Fill in any data, click <s>"Hack",</s> "Register."  We get the answer <blockquote>  "Invalid card number" </blockquote>  This means that we will enter the next number on the account, and so on, until we find free fuel for our four-wheel friend. <br><br>  <i>- Automate?</i> <i><br></i>  <i>- izi.</i> <i><br></i> <br>  We catch the package for registration.  We get the following <br><br>  <b>HTTP HEADERS:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text">  Host: lk.azs-etalon.ru <br>  User-Agent: Mozilla / 5.0 (Windows NT 6.3; WOW64; rv: 41.0) Gecko / 20100101 Firefox / 41.0 <br>  Accept: * / * <br>  Accept-Language: ru-RU, ru; q = 0.8, en-US; q = 0.5, en; q = 0.3 <br>  Accept-Encoding: gzip, deflate <br>  Content-Type: application / x-www-form-urlencoded;  charset = UTF-8 <br>  X-Requested-With: XMLHttpRequest <br>  Referer: <a href="http://lk.azs-etalon.ru/registration.php">lk.azs-etalon.ru/registration.php</a> <br>  Content-Length: 174 <br>  Cookie: _ym_uid = 10265171001178589;  _ym_d = 1214095619;  _ym_visorc191282814 = w;  _ym_isad = 2;  PHPSESSID = u0vp19oks8iman1hi8m8j1n105 <br>  Connection: keep-alive <br>  Pragma: no-cache <br>  Cache-Control: no-cache <br>  If-Modified-Since: * <br></div></div><br>  <b>POST-DATA:</b> <br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text">  card = 1111-114-089-111 &amp; fio =% D0% 90% D0% 9E% D0% 92% D0% A0% D0% 90% D0% 9B% D0% 9E% D0% 92% D0% 90% D0% A0 % D0% BB% D0% BE% D1% 80 &amp; phone = 7 (912) 345-6789 &amp; date = 11.11.1990 &amp; sex = 1 &amp; pass = 123321q &amp; pass2 = 123321q <br></div></div><br>  We bring in a convenient type, we adjust under CURL, we hammer in a cycle and we put in a stream.  The site will issue: <blockquote>  "—ú¬µ–Ü¬µ–Ç‚Äπ ‚Ññ –Ö—ï—ò¬µ–Ç—î ¬∞ –Ç‚Äö ‚Äπ¬ª </blockquote>  that in <s>German</s> CP1251 - <blockquote>  "Invalid card number" </blockquote>  We set a condition for the appearance of another answer and find the <u>‚Äúbuzz‚Äù</u> .  The simplest brute is ready. <br><br>  There is no captcha, IP blocking for a large number of requests is not, there is not even a primary check for data entry by the client.  Oh, okay.  And so come down. <br><br>  Let's go through one more beast.  It is much larger than others, but still vulnerable. <br><br>  <b>Ribbon</b> ... Just - <b>TAPE</b> <br><br>  Go to the hetepes lk.lenta.com/authentication/login/activate-card: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/en/ic/us/enicusare9pi6rphyjtuhhe6ts8.png" alt="image"></div><br>  <i>We assume that it was a pre-valid, non-activated card.</i>  <i>We are asked to enter a phone number</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2a/9b8/7ea/e2a9b87ea13938442f7db4cd7ab99868.png" alt="image"><br><br>  Well, enter your mobile, then the rest of the data, including the password.  All we are in the dashboard. <br><br>  Here, as if everything is similar to the previous systems.  It is only important to catch the necessary requests, then repeat them in the right sequence. <br><br>  But empirically some bad vulnerabilities were found.  When you enter the wrong verification code - what was?  Nothing, we were not allowed in the LC.  This is logical guys. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ks/vc/l9/ksvcl9ysnyjeyyux69nc0q68f28.png" alt="image"></div><br>  But by experiment, the following was verified!  Requests to confirm the code were captured, in which all the parameters were in full view: <br><blockquote>  {"Code": "12345667890", "card": "800011999193", "phone": "91234567789"} </blockquote><br>  I will not chew on how I exploited this vulnerability, but I will say it briefly.  With it, you can simply omit the <b>code</b> and we will always get into the LC without confirming the number.  And this means that we can indicate any number! <br><br>  ( <i>With the support of the TAPE, I'm currently trying to contact</i> ) <br><br>  Why all this?  Let's summarize. <br><br>  There are a lot of loyalty services.  You can endlessly look for them and "brutal" points.  If I tell you, is it possible for these points to also fly a plane? <br><br>  <b>Aeroflot</b> and <b>S7</b> also have a bonus system.  Miles are points.  We can earn them from, for example, partners.  Aeroflot, by the way, has about 2 thousand of them.  Including, almost all top supermarkets, including our notorious X5 Retail Group.  You can redeem points for miles directly in the LC of the same ‚ÄúCrossroads‚Äù.  Well, and so almost all other services.  By the way, this fact of stealing miles from the airline is officially fixed.  A loud business, not without victims. <br><br>  In the end, everything is not as simple as it seems.  There are people who live off these points.  Well, if these balls formally belong to you, then someone is sitting on your neck.  Kulkhatskers can eat, dress, ride cars, fly through cities, and much more. <br><br>  PS: Thank you for already having several security officers from <u>‚ÄúX5‚Äù</u> contacted me.  With one, there was more discussion about <i>‚Äúwhose scores are customers or Crossroads after all‚Äù</i> than the issue of system security.  But, I think, they will fix everything, since the whole Security Council is already aware.  Quickly, then.  They should pay tribute.  The main thing is to fix it. <br><br>  Well, here's a poll. </div><p>Source: <a href="https://habr.com/ru/post/428650/">https://habr.com/ru/post/428650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428638/index.html">Hearts Fiery Motor: QardioCore Heart Monitor Review</a></li>
<li><a href="../428640/index.html">With a tube in your pocket: Snom DECT equipment for wireless telephone networks</a></li>
<li><a href="../428644/index.html">Low-level brainfuck</a></li>
<li><a href="../428646/index.html">Last year's iPhone models also slow down as the battery wears out.</a></li>
<li><a href="../428648/index.html">Anton Arkhipov about effective work with IntelliJ IDEA and TeamCity on jug.msk.ru</a></li>
<li><a href="../428652/index.html">MIT course "Computer Systems Security". Lecture 15: "Medical software", part 1</a></li>
<li><a href="../428654/index.html">MIT course "Computer Systems Security". Lecture 15: "Medical software", part 2</a></li>
<li><a href="../428656/index.html">MIT course "Computer Systems Security". Lecture 15: "Medical Software", part 3</a></li>
<li><a href="../428658/index.html">Free educational workshops at the Mail.Ru Group office</a></li>
<li><a href="../428660/index.html">Apply Extensible Pull Request Policies to VSTS to Support the Development Process</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>