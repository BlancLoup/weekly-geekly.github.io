<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CannyViewAnimator: switch states beautifully</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I really like working with animations - in every Android application, in the creation of which I participate or which I just look at, I would f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CannyViewAnimator: switch states beautifully</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  I really like working with animations - in every Android application, in the creation of which I participate or which I just look at, I would find a place for a couple.  In the not so distant April 2016, <a href="https://habrahabr.ru/company/livetyping/blog/274135/">with my record</a> about the type of classes, Animation started a Live Typing company blog, and later <a href="https://youtu.be/wcixaQoPxXM%3Flist%3DPLI8nOcpqDyPMttKBdig6rRLQO82ivfHE-">I gave a talk about animations</a> at the next Omsk IT subbotnik.  In this article I want to introduce you to our library CannyViewAnimator, as well as immerse you in the process of its development.  It is needed for a beautiful visibility switch View.  If you are interested in the library, or the history of its creation, or at least the problems that I encountered and their solutions are interesting, then welcome to the article! </p><br><h1>  What is it all about </h1><br><p>  But first, for clarity, we present a situation that is trivial in Android development.  You have a screen, and on it - a list that comes from the server.  While beautiful data is being loaded from a beautiful server, you are showing a loader;  as soon as the data has arrived, you look at them: if it is empty, you show a stub, if not, you are actually showing the data. <br>  How to resolve this situation on the UI?  Previously, we used the following solution in Live Taiping, which we had once seen in <a href="https://github.com/JakeWharton/u2020">U2020</a> , and then transferred to our <a href="https://github.com/LiveTyping/u2020-mvp">U2020 MVP</a> - this is <a href="">BetterViewAnimator</a> , View, which inherits from ViewAnimator.  The only, but important, difference between BetterViewAnimator and its ancestor is the ability to work with id resources.  But he is not perfect. </p><br><div class="spoiler">  <b class="spoiler_title">What is ViewAnimator?</b> <div class="spoiler_text"><p>  ViewAnimator is a View that inherits from FrameLayout and which only one of its child is visible at a particular time.  To switch the visible child there is a set of methods. </p></div></div><br><p>  An important disadvantage of BetterViewAnimator is the ability to work only with outdated AnimationFramework.  And in this situation CannyViewAnimator comes to the rescue.  It supports work with Animator and AppCompat Transition. <br>  <a href="https://github.com/LiveTyping/CannyViewAnimator">Link to the project in Github</a> </p><br><img src="https://habrastorage.org/files/d92/3b2/d7b/d923b2d7b7084a50b7321a65a764371c.png"><a name="habracut"></a><br><h1>  How it all began </h1><br><p>  During the development of the next screen ‚Äúlist-loader-stub‚Äù, I thought that we, of course, use BetterViewAnimator, but for some reason do not use it almost as the main feature - animations.  Optimistic, I decided to add animation and stumbled upon what I forgot: ViewAnimator can only work with Animation.  Unfortunately, the search for alternatives on Github did not succeed - there were no decent ones, but there was only the <a href="https://github.com/JA-VON/Android-View-Controller">Android View Controller</a> , but it is absolutely not flexible and only supports eight pre-defined animations in it.  This meant only one thing: you have to write everything yourself. </p><br><h1>  What I want to get </h1><br><p>  The first thing I decided to do is think through what I want to end up with: </p><br><ul><li>  the ability to still manage the visibility of the child; </li><li>  the ability to use Animator and especially CircularRevealAnimator; </li><li>  the ability to run animations both sequentially and in parallel (ViewAnimator can only sequentially); </li><li>  the ability to use Transition; </li><li>  make a set of standard animations with the possibility of exhibiting them through xml; </li><li>  flexibility of work, the ability to set up an animation for an individual child. </li></ul><br><p>  Having defined my desires, I began to think over the ‚Äúarchitecture‚Äù of the future project.  It turned out three parts: </p><br><ul><li>  <i>ViewAnimator</i> - responds to the visibility switch child; </li><li>  <i>TransitionViewAnimator</i> - inherits from ViewAnimator and is responsible for working with Transition; </li><li>  <i>CannyViewAnimator</i> is inherited from TransitionViewAnimator and is responsible for working with Animator. </li></ul><br><p>  I decided to set up Animators and Transition using an interface with two parameters: child, which will appear, and child, which will disappear.  Every time when the visible child changes, the necessary animation will be taken from the interface implementation.  Interface will be three: </p><br><ul><li>  <i>InAnimator</i> - responsible for the animator of the emerging child; </li><li>  <i>OutAnimator</i> - responsible for the animator of the disappearing child; </li><li>  <i>CannyTransition</i> - in charge of Transition. </li></ul><br><p>  I decided to make the interface for Transition alone, since the Transition is superimposed immediately on all appearing and disappearing child.  The concept was thought out, and I began to develop. </p><br><h1>  ViewAnimator </h1><br><p>  With my base class, I didn‚Äôt think too much and decided to make a carbon copy with the ViewAnimator from the SDK.  I just threw out of it work with Animation and optimized the methods in it, since many of them seemed redundant to me.  Also, I did not forget to add methods from BetterViewAnimator.  The final list of important methods for working with him was: </p><br><ul><li>  <i>void setDisplayedChildIndex (int inChildIndex)</i> - displays the child with the specified index; </li><li>  <i>void setDisplayedChildId (@IdRes int id)</i> - displays the child with the given id; </li><li>  <i>void setDisplayedChild (View view)</i> - displays a specific child; </li><li>  <i>int getDisplayedChildIndex ()</i> - getting the index of the child being displayed; </li><li>  <i>View getDisplayedChild ()</i> - getting the displayed child; </li><li>  <i>int getDisplayedChildId ()</i> - getting the id of the displayed child. </li></ul><br><p>  A little thought, I decided to additionally save the position of the current visible child in onSaveInstanceState () and restore it to onRestoreInstanceState (Parcelable state), immediately displaying it. <br>  The final code is: </p><br><div class="spoiler">  <b class="spoiler_title">ViewAnimator</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewAnimator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FrameLayout</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastWhichIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDisplayedChildIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inChildIndex)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inChildIndex &gt;= getChildCount()) { inChildIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inChildIndex &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { inChildIndex = getChildCount() - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> hasFocus = getFocusedChild() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> outChildIndex = lastWhichIndex; lastWhichIndex = inChildIndex; changeVisibility(getChildAt(inChildIndex), getChildAt(outChildIndex)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasFocus) { requestFocus(FOCUS_FORWARD); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDisplayedChildId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@IdRes </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getDisplayedChildId() == id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, count = getChildCount(); i &lt; count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getChildAt(i).getId() == id) { setDisplayedChildIndex(i); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"No view with ID "</span></span> + id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDisplayedChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ setDisplayedChildId(view.getId()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDisplayedChildIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lastWhichIndex; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDisplayedChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getChildAt(lastWhichIndex); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDisplayedChildId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getDisplayedChild().getId(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeVisibility</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ outChild.setVisibility(INVISIBLE); inChild.setVisibility(VISIBLE); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View child, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, ViewGroup.LayoutParams params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.addView(child, index, params); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getChildCount() == <span class="hljs-number"><span class="hljs-number">1</span></span>) { child.setVisibility(View.VISIBLE); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { child.setVisibility(View.INVISIBLE); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; lastWhichIndex &gt;= index) { setDisplayedChildIndex(lastWhichIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeAllViews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.removeAllViews(); lastWhichIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = indexOfChild(view); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { removeViewAt(index); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeViewAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.removeViewAt(index); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> childCount = getChildCount(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (childCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) { lastWhichIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastWhichIndex &gt;= childCount) { setDisplayedChildIndex(childCount - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastWhichIndex == index) { setDisplayedChildIndex(lastWhichIndex); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeViewInLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ removeView(view); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeViews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.removeViews(start, count); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getChildCount() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { lastWhichIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastWhichIndex &gt;= start &amp;&amp; lastWhichIndex &lt; start + count) { setDisplayedChildIndex(lastWhichIndex); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeViewsInLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span><span class="hljs-function"> </span></span>{ removeViews(start, count); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRestoreInstanceState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcelable state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(state <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> SavedState)) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onRestoreInstanceState(state); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } SavedState ss = (SavedState) state; <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onRestoreInstanceState(ss.getSuperState()); lastWhichIndex = ss.lastWhichIndex; setDisplayedChildIndex(lastWhichIndex); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Parcelable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSaveInstanceState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SavedState savedState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SavedState(<span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onSaveInstanceState()); savedState.lastWhichIndex = lastWhichIndex; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> savedState; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SavedState</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseSavedState</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastWhichIndex; SavedState(Parcelable superState) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(superState); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeToParcel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel dest, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flags)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.writeToParcel(dest, flags); dest.writeInt(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastWhichIndex); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"ViewAnimator.SavedState{"</span></span> + <span class="hljs-string"><span class="hljs-string">"lastWhichIndex="</span></span> + lastWhichIndex + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Parcelable.Creator&lt;SavedState&gt; CREATOR = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Parcelable.Creator&lt;SavedState&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SavedState </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFromParcel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel source)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SavedState(source); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SavedState[] newArray(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SavedState[size]; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavedState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel in)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(in); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastWhichIndex = in.readInt(); } } }</code> </pre> </div></div><br><p>  <a href="">Ssylochka on Github</a> </p><br><h1>  TransitionViewAnimator </h1><br><p>  Having finished with ViewAnimator, I proceeded to a rather simple, but no less interesting task: to make support for Transition.  The essence of the work is this: when you call the overridden changeVisibility method (View inChild, View outChild), an animation is prepared.  From the specified CannyTransition using the interface, Transition is taken and recorded in the class field. </p><br><div class="spoiler">  <b class="spoiler_title">CannyTransition</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CannyTransition</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Transition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span></span>; }</code> </pre> </div></div><br><p>  Then in a separate method runs this Transition.  I decided to make the launch a separate method with a foundation for the future - the fact is that Transition is launched using the <i>TransitionManager.beginDelayedTransition</i> method, and this imposes some restrictions.  After all, Transition will be executed only for those View, which have changed their properties for a certain period of time after calling <i>TransitionManager.beginDelayedTransition</i> .  Since in the future we plan to introduce Animators, which can last for a relatively long time, the <i>TransitionManager.beginDelayedTransition</i> should be called immediately before changing Visibility.  Well, and then I call <i>super.changeVisibility (inChild, outChild);</i>  which changes the visibility of the desired child. </p><br><div class="spoiler">  <b class="spoiler_title">TransitionViewAnimator</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TransitionViewAnimator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CannyTransition cannyTransition; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Transition transition; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TransitionViewAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TransitionViewAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeVisibility</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ prepareTransition(inChild, outChild); startTransition(); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.changeVisibility(inChild, outChild); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cannyTransition != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { transition = cannyTransition.getTransition(inChild, outChild); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transition != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { TransitionManager.beginDelayedTransition(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, transition); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCannyTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CannyTransition cannyTransition)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cannyTransition = cannyTransition; } }</code> </pre> </div></div><br><p>  <a href="">Github Link</a> </p><br><h1>  CannyViewAnimator </h1><br><p>  So I got to the main layer.  Initially, I wanted to use <a href="https://developer.android.com/reference/android/animation/LayoutTransition.html">LayoutTransition</a> to control Animators, but my dreams were broken about the impossibility of using animations in parallel without crutches.  Also, additional problems created the remaining drawbacks of LayoutTransition, such as the need to set the duration for AnimatorSet, the impossibility of manual interruption, etc. It was decided to write its own logic of work.  Everything looked very simple: we launch Animator for the disappearing child, expose it to <i>Visibility.GONE for it</i> and immediately make the child appear visible and launch Animator for it. </p><br><p>  Here I stumbled upon the first problem: <b>you can‚Äôt start Animator for a non-attached View</b> (this is one that hasn‚Äôt yet performed <i>onAttach</i> or has already <i>started onDetach</i> ).  This did not allow me to change the visibility of any child in the constructor or any other method that is triggered before onAttach.  Anticipating a bunch of different situations where it might be needed, and at least a small bunch of issues on Github, I decided to try to rectify the situation.  Unfortunately, the simplest solution in the form of a call to the <i>isAttachedToWindow ()</i> method rested on the impossibility of calling it up to version 19 of the API, and I really wanted to have support with 14 APIs. </p><br><p>  However, View has an OnAttachStateChangeListener, and I did not fail to use it.  I redefined the <i>void addView</i> method <i>(View child, int index, ViewGroup.LayoutParams params)</i> and hung up this Listener for each added View.  Next, I placed in HashMap a link to the View itself and a Boolean variable indicating its state.  If <i>onViewAttachedToWindow (View v)</i> worked, I set the value to true, and if <i>onViewDetachedFromWindow (View v)</i> , then false.  Now, just before the launch of Animator, I could check the status of the View and could decide whether to run Animator at all. </p><br><p>  After overcoming the first ‚Äúbarricade‚Äù, I made two interfaces for receiving Animators: InAnimator and OutAnimator. </p><br><div class="spoiler">  <b class="spoiler_title">InAnimator</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span></span>; }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Outanimator</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OutAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOutAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span></span>; }</code> </pre> </div></div><br><p>  Everything went smoothly until a new problem arose in front of me: <b>after doing Animator, I need to restore the View state</b> . </p><br><p>  I did not find the answer to StackOverflow.  After half an hour of brainstorming, I decided to use the ValueAnimator's reverse method, making its duration zero. </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animator <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ValueAnimator) { animator.addListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorListenerAdapter() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animation)</span></span></span><span class="hljs-function"> </span></span>{ animation.removeListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); animation.setDuration(<span class="hljs-number"><span class="hljs-number">0</span></span>); ((ValueAnimator) animation).reverse(); } }); }</code> </pre> <br><p>  This helped, and I even gave the same <a href="http://stackoverflow.com/a/37503154/5451527">answer to StackOverflow</a> . </p><br><p>  Immediately after solving this problem, another one arose: <b>CircularRevealAnimator does not perform its animation, if View has not yet performed onMeasure.</b> </p><br><p>  This was bad news, because ViewAnimator has an invisible child Visibility.GONE.  This means that they are not measured until the moment when they are given a different type of Visibility - VISIBLE or INVISIBLE.  Even if I had changed Visibility to INVISIBLE before starting the animation, it would not solve the problem.  Since the measurement of the dimensions of the View occurs when the frame is drawn, and the frame is drawn asynchronously, there is no guarantee that by the time Animator View was started, it would have been measured.  I was extremely reluctant to set the delay or use onPreDrawListener, so by default I decided to use Visibility.INVISIBLE instead of Visibility.GONE. </p><br><p>  My head was scrolling horror scenes based on how my views are measured at inflate (although they don‚Äôt need it at all), which is accompanied by visual lags.  Therefore, I decided to conduct a small test, measuring the time of the inflate, with Visibility.INVISIBLE and Visibility.GONE with 10 View and nesting 5. The tests showed that the difference did not exceed 1 millisecond.  Either I did not notice how the phones became much more powerful, or Android was so well optimized, but I vaguely recall that once the extra Visibility.INVISIBLE had a bad effect on performance.  Well, okay, the problem was defeated. </p><br><p>  Not having time to recover from the previous "fight", I rushed to the next.  <b>Since in the FrameLayout child lie on top of each other, when simultaneously performing InAnimator and OutAnimator, a situation arises when, depending on the child index, the animation looks different.</b> <br>  Because of all the problems that have arisen with the implementation of Animators, I wanted to quit them, but the feeling ‚Äúonce started - finish‚Äù made me move forward.  The problem occurs when I try to make the View visible, which lies below the currently displayed View.  Because of this, the disappearance animation completely overlaps the appearance animation and vice versa.  In search of a solution, I tried to use other ViewGroups, played with the Z property, and tried a whole lot more. </p><br><p>  Finally, the idea came at the beginning of the animation just to delete the desired View from the container, add it to the top, and at the end of the animation again, delete and then return to the original place.  The idea worked, but on weak devices the animation was jabbed.  The hangup was due to the fact that when you delete or add a View, it itself and its parent call <i>requestLayout ()</i> , which recounts and redraws them.  I had to climb into the jungle of the ViewGroup class.  After a few minutes of studying, I came to the conclusion that the order of the View inside the ViewGroup depends only on one array, and then the heirs of the ViewGroup (for example, FrameLayout or LinearLayout) already decide how to display it.  Alas, the array, as well as methods of working with it, were marked private.  But there was some good news: in Java, this is not a problem, since there is a Java Reflection.  Using Java Reflection, I used the methods of working with an array and now I could control the position of the View I needed directly.  The result is this method: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bringChildToPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View child, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = indexOfChild(child); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; position &gt;= getChildCount()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Method removeFromArray = ViewGroup.class.getDeclaredMethod(<span class="hljs-string"><span class="hljs-string">"removeFromArray"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.class); removeFromArray.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); removeFromArray.invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, index); Method addInArray = ViewGroup.class.getDeclaredMethod(<span class="hljs-string"><span class="hljs-string">"addInArray"</span></span>, View.class, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.class); addInArray.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); addInArray.invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, child, position); Field mParent = View.class.getDeclaredField(<span class="hljs-string"><span class="hljs-string">"mParent"</span></span>); mParent.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); mParent.set(child, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchMethodException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InvocationTargetException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IllegalAccessException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchFieldException e) { e.printStackTrace(); } }</code> </pre> <br><p>  This method sets the position I need for the View.  Redrawing at the end of these manipulations is not necessary - for you it will make animation.  Now, before starting the animation, I could put the View I needed up, and return it at the end of the animation.  So, the main part of the story about CannyViewAnimator is over. </p><br><div class="spoiler">  <b class="spoiler_title">CannyViewAnimator</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CannyViewAnimator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TransitionViewAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SEQUENTIALLY = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TOGETHER = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> animateType = SEQUENTIALLY; <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.SOURCE) <span class="hljs-meta"><span class="hljs-meta">@IntDef</span></span>({SEQUENTIALLY, TOGETHER}) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> AnimateType { } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> FOR_POSITION = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> IN_ALWAYS_TOP = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> OUT_ALWAYS_TOP = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> locationType = FOR_POSITION; <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.SOURCE) <span class="hljs-meta"><span class="hljs-meta">@IntDef</span></span>({FOR_POSITION, IN_ALWAYS_TOP, OUT_ALWAYS_TOP}) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> LocationType { } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;? extends InAnimator&gt; inAnimator; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;? extends OutAnimator&gt; outAnimator; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;View, Boolean&gt; attachedList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(getChildCount()); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CannyViewAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CannyViewAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs); } <span class="hljs-meta"><span class="hljs-meta">@SafeVarargs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> &lt;T extends InAnimator&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T... inAnimators)</span></span></span><span class="hljs-function"> </span></span>{ setInAnimator(Arrays.asList(inAnimators)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;? extends InAnimator&gt; inAnimators)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inAnimator = inAnimators; } <span class="hljs-meta"><span class="hljs-meta">@SafeVarargs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> &lt;T extends OutAnimator&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOutAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T... outAnimators)</span></span></span><span class="hljs-function"> </span></span>{ setOutAnimator(Arrays.asList(outAnimators)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOutAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;? extends OutAnimator&gt; outAnimators)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.outAnimator = outAnimators; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeVisibility</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (attachedList.get(outChild) &amp;&amp; attachedList.get(inChild)) { AnimatorSet animatorSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorSet(); Animator inAnimator = mergeInAnimators(inChild, outChild); Animator outAnimator = mergeOutAnimators(inChild, outChild); prepareTransition(inChild, outChild); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (animateType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SEQUENTIALLY: animatorSet.playSequentially(outAnimator, inAnimator); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TOGETHER: animatorSet.playTogether(outAnimator, inAnimator); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (locationType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> FOR_POSITION: addOnStartVisibleListener(inAnimator, inChild); addOnEndInvisibleListener(outAnimator, outChild); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IN_ALWAYS_TOP: addOnStartVisibleListener(inAnimator, inChild); addOnEndInvisibleListener(inAnimator, outChild); addOnStartToTopOnEndToInitPositionListener(inAnimator, inChild); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> OUT_ALWAYS_TOP: addOnStartVisibleListener(outAnimator, inChild); addOnEndInvisibleListener(outAnimator, outChild); addOnStartToTopOnEndToInitPositionListener(outAnimator, outChild); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } animatorSet.start(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.changeVisibility(inChild, outChild); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> AnimatorSet </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mergeInAnimators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View inChild, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View outChild)</span></span></span><span class="hljs-function"> </span></span>{ AnimatorSet animatorSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorSet(); List&lt;Animator&gt; animators = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(inAnimator.size()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (InAnimator inAnimator : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inAnimator) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inAnimator != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Animator animator = inAnimator.getInAnimator(inChild, outChild); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animator != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { animators.add(animator); } } } animatorSet.playTogether(animators); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> animatorSet; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> AnimatorSet </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mergeOutAnimators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View inChild, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View outChild)</span></span></span><span class="hljs-function"> </span></span>{ AnimatorSet animatorSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorSet(); List&lt;Animator&gt; animators = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(outAnimator.size()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (OutAnimator outAnimator : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.outAnimator) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outAnimator != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Animator animator = outAnimator.getOutAnimator(inChild, outChild); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animator != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) animators.add(animator); } } animatorSet.playTogether(animators); addRestoreInitValuesListener(animatorSet); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> animatorSet; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRestoreInitValuesListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AnimatorSet animatorSet)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Animator animator : animatorSet.getChildAnimations()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animator <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ValueAnimator) { animator.addListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorListenerAdapter() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animation)</span></span></span><span class="hljs-function"> </span></span>{ animation.removeListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); animation.setDuration(<span class="hljs-number"><span class="hljs-number">0</span></span>); ((ValueAnimator) animation).reverse(); } }); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addOnStartVisibleListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animator, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View view)</span></span></span><span class="hljs-function"> </span></span>{ animator.addListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorListenerAdapter() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animation)</span></span></span><span class="hljs-function"> </span></span>{ startTransition(); view.setVisibility(VISIBLE); } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addOnEndInvisibleListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animator, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View view)</span></span></span><span class="hljs-function"> </span></span>{ animator.addListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorListenerAdapter() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animation)</span></span></span><span class="hljs-function"> </span></span>{ startTransition(); view.setVisibility(INVISIBLE); } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addOnStartToTopOnEndToInitPositionListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animator, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View view)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> initLocation = indexOfChild(view); animator.addListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorListenerAdapter() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animation)</span></span></span><span class="hljs-function"> </span></span>{ bringChildToPosition(view, getChildCount() - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animation)</span></span></span><span class="hljs-function"> </span></span>{ bringChildToPosition(view, initLocation); } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAnimateType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> animateType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAnimateType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@AnimateType </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animateType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.animateType = animateType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocationType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> locationType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocationType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@LocationType </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> locationType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.locationType = locationType; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View child, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, ViewGroup.LayoutParams params)</span></span></span><span class="hljs-function"> </span></span>{ attachedList.put(child, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); child.addOnAttachStateChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnAttachStateChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewAttachedToWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ attachedList.put(v, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewDetachedFromWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ attachedList.put(v, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.addView(child, index, params); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeAllViews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ attachedList.clear(); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.removeAllViews(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ attachedList.remove(view); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.removeView(view); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeViewAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ attachedList.remove(getChildAt(index)); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.removeViewAt(index); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeViews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = start; i &lt; start + count; i++) { attachedList.remove(getChildAt(i)); } <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.removeViews(start, count); } }</code> </pre> </div></div><br><p>  <a href="">Github</a> </p><br><h1>  Adding XML Support and Helper Classes </h1><br><p>  New task: add customization via XML.  Since I do not like very much the creation of Animator in XML (they seem to me something unreadable and not obvious), I decided to make a set of standard animations with the possibility of displaying them through flags.  Plus, this approach will make it easier to define animations via Java code.  Since the approach to creating CircularRevalAnimator differs from the standard one, I had to write two types of helper classes: one for ordinary Property, and the other for CircularReval. <br>  The result was six classes: </p><br><div class="spoiler">  <b class="spoiler_title">PropertyCanny</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyCanny</span></span></span><span class="hljs-class"> </span></span>{ Animator propertyAnimator; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyCanny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PropertyValuesHolder... holders)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.propertyAnimator = ObjectAnimator.ofPropertyValuesHolder(holders); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyCanny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Property&lt;?, Float&gt; property, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.propertyAnimator = ObjectAnimator.ofFloat(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, property, start, end); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyCanny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String propertyName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.propertyAnimator = ObjectAnimator.ofFloat(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, propertyName, start, end); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPropertyAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View child)</span></span></span><span class="hljs-function"> </span></span>{ propertyAnimator.setTarget(child); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> propertyAnimator.clone(); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Propertyin</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyIn</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyCanny</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PropertyValuesHolder... holders)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(holders); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Property&lt;?, Float&gt; property, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(property, start, end); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String propertyName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(propertyName, start, end); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PropertyIn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDuration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> millis)</span></span></span><span class="hljs-function"> </span></span>{ propertyAnimator.setDuration(millis); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getPropertyAnimator(inChild); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Propertyout</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyOut</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyCanny</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OutAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PropertyValuesHolder... holders)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(holders); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Property&lt;?, Float&gt; property, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(property, start, end); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String propertyName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(propertyName, start, end); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PropertyOut </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDuration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> millis)</span></span></span><span class="hljs-function"> </span></span>{ propertyAnimator.setDuration(millis); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOutAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getPropertyAnimator(outChild); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">RevealCanny</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RevealCanny</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> gravity; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RevealCanny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gravity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gravity = gravity; } <span class="hljs-meta"><span class="hljs-meta">@SuppressLint</span></span>(<span class="hljs-string"><span class="hljs-string">"RtlHardcoded"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCenterX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> horizontalGravity = gravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (horizontalGravity == Gravity.LEFT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (horizontalGravity == Gravity.RIGHT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view.getWidth(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// (Gravity.CENTER_HORIZONTAL) return view.getWidth() / 2; } } protected int getCenterY(View view) { final int verticalGravity = gravity &amp; Gravity.VERTICAL_GRAVITY_MASK; if (verticalGravity == Gravity.TOP) { return 0; } else if (verticalGravity == Gravity.BOTTOM) { return view.getHeight(); } else { // (Gravity.CENTER_VERTICAL) return view.getHeight() / 2; } } public int getGravity() { return gravity; } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">RevealIn</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@TargetApi</span></span>(Build.VERSION_CODES.LOLLIPOP) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RevealIn</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RevealCanny</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RevealIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gravity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(gravity); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> inRadius = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) Math.hypot(inChild.getWidth(), inChild.getHeight()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewAnimationUtils.createCircularReveal(inChild, getCenterX(inChild), getCenterY(inChild), <span class="hljs-number"><span class="hljs-number">0</span></span>, inRadius); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">RevealOut</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@TargetApi</span></span>(Build.VERSION_CODES.LOLLIPOP) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RevealOut</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RevealCanny</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OutAnimator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RevealOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gravity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(gravity); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOutAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> outRadius = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) Math.hypot(outChild.getWidth(), outChild.getHeight()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewAnimationUtils.createCircularReveal(outChild, getCenterX(outChild), getCenterY(outChild), outRadius, <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre> </div></div><br><p>  With their help, the initialization of animations has become easier and more elegant.  Instead: </p><br><pre> <code class="java hljs">animator.setInAnimator(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InAnimator() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ObjectAnimator.ofFloat(inChild, View.ALPHA, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } }); animator.setOutAnimator(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutAnimator() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOutAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View inChild, View outChild)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ObjectAnimator.ofFloat(outChild, View.ALPHA, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } });</code> </pre> <br><p>  You can simply write: </p><br><pre> <code class="java hljs"> animator.setInAnimator(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyIn(View.ALPHA, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); animator.setOutAnimator(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyOut(View.ALPHA, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>));</code> </pre> <br><p>  It turned out even prettier than using lamda expressions.  Then, using these classes, I created two lists of standard animations: one for Property - <a href="">PropertyAnimators</a> , the other for CircularReaval - <a href="">RevealAnimators</a> .  Then, using flags, I found the position in these lists in XML and substituted it.  Since CircularRevealAnimator only works with Android 5 and above.  I had to create four parameters instead of two: </p><br><ul><li>  in - sets the animation to appear </li><li>  out - sets the animation to disappear </li><li>  pre_lollipop_in - sets the animation to appear, does not contain CircularReveal in the list </li><li>  pre_lollipop_out - sets the animation to disappear, does not contain CircularReveal in the list </li></ul><br><p>  Further, when parsing parameters from XML, I determine the version of the system.  If it is higher than 5.0, then I take values ‚Äã‚Äãfrom in and out;  if lower, then from pre_lollipop_in and pre_lollipop_out.  If the version is lower than 5.0, but pre_lollipop_in and pre_lollipop_out are not specified, the values ‚Äã‚Äãare taken from in and out. </p><br><p>  Despite many problems, I still successfully completed CannyViewAnimator.  In general, the strange thing is that every time I want to implement any of my own wishlist, I have to use Java Reflection and go deep into it.  This suggests that either the Android SDK is something wrong, or I want too much.  If you have any ideas or suggestions, welcome to comments. <br>  I repeat the link to the project below: <br>  <a href="https://github.com/LiveTyping/CannyViewAnimator">Link to the project in Github</a> </p><br><p>  Bye everyone! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/309740/">https://habr.com/ru/post/309740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309730/index.html">What do system containers give in reality? Where should they be applied?</a></li>
<li><a href="../309732/index.html">New tricks Locky cipher</a></li>
<li><a href="../309734/index.html">Demovideo spy software from RCS Lab cyber weapon developers have leaked to the network</a></li>
<li><a href="../309736/index.html">III International Conference AI Ukraine, October 8-9, Kharkov</a></li>
<li><a href="../309738/index.html">Quest story "NIICHOSHI. Newbie</a></li>
<li><a href="../309742/index.html">UX-strategy in practice. Part 4 - From Design Team to Design Culture</a></li>
<li><a href="../309744/index.html">Little more: the problems of the children's Internet</a></li>
<li><a href="../309746/index.html">ESP32: Getting to know, writing and launching the first firmware</a></li>
<li><a href="../309748/index.html">A cool online business idea. How to make money on someone else's name, someone else's site, and even without a product</a></li>
<li><a href="../309750/index.html">Open platform for developers of open source projects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>