<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bluetooth-based wireless audio: what's better?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the development of technology, the usual "tube" analog headphones go down in history - they are increasingly being squeezed out by Bluetooth wire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bluetooth-based wireless audio: what's better?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/_p/or/uz_por_7qlk9snfb7v_jg2x5iae.jpeg"></div><br>  With the development of technology, the usual "tube" analog headphones go down in history - they are increasingly being squeezed out by Bluetooth wireless-based fellows. <br><br>  Modern smartphones are deprived of the usual connector for the sake of moisture and dust protection. <br><br>  Developers are releasing all newer versions of the Bluetooth protocol and all newer versions of codecs, promising ‚Äúfaster, higher, stronger‚Äù - lower playback delays and better quality. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Is everything so good?  Let's get a look. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  I will not delve into the technical implementation of the protocols, as well as the boring specifications.  Dear <a href="https://habr.com/users/valdikss/" class="user_link">ValdikSS</a> , who to a large extent was the inspiration and even the scientific consultant in this article, is preparing an exhaustive material on codecs - and everything will be described in much more detail and technically correct. <br><br>  I want to tell more about personal experience.  Well, a little entertaining (boring?) Practice. <br><br>  A year and a half ago, I got the idea of ‚Äã‚ÄãaptX.  Yes, I read a lot of reviews like <a href="https://habr.com/company/pult/blog/418593/">this</a> and believed in all these technical bells and whistles and possibilities.  I was born a child - and I really wanted to watch shows with headphones in my headphones at night, without creating noise or waking anyone in the house. <br><br>  What is it poured? <br><br><h2>  Quality </h2><br>  Let's start with numbers and facts (hello, wikipedia!) <br><br>  <b>SBC</b> is a good old codec that is required if the A2DP standard is observed.  The codec is the result of the work of Frans de Bont <i>(F. de Bont, M. Groenewegen and W. Oomen, "A High Quality Audio Coding System at 128 kb / s", 98th AES Convention, Febr. 25-28, 1995)</i> and use algorithms described in <a href="https://patents.google.com/patent/EP0400755A1/en">patent EP-0400755B1</a> .  It is noteworthy that the authors of the patent allow free use of the SBC only in the Bluetooth application, however, the patent expired on June 2, 2010.  Since the A2DP standard is very common, it is extremely difficult to find headphones or speakers that would not have SBC support. <br><br>  The codec provides a sampling frequency of 16, 32, 44.1, 48 kHz with a stream rate of 10-1500 kbit / s.  Yes, you heard right.  Up to 1500 kbps.  The codec simply does not have a limit on bitrate.  But more about that later. <br><br>  The <b>aptX</b> codec <b>was</b> <a href="https://patents.google.com/patent/EP0398973B1/en">developed in 1988 at the Royal University of Belfast</a> .  Yes, there was still about a decade before Bluetooth, so the codec was used in professional audio equipment.  Currently, rights are owned by Qualcomm, and therefore use requires licensing and license fees.  As of 2014, the cost is approximately as follows: a one-time payment of $ 6000 and ‚âà $ 1 for each device released for batches of up to 10,000 devices.  For this reason, many devices with Snapdragon chips 835, 845, 821, 820, 810, 805, 801, 800, 650, 615, 410 are quite possible and support aptX, but it was not activated there because the license was not purchased.  About this is also below. <br><br>  At 16 bits and a 48 kHz sampling rate, the codec can provide a stream rate of 384 kbps (dual channel). <br><br>  <a href="https://www.aptx.com/products%3Ffield_aptx_type_tid%3D482">List of products officially supporting aptX</a> .  On Aliexpress you can find a lot of unknown systems with support for aptX, but be prepared for the fact that in fact there will be the same good old SBC - and no more. <br><br>  <b>AptX HD</b> - the same codec, but with a different encoding profile, has a stream rate of 576 kbps, support for a sampling rate of up to 48 kHz and a bit depth of up to 24 bits.  Some people call this codec aptX Lossless - but this is complete nonsense, if only because it is currently not possible to achieve the value of a stream that could carry lossless data.  A special advantage of this codec is the adjustable coding delay, which can be reduced to 1 ms at a sampling rate of 48 kHz.  Also, the codec is extremely advantageous from the standpoint of CPU usage, which is an advantage over MP3 and AAC. <br><br>  <a href="https://www.aptx.com/products%3Ffield_aptx_type_tid%3D483">List of products officially supporting aptX HD</a> .  It is rather small. <br><br>  <b>aptX Low latency</b> (or LL) is a special version of the codec that allows you to reduce the audio delay time to less than 40 ms.  <a href="https://www.aptx.com/products%3Ffield_aptx_type_tid%3D484">List of products officially supporting aptX LL</a> . <br><br><img src="https://habrastorage.org/webt/oz/nd/5q/oznd5qcoovjbj8f4xdtfydbl_ym.png" alt="image"><br><br>  Here she is.  It was this picture that once bought me with giblets.  Delays!  After all, who wants to hear the sound of an explosion in some kind of action movie, the cry of a monster in horror or the roar of the crowd at a football match, when it was all over? <br><br>  But is this really all about it? <br><br>  Unfortunately no. <br><br>  As with any marketing material, the numbers are far-fetched.  The delay largely depends on system buffering and codec implementation.  Thus, the delay with SBC may well be at a level of less than 40 ms, which, taking into account the standards of television broadcasting (+40 ms ... ‚àí60 ms), is quite acceptable. <br><br>  <u>Summarizing:</u> <br><br><ol><li>  No existing codec can be better than wired technology, since no codec can achieve true lossless compression. </li><li>  The most popular codec is SBC.  He is the most flexible in the settings.  And despite the fact that aptX was released earlier, he could not beat the popularity of the SBC, apparently because of the free of charge last. </li><li>  The sound quality is extremely dependent on the implementation of the codec, as well as on the hardware performance of the headphones / speakers in general - if the speaker itself is weak, you will not improve the quality with a single codec.  Therefore, in the future, comparing the quality, we will talk about playing the same content from the same source on the same speakers / headphones, but with different codecs. </li></ol><br><h2>  Practical and very subjective results </h2><br><img src="https://habrastorage.org/webt/fj/uf/kj/fjufkjmv-sxcezemnqcz3ztyue4.jpeg"><br><br>  The information is based on the already mentioned one and a half year experience in operating, comparing and attracting outside listeners. <br><br>  The experience is based on listening to lossless on the SONY Walkman NWZ-A17 player, where the codec can be selected, as well as on watching various programs with audio output through the Avantree Priva III. <br><br>  Headphones were three: Sennheiser PMX 60, Koss Porta Pro and Koss UR-20. <br><br>  Jabra BT3030 (SBC) and Avantree Clipper Pro (aptX) were used as wireless signal receivers. <br><br>  Also used was a Voombox Outdoor speaker (SBC) and Aftershokz Trekz Titanium bone conduction headphones (aptX). <br><br>  All equalizers and improvers were turned off - and this is important. <br><br>  <u>Total:</u> <br><br><ol><li>  The quality of the sound played when wired is always better.  This is without a doubt. </li><li>  The difference between SBC and aptX is extremely difficult to hear - and only in the case of some types of music.  For example, the author of the article clearly heard the difference on cello solo in classical compositions, while the difference for the violin and low-frequency instruments was less noticeable.  In modern genres - pop, electronic music and rock - the difference is not audible.  In some cases, subjectively, it seemed that the SBC transmits sound better than aptX. </li><li>  The delay between SBC and aptX can be noticed only if it is connected to the same source and different receivers are inserted into different ears (well, the left channel is SBC, and the right one is aptX for example).  Delay with a picture is almost impossible to see, and therefore the story is that aptX is designed for dynamic scenes and content - a myth. </li><li> Surprise caused the sound quality at a fairly cheap and "not famous" Voombox Outdoor.  Apparently, this is the successful implementation of SBC, which was mentioned above. </li><li>  The implementation of aptX in headphones with bone conduction is completely incomprehensible - the technology is very specific, and therefore the loss in quality is significant because of the technology itself.  Taking into account the small range of "range" of the device, an extremely poor implementation of pairing with two devices, I can say that Aftershokz is a company that invests more in marketing than in development. </li></ol><br><br>  I do not argue that if you connect all sorts of spectral analyzers and stuff, you can and should see the difference.  But the human ear, and even worse - the average human ear is not a spectral device, and therefore does not hear all these nuances. <br><br><h2>  Practice: fix what can be fixed </h2><br><h3>  Part 1. Turn on aptX </h3><br>  As already mentioned, in some devices the use of aptX is disabled, probably to avoid patent prosecution. <br><br>  This issue can be resolved quite simply - by slipping the library device into the codec to implement the work and setting the option of working with this codec in build.prop. <br><br>  On the Internet there are a large number of solutions of this nature.  I took the liberty of combining them into one, while implementing it as a module for Magisk.  Yes, I really love this project and I believe that the implementation of changes in the system in the form of Magisk modules is a better and safer solution with the ability to save the system as much as possible in its original form and an easy way to roll back. <br><br>  The module can be downloaded <a href="https://www52.zippyshare.com/v/jJDY0aEC/file.html">from here</a> .  Yes, I know about the githab.  And no, as long as I do not have time to upload it there. <br><br>  Entries to build.prop, including aptX, and, if possible, aptX HD, will be emulated automatically by the module. <br><br><img src="https://habrastorage.org/webt/vg/lc/gu/vglcguyqsbbyxptonmhdw-5ta3y.png"><br><br><h3>  Part 2. Increasing the SBC bit rate </h3><br>  As previously reported, the SBC codec is fundamentally free of bitrate restrictions.  However, manufacturers usually put a limit of 342 kbps for mono and 345 kbps for stereo in order to ensure reliable operation with all types of receiving devices. <br><br>  At the same time, the A2DP v1.2 specification, which was active from 2007 to 2015, requires all decoders to work correctly with bitrates up to 320 kbit / s for mono and 512 kbit / s in the case of a stereo signal. <br><br>  In the new version of the specification, there is no limit on bitrate at all.  It is assumed that modern headphones, released after 2015 and supporting EDR, can support bitrates up to 730 kbit / s. <br><br>  In fact, this is certainly not the case.  <a href="https://4pda.ru/forum/index.php%3Fshowtopic%3D914135">In an extensive study</a> conducted by <a href="https://habr.com/users/valdikss/" class="user_link">ValdikSS</a> , it was found that almost all receiving devices work reliably with a bitrate of 454 kbit / s, and a sufficiently large number with a bitrate of 507 kbit / s. <br><br>  <a href="https://4pda.ru/forum/index.php%3Fshowtopic%3D914135%26view%3Dfindpost%26p%3D76185079">In his research,</a> <a href="https://habr.com/users/valdikss/" class="user_link">ValdikSS</a> also showed that, contrary to the conventional wisdom about the sound quality of the aptX codec, on some files it can produce worse results than SBC with a standard bitrate of 328 kbps, and switching to high-bit SBC, you will get a sound that is often superior aptX, on any headphones. <br><br>  <a href="https://habr.com/users/valdikss/" class="user_link">ValdikSS</a> based on this data sent comments to the developers of Lineage OS and to Google, but at the moment there was no reaction. <br><br>  Thus, we can only manually make modifications to the Bluetooth stack. <br><br>  We need an IDA Pro with the ability to decompile ARM, any HEX editor (I used WinHEX) and the bluetooth.default.so file from our device.  Usually it is located along the path / system / lib / hw and less often - also along the path / system / lib64 / hw (you definitely need root-access). <br><br>  So, open the bluetooth.default.so file. The operations and modifications described below apply only to the original Android stack (bluedroid).  If you see the line ‚ÄúNeeded Library 'com.qualcomm.qti.bluetooth_audio@1.0.so'‚Äù or similar in IDA Pro, with high probability, this instruction will not help you. <br><br><img src="https://habrastorage.org/webt/cf/3l/jb/cf3ljbjgckew4pd9tbutsy-tyaw.png"><br><br>  Our first task is to replace the Joint Stereo with a Dual Channel in the standard configuration. <br><br>  We will work with the <a href="">bta_av_build_src_cfg function</a> . <br><br>  To find this procedure in IDA, we use the search <a href="">for the line of the characteristic message in the debug log ‚ÄúCant parse src cap ret =% d‚Äù</a> : <br><br><img src="https://habrastorage.org/webt/wh/dk/ex/whdkexvibrxijvj7pqb-buzb0z8.png"><br><br><img src="https://habrastorage.org/webt/ea/2h/nh/ea2hnhbszbtyieokldywuch2qvi.png"><br><br>  As a result, quite quickly we find the function itself in the form of code: <br><br><img src="https://habrastorage.org/webt/mf/5_/_9/mf5__9yydhgwip0lvemgqwcwocw.png"><br><br>  Our task is to replace the original structure of checks. <br><br><pre><code class="plaintext hljs">if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_JOINT) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_JOINT; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;&lt;/code&gt;  &lt;code&gt; if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;</code> </pre> <br>  This can be done in several ways. <br><br>  The first one is the substitution of instructions TST.W R0, # 1 by TST.W R0, # 4 and MOVS R0, # 1 by MOVS R0, # 4 in the sequence of checks: <br><br><img src="https://habrastorage.org/webt/6e/zu/so/6ezusojttx0gavinlppmqeroet8.png"><br><br>  In the bytecode, this is the replacement of x01 by x04.  It is important to note the characteristic sequence of bytes by which this pattern can be found.  Without going deep into details, I‚Äôll say that this is essentially a search for a sequence <br><br><pre> <code class="plaintext hljs">10 20 8D F8 04 00 9D F8 0D 00 10 F0 01 0F ?? ?? 10 F0 02 0F ?? ?? 10 F0 04 0F ?? ?? 10 F0 08 0F ?? ?? 08 20 ?? ?? 01 20 ?? ?? 02 20 ?? ?? 04 20</code> </pre> <br>  and replacing it with <br><br><pre> <code class="plaintext hljs">?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ??</code> </pre> <br>  However, this method has drawbacks. <br><br>  A number of compilers change the sequence of command execution depending on optimization.  And in this case, it is not possible to find the desired pattern, and sometimes the checking mechanism in the structure is generally entered into the inline code.  Therefore, it is more reliable to change the constant <a href="">btif_av_sbc_default_config</a> . <br><br>  To begin with - we will find it.  It is at the very beginning of our function, because <br><br><pre> <code class="plaintext hljs">void bta_av_build_src_cfg (UINT8 *p_pref_cfg, UINT8 *p_src_cap) { tA2D_SBC_CIE src_cap; tA2D_SBC_CIE pref_cap; UINT8 status = 0; /* initialize it to default SBC configuration */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;btif_av_sbc_default_config, p_pref_cfg); /* now try to build a preferred one */ /* parse configuration */ if ((status = A2D_ParsSbcInfo(&amp;src_cap, p_src_cap, TRUE)) != 0) { APPL_TRACE_DEBUG(" Cant parse src cap ret = %d", status);</code> </pre> <br>  And here she is: <br><br><img src="https://habrastorage.org/webt/xi/j2/dt/xij2dtvma0evlnggxkxzqxkvdn4.png"><br><br><img src="https://habrastorage.org/webt/7a/z9/36/7az936re6naesontslfi1ogkd5c.png"><br><br>  It can be seen that btif_av_sbc_default_config itself is a sequence of bytes 20 01 10 04 01 35 02, while the first byte encodes the sampling frequency and can be 10 (48 kHz) and 20 (44 kHz), and therefore not specific.  Thus, our task is to replace the sequence <br> <code>01 10 04 01 35 02</code> <br>  on <br> <code>04 ?? ?? ?? ?? ??</code> <br> <br>  This will change the logic of the structure in a similar way, but the optimization of the compiler will not cause problems. <br><br>  In some cases, the initiator of the connection are the headphones or speakers themselves.  In this case, the mode is determined by the <a href="">bta_av_co_audio_init</a> function. <br><br>  The function is <a href="">characterized by the string ‚Äúbta_av_co_audio_init:% d‚Äù</a> and is easily found in the code: <br><img src="https://habrastorage.org/webt/fi/5o/ku/fi5okug9tbn6gvleetxo93uk9qg.png"><br><br>  The possible connection modes are listed in the following command: <br><br><pre> <code class="plaintext hljs"> switch (index) { case BTIF_SV_AV_AA_SBC_INDEX: /* Set up for SBC codec for SRC*/ *p_codec_type = BTA_AV_CODEC_SBC; /* This should not fail because we are using constants for parameters */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;bta_av_co_sbc_caps, p_codec_info); /* Codec is valid */ return TRUE;</code> </pre> <br>  while the <a href="">constant bta_av_co_sbc_caps has the following structure</a> : <br><br><pre> <code class="plaintext hljs">const tA2D_SBC_CIE bta_av_co_sbc_caps = { (A2D_SBC_IE_SAMP_FREQ_44), /* samp_freq */ (A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL), /* ch_mode */ (A2D_SBC_IE_BLOCKS_16 | A2D_SBC_IE_BLOCKS_12 | A2D_SBC_IE_BLOCKS_8 | A2D_SBC_IE_BLOCKS_4), /* block_len */ (A2D_SBC_IE_SUBBAND_4 | A2D_SBC_IE_SUBBAND_8), /* num_subbands */ (A2D_SBC_IE_ALLOC_MD_L | A2D_SBC_IE_ALLOC_MD_S), /* alloc_mthd */ BTA_AV_CO_SBC_MAX_BITPOOL, /* max_bitpool */ A2D_SBC_IE_MIN_BITPOOL /* min_bitpool */ };</code> </pre> <br>  The constant is easily located in the code, in my case it is equal to 20 0F F0 0C 03 35 02: <br><br><img src="https://habrastorage.org/webt/kj/hw/oi/kjhwoibpuk8brwa3kzvxiuxgeba.png"><br><br>  Note the byte <b>0F</b> - it provides the ability to connect with any of the allowed modes, because <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL = x08 | x02 | x01 | x04</code> </pre> <br>  Our task is to change this value in this way: <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_DUAL = x04</code> </pre> <br>  Therefore, it is necessary to replace <br><br> <code>?? 0F F0 0C 03 35 02</code> <br>  on <br> <code>?? 04 ?? ?? ?? ?? ??</code> <br> <br>  So, we forced the stack to connect in Dual Channel mode, both in the case of the device initiating the connection, and in the case of the party initiating the connection. <br><br>  Now you need to remove the restrictions in bitrate or raise its upper threshold. <br><br>  It is necessary to process <a href="">btif_media_task_get_sbc_rate</a> .  Similarly, <a href="">looking</a> for the <a href="">characteristic string ‚Äúnon-edr a2dp sink detected, restrict rate to% d‚Äù, we</a> find the function in the code: <br><img src="https://habrastorage.org/webt/kp/go/j2/kpgoj2xsq6vt8kbnexy81jy6j6s.png"><br><br>  The bitrate limit is expressed in the string <br>  UINT16 rate = DEFAULT_SBC_BITRATE (which in turn <a href="">is 328 kbps</a> ) <br><br>  In the code it is like this: <br><br><img src="https://habrastorage.org/webt/tf/ba/bn/tfbabnrxfks3pejhzqzdegiwn04.png"><br><br>  We change this value to 454 kbps - this is higher than the standard and works with the vast majority of receiving devices.  To do this, replace the bytes. <br><br> <code>B1 4F F4 A4 74 ?? E0</code> <br>  on <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br> <br>  You should also search by pattern. <br><br> <code>E0 4F F4 A4 74 ?? E0</code> <br>  and replace it with <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br>  - this is required for a number of devices. <br><br>  The value of E3 may be different depending on the desired maximum bitrate: <br><br><ul><li>  E3 - 454 kbps </li><li>  F1 - 482 kbps </li><li>  F3 - 486 kbps </li><li>  10 - 576 kbps </li><li>  48 - without restrictions </li></ul><br>  In general, this is determined by the byte code of the operation MOV.W R4, XXX. <br><br>  In practice, it is worth experimenting and choosing the maximum value at which in all your receiving devices there is a stable signal reception, there is no crack, interruption and distortion. <br><br>  In all the receivers in my experiment (I indicated them above), this value was 576 kbit / s, the signal source was the Xiaomi Redmi 4x MIUI10 Android 7.1 phone. <br><br>  Based on the described actions, was a generic patch created that finds the specified patterns in Bluetooth.default.so and replaces them?  including forced Dual Channel mode and setting a bitrate limit of 454 kbps.  If necessary, the limit value can be easily changed on the basis of the search and replacement of the corresponding byte - the attentive reader will do it without difficulty. <br><br>  I emphasize: the patch works only in the case of a bluedroid stack and most likely will not be successful in the case of the Fluoride stack and Android version 8 and newer. <br><br>  The patch can be downloaded <a href="https://www66.zippyshare.com/v/KTyvfawz/file.html">from here</a> . <br><br>  It is strongly recommended to replace the original file as Magisk modules, for myself I did it <a href="https://www43.zippyshare.com/v/RfnKuRtq/file.html">as follows</a> .  <b>Please note</b> : these modules are made by me for the Xiaomi Redmi 4x 3/32 GB phone from the global stable firmware MIUI 10 that is current at the time of writing the article. In your case, you will have to replace the bluetooth.default.so file with your own patched one as described above.  It is also possible that the file will have to be duplicated along the path / system / lib64 / hw - this depends on the model and firmware version of your phone. <br><br>  This approach using Magisk modules allows you to easily change the maximum bitrate and disable changes altogether if it turns out that one of the receiving devices does not support Dual Channel. <br><br><h2>  Conclusion </h2><br>  At the moment, in pursuit of sales, many companies are submitting some technological innovations as a justification for a higher price. <br><br>  In practice, it turns out that the already existing, cheaper technologies are not fully developed, and technological innovations are not fully implemented, which significantly affects the quality. <br><br>  Very often, users experience a ‚Äúplacebo effect‚Äù, convincing themselves of the perfection of a product just because it is newer or more colorfully presented.  In fact, this quality is imaginary. <br><br>  Despite the obvious deterioration in the quality of wireless transmission of sound compared to the wired version, it seems that modern device manufacturers are aiming at a complete transition to wireless technology.  At the same time, in order to justify the price increase, marketing tricks are used: protection against immersion of the telephone in the water (how can you talk underwater? Why drop a device into the water?), Use of more expensive codecs, etc.  At the same time, the potential of the existing popular SBC codec is not fully utilized. <br><br>  We were not able to get a clarification from Google regarding the bitrate of 328 kbps, nor to eliminate this limit and add the option to enable Dual Channel in the Bluetooth menu from the Lineage OS developers. <br><br>  Thanks to everyone who read to the end! <br><br>  Some continuation, caused by the discussion in the comments and the space regarding the LDAC codec, is <a href="https://habr.com/post/433724/">here</a> . <br><br><img src="https://habrastorage.org/webt/ob/mr/cc/obmrccmcn21gzh8g1ca3g3ykfs4.jpeg"></div><p>Source: <a href="https://habr.com/ru/post/433502/">https://habr.com/ru/post/433502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433490/index.html">Creality CR-X 3D Printer Review</a></li>
<li><a href="../433494/index.html">10 English idioms, the value of which you will never guess</a></li>
<li><a href="../433496/index.html">State-owned companies are obliged to switch to domestic software by 2022</a></li>
<li><a href="../433498/index.html">Sberbank - you have a ‚Äúpackage wrapper‚Äù for me, but I will not take it ...</a></li>
<li><a href="../433500/index.html">A courier robot in Berkeley burned out due to a lack of monitoring of the system status.</a></li>
<li><a href="../433506/index.html">In the EU, seeking the right to repair major household appliances</a></li>
<li><a href="../433508/index.html">The owner of the MIPS architecture is going to open a set of its commands (ISA) in 2019</a></li>
<li><a href="../433510/index.html">Cross cultural difference in games</a></li>
<li><a href="../433512/index.html">The theory of happiness. Dizzy flight of butter sandwich</a></li>
<li><a href="../433514/index.html">Hell do it yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>