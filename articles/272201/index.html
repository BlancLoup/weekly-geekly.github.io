<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The steady beauty of indecent models</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Could you build us a statistical model? 
 - With pleasure. Can I look at your historical data? 
 - We have no data yet. But the model is still neede...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The steady beauty of indecent models</h1><div class="post__text post__text-html js-mediator-article"><img alt="Titanic on KDPV no, he drowned" src="https://habrastorage.org/files/53a/d1f/d64/53ad1fd64f6549148c3fe004be5ea8d0.jpg"><br><blockquote>  - Could you build us a statistical model? <br>  - With pleasure.  Can I look at your historical data? <br>  - We have no data yet.  But the model is still needed. <br></blockquote><br>  Familiar dialogue, is not it?  Further, there are two possible scenarios: <br><br>  A. ‚ÄúThen come when data is available.‚Äù The option will not be considered as trivial. <br>  B. ‚ÄúTell us which factors do you think are most important.‚Äù The rest of the article is about this. <br><br>  Under the cut there is a story about what an improper model is, why their beauty is stable and what it costs.  All on the example of the long-suffering data on the survival of the passengers of the Titanic. <br><a name="habracut"></a><br><h2>  Where does this strange name come from </h2><br>  From the article <a href="http://www.cmu.edu/dietrich/sds/docs/dawes/the-robust-beauty-of-improper-linear-models-in-decision-making.pdf">The Robust Beauty of Improving Linear Models in Decision Making of</a> comrade Robyn M. Dawes, who in turn refers to the work of predecessors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  Proper linear models are those in which weights are assigned in such a way that the resulting linear combination predicts the quantity of interest in an optimal way.  An example would be the usual linear regression, fitted by the method of least squares.  [...] <br><br>  Indecent linear models (improper linear models) - those in which the weights are determined optimally.  For example, they are appointed on the basis of intuition, previous experience, or equal to one. </blockquote><br>  A typical linear model looks like this: <br><br>  ≈∑ = Œ≤ <sub>0</sub> + Œ≤ <sub>1</sub> x <sub>1</sub> + Œ≤ <sub>2</sub> x <sub>2</sub> +‚Ä¶ + Œ≤ <sub>m</sub> x x <sub>m</sub> <br><br>  Here is the estimate of the dependent variable, Œ≤ <sub>0</sub> is the free term, Œ≤ <sub>1</sub> ... Œ≤ <sub>m</sub> are the regression coefficients, x <sub>1</sub> ... x <sub>m</sub> are independent variables. <br><br>  Due to the lack of data to determine the values ‚Äã‚Äãof Œ≤ <sub>1</sub> ... Œ≤ <sub>m,</sub> we will act voluntarily: assign them the values ‚Äã‚Äãof +1 (positive effect), -1 (negative effect) and 0 (no effect). <br><br><h2>  Far-fetched example </h2><br>  Typical examples of statistical models that were discussed at the beginning of the article are scoring cards for consumer lending (they predict the likelihood of a client‚Äôs deep delay or non-return of debt), response models (they predict the likelihood that a client will respond to an offer to buy or subscribe to product), outflow models (predict the likelihood that a customer will go to a competitor), etc. <br><br>  This article will use a simpler data set, most likely already familiar to all interested in the topic of machine learning for readers: the list of passengers of the Titanic.  Earlier on Habr√© already looked at him: <br><br><ul><li>  <a href="http://habrahabr.ru/company/microsoft/blog/268039/">Predicting Titanic Passenger Survival with Azure Machine Learning</a> </li><li>  <a href="http://habrahabr.ru/company/mlclass/blog/270973/">Titanic on Kaggle: you do not finish reading this post until the end</a> </li></ul><br><h2>  Competitors </h2><br><ul><li> <code>ImproperModel</code> - regression with unit weights (topic of this article) </li><li>  <code>ProperModel</code> - logistic regression with the same independent variables. </li><li>  <code>LogisticRegression</code> - logistic regression with all independent variables </li><li>  <code>RandomForest</code> - one of the most common modern algorithms </li></ul><br><h2>  How will we compare </h2><br>  The passenger list will be divided into two parts, on one we will fit the model, on the other to check the quality of its work. <br><br>  There are no miracles and absolutely no knowledgeable model can be built without any knowledge.  In this case, such knowledge would be gallantry - women and children were let forward when boating.  Based on this prior knowledge for the regression with unit weights, we assign the variable <code>female</code> weight +1, and the <code>age</code> variable weight -1.  In addition, passengers with second and third class tickets, who have cabins in the hold, continue to run to the boats, so the variable <code>pclass</code> is assigned a weight of -1. <br><br>  In order not to get up two times, we will immediately normalize it - divide by the standard deviation in the training set.  This is necessary to bring the independent variables to a comparable scale.  It was possible to divide by the range and get a similar result. <br><br>  Please note that <b>in the single weights model we did not use information about who survived and who drowned</b> , only the standard deviation of independent variables for scaling. <br><br>  Repeat the experiment a thousand times and look at the results.  The quality of the model will be measured using the Gini coefficient ( <a href="https://ru.wikipedia.org/wiki/ROC-%25D0%25BA%25D1%2580%25D0%25B8%25D0%25B2%25D0%25B0%25D1%258F">G1</a> ). <br><br><div class="spoiler">  <b class="spoiler_title">R code with step by step comments</b> <div class="spoiler_text"><pre> <code class="hljs sql">install.packages(<span class="hljs-string"><span class="hljs-string">"pROC"</span></span>) install.packages(<span class="hljs-string"><span class="hljs-string">"randomForest"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">library</span></span>(pROC) <span class="hljs-keyword"><span class="hljs-keyword">library</span></span>(randomForest)</code> </pre><br>  Read the source data is also available here: <a href=""><code>titanic3.csv</code></a> <br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> &lt;- read.csv('~/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">habr</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit_weights</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">titanic3</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">csv'</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  Dependentd variable <code>survived</code> <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span>$survived &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>$survived)</code> </pre><br>  Eliminate variables that have too many different values ‚Äã‚Äãfor normal analysis. <br><pre> <code class="hljs php">data$name &lt;- <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> data$ticket &lt;- <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> data$cabin &lt;- <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> data$home.dest &lt;- <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> data$embarked &lt;- <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span></code> </pre><br>  We do not use variables from the future. <br><pre> <code class="hljs php">data$boat &lt;- <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> data$body &lt;- <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span></code> </pre><br>  Replace missing values ‚Äã‚Äãwith average <br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">$age[is.na(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">)] &lt;- mean(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">na</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rm</span></span></span><span class="hljs-class">=</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TRUE</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">$fare[is.na(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fare</span></span></span><span class="hljs-class">)] &lt;- mean(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fare</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">na</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rm</span></span></span><span class="hljs-class">=</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TRUE</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  Transform the floor into an indicator variable <br><pre> <code class="hljs bash">data<span class="hljs-variable"><span class="hljs-variable">$female</span></span> &lt;- 0 data<span class="hljs-variable"><span class="hljs-variable">$female</span></span>[<span class="hljs-built_in"><span class="hljs-built_in">which</span></span>(data<span class="hljs-variable"><span class="hljs-variable">$sex</span></span> == <span class="hljs-string"><span class="hljs-string">'female'</span></span>)] &lt;- 1 data<span class="hljs-variable"><span class="hljs-variable">$sex</span></span> &lt;- NULL</code> </pre><br>  We look at what is left: <br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">survived</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pclass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">age</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sibsp</span></span> 0<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:809</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Min</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Min</span></span>. : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.1667</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Min</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.0000</span></span> 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:500</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2.000</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:22.0000</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.0000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Median</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Median</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:29.8811</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Median</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.0000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mean</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2.295</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mean</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:29.8811</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mean</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.4989</span></span> 3<span class="hljs-selector-tag"><span class="hljs-selector-tag">rd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3.000</span></span> 3<span class="hljs-selector-tag"><span class="hljs-selector-tag">rd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:35.0000</span></span> 3<span class="hljs-selector-tag"><span class="hljs-selector-tag">rd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.0000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Max</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Max</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:80.0000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Max</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8.0000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parch</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fare</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">female</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Min</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Min</span></span>. : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Min</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.000</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.000</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.: 7<span class="hljs-selector-class"><span class="hljs-selector-class">.896</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">st</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Median</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Median</span></span> : 14<span class="hljs-selector-class"><span class="hljs-selector-class">.454</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Median</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mean</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.385</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mean</span></span> : 33<span class="hljs-selector-class"><span class="hljs-selector-class">.295</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mean</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.356</span></span> 3<span class="hljs-selector-tag"><span class="hljs-selector-tag">rd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0.000</span></span> 3<span class="hljs-selector-tag"><span class="hljs-selector-tag">rd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.: 31<span class="hljs-selector-class"><span class="hljs-selector-class">.275</span></span> 3<span class="hljs-selector-tag"><span class="hljs-selector-tag">rd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Qu</span></span>.<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Max</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9.000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Max</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:512.329</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Max</span></span>. <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.000</span></span></code> </pre><br>  Repeat the experiment a thousand times. <br><pre> <code class="hljs pgsql">im.gini = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> pm.gini = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> lr.gini = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> rf.gini = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.seed(<span class="hljs-number"><span class="hljs-number">42</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1000</span></span>) {</code> </pre><br>  We divide passengers into two samples - 70% are sent to the training sample, for the remaining 30% we will measure the quality of the model. <br><pre> <code class="hljs bash"> data<span class="hljs-variable"><span class="hljs-variable">$random_number</span></span> &lt;- runif(nrow(data),0,1) development &lt;- data[ <span class="hljs-built_in"><span class="hljs-built_in">which</span></span>(data<span class="hljs-variable"><span class="hljs-variable">$random_number</span></span> &gt; 0.3), ] holdout &lt;- data[ <span class="hljs-built_in"><span class="hljs-built_in">which</span></span>(data<span class="hljs-variable"><span class="hljs-variable">$random_number</span></span> &lt;= 0.3), ] development<span class="hljs-variable"><span class="hljs-variable">$random_number</span></span> &lt;- NULL holdout<span class="hljs-variable"><span class="hljs-variable">$random_number</span></span> &lt;- NULL</code> </pre><br>  Single Scale Model <br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">beta_pclass</span></span> &lt;- -<span class="hljs-number"><span class="hljs-number">1</span></span>/sd(development<span class="hljs-variable"><span class="hljs-variable">$pclass</span></span>) beta_age &lt;- -<span class="hljs-number"><span class="hljs-number">1</span></span>/sd(development<span class="hljs-variable"><span class="hljs-variable">$age</span></span> ) beta_female &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span>/sd(development<span class="hljs-variable"><span class="hljs-variable">$female</span></span>) im.score &lt;- beta_pclass*holdout<span class="hljs-variable"><span class="hljs-variable">$pclass</span></span> + beta_age*holdout<span class="hljs-variable"><span class="hljs-variable">$age</span></span> + beta_female*holdout<span class="hljs-variable"><span class="hljs-variable">$female</span></span> im.roc &lt;- roc(holdout<span class="hljs-variable"><span class="hljs-variable">$survived</span></span>, im.score) im.gini[i] &lt;- <span class="hljs-number"><span class="hljs-number">2</span></span>*im.roc<span class="hljs-variable"><span class="hljs-variable">$auc</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  The usual model is logistic regression with the same independent variables. <br><pre> <code class="hljs bash"> pm.model = glm(survived~pclass+age+female, family=binomial(logit), data=development) pm.score &lt;- predict(pm.model, holdout, <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"response"</span></span>) pm.roc &lt;- roc(holdout<span class="hljs-variable"><span class="hljs-variable">$survived</span></span>, pm.score) pm.gini[i] &lt;- 2*pm.roc<span class="hljs-variable"><span class="hljs-variable">$auc</span></span>-1</code> </pre><br>  Logistic regression with all variables <br><pre> <code class="hljs bash"> lr.model = glm(survived~., family=binomial(logit), data=development) lr.score &lt;- predict(lr.model, holdout, <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"response"</span></span>) lr.roc &lt;- roc(holdout<span class="hljs-variable"><span class="hljs-variable">$survived</span></span>, lr.score) lr.gini[i] &lt;- 2*lr.roc<span class="hljs-variable"><span class="hljs-variable">$auc</span></span>-1</code> </pre><br>  Everyone's favorite (and not without reason) RandomForest <br><pre> <code class="hljs haskell"> rf.model &lt;- randomForest(survived~., development) rf.score &lt;- predict(rf.model, holdout, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> = "prob") rf.roc &lt;- roc(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">holdout</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">survived</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">score</span></span></span><span class="hljs-class">[,1]) rf.gini[i] &lt;- 2*rf.roc$auc-1 }</span></span></code> </pre><br>  Display the results <br><pre> <code class="hljs matlab">bpd&lt;-data.frame(ImproperModel=im.gini, ProperModel=pm.gini, LogisticRegression=lr.gini, RandomForest=rf.gini) png(<span class="hljs-string"><span class="hljs-string">'~/habr/unit_weights/auc_comparison.png'</span></span>, height=<span class="hljs-number"><span class="hljs-number">700</span></span>, width=<span class="hljs-number"><span class="hljs-number">400</span></span>, res=<span class="hljs-number"><span class="hljs-number">120</span></span>, units=<span class="hljs-string"><span class="hljs-string">'px'</span></span>) boxplot(bpd, las=<span class="hljs-number"><span class="hljs-number">2</span></span>, ylab=<span class="hljs-string"><span class="hljs-string">"Gini"</span></span>, ylim=c(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), par(mar=c(<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)+ <span class="hljs-number"><span class="hljs-number">0.1</span></span>), col=c(<span class="hljs-string"><span class="hljs-string">"red"</span></span>,<span class="hljs-string"><span class="hljs-string">"green"</span></span>,<span class="hljs-string"><span class="hljs-string">"royalblue2"</span></span>,<span class="hljs-string"><span class="hljs-string">"brown"</span></span>)) dev.off() <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(im.gini) <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(pm.gini) <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(lr.gini) <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(rf.gini) <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(im.gini)/<span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(rf.gini) <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(pm.gini)/<span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(rf.gini) <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(lr.gini)/<span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(rf.gini) <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(rf.gini)/<span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(rf.gini)</code> </pre><br></div></div><br><h2>  results </h2><br><table><tbody><tr><th>  Model </th><th>  Gini </th><th>  Percentage of best </th></tr><tr><td>  ImproperModel </td><td>  0.639 </td><td>  90.4% </td></tr><tr><td>  ProperModel </td><td>  0.667 </td><td>  94.3% </td></tr><tr><td>  LogisticRegression </td><td>  0.679 </td><td>  96.0% </td></tr><tr><td>  RandomForest </td><td>  0.707 </td><td>  100% </td></tr></tbody></table><br><img src="https://habrastorage.org/files/b0e/df2/f3c/b0edf2f3cd4a49998a95c0507f97758b.png"><br><h2>  Far-reaching conclusions </h2><br>  A pessimist will say that the model with unit weights ranked last in this comparison, and this is true.  But it is also true that she gained <b>90%</b> of the best result <b>without using historical data</b> , and lagged behind the usual logistic regression with the same independent variables by only <b>4%</b> . <br><br><h2>  Why it happens </h2><br>  In the article with the unusual name <a href="http://www-stat.wharton.upenn.edu/~hwainer/Readings/Wainer_Estimating%2520Coefficients%2520in%2520Linear%2520Models.pdf">Estimating Coefficients in Linear Models:</a> its author (Howard Weiner) gives the following theorem of equal weights: <br><br><blockquote>  If <i>k</i> linearly independent variables <i>x <sub>i</sub> (i = 1, ..., k)</i> with zero mean value and unit variance are used to predict the variable <i>y</i> , which is also scaled to zero mean and unit variance, and the standardized values ‚Äã‚Äãof the least squares regression coefficients <i>Œ≤ <sub>i</sub> (i = 1, ..., k) are</i> evenly distributed over the interval <i>[0.25, 0.75]</i> , then when going to equal weights <i>(0.5), the</i> expectation of reducing the proportion of dispersion of the dependent variable explained by the model will be less than <i>k / 96</i> .  Losses are even less if <i>x <sub>i are</sub></i> correlated with each other. </blockquote><br>  In the example above, the regression is logistic, but the effect is still visible. <br><br>  Further in the same article, the author notes that the models with unit weights are stable in particular because they are not affected by emissions in the training set and cannot be overtrained. </div><p>Source: <a href="https://habr.com/ru/post/272201/">https://habr.com/ru/post/272201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272191/index.html">Welcome to TechDay in Moscow on December 10</a></li>
<li><a href="../272193/index.html">How to calculate the time for testing</a></li>
<li><a href="../272195/index.html">A couple of words about the "death" of Flash, Animate CC and Web standards</a></li>
<li><a href="../272197/index.html">Release close ...</a></li>
<li><a href="../272199/index.html">Installing and configuring Puppet version 3.8 using the example of Centos 6.5</a></li>
<li><a href="../272203/index.html">Where does IaaS work?</a></li>
<li><a href="../272205/index.html">10 attacks on web applications in action</a></li>
<li><a href="../272207/index.html">Kazakhstan introduces its CA to listen to all TLS traffic</a></li>
<li><a href="../272209/index.html">GDG DevFest Nizhny Novgorod 2015: photo report from the event</a></li>
<li><a href="../272211/index.html">SQL Server 2016 CTP3.1 - what's new for the developer?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>