<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with CouchDB using the example of the Todo List JavaScript application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At some point I had to work with one of the document-oriented DBMS, Apache CouchDB, but I had difficulty finding documentation. In this article I want...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with CouchDB using the example of the Todo List JavaScript application</h1><div class="post__text post__text-html js-mediator-article">  At some point I had to work with one of the document-oriented DBMS, Apache CouchDB, but I had difficulty finding documentation.  In this article I want to talk about how to work in this database from JavaScript using the example of a small application ‚ÄúTodo List‚Äù.  Since the article is focused on ApacheCouchDB - I will not show and talk about how the application works to the full. <br><a name="habracut"></a><br><h3>  <b>Model</b> </h3><br>  The principle of operation of this application is as follows: <br><br>  1. When the page loads, send a request to the database server. <br>  2. We receive from it JSON structure. <br>  3. Pars it on the page. <br>  4. Add any entries as needed ... <br>  5. When you click on the "Save" button, write the data to the database. <br><br>  All page content is stored as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs">model = { <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">"11.11.11"</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"  1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">does</span></span>:[{ <span class="hljs-attr"><span class="hljs-attr">check</span></span> : <span class="hljs-string"><span class="hljs-string">'true'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span> : <span class="hljs-string"><span class="hljs-string">' 1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">time</span></span> : <span class="hljs-string"><span class="hljs-string">'00:00'</span></span> }] } { <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">"11.11.11"</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"  2 "</span></span>, <span class="hljs-attr"><span class="hljs-attr">does</span></span>:[{ <span class="hljs-attr"><span class="hljs-attr">check</span></span> : <span class="hljs-string"><span class="hljs-string">'true'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span> : <span class="hljs-string"><span class="hljs-string">' 2 '</span></span>, <span class="hljs-attr"><span class="hljs-attr">time</span></span> : <span class="hljs-string"><span class="hljs-string">'00:00'</span></span> }] } ] }</code> </pre> <br>  Each of the elements of items contains a sheet that includes a to-do list; in the example above, each list contains one item (does). <br><br>  So we have a model for data storage.  The next step is to work directly with the DBMS. <br><br><h3>  <b>Install CouchDB</b> </h3><br>  The easiest way to install CouchDB is to go <a href="http://couchdb.apache.org/">to the site</a> and download the installation distribution for your operating system. <br><br>  <b>Health check</b> <br>  After installing CouchDB, you need to check it for operability, for this you need to go to: <a href="http://127.0.0.1/">127.0.0.1</a> : 5984.  Making sure that in response you received the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f95/83d/ef0/f9583def03533a8c8439311b831afd84.jpg" alt="image"><br><br>  You can proceed to the next step. <br><br><h3>  <b>Control Panel</b> </h3><br>  The CouchDB control panel is operated using the Futon interface, which can be accessed by entering the following address in your browser‚Äôs address bar: <a href="http://127.0.0.1/">127.0.0.1</a> : 5984 / _utils <br><br>  If everything is correct, a control panel will appear in front of you (in version 2.xx, the control panel looks different). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c91/b7d/856/c91b7d856b86855b27acf9f2b92e08f7.jpg" alt="image"><br><br>  Click the ‚ÄúCreate Database‚Äù button and enter the name of our database in the field. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d87/302/9dc/d873029dc57193a1dca02ecfaeff0319.jpg" alt="image"><br><br>  Everything, on this our base is created, the next step will be the interaction with this base specifically from the application. <br><br><h3>  <b>Interaction with the database from the application</b> </h3><br>  I wrote the functional part of the application, without connecting to the database, that is, it works offline, after reloading the page, all data is erased.  We need to implement the recording of the created data in the database, and extracting them from there when downloading the application. <br>  Having combed the official documentation, I found a plugin written for pure JavaScript, as well as for jQuery.  I decided to use jQueryPlugin. <br><br>  It is located in the CouchDB assembly that we downloaded, you can find it at <a href="http://127.0.0.1/">127.0.0.1</a> : 5984 / _utils / script / jquery.couch.js <br><br><h3>  <b>Writing data to the database</b> </h3><br>  After the application creates a model of our data, we need to write them to the database.  The first step is to specify the host and port of the database: <br><br><pre> <code class="javascript hljs">$.couch.urlPrefix = <span class="hljs-string"><span class="hljs-string">"http://localhost:5984"</span></span>;</code> </pre><br>  To access the database, use the following function <br><br><pre> <code class="javascript hljs">$.couch.db(‚Äútodo_model‚Äù).method</code> </pre><br>  We need a saveDoc method - which overwrites the document in the database if it has the same id as the document at the entrance and creates a new one if the id does not match any of the existing ones. <br><br>  Next, you need to cycle through each element of the application model, and write it into the database. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; $scope.list.items.length; i++){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> doc = $scope.list.items[i]; doc._id = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(doc._id); $.couch.db(<span class="hljs-string"><span class="hljs-string">"todo_model"</span></span>).saveDoc(doc, { <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data); }, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(status); } }); }</code> </pre><br>  <i><u>* The application was built using the framework AngularJS.</u></i>  <i><u>For real purposes, it is not recommended to use AngularJS and JQuery in conjunction.</u></i> <br><br>  Documents appeared in the database, which are stored in JSON format. <br><br><img src="http://i.imgur.com/3WipRzM.jpg" alt="image"><br><br>  Thus, using the JQueryCouchDB plugin, you can easily write data to the database.  You can also get them from there, but I decided to show a slightly different way that you can use without connecting any third-party plug-ins. <br><br><h3>  <b>HTTP request to CouchDB</b> </h3><br>  When I load the page, I send a request to the server where our database is located, in response, I receive a JSON structure with the necessary data: <br><br><pre> <code class="javascript hljs"> $http.get(<span class="hljs-string"><span class="hljs-string">'http://127.0.0.1:5984/todo_model/_all_docs'</span></span>).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    $scope.model_len = response.data.rows.length //    for (var i = 0; i &lt; $scope.model_len; i++) { var p = response.data.rows[i].id //  id   $http.get('http://127.0.0.1:5984/todo_model/' + p ).then(function(data){ //       id model.items.push(data.data) }); } });</span></span></code> </pre><br>  I get all the elements, for fixing their number, after which I ‚Äúpush‚Äù each element into the model. <br><br><h3>  <b>Conclusion</b> </h3><br>  There is little documentation on this DBMS, I showed one of the way to work with it, and, I hope, helped someone. </div><p>Source: <a href="https://habr.com/ru/post/323334/">https://habr.com/ru/post/323334/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323322/index.html">Marketing email marketing: the main metric that you safely forgot about</a></li>
<li><a href="../323324/index.html">What is new in approaches to automated testing? We find out on March 15 in St. Petersburg</a></li>
<li><a href="../323328/index.html">How to change a closed information system for themselves without involving a vendor. Unsolvable problem solving with Google Chrome</a></li>
<li><a href="../323330/index.html">The most useful Linux command line tricks</a></li>
<li><a href="../323332/index.html">Nobody is better than us modernizing our state bodies.</a></li>
<li><a href="../323336/index.html">Threat models based on user behavior analysis</a></li>
<li><a href="../323338/index.html">Corporate mobile security and user access control</a></li>
<li><a href="../323342/index.html">What's going on in the world of HR technology: 9 startups and tools that are worth watching</a></li>
<li><a href="../323344/index.html">How we did the ecosystem - a single ‚Äúlanguage‚Äù of design for the front end of dozens of related systems</a></li>
<li><a href="../323346/index.html">Read binary files of iOS applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>