<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Non-visual methods to protect the site from spam. Part 3. Repeats</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuation of the article Non-visual methods to protect the site from spam 

 Part 3. Duplicate substrings 
 As already mentioned, non-visual method...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Non-visual methods to protect the site from spam. Part 3. Repeats</h1><div class="post__text post__text-html js-mediator-article">  Continuation of the article <a href="https://habrahabr.ru/company/cleantalk/blog/282586/">Non-visual methods to protect the site from spam</a> <br><br><h1>  Part 3. Duplicate substrings </h1><br>  As already mentioned, non-visual methods of protecting the site from spam use text analysis.  One of the most frequently encountered spam signals is the presence of duplicate lines.  As always, the examples given are taken from the real data of the company <a href="https://cleantalk.org/">CleanTalk</a> . <br><br>  The search for such repetitions should be minimally resource-intensive.  It is better if it will be called after the tests from parts 1 and 2 of the article, which will eliminate obvious spam and bring the text into a form suitable for analysis.  Here I will give some statistics, as well as sample code. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  1. Sample code </h2><br>  The function we use to determine the longest repeating substrings is made using the naive algorithm described here <a href="http://algolist.manual.ru/search/lrs/naive.php">http://algolist.manual.ru/search/lrs/naive.php</a> <br><br>  An example of the output is shown below. <br><br> <b><code>s  a  l  e     f  o  r     s  a  l  e     f  o  r     s  a  l  e <br> 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 <br> <br> s  0   +  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  .  .  . <br> a  1   .  +  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  .  . <br> l  2   .  .  +  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  . <br> e  3   .  .  .  +  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  + <br> 4   .  .  .  .  +  .  .  .  +  .  .  .  .  +  .  .  .  +  .  .  .  . <br> f  5   .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  . <br> o  6   .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  .  .  .  .  .  . <br> r  7   .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  .  .  .  .  . <br> 8   .  .  .  .  .  .  .  .  +  .  .  .  .  +  .  .  .  +  .  .  .  . <br> s  9   .  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  .  .  . <br> a 10   .  .  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  .  . <br> l 11   .  .  .  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  +  . <br> e 12   .  .  .  .  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  .  .  + <br> 13   .  .  .  .  .  .  .  .  .  .  .  .  .  +  .  .  .  +  .  .  .  . <br> f 14   .  .  .  .  .  .  .  .  .  .  .  .  .  .  +  .  .  .  .  .  .  . <br> o 15   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  +  .  .  .  .  .  . <br> r 16   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  +  .  .  .  .  . <br> 17   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  +  .  .  .  . <br> s 18   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  +  .  .  . <br> a 19   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  +  .  . <br> l 20   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  +  . <br> e 21   .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  + <br> <br> $VAR1 = { <br> 'sale' =&gt; 3, <br> 'for sale' =&gt; 2 <br> };</code></b> <br> <br>  The pluses on the diagonals are marked with pluses.  It can be seen that the number of repetitions is equal to the number of segments of the diagonals of adjacent pluses parallel to the main one and having the same vertical displacement. <br><br>  In the implementation of the algorithm, the actual search for duplicate characters takes a bit.  More time is done exactly the analysis of the diagonals of the matrix with the allocation of substrings.  For this, a threshold of minimum repetition length was introduced.  Also had to take into account repetitions, starting with spaces.  It was also necessary to ensure that repetitions do not overlap.  Finding repetitions is done from short to long. <br><br>  And here is the Perl function itself with minimal changes.  For convenience, the full text that displays the matrix above. <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use strict; use utf8; use Data::Dumper; binmode(STDOUT, ':utf8'); my $min_longest_repeat_length = 4; my $message = 'sale for sale for sale'; my %longest_repeates = (); get_longest_repeates(\$message, \%longest_repeates); print Dumper(\%longest_repeates); sub get_longest_repeates { my $test_ref = shift; #      my $reps_ref = shift; #     my @symbols = split //, $$test_ref; my $m_len = scalar @symbols; my @matrix = (); #     #       for (my $i = 0; $i &lt; $m_len; $i++) { #  $matrix[$i] = []; for (my $j = $i; $j &lt; $m_len; $j++) { #       $matrix[$i][$j] = 1 if $symbols[$i] eq $symbols[$j]; } } #           my %repeats_tmp = (); #   my ($i, $j); #    , ..      for ($i = $m_len - 1; $i &gt; 0; $i--) { my $repeat = ''; my $repeat_pos = undef; my $repeat_temp; for ($j = $i; $j &lt; $m_len; $j++) { if (defined($matrix[$j-$i][$j]) &amp;&amp; $matrix[$j-$i][$j] == 1) { $repeat_temp = $repeat; $repeat_temp =~ s/^ //; #          if (defined($repeats_tmp{$repeat_temp})) { $repeat_pos = $j - length($repeat_temp); $repeats_tmp{$repeat_temp}{$repeat_pos} = 1; $repeat = $symbols[$j]; } else { $repeat .= $symbols[$j]; } } else { if ($repeat ne '') { $repeat =~ s/^ //; $repeat_pos = $j - length($repeat); if (length($repeat) &gt;= $min_longest_repeat_length) { if (defined($repeats_tmp{$repeat})) { $repeats_tmp{$repeat}{$repeat_pos} = 1; } else { $repeats_tmp{$repeat} = {$repeat_pos =&gt; 1}; } } $repeat = ''; } } } if ($repeat ne '') { $repeat =~ s/^ //; $repeat_pos = $j - length($repeat); if (length($repeat) &gt;= $min_longest_repeat_length) { if (defined($repeats_tmp{$repeat})) { $repeats_tmp{$repeat}{$repeat_pos} = 1; } else { $repeats_tmp{$repeat} = {$repeat_pos =&gt; 1}; } } $repeat = ''; } } foreach (keys %repeats_tmp){ $$reps_ref{$_} = 1 + scalar keys %{$repeats_tmp{$_}}; } #     print "\n"; print ' '; for (my $i = 0; $i &lt; $m_len; $i++) { print ' ' . $symbols[$i]; } print "\n"; print ' '; for (my $i = 0; $i &lt; $m_len; $i++) { printf '%3d', $i; } print "\n"; print "\n"; for (my $i = 0; $i &lt; $m_len; $i++) { print $symbols[$i]; printf '%3d ', $i; for (my $j = 0; $j &lt; $m_len; $j++) { my $value = '.'; $value = '+' if (defined $matrix[$i][$j] &amp;&amp; $matrix[$i][$j] == 1); printf(' %1s', $value); } print "\n"; } print "\n"; }</span></span></code> </pre> <br><br><h2>  2. Repeat statistics </h2><br>  We have chosen the threshold of the minimum repetition length (I do not specifically cite it), which gave maximum efficiency in tests.  His results in the number of repetitions are as follows: <br><br><table><thead><tr><th>  Number of repetitions </th><th>  In spam,% </th><th>  Not spam,% </th></tr></thead><tbody><tr><td>  2 </td><td>  78.58 </td><td>  90.28 </td></tr><tr><td>  3 </td><td>  11.93 </td><td>  4.86 </td></tr><tr><td>  four </td><td>  4.45 </td><td>  2.08 </td></tr><tr><td>  five </td><td>  2.30 </td><td>  1.39 </td></tr><tr><td>  6 </td><td>  1.93 </td><td>  0 </td></tr><tr><td>  7 </td><td>  0.22 </td><td>  0 </td></tr><tr><td>  eight </td><td>  0.37 </td><td>  0 </td></tr><tr><td>  9 </td><td>  0.07 </td><td>  0 </td></tr></tbody></table><br><br><h2>  3. Conclusion </h2><br>  I showed the implementation of a naive algorithm for finding duplicate substrings in a text.  For the analysis, you can use both the number of repetitions and the repetitions themselves (for example, by stop words).  I repeat that complex tests are most effective in the fight against spam. </div><p>Source: <a href="https://habr.com/ru/post/301302/">https://habr.com/ru/post/301302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301292/index.html">Yum, cheat sheet</a></li>
<li><a href="../301294/index.html">In Russia, launched the first accelerator for FMCG startups</a></li>
<li><a href="../301296/index.html">Air quality control (CO2 and temperature) in the office and at home, with their own hands</a></li>
<li><a href="../301298/index.html">Asynchronous Symphony: JavaFX Tasks and Netty Sockets</a></li>
<li><a href="../301300/index.html">How to create your own VPS hosting from scratch and start making money on it (introduction)</a></li>
<li><a href="../301304/index.html">I2P: Accelerating Asymmetric Cryptography with Spreadsheets</a></li>
<li><a href="../301306/index.html">Google-oriented programming</a></li>
<li><a href="../301310/index.html">Do-it-yourself travel planner for a couple of hours</a></li>
<li><a href="../301312/index.html">LinkedIn: just another resume site</a></li>
<li><a href="../301314/index.html">JS Programming Contest: Word qualifier (addition)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>