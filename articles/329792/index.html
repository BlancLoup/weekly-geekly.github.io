<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SCCM Inventory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the word ‚Äúinventory‚Äù, an ordinary person recalls the situation when, when he entered the store, you see a sign on the closed door and you think tha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SCCM Inventory</h1><div class="post__text post__text-html js-mediator-article">  At the word ‚Äúinventory‚Äù, an ordinary person recalls the situation when, when he entered the store, you see a sign on the closed door and you think that you will have to go through several more houses, and at worst quarters, to buy what you need.  An unusual person working with Microsoft System Center Configuration Manager, at the mention of the word, presents a bunch of problems associated with the reliability of the results.  About their decision we will talk under the cut. <br><br><img src="https://habrastorage.org/web/84d/905/f40/84d905f40465451cbe4d7a19a5b9c2a7.jpg"><br><a name="habracut"></a><br>  <i>I give the word to the author.</i> <br><br>  Hello colleagues.  Each administrator working with Microsoft System Center Configuration Manager (hereinafter referred to as ConfigMgr) daily uses the inventory functionality (Inventory).  This is the basic functionality that collects data about the managed environment and in the future it is used to build collections, queries, reports.  With the seeming ease of setting up and using the inventory functionality, ConfigMgr administrators face constant problems with the accuracy of the results obtained.  The task of the article is to give a complete understanding of how the inventory works, how to identify and how to solve problems.  In fact, I will try to consider as much as possible the ‚Äúwhat is under the hood‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Disclaimer </h2><br>  Before we go deep, you need to discuss a little disclaimer.  ConfigMgr works with both Windows operating systems, and Linux / Unix (using nanoWbem), with mobile systems.  ConfigMgr was originally developed as a product for managing Windows OS, so for full technical coverage in the article we will consider only customers running Windows.  If there is an interest in understanding how inventory works for Linux / Unix - write in the comments, think about writing an article.  We now turn to the most interesting. <br><br><h2>  Let's go to inventory </h2><br>  ConfigMgr has two different types of inventory - hardware inventory ( <a href="https://docs.microsoft.com/ru-ru/sccm/core/clients/manage/inventory/introduction-to-hardware-inventory">in Russian documentation</a> - hardware inventory) and software inventory ( <a href="https://docs.microsoft.com/ru-ru/sccm/core/clients/manage/inventory/introduction-to-software-inventory">respectively,</a> software inventory).  In the article I will use English-language titles.  The key point here is that, in essence, "the name does not match the content."  And this is the reason for one of the main mistakes of administrators.  In essence, hardware inventory is <a href="https://en.wikipedia.org/wiki/Windows_Management_Instrumentation">WMI</a> inventory, and software inventory is file inventory (collection of file properties using a given mask).  That is why the list of installed software ConfigMgr collects through hardware inventory - this information is in the WMI classes (partly in the default, partly in the ConfigMgr client WMI classes). <br><br>  In practice, hardware inventory is more used and more critical for the success of everyday tasks.  Therefore, in this article, we closely examine it. <br>  To use this functionality, it is necessary that the client settings (client settings -&gt; Hardware inventory) on the Primary site side be set to ‚Äúenable‚Äù, a schedule is set, WMI classes are selected, information from which must be collected (some of the classes are enabled by default).  A full description of the WMI classes is on <a href="https://msdn.microsoft.com/en-us/library/aa394388(v%3Dvs.85).aspx">MSDN</a> . <br><br>  ConfigMgr uses the Configuration.mof file located in \ inboxes \ clifiles.src \ hinv, which specifies the classes used by the WMI provider, WMI.  When a client on a schedule accesses the server (to the management point - management point), it downloads the policy to which this file is attached and compile it locally.  After that, based on the schedule, the ConfigMgr client starts the hardware inventory process (hereinafter referred to as hinv). <br><br>  Here it is necessary to make a small digression.  ConfigMgr client consists of an engine (engine) and agents, each of which is responsible for a specific functionality.  At the same time, the ConfigMgr client uses trigger codes (you can see the list <a href="https://blogs.technet.microsoft.com/charlesa_us/2015/03/07/triggering-configmgr-client-actions-with-wmic-without-pesky-right-click-tools/">here</a> ) to launch any actions with its agents.  To run the hinv agent, use the trigger code {00000000-0000-0000-0000-000000000001}. <br><br>  The following sequence of actions will occur on the client: <br><img src="https://habrastorage.org/web/7a0/fab/f91/7a0fabf91cfb43da954571b9ee379b8c.png"><br><br>  <b>1. Run hinv on a schedule</b> .  In inventoryagent.log will be the following entry: <br><blockquote>  <i>Inventory: Opening store for action {00000000-0000-0000-0000-000000000001} ...</i> <i><br></i>  <i>Inventory: Action = Hardware, ReportType = Delta, MajorVersion = 1, MinorVersion = 5</i> </blockquote><br>  <b>ReportType</b> - type of report sent to the Primary site (Delta or FULL).  FULL - the report will contain all the information that has been collected (the default is sent at the first inventory).  Delta is a report that contains only changes since the previous hinv.  Using the Delta report allows you to reduce the size of information sent over the network. <br><br>  <b>2. Collect data from WMI</b> : <br><blockquote>  <i>‚Ä¶‚Ä¶</i> <i><br></i>  <i>&lt;! [LOG [Collection: Namespace = \\. \ Root \ cimv2;</i>  <i>Query = SELECT __CLASS, __PATH, __RELPATH, UUID FROM Win32_ComputerSystemProduct;</i>  <i>Timeout = 600 secs.] LOG]!&gt;</i> <i><br></i>  <i>&lt;! [LOG [Collection: Namespace = \\. \ Root \ ccm \ invagt;</i>  <i>Query = SELECT __CLASS, __PATH, __RELPATH, Domain FROM CCM_ComputerSystem;</i>  <i>Timeout = 600 secs.] LOG]!&gt;</i> <i><br></i>  <i>... ............................</i> </blockquote><br>  Upon completion of the WMI survey, reporting is generated, which indicates how many WMI classes were not found on this machine.  This means that these classes were specified in the client setting for collection, but not on this client.  This information helps to understand whether there is any requested data at all on the client. <br><blockquote>  <i>Collection: 55/63 inventory data items successfully inventoried.</i> <i><br></i>  <i>Inventory: Collection Task completed in 67.422 seconds</i> <i><br></i>  <i>Inventory: 8 Collection Task (s) failed.</i> </blockquote><br>  <b>3. An xml file is generated</b> for sending to the management point.  The file is generated in the% WinDir% \ CCM \ Inventory \ Temp folder: <br><blockquote>  <i>Inventory: Temp report = C: \ SMS_CCM \ Inventory \ Temp \ 1870d2e7-631c-49e3-87f2-60b90bc1d410.xml InventoryAgent</i> <i><br></i>  <i>Inventory: Starting reporting task.</i>  <i>Inventoryvent</i> <i><br></i>  <i>Reporting: 88 report entries created.</i>  <i>Inventoryvent</i> <i><br></i>  <i>Inventory: Reporting Task completed in 0.937 seconds InventoryAgent)</i> </blockquote><br>  <b>4. The Xml file is sent to the management point and deleted (by default)</b> . <br><blockquote>  <i>Inventory: Successfully sent report.</i>  <i>Destination: mp: MP_HinvEndpoint, ID: {CF597D3C-8D61-47FC-8292-9711F5AC8430}, Timeout: 80640 minutes MsgMode: Signed, Not Encrypted</i> </blockquote><br>  If you need to save the xml (during the identification and solution of any problems), then you need to create a special "secret" file <a href="https://blogs.technet.microsoft.com/configurationmgr/2012/09/17/controlling-configuration-manager-2012-using-hidden-files/">ARCHIVE_REPORTS.SMS</a> . <br><br>  The hinv execution date is stored on the client in WMI: root \ ccm \ invagt \ C00000000-0000-0000-0000-000000000001.  Accordingly, if you need to force Full inventory, you just need to delete the record with the date of the previous hinv - ConfigMgr will automatically run FULL hinv. <br><br>  Further actions will take place at the management point: <br><img src="https://habrastorage.org/web/f51/271/3f8/f512713f84964243b834ec17c0073347.png"><br><br>  <b>5-7.</b>  <b>Management point receives the hinv report and processes it</b> .  After that, it sends to Primary site. <br><blockquote>  <i>&lt;! [LOG [Hinv Retry: ******************* Start of Task ******************* *] LOG]!&gt;</i> <i><br></i>  <i>&lt;! [LOG [Hinv: Loaded class definition map;</i>  <i>DB policy timestamp = 2016-12-28 08: 07: 10.000] LOG]!&gt;</i> <i><br></i>  <i>&lt;! [LOG [Hinv: Normalized DB policy timestamp: 20161228080710.000000 + 000.] LOG]!&gt;</i> <i><br></i>  <i>&lt;! [LOG [Hinv Sax: loading C: \ CM2012CB \ inboxes \ auth \ dataldr.box \ HinvAttachmentYNWMKIXC.xml] LOG]!&gt;</i> <i><br></i>  <i>&lt;! [LOG [Delta report from client ****, action description = Hardware] LOG]!&gt;</i> <i><br></i>  <i>&lt;! [LOG [Hinv Task: Translate report attachment to file "C: \ CM2012CB \ inboxes \ auth \ dataldr.box \ HCJ91LAV.MIF" returned 0] LOG]!&gt;</i> </blockquote><br>  <b>7 *.</b>  <b>If the Management Point is installed outside the Primary site</b> , then the MP File Dispatch Manager component (MPFDM.log) will be used. <br><br>  Actions on the Primary site: <br><img src="https://habrastorage.org/web/992/0dc/50a/9920dc50af284499ad559066ab33f27b.png"><br><br>  <b>8. The Data Loader component</b> (Responsible for hinv processing) detects new * .mif files in its inboxes \ auth \ dataldr.box root folder and moves it for further processing to the inboxes \ auth \ dataldr.box \ process \ folder. <br><br>  <b>9-10.</b>  <b>When processing the mif file, the</b> data is written to the ConfigMgr database. <br><br>  <b>9*.</b>  <b>If the mif file was rejected during processing</b> , the file is moved to the inboxes \ auth \ dataldr.box \ bad folder and stored for 14 days.  After 14 days, ConfigMgr deletes it automatically.  Accordingly, the information in the database does not fall and this is the reason for reducing the reliability, which affects all the functionality of ConfigMgr. <br><br>  When moving mif files to bad, ConfigMgr creates subfolders using the type of processing error as the folder name.  For example: <br><blockquote>  <i>InvalidMachine, NonExistentRow, MissingSystemClass, InvalidFileName, ExceedSizeLimit</i> </blockquote><br>  A detailed description of the reasons for the rejection of mif files and how to deal with this is described in the <a href="https://blogs.technet.microsoft.com/umairkhan/2014/10/01/configmgr-2012-hardware-inventory-resync-and-badmif-internals/">article Umair Khan (Support Escalation Engineer Microsoft Support)</a> .  I definitely recommend this article to anyone who works with ConfigMgr of any versions. <br><br>  Based on my experience, I can add that in Russian-speaking environments (where Cyrillic is used) there is another reason for the rejection of mif files - the discrepancy between the dimensions of the ServicePack00 field in the dbo.INSTALLED_SOFTWARE_DATA and dbo.INSTALLED_SOFTWARE_HIST tables.  By default, the ServicePack00 dimension (dbo.INSTALLED_SOFTWARE_DATA) is 255 (nvarchar), and the ServicePack00 dimension (dbo.INSTALLED_SOFTWARE_HIST) is 8 (nvarchar).  As a result, when ConfigMgr, when processing the mif file, tries to move the data to the HIST, it may not pass because of the dimension and the mif is rejected.  The correction option is a change in the dimension of the field in the HIST table.  But, it is necessary to take into account that any changes in the ConfigMgr database on the production server can be made only after thorough testing and this can lead to serious failures. <br><br>  ConfigMgr administrators should constantly monitor the process of accumulating rejected mif files.  For this, you can use operational monitoring systems available in your organization or the <a href="https://gallery.technet.microsoft.com/ConfigMgr-Inbox-Monitor-77620e1c">Inbox Monitor</a> utility. <br><br>  The hardware inventory itself is stored in the ConfigMgr database as a large number of views.  The actual hardware inventory is stored in a view starting with v_GS, historical data is stored in views starting with v_HS.  Detailed information with a description of all views is available <a href="https://technet.microsoft.com/en-us/library/dn581927.aspx">here</a> .  Using this information, you can easily obtain the required reports with minimal effort. <br><br>  I hope this article will help ConfigMgr administrators to better understand the hinv process and will give a clear understanding of how to find and eliminate failures that occur during the operation of this functionality. <br><br><h2>  about the author </h2><br><img src="https://habrastorage.org/files/225/07e/3c5/22507e3c5c524856b4c74daa6155cb20.jpeg" align="left" width="120">  <b>Andrey Petrov</b> is an IT specialist with 15 years of experience, specializing in Infrastructure Support, Cloud Computing and DevOps. <br><br>  Previous article on this topic: <a href="https://habrahabr.ru/company/microsoft/blog/326264/">How not to get confused in the abbreviations SCCM [Cheat Sheet]</a> . </div><p>Source: <a href="https://habr.com/ru/post/329792/">https://habr.com/ru/post/329792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329780/index.html">Chrome won</a></li>
<li><a href="../329782/index.html">Create your own Angular 2</a></li>
<li><a href="../329784/index.html">Node.js and cote: simple and convenient development of microservices</a></li>
<li><a href="../329786/index.html">WebVR: the rebirth of virtual reality</a></li>
<li><a href="../329788/index.html">HexRaysPyTools: decompile with pleasure</a></li>
<li><a href="../329794/index.html">Once again about storing logs in Zabbix</a></li>
<li><a href="../329796/index.html">Many pointless conversations</a></li>
<li><a href="../329798/index.html">Constructor</a></li>
<li><a href="../329804/index.html">Git: many useful and different hooks</a></li>
<li><a href="../329806/index.html">Co-marketing as a way to monetize mobile applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>