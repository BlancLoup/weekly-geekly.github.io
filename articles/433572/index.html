<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to Testing in Python. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 We continue the article about familiarity with testing in Python, which we have prepared for you as part of our course ‚ÄúPython Developer‚Äù . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to Testing in Python. Part 2</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  We continue the <a href="https://habr.com/company/otus/blog/433358/">article</a> about familiarity with testing in Python, which we have prepared for you as part of our course <a href="https://otus.pw/q4Hk/">‚ÄúPython Developer‚Äù</a> . <br><br>  <b>Testing for Django and Flask Web Frames</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are writing tests for web applications using one of the popular frameworks, for example, Django or Flask, then you should remember the important differences in writing and running such tests. <br><br>  <b>How Are They Different from Other Applications?</b> <br><br>  Think about the code you want to test in a web application.  All routes, views and models require a lot of imports and knowledge about the framework used. <br>  This is similar to testing the car, which was discussed in the first part of the tutorial: before you conduct simple tests, such as checking the operation of headlights, you need to turn on the computer in the car. <br><br>  Django and Flask simplify this task and provide a unittest-based test framework.  You can continue to write tests in the usual way, but perform them a little differently. <br><br><img src="https://habrastorage.org/webt/lj/uh/oh/ljuhoh7sksatntwvwjw1ruqlrki.png"><a name="habracut"></a><br><br>  <b>How to use the Django test runner</b> <b><br></b> <br>  The Django startapp template creates a file tests.py in your application directory.  If not already, create it with the following content: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.test <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TestCase <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Your test methods</span></span></code> </pre> <br>  The main difference from the previous examples is to inherit from <code>django.test.TestCase</code> , not <code>unittest.TestCase</code> .  The API of these classes is the same, but the Django TestCase class configures everything for testing. <br><br>  To execute the test suite, use <code>manage.py</code> test instead of unittest on the command line: <br><br><pre> <code class="bash hljs">$ python manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br>  If you need several test files, replace tests.py with the tests folder, put an empty file called <code>__init__.py</code> and create <code>test_*.py</code> files.  Django will detect and execute them. <br><br>  More information is available on <a href="https://docs.djangoproject.com/en/2.1/topics/testing/overview/">the Django documentation site</a> . <br><br>  <b>How to use unittest and flask</b> <b><br></b> <br>  To work with Flask, the application must be imported and transferred to test mode.  You can create a test client and use it to send requests to any routes in your application. <br><br>  Instantiation of a test client occurs in the setUp method of your test case.  In the following example, my_app is the name of the application.  Do not worry if you do not know what setUp does.  We will get acquainted with it in the section ‚ÄúMore Advanced Test Scripts‚Äù. <br>  The code in the test file will look like this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> my_app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTestCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> my_app.app.testing = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.app = my_app.app.test_client() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_home</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> result = self.app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Make your assertions</span></span></code> </pre> <br>  Then test cases can be performed using the <code>python -m unittest discover.</code> <br><br>  More information is available on the Flask documentation website. <br><br>  <b>More Advanced Test Scripts</b> <br><br>  Before you start creating tests for your application, remember the three main steps of any test: <br><br><ol><li>  Creation of input parameters; </li><li>  Execution of the code, obtaining data output; </li><li>  Comparing output data with an expected result; </li></ol><br>  This can be more complicated than creating a static value for source data like a string or a number.  Sometimes your application requires an instance of a class or context.  What to do in this case? <br><br>  The data that you create as source is called fixture.  Creating and re-using fixtures is a common practice. <br><br>  Running the same test several times with different values ‚Äã‚Äãin anticipation of the same result is called parameterization. <br><br>  <b>Handling Expected Crashes</b> <br><br>  Earlier, when we compiled a list of scripts for testing <code>sum()</code> , the question arose: what happens when we provide a bad value, for example, one integer or a string? <br><br>  In this case, it is expected that <code>sum()</code> will generate an error.  If an error occurs, the test will fail. <br><br>  There is a specific way to handle the expected errors.  You can use <code>.assertRaises()</code> as the context manager, and then perform the test steps inside the <code>with</code> block: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> my_sum <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sum <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestSum</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_list_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" ,       """</span></span> data = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] result = sum(data) self.assertEqual(result, <span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_list_fraction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" ,       """</span></span> data = [Fraction(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), Fraction(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), Fraction(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)] result = sum(data) self.assertEqual(result, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_bad_type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> data = <span class="hljs-string"><span class="hljs-string">"banana"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.assertRaises(TypeError): result = sum(data) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: unittest.main()</code> </pre> <br>  This test case will be passed only if <code>sum(data)</code> returns a TypeError.  You can replace TypeError with any other type of exception. <br><br>  <b>Behavior Isolation in the Appendix</b> <br><br>  In the last part of the tutorial, we talked about side effects.  They complicate unit testing, since each test run may produce a different result or worse - one test can affect the state of the entire application and cause another test to fail! <br><br>  There are some simple techniques for testing parts of an application with a lot of side effects: <br><br><ul><li>  Refactoring code in accordance with the Principle of Uniform Responsibility; </li><li>  Mocking all methods and function calls to eliminate side effects; </li><li>  Using integration tests instead of modular for this piece of the application. </li><li>  If you're not familiar with mocking, check out <a href="https://realpython.com/python-cli-testing/">great examples of Python CLI Testing</a> . </li></ul><br>  <b>Writing Integration Tests</b> <br><br>  So far, we have paid more attention to unit tests.  Unit testing is a great way to create predictable and stable code.  But in the end, your application should work on startup! <br><br>  Integration testing is needed to test the co-operation of multiple application components.  Such testing may require acting as a buyer or user: <br><br><ul><li>  Call HTTP REST API; </li><li>  Python API call; </li><li>  Call a web service; </li><li>  Run command line. </li></ul><br>  All these types of integration tests can be written in the same way as modular ones, following the pattern Introduction Parameters, Execution, Validation.  The most significant difference is that integration tests simultaneously check more components, and therefore lead to more side effects than unit tests.  In addition, integration tests require more fixtures, such as a database, a network socket, or a configuration file. <br><br>  Therefore, it is recommended to separate unit tests and integration tests.  Creating fixtures for integration, for example, a test database or test cases themselves, takes much longer than performing unit tests, so it is worthwhile to carry out integration tests before going into production instead of launching them at each commit. <br><br>  The simplest way to separate modular and integration tests is to spread them across different folders. <br><br> <code>project/ <br> ‚îÇ <br> ‚îú‚îÄ‚îÄ my_app/ <br> ‚îÇ ‚îî‚îÄ‚îÄ __init__.py <br> ‚îÇ <br> ‚îî‚îÄ‚îÄ tests/ <br> | <br> ‚îú‚îÄ‚îÄ unit/ <br> | ‚îú‚îÄ‚îÄ __init__.py <br> | ‚îî‚îÄ‚îÄ test_sum.py <br> | <br> ‚îî‚îÄ‚îÄ integration/ <br> ‚îú‚îÄ‚îÄ __init__.py <br> ‚îî‚îÄ‚îÄ test_integration.py</code> <br> <br>  You can run a specific group of tests in different ways.  A flag to specify the source directory, -s, can be added to unittest discover with a path containing tests: <br><br><pre> <code class="bash hljs">$ python -m unittest discover -s tests/integration</code> </pre> <br>  unittest will display all results in the tests / integration directory. <br><br>  <b>Testing Data-Oriented Applications</b> <br><br>  Many integration tests require backend data, for example, a database with specific values.  Imagine you need a test to verify that the application is working correctly with more than 100 clients in the database, or to check the correctness of the display of the order page, even if all the names of the goods are in Japanese. <br><br>  These types of integration tests will depend on various test fixtures to ensure their repeatability and predictability. <br><br>  Test data should be stored in the fixtures folder inside the integration tests directory to emphasize their ‚Äútestability‚Äù.  Then in the tests you can download the data and run the test. <br><br>  Here is an example of a data structure consisting of JSON files: <br><br> <code>project/ <br> ‚îÇ <br> ‚îú‚îÄ‚îÄ my_app/ <br> ‚îÇ ‚îî‚îÄ‚îÄ __init__.py <br> ‚îÇ <br> ‚îî‚îÄ‚îÄ tests/ <br> | <br> ‚îî‚îÄ‚îÄ unit/ <br> | ‚îú‚îÄ‚îÄ __init__.py <br> | ‚îî‚îÄ‚îÄ test_sum.py <br> | <br> ‚îî‚îÄ‚îÄ integration/ <br> | <br> ‚îú‚îÄ‚îÄ fixtures/ <br> | ‚îú‚îÄ‚îÄ test_basic.json <br> | ‚îî‚îÄ‚îÄ test_complex.json <br> | <br> ‚îú‚îÄ‚îÄ __init__.py <br> ‚îî‚îÄ‚îÄ test_integration.py</code> <br> <br>  In the test case, you can use the .setUp () method to load test data from the fixture file along a known path and run several tests with this data.  Remember that you can store multiple test cases in one Python file, unittest will find and execute them.  You can have one test case for each set of test data: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestBasic</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Load test data self.app = App(database='fixtures/test_basic.json') def test_customer_count(self): self.assertEqual(len(self.app.customers), 100) def test_existence_of_customer(self): customer = self.app.get_customer(id=10) self.assertEqual(customer.name, "Org XYZ") self.assertEqual(customer.address, "10 Red Road, Reading") class TestComplexData(unittest.TestCase): def setUp(self): # load test data self.app = App(database='fixtures/test_complex.json') def test_customer_count(self): self.assertEqual(len(self.app.customers), 10000) def test_existence_of_customer(self): customer = self.app.get_customer(id=9999) self.assertEqual(customer.name, u"„Éê„Éä„Éä") self.assertEqual(customer.address, "10 Red Road, Akihabara, Tokyo") if __name__ == '__main__': unittest.main()</span></span></code> </pre> <br>  If your application depends on data from a remote location, such as a remote API, make sure the tests are repeatable.  Development may be delayed due to tests that failed when the API was disabled and communication problems occurred.  In such cases, it is better to store the remote fixtures locally to call them again and send them to the application. <br><br>  <code>requests</code> library has a free response package that allows you to create response fixtures and store them in test folders.  Find out more <a href="https://github.com/getsentry/responses">on their GitHub page</a> . <br><br>  The next part will be about testing in several environments and test automation. <br><br>  THE END <br><br>  Comments / questions as always are welcome.  Here or go to <a href="https://otus.pw/8xO6/">Stas</a> on <a href="https://otus.pw/4slM/">the open day</a> . </div><p>Source: <a href="https://habr.com/ru/post/433572/">https://habr.com/ru/post/433572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433562/index.html">Checking the LibrePCB project with PVS-Studio inside the Docker container</a></li>
<li><a href="../433564/index.html">Predictive web interface behavior</a></li>
<li><a href="../433566/index.html">We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 6</a></li>
<li><a href="../433568/index.html">As in America, fighting thieves parcels</a></li>
<li><a href="../433570/index.html">The secret of the ritual ‚Äúwarming up‚Äù or why ‚Äúwarm‚Äù headphones sound ‚Äúbetter‚Äù</a></li>
<li><a href="../433574/index.html">Headphone Review Sony SBH90C: Wireless or USB Type-C?</a></li>
<li><a href="../433576/index.html">Guide on the St. Petersburg IT movement</a></li>
<li><a href="../433578/index.html">"When art connects to craft": publishers of online media about technology, AI and life</a></li>
<li><a href="../433580/index.html">Roskomnadzor plans to introduce a new blocking system worth 20 billion rubles</a></li>
<li><a href="../433582/index.html">What if the 30/70 profit sharing ceases to be the gamedev standard?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>