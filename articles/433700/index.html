<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Filter Bloom in Java using Guava</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. 

 We launched a new course - ‚ÄúAlgorithms for Developers‚Äù , designed for those to tighten their knowledge of various structures and a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Filter Bloom in Java using Guava</h1><div class="post__text post__text-html js-mediator-article">  Good day to all. <br><br>  We launched a new course - <a href="https://otus.pw/5arL/">‚ÄúAlgorithms for Developers‚Äù</a> , designed for those to tighten their knowledge of various structures and algorithms for data processing, solving algebraic problems and dynamic programming problems for various languages.  So today we are sharing a short note about the work of the Bloom filter in Java. <br><br>  <b>Introduction</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article we will look at the structure of the Bloom filter from the Guava library.  The Bloom filter is a probabilistic data structure with efficient memory usage that we can use to answer the question ‚ÄúIs this element contained in a set?‚Äù. <br><br>  There <b>are no false negatives in</b> Bloom‚Äôs filter, so if he returns false, you can be 100% sure that this element is not in the set. <br><br>  However, the Bloom filter <b>can return false positives</b> , so when returning true, there is a high probability that the element really exists in the set, but the probability is not 100%. <br><br>  To learn more about how the Bloom filter works, check out <a href="https://llimllib.github.io/bloomfilter-tutorial/">this</a> guide. <br><br><img src="https://habrastorage.org/webt/fj/qh/m-/fjqhm-uwwwp8iowxqjjkk2bahpo.png"><a name="habracut"></a><br><br>  <b>Maven addiction</b> <br><br>  We will use the Guava-implementation of the Bloom filter, so add a Guava-dependency. <br>  The latest version can be found in <a href="https://search.maven.org/classic/">Maven Central</a> . <br><br><pre><code class="java hljs">&lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">22.0</span></span>&lt;/version&gt; &lt;/dependency&gt;</code> </pre> <br>  <b>Why use a bloom filter?</b> <br><br>  Bloom filter is designed to be <b>economical and fast</b> .  When using it, we can specify the <i>probability of false positive responses, which we are ready to accept</i> , and, in accordance with the configuration, the Bloom filter will take as little memory as possible. <br><br>  Due to its economy, the Bloom filter fits easily in memory even with a large number of elements.  Some databases, including Cassandra and Oracle, use this filter for initial checking before accessing a disk or cache, for example, when a request is received for a specific ID. <br><br>  If the filter says that the ID does not exist, the database may stop processing the request and return to the client.  Otherwise, the query goes to the disk and returns the item found. <br><br>  <b>Creating a Bloom filter</b> <br><br>  Suppose we want to create a Bloom filter for no more than 500 integers, and we are tripled by a one percent (0.01) probability of false positives. <br><br>  To do this, we can use the <code>BloomFilter</code> class from the Guava library.  You must pass the number of elements reported to the filter, and the desired probability of false positives: <br><br><pre> <code class="java hljs">BloomFilter&lt;Integer&gt; filter = BloomFilter.create( Funnels.integerFunnel(), <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>);</code> </pre> <br>  Now add some numbers to the filter: <br><br><pre> <code class="bash hljs">filter.put(1); filter.put(2); filter.put(3);</code> </pre> <br>  We added only three elements and determined the maximum number of inserts - 500, so our Bloom filter should produce fairly accurate results.  Test it using the <code>mightContain()</code> method: <br><br><pre> <code class="java hljs">assertThat(filter.mightContain(<span class="hljs-number"><span class="hljs-number">1</span></span>)).isTrue(); assertThat(filter.mightContain(<span class="hljs-number"><span class="hljs-number">2</span></span>)).isTrue(); assertThat(filter.mightContain(<span class="hljs-number"><span class="hljs-number">3</span></span>)).isTrue(); assertThat(filter.mightContain(<span class="hljs-number"><span class="hljs-number">100</span></span>)).isFalse();</code> </pre> <br>  As the name implies, we cannot be 100% sure that this element really exists in the filter if the method returns true. <br><br>  In our case, when <code>mightContain()</code> returns true, 99%, that the element is in the filter, and 1%, that the result is false positive.  If the filter returns false, you can be 100% sure that the item is missing. <br><br>  <b>Bloom supersaturated filter</b> <br><br>  When designing a Bloom filter, it is important to provide a reasonably accurate value for the expected number of elements.  Otherwise, our filter will return false positives more often than we would like.  Consider an example. <br><br>  Suppose we create a filter with the desired probability of false positives equal to one percent and the expected number of elements equal to five, but then insert 100,000 elements: <br><br><pre> <code class="java hljs">BloomFilter&lt;Integer&gt; filter = BloomFilter.create( Funnels.integerFunnel(), <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>); IntStream.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100_000</span></span>).forEach(filter::put);</code> </pre> <br>  Expecting such a small number of elements, the filter will take very little memory. <br>  However, after adding a much larger number of elements, the filter becomes supersaturated and has a higher probability of producing a false positive result than the desired one percent. <br><br>  Note that the <code>mightContatin()</code> method returns true even for a value that we have not previously inserted into the filter. <br><br>  <b>Conclusion</b> <br><br>  In this quick tutorial, we looked at the probabilistic nature of the Bloom filter's data structure using the Guava implementation. <br><br>  The implementation of all these examples and code snippets can be found in the <a href="https://github.com/eugenp/tutorials/tree/master/guava">GitHub project</a> . <br><br>  This is a Maven project, so import and launch should be easy. <br><br>  <b>THE END</b> <br><br>  We are waiting for comments and questions, which, as always, you can leave here, and go on an <a href="https://otus.ru/lessons/algorithm/%3Futm_source%3Dhabr%26utm_medium%3Daffilate%26utm_campaign%3Dalgo%26utm_term%3Dprofi19.12.18">open day</a> to the course instructor <a href="https://otus.pw/Pnwk/">Mikhail Gorshkov</a> . </div><p>Source: <a href="https://habr.com/ru/post/433700/">https://habr.com/ru/post/433700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433688/index.html">How the annual review of events on YouTube began a civil war</a></li>
<li><a href="../433692/index.html">To solve the most difficult optimization tasks, just add lasers</a></li>
<li><a href="../433694/index.html">Enter on "My Circle" search by users "Toaster"</a></li>
<li><a href="../433696/index.html">The history of a single request</a></li>
<li><a href="../433698/index.html">CSS philosophy</a></li>
<li><a href="../433704/index.html">An excerpt from the novel "Endless Joke" about videophones and masks for photo and video - years before their real appearance</a></li>
<li><a href="../433706/index.html">Sandbox in Windows</a></li>
<li><a href="../433708/index.html">Welcome to the fifth Industrial Cybersecurity Meetup</a></li>
<li><a href="../433710/index.html">Placeholder for image using padding-top and percent</a></li>
<li><a href="../433712/index.html">Conversations with the "Higher Mind". Information in the brain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>