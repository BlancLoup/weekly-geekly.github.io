<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django BDD development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Programmers are very different in testing, and many do not like to write tests. The TDD process for newbies is not particularly clear - you have to wr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django BDD development</h1><div class="post__text post__text-html js-mediator-article">  Programmers are very different in testing, and many do not like to write tests.  The TDD process for newbies is not particularly clear - you have to write a test instead of the program‚Äôs functionality, which first checks it, that is, the amount of work increases.  However, over time, comes the realization that automatic testing is necessary.  For example, let's take the development process of even a simple project on django, while in the project a couple of views and models is simple.  When an application becomes cluttered with functions, it suddenly turns out that it is harder to perform such testing ‚Äî there are more clicks, you need to enter some data, etc., and this is where behavior-driven development (BDD) comes to the rescue. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f68/163/4b8/f681634b8b77c15bc4b620d431394583.png" alt="image"><br><br>  I want to talk about BDD on the example of creating a primitive application - rating sites.  The idea is trivial - the list of sites is displayed on the page, the user votes for the site, the site rises in the ranking and changes its position on the page accordingly. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, we create requirements.txt in the project's working folder, with something like this: <pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Django</span></span> git+git://github.com/svfat/django-behave splinter</code> </pre> <br><br>  Please note that in development I use my fork django-behave.  The code from the official repository refused to work, apparently due to incompatibility with current versions of programs. <pre> <code class="bash hljs">$ pip install -r requirements.txt $ django-admin.py startproject habratest $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> habratest/ $ ./manage.py startapp vote</code> </pre><br><br>  By default, the latest stable version of Django should be installed, and to start development we need to add only a few lines in settings.py: <pre> <code class="python hljs">INSTALLED_APPS = ( ... <span class="hljs-string"><span class="hljs-string">'vote'</span></span>, <span class="hljs-string"><span class="hljs-string">'django_behave'</span></span>, ) TEMPLATE_DIRS = ( os.path.join(BASE_DIR, <span class="hljs-string"><span class="hljs-string">'templates/'</span></span>), <span class="hljs-comment"><span class="hljs-comment">#     habratest/templates ) TEST_RUNNER = 'django_behave.runner.DjangoBehaveTestSuiteRunner'</span></span></code> </pre><br><br>  The first step is to display the list of sites.  To develop in the BDD-style using the tools we have, we create the habratest / vote / features and habratest / vote / features / steps folders <br><br>  Here we will describe the behavior that we want to achieve from the application.  In the features folder, create the file habra.features with the following contents: <pre> <code class="hljs sql">Feature: Habrarating Scenario: <span class="hljs-keyword"><span class="hljs-keyword">Show</span></span> a rating Given I am a visitor <span class="hljs-keyword"><span class="hljs-keyword">When</span></span> I visit <span class="hljs-keyword"><span class="hljs-keyword">url</span></span> <span class="hljs-string"><span class="hljs-string">"http://localhost:8081/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> I should see <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">contents</span></span> <span class="hljs-keyword"><span class="hljs-keyword">url</span></span> <span class="hljs-string"><span class="hljs-string">"habrahabr.ru"</span></span></code> </pre><br><br>  Not very similar to computer language, huh?  This is Gherkin.  It can describe the behavior of the program without going into the implementation.  Thus, a person who is not familiar with programming can write test tasks. <br><br>  We specify such a URL because django-behave runs a test server on port 8081. <br><br>  In the same folder we create environment.py, the code in which is executed before and after testing, and so far only ensures the efficiency of the test browser: <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> splinter.browser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Browser <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context)</span></span></span><span class="hljs-function">:</span></span> context.browser = Browser() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context)</span></span></span><span class="hljs-function">:</span></span> context.browser.quit() context.browser = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre><br><br>  Run <pre> <code class="bash hljs">$ ./manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> vote</code> </pre><br><br>  Nothing happened - the test environment does not understand what to do with the steps in the file habra.features. See the lines of yellow (or brown-yellow) color?  Feel free to copy them into habratest / vote / features / steps / habra.feature.py, it describes the implementation of the steps, and its content should look something like this: <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> behave <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> given, when, then @then(<span class="hljs-string"><span class="hljs-string">u'I should see link contents url "{content}"'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_should_see_link_contents_url</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, content)</span></span></span><span class="hljs-function">:</span></span> msg = context.browser.find_link_by_partial_href(content).first <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> msg @when(<span class="hljs-string"><span class="hljs-string">r'I visit url "{url}"'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_visit_url</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, url)</span></span></span><span class="hljs-function">:</span></span> br = context.browser br.visit(url) @given(<span class="hljs-string"><span class="hljs-string">u'I am a visitor'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_am_a_visitor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre><br><br>  Run again <pre> <code class="bash hljs"> $ ./manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> vote</code> </pre><br><br>  So, now we have to see that our test is filing, and the reason is obvious - we have not written a single line of application functional code, and there is no data in the database. <br><br>  Create a model in vote / models.py <pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VoteItem</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> url = models.URLField() rating = models.IntegerField(default=<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#      ListView      ordering = ["-rating"] def __unicode__(self): return self.url</span></span></code> </pre><br><br>  We do: <pre> <code class="bash hljs">$ ./manage.py syncdb</code> </pre><br><br>  Import to habratest / urls.py <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vote.views <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VoteListView</code> </pre><br><br>  and add to urlpatterns <pre> <code class="python hljs"> url(<span class="hljs-string"><span class="hljs-string">r'^$'</span></span>, VoteListView.as_view(), name=<span class="hljs-string"><span class="hljs-string">"index"</span></span>),</code> </pre><br><br>  in vote / views.py <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.views.generic <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ListView <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VoteItem <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VoteListView</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ListView)</span></span></span><span class="hljs-class">:</span></span> model=VoteItem template_name=<span class="hljs-string"><span class="hljs-string">"list.html"</span></span></code> </pre><br><br>  In habratest / templates / list.html our retro style template: <pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Habra rating<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ol</span></span></span><span class="hljs-tag">&gt;</span></span> {% for voteitem in object_list %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{voteitem.pk}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ voteitem.url }}"</span></span></span><span class="hljs-tag">&gt;</span></span>{{ voteitem.url }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> | Rating:{{voteitem.rating}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> {% endfor %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  When tests are run in memory, a new database is created each time, and after it is deleted, we need to fill it with some data.  To do this in the file habratest / habratest / populate.py we write: <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vote.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VoteItem VoteItem(url=<span class="hljs-string"><span class="hljs-string">"http://www.yandex.ru"</span></span>, rating=<span class="hljs-number"><span class="hljs-number">6</span></span>).save() VoteItem(url=<span class="hljs-string"><span class="hljs-string">"http://www.google.com"</span></span>, rating=<span class="hljs-number"><span class="hljs-number">5</span></span>).save() VoteItem(url=<span class="hljs-string"><span class="hljs-string">"http://www.habrahabr.ru"</span></span>, rating=<span class="hljs-number"><span class="hljs-number">6</span></span>).save()</code> </pre><br><br>  and append the import of this script in environment.py <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> habratest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> populate</code> </pre><br><br>  Now environment.py, in addition to ensuring the work of the browser, also deals with a test database. <br><br>  Run again <pre> <code class="bash hljs">$ ./manage.py <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> vote</code> </pre><br><br>  - excellent, the test is passed. But what about the rating - we need to somehow vote for the sites <br><br>  Add a new script to habra.feature: <pre> <code class="hljs pgsql"> Scenario: Vote <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a site Given I am a visitor <span class="hljs-keyword"><span class="hljs-keyword">When</span></span> I visit url "http://localhost:8081/" <span class="hljs-keyword"><span class="hljs-keyword">When</span></span> I click link contents "+" <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> I should see "Vote successful" somewhere <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> page</code> </pre><br><br>  The test environment does not know how to perform the last two steps, so we add them to steps / habra.feature.py: <pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@then(u'I should see "{text}" somewhere in page') def i_should_see_text_somwhere_in_page(context, text): assert text in context.browser.html @when(u'I click link contents "{text}"') def i_click_link_contents_text(context, text): link = context.browser.find_link_by_text(text).first assert link link.click()</span></span></code> </pre><br><br>  Then again run the tests.  Error in step When I click link contents "+".  So - we don‚Äôt have any link "+" in the template, as well as the reaction to it is not provided, which we will fix as follows (do not pay attention to the fact that the code is not protected from cheating, this is just an illustration): <br><br>  Add ‚Äúplus‚Äù to habratest / templates / list.html: <pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{voteitem.pk}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ voteitem.url }}"</span></span></span><span class="hljs-tag">&gt;</span></span>{{ voteitem.url }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> | Rating:{{voteitem.rating}} | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag"> '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">addvote</span></span></span><span class="hljs-tag">' </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">voteitem.pk</span></span></span><span class="hljs-tag"> %}&gt;</span></span>+<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Accordingly, we create a primitive view for addvote in vote / views.py: <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.shortcuts <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_to_response <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addvote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, pk)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_to_response(<span class="hljs-string"><span class="hljs-string">'successful.html'</span></span>, context)</code> </pre><br><br>  add it to urls.py, <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vote.views <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VoteListView, addvote</code> </pre><br><br>  and <pre> <code class="python hljs"> url(<span class="hljs-string"><span class="hljs-string">r'^plus/(?P&lt;pk&gt;\d+)/$'</span></span>, addvote, name=<span class="hljs-string"><span class="hljs-string">'addvote'</span></span>),</code> </pre><br><br>  And templates templates / successful.html: <pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Habra rating<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Vote successful<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We run tests - everything should be successful. <br><br>  And now we will write a test to check the performance of the rating increase.  We should see the changes in the list when voting, here we will use the fact that we know the original data (which made populate.py), because y habrahabr.ru rating = 6, when clicking on "+" its rating should change by one, and according to the previous scenario, its rating should be equal to "7". <pre> <code class="hljs pgsql"> Scenario: Vote <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a site <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> look at the rating Given I am a visitor <span class="hljs-keyword"><span class="hljs-keyword">When</span></span> I visit url "http://localhost:8081/" <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> I should see "Rating:7" somewhere <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> page</code> </pre><br><br>  Again the last step is not performed.  To fix this, we add the addvote view: <pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addvote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, pk)</span></span></span><span class="hljs-function">:</span></span> item = VoteItem.objects.get(pk=pk) item.rating += <span class="hljs-number"><span class="hljs-number">1</span></span> item.save() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_to_response(<span class="hljs-string"><span class="hljs-string">'successful.html'</span></span>)</code> </pre><br><br>  We check now the test is successful. <br><br>  So, continuing to write tests for gherkin (which, as I said above, even a person not familiar with programming can do) we will actually create part of the technical task and, at the same time, acceptance testing of our application. <br><br>  I wrote this article, since there is practically no information on BDD with django in Russian, and if experts in this matter suddenly read it, do not be lazy, write about your practice in the comments.  It will be useful to all.  I am pleased to accept your comments, corrections and criticism.  Thank! <br><br>  What else to read: <br>  <a href="http://pythonhosted.org/behave/">Behave documentation</a> <br>  <a href="http://splinter.cobrateam.info/">Splinter - test framework for web applications</a> <br>  <a href="http://cilliano.com/2011/02/07/django-bdd-with-lettuce-and-splinter.html">Django Full Stack Testing and BDD with Lettuce and Splinter</a> <br></div><p>Source: <a href="https://habr.com/ru/post/219665/">https://habr.com/ru/post/219665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219653/index.html">As we were beaten by current on April 1</a></li>
<li><a href="../219655/index.html">Automate acceptance testing for Android applications using Calabash</a></li>
<li><a href="../219657/index.html">String theory for guitarists</a></li>
<li><a href="../219659/index.html">Review of the home robot ver 0.3</a></li>
<li><a href="../219661/index.html">Debugging a Java application when it doesn't wait at all - welcome to the InTrace approach</a></li>
<li><a href="../219669/index.html">How to get data on 5 million companies via the LinkedIn REST API or why it is better to allow OAuth to use Request Token only once</a></li>
<li><a href="../219673/index.html">Spreading the open innovation business model using the API</a></li>
<li><a href="../219675/index.html">The value of an online brand: case distributors and industrialists</a></li>
<li><a href="../219677/index.html">Edward Snowden used the TAILS distribution</a></li>
<li><a href="../219679/index.html">Part one, and the second part still nobody reads</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>