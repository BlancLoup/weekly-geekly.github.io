<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy weekend or "wheelbarrow for pumping"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, I said: " I personally don‚Äôt care about tying a car ... ", but "never say" never "." The stars stood up in such an order that they had ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy weekend or "wheelbarrow for pumping"</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/2f8/00b/d97/2f800bd9776b47d69c736dd78a937042.jpg" width="496" align="left">  Some time ago, I said: " <a href="http://habrahabr.ru/post/171613/">I personally don‚Äôt care about tying a car ...</a> ", but "never say" never "."  The stars stood up in such an order that they had to urgently change the Peugeot 307sw to a Mazda5. <br><br>  The car drives, everything is fine, but some of the ‚Äúbuns‚Äù that were in the old car nominally, for some reason were absent in the current one. <br><br>  One of these useful things - parking sensors.  Installing parking sensors is not a problem, but somehow the ‚Äúnon-native‚Äù display of parking sensors did not suit me in the cabin.  The inner perfectionist was terribly against the "alien body." <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For some time I googled and found out that several years ago, one comrade from St. Petersburg made a special ‚Äúsupplement‚Äù, which was connected to the parking sensors on the one hand and to the car on the other.  And at the same time information from the PDC was displayed on a regular display. <br><div class="spoiler">  <b class="spoiler_title">There was even a video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/E6-DpT1hA98" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br>  It would seem that it is necessary to buy, deliver and relax, but that project ‚Äúdied‚Äù, the author doesn‚Äôt come to the contact: you cannot buy it. <br><br>  But this is not our method ... since it is impossible to buy, it means that you can ‚Äúreinvent‚Äù (and pump up your microcontroller programming skills). <br><br><h1>  Part One: Parktronic </h1><br>  At first it was necessary to choose parking sensors.  In the original project, Parkmaster was used (a model that was already completely unavailable - discontinued).  I had to choose from what can be freely purchased.  The choice fell on the Parkmaster 4-DJ-06 (the same brand - there was a hope that ‚Äúsomeone had already picked it up, it means I can too,‚Äù but compared to the original model, ‚Äúthe speed of detection of obstacles was improved, stability was improved, and sensors New design with effective water drainage, etc. "). <br><br>  The first thing that was done was the display disassembled and the cable connection to it was studied.  It was found that the display is connected by 5 wires: GND, + 5V, DATA, CS, CLK.  Those who are familiar with the <a href="https://ru.wikipedia.org/wiki/Serial_Peripheral_Interface">SPI</a> bus will immediately notice some similarities (for the DTC = MOSI).  The connection of the display with the main unit is one-way (the main unit is the master, the display is the slave), therefore one single conductor (MISO) is missing from the ‚Äúfull‚Äù SPI. <br><br>  Connecting an oscilloscope fully confirmed this hypothesis: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/487/ae5/c4e/487ae5c4ed894c3d9d4a8740d53249d8.png"></div><br>  Channel A - CS, B - CLK, D - DATA. <br><br>  Next - a matter of technology: it was necessary to figure out how to "remove" all the code parcels and decode what is transmitted there. <br><br>  I <a href="http://habrahabr.ru/post/249409/">have already spoken</a> about reverse engineering of the protocol of another PDC, so I will not describe it like this, just give a link to <a href="http://arduino.ru/forum/apparatnye-voprosy/rebyata-pomogite-podklyuchit-datchiki-parkovki-ot-parktronika-k-arduino%3Fpage%3D3">the forum thread</a> where the truth was born for my particular case (there is also a code with which the code packages were captured). My nickname on that forum is ustas). <br><br>  The work was quite routine, but in order to make everything ‚Äúbeautiful and interesting‚Äù I used two interruptions.  The first interrupt monitored CS, the second - for CLK.  There was nothing more interesting in this part. <br><br>  A couple of days off, a few evenings, and I had a ready-made prototype on a layout (with arduino-nano), which confidently received data from the main parking sensor unit and produced their decoding.  The choice of parking sensors was justified - even the levels were not coordinated. <br><br>  After that, parking sensors were installed in the car and the main development site moved there. <br><br><h2>  Part Two: Listening </h2><br>  At the same time, I learned a lot of new things about the fact that almost all modern machines are to a large extent ‚Äúcomputers‚Äù on wheels, even a ‚Äúnetwork of computers‚Äù: since almost all more or less ‚Äúsmart‚Äù units are connected to a single <a href="https://ru.wikipedia.org/wiki/Controller_Area_Network">CAN bus</a> and use it to ‚Äúcommunicate‚Äù between themselves". <br><br><blockquote>  In general, cars usually have two tires: HS-CAN and MS-CAN (high-speed and medium-speed tires, respectively).  The first relates to the operation of the engine and adjacent systems, the second - it is also called the ‚Äúcomfort tire‚Äù - refers to various service functions (music system, tidy, lighting, climate, doors, etc.). </blockquote><br>  In my car, the display is just connected to the MS bus ‚Äî this bus has become the ‚Äútarget‚Äù for my project.  Of course, need more information.  Manufacturers, of course, have all the necessary information, but are in no hurry to share it (although the situation is <a href="http://habrahabr.ru/post/226131/">beginning to change</a> , but not in my case). <br><br>  The starting point was <a href="http://www.madox.net/blog/projects/mazda-can-bus/">this page</a> , which presents some message identifiers and what data is encoded in these messages.  In the comments to this entry, too, there were useful notes. <br><br>  Before sending something to the bus, I decided that first I should ‚Äúlisten‚Äù to my car and make sure that the information presented was true. <br><br>  Since the corresponding shield with the CAN interface was not at hand, the Arduin had to be abandoned (and anyway, I decided to make the appropriate device for installation in the car) - I parted a simple board that contained a MK (atmega328p) CAN bus controller (MCP2515 / MCP2551), beeper ... and ... watch module. <br><br><blockquote>  <i>What not to collect on avr, but in the end the clock still turns out</i> <br>  from amateur radio forums </blockquote><br>  Well, who would have thought that a car that was made in this millennium has a watch, but no calendar?  Since I'm still a sclerotic, I decided that the calendar would not hurt me for sure, so DS1307 also ‚Äúregistered‚Äù on the device board. <br><br>  The device circuit does not at all shine with some originality: the typical inclusion schemes of all components (from their datasheets) are used.  Just in case, I brought almost all free I / O ports to an additional connector (what if something else comes to mind during the implementation process?).  Naturally, for the programmer, I spread the ICSP. <br><br>  It was decided to take the <a href="http://mcuguru.ru/2014/05/auto-usb/">power</a> from <a href="http://mcuguru.ru/2014/05/auto-usb/">USB charging</a> , so there is a miniUSB connector on the board.  An additional cable was laid from the parking sensors unit (during its installation) that ‚Äúduplicates‚Äù the main cable between the display and parking sensors (so that you can have both a full parking sensor display driver and my ‚Äúproduct‚Äù at the same time).  The cable took the first one ... But you will not be very surprised to learn that it turned out to be a long patchcord?  Therefore, the board has a corresponding connector (black, on the left).  The form of the board dictated the existing case. <br><br><div class="spoiler">  <b class="spoiler_title">Eagle, LUT, ferric chloride and the list goes on ...</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/5ce/b79/97b/5ceb7997b3e74631bfb91630cb318ba1.jpg"></div></div><br>  At the first stage I decided (for simplicity) to connect to the diagnostic connector, the benefit of which is the MS-bus.  Where exactly the connector should be looked for, <a href="http://forscan.org/forum/viewtopic.php%3Ff%3D4%26t%3D4">peeped here</a> . <br><br>  With the hardware, I hope everything is clear ... go to the software.  To work with the CAN-bus I used the <a href="https://github.com/Seeed-Studio/CAN_BUS_Shield">finished library</a> .  Test cases helped a lot - they allowed you to start listening at once.  The only thing that had to be corrected was to indicate the correct MS-bus speed (CAN_125KBPS) in the sketch. <br><br>  The data on where to look for the display messages was fully confirmed (to check it, I turned on the head unit in radio mode and chose a radio station which, through RDS, only output its name and then found the corresponding parcels).  There were two parcels in which this name was coded (in the first parcel - the first 7 characters, in the second - the remaining 5 characters). <br><br><h2>  Part Three: Speak </h2><br>  The first attempts to send messages to the display failed.  The standard auto display just ignored my packages. <br><br>  In order to deal with this problem (and for convenience) - on the "disassembly" acquired the display from Mazda3 (much more common spare part than the similar one from Mazda5).  The most noticeable difference between displays is the color of the backlight (Mazda5 is green, Mazda3 is red).  The rest is almost identical, and I hoped that the differences were only ‚Äúcosmetic‚Äù (and it turned out to be right). <br><br>  I gathered at home a small test stand consisting of my device and this display.  Working out on a stand is much more comfortable than in a car, in winter outside. <br><br>  In parallel, I found a wonderful comment: <br><blockquote>  You can send the 3 frames with the following IDs: <br>  0x28F: 0x28f frame LCD settings. <br>  0 √ó 290: 0xC0 (first byte) followed by first 5 alfanum signs <br>  0 √ó 291: 0 √ó 85 (first byte) followed by the next 7 alfanum signs <br><br>  all of them, just after you get the 0 √ó 291 frame id sent by the HU.  Flicker at all. <br>  0x280 and 0x291 text, it seems to simply ignore the 0x280 and 0x291. <br>  150ms interrupt and send 3 frames described above. <br><br>  ... <br><br>  0x28F frame content that I have used: <br>  hex: D1 00 00 00 80 00 00 01 </blockquote><br>  Thus, in order for the display to display the transmitted text, it is necessary to transmit <b>three</b> parcels (at the first tests I transmitted only two, and because of this, the display refused to display my text). <br><br>  But for some reason at home on the stand and the correct sequence did not work out - the display remained empty.  I went to the car: the same code worked perfectly.  He began to understand and realized that for the test bench there was not enough a 120 Ohm resistor on the bus (between CAN-H and CAN-L).  Once put this resistor - the display "came to life." <br><br><h2>  Part Four: Logic </h2><br>  I am very cautious about various ‚Äútuning‚Äù and I believe that if I do it, it is only in such a way that it looks like ‚Äúregular functionality‚Äù. <br><br>  Observing the work of the regular display prompted the logic that I wanted to implement: as soon as the display does not change the inscription for more than 5 seconds, you can display ‚Äúyour‚Äù information (for example, the date), but if ‚Äúthe car wants to say something‚Äù (new information ) - immediately remove the "abnormal" message and display information from the machine. <br><br>  Naturally, when parking such a logic is impossible to observe, in this case only information from the parking sensors should be displayed). <br><br>  At home I wrote the main part of the code, on the test display everything looked more or less decent.  But after a visit to the car, serious ones got out ... <br><br><h2>  Part Five: Rakes </h2><br>  The problem was that the head unit ‚Äúfloods‚Äù into the bus with its messages on the display with a period of about 150 ms (even if the information on the display has not changed).  This led to the fact that "non-standard" messages almost immediately "frayed" regular ones. <br><br>  Then began the " <s>arms</s> race messages."  I slightly changed the scheme of my device, used an interrupt to track messages on the display and immediately tried to send my message (in order to ‚Äúgrind‚Äù a regular message with my own). <br><br>  The approach might have worked at a faster MK, but the speed of the atmega was not enough - regular messages ‚Äúskipped‚Äù periodically and this led to a very messy ‚Äúmess‚Äù of messages (especially since the text is transmitted in two portions: sometimes a situation occurred that the first part of the message is from the car, and the second is from my module). <br><br>  In general, it works, but not at all as we would like. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9b5/b07/f20/9b5b07f20174450fa4fd417e4a58b965.jpg"></div><br><br>  To solve this problem, it was necessary to somehow "tear" too "talkative" radio tape recorder from the tire. <br><br>  It would be possible to put a ‚Äúrelay‚Äù that would disconnect the radio tape recorder from the CAN bus at the moments of displaying irregular information, but this would violate the logic (for example, I would start to change the volume, while the message ‚ÄúVOL 7‚Äù with the corresponding level and this message would be skipped). <br><br>  Those.  It was necessary to solve the puzzle: listen to the CAN bus, analyze the messages and send the necessary messages to the display. <br><br>  "The right question is half the answer."  I came up with the need to add a second CAN interface.  In this case, my device is turned on "in the cut" of the CAN bus between the car and the display.  The device ‚Äúlistens‚Äù to what the machine says (and generally takes everything it needs from the bus), analyzes the data and only the necessary is transmitted to the display. <br><br>  In order not to overhaul the board completely - I did the ‚Äúshield‚Äù (the divorced additional input / output ports and the ICSP just came in handy), because the CAN bus controller is connected to the MC via the SPI bus. <br><br>  It turned out such a device: <br><img src="https://habrastorage.org/files/e7b/b39/fea/e7bb39fea61b47509d351329164b79b2.jpg"><br><br>  For convenience, the ICSP made it ‚Äúpass-through‚Äù so that it would not be necessary to disassemble the ‚Äúsandwich‚Äù each time to update the firmware. <br><br><h2>  Part Six: Tests </h2><br>  At home, my prototype only "removed" the data from the camera, but nothing was done to "visualize" the result.  As soon as the main problems with the device are eliminated and the connection scheme has already been ‚Äúfixed‚Äù, it recreated the work of the parking sensor on the standard display.  It turned out like this: <br><iframe width="560" height="315" src="https://www.youtube.com/embed/gyNNjQz3kfI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  The video shows that the output is almost identical, and in some cases the information appears on the Mazda display a fraction of a second earlier (which is not bad at all). <br><br>  After the main parts of the firmware were debugged, I decided to install my development in the machine in order to arrange a serious test operation. <br><br>  And then the following problem was revealed: <br><img src="https://habrastorage.org/files/6df/8da/572/6df8da5727cc4263b295a2fe5be4a8ff.jpg"><br><br>  Missing information unit climate control (right side of the display).  As it turned out, this is not the only loss - the trip computer also refused to show its information. <br><br>  This was not a big surprise, since in the firmware I ‚Äúwatched‚Äù only the messages on the central part of the display (I received, analyzed and, if necessary, displayed), all other messages were simply ignored. <br><br>  Obviously, it was necessary to find message identifiers that contained the ‚Äúmissing‚Äù information.  It didn't take long. <br><br><div class="spoiler">  <b class="spoiler_title">The following identifiers were found.</b> <div class="spoiler_text"><ul><li>  0x38A mandatory sending, without that the route guide does not work </li><li>  0x400 route data </li><li>  0x3BA climate </li><li>  0x201 current parameters (speed, speed) </li></ul></div></div><br><br>  After the rules for the live broadcast of messages with these identifiers on the display were added to the firmware code, everything worked as it should. <br><br><h2>  Part Seven: "... and jumped!" </h2><br>  In the process of searching for various information, I registered on the Mazda5 owners forum - shared my experience, showed how it works.  It turned out that this project is interesting not only for me.  The conference helped to find the necessary information, suggested possible functions. <br><br>  During the discussion, it turned out that not all trim levels have a trip computer, but replacing the display with another one adds this function.  This indicated that the data was in the bus, and the display function was implemented in some configurations, in others it was not (and this is realized in the display firmware). <br><br>  I checked this hypothesis and made sure that it is correct.  Simply enough to get the following data: <br><ul><li>  average speed, </li><li>  instant fuel consumption </li><li>  average fuel consumption </li><li>  power reserve on the remainder of the fuel. </li></ul><br>  "Digging" a little deeper - found more and current data: speed, engine speed. <br><br><div class="spoiler">  <b class="spoiler_title">In general, the data retrieval process should be described in more detail - this may seem interesting (and useful for such re-engineering).</b> <div class="spoiler_text">  The first look at this task is scary: there are many messages with different identifiers on the bus and it‚Äôs quite difficult to track which of them has changed.  But it turned out that with the right approach, the task can be significantly simplified.  I acted as follows (for example, when searching for data on the state of the parking brake): <br><ul><li>  included logging of all messages (so that the amount of data for analysis was not too large - limited the time interval to 5-10 seconds), </li><li>  in the time allotted for the test, he raised and lowered the handbrake, </li><li>  the data was loaded into Excel, </li><li>  included "autofilter" </li><li>  found a message identifier where the data changed (for such ‚Äúatomic‚Äù actions, one bit was usually changed), </li><li>  allocated such message identifiers (usually there was one such identifier), </li><li>  included ‚Äúfiltering‚Äù in the firmware (so that only ‚Äúinteresting‚Äù messages were recorded), </li><li>  repeated the analysis with filtered data. </li></ul><br>  In the course of such research, I found out that the tire contains information on the state of all the doors of the car, parking brake, turn signals, etc. <br></div></div><br>  Once the data is there, you need to use it somehow. <br><br>  Immediately added to his module the function of notification of unclosed doors at speeds above 10 km / h. <br><blockquote>  Yes, there is a regular indicator of unlocked doors on the dashboard, but it only signals this fact, but does not specify which particular door is not closed. </blockquote><br>  Then he remembered that Peugeot had a full-time function of automatically locking doors at speed.  Obviously, the same function is also added here ... but no longer on the prototype (unfortunately, control of the central lock in Mazda is impossible via CAN-bus, although in some other machines it is quite realistic). <br><br>  Thus, the list of functions has expanded somewhat: <br><ul><li>  parking sensors </li><li>  the calendar, </li><li>  output of trip computer data, </li><li>  open door control, </li><li>  auto closing doors at speed </li><li>  autoplay music when parking (in order to better hear the PDC's ‚Äúbeeper‚Äù), </li><li>  control voltage on-board network. </li></ul><br>  Since the result of my work was interesting to the fellow users, I decided to completely redo the device circuit (making it ‚Äúsingle board‚Äù and ‚Äúself-sufficient‚Äù): I included all the necessary interfaces, powerful transistor switches, a DC / DC power converter.  At the same time made the original size of the board: <br><img src="https://habrastorage.org/files/ee7/43e/48e/ee743e48e2a64e7b89caab919cfa6e19.png"><br><br>  Naturally, all the knowledge gained in the process of creating and operating a prototype came in handy (the same 120 ohm resistor on the CAN bus for display operation). <br><br>  It turned out that all connections to the wiring of the machine could be made directly behind the display (there is a very large empty niche and all the necessary signal wires are present). <br><br>  As a ‚Äúprotection‚Äù, I made additional platforms for connecting the ‚Äúalternative‚Äù battery of the reserve module‚Äôs power supply (all of a sudden the CR1225 backup battery will ‚Äúfreeze‚Äù in winter and the clock will get stuck) and the external ‚Äútweeter‚Äù. <br><br><h2>  Part Eight: Production </h2><br>  The board turned out to be quite compact due to the fact that it switched to size 0603 (in the prototype was 0805), quite a lot of vias (although it has repeatedly optimized tracing), tracks / gaps - 0.2mm.  In principle, it was possible to make houses with LUT, but the project already took too much of my time, I decided that it would be much easier for someone to pay so that the board was made in the right quantity and the components were soldered (there were 9 interested co-users, plus for my car instead of the prototype). <br><br>  I already had a similar experience of ordering in the ‚ÄúCelestial‚Äù - entrusted it to ‚Äúmy‚Äù contractor.  It turned out relatively budget (cheaper than just buying components in Moscow stores), but not too much (small batch).  He paid for the production with funds collected from those who wanted (‚Äúmicro-crowdfunding‚Äù). <br><br>  The devices did not produce too quickly - it took almost 3 weeks.  But the post has increased the waiting period by almost a month.  But let's not talk about sad things, because it turned out well: <br><img src="https://habrastorage.org/files/6cf/549/719/6cf5497195fa4192ac05fd0e6104cd4f.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">On the reverse side of the board, there is nothing interesting: a micro-instruction on connecting.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c53/66a/0f4/c5366a0f45944fd6b4f2182e8046cdf7.jpg"></div></div><br>  Replacing the prototype with a ‚Äúfactory‚Äù product took me about half an hour (and the process was also photographed - to make it easier for users).  But not everything went smoothly: the auto-mute function of the music on my particular radio tape recorder did not work (the frugal Japanese, to my regret, did not unsolder the System Mute circuit).  But the management of the door locks started working immediately (albeit, after a rather thorough examination of the electrical circuitry of the car and the search for the ‚Äúsame‚Äù wire that is responsible for locking). <br><br><h2>  Part Nine: Settings </h2><br>  Due to the fact that the device had to be placed in machines of different configurations (and different users), it was necessary to figure out how to implement the setup mode (enabling / disabling necessary messages, functions, setting the date / time).  Of course, ‚Äúfor myself‚Äù I would not even think about this task - there is nothing easier than connecting a programmer, but not in this case.  We need to think about the "consumers" of the device. <br><br>  At the same time, according to the ‚ÄúLogic‚Äù part, everything should look as clean as possible and without adding additional buttons to the salon (even a hidden installation).  And then I remembered successfully that one can easily obtain data on the state of the doors, parking brake, ‚Äúturn signals‚Äù, moreover, the latter in the tire had a state that completely repeated the state of the lamps (the corresponding bit in the package blinked). <br><br>  I entered the settings mode according to the ‚Äúshamanic‚Äù sequence: on the standing car (zero current speed), you need to open the driver's door (monitor its condition) and raise and lower the handbrake for 15 seconds after opening the doors.  After that, ‚ÄúSETUP?‚Äù Appears on the display and, for confirmation, close the driver's door.  Those.  ‚ÄúNon-random‚Äù sequence of actions (which is unlikely to be played by someone in a car‚Äôs normal operation mode). <br><br>  Navigating through the ‚Äúsettings menu‚Äù using the direction indicator switch: left - down, right - up.  Enable / disable features / messages - handbrake. <br><br>  The verbal description looks very complicated, but in actual use everything is much simpler (in front of the car - polycarbonate fence, pay attention to the reflection - it can be seen when the ‚Äúturn signals‚Äù are used): <br><iframe width="560" height="315" src="https://www.youtube.com/embed/3MZzG-S7PJw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  In general, it was quite difficult and interesting to come up with the implementation of such a menu, when a display in one line and only 12 characters is available. <br><br>  I tested the product in my car for several days - no complaints, everything works fine. <br><br><h2>  Part ten: Continuation? </h2><br>  To date, all fees have been sent to their new owners.  As soon as they are installed, I hope I will receive additional feedback. <br>  Before sending, I managed to connect one of the boards to the Mazda CX-7 - almost everything worked right away (some of the trip computer data were encoded a little differently), but in general, the connection was successful. <br>  Now the device (with the current firmware) is checked for Mazda3, 5, 6 (where the displays are similar to those that I used in the development process). <br><br>  After adapting the firmware, I think the device can be useful on almost any modern car, where the display is displayed (or dashboard) via MS-CAN. <br><br><h2>  Part last: Arduino? </h2><br>  After reading such a long record (I apologize to those who read it), the question may arise: ‚ÄúWhat does the Arduino have to do with it?‚Äù. <br><br>  The answer is very simple: I did all the programming in the Arduino environment. <br><br>  After that, some may start ‚Äúthrowing tomatoes at me,‚Äù but my personal opinion: it‚Äôs better to use the tool that is available and familiar. <br><br>  Arduino is one such tool that, on the one hand, allows beginners to quickly and relatively easily get involved in such an interesting area as microcontroller programming, and ‚Äúsets‚Äù and ‚Äúshield‚Äù also significantly expand the scope of use of hardware in their projects ( although it is not cheap). <br>  Arduino (in my understanding) - a kind of framework for "quick start". <br><br>  Of course, the use of professional tools could help to implement the necessary functionality faster / better / more optimally (underline the necessary), but for a ‚Äúweekend project‚Äù this may be redundant. <br><br>  Dare! <br><br>  And once again for the sake of which everything was started: <br><img src="https://habrastorage.org/files/2f8/00b/d97/2f800bd9776b47d69c736dd78a937042.jpg"><br>  The display has significantly expanded its ability to display useful (and not so much) information; nothing ‚Äúalien‚Äù has been added in the cabin, while all the regular functions have been fully preserved. <br><br>  PS If there are those who wish, I will lay out the circuit, board, BOM (I will support ‚Äúopen hardware‚Äù)  <a href=""><b>Download it here</b></a> . <br>  PPS I will not upload the firmware in open access. </div><p>Source: <a href="https://habr.com/ru/post/253237/">https://habr.com/ru/post/253237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253225/index.html">MailChimp UX Team: Design [Part 4 of the Book]</a></li>
<li><a href="../253227/index.html">Deep Learning, NLP, and Representations</a></li>
<li><a href="../253229/index.html">Weekly assembly Vivaldi 1.0.129.2</a></li>
<li><a href="../253233/index.html">Boost C ++ libraries on Android</a></li>
<li><a href="../253235/index.html">About installing Crashplan in FreeNAS (and solving the Cyrillic problem)</a></li>
<li><a href="../253238/index.html">Installing and running Android applications on Linux</a></li>
<li><a href="../253240/index.html">Self assembly or purchase of ready equipment for design. 3d printer. Part 1</a></li>
<li><a href="../253246/index.html">The power of minimalism: how we changed the design of Yelp</a></li>
<li><a href="../253248/index.html">Cognitoys: IBM's Intelligent Intelligent Intelligent Toy</a></li>
<li><a href="../253250/index.html">Richard Stallman: Why we need free digital iron circuits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>