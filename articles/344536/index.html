<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Designing a site that is protected from blocking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all! In connection with the growth of locks, including unreasonable sites on the part of the state, we are offering you a description of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Designing a site that is protected from blocking</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello to all!  In connection with the growth of locks, including unreasonable sites on the part of the state, we are offering you a description of the idea, as well as a <strong>prototype of the settings of the site</strong> , protected from locks on a specific path and domain name.  Block Protection Ideas: </p><br><ul><li>  with an asterisk </li><li>  by IP address </li></ul><br><p>  will be outlined in other posts.  Who is interested in the topic, go under the cat. </p><a name="habracut"></a><br><h2 id="ssylka">  Link </h2><br><p>  <a href="http-abs/">https://github.com/http-abs/http-abs/</a> </p><br><h2 id="opisanie-idei">  Description of the idea </h2><br><p>  The principle of protection is that each user receives a unique pair from the individual (sub) domain and the prefix of the path to view the site.  Let's call this pair <em>an agent id</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Note 1</b> <div class="spoiler_text"><p>  If for some reason, you can manage only a limited set of subdomains, the user will of course share his subdomain with some other users. </p></div></div><br><h3 id="kak-eto-zaschitit-ot-blokirovki">  How does this protect against blocking? </h3><br><ul><li>  If the blocking is limited to the path and / or the exact domain, then by sending a request to block such a path and / or domain, the blocking operator will block only his own access, without affecting the interests of other users. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Note 2</b> <div class="spoiler_text"><p>  Of course, in the case of the above limitation, life will become more difficult for those users who are not lucky to share the subdomain with the lock operator.  But not much. </p></div></div><br><ul><li>  When and if you, as the site administrator, find a blockage, you can exclude (say, replace with seals) the issue of the disputed material at this address: this will not affect the issue of the same material to other users. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Note 3</b> <div class="spoiler_text"><p>  Subject to previous note. </p></div></div><br><ul><li>  Local replacement of content will give you the opportunity to try to exclude a link from the list of locks, for example, avoiding total blocking by domain name. </li></ul><br><h3 id="a-kak-zhe-togda-delitsya-ssylkami">  How, then, to share links? </h3><br><p>  Easy.  The agent identifier allocated to the user to view the site is stored in his cookie.  The user simply shares a link from the address bar. </p><br><ul><li>  If the user does not already have a corresponding cookie, clicking on the link containing the alien identifier initiates the process of allocating a new agent identifier, with a redirect to the individual URL to view the material, including this identifier. </li><li>  If the user already has a cookie with the agent identifier, clicking on the link containing the foreign identifier initiates a redirect to the individual URL for viewing the material for this user, with his own identifier. </li></ul><br><h3 id="a-zachem-sohranyat-kuku">  Why keep a cookie? </h3><br><p>  To isolate the operator locks.  If you are lucky, after several locks, it can even be identified. </p><br><h3 id="ne-uslozhnit-li-eto-zhizn-polzovatelyu">  Will it make life difficult for the user? </h3><br><p>  Not at all, nothing is literally required of him.  He enters the site in the usual way, reads materials and shares links.  In his life, only the type of the address bar changes. </p><br><h3 id="uslozhnit-li-eto-zhizn-razrabotchiku-servera">  Will it make life more difficult for a server developer? </h3><br><p>  Maybe.  It will not have to take into account the path prefix and subdomains included in the agent identifier: the handler will truncate them at the first stage of processing the incoming URL.  However, to make the process completely transparent, you may still have to work hard. </p><br><h3 id="smozhet-li-operator-blokirovok-oboyti-izolyaciyu">  Will the lock operator be able to bypass the insulation? </h3><br><p>  Of course.  But it will be much more difficult for him to prove the necessity of blocking an infinite number of references to material formed according to an intricate rule, despite the fact that the rules may change to even more intricate. </p><br><h3 id="operator-prosto-zablokiruet-vse-nafig-so-zvezdochkoy-i-adresom-ip">  The operator will simply block all nafig with an asterisk and IP address </h3><br><p>  This development is not excluded, but I want to consider these cases separately in another article.  Perhaps we will come up with something together in the comments. </p><br><h2 id="realizaciya">  Implementation </h2><br><h3 id="arhitektura">  Architecture </h3><br><p> In order to make the process as transparent as possible, the code is concentrated in the frontend server <code>nginx</code> .  This allows you to protect a variety of application servers with little or no restrictions. </p><br><p>  Since the processing of the request will be very nontrivial, the additional package <code>libnginx-mod-http-lua</code> , which introduces the <code>lua</code> language in the processing of requests under nginx. </p><br><h3 id="dopolnitelnye-usloviya">  Additional terms </h3><br><p>  Ideally, processing should be done in such a way that the back-end (uplink, application server) is not at all concerned about whether it is placed under protection.  He receives requests on the URL from which all the elements of the agent identifier are removed (let's call such <em>pure URLs</em> ).  In order not to alter the returned pages, going to a clean URL with the agent identifier cookie set, causes a redirect to the individual URL. </p><br><p>  The frontend does not store the status anywhere except the agent ID cookie. </p><br><p>  The browser does not use a single line of javascript code.  Only HTTP is used. </p><br><h3 id="ogranicheniya-alfa-realizacii">  Limitations of alpha implementation </h3><br><p>  In fact, only the proof-of-concept is implemented, which allows to observe the real operation of the algorithm.  Many details related to product packaging are not solved: modularity, selection and verification of parameters, and so on. </p><br><p>  For subdomains, a scheme with a fixed set of subdomains has been selected, suitable for use in conjunction with the <code>hosts</code> , without installing an additional DNS server. </p><br><p>  The format of the path prefix is ‚Äã‚Äãpredefined and consists of 32 digits on the base 16. </p><br><h1 id="ustanovlennye-parametry-zapuska">  Installed startup options </h1><br><p>  Startup parameters are set right in the code. </p><br><p>  The set of subdomains (a, b, c) is set to a variable and can be expanded. </p><br><p>  Domain set to <code>example.com</code> . </p><br><p>  Backend expected at <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a> </p><br><h2 id="vyvody">  findings </h2><br><p>  The growing threat of sudden blockages makes it necessary to prepare in advance and invent owners even completely loyal websites to protect them.  Such protection is quite possible, does not require any gestures on the part of the user, and can be implemented with quite a modest amount of effort on the part of the site administrator. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/344536/">https://habr.com/ru/post/344536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344524/index.html">Case analysis about backup verification (SureBackup) and using vSAN</a></li>
<li><a href="../344526/index.html">C / C ++ application development using Tcl / Tk</a></li>
<li><a href="../344528/index.html">How to segment users for different verticals</a></li>
<li><a href="../344530/index.html">cBackup - backup network equipment configurations</a></li>
<li><a href="../344534/index.html">Acceleration build C and C ++ projects</a></li>
<li><a href="../344538/index.html">How I realized what distributed systems are</a></li>
<li><a href="../344540/index.html">Are you still Java code? It's time to change</a></li>
<li><a href="../344542/index.html">The human factor in information security</a></li>
<li><a href="../344546/index.html">What hurts a business?</a></li>
<li><a href="../344548/index.html">Zabbix: LLD monitoring of disks without UserParameter and agent scripts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>