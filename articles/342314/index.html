<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Playing with Nextgen-antivirus from Palo Alto Networks: it injects its dll into executable processes like * .exe</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Naturally, we undertook to test it, because such a beast had not yet been seen. 

 Once upon a time, there was the Palo Alto company, which made quite...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Playing with Nextgen-antivirus from Palo Alto Networks: it injects its dll into executable processes like * .exe</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ql/ew/kc/qlewkc5wvrcfmera9jrqgx9mndu.jpeg"><br><br>  Naturally, we undertook to test it, because such a beast had not yet been seen. <br><br>  Once upon a time, there was the Palo Alto company, which made quite good enterprise-level firewalls.  Further, in accordance with the technological trend, the sandbox, both cloudy and private, was included in the vendor‚Äôs line of solutions.  Up to a certain point, both streaming firewalls and sandboxes at the entrance closed the task of providing information security.  But over time, and this was not enough - the concept of "continuous protection" appeared, which, in order to be completely happy, also required the protection of end machines, the so-called end-point solutions.  ‚ÄúPalo Alto‚Äù ‚Äã‚Äãbought the company Cyvera and finished its product for themselves.  This is how Traps, the ‚Äúantivirus of the new generation‚Äù, appeared. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Traps injects its code into executable processes (for example, * .exe), which allows you to run everything in the mode of a kind of small hypervisor, and looks at the memory usage.  He does not check signatures, only catches strange behavior of the software under control. <br><br>  <b>There is nothing funnier than an antivirus that behaves like a virus and works even under WinXP.</b>  This thing is Traps. <br><a name="habracut"></a><br>  Here is how it looks from the process explorer: <br><br><img src="https://habrastorage.org/webt/2g/mj/h9/2gmjh9xsen4l4rhul_b-pdzn180.png"><br><br>  In total, there are 300 types of processes out of the box, where the solution can inject its modules, plus you can make customization for other types of processes using a fairly simple designer. <br><br>  This is how the agent interface on the Win-machine looks like: <br><br><img src="https://habrastorage.org/webt/ru/r6/yj/rur6yjneziqmn86l8oyrd06eiri.png"><br><br>  So, Traps "is registered" in the exe-file and begins to follow what the "sibiotic" process is doing.  At the OS level, Traps can log suspicious events from a memory management point of view.  For the most part, privilege acquisition is due to buffer overflow and other anomalies.  Such events "Palo Alto" and calculates. <br><br><img src="https://habrastorage.org/webt/jk/uu/ob/jkuuobsidpncoirhbp0nvgjmwta.png"><br><br>  <b>The advantage is that this antivirus has no signatures in essence.</b>  There is a set of countermeasures and known events of failures, plus a set of heuristics.  That is, updates may be useful, but in general they are optional (until viruses appear that specifically bypass Traps).  This can be very useful in isolated networks and on certified sites. <br><br>  Even by virtue of an elegant, like a blow with a crowbar, solution with ‚Äúinfecting‚Äù executable files, Traps runs on WinXP.  And this is no longer a joke in the corporate segment: many ATMs and cash desks still work under embed versions of WinXP, and patches for them are not issued.  Every time about the height of the next epidemic, everyone can learn, for example, from terminal screens at train stations. <br><br>  It is installed on servers, VDI machines and physical workstations.  It is undemanding enough resources: <br><br><img src="https://habrastorage.org/webt/19/pd/lj/19pdljdeif8355tl5lkg77gv3b0.png"><br><br>  The product can coexist with other anti-virus solutions, but not with all.  Information is open, the list can be taken in release notes. <br><br>  If you have another Palo Alto infrastructure, then you should know that Traps is built with a bang.  Echeloned protection looks like this: their screen, their sandbox, their own protection on the endpoint.  If an unknown executable file (with an unknown reputation) comes to the traps machine, you can disable its execution until the solution of the ‚Äúbig‚Äù corporate sandbox.  Previously, only the firewall was integrated with the sandbox - it was possible to catch horses only after the fact - after running the file on the endpoint.  And Traps allows you to block the execution before the proceedings.  And when synchronizing with their cloud service, all the hashes that come to Traps go there - and if it‚Äôs known that they are not the same, then they are immediately decided to refuse execution. <br><br>  It works in the opposite direction.  As soon as an epidemic began in the world and the global sandbox detected a specific instance as malicious, this signature is instantly accessible to all Palo Alto subscribers.  And from the experience of previous epidemics such as WannaCry, we see that the peak of infection falls on the first day, while no one has come to their senses.  It is very important to have protection during this period, and Palo Alto provides it. <br><br>  When there are attacks, there are so-called killchains - sequences of actions that lead to the compromise of the machine. <br><br><img src="https://habrastorage.org/webt/xp/z6/kc/xpz6kcnffbk_doyg3swwxqnp63m.png"><br><br>  If at least one element is blocked in this chain, then the attack will not take place. <br><br><img src="https://habrastorage.org/webt/5z/oh/c2/5zohc2ai5nnrppsmrlmt58xpix4.png"><br><br>  Known vulnerabilities and technologies that Traps uses to counter attacks. <br><br><img src="https://habrastorage.org/webt/5x/bh/xp/5xbhxpbtits9qwbyoutxyrndp3w.png"><br><br>  Naturally, this software cannot scan folders as usual antivirus software - there is no static analyzer, only hardcore.  The classic antivirus approach to detecting known threats no longer works.  "Antivirus is dead," <a href="https://www.pcworld.com/article/2150743/antivirus-is-dead-says-maker-of-norton-antivirus.html">said</a> Symantec vice president in 2014. <br><br>  Traps is also good at collecting forsica.  When triggered, a memory dump is generated, which you can analyze as much as you like (the dump can be copied to your analysis server). <br><br>  The result - we will put this solution where the protection of workstations is needed.  Traps does not replace or displace antiviruses (at least for now), but complements them.  Now the vendor is already saying that antiviruses, besides Traps, are no longer needed - there are examples when customers passed PCI DSS and HIPAA compliance, with Traps in their infrastructure. <br><br>  If we talk about vulnerability in SMBv1 (WannaCry, Petya), then it existed for a very long time, and anyone who had information about her could have exploited it imperceptibly.  But Traps users were protected. <br><br>  And here is an example of the fact that the release of patches does not guarantee that a new threat will not be found in the near future. <br><br><img src="https://habrastorage.org/webt/so/-z/jx/so-zjxypjasll61gopwpqz6cw-q.png"><br><br>  On July 5, 2015, a vulnerability was discovered, the patch was released only on the 8th.  Accordingly, the users were not protected for 3 days, on the 10th - a new vulnerability, the patch - on the 14th.  Had Traps, the problems would be much less. <br><br>  Naturally, I wanted to test it.  I took the distributions of viruses and trojans ( <a href="https://github.com/ytisf/theZoo">repository</a> , <b><i>carefully</i></b> , all the samples are working, do not kill yourself the machine).  The VMWare Fusion Professional Version 10.0.1 (6754183) hypervisor created a new virtual machine using the original MSDN image of Windows XP SP3 VL, the English version (md5 5bf476e2fc445b8d06b3c2a6091fe3aa).  A virtual machine is allocated 1 core and 512 MB of memory.  The .NET Framework v3.5.1 is installed (necessary for installing Traps), Traps itself is installed on top, network interaction with the ESM management server is organized, which is organized on Windows Server 2016 from the database to SQL-Express (vendor's recommendation for PoC-deployment).  Neither the client nor the server had access to the Internet to communicate with the WildFire cloud sandbox.  That is, we simulate a full offline - a fairly frequent story for a banking machine.  Version ESM 4.1.1.28779, version of Traps Agent 3.4.4.24430. <br><br>  After installing the agent on WinXP, a snapshot was taken, to which I rolled back after testing each sample.  The transfer of the sample took place simply by dragging the executable file to the target machine (drag'n'drop), after which, depending on the file type, it was launched.  Either by double clicking or through the console. <br><br>  List of tested samples: <br>  1. Win32.Alina.3.4.B <br>  2. Trojan.Asprox <br>  3. Win32.Avatar <br>  4. Trojan.Bladabindi <br>  5. Win32.Boaxxe.BB <br>  6. Win32.Carberp <br>  7. Win32.Cridex <br>  8. Ransomware.CryptoLocker <br>  9. Ransomware.Cryptowall <br>  10. Win32.Cutwail <br>  11. Trojan.Dropper.Gen <br>  12. Win32.Emotet <br>  13. Win32.Fareit <br>  14. Win32.Hupigon <br>  15. Win32.Infostealer.Dexter <br>  16. Ransomware.Jigsaw <br>  17. Trojan.Kovter <br>  18. Trojan.Loadmoney <br>  19. Ransomware.Locky <br>  20. Ransomware.Matsnu <br>  21. Trojan.NSIS.Win32 <br>  22. Ransomware.Petrwrap <br>  23. Ransomware.Petya <br>  24. Ransomware.Radamant <br>  25. Ransomware.Satana <br>  26. Trojan.Stabuniq <br>  27. Trojan.Sinowal <br>  28. Ransomware.TeslaCrypt <br>  29. Ransomware.Vipasana <br>  30. Ransomware.WannaCry <br><br>  Only TeslaCrypt's malware passed through Traps.  At the same time, we deliberately ignored the <a href="https://www.paloaltonetworks.com/documentation/34/endpoint/endpoint-admin-guide/malware-protection/malware-protection-policy-best-practices">vendor's best practitioner</a> to test the capabilities of Traps local analysis.  In particular, we have disabled all interaction with the sandbox, which is highly undesirable.  In normal mode, even if the server‚Äôs connection to the sandbox disappears, when the connection is restored, it will send unknown files for analysis, and we still know that the machine was infected, for that there is a point in the management server - malware post-detection ( see screenshot).  And even hashes of known files, just in case, with a certain periodicity are still checked by the sandbox in case the sandbox's verdict has changed.  And by clicking on the WildFire report button, we will receive a detailed info on why this file was considered malicious.  The specific teslacrypt report <a href="https://yadi.sk/d/U2bSKp_g3Pf7f4">here</a> . <br><br><img src="https://habrastorage.org/webt/dg/nq/o_/dgnqo_qcnziiiy82mgwpp-bqkq4.png"><br><br>  All unprotected malware was detected locally by the agent itself without communication with the external server and signatures (there was communication with the local server, but the tested machine itself and the management server did not have Internet access). <br><br>  It looked like this: <br><br><img src="https://habrastorage.org/webt/k2/gd/bz/k2gdbzns3va-jlcbd03yrzwhqfe.png"><br><br>  As a result, I think the fight against known viruses by signatures is already the last century, given that the malware hash is easy to change.  The Traps approach offers ways to deal with unknown threats, with a focus on preventing the threat.  It works well enough to replace antiviruses in the future.  Already now ideal for isolated environments (process control systems, etc.). <br><br><h2>  Links </h2><br><ul><li>  <a href="https://www.paloaltonetworks.com/content/dam/pan/en_US/assets/pdf/technical-documentation/41/endpoint/endpoint-admin-guide.pdf">PDF manual</a> from Palo Alto </li><li>  <a href="http://www.virustotal.com/">Virustotal</a> added the engine to the scan, it is called Palo Alto Networks, but this is not Traps, but a firewall.  If you want the results of tests on Traps, then they are <a href="https://www.av-test.org/fileadmin/pdf/reports/AV-TEST_Palo_Alto_Traps_Full_Product_Test_July_2017.pdf">on the link</a> . </li><li>  Here is another interesting <a href="https://researchcenter.paloaltonetworks.com/2017/08/av-test-validated-traps-can-replace-legacy-antivirus/">link</a> from the vendor about the replacement of "old" antiviruses </li><li>  My mail: DDrozhzhin@croc.ru </li></ul></div><p>Source: <a href="https://habr.com/ru/post/342314/">https://habr.com/ru/post/342314/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342304/index.html">Interesting logical puzzles for interviews</a></li>
<li><a href="../342306/index.html">How we played with neural networks</a></li>
<li><a href="../342308/index.html">Future of wikipedia</a></li>
<li><a href="../342310/index.html">Installing Proxmox VE on Debian Stretch using Ansible</a></li>
<li><a href="../342312/index.html">Configuring Jail on FreeBSD 11.1</a></li>
<li><a href="../342316/index.html">Actors for fun and profit</a></li>
<li><a href="../342318/index.html">PouchDB or what to do when the ‚Äúinternet is stable‚Äù</a></li>
<li><a href="../342324/index.html">Errors in smart contracts or Parity's new Security Alert</a></li>
<li><a href="../342326/index.html">PVS-Studio report is now in Html format</a></li>
<li><a href="../342330/index.html">Insight on metrics: how do I understand what metrics are and what is their main charm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>