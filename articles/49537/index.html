<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP: TO_DAYS () function port from MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I needed an analogue of the function TO_DAYS () in PHP. I, naively, thought that among the huge set of functions, there must be an implementation...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP: TO_DAYS () function port from MySQL</h1><div class="post__text post__text-html js-mediator-article">  Once I needed an analogue of the function TO_DAYS () in PHP.  I, naively, thought that among the huge set of functions, there must be an implementation of TO_DAYS () from MySQL.  But my searches were in vain.  I rummaged Google, but did not find the implementation I needed.  Everything I found was from the category <br><br>  define ("SECONDS_PER_DAY", 86400); <br>  $ now = (int) (time () / SECONDS_PER_DAY); <br><br>  I did not accept this approach. <a name="habracut"></a><br>  First, this solution counted the days relative to the beginning of the UNIX epoch, and in MySQL it is from the date of the 0000-00-00, that is, the numbers, to put it mildly, did not coincide.  One could, of course, add the number of days before the beginning of the UNIX epoch, but this would greatly reduce the range of valid dates. <br>  Secondly, it did not take into account the fact that in some days it was 23 hours, and in some days 25 (during the transition to summer and winter time). <br>  In addition, the timestamp can not say exactly what the number is now without knowing the time zone (although this is not a particular problem). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The most important criterion was the coincidence of the results of the function with the results of TO_DAYS () from MySQL.  Well, if so, then I went to look for this function in the source code of MySQL itself.  With a grief in half, I found the <a href="http://dev.mysql.com/sources/doxygen/mysql-5.1/my__time_8h.html">calc_daynr</a> function, which the <a href="http://dev.mysql.com/sources/doxygen/mysql-5.1/classItem__func__to__days.html">Item_func_to_days :: val_int ()</a> function <a href="http://dev.mysql.com/sources/doxygen/mysql-5.1/classItem__func__to__days.html">calls</a> to count these days. <br><br>  After some simple conversion, the code written in C was turned into PHP code.  I upgraded the input parameters a bit to reflect the latest trends in working with date in PHP, and got the following function: <br><br>  <font color="#0000BB">&lt;?</font> <font color="#0000BB"><br></font>  <font color="#0000BB">define</font> <font color="#007700">(</font> <font color="#DD0000">"YY_PART_YEAR"</font> <font color="#007700">,</font> <font color="#0000BB">70</font> <font color="#007700">);</font> <font color="#007700"><br></font>  <font color="#0000BB">define</font> <font color="#007700">(</font> <font color="#DD0000">"YY_MAGIC_BELOW"</font> <font color="#007700">,</font> <font color="#0000BB">200</font> <font color="#007700">);</font> <font color="#007700"><br><br></font>  <font color="#007700">function</font> <font color="#0000BB">to_days</font> <font color="#007700">(</font> <font color="#0000BB">DateTime $ date</font> <font color="#007700">)</font> <font color="#007700"><br></font>  <font color="#007700">{</font> <font color="#007700"><br></font>  <font color="#0000BB">$ year</font> <font color="#007700">=</font> <font color="#0000BB">$ date</font> <font color="#007700">-&gt;</font> <font color="#0000BB">format</font> <font color="#007700">(</font> <font color="#DD0000">"Y"</font> <font color="#007700">);</font> <font color="#007700"><br></font>  <font color="#0000BB">$ month</font> <font color="#007700">=</font> <font color="#0000BB">$ date</font> <font color="#007700">-&gt;</font> <font color="#0000BB">format</font> <font color="#007700">(</font> <font color="#DD0000">"m"</font> <font color="#007700">);</font> <font color="#007700"><br></font>  <font color="#0000BB">$ day</font> <font color="#007700">=</font> <font color="#0000BB">$ date</font> <font color="#007700">-&gt;</font> <font color="#0000BB">format</font> <font color="#007700">(</font> <font color="#DD0000">"d"</font> <font color="#007700">);</font> <font color="#007700"><br><br></font>  <font color="#007700">if (</font> <font color="#0000BB">$ year</font> <font color="#007700">==</font> <font color="#0000BB">0</font> <font color="#007700">&amp;&amp;</font> <font color="#0000BB">$ month</font> <font color="#007700">==</font> <font color="#0000BB">0</font> <font color="#007700">&amp;&amp;</font> <font color="#0000BB">$ day</font> <font color="#007700">==</font> <font color="#0000BB">0</font> <font color="#007700">)</font> <font color="#007700"><br></font>  <font color="#007700">{</font> <font color="#007700"><br></font>  <font color="#007700">return</font> <font color="#0000BB">0</font> <font color="#007700">;</font> <font color="#007700"><br></font>  <font color="#007700">}</font> <font color="#007700"><br></font>  <font color="#007700">if (</font> <font color="#0000BB">$ year</font> <font color="#007700">&lt;</font> <font color="#0000BB">YY_MAGIC_BELOW</font> <font color="#007700">)</font> <font color="#007700"><br></font>  <font color="#007700">{</font> <font color="#007700"><br></font>  <font color="#007700">if ((</font> <font color="#0000BB">$ year</font> <font color="#007700">=</font> <font color="#0000BB">$ year</font> <font color="#007700">+</font> <font color="#0000BB">1900</font> <font color="#007700">) &lt;</font> <font color="#0000BB">1900</font> <font color="#007700">+</font> <font color="#0000BB">YY_PART_YEAR</font> <font color="#007700">)</font> <font color="#007700"><br></font>  <font color="#007700">{</font> <font color="#007700"><br></font>  <font color="#0000BB">$ year</font> <font color="#007700">+ =</font> <font color="#0000BB">100</font> <font color="#007700">;</font> <font color="#007700"><br></font>  <font color="#007700">}</font> <font color="#007700"><br></font>  <font color="#007700">}</font> <font color="#007700"><br></font>  <font color="#0000BB">$ delsum</font> <font color="#007700">=</font> <font color="#0000BB">365</font> <font color="#007700">*</font> <font color="#0000BB">$ year</font> <font color="#007700">+</font> <font color="#0000BB">31</font> <font color="#007700">* (</font> <font color="#0000BB">$ month</font> <font color="#007700">-</font> <font color="#0000BB">1</font> <font color="#007700">) +</font> <font color="#0000BB">$ day</font> <font color="#007700">;</font> <font color="#007700"><br></font>  <font color="#007700">if (</font> <font color="#0000BB">$ month</font> <font color="#007700">&lt;=</font> <font color="#0000BB">2</font> <font color="#007700">)</font> <font color="#007700"><br></font>  <font color="#007700">{</font> <font color="#007700"><br></font>  <font color="#0000BB">$ year</font> <font color="#007700">-;</font> <font color="#007700"><br></font>  <font color="#007700">}</font> <font color="#007700"><br></font>  <font color="#007700">else</font> <font color="#007700"><br></font>  <font color="#007700">{</font> <font color="#007700"><br></font>  <font color="#0000BB">$ delsum</font> <font color="#007700">- =</font> <font color="#0000BB">floor</font> <font color="#007700">((</font> <font color="#0000BB">$ month</font> <font color="#007700">*</font> <font color="#0000BB">4</font> <font color="#007700">+</font> <font color="#0000BB">23</font> <font color="#007700">) /</font> <font color="#0000BB">10</font> <font color="#007700">);</font> <font color="#007700"><br></font>  <font color="#007700">}</font> <font color="#007700"><br></font>  <font color="#0000BB">$ temp</font> <font color="#007700">=</font> <font color="#0000BB">floor</font> <font color="#007700">((</font> <font color="#0000BB">floor</font> <font color="#007700">(</font> <font color="#0000BB">$ year</font> <font color="#007700">/</font> <font color="#0000BB">100</font> <font color="#007700">) +</font> <font color="#0000BB">1</font> <font color="#007700">) *</font> <font color="#0000BB">3/4</font> <font color="#007700">);</font> <font color="#007700"><br></font>  <font color="#007700">return</font> <font color="#0000BB">floor</font> <font color="#007700">(</font> <font color="#0000BB">$ delsum</font> <font color="#007700">+</font> <font color="#0000BB">$ year</font> <font color="#007700">/</font> <font color="#0000BB">4</font> <font color="#007700">-</font> <font color="#0000BB">$ temp</font> <font color="#007700">);</font> <font color="#007700"><br></font>  <font color="#007700">}</font> <font color="#007700"><br></font>  <font color="#0000BB">?&gt;</font> <br><br>  If you think that I fully understand this code, then you are mistaken.  What is this at least worth: <br><br>  <font color="#0000BB">$ delsum</font> <font color="#007700">- =</font> <font color="#0000BB">floor</font> <font color="#007700">((</font> <font color="#0000BB">$ month</font> <font color="#007700">*</font> <font color="#0000BB">4</font> <font color="#007700">+</font> <font color="#0000BB">23</font> <font color="#007700">) /</font> <font color="#0000BB">10</font> <font color="#007700">);</font> <br><br>  But this is not required at this stage, the main thing is to work. <br>  I checked for a match with TO_DAYS () from 1700 to 2300 - not a single error. <br>  So if anyone needs, use on health. <br><br>  PS Now you need to do the same for FROM_DAYS ().  Then I will share, if there will be something :) </div><p>Source: <a href="https://habr.com/ru/post/49537/">https://habr.com/ru/post/49537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../49530/index.html">Torrent TV with Myka BitTorrent</a></li>
<li><a href="../49531/index.html">It is not possible to update (UPDATE) the same table that you use in the SELECT query</a></li>
<li><a href="../49532/index.html">Mail.ru shoots horror movie</a></li>
<li><a href="../49534/index.html">Mikhail Donskoy died</a></li>
<li><a href="../49535/index.html">Emergency resuscitation epmd</a></li>
<li><a href="../49538/index.html">Opera won the first round of the antitrust process against IE</a></li>
<li><a href="../49540/index.html">Perhaps the most annoying Microsoft ad</a></li>
<li><a href="../49542/index.html">Livescribe Pulse smartpen - digital pen</a></li>
<li><a href="../49543/index.html">Youtube video can now be officially downloaded</a></li>
<li><a href="../49546/index.html">How to prepare for Zend Framework certification?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>