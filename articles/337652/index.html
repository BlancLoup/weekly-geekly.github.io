<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Platform for collecting donations in two weeks - the results of anti-hacking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our anti-hakatone, a team of students of the Higher School of Economics won with a decision to accept donations for streaming. But Maxim Dyakov , t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Platform for collecting donations in two weeks - the results of anti-hacking</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/fdc/d36/a7b/fdcd36a7b5464f56a270f7fbc11c0e2a.png"></p><br><p>  <em>In our anti-hakatone, a team of students of the Higher School of Economics won with a decision to accept donations for streaming.</em>  <em>But <strong>Maxim Dyakov</strong> , the founder of <strong>the Yastrim</strong> service, will tell about the project the best - I give the microphone to the author.</em> </p><br><p>  <strong>Under the cut there are a few throwings between ChromeApps and Electron, the impressions of the Yandex SpeechKit test and generally about the development in the anti-hacking format</strong> . <a name="habracut"></a></p><br><blockquote>  One rainy summer evening, my friends and I decided to take part in the <a href="https://habrahabr.ru/company/yamoney/blog/330096/">anti-hacking engine Yandex</a> . <a href="https://habrahabr.ru/company/yamoney/blog/330096/">Money</a> .  And the reason was suitable, because I had long wanted to create an application related to stream services and the process of sending donations.  Our team consisted of four people: Alexander Naumov, responsible for the mobile application Javid Khalilov, the main PC client Alexander Kobrin and me, as a backend developer and ideological inspirer. <br>  It turned out cheerfully - in two weeks a minimally viable product ‚ÄúYastrim‚Äù appeared. </blockquote><br><h1 id="zachem-komu-to-platit-za-strim">  Why would anyone pay for stream </h1><br><p>  For a general understanding, I‚Äôll talk a little about how the donation is sent and, more importantly, why it is needed at all. </p><br><blockquote>  Streaming in this article means gaming streaming.  That is, when someone broadcasts to the network his gameplay and at the same time all this comments.  Popular streamers have their own audience of viewers who follow the release of new ‚Äúepisodes‚Äù and sometimes send comments, messages or money.  Of course, everything on a voluntary basis and without any practical purpose for the audience is purely just for fun. </blockquote><p>  Since streaming for the viewer is just a way to have fun, there is no obvious reason to pay someone even 50 rubles (this is not a movie, and they do not ask for tickets when they are connected).  However, the online streaming industry is gaining momentum almost faster than blogging, which means it cannot do without a good cash flow.  In general, there is no clear answer as such.  Throwing a coin to young musicians in the subway, we do not receive any kind of service or product, but only thank the performer for his work - and here too. </p><br><p>  As for the technical side of streaming, there have long been known products for capturing and broadcasting video from the screen, but there is no sensible system for collecting donations.  Sensible is that: </p><br><ol><li>  allows the user with a minimum of effort to transfer a certain amount of streamer; </li><li>  supports message transfer (text or voice) from a user to a streamer in the process of money transfer; </li><li>  shows streamer message and alerts about receiving money from specific users; </li><li>  can read user messages out loud live and contains settings for ‚Äústicking‚Äù the mat and other words not suitable for streamer; </li><li>  can work with any streaming software, so as not to force the tape drive to abandon the usual environment. </li></ol><br><p>  At least, there is no product that would satisfy these requirements and did not take its own commission.  In addition, for the transfer of money in most products is their own development that adds doubt to the consumer.  And if there is no sensible product, then there is a reason for a startup. </p><br><p>  Building only one donation product is pointless - it will limit its capabilities and reduce the development potential to almost zero.  Therefore, we decided to make a comprehensive solution ‚Äú <a href="https://yastream.win/">Yastrim</a> ‚Äù, the alpha version of which you can watch in the video: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/G3eCmfFvnQs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>So the streamer sees the Yastrim interface.</em> </p><br><p>  The main advantage of our project over competitors is that Yastrim does not require any integration with the usual streamer application for screen capture and broadcast.  Instead, it simply imposes the necessary interface and user messages on the screen, which is captured by the streaming application. </p><br><h1 id="stroim-schaste-dlya-strimera">  Building happiness for streamer </h1><br><p>  Since we wanted to cover a bigger market, and at the same time learn something new on the anti-hackone, the solution had to be cross-platform - with the support of all streaming platforms and related software.  Chrome Apps was originally chosen as the basis, which seemed almost an ideal tool for debugging and API development (I especially liked the debugging of applications in Postman, which was also written under Chrome).  Then desktop clients could be written on Chrome Apps immediately under a variety of platforms. </p><br><p>  Inspired by the best, in my opinion, tool for developing Web API - <a href="https://www.getpostman.com/">Postman</a> in the version for Chrome - I decided to use Google Chrome Apps as the basis.  Applications written for this platform work in Google Chrome and in other browsers on the chromium engine, which would make an easy cross-platform solution. </p><br><p>  Here are some motivating factors: </p><br><ul><li><p>  Google Chrome and other browsers on the Chromium engine make up most of the market, so the solution would be "omnivorous"; </p><br></li><li>  development on this platform is a typical web frontend with some nuances that were placed in the book Marc Rochkind on 240 pages. </li></ul><br><p>  As for the backend, the choice is clear for me - ASP.NET.  After some experience configuring the server on Ubuntu, it‚Äôs worth once to get acquainted with the pleasant Azure UI, and there‚Äôs no going back.  The last nail in our doubts was driven into Azure's free monthly subscription for a month, that in the conditions of anti-hackathon it is the most. </p><br><p><img src="https://habrastorage.org/web/574/0fb/1ef/5740fb1ef40a4fde9e103689ad96fdb2.png"><br>  <em>Of course, in all of this kingdom of convenience and free of charge was not without hell of a moment.</em> </p><br><blockquote>  I would like to share the fact that all this time I have been under the impression of the book ‚ÄúThe mental hospital in the hands of patients‚Äù by Alan Cooper.  The book is devoted to the theory of interaction design, so when it came to the second component - the audience - I really wanted to try out techniques like character making in battle. </blockquote><p>  When we decided on the main components of the product (desktop app, web form, and mobile app), our front developer suddenly found out that Google is <a href="https://blog.chromium.org/2016/08/from-chrome-apps-to-web.html">stopping support for Chrome Apps</a> on Windows, Mac and Linux.  An awkward pause, disappointment, resentment, acceptance. </p><br><h1 id="korol-umer-da-zdravstvuet-korol-electron">  The king is dead, long live the king of Electron </h1><br><p>  Alternatively, the open source <strong>Electron</strong> framework was a great fit.  Of course, the novelty of the platform was alarmed, but the growing popularity offset the fears.  As for the mobile application, let's say this: I only had an Android developer on my mobile team.  The client-server architecture was chosen for YAS Strima, with Microsoft SQL as the backend database. </p><br><p>  I think it makes no sense to disassemble architecture in detail, draw flowcharts, etc.  - it's boring and specific to a particular project.  Better share tips on my own experience of trial and error: </p><br><ul><li>  As an identifier, it is better to choose something globally unique, for the future.  For example, for the ID of the online broadcasts, I chose the URL, which allowed us to solve a million problems in one fell swoop (uniqueness, quick access, the ability to continue working with the streaming platform API). </li><li>  Study in detail the platform of your future service - it will save a lot of time at higher levels of implementation.  It is better to spend a couple of days on the platform than in the final stages to find that everything needs to be rewritten in half. </li><li>  Unless we are talking about the hackathon and the project without further prospects, immediately document all entities, logic, interaction, and so on.  The further all this is postponed, the more information you have to keep in your head.  It‚Äôs not easy to remember everything on a big project, so it‚Äôs best to do it right away. </li></ul><br><p>  Then came the development stage of the WEB API of our service, where the main task was to ensure the safety of streamers: that if someone changes the donation settings, changes the logo or starts something else unkind. </p><br><p>  So the following security tools appeared on the platform: </p><br><ul><li>  With each transfer, a special label is entered in the label field, and the operation identifier (if it can be obtained) is included in the donate data.  This was necessary for convenient work with the Yandex.Money API on the side of the streamer and checking the existence of a transfer in the payment system. </li><li>  When YAStrim receives data about the donate produced, the user client requests Yandex.Money operation with the same ID or all operations with a match on the label field.  Donat will appear in the stream only if the transaction is found. </li><li>  All communication between the user client and the streaming platform takes place using the special YAS Strim token, which is issued at the authorization stage in the payment system. </li><li>  Separately, we had to tinker with uploading photos, as there was no experience, and for the simplicity of working with the API, it was necessary to make a small photo hosting site. </li></ul><br><p>  The result of all these studies could be described as ‚Äúbackend works‚Äù, which, in my opinion, perfectly characterizes the early prototype.  Next, there was still to be refactoring, refactoring, and once again exciting refactoring. </p><br><h1 id="volnitelnyy-etap-sborki">  Exciting assembly stage </h1><br><p>  When it came time to create a working build, we didn‚Äôt have to connect React in any way - as a result, the application produced wild errors at startup. </p><br><p><img src="https://habrastorage.org/web/409/e85/6d9/409e856d99e346d1a3823e74fb54ca3e.png"><br>  <em>An example of what we caught when trying to build.</em> </p><br><p>  Our team dug up the length and breadth of Stackoverflow and GitHub Issues, so it only remains to open a new topic and look for knowledgeable people.  So we met the developer Electron and <a href="https://github.com/akashnimare">@akashnimare</a> , who has the right experience and was willing to share it.  In addition, we have discovered the <a href="https://t.me/electron_ru">Russian Electron community</a> , where it is worth going to anyone who is going to use this platform. </p><br><p>  With the storage of files, too, a hitch came out, from which the council was born to pay more attention to the foundations of the application.  It was necessary for us not to be lazy, but from the very beginning to connect the electron-storage or electron-storage-json library, so as not to rewrite the code when it turns out that local-storage from main is not available. </p><br><p>  A ray of light in the dark realm of unfamiliar frameworks was <a href="https://speechkit.yandex.ru/dev">Yandex SpeechKit</a> , which not only produced an excellent result, but also required a minimum of time to study the documentation.  In fact, the necessary option to voice the message from the user's donate turned out after three lines of code: </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ya.speechkit.Tts({ apikey: <span class="hljs-string"><span class="hljs-string">'ffffffff-2222-4444-0000-1111111111'</span></span>, emotion: <span class="hljs-string"><span class="hljs-string">'good'</span></span>, speed: <span class="hljs-number"><span class="hljs-number">1.2</span></span> }) ... tts.speak(donate.text_data, { speaker: <span class="hljs-string"><span class="hljs-string">'zahar'</span></span> })</code> </pre> <br><p>  It is enough to specify the API private key, choose a voice (zahar), speed, emotional color (good) - and that's it. </p><br><h1 id="za-plechami-litry-energetikov-i-3-nedeli-plotnoy-razrabotki">  Behind shoulders liters of power engineering specialists and 3 weeks of dense development </h1><br><p>  To summarize, I want to say that as a startup, we are not even at the first stage.  But from the point of view of the original goal, we achieved the main thing: we managed to implement almost all features (except voice messages, which still have roughness), which is not often possible for young developers on a real project.  In this case, no one has quarreled, all four in the boat and continue to believe in success.  Therefore, achievement unlocked, but there is still a long way to go. </p><br><p>  <strong>If our experience seemed interesting to you, I would be happy to answer questions in the comments.</strong> </p><br><p>  <a href="https://yastream.win/">Page of the project "YStream"</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/337652/">https://habr.com/ru/post/337652/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337640/index.html">Survey: Does the creator of the product need additional study in order to conduct user research?</a></li>
<li><a href="../337642/index.html">Learn OpenGL. Lesson 2.5 - Light Sources</a></li>
<li><a href="../337644/index.html">tig - we improve productivity of work with git</a></li>
<li><a href="../337646/index.html">Technocup 2017-2018</a></li>
<li><a href="../337648/index.html">A curious feature of the Java language and insidious errors that it may cause</a></li>
<li><a href="../337654/index.html">Read user input (digits) in the 3CX Call Flow Designer application</a></li>
<li><a href="../337656/index.html">This is not an article - just food for thought about how to write it.</a></li>
<li><a href="../337658/index.html">How we built our mini data center. Part 5 - experience, breaks, heat</a></li>
<li><a href="../337660/index.html">Why is a site audit useless for 99% of small businesses?</a></li>
<li><a href="../337662/index.html">JavaScript: Asynchronous Programming Techniques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>