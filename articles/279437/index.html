<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking the source code of the PVS-Studio plugin with PVS-Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the eternal questions we face is this: ‚ÄúHave you checked PVS-Studio with PVS-Studio? Where is the article about the test results? ‚Äù Yes, we reg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking the source code of the PVS-Studio plugin with PVS-Studio</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e5/6e7/2f9/2e56e72f98ac4c11597a59bf5eaeb771.png"></div><br>  One of the eternal questions we face is this: ‚ÄúHave you checked PVS-Studio with PVS-Studio?  Where is the article about the test results? ‚Äù  Yes, we regularly do this, so we could not write an article about errors that we found in ourselves.  Errors are corrected by developers at the stage of writing code, and we constantly forget at this moment to write them out.  But readers are lucky this time.  Due to an oversight, the C # plug-in code for Visual Studio was not added to the daily nightly checks we carry out.  And, accordingly, unlike the analyzer core, errors in it were not noticed throughout the development of C # PVS-Studio.  As they say, every cloud has a silver lining, and because of this you are reading this article. <br><a name="habracut"></a><br><h2>  <b>A little more about testing PVS-Studio</b> </h2><br>  It may be interesting for readers to find out how the PVS-Studio testing process is built in general.  We have already written <a href="http://www.viva64.com/ru/a/0047/">an article</a> on this topic.  But a lot of time has passed since then, and something has changed.  Therefore, I will briefly describe how things are at the moment. <br><br>  When developing PVS-Studio, we use seven testing methods: <ol><li>  Static code analysis on developer machines.  All developers have PVS-Studio installed.  New or changed code is immediately checked using the incremental analysis mechanism.  C ++ and C # code is checked. </li><li>  Static code analysis for nightly builds.  If the warning was not noticed, it will be revealed at the stage of the night assembly on the server.  PVS-Studio checks C # and C ++ code.  In addition, we additionally use Clang to check C ++ code. </li><li>  Unit tests at the level of classes, methods, functions.  The system is not very developed, since many issues are difficult to test because of the need to prepare a large amount of input data for the test.  We rely more on high-level tests. </li><li>  Functional level tests of specially prepared and tagged files with errors. </li><li>  Functional tests confirming that we correctly parse the main system header files. </li><li>  Regression tests of the level of individual third-party projects and solutions (projects and solutions).  The most important and useful type of testing for us.  To implement it, we regularly check 105 open projects in C ++ and 49 in C #.  Comparing the old and new results of the analysis, we control that something has not been broken and we are honing new diagnostic messages. </li><li>  Functional tests of user interface extensions - add-in, integrated into the environment of Visual Studio. </li></ol><br>  How did it happen that we missed checking the plugin?  We do not know.  Just no one remembered to add the plugin code verification on the server.  A new C # analyzer check was added, but not a plug-in.  As a result, the C # analyzer developed and found errors in itself.  And the plugin, also written in C #, stayed aside.  It has not changed much lately.  So it turned out that incremental analysis did not help, since the plug-in code almost did not work.  And there were no night checks. <br><br><h2>  <b>PVS-Studio Plugin</b> </h2><br>  By virtue of your honesty and openness in front of customers and in order to avoid talking a la - "You see a speck in another's eye, and you don‚Äôt notice it in your log," we will write down all our typos and errors, even curious ones.  We owe all the errors found to the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> v6.02 analyzer, which supports C #. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's begin, perhaps, with real errors that have already been corrected by the time these lines are written. <br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessFiles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RowsCount = DynamicErrorListControl.Instance.Plog.NumberOfRows; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RowsCount &gt; <span class="hljs-number"><span class="hljs-number">20000</span></span>) DatatableUpdateInterval = <span class="hljs-number"><span class="hljs-number">30000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//30s else if (RowsCount &gt; 100000) DatatableUpdateInterval = 60000; //1min else if (RowsCount &gt; 200000) DatatableUpdateInterval = 120000; //2min .... }</span></span></code> </pre> <br>  The analyzer, accordingly, issued two warnings: <br><br>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'RowsCount&gt; 100000' is always false.  ProcessingEngine.cs 559 <br><br>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'RowsCount&gt; 200000' is always false.  ProcessingEngine.cs 561 <br><br>  The human brain is accustomed to think consistently - from simple to complex or, as in this case, from less to more, checking all values.  In this case, such human logic led to the wrong behavior of the program.  An error occurred while checking the number of rows in the table.  The program, checking the first condition that there are more than 20,000 rows, will immediately assign the value to DatatableUpdateInterval in 30 seconds.  And, of course, will not check the other conditions.  Even if RowsCount was 1,000,000. <br><br>  This code was written in order to optimize the display of error messages in the IDE PVS-Studio window in Visual Studio.  Initially, the PVS-Studio plugin issued analysis results immediately upon receipt.  That is, at the moment when these results came from the cmd process (which starts the analyzer core).  However, on very large projects, we began to notice serious interface ‚Äúbrakes‚Äù.  Especially problems appeared when there was a large number of * .c files in the projects.  This happened because the * .c files were checked very quickly, and the UI stream was constantly busy redrawing the results table.  It was decided to add a delay between updates, which would increase with an increase in the number of messages.  Until reaching 20,000 messages in the list, the delay was set to 15 seconds. <br><br>  In this case, we are lucky, and we get only a slight slowdown in the program (especially since we rarely receive more than hundreds of thousands of messages after verification), but this message is intended to detect more serious cases.  For example, <a href="http://www.viva64.com/ru/b/0375/">as it was</a> in the project from the company Infragistics. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateTemperature</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GeoLocation location</span></span></span><span class="hljs-function">)</span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.Latitude &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> || location.Latitude &lt; <span class="hljs-number"><span class="hljs-number">25</span></span>) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.Latitude &gt; <span class="hljs-number"><span class="hljs-number">-40</span></span> || location.Latitude &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) .... }</code> </pre> <br>  Here the condition will also always be true, which led to erroneous calculations. <br><br>  The following error is more serious for our project: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GeneratePreprocessedFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info.PreprocessorCommandLine.Contains(<span class="hljs-string"><span class="hljs-string">" /arch:SSE"</span></span>)) ClangCommandLine += <span class="hljs-string"><span class="hljs-string">" /D \"_M_IX86_FP=1\""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info.PreprocessorCommandLine.Contains(<span class="hljs-string"><span class="hljs-string">" /arch:SSE2"</span></span>)) ClangCommandLine += <span class="hljs-string"><span class="hljs-string">" /D \"_M_IX86_FP=2\""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info.PreprocessorCommandLine.Contains(<span class="hljs-string"><span class="hljs-string">" /arch:IA32"</span></span>)) ClangCommandLine += <span class="hljs-string"><span class="hljs-string">" /U \"_M_IX86_FP\""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info.PreprocessorCommandLine.Contains(<span class="hljs-string"><span class="hljs-string">" /arch:AVX"</span></span>)) ClangCommandLine += <span class="hljs-string"><span class="hljs-string">" /D \"_M_IX86_FP=2\""</span></span>; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0454/">V3053</a> An excessive check.  Search for the substrings '/ arch: SSE' and '/ arch: SSE2'.  StandaloneProjectItem.cs 229 <br><br>  Although the error has a different number, the essence of it is the same.  The logic of man - to follow from simple to complex, pumped up here.  By checking the value of ‚Äúinfo.PreprocessorCommandLine‚Äù on the entry of the substring "/ arch: SSE" into it, we will simultaneously satisfy the condition in the case when the info.PreprocessorCommandLine "contains the following substring" / arch: SSE2 ".  As you can see, the text, which is naturally read, does not correspond to the logic that we wanted to set in the program.  Even if we know that the PreprocessorCommandLine contains "/ arch: SSE2", then passing the eyes through the code we will speculatively add to the ClangCommandLine variable the value "/ D \" _ M_IX86_FP = 2 \ "", and not "/ D \" _ M_IX86_FP = one\""; <br><br>  From the point of view of the analyzer, the error was the incorrect definition of the _M_IX86_FP macro when the / arch: SSE2 flag was passed to the compiler.  The point is that for preprocessing before directly analyzing, PVS-Studio uses Clang instead of cl (standard Visual C ++ preprocessor).  Clang runs much faster.  Unfortunately, the Clang C ++ language dialect support from Microsoft is still far from ideal - so if Clang "could not" preprocess something, PVS-Studio will call cl.  Therefore, we will convert the cl compiler flags to define for Clang.  <a href="http://www.viva64.com/ru/b/0186/">Details</a> <br><br>  This error most likely never led to errors in the Clang operation or incorrect output of the analysis results, so it existed in our code for a very long time. <br><br>  Another real error is calling the ProcessAnalyzerOutput function. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PVSFinishKey</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hashtable PathExcludes</span></span></span><span class="hljs-function">)</span></span> { .... ProcessAnalyzerOutput(fileName, projectName, task.strStandardOutput, task.strStandardError, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> ParsedOutput, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> PathExcludes); }</code> </pre> <br>  Noticing the error is not easy, even if you look at the function declaration: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessAnalyzerOutput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> String fileName, String projectName, String strStandardError, String strStandardOutput, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LargeFileMode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> List&lt;ErrorInfo&gt; ParsedOutputLines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hashtable PathExcludes</span></span></span><span class="hljs-function">)</span></span> { .... }</code> </pre> <br>  The problem is the mismatch between the names of the function parameters and the names of the arguments that we pass there: <br><br>  <a href="http://www.viva64.com/ru/d/0459/">V3066</a> Possible incorrect order of arguments passed to 'ProcessAnalyzerOutput' method: 'strStandardError' and 'strStandardOutput'.  ProcessingEngine.cs 1995 <br><br>  It is always difficult to find a discrepancy in such a long list of function parameters.  Even IntelliSense in such cases does not always save.  In large projects, it can be slowed down, and because of this, it is not always clear which element you are on now. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6db/d83/4d7/6dbd834d7dc8ad87b47bd1d3bb2de67c.png"></div><br><br>  Because of this, a very unpleasant situation can occur.  Although this diagnostics belongs to the third level, like all other heuristic ones, but it is very useful and you should not ignore it. <br><br>  The place where this error was detected is a ‚Äústub‚Äù - the stderr and stdout parameters never received anything but empty lines.  This error would find itself quickly enough when this stub began to be used. <br><br>  Another error was detected by diagnostics number V3072, which is currently under development: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProcessingEngine</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PVSMessageBase _retiredMessageBase; .... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PVSMessageBase</span></span> : <span class="hljs-title"><span class="hljs-title">ContextBoundObject</span></span>, <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { .... }</code> </pre> <br>  This diagnostic is intended for finding in a class that does not implement the IDisposable interface, fields that have a type that implements the IDisposable interface.  Such code tells us that a programmer may forget to clear some resources after using an object of its class. <br><br>  In this case, the ProcessingEngine class (which does not implement the IDisposable interface) has a field of the PVSMessageBase class, the type of which implements the IDisposable interface. <br><br>  This operation can be attributed to false positive, caused by not quite ‚Äúneat‚Äù architecture.  The ProcessingEngine class is used in the program as singleton.  And therefore, its only instance exists during the whole time the program is running, just like the PVSMessageBase field.  Resources will be released upon completion of the program. <br><br>  Well, in spite of ill-wishers and, to our delight, no other serious errors were found in the code.  The rest of the "errors" rather refers to the format - "just in case." <br><br>  For example, in this expression: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSetRemainingClicks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((CurrentRemClicks != <span class="hljs-number"><span class="hljs-number">0</span></span>) || ((CurrentRemClicks == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; DecrementCurrent)) { .... } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0416/">V3031 Anonymous</a> check can be simplified.  The '||'  operator is surrounded by opposite expressions.  DynamicErrorList.cs 383 <br><br>  This code can be safely reduced to: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CurrentRemClicks != <span class="hljs-number"><span class="hljs-number">0</span></span> || DecrementCurrent) {</code> </pre> <br>  Also found several "reinsurance": <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">comboBoxFind_KeyDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, KeyEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.KeyCode == Keys.Escape) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.KeyCode == Keys.Escape) { ProcessingEngine.PluginInstance.HidePVSSearchWindow(); } } }</code> </pre> <br>  And here once again rechecked the obvious thing: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;KeyValuePair&lt;String, DataRow&gt;&gt; GetSortedNonRetiredRows() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ei.ProjectNames.Count == <span class="hljs-number"><span class="hljs-number">1</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ei.ProjectNames.Count &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ei.ProjectNames.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'ei.ProjectNames.Count == 0' is always true.  PlogController.cs 277 <br><br>  Well, if he began to reinsure, then we must hold to the end and check everything.  Like, for example, here: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessVCProjAnalysisIntegration</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String Path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Remove</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Remove) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Remove) { .... } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression '! Remove' is always true.  VCProjectEngine.cs 733 <br><br>  Sometimes the code comes to ‚Äúvery strange ghosts,‚Äù but if you promised to write about everything, then we write: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostWebRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String post_data</span></span></span><span class="hljs-function">)</span></span> { .... String Sts = ex.Status.ToString() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> sts = wex.Status.ToString() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0455/">V3051</a> An excessive type cast.  The object is already of the 'String' type.  TrialExtensionRequest.cs 181 <br><br>  <a href="http://www.viva64.com/ru/d/0455/">V3051</a> An excessive type cast.  The object is already of the 'String' type.  TrialExtensionRequest.cs 241 <br><br>  The following checks are also found in our code: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get_StructMemberAlignment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CompileAsManaged.Equals(<span class="hljs-string"><span class="hljs-string">"false"</span></span>) || String.IsNullOrEmpty(CompileAsManaged)) Params += <span class="hljs-string"><span class="hljs-string">" /GR-"</span></span>; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0414/">V3027</a> The variable "CompileAsManaged" was used in the same logical expression.  MSVCParamsGenerator.cs 801 <br><br>  Once again: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get_DisableLanguageExtensions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DisableLanguageExtensions.Equals(<span class="hljs-string"><span class="hljs-string">"false"</span></span>) || String.IsNullOrEmpty(DisableLanguageExtensions)) { .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0414/">V3027</a> The variable "DisableLanguageExtensions" was used in the same logical expression.  MSVCParamsGenerator.cs 1118 <br><br>  It is a mistake to check a variable for null after the Equals function was called.  In fact, there is no real error here, because according to the API, the variables ‚ÄúCompileAsManaged‚Äù and ‚ÄúDisableLanguageExtensions‚Äù cannot be null.  Therefore, checks can be simplified to: <br><pre> <code class="cs hljs">CompileAsManaged == <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty DisableLanguageExtensions == <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty</code> </pre> <br>  Let's see where else we wrote the code, which received attention from the analyzer: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DialogResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowModalDialog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buttons == MessageBoxButtons.YesNo || buttons == MessageBoxButtons.YesNoCancel) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DialogResult.Yes; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buttons == MessageBoxButtons.OKCancel) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DialogResult.OK; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DialogResult.OK; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0402/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  Utilities.cs 496 <br><br>  Checking the variable buttons for equality MessageBoxButtons.OKCancel does not make sense because  in any case, we will return DialogResult.OK.  As a result, in our case, the code is reduced to: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (buttons == MessageBoxButtons.YesNo || buttons == MessageBoxButtons.YesNoCancel) ? DialogResult.Yes : DialogResult.OK;</code> </pre> <br>  And the last.  Here, most likely, refactoring is to blame: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadPlog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... XmlReadMode readMode = XmlReadMode.Auto; .... readMode = dataset.ReadXml(filename); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'readMode' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 512, 507. PlogController.cs 512 <br><h2>  <b>Conclusion</b> </h2><br>  Checking your code, you have different feelings.  If the mistake is made with your own hand, then you try to correct it or find an excuse for it.  If the other has a mistake, then you experience a completely different spectrum of feelings for it.  This is the big problem of realizing that we are all human and we are all mistaken.  Some of us admit it, and this is good, some persist: <br><br>  ‚Äú... these are not mistakes ...‚Äù <br><br>  ‚Äú... it's easy to fix ...‚Äù <br><br>  - ... 5 years worked, and no one complained ... <br><br>  Yes, indeed, many errors are easy to fix, and this is very good.  But to notice this typo or error is very difficult.  Often the error is noticed not by the programmer himself, but by the tester or, even worse, by the user. <br><br>  The goal of our analyzer is to help you see these errors and typos.  Agree, it is much better to write a large text in Microsoft Word than in notepad.  And the program code is often more than some sensational bestsellers. <br><br>  PVS-Studio, in fact, is the spelling system from Microsoft Word for your code.  He will simply tell you that here you were hurried and sealed up, or, perhaps, expressed their thought not in the way they wanted.  Agree - the correct formulation of thoughts in the text of the book is very important for the reader, and the correct formation of the program logic is important for the end user.  Using <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> you will be able to express and formulate your idea much better. <br><br>  We wish you inspiration and clear thought, and we will help you with this. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0382/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Vitaliy Alferov.  <a href="http://www.viva64.com/en/b/0382/">Checking PVS-Studio plugin with PVS-Studio analyzer</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/279437/">https://habr.com/ru/post/279437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279425/index.html">Using √Öngstr√∂m Style System in real projects</a></li>
<li><a href="../279427/index.html">About one funny approach to filtering unimodal signals</a></li>
<li><a href="../279429/index.html">Three main browsers added support for low-level WebAssembly binary format</a></li>
<li><a href="../279431/index.html">ePMP AP Lite | Use of ePMP 1000 Cambium Networks Licenses</a></li>
<li><a href="../279435/index.html">New ICQ for Windows, open source and something else</a></li>
<li><a href="../279439/index.html">A simple and not very obvious way to hang chrome, firefox and nodejs inside a native function</a></li>
<li><a href="../279441/index.html">MSLibrary. Implementing multiple selection of conditions using bitmasks, for iOS and not only ...</a></li>
<li><a href="../279443/index.html">Persistent RAM</a></li>
<li><a href="../279445/index.html">How to turn a conference trip into a cool weekend?</a></li>
<li><a href="../279447/index.html">What to write desktop client for a web service?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>