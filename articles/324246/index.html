<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Active Directory Recycle Bin: Usage Guidelines</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to publish a series of articles on the restoration of Active Directory objects and the tools used for this. 

 In the previous article, we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Active Directory Recycle Bin: Usage Guidelines</h1><div class="post__text post__text-html js-mediator-article">  We continue to publish a series of articles on the restoration of Active Directory objects and the tools used for this. <br><br>  In the previous <a href="https://habrahabr.ru/company/veeam/blog/317174/">article,</a> we analyzed cases where administrators have to work with domain controllers, where the functional mode of the Windows Server 2003 or Windows Server 2008 forest is set in Active Directory. As you recall, we have examined in detail the steps required to restore tombstone objects using the utility LDP and Veeam Explorer tool for Microsoft Active Directory. <br><br>  Today we will move on to more modern systems that allow you to use the Active Directory Recycle Bin function.  For details, I ask under the cat. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/f6d/191/818/f6d1918188a34f1296f061af8a7cfede.png"><br><a name="habracut"></a><br><h1>  How Active Directory Shopping Cart Works </h1><br>  Microsoft first implemented the long-awaited basket of Active Directory in Windows Server 2008 R2.  At the same time, the life cycle of Active Directory objects and the order of their deletion changed.  So, after deleting an object, the following happens now: <br><br><ol><li>  Immediately after deletion, the object is moved to the container of remote objects, where it remains until the end of the lifetime of the <i>remote</i> object (by default, this time is equal to the lifetime of the <i>recycled</i> object). <br>  <i>Important!</i>  All related and unrelated object attributes are stored in the system for the same time.  This means that during the specified period, the object can be restored along with all attributes. </li><li>  After the end of the lifetime of the object, the system changes its state to <i>recycled</i> and resets most of the attributes.  The object becomes analogous to the deleted ( <i>tombstone</i> ) in Windows Server 2003 and Windows Server 2008. The only difference is that it can no longer be restored. </li><li>  After the lifetime of the <i>recycled</i> object (the default is 180 days), it is automatically deleted by the garbage collector. </li></ol><br>  Schematically, these stages can be represented as: <br><br><img src="https://habrastorage.org/files/336/d42/2e9/336d422e973644009301bd3b073b2f60.png"><br><br><h1>  Enable Active Directory Recycle Bin </h1><br>  Currently, the cart is not activated by default in any Windows Server OS.  To use it, you need to prepare the infrastructure: make sure that all domain controllers are running Windows Server 2008 R2 or higher, and set the forest functional mode to Windows Server 2008 R2 or higher. <br><br>  <i>Useful:</i> Activating the Active Directory Recycle Bin, as well as any other significant changes to the Active Directory settings (or another production system), is recommended to be first tested in a sandbox.  To do this, you can use the technology of the <a href="https://habrahabr.ru/company/veeam/blog/182144/">virtual laboratory Veeam</a> .  In addition to the domain controller, you can also run other critical virtual machines in the virtual lab.  This technology helps a lot when testing multi-tier application compatibility after making changes.  Depending on the configuration, the virtual lab can be run from backups, replicas, or even hardware snapshots.  This will avoid unpleasant surprises when changing the settings of the production environment. <br><br>  Before you start using the Active Directory Recycle Bin, consider the following: <br><br><ol><li>  When you turn on the Active Directory Recycle Bin, all <i>tombstone</i> objects will turn into <i>recycled</i> objects, and it will be impossible to restore them after that. </li><li>  Restoring several dependent objects can be difficult, since it must be done in a strictly defined order, starting from the upper levels of the hierarchy. </li><li>  In Windows Server 2008 R2, all basket operations are performed using PowerShell cmdlets.  In Windows Server 2012, all basket actions can be performed through the user interface using the Active Directory Administrative Center (ADAC). <br><br><img src="https://habrastorage.org/files/4c9/7ae/f03/4c97aef0360b460b8024aba2f258c410.png"><br></li><li>  The recycle bin has nothing to do with the Active Directory backup and will not allow restoring the entire domain controller if it is damaged. </li></ol><br><h1>  Pros and cons of Active Directory Recycle Bin </h1><br>  When you turn on the Active Directory Recycle Bin, you‚Äôll see a new <b>Deleted Objects</b> container in the Active Directory Administrative Center.  In this container you will find all deleted objects, be able to view their properties and restore them to the original or any other place of your choice. <br><br><img src="https://habrastorage.org/files/f1c/d96/dc0/f1cd96dc03be44c4ac9de3e263c24980.png"><br><br>  Although at first glance, it is much easier to restore individual objects using this function than using the LDP utility or the ‚Äúauthoritative‚Äù restoration of a domain controller, you need to remember some pitfalls.  Below are the pros and cons of using the Active Directory Recycle Bin. <br><br><h2>  pros </h2><br><ol><li>  Universal method for domains with functional level of Windows Server 2008 R2 (and later). </li><li>  The long time of the object's existence (by default, 180 days is sufficient time for most tasks). </li><li>  Saving the attributes of the object during the time of its existence. </li><li>  No restart of the domain controller is required. </li><li>  Graphical Management Interface (ADAC) for Windows Server 2012 and higher. </li></ol><br><h2>  Minuses </h2><br><ol><li>  Does not work for domains that are functional in the forest of Windows Server 2008 and earlier. </li><li>  Not suitable for restoring changed objects (you can restore an object only if it was deleted). </li><li>  Recovery is possible only during the lifetime of the object. </li><li>  Does not provide protection against problems with the domain controller itself (can not be compared with a backup copy). </li><li>  Does not support automatic hierarchy recovery. </li></ol><br>  The second point is especially important here.  What to do if the object was not deleted, but accidentally changed, and the error was discovered much later?  Unfortunately, the basket does not help here, and this problem requires a different solution. <br><br><h1>  How Veeam allows you to bypass the basket restrictions </h1><br>  Of course, for most of you, basket minuses will not be a reason to abandon it.  However, those who want to get a universal solution for all tasks should think about overcoming the drawbacks of the basket.  And here Veeam comes on the scene with the previously discussed Veeam Explorer for Active Directory.  This tool completely eliminates the limitations of the Active Directory Recycle Bin: <br><br><ul><li>  With its help, all Active Directory objects will be protected during the entire backup storage period. </li><li>  It can be used for domains with forest functional scope of Windows Server 2003 and higher. </li></ul><br>  <i>Important!</i>  This tool is included in all editions of Veeam Backup &amp; Replication, including its free edition. <br><br>  Using Veeam Backup &amp; Replication and Veeam Explorer for Active Directory together, you can instantly restore the entire domain controller or restore individual Active Directory objects: organizational units (OU), computer and user accounts with passwords, group policy objects, DNS records, etc. In addition, by running Explorer, you can easily compare the objects in the backup with the current objects in the production environment and detect the differences, as well as identify the changed attributes. <br><br>  Below is an example of a situation where an administrator has detected a change in the attributes of a user account and must restore it to its original state. <br><br><img src="https://habrastorage.org/files/e17/598/998/e175989982ed47259194b2514a5ac6e2.png"><br><br>  In any case, if you take care of eliminating the consequences of possible failures of Active Directory in advance and test various tools for solving this problem, then you will be able to sleep well. <br><br><h1>  Additional links </h1><br>  Article on Habr√©: <a href="https://habrahabr.ru/company/veeam/blog/317174/">Recovering deleted AD objects from tombstone objects</a> <br>  Article on Habr√©: <a href="https://habrahabr.ru/company/veeam/blog/313570/">Restoring a domain controller from a backup using Veeam</a> <br>  Article on Habr√©: <a href="https://habrahabr.ru/company/veeam/blog/309904/">Backup of domain controllers using Veeam</a> </div><p>Source: <a href="https://habr.com/ru/post/324246/">https://habr.com/ru/post/324246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324236/index.html">MIPT launched an online course on innovative project management</a></li>
<li><a href="../324238/index.html">J-Bird, or as a bummer game sold</a></li>
<li><a href="../324240/index.html">We assemble your OpenShift Origin Cluster</a></li>
<li><a href="../324242/index.html">Replacing Oracle with PostgreSQL and the ability to work with partitioning inside a DLP system</a></li>
<li><a href="../324244/index.html">How to search for patterns in stock data and use them in trading?</a></li>
<li><a href="../324250/index.html">Calling Go functions from other languages</a></li>
<li><a href="../324256/index.html">Segmental</a></li>
<li><a href="../324258/index.html">How the dislike for the code helped me to ‚Äúpump over‚Äù designer skills</a></li>
<li><a href="../324260/index.html">Creating Web Applications with Scala.js and React - Part 1</a></li>
<li><a href="../324262/index.html">Interview IT specialists. On ‚Äúyou‚Äù or on ‚Äúyou‚Äù?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>