<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An interesting technique for hiding JS "virus" codes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today they dropped a code dropping a regular virus ‚Äúsend an SMS to unlock‚Äù to the machine. Background and methods of cleaning outlined force 

 I trie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An interesting technique for hiding JS "virus" codes</h1><div class="post__text post__text-html js-mediator-article">  Today they dropped a code dropping a regular virus ‚Äúsend an SMS to unlock‚Äù to the machine.  Background and methods of cleaning <a href="http://habrahabr.ru/blogs/virus/83945/">outlined</a> <a href="https://habrahabr.ru/users/force/" class="user_link">force</a> <br><br>  I tried to pick it up.  I took the code, formatted it, started debugging ... Hmm, interesting ... In the code there is a call (after reduction to readable form) <br><br><blockquote><code><font color="black">window[ <font color="#A31515">'eval'</font> ](var2);</font> <br></code> </blockquote><br>  But in var2 - binary data.  Wow ... But eval cannot execute binary data !!! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  I looked at the code ... and it turns out it uses its body to decrypt it and, accordingly, after formatting the code, the body has changed and the result of the decryption too. <br><br>  So you need to somehow run the unformatted code and at the same time do not catch anything harmful.  How?  Call debugger;  do not insert, do not breakpoint - all in one line ... <br><br>  Knowing that the script makes eval, you can apply this structure: <br><br><blockquote> <code><font color="black">window.eval = <font color="#0000ff">function</font> (arg) { <br> debugger; <br> }</font> <br></code> </blockquote><br>  After that, successfully catch the eval call and get all the code that the virus was trying to execute ... <br><br>  <b>UPD1</b> : Actually, why am I all this?  Previously, I have not met such sophisticated designs.  Basically, simple eval (base64_decode ('...')) was used;  Well, IMHO is an interesting debugging method through redefining eval ... <br><br>  <b>UPD2</b> : Attempting to deobfuscate and unpack the primary ‚Äúvirus‚Äù - <a href="">tyts</a> .  The source code (before the operation) can be seen on line 22.  What was there before is on the next one in the comment.  I did not try to run =).  The file is detected by heuristic anti-virus analyzers. <br><br>  <b>UPD3</b> : Already now, having parsed the code, it is clear that the decoder does not use all of its code for work.  He needs only numbers and their position is not important, order is important.  The initial ‚Äúglitch‚Äù with binary data turned out because I changed the name of the function to a more humane one.  And as you can see there were numbers.  That is why it all broke.  Adding new non-numbers does not affect the operation of the script. <br><br>  <b>UPD4</b> : What did the resulting code do in the end?  He defined the browser, installed plugins, and other information interesting for further actions (is Java, the system language (?) Included).  Further, in accordance with the received data, a URL was formed to obtain a further script, which, in turn, rendered the exploit most suitable for this configuration to the page.  In my environment, it was a Java applet.  According to colleagues, the applet downloaded from the link uses <a href="http://www.microsoft.com/security/portal/Threat/Encyclopedia/Entry.aspx%3FName%3DExploit%253AJava%252FCVE-2008-5353.C">this</a> vulnerability.  Codes of the "secondary" virus and the applet-expolit itself are available. <br><br>  <b>UPD5</b> : In the messages, an <a href="https://addons.mozilla.org/en-US/firefox/addon/10345">extension for FF is</a> reported, which allows you to see all the code defined and <b>executed</b> on the page. </div><p>Source: <a href="https://habr.com/ru/post/83893/">https://habr.com/ru/post/83893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83888/index.html">StarCraft 2 beta test in February</a></li>
<li><a href="../83889/index.html">February 16 at the United States will make training cyber attack</a></li>
<li><a href="../83890/index.html">The second open international conference dedicated to Maemo in Moscow</a></li>
<li><a href="../83891/index.html">Working with FBA accounts via C #</a></li>
<li><a href="../83892/index.html">jQuery 1.3.x -> 1.4.x and JSON</a></li>
<li><a href="../83894/index.html">Apple in the regions</a></li>
<li><a href="../83895/index.html">GuruPlug Server - a new version of an ultra-compact Linux server the size of a charger</a></li>
<li><a href="../83896/index.html">The introduction of free software in schools</a></li>
<li><a href="../83897/index.html">A bunch of Nginx + Apache, how to give Apache only PHP requests?</a></li>
<li><a href="../83898/index.html">The first Blu-ray 3D player</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>