<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Containerizing Angular 6 SPA Template ASP .NET Core 2.1 Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPDATE from 11/01/2018 { 
 Thanks to the help in the comments, below is a more ideologically correct version of the docker file. 

 The standard Angul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Containerizing Angular 6 SPA Template ASP .NET Core 2.1 Applications</h1><div class="post__text post__text-html js-mediator-article">  UPDATE from 11/01/2018 { <br>  Thanks to the help in the comments, below is a more ideologically correct version of the docker file. <br><br>  The standard Angular SPA Template project template contains an error.  Developers in the version of net .core 2.1.  removed from the microsoft / dotnet: 2.1-sdk image used to build the nodejs, but the code in the project file uses it.  Learn more here <a href="https://github.com/aspnet/Announcements/issues/298">github.com/aspnet/Announcements/issues/298</a> <br>  You must manually edit the project file * .csproj, removing the following code <br><div class="spoiler">  <b class="spoiler_title">Code to remove from * .csproj</b> <div class="spoiler_text"><pre><code class="cs hljs">&lt;Target Name=<span class="hljs-string"><span class="hljs-string">"PublishRunWebpack"</span></span> AfterTargets=<span class="hljs-string"><span class="hljs-string">"ComputeFilesToPublish"</span></span>&gt; &lt;!-- As part of publishing, ensure the JS resources are freshly built <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> production mode --&gt; &lt;Exec WorkingDirectory=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"npm install"</span></span> /&gt; &lt;Exec WorkingDirectory=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"npm run build -- --prod"</span></span> /&gt; &lt;Exec WorkingDirectory=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"npm run build:ssr -- --prod"</span></span> Condition=<span class="hljs-string"><span class="hljs-string">" '$(BuildServerSideRenderer)' == 'true' "</span></span> /&gt; &lt;!-- Include the newly-built files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the publish output --&gt; &lt;ItemGroup&gt; &lt;DistFiles Include=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)dist\**; $(SpaRoot)dist-server\**"</span></span> /&gt; &lt;DistFiles Include=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)node_modules\**"</span></span> Condition=<span class="hljs-string"><span class="hljs-string">"'$(BuildServerSideRenderer)' == 'true'"</span></span> /&gt; &lt;ResolvedFileToPublish Include=<span class="hljs-string"><span class="hljs-string">"@(DistFiles-&gt;'%(FullPath)')"</span></span> Exclude=<span class="hljs-string"><span class="hljs-string">"@(ResolvedFileToPublish)"</span></span>&gt; &lt;RelativePath&gt;%(DistFiles.Identity)&lt;/RelativePath&gt; &lt;CopyToPublishDirectory&gt;PreserveNewest&lt;/CopyToPublishDirectory&gt; &lt;/ResolvedFileToPublish&gt; &lt;/ItemGroup&gt; &lt;/Target&gt;</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Correct dockerfile</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">ARG NODE_IMAGE=node:<span class="hljs-number"><span class="hljs-number">8.12</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-aspnetcore-runtime <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> base WORKDIR /app EXPOSE <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-sdk <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> build WORKDIR /src <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> ["AngularWebApp/AngularWebApp.csproj", "AngularWebApp/"] RUN dotnet restore "AngularWebApp/AngularWebApp.csproj" <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> . . WORKDIR "/src/AngularWebApp" <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ${NODE_IMAGE} <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> node-build WORKDIR /src <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> AngularWebApp/ClientApp . RUN npm install RUN npm run build <span class="hljs-comment"><span class="hljs-comment">-- --prod FROM build AS publish RUN dotnet publish "AngularWebApp.csproj" -c Release -o /app FROM base AS final WORKDIR /app COPY --from=publish /app . COPY --from=node-build /src/dist ./ClientApp/dist ENTRYPOINT ["dotnet", "AngularWebApp.dll"]</span></span></code> </pre> <br></div></div><br>  } <br><br>  Unfortunately I did not find a ready solution anywhere.  I had to compile information from several sources.  To run the Angular 6/7 application in the docker as a project on an ASP .NET Core. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If we include standard support for the docker for a project with the Angular application, then the docker file will create an image of the application based on the microsoft / dotnet: 2.1-aspnetcore-runtime image.  This base image does not include the node.js server.  And the ASP .NET Core error will be output in the execution results. <br><a name="habracut"></a><br><br><pre> <code class="hljs pgsql">An unhandled <span class="hljs-keyword"><span class="hljs-keyword">exception</span></span> occurred <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> processing the request. The NPM script <span class="hljs-string"><span class="hljs-string">'start'</span></span> exited <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> indicating that the Angular CLI was listening <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> requests</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a86/95a/1e6/a8695a1e647a8c8fe2649fe373ead513.jpg" alt="image"><br><br>  To resolve this error, you need to update the Docker file by adding the node.js and angular installation. <br>  In addition, since the development goes under Windows, and it all runs in the Ubunty-based Docker container, if scss or sass style files are used, they are compiled by Angular CLI using node-sass, and at startup produced an error ‚ÄúNode Sass does not yet support your current environment: Windows 64-bit with Unsupported runtime ‚Äù.  You must run the command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">npm</span></span> rebuild node-sass</code> </pre> <br>  npm will download the necessary scripts for the current platform and rebuild the css files. <br><br>  The resulting Docker file for the Angular application based on the ASP .NET Core 2.1 project is as follows <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-aspnetcore-runtime <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> base # Setup NodeJs RUN apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> &amp;&amp; \ apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install -y wget &amp;&amp; \ apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install -y gnupg2 &amp;&amp; \ wget -qO- https://deb.nodesource.com/setup_8.x | bash - &amp;&amp; \ apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install -y build-essential nodejs RUN npm install @angular/cli -g # <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> setup WORKDIR /app EXPOSE <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-sdk <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> build WORKDIR /src <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> ["AngularWebApp/AngularWebApp.csproj", "AngularWebApp/"] RUN dotnet restore "AngularWebApp/AngularWebApp.csproj" <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> . . WORKDIR "/src/AngularWebApp" RUN dotnet build "AngularWebApp.csproj" -c <span class="hljs-keyword"><span class="hljs-keyword">Release</span></span> -o /app <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> build <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> publish RUN dotnet publish "AngularWebApp.csproj" -c <span class="hljs-keyword"><span class="hljs-keyword">Release</span></span> -o /app <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> base <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> final WORKDIR /app <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> <span class="hljs-comment"><span class="hljs-comment">--from=publish /app . WORKDIR /app/ClientApp RUN npm install RUN npm rebuild node-sass WORKDIR /app ENTRYPOINT ["dotnet", "AngularWebApp.dll"]</span></span></code> </pre> <br>  I used the stable LTS release of Node.js, at the moment 8.x, but can be changed to any more relevant. <br><br>  In addition, I also note that Windows forgives errors associated with various case of characters, but Linux does not forgive this.  And the project that worked during development will refuse to compile in the container, giving an error <br><br><pre> <code class="hljs pgsql">docker ERROR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> error TS1149: File <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-string"><span class="hljs-string">'filename.ts'</span></span> differs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> already included file <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-string"><span class="hljs-string">'FileNames.ts'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> casing</code> </pre> <br>  In order to avoid such errors at the compilation stage, I recommend adding the appropriate option ‚ÄúforceConsistentCasingInFileNames‚Äù: true to the tsconfig.json file in the compilerOptions section <br><br><pre> <code class="hljs objectivec">{ <span class="hljs-string"><span class="hljs-string">"compilerOptions"</span></span>: { <span class="hljs-string"><span class="hljs-string">"forceConsistentCasingInFileNames"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } }</code> </pre><br>  angular, angular6 / 7, asp .net core 2.1, docker </div><p>Source: <a href="https://habr.com/ru/post/428107/">https://habr.com/ru/post/428107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428097/index.html">Recursive routing to MikroTik through DHCP designated gateways</a></li>
<li><a href="../428099/index.html">What do common dress and upcoming 5G era have in common?</a></li>
<li><a href="../428101/index.html">How to automate with Jenkins the assembly and rolling-out of artifacts of the metadata model for tables in the repository</a></li>
<li><a href="../428103/index.html">Mitap in Petersburg: Data Engineering and not only</a></li>
<li><a href="../428105/index.html">Blogger recommends: influence-marketing</a></li>
<li><a href="../428109/index.html">Corporate wall</a></li>
<li><a href="../428111/index.html">Arithmetic of arbitrary precision in Erlang</a></li>
<li><a href="../428113/index.html">On the question of Bezier curves, speed Arduino and one interesting site, or how I spent the weekend</a></li>
<li><a href="../428115/index.html">Web development for ecommerce: 5 technology trends for 2019</a></li>
<li><a href="../428117/index.html">Google's free tensor processors in the cloud laboratory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>