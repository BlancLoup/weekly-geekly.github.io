<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Capture all .io domains with targeted registration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we discussed the seizure of the domain extensions .na , .co.ao, and .it.ao using various DNS tricks. Now consider the threat ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Capture all .io domains with targeted registration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/77b/e95/667/77be956670d1465dabe157fd9a4fe45b.jpg" align="left">  In the <a href="https://thehackerblog.com/the-journey-to-hijacking-a-countrys-tld-the-hidden-risks-of-domain-extensions/index.html">previous article,</a> we discussed the seizure of the domain extensions <i>.na</i> , <i>.co.ao,</i> and <i>.it.ao using</i> various DNS tricks.  Now consider the threat of compromising a top-level domain (TLD) and how an attacker needs to act in order to achieve the goal.  One of the rather simple methods is to register the domain name of one of the <a href="https://en.wikipedia.org/wiki/Name_server">authoritative name servers for</a> this TLD.  Since TLD authoritative servers can be located on arbitrary domains, there is a chance to register such a domain, taking advantage of an error due to incorrect configuration, expiration or other errors.  Then this server can be used to issue new DNS records in the whole domain zone. <br><br>  I will cite here the corresponding quote from the previous article: <br><br><blockquote>  This option seemed like the right way to win, so I spent a lot of time developing tools for checking this type of error.  In essence, this process consists in recording all the name server hosts for a given domain - and checking when the registration of any of the root domains expires and it becomes available for registration.  The main problem is that many registrars do not say that the domain is completely free until you really try to buy it.  In addition, there were several cases when the server expired on registration, but for some reason the domain was not available for registration, although it was not marked as reserved.  As a result of such a scan, it was possible to fix many interceptions of domains in closed zones (.gov, .edu, .int, etc.), but not the TLDs themselves. </blockquote><br>  As it turned out, this method is not only suitable for attacking TLDs, but in reality has led to the largest seizure of TLDs to date. <br><a name="habracut"></a><br><h2>  Anomaly .io </h2><br>  On Friday evening, compiling a <a href="https://github.com/mandatoryprogrammer/trusttrees">schedule of DNS delegation</a> for various TLDs, my script produced an unexpected result for the .io zone: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href=""><img src="https://habrastorage.org/web/166/885/56e/16688556ee424cdfa746f8bfc126b253.png"></a> <br><br>  One of the functions of this script (called <a href="https://github.com/mandatoryprogrammer/trusttrees">TrustTrees</a> ) is that it can transfer <a href="https://www.gandi.net/">the Gandi API key to it</a> - and it will check if there are any domain names in the delegation chain with domain names free for registration.  The script showed that in the .io zone, many name server domains are available for purchase!  However, this does not mean that they really can be bought.  Previously, I repeatedly encountered the fact that a free domain name cannot be registered because it is ‚Äúreserved‚Äù.  I decided to go to the website of the registrar <a href="https://www.nic.io/">NIC.IO</a> and check.  Having quickly looked for the domain name <i>ns-a1.io</i> , I was surprised to find that it was put up for sale at a price of $ 90.00.  Since it was about midnight ( <i>probably, the author considers this a ‚Äúchildish‚Äù time - approx. Per.</i> ), I decided to continue and really try to buy this domain.  Soon a letter arrived confirming that the registration of the domain name was ‚Äúbeing processed‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e00/416/e29/e00416e29f43990c4e09a3214b828e58.png"><br><br>  It's not entirely clear why the letter came from 101Domain.  She is probably engaged in the registration of domains in the .io zone (perhaps, she manages the entire registry?).  At that time, well past midnight, I shrugged and went to bed, and forgot about this incident until such a letter arrived on Wednesday morning when I was about to leave for work: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5bc/0d2/3c3/5bc0d23c3a469ff6977686745cb600d9.png"><br><br>  Then I remembered my Friday investigation and all registration details.  I had to go back to the computer: I wonder, did I really get control of the domain name server .io?  I quickly ran the <code>dig</code> command for the domain - and made sure that my test DNS name servers ( <i>ns1 / ns2.networkobservatory.com</i> ) are really recorded on <i>ns-a1.io</i> : <br><br><pre> <code class="bash hljs">bash-3.2$ dig NS ns-a1.io ; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; NS ns-a1.io ;; global options: +cmd ;; Got answer: ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 8052 ;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0 ;; QUESTION SECTION: ;ns-a1.io. IN NS ;; ANSWER SECTION: ns-a1.io. 86399 IN NS ns2.networkobservatory.com. ns-a1.io. 86399 IN NS ns1.networkobservatory.com. ;; Query time: 4 msec ;; SERVER: 2604:5500:16:32f9:6238:e0ff:feb2:e7f8<span class="hljs-comment"><span class="hljs-comment">#53(2604:5500:16:32f9:6238:e0ff:feb2:e7f8) ;; WHEN: Wed Jul 5 08:46:44 2017 ;; MSG SIZE rcvd: 84 bash-3.2$</span></span></code> </pre> <br>  I requested one of the root DNS servers and again made sure that this domain was specified as an authoritative name server for the first-level domain zone .io: <br><br><pre> <code class="bash hljs">bash-3.2$ dig NS io. @k.root-servers.net. ; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; NS io. @k.root-servers.net. ;; global options: +cmd ;; Got answer: ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 19611 ;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 7, ADDITIONAL: 12 ;; WARNING: recursion requested but not available ;; QUESTION SECTION: ;io. IN NS ;; AUTHORITY SECTION: io. 172800 IN NS ns-a1.io. io. 172800 IN NS ns-a2.io. io. 172800 IN NS ns-a3.io. io. 172800 IN NS ns-a4.io. io. 172800 IN NS a0.nic.io. io. 172800 IN NS b0.nic.io. io. 172800 IN NS c0.nic.io. ;; ADDITIONAL SECTION: ns-a1.io. 172800 IN AAAA 2001:678:4::1 ns-a2.io. 172800 IN AAAA 2001:678:5::1 a0.nic.io. 172800 IN AAAA 2a01:8840:9e::17 b0.nic.io. 172800 IN AAAA 2a01:8840:9f::17 c0.nic.io. 172800 IN AAAA 2a01:8840:a0::17 ns-a1.io. 172800 IN A 194.0.1.1 ns-a2.io. 172800 IN A 194.0.2.1 ns-a3.io. 172800 IN A 74.116.178.1 ns-a4.io. 172800 IN A 74.116.179.1 a0.nic.io. 172800 IN A 65.22.160.17 b0.nic.io. 172800 IN A 65.22.161.17 c0.nic.io. 172800 IN A 65.22.162.17 ;; Query time: 70 msec ;; SERVER: 2001:7fd::1<span class="hljs-comment"><span class="hljs-comment">#53(2001:7fd::1) ;; WHEN: Wed Jul 5 08:46:14 2017 ;; MSG SIZE rcvd: 407</span></span></code> </pre> <br>  Wow!  I immediately connected via SSH to my test DNS server, to which this domain was now linked, and quickly killed the working BIND server.  If DNS traffic hits me, I definitely don‚Äôt want to return bad answers to people who have legitimate access to their .io domains.  Since the BIND server no longer processes requests for port 53, all DNS requests are automatically redirected to other name servers of this TLD and do not affect traffic too much (except for a small delay in resolving, until DNS clients reach a working name server).  To see if DNS requests really went to me, I quickly started recording <a href="https://en.wikipedia.org/wiki/Tcpdump">tcpdump</a> dump of all DNS traffic to a file - and right there hundreds of requests from random IPs from all over the Internet rushed to the screen.  It seems that I really handled the traffic for the entire domain zone.  And even worse: it was probably only the beginning, because many DNS clients were still guided by cached old DNS records, which will be updated soon. <br><br><h2>  Report Security Issue in a TLD </h2><br>  Since my server no longer responded to DNS requests, I was only thinking about how to fix the situation as quickly as possible.  What bothered me most was that there were still a lot of domains for name servers that anyone who had the money and the knowledge of what to do could register.  I searched for .io TLD admin contacts in <a href="https://www.iana.org/domains/root/db/io.html">the IANA root database</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/412/f60/67b/412f6067be54ec2eb40f2986e13b7ef9.png"><br><br>  Then he made a description of the problem and sent letters to both addresses, noting the need for an urgent solution.  I indicated that domains for other TLD name servers are still available for registration and that if the problem is not resolved within a few hours, I will register them to protect the zone.  Immediately after sending the letter, I received a bounce from the mail server with the indication that the address <i>adminstrator@nic.io</i> does not exist: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f5/017/0c4/5f50170c4868a74e65f6621eae54620b.png"><br><br>  This obviously did not add confidence that someone would read my letter.  So I decided to spend some money and buy the rest of the name server domains so that nobody hacked the TLD.  As in the first case, I explicitly configured the DNS server not to accept incoming requests, so I did not interfere with normal .io traffic.  These purchase orders were issued fairly quickly: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/178/1a7/2a1/1781a72a17993136b7a097305f4e7c34.png"><br><br>  Whew!  At least, some random hacker won't hack them, and I can go to work with a pure heart. <br><br>  Later that day, I phoned in support of NIC.IO and asked for the valid email address of someone from the security department staff for the TLD.  The agent assured me that the appropriate address for such a request would be <i>abuse@101domain.com</i> (I asked him twice for that matter for sure).  Although this address does not look appropriate, I sent a report describing the problem and hoped that it would at least be sent to a competent specialist.  Since it was not possible to find out other addresses, I waited for an answer. <br><br><h2>  "Oops" - correction by canceling domain registration </h2><br>  Around noon the next day, a series of notifications from 101Domains came that the domain registrations were canceled, the money was returned to the card, and my ‚Äúticket in the support‚Äù was answered and closed: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cbe/344/c9b/cbe344c9b9a73ad344176fdce0faba95.png"><br><br>  Surprisingly, it seems that the abuse @ address really turned out to be the right address to solve the problem.  Logging in to your 101Domain account, I discovered such a letter from the 101Domain legal department: <br><br> <a href=""><img src="https://habrastorage.org/web/96d/b70/8c7/96db708c768f40f8a8b0f7120d1e5bcc.png"></a> <br><br>  Everything was done fairly quickly and correctly (although usually I get just a letter with the notice instead of the answer of the legal department).  Making sure that these domains were not available for registration, it was possible to conclude that the situation was completely corrected. <br><br><h2>  Possible consequences </h2><br>  Given that we registered four of the seven authoritative name servers for the .io domain zone, we could change / redirect DNS records for all registered .io domains.  Moreover, since we controlled more than half of the name servers, DNS queries were <i>more</i> likely to come to us without any additional tricks like <a href="https://thehackerblog.com/respect-my-authority-hijacking-broken-nameservers-to-compromise-your-target/index.html">long TTL responses</a> and others that increase our chances even more.  Even under the condition of an immediate reaction to this kind of attack, it will take some time until the cached records are completely erased from all the world's DNS resolvers. <br><br>  To remedy the situation, it would help that DNSSEC technology is supported in the .io domain zone.  This means that if your resolver also supports this technology, you can protect yourself from such attacks with fake DNS records.  But as I said in the last article, <a href="https://dnssec.vs.uni-due.de/">almost no one uses DNSSEC</a> .  I rarely see any support for this technology, unless I specifically set up a resolver myself. <br><br>  <i>* One note that is not related to the topic: it is important not to forget to stop tcpdump after starting.</i>  <i>If you do not do this, then you have a good chance to fill all the disk space on the VPS with DNS data.</i>  <i>Please note that all DNS data recorded for debugging purposes is cleared of confidential user information.</i> <br><br><h2>  TLD Protection and Security </h2><br>  I wrote in some detail how TLDs can avoid some of these problems (for more information, see ‚ÄúConclusions and Recent Thoughts‚Äù in the article ‚Äú <a href="https://thehackerblog.com/the-journey-to-hijacking-a-countrys-tld-the-hidden-risks-of-domain-extensions/index.html">Hacking a National TLD ‚Äî The Hidden Risks of Domain Name Extensions</a> .‚Äù In the future, I‚Äôm going to put together more extensive guidelines TLD and domain name extension operators to monitor and prevent such situations. <br><br><h2>  Greetings </h2><br>  I promised my friend that I would give him a hacker greeting in the next blog post, so I must fulfill my promise :).  Special thanks to these guys for moral and "immoral" support (as the one and only <a href="https://twitter.com/aegarbutt">HackerBadger said</a> ). <br><br>  <b>Hi, <a href="https://twitter.com/aegarbutt">HackerBadger</a> , EngSec (you know who you are), <a href="https://www.youtube.com/watch%3Fv%3Du3CKgkyc7Qo">Hacke the planet</a> , <a href="https://www.youtube.com/watch%3Fv%3DBmz67ErIRa4">the gibson</a> and all that.</b> </div><p>Source: <a href="https://habr.com/ru/post/333026/">https://habr.com/ru/post/333026/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333014/index.html">Testing in Openshift: Automated Testing</a></li>
<li><a href="../333016/index.html">Delhi - cut, or as we did mobile 2GIS Online</a></li>
<li><a href="../333018/index.html">What is ERP system</a></li>
<li><a href="../333020/index.html">Creating a blog engine with Phoenix and Elixir / Part 10. Channel testing</a></li>
<li><a href="../333024/index.html">Top Achievement Code</a></li>
<li><a href="../333028/index.html">Whats going on with HEVC (h265)</a></li>
<li><a href="../333030/index.html">Bare words in javascript</a></li>
<li><a href="../333032/index.html">Why the guide does not accept agile and what can you do about it</a></li>
<li><a href="../333034/index.html">Upsource 2017.2 released with support for external code inspections, Python, NPM, and more</a></li>
<li><a href="../333036/index.html">Yubikey 4 - purchase, delivery and receipt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>