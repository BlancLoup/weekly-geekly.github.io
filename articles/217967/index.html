<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Converting RAID 10 of 4 drives to RAID 6 of 8 drives on HP Proliant servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We will perform the conversion on the HP Proliant DL160 G8 server with the usual partitioning into sections (not lvm). Those. drives sda1 ... sda8, ea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Converting RAID 10 of 4 drives to RAID 6 of 8 drives on HP Proliant servers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/578/211/bfe/578211bfe38bc16262c1d94a4a712565.jpg" alt="image"><br><br>  We will perform the conversion on the HP Proliant DL160 G8 server with the usual partitioning into sections (not lvm).  Those.  drives sda1 ... sda8, each of which is mounted in a specific directory.  In the case of lvm, the process is slightly easier and more convenient.  The article should be suitable for any hp-server that uses the official utility hpacucli.  In this example, we have CentOS 6.5, but any Linux supported by hpacucli will do. <br><a name="habracut"></a><br>  In the process of conversion, to add space to CentOS, you will have to unmount the directory to which we will add free space (the last one in the partitioned table is parted - sda8), and also make a reboot, unless all sections of sda1..sda8 are used by any process. <br><br><h5>  Add wheels </h5><br>  Check what kind of RAID we have, how many disks there are, as well as how many disks are not used: <br> <code>#hpacucli ctrl all show config</code> <br>  In our case, the team will show 4 disks in RAID 10 and 4 unused disks that we just inserted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Add unused drives to RAID 10: <br> <code>#hpacucli ctrl slot=2 ld 1 add drives=allunassigned</code> <br> <br><h5>  Convert RAID 10 to RAID 6 </h5><br>  Convert with the command: <br> <code>#hpacucli ctrl slot=2 ld 1 modify raid=6</code> <br>  Check that we now have RAID 6 out of 8 disks: <br> <code>#hpacucli ctrl all show config</code> <br> <code>Smart Array P420 in Slot 2 (sn: PDSXK0BRH5S1AY)</code> <br> <code>array A (SAS, Unused Space: 1525708 MB)</code> <br> <code>logicaldrive 1 (558.7 GB, RAID 6 (ADG), OK)</code> <br> <code>physicaldrive 1I:1:1 (port 1I:box 1:bay 1, SAS, 300 GB, OK)</code> <br> <code>physicaldrive 1I:1:2 (port 1I:box 1:bay 2, SAS, 300 GB, OK)</code> <br> <code>physicaldrive 1I:1:3 (port 1I:box 1:bay 3, SAS, 300 GB, OK)</code> <br> <code>physicaldrive 1I:1:4 (port 1I:box 1:bay 4, SAS, 300 GB, OK)</code> <br> <code>physicaldrive 2I:1:5 (port 2I:box 1:bay 5, SAS, 300 GB, OK)</code> <br> <code>physicaldrive 2I:1:6 (port 2I:box 1:bay 6, SAS, 300 GB, OK)</code> <br> <code>physicaldrive 2I:1:7 (port 2I:box 1:bay 7, SAS, 300 GB, OK)</code> <br> <code>physicaldrive 2I:1:8 (port 2I:box 1:bay 8, SAS, 300 GB, OK)</code> <br>  Expand the resulting RAID to the maximum size: <br> <code>#hpacucli ctrl slot=2 ld 1 modify size=max</code> <br> <code>array A (SAS, Unused Space: 0 MB)</code> <br> <br><h4>  Adding space to CentOS </h4><br>  Making CentOS re-scan RAID: <br> <code>#echo 1 &gt; /sys/block/sda/device/rescan</code> <br>  We look that physically the place appeared: <br> <code>#fdisk -l</code> <br> <br><h5>  Adding free space to the last section in the partition table </h5><br>  Let's look at the current partition table by converting units of measurement into sectors: <br> <code>#parted /dev/sda</code> <br> <code>(parted) unit s</code> <br> <code>(parted) print</code> <br> <code>Model: HP LOGICAL VOLUME (scsi)</code> <br> <code>Disk /dev/sda: 3515228764s</code> <br> <code>Sector size (logical/physical): 512B/512B</code> <br> <code>Partition Table: msdos</code> <br> <code>Number Start End Size Type File system Flags</code> <br> <code>1 2048s 1026047s 1024000s primary ext4 boot</code> <br> <code>2 1026048s 84912127s 83886080s primary ext4</code> <br> <code>3 84912128s 168798207s 83886080s primary ext4</code> <br> <code>4 168798208s 1171743323s 1002945116s extended</code> <br> <code>5 168800256s 252686335s 83886080s logical ext4</code> <br> <code>6 252688384s 294631423s 41943040s logical ext4</code> <br> <code>7 294633472s 303022079s 8388608s logical linux-swap(v1)</code> <br> <code>8 303025152s 1171743323s 868718172s logical ext4</code> <br>  We see that the last section is the 8th.  Remember the beginning of the 8th section (303025152s).  We look where it is mounted: <br> <code>#mount |grep sda8</code> <br> <code>/dev/sda8 on /var/lib type ext4 (rw)</code> <br>  We are looking for whether anyone uses the / var / lib directory: <br> <code>#lsof /var/lib</code> <br>  Turn off all services / processes that this utility has shown. <br>  Now you can unmount the directory: <br> <code>#umount /var/lib</code> <br>  If we have only one partition where the root of the system is located, then we are not lucky, and we will have to boot into rescue mode, after which we can continue on. <br>  We can add a place only to the last (8th) section. <br>  First, increase the 4th extended partition, because  All sections with more than four numbers are essentially contained inside the 4th: <br> <code>#parted</code> <br> <code>(parted) resize 4 168798208s -1s</code> <br>  We delete the 8th section (nothing will happen to the data) and create a new one using the memorized sector number of the beginning of this section. <br> <code>(parted) rm 8</code> <br> <code>(parted) mkpart logical ext4 303024128s -1s</code> <br> <br>  Now in order for CentOS to see the modified partition table, if no process uses the sda1..sda8 partitions, then we simply do partprobe / dev / sda, otherwise (more likely) we simply reboot the server. <br>  After this, we increase the partition's file system (if we managed to avoid a reboot, then you need to remember to mount the partition back with the command mount / dev / sda8 / var / lib): <br> <code>#resize2fs /dev/sda8</code> <br> <br>  Checking: <br>  #df -h <br> <code>/dev/sda8 1.5T 229M 1.4T 1% /var/lib</code> <br>  <b>PS</b> <br>  Why did we convert RAID 10 to RAID 6? <br>  Because it is much faster for 8 disks.  This fact is verified and tested by me personally. <br>  Useful links: <br><br>  <a href="http://h20565.www2.hp.com/portal/site/hpsc/template.PAGE/public/psi/mostViewedDisplay%3Fjavax.portlet.begCacheTok%3Dcom.vignette.cachetoken%26javax.portlet.endCacheTok%3Dcom.vignette.cachetoken%26javax.portlet.prp_efb5c0793523e51970c8fa22b053ce01%3Dwsrp-navigationalState%253DdocId%25253Demr_na-c03493210-1%25257CdocLocale%25253Den_US%26javax.portlet.tpst%3Defb5c0793523e51970c8fa22b053ce01%26sp4ts.oid%3D5177957%26ac.admitted%3D1396360470424.876444892.492883150">Hpacucli Utility for Linux - All Commands Guide</a> . </div><p>Source: <a href="https://habr.com/ru/post/217967/">https://habr.com/ru/post/217967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217951/index.html">Festo has created a new type of wind generator.</a></li>
<li><a href="../217953/index.html">Will China UnionPay replace MasterCard and Visa for Russians?</a></li>
<li><a href="../217959/index.html">Mysterious game from IBM</a></li>
<li><a href="../217963/index.html">Analysis and visualization of real tabular data in R</a></li>
<li><a href="../217965/index.html">Eight tricks that marketers can borrow from Agile programmers</a></li>
<li><a href="../217969/index.html">Loading historical data in SAP using LSMW - we write "macro"</a></li>
<li><a href="../217973/index.html">ZNC bouncer on RPi</a></li>
<li><a href="../217977/index.html">Know How: P-branding as improving the appearance of the site and the desired advertising format</a></li>
<li><a href="../217979/index.html">Google now allows you to customize the services panel</a></li>
<li><a href="../217981/index.html">Yandex and the Higher School of Economics open the Computer Science faculty</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>