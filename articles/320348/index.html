<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to establish a trust relationship between the computer and the main domain</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello Dear Habrahabr readers! In the Internet, each of us can find a lot of separate articles about not going through computer authentication through ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to establish a trust relationship between the computer and the main domain</h1><div class="post__text post__text-html js-mediator-article">  Hello Dear Habrahabr readers!  In the Internet, each of us can find a lot of separate articles about not going through computer authentication through a domain controller, more precisely, a computer connected to a domain loses connection with it. <br><br>  So, we will start studying this problem. <br><a name="habracut"></a><br>  Many IT engineers who work in large and small companies have computers with the Windows 7, 8.1 operating system, etc.  and all these computers are connected to a domain network (DC). <br><br>  This problem occurs due to the fact that the Kerberos network protocol cannot synchronize and authenticate with the computer (which is connected to the domain).  Then we can see such an error (see photo below). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/62e/c7f/075/62ec7f0754ef4106ae1efb3f8ee055d2.jpg" alt="image"></div><br>  After that, we search for a third-party program, download it, create a bootable USB flash drive and local admin, then log in through it and exit the domain, add the computer to the Workgroup and then connect this computer back to the domain. <br><br>  Using Windows Batch scripting, I want to create a bat file and automate the process of creating and adding a local admin.  The only thing we need is to run it after creating this file. <br><br>  Open our text editor, enter the command shown below. <br><br><pre><code class="hljs pgsql">net <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> Ww123456 /<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> /active:yes WMIC USERACCOUNT <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> "Name='admin'" <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> PasswordExpires=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> net localgroup Administrators <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> net localgroup Users <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> netsh advfirewall <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> allprofiles state <span class="hljs-keyword"><span class="hljs-keyword">off</span></span></code> </pre> <br>  Let's go through all the teams on the points to eliminate unclear points. <br><br>  ‚Ä¢ net user admin (instead of the word admin, you can add any name that suits you, the default is administrator, in my case it is admin). <br>  Next we see the password that I put there Ww123456 (you can put any password that is remembered for you). <br><br>  After we see / add / active: yes ‚Äìadd and activate: YES <br><br>  ‚Ä¢ WMIC USERACCOUNT WHERE "Name = 'admin'" SET PasswordExpires = FALSE - this command means that the admin that is added has a permanent password with no expiration date (see picture below). <br><br><img src="https://habrastorage.org/files/78f/7a4/5cb/78f7a45cbe1b4f48b1155d18bd82def2.jpg" alt="image"><br><br>  ‚Ä¢ The third and fourth paragraphs are interconnected by the fact that by default, when a local admin is created, the Member Of item is set to Users (see photo).  We do not need it (Users), because we create a full-fledged administrator for our OS.  Therefore, the fourth command, net localgroup Users admin / delete, deletes Users, and the previous command, net localgroup Administrators admin / add, adds an administrator (see photo). <br><br><img src="https://habrastorage.org/files/43c/6d1/271/43c6d127194542a39e188e521ba8a086.jpg" alt="image"><br><br><img src="https://habrastorage.org/files/a33/f84/036/a33f84036e83490f88f7b4887bfc27a9.jpg" alt="image"><br><br>  ‚Ä¢ The last command, netsh advfirewall set allprofiles state off, disables the Windows firewall. <br>  Sometimes, to install a program or give a command to the Windows-e, you need to disable the firewall (After running the script, you can enter the command-netsh advfirewall set allprofiles state on and re-enable it. I have off by default, because I'm using a third-party firewall. This is at the discretion of each person personally). <br><br>  Next we go to our notebook, click File, save as ... (save as ...) enter the name of our script (in my case: localadmin). Then put a dot (.) And write the format of the bat script.  Choose a place to save this entry and click save.  Shown in more detail in the picture. <br><br><img src="https://habrastorage.org/files/0ab/d05/e23/0abd05e23e7a45ca8605d262100b37cd.jpg" alt="image"><br><br>  It turns out that such a script (see photo). <br><br><img src="https://habrastorage.org/files/2aa/01f/71b/2aa01f71b6c8419f8ec63d94a46e40f4.jpg" alt="image"><br><br>  At startup, this script must be opened as an administrator: <br><br>  ‚Ä¢ Press the right mouse button and Run as administrator (see photo). <br><br><img src="https://habrastorage.org/files/0f5/d3d/41f/0f5d3d41f80c41c0ae7172d18685cd14.jpg" alt="image"><br><br>  After launching the script, you should have this window (see photo). <br><br><img src="https://habrastorage.org/files/4c6/4e9/91d/4c64e991ddb64d03ade452b42db11ef8.jpg" alt="image"><br><br>  If for any reason an error occurs, then in 90% of such cases this is due to the fact that your image from which you installed Windows is of an unlicensed nature, some kind of repack or the like.  Download and use the licensed and proven software. <br><br>  After successfully adding a local admin, you can run this script on all workstations in your office that have Windows installed. <br><br>  If you ever get this error: The trust relationship you need only make the switch user and write the login where. \ Admin (remember! At the beginning, before the slash, the period is set!), Below enter the password you added to your script (in my case: Ww123456).  After that you go to the working OS. <br><br>  It remains to remove our computer from the domain and add it to the Workgroup.  Instead of a Workgroup, we enter any letter (see photo). <br><br><img src="https://habrastorage.org/files/6fa/341/11e/6fa34111e2c04d379124d8a99e785795.JPG" alt="image"><br><br>  Next, enter the domain administrator password and the computer asks us to restart. <br>  After the reboot, we go under our local admin again and then we add the computer to our domain.  The system once again requires a reboot and Voila!  Our User can again connect to the domain without any problems! <br><br>  PS - This system also works for the server part of Windows, however, if you write such a script for servers after disabling the firewall, you will need to enable it again (before - netsh advfirewall set allprofiles state off, after netsh advfirewall set allprofiles state on). <br><br>  Thank you for attention! </div><p>Source: <a href="https://habr.com/ru/post/320348/">https://habr.com/ru/post/320348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320336/index.html">Labor market overview in the field of big data and data science</a></li>
<li><a href="../320338/index.html">Observed models in Realm Xamarin</a></li>
<li><a href="../320342/index.html">Tale of the impossible bug: big.LITTLE and caching</a></li>
<li><a href="../320344/index.html">Olympiad of MIPT on electronics for schoolchildren</a></li>
<li><a href="../320346/index.html">Docker implementation for a small project in Production, part 2</a></li>
<li><a href="../320350/index.html">Five years, five educational projects: briefly about the main and the history of teachers</a></li>
<li><a href="../320354/index.html">How were born the IT-dynasties in Belarus</a></li>
<li><a href="../320356/index.html">How we lost 150,000 and closed the project</a></li>
<li><a href="../320360/index.html">What the flask?</a></li>
<li><a href="../320362/index.html">The first real campaign campaigns Yandex Direct in Adwords</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>