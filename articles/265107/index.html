<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Some experience developing games on Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I do not consider myself an experienced programmer, and the more serious game developer. I am a person who is interested in programming and I get a li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Some experience developing games on Unity3D</h1><div class="post__text post__text-html js-mediator-article">  I do not consider myself an experienced programmer, and the more serious game developer.  I am a person who is interested in programming and I get a little bit.  The article does not claim to be called educational material or instruction. <br><br>  Screenshots to attract attention: <br><img width="400" height="200" src="https://habrastorage.org/files/adb/d47/884/adbd47884de942df92280c58843ec8d3.png" alt="image"><img width="400" height="200" src="https://habrastorage.org/files/1b7/441/969/1b744196917b4c988e5a2beeeda14d43.png" alt="image"><br><br><h5>  Moral issue </h5><br>  Is it worth doing this without having serious knowledge in game development, modeling, programming?  The answer to the question from me will not follow, it will be for everyone.  I can definitely say for sure - I did not regret.  I will try to briefly and clearly identify and describe the bottlenecks with which I encountered, lay a map on the rake. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Unity3d </h5><br>  Unity3d has recently been allowed to use for free and at full power.  I have long tossed between several engines, but c # turned out to be a decisive advantage for me.  In addition, Unity3d is a very convenient way to build a user interface.  For those who are not afraid of Lua, I can also advise Project Anarchy, or the Unreal Engine 4, if you are not squeamish about visual programming.  I got the impression that Unity3D is great for mobile development.  Unfortunately, Unity3D has a weak Russian-speaking community and often has to go to the official qa. <br><a name="habracut"></a><br><h5>  Game architecture </h5><br>  I have attempted to apply existing patterns, but in the end it all came down to ‚Äúfor now let it lie here‚Äù.  There are many components in Unity that are difficult to attribute to some type.  Most likely the reason for this is my inexperience, but in the end, such scripts as <i>BotSpawner</i> remained to lie in the root of the <i>Scripts</i> folder without having a shelter. <br><br><h5>  Save to Unity and Database </h5><br>  I used embedded <i>PlayerPrefs</i> and <i>sqlite</i> .  Sqlite can now be used out of the box in the free version.  For me, sql tables were convenient for storing data of goods when trading.  The most convenient tool for managing tables is <i>sqlitebrowser</i> , we stopped him trying some competitors. <br><br>  Writing and reading in PlayerPrefs is similar to: <br><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DB</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentShipBodyState { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PlayerPrefs.GetInt(<span class="hljs-string"><span class="hljs-string">"currentShipBodyState"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { PlayerPrefs.SetInt(<span class="hljs-string"><span class="hljs-string">"currentShipBodyState"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } }</code> </pre> <br>  followed by elegant reading and writing: <br><pre> <code class="hljs objectivec">db.currentShipBodyState = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> shbs = db.currentShipBodyState;</code> </pre><br><br>  Sqlite demanded big gestures.  Below is an example of using Sqlite in Unity3d version 5. <br>  To use Sqlite in the editor, it is enough to create the <i>StreamingAssets</i> directory and place the database file there.  In order to work with the database on the android device, the database file must be placed in <i>Application.persistentDataPath</i> .  The official documentation is characterized as a public directory that is not overwritten when the program is updated.  You also need to create the <i>Plugins</i> and <i>Plugins \ Android</i> directory.  In the first place sqlite3.dll and System.Data.dll in <i>Plugins \ Android</i> place libsqlite3.so. <br><br>  Universal <s>kalo</s> code for connecting to the database: <br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IDbConnection connector() { //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Application.platform != RuntimePlatform.Android) { //<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span>(Application.dataPath + "/StreamingAssets/db.sqlite"); dbconn = (IDbConnection)<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SqliteConnection("URI=file:" + Application.dataPath + "/StreamingAssets/db.sqlite"); dbconn.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span>(); //<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">database</span></span>. } // android <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //    string filepath = Application.persistentDataPath + "/" + "db.sqlite"; //       ,    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!File.<span class="hljs-keyword"><span class="hljs-keyword">Exists</span></span>(filepath)) { WWW loadDB = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WWW("jar:file://" + Application.dataPath + "!/assets/" + "db.sqlite"); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!loadDB.isDone) { } File.WriteAllBytes(filepath, loadDB.bytes); } dbconn = (IDbConnection)<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SqliteConnection("URI=file:" + Application.persistentDataPath + "/db.sqlite"); dbconn.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span>(); //<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">database</span></span>. } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dbconn; }</code> </pre><br><br>  database queries, these are ordinary sql queries: <br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> List&lt;string&gt; getItemInfoFromIslandByItemName(string item) { dbconn = connector(); dbcmd = dbconn.CreateCommand(); string sqlQuery = "SELECT island_resources.amount, island_resources.weight, island_resources.title, island_resources.price, island_resources.sell_price,ship_resources.amount FROM island_resources INNER JOIN ship_resources ON island_resources.title=ship_resources.title WHERE island_resources.title='" + item + "' AND island_resources.island_id=" + zones_filter(current_zone_name) + " "; dbcmd.CommandText = sqlQuery; reader = dbcmd.ExecuteReader(); <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>[] <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>[reader.FieldCount]; <span class="hljs-type"><span class="hljs-type">int</span></span> fieldCount = reader.GetValues(<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>); List&lt;string&gt; list = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;string&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; fieldCount; i++) { list.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[i].ToString() ); } clean(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; }</code> </pre><br><br><h5>  Modeling, landscape and water </h5><br>  I studied modeling on the go, video lessons.  Ships (two available ships) are the fruits of my labors.  It turned out to be harder to texture, it took no more than 30 minutes on the model. <br>  The landscape was an unexpected problem.  The built-in terrain creation system is unsuitable for mobile devices due to high draw calls (dc).  In my game, a large map and many islands.  I had to take a lot of effort to get a quality landscape.  To create a relief, I can advise <i>GeoControl</i> from which you can import a height map into Unity, then convert it to a mesh using a special plug-in.  The resulting mesh needs to be optimized in the 3d editor, I use Maya.  As a result, the number of dc does not exceed 100. I tried a huge amount of water assets, the choice fell on standard water4 water. <br><br><h5>  AI </h5><br>  To control the bots did not use the search paths.  I decided to build an "intelligence" on the detection of obstacles and reactions from the ship's navigation system.  The ship of the bot we shoot rays in 3 directions, when an obstacle is detected by one of the rays, the command "steering" is transmitted.  When a protagonist ship is detected (when approaching the minimum distance), the bot receives the target of the pursuit and tries to get into a position convenient for the shot.  When a protagonist is detected, the lateral rays transmit the command to the script responsible for firing.  If there are no obstacles in the vicinity, the bots live their life and travel along the ‚Äúsea routes‚Äù from island to island. <br><br><h5>  In-game purchases Unity3d </h5><br>  The choice fell on <i>OpenIAB</i> .  Incredibly simple solution to a complex problem. <br>  1. In the content section for google play sales, create a product. <br>  2. Create a script in which you make several simple operations. <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"> private <span class="hljs-type"><span class="hljs-type">void</span></span> Awake() { //     OpenIABEventManager.billingSupportedEvent += OnBillingSupported; OpenIABEventManager.billingNotSupportedEvent += OnBillingNotSupported; OpenIABEventManager.queryInventorySucceededEvent += OnQueryInventorySucceeded; OpenIABEventManager.queryInventoryFailedEvent += OnQueryInventoryFailed; OpenIABEventManager.purchaseSucceededEvent += OnPurchaseSucceded; OpenIABEventManager.purchaseFailedEvent += OnPurchaseFailed; OpenIABEventManager.consumePurchaseSucceededEvent += OnConsumePurchaseSucceeded; OpenIABEventManager.consumePurchaseFailedEvent += OnConsumePurchaseFailed; OpenIABEventManager.transactionRestoredEvent += OnTransactionRestored; OpenIABEventManager.restoreSucceededEvent += OnRestoreSucceeded; OpenIABEventManager.restoreFailedEvent += OnRestoreFailed; } //    <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> () { OpenIAB.mapSku(SKU_COINS_2000, OpenIAB_Android.STORE_GOOGLE, "id   "); OpenIAB.mapSku(SKU_COINS_5000, OpenIAB_Android.STORE_GOOGLE, "id   "); var public_key = "      api"; var <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OnePF.<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.storeKeys.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(OpenIAB_Android.STORE_GOOGLE, public_key); <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.verifyMode = OptionsVerifyMode.VERIFY_ONLY_KNOWN; OpenIAB.init(<span class="hljs-keyword"><span class="hljs-keyword">options</span></span>); }</code> </pre><br></div></div><br>  3. In a convenient way for you, call <i>OpenIAB.purchaseProduct (id of the item you created);</i> <br><br>  If the purchase is successful, the <i>OnPurchaseSucceded</i> method is <i>called with</i> which we listened for the successful execution of the purchase operation.  If the purchase is successful, the product must be consumed, otherwise the second purchase will not be available. <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPurchaseSucceded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Purchase purchase</span></span></span><span class="hljs-function">)</span></span> { OpenIAB.consumeProduct(purchase); }</code> </pre><br>  If you use it successfully, <i>OnConsumePurchaseSucceeded</i> is <i>called</i> here, you can make an entry to assign the goods to the player, etc. <br><br><h5>  Sound management, solving the problem of simultaneous playback of several sounds on one object </h5><br>  Create an empty object on which we hang this script: <br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AudioManager : MonoBehaviour { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span> target; //      "" //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> AudioClip cannon_fire_sound_AC; //   private AudioSource cannon_fire_sound_AS; //   <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">bool</span></span> is_cannon_fire; <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Update</span></span> () { this.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.position = target.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.position; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_cannon_fire) { cannon_fire_sound_AS = AddAudio(cannon_fire_sound_AC, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>f); cannon_fire_sound_AS.Play(); is_cannon_fire = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } AudioSource AddAudio(AudioClip clip, <span class="hljs-type"><span class="hljs-type">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>, <span class="hljs-type"><span class="hljs-type">bool</span></span> playAwake, <span class="hljs-type"><span class="hljs-type">float</span></span> vol) { var newAudio = gameObject.AddComponent&lt;AudioSource&gt;(); newAudio.clip = clip; newAudio.<span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; newAudio.playOnAwake = playAwake; newAudio.volume = vol; newAudio.minDistance = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newAudio; } }</code> </pre><br>  Then from the right place we call <i>AudioManager.is_cannon_fire = true; // not the best name for the variable</i> <br><br><h5>  Admob </h5><br>  Trying to understand the intricacies of Admob.  I filled up the account for 500r for tests and launched the promotion by setting the daily limit to 100r.  After a couple of hours, I admire this: <br><img src="https://habrastorage.org/files/521/25b/569/52125b569cfb4e51830a9155640f2b05.png"><br>  Honestly I did not understand where such amounts came from, most likely my inattention to details.  But still, I hope this is not an invoice from Admob. <br><br>  The game was called <i>Pirates and traders</i> , Google Play is available.  Naturally requires improvements and development.  Those interested can touch, the search at the time of writing is on the 29th place. <br><br><img width="200" height="80" src="https://habrastorage.org/files/fe5/efa/446/fe5efa446e5343fcbb297c1c88232b0c.png"></div><p>Source: <a href="https://habr.com/ru/post/265107/">https://habr.com/ru/post/265107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265091/index.html">Migrating from 3CX v12 Cloud Server to 3CX v14 Virtual PBX Server</a></li>
<li><a href="../265093/index.html">MOOC courses in robotics</a></li>
<li><a href="../265095/index.html">Cycle optimization: blocks needed</a></li>
<li><a href="../265103/index.html">Tehnokniga, part 1: literature on web technologies, algorithms and data structures, in-depth C ++ programming</a></li>
<li><a href="../265105/index.html">Data Science Week - microanons for those who do not know</a></li>
<li><a href="../265109/index.html">Bootstrap 4 released in alpha version</a></li>
<li><a href="../265111/index.html">Making the code cleaner: When does the use of the devres API harm?</a></li>
<li><a href="../265115/index.html">Go 1.5 released</a></li>
<li><a href="../265117/index.html">NDK c half-kick</a></li>
<li><a href="../265119/index.html">Introduction to the new CoordinatorLayout</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>