<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Operator << options for logger</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dear habrovchane, I was born a publication - a question. I am pleased to hear your criticism in the comments. 


 The project had to sketch a small wr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Operator << options for logger</h1><div class="post__text post__text-html js-mediator-article"><p>  Dear habrovchane, I was born a publication - a question.  I am pleased to hear your criticism in the comments. </p><br><p>  The project had to sketch a small wrapper over the existing logging system and, in addition to its main purpose, I wanted to use it in the style of working with the output stream. </p><a name="habracut"></a><br><p>  Omitting unnecessary details, the wrapper looks like this: </p><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggerWrap</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RequiredInterface { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; str)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//     /* ...       RequiredInterface ... */ };</span></span></code> </pre> <br><p>  And I also want to use something like this: </p><br><pre> <code class="cpp hljs">LoggerWrap <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">" 1: "</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::setw(<span class="hljs-number"><span class="hljs-number">10</span></span>) &lt;&lt; someValue &lt;&lt; <span class="hljs-string"><span class="hljs-string">";  2:"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::setw(<span class="hljs-number"><span class="hljs-number">15</span></span>) &lt;&lt; anotherValue;</code> </pre> <br><p>  In the process of thinking, I came up with several decisions that I want to discuss. </p><br><h1 id="variant-1">  Option 1 </h1><br><p>  Overload the operator &lt;&lt;, the data received by him to send to the local stream ostringstream.  At the end of writing to the log a special object - a sign of the end of the line. </p><br><p>  The solution might look something like this: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggerWrap</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; str)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   std::cout &lt;&lt; "[Log]: " &lt;&lt; str &lt;&lt; std::endl; } /* ...      ... */ struct Flush {}; //   template&lt;typename T&gt; LoggerWrap&amp; operator&lt;&lt; (const T&amp; data) { buf &lt;&lt; data; return *this; } LoggerWrap&amp; operator&lt;&lt; (const Flush&amp;) { write(buf.str()); buf.str(""); buf.flags(defFmtFlags); return *this; } private: thread_local static std::ostringstream buf; const thread_local static std::ios::fmtflags defFmtFlags; }; thread_local std::ostringstream LoggerWrap::buf; const thread_local std::ios::fmtflags LoggerWrap::defFmtFlags(buf.flags());</span></span></code> </pre> <br><p>  Using: </p><br><pre> <code class="cpp hljs">LoggerWrap logger; logger &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1.2</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">", text again"</span></span> &lt;&lt; LoggerWrap::Flush(); logger &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::scientific &lt;&lt; <span class="hljs-number"><span class="hljs-number">2.3</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">", text again"</span></span> &lt;&lt; LoggerWrap::Flush(); logger &lt;&lt; <span class="hljs-string"><span class="hljs-string">"string #"</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">10.5</span></span> &lt;&lt; LoggerWrap::Flush();</code> </pre> <br><p>  the console will print: </p><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[Log]</span></span>: <span class="hljs-selector-id"><span class="hljs-selector-id">#1</span></span>: 1<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">again</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Log]</span></span>: <span class="hljs-selector-id"><span class="hljs-selector-id">#2</span></span>: 2<span class="hljs-selector-class"><span class="hljs-selector-class">.300000e</span></span>+00, <span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">again</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Log]</span></span>: <span class="hljs-selector-id"><span class="hljs-selector-id">#3</span></span>: 10<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span></code> </pre> <br><p>  For me, the disadvantage of this option is the need to write LoggerWrap :: Flush ().  You can forget to write it and then try to understand for a long time what the hell is happening in the log. </p><br><h1 id="variant-2">  Option 2 </h1><br><p>  How to determine that the line for logging is complete, without explicit reference to this?  I decided to rely on the lifetime of the temporary object.  When a function returns an object, then it lives while there is a link to it.  In this way, you can create a temporary object with your operator &lt;&lt;, which returns a reference to this object, and its destructor will call the LoggerWrap :: write method. </p><br><p>  It turns out the following: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggerWrap</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; str)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   std::cout &lt;&lt; "[Log]: " &lt;&lt; str &lt;&lt; std::endl; } /* ...      ... */ class TmpLog { friend class LoggerWrap; public: ~TmpLog() { if (flush) { logger.write(buf.str()); buf.str(""); } } template&lt;typename T&gt; TmpLog&amp; operator&lt;&lt; (const T&amp; data) { buf &lt;&lt; data; return *this; } TmpLog(const TmpLog&amp;) = delete; private: TmpLog(const LoggerWrap&amp; logger, std::ostringstream&amp; buf) : logger(logger), buf(buf) { } TmpLog(TmpLog&amp;&amp; that): logger(that.logger), buf(that.buf), flush(that.flush) { that.flush = false; } const LoggerWrap&amp; logger; std::ostringstream&amp; buf; bool flush = true; }; template&lt;typename T&gt; TmpLog operator&lt;&lt; (const T&amp; data) { buf.flags(defFmtFlags); TmpLog tmlLog(*this, buf); return std::move(tmlLog &lt;&lt; data); } private: thread_local static std::ostringstream buf; const thread_local static std::ios::fmtflags defFmtFlags; }; thread_local std::ostringstream LoggerWrap::buf; const thread_local std::ios::fmtflags LoggerWrap::defFmtFlags(buf.flags());</span></span></code> </pre> <br><p>  and use: </p><br><pre> <code class="cpp hljs"> LoggerWrap logger; logger &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1.2</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">", text again"</span></span>; logger &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::scientific &lt;&lt; <span class="hljs-number"><span class="hljs-number">2.3</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">", text again"</span></span>; logger &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">10.5</span></span>;</code> </pre> <br><p>  console output will be similar to the first solution. </p><br><h1 id="itogi">  Results </h1><br><p>  Logging levels are not specified here (Warning, Error, Info, etc.) as our logging system does not distinguish between them, but adding it to the wrapper is not difficult.  For example, define LoggerWrap :: operator (), taking as an argument the desired level for the string to be output. </p><br><p>  I prefer the second solution, since I don‚Äôt need to add a certain magic word after each line.  And when adding logging levels, this information can be stored in a temporary object for the current line. </p><br><p>  Thank you for reading, I hope to see your opinion in the comments. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/342160/">https://habr.com/ru/post/342160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342148/index.html">Digital Transformation: Lottery in the Cloud</a></li>
<li><a href="../342152/index.html">Frontend distribution via CDN</a></li>
<li><a href="../342154/index.html">Simulator cars Breitenberg</a></li>
<li><a href="../342156/index.html">How self-taught programmers get jobs in reality</a></li>
<li><a href="../342158/index.html">How to legalize newsletter clients</a></li>
<li><a href="../342162/index.html">Syntax analysis in NLTK. Continuation</a></li>
<li><a href="../342168/index.html">Internet: everything is very bad</a></li>
<li><a href="../342170/index.html">Java 9 overview</a></li>
<li><a href="../342172/index.html">Creating concept art in 3D</a></li>
<li><a href="../342174/index.html">How to follow trends on github</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>