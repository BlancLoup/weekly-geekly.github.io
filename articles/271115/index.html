<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hibernate. Basic principles of working with sessions and transactions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my first article on Habr√©, I would like to share some thoughts and comments on working with Hibernate regarding sessions and transactions. I stoppe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hibernate. Basic principles of working with sessions and transactions</h1><div class="post__text post__text-html js-mediator-article">  In my first article on Habr√©, I would like to share some thoughts and comments on working with Hibernate regarding sessions and transactions.  I stopped at some of the nuances that arise at the beginning of the development of this topic.  I admit, while Junior programmer himself, with Hibernate did not work constantly, therefore, <s>as always</s> , mistakes are possible, if you notice these, I will be grateful for the amendments. <br><br>  Hibernate is the most popular ORM library and a Java Persistence API implementation.  It is often used as an ORM provider in regular Java applications, servlet containers, in particular, in the JBoss application server (and its descendant WildFly). <br><br>  Let's start, perhaps. <br><a name="habracut"></a><br><h5>  one).  Entity Objects </h5><br>  Consider two entities - the user and his task: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"user"</span></span> ( user_id <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, login <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">role</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> user_pkey PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (user_id) ) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> task ( task_id <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, user_id <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>, task_date <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>), definition <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> tasks_pkey PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (task_id), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> fk_user <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (user_id) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-string"><span class="hljs-string">"user"</span></span> (user_id) <span class="hljs-keyword"><span class="hljs-keyword">MATCH</span></span> SIMPLE <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> )</code> </pre> <br>  Now we give the entity classes for these tables: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"user"</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"public"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long userId; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer role; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Task&gt; tasks; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@SequenceGenerator</span></span>(name = <span class="hljs-string"><span class="hljs-string">"user_seq"</span></span>, sequenceName = <span class="hljs-string"><span class="hljs-string">"user_user_id_seq"</span></span>, allocationSize = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.SEQUENCE, generator = <span class="hljs-string"><span class="hljs-string">"user_seq"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"user_id"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> userId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUserId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userId = userId; } <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(fetch = FetchType.LAZY, mappedBy = <span class="hljs-string"><span class="hljs-string">"user"</span></span>, cascade = CascadeType.ALL) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Tasks&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tasks; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Tasks&gt; tasks)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tasks = tasks; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"login"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> login; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.login = login; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"password"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> password; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password; } } <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"task"</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"public"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Task</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long taskId; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> User user; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date taskDate; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String definition; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Priority priority; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Type type; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@SequenceGenerator</span></span>(name = <span class="hljs-string"><span class="hljs-string">"tasks_seq"</span></span>, sequenceName = <span class="hljs-string"><span class="hljs-string">"tasks_task_id_seq"</span></span>, allocationSize = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.SEQUENCE, generator = <span class="hljs-string"><span class="hljs-string">"tasks_seq"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"task_id"</span></span>, unique = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTaskId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> taskId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTaskId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long taskId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.taskId = taskId; } <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.LAZY, cascade = CascadeType.ALL) <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"user_id"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> User </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user = user; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"task_date"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Date </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTaskDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> taskDate; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTaskDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date taskDate)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.taskDate = taskDate; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"definition"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefinition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> definition; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDefinition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String definition)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.definition = definition; } }</code> </pre><br>  JPA annotations can be found <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/package-summary.html">here</a> . <br><br><h5>  2).  Session Interface </h5><br>  In Hibernate, working with a database is done through an object of type <i>org.hibernate.Session</i> . <br>  Excerpt from the documentation: <br><blockquote>  The main runtime interface between a Java application and Hibernate.  This is a central API. <br>  Session is bounded by the beginning of the logical transaction.  (Long transactions might span several database transactions.) <br>  For the mapped entity classes. <br></blockquote><br>  The <i>org.hibernate.Session</i> interface is the bridge between the application and Hibernate.  With the help of sessions, all CRUD operations with <i>entity objects</i> are performed.  An object of type <i>Session is</i> obtained from an instance of type <i>org.hibernate.SessionFactory</i> , which must be present in the application as a <i>singleton</i> . <br><br><h5>  3).  Object states </h5><br>  An entity object can be in one of 3 states (statuses): <br><br><ul><li>  <i>transient object</i> .  Objects in this status are completed instances of entity classes.  Can be saved in db.  Not attached to the session.  The <i>Id</i> field must not be filled, otherwise the object has a <i>detached</i> status; </li><li>  <i>persistent object</i> .  The object in this status is the so-called stored entity, which is attached to a specific session.  Only in this status the object interacts with the database.  When working with an object of this type as part of a transaction, all changes to the object are recorded in the database; </li><li>  <i>detached object</i> .  An object in this status is an object disconnected from a session, it may or may not exist in the database. </li></ul><br>  Any entity object can be transferred from one status to another.  For this, the following methods exist in the <i>Session</i> interface: <br><br><ul><li>  <i>persist (Object)</i> - converts an object from <i>transient</i> to <i>persistent</i> , that is, attaches to the session and saves it to the database.  However, if we assign a value to the object's <i>Id</i> field, we get <i>PersistentObjectException</i> - Hibernate will consider that the object is <i>detached</i> , i.e. it exists in the database.  When saving, the <i>persist ()</i> method immediately executes the <i>insert</i> , without making a <i>select</i> . </li><li>  <i>merge (Object)</i> - converts an object from <i>transient</i> or <i>detached</i> to <i>persistent</i> .  If from <i>transient</i> , it works in the same way as <i>persist ()</i> (generates a new <i>Id</i> for an object, even if it is specified), if from <i>detached</i> - loads an object from the database, attaches to the session, and when saved, performs an <i>update</i> request </li><li>  <i>replicate (Object, ReplicationMode)</i> - converts an object from <i>detached</i> to <i>persistent</i> , while the object must have an <i>Id</i> pre-set.  This method is intended to save an object with the specified <i>Id</i> in the database, which is not possible to do <i>persist ()</i> and <i>merge ()</i> .  If an object with this <i>Id</i> already exists in the database, then the behavior is determined according to the rule from the <i>org.hibernate.ReplicationMode</i> enumeration: <br>  <i>ReplicationMode.IGNORE</i> - nothing changes in the database. <br>  <i>ReplicationMode.OVERWRITE</i> - the object is saved to the database instead of the existing one. <br>  <i>ReplicationMode.LATEST_VERSION</i> - the object with the latest version is saved in the database. <br>  <i>ReplicationMode.EXCEPTION</i> - generates an exception. </li><li>  <i>delete (Object)</i> - deletes an object from the database, in other words, converts <i>persistent</i> to <i>transient</i> .  <i>Object</i> can be in any status, as long as <i>Id is</i> set. </li><li>  <i>save (Object)</i> - saves the object in the database, generating a new <i>Id</i> , even if it is installed.  <i>Object</i> can be <i>transient</i> or <i>detached</i> </li><li>  <i>update (Object)</i> - updates the object in the database, transforming it into <i>persistent</i> ( <i>Object</i> in the <i>detached</i> status) </li><li>  <i>saveOrUpdate (Object)</i> - calls <i>save ()</i> or <i>update ()</i> </li><li>  <i>refresh (Object)</i> - updates the <i>detached</i> object by executing <i>select</i> to the database and converts it to <i>persistent</i> </li><li>  <i>get (Object.class, id)</i> - gets from the database an object of an entity class with a specific <i>Id</i> in the <i>persistent</i> status </li></ul><br>  The <i>Session</i> object caches the loaded objects;  When an object is loaded from the database, the cache is first checked.  To remove an object from the cache and disconnect from the session, use <i>session.evict (Object)</i> .  The <i>session.clear ()</i> method will apply <i>evict ()</i> to all objects in the session. <br><br>  And now let's pay attention to the annotations <i>@OneToMany</i> and <i>@ManyToOne</i> in <i>entity</i> classes.  The <i>fetch</i> parameter in <i>@OneToMany</i> indicates when to load child objects.  It can have one of the two values ‚Äã‚Äãspecified in the <i>javax.persistence.FetchType</i> enumeration: <br><br>  <i>FetchType.EAGER</i> - load a collection of child objects immediately when loading parent objects. <br>  <i>FetchType.LAZY</i> - load a collection of child objects when it is first accessed (call <i>get</i> ) - the so-called delayed loading. <br><br>  The <i>cascade</i> parameter indicates which of the methods of the <i>Session</i> interface will be cascaded to the associated entities.  For example, in the <i>User</i> entity class for the <i>tasks</i> collection, we specify: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(fetch = FetchType.LAZY, mappedBy = <span class="hljs-string"><span class="hljs-string">"user"</span></span>, cascade = {CascadeType.PERSIST, CascadeType.MERGE}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Tasks&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tasks; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Tasks&gt; tasks)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tasks = tasks; }</code> </pre><br>  Then, when running <i>session.persist (user)</i> or <i>session.merge (user)</i> , the <i>persist</i> or <i>merge</i> operations will be applied to all objects from <i>tasks</i> .  Similarly for the remaining operations from the <i>javax.persistence.CascadeType</i> enumeration.  <i>CascadeType.ALL</i> applies all operations from the enumeration.  You need to properly configure <i>CascadeType</i> in order not to load a bunch of unnecessary associated entity objects from the database. <br><br><h5>  four).  Extracting objects from the database </h5><br>  Let's give a simple example: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SessionFactory sessionFactory </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId)</span></span></span><span class="hljs-function"> </span></span>{ ... Session session = sessionFactory.openSession(); User user = (User) session.load(User.class, userId); Session session = sessionFactory.openSession(); List&lt;Task&gt; tasksList = user.getTasks(); ... }</code> </pre><br>  Instead of the <i>session.get ()</i> method, you can use <i>session.load ()</i> .  The <i>session.load ()</i> method returns the so-called <i>proxy-object</i> .  <i>Proxy-object</i> is a mediation object through which we can interact with a real object in the database.  It expands the functionality of the entity object.  The interaction with the <i>proxy-object is</i> completely analogous to the interaction with the entity object.  <i>Proxy-object</i> differs from the entity object in that when creating a <i>proxy-object,</i> not a single query to the database is executed, that is, Hibernate simply believes that the object with the given <i>Id</i> exists in the database.  However, the <i>proxy object</i> first called <i>get</i> or <i>set</i> immediately triggers a <i>select</i> request, and if the object with the given <i>Id is</i> not in the database, then we will get an <i>ObjectNotFoundException</i> .  The main purpose of the <i>proxy-object</i> is to implement delayed loading. <br><br>  Calling <i>user.getTasks ()</i> initiates the loading of user tasks from the database, since the <i>User</i> class for <i>tasks is</i> set to <i>FetchType.LAZY</i> . <br><br><h6>  LazyInitializationException </h6><br>  With the parameter <i>FetchType.LAZY</i> need to be careful.  Sometimes when loading associated entities, we can catch a <i>LazyInitializationException</i> exception.  In the above code, during a call to <i>user.getTasks (), the</i> <i>user</i> must be either <i>persistent</i> or <i>proxy</i> . <br><br>  Also, <i>LazyInitializationException</i> may cause a slight change in our code: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Task&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId)</span></span></span><span class="hljs-function"> </span></span>{ ... Session session = sessionFactory.openSession(); User user = (User) session.load(User.class, userId); List&lt;Task&gt; tasksList = user.getTasks(); session.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tasksList; }</code> </pre><br>  Here, theoretically, everything is correct.  But when trying to access <i>tasksList,</i> we CAN get a <i>LazyInitializationException</i> .  But in the debugger, this code executes correctly.  Why?  Because <i>user.getTasks ()</i> only returns a link to the collection, but does not wait for it to load.  Without waiting for the data to load, we closed the session.  Exit - perform in a transaction, i.e .: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Task&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId)</span></span></span><span class="hljs-function"> </span></span>{ ... User user = (User) session.load(User.class, userId); Session session = sessionFactory.openSession(); session.beginTransaction(); List&lt;Task&gt; tasksList = user.getTasks(); session.getTransaction().commit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tasksList; }</code> </pre><br><h6>  Sample with conditions </h6><br>  And now we give some simple examples of data sampling with conditions.  To do this, Hibernate uses objects of type <i>org.hibernate.Criteria</i> : <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Task&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login)</span></span></span><span class="hljs-function"> </span></span>{ ... Session session = sessionFactory.openSession(); Criteria userCriteria = session.createCriteria(User.class); userCriteria.add(Restrictions.eq(<span class="hljs-string"><span class="hljs-string">"login"</span></span>, login)); user = (User) userCriteria.uniqueResult(); session.close(); ... }</code> </pre><br>  Here it is clear that we execute <i>select * from user where login = 'login'</i> .  In the <i>add</i> method, we pass an object of type <i>Criterion</i> , representing a certain selection criterion.  The <i>org.hibernate.criterion.Restrictions</i> class provides many different kinds of criteria.  The ‚Äúlogin‚Äù parameter indicates the name of the property of the class-entity, and not the field in the database table. <br>  Here are a couple of examples: <br><br>  but). <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Task&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasksByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ ... session = sessionFactory.openSession(); Criteria criteria = session.createCriteria(Task.class); List&lt;Task&gt; tasks = criteria.add(Restrictions.like(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, name, MatchMode.ANYWHERE)).list(); ... }</code> </pre><br>  Here we select the contents of the <i>name</i> property of the <i>Task</i> class entity.  <i>MatchMode.ANYWHERE</i> means that you need to search for the substring <i>name</i> anywhere in the <i>name</i> property. <br><br>  b). <br>  And here we get 50 lines, starting from the 20th number in the table. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Task&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... Session session = sessionFactory.openSession(); Criteria criteria = session.createCriteria(Task.class); List&lt;Task&gt; tasks = criteria.setFirstResult(<span class="hljs-number"><span class="hljs-number">20</span></span>).setMaxResults(<span class="hljs-number"><span class="hljs-number">50</span></span>).list(); ... }</code> </pre><br><h5>  five).  Saving objects </h5><br>  Let's look at several ways to save an entity object to the database. <br><br>  but).  Create a <i>transient-object</i> and save it to the database: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UserDao userDao; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SessionFactory sessionFactory; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login)</span></span></span><span class="hljs-function"> </span></span>{ User user = userDao.getUserByLogin(login); Session session = sessionFactory.openSession(); session.openTransaction(); Task task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Task(); task.setName(<span class="hljs-string"><span class="hljs-string">" 1"</span></span>); task.setDefinition(<span class="hljs-string"><span class="hljs-string">" 1"</span></span>); task.setTaskDate(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date()); task.setUser(user); session.saveOrUpdate(task); session.flush(); session.getTransaction().commit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task.getTaskId(); }</code> </pre><br>  We note a few nuances.  First, saving to the database can only be done as part of a transaction.  Calling <i>session.openTransaction ()</i> opens a new transaction for the session, and <i>session.getTransaction (). Commit ()</i> performs it.  Secondly, in the <i>task.setUser (user)</i> method we pass <i>user</i> in the <i>detached</i> state.  You can also transfer in the status <i>persistent</i> . <br><br>  This code will execute (not counting receiving <i>user</i> ) 2 queries - <i>select nextval ('task_task_id_seq')</i> and <i>insert into task ...</i> <br>  Instead of <i>saveOrUpdate (),</i> you can perform <i>save ()</i> , <i>persist ()</i> , <i>merge ()</i> - there will also be 2 requests.  The call <i>session.flush ()</i> applies all changes to the database, but, to be honest, this call is useless here, since nothing is stored in the database until <i>commit ()</i> , which itself will cause <i>flush ()</i> . <br><br>  Remember that if we inside the transaction change something in the <i>persistent</i> or <i>proxy-object</i> status object loaded from the database, the <i>update</i> request will be executed.  If the <i>task</i> should refer to the new <i>user</i> , then do this: <br><br><pre> <code class="java hljs"> User user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(); <span class="hljs-comment"><span class="hljs-comment">//  &lt;i&gt;transient-object&lt;/i&gt; user.setLogin("user"); user.setPassword("user"); ... task.setUser(user); session.saveOrUpdate(task); // </span></span></code> </pre><br>  Attention: in the <i>Task</i> class for the <i>user</i> field, <i>CascadeType.PERSIST</i> , <i>CascadeType.MERGE</i> or <i>CascadeType.ALL</i> must be set. <br><br>  If we have <i>userId with an</i> existing user in the database, then we do not need to load the <i>User</i> object from the database, making an extra <i>select</i> .  Since we cannot assign the user ID directly to the property of the <i>Task</i> class, we need to create an object of the <i>User</i> class with only <i>userId values</i> .  Naturally, this cannot be a <i>transient-object</i> , so here you should use a <i>proxy object</i> known to us. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId, Task task)</span></span></span><span class="hljs-function"> ... task.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((User)</span></span></span><span class="hljs-function"> session.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User.class, userId)</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       session.saveOrUpdate(task); ...</span></span></code> </pre><br>  b).  Add an object to the collection of child objects: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login)</span></span></span><span class="hljs-function"> </span></span>{ Session session = sessionFactory.openSession(); session.openTransaction(); user = (User) session.load(User.class, userId); Task task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Task(); task.setName(<span class="hljs-string"><span class="hljs-string">""</span></span>); task.setUser(user); user.getTasks().add(task); session.getTransaction().commit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.getUserId(); }</code> </pre><br>  In <i>User, the</i> <i>tasks</i> property should be <i>CascadeType.ALL</i> .  If it is <i>CascadeType.MERGE</i> , then after <i>user.getTasks (). Add (task)</i> execute <i>session.merge (user)</i> .  This code will execute 3 queries - <i>select * from user</i> , <i>select nextval ('task_task_id_seq')</i> and <i>insert into task</i> ... <br><br><h5>  6).  Deleting objects </h5><br>  but).  You can delete it by creating a <i>transient-object</i> : <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long taskId)</span></span></span><span class="hljs-function"> </span></span>{ Session session = sessionFactory.openSession(); session.openTransaction(); Tasks task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tasks(); task.setTaskId(taskId); session.delete(task); session.getTransaction().commit(); }</code> </pre><br>  This code will delete only the <i>task</i> .  However, if the <i>task</i> is an object of the <i>proxy</i> , <i>persistent</i> or <i>detached type</i> and <i>CascadeType.REMOVE</i> operates in the <i>Task</i> class for the <i>user</i> field, then the associated <i>user</i> will also be deleted from the database.  If you do not need to delete the user, do what?  Correct, <i>task.setUser (null)</i> <br><br>  b).  You can delete in this way: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId, Long taskId)</span></span></span><span class="hljs-function"> </span></span>{ User user = (User) session.load(User.class, userId); user.getTasks().removeIf((Task task) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.getTaskId() == taskId) { task.setUser(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }); }</code> </pre><br>  This code simply removes the connection between the <i>task</i> and the <i>user</i> .  Here we have applied the newfangled <i>lambda expression</i> .  The <i>task</i> object will be removed from the database under one condition - if you change something in the <i>User</i> entity class: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(fetch = FetchType.LAZY, mappedBy = <span class="hljs-string"><span class="hljs-string">"user"</span></span>, cascade = CascadeType.ALL, orphanRemoval = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Tasks&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tasks; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Tasks&gt; tasks)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tasks = tasks; }</code> </pre><br>  The <i>orphanRemoval = true</i> parameter indicates that all <i>Task</i> objects that do not have a <i>User</i> reference should be removed from the database. <br><br><h5>  7).  Declarative transaction management </h5><br>  For declarative transaction management, we will use the <i>Spring Framework</i> .  Transaction management is carried out through a transaction manager.  Instead of calling <i>session.openTransaction ()</i> and <i>session.commit ()</i> , the <i>@Transactional</i> annotation is <i>used</i> .  The following must be present in the application configuration: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sessionFactory"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"configLocation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"classpath:hibernate.cfg.xml"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.orm.hibernate4.HibernateTransactionManager"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sessionFactory"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sessionFactory"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tx:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">transaction-manager</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  Here we have defined the <i>transactionManager</i> bean to which the <i>sessionFactory is attached</i> .  The <i>HibernateTransactionManager</i> class is an implementation of the common <i>org.springframework.transaction.PlatformTransactionManager</i> interface for the Hibernate <i>SessionFactory</i> library.  <i>annotation-driven</i> instructs the transaction manager to process the <i>@Transactional</i> annotation. <br><br>  - Chatter is worth nothing.  Show me the code.  <i>(Linus Torvalds)</i> <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span>(propagation = Propagation.REQUIRED, rollbackFor = {ObjectNotFoundException.class, ConstraintViolationException.class}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId)</span></span></span><span class="hljs-function"> </span></span>{ Session session = sessionFactory.getCurrentSession(); Tasks task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tasks(); task.setName(<span class="hljs-string"><span class="hljs-string">" 1"</span></span>); task.setDefinition(<span class="hljs-string"><span class="hljs-string">" 1"</span></span>); task.setTaskDate(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date()); task.setUser((User) session.load(User.class, userId)); session.saveOrUpdate(task); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task.getTaskId(); }</code> </pre><br>  The <i>@Transactional annotation</i> indicates that the method should be executed in a transaction.  The transaction manager opens a new transaction and creates an instance of <i>Session</i> for it, which is accessible via <i>sessionFactory.getCurrentSession ()</i> .  All methods that are called in the method with this annotation also have access to this transaction, because the <i>Session</i> instance is a thread variable (ThreadLocal).  Calling <i>sessionFactory.openSession ()</i> will open a completely different session that is not related to the transaction. <br><br>  The <i>rollbackFor</i> parameter specifies the exceptions that should be rolled back when a rollout is thrown.  There is a reverse parameter - <i>noRollbackFor</i> , indicating that all exceptions, except those listed, lead to a rollback of the transaction. <br><br>  The <i>propagation</i> parameter is the most interesting.  It specifies the principle of distribution of the transaction.  Can be any value from the <i>org.springframework.transaction.annotation.Propagation</i> enumeration.  Let's give an example: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SessionFactory sessionFactory; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UserDao userDao; <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span>(propagation = Propagation.REQUIRED, rollbackFor = {ConstraintViolationException.class}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long userId)</span></span></span><span class="hljs-function"> </span></span>{ Session session = sessionFactory.getCurrentSession(); User user = userDao.getUserByLogin(<span class="hljs-string"><span class="hljs-string">"user1"</span></span>); Tasks task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tasks(); task.setName(<span class="hljs-string"><span class="hljs-string">" 1"</span></span>); ... task.setUser(user); session.saveOrUpdate(task); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task.getTaskId(); }</code> </pre><br>  The <i>UserDao.getUserByLogin ()</i> method can also be annotated with <i>@Transactional</i> .  And here the <i>propagation</i> parameter determines the behavior of the <i>UserDao.getUserByLogin ()</i> method <i>regarding the saveTask ()</i> method transaction: <br><br><ul><li>  <i>Propagation.REQUIRED</i> - run in an existing transaction, if one exists, otherwise create a new one. </li><li>  <i>Propagation.MANDATORY</i> - run in an existing transaction, if one exists, otherwise generate an exception. </li><li>  <i>Propagation.SUPPORTS</i> - run in an existing transaction, if it exists, otherwise run outside the transaction. </li><li>  <i>Propagation.NOT_SUPPORTED</i> - always executed outside the transaction.  If there is an existing one, then it will be stopped. </li><li>  <i>Propagation.REQUIRES_NEW</i> - always run in a new, independent transaction.  If there is an existing one, then it will be stopped until the completion of a new transaction. </li><li>  <i>Propagation.NESTED</i> - if there is a current transaction, run in a new, so-called, nested transaction.  If the nested transaction is canceled, it will not affect the external transaction;  if an external transaction is canceled, the nested one will be canceled.  If there is no current transaction, then a new one is simply created. </li><li>  <i>Propagation.NEVER</i> - always execute outside the transaction, if there is an existing one, generate an exception. </li></ul><br>  Good <a href="http://www.ibm.com/developerworks/ru/library/j-ts1/">stuff about transactions</a> .  It should be remembered that the use of transactions carries additional costs in performance. <br><br><h5>  Well, let's summarize </h5><br>  In my article I covered the most basic principles of working with sessions and transactions in Hibernate.  I hope that this article will be useful for novice Java programmers in overcoming the first threshold in learning the superclass (not for everyone, perhaps) Hibernate library.  I wish you all success in our complex and interesting programming activities! <br><br>  <a href="https://github.com/Niyazguest/testApp">Sample project</a> . <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/271115/">https://habr.com/ru/post/271115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271105/index.html">Another way to implement binding computable properties in WPF</a></li>
<li><a href="../271107/index.html">High Flight Frames - Cloud HR and Big Data</a></li>
<li><a href="../271109/index.html">AutoCAD: Communication with external data</a></li>
<li><a href="../271111/index.html">AllcountJS and ionic: Mobile application for CRM in 30 minutes</a></li>
<li><a href="../271113/index.html">Two-factor authentication of AnyConnect clients. Active Directory and Azure Multi-Factor Authentication Server</a></li>
<li><a href="../271117/index.html">Hammer on the ORM</a></li>
<li><a href="../271119/index.html">Microsoft boosts Edge web browser security</a></li>
<li><a href="../271121/index.html">DBMS Linter and ReactOS, Technical Details</a></li>
<li><a href="../271123/index.html">Phishing Email Examples</a></li>
<li><a href="../271125/index.html">Indication notification LED webcam [Part 1]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>