<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LibreOffice: a bad dream accountant</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="LibreOffice is a powerful office suite that is free for private, educational, and commercial use. Its developers make a great product that is used in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LibreOffice: a bad dream accountant</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf0/ff5/4b4/bf0ff54b40fb8527f7bf79edc4050d37.png"></div><br>  LibreOffice is a powerful office suite that is free for private, educational, and commercial use.  Its developers make a great product that is used in many areas as an alternative to Microsoft Office.  The PVS-Studio team is always interested in looking at the code of such famous projects and trying to find errors in them.  This time it was easy to do.  The project contains many errors that can lead to serious problems.  The article will consider some interesting defects found in the code. <br><br><h2>  Introduction </h2><br>  <a href="https://www.libreoffice.org/">LibreOffice</a> is a very large C ++ project.  Maintaining a project of this size is a difficult task for the development team.  And, unfortunately, it seems that the quality of the LibreOffice code cannot be given sufficient attention. <br><br>  On the one hand, the project is simply huge, not every static or dynamic analysis tool will master the analysis of 13k source code files.  So many files are involved in building an office suite with third-party libraries.  The main LibreOffice repository stores about 8k files of source code.  This amount of code creates problems not only for developers: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95d/8f8/322/95d8f8322f57ac9af0206a3ef955e55e.png"></div><a name="habracut"></a><br>  On the other hand, the project has many users and needs to find and correct as many errors as possible.  Every mistake can hurt hundreds and thousands of users.  Therefore, the large size of the code base should not become a reason to abandon the use of certain tools that can detect errors.  I think the reader has already guessed that we are talking about static code analyzers :). <br><br>  Yes, the use of static analyzers does not guarantee the absence of errors in the project.  However, tools such as PVS-Studio are able to find a large number of errors at the design stage and thereby reduce the amount of work related to debugging and supporting the project. <br><br>  Let's see what you can find interesting in the LibreOffice source codes, if you take the <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static code analyzer.  The analyzer launch options are extensive: Windows, Linux, macOS.  To write this review, we used the PVS-Studio report, created when analyzing a project on Windows. <br><br><h2>  Changes since the last check in 2015 </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b28/750/671/b28750671ffb2784af092ee21c716259.png"></div><br><br>  In March 2015, the first analysis of LibreOffice (" <a href="https://www.viva64.com/ru/b/0308/">Verification of the LibreOffice Project</a> ") was performed using PVS-Studio.  Since then, the office suite has evolved greatly as a product, but inside everything also contains many errors.  And some error patterns have not changed at all since then.  For example, the error from the first article: <br><br>  <a href="https://www.viva64.com/ru/w/v656/">V656</a> Variables 'aVRP', 'aVPN' are initialized.  It's probably not an error or un-optimized code.  Consider inspecting the 'rSceneCamera.GetVRP ()' expression.  Check lines: 177, 178. viewcontactofe3dscene.cxx 178 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ViewContactOfE3dScene::createViewInformation3D(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> basegfx::<span class="hljs-function"><span class="hljs-function">B3DPoint </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aVRP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rSceneCamera.GetVRP())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> basegfx::<span class="hljs-function"><span class="hljs-function">B3DVector </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aVPN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rSceneCamera.GetVRP())</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= const basegfx::B3DVector aVUV(rSceneCamera.GetVUV()); .... }</span></span></code> </pre> <br>  This bug was fixed, but this is what was found in the most recent version of the code: <br><br>  <a href="https://www.viva64.com/ru/w/v656/">V656</a> Variables 'aSdvURL', 'aStrURL' are initialized.  It's probably not an error or un-optimized code.  Consider inspecting the 'pThm-&gt; GetSdvURL ()' expression.  Check lines: 658, 659. gallery1.cxx 659 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetThmURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aThmURL; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSdgURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aSdgURL; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSdvURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aSdvURL; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStrURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aStrURL; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Gallery::RemoveTheme( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString&amp; rThemeName ) { .... <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aThmURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetThmURL() )</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aSdgURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetSdgURL() )</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aSdvURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetSdvURL() )</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aStrURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetSdvURL() )</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  As you can see, subtle function names are still the source of errors. <br><br>  Another interesting example from the old code: <br><br>  <a href="https://www.viva64.com/ru/w/v656/">V656</a> Variables 'nDragW', 'nDragH' are initialized.  It's probably not an error or un-optimized code.  Consider inspecting the 'rMSettings.GetStartDragWidth ()' expression.  Check lines: 471, 472. winproc.cxx 472 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VCL_DLLPUBLIC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MouseSettings</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStartDragWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStartDragHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImplHandleMouseEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( .... )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> nDragW = rMSettings.GetStartDragWidth(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> nDragH = rMSettings.GetStartDragWidth(); .... }</code> </pre> <br>  This piece of code really contained an error that is now fixed.  But there are no fewer errors in the code ... Now a similar situation has been revealed: <br><br>  <a href="https://www.viva64.com/ru/w/v656/">V656</a> Variables 'defaultZoomX', 'defaultZoomY' are initialized.  It's probably not an error or un-optimized code.  Consider inspecting the 'pViewData-&gt; GetZoomX ()' expression.  Check lines: 5673, 5674. gridwin.cxx 5674 <br><br><pre> <code class="cpp hljs">OString ScGridWindow::getCellCursor(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... SCCOL nX = pViewData-&gt;GetCurX(); SCROW nY = pViewData-&gt;GetCurY(); Fraction defaultZoomX = pViewData-&gt;GetZoomX(); Fraction defaultZoomY = pViewData-&gt;GetZoomX(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  Errors are entered into the code literally by analogy. <br><br><h2>  Do not be fooled </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e64/21a/1a9/e6421a1a9d0e05a1dff0c27f304ce403.png"></div><br><br>  <a href="https://www.viva64.com/ru/w/v765/">V765</a> A compound assignment expression 'x - = x - ...' is suspicious.  Consider inspecting it for a possible error.  swdtflvr.cxx 3509 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SwTransferable::PrivateDrop(...) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( rSrcSh.IsSelFrameMode() ) { <span class="hljs-comment"><span class="hljs-comment">//Hack: fool the special treatment aSttPt -= aSttPt - rSrcSh.GetObjRect().Pos(); } .... }</span></span></code> </pre> <br>  Here is such an interesting ‚ÄúHack‚Äù was found using the diagnostics <a href="https://www.viva64.com/ru/w/v765/">V765</a> .  If you simplify the line of code with a comment, you can get an unexpected result: <br><br>  1st step: <br><br><pre> <code class="cpp hljs">aSttPt = aSttPt - (aSttPt - rSrcSh.GetObjRect().Pos());</code> </pre> <br>  2nd step: <br><br><pre> <code class="cpp hljs">aSttPt = aSttPt - aSttPt + rSrcSh.GetObjRect().Pos();</code> </pre> <br>  3rd step <br><br><pre> <code class="cpp hljs">aSttPt = rSrcSh.GetObjRect().Pos();</code> </pre> <br>  And then what is Hack? <br><br>  Another example on this topic: <br><br>  <a href="https://www.viva64.com/ru/w/v567/">V567</a> The modification of the nCount variable is unsequenced.  This may lead to undefined behavior.  stgio.cxx 214 <br><br><pre> <code class="cpp hljs">FatError EasyFat::Mark(....) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { --nCount /= GetPageSize(); nCount++; } .... }</code> </pre> <br>  Code execution in such situations may depend on the compiler and the language standard.  Why not rewrite this piece of code easier, clearer and more reliable? <br><br><h2>  How not to use arrays and vectors </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d61/38d/483/d6138d483ed86734a4b6d20405af255c.png"></div><br><br>  For some reason, someone has made a lot of mistakes of the same type when working with arrays and vectors.  Let's look at these examples. <br><br>  <a href="https://www.viva64.com/ru/w/v557/">V557</a> Array overrun is possible.  The 'nPageNum' index is pointing beyond array bound.  pptx-epptooxml.cxx 1168 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PowerPointExport::ImplWriteNotes(sal_uInt32 nPageNum) { .... <span class="hljs-comment"><span class="hljs-comment">// add slide implicit relation to notes if (mpSlidesFSArray.size() &gt;= nPageNum) addRelation(mpSlidesFSArray[ nPageNum ]-&gt;getOutputStream(), oox::getRelationship(Relationship::NOTESSLIDE), OUStringBuffer() .append("../notesSlides/notesSlide") .append(static_cast&lt;sal_Int32&gt;(nPageNum) + 1) .append(".xml") .makeStringAndClear()); .... }</span></span></code> </pre> <br>  The last valid index should be a value equal to <i>size () - 1</i> .  But in this code snippet, a situation was allowed where the <i>nPageNum</i> index could be <i>mpSlidesFSArray.size ()</i> , which causes the array to exit the array and work with the element consisting of garbage. <br><br>  <a href="https://www.viva64.com/ru/w/v557/">V557</a> Array overrun is possible.  The 'mnSelectedMenu' index is pointing beyond array bound.  checklistmenu.cxx 826 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ScMenuFloatingWindow::ensureSubMenuNotVisible() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mnSelectedMenu &lt;= maMenuItems.size() &amp;&amp; maMenuItems[mnSelectedMenu].mpSubMenuWin &amp;&amp; maMenuItems[mnSelectedMenu].mpSubMenuWin-&gt;IsVisible()) { maMenuItems[mnSelectedMenu].mpSubMenuWin-&gt;ensureSubMenuNotVisible(); } EndPopupMode(); }</code> </pre> <br>  Interestingly, in this code snippet, we wrote an index check more clearly, but at the same time made the same error. <br><br>  <a href="https://www.viva64.com/ru/w/v557/">V557</a> Array overrun is possible.  The 'nXFIndex' index is pointing beyond array bound.  xestyle.cxx 2613 <br><br><pre> <code class="cpp hljs">sal_Int32 XclExpXFBuffer::GetXmlStyleIndex( sal_uInt32 nXFIndex ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { OSL_ENSURE( nXFIndex &lt; maStyleIndexes.size(), <span class="hljs-string"><span class="hljs-string">"...."</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nXFIndex &gt; maStyleIndexes.size() ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// should be caught/debugged via above assert; return maStyleIndexes[ nXFIndex ]; }</span></span></code> </pre> <br>  And this mistake is doubly interesting!  In the debug macro, they wrote the correct index check, and in another place they again made a mistake, allowing the output outside the array. <br><br>  Now consider a different kind of error not related to indices. <br><br>  <a href="https://www.viva64.com/ru/w/v554/">V554</a> Incorrect use of shared_ptr.  The memory is allocated with 'new []' will be cleaned using 'delete'.  dx_vcltools.cxx 158 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RawRGBABitmap</span></span></span><span class="hljs-class"> {</span></span> sal_Int32 mnWidth; sal_Int32 mnHeight; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; sal_uInt8 &gt; mpBitmapData; }; <span class="hljs-function"><span class="hljs-function">RawRGBABitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bitmapFromVCLBitmapEx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ::BitmapEx&amp; rBmpEx )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">// convert transparent bitmap to 32bit RGBA // ======================================== const ::Size aBmpSize( rBmpEx.GetSizePixel() ); RawRGBABitmap aBmpData; aBmpData.mnWidth = aBmpSize.Width(); aBmpData.mnHeight = aBmpSize.Height(); aBmpData.mpBitmapData.reset( new sal_uInt8[ 4*aBmpData.mnWidth *aBmpData.mnHeight ] ); .... }</span></span></code> </pre> <br>  This code snippet contains an error leading to undefined program behavior.  The fact is that the memory is allocated and released in different ways.  To release the memory correctly, it was necessary to declare the class field as follows: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; sal_uInt8[] &gt; mpBitmapData;</code> </pre> <br><h2>  How to make a mistake twice in macros </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ead/1d2/de0/ead1d2de04413fc43dba4e42280f98ed.png"></div><br><br>  <a href="https://www.viva64.com/ru/w/v568/">V568</a> It's odd that the sizeof () operator is the 'bTextFrame?  aProps: aShapeProps' expression.  wpscontext.cxx 134 <br><br><pre> <code class="cpp hljs">oox::core::ContextHandlerRef WpsContext::onCreateContext(....) { .... OUString aProps[] = { .... }; OUString aShapeProps[] = { .... }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; SAL_N_ELEMENTS(bTextFrame ? aProps : aShapeProps); <span class="hljs-comment"><span class="hljs-comment">//1 ++i) if (oInsets[i]) xPropertySet-&gt;setPropertyValue((bTextFrame ? aProps : aShapeProps)[i], //2 uno::makeAny(*oInsets[i])); .... }</span></span></code> </pre> <br>  Unfortunately for many developers, macro arguments do not behave like function arguments.  Ignoring this fact often leads to errors.  In cases # 1 and # 2, almost the same construction is used using the ternary operator.  But in the first case - a macro, in the second - a function.  However, this is only the top of the problem. <br><br>  In case # 1, the analyzer actually found the following code with an error: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (bTextFrame ? aProps : aShapeProps) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> ((bTextFrame ? aProps : aShapeProps)[<span class="hljs-number"><span class="hljs-number">0</span></span>])); ++i)</code> </pre> <br>  This is our loop with the <i>SAL_N_ELEMENTS</i> macro.  The <i>sizeof</i> operator does not evaluate an expression in the ternary operator.  In this case, arithmetic is performed with the size of the pointers, which results in values ‚Äã‚Äãfar from the actual size of the specified arrays.  The calculation of incorrect values ‚Äã‚Äãadditionally affects the width of the application. <br><br>  But then it turned out that there are 2 macro <i>SAL_N_ELEMENTS</i> !  Those.  the preprocessor opened the wrong macro, how could this happen?  Macro definition and developer comments will help us: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> SAL_N_ELEMENTS # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(__cplusplus) &amp;&amp; ( defined(__GXX_EXPERIMENTAL_CXX0X__) || __cplusplus &gt;= 201103L ) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* * Magic template to calculate at compile time the number of elements * in an array. Enforcing that the argument must be a array and not * a pointer, eg * char *pFoo="foo"; * SAL_N_ELEMENTS(pFoo); * fails while * SAL_N_ELEMENTS("foo"); * or * char aFoo[]="foo"; * SAL_N_ELEMENTS(aFoo); * pass * * Unfortunately if arr is an array of an anonymous class then we need * C++0x, ie see * http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#757 */</span></span></span><span class="hljs-meta"> template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename T, size_t S&gt; char (&amp;sal_n_array_size( T(&amp;)[S] ))[S]; # define SAL_N_ELEMENTS(arr) (sizeof(sal_n_array_size(arr))) # else # define SAL_N_ELEMENTS(arr) (sizeof (arr) / sizeof ((arr)[0])) # endif #endif</span></span></span></span></code> </pre> <br>  Another version of the macro contains a secure template function, but something went wrong: <br><br><ol><li>  The safe macro is not included in the code; </li><li>  It is still impossible to use another macro, since  successful instantiation of the template function is performed only if arrays of the same size are passed to the ternary operator.  And in this case, the use of such a macro loses its meaning. </li></ol><br><h2>  Typing and copy-paste </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19d/419/905/19d41990527e23e0654820cfcddcbe9a.png"></div><br><br>  <a href="https://www.viva64.com/ru/w/v1013/">V1013</a> Suspicious subexpression f1.Pitch == f2.CharSet in a sequence of similar comparisons.  xmldlg_export.cxx 1251 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equalFont</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Style </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; style1, Style </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; style2 )</span></span></span><span class="hljs-function"> </span></span>{ awt::FontDescriptor <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; f1 = style1._descr; awt::FontDescriptor <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; f2 = style2._descr; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( f1.Name == f2.Name &amp;&amp; f1.Height == f2.Height &amp;&amp; f1.Width == f2.Width &amp;&amp; f1.StyleName == f2.StyleName &amp;&amp; f1.Family == f2.Family &amp;&amp; f1.CharSet == f2.CharSet &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= f1.Pitch == f2.CharSet &amp;&amp; // &lt;= f1.CharacterWidth == f2.CharacterWidth &amp;&amp; f1.Weight == f2.Weight &amp;&amp; f1.Slant == f2.Slant &amp;&amp; f1.Underline == f2.Underline &amp;&amp; f1.Strikeout == f2.Strikeout &amp;&amp; f1.Orientation == f2.Orientation &amp;&amp; bool(f1.Kerning) == bool(f2.Kerning) &amp;&amp; bool(f1.WordLineMode) == bool(f2.WordLineMode) &amp;&amp; f1.Type == f2.Type &amp;&amp; style1._fontRelief == style2._fontRelief &amp;&amp; style1._fontEmphasisMark == style2._fontEmphasisMark ); }</span></span></code> </pre> <br>  Error is a worthy candidate for replenishing the article " <a href="https://www.viva64.com/ru/b/0509/">Evil lives in comparison functions</a> " if we ever decide to update or expand it.  I think the probability of finding such an error (skipping <i>f2.Pitch</i> ) on its own is extremely small.  What do you think? <br><br>  <a href="https://www.viva64.com/ru/w/v501/">V501</a> There are identical sub-expressions 'mpTable [ocArrayColSep]! = MpTable [eOp]' the operator.  formulacompiler.cxx 632 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FormulaCompiler::OpCodeMap::putOpCode(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ocSep: bPutOp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; bRemoveFromMap = (mpTable[eOp] != <span class="hljs-string"><span class="hljs-string">";"</span></span> &amp;&amp; mpTable[ocArrayColSep] != mpTable[eOp] &amp;&amp; mpTable[ocArrayColSep] != mpTable[eOp]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  The result of mindless copying was such a code fragment.  Perhaps the conditional expression is simply duplicated once again, but still there is no place for such ambiguities in the code. <br><br>  <a href="https://www.viva64.com/ru/w/v517/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 781, 783. mysqlc_databasemetadata.cxx 781 <br><br><pre> <code class="cpp hljs">Reference&lt;XResultSet&gt; SAL_CALL ODatabaseMetaData::getColumns(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bIsCharMax = !xRow-&gt;wasNull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sDataType.equalsIgnoreAsciiCase(<span class="hljs-string"><span class="hljs-string">"year"</span></span>)) nColumnSize = sColumnType.copy(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).toInt32(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sDataType.equalsIgnoreAsciiCase(<span class="hljs-string"><span class="hljs-string">"date"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">// &lt;= nColumnSize = 10; else if (sDataType.equalsIgnoreAsciiCase("date")) // &lt;= nColumnSize = 8; else if (sDataType.equalsIgnoreAsciiCase("datetime") || sDataType.equalsIgnoreAsciiCase("timestamp")) nColumnSize = 19; else if (!bIsCharMax) nColumnSize = xRow-&gt;getShort(7); else nColumnSize = nCharMaxLen; .... }</span></span></code> </pre> <br>  As a result of copying conditional expressions, an error was made in the code, due to which the value <i>8</i> for the variable <i>nColumnSize is</i> never set. <br><br>  <a href="https://www.viva64.com/ru/w/v523/">V523</a> The 'then' statement is equivalent to the 'else' statement.  svdpdf.hxx 146 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/// Transform the rectangle (left, right, top, bottom) by this Matrix. template &lt;typename T&gt; void Transform(....) { .... if (top &gt; bottom) top = std::max(leftTopY, rightTopY); else top = std::min(leftTopY, rightTopY); if (top &gt; bottom) bottom = std::max(leftBottomY, rightBottomY); // &lt;= else bottom = std::max(leftBottomY, rightBottomY); // &lt;= }</span></span></code> </pre> <br>  Here the functions <i>min ()</i> and <i>max () are</i> confused.  Surely because of this typo in the interface, something strange scaled. <br><br><h2>  Strange cycles </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/361/175/35d/36117535d4e5edba8d6a11ce89ae5cbc.gif"></div><br><br>  <a href="https://www.viva64.com/ru/w/v533/">V533</a> It is likely that a variable is being incremented inside the 'for' operator.  Consider reviewing 'i'.  javatypemaker.cxx 602 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printConstructors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; unoidl::SingleInterfaceBasedServiceEntity::Constructor:: Parameter &gt;::const_iterator j(i-&gt;parameters.begin()); j != i-&gt;parameters.end(); ++i) { o &lt;&lt; <span class="hljs-string"><span class="hljs-string">", "</span></span>; printType(o, options, manager, j-&gt;type, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j-&gt;rest) { o &lt;&lt; <span class="hljs-string"><span class="hljs-string">"..."</span></span>; } o &lt;&lt; <span class="hljs-string"><span class="hljs-string">' '</span></span> &lt;&lt; codemaker::java::translateUnoToJavaIdentifier( u2b(j-&gt;name), <span class="hljs-string"><span class="hljs-string">"param"</span></span>); } .... }</code> </pre> <br>  The <i>++ i</i> expression in the loop looks very suspicious.  Perhaps there should be <i>++ j</i> . <br><br>  <a href="https://www.viva64.com/ru/w/v756/">V756</a> The 'nIndex2' counter is not used inside a loop.  Consider inspecting usage of 'nIndex' counter.  treex.cxx 34 <br><br><pre> <code class="cpp hljs">SAL_IMPLEMENT_MAIN_WITH_ARGS(argc, argv) { OString sXHPRoot; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; nIndex != argc; ++nIndex) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(argv[nIndex], <span class="hljs-string"><span class="hljs-string">"-r"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { sXHPRoot = OString( argv[nIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>] ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nIndex2 = nIndex+<span class="hljs-number"><span class="hljs-number">3</span></span>; nIndex2 &lt; argc; nIndex2 = nIndex2 + <span class="hljs-number"><span class="hljs-number">2</span></span> ) { argv[nIndex<span class="hljs-number"><span class="hljs-number">-3</span></span>] = argv[nIndex<span class="hljs-number"><span class="hljs-number">-1</span></span>]; argv[nIndex<span class="hljs-number"><span class="hljs-number">-2</span></span>] = argv[nIndex]; } argc = argc - <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } common::HandledArgs aArgs; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !common::handleArguments(argc, argv, aArgs) ) { WriteUsage(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } .... }</code> </pre> <br>  There is some kind of error in the <b>inner</b> <i>for</i> loop.  Since  the <i>nIndex</i> variable <i>does</i> not change, the same two array elements are overwritten at each iteration.  Most likely, the variable <b><i>nIndex2</i></b> should have been used everywhere instead of <b><i>nIndex</i></b> . <br><br>  <a href="https://www.viva64.com/ru/w/v1008/">V1008</a> Consider inspecting the 'for' operator.  Will be performed.  diagramhelper.cxx 292 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DiagramHelper::setStackMode( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Reference&lt; XDiagram &gt; &amp; xDiagram, StackMode eStackMode ) { .... sal_Int32 nMax = aChartTypeList.getLength(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nMax &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ) nMax = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( sal_Int32 nT = <span class="hljs-number"><span class="hljs-number">0</span></span>; nT &lt; nMax; ++nT ) { uno::Reference&lt; XChartType &gt; xChartType( aChartTypeList[nT] ); .... } .... }</code> </pre> <br>  The <i>for</i> loop is intentionally limited to 1 iteration.  It is not clear why this is done in this way. <br><br>  <a href="https://www.viva64.com/ru/w/v612/">V612</a> An unconditional 'return' within a loop.  pormulti.cxx 891 <br><br><pre> <code class="cpp hljs">SwTextAttr <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>* MergedAttrIterMulti::NextAttr(....) { .... <span class="hljs-function"><span class="hljs-function">SwpHints </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function">*</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pHints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m_pNode-&gt;GetpSwpHints())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pHints) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (m_CurrentHint &lt; pHints-&gt;Count()) { <span class="hljs-function"><span class="hljs-function">SwTextAttr </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function">*</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pHint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pHints-&gt;Get(m_CurrentHint))</span></span></span></span>; ++m_CurrentHint; rpNode = m_pNode; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pHint; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; .... }</code> </pre> <br>  An example of a simpler, odd loop from one iteration, which is best rewritten to a conditional operator. <br><br>  A few more places like this: <br><br><ul><li>  V612 An unconditional 'return' within a loop.  txtfrm.cxx 144 </li><li>  V612 An unconditional 'return' within a loop.  txtfrm.cxx 202 </li><li>  V612 An unconditional 'return' within a loop.  txtfrm.cxx 279 </li></ul><br><h2>  Strange conditions </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f6/73a/01b/9f673a01bb41965f47539e9311546201.png"></div><br><br>  <a href="https://www.viva64.com/ru/w/v637/">V637</a> Two opposite conditions were encountered.  The second condition is always false.  Check lines: 281, 285. authfld.cxx 281 <br><br><pre> <code class="cpp hljs">sal_uInt16 SwAuthorityFieldType::GetSequencePos(sal_IntPtr nHandle) { .... SwTOXSortTabBase* pOld = aSortArr[i].get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(*pOld == *pNew) { <span class="hljs-comment"><span class="hljs-comment">//only the first occurrence in the document //has to be in the array if(*pOld &lt; *pNew) pNew.reset(); else // remove the old content aSortArr.erase(aSortArr.begin() + i); break; } .... }</span></span></code> </pre> <br>  The analyzer found inconsistent comparisons.  Something with this code snippet is clearly wrong. <br><br>  The same code is seen in this place: <br><br><ul><li>  V637 Two opposite conditions were encountered.  The second condition is always false.  Check lines: 1827, 1829. doctxm.cxx 1827 </li></ul><br>  <a href="https://www.viva64.com/ru/w/v590/">V590</a> Consider inspecting this expression.  The expression is misprint.  fileurl.cxx 55 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">OUString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToFileUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * filename, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((filename[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'.'</span></span>) || (filename[<span class="hljs-number"><span class="hljs-number">0</span></span>] != SEPARATOR)) { .... } .... }</code> </pre> <br>  The problem with the above code fragment is that the first conditional expression does not affect the result of the whole expression. <br><br>  Based on these errors, I even wrote a theoretical article: " <a href="https://www.viva64.com/ru/b/0390/">Logical expressions in C / C ++. How professionals are mistaken</a> ." <br><br>  <a href="https://www.viva64.com/ru/w/v590/">V590</a> Consider inspecting this expression.  The expression is misprint.  unoobj.cxx 1895 <br><br><pre> <code class="cpp hljs">uno::Sequence&lt; beans::PropertyState &gt; SwUnoCursorHelper::GetPropertyStates(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION == eCaller) || (SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION_TOLERANT == eCaller)) &amp;&amp; pEntry-&gt;nWID &lt; FN_UNO_RANGE_BEGIN &amp;&amp; pEntry-&gt;nWID &gt; FN_UNO_RANGE_END &amp;&amp; pEntry-&gt;nWID &lt; RES_CHRATR_BEGIN &amp;&amp; pEntry-&gt;nWID &gt; RES_TXTATR_END ) { pStates[i] = beans::PropertyState_DEFAULT_VALUE; } .... }</code> </pre> <br>  Immediately do not understand what the problem is this condition, so an expanded code fragment was written out from the preprocessed file: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION == eCaller) || (SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION_TOLERANT == eCaller)) &amp;&amp; pEntry-&gt;nWID &lt; (<span class="hljs-number"><span class="hljs-number">20000</span></span> + <span class="hljs-number"><span class="hljs-number">1600</span></span>) &amp;&amp; pEntry-&gt;nWID &gt; ((<span class="hljs-number"><span class="hljs-number">20000</span></span> + <span class="hljs-number"><span class="hljs-number">2400</span></span>) + <span class="hljs-number"><span class="hljs-number">199</span></span>) &amp;&amp; pEntry-&gt;nWID &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; pEntry-&gt;nWID &gt; <span class="hljs-number"><span class="hljs-number">63</span></span> ) { pStates[i] = beans::PropertyState_DEFAULT_VALUE; }</code> </pre> <br>  It turned out that not a single number is included simultaneously in the 4 ranges specified in the condition by numbers.  The developers made a mistake. <br><br>  <a href="https://www.viva64.com/ru/w/v590/">V590</a> Consider inspecting the '* pData &lt;= MAXLEVEL &amp;&amp; * pData &lt;= 9' expression.  The expression is misprint.  ww8par2.cxx 756 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sal_uInt8 MAXLEVEL = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SwWW8ImplReader::Read_ANLevelNo(....) { .... <span class="hljs-comment"><span class="hljs-comment">// Range WW:1..9 -&gt; SW:0..8 no bullets / numbering if (*pData &lt;= MAXLEVEL &amp;&amp; *pData &lt;= 9) { .... } else if( *pData == 10 || *pData == 11 ) { // remember type, the rest happens at Sprm 12 m_xStyles-&gt;mnWwNumLevel = *pData; } .... }</span></span></code> </pre> <br>  Because the first condition uses a constant with a value of <i>10</i> , the condition turned out to be redundant.  This code snippet can be rewritten as follows: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*pData &lt;= <span class="hljs-number"><span class="hljs-number">9</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( *pData == <span class="hljs-number"><span class="hljs-number">10</span></span> || *pData == <span class="hljs-number"><span class="hljs-number">11</span></span> ) { .... }</code> </pre> <br>  But perhaps there was another problem with the code presented. <br><br>  <a href="https://www.viva64.com/ru/w/v757/">V757</a> It is possible that the variable is compared with nullptr after type conversion using 'dynamic_cast'.  Check lines: 2709, 2710. menu.cxx 2709 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PopupMenu::ClosePopup(Menu* pMenu) { MenuFloatingWindow* p = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;MenuFloatingWindow*&gt;(ImplGetWindow()); PopupMenu *pPopup = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;PopupMenu*&gt;(pMenu); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p &amp;&amp; pMenu) p-&gt;KillActivePopup(pPopup); }</code> </pre> <br>  Most likely, the condition contains an error.  It was necessary to check the <i>p</i> and <i>pPopup pointers</i> . <br><br>  <a href="https://www.viva64.com/ru/w/v668/">V668</a> using m_pStream p against p p was _ _ _ _ _ _ _ _ _ _  The exception will be generated in the case of memory allocation error.  zipfile.cxx 408 <br><br><pre> <code class="cpp hljs">ZipFile::ZipFile(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::wstring &amp;FileName) : m_pStream(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>), m_bShouldFree(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { m_pStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(FileName.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_pStream &amp;&amp; !isZipStream(m_pStream)) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> m_pStream; m_pStream = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } }</code> </pre> <br>  The analyzer detected a situation when the value of the pointer returned by the <i>new</i> operator is compared with zero.  According to the C ++ standard of the language, in case of impossibility of allocating memory, the operator <i>new</i> <i>throws an</i> exception <i>std :: bad_alloc</i> .  In the LibreOffice project, there were only 45 such places, which is very small for this amount of code.  But still it can lead to problems for users.  Developers should remove unnecessary checks or create objects in this way: <br><br><pre> <code class="cpp hljs">m_pStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::nothrow) FileStream(FileName.c_str());</code> </pre> <br>  <a href="https://www.viva64.com/ru/w/v728/">V728 Anonymous</a> check can be simplified.  The '(A &amp;&amp;! B) ||  (! A &amp;&amp; B) 'expression is equivalent to the' bool (A)! = Bool (B) 'expression.  toolbox2.cxx 1042 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ToolBox::SetItemImageMirrorMode( sal_uInt16 nItemId, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bMirror ) { ImplToolItems::size_type nPos = GetItemPos( nItemId ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( nPos != ITEM_NOTFOUND ) { ImplToolItem* pItem = &amp;mpData-&gt;m_aItems[nPos]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((pItem-&gt;mbMirrorMode &amp;&amp; !bMirror) || <span class="hljs-comment"><span class="hljs-comment">// &lt;= (!pItem-&gt;mbMirrorMode &amp;&amp; bMirror)) // &lt;= { .... } } }</span></span></code> </pre> <br>  A long time ago, the diagnosis of the <a href="https://www.viva64.com/ru/w/v728/">V728</a> was expanded to cases that, most likely, are not wrong, but complicate the code.  And in a complex code, errors will be made sooner or later. <br><br>  This condition is simplified to this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pItem-&gt;mbMirrorMode != bMirror) { .... }</code> </pre> <br>  About 60 of these structures are found in the project, some of which are very, very bulky.  The authors of the project are better acquainted with the full report of the PVS-Studio analyzer. <br><br><h2>  Safety problems </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38b/9aa/9ba/38b9aa9ba87c83eb5207957913b918af.png"></div><br><br>  <a href="https://www.viva64.com/ru/w/v523/">V523</a> The 'then' statement is equivalent to the 'else' statement.  docxattributeoutput.cxx 1571 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DocxAttributeOutput::DoWritePermissionTagEnd( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; permission) { OUString permissionIdAndName; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (permission.startsWith(<span class="hljs-string"><span class="hljs-string">"permission-for-group:"</span></span>, &amp;permissionIdAndName)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sal_Int32 sparatorIndex = permissionIdAndName.indexOf(<span class="hljs-string"><span class="hljs-string">':'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString permissionId = permissionIdAndName.copy(....); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OString rId = OUStringToOString(....).getStr(); m_pSerializer-&gt;singleElementNS(XML_w, XML_permEnd, FSNS(XML_w, XML_id), rId.getStr(), FSEND); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sal_Int32 sparatorIndex = permissionIdAndName.indexOf(<span class="hljs-string"><span class="hljs-string">':'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString permissionId = permissionIdAndName.copy(....); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OString rId = OUStringToOString(....).getStr(); m_pSerializer-&gt;singleElementNS(XML_w, XML_permEnd, FSNS(XML_w, XML_id), rId.getStr(), FSEND); } }</code> </pre> <br>  Here is copied a very large piece of code.  For a function that changes certain rights, the identified problem looks very suspicious. <br><br>  <a href="https://www.viva64.com/ru/w/v1001/">V1001</a> The "DL" variable is assigned.  cipher.cxx 811 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BF_updateECB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CipherContextBF *ctx, rtlCipherDirection direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sal_uInt8 *pData, sal_uInt8 *pBuffer, sal_Size nLength)</span></span></span><span class="hljs-function"> </span></span>{ CipherKeyBF *key; sal_uInt32 DL, DR; key = &amp;(ctx-&gt;m_key); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction == rtl_Cipher_DirectionEncode) { RTL_CIPHER_NTOHL64(pData, DL, DR, nLength); BF_encode(key, &amp;DL, &amp;DR); RTL_CIPHER_HTONL(DL, pBuffer); RTL_CIPHER_HTONL(DR, pBuffer); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { RTL_CIPHER_NTOHL(pData, DL); RTL_CIPHER_NTOHL(pData, DR); BF_decode(key, &amp;DL, &amp;DR); RTL_CIPHER_HTONL64(DL, DR, pBuffer, nLength); } DL = DR = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  The variables <i>DL</i> and <i>DR</i> are reset to zero by simple assignment at the end of the function and are no longer used.  For the compiler, this is the reason to remove the optimization commands. <br><br>  To properly clean up variables in Windows applications, you can rewrite the code as follows: <br><br><pre> <code class="cpp hljs">RtlSecureZeroMemory(&amp;DL, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(DL)); RtlSecureZeroMemory(&amp;DR, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(DR));</code> </pre> <br>  But for LibreOffice, a cross-platform solution is required here. <br><br>  A similar warning from another function: <ul><li>  V1001 The "DL" variable is assigned.  cipher.cxx 860 </li></ul><br>  <a href="https://www.viva64.com/ru/w/v764/">V764 possible query</a> order passed to 'queryStream' function: 'rUri' and 'rPassword'.  tdoc_storage.cxx 271 <br><br><pre> <code class="cpp hljs">css::uno::Reference&lt; css::io::XStream &gt; queryStream( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> css::uno::Reference&lt; css::embed::XStorage &gt; &amp; xParentStorage, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rPassword, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rUri, StorageAccessMode eMode, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bTruncate ); uno::Reference&lt; io::XOutputStream &gt; StorageElementFactory::createOutputStream( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rUri, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rPassword, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bTruncate ) { .... uno::Reference&lt; io::XStream &gt; xStream = queryStream( xParentStorage, rUri, rPassword, READ_WRITE_CREATE, bTruncate ); .... }</code> </pre> <br>  Notice that in the <i>queryStream</i> function in the parameter list, <i>rPassword</i> first comes, and then <i>rUri</i> .  In the code there was a place where the corresponding arguments are interchanged when calling this function. <br><br>  <a href="https://www.viva64.com/ru/w/v794/">V794</a> The assignment operator should not be protected from the case of this == &amp; rToBeCopied '.  hommatrixtemplate.hxx 121 <br><br><pre> <code class="cpp hljs">ImplHomMatrixTemplate&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(....) { <span class="hljs-comment"><span class="hljs-comment">// complete initialization using copy for(sal_uInt16 a(0); a &lt; (RowSize - 1); a++) { memcpy(&amp;maLine[a], &amp;rToBeCopied.maLine[a], sizeof(....)); } if(rToBeCopied.mpLine) { mpLine.reset( new ImplMatLine&lt; RowSize &gt;(....) ); } return *this; }</span></span></code> </pre> <br>  The given case concerns safe code writing more.  In the copy statement there is no check for assigning an object to itself.  There are about 30 such implementations of the copy operator in the project. <br><br><h2>  Errors with SysAllocString </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39c/568/55a/39c56855adffe06a5e0d517f764ecea6.png"></div><br><br>  <a href="https://www.viva64.com/ru/w/v649/">V649</a> There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains function return.  This means that the statement is senseless.  Check lines: 125, 137. acctable.cxx 137 <br><br><pre> <code class="cpp hljs">STDMETHODIMP CAccTable::get_columnDescription(<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> column, BSTR * description) { SolarMutexGuard g; ENTER_PROTECTED_BLOCK <span class="hljs-comment"><span class="hljs-comment">// #CHECK# if(description == nullptr) return E_INVALIDARG; // #CHECK XInterface# if(!pRXTable.is()) return E_FAIL; .... SAFE_SYSFREESTRING(*description); *description = SysAllocString(o3tl::toW(ouStr.getStr())); if(description==nullptr) // &lt;= return E_FAIL; return S_OK; LEAVE_PROTECTED_BLOCK }</span></span></code> </pre> <br>  The <i>SysAllocString ()</i> function returns a pointer, which can be <i>NULL</i> .  Something strange was written by the author of this code.  A pointer to allocated memory is not checked, which can lead to problems in the program. <br><br>  Similar warnings from other features: <br><br><ul><li>  V649 There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains function return.  This means that the statement is senseless.  Check lines: 344, 356. acctable.cxx 356 </li><li>  V649 There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains function return.  This means that the statement is senseless.  Check lines: 213, 219. trvlfrm.cxx 219 </li></ul><br>  <a href="https://www.viva64.com/ru/w/v530/">V530</a> SysAllocString 'is the value required to be used.  maccessible.cxx 1077 <br><br><pre> <code class="cpp hljs">STDMETHODIMP CMAccessible::put_accValue(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(varChild.lVal==CHILDID_SELF) { SysAllocString(m_pszValue); m_pszValue=SysAllocString(szValue); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> S_OK; } .... }</code> </pre> <br>  The result of one of the calls to the <i>SysAllocString ()</i> function is not used.  Developers should pay attention to this code snippet. <br><br><h2>  miscellanea </h2><br>  <a href="https://www.viva64.com/ru/w/v716/">V716</a> Suspicious type conversion in return statement: returned HRESULT, but the function actually returns BOOL.  maccessible.cxx 2649 <br><br><pre> <code class="cpp hljs">BOOL CMAccessible::get_IAccessibleFromXAccessible(....) { ENTER_PROTECTED_BLOCK <span class="hljs-comment"><span class="hljs-comment">// #CHECK# if(ppIA == nullptr) { return E_INVALIDARG; // &lt;= } BOOL isGet = FALSE; if(g_pAgent) isGet = g_pAgent-&gt;GetIAccessibleFromXAccessible(....); if(isGet) return TRUE; else return FALSE; LEAVE_PROTECTED_BLOCK }</span></span></code> </pre> <br>  One of the branches of the execution of the function returns a value whose type does not correspond to the type of the return value of the function.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HRESULT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> type </font><font style="vertical-align: inherit;">has a more complex format than the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOOL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> type </font><font style="vertical-align: inherit;">, and is intended for storing operation statuses. </font><font style="vertical-align: inherit;">For example, the value of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E_INVALIDARG</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x80070057L</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It will be correct to write, for example, like this:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FAILED(E_INVALIDARG);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can read more about this in the V716 diagnostic documentation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some more similar places:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Suspicious type conversion in return statement: returned HRESULT, but the function actually returns BOOL. </font><font style="vertical-align: inherit;">inprocembobj.cxx 1299</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Suspicious type conversion in return statement: returned HRESULT, but the function actually returns BOOL. </font><font style="vertical-align: inherit;">maccessible.cxx 2660</font></font></li></ul><br> <a href="https://www.viva64.com/ru/w/v670/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V670</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The uninitialized class member 'm_aMutex' is used to initialize the 'm_aModifyListeners' member. </font><font style="vertical-align: inherit;">Remember that members are initialized in the order of declarations inside a class. </font><font style="vertical-align: inherit;">fmgridif.cxx 1033</font></font><br><br><pre> <code class="cpp hljs">FmXGridPeer::FmXGridPeer(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Reference&lt; XComponentContext &gt;&amp; _rxContext) :m_aModifyListeners(m_aMutex) ,m_aUpdateListeners(m_aMutex) ,m_aContainerListeners(m_aMutex) ,m_aSelectionListeners(m_aMutex) ,m_aGridControlListeners(m_aMutex) ,m_aMode( getDataModeIdentifier() ) ,m_nCursorListening(<span class="hljs-number"><span class="hljs-number">0</span></span>) ,m_bInterceptingDispatch(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) ,m_xContext(_rxContext) { <span class="hljs-comment"><span class="hljs-comment">// Create must be called after this constructor m_pGridListener.reset( new GridListenerDelegator( this ) ); } class __declspec(dllexport) FmXGridPeer: public cppu::ImplInheritanceHelper&lt;....&gt; { .... ::comphelper::OInterfaceContainerHelper2 m_aModifyListeners, m_aUpdateListeners, m_aContainerListeners, m_aSelectionListeners, m_aGridControlListeners; .... protected: css::uno::Reference&lt; css::uno::XComponentContext &gt; m_xContext; ::osl::Mutex m_aMutex; .... };</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">According to the language standard, the order of initialization of class members in the constructor occurs in the order they are declared in the class. </font><font style="vertical-align: inherit;">In our case, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_aMutex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">will be initialized after it participates in the initialization of five other fields of the class. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is the constructor of one of the class fields:</font></font><br><br><pre> <code class="cpp hljs">OInterfaceContainerHelper2( ::osl::Mutex &amp; rMutex );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The mutex object is passed by reference. </font><font style="vertical-align: inherit;">In this case, various problems may arise: from accessing uninitialized memory to the subsequent loss of changes to the object. </font></font><br><br> <a href="https://www.viva64.com/ru/w/v763/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V763</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter 'nNativeNumberMode' is always rewritten in function body before being used. </font><font style="vertical-align: inherit;">calendar_jewish.cxx 286</font></font><br><br><pre> <code class="cpp hljs">OUString SAL_CALL Calendar_jewish::getDisplayString(...., sal_Int16 nNativeNumberMode ) { <span class="hljs-comment"><span class="hljs-comment">// make Hebrew number for Jewish calendar nNativeNumberMode = NativeNumberMode::NATNUM2; if (nCalendarDisplayCode == CalendarDisplayCode::SHORT_YEAR) { sal_Int32 value = getValue(CalendarFieldIndex::YEAR) % 1000; return mxNatNum-&gt;getNativeNumberString(...., nNativeNumberMode ); } else return Calendar_gregorian::getDisplayString(...., nNativeNumberMode ); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Function arguments are overwritten for various reasons: fighting compiler warnings, backward compatibility, ‚Äúcrutch‚Äù, etc. </font><font style="vertical-align: inherit;">However, any of these solutions is not good, and the code looks confusing. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You should review the code of this place and a few more similar ones:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V763 Parameter 'bExtendedInfo' is always rewritten in function body before being used. </font><font style="vertical-align: inherit;">graphicfilter2.cxx 442</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V763 Parameter 'nVerbID' is always rewritten in function body before being used. </font><font style="vertical-align: inherit;">oleembed.cxx 841</font></font></li><li> V763 Parameter 'pCursor' is always rewritten in function body before being used. edlingu.cxx 843 </li><li> V763 Parameter 'pOutput' is always rewritten in function body before being used. vnew.cxx 181 </li><li> V763 Parameter 'pOutput' is always rewritten in function body before being used. vnew.cxx 256 </li></ul><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The desire to check the code LibreOffice I had after personal use of the product. </font><font style="vertical-align: inherit;">For some reason, with some random launches, absolutely all menu items disappear. </font><font style="vertical-align: inherit;">There are only icons and monotonous stripes. </font><font style="vertical-align: inherit;">The error is most likely a high-level one and, probably, it cannot be found with the help of static analysis tools. </font><font style="vertical-align: inherit;">Nevertheless, the analyzer has found a lot of problems not related to this, and I will be happy if the developers of LibreOffice pay attention to static code analyzers and try to use them to improve the quality and reliability of the project. </font><font style="vertical-align: inherit;">It will be useful to all.</font></font><br><br>  Thanks for attention.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Subscribe to our channels and follow the news from the world of programming! </font></font><br><br><ul><li><font style="vertical-align: inherit;"><a href="https://vk.com/pvsstudio_rus"><font style="vertical-align: inherit;">VK</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://vk.com/pvsstudio_rus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram: </font></font><a href="https://t.me/pvsstudio_rus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instagram: </font></font><a href="https://www.instagram.com/pvsstudio_rus/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter: </font></font><a href="https://twitter.com/pvsstudio_rus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTube: </font></font><a href="https://www.youtube.com/c/PVSStudioTool"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@PVSStudioTool</font></font></a> </li></ul><br><p> <a href="https://www.viva64.com/en/b/0586/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov. </font></font><a href="https://www.viva64.com/en/b/0586/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LibreOffice: Accountant's Nightmare</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/426977/">https://habr.com/ru/post/426977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426967/index.html">Online ABAP code generator</a></li>
<li><a href="../426969/index.html">Alert "Lida": security testing automation</a></li>
<li><a href="../426971/index.html">Fatalism in error handling</a></li>
<li><a href="../426973/index.html">Corporate Sandwiches</a></li>
<li><a href="../426975/index.html">Joker 2018: the impossible is possible</a></li>
<li><a href="../426979/index.html">How to learn English for free: 3 banal tools and detailed instructions for each</a></li>
<li><a href="../426981/index.html">10 tricks for advanced dashboarding in Splunk. Part 1</a></li>
<li><a href="../426983/index.html">New in SObjectizer 5.5.23: wish fulfillment or Pandora's box?</a></li>
<li><a href="../426985/index.html">kubebox and other console shells for Kubernetes</a></li>
<li><a href="../426987/index.html">Learn OpenGL. Lesson 6.3 - Image Based Lighting. Diffuse irradiation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>