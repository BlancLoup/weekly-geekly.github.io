<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multiboot flash drive on GRUB2 with several partitions under Ubuntu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone knows about bootable flash drives, and many have a card with several systems. But when using them, many inconveniences arise, for example: 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multiboot flash drive on GRUB2 with several partitions under Ubuntu</h1><div class="post__text post__text-html js-mediator-article">  Everyone knows about bootable flash drives, and many have a card with several systems.  But when using them, many inconveniences arise, for example: <br><br><ul><li>  Slow loading from iso-images </li><li>  Confusion in multiple system files (try splitting Ubuntu and BackTrack without crutches!) </li><li>  Impossibility to put several systems of the same type (again, without using crutches) </li><li>  And of course, this whole farceress gets in the way when you just need to transfer several files. </li></ul><br><br>  Today I will tell you how to avoid all these disadvantages comfortably and relatively quickly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  So let's get started.  I chose the Transcend JetFlash 16G as an experimental animal;  the flash drive model is not crucial, only in the breakdown of 512 megabytes of memory there is no sense :) <br><br>  First, format the memory, create a clean MBR and partitions.  Under Linux means mass, I used the standard Ubuntu utility. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/512/de6/127/512de61273a89f5cfc8f5d309977095d.png" alt="image"><br><br>  Install GRUB2: <br> <code>sudo grub-install --no-floppy --root-directory=/media/ALKID /dev/sdd <br> sudo grub-mkconfig -o /media/ALKID/boot/grub/grub.cfg <br></code> <br>  In the example, / media / ALKID is a mounted partition of a flash drive (any other than NTFS; the first partition will be used for personal files, so it is preferable to put, say, the second partition); <br>  / dev / sdd is the flash drive itself. <br><br>  If rude answers like this: <br> <code>utrack@utrack ~ $ sudo grub-install --no-floppy --root-directory=/media/fpart2 /dev/sdd <br> [sudo] password for utrack: <br> /usr/sbin/grub-setup: : Your embedding area is unusually small. core.img won't fit in it.. <br> /usr/sbin/grub-setup: :  .    GRUB        (blocklists). ,          .. <br> /usr/sbin/grub-setup: :      blocklists. <br></code> <br>  This means that there is not enough space for the bootloader and you need to move the beginning of the first section, say, 1 mb ahead. <br>  Then simply copy the system files to the USB flash drive, iso-images can be unpacked with a regular archiver. <br><br>  <b>And now the hard part :)</b> <br><br>  The fact is that for each system the settings are slightly, yes, different.  For some distros you will have to choose the parameters yourself, but I will help with the most popular systems. <br><br>  For any Linux distribution on a separate section: <br><br> <code>menuentry 'BackTrack 5 R1' --class gnu-linux --class gnu --class os { <br> recordfail <br> set gfxpayload=$linux_gfx_mode <br> insmod gzio <br> insmod part_msdos <br> insmod ext2 <br> insmod fat <br> search --no-floppy --fs-uuid --set=root BC1B-344D <br> linux /casper/vmlinuz file=/preseed/custom.seed boot=casper text splash vga=791 -- <br> initrd /casper/initrd.gz <br> } <br></code> <br><br>  where BC1B-344D is the UUID of the partition (you can find it with the command 'ls -l / dev / disk / by-uuid'). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d4/38e/76e/0d438e76e0ca4cded4a11d99dac3e99f.png" alt="image"><br><br>  Because of the similar structure with them, there is one quandary: for each, you will have to change the name of the <b>casper</b> folder, for example, the BT5 in the example is in the casper folder, and the next section will have Mint, and in the casper2 folder.  You can connect it as follows: <br><br> <code>menuentry 'Mint Default' --class ubuntu --class gnu-linux --class gnu --class os { <br> recordfail <br> set gfxpayload=$linux_gfx_mode <br> insmod gzio <br> insmod part_msdos <br> insmod ext2 <br> insmod fat <br> search --no-floppy --fs-uuid --set=root 1E1F-DD84 <br> linux /casper2/vmlinuz live-media-path=/casper2/ nopersistent boot=casper initrd=/casper2/initrd.lz quiet splash -- <br> initrd /casper2/initrd.lz <br> } <br></code> <br><br>  Next, Dr.Web on the second section in the drweb folder: <br><br> <code>menuentry "Dr.Web" { <br> recordfail <br> set gfxpayload=$linux_gfx_mode <br> insmod gzio <br> insmod part_msdos <br> insmod ext2 <br> insmod fat <br> search --no-floppy --fs-uuid --set=root 8614-5FEE <br> linux /drweb/boot/vmlinuz ID=HOpnMxLPodF82zUr usbroot root=/dev/ram0 realroot=/dev/sd[az][0-9]/drweb init=/linuxrc init_opts=4 quiet vga=791 splash=silent,theme:drweb CONSOLE=/dev/tty1 dokeymap looptype=squashfs usbroot=/dev/sd[az][0-9]/drweb slowusb vga=791 CONSOLE=/dev/tty1 SDELAY=12 USBWAIT=15 <br> initrd /drweb/boot/initrd <br> } <br></code> <br><br>  Kaspersky next to it in the kav folder: <br><br> <code>menuentry "Kaspersky RD 10" { <br> set gfxpayload=$linux_gfx_mode <br> insmod gzio <br> insmod part_msdos <br> insmod ext2 <br> insmod fat <br> insmod ntfs <br> search --no-floppy --fs-uuid --set=root 8614-5FEE <br> linux /kav/boot/rescue subdir=/kav root=/dev/ram0 vga=791 init=/linuxrc looptype=squashfs loop=/kav/image.squashfs nodevfs kav_lang=en udev aufs quiet noresume doscsi kav_lang=en cdroot=/dev/sd[az][0-9] <br> initrd /kav/boot/rescue.igz <br> } <br></code> <br><br>  You can change the language to Russian directive kav_lang = ru. <br><br>  Partition Editor on the NTFS partition in the / sys / pwizard folder: <br><br> <code>menuentry 'pwhe6 - Partition Editor' { <br> recordfail <br> set gfxpayload=$linux_gfx_mode <br> insmod gzio <br> insmod part_msdos <br> insmod ext2 <br> insmod fat <br> insmod ntfs <br> search --no-floppy --fs-uuid --set=root 01CCC7C26FA774D0 <br> linux /sys/pwizard/BZIMAGE ramdisk_size=102400 root=/dev/ram0 rw <br> initrd /sys/pwizard/tinycore.gz <br> } <br></code> <br><br>  In principle, there are no problems with it, besides from the whole image you can leave only the files BZIMAGE and tinycore.gz. <br><br>  Partition Doctor: <br><br> <code>menuentry 'Partition Doctor'{ <br> recordfail <br> set gfxpayload=$linux_gfx_mode <br> insmod gzio <br> insmod part_msdos <br> insmod ext2 <br> insmod fat <br> search --no-floppy --fs-uuid --set=root BC1B-344D <br> linux /partdoc/memdisk <br> initrd /partdoc/partdoc.ima <br> } <br></code> <br><br>  memtest86: <br><br> <code>menuentry "Memory test (memtest86+)" { <br> insmod part_msdos <br> insmod ext2 <br> insmod fat <br> search --no-floppy --fs-uuid --set=root 8614-5FEE <br> linux16 /memtest.bin <br> } <br></code> <br><br>  And boot from the first hard disk, if you accidentally left a USB flash drive in the connector: <br><br> <code>menuentry "hd0"{ <br> insmod part_msdos <br> insmod ntfs <br> insmod fat <br> insmod ext2 <br> set root='(hd0)' <br> chainloader +1 <br> } <br></code> <br><br>  Some BIOSes perceive the card as hd0, so it is advisable to leave the hd1 download close by in a similar way. <br><br>  If you find the system you need in the article, you can delete the syslinux, isolinux, boot / grub, etc. folders from the copied images, but if you haven‚Äôt found them, look for hints in them :) <br>  For example, for the same Linux Mint in the file <i>/isolinux/isolinux.cfg</i> : <br><br> <code>label live <br> menu label Start Linux Mint <br> kernel /casper/vmlinuz <br> append file=/cdrom/preseed/mint.seed boot=casper initrd=/casper/initrd.lz quiet splash -- <br></code> <br><br>  All we need to do is connect the modules necessary for the FS with insmod, replace the kernel with linux and move the append section after the kernel name and specify the system partition.  Like this: <br><br> <code>menuentry 'Mint Default' --class ubuntu --class gnu-linux --class gnu --class os { <br> insmod ext2 <br> insmod fat <br> search --no-floppy --fs-uuid --set=root 1E1F-DD84 <br> linux /casper/vmlinuz boot=casper initrd=/casper/initrd.lz quiet splash -- <br> initrd /casper/initrd.lz <br> } <br></code> <br><br>  <i>Done</i> , you can reboot and experience the new system! </div><p>Source: <a href="https://habr.com/ru/post/135637/">https://habr.com/ru/post/135637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135628/index.html">Collective intelligence of bacteria or swarm intelligence</a></li>
<li><a href="../135629/index.html">Asynchronous data exchange over HTTP</a></li>
<li><a href="../135630/index.html">We control printing with PAM</a></li>
<li><a href="../135633/index.html">Jrebel</a></li>
<li><a href="../135634/index.html">Ensuring clean air when cleaning the matrix of a digital camera</a></li>
<li><a href="../135638/index.html">Quick hand download counter</a></li>
<li><a href="../135641/index.html">MSP430 Developer Kit from Texas Instruments</a></li>
<li><a href="../135643/index.html">The new law requires Wi-Fi in all restaurants of the capital of Malaysia</a></li>
<li><a href="../135645/index.html">Why is coworking in Thailand covered</a></li>
<li><a href="../135646/index.html">Interview with Dries Bytaertom: About Drupal 8, Open Source, Business and India</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>