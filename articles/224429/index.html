<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>With remote control for life or laziness - the engine of progress</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Picture to attract attention, the similarity with real life distant 

 I'll write another article. About one of your projects from the previously ment...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>With remote control for life or laziness - the engine of progress</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8c0/e43/514/8c0e435144e238ab0048392963129f85.png" alt="image"><br>  <i>Picture to attract attention, the similarity with real life distant</i> <br><br>  I'll write another article.  About one of your projects from the previously <a href="http://habrahabr.ru/post/224197/">mentioned</a> folder "Projects / 4Fun".  This project started as 4Fun, and ended as 4Use.  That is, it is used periodically to this day.  And it was like that ... <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Problem one </h4><br>  We all love to watch TV.  Well, almost all love.  I'm not an exception.  But to watch TV, you need to have it.  But with this I had some problems.  I did not have his (telly).  And it was not because usually the TV sets were attached to the rented apartments in which I lived.  But then there was one apartment without TV.  And this problem had to be solved somehow. <br><br><h4>  Solution one </h4><br>  Being a <s>miser</s> for a living <s>,</s> quite an economical person, I decided not to buy a telly, but a TV tuner - this is probably the first thought that should come to my head in a similar situation.  Thought - done.  One of my colleagues just wanted to sell a TV tuner.  Here is such, approximately: <br><img src="https://habrastorage.org/getpro/habr/post_images/30f/8e3/c20/30f8e3c20e2c88a5fbb55d45fcc7c25e.jpg" alt="image"><br><br>  In general, I bought it.  Yes, just was ... <br><br><h4>  Problem two </h4><br>  It turned out that the remote control was irretrievably lost and could not be restored.  And I would like to lie on the couch to switch channels and adjust the sound (ordinary and understandable joys).  Then connected to the brain department responsible for finding solutions.  Immediately it seemed obvious - to find another remote control and somehow make them friends with the tuner.  But it did not fit, because  along with the native remote, the signal receiver was also lost (it seems that it was a long time ago).  Well, somehow it is not in programmer, perhaps, ‚Äúwe have our own way‚Äù (c).  Therefore, it was suggested ... <br><br><h4>  Solution two </h4><br>  To watch TV, I use my native tuner card - BeholdTV.  You can switch channels in it using the ‚Äúup‚Äù and ‚Äúdown‚Äù keys, adjust the sound ‚Äúright‚Äù / ‚Äúleft‚Äù, etc.  Therefore, I thought of the following: write a server on a computer that will emulate key presses, and a client on a mobile phone will send the codes of the necessary keys to the server, and everything will be fine.  So in the end it turned out (good). <br><br>  The server was written under Windows, in C ++ and WinAPI.  It's simple: we start a stream for Broadcast over UDP messages of the type ‚ÄúI am a server for managing a TV set‚Äù and are waiting for the clients to connect.  So any client will be able to find out about the location of the server, and no IP hardcode will be needed.  And so do the right thing (I think). <br>  The client connects, the server starts listening to incoming commands.  As soon as I heard something, it emulates pressing a key.  Everything is simple and fit in one file: <br><div class="spoiler">  <b class="spoiler_title">Server code</b> <div class="spoiler_text"><pre><code class="hljs pgsql">// Roco.cpp : Defines the entry <span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the console application. // #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "stdafx.h" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;winsock2.h&gt; #pragma <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span>(lib, "Ws2_32.lib") <span class="hljs-type"><span class="hljs-type">void</span></span> broadcastThreadFunction(<span class="hljs-type"><span class="hljs-type">void</span></span> *context) { const SOCKET *broadcastSocket = (SOCKET*)context; sockaddr_in broadcastSocketServiceInfo; ZeroMemory(&amp;broadcastSocketServiceInfo, sizeof(broadcastSocketServiceInfo)); broadcastSocketServiceInfo.sin_family = AF_INET; broadcastSocketServiceInfo.sin_addr.s_addr = htonl(INADDR_BROADCAST); broadcastSocketServiceInfo.sin_port = htons(<span class="hljs-number"><span class="hljs-number">28777</span></span>); static const <span class="hljs-type"><span class="hljs-type">char</span></span> broadcastMessage[] = "ROCO-BROADCAST-MESSAGE"; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { const <span class="hljs-type"><span class="hljs-type">int</span></span> result = sendto(*broadcastSocket, broadcastMessage, sizeof(broadcastMessage), <span class="hljs-number"><span class="hljs-number">0</span></span>, (SOCKADDR*)&amp;broadcastSocketServiceInfo, sizeof(broadcastSocketServiceInfo)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == SOCKET_ERROR &amp;&amp; ::WSAGetLastError() == WSAENOTSOCK) { break; } ::Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); _endthread(); } <span class="hljs-type"><span class="hljs-type">int</span></span> _tmain(<span class="hljs-type"><span class="hljs-type">int</span></span> argc, _TCHAR* argv[]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; _tcscmp(argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], _T("/silent")) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ::ShowWindow(::GetConsoleWindow(), SW_HIDE); } WSADATA wsaData; ZeroMemory(&amp;wsaData, sizeof(wsaData)); printf("Initializing network... "); <span class="hljs-type"><span class="hljs-type">int</span></span> result = ::WSAStartup(MAKEWORD(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>), &amp;wsaData); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == NO_ERROR) { printf("Done.\n"); printf("Creating broadcast socket... "); const SOCKET broadcastSocket = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (broadcastSocket != INVALID_SOCKET) { printf("Done.\n"); static const <span class="hljs-type"><span class="hljs-type">BOOL</span></span> onValue = <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; setsockopt(broadcastSocket, SOL_SOCKET, SO_BROADCAST, (const <span class="hljs-type"><span class="hljs-type">char</span></span>*)&amp;onValue, sizeof(onValue)); printf("Starting broadcast thread... "); HANDLE broadcastThreadHandle =(HANDLE)_beginthread(broadcastThreadFunction, <span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-type"><span class="hljs-type">void</span></span>*)&amp;broadcastSocket); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (broadcastThreadHandle != INVALID_HANDLE_VALUE) { printf("Done.\n"); printf("Creating listen socket... "); const SOCKET listenSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (listenSocket != INVALID_SOCKET) { printf("Done.\n"); printf("Binding listen socket... "); sockaddr_in listenSocketServiceInfo; ZeroMemory(&amp;listenSocketServiceInfo, sizeof(listenSocketServiceInfo)); listenSocketServiceInfo.sin_family = AF_INET; listenSocketServiceInfo.sin_addr.s_addr = htonl(INADDR_ANY); listenSocketServiceInfo.sin_port = htons(<span class="hljs-number"><span class="hljs-number">28666</span></span>); result = bind(listenSocket, (SOCKADDR*)&amp;listenSocketServiceInfo, sizeof(listenSocketServiceInfo)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != SOCKET_ERROR) { printf("Done.\n"); printf("Listening for incoming connection... "); result = <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span>(listenSocket, SOMAXCONN); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != SOCKET_ERROR) { printf("Done.\n"); unsigned connectionIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { printf("Accepting incoming connection #%d... ", connectionIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); ::ResumeThread(broadcastThreadHandle); SOCKET commandSocket = accept(listenSocket, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (commandSocket != INVALID_SOCKET) { printf("Done.\n"); ::SuspendThread(broadcastThreadHandle); printf("Sending PING to command socket... "); static const <span class="hljs-type"><span class="hljs-type">char</span></span> ping[] = "PING"; result = send(commandSocket, ping, sizeof(ping), <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != SOCKET_ERROR &amp;&amp; result == sizeof(ping)) { printf("Done.\n"); printf("Receiving PONG from command socket... "); static <span class="hljs-type"><span class="hljs-type">char</span></span> pong[sizeof("PONG")]; pong[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; result = recv(commandSocket, pong, sizeof(pong), <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != SOCKET_ERROR &amp;&amp; result == sizeof(pong) &amp;&amp; strcmp(pong, "PONG") == <span class="hljs-number"><span class="hljs-number">0</span></span>) { printf("Done.\n"); unsigned commandIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { printf("Waiting for command #%d...\n", commandIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); static <span class="hljs-type"><span class="hljs-type">char</span></span> command[<span class="hljs-number"><span class="hljs-number">2</span></span>]; ZeroMemory(command, sizeof(command)); result = recv(commandSocket, command, sizeof(command), <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != SOCKET_ERROR &amp;&amp; result == sizeof(command)) { enum { CC_KEY_DOWM = <span class="hljs-number"><span class="hljs-number">1</span></span>, CC_KEY_UP = <span class="hljs-number"><span class="hljs-number">0</span></span> }; const <span class="hljs-type"><span class="hljs-type">char</span></span> commandCode = command[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const <span class="hljs-type"><span class="hljs-type">char</span></span> keyCode = command[<span class="hljs-number"><span class="hljs-number">1</span></span>]; static const <span class="hljs-type"><span class="hljs-type">char</span></span> res = <span class="hljs-number"><span class="hljs-number">1</span></span>; switch (commandCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CC_KEY_DOWM: { printf("KEY_DOWN(%d)\n", keyCode); keybd_event(keyCode, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); send(commandSocket, &amp;res, sizeof(res), <span class="hljs-number"><span class="hljs-number">0</span></span>); } break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CC_KEY_UP: { printf("KEY_UP(%d)\n", keyCode); keybd_event(keyCode, <span class="hljs-number"><span class="hljs-number">0</span></span>, KEYEVENTF_KEYUP, <span class="hljs-number"><span class="hljs-number">0</span></span>); send(commandSocket, &amp;res, sizeof(res), <span class="hljs-number"><span class="hljs-number">0</span></span>); } break; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { printf("Invalid command received - %d!\n", commandCode); } break; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("Could not receive command from socket (error - %d)!\n", ::WSAGetLastError()); break; } ++commandIndex; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not receive PONG from command socket (error - %d)!\n", ::WSAGetLastError()); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not sent PING to command socket (error - %d)!\n", ::WSAGetLastError()); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not accept incoming connection (error - %d)!\n", ::WSAGetLastError()); } ++connectionIndex; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not listen for incoming connection (error - %d)!\n", ::WSAGetLastError()); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not bind listen socket (error - %d)!\n", ::WSAGetLastError()); } closesocket(listenSocket); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not create listen socket (error - %d)!\n", ::WSAGetLastError()); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not start broadcast thread!\n"); } ::ResumeThread(broadcastThreadHandle); closesocket(broadcastSocket); ::WaitForSingleObject(broadcastThreadHandle, INFINITE); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nCould not create broadcast socket (error - %d)!\n", ::WSAGetLastError()); } ::WSACleanup(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { printf("\nWSAStartup failed (error - %d)!", result); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br><br>  Starts the server along with the prominent.  Server console utility (convenient for viewing logs, if that), so this line is needed right after launch: <br><pre> <code class="hljs css"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::ShowWindow(</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::GetConsoleWindow()</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">SW_HIDE</span></span>);</code> </pre><br><br>  I have a mobile phone on Android, so the client wrote a native one, on the edge.  It turned out such a super-mega interface: <br><img src="https://habrastorage.org/getpro/habr/post_images/4f4/a20/089/4f4a20089d1f5b5deab9b31ec44e6da8.png"><br><br>  The client source is also pretty simple.  We generate the interface programmatically, on each button hangs the sending of the key code on the server.  When the client starts, we look for the location of the server, connect.  It looks like this: <br><div class="spoiler">  <b class="spoiler_title">Client code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.dummy.roco; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.DatagramPacket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.DatagramSocket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.InetSocketAddress; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.Socket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Timer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.TimerTask; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.net.wifi.WifiManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.net.wifi.WifiManager.MulticastLock; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.StrictMode; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Vibrator; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.AlertDialog; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.DialogInterface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.KeyEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.MotionEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.ViewGroup.LayoutParams; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.LinearLayout; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RemoteControlActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ButtonInfo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String text_; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> code_; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ButtonInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String text, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code)</span></span></span><span class="hljs-function"> </span></span>{ text_ = text; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (code != <span class="hljs-number"><span class="hljs-number">0</span></span>) { code_ = code; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { code_ = text.codePointAt(<span class="hljs-number"><span class="hljs-number">0</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandButton</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> ButtonInfo buttonInfo_; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Socket commandSocket_; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Vibrator vibrator_; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Timer commandTimer_; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> COMMAND_DELAY = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CommandButton</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Context context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ButtonInfo buttonInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Socket commandSocket, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vibrator vibrator)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); buttonInfo_ = buttonInfo; commandSocket_ = commandSocket; vibrator_ = vibrator; setText(buttonInfo_.text_); setTextSize(getTextSize()); setOnTouchListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnTouchListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, MotionEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_DOWN: startCommandTimer(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_UP: stopCommandTimer(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> commandCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> buttonCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> command[] = { (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) commandCode, (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) buttonCode }; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { commandSocket_.getOutputStream().write(command); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { exception.printStackTrace(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startCommandTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ vibrator_.vibrate(<span class="hljs-number"><span class="hljs-number">10</span></span>); sendCommand(CC_KEY_DOWM, buttonInfo_.code_); commandTimer_ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer(); commandTimer_.schedule(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimerTask() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sendCommand(CC_KEY_DOWM, buttonInfo_.code_); } }, COMMAND_DELAY, COMMAND_DELAY); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopCommandTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ commandTimer_.cancel(); commandTimer_.purge(); commandTimer_ = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; sendCommand(CC_KEY_UP, buttonInfo_.code_); vibrator_.vibrate(<span class="hljs-number"><span class="hljs-number">10</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ButtonInfo buttonInfos_[][] = { { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) }, { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"5"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"6"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) }, { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"7"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"8"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) }, { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"¬æ"</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"‚Üë"</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"¬§"</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span>) }, { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"‚Üê"</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"¬Æ"</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"‚Üí"</span></span>, <span class="hljs-number"><span class="hljs-number">39</span></span>) }, { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"¬ß"</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"‚Üì"</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonInfo(<span class="hljs-string"><span class="hljs-string">"¬´"</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>) } }; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CC_KEY_DOWM = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CC_KEY_UP = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Socket commandSocket_ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Socket(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Vibrator vibrator_; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); vibrator_ = (Vibrator) getSystemService(VIBRATOR_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LinearLayout mainLayout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); mainLayout.setOrientation(LinearLayout.VERTICAL); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; buttonInfos_.length; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LinearLayout rowLayout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); rowLayout.setOrientation(LinearLayout.HORIZONTAL); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; buttonInfos_[i].length; ++j) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CommandButton button = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandButton(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, buttonInfos_[i][j], commandSocket_, vibrator_); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LinearLayout.LayoutParams layoutParams = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayout.LayoutParams( LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT); layoutParams.weight = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; rowLayout.addView(button, layoutParams); } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LinearLayout.LayoutParams layoutParams = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayout.LayoutParams( LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT); layoutParams.weight = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; mainLayout.addView(rowLayout, layoutParams); } setContentView(mainLayout, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT)); MulticastLock multicastLock = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; DatagramSocket broadcastSocket = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { StrictMode.setThreadPolicy(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StrictMode.ThreadPolicy.Builder() .permitAll().build()); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WifiManager wifiManager = (WifiManager) getSystemService(Context.WIFI_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wifiManager != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { multicastLock = wifiManager .createMulticastLock(<span class="hljs-string"><span class="hljs-string">"ROCO-MulticastLock"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (multicastLock != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { multicastLock.acquire(); } broadcastSocket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DatagramSocket(<span class="hljs-number"><span class="hljs-number">28777</span></span>); broadcastSocket.setBroadcast(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); broadcastSocket.setSoTimeout(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] datagramPacketData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-string"><span class="hljs-string">"ROCO-BROADCAST-MESSAGE\0"</span></span> .length()]; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DatagramPacket datagramPacket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DatagramPacket( datagramPacketData, datagramPacketData.length); broadcastSocket.receive(datagramPacket); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(datagramPacketData) .compareTo(<span class="hljs-string"><span class="hljs-string">"ROCO-BROADCAST-MESSAGE\0"</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Could not get ROCO server address!"</span></span>); } commandSocket_.setSoTimeout(<span class="hljs-number"><span class="hljs-number">500</span></span>); commandSocket_.connect(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InetSocketAddress(datagramPacket .getAddress().getHostAddress(), <span class="hljs-number"><span class="hljs-number">28666</span></span>), commandSocket_ .getSoTimeout()); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> ping[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-string"><span class="hljs-string">"PING\0"</span></span>.length()]; commandSocket_.getInputStream().read(ping); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(ping).compareTo(<span class="hljs-string"><span class="hljs-string">"PING\0"</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception( <span class="hljs-string"><span class="hljs-string">"Could not receive PING from command socket!"</span></span>); } commandSocket_.getOutputStream().write( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(<span class="hljs-string"><span class="hljs-string">"PONG\0"</span></span>).getBytes()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AlertDialog alertDialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AlertDialog.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .create(); alertDialog.setCancelable(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); alertDialog.setTitle(<span class="hljs-string"><span class="hljs-string">"Roco: Error"</span></span>); alertDialog .setMessage(<span class="hljs-string"><span class="hljs-string">"Could not connect to the server!\nError - '"</span></span> + exception.toString() + <span class="hljs-string"><span class="hljs-string">"'\n\nExiting..."</span></span>); alertDialog.setButton(AlertDialog.BUTTON_POSITIVE, <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DialogInterface.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DialogInterface dialog, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> which)</span></span></span><span class="hljs-function"> </span></span>{ dialog.dismiss(); finish(); } }); alertDialog.show(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (broadcastSocket != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { broadcastSocket.close(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (multicastLock != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; multicastLock.isHeld()) { multicastLock.release(); } } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { commandSocket_.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { exception.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDestroy(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKeyDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keyCode, KeyEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((keyCode == KeyEvent.KEYCODE_BACK)) { finish(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onKeyDown(keyCode, event); } }</code> </pre><br></div></div><br><br>  The project was written for a long time, and professionalism does not stand still.  Now, perhaps, I would write everything is not so clumsy (perhaps even using the <a href="http://www.beholder.ru/support/downld.htm">official API</a> , which I learned about after writing the project).  However, everything works stably and periodically used. <br><br>  There is an interesting side effect - if you watch not a TV set, but, say, YouTube, then the player can be paused.  And otpauzit too. <br><br>  In general, it turned out cool, useful, cheap and cheerful. <br><br>  The project is called ‚ÄúRoco‚Äù.  Who can guess why this is so - write in the comments.  Guessing glory and respect. <br><br>  PS By the way, I rarely watch TV recently.  Mostly downloaded movies or online.  Good thing I did not buy it then.  But now I'm thinking about buying.  Some paradox turns out ... </div><p>Source: <a href="https://habr.com/ru/post/224429/">https://habr.com/ru/post/224429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224419/index.html">Under the hood: build and open source flint</a></li>
<li><a href="../224421/index.html">Ours in Vancouver: as a scientist from Kemerovo creates a virtual trainer for MIO</a></li>
<li><a href="../224423/index.html">Google Chrome denies Windows users the ability to install extensions from outside the Chrome Web Store</a></li>
<li><a href="../224425/index.html">Bryn admitted that his work on Google+ was a mistake.</a></li>
<li><a href="../224427/index.html">The Germans have created a control system of the aircraft with the help of thoughts</a></li>
<li><a href="../224431/index.html">Over the weekend, Google changed its logo, and you did not even notice</a></li>
<li><a href="../224433/index.html">Robot Canadarm2 on the ISS "operated on" itself</a></li>
<li><a href="../224435/index.html">Report on the first stage of the Geo-Hakaton</a></li>
<li><a href="../224437/index.html">How I ordered and collected PRUSA i3</a></li>
<li><a href="../224443/index.html">One essay on project portfolio management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>