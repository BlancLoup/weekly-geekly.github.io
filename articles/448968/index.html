<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asynchronous PHP. What for?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Asynchronous programming today is in demand, especially in web development, where application responsiveness is especially important. No one wants to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asynchronous PHP. What for?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/vr/yd/zc/vrydzcqx0ogo5vfy-a2uzf0wmgs.jpeg" alt="image"><br><br>  Asynchronous programming today is in demand, especially in web development, where application responsiveness is especially important.  No one wants to wait for the application to ‚Äúhang out,‚Äù even if at this time it performs a query to the database, sends an email, or works on other tasks that may take a long time.  The client wants to get an answer to their action, the best - immediately.  If your application is slow, you lose clients.  When confronted with a hanging application, most often the user simply closes it and never returns.  From the user's point of view, the application just hung, it cannot understand why this happened: whether it performs a complex operation or stopped working in principle. <br><br>  <i>We present the translation of the article by Skyeng backend developer Sergey Zhuk.</i> <br><a name="habracut"></a><br><h3>  Application responsiveness </h3><br>  Modern applications are most often responsive, but some tasks or operations, such as exchanging data over a network, file I / O, or database requests, can take a lot of time and significantly slow down an application.  To prevent such operations from blocking the application, they can be run in the background, thereby hiding the delay they cause.  At the same time, the application remains responsive because it can continue to perform other tasks, such as returning the control flow to the user interface or responding to other events. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Parallelism and asynchrony </h3><br>  When people see an asynchronous code, most often they immediately think: ‚ÄúExcellent, I can parallelize processes!‚Äù.  Perhaps I will disappoint you, but in fact it is not.  Asynchrony and concurrency are not the same thing.  To catch this difference can be difficult, so let's try to figure it out. <br><br>  If tasks are performed asynchronously, they do not block each other and the execution of one task does not depend on the completion of another.  Parallelism, in turn, implies the launch of several separate tasks simultaneously as independent units of work. <br><br>  Asynchrony: <br><blockquote>  Go and complete the task <b>yourself</b> .  Let me know when you're done, and show the result.  At this time I can continue to engage in their task. </blockquote><br>  Asynchronous code requires handling dependencies that arise when performing tasks, and this is implemented using callbacks.  When a task is completed, the code notifies another task.  Asynchronous code is basically about the task execution time (the order of events). <br><img src="https://habrastorage.org/webt/zu/np/3h/zunp3hgp9rim8pbath4tidi_icu.png" alt="image"><br>  Parallelism: <br><blockquote>  <b>Hire as many workers as you like,</b> and divide the task between them to complete it faster, and notify me when you are done.  I can continue to do other things, or if the task is urgent, I will stay and wait until you return with the results.  Then I can build the final result from all the workers.  Parallel execution often requires more resources, so here basically everything depends on hardware. </blockquote><br><img src="https://habrastorage.org/webt/o9/ty/fp/o9tyfphmymspkaemitwjnhrikx0.png" alt="image"><br>  To understand the difference between asynchronous and parallel execution with a real example, let's compare two popular web servers: Apache and Nginx.  They perfectly illustrate this difference.  Nginx uses an asynchronous, event-based model while Apache uses parallel threads.  Apache creates new threads for each additional connection, so here the maximum number of allowed connections depends on the amount of available memory in the system.  When the connection limit is reached, Apache stops creating additional connections.  The limiting factor in configuring Apache is memory (remember that parallel execution often depends on hardware).  If the stream stops, the client waits for a response until the stream is free and can send a response. <br><br>  Nginx does not work like Apache, it does not create new threads for each incoming request.  Nginx has a main workflow (or several workers, often for one processor there is one workflow), which is single-threaded.  This worker can handle thousands of connections "simultaneously" and does it asynchronously, in one thread, rather than in parallel in several threads. <br><br>  Thus, ‚Äúasynchronous‚Äù is how we build the system, this is a composition of processes independent of each other.  By "parallel execution" is meant the execution of several processes at the same moment in time, and they may be related or not related to each other.  With asynchronous execution, we process several tasks at once, and with parallel execution, we run several processes at once.  It may seem that this is the same thing, but it is not.  Asynchrony describes the structure, parallelism - the way to perform. <br><br>  Asynchronous execution can be compared with input-output devices on your computer (mouse, keyboard, display).  All of them are controlled by the operating system, but each of them is an independent part of the kernel.  These processes run asynchronously, they can be parallel, but this is not necessary.  Thus, to ensure consistency, you must create a link between these independent parts in order to coordinate them. <br><br><h3>  And what of this backend? </h3><br>  You can say that responsiveness is not so important on the back end.  All these cool asynchronous javascript stuff happens on the frond, and your server just responds to requests, so the frond should be responsible for the application's responsiveness, but not you.  Yes, this is true, but the server‚Äôs task is not limited to API responses.  Sometimes you have to manage complex tasks, such as downloading videos.  In this case, perhaps, responsiveness is not the key factor, but its absence leads to wasting resources, because the application has to be idle.  It can wait for the completion of file system operations, network interactions, database queries, and the like.  Often, these I / O operations are very slow compared to CPU calculations, for example, when we convert video files.  And while we are slowly saving or reading the file, the processor is forced to be in standby mode instead of doing useful work.  As we have already found out, instead of waiting, we can run these tasks in the background.  How?  Go ahead. <br><br><h3>  Asynchronous PHP </h3><br>  In JavaScript, out-of-the-box, built-in support and solutions for writing asynchronous code are available.  There is also Node.js, which allows you to write asynchronous server applications.  In JavaScript, we can use the setTimeout () function to demonstrate an example of asynchronous code: <br><img src="https://habrastorage.org/webt/j-/tx/mt/j-txmtg4lym_eu5fwk2qakt_s08.png" alt="image"><br><br>  When you run this code, we will see the following: <br><img src="https://habrastorage.org/webt/bk/fk/2r/bkfk2r_onqq6_yhyqzqbzsuqod8.png" alt="image"><br><br>  The setTimeout () function sends the code to the queue and executes it upon completion of the current call stack.  This means that we break the synchronous flow of code and delay execution.  The second call to console.log () is executed before the call to the queue inside the call to setTimeout (). <br><br>  What about PHP?  In PHP, we do not have suitable adapted tools for writing truly asynchronous code.  There is no equivalent to setTimeout (), and we cannot simply postpone or queue the execution of any code.  That is why such frameworks and libraries as Amp and ReactPHP began to appear.  Their idea is to hide the low-level details of the language and give the user high-level tools that allow you to write asynchronous code and control the competitive execution of processes like JavaScript and Node.js. <br><br><h3>  Why should I use PHP if I have Node.js and Go? </h3><br>  This question often arises when it comes to asynchronous PHP.  For some reason, many oppose the use of PHP for writing asynchronous code.  Someone always suggests using Go or Node.js instead of PHP. <br><br>  Tweet <a href="https://twitter.com/assertchris">assertchris</a> perfectly describes such situations: <br><br><img src="https://habrastorage.org/webt/hz/gd/gs/hzgdgsarcixle4sahqsvummqkvs.png" alt="image"><br><br>  Of course, when PHP was first created, there was no goal to make it a programming language that you can use to create large complex applications.  At that time, no one thought about either JavaScript or asynchrony.  But now we have a completely different PHP, which already has its own functions for writing asynchronous code (for example, the stream_select () function). <br><br>  Yes, you can use Go or Node.js to create asynchronous server applications, but this does not always solve the problem.  If you already have a lot of experience with PHP, it will be much easier for you to simply study the libraries and tools that are suitable for your situation than to learn a new language and a new ecosystem.  Tools like <a href="https://reactphp.org/">ReactPHP</a> or <a href="http://amphp.org/">Amp</a> allow you to write asynchronous code in the same way you do in Node.js.  These tools are quite advanced and have stable versions, so you can safely use them in production. <br><br><h3>  Not only CLI </h3><br><blockquote>  I'm not going to write a chat, server or something like that.  I just want to speed up the site. </blockquote><br>  It is customary to think that asynchronous code can only be used in CLI scripts.  It is absolutely normal to integrate some asynchronous components into a traditional synchronous environment, even into a traditional web application.  For example, you can receive a request, and then asynchronously call several different resources, and when these calls are made, you can continue the request-response life cycle, and the page will be displayed faster as a result. <br><br>  Or you need to make some external API calls - for example, when a user completes a payment, you want to send an email or push notification.  You can execute these API calls asynchronously, and then continue with your traditional synchronous code flow.  There is no need to completely rewrite the application and delete everything that slows down the work.  Just identify the bottlenecks that interfere with performance, and, quite possibly, they will be able to fix with asynchronous code. <br><br>  Yes, asynchronous code in most cases is still used in CLI scripts, but it is not limited to real-time chats and servers.  If you just want to speed up your site, you do not need to abandon your symfony or Laravel framework and create your own fully asynchronous application server. <br><br><h3>  Conclusion </h3><br>  Do not be afraid to learn a new paradigm.  PHP is much more than "run the script, execute the code and die."  You will be surprised when you realize that you can use the familiar PHP in a completely new way, as you have never used it!  Asynchronous code and event-oriented programming will enhance your understanding of PHP and the possibilities of using this language.  You do not need to learn a new language to write asynchronous applications just because "PHP is not the right tool" or "I have always done that, it cannot be improved."  Just try it! <br><br>  Well, we also remind you that we always have a lot of <a href="https://moikrug.ru/companies/skyeng/vacancies">interesting vacancies</a> for developers! </div><p>Source: <a href="https://habr.com/ru/post/448968/">https://habr.com/ru/post/448968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448956/index.html">Anger at the code: programmers and negative</a></li>
<li><a href="../448958/index.html">How Amazon selects its seemingly random offers of the day. And why are sellers chasing them like that?</a></li>
<li><a href="../448960/index.html">Unlimited XR technologies in the era of distributed computing</a></li>
<li><a href="../448964/index.html">Toaster gives users more rights.</a></li>
<li><a href="../448966/index.html">Android application in memory. Optimization Report for Yandex.Luncher</a></li>
<li><a href="../448970/index.html">Two-factor authentication for SSH</a></li>
<li><a href="../448976/index.html">Spring activities on game dev in VSBI</a></li>
<li><a href="../448980/index.html">Our first lunch together: why and how we spend a test day</a></li>
<li><a href="../448982/index.html">Headless CMS. Why i write my</a></li>
<li><a href="../448986/index.html">Reverse engineering in production using 3D scanning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>