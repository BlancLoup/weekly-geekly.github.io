<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends Mac OS X with Microsoft DFS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Although this is the ABBYY corporate blog, in this article I will not touch our products and our company, but I‚Äôll tell you about solving one practica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends Mac OS X with Microsoft DFS</h1><div class="post__text post__text-html js-mediator-article"> Although this is the ABBYY corporate blog, in this article I will not touch our products and our company, but I‚Äôll tell you about solving one practical issue: access to network resources from Mac OS X in a situation when the company uses Microsoft DFS (Distributed File System).  In large companies, this technology is used at every turn, and ABBYY is no exception.  Indeed, instead of a scattered server system with resources scattered across them, the user sees a logically built network resource tree. <br><br>  When five years ago I decided to change my working laptop on a MacBook Pro, this was ambiguous in the team.  Especially skeptical looked at it in team of system administrators.  Although I was in charge of this team over the past five years, I was given very minor concessions, and the use of Mac OS, from the point of view of our admins, went beyond just concessions.  But I said that I would take all the problems on me and almost kept my word, although, I confess, sometimes I still had to annoy administrators with my Mac problems.  But I managed to solve the problem with DFS myself, because she really got me. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The problem of accessing DFS has been discussed in forums for a long time; all interested parties have been waiting for normal support of this technology from Apple for several years.  But, unfortunately, things are still there (in Cupertino, apparently). <br><br>  I will briefly outline the problem: I regularly receive letters with links in the UNC format to files like these: <br><br> <code>\\dfs\Common\Media\Pictures\New Year Party\Aram on his head.jpg</code> <br> <br>  At the same time, the latest versions of Outlook automatically inserted a URL link into emails, which looks like this: <br><br> <code>file:////dfs/Common/Media/Pictures/New%20Year%20Party/‚Ä¶</code> <br> <br>  For me, this is a disservice, because Mac OS does not know which protocol to use via this link.  If suddenly lucky, Outlook didn‚Äôt set the link itself, then Mail.app in Snow Leopard can automatically convert UNC paths to the <code>smb://server/share/path</code> view.  A good function, but to help it, you need to be very lucky: the source path should not be to the DFS resource and the link should not be enclosed in the HTML text.  In addition, the enthusiasm of Mail.app ends on the first space encountered, therefore, very often such automatic links are also broken.  But even open the ‚ÄúConnect to server‚Äù window in the Finder, copy the source text with handles, fix all backslashes to straight lines, everything will work out only if the source path is the real path to the real computer, not the DFS path. <br><br>  It must be admitted that there is a global solution to this problem, called <a href="http://www.thursby.com/products/admitmac.html">ADmitMac,</a> but it costs a lot of money and does a lot of other things, which is more harmful than useful, because this program climbs too deep into the system. <br><br>  The second, simpler solution, called <a href="http://www.aderstedtsoftware.com/diffiss/">Diffiss</a> , is similar to the experimental work of a novice programmer.  The product allows you to navigate the DFS tree, however, until the main application window is closed, which you can‚Äôt open after that except by restarting the application.  This program allows you not to keep in mind the correspondence of DFS nodes to real servers, and to walk through the DFS tree, but it does not help you to open links from emails.  It is necessary to walk on the tree with handles, first inside Diffiss, then inside Finder.  But for a while even this was a relief. <br><br>  Recently, I almost accidentally stumbled upon <a href="http://the.taoofmac.com/space/HOWTO/DFS">this article</a> , which made me take up a solid solution to the problem, that is, to make solid crutches, in order to hover until the time when Apple finally supports DFS in the system itself at the Finder level.  By the way, in Samba 3.0.28, supplied with OS X Snow Leopard, work with DFS is supported (which I actually used). <br><br>  Crutches consist of two parts.  One is a bash script that takes as input the name of the DFS root server and the source path, and on output gives the UNC path to the directory on the real server.  The second part is a small AppleScript script that gets the user‚Äôs source path, runs the bash script and opens the required directory in Finder. <br><br>  Consider each of the details separately. <br><br><blockquote>  <font color="#666666">#! / bin / bash</font> <br><br>  <font color="#666666"># This script is designed to convert the DFS path to the resource.</font> <br>  <font color="#666666"># in the path to a real shared resource on a Windows network</font> <br><br>  <font color="#666666"># The script is waiting at the entrance:</font> <br>  <font color="#666666"># arg1: DFS root server name</font> <br>  <font color="#666666"># arg2: UNC path that needs to be brought to the real path</font> <br>  <font color="#666666"># The script assumes that user authentication is performed via Kerberos.</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#660033">-z</font> <font color="#ff0000">"$ 1"</font> <font color="#7a0874">]</font> <font color="#000000">||</font>  <font color="#7a0874">[</font> <font color="#660033">-z</font> <font color="#ff0000">"$ 2"</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#660033">-e</font> <font color="#ff0000">"Error: script assumes two arguments."</font> <br>  <font color="#7a0874">echo</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">100</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#007800">DFS_SERVER</font> = $ <font color="#000000">1</font> <br><br>  <font color="#666666"># Convert backslashes to straight lines, remove possible spaces in the beginning</font> <br>  <font color="#666666"># strings and translate all letters to lowercase</font> <br>  <font color="#007800">DFS_PATH</font> = $ <font color="#7a0874">(</font> <font color="#7a0874">echo</font> <font color="#660033">-n</font> $ <font color="#000000">2</font> <font color="#000000">|</font> <font color="#c20cb9">sed</font> <font color="#ff0000">'s / \\ / \ // g'</font> <font color="#000000">|</font> <font color="#c20cb9">sed</font> <font color="#ff0000">'s / ^ * // g'</font> <font color="#000000">|</font> <font color="#c20cb9">tr</font> <font color="#ff0000">"[: upper:]"</font> <font color="#ff0000">"[: lower:]"</font> <font color="#7a0874">)</font> <br>  <font color="#007800">real_share</font> = <font color="#ff0000">""</font> <br>  <font color="#007800">exit_code</font> = <font color="#ff0000">"0"</font> <br><br>  <font color="#666666"># Get a list of DFS nodes using rpcclient (see the expression at the end of the loop,</font> <br>  <font color="#666666"># immediately after 'done').</font>  <font color="#666666">This way of invoking the command is done in order to avoid</font> <br>  <font color="#666666"># of using channels, as for the implementation of channels the cycle is performed in a subshell,</font> <br>  <font color="#666666"># that masks the variables we want to modify in a loop.</font> <br><br>  <font color="#000000">while</font> <font color="#c20cb9">read</font> smb_path;  <font color="#000000">do</font> <br>  <font color="#c20cb9">read</font> comment <br>  <font color="#c20cb9">read</font> state <br>  <font color="#c20cb9">read</font> num_stores <br>  <font color="#666666"># Separate fields from labels, delete spaces in the beginning, and translate letters into lowercase</font> <br>  <font color="#007800">smb_path</font> = $ <font color="#7a0874">(</font> <font color="#7a0874">echo</font> <font color="#007800">$ smb_path</font> <font color="#000000">|</font> <font color="#c20cb9">awk</font> -F: <font color="#ff0000">'{gsub (/ ^ [\ t] + /, "", $ 2); print $ 2}'</font> <font color="#000000">|</font> \ <br>  <font color="#c20cb9">tr</font> <font color="#ff0000">"[: upper:]"</font> <font color="#ff0000">"[: lower:]"</font> <font color="#7a0874">)</font> <br>  <font color="#007800">num_stores</font> = $ <font color="#7a0874">(</font> <font color="#7a0874">echo</font> <font color="#007800">$ num_stores</font> <font color="#000000">|</font> <font color="#c20cb9">awk</font> -F: <font color="#ff0000">'{gsub (/ ^ [\ t] + /, "", $ 2); print $ 2}'</font> <font color="#7a0874">)</font> <br>  <font color="#007800">state</font> = $ <font color="#7a0874">(</font> <font color="#7a0874">echo</font> <font color="#007800">$ state</font> <font color="#000000">|</font> <font color="#c20cb9">awk</font> -F: <font color="#ff0000">'{gsub (/ ^ [\ t] + /, "", $ 2); print $ 2}'</font> <font color="#7a0874">)</font> <br><br>  <font color="#666666"># Verify that the numbers and num_stores and state variables are entered</font> <br>  <font color="#666666"># they are not empty.</font>  <font color="#666666">If not, then it seems to have failed.</font> <br>  <font color="#c20cb9">expr</font> <font color="#ff0000">" <font color="#007800">$ num_stores</font> + <font color="#007800">$ state</font> "</font> <font color="#000000">&gt;</font> <font color="#000000">/</font> dev <font color="#000000">/</font> null <font color="#000000">2</font> <font color="#000000">&gt;</font> <font color="#000000">/</font> dev <font color="#000000">/</font> null <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#007800">$?</font>  <font color="#000000">!</font>  = <font color="#000000">0</font> <font color="#7a0874">]</font> <font color="#000000">||</font>  <font color="#7a0874">[</font> <font color="#660033">-z</font> <font color="#ff0000">" <font color="#007800">$ num_stores</font> "</font> <font color="#7a0874">]</font> <font color="#000000">||</font>  <font color="#7a0874">[</font> <font color="#660033">-z</font> <font color="#ff0000">" <font color="#007800">$ state</font> "</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#660033">-e</font> <font color="#ff0000">"Error while trying to get the list of DFS nodes."</font> <br>  <font color="#007800">exit_code</font> = <font color="#ff0000">"200"</font> <br>  <font color="#7a0874">break</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#666666"># The number of real resources associated with a node may be more than one.</font> <br>  <font color="#666666"># In such cases, we will use the smbclient call to select a resource.</font> <br>  <font color="#000000">for</font> <font color="#7a0874">(</font> <font color="#7a0874">(</font> store = <font color="#000000">0</font> ; store <font color="#000000">&lt;</font> <font color="#007800">$ num_stores</font> ; store ++ <font color="#7a0874">)</font> <font color="#7a0874">)</font> ;  <font color="#000000">do</font> <br>  <font color="#c20cb9">read</font> server <br>  <font color="#c20cb9">read</font> share <br>  <font color="#000000">done</font> <br><br>  <font color="#666666"># Check whether the beginning of the DFS path matches any of the resources</font> <br>  <font color="#666666"># from the resulting list</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ state</font> "</font> <font color="#660033">-eq</font> <font color="#ff0000">"1"</font> <font color="#7a0874">]</font> <font color="#000000">&amp;&amp;</font> <font color="#7a0874">[</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ DFS_PATH</font> "</font> == <font color="#ff0000">" <font color="#007800">$ smb_path</font> "</font> <font color="#000000">*</font> <font color="#7a0874">]</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ num_stores</font> "</font> <font color="#660033">-gt</font> <font color="#ff0000">"1"</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#666666"># If the number of resources per node is more than one, call smbclient.</font> <br>  <font color="#666666"># Issue consists of two lines, we are interested in the second</font> <br>  <font color="#000000">while</font> <font color="#c20cb9">read</font> buff;  <font color="#000000">do</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#000000">!</font>  <font color="#660033">-z</font> <font color="#ff0000">" <font color="#007800">$ buff</font> "</font> <font color="#7a0874">]</font> <font color="#000000">&amp;&amp;</font> <font color="#7a0874">[</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ buff</font> "</font> == <font color="#ff0000">"//"</font> <font color="#000000">*</font> <font color="#7a0874">]</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#007800">real_share</font> = <font color="#ff0000">" <font color="#007800">$ buff</font> "</font> ; <br>  <font color="#000000">else</font> <br>  <font color="#666666"># If the second line does not look like</font> <br>  <font color="#666666"># as a UNC path to a resource, then an error has occurred</font> <br>  <font color="#7a0874">echo</font> <font color="#660033">-e</font> <font color="#ff0000">"Error calling smbclient: <font color="#007800">$ buff</font> "</font> <br>  <font color="#007800">exit_code</font> = <font color="#ff0000">"300"</font> <br>  <font color="#000000">fi</font> <br>  <font color="#000000">done</font> <font color="#000000">&lt;&lt;</font> <font color="#7a0874">(</font> smbclient <font color="#660033">-k</font> <font color="#660033">-c</font> showconnect <font color="#007800">$ smb_path</font> <font color="#000000">2</font> <font color="#000000">&gt;</font> <font color="#000000">/</font> dev <font color="#000000">/</font> null <font color="#7a0874">)</font> <br>  <font color="#000000">else</font> <br>  <font color="#007800">server</font> = $ <font color="#7a0874">(</font> <font color="#7a0874">echo</font> <font color="#007800">$ server</font> <font color="#000000">|</font> <font color="#c20cb9">awk</font> -F: <font color="#ff0000">'{gsub (/ ^ [\ t] + /, "", $ 2); print $ 2}'</font> <font color="#7a0874">)</font> <br>  <font color="#007800">share</font> = $ <font color="#7a0874">(</font> <font color="#7a0874">echo</font> <font color="#007800">$ share</font> <font color="#000000">|</font> <font color="#c20cb9">awk</font> -F: <font color="#ff0000">'{gsub (/ ^ [\ t] + /, "", $ 2); print $ 2}'</font> <font color="#7a0874">)</font> <br>  <font color="#007800">real_share</font> = <font color="#ff0000">"// <font color="#007800">$ server</font> / <font color="#007800">$ share</font> "</font> <br>  <font color="#000000">fi</font> <br>  <font color="#666666"># Add the rest of the UNC path to the real server and resource</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#000000">!</font>  <font color="#660033">-z</font> <font color="#ff0000">" <font color="#007800">$ real_share</font> "</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#007800">smb_path_len</font> = <font color="#ff0000">" <font color="#007800">$ {# smb_path}</font> "</font> <br>  <font color="#007800">rest_of_path</font> = $ <font color="#7a0874">(</font> <font color="#c20cb9">awk</font> <font color="#660033">-v</font> <font color="#007800">len</font> = <font color="#ff0000">" <font color="#007800">$ smb_path_len</font> "</font> <font color="#660033">-v</font> <font color="#007800">awk_string</font> = <font color="#ff0000">" <font color="#007800">$ DFS_PATH</font> "</font> \ <br>  <font color="#ff0000">'BEGIN {print substr (awk_string, len + 1)}'</font> <font color="#7a0874">)</font> <br>  <font color="#007800">real_share</font> = <font color="#ff0000">" <font color="#007800">$ real_share</font> <font color="#007800">$ rest_of_path</font> "</font> <br>  <font color="#000000">fi</font> <br>  <font color="#666666"># We are looking for the first match, so leave the loop</font> <br>  <font color="#7a0874">break</font> <br>  <font color="#000000">fi</font> <br>  <font color="#000000">done</font> <font color="#000000">&lt;&lt;</font> <font color="#7a0874">(</font> rpcclient <font color="#660033">-k</font> <font color="#660033">--command</font> = <font color="#ff0000">"dfsenum 3"</font> <font color="#007800">$ DFS_SERVER</font> <font color="#000000">|</font> <font color="#c20cb9">sed</font> <font color="#ff0000">'s / \\ / \ // g'</font> <font color="#7a0874">)</font> <br><br>  <font color="#666666"># If no value has been assigned to the real_share variable (most likely because</font> <br>  <font color="#666666"># that the original path was not found in the list, or because an error occurred,</font> <br>  <font color="#666666"># return source path</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#660033">-z</font> <font color="#ff0000">" <font color="#007800">$ real_share</font> "</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#007800">real_share</font> = <font color="#007800">$ DFS_PATH</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#666666"># To return the result to AppleScript, we need to display it.</font> <br>  <font color="#666666"># to standard output</font> <br>  <font color="#7a0874">echo</font> <font color="#007800">$ real_share</font> <br><br>  <font color="#7a0874">exit</font> <font color="#007800">$ exit_code</font> <br></blockquote><br><br>  The script, of course, is not perfect, everything can certainly be done better.  I rarely write scripts at all, the Mac OS user doesn‚Äôt usually need them, so I haven‚Äôt got my hand yet.  Technical details are clear from the comments, and in fact he does the following: <br><ul><li>  using the rpcclient program, which is part of the Samba package, we will find out the node table in the DFS root server, linked to real servers.  Here it should be noted that the script assumes authentication through Kerberos, which most likely means that your computer is registered in the domain and you are already logged in with a domain name and password.  Without it, living in an environment of Windows-servers is very tight. </li><li>  next, we parse the resulting table (in the above article, the structure of the rpcclient output is described, so I will not repeat it here).  As we analyze the nodes, we are looking for the one that coincides with the beginning of our original path.  As soon as we find, we stop further searches, compose the real path from the parts and output it with the echo command.  This is the standard way to transfer work from the shell to AppleScript. <br></li></ul><br><br>  In this whole story there is one feature.  The fact is that DFS contains built-in duplication mechanisms that allow you to store mirror copies of data on different servers.  Therefore, a single node can correspond to several real resources on different servers.  It would not have been wise and just take one of them (if you don‚Äôt change anything in the code, the last one will be taken), but I decided to take the choice that Samba would have made, for which in such cases smbclient is run with the only command that returns the to the resource on the server to which you want to connect.  By the way, I suspect that Samba selects nodes at random (the code did not look), but oh well. <br><br>  Now, when we figured out the first script, let's move on to the second one.  It is written so that it can be run both from the command line (using osascript) and interactively.  In fact, there is a third way to start, about it below. <br><br><blockquote>  <font color="#808080">- This script connects the Windows network resource in the Finder via the DFS path to the resource.</font> <br>  <font color="#808080">- The script calls an external bash script to convert the DFS path to the path</font> <br>  <font color="#808080">- to real shared resource</font> <br><br>  <font color="#ff0033">property</font> DFSRootServer: <font color="#009900">"dfs.mycompany"</font> <font color="#808080">- insert the name of the DFS root server here</font> <br>  <font color="#ff0033">property</font> BashScriptPath: <font color="#009900">"/ Users / Shared / Scripts / dfs_to_share"</font> <font color="#808080">- the path to our bash script</font> <br>  <font color="#ff0033">property</font> isRunFromCommandLine: <font color="#0066ff">true</font> <br><br>  <font color="#808080">- This handler is used by ThisService to organize</font> <br>  <font color="#808080">- call the script from the "Services" menu.</font> <br>  <font color="#808080">- We also call it from the "run" method.</font>  <font color="#808080">The source UNC path is passed as an argument.</font> <br>  <font color="#ff0033">on</font> process <font color="#000000">(</font> input <font color="#000000">)</font> <br>  <font color="#ff0033">try</font> <br>  <font color="#ff0033">set</font> realPath <font color="#ff0033">to</font> <font color="#0066ff">do shell script</font> <font color="#009900">"/ bin / bash"</font> <font color="#000000">&amp;</font> BashScriptPath <font color="#000000">&amp;</font> ¬¨ <br>  <font color="#009900">""</font> <font color="#000000">&amp;</font> DFSRootServer <font color="#000000">&amp;</font> <font color="#009900">"'"</font> <font color="#000000">&amp;</font> input <font color="#000000">&amp;</font> <font color="#009900">"'"</font> <br>  <font color="#ff0033">on</font> <font color="#ff0033">error</font> errMessage <font color="#0066ff">number</font> errNumber <br>  <font color="#808080">- Our script returns different error codes in different situations, we process here</font> <br>  <font color="#ff0033">if</font> errNumber <font color="#ff0033">is</font> <font color="#000000">100</font> <font color="#ff0033">then</font> <br>  <font color="#ff0033">set</font> errMessage <font color="#ff0033">to</font> <font color="#009900">"Internal error when executing script."</font> <br>  <font color="#ff0033">else</font> <font color="#ff0033">if</font> errNumber <font color="#ff0033">is</font> <font color="#000000">200</font> <font color="#ff0033">then</font> <br>  <font color="#ff0033">set</font> errMessage <font color="#ff0033">to</font> <font color="#009900">"Unable to get table of DFS nodes from server. ¬¨</font> <font color="#009900"><br></font>  <font color="#009900">Check if you have an active Kerberos ticket. "</font> <br>  <font color="#ff0033">else</font> <font color="#ff0033">if</font> errNumber <font color="#ff0033">is</font> <font color="#000000">300</font> <font color="#ff0033">then</font> <br>  <font color="#ff0033">set</font> errMessage <font color="#ff0033">to</font> <font color="#009900">"Error using smbclient to get the DFS node."</font> <br>  <font color="#ff0033">else</font> <br>  <font color="#ff0033">set</font> errMessage <font color="#ff0033">to</font> <font color="#009900">"Unknown error while executing shell script:"</font> <font color="#000000">&amp;</font> <font color="#000000">(</font> errNumber <font color="#ff0033">as</font> <font color="#0066ff">text</font> <font color="#000000">)</font> <br>  <font color="#ff0033">end</font> <font color="#ff0033">if</font> <br>  <font color="#ff0033">if</font> isRunFromCommandLine <font color="#ff0033">then</font> <br>  <font color="#808080">- In case the application is launched from the command line,</font> <br>  <font color="#808080">- display the message in the console</font> <br>  log errMessage <br>  <font color="#ff0033">else</font> <br>  <font color="#0066ff">display dialog</font> errMessage <font color="#0066ff">buttons</font> <font color="#000000">{</font> <font color="#009900">"Close"</font> <font color="#000000">}</font> <br>  <font color="#ff0033">end</font> <font color="#ff0033">if</font> <br>  <font color="#ff0033">return</font> <br>  <font color="#ff0033">end</font> <font color="#ff0033">try</font> <br>  <font color="#ff0033">try</font> <br>  <font color="#808080">(* The most convenient way to force the Finder to open a directory along a given path is</font> <font color="#808080"><br></font>  <font color="#808080">use the "open location" method.</font>  <font color="#808080">He automatically mounts the device and</font> <font color="#808080"><br></font>  <font color="#808080">Opens the desired directory in the Finder window.</font>  <font color="#808080">But this method requires an input</font> <font color="#808080"><br></font>  <font color="#808080">path in the URL representation, so we use python to convert</font> <font color="#808080"><br></font>  <font color="#808080">UNC paths to URL view *)</font> <br>  <font color="#ff0033">set</font> urlOfPath <font color="#ff0033">to</font> <font color="#009900">"smb:"</font> <font color="#000000">&amp;</font> <font color="#000000">(</font> <font color="#0066ff">do shell script</font> ¬¨ <br>  <font color="#009900">"python -c 'import urllib, sys; print urllib.pathname2url (sys.argv [1])'"</font> <font color="#000000">&amp;</font> ¬¨ <br>  <font color="#0066ff">quoted form</font> <font color="#ff0033">of</font> realPath <font color="#000000">)</font> <br>  <font color="#ff0033">tell</font> <font color="#0066ff">application</font> <font color="#009900">"Finder"</font> <br>  <font color="#0066ff">open</font> location urlOfPath <br>  <font color="#ff0033">end</font> <font color="#ff0033">tell</font> <br>  <font color="#ff0033">on</font> <font color="#ff0033">error</font> errMessage <br>  <font color="#0066ff">display dialog</font> errMessage <font color="#0066ff">buttons</font> <font color="#000000">{</font> CloseButton <font color="#000000">}</font> <br>  <font color="#ff0033">end</font> <font color="#ff0033">try</font> <br>  <font color="#ff0033">end</font> process <br><br>  <font color="#ff0033">on</font> <font color="#0066ff">run</font> argv <br>  <font color="#ff0033">set</font> ConnectButton <font color="#ff0033">to</font> <font color="#009900">"Connect"</font> <br>  <font color="#ff0033">set</font> CancelButton <font color="#ff0033">to</font> <font color="#009900">Cancel</font> <br>  <font color="#808080">- We check if we were started from the command line with passing the path as a parameter</font> <br>  <font color="#ff0033">if</font> <font color="#000000">(</font> <font color="#0066ff">count</font> <font color="#ff0033">of</font> argv <font color="#000000">)</font> <font color="#ff0033">is</font> <font color="#ff0033">equal</font> <font color="#ff0033">to</font> <font color="#000000">0</font> <font color="#ff0033">then</font> <br>  <font color="#0066ff">display dialog</font> <font color="#009900">"Enter UNC path:"</font> <font color="#0066ff">default answer</font> <font color="#009900">""</font> <br>  <font color="#0066ff">buttons</font> <font color="#000000">{</font> ConnectButton, CancelButton <font color="#000000">}</font> default button <font color="#000000">1</font> <br>  <font color="#ff0033">copy</font> <font color="#ff0033">the</font> <font color="#0066ff">result</font> <font color="#ff0033">as</font> <font color="#0066ff">list</font> <font color="#ff0033">to</font> <font color="#000000">{</font> UNC_path, button_pressed <font color="#000000">}</font> <br><br>  <font color="#ff0033">if</font> button_pressed <font color="#ff0033">is</font> ConnectButton <font color="#ff0033">and</font> UNC_path <font color="#ff0033">is</font> <font color="#ff0033">not</font> <font color="#009900">""</font> <font color="#ff0033">then</font> <br>  <font color="#ff0033">set</font> isRunFromCommandLine <font color="#ff0033">to</font> <font color="#0066ff">false</font> <br>  process <font color="#000000">(</font> UNC_path <font color="#000000">)</font> <br>  <font color="#ff0033">end</font> <font color="#ff0033">if</font> <br>  <font color="#ff0033">else</font> <br>  process <font color="#000000">(</font> <font color="#0066ff">item</font> <font color="#000000">1</font> <font color="#ff0033">of</font> argv <font color="#000000">)</font> <br>  <font color="#ff0033">end</font> <font color="#ff0033">if</font> <br>  <font color="#ff0033">end</font> <font color="#0066ff">run</font> <br></blockquote><br><br>  The run method is automatically called after running the script, it displays a single window in which the user is prompted to enter the source path to the desired resource.  The main functionality of the script is enclosed in the "process" method.  It receives the actual path to the server as input, runs the bash script described above, interprets the result and opens the resulting path in the Finder program. <br><br>  At this, the last stage, one problem arises.  The Finder has a handy Connect to Server dialog box.  Unfortunately, this functionality is not available through AppleScript, therefore, having tried several different options, I stopped at the ‚Äúopen location‚Äù method, which is waiting for the URL to enter.  And for this it is necessary to convert the line returned by the first script into a URL representation, replacing some characters with their codes.  Fortunately, Mac OS X comes with a python interpreter with libraries that have a convenient method that does exactly what we need.  We feed the resulting URL to Finder, and it magically opens a window with the directory we need. <br><br>  If you try these scripts, you will notice one feature: if you connect to a resource through the Finder dialog box, the directly shared resource is mounted on the server, and in the Finder you can walk around the entire directory tree in this resource.  As a result of the work of the described script, only the directory referenced by the source path and its subdirectories is available.  Like who, but I like this behavior more: you get what you ask for and nothing more.  We need to go deeper above, we can take part of the path and connect only this part, or select the connected server in the sidebar of the Finder window, and go down the hierarchy from it. <br><br>  Now, about the promised third way to run the script.  In the programs on Cocoa, the Services menu is available (Services), and it would be very convenient if our script could be called from this menu.  Select the path in the text, select an item from this menu (or press the corresponding keys corresponding to this item) and open the path in the Finder.  It turned out that it is easy to do, there is a free program (donationware), which is called <a href="http://wafflesoftware.net/thisservice/">ThisService</a> , which allows you to enable the script in the ‚ÄúServices‚Äù menu.  For this purpose, I divided the script into two methods, since for the work of ThisService it is required that the script have a ‚Äúprocess‚Äù method that accepts a string as input.  After a simple setup, it all worked. <br><br>  There is another handy program that is just as free, called <a href="http://www.cocoabeans.se/apptivate">Apptivate</a> , which allows you to assign system-wide hotkeys to launch any applications, including scripts.  I tied the launch of the script to the key combination, and now I can get my version of the ‚ÄúConnect to server‚Äù window on the screen at any time. <br><br>  By the way, one important observation regarding Snow Leopard.  If you already have a valid Kerberos ticket, and you disconnect all SMB volumes, then the ticket is lost.  This funny behavior leads to the fact that from time to time you suddenly discover that you cannot connect to the network objects, although you did it all five minutes ago.  This is clearly seen if you launch the ‚ÄúView Tickets‚Äù program (this can be done from the ‚ÄúKeychain‚Äù), connect and disconnect volumes, and see what happens to your ticket.  As a result, I decided to always have it at hand, and started a hot key on it in the Apptivate program. <br><br>  In conclusion, I must warn you that everything described was tested only on my computer (Mac OS X Snow Leopard, version 10.6.4) and only within the walls of ABBYY.  Write in the comments about any inaccuracies that you notice, and suggest what can be improved.  And I, and all who are interested, we will only be grateful. </div><p>Source: <a href="https://habr.com/ru/post/102518/">https://habr.com/ru/post/102518/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../102506/index.html">Automatic detection of user's time zone</a></li>
<li><a href="../102511/index.html">Testing Bada Applications with RTL</a></li>
<li><a href="../102512/index.html">Microsoft revealed the details of the new architecture XBox 360 250 GB</a></li>
<li><a href="../102515/index.html">Top 7 gadgets from China</a></li>
<li><a href="../102516/index.html">String Calculator - a simple calculator that counts math expressions with comments.</a></li>
<li><a href="../102520/index.html">Heliotrope - the world's first "solar" house, which produces energy</a></li>
<li><a href="../102521/index.html">JPEG decoding for dummies</a></li>
<li><a href="../102523/index.html">Go language from the point of view of a PHP developer</a></li>
<li><a href="../102525/index.html">Next Startup Weekend</a></li>
<li><a href="../102526/index.html">Swype keyboard updated world typing speed record</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>