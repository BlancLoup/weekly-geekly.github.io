<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Diagnosing problems with the "unstable availability" of the site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I present to you the article, the purpose of which is to determine the sequence of actions in the analysis of unstable loading pages or inaccessibilit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Diagnosing problems with the "unstable availability" of the site</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d1/33c/85e/8d133c85ea61795122f1e4a6ed740f01.jpg"></div><br>  I present to you the article, the purpose of which is to determine the sequence of actions in the analysis of unstable loading pages or inaccessibility of the site for the average user.  In addition, I propose to supplement my scheme with the general mind of the habrasoobshchestva, so I am waiting for your comments under the post, so that together we can form a ‚Äúreminder for the non-sysadmin‚Äù. <br><a name="habracut"></a><br>  So let's get started. <br><img src="https://habrastorage.org/getpro/habr/post_images/e57/84d/ed9/e5784ded90a985bcf4c698aa361f9b99.png" align="left"><br>  First, you need to exclude from the list of possible faults the most obvious and easily diagnosed: the lack of connection to Wi-Fi, problems on the side of the Internet provider, or, for example, the lack of a cable in the socket and the battery in the laptop. <br><br>  I also propose to omit difficult-to-solve problems and malfunctions of the local Internet or the computer itself, which require the direct intervention of a sysadmin.  These may be Trojans, problems with hardware, browser or operating system, MTU on the router, incorrectly configured DNS or DNS failures and a number of problems that can be identified, but the article will turn into a book or even in a training course. <br><br>  Let us dwell on the fact that we have no problems with the Internet and the websites are loading normally, but our site is accessible with interruptions or is not available at all. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/222/a00/0ee/222a000eeb91f50cef04e0a979f927e9.png" align="right"><br><h1>  <font color="#000"><b>How to find the cause?</b></font> </h1><br>  1. The Internet is a huge number of highways leading from the server to the server, and there are cases when our server is working and we see other sites, but here the path of the packets from us to our site is broken: the network has been segmented because of a routing failure or somewhere then there was a failure in the channels of the providers.  Of course, in the console, the <b>traceroute</b> command (tracert on Windows) will show whether the server of our site is accessible, which servers go through the packages and where they stop.  If traceroute and <b>ping</b> do not reach our server, but reach the hosting network, then it‚Äôs time to call the hosting technical support or sysadmins, since in this case it will be difficult to do something on your own. <br><br>  Traceroute and ping are simple commands, there are articles on this topic on Wikipedia with quite an accessible description: <br>  <a href="https://ru.wikipedia.org/wiki/Traceroute">https://ru.wikipedia.org/wiki/Traceroute</a> <br>  <a href="https://ru.wikipedia.org/wiki/Ping">https://ru.wikipedia.org/wiki/Ping</a> <br><br>  If traceroute ‚Äústicks‚Äù somewhere on the main channels on the way to the site, then I recommend you to check how the server / site is visible from other servers (computers) of the global network outside of your provider.  They are very likely to use other trunks and it is often clear that traceroute passes through other channels to your server successfully.  For example, <br>  <a href="http://network-tools.com/default.asp%3Fprog%3Dexpress%26host%3Dwww.reg.ru">http://network-tools.com/default.asp?prog=express&amp;host=www.reg.ru</a> <br><br>  If everything is in order, then the problems are either with your provider or with his providers a level higher, but not near your server and not on it. <br>  Now you can call the technical support of your local provider and ask: "What are the main channels there?";) <br><br>  2. The speed and stability of the Internet channel is the speed and stability of the slowest and worst communication channel on the way from you to the server.  You can determine if there are problems with packet loss ‚Äúon the road‚Äù, large packet delays between different providers or between you and the provider, using the <a href="https://en.wikipedia.org/wiki/MTR_(software)"><b>mtr</b></a> utility, and the results of the utility are especially indicative of a large packet size and its possible segmentation (for example, 1500 bytes) . <br><br>  Mtr is something like combined ping (polling each server along the path of packets) and traceroute (determining the entire path of packets), but keep in mind that due to the constant stream of packets, the utility eats up a lot of traffic. <br><br>  Call example: <br><pre><code class="bash hljs">mtr -s 1500 --report .com</code> </pre> <br><br>  Request verification to the website yahoo.com: <br><pre> <code class="bash hljs">HOST: xxx.reg.ru Loss% Snt Last Avg Best Wrst StDev 1.|-- 31.31.xxx.xxx 0.0% 10 43.4 16.7 0.5 102.8 33.1 2.|-- bdi-799.sr7.msk1.ip.di<span class="hljs-_"><span class="hljs-_">-ne</span></span> 0.0% 10 1.5 1.5 1.5 1.7 0.1 3.|-- vlan-793.br1.msk1.ip.di-n 0.0% 10 0.8 0.8 0.8 0.9 0.0 4.|-- 31.28.19.100 0.0% 10 0.9 4.5 0.9 36.8 11.3 5.|-- ae0-948-rt2.spb.cloud-ix. 90.0% 10 14.7 14.7 14.7 14.7 0.0 6.|-- ae0-59-rt1.frk.cloud-ix.n 10.0% 10 37.7 37.8 37.7 38.3 0.2 ... 15.|-- po-15.bas2-7-prd.gq1.yaho 10.0% 10 204.7 207.0 204.5 211.1 2.8 16.|-- ir1.fp.vip.gq1.yahoo.com 10.0% 10 204.7 227.4 204.7 281.4 32.1</code> </pre><br><br>  Indicative for us will be the value of the percentage of packet loss (Loss%) of our final list server.  Losses on intermediate servers, if they do not affect the final server, are most likely due to the limitation of the number of test packets to them (ICMP traffic). <br><br>  Usually, if there is a 30-50% loss of large packets, the connection problems are already becoming noticeable (the page sticks, slows down due to underloaded elements), and the higher the percentage, the harder it is to break through. <br><img src="https://habrastorage.org/getpro/habr/post_images/3f8/eab/190/3f8eab190b03ecff921d554a9ecd42f2.jpg" align="left"><br>  Problems can be born on some intermediate node, for example, on the next main Wi-Fi link from your office to the provider (if any).  In addition, problems can be caused by communication and packet routing between providers. <br><br>  A detailed article on how to use mtr to diagnose problems with the channel (in English) can be found <a href="https://library.linode.com/linux-tools/mtr">here</a> or on <a href="https://en.wikipedia.org/wiki/MTR_(software)">Wikipedia</a> . <br>  Something similar to the mtr utility in Windows NT is <a href="https://ru.wikipedia.org/wiki/Pathping">pathping</a> . <br><br>  Sometimes the provider (or our server) can be completely disabled or limited to pass these test packets (ICMP traffic).  In this case, such tests will not help identify the problem.  Here, of course, it is fit to remember about ‚Äúeverybody is angry with Buratino himself‚Äù - if you disable the ability to check the server, then you will not be able to check it :-). <br><br>  3. If the above tests do not reveal any problems, then we use the main visual and convenient tool - <b>Chrome Developer Tools</b> (Web Inspector in Safari, Firefox Develper Tools): <br>  <a href="https://developers.google.com/chrome-developer-tools/">https://developers.google.com/chrome-developer-tools/</a> <br>  <a href="https://developer.apple.com/library/safari/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Introduction/Introduction.html">https://developer.apple.com/library/safari/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Introduction/Introduction.html</a> <br>  <a href="https://developer.mozilla.org/en-US/docs/Tools/Network_Monitor">https://developer.mozilla.org/en-US/docs/Tools/Network_Monitor</a> <br><br>  When working with Chrome Developer Tools (Menu -&gt; Tools -&gt; Developer Tools), in the Network tab, we update the page of our website and get a report on how all the resources are loaded on it: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b2/fdb/db6/3b2fdbdb6ca0da80e3c1775f7f3affa1.png"></div><br><br>  Upon successful loading (albeit slow), the page of the site will be visible: when the main content of the page is loaded and it begins to be formed for display, when all nested java-scripts tied to work with page elements and waiting for the full load of the main code and the necessary undefined additional nested elements.  This moment in the picture above: the blue vertical line is the DOMContentLoaded event, and the red vertical line is the activation of the windows.onLoad event (when the scripts have already worked and the whole page with elements has been formed, the contents of the images are loaded). <br><br>  Using this information tool, we can check whether everything is in order with loading the main content of the page and the main html-code, that is, to make sure that our server is completely ‚Äúlive‚Äù and the main engine of the site does not slow down. <br>  This is the first item on the list.  By clicking on it, we get a more detailed server response time: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e2/b84/d7e/3e2b84d7ead9c30f46f89f20c7264570.png"></div><br><br>  As we see here, our browser waited for data from the server for 68 milliseconds (the server formed the page on the request received from us) and 2 milliseconds it was received (which was fast enough). <br><br>  Already from this information, it is sometimes possible to see that the problem consists in slow loading of the site - this, for example, is not a millisecond, but a 30-second formation of the main code of the page.  This happens when the server or provider is overloaded with requests, inefficient code is used (the request on this page works for a long time) or there are some other reasons that the sysadmins and the programmer of the engine can analyze. <br><br>  Below in the list of download graphs you will see which resources on the page load longer, which page resources the browser waits before displaying the page, and what blocks its display. <br><img src="https://habrastorage.org/getpro/habr/post_images/663/b7c/fae/663b7cfaecd6597d2b093e948a124bb7.png" align="right"><br>  A common cause of blocking is the dependence of the start time of work on changing / forming the page content (before linking to the DOMContentLoaded event) of scripts from any external statistics collection services, advertising engines or link exchange pages.  Usually these are pieces of a script for inserting "one more" external script: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.write(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'&lt;scr'</span></span></span><span class="javascript">+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'ipt type="text/javascript"'</span></span></span><span class="javascript">+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' src="http://jsc.dt00.net .... </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  These systems are located on foreign servers and are often inaccessible to our sysadmins, so they can behave as they please, for example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/df3/f62/4a3df3f62550dcb3752919c985b19075.png"></div><br><br>  That is, until it loads and executes the &lt;script ...&gt; block, which in turn refers to an external resource, the browser will expect results from it, often not displaying the content of the page or displaying it incorrectly, although modern browser engines can work ahead of the curve. <br><br>  Here and in the screenshot above, the work of the scripts on the page started with a delay of 135 ms due to the download of the ad script from admobi.ru (admobi.js).  There are cases when the distribution server code advertising and statistics is available, but responds slowly, and the browser, successfully connected with it, can wait a response for tens of seconds. <br><br>  4. As with traceroute (p. 1), information on loading the page through the Developer Tools (p. 3) can and should be checked ‚Äúby someone else‚Äôs view of your server‚Äù using similar external analyzer services, for example: <br>  <a href="http://www.uptrends.com/aspx/free-html-site-page-load-check-tool.aspx">http://www.uptrends.com/aspx/free-html-site-page-load-check-tool.aspx</a> <br><br>  What it looks like: <br><div style="text-align:center;"><img src="//habrastorage.org/files/714/a04/951/714a049513514c1bac37291537d9b216.png"></div><br><br><div style="text-align:center;"><img src="//habrastorage.org/files/bc9/b61/3ca/bc9b613ca66b4473856773f9bde6e1e9.png"></div><br><br>  and <a href="http://tools.pingdom.com/fpt/">http://tools.pingdom.com/fpt/</a> <br><br>  Pay attention to the final table of the first service with temporary totals.  And at the beginning of the second table, with the ranking of "how your site is accessible by speed, in comparison with other network sites", as well as the number of requests (elements), volume and download time of all information on the page. <br><br><div style="text-align:center;"><img src="//habrastorage.org/files/ea4/c3c/198/ea4c3c198a574736aa0aa100c48a717a.png"></div><br><br>  Such reports and comparisons with download timelines in your browser will show the places where the loading of the site through your provider differs from the loading in these two services and where the longest delay occurs.  Even, for example, in HTTPS Handshake, there can be tangible lags when checking certificates from you to the server of the certificate provider. <br><br>  Another ‚Äúfeature‚Äù of these two services is the ability to select the server from which the test request will be conducted, that is, simulate how your page is loaded from a server in Berlin, New York or Moscow. <br><br>  5. Strange and not frequent "sticking". <br>  Sometimes with unpredictable periodicity, ‚Äústicking‚Äù of page loads occurs.  For example, once a day.  The first time - after a long break or even by accident.  Such cases are harder to catch. <br>  I propose to single out and supplement with a general mind possible options for such problems: <br><ul><li>  The problem with the work of plug-ins, which in modern browsers are now tons: <br><ul><li>  Unplug everything and compare; </li><li>  Or vice versa, enable (look for!) Adblock and ghostery plugins. </li></ul><br></li><li>  The first contact with the server after the break. <br>  Initiation of a secure ssl session for the browser usually takes place more slowly due to the initial key exchange and verification of certificates.  This happens just when entering the site after a break or clearing caches / keys. <br></li><li>  Lags with obtaining certificates or keys when loading other (external) scripts and page elements that can block the display: statistics collectors, ad networks, banner exchanges. </li><li>  All the named elements from the previous paragraph, if the connection with our server is good, but with the server giving this embedded element - it is bad or it is overloaded. <br>  As mentioned in one of the points above, until the script is reloaded, the page render can ‚Äústick‚Äù, OnDom / OnLoad is processed with a delay.  It often happens that when viewing other pages this item is already cached and everything is in order.  Here you can try to exclude requests for these external servers (again, we see the brakes in Developer Tools) by adding to the local computer for a time in the hosts file in turn: <br><ul><li>  server-collection-statistics.ru 127.0.0.1; </li><li>  advertising server.com 127.0.0.1; </li><li>  and other servers, the scripts of which are called on the page. </li></ul><br>  It must be remembered that if we redirect requests instead of some servers on the Internet inside our network "directly to our laptop" (to localhost, 127.0.0.1), then we can get a second delay, as in the example above, where we have port not responding by timeout. <br></li><li>  If a page is delivered not by one, but several servers in turn at load distribution, it happens that we after some number of times get on some kind of ‚Äútight‚Äù server, and then again on fast ones. <br>  Here you can check whether there is a separate server name from those to which the load is distributed, and work directly. </li><li>  Problem with statics return servers, if it is issued by another server.  Here, often, subsequent downloads are in order, since all the static goes with a noticeable margin of obsolescence (expired), here and then it has slowed down once, then the pages load normally.  Developer Tools will help you see this clearly with the options to clear or turn off the cache. </li><li>  If the ‚Äúbrakes‚Äù are observed when editing the pages of your site, you can exclude elements and blocks of external advertising and statistics from the page in turn and, by updating, determine what the problem is. </li></ul><img src="//habrastorage.org/files/e32/747/1ab/e327471ab2f94f16a28d7a416b1dd767.jpg" align="left"><br><br><br><br><br>  Of course, there are a lot of possible problems, and in order to form a complete list, you need to brainstorm.  For example, at one time there were lags of fresh technologies in browsers and their beta versions on the svg renderer or glitches with new protocols, such as SPDY.  But this is just an example of which way you can think further, and here intuition, the experience of your sysadmin and, most importantly, the size and quality of his tambourine are already important. </div><p>Source: <a href="https://habr.com/ru/post/218161/">https://habr.com/ru/post/218161/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218139/index.html">Ale, Dispatch: AdvertOne vs Google Tag Manager</a></li>
<li><a href="../218143/index.html">Investigation of information security in Yandex. Rdomn - hidden threat</a></li>
<li><a href="../218147/index.html">Node.js vs Ruby on Rails</a></li>
<li><a href="../218149/index.html">Building RESTful Message Based Web Services on WCF</a></li>
<li><a href="../218153/index.html">Interview with the speaker Loc Kit 2014</a></li>
<li><a href="../218169/index.html">Windows XP discontinued today</a></li>
<li><a href="../218171/index.html">Why in Russia there are almost no civil / commercial high-tech production?</a></li>
<li><a href="../218173/index.html">"Flexible" office with service racks and mini columns from Schneider-electric</a></li>
<li><a href="../218177/index.html">The system of interbank electronic payments in Ukraine. How it works</a></li>
<li><a href="../218179/index.html">JetBrains EdTech Hackathon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>