<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>50 shades of Go: traps, pitfalls and common mistakes beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Go is a simple and fun language. But in it, as well as in any other languages, there are reefs. And in many of them Go itself is not to blame. Some ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>50 shades of Go: traps, pitfalls and common mistakes beginners</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/64f/bc1/8a3/64fbc18a37fa4dd884eeb8200dd5c8dd.jpg"><br><br>  Go is a simple and fun language.  But in it, as well as in any other languages, there are reefs.  And in many of them Go itself is not to blame.  Some are a natural consequence of the arrival of programmers from other languages, others arise from misconceptions and lack of details.  If you find time and read the official specifications, wikis, mailing lists, blog posts and source code, many of the pitfalls will become obvious to you.  But not everybody starts like that, and that's fine.  If you are new to Go, the article will help you save a lot of hours that you would spend on debugging code.  We will consider versions of Go 1.5 and below. <br><a name="habracut"></a><br><h1>  Content </h1><br>  Level: absolute beginner <br><br>  1. <a href="https://habr.com/ru/company/mailru/blog/314804/">The opening brace cannot be placed on a separate line.</a> <br>  2. <a href="https://habr.com/ru/company/mailru/blog/314804/">Unused variables</a> <br>  3. <a href="https://habr.com/ru/company/mailru/blog/314804/">Unused imports</a> <br>  4. <a href="https://habr.com/ru/company/mailru/blog/314804/">Short variable declarations can only be used inside functions.</a> <br>  5. <a href="https://habr.com/ru/company/mailru/blog/314804/">Redeclaration of Variables with Short Declarations</a> <br>  6. <a href="https://habr.com/ru/company/mailru/blog/314804/">You cannot use short variable declarations to set field values.</a> <br>  7. <a href="https://habr.com/ru/company/mailru/blog/314804/">Random variable hiding</a> <br>  8. <a href="https://habr.com/ru/company/mailru/blog/314804/">You cannot use nil to initialize a variable without explicitly specifying the type.</a> <br>  9. <a href="https://habr.com/ru/company/mailru/blog/314804/">Using nil slices (slice) and hash tables (map)</a> <br>  10. <a href="https://habr.com/ru/company/mailru/blog/314804/">Capacity of hash tables</a> <br>  11. <a href="https://habr.com/ru/company/mailru/blog/314804/">Strings cannot be nil</a> <br>  12. <a href="https://habr.com/ru/company/mailru/blog/314804/">Passing arrays to functions</a> <br>  13. <a href="https://habr.com/ru/company/mailru/blog/314804/">Unexpected values ‚Äã‚Äãin range expressions in slices and arrays</a> <br>  14. <a href="https://habr.com/ru/company/mailru/blog/314804/">One-dimensionality of slices and arrays</a> <br>  15. <a href="https://habr.com/ru/company/mailru/blog/314804/">Accessing non-existent keys in the map</a> <br>  16. The <a href="https://habr.com/ru/company/mailru/blog/314804/">immutability of the lines</a> <br>  17. <a href="https://habr.com/ru/company/mailru/blog/314804/">String conversion to byte slices (Byte Slices), and vice versa</a> <br>  18. <a href="https://habr.com/ru/company/mailru/blog/314804/">Strings and operator index</a> <br>  19. <a href="https://habr.com/ru/company/mailru/blog/314804/">Strings - not always text encoded in UTF-8</a> <br>  20. <a href="https://habr.com/ru/company/mailru/blog/314804/">Line length</a> <br>  21. <a href="https://habr.com/ru/company/mailru/blog/314804/">Missing comma in multiline slice / array / map literals</a> <br>  22. <a href="https://habr.com/ru/company/mailru/blog/314804/">log.Fatal and log.Panic not only log</a> <br>  23. <a href="https://habr.com/ru/company/mailru/blog/314804/">Unsynchronized operations of embedded data structures</a> <br>  24. <a href="https://habr.com/ru/company/mailru/blog/314804/">Iterative values ‚Äã‚Äãfor rows in range expressions</a> <br>  25. <a href="https://habr.com/ru/company/mailru/blog/314804/">Iteration of hash tables (map) using the expression for range</a> <br>  26. <a href="https://habr.com/ru/company/mailru/blog/314804/">Failure behavior in switch expressions</a> <br>  27. <a href="https://habr.com/ru/company/mailru/blog/314804/">Increments and decrements</a> <br>  28. <a href="https://habr.com/ru/company/mailru/blog/314804/">Bitwise NOT-operator</a> <br>  29. <a href="https://habr.com/ru/company/mailru/blog/314804/">Differences in operator priorities</a> <br>  30. <a href="https://habr.com/ru/company/mailru/blog/314804/">Unexported structure fields are not encoded.</a> <br>  31. <a href="https://habr.com/ru/company/mailru/blog/314804/">Exit applications using active gorutin</a> <br>  32. <a href="https://habr.com/ru/company/mailru/blog/314804/">When sent to an unbuffered channel, data is returned as the recipient is ready.</a> <br>  33. <a href="https://habr.com/ru/company/mailru/blog/314804/">Sending to a closed channel leads to panic</a> <br>  34. <a href="https://habr.com/ru/company/mailru/blog/314804/">Using "nil" channels</a> <br>  35. <a href="https://habr.com/ru/company/mailru/blog/314804/">Methods that take parameters by value do not change the original values.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Level: more experienced beginner <br><br>  36. <a href="https://habr.com/ru/company/mailru/blog/314804/">Closing HTTP response body</a> <br>  37. <a href="https://habr.com/ru/company/mailru/blog/314804/">Close HTTP connections</a> <br>  38. <a href="https://habr.com/ru/company/mailru/blog/314804/">Deserialization (unmarshalling) JSON numbers into interface values</a> <br>  39. <a href="https://habr.com/ru/company/mailru/blog/314804/">Comparison of struct, array, slice and map</a> <br>  40. <a href="https://habr.com/ru/company/mailru/blog/314804/">Recovery after panic</a> <br>  41. <a href="https://habr.com/ru/company/mailru/blog/314804/">Updating and binding field values ‚Äã‚Äãin slice, array and map in expressions for range</a> <br>  42. <a href="https://habr.com/ru/company/mailru/blog/314804/">"Hidden data" in slices</a> <br>  43. <a href="https://habr.com/ru/company/mailru/blog/314804/">"Damage" data in slices</a> <br>  44. <a href="https://habr.com/ru/company/mailru/blog/314804/">"Outdated" slices</a> <br>  45. <a href="https://habr.com/ru/company/mailru/blog/314804/">Methods and type declarations.</a> <br>  46. <a href="https://habr.com/ru/company/mailru/blog/314804/">How to get out of the code blocks for switch and for select</a> <br>  47. <a href="https://habr.com/ru/company/mailru/blog/314804/">Iterative variables and closures in for expressions</a> <br>  48. <a href="https://habr.com/ru/company/mailru/blog/314804/">Calculate the argument block defer (Deferred Function Call Argument Evaluation)</a> <br>  49. <a href="https://habr.com/ru/company/mailru/blog/314804/">Call block defer</a> <br>  50. <a href="https://habr.com/ru/company/mailru/blog/314804/">Errors in casting</a> <br>  51. <a href="https://habr.com/ru/company/mailru/blog/314804/">Blocked gorutiny and resource leaks</a> <br><br>  Level: advanced beginner <br><br>  52. <a href="https://habr.com/ru/company/mailru/blog/314804/">Applying methods that take value by reference (pointer receiver) to value instances</a> <br>  53. <a href="https://habr.com/ru/company/mailru/blog/314804/">Updating value fields in a hash table</a> <br>  54. <a href="https://habr.com/ru/company/mailru/blog/314804/">nil interfaces and nil interface values</a> <br>  55. <a href="https://habr.com/ru/company/mailru/blog/314804/">Stack and heap variables</a> <br>  56. <a href="https://habr.com/ru/company/mailru/blog/314804/">GOMAXPROCS, consistency (concurrency) and concurrency</a> <br>  57. <a href="https://habr.com/ru/company/mailru/blog/314804/">Changing the order of read and write operations.</a> <br>  58. <a href="https://habr.com/ru/company/mailru/blog/314804/">Preemptive Scheduling</a> <br><br><a name="1"></a><h1>  1. The opening brace cannot be placed on a separate line. </h1><br>  In most other languages ‚Äã‚Äãthat use curly braces, you need to choose where to place them.  Go out of the rule.  For this, you can thank the automatic insertion of a semicolon (semicolon is assumed at the end of each line, without analyzing the next one).  Yes, there is a semicolon in Go! <br><br>  Wrong: <br><br><pre><code class="go">package main

import "fmt"

func main()  
{ // ,        
    fmt.Println("hello there!")
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox826898458/main.go:6: syntax error: unexpected semicolon or newline before {
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    fmt.Println("works!")
}
</code></pre><br>
<a name="2"></a><h1>2.  </h1><br>
     ,    . : ,    .      .      .<br>
<br>
      ,        .   - ,   .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

var gvar int // not an error

func main() {  
    var one int   // ,  
    two := 2      // ,  
    var three int // ,      3   
    three = 3

    func(unused string) {
        fmt.Println("Unused arg. No compile error")
    }("what?")
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox473116179/main.go:6: one declared and not used /tmp/sandbox473116179/main.go:7: two declared and not used /tmp/sandbox473116179/main.go:8: three declared and not used
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    var one int
    _ = one

    two := 2
    fmt.Println(two)

    var three int
    three = 3
    one = three

    var four int
    four = four
}
</code></pre><br>
 :     .<br>
<br>
<a name="3"></a><h1>3.  </h1><br>
        -   , ,   ,    .    ,  ¬´_¬ª        .  ¬´_¬ª      -  .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "log"
    "time"
)

func main() {  
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox627475386/main.go:4: imported and not used: "fmt" /tmp/sandbox627475386/main.go:5: imported and not used: "log" /tmp/sandbox627475386/main.go:6: imported and not used: "time"
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import (  
    _ "fmt"
    "log"
    "time"
)

var _ = log.Println

func main() {  
    _ = time.Now
}
</code></pre><br>
 :     .     <a href="http://godoc.org/golang.org/x/tools/cmd/goimports">goimports</a>.<br>
<br>
<a name="4"></a><h1>4.        </h1><br>
:<br>
<br>
<pre><code class="go">package main

myvar := 1 // 

func main() {  
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox265716165/main.go:3: non-declaration statement outside function body
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

var myvar = 1

func main() {  
}
</code></pre><br>
<a name="5"></a><h1>5.      </h1><br>
       ,         (multi-variable declarations),      ‚Äî .        ,     (shadowed variable).<br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    one := 0
    one := 1 // 
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox706333626/main.go:5: no new variables on left side of :=
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    one := 0
    one, two := 1,2

    one,two = two,one
}
</code></pre><br>
<a name="6"></a><h1>6.         </h1><br>
:<br>
<br>
<pre><code class="go">package main

import (  
  "fmt"
)

type info struct {  
  result int
}

func work() (int,error) {  
    return 13,nil  
  }

func main() {  
  var data info

  data.result, err := work() // 
  fmt.Printf("info: %+v\n",data)
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">prog.go:18: non-name data.result on left side of :=
</code></pre><br>
  Go    ,     :     ¬´ ¬ª.    .           .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import (  
  "fmt"
)

type info struct {  
  result int
}

func work() (int,error) {  
    return 13,nil  
  }

func main() {  
  var data info

  var err error
  data.result, err = work() // ok
  if err != nil {
    fmt.Println(err)
    return
  }

  fmt.Printf("info: %+v\n",data) // : info: {result:13}
}
</code></pre><br>
<a name="7"></a><h1>7.   </h1><br>
      (  ,    Go   ),        .         ,     ,     .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := 1
    fmt.Println(x)     //  1
    {
        fmt.Println(x) //  1
        x := 2
        fmt.Println(x) //  2
    }
    fmt.Println(x)     //  1 (,    2)
}
</code></pre><br>
       Go-.      .        vet.         .    <code>-shadow: go tool vet -shadow your_file.go</code><br>
<br>
<a name="8"></a><h1>8.   nil       </h1><br>
 <code>nil</code>    ¬´ ¬ª (zero value)  , , , - (map),  (slices)  .     ,      ,      .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    var x = nil // 

    _ = x
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox188239583/main.go:4: use of untyped nil
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    var x interface{} = nil

    _ = x
}
</code></pre><br>
<a name="9"></a><h1>9.  nil- (slice)  - (map)</h1><br>
    <code>nil</code>-,        -,     runtime panic.<br>
<br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    var s []int
    s = append(s,1)
}
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    var m map[string]int
    m["one"] = 1 // 

}
</code></pre><br>
<a name="10"></a><h1>10.  -</h1><br>
     -,       <code>cap()</code>.<br>
<br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    m := make(map[string]int,99)
    cap(m) // 
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox326543983/main.go:5: invalid argument m (type map[string]int) for cap
</code></pre><br>
<a name="11"></a><h1>11.     nil</h1><br>
    ,     <code>nil</code>-.<br>
<br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    var x string = nil // 

    if x == nil { // 
        x = "default"
    }
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox630560459/main.go:4: cannot use nil as type string in assignment /tmp/sandbox630560459/main.go:6: invalid operation: x == nil (mismatched types string and nil)
</code></pre><br>
:<br>
<br>
package main<br>
<br>
<pre><code class="go">func main() {  
    var x string //     "" ( )

    if x == "" {
        x = "default"
    }
}
</code></pre><br>
<a name="12"></a><h1>12.    </h1><br>
    /++,     ‚Äî .     ,             .  Go   ,  ,     ,     .    ,       .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := [3]int{1,2,3}

    func(arr [3]int) {
        arr[0] = 7
        fmt.Println(arr) //  [7 2 3]
    }(x)

    fmt.Println(x) //  [1 2 3] (,     [7 2 3])
}
</code></pre><br>
      ,    .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := [3]int{1,2,3}

    func(arr *[3]int) {
        (*arr)[0] = 7
        fmt.Println(arr) //  &amp;[7 2 3]
    }(&amp;x)

    fmt.Println(x) //  [7 2 3]
}
</code></pre><br>
 : .       ,        .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := []int{1,2,3}

    func(arr []int) {
        arr[0] = 7
        fmt.Println(arr) //  [7 2 3]
    }(x)

    fmt.Println(x) //  [7 2 3]
}
</code></pre><br>
<a name="13"></a><h1>13.     range    </h1><br>
  ,      <code>for-in</code>  <code>foreach</code>   .   Go  <code>range</code>  ,     :  ‚Äî    (item index),   ‚Äî   (item data).<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := []string{"a","b","c"}

    for v := range x {
        fmt.Println(v) //  0, 1, 2
    }
}
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := []string{"a","b","c"}

    for _, v := range x {
        fmt.Println(v) //  a, b, c
    }
}
</code></pre><br>
<a name="14"></a><h1>14.    </h1><br>
,  Go     ? ,   .          .       ‚Äî      ,          .<br>
<br>
         ,   ¬´¬ª ,      ¬´   ¬ª.<br>
<br>
     ,        ,     .<br>
<br>
         ¬´¬ª     .     ,        .       .     ,   .<br>
<br>
<pre><code class="go">package main

func main() {  
    x := 2
    y := 4

    table := make([][]int,x)
    for i:= range table {
        table[i] = make([]int,y)
    }
}
</code></pre><br>
         ¬´   ¬ª    .    ,   ¬´¬ª ,     (raw data).  ‚Äî  .        ,     .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    h, w := 2, 4

    raw := make([]int,h*w)
    for i := range raw {
        raw[i] = i
    }
    fmt.Println(raw,&amp;raw[4])
    // : [0 1 2 3 4 5 6 7] &lt;ptr_addr_x&gt;

    table := make([][]int,h)
    for i:= range table {
        table[i] = raw[i*w:i*w + w]
    }

    fmt.Println(table,&amp;table[1][0])
    // : [[0 1 2 3] [4 5 6 7]] &lt;ptr_addr_x&gt;
}
</code></pre><br>
       ,  ,   ,     .<br>
<br>
<a name="15"></a><h1>15.      map</h1><br>
   ,         <code>nil</code>- (     ).    <code>nil</code>,  ¬´ ¬ª     ‚Äî <code>nil</code>.        . ,     - (map record),       ¬´ ¬ª.      (,    ,       ,  ¬´ ¬ª ‚Äî false).    ,   , ‚Äî   ,     .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := map[string]string{"one":"a","two":"","three":"c"}

    if v := x["two"]; v == "" { // 
        fmt.Println("no entry")
    }
}
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := map[string]string{"one":"a","two":"","three":"c"}

    if _,ok := x["two"]; !ok {
        fmt.Println("no entry")
    }
}
</code></pre><br>
<a name="16"></a><h1>16.  </h1><br>
           ,    .  ‚Äî  - (byte slices),    .   -   ,    -       .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := "text"
    x[0] = 'T'

    fmt.Println(x)
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox305565531/main.go:7: cannot assign to x[0]
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := "text"
    xbytes := []byte(x)
    xbytes[0] = 'T'

    fmt.Println(string(xbytes)) //  Text
}
</code></pre><br>
 ,         ,        .          ¬´¬ª (rune).      ¬´¬ª        ,      (grave accent).      ¬´¬ª   ,   Go      .<br>
<br>
<a name="17"></a><h1>17.    - (Byte Slices),  </h1><br>
     - ( ),      .     (cast operation),    ,    (reslicing),           ,   -.<br>
<br>
 Go       <code>[]byte</code>  <code>string</code>   <code>string</code>  <code>[]byte</code>,      (     todo).<br>
<br>
      ,   <code>[]byte</code>       <code>map[string]: m[string(key)]</code>.<br>
<br>
        <code>for range</code>,     <code>[]byte: for i,v := range []byte(str) {...}</code>.<br>
<br>
<a name="18"></a><h1>18.    </h1><br>
 ,   <b></b>,    (byte value),    (   ).<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    x := "text"
    fmt.Println(x[0]) //  116
    fmt.Printf("%T",x[0]) //  uint8
}
</code></pre><br>
     ¬´¬ª ( / Unicode),    <code>for range</code>.       unicode/utf8   utf8string (golang.org/x/exp/utf8string). utf8string      <code>At()</code>.    <b></b>    (slice of runes).<br>
<br>
<a name="19"></a><h1>19.  ‚Äî      UTF-8</h1><br>
           UTF-8.     .  ,       UTF-8, ‚Äî      .           .<br>
<br>
   ,   <code>ValidString()</code>   unicode/utf8.<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "unicode/utf8"
)

func main() {  
    data1 := "ABC"
    fmt.Println(utf8.ValidString(data1)) // : true

    data2 := "A\xfeC"
    fmt.Println(utf8.ValidString(data2)) // : false
}
</code></pre><br>
<a name="20"></a><h1>20.  </h1><br>
,    Python      :<br>
<br>
<pre><code class="python">data = u'‚ô•'  
print(len(data)) # : 1  
</code></pre><br>
       Go,     .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    data := "‚ô•"
    fmt.Println(len(data)) // : 3
}
</code></pre><br>
  <code>len()</code>   ,   ,     Unicode-  Python.<br>
<br>
      Go,   <code>RuneCountInString()</code>   unicode/utf8.<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "unicode/utf8"
)

func main() {  
    data := "‚ô•"
    fmt.Println(utf8.RuneCountInString(data)) // : 1
</code></pre><br>
  <code>RuneCountInString()</code>    ,        .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "unicode/utf8"
)

func main() {  
    data := "eÃÅ"
    fmt.Println(len(data))                    // : 3
    fmt.Println(utf8.RuneCountInString(data)) // : 2
}
</code></pre><br>
<a name="21"></a><h1>21.      slice/array/map</h1><br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    x := []int{
    1,
    2 // error
    }
    _ = x
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox367520156/main.go:6: syntax error: need trailing comma before newline in composite literal /tmp/sandbox367520156/main.go:8: non-declaration statement outside function body /tmp/sandbox367520156/main.go:9: syntax error: unexpected }
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

func main() {  
    x := []int{
    1,
    2,
    }
    x = x

    y := []int{3,4,} //  
    y = y
}
</code></pre><br>
    ,         .<br>
<br>
<a name="22"></a><h1>22. log.Fatal  log.Panic   </h1><br>
        .     ,    Go  .     <code>Fatal*()</code>  <code>Panic*()</code>,    .<br>
<br>
<pre><code class="go">package main

import "log"

func main() {  
    log.Fatalln("Fatal Level: log entry") //     
    log.Println("Normal Level: log entry")
}
</code></pre><br>
<a name="23"></a><h1>23.     </h1><br>
  Go    (concurrency),         (concurrency safe).       .         ,      sync,      .<br>
<br>
<a name="24"></a><h1>24.       range</h1><br>
  ( ,   <code>range</code>) ‚Äî      ¬´¬ª ( / Unicode),    .     ¬´¬ª,    .  ,        .       ,     norm (golang.org/x/text/unicode/norm).<br>
<br>
 <code>for range</code>           UTF-8.     -  ,    0xfffd (  Unicode),    .        ( UTF-8),       -.<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    data := "A\xfe\x02\xff\x04"
    for _,v := range data {
        fmt.Printf("%#x ",v)
    }
    // : 0x41 0xfffd 0x2 0xfffd 0x4 ()

    fmt.Println()
    for _,v := range []byte(data) {
        fmt.Printf("%#x ",v)
    }
    // : 0x41 0xfe 0x2 0xff 0x4 ()
}
</code></pre><br>
<a name="25"></a><h1>25.  - (map)    for range</h1><br>
     ,  ,        (,    ).   -    .   (runtime) Go    ,   ,      ,        (, ) .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    m := map[string]int{"one":1,"two":2,"three":3,"four":4}
    for k,v := range m {
        fmt.Println(k,v)
    }
}
</code></pre><br>
    Go Playground (https://play.golang.org/),      ,     ,     .<br>
<br>
<a name="26"></a><h1>26.     switch</h1><br>
 <code>case</code>   <code>switch</code>    (break).       :  (fall through)    <code>case</code>.<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    isSpace := func(ch byte) bool {
        switch(ch) {
        case ' ': // 
        case '\t':
            return true
        }
        return false
    }

    fmt.Println(isSpace('\t')) //  true ()
    fmt.Println(isSpace(' '))  //  false ()
}
</code></pre><br>
   case      <code>fallthrough</code>    .      <code>switch</code>,      .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    isSpace := func(ch byte) bool {
        switch(ch) {
        case ' ', '\t':
            return true
        }
        return false
    }

    fmt.Println(isSpace('\t')) //  true ()
    fmt.Println(isSpace(' '))  //  true ()
}
</code></pre><br>
<a name="27"></a><h1>27.   </h1><br>
       .   Go     .         .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    data := []int{1,2,3}
    i := 0
    ++i // error
    fmt.Println(data[i++]) // 
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox101231828/main.go:8: syntax error: unexpected ++ /tmp/sandbox101231828/main.go:9: syntax error: unexpected ++, expecting :
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    data := []int{1,2,3}
    i := 0
    i++
    fmt.Println(data[i])
}
</code></pre><br>
<a name="28"></a><h1>28.  NOT-</h1><br>
    ~     NOT- (aka  , bitwise complement),   Go    XOR- (^).<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    fmt.Println(~2) // 
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox965529189/main.go:6: the bitwise complement operator is ^
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    var d uint8 = 2
    fmt.Printf("%08b\n",^d)
}
</code></pre><br>
-  ,  ^  Go ‚Äî  XOR-.  ,   NOT- (, <code>NOT 0x02</code>)    XOR- (, <code>0x02 XOR 0xff</code>).  ,  ^     NOT-.<br>
<br>
  Go     AND NOT (&amp;^),      NOT. AND NOT    /   <code>A AND (NOT B)</code>     .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    var a uint8 = 0x82
    var b uint8 = 0x02
    fmt.Printf("%08b [A]\n",a)
    fmt.Printf("%08b [B]\n",b)

    fmt.Printf("%08b (NOT B)\n",^b)
    fmt.Printf("%08b ^ %08b = %08b [B XOR 0xff]\n",b,0xff,b ^ 0xff)

    fmt.Printf("%08b ^ %08b = %08b [A XOR B]\n",a,b,a ^ b)
    fmt.Printf("%08b &amp; %08b = %08b [A AND B]\n",a,b,a &amp; b)
    fmt.Printf("%08b &amp;^%08b = %08b [A 'AND NOT' B]\n",a,b,a &amp;^ b)
    fmt.Printf("%08b&amp;(^%08b)= %08b [A AND (NOT B)]\n",a,b,a &amp; (^b))
}
</code></pre><br>
<a name="29"></a><h1>29.   </h1><br>
 ¬´ ¬ª (bit clear)  (&amp;^),  Go    ,    .          .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    fmt.Printf("0x2 &amp; 0x2 + 0x4 -&gt; %#x\n",0x2 &amp; 0x2 + 0x4)
    //prints: 0x2 &amp; 0x2 + 0x4 -&gt; 0x6
    //Go:    (0x2 &amp; 0x2) + 0x4
    //C++:    0x2 &amp; (0x2 + 0x4) -&gt; 0x2

    fmt.Printf("0x2 + 0x2 &lt;&lt; 0x1 -&gt; %#x\n",0x2 + 0x2 &lt;&lt; 0x1)
    //prints: 0x2 + 0x2 &lt;&lt; 0x1 -&gt; 0x6
    //Go:     0x2 + (0x2 &lt;&lt; 0x1)
    //C++:   (0x2 + 0x2) &lt;&lt; 0x1 -&gt; 0x8

    fmt.Printf("0xf | 0x2 ^ 0x2 -&gt; %#x\n",0xf | 0x2 ^ 0x2)
    //prints: 0xf | 0x2 ^ 0x2 -&gt; 0xd
    //Go:    (0xf | 0x2) ^ 0x2
    //C++:    0xf | (0x2 ^ 0x2) -&gt; 0xf
}
</code></pre><br>
<a name="30"></a><h1>30.     </h1><br>
  (struct fields),    ,    (JSON, XML, GON  . .),             .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "encoding/json"
)

type MyData struct {  
    One int
    two string
}

func main() {  
    in := MyData{1,"two"}
    fmt.Printf("%#v\n",in) //  main.MyData{One:1, two:"two"}

    encoded,_ := json.Marshal(in)
    fmt.Println(string(encoded)) //  {"One":1}

    var out MyData
    json.Unmarshal(encoded,&amp;out)

    fmt.Printf("%#v\n",out) //  main.MyData{One:1, two:""}
}
</code></pre><br>
<a name="31"></a><h1>31.       </h1><br>
      .     .  -  ‚Äî      .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

func main() {  
    workerCount := 2

    for i := 0; i &lt; workerCount; i++ {
        go doit(i)
    }
    time.Sleep(1 * time.Second)
    fmt.Println("all done!")
}

func doit(workerId int) {  
    fmt.Printf("[%v] is running\n",workerId)
    time.Sleep(3 * time.Second)
    fmt.Printf("[%v] is done\n",workerId)
}
</code></pre><br>
 :<br>
<br>
<pre><code class="go">[0] is running 
[1] is running 
all done!
</code></pre><br>
     ‚Äî  <code>WaitGroup</code>.          .            ,    -    ,   .       <code>kill</code>.   ,      :     .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "sync"
)

func main() {  
    var wg sync.WaitGroup
    done := make(chan struct{})
    workerCount := 2

    for i := 0; i &lt; workerCount; i++ {
        wg.Add(1)
        go doit(i,done,wg)
    }

    close(done)
    wg.Wait()
    fmt.Println("all done!")
}

func doit(workerId int,done &lt;-chan struct{},wg sync.WaitGroup) {  
    fmt.Printf("[%v] is running\n",workerId)
    defer wg.Done()
    &lt;- done
    fmt.Printf("[%v] is done\n",workerId)
}
</code></pre><br>
   ,  :<br>
<br>
<pre><code class="go">[0] is running 
[0] is done 
[1] is running 
[1] is done
</code></pre><br>
,        . !     :<br>
<br>
<pre><code class="bash">fatal error: all goroutines are asleep - deadlock!
</code></pre><br>
!  ?   ?      <code>wg.Done()</code>.   .<br>
<br>
 ,         <code>WaitGroup</code>.      <code>wg.Done()</code>,       <code>WaitGroup</code>   .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "sync"
)

func main() {  
    var wg sync.WaitGroup
    done := make(chan struct{})
    wq := make(chan interface{})
    workerCount := 2

    for i := 0; i &lt; workerCount; i++ {
        wg.Add(1)
        go doit(i,wq,done,&amp;wg)
    }

    for i := 0; i &lt; workerCount; i++ {
        wq &lt;- i
    }

    close(done)
    wg.Wait()
    fmt.Println("all done!")
}

func doit(workerId int, wq &lt;-chan interface{},done &lt;-chan struct{},wg *sync.WaitGroup) {  
    fmt.Printf("[%v] is running\n",workerId)
    defer wg.Done()
    for {
        select {
        case m := &lt;- wq:
            fmt.Printf("[%v] m =&gt; %v\n",workerId,m)
        case &lt;- done:
            fmt.Printf("[%v] is done\n",workerId)
            return
        }
    }
}
</code></pre><br>
   .<br>
<br>
<a name="32"></a><h1>32.           </h1><br>
   ,     .    ,    ,           ,     .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    ch := make(chan string)

    go func() {
        for m := range ch {
            fmt.Println("processed:",m)
        }
    }()

    ch &lt;- "cmd.1"
    ch &lt;- "cmd.2" //   
}
</code></pre><br>
<a name="33"></a><h1>33.       panic</h1><br>
    .   <code>ok</code>    (receive statement)  <code>false</code>,    ,      .      ,     ,    ,  <code>ok</code>  <code>false</code>.<br>
<br>
       panic.   ,       ,   ,         .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

func main() {  
    ch := make(chan int)
    for i := 0; i &lt; 3; i++ {
        go func(idx int) {
            ch &lt;- (idx + 1) * 2
        }(i)
    }

    // get the first result
    fmt.Println(&lt;-ch)
    close(ch) // (      )
    // do other work
    time.Sleep(2 * time.Second)
}
</code></pre><br>
    .       ‚Äî  ,  .    ,         .<br>
<br>
    ,      (special cancellation channel)   ,      .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

func main() {  
    ch := make(chan int)
    done := make(chan struct{})
    for i := 0; i &lt; 3; i++ {
        go func(idx int) {
            select {
            case ch &lt;- (idx + 1) * 2: fmt.Println(idx,"sent result")
            case &lt;- done: fmt.Println(idx,"exiting")
            }
        }(i)
    }

    // get first result
    fmt.Println("result:",&lt;-ch)
    close(done)
    // do other work
    time.Sleep(3 * time.Second)
}
</code></pre><br>
<a name="34"></a><h1>34.  ¬´nil¬ª-</h1><br>
  <code>nil</code>      .    ,       .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

func main() {  
    var ch chan int
    for i := 0; i &lt; 3; i++ {
        go func(idx int) {
            ch &lt;- (idx + 1) * 2
        }(i)
    }

    // get first result
    fmt.Println("result:",&lt;-ch)
    // do other work
    time.Sleep(2 * time.Second)
}
</code></pre><br>
       runtime  <code>fatal error: all goroutines are asleep - deadlock!</code><br>
<br>
          <code>case</code>   <code>select</code>.<br>
<br>
<pre><code class="go">package main

import "fmt"  
import "time"

func main() {  
    inch := make(chan int)
    outch := make(chan int)

    go func() {
        var in &lt;- chan int = inch
        var out chan &lt;- int
        var val int
        for {
            select {
            case out &lt;- val:
                out = nil
                in = inch
            case val = &lt;- in:
                out = outch
                in = nil
            }
        }
    }()

    go func() {
        for r := range outch {
            fmt.Println("result:",r)
        }
    }()

    time.Sleep(0)
    inch &lt;- 1
    inch &lt;- 2
    time.Sleep(3 * time.Second)
}
</code></pre><br>
<a name="35"></a><h1>35. ,    ,    </h1><br>
  ‚Äî     .    ,  /     (receiver argument).         ,   ‚Äî  - (map)              ‚Äî  .<br>
<br>
<pre><code class="go">package main

import "fmt"

type data struct {  
    num int
    key *string
    items map[string]bool
}

func (this *data) pmethod() {  
    this.num = 7
}

func (this data) vmethod() {  
    this.num = 8
    *this.key = "v.key"
    this.items["vmethod"] = true
}

func main() {  
    key := "key.1"
    d := data{1,&amp;key,make(map[string]bool)}

    fmt.Printf("num=%v key=%v items=%v\n",d.num,*d.key,d.items)
    // prints num=1 key=key.1 items=map[]

    d.pmethod()
    fmt.Printf("num=%v key=%v items=%v\n",d.num,*d.key,d.items)
    // prints num=7 key=key.1 items=map[]

    d.vmethod()
    fmt.Printf("num=%v key=%v items=%v\n",d.num,*d.key,d.items)
    // prints num=7 key=v.key items=map[vmethod:true]
}
</code></pre><br>
<a name="36"></a><h1>36.   HTTP-</h1><br>
     HTTP-,    HTTP-.       ,     .  :      .     ,  .<br>
<br>
     ,    .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "net/http"
    "io/ioutil"
)

func main() {  
    resp, err := http.Get("https://api.ipify.org?format=json")
    defer resp.Body.Close()// 
    if err != nil {
        fmt.Println(err)
        return
    }

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println(err)
        return
    }

    fmt.Println(string(body))
}
</code></pre><br>
      HTTP-,      <code>resp</code>   <code>nil</code>,    runtime panic.<br>
<br>
      ‚Äî    <code>defer</code>    HTTP-.<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "net/http"
    "io/ioutil"
)

func main() {  
    resp, err := http.Get("https://api.ipify.org?format=json")
    if err != nil {
        fmt.Println(err)
        return
    }

    defer resp.Body.Close()// ,    :-)
    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println(err)
        return
    }

    fmt.Println(string(body))
}
</code></pre><br>
  ,    HTTP-,  <code>resp</code>  <code>nil</code>,   <code>err ‚Äî non-nil</code>.        <code>non-nil</code>.    .<br>
<br>
  ,       <code>non-nil</code>     HTTP-.  :    <code>defer</code>          .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "net/http"
    "io/ioutil"
)

func main() {  
    resp, err := http.Get("https://api.ipify.org?format=json")
    if resp != nil {
        defer resp.Body.Close()
    }

    if err != nil {
        fmt.Println(err)
        return
    }

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println(err)
        return
    }

    fmt.Println(string(body))
}
</code></pre><br>
  <code>resp.Body.Close()</code>        .   HTTP-       ,    <code>keep alive</code>.    HTTP- .          .    ,  HTTP-      . ,        Go 1.5.<br>
<br>
       HTTP-,          -  :<br>
<br>
<pre><code class="go">_, err = io.Copy(ioutil.Discard, resp.Body)
</code></pre><br>
  ,        ,     JSON API    :<br>
<br>
<pre><code class="go">json.NewDecoder(resp.Body).Decode(&amp;data)
</code></pre><br>
<a name="37"></a><h1>37.  HTTP-</h1><br>
 HTTP- -      (  HTTP 1.1    <code>keep alive</code>).    HTTP-  ,       HTTP-.           /  .<br>
<br>
        ,   <code>true</code>   <code>Close</code>  .<br>
<br>
 :    <code>Connection</code>     <code>close</code>.  HTTP-     <code>Connection: close</code>.    ,   .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "net/http"
    "io/ioutil"
)

func main() {  
    req, err := http.NewRequest("GET","http://golang.org",nil)
    if err != nil {
        fmt.Println(err)
        return
    }

    req.Close = true
    //or do this:
    //req.Header.Add("Connection", "close")

    resp, err := http.DefaultClient.Do(req)
    if resp != nil {
        defer resp.Body.Close()
    }

    if err != nil {
        fmt.Println(err)
        return
    }

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println(err)
        return
    }

    fmt.Println(len(string(body)))
}
</code></pre><br>
      HTTP-.      HTTP-.<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "net/http"
    "io/ioutil"
)

func main() {  
    tr := &amp;http.Transport{DisableKeepAlives: true}
    client := &amp;http.Client{Transport: tr}

    resp, err := client.Get("http://golang.org")
    if resp != nil {
        defer resp.Body.Close()
    }

    if err != nil {
        fmt.Println(err)
        return
    }

    fmt.Println(resp.StatusCode)

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        fmt.Println(err)
        return
    }

    fmt.Println(len(string(body)))
}
</code></pre><br>
       ,       .        -     ,        .        .   ‚Äî    .<br>
<br>
<a name="38"></a><h1>38.  (unmarshalling) JSON-   </h1><br>
  / JSON-  , Go        JSON    <code>float64</code>. ,     panic:<br>
<br>
<pre><code class="go">package main

import (  
  "encoding/json"
  "fmt"
)

func main() {  
  var data = []byte(`{"status": 200}`)

  var result map[string]interface{}
  if err := json.Unmarshal(data, &amp;result); err != nil {
    fmt.Println("error:", err)
    return
  }

  var status = result["status"].(int) // 
  fmt.Println("status value:",status)
}
</code></pre><br>
Runtime Panic:<br>
<br>
<code>panic: interface conversion: interface is float64, not int</code> <br>
<br>
 JSON-,    , ,   .<br>
<br>
<ul>
<li>       :-)</li>
<li>       ,   .<br>
<br>
<pre><code class="go">package main

import (  
  "encoding/json"
  "fmt"
)

func main() {  
  var data = []byte(`{"status": 200}`)

  var result map[string]interface{}
  if err := json.Unmarshal(data, &amp;result); err != nil {
    fmt.Println("error:", err)
    return
  }

  var status = uint64(result["status"].(float64)) // 
  fmt.Println("status value:",status)
}
</code></pre><br>
</li>
<li>  <code>Decoder</code>   JSON   JSON-     <code>Number</code>.<br>
<br>
<pre><code class="go">package main

import (  
  "encoding/json"
  "bytes"
  "fmt"
)

func main() {  
  var data = []byte(`{"status": 200}`)

  var result map[string]interface{}
  var decoder = json.NewDecoder(bytes.NewReader(data))
  decoder.UseNumber()

  if err := decoder.Decode(&amp;result); err != nil {
    fmt.Println("error:", err)
    return
  }

  var status,_ = result["status"].(json.Number).Int64() // 
  fmt.Println("status value:",status)
}
</code></pre><br>
      <code>Number</code>,       :<br>
<br>
<pre><code class="go">package main

import (  
  "encoding/json"
  "bytes"
  "fmt"
)

func main() {  
  var data = []byte(`{"status": 200}`)

  var result map[string]interface{}
  var decoder = json.NewDecoder(bytes.NewReader(data))
  decoder.UseNumber()

  if err := decoder.Decode(&amp;result); err != nil {
    fmt.Println("error:", err)
    return
  }

  var status uint64
  if err := json.Unmarshal([]byte(result["status"].(json.Number).String()), &amp;status); err != nil {
    fmt.Println("error:", err)
    return
  }

  fmt.Println("status value:",status)
}
</code></pre><br>
</li>
<li>  <code>struct</code>,   (maps)       .<br>
<br>
<pre><code class="go">package main

import (  
  "encoding/json"
  "bytes"
  "fmt"
)

func main() {  
  var data = []byte(`{"status": 200}`)

  var result struct {
    Status uint64 `json:"status"`
  }

  if err := json.NewDecoder(bytes.NewReader(data)).Decode(&amp;result); err != nil {
    fmt.Println("error:", err)
    return
  }

  fmt.Printf("result =&gt; %+v",result)
  //prints: result =&gt; {Status:200}
}
</code></pre><br>
</li>
<li> <code>struct</code>       <code>json.RawMessage</code>,     .<br>
<br>
 ,       JSON- (conditional field)        .<br>
<br>
<pre><code class="go">package main

import (  
  "encoding/json"
  "bytes"
  "fmt"
)

func main() {  
  records := [][]byte{
    []byte(`{"status": 200, "tag":"one"}`),
    []byte(`{"status":"ok", "tag":"two"}`),
  }

  for idx, record := range records {
    var result struct {
      StatusCode uint64
      StatusName string
      Status json.RawMessage `json:"status"`
      Tag string             `json:"tag"`
    }

    if err := json.NewDecoder(bytes.NewReader(record)).Decode(&amp;result); err != nil {
      fmt.Println("error:", err)
      return
    }

    var sstatus string
    if err := json.Unmarshal(result.Status, &amp;sstatus); err == nil {
      result.StatusName = sstatus
    }

    var nstatus uint64
    if err := json.Unmarshal(result.Status, &amp;nstatus); err == nil {
      result.StatusCode = nstatus
    }

    fmt.Printf("[%v] result =&gt; %+v\n",idx,result)
  }
}
</code></pre><br>
</li>
</ul><br>
<a name="39"></a><h1>39.  struct, array, slice  map</h1><br>
    <code>==</code>    ,          .<br>
<br>
<pre><code class="go">package main

import "fmt"

type data struct {  
    num int
    fp float32
    complex complex64
    str string
    char rune
    yes bool
    events &lt;-chan string
    handler interface{}
    ref *byte
    raw [10]byte
}

func main() {  
    v1 := data{}
    v2 := data{}
    fmt.Println("v1 == v2:",v1 == v2) // : v1 == v2: true
}
</code></pre><br>
     ,        .  ,      ,    .<br>
<br>
<pre><code class="go">package main

import "fmt"

type data struct {  
    num int                // ok
    checks [10]func() bool // 
    doit func() bool       // 
    m map[string] string   // 
    bytes []byte           // 
}

func main() {  
    v1 := data{}
    v2 := data{}
    fmt.Println("v1 == v2:",v1 == v2)
}
</code></pre><br>
Go       ,       .<br>
<br>
  :   <code>DeepEqual()</code>   reflect.<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "reflect"
)

type data struct {  
    num int                // ok
    checks [10]func() bool // 
    doit func() bool       // 
    m map[string] string   // 
    bytes []byte           // 
}

func main() {  
    v1 := data{}
    v2 := data{}
    fmt.Println("v1 == v2:",reflect.DeepEqual(v1,v2)) // prints: v1 == v2: true

    m1 := map[string]string{"one": "a","two": "b"}
    m2 := map[string]string{"two": "b", "one": "a"}
    fmt.Println("m1 == m2:",reflect.DeepEqual(m1, m2)) // prints: m1 == m2: true

    s1 := []int{1, 2, 3}
    s2 := []int{1, 2, 3}
    fmt.Println("s1 == s2:",reflect.DeepEqual(s1, s2)) // prints: s1 == s2: true
}
</code></pre><br>
   (      ), <code>DeepEqual()</code>     .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "reflect"
)

func main() {  
    var b1 []byte = nil
    b2 := []byte{}
    fmt.Println("b1 == b2:",reflect.DeepEqual(b1, b2)) // prints: b1 == b2: false
}
</code></pre><br>
<code>DeepEqual()</code>      <code>nil</code>-.     ,       <code>bytes.Equal()</code>:    <code>nil</code>   .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "bytes"
)

func main() {  
    var b1 []byte = nil
    b2 := []byte{}
    fmt.Println("b1 == b2:",bytes.Equal(b1, b2)) // prints: b1 == b2: true
}
</code></pre><br>
<code>DeepEqual()</code>      .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "reflect"
    "encoding/json"
)

func main() {  
    var str string = "one"
    var in interface{} = "one"
    fmt.Println("str == in:",str == in,reflect.DeepEqual(str, in))
    //prints: str == in: true true

    v1 := []string{"one","two"}
    v2 := []interface{}{"one","two"}
    fmt.Println("v1 == v2:",reflect.DeepEqual(v1, v2))
    //prints: v1 == v2: false (not ok)

    data := map[string]interface{}{
        "code": 200,
        "value": []string{"one","two"},
    }
    encoded, _ := json.Marshal(data)
    var decoded map[string]interface{}
    json.Unmarshal(encoded, &amp;decoded)
    fmt.Println("data == decoded:",reflect.DeepEqual(data, decoded))
    //prints: data == decoded: false (not ok)
}
</code></pre><br>
  - ( )   , ,       ,    <code>ToUpper()</code>  <code>ToLower()</code>   bytes  strings (    <code>==</code>, <code>bytes.Equal()</code>  <code>bytes.Compare()</code>).     ,      .     <code>strings.EqualFold()</code>  <code>bytes.EqualFold()</code>.<br>
<br>
  -    ( ,   . .),       ,   <code>reflect.DeepEqual()</code>, <code>bytes.Equal()</code>  <code>bytes.Compare()</code>.         .      ,     crypto/subtle (, <code>subtle.ConstantTimeCompare()</code>).<br>
<br>
<a name="40"></a><h1>40.   panic</h1><br>
 <code>recover()</code>    / panic.  ,       defer.<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    recover() //   
    panic("not good")
    recover() //    :)
    fmt.Println("ok")
}
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    defer func() {
        fmt.Println("recovered:",recover())
    }()

    panic("not good")
}
</code></pre><br>
 <code>recover()</code> ,       defer.<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func doRecover() {  
    fmt.Println("recovered =&gt;",recover()) // prints: recovered =&gt; &lt;nil&gt;
}

func main() {  
    defer func() {
        doRecover() //  panic  
    }()

    panic("not good")
}
</code></pre><br>
<a name="41"></a><h1>41.       slice, array  map   for range</h1><br>
   <code>range</code>   ‚Äî     ,      .  ,      .  ,    ,        .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    data := []int{1,2,3}
    for _,v := range data {
        v *= 10 //   
    }

    fmt.Println("data:",data) // : [1 2 3]
}
</code></pre><br>
        ,        .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    data := []int{1,2,3}
    for i,_ := range data {
        data[i] *= 10
    }

    fmt.Println("data:",data) // : [10 20 30]
}
</code></pre><br>
    ,    .       ,       .     ,    ,       <code>for range</code>.<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    data := []*struct{num int} {{1},{2},{3}}

    for _,v := range data {
        v.num *= 10
    }

    fmt.Println(data[0],data[1],data[2]) // prints &amp;{10} &amp;{20} &amp;{30}
}
</code></pre><br>
<a name="42"></a><h1>42. ¬´ ¬ª  </h1><br>
         .    .      ,             ,       .<br>
<br>
<pre><code class="go">package main

import "fmt"

func get() []byte {  
    raw := make([]byte,10000)
    fmt.Println(len(raw),cap(raw),&amp;raw[0]) // : 10000 10000 &lt;byte_addr_x&gt;
    return raw[:3]
}

func main() {  
    data := get()
    fmt.Println(len(data),cap(data),&amp;data[0]) // : 3 10000 &lt;byte_addr_x&gt;
}
</code></pre><br>
   , ,        ( ).<br>
<br>
<pre><code class="go">package main

import "fmt"

func get() []byte {  
    raw := make([]byte,10000)
    fmt.Println(len(raw),cap(raw),&amp;raw[0]) // : 10000 10000 &lt;byte_addr_x&gt;
    res := make([]byte,3)
    copy(res,raw[:3])
    return res
}

func main() {  
    data := get()
    fmt.Println(len(data),cap(data),&amp;data[0]) // : 3 3 &lt;byte_addr_y&gt;
}
</code></pre><br>
<a name="43"></a><h1>43. ¬´¬ª   </h1><br>
,     (  ).     ,   ,    ,       .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "bytes"
)

func main() {  
    path := []byte("AAAA/BBBBBBBBB")
    sepIndex := bytes.IndexByte(path,'/')
    dir1 := path[:sepIndex]
    dir2 := path[sepIndex+1:]
    fmt.Println("dir1 =&gt;",string(dir1)) // : dir1 =&gt; AAAA
    fmt.Println("dir2 =&gt;",string(dir2)) // : dir2 =&gt; BBBBBBBBB

    dir1 = append(dir1,"suffix"...)
    path = bytes.Join([][]byte{dir1,dir2},[]byte{'/'})

    fmt.Println("dir1 =&gt;",string(dir1)) // : dir1 =&gt; AAAAsuffix
    fmt.Println("dir2 =&gt;",string(dir2)) // : dir2 =&gt; uffixBBBB (not ok)

    fmt.Println("new path =&gt;",string(path))
}
</code></pre><br>
  .  AAAAsuffix/BBBBBBBBB   AAAAsuffix/uffixBBBB.   ,                .      .       .<br>
<br>
  ,          .  :     (full slice expression).<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "bytes"
)

func main() {  
    path := []byte("AAAA/BBBBBBBBB")
    sepIndex := bytes.IndexByte(path,'/')
    dir1 := path[:sepIndex:sepIndex] //   
    dir2 := path[sepIndex+1:]
    fmt.Println("dir1 =&gt;",string(dir1)) // : dir1 =&gt; AAAA
    fmt.Println("dir2 =&gt;",string(dir2)) // : dir2 =&gt; BBBBBBBBB

    dir1 = append(dir1,"suffix"...)
    path = bytes.Join([][]byte{dir1,dir2},[]byte{'/'})

    fmt.Println("dir1 =&gt;",string(dir1)) // : dir1 =&gt; AAAAsuffix
    fmt.Println("dir2 =&gt;",string(dir2)) // : dir2 =&gt; BBBBBBBBB (ok now)

    fmt.Println("new path =&gt;",string(path))
}
</code></pre><br>
        .                  .<br>
<br>
<a name="44"></a><h1>44. ¬´¬ª </h1><br>
         . ,        .       ,   ¬´¬ª .<br>
<br>
 -              ,          .     (  )   .<br>
<br>
<pre><code class="go">import "fmt"

func main() {  
    s1 := []int{1,2,3}
    fmt.Println(len(s1),cap(s1),s1) //  3 3 [1 2 3]

    s2 := s1[1:]
    fmt.Println(len(s2),cap(s2),s2) //  2 2 [2 3]

    for i := range s2 { s2[i] += 20 }

    //       
    fmt.Println(s1) //  [1 22 23]
    fmt.Println(s2) //  [22 23]

    s2 = append(s2,4)

    for i := range s2 { s2[i] += 10 }

    //s1 is now "stale"
    fmt.Println(s1) //  [1 22 23]
    fmt.Println(s2) //  [32 33 14]
}
</code></pre><br>
<a name="45"></a><h1>45.    </h1><br>
        ( ),          ,    .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "sync"

type myMutex sync.Mutex

func main() {  
    var mtx myMutex
    mtx.Lock() // 
    mtx.Unlock() // 
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox106401185/main.go:9: mtx.Lock undefined (type myMutex has no field or method Lock) /tmp/sandbox106401185/main.go:10: mtx.Unlock undefined (type myMutex has no field or method Unlock)
</code></pre><br>
      ,      ,      .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "sync"

type myLocker struct {  
    sync.Mutex
}

func main() {  
    var lock myLocker
    lock.Lock() // ok
    lock.Unlock() // ok
}
</code></pre><br>
       .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "sync"

type myLocker sync.Locker

func main() {  
    var lock myLocker = new(sync.Mutex)
    lock.Lock() // ok
    lock.Unlock() // ok
}
</code></pre><br>
<a name="46"></a><h1>46.      for switch  for select</h1><br>
<ul>
<li>:  </li>
</ul><br>
 <code>break</code>   (label)       <code>switch/select</code>.    <code>return</code> ‚Äî  ,    ‚Äî     .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    loop:
        for {
            switch {
            case true:
                fmt.Println("breaking out...")
                break loop
            }
        }

    fmt.Println("out!")
}
</code></pre><br>
      <code>goto</code>‚Ä¶<br>
<br>
<a name="47"></a><h1>47.       for</h1><br>
    Go.     <code>for</code>     .  ,    (aka  ),     <code>for</code>,       (       ,     ).<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

func main() {  
    data := []string{"one","two","three"}

    for _,v := range data {
        go func() {
            fmt.Println(v)
        }()
    }

    time.Sleep(3 * time.Second)
    //  : three, three, three
}
</code></pre><br>
  (   ):            <code>for</code>.<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

func main() {  
    data := []string{"one","two","three"}

    for _,v := range data {
        vcopy := v //
        go func() {
            fmt.Println(vcopy)
        }()
    }

    time.Sleep(3 * time.Second)
    //  : one, two, three
}
</code></pre><br>
 :         .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

func main() {  
    data := []string{"one","two","three"}

    for _,v := range data {
        go func(in string) {
            fmt.Println(in)
        }(v)
    }

    time.Sleep(3 * time.Second)
    //  : one, two, three
}
</code></pre><br>
     .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

type field struct {  
    name string
}

func (p *field) print() {  
    fmt.Println(p.name)
}

func main() {  
    data := []field{{"one"},{"two"},{"three"}}

    for _,v := range data {
        go v.print()
    }

    time.Sleep(3 * time.Second)
    //  : three, three, three
}
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

type field struct {  
    name string
}

func (p *field) print() {  
    fmt.Println(p.name)
}

func main() {  
    data := []field{{"one"},{"two"},{"three"}}

    for _,v := range data {
        v := v
        go v.print()
    }

    time.Sleep(3 * time.Second)
    //  : one, two, three
}
</code></pre><br>
  ,    ( ),   ?<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "time"
)

type field struct {  
    name string
}

func (p *field) print() {  
    fmt.Println(p.name)
}

func main() {  
    data := []*field{{"one"},{"two"},{"three"}}

    for _,v := range data {
        go v.print()
    }

    time.Sleep(3 * time.Second)
}
</code></pre><br>
<a name="48"></a><h1>48.    defer (Deferred Function Call Argument Evaluation)</h1><br>
       ,    <code>defer</code> (       ).<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    var i int = 1

    defer fmt.Println("result =&gt;",func() int { return i * 2 }())
    i++
    //: result =&gt; 2 (not ok if you expected 4)
}
</code></pre><br>
<a name="49"></a><h1>49.   defer</h1><br>
       ,        .   ,           .    ,        <code>for</code>,        (<code>defer</code>)   .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "os"
    "path/filepath"
)

func main() {  
    if len(os.Args) != 2 {
        os.Exit(-1)
    }

    start, err := os.Stat(os.Args[1])
    if err != nil || !start.IsDir(){
        os.Exit(-1)
    }

    var targets []string
    filepath.Walk(os.Args[1], func(fpath string, fi os.FileInfo, err error) error {
        if err != nil {
            return err
        }

        if !fi.Mode().IsRegular() {
            return nil
        }

        targets = append(targets,fpath)
        return nil
    })

    for _,target := range targets {
        f, err := os.Open(target)
        if err != nil {
            fmt.Println("bad target:",target,"error:",err) // : too many open files
            break
        }
        defer f.Close() //       
        //  -  ...
    }
}
</code></pre><br>
     ‚Äî     .<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "os"
    "path/filepath"
)

func main() {  
    if len(os.Args) != 2 {
        os.Exit(-1)
    }

    start, err := os.Stat(os.Args[1])
    if err != nil || !start.IsDir(){
        os.Exit(-1)
    }

    var targets []string
    filepath.Walk(os.Args[1], func(fpath string, fi os.FileInfo, err error) error {
        if err != nil {
            return err
        }

        if !fi.Mode().IsRegular() {
            return nil
        }

        targets = append(targets,fpath)
        return nil
    })

    for _,target := range targets {
        func() {
            f, err := os.Open(target)
            if err != nil {
                fmt.Println("bad target:",target,"error:",err)
                return
            }
            defer f.Close() // ok
            //  -  ...
        }()
    }
}
</code></pre><br>
 :    <code>defer</code> :-)<br>
<br>
<a name="50"></a><h1>50.    </h1><br>
    ¬´ ¬ª   ,    .    ,      .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    var data interface{} = "great"

    if data, ok := data.(int); ok {
        fmt.Println("[is an int] value =&gt;",data)
    } else {
        fmt.Println("[not an int] value =&gt;",data)
        //: [not an int] value =&gt; 0 (not "great")
    }
}
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    var data interface{} = "great"

    if res, ok := data.(int); ok {
        fmt.Println("[is an int] value =&gt;",res)
    } else {
        fmt.Println("[not an int] value =&gt;",data)
        // : [not an int] value =&gt; great (as expected)
    }
}
</code></pre><br>
<a name="51"></a><h1>51.     </h1><br>
  ¬´Go Concurrency Patterns¬ª   Google I/O  2012-       concurrency-.    ‚Äî   .<br>
<br>
<pre><code class="go">func First(query string, replicas ...Search) Result {  
    c := make(chan Result)
    searchReplica := func(i int) { c &lt;- replicas[i](query) }
    for i := range replicas {
        go searchReplica(i)
    }
    return &lt;-c
}
</code></pre><br>
   (replica)     .          .     .<br>
<br>
      ?     ?<br>
<br>
  <code>First()</code>    .  ,     .        . ,        (replica),       .<br>
<br>
  ,     (exit).    :      ,    .<br>
<br>
<pre><code class="go">func First(query string, replicas ...Search) Result {  
    c := make(chan Result,len(replicas))
    searchReplica := func(i int) { c &lt;- replicas[i](query) }
    for i := range replicas {
        go searchReplica(i)
    }
    return &lt;-c
}
</code></pre><br>
 :   <code>select</code>   (case) <code>default</code>      .  <code>default</code>   ,    ,        .<br>
<br>
<pre><code class="go">func First(query string, replicas ...Search) Result {  
    c := make(chan Result,1)
    searchReplica := func(i int) {
        select {
        case c &lt;- replicas[i](query):
        default:
        }
    }
    for i := range replicas {
        go searchReplica(i)
    }
    return &lt;-c
}
</code></pre><br>
      (special cancellation channel)    .<br>
<br>
<pre><code class="go">func First(query string, replicas ...Search) Result {  
    c := make(chan Result)
    done := make(chan struct{})
    defer close(done)
    searchReplica := func(i int) {
        select {
        case c &lt;- replicas[i](query):
        case &lt;- done:
        }
    }
    for i := range replicas {
        go searchReplica(i)
    }

    return &lt;-c
}
</code></pre><br>
     ?        (slides)  .    ,       ,   ,     .<br>
<br>
<a name="52"></a><h1>52.  ,     (pointer receiver),   </h1><br>
   (addressable),     ,    .  ,         ,    .<br>
<br>
    .  - (map) . ,     ,  .<br>
<br>
<pre><code class="go">package main

import "fmt"

type data struct {  
    name string
}

func (p *data) print() {  
    fmt.Println("name:",p.name)
}

type printer interface {  
    print()
}

func main() {  
    d1 := data{"one"}
    d1.print() //ok

    var in printer = data{"two"} // 
    in.print()

    m := map[string]data {"x":data{"three"}}
    m["x"].print() //
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox017696142/main.go:21: cannot use data literal (type data) as type printer in assignment: data does not implement printer (print method has pointer receiver)
/tmp/sandbox017696142/main.go:25: cannot call pointer method on m["x"] /tmp/sandbox017696142/main.go:25: cannot take the address of m["x"]
</code></pre><br>
<a name="53"></a><h1>53.     -</h1><br>
    ,   ,        .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

type data struct {  
    name string
}

func main() {  
    m := map[string]data {"x":{"one"}}
    m["x"].name = "two" // error
}
</code></pre><br>
 :<br>
<br>
<pre><code class="bash">/tmp/sandbox380452744/main.go:9: cannot assign to m["x"].name
</code></pre><br>
  ,      .<br>
<br>
    ,    ‚Äî .<br>
<br>
<pre><code class="go">package main

import "fmt"

type data struct {  
    name string
}

func main() {  
    s := []data {{"one"}}
    s[0].name = "two" // ok
    fmt.Println(s)    // prints: [{two}]
}
</code></pre><br>
 ,  -     (gccgo)      .     :-)  ,      Go 1.3.         ,         todo.<br>
<br>
  :   .<br>
<br>
<pre><code class="go">package main
import "fmt"

type data struct {  
    name string
}

func main() {  
    m := map[string]data {"x":{"one"}}
    r := m["x"]
    r.name = "two"
    m["x"] = r
    fmt.Printf("%v",m) //: map[x:{two}]
}
</code></pre><br>
  :  -  .<br>
<br>
<pre><code class="go">package main

import "fmt"

type data struct {  
    name string
}

func main() {  
    m := map[string]*data {"x":{"one"}}
    m["x"].name = "two" //ok
    fmt.Println(m["x"]) //: &amp;{two}
}
</code></pre><br>
,  ,    ?<br>
<br>
<pre><code class="go">package main

type data struct {  
    name string
}

func main() {  
    m := map[string]*data {"x":{"one"}}
    m["z"].name = "what?" //???
}
</code></pre><br>
<a name="54"></a><h1>54. nil-  nil- </h1><br>
     Go.  ‚Äî  ,     .    <code>nil</code>  ,        <code>nil</code>.<br>
<br>
           ,      .    ,    <code>nil</code>,       .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    var data *byte
    var in interface{}

    fmt.Println(data,data == nil) // : &lt;nil&gt; true
    fmt.Println(in,in == nil)     // : &lt;nil&gt; true

    in = data
    fmt.Println(in,in == nil)     // : &lt;nil&gt; false
    //'data'  'nil',  'in' ‚Äî  'nil'
}
</code></pre><br>
  ,     ,  .<br>
<br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    doit := func(arg int) interface{} {
        var result *struct{} = nil

        if(arg &gt; 0) {
            result = &amp;struct{}{}
        }

        return result
    }

    if res := doit(-1); res != nil {
        fmt.Println("good result:",res) // : good result: &lt;nil&gt;
        // 'res'   'nil',    ‚Äî 'nil'
    }
}
</code></pre><br>
:<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    doit := func(arg int) interface{} {
        var result *struct{} = nil

        if(arg &gt; 0) {
            result = &amp;struct{}{}
        } else {
            return nil //   'nil'
        }

        return result
    }

    if res := doit(-1); res != nil {
        fmt.Println("good result:",res)
    } else {
        fmt.Println("bad result (res is nil)") //  ‚Äî   
    }
}
</code></pre><br>
<a name="55"></a><h1>55.    </h1><br>
  ,        .   ++      <code>new</code>,      .  Go     ,     <code>new()</code>  <code>make()</code>.         ¬´ ¬ª (escape analysis).   ,       ,     ,     ++.<br>
<br>
   ,   ,   <code>-gcflags -m</code>  <code>go build</code>  <code>go run</code> (, <code>go run -gcflags -m app.go</code>).<br>
<br>
<a name="56"></a><h1>56. GOMAXPROCS,  (concurrency)  </h1><br>
Go 1.4         / .  ,          .   Go 1.5         ,  <code>runtime.NumCPU()</code>.           ,      CPU  .   ,    <code>GOMAXPROCS</code>    <code>runtime.GOMAXPROCS()</code>.<br>
<br>
  ,  <code>GOMAXPROCS</code>    ,  Go     .    <code>runtime.GOMAXPROCS()</code>   .      <code>GOMAXPROCS</code> (https://golang.org/pkg/runtime/)     .<br>
<br>
 <code>GOMAXPROCS</code>     ,   ‚Äî 256.<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "runtime"
)

func main() {  
    fmt.Println(runtime.GOMAXPROCS(-1)) // : X (1 on play.golang.org)
    fmt.Println(runtime.NumCPU())       // : X (1 on play.golang.org)
    runtime.GOMAXPROCS(20)
    fmt.Println(runtime.GOMAXPROCS(-1)) // : 20
    runtime.GOMAXPROCS(300)
    fmt.Println(runtime.GOMAXPROCS(-1)) // : 256
}
</code></pre><br>
<a name="57"></a><h1>57.      </h1><br>
Go     ,     ,   ,  .         .<br>
<br>
<pre><code class="go">package main

import (  
    "runtime"
    "time"
)

var _ = runtime.GOMAXPROCS(3)

var a, b int

func u1() {  
    a = 1
    b = 2
}

func u2() {  
    a = 3
    b = 4
}

func p() {  
    println(a)
    println(b)
}

func main() {  
    go u1()
    go u2()
    go p()
    time.Sleep(1 * time.Second)
}
</code></pre><br>
     ,       <code>a</code>  <code>b</code>:<br>
<br>
<pre><code class="bash">1 
2

3 
4

0 
2

0 
0

1 
4
</code></pre><br>
   ‚Äî 02 ‚Äî   ,  <code>b</code>    <code>a</code>.<br>
<br>
          ,         sync.<br>
<br>
<a name="58"></a><h1>58.    (Preemptive Scheduling)</h1><br>
   (rogue) ,     .  ,      <code>for</code>,    .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    done := false

    go func(){
        done = true
    }()

    for !done {
    }
    fmt.Println("done!")
}
</code></pre><br>
 <code>for</code>    .   ,     ,    .<br>
<br>
    ,  <code>go</code>,   ,      .    ,    (non-inlined) .<br>
<br>
<pre><code class="go">package main

import "fmt"

func main() {  
    done := false

    go func(){
        done = true
    }()

    for !done {
        fmt.Println("not done!") //  
    }
    fmt.Println("done!")
}
</code></pre><br>
 ,       ,  <code>-gcflags ‚Äìm</code>  <code>go build</code>  <code>go run</code> (, <code>go build -gcflags -m</code>).<br>
<br>
 :   .       <code>Gosched()</code>   runtime.<br>
<br>
<pre><code class="go">package main

import (  
    "fmt"
    "runtime"
)

func main() {  
    done := false

    go func(){
        done = true
    }()

    for !done {
        runtime.Gosched()
    }
    fmt.Println("done!")
}
</code></pre><br>
           ,    <a href="https://www.reddit.com/r/golang/comments/360vlb/draft_traps_gotchas_and_common_mistakes_in_go/"></a>  Reddit (   ,  . ‚Äî . .).</div><p>Source: <a href="https://habr.com/ru/post/314804/">https://habr.com/ru/post/314804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314794/index.html">Itseez, double Intel Company</a></li>
<li><a href="../314796/index.html">How we ran Habr for the humanities</a></li>
<li><a href="../314798/index.html">Automated testing survey results: 411 responses in 2016</a></li>
<li><a href="../314800/index.html">Russian hacker taught IT university students how to hack network</a></li>
<li><a href="../314802/index.html">About layout, logic, eccentrics and MTS portals</a></li>
<li><a href="../314806/index.html">The history of the startup and our pivot</a></li>
<li><a href="../314810/index.html">Analyzing the performance of the server Oracle SPARC T7-2</a></li>
<li><a href="../314814/index.html">Working with different units of measurement of the same type and converting them</a></li>
<li><a href="../314816/index.html">Microsoft fixed a serious vulnerability in Windows</a></li>
<li><a href="../314818/index.html">Search optimization when choosing a campaign</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>