<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Math and Play 2048</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the first time the game 2048 presented on Habrahabr here . Less than five days, as revealed the secret of a simple strategy for its passage. It is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Math and Play 2048</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f6e/785/2e9/f6e7852e926b8d31162e16abb27f0b4a.jpg" alt="one hundred thirty one thousand" width="280" height="400" align="right"><br>  For the first time the game 2048 presented on Habrahabr <a href="http://habrahabr.ru/post/215291/">here</a> .  Less than five days, as revealed the secret of a <a href="http://habrahabr.ru/post/215907/">simple strategy for</a> its passage.  It is really simple - you need to build a snake from the tiles (as in the picture). <br><br>  However, a clear goal does not always mean its easy achievement.  <a href="http://habrahabr.ru/users/mrrl/" class="user_link">Mrrl</a> and I shared our successes in turn: blocks 8, 16, 32, and 65 thousand <a href="http://habrahabr.ru/users/mrrl/" class="user_link">blind</a> . Now I managed what I didn‚Äôt expect - collect the maximum possible tile in the game - 131 072 or 2 <sup>17</sup> , accumulating over 2 million points. <br><br>  This inspired me to refine and formalize the post- <a href="http://habrahabr.ru/post/215907/">started</a> reflections on the game 2048. This is not about the strategy and tactics of passing, but about such issues as: <br>  - Is 2 <sup>17</sup> really the highest possible block? <br>  - How many points can you basically dial on the way to the inevitable end of the game? <br>  - how many moves does the puzzle make? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It takes a bit of math to figure it out ... <br><a name="habracut"></a><br><h4>  Maximum possible tile </h4><br>  Looking at the picture with the snake leading to the creation of block 2 <sup>17</sup> , it is obvious that it would not be possible to assemble the first tile with this particular strategy.  However, is it true that 131,072 is really the maximum?  Intuition gives us the answer ‚Äúyes‚Äù, but I would like more convincing arguments.  And this part of the study was for me the most difficult.  Several approaches were brought to a standstill, until finally I came to the following construction. <br><br>  The main idea is to abstract away from how the tiles are located on the playing field, focusing only on their values.  From this point of view, the <i>state of the game</i> can be described in an ordered ascending set of 16 numbers currently displayed on the screen (a blank cell corresponds to zero). <br><br>  In the case as in the picture, the state will be set (4, 4, 8, 16, ..., 65536).  And at the very beginning of the game, it can be, for example, a vector (0, 0, ..., 0, 2, 2).  Each move (both human and machine) leads to a new state, which, however, cannot be arbitrary.  So, the rules of the game do not allow to jump at once with (0, ..., 0, 2, 2, 8) to (0, ..., 0, 4, 16). <br><br>  We describe all possible transitions from one state to another: <br>  - in the course of a person - either nothing changes, or one or several pairs of identical numbers are replaced by the sum of the elements in the pair, then the required number of zeros is added and the vector is ordered; <br>  - in the course of the machine - either one deuce or one four is added to the set (so as not to disturb the order), and one zero is removed, or (if there are no zeros) the player is declared a loss. <br>  The initial state (that is, the state at the start of the puzzle) can be (0, ..., 0, 2, 2), (0, ..., 0, 2, 4) or (0, ..., 0, 4, 4).  The man and the car take turns, the player starts first. <br><br>  These rules can be viewed as an axiom of the 2048 game model we have constructed. As expected, it is simpler than the object of modeling, but it has important properties: <br>  - if in the original puzzle you can build a tile, for example, 2 <sup>17</sup> , then in the new one too; <br>  - and vice versa, if in the simplified game it is impossible to go to the state with the number 2 <sup>18</sup> , then in the original creation of such a block is impossible. <br><br>  Thus, to answer the question ‚ÄúIs 131 072 exactly the maximum possible tile?‚Äù, It remains to prove that it is never possible to switch to the state with the number 2 <sup>18</sup> in the model. <br><br>  <b>Proof:</b> suppose the contrary and consider a chain of states from one of the initial states to the time when the number 2 <sup>18</sup> first appeared.  Based on the model axioms, the last vector could appear only after a person‚Äôs progress in a situation of the species (..., 2 <sup>17</sup> , 2 <sup>17</sup> ). <br><br>  Consider the first such condition that occurs in the chain.  It was preceded by (again, according to the accepted axioms) either (..., 2 <sup>16</sup> , 2 <sup>16</sup> , 2 <sup>17</sup> ), or (..., 2 <sup>16</sup> , 2 <sup>16</sup> , 2 <sup>16</sup> , 2 <sup>16</sup> ), with the turn behind man. <br><br>  This in turn means that the player had to be in one of the situations earlier: (..., 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>16</sup> , 2 <sup>17</sup> ), (..., 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>17</sup> ), (..., 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>16</sup> , 2 <sup>16</sup> , 2 <sup>16</sup> ), (..., 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>16</sup> , 2 <sup>16</sup> ), (..., 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>16</sup> ) or (..., 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> , 2 <sup>15</sup> ). <br><br>  <i>Remark: some states and transitions are possible only in the model we are considering; they have no analogues in the 2048 game, which does not affect the course of the proof.</i> <br><br>  Each subsequent stage of such reasoning leads to an increase of at least one unit in the number of strictly specified components of the vector that must be present in the circuit.  In this case, the smallest of fixed values ‚Äã‚Äãis halved. <br><br>  As a result, in no more than 15 steps, all 16 components will be explicitly specified.  Then we come to the statement that there should be a state in the chain of the form (2 <sup><i>k</i></sup> , ...), where <i>k</i> ‚â• 3, and a person walks. <br><br>  However, the player could not find himself in such a situation, since after the action of the machine the smallest of the numbers represented in the vector can only be 0, 2 or 4. They arrived at a contradiction that refutes our initial assumption of the contrary, thus proving the required. <br><br>  As a result, 2 <sup>17 is</sup> indeed the <b>maximum possible tile in the 2048 game</b> .  It also means that passing a puzzle can be done no more than some fixed number of moves, while gaining a limited number of points.  I wonder how many points and actions are at our disposal? <br><br><h4>  The maximum possible number of points </h4><br>  Scoring was much easier for me.  To begin, let us outline the best for what a player can strive for in 2048. The record holder‚Äôs cherished goal by points (and by the number of moves, by the way, too) is a situation described by a vector (2, 8, 16, 32, ..., 131 072) or 4, 8, 16, 32, ..., 131 072).  In this case, the game ends, while any other state is ‚Äúdominated‚Äù by the indicated ones, that is, it can be improved precisely by gaining additional points (by completing additional actions). <br><br>  We also note that on the way to the desired final, the car can produce more or fewer fours.  The more often a player receives such "gifts", the worse his score will be on points.  Therefore, let's assume that the car in all (except for the cases specified below) produces a deuce.  To get to the end, you need to get only 15 fours - to collect the block 131 072, the 65,536 tile next to it, and so on up to 8. <br><br>  So, let us remember the assumption made and consider the function <i>f</i> ( <i>n</i> ), the value of which is defined as the smallest possible number of points earned by the time of the first appearance of a 2 <sup><i>n</i></sup> tile.  Why precisely the least?  The fact is that by collecting for the first time, for example, block 4, we can guarantee the presence of the four points obtained for this, but there may be more (if several tiles of 4 are gathered in parallel). <br><br>  We get <i>f</i> (2) = 4. Next: <br>  <i>f</i> (3) = 16 (4 points we get for each of the two necessary blocks 4, then another 8 - for combining them into the figure eight), <br>  <i>f</i> (4) = 48 (= 16 + 16 + 16), <br>  <i>f</i> (5) = 128 (= 48 + 48 + 32), etc. <br><br>  The recurrence relation is: <i>f</i> ( <i>n</i> ) = 2 <i>f</i> ( <i>n - 1</i> ) + 2 <sup><i>n</i></sup> for all natural <i>n</i> , 3 ‚â§ <i>n</i> ‚â§ 16. One of the ways to solve it is to consider the equalities <i>f</i> ( <i>n</i> ) = 2 (2 <i>f</i> ( <i>n - 2</i> ) + 2 <sup><i>n - 1</i></sup> ) + 2 <sup><i>n</i></sup> = 4 <i>f</i> ( <i>n - 2</i> ) + 2 * 2 <sup><i>n</i></sup> , <i>f</i> ( <i>n</i> ) = 4 (2 <i>f</i> ( <i>n - 3</i> ) + 2 <sup><i>n - 2</i></sup> ) + 2 * 2 <sup><i>n</i></sup> = 2 <sup>3</sup> <i>f</i> ( <i>n - 3</i> ) + 3 * 2 <sup><i>n</i></sup> , ..., <i>f</i> ( <i>n</i> ) = 2 <sup><i>n</i> - 2</sup> <i>f</i> ( <i>2</i> ) + ( <i>n</i> - 2) * 2 <sup><i>n</i></sup> .  Taking <i>f</i> (2) = 4 into account, we get <i>f</i> ( <i>n</i> ) = 2 <sup><i>n</i></sup> ( <i>n</i> - 1), which is true, we recall, for 3 ‚â§ <i>n</i> ‚â§ 16. <br><br>  Collecting tile 2 <sup>17</sup> we will get 4 points less than the predicted formula predicts, since we will have to use one of the four given to us by the machine.  That is, <i>f</i> (17) = 2 <sup>17</sup> * 16 - 4 or 2 097 148. <br><br>  It remains only to understand that after creating the maximum block, we again have to ‚Äúassemble‚Äù tile 2 <sup>16</sup> ‚Äúfor the first time‚Äù, rescuing <i>f</i> (16) for this - 4 points (fine again for using the free four), then 2 <sup>15</sup> , receiving accompanying <i>f</i> (15 ) - 4 points, and so on up to 2 <sup>3</sup> and <i>f</i> (3) - 4 points in the piggy bank. <br><br>  Calculating the sum <i>f</i> (17) + <i>f</i> (16) - 4 + <i>f</i> (15) - 4 + ... + <i>f</i> (3) - 4, we get 3 932 100, which is the <b>maximum possible number of points in the game 2048</b> . <br><br>  A small note: by definition, <i>f</i> ( <i>n</i> ) is the smallest possible number of points earned by the time of the first appearance of a tile on a 2 <sup><i>n</i></sup> field.  However, in the final of the game, the number of points earned is exactly equal to the sum of the values ‚Äã‚Äãof the functions for <i>n</i> from 3 to 17 (minus the fine).  There is no surplus, as they are taken into account in the terms corresponding to smaller blocks. <br><br><h4>  Maximum possible number of player moves </h4><br>  The task about the number of moves seemed to me the most difficult at the beginning.  But the reasoning is simple: we introduce the function <i>g</i> ( <i>n</i> ), somewhat similar to <i>f</i> .  We define its value as the minimum number of tiles 2 needed to collect a block 2 <sup><i>n</i></sup> .  In order to maximize the number of moves, we also act on the assumption that the machine each time (with the exception of 15 specially specified cases) gives us twos. <br><br>  So, <i>g</i> (2) = 2 (to collect four, you need to merge 2 deuces), <i>g</i> (3) = 4 (to collect eight, you need to merge two four, the production of each of which requires 2 deuces), <i>g</i> (4) = 8 ( = 4 + 4) and so on.  A simple recurrence relation <i>g</i> ( <i>n</i> ) = 2 <i>g</i> ( <i>n</i> - 1) gives the formula <i>g</i> ( <i>n</i> ) = 2 <sup><i>n</i> - 1</sup> for 3 ‚â§ <i>n</i> ‚â§ 16. <br><br>  When creating block 2 <sup>17,</sup> we need two tiles 2 less than the expression above indicates, since we are given one of the four right away, we don‚Äôt need to assemble it.  Therefore, <i>g</i> (17) = 2 <sup>16</sup> - 2 = 65 534. Just as in the case of points, to calculate the total number of twos involved on the way to one of the two final states, add the values ‚Äã‚Äãof the function <i>g</i> ( <i>n</i> ) for <i>n</i> from 3 to 17 with penalties.  We get <i>g</i> (17) + <i>g</i> (16) - 2 + ... + <i>g</i> (3) - 2, equal to 131 038. For the full order, we must add one to this number if we have arrived at the final state (2, 8, 16, ... 131 072). <br><br>  Now back to our task.  Two tiles 2 are given to us from the very beginning.  To get the remaining 131,036 (not counting the last in one of the finals), you need to perform an appropriate number of actions (after all, the machine gives us exactly one deuce each turn).  Plus, you will need another 15 fours (also not counting the last in one of the finals).  And finally, another action will lead to the appearance of the last two or four. <br><br>  Total, willy-nilly, you have to do 131,036 + 15 + 1 = 131,052 keystrokes (or touching the touch screen) - this is the desired <b>maximum number of user moves in the game 2048</b> . <br><br><h4>  Analysis of my current achievements in the 2048 game </h4><br>  In conclusion, let me apply the above results and approaches for analyzing my recent success in the game of 2048. It seemed to me surprising and interesting that it turns out you can determine the exact number of moves required to achieve the situation depicted in the picture.  Of course, this does not take into account the actions that I performed, repeatedly replaying individual episodes from the last save (saves can be done, tritely duplicating tabs with the game).  And without this, to collect the maximum possible unit is extremely unlikely. <br><br>  So, following the arguments that were tested earlier, if the whole game had only two and one four fall out of me, then as a result <i>g</i> (16) + <i>g</i> (15) + ... + <i>g</i> (2) + 1 - 2 = 65 533 moves I had to dial integers <i>f</i> (16) + <i>f</i> (15) + <i>f</i> (14) + ... + <i>f</i> (2) = 1,835,012 points.  However, as you can see, only 1,811,320 were earned. 23,692 is not enough, that is, the car gave me 5,923 fours, making it impossible to get points, but saving the corresponding number of moves. <br><br>  Findings: <br>  - by now I have done about 60 thousand correct actions on the way to complete victory in the 2048 game; <br>  - to one of the two inevitable finals, there are still about 71 thousand keystrokes (with a perfect game and luck); <br>  - the total number of points I received (after collecting the maximum tile and the four thousand block next to it) is 2,117,800, that is ~ 54% of the maximum possible.  More than a half!  Even with the irrecoverable losses in the amount of almost 24 thousand points due to a random number generator. <br><br>  If suddenly I finish the toy to the end - I will post a picture in this post.  Good mood to you all! <br><br>  <b>UPD:</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/3a6/966/917/3a696691780d2a0b296ff50af7870118.jpg" alt="final position" width="280" height="400" align="left">  Appearing immediately after the screen shot, the phrase Game over seems to me not quite appropriate in this case.  After all, on the way to one of two possible final states, the victory block 2048 had to be collected 127 times.  Total made 119,322 correct moves.  The car threw out on the field 11 730 fours (not counting the last in the upper left corner), which accelerated the victory, but deprived of 46 920 points. </div><p>Source: <a href="https://habr.com/ru/post/219497/">https://habr.com/ru/post/219497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219475/index.html">Vulnerability of remember me functionality found in Laravel</a></li>
<li><a href="../219481/index.html">Using MongoDB instead of memcached: to be or not to be?</a></li>
<li><a href="../219487/index.html">"Sex" robots</a></li>
<li><a href="../219491/index.html">We fix the errors with their own hands, or a bug that "no one shakes"</a></li>
<li><a href="../219493/index.html">Fingerprint scanner in the Samsung Galaxy S5 is also vulnerable</a></li>
<li><a href="../219499/index.html">Vidonn X5 - bracelet from heaven to monitor physical activity</a></li>
<li><a href="../219505/index.html">The basic rules of indie gamedev. Part 1</a></li>
<li><a href="../219507/index.html">LSI MegaRAID SAS 8208XLP to Debian</a></li>
<li><a href="../219509/index.html">Skeletal animation for the first time</a></li>
<li><a href="../219521/index.html">Humble Mobile Bundle 5!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>