<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cloud box office, my humble experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are things that you understand that you do once in your life and that the experience gained will not be useful anymore. From this sad, but it is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cloud box office, my humble experience</h1><div class="post__text post__text-html js-mediator-article">  There are things that you understand that you do once in your life and that the experience gained will not be useful anymore.  From this sad, but it is necessary to do.  Such experiences and stuffed cones are easy to share, can help someone. <br><br>  Below is my little experience on raising an online store with payment acceptance according to the law.  To do this after the entry into force of 54 Federal Law has become decently more difficult and costly.  I am not a real businessman, but an engineer.  Therefore, everything is narrated from the point of view of an engineer, with a decent layer of autobiography. <br><a name="habracut"></a><br>  The story began like that of many: my friends and I formed an interest club, and we began to do something for ourselves, say, clay whistles.  Then other friends asked to do for them.  Then friends of friends.  They did not take money at the beginning, but the love of art quickly devastated the wallet, and unfamiliar people pushed for deadlines.  Therefore, they began to take cash on components.  Then volumes somehow grew, orders from other cities appeared, fast transfers began, including from card to card. <br><br>  Courage to receive large amounts on the card, exactly like the desire to explain with the tax I did not have, so it was decided to register the PI, which was done through public services and two trips to the MFC, and open a current account (week). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There was nothing to fear, know yourself, work, develop, pay 6% of taxes and reassure-explain to customers that transfers of 1-2 days to the account of a legal entity are the norm, money is not lost, it's just Saturday.  And, they say, sorry, as before, in 15 minutes by the card number can no longer. <br><br>  The processing time was not encouraging and a statement was written to the bank for acquiring. <br><br>  Acquiring is an opportunity for legal entities to accept payment to a current account with cards and other types of electronic payments.  The amount is debited from the client‚Äôs card, credited to the legal entity‚Äôs account, minus the commission of the organization providing the service.  This is done both physically, for example, in the grocery, and on the Internet, when the card payment form is filled. <br><br>  All would be fine, but 54FZ loomed and ordered to receive an electronic check for any receipt of payment from individuals, with sending to the tax. <br><br>  Money to the IP account from individuals remained to receive half a year, since  the law prescribed all those who receive money from physicists to acquire cash registers.  Internet cash registers, so that they physically were in the office / outlet / apartment, are connected to the Internet and the information about the punched check was sent to the tax. <br><br>  Traditionally, the law had many discrepancies, a few exceptions, there were two interpretations, and most importantly, there was simply no technology.  The queue at the box office was a few months ahead.  Everyone was scared, because  we are fined easily and naturally. <br><br>  How to link the site and account - no one knew.  Those with acquiring connected - sounded the alarm. <br><br>  I didn‚Äôt really want to have a cash register, be on duty at his office, and most importantly, for what?  I perfectly received the payment to the account, the clients were already from all over Russia, I physically did not see anyone.  Received payment, completed the order, took it to the post office.  How much money is received - tax and so knows, the bank will tell her.  But, the law is the law and work has begun on finding a legal method of receiving payment. <br><br>  Simplified, what internet shopping should look like now: <br><br><ol><li>  The customer makes a purchase on the site, enters the card data for payment. </li><li>  On the seller‚Äôs side, besides the usual order processing, the data for the check must be generated. </li><li>  Within 5 minutes after the payment is received, your cash register machine should send a cash voucher to the client via email or SMS.  Here, in fact, is a multi-round process: the cash desk sends the data for the check to the Fiscal Data Operator (CRF).  OFD sends data to the tax and electronic check to the client. </li></ol><br>  If the order is completed at night, when you sleep peacefully, and the client chooses your site, after tedious marketing, and paid, and the cash register is simply turned off, the new shift is not open and so on - your problems.  If the Internet disappears (and we often change the pipes, then the lightning in the equipment) - your problems.  If the site failed and the check did not go away - your problems. <br><br>  It is only to live near the cashier for rare purchases and pray that the provider in the attic does not hang. <br><br>  Therefore, it was finally decided to abandon the physical box office in favor of the cloud.  This is a cash register emulator.  Cashier with web interface, so to speak. <br><br>  It is also registered in the tax office, it requires connection to the CRF, but the location is indicated - the data center of the cash provider.  I am in Petersburg, the place of installation of the cloud office is Moscow.  It does not bother anyone. <br><br>  In order to more or less fix everything, I had to figure out an action plan for registering the cash desk and getting plastic into the account. <br><br>  Step by step it is: <br><br><ol><li>  Get the service of acquiring in the bank.  I received it in my bank, T. It is possible in Yandex.Money, or some other similar service.  This is for crediting payment cards to the account. </li><li>  Find a suitable online store engine.  To be lively, convenient, with good reviews, and most importantly, compatible with an acquirer (so that there is a payment module for a given engine).  I wanted to quickly close the question (haha, naive!), So I went to the forehead and chose Opencart (in the last round, the add-on to Word Press, Opencart, Magento, Presta Shop was involved).  Opencart - one of the most running engines, visual, knowledgeable people, like not a little. </li><li>  Find a cloud ticket office for rent.  It's almost empty here.  I chose Atol, because there was nothing to choose from.  The remaining one and a half cloud counters that existed at the end of 2018 did not look very impressive.  The list of compatibility with the banks' online shopping engines is short, the list of compatible CRFs is also not very good. </li><li>  Select OFD - to whom the cashier should send the data for check registration in the tax.  There are many CRFs, but in fact many agents are each other.  The OFD was selected for which there were the least bad reviews and it was on the list of cash desk provider partners.  It was thought that once a partner, compatibility must be good. </li><li>  Start registering the cloud office with the cash desk provider, then transfer the received data to the tax office, then enter the provider data from the tax office.  Again mnogohodovochka. <br><br>  To register a tax office in tax would require a trip (I have a good tax inspection, but there is always something going on: repair of the building and offices are moved randomly, then the electronic queue breaks and anarchy, the citizens from the live queue strive to insert lyuley those signed up on the Internet, although the time itself was appointed by the tax authority, issued a priority. The security, of course, works, but still the sediment remains).  To modify this part of the quest, you can use paragraph 6. </li><li>  Get a qualified electronic signature to register the cashier (or many cash desks) on the Internet, through the site nalog.ru. </li></ol><br>  Suddenly, there is also a quest.  Many EDS providers.  The tech support answers with jagged phrases, to the question on the forehead: ‚ÄúWill I be able to register the cash desk with the proposed EDS at the tax office?‚Äù Most often, a paragraph of blurred text was read.  Then I thinned the list by organization, eliminating those whose offices had zero chances of parking even for a fee (at the time of checkout I worked for two jobs, the available time window was narrow).  Then there was a ready-made solution, which was called ‚Äúthe key for the cash register‚Äù, the truth is to go to the other end of the city. <br><br>  So, the participants in the chain: <br><br><ol><li>  I like PI; </li><li>  Provider site online store; </li><li>  A bank in which the account and services of acquiring; </li><li>  Cloud Desk Provider; </li><li> Tax for cash register registration; </li><li>  Provider of an electronic signature for registration of cash in tax; </li><li>  CRF for check registration. </li></ol><br>  Prior to the entry into force of the law, the first three points would suffice.  After the introduction, there are seven of them and it is necessary to coordinate them with others.  To acquiring friends with the site's engine, and the chosen cash desk - with the bank. <br><br>  What was connected with what: <br><br><ol><li>  The module provided by the bank was connected to the CMS.  The module recorded the number of the payment terminal and password. </li><li>  In the acquiring section of the bank, in the subsection of the Cashier, a login was written: the cashier's password and some code, a la ‚Äúunit code‚Äù downloaded from the Atol website.  In the open form they are not, I had to pick out from XML. </li><li>  Cashier and OFD connected themselves (there was a nuance that the OFD wanted money separately, despite the all-inclusive of Atol). </li></ol><br>  What actually happened and what I think about it all: <br><br>  1. It was not very easy to fill in all the forms for the same Atol, for an explanation on how to fill in individual fields you had to write in support.  The manager helped with registration and promised to help with setting up the cash desk through Team Viewer after registering with the tax and this is exactly as long as the organization has not received payment.  Then I had to rely only on myself. <br>  To create an electronic signature on the cash register registration, I had to sweat and hang-up the Chrome browser with plug-ins.  I did not fully understand what I was doing, everything was not the first attempt, but somehow it turned out. <br><br>  Tax believes that there is no chrome and under it had to put plug-ins for Internet Explorer.  I have not used it for many years, and the upgrade from version 9 to version 11 caused Windows to freeze at boot.  After the repair, some of the software stopped working. <br><br>  2. Bank T. provided test turnouts for debugging acquiring: login with demo and password, test card numbers for which money was not written off and checks were not sent to the cashier and CRF.  Tests - sensible, but. <br><br>  3. It turned out that the module for the online store provided by the bank turned out to be incompatible with the partner of the bank, Atol.  Bank T. could work only according to protocol 1.0, while the cash desk worked on incompatible with it 1.05.  The change of protocol hung for 10 days (the system wrote that everything was fine, there were no errors, but the checks did not get through!). <br><br>  Since 2019, this problem is closed, because  the state forced everyone to go to protocol 1.05.  But this is before the introduction of the new protocol. <br><br>  4. Bank module T. perfectly flew.  There is a paid delivery on the site - the payment crashes with an unknown error at the last payment step.  We need callbacks so that the paid goods will be deducted from the warehouse automatically - similarly.  Any sneeze and everything, payment failed, reputation - undermined.  Something has changed on the site, kindly stop the site and go through a series of tests again, otherwise it‚Äôs not a fact that the module will work. <br><br>  Before the first real payment, the test payment was made about 60 pieces and this instead of 5. The support of the bank itself asked to turn off callbacks and various features of the site, just to take the test.  Now many bugs are patched, and, on the sly.  The fact that they repaired their module did not even mention a letter.  Now it is still scary to change something on the site, because you have to stop the site and do a series of tests.  And also, looking at the CMS logs, if a person reached the payment, but didn‚Äôt pay, I immediately think that the payment module crashed. <br><br>  5. I have to live in the logs.  Watch the CMS logs, and the CRF logs, suddenly the cash register disappears from the air again.  Atol often gets up for prevention, 9 letters for the 2019th year about stopping for prevention and one about technical failure.  Then you need to look at the logs whether there were sales and ‚Äúpunch‚Äù checks by hand. <br><br>  Time: <br><br><ol><li>  On the registration of the cloud office in the total went a week.  Quest in plugins.  The electronic signature was not very quickly formed, there were difficulties with the order, and most importantly, the transfer of payment for the signature was made notorious for three. </li><li>  Pairing CMS, bank and cloud office took almost a month.  It would be much shorter if the module provided by the bank was without noticeable errors and Atol switched the protocol not in a day (from days to ‚Äúuntil you pull‚Äù). </li></ol><br>  Money: <br><br><ul><li>  Electronic signature - 1500r., One-time </li><li>  Rent a cloud box office for a year.  + OFD - 36000r. </li><li>  Acquiring - 2.79% for each payment </li><li>  A couple of modules for the CMS - 2800r.  (one time) </li><li>  Hosting CMS - 1800r.  in year. </li></ul><br>  Was it possible not to put a cloud box office? <br><br>  First, you need to read the law 54- and explanations to it, it is possible that cash register is not necessary for your business. <br><br>  If you still need it, but there is no opportunity and desire, there are services like RoboMarket that take over sales to individuals: take the order and payment from the physicist, then send the order to the seller and he sends the order to the client.  Then, the service transfers the payment to the current account as a legal entity to a legal entity.  But, there is a rather tangled and frightening contract, for any 1000 euro fines.  As a result, the service was unpopular, both among sellers and buyers. <br><br>  You can put the usual, online (physical) cashier.  She receives sales data from the site / bank and sends a check.  At the time of the search for decisions about accepting payments from individuals, this scheme worked with CMS Bitrix + with some kind of 1C config.  Most likely, now there are more such decisions. <br><br>  It did not suit me, because I do not believe in the reliability of available Internet connections and there is no need for a physical cash register, there is no desire to be on duty with him, in case of anything, because  there is practically no direct contact with customers. <br><br>  In general, the problem is solved, to accept payment on the Internet from individuals - it turned out. <br>  It was possible to unravel the rather intricate scheme and bring it to a working state, but even a simple solution to the forehead on everything ready took place at C grade (well, that was enough for the mind to take a ready-made CMS, rather than order a samopisny). <br><br>  The process was hampered by the inconsistency between the individual participants, even despite the stated partnership agreements, plus not very good software quality, and working with clients could be better, because  notifications about new services come on a regular basis, and the message about updates of the module for the CMS came about never. <br><br>  In general, satisfactory, bordering on bad. <br><br>  Separately, it should be noted that training in IT is necessary at least at the college level.  Be prepared to read logs, register appearances, extract them from XML, and generally understand what connects with what. <br><br>  If I had begun this quest to be re-run today, I would probably change the bank or the acquirer to a more competent software and with a smaller commission.  I would search for other providers of cloud banks that have self tests that check if the box office is alive.  To phone technical support around the clock, with the number 8-800.  For now, it is necessary to glance in broad gulls. <br>  In general, I am more or less satisfied with the work and would not change the CMS, CRF and, suddenly, tax. <br><br>  All of the above is my personal experience, without any claim to absolute truth. <br><br>  Links that may be useful: <br><br><ul><li>  <a href="https://www.klerk.ru/buh/articles/476136/">Explanation of the timing of sending checks</a> </li><li>  <a href="https://fiscal.robokassa.ru/">Robokassa and 54-FZ</a> </li><li>  <a href="https://kassa.yandex.ru/54fz">Yandex.cassa and 54-</a> </li><li>  <a href="https://e-kontur.ru/blog/15634">Online checkout, contour-extern blog</a> </li><li>  <a href="https://oplata.tinkoff.ru/landing/fz">Visual instruction on receiving payments from the bank</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/449860/">https://habr.com/ru/post/449860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../44984/index.html">Size converter function from * KB, * MB, * GB</a></li>
<li><a href="../449840/index.html">Inception bar: new phishing method</a></li>
<li><a href="../449842/index.html">Career programmer. Part 3. University</a></li>
<li><a href="../449848/index.html">We connect the WN727N WiFi adapter to Ubuntu / Mint</a></li>
<li><a href="../449854/index.html">How complaints reconfigure your brain to negative [and affect health]</a></li>
<li><a href="../449866/index.html">Potential HTTPS attacks and how to protect against them</a></li>
<li><a href="../44987/index.html">Running a project on different hosts</a></li>
<li><a href="../449870/index.html">Universal JSONDecoder</a></li>
<li><a href="../449876/index.html">Innovation SSI-2001: the story of one of the rarest sound cards for the IBM PC (and its replicas)</a></li>
<li><a href="../449878/index.html">Patent research in IT. Course young fighter. Part I. How to understand customer requirements and prepare a report template</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>