<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ethernet bandwidth measurement</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task arose to measure the bandwidth of the Ethernet channel and provide a report, and the measurements should be carried out 24 hours. What ways c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ethernet bandwidth measurement</h1><div class="post__text post__text-html js-mediator-article">  The task arose to measure the bandwidth of the Ethernet channel and provide a report, and the measurements should be carried out 24 hours.  What ways can this be done? <br><br><h4>  Than </h4><br><ul><li>  Service speedtest.net - measures the width of the Internet channel to a certain server.  It does not suit us because this service does not measure a specific communication channel, but the entire line to a specific server, as the measured communication channel does not have access to the Internet; </li><li>  Download a large file from one end of the feed to the other.  Not quite suitable because the required measurement accuracy is missing; </li><li>  Iperf is a client-server utility that allows you to measure a specified time with the provision of a simple report.  We will work with her now. </li></ul><br><a name="habracut"></a><br><h4>  how </h4><br>  Using the iperf tool is very simple: on the one side of the channel, a server is started on the computer, which waits for a connection from the client: <br><br><pre><code class="bash hljs">d@i:~$ iperf -s ------------------------------------------------------------ Server listening on TCP port 5001 TCP window size: 85.3 KByte (default) ------------------------------------------------------------</code> </pre> <br>  On the other side of the channel on another computer, the client starts with the server ip: <br><pre> <code class="bash hljs">d@i:~$ iperf -c 172.28.0.103 ------------------------------------------------------------ Client connecting to 172.28.0.103, TCP port 5001 TCP window size: 2.50 MByte (default) ------------------------------------------------------------ [ 3] <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> 172.28.0.103 port 56868 connected with 172.28.0.103 port 5001 [ ID] Interval Transfer Bandwidth [ 3] 0.0-10.0 sec 32.9 GBytes 28.2 Gbits/sec</code> </pre><br>  As you can see from the report, bandwidth was measured at 10 seconds and amounted to 28.2 Gbit / s (the speed is so high because both the server and the client were running on the same computer).  Great, but we need to measure speed all day.  We look at the parameters of iperf --help and find there a lot of useful information.  In the end, I did something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">d@i:~$ iperf -c 172.28.0.103 -t 86400 -i 15 ------------------------------------------------------------ Client connecting to 172.28.0.103, TCP port 5001 TCP window size: 2.50 MByte (default) ------------------------------------------------------------ [ 3] <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> 172.28.0.103 port 56965 connected with 172.28.0.103 port 5001 [ ID] Interval Transfer Bandwidth [ 3] 0.0-15.0 sec 58.0 GBytes 33.2 Gbits/sec [ 3] 15.0-30.0 sec 50.4 GBytes 28.9 Gbits/sec [ 3] 30.0-45.0 sec 47.4 GBytes 27.2 Gbits/sec [ 3] 45.0-60.0 sec 51.8 GBytes 29.7 Gbits/sec [ 3] 60.0-75.0 sec 45.5 GBytes 26.1 Gbits/sec [ 3] 75.0-90.0 sec 43.2 GBytes 24.7 Gbits/sec [ 3] 90.0-105.0 sec 54.6 GBytes 31.3 Gbits/sec</code> </pre><br>  The -t 86400 parameter sets the measurement time in seconds, and the -i 15 parameter says to output the result every 15 seconds.  It is already better, but not quite convenient to view such a report for the whole day (there will be 86400/15 = 5760 lines in such a report).  Look help further and see that iperf can provide a report in the form of: <br><br><pre> <code class="bash hljs">-y, --reportstyle C report as a Comma-Separated Values</code> </pre><br>  Checking: <br><br><pre> <code class="bash hljs">d@i:~$ iperf -c 172.28.0.103 -t 86400 -i 15 -y C 20141130132436,172.28.0.103,56976,172.28.0.103,5001,3,0.0-15.0,59595292672,31784156091 20141130132451,172.28.0.103,56976,172.28.0.103,5001,3,15.0-30.0,49530142720,26416076117 20141130132506,172.28.0.103,56976,172.28.0.103,5001,3,30.0-45.0,57119866880,30463929002</code> </pre><br>  Fine!  Exactly what is needed!  Now iperf gives statistics convenient for processing.  Parameters in the report are separated by commas.  The first column is the date and time, then you can see the ip addresses and ports of the client and server, at the end the bandwidth in bits / sec.  Redirect this report to a file: <br><br><pre> <code class="bash hljs">d@i:~$ iperf -c 172.28.0.103 -t 86400 -i 15 -y C &gt; stat.txt</code> </pre><br>  After the end of the daily test, the results in the stat.txt file are neatly stacked, which must be visualized in a convenient form for analysis. <br><br><h4>  And now what to do with it? </h4><br>  So, in the stat.txt file, the results of the channel bandwidth tests are collected for the right time at a specified interval.  You can look through each of several thousand lines and do analysis, of course, but once people came up with computers in the first place to make their work easier, and not to look at the seals in contact, and we will use this invention. <br><br>  The report file contains the data needed and not so much.  Get rid of the extra.  We are interested in the date / time of measurement and speed in this date / time.  This is the first and last parameter in each line of the stat.txt file. <br><br>  I processed this file in a hastily written script on python3, please do not judge the curvature of the code - I‚Äôm not a real welder, I found a mask on a construction site. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 import datetime st = open('stat.txt', 'r') res = open('est.txt', 'w') for line in st: w = line.split(',') ti = datetime.time(int(w[0][-6:][0:2]), int(w[0][-6:][2:4]), int(w[0][-6:][4:6])) da = datetime.date(int(w[0][0:8][0:4]), int(w[0][0:8][4:6]), int(w[0][0:8][6:9])) print("{0} {1} {2}".format(da, ti, int(w[8])/(1024**2)), file=res) res.close()</span></span></code> </pre><br>  This script reads lines from the stat.txt file and writes the results to the est.txt file.  The est.txt file is: <br><br><pre> <code class="bash hljs"> d@i:~/project/iperf_graph$ cat est.txt 2014-11-30 13:35:07 4521.25 2014-11-30 13:35:08 3682.875 2014-11-30 13:35:09 2974.75 2014-11-30 13:35:10 2974.625 2014-11-30 13:35:11 2976.375 2014-11-30 13:35:12 2976.25 2014-11-30 13:35:13 2977.0 2014-11-30 13:35:14 2969.75</code> </pre><br>  Already more convenient.  The date, time, measurement result in Mbps is shown.  For this example, the measurement results are taken in 10 minutes with a report every second. <br><br>  But still the result is in the form of a text file not very convenient for analysis.  Need to draw a graph! <br><br>  For drawing graphs there are special and cool programs.  I advise gnuplot for its super flexibility, free of charge, a lot of examples on the Internet. <br><br>  After half an hour of digging in the results of the Google query ‚Äúgnuplot example‚Äù, the following script was born: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /usr/bin/gnuplot -persist set term png size 1024,768 #set terminal postscript eps enhanced color size 1024, 768 set output "graph.png" set grid set yrange[0:] set xdata time set xlabel "Time" set ylabel "Mbit/s" set timefmt "%Y-%m-%d %H:%M:%S" set format x "%Y-%m-%d %H:%M:%S" set xrange [] noreverse nowriteback set xtics rotate plot "est.txt" using 1:3 title "Bandwith" with filledcurve x1 lt 1 lc 2</span></span></code> </pre><br>  This script reads the est.txt file, which is obtained after processing stat.txt and draws a graph in the graph.png file.  We start and the graph.png file appears. <br><br><h4>  Result </h4><br><img src="https://habrastorage.org/files/8a2/532/180/8a2532180ba6417d8a8c7486ad889ee7.png" alt="image"><br><br>  As a result, a simple method of measuring bandwidth with a visually convenient report and two data processing scripts appeared. <br><br>  You can cram a bunch of other things into these scripts for flexibility, such as: a report for a given time interval, more detailed schedule details for closer scrutiny, bolting the ping response time analysis, and parallel with collecting daily data, remove other data such as signal levels on the radio channel and BER indicators, but that's another story. </div><p>Source: <a href="https://habr.com/ru/post/244627/">https://habr.com/ru/post/244627/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244615/index.html">ABAP: Sampling reference values ‚Äã‚Äãby their keys from database tables</a></li>
<li><a href="../244619/index.html">Joker 2014 Java conference through the eyes of a speaker from Siberia</a></li>
<li><a href="../244621/index.html">Using the AdDuplex Service for Universal Applications</a></li>
<li><a href="../244623/index.html">non-FlexPod DC: Direct-Attached Storage, One-stop support</a></li>
<li><a href="../244625/index.html">Probabilistic programming</a></li>
<li><a href="../244631/index.html">Horizontal scroll becomes fashionable. We will understand this</a></li>
<li><a href="../244633/index.html">Joy Inc. Dream job and business processes based on joy</a></li>
<li><a href="../244635/index.html">New free courses virtual academy Microsoft Virtual Academy, December 2014</a></li>
<li><a href="../244637/index.html">What is remembered by Digitale 6</a></li>
<li><a href="../244639/index.html">Indie startup at the GDS 2014 gaming conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>