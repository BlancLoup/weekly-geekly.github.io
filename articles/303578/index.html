<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a blog on symfony 2.8 lts [Part 6]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Navigation in parts of the manual  Part 1 - Configuring Symfony2 and Templates 
 Part 2 - Contact page: validators, forms, and email 
 Part 3 - Doctri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a blog on symfony 2.8 lts [Part 6]</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/post/303578/"><img src="https://habrastorage.org/files/b40/689/6be/b406896bec784ff1a1ad0f64fcd9321b.jpg"></a> <br><a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">Navigation in parts of the manual</b> <div class="spoiler_text"><blockquote>  <a href="https://habrahabr.ru/post/301760/">Part 1 - Configuring Symfony2 and Templates</a> <br>  <a href="https://habrahabr.ru/post/302032/">Part 2 - Contact page: validators, forms, and email</a> <br>  <a href="https://habrahabr.ru/post/302438/">Part 3 - Doctrine 2 and Data Fixtures</a> <br>  <a href="https://habrahabr.ru/post/302602/">Part 4 - Comment Model, Repository and Migrations of Doctrine 2</a> <br>  <a href="https://habrahabr.ru/post/303114/">Part 5 - Twig Extensions, Sidebar (sidebar) and Assetic</a> <br></blockquote><br></div></div><br><br>  Project on <a href="">Github</a> <br><blockquote>  You can find out how to install the part of the manual you need in the description of the repository by the <a href="https://github.com/AntoscencoVladimir/symfony-blog">link</a> .  (For example, if you want to start with this lesson without going through the previous one) <br></blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Testing in symfony2 <br><br>  PHPUnit has become the ‚Äúde facto standard‚Äù for writing tests in PHP, so learning it will benefit you in all your PHP projects.  Let us also not forget that most of the topics covered in this section are language independent, and therefore can be applied to other languages ‚Äã‚Äãthat you use. <br><br><blockquote>  <b><i>The board</i></b> <br><br>  If you plan to write your own Open Source Symfony2 bundles, you are much more likely to get a good response from users if your bundle is well tested (and documented).  Look at the list of existing symfony2 bundles available on <a href="http://knpbundles.com/">knpbundles</a> . <br></blockquote><br><br><h4>  Unit testing </h4><br>  Unit testing verifies the proper operation of individual function units when used in isolation.  In object-oriented code like in symfony2, a module is a class and its methods.  For example, we could write tests for Blog and Comment entity classes.  When writing unit tests, the tests should be written independently of other tests, that is, the result of test <b>B</b> should not depend on the result of <b>A.</b>  Unit testing allows you to create fictitious objects that allow you to test functions that have external dependencies.  Dummy objects (mocks) allow you to simulate a function call instead of the actual execution.  An example of this might be unit testing of a class that wraps an external API.  The API class can use the transport layer protocol to communicate with an external API.  We could make a dummy transport-level query method to return the results that we set, rather than actually returning from the external API.  Unit testing does not verify if the components of an application function correctly together, as shown in the next section. <br><br><h4>  Functional testing </h4><br>  Functional testing verifies the integration of various application components, such as routing, controllers, and mappings.  Functional tests are similar to manual tests that you could do in your browser, for example, requesting the main page, clicking on the record link and checking that it was displayed correctly.  Functional testing gives you the ability to automate this process.  Symfony2 comes bundled with a variety of useful classes that help with functional testing, including the <i>Client</i> , which is able to make requests for pages, submit forms and a <i>DOM Crawler</i> that we can use to bypass the Response from the client. <br><br><h4>  PHPUnit </h4><br>  As mentioned above, symfony2 tests are written using PHPUnit.  You will need to install PHPUnit in order to run tests from this part.  For more installation information, refer to the official documentation on <a href="https://phpunit.de/manual/current/en/installation.html">the PHPUnit website</a> .  To run tests in Symfony2, you need to install PHPUnit 5.4 (requires PHP 5.6).  PHPUnit is a very large library of testing, in connection with this reference will be made to the official documentation, where additional information may be required. <br><br><h4>  Assertions </h4><br>  Writing tests is a test of whether the expected test result is equal to the actual result.  There are a number of assertion methods in PHPUnit to help us with this task.  Some of the common assertion methods that we will use are listed below. <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Check 1 === 1 is true $this-&gt;assertTrue(1 === 1); // Check 1 === 2 is false $this-&gt;assertFalse(1 === 2); // Check 'Hello' equals 'Hello' $this-&gt;assertEquals('Hello', 'Hello'); // Check array has key 'language' $this-&gt;assertArrayHasKey('language', array('language' =&gt; 'php', 'size' =&gt; '1024')); // Check array contains value 'php' $this-&gt;assertContains('php', array('php', 'ruby', 'c++', 'JavaScript'));</span></span></code> </pre> <br><br>  A complete list of assertions is available in the <a href="https://phpunit.de/manual/current/en/appendixes.assertions.html">PHPUnit documentation.</a> <br><br><h4>  Running symfony2 tests </h4><br>  Before we start writing a few tests, let's take a look at how we run the tests in Symfony2.  <b>PHPUnit</b> can use the configuration file.  In our Symfony2 project, this file is <i>app / phpunit.xml.dist</i> .  Since this file is suffixed with <i>.dist</i> , you need to copy its contents to a file called <i>app / phpunit.xml</i> . <br><br><blockquote>  <b><i>The board</i></b> <br><br>  If you are using VCS, such as Git, you must add the <i>app / phpunit.xml file</i> to the ignore list. <br></blockquote><br><br>  If you look at the contents of the <b>PHPUnit</b> configuration file, you will see the following. <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- app/phpunit.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuites</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuite</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Project Test Suite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span>../src/*/*Bundle/Tests<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span>../src/*/Bundle/*Bundle/Tests<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuite</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuites</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  These parameters set up some directories that are part of our test suite.  When running, <b>PHPUnit</b> will look for tests to run in the above directories.  You can also pass additional arguments from the command line to run PHPUnit tests in certain directories.  You will see how to achieve this later. <br><br><blockquote>  <b><i>The board</i></b> <br><br>  For more information on configuring PHPUnit using an XML file, see the <a href="https://phpunit.de/">PHPUnit</a> documentation. <br></blockquote><br><br><h4>  Run current tests </h4><br>  Since we used one of the Symfony2 generator commands to create the Blogger BlogBundle in the first part, she also created a controller test for the Default Controller class.  We can perform this test by running the following command from the project root directory.  <b>The -c</b> option indicates that PHPUnit should load its configuration from the <b>app</b> directory. <br><pre> <code class="bash hljs">$ phpunit -c app</code> </pre><br><br>  After testing completes, you should be notified that the test failed.  If you look at the class <b>DefaultControllerTest</b> located <i>src / Blogger / BlogBundle / Tests / Controller / DefaultControllerTest.php</i> you will see <br><div class="spoiler">  <b class="spoiler_title">following content</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Blogger</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Tests</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Bundle</span></span>\<span class="hljs-title"><span class="hljs-title">FrameworkBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Test</span></span>\<span class="hljs-title"><span class="hljs-title">WebTestCase</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultControllerTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $client = <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::createClient(); $crawler = $client-&gt;request(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertContains(<span class="hljs-string"><span class="hljs-string">'Hello World'</span></span>, $client-&gt;getResponse()-&gt;getContent()); } }</code> </pre><br></div></div><br><br>  This is a functional test for the <b>Default Controller</b> class that Symfony2 generated.  If you remember in Part 1, this controller had a method that processed the request /, at this address we displayed a template with the content <i>‚ÄúHello World‚Äù</i> .  Since we have deleted this controller and the template has completely different content along this route, the above test fails. <br>  Functional testing is a big part of this chapter and will be discussed in detail later. <br>  Since the Default Controller class has been deleted, you can delete the <b>src / Blogger / BlogBundle / Tests / Controller / DefaultControllerTest.php</b> file <br><br><h4>  <b>Unit testing</b> </h4><br>  As explained earlier, unit testing deals with testing individual units of your application in isolation.  When writing unit tests, it is recommended to duplicate the bundle structure in the tests folder.  For example, if you want to test the <i>Blog</i> class entity located in <i>src / Blogger / BlogBundle / Entity / Blog.php the</i> test file will be in <i>src / Blogger / BlogBundle / Tests / Entity / BlogTest.php</i> .  An example will look like <br><div class="spoiler">  <b class="spoiler_title">in the following way</b> <div class="spoiler_text"><pre> <code class="php hljs">src/Blogger/BlogBundle/ Entity/ Blog.php Comment.php Controller/ PageController.php Twig/ Extensions/ BloggerBlogExtension.php Tests/ Entity/ BlogTest.php CommentTest.php Controller/ PageControllerTest.php Twig/ Extensions/ BloggerBlogExtensionTest.php</code> </pre><br></div></div><br><br>  Please note that each of the test files has a <i>Test</i> suffix. <br><br><h4>  Testing Blog Entity - the slugify method </h4><br>  We will begin testing the <i>slugify</i> method in the essence of Blog.  Let's write some tests to make sure this method works correctly.  Create a new file located in <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Tests / Entity / BlogTest.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Entity/BlogTest.php namespace Blogger\BlogBundle\Tests\Entity; use Blogger\BlogBundle\Entity\Blog; class BlogTest extends \PHPUnit_Framework_TestCase { }</span></span></code> </pre><br></div></div><br><br>  We created a test class for the Blog entity.  Please note that the location of the file corresponds to the folder structure mentioned above.  The Blog Test class extends the base PHPUnit class PHPUnit_Framework_TestCase.  All tests you write for PHPUnit will be descendants of this class.  You remember from the previous parts that <b>\</b> must be placed before the name of the class PHPUnit_Framework_TestCase since the class is declared in the common PHP namespace. <br><br>  Now we have a skeleton class for the Blog Entity tests, let's write a test.  Tests in PHPUnit are Test class methods with the test prefix, for example <b>testSlugify ()</b> .  Update your BlogTest located <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Tests / Entity / BlogTest.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Entity/BlogTest.php // .. class BlogTest extends \PHPUnit_Framework_TestCase { public function testSlugify() { $blog = new Blog(); $this-&gt;assertEquals('hello-world', $blog-&gt;slugify('Hello World')); } }</span></span></code> </pre><br></div></div><br><br>  This is a very simple test.  It creates a new Blog entity and runs <b>assertEquals ()</b> for the result of the slugify method.  The <b>assertEquals ()</b> method takes 2 required arguments, the expected result and the actual result.  An optional third argument may be passed to output a message when the test fails. <br><br>  Let's run our new unit test.  Type the following command in the console. <br><br><pre> <code class="bash hljs">$ phpunit -c app</code> </pre><br><br>  You should see the following. <br><br><pre> <code class="bash hljs">PHPUnit 5.4.6 by Sebastian Bergmann and contributors. . 1 / 1 (100%) Time: 348 ms, Memory: 13.25MB OK (1 <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>, 1 assertion)</code> </pre><br><br>  The PHPPunit output is very simple, at first, some information about PHPUnit and the number of each running test is shown, in our case we only have 1 test.  At the end he informs us about the test results.  For our BlogTest, we launched only 1 test with 1 statement.  If you have configured to display colors in your command line, you will also see that the last line is colored green, indicating that everything is <b>OK</b> .  Let's update the <b>testSlugify ()</b> method to see what happens when the test fails. <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Entity/BlogTest.php // .. public function testSlugify() { $blog = new Blog(); $this-&gt;assertEquals('hello-world', $blog-&gt;slugify('Hello World')); $this-&gt;assertEquals('a day with symfony2', $blog-&gt;slugify('A Day With Symfony2')); }</span></span></code> </pre><br><br>  Restart the unit test as before.  Will be displayed <br><div class="spoiler">  <b class="spoiler_title">following</b> <div class="spoiler_text"><pre> <code class="bash hljs">PHPUnit 5.4.6 by Sebastian Bergmann and contributors. F 1 / 1 (100%) Time: 340 ms, Memory: 13.25MB There was 1 failure: 1) Blogger\BlogBundle\Tests\Entity\BlogTest::testSlugify Failed asserting that two strings are equal. --- Expected +++ Actual @@ @@ -<span class="hljs-string"><span class="hljs-string">'a day with symfony2'</span></span> +<span class="hljs-string"><span class="hljs-string">'a-day-with-symfony2'</span></span> D:\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\symfony-blog\src\Blogger\BlogBundle\Tests\Entity\BlogTest.php:15 FAILURES! Tests: 1, Assertions: 2, Failures: 1.</code> </pre><br></div></div><br><br>  The output is a bit more this time.  The <b>F</b> character tells us that the test fails.  You will also see the <b>E</b> symbol if your test contains errors.  Then PHPUnit notifies us of the details of the failures, in this case one.  We can see that the <i>Blogger \ BlogBundle \ Tests \ Entity \ BlogTest :: testSlugify method</i> failed because the expected and actual values ‚Äã‚Äãare different.  If you have a color output in your command line, you will also see that the last line is colored red, indicating that there are errors in the test.  Correct the <b>testSlugify ()</b> method so that it is successfully executed. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Entity/BlogTest.php // .. public function testSlugify() { $blog = new Blog(); $this-&gt;assertEquals('hello-world', $blog-&gt;slugify('Hello World')); $this-&gt;assertEquals('a-day-with-symfony2', $blog-&gt;slugify('A Day With Symfony2')); }</span></span></code> </pre><br><br>  Before going further add a few more tests. <br><div class="spoiler">  <b class="spoiler_title">for slugify () method</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Entity/BlogTest.php // .. public function testSlugify() { $blog = new Blog(); $this-&gt;assertEquals('hello-world', $blog-&gt;slugify('Hello World')); $this-&gt;assertEquals('a-day-with-symfony2', $blog-&gt;slugify('A Day With Symfony2')); $this-&gt;assertEquals('hello-world', $blog-&gt;slugify('Hello world')); $this-&gt;assertEquals('symblog', $blog-&gt;slugify('symblog ')); $this-&gt;assertEquals('symblog', $blog-&gt;slugify(' symblog')); }</span></span></code> </pre><br></div></div><br><br>  Now that we have tested the slugify method, we need to make sure that Blog <b>$ slug</b> is set correctly when Blog <b>$ title is</b> updated.  Add the following methods to the file <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Tests / Entity / BlogTest.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Entity/BlogTest.php // .. public function testSetSlug() { $blog = new Blog(); $blog-&gt;setSlug('Symfony2 Blog'); $this-&gt;assertEquals('symfony2-blog', $blog-&gt;getSlug()); } public function testSetTitle() { $blog = new Blog(); $blog-&gt;setTitle('Hello World'); $this-&gt;assertEquals('hello-world', $blog-&gt;getSlug()); }</span></span></code> </pre><br></div></div><br><br>  We started by testing the setSlug method to ensure that the $ slug element correctly adds slug when updating.  Next, we check that $ slug is updated correctly when the setTitle method is called by the Blog entity. <br>  Run tests to check the performance of the Blog Entity. <br><br><h4>  Twig Extension Testing </h4><br>  In the previous section, we created a Twig extension to convert a <i>\ DateTime</i> into a string to determine the elapsed time since the comment was posted.  Create a new file <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Tests / Twig / Extensions / BloggerBlogExtensionTest.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Twig/Extensions/BloggerBlogExtensionTest.php namespace Blogger\BlogBundle\Tests\Twig\Extensions; use Blogger\BlogBundle\Twig\Extensions\BloggerBlogExtension; class BloggerBlogExtensionTest extends \PHPUnit_Framework_TestCase { public function testCreatedAgo() { $blog = new BloggerBlogExtension(); $this-&gt;assertEquals("0 seconds ago", $blog-&gt;createdAgo(new \DateTime())); $this-&gt;assertEquals("34 seconds ago", $blog-&gt;createdAgo($this-&gt;getDateTime(-34))); $this-&gt;assertEquals("1 minute ago", $blog-&gt;createdAgo($this-&gt;getDateTime(-60))); $this-&gt;assertEquals("2 minutes ago", $blog-&gt;createdAgo($this-&gt;getDateTime(-120))); $this-&gt;assertEquals("1 hour ago", $blog-&gt;createdAgo($this-&gt;getDateTime(-3600))); $this-&gt;assertEquals("1 hour ago", $blog-&gt;createdAgo($this-&gt;getDateTime(-3601))); $this-&gt;assertEquals("2 hours ago", $blog-&gt;createdAgo($this-&gt;getDateTime(-7200))); // Cannot create time in the future $this-&gt;setExpectedException('\InvalidArgumentException'); $blog-&gt;createdAgo($this-&gt;getDateTime(60)); } protected function getDateTime($delta) { return new \DateTime(date("Ymd H:i:s", time()+$delta)); } }</span></span></code> </pre><br></div></div><br><br>  The class is configured the same way as before, creating the testCreatedAgo () method to test the Twig extension.  We introduced another PHPUnit method in this test setExpectedException ().  We know that the createdAgo method of Twig extension cannot handle dates in the future and will be passed to \ Exception.  The getDateTime () method is auxiliary for creating an instance of \ DateTime.  Please note that there is no <b>test</b> prefix, so PHPUnit will not try to run it as a test.  Open a console and run tests for this file.  We could just run the test as before, but we can also tell PHPUnit to run tests only for a specific folder (and subfolders) or a file.  Enter the following command: <br><br><pre> <code class="bash hljs">$ phpunit -c app src/Blogger/BlogBundle/Tests/Twig/Extensions/BloggerBlogExtensionTest.php</code> </pre><br><br>  This will run tests for the BloggerBlogExtensionTest file only.  <b>PHPUnit</b> will tell us that the test failed.  The output is shown below. <br><pre> <code class="bash hljs">1) Blogger\BlogBundle\Tests\Twig\Extensions\BloggerBlogExtensionTest::testCreatedAgo Failed asserting that two strings are equal. --- Expected +++ Actual @@ @@ -<span class="hljs-string"><span class="hljs-string">'0 seconds ago'</span></span> +<span class="hljs-string"><span class="hljs-string">'0 second ago'</span></span> //..</code> </pre><br><br>  We expected the first statement to return 0 seconds ago, but it did not return because the second word was not a plural number.  Let's update the twig extension to fix this. <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Twig / Extensions / BloggerBlogBundle.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Twig/Extensions/BloggerBlogBundle.php namespace Blogger\BlogBundle\Twig\Extensions; class BloggerBlogExtension extends \Twig_Extension { // .. public function createdAgo(\DateTime $dateTime) { // .. if ($delta &lt; 60) { // Seconds $time = $delta; $duration = $time . " second" . (($time === 0 || $time &gt; 1) ? "s" : "") . " ago"; } // .. } // .. }</span></span></code> </pre><br></div></div><br><br>  Restart Unit tests.  You should see that the first statement is displayed correctly, but the test still fails.  Let's consider the following conclusion. <br><br><pre> <code class="bash hljs">1) Blogger\BlogBundle\Tests\Twig\Extensions\BloggerBlogExtensionTest::testCreatedAgo Failed asserting that two strings are equal. --- Expected +++ Actual @@ @@ -<span class="hljs-string"><span class="hljs-string">'1 hour ago'</span></span> +<span class="hljs-string"><span class="hljs-string">'60 minutes ago'</span></span></code> </pre><br><br>  We see that the fifth statement fails.  Looking at the test, we can see that the Twig Expansion did not function correctly.  Should have been returned 1 hour ago, but instead returned 60 minutes ago.  If we look at the code in BloggerBlogExtension Twig we will see the reason.  We compare the time that can be included, that is, we use <b>&lt;=</b> instead of <b>&lt;</b> .  Update Twig extension to fix this. <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Twig / Extensions / BloggerBlogBundle.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Twig/Extensions/BloggerBlogBundle.php namespace Blogger\BlogBundle\Twig\Extensions; class BloggerBlogExtension extends \Twig_Extension { // .. public function createdAgo(\DateTime $dateTime) { // .. else if ($delta &lt; 3600) { // Mins $time = floor($delta / 60); $duration = $time . " minute" . (($time &gt; 1) ? "s" : "") . " ago"; } else if ($delta &lt; 86400) { // Hours $time = floor($delta / 3600); $duration = $time . " hour" . (($time &gt; 1) ? "s" : "") . " ago"; } // .. } // .. }</span></span></code> </pre><br></div></div><br><br>  Now re-run all the tests with the following command. <br><br><pre> <code class="bash hljs">$ phpunit -c app</code> </pre><br><br>  This will run all our tests and show that all tests have been successfully passed.  Although we have written only a small number of unit tests, you should get a sense of how powerful and important testing is when writing code.  Testing also helps add any future functionality to the project without breaking the previous specifications.  This concludes the unit testing review. <br><br><blockquote>  <b><i>The board</i></b> <br><br>  Try adding your own unit tests. <br></blockquote><br><br><h4>  <b>Functional testing</b> </h4><br>  We have written several unit tests, let's move on to testing several components together.  The first section of functional testing will include simulating browser requests to test the generated responses. <br><br><h5>  Testing the About page </h5><br>  We'll start by testing the PageController class for the About page.  Since the page is very simple, this is a good place to start.  Create a new file <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Tests / Controller / PageControllerTest.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php namespace Blogger\BlogBundle\Tests\Controller; use Symfony\Bundle\FrameworkBundle\Test\WebTestCase; class PageControllerTest extends WebTestCase { public function testAbout() { $client = static::createClient(); $crawler = $client-&gt;request('GET', '/about'); $this-&gt;assertEquals(1, $crawler-&gt;filter('h1:contains("About symblog")')-&gt;count()); } }</span></span></code> </pre><br></div></div><br><br>  We will see that the controller test is very similar to the class DefaultControllerTest.  Testing the about page, checks the About symblog line that is present in the generated HTML, namely inside the H1 tag.  The PageControllerTest class does not extend the \ PHPUnit_Framework_TestCase, as we saw in the unit testing example, instead it extends the <b>WebTestCase</b> class.  This class is part of the symfony2 FrameworkBundle. <br><br>  As explained above, the PHPUnit test classes should extend \ PHPUnit_Framework_TestCase, but when additional or common functionality is required in several tests, it is useful to encapsulate it in your own class and have your test classes extend it.  WebTestCase does exactly that, it provides several useful methods for performing functional tests in Symfony2.  Look at the WebTestCase file located at <i>vendor / symfony / symfony / src / Symfony / Bundle / FrameworkBundle / Test / WebTestCase.php</i> , you will see that this class is actually an extension of the KernelTestCase class. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// vendor/symfony/symfony/src/Symfony/Bundle/FrameworkBundle/Test/WebTestCase.php abstract class WebTestCase extends KernelTestCase { // .. }</span></span></code> </pre><br><br>  If you look at the createClient () method in the WebTestCase class, you can see that it creates an instance of the Symfony2 Kernel.  Following the methods further, you will also notice that the environment is set to test (if not overridden as one of the createClient () arguments).  This is the test environment we talked about in the previous section. <br><br>  Looking at our test class, we can see that the createClient () method is called to get and run the test.  Then we call the client-side request () method to simulate a browser HTTP GET request by the URL <b>/ about</b> (this would be exactly the same if you visited the browser <a href="http://localhost:8000/about">http: // localhost: 8000 / about</a> ).  The request gives us a Crawler object that contains the response.  The Crawler class is very useful because it allows us to move the returned HTML.  We use an instance of Crawler to verify that the H1 tag in the HTML response contains the words About symblog.  You will notice that even if we extend the WebTestCase class, we still use the Assert method, as before (remember, the PageControllerTest class is still a descendant of the \ PHPUnit_Framework_TestCase class). <br><br>  Let's run PageControllerTest, with the following command.  When writing tests, it is useful to use it to perform tests only for the file in which you are currently working. <br><br><pre> <code class="bash hljs">$ phpunit -c app/ src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php</code> </pre><br><br>  The message OK (1 test, 1 assertion) should be displayed letting us know that 1 test (testAbout () was running), with 1 statement (assertEquals ()). <br><br>  Try changing the line About Symblog to Contact, and then rerun the test.  The test will fail because Contact is not found, with the result that assertEquals will be set to false. <br>  Return the About symblog line back before we continue. <br>  A Crawler instance allows you to view HTML or XML documents (which means that the Crawler will only work with responses that return HTML or XML).  We can use Crawler to bypass the generated response using methods such as filter (), first (), last () and parents ().  If you used jQuery before, you should feel right at home with the Crawler class.  A full list of supported Crawler traversal methods can be found in the <a href="http://symfony.com/doc/current/book/testing.html">Testing</a> chapter of the Symfony2 book. <br><br><h5>  Homepage </h5><br><br>  While the test for the About page was simple, he outlined the basic principles of functional testing of the site page. <br><br>  <i>Customer creation</i> <i><br><br></i>  <i>Page request</i> <i><br><br></i>  <i>Response check</i> <br><br>  This is a simple overview of the process, in fact there are a number of other steps that we could take such as clicking on links, filling out and submitting a form. <br>  Let's create a method to test the home page.  We know that the main page is accessible along the route <b>/</b> and that it should display the latest blog entries.  Add a new <b>testIndex ()</b> method to the <b>PageControllerTest</b> class located <br><div class="spoiler">  <b class="spoiler_title">src / Blogger / BlogBundle / Tests / Controller / PageControllerTest.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php public function testIndex() { $client = static::createClient(); $crawler = $client-&gt;request('GET', '/'); // Check there are some blog entries on the page $this-&gt;assertTrue($crawler-&gt;filter('article.blog')-&gt;count() &gt; 0); }</span></span></code> </pre><br></div></div><br><br>  You can see the same steps as with the dough for the about page.  Run the test to make sure everything works correctly. <br><br><pre> <code class="bash hljs">$ phpunit -c app/ src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php</code> </pre><br><br>  Let's go now a little further.  Part of the functional testing includes the ability to repeat what the user will do on the site.  In order to navigate through the pages of your site, users click on links.  Let's simulate this action now to check if the links to the post page are correct when clicking on the header. <div class="spoiler">  <b class="spoiler_title">Update the testIndex () method in the PageControllerTest class</b> <div class="spoiler_text">  // src / Blogger / BlogBundle / Tests / Controller / PageControllerTest.php <br><br>  public function testIndex () <br>  { <br>  // ... <br><br>  // Find the first link <br>  $ blogLink = $ crawler-&gt; filter ('article.blog h2 a') -&gt; first (); <br>  $ blogTitle = $ blogLink-&gt; text (); <br>  $ crawler = $ client-&gt; click ($ blogLink-&gt; link ()); <br><br>  // Check the h2 has the blog title in it <br>  $ this-&gt; assertEquals (1, $ crawler-&gt; filter ('h2: contains ("'. $ blogTitle. '")') -&gt; count ()); <br>  } <br></div></div><br><br>  The first thing we do is use a Crawler to extract the text from the first link of the title of the record.  This is done using the <b>article.blog h2 a</b> filter.  This filter is used to return the <b>a</b> tag in the <b>H2</b> <i>article.blog</i> article.  To better understand this, take a look at the markup used on the home page to display the entry. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">article</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"date"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">datetime</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2016-06-17T14:23:55+03:00"</span></span></span><span class="hljs-tag">&gt;</span></span>Friday, June 17, 2016<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/1/a-day-with-symfony2"</span></span></span><span class="hljs-tag">&gt;</span></span>A day with Symfony2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">header</span></span></span><span class="hljs-tag">&gt;</span></span> //.. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">article</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  You can see the structure of the <b>article.blog h2 a</b> filter in the <b>homepage</b> markup.  You will also notice that there are several in the markup, which means that the Crawler filter returns collections.  Since we only want the first link, we use the first () method in the collection.  The click () method takes a reference object and returns the response in the Crawler instance.  You will notice that the Crawler object is a key element for functional testing. <br>  The Crawler object now contains the response of the blog page.  We need to test that the link redirects us to the right page.  We can use the <b>$ blogTitle</b> value we extracted earlier to check the title in the response. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Run the tests to ensure that the navigation between the home page and the recording page is working properly. </font></font><br><br><pre> <code class="bash hljs">$ phpunit -c app/ src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now that you have an understanding of how to navigate through the pages of a site with functional testing, let's move on to testing forms. </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Testing your contact page </font></font></h5><br><br>  symblog    ,      <a href="http://localhost:8000/contact">http://localhost:8000/contact</a> .  ,    .    ,   ,     (     ,   ). <br><br> <i>    <br><br>    <br><br>   <br><br>      <br><br>     </i> <br><br>            1  5.   ,   3  . <br><br>    testContact()   PageControllerTest,  <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Blogger / BlogBundle / Tests / Controller / PageControllerTest.php</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php public function testContact() { $client = static::createClient(); $crawler = $client-&gt;request('GET', '/contact'); $this-&gt;assertEquals(1, $crawler-&gt;filter('h1:contains("Contact symblog")')-&gt;count()); // Select based on button value, or id or name for buttons $form = $crawler-&gt;selectButton('Submit')-&gt;form(); $form['contact[name]'] = 'name'; $form['contact[email]'] = 'email@email.com'; $form['contact[subject]'] = 'Subject'; $form['contact[body]'] = 'The comment body must be at least 50 characters long as there is a validation constrain on the Enquiry entity'; $crawler = $client-&gt;submit($form); $this-&gt;assertEquals(1, $crawler-&gt;filter('.blogger-notice:contains("Your contact enquiry was successfully sent. Thank you!")')-&gt;count()); }</span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will start with the url </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ contact</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> request </font><font style="vertical-align: inherit;">and verify that the page contains the correct H1 header. </font><font style="vertical-align: inherit;">Next we use Crawler to select the form submit button. </font><font style="vertical-align: inherit;">The reason that we choose the button, and not the form, is that the form may contain several buttons that we may want to press independently of each other. </font><font style="vertical-align: inherit;">From the selected button we can get the form. </font><font style="vertical-align: inherit;">We can set the form values ‚Äã‚Äãusing the [] array. </font><font style="vertical-align: inherit;">Finally, the form is submitted to the client‚Äôs submit () method to submit the form. </font><font style="vertical-align: inherit;">As usual, we get a copy of the Crawler back. </font><font style="vertical-align: inherit;">Using the Crawler response, we verify that the flash message is present in the returned response. </font><font style="vertical-align: inherit;">Perform a test to verify that everything is functioning normally.</font></font><br><br><pre> <code class="bash hljs">$ phpunit -c app/ src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The test failed. </font><font style="vertical-align: inherit;">We will get the following PHPUnit message</font></font><br><br><pre> <code class="php hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>) Blogger\BlogBundle\Tests\Controller\PageControllerTest::testContact Failed asserting that <span class="hljs-number"><span class="hljs-number">0</span></span> matches expected <span class="hljs-number"><span class="hljs-number">1.</span></span> D:\local\symfony-blog\src\Blogger\BlogBundle\Tests\Controller\PageControllerTest.php:<span class="hljs-number"><span class="hljs-number">55</span></span> FAILURES! Tests: <span class="hljs-number"><span class="hljs-number">3</span></span>, Assertions: <span class="hljs-number"><span class="hljs-number">5</span></span>, Failures: <span class="hljs-number"><span class="hljs-number">1.</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The output informs us that the flash message cannot be found in the response after the form has been submitted. </font><font style="vertical-align: inherit;">This happened because when we are in a test environment, no redirections are performed. </font><font style="vertical-align: inherit;">When a form is successfully tested in the PageController class, a redirect occurs. </font><font style="vertical-align: inherit;">This redirection does not occur; </font><font style="vertical-align: inherit;">We need to explicitly state that it should be respected. </font><font style="vertical-align: inherit;">The reason that redirects are not performed is simple, because you may want to check the current response first. </font><font style="vertical-align: inherit;">We will see this later when we check to see if the message went. </font><font style="vertical-align: inherit;">Update the PageControllerTest class to set the redirection.</font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php public function testContact() { // .. $crawler = $client-&gt;submit($form); // Need to follow redirect $crawler = $client-&gt;followRedirect(); $this-&gt;assertEquals(1, $crawler-&gt;filter('.blogger-notice:contains("Your contact enquiry was successfully sent. Thank you!")')-&gt;count()); }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now if we run the PHPUnit tests, we must pass them. </font><font style="vertical-align: inherit;">Let's now look at the final stage of checking the process of sending a contact form, step 4, checking that the mail has been sent. </font><font style="vertical-align: inherit;">We already know that mail will not be delivered in the test environment due to the following configuration.</font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># app/config/config_test.yml swiftmailer: disable_delivery: true</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can verify the fact that the letters were sent using the information collected using the web profiler. </font><font style="vertical-align: inherit;">This is where it is important not to redirect the client. </font><font style="vertical-align: inherit;">The profiler check must be done before the redirection occurs, otherwise the profiler information will be lost.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update testContact () method</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php public function testContact() { // .. $crawler = $client-&gt;submit($form); // Check email has been sent if ($profile = $client-&gt;getProfile()) { $swiftMailerProfiler = $profile-&gt;getCollector('swiftmailer'); // Only 1 message should have been sent $this-&gt;assertEquals(1, $swiftMailerProfiler-&gt;getMessageCount()); // Get the first message $messages = $swiftMailerProfiler-&gt;getMessages(); $message = array_shift($messages); $symblogEmail = $client-&gt;getContainer()-&gt;getParameter('blogger_blog.emails.contact_email'); // Check message is being sent to correct address $this-&gt;assertArrayHasKey($symblogEmail, $message-&gt;getTo()); } // Need to follow redirect $crawler = $client-&gt;followRedirect(); $this-&gt;assertTrue($crawler-&gt;filter('.blogger-notice:contains("Your contact enquiry was successfully sent. Thank you!")')-&gt;count() &gt; 0); }</span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After submitting the form, we check if the profiler is available, since this can be turned off using the configuration for the current environment. </font></font><br><br><blockquote> <b><i></i></b> <br><br> ,        ,       ,  ,      . <br></blockquote><br><br>           swiftmailer . swiftmailer    ,     ,     .    ,     ,    . <br>     getMessageCount(),  ,    1 .   ,  ,    ,    ,        . <br>     ,    . <br><br><pre> <code class="bash hljs">$ phpunit -c app/ src/Blogger/BlogBundle/Tests/Controller/PageControllerTest.php</code> </pre><br><br><h5>    </h5><br>    ,        ,       .    ,   ,     . <br><br> <i>    <br><br>    <br><br>   <br><br>            <br><br>    ,    (    )</i> <br><br>   ,   <br><div class="spoiler"> <b class="spoiler_title">src/Blogger/BlogBundle/Tests/Controller/BlogControllerTest.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Controller/BlogControllerTest.php namespace Blogger\BlogBundle\Tests\Controller; use Symfony\Bundle\FrameworkBundle\Test\WebTestCase; class BlogControllerTest extends WebTestCase { public function testAddBlogComment() { $client = static::createClient(); $crawler = $client-&gt;request('GET', '/1/a-day-with-symfony'); $this-&gt;assertEquals(1, $crawler-&gt;filter('h2:contains("A day with Symfony2")')-&gt;count()); // Select based on button value, or id or name for buttons $form = $crawler-&gt;selectButton('Submit')-&gt;form(); $crawler = $client-&gt;submit($form, array( 'blogger_blogbundle_commenttype[user]' =&gt; 'name', 'blogger_blogbundle_commenttype[comment]' =&gt; 'comment', )); // Need to follow redirect $crawler = $client-&gt;followRedirect(); // Check comment is now displaying on page, as the last entry. This ensure comments // are posted in order of oldest to newest $articleCrawler = $crawler-&gt;filter('section .previous-comments article')-&gt;last(); $this-&gt;assertEquals('name', $articleCrawler-&gt;filter('header span.highlight')-&gt;text()); $this-&gt;assertEquals('comment', $articleCrawler-&gt;filter('p')-&gt;last()-&gt;text()); // Check the sidebar to ensure latest comments are display and there is 10 of them $this-&gt;assertEquals(10, $crawler-&gt;filter('aside.sidebar section')-&gt;last() -&gt;filter('article')-&gt;count() ); $this-&gt;assertEquals('name', $crawler-&gt;filter('aside.sidebar section')-&gt;last() -&gt;filter('article')-&gt;first() -&gt;filter('header span.highlight')-&gt;text() ); } }</span></span></code> </pre><br></div></div><br><br>      ,     ,  ,    . <br><pre> <code class="bash hljs">$ phpunit -c app/ src/Blogger/BlogBundle/Tests/Controller/BlogControllerTest.php</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPUnit should tell you that 1 test was successfully completed. </font><font style="vertical-align: inherit;">Looking at the code for testAddBlogComment () we can see the creation of the client, the page request and its verification. </font><font style="vertical-align: inherit;">Then proceed to the receipt of the form Adding a comment and submitting the form. </font><font style="vertical-align: inherit;">The way in which we fill out the form values ‚Äã‚Äãis slightly different from the previous version. </font><font style="vertical-align: inherit;">This time we use the 2nd argument of the submit () client method to add form values.</font></font><br><br><blockquote> <b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tip</font></font></i></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We could also use an object-oriented interface to set form field values. </font><font style="vertical-align: inherit;">Examples are shown below.</font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Tick a checkbox $form['show_emal']-&gt;tick(); // Select an option or a radio $form['gender']-&gt;select('Male');</span></span></code> </pre><br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After submitting the form, we request a client who must follow the redirection so that we can verify the response. </font><font style="vertical-align: inherit;">We use Crawler again to get the latest blog comment, which should be the one we just posted. </font><font style="vertical-align: inherit;">Finally we check the latest comments in the sidebar to check that the comment is first on the list.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Blog repository </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the last part of functional testing, we explore the testing of the Doctrine 2 Repository. </font><font style="vertical-align: inherit;">Create a new file</font></font><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Blogger / BlogBundle / Tests / Repository / BlogRepositoryTest.php</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// src/Blogger/BlogBundle/Tests/Repository/BlogRepositoryTest.php namespace Blogger\BlogBundle\Tests\Repository; use Blogger\BlogBundle\Entity\Repository\BlogRepository; use Symfony\Bundle\FrameworkBundle\Test\WebTestCase; class BlogRepositoryTest extends WebTestCase { /** * @var \Blogger\BlogBundle\Entity\Repository\BlogRepository */ private $blogRepository; public function setUp() { $kernel = static::createKernel(); $kernel-&gt;boot(); $this-&gt;blogRepository = $kernel-&gt;getContainer() -&gt;get('doctrine.orm.entity_manager') -&gt;getRepository('BloggerBlogBundle:Blog'); } public function testGetTags() { $tags = $this-&gt;blogRepository-&gt;getTags(); $this-&gt;assertTrue(count($tags) &gt; 1); $this-&gt;assertContains('symblog', $tags); } public function testGetTagWeights() { $tagsWeight = $this-&gt;blogRepository-&gt;getTagWeights( array('php', 'code', 'code', 'symblog', 'blog') ); $this-&gt;assertTrue(count($tagsWeight) &gt; 1); // Test case where count is over max weight of 5 $tagsWeight = $this-&gt;blogRepository-&gt;getTagWeights( array_fill(0, 10, 'php') ); $this-&gt;assertTrue(count($tagsWeight) &gt;= 1); // Test case with multiple counts over max weight of 5 $tagsWeight = $this-&gt;blogRepository-&gt;getTagWeights( array_merge(array_fill(0, 10, 'php'), array_fill(0, 2, 'html'), array_fill(0, 6, 'js')) ); $this-&gt;assertEquals(5, $tagsWeight['php']); $this-&gt;assertEquals(3, $tagsWeight['js']); $this-&gt;assertEquals(1, $tagsWeight['html']); // Test empty case $tagsWeight = $this-&gt;blogRepository-&gt;getTagWeights(array()); $this-&gt;assertEmpty($tagsWeight); } }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we want to run tests that require a proper connection to the database, we will again extend WebTestCase, as this allows you to load the Symfony2 Kernel. </font><font style="vertical-align: inherit;">Run a test for this file using the following command.</font></font><br><br><pre> <code class="bash hljs">$ phpunit -c app/ src/Blogger/BlogBundle/Tests/Repository/BlogRepositoryTest.php</code> </pre><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code coverage </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code coverage gives us an understanding of which parts of the code are executed when the tests run. </font><font style="vertical-align: inherit;">With this, we can see parts of our code that are not covered by tests and determine whether to write a test for them. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To display the code coverage for your application, enter in the console</font></font><br><br><pre> <code class="bash hljs">$ phpunit --coverage-html ./phpunit-report -c app/</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that the command worked, you need activated </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xdebug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in php. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will display the code coverage analysis in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">phpunit-report</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> folder </font><font style="vertical-align: inherit;">in the project root. </font><font style="vertical-align: inherit;">Open the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">from this folder in your browser to see the result of the analysis.</font></font><br><br><img src="https://habrastorage.org/files/49c/95e/171/49c95e171b8c497bbbc7dda433f43fe1.png"><br><br><h4>  Conclusion </h4><br><br>       .       ,    ,     .  ,         Symfony2 Crawler     . <br><br>    : <br><br> <a href="https://symfony.com/">https://symfony.com/</a> <br> <a href="http://tutorial.symblog.co.uk/">http://tutorial.symblog.co.uk/</a> <br> <a href="https://phpunit.de/">https://phpunit.de/</a> <br><br><div class="spoiler">  <b class="spoiler_title">Post Scriptum</b> <div class="spoiler_text"><blockquote>         ,       ,      ,   . </blockquote><br></div></div><br><blockquote> <a href="https://habrahabr.ru/post/301760/"> 1 ‚Äî  Symfony2  </a> <br> <a href="https://habrahabr.ru/post/302032/"> 2 ‚Äî    : ,    </a> <br> <a href="https://habrahabr.ru/post/302438/"> 3 ‚Äî Doctrine 2   </a> <br> <a href="https://habrahabr.ru/post/302602/"> 4 ‚Äî  ,    Doctrine 2</a> <br> <a href="https://habrahabr.ru/post/303114/"> 5 ‚Äî Twig ,  (sidebar)  Assetic</a> <br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, if you like the guide, you can put a star to </font></font><a href="https://github.com/AntoscencoVladimir/symfony-blog"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the project repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or subscribe.</font></font> Thank. </div><p>Source: <a href="https://habr.com/ru/post/303578/">https://habr.com/ru/post/303578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303562/index.html">Features of component caching in Unity3D</a></li>
<li><a href="../303566/index.html">When software communicates with us, should they be friendly</a></li>
<li><a href="../303572/index.html">We write an extension for PHP (7.0.7) without knowledge of C / C ++ and how it works in general</a></li>
<li><a href="../303574/index.html">Implementing demons on Node.js</a></li>
<li><a href="../303576/index.html">Unique data center Finger Lakes Technologies Group inside the nuclear storage</a></li>
<li><a href="../303580/index.html">How we develop a new frontend Tinkoff.ru</a></li>
<li><a href="../303582/index.html">C--. First meeting</a></li>
<li><a href="../303584/index.html">Experience in automating server REST API testing with Jmeter</a></li>
<li><a href="../303590/index.html">Comparing D and Go performance for web</a></li>
<li><a href="../303594/index.html">Using lambda as local functions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>