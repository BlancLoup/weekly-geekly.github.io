<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>That the site did not fall: an economical method</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sites are falling. I have been working in hosting for 7 years and for the last 5 years (among other things) I provide services in geographically-distr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>That the site did not fall: an economical method</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/19d/8fb/72b/19d8fb72b1a444c98ea5aaabd241b838.png"><br><br>  Sites are falling.  I have been working in hosting for 7 years and for the last 5 years (among other things) I provide services in geographically-distributed clusters so that in case of an accident in one of the data centers, the site continues to work in another.  At the exit, such a solution costs at least 4 thousand rubles per month for 1 virtual server.  It may be expensive for a small online store for ‚Äúinsurance‚Äù, which will be required 1-3 times a year, and if lucky, it will not be required at all.  Accordingly, many need a cheaper option, suitable for small and medium businesses.  Now I will tell you how to solve this very, very simply. <br><a name="habracut"></a><br><h1>  Important entry </h1><br>  <a href="http://habrahabr.ru/post/248837/">Last time</a> I talked about the principles of organizing a budget fault-tolerant cluster.  A full cluster requires at least doubling the amount of equipment in order to be able to continue to work if it fails.  In this post I will talk about how to do without duplicating the system and at the same time keep the clients in case of failure of the main server. <br><br>  So, when the site of an online store or, for example, a cafe falls, there are two problems: <br><ol><li>  Customers can not reach the site and you lose orders.  As a rule, falls rarely last more than a day, so usually just subtract the day of work from the profits. </li><li>  Worse, sites may fall out of search engines, because search robots see some 503 or 404 error instead of a website, or they don‚Äôt see anything at all. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If the first is usually easy enough to endure in a small business (well, 9-15 thousand turnover with a margin of 30% is 3-5 thousand rubles, in general it is not terrible), then the subsidence in search engines is much more expensive.  Face seoshnika on the second hour of the fall will look scary.  Damage (if not lucky) - approximately your monthly budget for promotion.  For this, it is worthwhile to ‚Äúlay straws‚Äù in case of a fall. <br><br>  We talked to <a href="http://habrahabr.ru/users/milfgard/" class="user_link">Milfgard</a> about fault-tolerant solutions, and he told how they had been solving this problem in Mosigra for many years.  At the time of site outages, clients simply switch to a static html stub with basic information. <br><br>  This is a page where you can see general information about the company, a telephone for communication and maybe a few more pages in which money is invested.  For such a stub enough from 1 to 20 pages (conventionally this is the main page and a few pages with top products).  If more, it already makes sense to think about the cluster.  Such a ‚Äústub‚Äù system is made and maintained noticeably simpler than a full-fledged cluster. <br><br><h2>  The essence of the method </h2><br><ol><li>  The main pages are taken from the site (home + some of your choice).  A static stub site is automatically created from them.  When you click on any link (leading to pages not included in such a stub), a message appears like: "The site is temporarily unavailable, call 123, we will accept the order."  This stub is hosted on a server independent of the hosting where the main site is running. </li><li>  To maintain relevance (prices, design changes, etc.), such a stub site is automatically updated once a week. </li><li>  The domain is delegated to a reliable DNS service (in my case, Yandex, because it is in itself fault tolerant), which can be managed through the API. </li><li>  The backup server monitors the main server and, in case of failure, changes the IP address to the address of the backup server.  The check is performed once a minute, and if the robot encounters an error 3 times in a row, the A-domain record is switched to the backup server.  When restoring the main site, the record changes back. </li><li>  When the record is switched back and forth, an SMS notification is sent to the owner or administrator. </li></ol><br><br>  <b>In other words</b> : we take and copy the main pages of any site, make a static stub and make sure that when the main site falls, customers switch to our static version.  Then we switch back after the restoration of the main site. <br>  The switching process takes about 1.5 minutes, that is, this time (TTL) plus or minus a couple of minutes the site still lies down.  When we first started testing, the delay was about 12-17 minutes, now everything is much faster: there were options. <br><br><h2>  Cluster Benefits </h2><br><ol><li>  Very simple to implement, done one by one. </li><li>  Incomparably cheaper. </li><li>  Often, this is enough to save the buyer who came from advertising - the operator will tell the details on the phone, well, in general, the client will see that the site is live, works instead of an incomprehensible mistake. </li><li>  Does not require any support from the main site, works with any engines and technologies. </li><li>  Saves from overloads, errors in the site / database software, hacks, attacks, etc.  - for any unfavorable scenario, you can switch the domain to a static site and it honestly will work.  It is difficult to break the site from some static html files with pictures and it will sustain noticeably more than the main site with a bunch of functions and a large base. </li><li>  It can work with any hosting, as long as it supports work with external DNS servers (the vast majority support it). </li><li>  It‚Äôs not at all necessary for the client to transfer their site to our hosting - it‚Äôs enough to order a service for such a stub and you don‚Äôt have to touch anything on your site. </li></ol><br><br>  <b>Once again</b> : such a stub does not require any changes from the site, hosting, etc. - the site will work as it worked, and in case of problems a straw will be prepared where it should fall gently. <br><br><h2>  disadvantages </h2><br><ol><li>  This is a stub - the user will not be able to search the site, register, log in to his personal account, etc.  Just see the basic information and (conditionally price and phone number to contact the operator). </li><li>  When switching there is a delay in updating the DNS cache, about 1.5 minutes. </li><li>  There is an additional difficulty - you need the site owner to delegate the domain to the Yandex DNS servers.  This is not difficult, but it takes experience - this procedure will not be able to perform an ordinary secretary. </li></ol><br><br><h2>  Practical implementation </h2><br><ol><li>  The client's domain is delegated to Yandex DNS servers ‚Äî they are free and reliable, there is a simple management API.  TTL is set to the minimum - 90 seconds. </li><li>  A separate server hosts the monitoring service and hosting static sites.  Monitoring once a minute refers to the main server, downloads the main page and searches there for a key phrase that says that the site is working.  This is usually the code of Yandex-metrics or google-analytics, but you can also insert something special that will be exactly issued by a query from the database inside the main text of the page.  In case of three failures in a row, an SMS message is sent to the client about the failure and switching the site to a spare site. </li><li>  At the same time, monitoring changes the IP address of the domain to the address of the backup site and continues to check the main site for availability.  As soon as the main site returns to normal, a notification is sent to the client that the site has switched to the main site and the main IP address of the server is returned. </li><li>  If necessary, the client can organize ftp-access to the files of his site or API to download the archive to update the stub in automatic mode (this is not yet implemented on my stream). </li></ol><br><br><h2>  Look </h2><br>  See how it works on the example of test sites: <br><br>  <a href="http://splasher-test-00.inf1f2.ru/">splasher-test-00.inf1f2.ru</a> - gives an error from zero to the 14th minute of each hour <br>  <a href="http://splasher-test-15.inf1f2.ru/">splasher-test-15.inf1f2.ru</a> - gives an error from the 15th to the 29th minute of each hour <br>  <a href="http://splasher-test-30.inf1f2.ru/">splasher-test-30.inf1f2.ru</a> - gives an error from the 30th to the 44th minute of each hour <br>  <a href="http://splasher-test-45.inf1f2.ru/">splasher-test-45.inf1f2.ru</a> - gives an error from the 45th to the 59th minute of each hour </div><p>Source: <a href="https://habr.com/ru/post/260277/">https://habr.com/ru/post/260277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260259/index.html">Ingredients of IoT Fast Food Delicacies: Intel Edison + Intel XDK + JavaScript + Grove Kit</a></li>
<li><a href="../260269/index.html">Antivirus Self-Defense</a></li>
<li><a href="../260271/index.html">Salad "Microsoft Guide for SymbolTable with a delicate aftertaste Antlr4"</a></li>
<li><a href="../260273/index.html">Challenge the tradition of hi-fi. Digital potentiometers in detail. Part two</a></li>
<li><a href="../260275/index.html">How we made the best release tracker tracker</a></li>
<li><a href="../260279/index.html">Do we really need start-ups for large corporations</a></li>
<li><a href="../260285/index.html">Analysis of the tasks of the qualifying round of RCC 2015</a></li>
<li><a href="../260287/index.html">Are you ready to complain?</a></li>
<li><a href="../260289/index.html">LabVIEW Programming Contest. The decision of the winning team</a></li>
<li><a href="../260291/index.html">Examples of using MongoDB in e-commerce (part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>