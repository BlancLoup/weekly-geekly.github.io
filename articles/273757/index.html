<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Veeam Backup: nice little tricks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the eve of the New Year, I thought: not to make a modest, but very useful gift to our readers, talking about features that the system administrator...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Veeam Backup: nice little tricks</h1><div class="post__text post__text-html js-mediator-article">  On the eve of the New Year, I thought: not to make a modest, but very useful gift to our readers, talking about features that the system administrators and users of Veeam Backup &amp; Replication usually don‚Äôt pay attention to, and don‚Äôt even know about some of them?  So this article was born on how to use Veeam Backup in a non-standard way. <br><br>  I will start, perhaps, with many well-known VeeamZIP. <br><br><img src="https://habrastorage.org/files/b8a/631/60c/b8a63160c8af4f55b737fd101060d65e.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h1>  VeeamZIP </h1><br>  <a href="http://habrahabr.ru/company/veeam/blog/191828/">VeeamZIP</a> is a free backup tool. <br><br>  In the free Veeam Backup Free Edition, it is possible to backup only one VM in one pass of VeeamZIP, in the paid version of Veeam Backup &amp; Replication VeeamZIP has no limitations.  As a result of VeeamZIP operation, a file is obtained that contains a complete copy of the backup VM.  The VeeamZIP operation is started manually from the interface (on the <b>Virtual Machines</b> tab - see the screenshot below), by the PowerShell cmdlet ( <a href="http://helpcenter.veeam.com/backup/80/powershell/start-vbrzip.html">Help</a> , <a href="http://habrahabr.ru/company/veeam/blog/257579/">story on habr</a> ) or from the vSphere Web Client (if the <a href="http://helpcenter.veeam.com/backup/80/em/em_vmware_web_veeamzip.html">plug-in</a> with Veeam Backup Enterprise Manager is installed). <br><br>  The main purpose of VeeamZIP is to create an independent portable backup once. <br><br><img src="https://habrastorage.org/files/b8a/631/60c/b8a63160c8af4f55b737fd101060d65e.png"><br><br>  When may need: <br><ol><li>  Archiving old VMs;  test or decommissioned service.  In this case, do VeeamZIP-file and delete the VM in production. </li><li>  Transfer / send VM to the developer in order to test on his stand;  a full copy is required for subsequent replication setup (seeding);  it is necessary to transfer the prepared VMs to the branches or hand them over to the contractors / for inspection, to safety officers, etc., etc. </li><li>  Saving different variants of VMs, for example, different versions of software (as in a joke: ‚ÄúHere is the skeleton of Alexander the Great when he was five years old ... But the skeleton of a seven-year-old Macedonian ...‚Äù). </li><li>  Creating an unscheduled copy before the changes, if Quick Backup is not suitable - for example, the task states to store 3 daily restore points, and you need to keep the copy for a longer period. </li><li>  Come up with your option. </li></ol><br>  <i>A nice bonus:</i> you can set the backup retention period on the disk.  If you don‚Äôt take it anywhere, Veeam Backup will remove it. <br><br><img src="https://habrastorage.org/files/4b0/79a/636/4b079a6362174448812b4dee6dc876d8.png"><br><br><h1>  Quick migration </h1><br>  The Quick Migration feature is available in the free version.  In paid Veeam Backup &amp; Replication, it is used to migrate a VM, after a restore operation by running directly from a backup - <a href="http://habrahabr.ru/company/veeam/blog/166221/">Instant VM Recovery</a> , in case, for example, VMware Storage vMotion is impossible.  You can also start this operation from the <b>Virtual Machines</b> tab. <br><br>  But after all, no one forbids using this function for the usual transfer of the VM in a working environment!  No doubt, Storage vMotion is good because it transfers VM disks without stopping their work, but it negatively affects the performance of the main storage system at the moment of migration.  And Quick Migration works similarly to replication in Veeam Backup &amp; Replication, and the effect on storage is much less [I‚Äôll mark myself that I need to check if I / O Control works during this operation], but the VM will be unavailable for some time (downtime will take place at the time of entering the VM into a pause, transfer of extraneous blocks and bringing the machine out of a pause).  So here you have a choice: either regular demanding svMotion without stopping, or Veeam Quick Migration with less impact on productive, but suspension in work. <br><br>  In general, the Virtual Machines tab is a very useful section. <br><br><h1>  Virtual Machines tab </h1><br>  Here you can easily find the necessary VMs and, by clicking on the right mouse button, add them to existing tasks or create new ones with them.  This is often simpler and clearer than opening an assignment for editing each time and adding new VMs to backup through its properties. <br><br><img src="https://habrastorage.org/files/240/068/095/24006809582044468c4804bf7e1b5d8c.png"><br><br><h1>  Did you miss the FastSCP? </h1><br>  Who remembers Veeam FastSCP for VMware?  Once it was the only good way to copy data to datastores, for example, if it is ISO-shniki or ready-made VM, disk images.  The console scp copied very slowly, and FastSCP was really fast and free.  Then he was abolished in favor of the free edition of Veeam Backup.  But!  The copy function has been and remains in Veeam Backup &amp; Replication. <br><br>  So, let's go to the <b>Files</b> tab in the console (do you open it at all, tell me honestly? No? Well, in vain!).  There we will be able to find the necessary files on any of the servers registered in the Veeam console: VMware, Linux, Windows (including Hyper-V hosts, of course) - and copy them anywhere within the same registered servers via Copy-Paste or Drag'n ' Drop.  (Note, and from Linux to Windows, and vice versa is also possible.) <br><br><img src="https://habrastorage.org/files/0ab/888/801/0ab88880174d4b1082ed1cdbd6ca91db.png"><br><br>  In addition, you can copy and schedule - using job File Copy Job.  Although there is no explicit execution of the deferred one-time execution, it is possible to solve this bypassing maneuver - via the command line and the Windows scheduler: <br><ol><li>  Create a job to copy File Copy Job without including the schedule for execution. </li><li>  On the final screen of the wizard, copy the command line to complete the task. <br><br><img src="https://habrastorage.org/files/4e4/267/99e/4e426799eadd4e6584210a9cf6420a78.png"><br><br>  <i>Useful: the</i> same lines are for other types of tasks. </li><li>  Go to the Windows scheduler and create a new task for a one-time execution, specify the desired time and paste the copied line from step 2. <br><br><img src="https://habrastorage.org/files/faf/efc/781/fafefc781b7e4de9821c7c54bc3c52a1.png"></li></ol><br><br>  The process of copying itself, if we talk about Windows / Linux, comes from within the OS.  So feel free to add physical hosts to the Veeam Backup &amp; Replication console when you need to copy something from / to them too. <br><br>  Copying takes place as is, that is, without compression and deduplication.  Want to compress files for archiving?  Probably then tapes would be best.  They have built-in archiving, while Veeam Backup &amp; Replication has tape integration and its own job type File to Tape Job. <br><br><h1>  And about the bookmark Files </h1><br>  There is a built-in text editor on this tab! <br><br><img src="https://habrastorage.org/files/738/363/f18/738363f18e2f44ca8a5f48e53c9408a5.png"><br><br>  And he understands text files in Unix format: <br><br><img src="https://habrastorage.org/files/112/5d1/8fe/1125d18fea5a41e4961be9e28e416bb9.png"><br><br>  So if you need to edit a vmx file (VM configuration on VMware platform) or any other configuration file inside Linux (and Windows too), you can safely use this tool.  The command ‚ÄúSave‚Äù will save the file in the same place where it was opened (that is, you don‚Äôt need to copy it to your disk, edit it and then upload it back). <br><br><h1>  Tricks with vPower </h1><br>  Let me remind those who do not know, and tell those who have forgotten. <br><br>  vPower is a Veeam technology designed to gain access to VM data in a backup, without the need to completely retrieve (unzip and rehydrate all data back).  It builds on the Veeam Instant VM Recovery feature to quickly restore access to a crashed VM, as well as other features, including virtual labs, file recovery for ‚Äúother OS‚Äù (not Windows), etc. <br><br>  The VMware vSphere platform uses its built-in NFS server (vPower NFS).  The principle of its operation is as follows.  Veeam Backup &amp; Replication registers with the ESXi host a new NFS storage.  Then, when restoring a VM, it extracts small VM files from the backup - vmx, nvram and others.  In this case, instead of disk files (vmdk), files are created link to them.  Next, Veeam Backup registers the VM in vSphere and gives the command to load it (if the corresponding option is enabled).  When the hypervisor accesses the VM disk file for a data block, Veeam Backup &amp; Replication removes the necessary block from the backup and gives it to the hypervisor.  This is how the VM is loaded and then running from the backup. <br><br>  And how else can this be used, if not to start the VM?  Well, for example, for the presentation of a disk to a VM in another machine.  In this use case, you need to remember a few points: <br><ol><li>  During recovery (be sure to restore to a new location, you do not want to overwrite the existing VM!) DO NOT enable the <b>Connect VM to network</b> and <b>Power on VM automatically</b> options. </li><li>  After the recovery process is completed, the current state in the log will be designated as <i>Waiting for user to start migration</i> . </li><li>  In the vSphere console to the desired running VM, start adding a new disk. </li><li>  Choose an existing one. </li><li>  Find the desired disk presented from the backup VM on the datastore [VeeamBackup_ &lt;server_name&gt;]. </li><li>  And confirm its addition. </li><li>  Inside the VM, initialize, if necessary, and use this disk. </li><li>  Profit! </li></ol><br>  A few more important notes: <br><ul><li>  It is desirable to perform recovery on the same host where the target VM is located to which you want to attach the disk.  Otherwise, you may not see vPower NFS-storage - in the event that the host has never recovered. </li><li>  Do not attempt to attach the drive to the same VM with which this vPower NFS service is running (that is, to the Veeam repository) - you will get an error. </li><li>  If you write something to such a disk, the data will not be backed up.  New data will be saved to disk if you do not cancel Instant VM Recovery.  After migration of such disks data is saved in it permanently. </li><li>  Storage vMotion for the VM to which such a disk is attached will help to transfer this disk to the main storage system (in this case it will migrate along with new data). </li><li>  And then do not forget to unregister the initially ‚Äúrecoverable‚Äù VM (i.e., make <b>Stop publishing</b> for Instant VM Recovery). </li></ul><br>  In this tricky way, you can quickly restore disk access and use it instead of restoring a separate vmdk disk with a connection to another VM.  You know that in Veeam Backup there is such a way to restore (restore and connect as a new SCSI disk), right? <br><br>  What else can be done with vPower NFS?  Go ahead! <br><br><h1>  Here you have the ball </h1><br>  Usually, VeeamBackup NFS is added once per ESXi host when performing the above operations.  When repeated operations, it is checked that this connection exists, and if you manually delete this connection (unmount datastore), Veeam Backup &amp; Replication reconnects it.  (Veeam Backup itself doesn‚Äôt delete it voluntarily, in order to save time during the next process.) It doesn‚Äôt make much sense to disconnect it, and being connected, it can help you in other cases.  So, it can be used as (suddenly!) NFS orb :) For example, you can put an ISO-shnik there or migrate VMs between ESXi hosts that are not connected by a shared storage. <br><br>  <i>Convenient:</i> migrate the folder for vPower NFS to a convenient, accessible for you place on the repository server (the default location is in <code>%ProgramData%</code> ). <br><br><img src="https://habrastorage.org/files/a29/d65/c9a/a29d65c9ad4c406d871680a2c6f125e0.png"><br><br>  Then it will be easier to put something into this folder on the Windows machine side.  And you can also share the folder - for convenient access from the outside. (Here is the idea: to check how VMware Workstation will work with such a disk.) <br><br>  Connect NFS to all hosts - this can be done manually by running the Instant VM Recovery recovery process on each host, and then canceling the restore (personally, this is not very convenient for me, especially with a large number of hosts).  Another option is to add NFS with server data in the VMware console on each host, as shown here (but this is also done manually): <br><br><img src="https://habrastorage.org/files/46c/d31/98d/46cd3198d5d34f64a0d57296ebc1b6ba.png"><br><br>  You can do the same through the <code>New-Datastore</code> (from <a href="https://www.vmware.com/support/developer/PowerCLI/PowerCLI41/html/New-Datastore.html">powercli</a> ).  For example, like this: <br><pre> <code class="bash hljs">Get-VMHost | New-Datastore -Nfs -Name VeeamBackup_vbr.domain.local -Path <span class="hljs-string"><span class="hljs-string">"/VeeamBackup_vbr.domain.local"</span></span> -NfsHost vbr.domain.local</code> </pre><br>  Well, if you want to delete all NFS datastores left over from Veeam Backup &amp; Replication, then there is a <a href="http://foonet.be/2015/12/04/auto-unmount-veeam-vpower-nfs-datastore/">script</a> for this purpose. <br><br><h1>  And instead of the conclusion - pre-Christmas wish </h1><br>  Sometimes we don‚Äôt even think that the software we use every day has capabilities that we don‚Äôt pay attention to - and they can help us in other, not quite ‚Äúour‚Äù everyday tasks. <br><br>  Everyone knows that in system administration most of the time routine tasks are taken away.  Think about how to automate them with the help of the tools that you already have at hand, and you will surely find how to use the available programs for their not entirely direct purpose.  Think, so to speak, different ... </div><p>Source: <a href="https://habr.com/ru/post/273757/">https://habr.com/ru/post/273757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273747/index.html">IBM is working on a project to create an open-source blockchain for business representatives.</a></li>
<li><a href="../273749/index.html">Weather Station on Arduino with data visualization</a></li>
<li><a href="../273751/index.html">bala.js - jQuery killer in less than 400 characters of code *</a></li>
<li><a href="../273753/index.html">ASP.NET 5 Identity 3 and new authentication / authorization toolkit</a></li>
<li><a href="../273755/index.html">Why I love so much EF, or features that are hard to give up</a></li>
<li><a href="../273759/index.html">Budget homemade TCP "on the knees" (mobile television station). Part 1</a></li>
<li><a href="../273765/index.html">As I wrote and published a book based on my posts with Habr</a></li>
<li><a href="../273771/index.html">Parallel calculations on CPU and GPU</a></li>
<li><a href="../273773/index.html">3D-lab for people from MIEM, sling their heads inside the prototype trace of printed circuit boards</a></li>
<li><a href="../273775/index.html">The design decision is made by the designer.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>