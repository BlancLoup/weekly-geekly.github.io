<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Urho3D: Materials</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The graphics subsystem is probably the most complex and confusing part of the engine. And at the same time, this is the part in which you need to be v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Urho3D: Materials</h1><div class="post__text post__text-html js-mediator-article">  The graphics subsystem is probably the most complex and confusing part of the engine.  And at the same time, this is the part in which you need to be very well oriented.  You can easily handle the input, play sounds and not even think about how it is arranged inside there.  But a rare game will do without its own beautiful effects, and there is no need to do without a certain set of knowledge.  In one article it is impossible to cover the whole amount of information on this topic, but I hope that I can provide you with a base, relying on which you will master all the nuances and subtleties of the Urho3D render much easier. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b57/ea5/01d/b57ea501ded85af5bb6d28d3864f01c1.gif" alt="image"><br><a name="habracut"></a><br><h2>  For impatient </h2><br>  The result of the experiments is here: <a href="https://github.com/1vanK/Urho3DHabrahabr05">github.com/1vanK/Urho3DHabrahabr05</a> .  In the Demo folder of the demo itself (by moving the mouse you can rotate the model, the wheel turns the light source).  All added resources are separated from the engine files and are located in the Demo / MyData folder. <br><br><h2>  Considered version of the engine </h2><br>  Currently, integration into the PBR engine (Physically Based Rendering, physically correct rendering) is underway.  It will not add any significant changes to the engine itself, basically it‚Äôs just an additional set of shaders.  In addition, he has not yet settled down and in the final some things can change.  Therefore, in order to narrow the range of the information in question, I will rely on an older version of the engine (at the time of this writing, it was already out of date for ten days :). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Version of April 9, 2016.</b> <div class="spoiler_text"><pre><code class="hljs pgsql">::    git.exe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> "PATH=c:\Program Files (x86)\Git\bin\" ::   git clone https://github.com/Urho3D/Urho3D.git ::       cd Urho3D ::       (<span class="hljs-number"><span class="hljs-number">9</span></span>  <span class="hljs-number"><span class="hljs-number">2016</span></span>) git <span class="hljs-keyword"><span class="hljs-keyword">reset</span></span> <span class="hljs-comment"><span class="hljs-comment">--hard 4c8bd3efddf442cd31b49ce2c9a2e249a1f1d082 ::   ENTER    pause</span></span></code> </pre> </div></div><br><h2>  Importing a model </h2><br>  For the experiments, I decided to take the <a href="http://www.dota2.com/workshop/requirements/Abaddon">Abaddon</a> model from the Dota 2 game. Here there are both texture maps that Urho3D supports ‚Äúout of the box‚Äù and those specific to the Source 2 engine. We will not disregard them either.  Which card is responsible for what you can see in <a href="http://media.steampowered.com/apps/dota2/workshop/Dota2ShaderMaskGuide.pdf">this document</a> .  But before we deal with the materials, we need to transform the model into the format understood by Urho3D.  This can be done in different ways. <br><br>  Included with the engine comes a utility AssetImporter, which allows you to import models from a variety of formats.  It can be found in the bin / tool folder.  The "AssetImporter.exe model abaddon_econ.fbx abaddon.mdl -t" command combines all the model fragments into a single whole (the model is divided into fbx-file).  Be sure to include the "-t" option if you are going to use normal maps (this parameter adds information about tangents to model vertices).  The ‚ÄúAssetImporter.exe node abaddon_econ.fbx abaddon.xml -t‚Äù command will save the model as a prefab, in which parts of the model are organized as a hierarchy of nodes.  Since there are no textures assigned to the model in this fbx file, the materials will have to be created manually. <br><br>  You can import a model directly from the editor (File&gt; Import model ...).  In this case, the same AssetImporter utility is used.  The "-t" option is enabled by default.  The remaining parameters can be specified in the View&gt; Editor settings window. <br><br>  For fans of Blender there is a separate exporter.  And he is great.  Download the <a href="https://github.com/reattiva/Urho3D-Blender">addon</a> , install it and open the already prepared <a href="https://github.com/1vanK/Urho3DHabrahabr05/tree/master/Blend">Abaddon.blend</a> file (I left only the horse from the model and created the material for it).  Specify the path where you want to save the result, check the settings (do not forget about tangents) and click the Export button. <br><br><img src="https://habrastorage.org/files/7ba/063/8d0/7ba0638d01144752950c7ba55d42e4e8.png"><br><br>  The first thing that catches your eye when opening a model in the Urho3D editor is the white legs of a horse.  The fact is that Blender interprets the glow map as intensity (black and white image), and the Urho3D engine as color.  You can fix the glow map itself (for example, in the IMP multiply it with a diffuse map), but we are not looking for easy ways and we will change the Urho3D shader to adapt it to the Source 2 engine texture set. But it will be later, but for now, to see the model in a more pleasant way, you can change the value of the glow factor MatEmissiveColor to ‚Äú0 0 0‚Äù in the material parameters (abaddon_mount.xml file), or delete this line altogether (just do not forget to return everything back, we still need this parameter).  By the way, when you modify and save a material file, the editor automatically picks up the new version and updates its viewport.  Moreover, it works even for shaders.  You can write a shader and watch the result of their work in real time. <br><br><h2>  Rendering process </h2><br>  The rendering process in Urho3D is described using a set of text files: renderers (CoreData / RenderPaths / *. Xml), a technician (CoreData / Techniques / *. Xml) and shaders (CoreData / Shaders / GLSL / *. Glsl or CoreData / Shaders / HLSL * .hlsl).  Once you understand the relationship between them, the rest will not be difficult to figure out. <br><br>  So, each object of the scene in most cases is rendered several times using different shaders (the so-called render passes).  Which set of passes (shaders) is required to draw each object is described in the technique.  In what order these passes (shaders) will be executed, described in the renderpas.  Once again I draw your attention: the order of the lines in the technique is not important. <br><br>  There are also materials (Data / Materials / *. Xml).  The material determines which technique will be used for the object, and also fills this technique with specific content, that is, determines the data that will be transferred to the shaders: textures, colors, etc. <br><br>  That is, the set of renderpas + technology + shaders can be represented as an algorithm, and the material - as a data set for this algorithm. <br><br>  To understand the procedure for calling shaders, take a look at this comparison label: <br><br><pre> <code class="hljs pgsql">//  //  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ; i++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ; i++) { { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; ; j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; ; j++) ([i], [j]); { } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([j]  [i]) ([j], [i]); } }</code> </pre><br>  If there is a passage in the technique, but there is no such passage in the renderpas, it will not be executed.  And vice versa, if there is some kind of pass in the renderpas, but it is absent in the technology, then it will not be executed either.  However, there are passages registered in the engine itself, which you will not find in the renderpas, but they will still be executed if they are in the technique. <br><br><h2>  Shaders </h2><br>  Urho3D supports both OpenGL and DirectX, so it contains two sets of shaders similar in functionality, which are located in the CoreData / Shaders / GLSL and CoreData / Shaders / HLSL folders.  Which API and, accordingly, which set of shaders will be used, is determined when compiling the engine.  I prefer OpenGL as more universal, so in this article I will focus on it. <br><br>  There are a lot of files in the CoreData / Shaders / GLSL folder, but you should pay particular attention to one of them - LitSolid.glsl.  This shader is used for the vast majority of materials.  Urho3D uses the Ubershader method, that is, from the huge universal shader LitSolid.glsl, defines are thrown out unnecessary pieces and a small fast specialized shader is obtained.  Define sets are specified in the techniques, and some defines are added by the engine itself. <br><br><h2>  Back to our horse </h2><br>  Currently, Urho3D supports 3 rendering methods: Forward (traditional), Light Pre-Pass and Deferred.  The differences between them are a topic for a separate conversation, so we just confine ourselves to the Forward method, which is used by default and described in CoreData / RenderPaths / Forward.xml. <br><br><div class="spoiler">  <b class="spoiler_title">After exporting from Blender, we received Materials Materials / abaddon_mount.xml.</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">&lt;material&gt; &lt;technique <span class="hljs-type"><span class="hljs-type">name</span></span>="Techniques/DiffNormalSpecEmissive.xml"/&gt; &lt;texture <span class="hljs-type"><span class="hljs-type">name</span></span>="Textures/abaddon_mount_color.tga" unit="diffuse"/&gt; &lt;texture <span class="hljs-type"><span class="hljs-type">name</span></span>="Textures/abaddon_mount_normal.tga" unit="normal"/&gt; &lt;texture <span class="hljs-type"><span class="hljs-type">name</span></span>="Textures/abaddon_mount_specmask.tga" unit="specular"/&gt; &lt;texture <span class="hljs-type"><span class="hljs-type">name</span></span>="Textures/abaddon_mount_selfillummask.tga" unit="emissive"/&gt; &lt;parameter <span class="hljs-type"><span class="hljs-type">name</span></span>="MatDiffColor" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="1 1 1 1"/&gt; &lt;parameter <span class="hljs-type"><span class="hljs-type">name</span></span>="MatSpecColor" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="1 1 1 50"/&gt; &lt;parameter <span class="hljs-type"><span class="hljs-type">name</span></span>="MatEmissiveColor" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="1 1 1"/&gt; &lt;/material&gt;</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">This material uses Techniques / DiffNormalSpecEmissive.xml technique.</b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">technique</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LitSolid"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ps</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LitSolid"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DIFFMAP"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"base"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EMISSIVEMAP"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"light"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vsdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NORMALMAP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NORMALMAP SPECMAP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">depthtest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"equal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">depthwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">blend</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"add"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"prepass"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vsdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NORMALMAP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PREPASS NORMALMAP SPECMAP"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"material"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MATERIAL SPECMAP EMISSIVEMAP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">depthtest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"equal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">depthwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"deferred"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vsdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NORMALMAP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DEFERRED NORMALMAP SPECMAP EMISSIVEMAP"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"depth"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Depth"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ps</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Depth"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shadow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Shadow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ps</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Shadow"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">technique</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  Since we will modify the technique, copy it into a separate Techniques / MyTechnique.xml file, so as not to affect other materials that may also use this technique.  In the material also change the name of the used equipment. <br><br>  The technique uses the standard for materials shader LitSolid.glsl.  Since we are going to change this shader, copy it in Shaders / GLSL / MyLitSolid.glsl.  Also change the name of the used shader in the technique.  At the same time, this technique can be simplified by throwing out too much.  Since the passages ‚Äúprepass‚Äù, ‚Äúmaterial‚Äù, ‚Äúdeferred‚Äù and ‚Äúdepth‚Äù are absent in the Forward renderpass (they are defined in other renderpasses), they will never be used.  However, leave the passage ‚Äúshadow‚Äù.  Although it is not in the renderpas, it is a built-in passage and is registered in the engine itself.  Without it, the horse will not cast shadows. <br><br><div class="spoiler">  <b class="spoiler_title">As a result, we have Techniques / MyTechnique.xml</b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">technique</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyLitSolid"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ps</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyLitSolid"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DIFFMAP"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"base"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EMISSIVEMAP"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"light"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vsdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NORMALMAP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">psdefines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NORMALMAP SPECMAP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">depthtest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"equal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">depthwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">blend</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"add"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pass</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shadow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Shadow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ps</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Shadow"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">technique</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  Let's work with our Shaders / GLSL / MyLitSolid.glsl shader now and change the way we use the glow map to the one we need.  Define EMISSIVEMAP (just signaling that the material should determine the glow map) in the shader is present in several places, and since the shader is disassembled line by line within the article does not work out, we will go the other way.  Defaults DEFERRED, PREPASS and MATERIAL will never be defined in the shader, since the passages in which they are defined are removed from the technology as unused.  Therefore, we boldly delete the code framed by them.  Shader size decreased by one third.  Define EMISSIVEMAP remained only in one place. <br><br>  Let's multiply the glow map with a diffuse color.  Replace line <br><br><pre> <code class="hljs vbscript">finalColor += cMatEmissiveColor * texture2D(sEmissiveMap, vTexCoord.xy).<span class="hljs-built_in"><span class="hljs-built_in">rgb</span></span>;</code> </pre> <br>  on line <br><br><pre> <code class="hljs vbscript">finalColor += cMatEmissiveColor * texture2D(sEmissiveMap, vTexCoord.xy).<span class="hljs-built_in"><span class="hljs-built_in">rgb</span></span> * diffColor.<span class="hljs-built_in"><span class="hljs-built_in">rgb</span></span>;</code> </pre> <br>  Now the horse's legs glow in the correct blue. <br><br>  For more beauty, let's add a bloom effect (a halo around the bright parts of the image).  It is implemented in two lines in the <a href="">script</a> : <br><br><pre> <code class="hljs sql">//  HDR-. renderer.hdrRendering = true; //   . viewport.renderPath.Append(cache.GetResource(<span class="hljs-string"><span class="hljs-string">"XMLFile"</span></span>, <span class="hljs-string"><span class="hljs-string">"PostProcess/BloomHDR.xml"</span></span>));</code> </pre><br>  Please note that the post-processing effect is added to the end of the render.  You can add it directly to the file. <br><br><h2>  Rim light </h2><br>  Highlighting the edges of the model - fake technique that simulates the light falling on the model behind.  In the Source 2 engine, a separate mask is used to identify the parts of the model on which you want to apply this effect. <br><br>  In order to transfer the texture to the shader, choose an unused texture unit.  Our material does not use the environment map, so we will use its slot.  Also in the shader, we will need two parameters RimColor and RimPower, so we immediately add them.  The final material looks like <a href="">this</a> .  This can sometimes be confusing, but the name of the texture unit does not have to match its use.  You are free to transfer whatever you like via texture units and apply it in your shaders as you like. <br><br>  The name of the uniform in the shader will differ from the name of the parameter in the material by the prefix ‚Äúc‚Äù (const): the RimColor parameter will become the cRimColor uniform, and the RimPower parameter will become the cRimPower uniform. <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cRimPower; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> vec3 cRimColor;</code> </pre><br>  This is how the implementation itself looks like: <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ RIM LIGHT /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  =   -  . vec3 viewDir = normalize(cCameraPosPS - vWorldPos.xyz); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      = 1. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     = 0. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,   ,      /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ (     ),    . /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      ,      . float rimFactor = 1.0 - clamp(dot(normal, viewDir), 0.0, 1.0); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  cRimPower &gt; 1,     . /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  cRimPower &lt; 1,      . /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  cRimPower = 0     ,        = 1. rimFactor = pow(rimFactor, cRimPower); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ ,     . #ifdef RIMMAP /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     . finalColor += texture2D(sEnvMap, vTexCoord.xy).rgb * cRimColor * rimFactor; #else finalColor += cRimColor * rimFactor; #endif</span></span></code> </pre><br>  Pay attention to the default RIMMAP.  You may want to not use the backlight map, but simply impose the effect on the entire model.  In this case, you simply do not define the RIMMAP in the technology.  By the way, do not forget to define the RIMMAP define in the technique :) The final technique looks like <a href="">this</a> , and the shader <a href="">does</a> . <br><br><h2>  Literature </h2><br>  <a href="http://urho3d.github.io/documentation/1.5/_rendering.html">urho3d.github.io/documentation/1.5/_rendering.html</a> <br>  <a href="http://urho3d.github.io/documentation/1.5/_a_p_i_differences.html">urho3d.github.io/documentation/1.5/_a_p_i_differences.html</a> <br>  <a href="http://urho3d.github.io/documentation/1.5/_shaders.html">urho3d.github.io/documentation/1.5/_shaders.html</a> <br>  <a href="http://urho3d.github.io/documentation/1.5/_render_paths.html">urho3d.github.io/documentation/1.5/_render_paths.html</a> <br>  <a href="http://urho3d.github.io/documentation/1.5/_materials.html">urho3d.github.io/documentation/1.5/_materials.html</a> <br>  <a href="http://urho3d.github.io/documentation/1.5/_rendering_modes.html">urho3d.github.io/documentation/1.5/_rendering_modes.html</a> </div><p>Source: <a href="https://habr.com/ru/post/281903/">https://habr.com/ru/post/281903/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281887/index.html">The interaction of software and hardware</a></li>
<li><a href="../281889/index.html">How to create a virtual infrastructure provider: Experience 1cloud</a></li>
<li><a href="../281895/index.html">How we implemented DevOps: release management in Visual Studio Team Services</a></li>
<li><a href="../281897/index.html">Quickly create MVP (minimum viable product) based on Microsoft Azure and Xamarin.Forms</a></li>
<li><a href="../281899/index.html">Deploying Django Stack on Ubuntu in Microsoft Azure Cloud</a></li>
<li><a href="../281905/index.html">Ershov's Birthday</a></li>
<li><a href="../281913/index.html">M2M in 5 minutes with DeviceHive and Microsoft Azure. How to start your journey in IoT</a></li>
<li><a href="../281915/index.html">How to send an email using Python: a guide for dummies</a></li>
<li><a href="../281917/index.html">The story of my participation in the Ubuntu Scope Showdown 2016</a></li>
<li><a href="../281919/index.html">Osliki.Net - social delivery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>