<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Apache Ignite: in-memory distributed computing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 We continue to be interested in new solutions from Apache. We expect to release Holden Karau‚Äôs ‚ÄúHigh Performance Spark‚Äù book in May (book...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Apache Ignite: in-memory distributed computing</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/tq/xl/j3/tqxlj3ff5ztpp5xhzzvnr4tvfok.png"><br><br>  Hi, Habr! <br><br>  We continue to be interested in new solutions from Apache.  We expect to release Holden Karau‚Äôs <a href="https://www.amazon.com/High-Performance-Spark-Practices-Optimizing/dp/1491943203/">‚ÄúHigh Performance Spark‚Äù</a> book in May (book in layout), and Nia NƒÅrhid‚Äôs book <a href="https://www.amazon.com/Kafka-Definitive-Real-Time-Stream-Processing/dp/1491936169/">‚ÄúKafka: The Definitive Guide‚Äù in</a> August (still in translation).  Today we want to offer a brief introductory article on Apache Ignite and assess the scale of interest in the topic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Enjoy reading! <br><a name="habracut"></a><br>  Apache Ignite is a relatively new solution, however, its popularity is growing rapidly.  It is difficult to attribute it to any particular sub-type of database engines, since the characteristics of Ignite are related to it with several tools.  The main purpose of this tool is to store distributed data in RAM, as well as to store information in a ‚Äúkey-value‚Äù format.  Ignite also has some common RDBMS functions, in particular, support for SQL queries and ACID transactions.  But this does not mean that this solution is a typical database for working with transactions in SQL.  Foreign key restrictions are not supported here, and transactions are only available at the ‚Äúkey-value‚Äù level.  However, Apache Ignite seems like a very interesting solution. <br><br>  Apache Ignite is easy to run as a node embedded in the Spring Boot application.  The easiest way to achieve this is with the Spring Data Ignite library.  Apache Ignite implements the Spring Data <code>CrudRepository</code> that supports basic CRUD operations, as well as providing access to the Apache Ignite SQL Grid grid using Spring Data unified interfaces.  Although it provides data storage in disk storage with SQL support and ACID paradigm, we developed a solution for storing RAM cache objects in MySQL database.  The architecture of the proposed solution is shown in the figure below - as you can see, it is very simple.  The application places the data in the cache memory, arranged in Apache Ignite.  Apache Ignite automatically synchronizes these changes with the database during an asynchronous background task.  The method of reading data in this application should not surprise you either.  If the entity is not cached, then it is read from the database and placed in the cache for the future. <br><br><img src="https://habrastorage.org/webt/jv/2q/l6/jv2ql6vrtyvzyo6ksugxpc73zru.png"><br><br>  Here I will describe in detail how this kind of application is developed.  The result is posted on GitHub.  I found some more examples on the Internet, but only the basics are affected.  I will show you how to configure Apache Ignite to write objects from the cache to the database, as well as how to create more complex join requests using multiple caches.  Start by starting the database. <br><br><h4>  1. Configure the MySQL database </h4><br>  To run the MySQL database locally, it is best to use the Docker container, of course.  The MySQL for Docker database for Windows is currently available at 192.168.99.100:33306. <br><br><pre> <code class="sql hljs"> docker run -d <span class="hljs-comment"><span class="hljs-comment">--name mysql -e MYSQL_DATABASE=ignite -e MYSQL_USER=ignite -e MYSQL_PASSWORD=ignite123 -e MYSQL_ALLOW_EMPTY_PASSWORD=yes -p 33306:3306 mysql</span></span></code> </pre> <br>  Next, create the tables used by the application storage entities: <code>PERSON</code> , <code>CONTACT</code> .  They refer to tables as 1 ... N, where the <code>CONTACT</code> table contains a foreign key pointing to the <code>PERSON id</code> . <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`person`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`first_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">45</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`last_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">45</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`gender`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`country`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`city`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`address`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">45</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`birth_date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`contact`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`location`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">45</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`contact_type`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`person_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ignite`</span></span>.<span class="hljs-string"><span class="hljs-string">`contact`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-string"><span class="hljs-string">`person_fk_idx`</span></span> (<span class="hljs-string"><span class="hljs-string">`person_id`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ASC</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ignite`</span></span>.<span class="hljs-string"><span class="hljs-string">`contact`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">`person_fk`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`person_id`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-string"><span class="hljs-string">`ignite`</span></span>.<span class="hljs-string"><span class="hljs-string">`person`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>;</code> </pre> <br><h4>  2. Configure Maven </h4><br>  To get started with the Spring Data repository for Apache Ignite, the easiest way is to add the following Maven dependency to the <code>pom.xml</code> file of our application.  All other Ignite dependencies will be included automatically.  We also need the MySQL JDBC driver and the Spring JDBC dependencies to configure the database connection.  They are necessary because we embed Apache Ignite into the application, and you need to connect to the MySQL database so that you can synchronize the cache with the database tables. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-web<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-jdbc<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>mysql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mysql-connector-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>runtime<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.ignite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>ignite-spring-data<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${ignite.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h4>  3. Configure the Ignite node </h4><br>  The <code>IgniteConfiguration</code> class allows you to configure all available Ignite node settings.  In this case, the most important cache configuration (1).  You should add master key and entity classes as indexed types (2).  Next, you need to provide for the export of cache updates to the database (3) and read from the database the information that is not in the cache (4).  The interaction between the Ignite node and MySQL can be configured using the <code>CacheJdbcPojoStoreFactory</code> (5) class.  There you need to pass the <code>DataSource @Bean</code> (6), the dialect (7) and the correspondence between the fields of the object and the columns of the table (8). <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Ignite </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">igniteInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ IgniteConfiguration cfg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteConfiguration(); cfg.setIgniteInstanceName(<span class="hljs-string"><span class="hljs-string">"ignite-1"</span></span>); cfg.setPeerClassLoadingEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); CacheConfiguration&lt;Long, Contact&gt; ccfg2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CacheConfiguration&lt;&gt;(<span class="hljs-string"><span class="hljs-string">"ContactCache"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// (1) ccfg2.setIndexedTypes(Long.class, Contact.class); // (2) ccfg2.setWriteBehindEnabled(true); ccfg2.setWriteThrough(true); // (3) ccfg2.setReadThrough(true); // (4) CacheJdbcPojoStoreFactory&lt;Long, Contact&gt; f2 = new CacheJdbcPojoStoreFactory&lt;&gt;(); // (5) f2.setDataSource(datasource); // (6) f2.setDialect(new MySQLDialect()); // (7) JdbcType jdbcContactType = new JdbcType(); // (8) jdbcContactType.setCacheName("ContactCache"); jdbcContactType.setKeyType(Long.class); jdbcContactType.setValueType(Contact.class); jdbcContactType.setDatabaseTable("contact"); jdbcContactType.setDatabaseSchema("ignite"); jdbcContactType.setKeyFields(new JdbcTypeField(Types.INTEGER, "id", Long.class, "id")); jdbcContactType.setValueFields(new JdbcTypeField(Types.VARCHAR, "contact_type", ContactType.class, "type"), new JdbcTypeField(Types.VARCHAR, "location", String.class, "location"), new JdbcTypeField(Types.INTEGER, "person_id", Long.class, "personId")); f2.setTypes(jdbcContactType); ccfg2.setCacheStoreFactory(f2); CacheConfiguration&lt;Long, Person&gt; ccfg = new CacheConfiguration&lt;&gt;("PersonCache"); ccfg.setIndexedTypes(Long.class, Person.class); ccfg.setWriteBehindEnabled(true); ccfg.setReadThrough(true); ccfg.setWriteThrough(true); CacheJdbcPojoStoreFactory&lt;Long, Person&gt; f = new CacheJdbcPojoStoreFactory&lt;&gt;(); f.setDataSource(datasource); f.setDialect(new MySQLDialect()); JdbcType jdbcType = new JdbcType(); jdbcType.setCacheName("PersonCache"); jdbcType.setKeyType(Long.class); jdbcType.setValueType(Person.class); jdbcType.setDatabaseTable("person"); jdbcType.setDatabaseSchema("ignite"); jdbcType.setKeyFields(new JdbcTypeField(Types.INTEGER, "id", Long.class, "id")); jdbcType.setValueFields(new JdbcTypeField(Types.VARCHAR, "first_name", String.class, "firstName"), new JdbcTypeField(Types.VARCHAR, "last_name", String.class, "lastName"), new JdbcTypeField(Types.VARCHAR, "gender", Gender.class, "gender"), new JdbcTypeField(Types.VARCHAR, "country", String.class, "country"), new JdbcTypeField(Types.VARCHAR, "city", String.class, "city"), new JdbcTypeField(Types.VARCHAR, "address", String.class, "address"), new JdbcTypeField(Types.DATE, "birth_date", Date.class, "birthDate")); f.setTypes(jdbcType); ccfg.setCacheStoreFactory(f); cfg.setCacheConfiguration(ccfg, ccfg2); return Ignition.start(cfg); }</span></span></code> </pre> <br>  Here is the Spring data source configuration for MySQL as a Docker container. <br><br> <code>spring: <br> datasource: <br> name: mysqlds <br> url: jdbc:mysql://192.168.99.100:33306/ignite?useSSL=false <br> username: ignite <br> password: ignite123</code> <br> <br>  It should be noted here that Apache Ignite is not without some drawbacks.  For example, it maps <code>Enum</code> to an integer and takes its ordinal value, although it configures VARCHAR as a JDCB type.  When such a row is read from the database, it is incorrectly displayed on Enum in the object ‚Äî in this response field you will get <code>null</code> . <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JdbcTypeField(Types.VARCHAR, <span class="hljs-string"><span class="hljs-string">"contact_type"</span></span>, ContactType.class, <span class="hljs-string"><span class="hljs-string">"type"</span></span>)</code> </pre> <br><h4>  4. Objects of the model </h4><br>  As mentioned above, there are two tables in our database schema.  There are still two model classes and two cache configurations, one for each model class.  Below is the implementation of the model class.  One of the most interesting things worth noting here is ID generation using the <code>AtomicLong</code> class.  This is one of the basic components of Ignite, which serves as a sequence generator.  We also see the specific <code>@QuerySqlField</code> annotation;  if it accompanies a field, this means that this field can be used in SQL as a query parameter. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@QueryGroupIndex</span></span>.List( <span class="hljs-meta"><span class="hljs-meta">@QueryGroupIndex</span></span>(name=<span class="hljs-string"><span class="hljs-string">"idx1"</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">1271194616130404625L</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AtomicLong ID_GEN = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AtomicLong(); <span class="hljs-meta"><span class="hljs-meta">@QuerySqlField</span></span>(index = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@QuerySqlField</span></span>(index = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@QuerySqlField</span></span>.Group(name = <span class="hljs-string"><span class="hljs-string">"idx1"</span></span>, order = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String firstName; <span class="hljs-meta"><span class="hljs-meta">@QuerySqlField</span></span>(index = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@QuerySqlField</span></span>.Group(name = <span class="hljs-string"><span class="hljs-string">"idx1"</span></span>, order = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String lastName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Gender gender; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date birthDate; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String country; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String city; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String address; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Contact&gt; contacts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = ID_GEN.incrementAndGet(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFirstName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> firstName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFirstName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String firstName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.firstName = firstName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lastName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastName = lastName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Gender </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gender; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Gender gender)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gender = gender; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Date </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBirthDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> birthDate; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBirthDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date birthDate)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.birthDate = birthDate; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCountry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> country; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCountry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String country)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.country = country; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> city; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String city)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.city = city; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> address; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String address)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.address = address; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Contact&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contacts; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setContacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Contact&gt; contacts)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.contacts = contacts; } }</code> </pre> <br><h4>  5. Ignite repositories </h4><br>  I guess you know how repositories are created in Spring Data JPA.  Repository processing must be provided in the <code>main</code> class or <code>@Configuration</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableIgniteRepositories</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteRestApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> DataSource datasource; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(IgniteRestApplication.class, args); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  Then we extend our <code>@Repository</code> interface <code>@Repository</code> base <code>CrudRepository</code> interface.  It supports only inherited methods with the <code>id</code> parameter.  In the <code>PersonRepository</code> snippet <code>PersonRepository</code> I defined several search methods using the Spring Data naming conventions and Ignite queries.  These examples demonstrate that you can return in the query results either a full object or selected fields from it, depending on what we need. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RepositoryConfig</span></span>(cacheName = <span class="hljs-string"><span class="hljs-string">"PersonCache"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByFirstNameAndLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String firstName, String lastName)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"SELECT c.* FROM Person p JOIN \"ContactCache\".Contact c ON p.id=c.personId WHERE p.firstName=? and p.lastName=?"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Contact&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">selectContacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String firstName, String lastName)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"SELECT p.id, p.firstName, p.lastName, c.id, c.type, c.location FROM Person p JOIN \"ContactCache\".Contact c ON p.id=c.personId WHERE p.firstName=? and p.lastName=?"</span></span>) List&lt;List&lt;?&gt;&gt; selectContacts2(String firstName, String lastName); }</code> </pre><br><h4>  6. API and Testing </h4><br>  Now you can embed the repository components in the classes of REST controllers.  The API will provide methods for adding new objects to the cache, updating or deleting existing objects, and also for searching by the primary key or by other, more complex indexes. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/person"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(PersonController.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> PersonRepository repository; <span class="hljs-meta"><span class="hljs-meta">@PostMapping</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Person </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody Person person)</span></span></span><span class="hljs-function"> </span></span>{ person.init(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.save(person.getId(), person); } <span class="hljs-meta"><span class="hljs-meta">@PutMapping</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Person </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody Person person)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.save(person.getId(), person); } <span class="hljs-meta"><span class="hljs-meta">@DeleteMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/{id}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ repository.delete(id); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/{id}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Person </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long id) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findOne(id); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/{firstName}/{lastName}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"firstName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String firstName, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PathVariable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"lastName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String lastName) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findByFirstNameAndLastName(firstName, lastName); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/contacts/{firstName}/{lastName}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByNameWithContacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"firstName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String firstName, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PathVariable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"lastName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String lastName) </span></span>{ List&lt;Person&gt; persons = repository.findByFirstNameAndLastName(firstName, lastName); List&lt;Contact&gt; contacts = repository.selectContacts(firstName, lastName); persons.stream().forEach(it -&gt; it.setContacts(contacts.stream().filter(c -&gt; c.getPersonId().equals(it.getId())).collect(Collectors.toList()))); LOGGER.info(<span class="hljs-string"><span class="hljs-string">"PersonController.findByIdWithContacts: {}"</span></span>, contacts); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> persons; } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/contacts2/{firstName}/{lastName}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByNameWithContacts2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"firstName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String firstName, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PathVariable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"lastName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String lastName) </span></span>{ List&lt;List&lt;?&gt;&gt; result = repository.selectContacts2(firstName, lastName); List&lt;Person&gt; persons = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (List&lt;?&gt; l : result) { persons.add(mapPerson(l)); } LOGGER.info(<span class="hljs-string"><span class="hljs-string">"PersonController.findByIdWithContacts: {}"</span></span>, result); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> persons; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Person </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;?&gt; l)</span></span></span><span class="hljs-function"> </span></span>{ Person p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(); Contact c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Contact(); p.setId((Long) l.get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); p.setFirstName((String) l.get(<span class="hljs-number"><span class="hljs-number">1</span></span>)); p.setLastName((String) l.get(<span class="hljs-number"><span class="hljs-number">2</span></span>)); c.setId((Long) l.get(<span class="hljs-number"><span class="hljs-number">3</span></span>)); c.setType((ContactType) l.get(<span class="hljs-number"><span class="hljs-number">4</span></span>)); c.setLocation((String) l.get(<span class="hljs-number"><span class="hljs-number">4</span></span>)); p.addContact(c); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p; } }</code> </pre> <br>  Of course, it is important to check the performance of the created solution, especially when it is associated with the storage of distributed data in RAM and with databases.  To do this, I wrote several junit tests that put a large number of objects in the cache, and then calling the search methods (random data is used for input) - this is how the query performance is checked.  Here is a method that generates many <code>Person</code> and <code>Contact</code> objects and caches them using the endpoint API. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testAddPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InterruptedException </span></span>{ ExecutorService es = Executors.newCachedThreadPool(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; j++) { es.execute(() -&gt; { TestRestTemplate restTemplateLocal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestRestTemplate(); Random r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">1000000</span></span>; i++) { Person p = restTemplateLocal.postForObject(<span class="hljs-string"><span class="hljs-string">"http://localhost:8090/person"</span></span>, createTestPerson(), Person.class); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = r.nextInt(<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; x; k++) { restTemplateLocal.postForObject(<span class="hljs-string"><span class="hljs-string">"http://localhost:8090/contact"</span></span>, createTestContact(p.getId()), Contact.class); } } }); } es.shutdown(); es.awaitTermination(<span class="hljs-number"><span class="hljs-number">60</span></span>, TimeUnit.MINUTES); }</code> </pre> <br>  Spring Boot provides methods for capturing key features that allow you to judge the speed of the API response.  To activate this feature, you need to enable <code>Spring Actuator</code> dependencies.  The Metrics endpoint is available at <a href="http://localhost/">localhost</a> : 8090 / metrics.  It not only shows how much time each API method spends on its work, but also displays statistics on such indicators as the number of active threads or free memory. <br><br><h4>  7. Run the application </h4><br>  Now let's run the application we got, which has the Apache Ignite node embedded in it.  I took into account the performance tips that are contained in the Ignite documentation and determined the JVM configuration shown below. <br><br><pre> <code class="java hljs"> java -jar -Xms512m -Xmx1024m -XX:MaxDirectMemorySize=<span class="hljs-number"><span class="hljs-number">256</span></span>m -XX:+DisableExplicitGC -XX:+UseG1GC target/ignite-rest-service-<span class="hljs-number"><span class="hljs-number">1.0</span></span>-SNAPSHOT.jar</code> </pre> <br>  You can now run the test class <code>JUnit IgniteRestControllerTest</code> .  It caches a certain amount of data, and then calls the search methods.  Parameters for tests are given, where 1M <code>Person</code> objects and 2.5M <code>Contact</code> objects are used in the cache.  Each search method is performed on average over 1 ms. <br><br><pre> <code class="java hljs"> { <span class="hljs-string"><span class="hljs-string">"mem"</span></span>: <span class="hljs-number"><span class="hljs-number">624886</span></span>, <span class="hljs-string"><span class="hljs-string">"mem.free"</span></span>: <span class="hljs-number"><span class="hljs-number">389701</span></span>, <span class="hljs-string"><span class="hljs-string">"processors"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"instance.uptime"</span></span>: <span class="hljs-number"><span class="hljs-number">2446038</span></span>, <span class="hljs-string"><span class="hljs-string">"uptime"</span></span>: <span class="hljs-number"><span class="hljs-number">2466661</span></span>, <span class="hljs-string"><span class="hljs-string">"systemload.average"</span></span>: -<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"heap.committed"</span></span>: <span class="hljs-number"><span class="hljs-number">524288</span></span>, <span class="hljs-string"><span class="hljs-string">"heap.init"</span></span>: <span class="hljs-number"><span class="hljs-number">524288</span></span>, <span class="hljs-string"><span class="hljs-string">"heap.used"</span></span>: <span class="hljs-number"><span class="hljs-number">133756</span></span>, <span class="hljs-string"><span class="hljs-string">"heap"</span></span>: <span class="hljs-number"><span class="hljs-number">1048576</span></span>, <span class="hljs-string"><span class="hljs-string">"threads.peak"</span></span>: <span class="hljs-number"><span class="hljs-number">107</span></span>, <span class="hljs-string"><span class="hljs-string">"threads.daemon"</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-string"><span class="hljs-string">"threads.totalStarted"</span></span>: <span class="hljs-number"><span class="hljs-number">565</span></span>, <span class="hljs-string"><span class="hljs-string">"threads"</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, ... <span class="hljs-string"><span class="hljs-string">"gauge.response.person.contacts.firstName.lastName"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"gauge.response.contact"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"gauge.response.person.firstName.lastName"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"gauge.response.contact.location.location"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"gauge.response.person.id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"gauge.response.person"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.status.200.person.id"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.status.200.person.contacts.firstName.lastName"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.status.200.person.firstName.lastName"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.status.200.contact"</span></span>: <span class="hljs-number"><span class="hljs-number">2500806</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.status.200.person"</span></span>: <span class="hljs-number"><span class="hljs-number">1000000</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.status.200.contact.location.location"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span> }</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/352070/">https://habr.com/ru/post/352070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352060/index.html">Accelerating the enumeration of processes and threads in Windows</a></li>
<li><a href="../352062/index.html">How to explain to relatives who you are in the IT world on the example of buns</a></li>
<li><a href="../352064/index.html">Bluebird: belt with tools for the asynchronist</a></li>
<li><a href="../352066/index.html">New solution for maintaining the availability of IT infrastructure: Veeam Availability Orchestrator</a></li>
<li><a href="../352068/index.html">Installing Facebook image recognition package. All rake in one place</a></li>
<li><a href="../352072/index.html">The end of procrastination or what is ICIGAI?</a></li>
<li><a href="../352074/index.html">A tale about how an HTTP / 2 Client engineer overclocked</a></li>
<li><a href="../352076/index.html">Immigration in Chile: finding a job and obtaining a residence permit</a></li>
<li><a href="../352078/index.html">How to make a report on the identified vulnerability</a></li>
<li><a href="../352080/index.html">FastTrack Training. "Network Basics". "Understanding Cisco Architectural Games (Overview)". Eddie Martin December 2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>