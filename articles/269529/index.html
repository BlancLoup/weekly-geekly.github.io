<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco switch stacking. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article (it will consist of two parts) I would like to briefly go through the basic stacking technologies of Cisco switches. Let's try to deal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco switch stacking. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/184/f51/999/184f5199938048dba967095a53a71712.jpg"><br><br>  In this article (it will consist of two parts) I would like to briefly go through the basic stacking technologies of Cisco switches.  Let's try to deal with the overall packet transfer architecture within each type of stack, the response to failures, as well as throughput numbers.  In the first part, we look at the StackWise and StackWise Plus technologies.  In the second part - StackWise-160, StackWise-480, FlexStack and FlexStack Plus. <br><a name="habracut"></a><br>  Now you won't surprise anyone with stacking functionality.  He is in many models of switches from different manufacturers, including Cisco.  But it was not always so.  At the dawn of my career (somewhere in the middle of two thousandths) in the field of network technologies, Cisco had only one switchboard with support for a full stack.  It was a model of the Cisco 3750 switch. Pseudo stacks based on 2950 and 3550 had practically died at that time.  At that time, I, as a young specialist, was very surprised by the fact that Cisco paid so little attention to the issue of stacking switches.  At the same time, for example, with 3com switches (note purchased by HP), which at that time were quite popular, stacking was supported on a sufficiently large list of models.  Allied Telesis also had things to do.  I even remember how followers of Cisco products explained to me that stacking is bad, and this technology should not be used in production.  It is a pity, I do not remember the exact wording, but it was sort of about job stability.  It is worth noting that at that time the main arguments in favor of stacking were the simplification of management (in any case, at that time it seemed to me exactly that way).  Those.  instead of configuring two or more devices separately, the stack allows us to get one large switch. <br><br>  Time went by.  Many realized the advantages of stacking.  And now, most Cisco switches support this technology.  Currently, speaking of stacking, it is worthwhile to separate the stack at the access level (where we connect regular users) and the stack in all other cases. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the first case, the main reason for merging switches into a stack is to simplify administration.  At some point in time, it even began to seem to me that this is no longer relevant and is more a marketing point.  But not so long ago in communicating with the customer, who has a large fleet of <s>car</s> network devices, I found out that this was the main reason for integrating switches into a stack at the access level. <br><br>  In all other cases, in my opinion, the main ‚Äúin favor‚Äù in favor of the stack was the possibility of organizing a relatively inexpensive network fault tolerance scheme (both at the network core level and when connecting server hardware).  The stack allows us to aggregate the physical channels wound on different switches into one logical one.  This provides us not only with greater bandwidth (due to the utilization of several channels simultaneously) and fault tolerance (the failure of one of the stack switches does not cause the network to stop), but in some cases it gives the opportunity to completely abandon loops.  So from the use of protocols of the STP family.  Those.  simplifies life by making the network topology quite simple. <br><br>  On Cisco equipment, several stacking technologies are used depending on the platform.  A small note.  We will consider classical stacking schemes.  VSS technology will remain behind the scenes. <br><table width="1000"><tbody><tr><th width="200">  Technology </th><th width="200">  Platform </th><th width="200">  Number of switches in the stack </th><th width="200">  Total bus bandwidth </th><th width="200">  The need for a stack set </th></tr><tr><td>  Stackway </td><td>  3750, 3750G </td><td>  9 </td><td>  32 Gbps </td><td>  Not </td></tr><tr><td>  StackWise Plus </td><td>  3750-E, 3750-X </td><td>  9 </td><td>  64 Gbps </td><td>  Not </td></tr><tr><td>  StackWise-160 </td><td>  3650 </td><td>  9 </td><td>  160 Gbit / s </td><td>  Yes </td></tr><tr><td>  StackWise-480 </td><td>  3850 </td><td>  9 </td><td>  480 Gbps </td><td>  Not </td></tr><tr><td>  Flexstack </td><td>  2960-S, 2960-SF </td><td>  four </td><td>  40 Gbps </td><td>  Yes </td></tr><tr><td>  FlexStack Plus </td><td>  2960-X, 2960-XR </td><td>  eight </td><td>  80 Gbps </td><td>  Yes </td></tr></tbody></table>  I suggest a little more to deal with the numbers of the total bandwidth of the stack bus, as well as the general architecture of packet transmission within each type of stack.  I would like to clarify that by a stack bus we mean the internal interfaces and ports that provide stacking.  Its performance is the total effective throughput of all stack ports.  Why am I not talking about the overall performance of the stack?  This is due to the fact that in most technologies, when performing packet switching between internal ports of one switch, only internal logic (switching fabric, ASIC, etc.) is used.  In this case, the packet does not fall on the stack bus.  The stacked bus is utilized only when the packet gets to the port of one switch and goes through the port of another switch stack. <br><br>  <b>Stackway</b> <br><br>  Consider the StackWise technology.  She is the oldest among the rest.  To connect switches into a stack using the StackWise technology, a specialized stack cable is used.  At the same time, there is no separate stack module, the stack ports are immediately integrated into the switch (two ports each). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0f5/127/0d3/0f51270d31b249d4a0e36e51f0ad0680.jpg" alt="Stack stackwise"></div><br>  The bandwidth of a stacked cable is 16 Gbps (in each direction).  Since each switch has two stack ports, the throughput of the stack bus must be: <br><br>  16 Gbit / s * 2 (in each direction) * 2 (number of ports) = 64 Gbit / s <br><br>  We look in the specification, and there 32 Gbit / s.  Where did half the bandwidth go? <br><br>  In the 3750 (3750v2) and 3750G switches, there is no dedicated internal switching fabric per se (the old shared-ring switch fabric architecture is used).  Stack ports are connected directly to the internal bus switch, becoming its continuation.  Thus, switches of one stack have one big bus in the form of a ring.  This bus at the logical level represents two paths in the form of a ring each. <br><br>  The capacity of each of them is 16 Gbit / s.  These paths are multidirectional: packets are transmitted through them in opposite directions.  Since we have a common bus for the whole stack, a packet, hitting the port of any switch of the stack, will pass not only through all the internal ASICs, but through the whole stack ring, even if the outgoing port is on the same switch as the incoming .  And the package will be removed from the bus, only when it passes the whole circle and comes back.  This allows ASIC, who ‚Äúcaptured‚Äù one of the paths, to learn that the packet has reached and the path can be freed.  Such an algorithm can be called "deletion by the sender" (in terms of Cisco - Source stripped).  The choice of the way to send a packet is determined based on the availability of each of them (the token mechanism is used: the ASIC that possesses the token transfers data). <br><br>  Let's look at this with an example (Fig. 2).  In our case, the packet, hitting the switch port (1), falls on the ASIC, which in turn selects the blue path (2) (for example, it was free at this moment).  Then the packet goes along the blue path through all the switches (3), eventually getting to the switch where the destination port is located (4).  The switch sends a copy of the packet (5) through its local port.  But the packet itself continues its journey through the stack ring (6) until it reaches the ASIC that originally sent it (7).  Only there it will be removed from the stack bus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f94/c44/17b/f94c4417bd4b46cdae841dd9bd29246b.jpg"></div><br>  Thus, the same packet passes 2 times through the stack ports of the switch (first through one (3), then through the second (6) ports).  So our total usable bandwidth of the stack bus is 32 Gbit / s (exactly two times less than the physical one). <br><br>  And what will happen if one of the stack switches fails?  In this case, the paths are closed on each other, thereby forming one large ring (Fig. 3).  The switches will also behave exactly if one of the stacking cables is disconnected. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/147/907/252/147907252f514bafb0f21809eff56694.jpg"></div><br>  It is worth noting two more points.  Two paths "spin" in different directions.  I assume that this is done to average the packet transfer delay inside the stack.  The second point is that, for Stackwise, the throughput of the stacked bus is equal to the overall performance of the stack, due to the fact that all switches in the stack use one common bus. <br><br>  <b>StackWise Plus</b> <br><br>  Let's turn to the technology StackWise Plus.  In the 3750E and 3750X switches, a dedicated switch fabric has been added.  This allows local switching of packets without their occurrence in the stack ring.  Stack ports are plugged directly into the switch fabric.  Now the switching fabric is directly responsible for the logic of working with the stack bus.  In the case of StackWise technology with a stack bus, each ASIC worked separately. <br><br>  The StackWise Plus technology used a new algorithm for processing packets in the stack - ‚Äúrecipient deletion‚Äù (in terms of Cisco, Destination stripped, another name is Spatial reuse).  In this algorithm, the packet is removed from the stack bus as soon as it reaches the switch on which the outgoing port is located (Figure 4).  Now, a small Ack packet (8 bits) is used to signal that the path can be freed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/395/3a2/72e/3953a272efa643779c133f8b79800972.jpg"></div><br>  As in the Stackwise technology, logically, we still have two ways.  But since now the switching factory is responsible for working with the stack ring, the mechanism for working with these paths has become more complicated.  As before, access to this or that path is performed using the token mechanism.  After receiving the token, the switching factory can transmit packets along the stack ring.  And since the packages are taken directly from each ASIC, the credit mechanism is responsible for the maintenance of each ASIC.  They are distributed by the switching factory. <br><br>  These innovations made it possible to increase the capacity of the stack bus to marketing 64 Gb / s, by equating the useful capacity to the physical.  Now the packet passes only once through the stack port of the switch.  I would like to note that both technologies (Stackwise and StackWise Plus) use the same types of stack cables. <br><br>  It is worth emphasizing that the bandwidth of the stack bus did not become equal to 64 Gb / s, it began to strive for this figure.  Why?  The reason is that all broadcast, multicast and unknown unicast traffic continues to be processed using the Source stripped algorithm.  Those.  these types of traffic go through the entire ring before they are removed from the stack bus.  This means that double bandwidth is spent on these types of traffic. <br><br>  You can use any 3750 series switches in one stack. If you add, for example, 3750v2 switches (support StackWise) and 3750X (StackWise Plus) to a single stack, the stack will work using the StackWise technology (Source stripped algorithm).  In this case, for the 3750X, packet switching between local ports will be carried out only inside the switch without appearing on the stack bus.  For 3750v2 switches, the packets between the local ports will pass through the stack bus in the old fashioned way. <br><br>  Let's briefly touch the stack operation scheme at the program level.  Within the framework of the StackWise or StackWise Plus stack, one of the switches is selected as the master.  It performs logic operations (control-plane) for the entire stack.  If it fails, the transfer of unicast traffic continues.  This is achieved through synchronization of hardware tables.  The MAC table and the Cisco Express Forwarding (CEF) tables, namely FIB and Adjacency table, are synchronized between the stack switches.  But the rest of the tables, including the routing table, the multicast traffic transfer table, are filled in again on the new master.  In this case, it is possible to use the NSF functional - Nonstop Forwarding.  Those.  The control-plane on the new master starts from scratch. <br><br>  On this I propose to interrupt.  <a href="http://habrahabr.ru/company/cbs/blog/269629/">Continuation</a> will appear in the coming days. </div><p>Source: <a href="https://habr.com/ru/post/269529/">https://habr.com/ru/post/269529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269517/index.html">Integrating Admob Native Ads into ListView</a></li>
<li><a href="../269519/index.html">Cryptanalysis "Enigma"</a></li>
<li><a href="../269521/index.html">German intelligence agencies have discovered new traces of the Regin virus</a></li>
<li><a href="../269525/index.html">HackerSIM: Debriefing</a></li>
<li><a href="../269527/index.html">Participation in the competition LudumDare # 33</a></li>
<li><a href="../269531/index.html">Why writing scripts to fight Amigo browser is evil?</a></li>
<li><a href="../269533/index.html">Undocumented app in Thinstation</a></li>
<li><a href="../269535/index.html">PC Tuneup feature in Panda antivirus to optimize PC performance</a></li>
<li><a href="../269537/index.html">Manual editing of uboot-elf in the name of DHCP and SSH</a></li>
<li><a href="../269541/index.html">UnityEditor, dynamic content editor component</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>