<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Tsearch2 in PostgreSQL 8.3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many in the implementation of site search have to make a query to the database using the operator LIKE or regular expressions. 
 With the release of P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Tsearch2 in PostgreSQL 8.3</h1><div class="post__text post__text-html js-mediator-article">  Many in the implementation of site search have to make a query to the database using the operator <a href="http://www.postgresql.org/docs/8.3/interactive/functions-matching.html">LIKE</a> or regular expressions. <br>  With the release of <a href="http://www.postgresql.org/">PostgreSQL 8.3</a> , the full-text search module <a href="http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/">tsearch2</a> was built into the kernel of the system (this has already been <a href="http://habrahabr.ru/blog/postgresql/27279.html">written</a> on Habr√©), and with its help you can implement database search, which will be more functional.  In principle, the article mentioned above gives an example of using this module, but I would like to share the experience of implementing full-text search in a real <a href="http://en.edu.ru/">project</a> . <br><a name="habracut"></a><br>  So, there is a table ‚Äúnews‚Äù containing the fields: ‚Äútitle‚Äù, ‚ÄúmetaKeywords‚Äù, ‚ÄúmetaDescription‚Äù and ‚Äúcontent‚Äù. <br>  It is necessary to implement a full-text search that will search for a word across all fields of the table, and each field has its own absolute priority. <br><br>  Create a database in UTF8 encoding, and create a test table in it: <br><blockquote>  <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">DATABASE</font> "tsearch2"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">WITH</font> ENCODING = <font color="#A31515">'UTF8'</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">TABLE</font> "news"</font> <font color="black"><br></font>  <font color="black">(</font> <font color="black"><br></font>  <font color="black">"NewsId" Serial <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> ,</font> <font color="black"><br></font>  <font color="black">"Title" <font color="#0000ff">Varchar</font> (1024) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> ,</font> <font color="black"><br></font>  <font color="black">"MetaKeywords" <font color="#0000ff">Varchar</font> (2048),</font> <font color="black"><br></font>  <font color="black">"MetaDescription" <font color="#0000ff">Varchar</font> (1024),</font> <font color="black"><br></font>  <font color="black">"Content" Text <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> ,</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">primary</font> <font color="#0000ff">key</font> ("newsId")</font> <font color="black"><br></font>  <font color="black">);</font> </blockquote><br>  Next, add some entry to this table: <br><blockquote>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> "news" ("title", "metaKeywords", "metaDescription", "content")</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">VALUES</font> ( <font color="#A31515">'Test news'</font> , <font color="#A31515">'news, article'</font> , <font color="#A31515">'Test news for search'</font> , <font color="#A31515">'Hello world'</font> );</font> </blockquote><br>  Now you need to create a full-text search configuration: <br><blockquote>  <font color="black"><font color="#0000ff">CREATE</font> TEXT <font color="#0000ff">SEARCH</font> <font color="#0000ff">DICTIONARY</font> mydict_russian_ispell (</font> <font color="black"><br></font>  <font color="black">TEMPLATE = ispell,</font> <font color="black"><br></font>  <font color="black">DictFile = russian,</font> <font color="black"><br></font>  <font color="black">AffFile = russian,</font> <font color="black"><br></font>  <font color="black">StopWords = russian</font> <font color="black"><br></font>  <font color="black">);</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">CREATE</font> TEXT <font color="#0000ff">SEARCH</font> CONFIGURATION <font color="#0000ff">public.</font> Mydict_ru (PARSER = <font color="#0000ff">default</font> );</font> <font color="black"><br></font>  <font color="black">COMMENT <font color="#0000ff">ON</font> TEXT <font color="#0000ff">SEARCH</font> CONFIGURATION <font color="#0000ff">public</font> .mydict <font color="#0000ff">IS</font> <font color="#A31515">'conf.</font></font>  <font color="black"><font color="#A31515">for mydict ru '</font> ;</font> <font color="black">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </font>  <font color="black"><font color="#0000ff">ALTER</font> TEXT <font color="#0000ff">SEARCH</font> CONFIGURATION mydict <font color="#0000ff">ADD</font> MAPPING</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FOR</font> email, url, url_path, <font color="#0000ff">host</font> , <font color="#0000ff">file</font> , version,</font> <font color="black"><br></font>  <font color="black">sfloat, <font color="#0000ff">float</font> , <font color="#0000ff">int</font> , uint,</font> <font color="black"><br></font>  <font color="black">numword, hword_numpart, numhword</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">WITH</font> simple;</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">ALTER</font> TEXT <font color="#0000ff">SEARCH</font> CONFIGURATION mydict <font color="#0000ff">ADD</font> MAPPING</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FOR</font> word, hword_part, hword</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">WITH</font> mydict_russian_ispell;</font> </blockquote><br>  In this script we have created our <a href="http://ficus-www.cs.ucla.edu/geoff/ispell.html">ispell</a> dictionary <em>mydict_russian_ispell</em> .  Then they created their own configuration, <em>mydict_ru</em> , which indicated the rules for using dictionaries. <br>  It is worth saying that the first request uses links to files in postgres in the default directory (\ share \ tsearch_data \). <br>  To create our own dictionary, we needed 3 files: russian.affix, russian.stop and russian.dict.  The first contains a description of the endings of words in a given language, the second - a list of stop words, the last - the words themselves.  It is important to remember that the files must be in the same encoding as the base itself, i.e.  in our case, UTF8. <br><br>  When implementing a search, we will refer not to the database fields, but to a special index that will contain information about the contents of the table. <br><blockquote>  <font color="black"><font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> "news" <font color="#0000ff">ADD</font> <font color="#0000ff">COLUMN</font> fts_news tsvector;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">UPDATE</font> "news" <font color="#0000ff">SET</font> fts_news =</font> <font color="black"><br></font>  <font color="black">setweight ( <font color="#0000ff">coalesce</font> (to_tsvector ( <font color="#A31515">'mydict_ru'</font> , "title"), <font color="#A31515">''</font> ), <font color="#A31515">'A'</font> ) ||</font> <font color="black"><br></font>  <font color="black">setweight ( <font color="#0000ff">coalesce</font> (to_tsvector ( <font color="#A31515">'mydict_ru'</font> , "metaKeywords"), <font color="#A31515">''</font> ), <font color="#A31515">'B'</font> ) ||</font> <font color="black"><br></font>  <font color="black">setweight ( <font color="#0000ff">coalesce</font> (to_tsvector ( <font color="#A31515">'mydict_ru'</font> , "metaDescription"), <font color="#A31515">''</font> ), <font color="#A31515">'C'</font> ) ||</font> <font color="black"><br></font>  <font color="black">setweight ( <font color="#0000ff">coalesce</font> (to_tsvector ( <font color="#A31515">'mydict_ru'</font> , "content"), <font color="#A31515">''</font> ), <font color="#A31515">'D'</font> );</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">INDEX</font> news_fts_idx <font color="#0000ff">ON</font> "news" <font color="#0000ff">USING</font> gist (fts_news);</font> <font color="black"><br><br></font>  <font color="black">vacuum analyze "news";</font> <font color="black"><br></font> </blockquote><br>  With this script, we created another <em>tsvector</em> type field in the table, which contains information about the four fields in the table, the ‚Äútitle‚Äù field is taken with the highest priority <strong>A</strong> , and the ‚Äúcontent‚Äù field with the lowest <strong>D.</strong>  Then we created a GIST index and made an index update. <br>  As a result of our test record of the table, the following tsvector - <em>'search': 8C 'article': 4B 'news': 2A, 3B, 6C 'test': 1A, 5C</em> . <br><br>  Well, now it's time to test our search.  Perform the following query: <br><blockquote>  <font color="black"><font color="#0000ff">SELECT</font></font> <font color="black"><br></font>  <font color="black">"NewsId",</font> <font color="black"><br></font>  <font color="black">ts_headline ( <font color="#A31515">'mydict_ru'</font> , "title", q) <font color="#0000ff">as</font> "title",</font> <font color="black"><br></font>  <font color="black">rank</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FROM</font> (</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">SELECT</font></font> <font color="black"><br></font>  <font color="black">"NewsId",</font> <font color="black"><br></font>  <font color="black">"Title",</font> <font color="black"><br></font>  <font color="black">q,</font> <font color="black"><br></font>  <font color="black">ts_rank (fts_news, q) <font color="#0000ff">as</font> rank</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FROM</font> "news", plainto_tsquery ( <font color="#A31515">'mydict_ru'</font> , <font color="#A31515">'news'</font> ) q</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">WHERE</font> fts_news @@ q</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">ORDER</font> <font color="#0000ff">BY</font> rank <font color="#0000ff">DESC</font></font> <font color="black"><br></font>  <font color="black">) <font color="#0000ff">AS</font> foo;</font> </blockquote><br>  As a result, we get the string <em>Test <b>News</b></em> .  The highlighting of the found word is implemented by the <em>ts_headline</em> function;  query ranking is the <em>ts_rank</em> function, by the value of which we sort the results. <br><br>  Well, of course, you need to remember to make a trigger that will update the ‚Äúfts_news‚Äù field on the ‚Äúnews‚Äù table: <br><blockquote>  <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">OR</font> REPLACE <font color="#0000ff">FUNCTION</font> "updateNewsFTS" () <font color="#0000ff">RETURNS</font> " <font color="#0000ff">trigger</font> " <font color="#0000ff">AS</font> <font color="#A31515">'</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">DECLARE bUpdate boolean;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">BEGIN</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">bUpdate = false;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">IF (TG_OP = '</font> <font color="#A31515">' INSERT '</font> <font color="#A31515">') THEN</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">bUpdate: = true;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">ELSEIF (TG_OP = '</font> <font color="#A31515">' UPDATE '</font> <font color="#A31515">') THEN</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">IF NEW.title! = OLD.title OR NEW.content! = OLD.content OR NEW. "MetaKeywords"! = OLD. "MetaKeywords" OR NEW. "MetaDescription"! = OLD. "MetaDescription" THEN</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">bUpdate: = true;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">END IF;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">END IF;</font></font> <font color="black"><font color="#A31515"><br><br></font></font>  <font color="black"><font color="#A31515">IF bUpdate = TRUE THEN</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">RAISE NOTICE '</font> <font color="#A31515">' UPDATE '</font> <font color="#A31515">';</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">new.fts_news: = setweight (coalesce (to_tsvector ('</font> <font color="#A31515">' mydict_ru '</font> <font color="#A31515">', new.title), '</font> <font color="#A31515">' '</font> <font color="#A31515">'), '</font> <font color="#A31515">' A '</font> <font color="#A31515">') ||</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">setweight (coalesce (to_tsvector ('</font> <font color="#A31515">' mydict_ru '</font> <font color="#A31515">', new. "metaKeywords"), '</font> <font color="#A31515">' '</font> <font color="#A31515">', '</font> <font color="#A31515">' B '</font> <font color="#A31515">') ||</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">setweight (coalesce (to_tsvector ('</font> <font color="#A31515">' mydict_ru '</font> <font color="#A31515">', new. "metaDescription"), '</font> <font color="#A31515">' '</font> <font color="#A31515">', '</font> <font color="#A31515">' C '</font> <font color="#A31515">') ||</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">setweight (coalesce (to_tsvector ('</font> <font color="#A31515">' mydict_ru '</font> <font color="#A31515">', new.content), '</font> <font color="#A31515">' '</font> <font color="#A31515">'), '</font> <font color="#A31515">' D '</font> <font color="#A31515">');</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">END IF;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">RETURN NEW;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">END;</font></font> <font color="black"><font color="#A31515"><br></font></font>  <font color="black"><font color="#A31515">'</font> <font color="#0000ff">LANGUAGE</font> <font color="#A31515">' plpgsql '</font> VOLATILE;</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">TRIGGER</font> "newsFTSTrigger"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">BEFORE</font> <font color="#0000ff">INSERT</font> <font color="#0000ff">OR</font> <font color="#0000ff">UPDATE</font> <font color="#0000ff">ON</font> "news"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FOR</font> <font color="#0000ff">EACH</font> <font color="#0000ff">ROW</font> <font color="#0000ff">EXECUTE</font> <font color="#0000ff">PROCEDURE</font> ‚ÄúupdateNewsFTS‚Äù ();</font> </blockquote><br>  <strong>UPD</strong> <br><h2>  Performance </h2><br>  Since I was asked to provide information about the performance in the comments, I decided to compare two types of search - tsearch and regular expression search. <br>  The search is conducted by VIEW, which connects data from four tables (about 5400 records in total). <br><br>  Query using tsearch: <br><blockquote>  <font color="black"><font color="#0000ff">SELECT</font></font> <font color="black"><br></font>  <font color="black">"Id"</font> <font color="black"><br></font>  <font color="black">"Type",</font> <font color="black"><br></font>  <font color="black">ts_headline ( <font color="#A31515">'mydict_ru'</font> , "title", q) <font color="#0000ff">as</font> "title",</font> <font color="black"><br></font>  <font color="black">( <font color="#0000ff">CASE</font> <font color="#0000ff">WHEN</font> <font color="#0000ff">trim</font> ("foreword") = <font color="#A31515">''</font> <font color="#0000ff">THEN</font> ts_headline ( <font color="#A31515">'mydict_ru'</font> , "content", q)</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">ELSE</font> ts_headline ( <font color="#A31515">'mydict_ru'</font> , "foreword", q) <font color="#0000ff">END</font> ) <font color="#0000ff">as</font> "body",</font> <font color="black"><br></font>  <font color="black">"ResourceTypes",</font> <font color="black"><br></font>  <font color="black">rank</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FROM</font> (</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">SELECT</font></font> <font color="black"><br></font>  <font color="black">"Id"</font> <font color="black"><br></font>  <font color="black">"Type",</font> <font color="black"><br></font>  <font color="black">"Title",</font> <font color="black"><br></font>  <font color="black">Foreword</font> <font color="black"><br></font>  <font color="black">"Content",</font> <font color="black"><br></font>  <font color="black">"ResourceTypes",</font> <font color="black"><br></font>  <font color="black">q,</font> <font color="black"><br></font>  <font color="black">ts_rank (fts_vector, q) <font color="#0000ff">as</font> rank</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FROM</font> "getSearchItems", plainto_tsquery ( <font color="#A31515">'mydict_ru'</font> , <font color="#A31515">'physics'</font> ) q</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">WHERE</font> fts_vector @@ q</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">ORDER</font> <font color="#0000ff">BY</font> rank <font color="#0000ff">DESC</font></font> <font color="black"><br></font>  <font color="black">) <font color="#0000ff">AS</font> foo;</font> </blockquote><br>  The average time to complete such a request on my laptop is 2.35 seconds.  The result contains 821 entries. <br><br>  A query that uses regular expressions and implements a sort of ranking of results: <br><blockquote>  <font color="black"><font color="#0000ff">SELECT</font> *</font> <font color="black"><br></font>  <font color="black">, ( <font color="#0000ff">SELECT</font> <font color="#0000ff">position</font> ( <font color="#0000ff">lower</font> ( <font color="#A31515">'physics'</font> ) <font color="#0000ff">in</font> <font color="#0000ff">lower</font> (" <font color="#0000ff">search</font> ". "Title")) <font color="#0000ff">as</font> "pos"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">EXCEPT</font> <font color="#0000ff">SELECT</font> 0 <font color="#0000ff">as</font> "pos") <font color="#0000ff">as</font> "titlePosition"</font> <font color="black"><br></font>  <font color="black">, ( <font color="#0000ff">select</font> <font color="#0000ff">position</font> ( <font color="#0000ff">lower</font> ( <font color="#A31515">'physics'</font> ) <font color="#0000ff">in</font> <font color="#0000ff">lower</font> (" <font color="#0000ff">search</font> ". "metaKeywords")) <font color="#0000ff">as</font> "pos"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">EXCEPT</font> <font color="#0000ff">SELECT</font> 0 <font color="#0000ff">as</font> "pos") <font color="#0000ff">as</font> "metaKeywordsPosition"</font> <font color="black"><br></font>  <font color="black">, ( <font color="#0000ff">SELECT</font> <font color="#0000ff">position</font> ( <font color="#0000ff">lower</font> ( <font color="#A31515">'physics'</font> ) <font color="#0000ff">in</font> <font color="#0000ff">lower</font> (" <font color="#0000ff">search</font> ". "MetaDescription")) <font color="#0000ff">as</font> "pos"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">EXCEPT</font> <font color="#0000ff">SELECT</font> 0 <font color="#0000ff">as</font> "pos") <font color="#0000ff">as</font> "metaDescriptionPosition"</font> <font color="black"><br></font>  <font color="black">, ( <font color="#0000ff">SELECT</font> <font color="#0000ff">position</font> ( <font color="#0000ff">lower</font> ( <font color="#A31515">'physics'</font> ) <font color="#0000ff">in</font> <font color="#0000ff">lower</font> (" <font color="#0000ff">search</font> ". "Foreword")) <font color="#0000ff">as</font> "pos"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">EXCEPT</font> <font color="#0000ff">SELECT</font> 0 <font color="#0000ff">as</font> "pos") <font color="#0000ff">as</font> "forewordPosition"</font> <font color="black"><br></font>  <font color="black">, ( <font color="#0000ff">SELECT</font> <font color="#0000ff">position</font> ( <font color="#0000ff">lower</font> ( <font color="#A31515">'physics'</font> ) <font color="#0000ff">in</font> <font color="#0000ff">lower</font> (" <font color="#0000ff">search</font> ". "Content")) <font color="#0000ff">as</font> "pos"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">EXCEPT</font> <font color="#0000ff">SELECT</font> 0 <font color="#0000ff">as</font> "pos") <font color="#0000ff">as</font> "contentPosition"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FROM</font> (</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">SELECT</font></font> <font color="black"><br></font>  <font color="black">"Id"</font> <font color="black"><br></font>  <font color="black">"Type",</font> <font color="black"><br></font>  <font color="black">"Title",</font> <font color="black"><br></font>  <font color="black">"MetaKeywords",</font> <font color="black"><br></font>  <font color="black">"MetaDescription",</font> <font color="black"><br></font>  <font color="black">Foreword</font> <font color="black"><br></font>  <font color="black">"Content"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FROM</font> "getSearchItems"</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">WHERE</font> ( <font color="#0000ff">lower</font> ("title") ~ <font color="#0000ff">lower</font> ( <font color="#A31515">'(. *)'</font> || <font color="#A31515">physics'</font> || <font color="#A31515">'(. *)'</font> )</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">or</font> <font color="#0000ff">lower</font> ("metaKeywords") ~ <font color="#0000ff">lower</font> ( <font color="#A31515">'(. *)'</font> || <font color="#A31515">physics'</font> || <font color="#A31515">'(. *)'</font> )</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">or</font> <font color="#0000ff">lower</font> ("metaDescription") ~ <font color="#0000ff">lower</font> ( <font color="#A31515">'(. *)'</font> || <font color="#A31515">physics'</font> || <font color="#A31515">'(. *)'</font> )</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">or</font> <font color="#0000ff">lower</font> ("foreword") ~ <font color="#0000ff">lower</font> ( <font color="#A31515">'(. *)'</font> || <font color="#A31515">'physics'</font> || <font color="#A31515">'(. *)'</font> )</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">or</font> <font color="#0000ff">lower</font> ("content") ~ <font color="#0000ff">lower</font> ( <font color="#A31515">'(. *)'</font> || <font color="#A31515">physics'</font> || <font color="#A31515">'(. *)'</font> ))</font> <font color="black"><br></font>  <font color="black">) <font color="#0000ff">as</font> " <font color="#0000ff">search</font> "</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">ORDER</font> <font color="#0000ff">BY</font> "type" <font color="#0000ff">ASC</font></font> <font color="black"><br></font>  <font color="black">, "TitlePosition" <font color="#0000ff">ASC</font></font> <font color="black"><br></font>  <font color="black">, "MetaKeywordsPosition" <font color="#0000ff">ASC</font></font> <font color="black"><br></font>  <font color="black">, "MetaDescriptionPosition" <font color="#0000ff">ASC</font></font> <font color="black"><br></font>  <font color="black">, "ForewordPosition" <font color="#0000ff">ASC</font></font> <font color="black"><br></font>  <font color="black">, "ContentPosition" <font color="#0000ff">ASC</font> ;</font> </blockquote><br>  The average time to complete such a request on my laptop is 1.5 seconds.  The result contains 567 records. <br>  Thus, when using tsearch, I got the work time 1.5 times longer than the ‚Äúsimple‚Äù search, but I got about 1.5 times more records that contain different forms of the word <em>physics</em> and are already ready for output to the pattern . <br><br><h2>  PS </h2><br>  This search implementation provides full-text search for Russian words in the database. <br>  With this configuration, the English words were not indexed.  To fix this, you need to create a different search configuration, I just provided the one I used myself. <br>  So far, the simplest and most accessible to me is this kind of configuration, adding an English ispell dictionary and indexing of English words: <br><blockquote>  <font color="black"><font color="#0000ff">CREATE</font> TEXT <font color="#0000ff">SEARCH</font> <font color="#0000ff">DICTIONARY</font> english_ispell (</font> <font color="black"><br></font>  <font color="black">TEMPLATE = ispell,</font> <font color="black"><br></font>  <font color="black">DictFile = english,</font> <font color="black"><br></font>  <font color="black">AffFile = english,</font> <font color="black"><br></font>  <font color="black">StopWords = english</font> <font color="black"><br></font>  <font color="black">);</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">ALTER</font> TEXT <font color="#0000ff">SEARCH</font> CONFIGURATION mydict <font color="#0000ff">ADD</font> MAPPING</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">FOR</font> asciiword</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">WITH</font> english_ispell;</font> </blockquote><br>  Related Links: <br>  <a href="">Archive with files of Russian ispell dictionaries (UTF8)</a> <br>  <a href="http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/">The official tsearch2 page</a> <br>  <a href="http://dolzhenko.blogspot.com/2007/10/postgresql-full-text-search.html">An example of using tsearch2 in postgresql-8.2</a> </div><p>Source: <a href="https://habr.com/ru/post/30533/">https://habr.com/ru/post/30533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305308/index.html">In the footsteps of Google I / O 2016 - the new Firebase: integration with Android</a></li>
<li><a href="../305312/index.html">Review of physics in Sonic games. Parts 5 and 6: the loss of rings and being under water</a></li>
<li><a href="../305314/index.html">It seems that Github is again unavailable in Russia ... and other sites</a></li>
<li><a href="../305316/index.html">Facebook Messenger will receive end-to-end encryption</a></li>
<li><a href="../305318/index.html">Photos from Varlamov. Honest business or misunderstood law</a></li>
<li><a href="../305330/index.html">Writing an adaptive template for Emlog CMS</a></li>
<li><a href="../305332/index.html">Encoder's good instincts will ultimately hit you in the teeth</a></li>
<li><a href="../305334/index.html">The feasibility and benefits of using server drives, building RAID arrays, is it worth saving and when?</a></li>
<li><a href="../305336/index.html">Blocking of IP addresses of CloudFlare in Beeline. 149-FZ</a></li>
<li><a href="../305338/index.html">Let me go Meteor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>