<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Aida. Automation of work with Git, JIRA and TeamCity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing and testing a product, a lot of routine work appears. To avoid human error, we use AIDA. 

 AIDA (English Automated Interactive Deploy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Aida. Automation of work with Git, JIRA and TeamCity</h1><div class="post__text post__text-html js-mediator-article"> <a href=""><img src="https://habrastorage.org/storage2/4fd/6b4/2f8/4fd6b42f83fcb9a7e41065f1b1dd2a8a.jpg" align="left"></a>  When developing and testing a product, a lot of routine work appears.  To avoid human error, we use AIDA. <br><br>  <b>AIDA</b> (English Automated Interactive Deploy Assistant) is an account that greatly facilitates work with Git, TeamCity and JIRA. <br>  Today we will talk about how with its help we managed to automate many working processes. <br><br>  First of all, we‚Äôll recall the version control system used in Badoo, then we‚Äôll tell you how the release branches were automated and the branches were automatically merged into Git, we‚Äôll talk about AIDA‚Äôs substantial assistance in working with JIRA (monitoring and changing the status of tasks, filling ) and TeamCity (continuous integration and deployment to a test environment). <br><a name="habracut"></a><br><h4>  Git workflow </h4><br>  Badoo uses Git as its version control system.  The peculiarity of our model is that each task is developed and tested in a separate branch.  Its name consists of a ticket number in JIRA and a free description of the task. <br>  We collect and test the release from a separate branch into which we merge the completed tasks.  Since the code on the combat servers is laid out twice a day, two new branches are created for release. <br>  The name of the release branch is simple: <b>build_ {release date} _ {time}</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From this name, the whole team knows the date and time of release.  Also at this time oriented hooks prohibiting changes to the release branch.  For example, developers are not allowed to add a task to a release branch two hours prior to laying out on combat servers.  Without such a restriction, the QA team would not have time to check all the tasks in the release branch. <br><br>  The master branch for us is a copy of production.  As soon as build updates the code on the servers, it merges into the master branch.  Also from this branch are fixed urgent fixes on the site. <br><br>  This scheme is shown in the picture: <br> <nobr><img src="https://habrastorage.org/storage2/630/cc3/c5a/630cc3c5a21b74491d620b98b5a95495.png"><br></nobr> <br><br>  Testing goes in several stages: <br><ul><li>  <b>Devel</b> is the first stage of testing, each task is checked on the development environment, it is looked at on test bases and unit tests are run. </li><li>  <b>Shot</b> - a task is checked in a combat environment.  Physically, this is the folder on the server where the repository branch is being downloaded and nginx is configured;  has its first level domain - .shot.  At this stage, translations into the main languages ‚Äã‚Äãare generated. </li><li>  <b>Staging</b> - the release is tested in a combat environment, translated into all languages, fully monitored.  All tasks are checked again. </li></ul><br>  If there is something wrong with the release task, then we roll back the branch with it using git rebase.  This function is not used by chance: revert does not suit us, since after a rollback, the release branch will merge into master, and the branches with tasks are constantly updated from it.  As a result, when the developer of the problem task updates his branch, his code disappears, and you have to revert to the commit <i>revert</i> . <br><br><h4>  AIDA and Git </h4><br>  Due to the large number of branches in the model described above, many tasks arise on merging branches, forming a release and monitoring the code.  Consider their automatic solution: <br><ul><li>  First of all, AIDA creates a build branch.  It ‚Äúlistens‚Äù to the master branch, and if the previous release branch merges into master, then a new branch is created. <br><img src="https://habrastorage.org/storage2/122/927/90e/12292790e2b7424563dca3838aabc9d5.png" alt="image"></li><li>  Then, in a new release branch, every minute the branches merge with the tasks already completed, tested and corresponding to the pattern in JIRA.  If a conflict occurs during the merge, the developer and the release engineer receive a notification about it, and the task is redirected to the developer. <br><img src="https://habrastorage.org/storage2/946/c2b/223/946c2b2234cd90b67348505a3b4cc67b.png" alt="image"></li><li>  Since the master branch is a copy of the code laid out on the combat servers, and changes are added to it, it must be constantly merged with the release branch.  AIDA performs this merge if there is a change in the master branch.  If there is a conflict, a corresponding message appears. <br><img src="https://habrastorage.org/storage2/c2f/eba/fc8/c2febafc8feaecafc82ebbe9810d76ad.png"></li><li>  If, after merging with the release branch, the developer adds a change to the branch with the task, then this commit will be caught and AIDA will report this. <br><img src="https://habrastorage.org/storage2/917/11f/f9b/91711ff9b2638d8e5ef56720a8ec9051.png"></li></ul><br><br><h4>  AIDA and JIRA </h4><br>  We use JIRA to control development, release, and testing.  Workflow in all projects is fully developed and formalized.  In the process of developing and testing, part of the work in the bug tracker is performed by AIDA. <br>  Basically, it helps us move tasks or displays one or another information in them.  Here are some examples: <br><ul><li>  developer fixes code changes in the central repository, ticket status automatically changes from Open to In Progress; </li><li>  if Shot is created for the ticket (the code is laid out in a separate combat environment), then the task status automatically changes to In Shot; </li><li>  The ticket is automatically reopened when the task is rolled back from the release branch; </li><li>  if the task has passed the code verification procedure and then a change in the branch follows, then the ticket is returned to the check. </li></ul><br>  It also helps to change the status of the task if there are certain resolutions: <br><ul><li>  <b>Fixed &amp; Deploy on Production</b> - the ticket automatically changes its status to On Production </li></ul><br>  AIDA informs us about all its actions with tasks. <br>  This automation greatly simplifies the work with workflow and eliminates the routine actions. <br><br><h4>  AIDA and TeamCity </h4><br>  When building and automating on a test environment, we wanted to completely get rid of routine actions, but we had to manually write the changing names of the release branches in the CI server projects.  At the moment, TeamCity catches changes in all branches according to a given mask (in our case it is the <b>build_ *</b> mask) and starts the build.  Unfortunately, there is one problem: we cannot remove the default branch from the project configuration, and if changes come in there, we simply ignore it.  In this case, the branch is pulled out, and we lose resources and time.  We really hope that the developers of the CI server will soon fix this problem. <br>  Links to tickets: <br>  <a href="http://youtrack.jetbrains.com/issue/TW-22291">Support branch specification in the VCS trigger rule</a> <br>  <a href="http://youtrack.jetbrains.com/issue/TW-24147">Ignore default VCS branch</a> <br><br>  Let's see what happens with the build and automatic deployment: <br><ol><li>  The project in TeamCity is configured for branches with a <b>build_ *</b> mask. </li><li>  After the changes in the release branch, the automatic build starts. </li><li>  If successful, the deployment script starts on test servers. </li><li>  With the help of quick smoke tests (using a simple curl), the test environment is checked. </li><li>  If the tests do not pass, the release version is marked as bad and rolls back to the previous (good) release version. </li></ol><br><img src="https://habrastorage.org/storage2/715/d74/0fd/715d740fdbd4c2c6147c3968fd383695.png"><br><br>  The whole procedure takes three minutes.  Tests only reveal fatal errors.  In this case, all unit-, auto- and functional tests are run in parallel. <br>  This is done so that the tester sees the task as quickly as possible in the test environment. <br><br><h4>  Results </h4><br>  Let's see what actions AIDA automates with us: <br><ol><li>  It works with Git, creates branches, merges them, warns us if something goes wrong. </li><li>  Interacts with JIRA, automatically changes statuses and updates information in tasks. </li><li>  Helps TeamCity run scripts, tests and deploy to a test environment. </li></ol><br>  AIDA can do a lot, but we don‚Äôt stop there and want to teach our assistant the following actions: <br><ul><li>  automatic application of patches for Git from a special interface for collecting, controlling, recording and formalizing patches, with a full list of information and automatic notification; </li><li>  fully automatic rebase of tasks from the build branch by changing the ticket status in JIRA; </li><li>  automatic start of unit-tests for each branch of the task at the moment of its completion and after changing the status in the bug tracker with the subsequent report in JIRA. </li></ul><br>  If you are interested in a more detailed story about each type of automation, write about it in the comments and we will be happy to continue the series of articles on this topic. <br><br>  PS Create yourself good helpers who won't let you down in difficult times! </div><p>Source: <a href="https://habr.com/ru/post/169417/">https://habr.com/ru/post/169417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169403/index.html">Open source PKS controllers</a></li>
<li><a href="../169405/index.html">Dating site for Love programmers ++</a></li>
<li><a href="../169409/index.html">Parsing shopping sites. Personal experience and a little how-to</a></li>
<li><a href="../169411/index.html">New Adobe 0day vulnerabilities exploited by hackers</a></li>
<li><a href="../169415/index.html">Why we began to use the Stylus preprocessor in Yandex. Mail, as well as about the library that helps to live with IE</a></li>
<li><a href="../169419/index.html">How to improve "Windows 8". Private opinion</a></li>
<li><a href="../169429/index.html">Yahoo unhappy with Microsoft results</a></li>
<li><a href="../169433/index.html">HP will release the tablet again, but on Android</a></li>
<li><a href="../169435/index.html">Little Brave Arkanoid (Part 4)</a></li>
<li><a href="../169437/index.html">3d printers. Review of achievements for 2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>