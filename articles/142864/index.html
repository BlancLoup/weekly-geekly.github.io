<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sales funnel: we make an automatically updated report from the database using Excel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are selling an online service, you probably would like to see what happens at each stage of the sales funnel. From the analysis of the funnel, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sales funnel: we make an automatically updated report from the database using Excel</h1><div class="post__text post__text-html js-mediator-article">  If you are selling an online service, you probably would like to see what happens at each stage of the sales funnel.  From the analysis of the funnel, we can draw important conclusions: how clear and convenient is the installation process and the initial setup of the application, how many and which clients become active users of the service, what percentage goes from the free version to the paid one.  In addition, the dynamics of conversion rates can be inferred about the effectiveness of measures taken to increase sales. <br><br>  Under the cat you will find a description of some techniques for working with Excel, which can be useful when analyzing data arrays.  We will describe how we maintain management statistics on the <a href="http://jivosite.ru/">jivosite.ru</a> service using Excel pivot tables and connecting to MySQL via ODBC using the example of a report on the sales funnel.  The proposed method is quite simple and versatile, with its help you can build beautiful reports in minutes. <br><a name="habracut"></a><br><h4>  Formulation of the problem </h4><br>  It is required to build a report on the sales funnel for the <a href="http://jivosite.ru/">jivosite.ru</a> service.  This is an online consultant for online stores, which is sold on the model of freemium.  Users connect with a two-week demo period during which an extended version is available.  After 2 weeks, there is a free version that continues to work for an unlimited period. <br><br>  Thus, we have the following sales funnel: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/639/d27/b60/639d27b60d734a456ed3eaeb00924703.png"><br><br>  It is required to show the number of customers at each level of the funnel, as well as to calculate the conversion rate for each level, broken down by weeks and months.  The source data is in MySQL, reports should be built automatically by pressing a few buttons, and also allow, if necessary, to build cuts into different categories and enter filters without additional programming. <br><br><h4>  Load the source data from the database </h4><br>  To load data from the database to Excel, we need an ODBC driver.  In our case, we will use <a href="http://dev.mysql.com/downloads/connector/odbc/">the ODBC-MySQL for Windows connector</a> .  On a Mac with a connector, something didn't work out for us, but maybe it was already corrected in new versions. <br><br>  After installing the driver, create an empty Excel workbook, open the ‚ÄúData‚Äù tab - ‚ÄúFrom other sources‚Äù - ‚ÄúFrom Microsoft Query‚Äù <br><br><img src="https://habrastorage.org/storage2/74e/329/477/74e329477fce08add772251c77433534.png"><br><br>  Then select ‚ÄúNew data source‚Äù, enter the name of the connection, select the driver ‚ÄúMySQL ODBC Driver‚Äù.  Then we press the "Connection" button, enter the connection parameters to our database, click "OK".  After that, if the connection is successfully established, Microsoft Query will offer a step-by-step query creation wizard.  Close all failed pop-up windows, and then click ‚ÄúSQL‚Äù and enter our SQL query, which will return the original table, manually.  Our query simply makes a selection from the table of connected clients from the database slave server. <br><br>  In our source table, we will use the following columns: <br><ul><li>  created - the date of registration of the client </li><li>  name - site URL </li><li>  was_installed - 1 if the client installed the widget on his site, 0 if he never installed </li><li>  chats_count - the number of dialogs that took place using our service </li><li>  is_paid - 0 if the client did not pay us anything, 1 - if he paid </li></ul><br>  The result of the query will go to the Excel sheet as an ordered table. <br><br><img src="https://habrastorage.org/storage2/754/ad9/2c1/754ad92c1744faa0d070f93959ffee7d.png"><br><br>  This ordered table has a number of useful properties that we will use later. <br><br><h4>  Create a pivot table </h4><br>  To make a large source data array into convenient and beautiful reports, we will use <a href="http://en.wikipedia.org/wiki/Pivot_table">pivot tables</a> .  Click on the upper-left-hand cell of the table with the original data (cell A1) then "Insert" - "Pivot Table" - "OK".  Thus, the initial array for the pivot table will be the entire result of the query in MySQL, when adding new columns and rows, the pivot table will be updated automatically. <br><br>  An empty pivot table looks like this: <br><br><img src="https://habrastorage.org/storage2/8e6/eee/eba/8e6eeeeba5b81b9e6144e3958cc34778.png"><br><br><h4>  We count the number of customers at each stage of sales. </h4><br>  Before generating such a report, for each row in the source table we need to add the week number and the year in which the client was connected.  This is needed to group data by year and week.  To do this, open the sheet with the source data, scroll to the right to the last column, click on the cell to the right of the last column header, and write ‚ÄúConnection week‚Äù there.  A new column has been added to the table with empty values ‚Äã‚Äãin the rows.  Now, in the cell under the heading of the new column, we write the formula ‚Äú= NUMBER OF WEEKS (‚Äù) and click on the cell in this line, in which we have the date of connection of the client. <br><br><img src="https://habrastorage.org/storage2/a5e/f3c/aa5/a5ef3caa5e6019455b3466142a1e1e93.png"><br><br>  In this case, the formula will look like ‚Äú= NOMEDELIES ([@ created]; 21)‚Äù.  If the cell is in the same row as the formula, smart Excel creates a link to it by column name, and also automatically fills all the rows in the table with this formula.  When adding rows to the source data table, new calculated cells will be added automatically.  Convenient, Exel Respect :).  Please note that there are <a href="http://office.microsoft.com/en-us/excel-help/weeknum-function-HP010343016.aspx">different algorithms for calculating the number of the week</a> .  For ourselves, we chose the scheme number 21. <br><br>  Similarly, we add the column ‚ÄúYear of Connection‚Äù with the formula ‚Äú= YEAR ([@ created])‚Äù.  After that, go to the sheet with our pivot table, click on the pivot table with the right button - ‚ÄúUpdate‚Äù so that the table will learn about new columns in the source data. <br><br>  Of course, these columns could be added to the original data by means of SQL, but in Ekzel it is somehow faster and more pleasant.  Although it is certainly a matter of taste :) <br><br>  Now we drag the ‚ÄúConnection Year‚Äù and ‚ÄúConnection Week‚Äù columns from the list of fields to the ‚ÄúRow Names‚Äù area, and the ‚Äúname‚Äù field (we have the site URL in this field) to the ‚ÄúValues‚Äù area. <br><br><img src="https://habrastorage.org/storage2/d6e/9e5/701/d6e9e570153b6ebb9844b9a9187927c8.png"><br><br>  We will get a neat table, in which the number of clients connected by weeks is broken.  We dragged the "name" field to the value area so that Exel counted the number of elements in this column (i.e. all elements), grouped by weeks and years.  This will be the number of registrations (second stage of the funnel). <br><br>  Let us calculate how many of the clients who registered in each week have installed our chat on the site.  To do this, drag the "was_installed" field to the value area.  This field in the source data is ‚Äú0‚Äù if the widget is not set, and ‚Äú1‚Äù if set.  Then right click - ‚ÄúParameters of value fields‚Äù - select the operation ‚ÄúAmount‚Äù.  Now in the pivot table there is a second column in which we see how many of the clients registered in any week have installed the widget on the site. <br><br><img src="https://habrastorage.org/storage2/f5a/f27/06c/f5af2706c96278cd7b4609acf812f224.png"><br><br>  Now we will count active clients.  We will consider active those who had more than 20 conversations with site visitors.  To do this, we need to add the column ‚Äúis_active‚Äù with the cell formula ‚Äú= IF ([@ [chats_count]]&gt; 20; 1; 0)‚Äù to the source data table.  In the "chats_count" column we have the number of client chats.  As a result, in the ‚Äúis_active‚Äù column we will have ‚Äú1‚Äù if the client has more than 20 chats.  Now the is_active field can also be dragged to the value area. <br><br>  Adding a little feng shui in the form of histograms and renaming the columns, we get the following label: <br><br><img src="https://habrastorage.org/storage2/d59/a54/020/d59a54020b7c0eb8ad6bcdcc945e00f8.png"><br><br>  Here we have already received nice statistics, which is also automatically updated from the database.  To update the data, you must first go to the sheet with the original data, there right click on the table - ‚ÄúUpdate‚Äù.  And then right click on the pivot table - ‚ÄúRefresh‚Äù. <br><br><h4>  Consider conversion rates </h4><br>  To calculate k0, you need to take the data on unique visitors from Google analytics, and we will leave this outside of the scope of this manual (by the way, we are solving this problem by copy-paste from Google analytics). <br><br>  Let's start by counting k1 - the ratio of the number of people who installed chat on their site to the total number of registered customers. <br><br>  There is one not quite beautiful moment, which we did not find, how to solve directly: the column ‚Äúone‚Äù should be added to the source data table with the formula ‚Äú= 1‚Äù - so that in all cells of the source table there is a unit in this column. <br><br>  Now you can add such a calculated field: <br><br><img src="https://habrastorage.org/storage2/ebb/a8f/5dc/ebba8f5dcda69839009b01445d4cacce.png"><br><br>  Name we write "k1", in the formula we specify "= SUM (was_installed) / SUM (one)". <br><br><img src="https://habrastorage.org/storage2/436/d46/05d/436d4605d0a810e69887ab332e6d41f3.png"><br><br>  If the report in the summary table is grouped by weeks, then we get the ratio of the number of customers who installed the widget (SUM (was_installed)) to the total number of customers who registered for this week (SUM (one)).  If the report is grouped by month, the coefficient will be recalculated accordingly.  It is important to note that the conversion shows the proportion of customers who established a chat on their website among those who registered on a particular week.  Those.  if the client has registered on the fourth week, and has established a chat on the site only on the 10th week, then the figure in the 4th week report will change. <br><br>  Now we consider the conversion from installed to active clients: <br>  k2 = SUM (is_active) / SUM (was_installed) <br><br>  In the same way, we add a field for conversion from active clients to paid ones: <br>  k3 = SUM (is_paid) / SUM (is_active) <br><br>  Only k3 in the screenshots can not be shown, a trade secret :) <br><br>  Now in our pivot table there are fields k1, k2, k3, which can be dragged into the range of values.  Adding a little feng shui, we get this table by funnel broken down by weeks: <br><br><img src="https://habrastorage.org/storage2/04a/27b/8c1/04a27b8c16fd20f965a38f7ab37b3534.png"><br><br>  It is already possible to draw some conclusions from it, but we will leave the business analytics questions to another post, now we are interested in technical issues. <br><br><h4>  Monthly sales funnel </h4><br>  From the weekly report to make a report by month is very simple.  In the initial data, add the column ‚ÄúMonth of connection‚Äù with the formula ‚Äú= MONTH ([@ created])‚Äù, right-click on the pivot table - ‚Äúupdate‚Äù and drag the field ‚ÄúMonth of connection‚Äù in the pivot table to the ‚ÄúRow names‚Äù area (after "Year of connection").  It turns out like this: <br><br><img src="https://habrastorage.org/storage2/00f/d8e/80e/00fd8e80e7d6a2028a1a455100088fef.png"><br><br>  And here is a beautiful sign for months: <br><br><img src="https://habrastorage.org/storage2/e74/8d0/df9/e748d0df98af8c2e130b49cb9e4cadae.png"><br><br><h4>  Other report options </h4><br>  If you are not familiar with the pivot tables, I suggest you play with them yourself.  This is a great analytics tool that doesn‚Äôt reveal interesting dependencies.  For example, it is interesting to see the conversion at different stages in the context of the source of customers (advertising campaigns).  To do this, we save <a href="http://myemarketing.ru/marketing/utm-metki-i-analitika">UTM tags</a> in the database when registering each client, and build a report on the effectiveness of various advertising campaigns in absolute (rubles) and relative (conversion) units. <br><br>  By the way, double-clicking on each cell of the pivot table opens a list of rows of input data that were used to calculate this digit.  Very handy to figure out where it is growing from. <br><br>  In the pivot tables, there are many more features and tools that allow you to quickly get interesting reports.  I strongly recommend to all entrepreneurs who want to be aware of the processes occurring in their business, to master these tools. </div><p>Source: <a href="https://habr.com/ru/post/142864/">https://habr.com/ru/post/142864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142859/index.html">Architecture Bitrix24 - Inside View</a></li>
<li><a href="../142860/index.html">Google launched Trusted Stores service in test mode</a></li>
<li><a href="../142861/index.html">TSM service for managing NFC SIM applications</a></li>
<li><a href="../142862/index.html">Getting cross-domain data in Google Chrome via user scripts (bypassing a bug)</a></li>
<li><a href="../142863/index.html">Flickr has undergone major changes.</a></li>
<li><a href="../142865/index.html">SMS for MTS - in vain on the site I got to them</a></li>
<li><a href="../142867/index.html">Testing Iphone 2g for extreme EMF - a mini lightning strike</a></li>
<li><a href="../142868/index.html">Opera goes to the side of evil: Declared support for properties with the prefix -webkit-</a></li>
<li><a href="../142870/index.html">Analogue Teamviewer or VNC Strength</a></li>
<li><a href="../142871/index.html">How Google Russia advertises virus writers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>