<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a game calculator on the example of the game Aion</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Anyone who enjoys programming while playing a game always wants to screw something of their own or make something useful. Someone makes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a game calculator on the example of the game Aion</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Anyone who enjoys programming while playing a game always wants to screw something of their own or make something useful.  Someone makes modifications to the game, someone trainers or cheats, someone wiki or fan sites.  Not spared this passion party and me. <br>  I play at the moment in MMO Aion: Tower of Eternety (hereinafter, for simplicity, ‚ÄúAion‚Äù) from the Korean developer NCSOFT.  It is about her and go talk. <br><br>  The first thing that comes to mind regarding MMOs is user interface plugins.  Unfortunately, although the game supports add-ons, it‚Äôs impossible to create them for a mere mortal: there is no API documentation, and the client simply ignores them without a digital signature.  A very strange decision of the developers, but apparently, they have their own reasons. <br><br>  The second is the change in the appearance of the game items.  There seems to be no problems here, except that modification of the client is prohibited by the user agreement and that each user will have to install this modification.  In this way, you can ‚Äútry on‚Äù the appearance of new items that are only on Korean servers for now.  Again does not fit. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The third is various cheating devices.  To the credit of the developers, something really worthless simply by modifying the resources of the game cannot be obtained, everything is checked by the server and the tsiferka client rather for user reference and synchronization of actions on the screen with calculations on the server.  You can indulge in an increase in the size of any inconspicuous objects in the game, such as treasure chests or named monsters.  But it is fraught with glitches and again violates the PS as well as item 2. <br><br>  It remains to create out of the game, but on her topic, but we, of course, are interested in what can be coded, and not in fanarty or articles.  There are plenty of databases of varying degrees of relevance and scall on the Internet.  But what really did not exist before me was the character's calculator, at least I did not come across the online version.  With the introduction of new classes in the game, the existing skill calculators (stigmas) are also irrelevant.  The equipment calculator is complicated enough to start analyzing it, so let's talk about skills first. <br><a name="habracut"></a><br><h4>  Determination of requirements </h4><br>  So, a calculator was chosen as a project.  The first thing to decide in this case is the development tools.  The online focus of the game immediately cuts off the offline version of the application and implies a web, and I wanted to learn some experience in web programming, the benefit of the time was enough to sit and figure out, no bosses were in a hurry.  Partly because of this, it all started with the choice of tools. <br><br>  For the creation we need: <br><ul><li>  Game client and tools for unpacking resources </li><li>  Favorite programming language for parsing and converting game data locally on your computer.  Personally, I prefer Perl. </li><li>  Intermediate proficiency in HTML + CSS and JavaScript (jQuery).  Server programming is not necessary due to the simplicity of the calculator. </li><li>  A simple graphic editor for processing images of the interface from the game, for example Paint.NET. </li><li>  Batch image converter from dds to png to convert skill icons.  For example, ImageConverter + (enough of the trial, it does not put watermarks on images of size 40x40) </li><li>  Overcome laziness.  Although, perhaps, this is the main point, not the last. </li></ul><br><br>  Starting any development is always worth analyzing the subject area.  Let's see what are the skills in the game. <br><br>  The skills in the game are divided into 2 categories: those studied from books and those obtained by the installation of stigmas.  Stigma, in turn, are divided into 2 types: normal and improved.  Book skills are the same for all characters of one class, stigmas are usually strong skills, but they have a restriction on their use - a fixed number of slots for them.  Stigma and equipment completely determine the role of the character in the game and the group, the so-called ‚Äúbuild‚Äù (from the English build - build) character.  Simple stigmas can be installed in any free slot, improved only in the slot for improved and require the presence of 1 or 2 other stigmas, thus forming a skill tree. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/574/2a5/017/5742a5017d7ba684aaac2dde8a4be2b0.jpg" alt="Stigma in the game"><br><h6>  Stigma and a slice of my character's skill window </h6><br>  It is clear that there are fewer stigma slots than are available in the game and it would be nice to be able to conveniently calculate suitable options, despite the wretchedness of the balance in Korean MMO, there are still a lot of them.  It is her calculator and provide. <br><br>  Total skills: <br><ul><li>  Each class has 2 trees of improved stigma. </li><li>  The number of slots increases with increasing level to a maximum of 6 pieces of each type. </li><li>  The level of stigma can also increase with the growth of the character. </li><li>  Each stigma has a minimum level of character. </li><li>  Some stigmas are different for different races, either by name and icon or effect. </li><li>  Each stigma has an ‚Äúinsert‚Äù value in stigma fragments. </li><li>  Improved stigmas have an Abyss Points purchase price (AP, Abyss Points, a type of game currency associated with PvP). </li></ul><br>  Also, the final calculator should have the following functions: <br><ul><li>  The possibility of a set of stigmas for each of the game classes of any level from 20 (the first slot opens) to the maximum. </li><li>  The choice of stigm level. </li><li>  Ability to share the set with friends or in discussion forums.  This is a very important part of calculators. </li><li>  Multilingual, I was interested in receiving feedback from foreign players. </li></ul><br><br><h4>  Database </h4><br>  With the requirements and the subject area decided.  You can begin to study the material with which you have to work. <br><br>  The game client is written on the CryEngine 1 engine, so there are enough unpacking utilities on the Internet.  I will not discuss this point in detail here, there is enough material for one more article.  Even models and character animations were able to get out of the game. <br>  All digital data on objects and skills are stored in simple XML with encoding UTF16-LE, graphics in DDS (DirectDraw Surface - DirectX format).  Respect and respect for the developers for not hiding data behind seven locks with encryption and using human formats. <br>  Almost all the names of fields in XML correspond to their purpose and a lot of time to figure out what to spend is not necessary. <br><br>  Information on stigmas is stored in files with items, the format is uniform for all items, so there is a lot of excess garbage.  The fields containing the data necessary for the calculator look like this: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">client_item</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">abyss_point</span></span></span><span class="hljs-tag">&gt;</span></span>76350<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">abyss_point</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priest</span></span></span><span class="hljs-tag">&gt;</span></span>55<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priest</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">require_skill1</span></span></span><span class="hljs-tag">&gt;</span></span>PR_EternalServent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">require_skill1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">require_skill2</span></span></span><span class="hljs-tag">&gt;</span></span>PR_SufferMemory<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">require_skill2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">require_shard</span></span></span><span class="hljs-tag">&gt;</span></span>275<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">require_shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stigma_type</span></span></span><span class="hljs-tag">&gt;</span></span>Enhanced1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stigma_type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gain_skill1</span></span></span><span class="hljs-tag">&gt;</span></span>PR_CallLightning_G1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gain_skill1</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">race_permitted</span></span></span><span class="hljs-tag">&gt;</span></span>pc_light pc_dark<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">race_permitted</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">client_item</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Above is an improved level 55 stigma for a healer for 76350 AP giving the CallLightning (Thunder) skill of the first level.  The installation requires 275 stigma shards, the already established EternalServent (Holy Energy) and SufferMemory stigmas (Weakening stigma) and is available to characters of both races. <br><br>  The name of the skill consists of the class prefix - ‚ÄúPR‚Äù (priest), the devname of the skill - ‚ÄúCallLightning‚Äù and the skill level - ‚ÄúG1‚Äù (grade 1).  For the necessary stigmas, the level is not important, therefore it is not indicated, in fact, this is not a title of a skill at all, but a category.  Details about the description of skills will be discussed closer to the end of development.  This information is enough to build a tree and in general there is everything necessary except for the description of the skills themselves and their icons, we will return to them later. <br><br>  Using a small script, we obtain from the XML file the first version of the JSON base for the calculator in approximately the following form: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stigmas = { <span class="hljs-string"><span class="hljs-string">'priest'</span></span>: { ... <span class="hljs-string"><span class="hljs-string">"pr_calllightning"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">levels</span></span>:[<span class="hljs-number"><span class="hljs-number">55</span></span>,<span class="hljs-number"><span class="hljs-number">58</span></span>,<span class="hljs-number"><span class="hljs-number">61</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>],<span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-attr"><span class="hljs-attr">require</span></span>:[<span class="hljs-string"><span class="hljs-string">'pr_eternalservent'</span></span>,<span class="hljs-string"><span class="hljs-string">'pr_suffermemory'</span></span>],<span class="hljs-attr"><span class="hljs-attr">shards</span></span>:[<span class="hljs-number"><span class="hljs-number">275</span></span>,<span class="hljs-number"><span class="hljs-number">290</span></span>,<span class="hljs-number"><span class="hljs-number">732</span></span>,<span class="hljs-number"><span class="hljs-number">768</span></span>],<span class="hljs-attr"><span class="hljs-attr">abyss</span></span>:[<span class="hljs-number"><span class="hljs-number">76350</span></span>,<span class="hljs-number"><span class="hljs-number">91800</span></span>,<span class="hljs-number"><span class="hljs-number">187950</span></span>,<span class="hljs-number"><span class="hljs-number">205450</span></span>]}, ...</code> </pre><br><br>  For each class, abilities are listed as properties, in which, in turn, properties are given levels, the corresponding number of fragments and AP, as well as the necessary stigmas.  All that is specified in the XML above.  Data storage in JSON greatly simplifies working with them.  You shouldn‚Äôt push for minimization of the names of the properties of objects - it will reduce their compression without us, but it will not be very convenient to work.  If there is an overwhelming desire, then the name can be reduced to 1-2 letters, but better at the end of development. <br><br>  The file with all the skills turned out to be a little less than 20kb (to the final version it has grown to 45kb) and it will be noticeably stung by a deflate, stigmas are rarely updated (every large patch), and therefore there is no point in loading data using AJAX and you can store it statically in a separate js file.  It is also not necessary to sculpt all static databases into one file, this makes it difficult to update them. <br><br>  In the case of objects such a trick, of course, would not have passed.  Their total number exceeds 50,000 and the organization of the search in such a dump would be extremely inefficient.  Without a query to the database in such cases is not enough.  You should always choose a storage method appropriate to the amount of data and operations that will be performed on them.  Also, you should always choose a format that does not set a rigid framework, it often happens that you need to make changes that were not originally planned and still lie somewhere in the depths of the developers' minds.  Try to leave room for painless insertion of ‚Äúcrutches‚Äù. <br><br><h4>  Calculator outline </h4><br>  Here we have a base with the minimum necessary information, we can begin to make sketches.  With the help of game graphics that we have in the client, we make a draft version of the interface. At first, this can be done very schematically: with blocks with a frame and without graphics.  Being engaged in visualization at the initial stages of development, you can immediately identify some shortcomings in database design, if any, for example, a missing property or an inconvenient presentation format.  Also appears the first information about the convenience or convenience of working with a calculator. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be9/2aa/28d/be92aa28d6a722f8dbad8b57d8aaa4c3.jpg" alt="image"><br><br><h6>  Draft Interface Sketch </h6><br>  Most of the work area is occupied by stigma slots as the main element.  Nearby are the available regular stigmas and the bottom is an empty space for trees of improved stigma.  The skill trees have yet to be drawn as well as choosing a level with a class, but for the time being it is enough that you can set the missing values ‚Äã‚Äãhard in the code.  The list of available stigmas is formed according to the residual principle: everything that is not inserted into the slots is accessible. <br><br>  Already at the earliest stage it is worth getting rid of the magic numbers and variables as much as possible.  I brought everything to the Calc container object, and the functions will be stored there: <br><br><pre> <code class="javascript hljs">Calc = { <span class="hljs-attr"><span class="hljs-attr">className</span></span>:<span class="hljs-string"><span class="hljs-string">'priest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">race</span></span>:<span class="hljs-string"><span class="hljs-string">'pc_light'</span></span>, <span class="hljs-attr"><span class="hljs-attr">level</span></span>:<span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-attr"><span class="hljs-attr">slots</span></span>:[], <span class="hljs-attr"><span class="hljs-attr">norAllowed</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-attr"><span class="hljs-attr">advAllowed</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-attr"><span class="hljs-attr">norLevel</span></span>:[<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">55</span></span>], <span class="hljs-attr"><span class="hljs-attr">advLevel</span></span>:[<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">52</span></span>,<span class="hljs-number"><span class="hljs-number">55</span></span>,<span class="hljs-number"><span class="hljs-number">58</span></span>], <span class="hljs-attr"><span class="hljs-attr">SLOTS_NOR_MAX</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-attr"><span class="hljs-attr">SLOTS_ADV_MAX</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-attr"><span class="hljs-attr">MIN_CHAR_LEVEL</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">MAX_CHAR_LEVEL</span></span>: <span class="hljs-number"><span class="hljs-number">65</span></span> }</code> </pre><br><br>  The norAllowed and advAllowed values ‚Äã‚Äãstore the value of the available regular and improved slots, respectively, they are calculated from the character level level based on the norLevel and advLevel arrays containing slots appearance levels. <br>  For storing inserted stigmas, in my opinion, the array will be the most optimal data structure.  It is not rational to contain two arrays, this makes it difficult to iterate over the slots and sometimes it can be reduced to 1 cycle instead of 2x.  For example, the function checking whether a certain stigma is inserted or not, it does not need to know whether the 4th slot of improved stigma is available or not and just runs through the whole array, the removal function should take care of clearing it. <br><br>  Using variables instead of numbers makes it easy to vary the total number of slots without changing the logic of the functions.  So in my case, everyday stigmas are stored in the array under the indices from 0 to SLOTS_NOR_MAX - 1, and improved from SLOTS_NOR_MAX to SLOTS_NOR_MAX + SLOTS_ADV_MAX - 1. Thus, if all of a sudden the slots become 8 instead of 6, you only need to add them in the interface and set the values ‚Äã‚Äãfor SLOTST_TIV_NT_TOR__XXX_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXF and SLOTS_ADV_MAX - everything else will work with the new values ‚Äã‚Äãas if it always was. <br><br>  Available stigmas are drawn as blocks containing the name of the stigma in the identifier.  This allows you to use one handler for all stigmas and identify the desired stigma by the object identifier of the event that caused the event.  The skill level is automatically set to the maximum for the selected character level.  It is unlikely that someone is interested in lower levels and there is nothing to force the user to make a couple of clicks to change to the maximum.  For the same reason, the level of the character is initially also worth the maximum possible.  A good interface should be designed so that the most frequent actions are the simplest and lead to the expected result. <br>  Most users only view the finished options made up by other users and therefore it is better to unload the interface with such functions as level selection and deletion.  It is better to show them when you hover on exposed stigma. <br><img src="https://habrastorage.org/getpro/habr/post_images/4c6/59f/eef/4c659feef76faa393d813290f45be5d5.jpg" alt="Sketch"><br><br>  Here is the version that you can try yourself.  But this is only the beginning. <br><br><h4>  Skill trees </h4><br>  When building trees, a problem quickly emerged: some skills belong only to one of the races and improved stigma requires the installation of any of them.  Some of these skills also had different names.  There are several alternative solutions: add a property with a category and compare it according to it, rather than by name or list several options in require.  As a result, I settled on a mixed solution: I added a light or dark suffix to all names of race-specific skills and I added both skill options to require: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"pr_calllightning"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">levels</span></span>:[<span class="hljs-number"><span class="hljs-number">55</span></span>,<span class="hljs-number"><span class="hljs-number">58</span></span>,<span class="hljs-number"><span class="hljs-number">61</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>],<span class="hljs-attr"><span class="hljs-attr">type</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-attr"><span class="hljs-attr">require</span></span>:[[<span class="hljs-string"><span class="hljs-string">'pr_eternalservent_light'</span></span>,<span class="hljs-string"><span class="hljs-string">'pr_eternalservent_dark'</span></span>],<span class="hljs-string"><span class="hljs-string">'pr_suffermemory'</span></span>],<span class="hljs-attr"><span class="hljs-attr">shards</span></span>:[<span class="hljs-number"><span class="hljs-number">275</span></span>,<span class="hljs-number"><span class="hljs-number">290</span></span>,<span class="hljs-number"><span class="hljs-number">732</span></span>,<span class="hljs-number"><span class="hljs-number">768</span></span>],<span class="hljs-attr"><span class="hljs-attr">abyss</span></span>:[<span class="hljs-number"><span class="hljs-number">76350</span></span>,<span class="hljs-number"><span class="hljs-number">91800</span></span>,<span class="hljs-number"><span class="hljs-number">187950</span></span>,<span class="hljs-number"><span class="hljs-number">205450</span></span>]},</code> </pre><br><br>  You can immediately see the advantage of a scalable database, the necessary change was made without any problems and wasted time.  The skill suffix was later also used for the stigma filter for a particular race. <br>  The tree is counted each time a class is changed and in the document is displayed in a horizontal orientation based on tables.  With blocks it would be too hard to position in my opinion. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f82/4f0/b22/f824f0b22cf2ef0e03aa86c5020c0d58.jpg" alt="Trees"><br><br><h6>  Almost final view of the interface </h6><br>  Insertion of improved stigm is carried out directly from the icons in the tree along with all the leaves necessary for them.  What is undoubtedly convenient than setting stigm in order.  If there are not enough free slots, the icon is dimmed, the already established stigmas are also marked on the tree.  The visualization should be as understandable as possible without prompts: red is not possible, green is already there, gray is inaccessible.  If necessary, add text hints. <br><br><h4>  Tips and descriptions </h4><br>  With descriptions of skills things are more complicated than it seems at first glance.  Each skill is a description of its main properties (cost, time of use and reuse, goals, etc.) and from 1 to 4 effects that describe its action.  And if the main description is clear, the effects are described by a set of nameless fields reserved1-reserved24 meaning and a set that changes for each type of effect.  It took more time to analyze these values ‚Äã‚Äãof time than to write the entire calculator, but for all the skills of the game characters, the necessary values ‚Äã‚Äãwere compared with their logic as a result. <br><br>  The description line is a template for the substitution of this type: <br><br><pre> <code class="html hljs xml">  ,   [%e1.SpellATK_Instant.FixDamage] . .  : [%First_Target_Valid_Distance] .   [%e2.SpellATK.Damage] .     [%e2.SpellATK.CheckTime]  : [%e2.SpellATK.RemainTime] [%e4.StatDown.StatName] -[%e4.StatDown.Value].       ,       .</code> </pre><br><br>  The value pattern will be in general: the effect number, its name, and the name of the attribute.  The basic properties of a skill are recorded without effect prefixes.  It is better to leave the line in its original form, any alteration of it will complicate the database update.  So the substitution of values ‚Äã‚Äãin the description and, accordingly, the base should be adjusted to the kind that is in the original, unless the labor costs for it exceed the conversion of the source code into a more convenient form for work. <br><br>  The correspondence of the attributes has already been compiled and it is possible to make without any problems the converter of the description of skills into the necessary JSON format similar to the skills themselves, except that instead of division into classes, now the division into levels.  For the above skill, the data looks like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"pr_painlinks"</span></span>:{<span class="hljs-string"><span class="hljs-string">'1'</span></span>:{<span class="hljs-string"><span class="hljs-string">'e1.spellatk_instant.fixdamage'</span></span>:<span class="hljs-string"><span class="hljs-string">'532'</span></span>,<span class="hljs-string"><span class="hljs-string">'first_target_valid_distance'</span></span>:<span class="hljs-string"><span class="hljs-string">'25'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.checktime'</span></span>:<span class="hljs-string"><span class="hljs-string">'12'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>:<span class="hljs-string"><span class="hljs-string">'317 MP'</span></span>,<span class="hljs-string"><span class="hljs-string">'cooltime'</span></span>:<span class="hljs-string"><span class="hljs-string">'300'</span></span>,<span class="hljs-string"><span class="hljs-string">'e4.statdown.statname'</span></span>:<span class="hljs-string"><span class="hljs-string">'MagicalResist'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.remaintime'</span></span>:<span class="hljs-string"><span class="hljs-string">'120'</span></span>,<span class="hljs-string"><span class="hljs-string">'e4.statdown.value'</span></span>:<span class="hljs-string"><span class="hljs-string">'400'</span></span>,<span class="hljs-string"><span class="hljs-string">'casttime'</span></span>:<span class="hljs-string"><span class="hljs-string">'2'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.damage'</span></span>:<span class="hljs-string"><span class="hljs-string">'532'</span></span>}, <span class="hljs-string"><span class="hljs-string">'2'</span></span>:{<span class="hljs-string"><span class="hljs-string">'e1.spellatk_instant.fixdamage'</span></span>:<span class="hljs-string"><span class="hljs-string">'557'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>:<span class="hljs-string"><span class="hljs-string">'333 MP'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.damage'</span></span>:<span class="hljs-string"><span class="hljs-string">'557'</span></span>}, <span class="hljs-string"><span class="hljs-string">'3'</span></span>:{<span class="hljs-string"><span class="hljs-string">'e1.spellatk_instant.fixdamage'</span></span>:<span class="hljs-string"><span class="hljs-string">'590'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>:<span class="hljs-string"><span class="hljs-string">'355 MP'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.damage'</span></span>:<span class="hljs-string"><span class="hljs-string">'590'</span></span>}, <span class="hljs-string"><span class="hljs-string">'4'</span></span>:{<span class="hljs-string"><span class="hljs-string">'e1.spellatk_instant.fixdamage'</span></span>:<span class="hljs-string"><span class="hljs-string">'642'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>:<span class="hljs-string"><span class="hljs-string">'386 MP'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.damage'</span></span>:<span class="hljs-string"><span class="hljs-string">'642'</span></span>}, <span class="hljs-string"><span class="hljs-string">'5'</span></span>:{<span class="hljs-string"><span class="hljs-string">'e1.spellatk_instant.fixdamage'</span></span>:<span class="hljs-string"><span class="hljs-string">'690'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>:<span class="hljs-string"><span class="hljs-string">'413 MP'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.damage'</span></span>:<span class="hljs-string"><span class="hljs-string">'690'</span></span>}, <span class="hljs-string"><span class="hljs-string">'6'</span></span>:{<span class="hljs-string"><span class="hljs-string">'e1.spellatk_instant.fixdamage'</span></span>:<span class="hljs-string"><span class="hljs-string">'738'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>:<span class="hljs-string"><span class="hljs-string">'442 MP'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.damage'</span></span>:<span class="hljs-string"><span class="hljs-string">'738'</span></span>}, <span class="hljs-string"><span class="hljs-string">'7'</span></span>:{<span class="hljs-string"><span class="hljs-string">'e1.spellatk_instant.fixdamage'</span></span>:<span class="hljs-string"><span class="hljs-string">'799'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>:<span class="hljs-string"><span class="hljs-string">'508 MP'</span></span>,<span class="hljs-string"><span class="hljs-string">'e2.spellatk.damage'</span></span>:<span class="hljs-string"><span class="hljs-string">'824'</span></span>}},</code> </pre><br><br>  Given that most values ‚Äã‚Äãare repeated for all skill levels, it makes no sense to specify them each time.  So for the 1st level all properties are written, and then only changing.  When filling the template, moving from the desired level down through all the previous ones, we get complete information about the properties.  I strongly recommend to bring all identifiers to a single register if the source data is not sensitive to it - eliminates unnecessary checks and random errors. <br><br>  It is easiest to substitute values ‚Äã‚Äãwith a regular expression with a callback: <br><br><pre> <code class="javascript hljs">desc.replace(<span class="hljs-regexp"><span class="hljs-regexp">/\[%(.*?)\]%?/g</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ...   ... });</code> </pre><br><br>  If the property stores for some time - it is converted into a human-readable line (for example, instead of "90" it is written "1 min. 30 sec."), If the name of the character characteristic or some element of game mechanics (for example, "stunning") - then it is necessary to substitute its name in accordance with the selected language.  The remaining numbers remain as is. <br>  In conclusion, two consecutive percentages must be removed from the resulting line (the percentage can be both in the attribute value and after the pattern in the description line, the translators are people too and cannot know such things where to put the percentage and not) or points ( -for abbreviations "sec." and so on), which could happen with the substitution. <br><br>  The time of use, reuse and cost of the skill are not indicated in the description text.  They need to be added in addition. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f8e/fdc/dc0/f8efdcdc0a57ef6b36275f7c258c3ff4.jpg" alt="image"><br><br><h6>  Appearance hints </h6><br>  With regard to the position of the display is worth considering 2 nuances. <br>  First, the tooltip must be shifted relative to the stigma slot so as not to overlap the icon and level tooltip. <br>  Secondly, the tooltip may not fit on the screen to the right and it should be displayed on the opposite side of the cursor if it, of course, fits there.  A similar test should be done for the bottom edge of the tooltip.  This is very often neglected, and some pop-up windows on small monitors crawl off the screen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/832/043/ccc/832043cccabd20fc95c2c79af013c9c5.jpg" alt="image"><br><br><h6>  Tip positioning </h6><br><br><h4>  Multilingualism </h4><br>  It just so happened that I devoted little time to this moment and all of the hoo-yaps were done.  But it is impossible not to mention this section, especially since multilingualism was stated in the requirements. <br><br>  The easiest option is to abandon the dynamic change of the language and make it a full page reload.  There are 2 separate js files with strings in the appropriate language and the desired one is connected to the page.  This happens transparently to the user because when switching the hash is saved in the link and when the page is reloaded, the calculator status is exactly the same as it was before the language was changed. <br><br>  When you first enter a page, the language is determined by the Accept-Language header from the browser, then stored in Cookies and use the value from there.  In the way of cookies it is better to put the domain root and thereby save the language settings for the entire site.  This is convenient for the user and will save him from unnecessary manipulations with an incorrectly defined Accept-Language. <br><br>  For dynamic content, an auxiliary function is used that takes the desired value from the language js file, with the simplest template-ability. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLang</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">category, name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lang[category] &amp;&amp; lang[category][name]) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = lang[category][name]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.length <span class="hljs-number"><span class="hljs-number">-1</span></span>; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> re = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">'%'</span></span>+i, <span class="hljs-string"><span class="hljs-string">'g'</span></span>); result = result.replace(re, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } ... lang = $.extend(lang, { <span class="hljs-attr"><span class="hljs-attr">base</span></span> : { ... <span class="hljs-string"><span class="hljs-string">'reqlvl'</span></span>:<span class="hljs-string"><span class="hljs-string">'  %1 '</span></span>, ... getLang(<span class="hljs-string"><span class="hljs-string">'base'</span></span>, <span class="hljs-string"><span class="hljs-string">'reqlvl'</span></span>, <span class="hljs-number"><span class="hljs-number">65</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   65 </span></span></code> </pre><br><br>  For static content, localized strings are substituted when the page is loaded based on the container id.  It is logical that the text should be indicated in the markup of the document, albeit in this way. <br>  Already after I did everything in this way I found out that in HTML 5 there is such a thing as data attributes and I don‚Äôt need to write anything in id.  In the correct form, my method would look like this: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"iface-string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-stringid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"copyright"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">".iface-string"</span></span>).html(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getLang(<span class="hljs-string"><span class="hljs-string">'interface'</span></span>, $(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).data(<span class="hljs-string"><span class="hljs-string">'stringid'</span></span>)); });</code> </pre><br><br>  Such work with languages ‚Äã‚Äãis quite enough for a small project, but it requires a bit of php code (language definition, substitution of the necessary js). <br><br><h4>  To reduce or not to reduce? </h4><br>  So the main functionality is ready.  It remains only to save the result.  The first thing needed for this is a convenient and short identifier for classes and skills.  Since the game identifiers obviously do not fall under this definition, you will have to make your own.  What could be simpler and shorter than the sequence number?  Yes, perhaps nothing.  The only thing that needs to be done is to make sure that the numbering is not violated when updating the database. <br>  The amount of stigma can vary, but the level, race and class is always there.  So they should go at the beginning of the line with the result, followed by stigma indicating the level.  For example, like this: <br>  <i>0,65,0,7,0,18,6,28,2,1,0,12,0,15,0,6,6,13,4,19,6,14,6,32,5, 29.3</i> <br>  Well, such a record cannot be called short.  So it is necessary to reduce the number of characters by inventing an encoding algorithm. <br>  If you remove the delimiters between the numbers, it will be impossible to determine where one number ends and a new one begins.  It would seem that the problem is solved by increasing the base of the number system, but who can guarantee that in a year the sequence number will fit into this base?  Now the maximum number of stigmas in a class is 39, which already excludes the use of toString ().  Need another option. <br>  Then I decided to use another solution.  Letters be used as numbers, and the capital letter means that the next number refers to the same number.  those.  the number ends with a lowercase letter.  That is, the string ‚Äúbaa‚Äù corresponds to ‚Äú1.0.0‚Äù, and the string ‚ÄúBa‚Äù to ‚Äú26.0‚Äù.  Thus, there is no need for separators between numbers and almost all stigmas fit into 1 symbol.  You can numbering not in order, but the most rare stigma to put a larger identifier.  With this way, the string containing the class, level and 12 stigmas is obtained: <br>  <i>... / stigma / # aCnahasgBccbamapaggnetgogBgfBdd</i> <br>  In my opinion, a fairly short link is obtained in the end so as not to make the implementation of the reduction.  Fans of twitter let them use their services. <br>  The link is written in location.hash every time the set is changed, it is important to avoid looping if the set is updated from the event hash.  Watching the hash is highly desirable, because if the user inserts a link to another set in the same tab in the address bar, the page will not reload, the address before the hash is completely the same.  Accordingly, in this case, the link will not load without an event handler, which is clearly not consistent with the expected result. <br>  Also, for a clearer perception, the link can be duplicated in the text field somewhere in the interface, not everyone pays attention to the address bar.  With any click on the field, you need to select the entire text and block the input / editing.  Or you can use the Clipboard API, but not everywhere it will work without crutches (hi IE).  The best option is to check the presence of the Clipboard API and display the Share button or the text field otherwise, if religion, of course, allows you to use draft standards.  Personally, I am not allowed to be lazy, and even with the link field, the functionality looks somehow more obvious. <br><br><h4>  Summary </h4><br>  In just a couple of weeks it took a couple of hours a day to create a complete version of the calculator.  The structure of the code and data allows you to easily add new classes and skills to them, quickly update the descriptions and values ‚Äã‚Äãof skills.  Already on the day of the release of the update on the test server of Korea, you can have an idea about the new skills. <br>  The ability to save links to a set of stigmas helps in compiling guides and publishing videos or showing off your character in the forum signature. <br><br>  At present, on average, the calculator accounts for 4000 visits per day and 300 unique users, provided that no advertising of the resource was made because it is not needed - this is not a commercial development. <br><img src="http://habrastorage.org/getpro/habr/post_images/c07/db6/71b/c07db671bdd6d6558df06544f9d5e68a.jpg" alt="image"><br><h6>  Visitor statistics for the last month </h6><br><br>  I hope the tips from the article will help someone in the development of their projects or motivate to develop something useful. <br><br>  PS: I do not want to publish the link, since the hosting is small and will die.  If anyone is interested, you can ask in a personal or use search engines. <br><br>  PPS: There is also an equipment calculator for this topic that started it all <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="http://habrastorage.org/getpro/habr/post_images/dd0/e84/067/dd0e8406765d8bf42d154e3bda931f2f.jpg" alt="image"></div></div><br>  and a small piece ‚Äúwith a touch‚Äù on WebGL with game models and animation, abandoned at the ‚Äúoh nifiga!‚Äù stage.  works!  Further boring saw <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="http://habrastorage.org/getpro/habr/post_images/acb/a97/e0a/acba97e0a26607596d01db1eb70a4394.jpg" alt="image"></div></div><br>  If there is time, perhaps this publication will not end. </div><p>Source: <a href="https://habr.com/ru/post/203178/">https://habr.com/ru/post/203178/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203166/index.html">DIY for children. We collect USB microscope</a></li>
<li><a href="../203168/index.html">AOL plans to close SHOUTcast and sell Nullsoft assets to Microsoft</a></li>
<li><a href="../203170/index.html">Extension Node.js Tools for Visual Studio</a></li>
<li><a href="../203172/index.html">Brute force attack on github</a></li>
<li><a href="../203174/index.html">Management tools: 5 questions for clarification purposes or why do you need a BMW X5?</a></li>
<li><a href="../203182/index.html">Bitcoin What's next?</a></li>
<li><a href="../203184/index.html">Puppet + Opsview: template-based automatic monitoring</a></li>
<li><a href="../203186/index.html">Technical report on the development of the contactless charging system for mobile devices "Powell"</a></li>
<li><a href="../203190/index.html">Effective training for C # developers or proper C # programming from scratch</a></li>
<li><a href="../203194/index.html">How to generate a CREATE TABLE script for an existing table</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>