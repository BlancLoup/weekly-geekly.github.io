<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Glowing snowballs, or decorating the New Year with ‚Äúimprovised materials‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inspired by the article about LEDs in the snow , I wanted to try to do something similar in my own. In the comments to that article, I published ideas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Glowing snowballs, or decorating the New Year with ‚Äúimprovised materials‚Äù</h1><div class="post__text post__text-html js-mediator-article">  Inspired by the article <a href="http://habrahabr.ru/post/207130/">about LEDs in the snow</a> , I wanted to try to do something similar in my own.  In the comments to that article, I published ideas and a small handful of photos.  Even in spite of the fact that now there is snow in Moscow region is a scarce thing, this did not diminish the enthusiasm, rather the opposite - to realize the idea as soon as possible, while there is still snow. <br><br>  The first attempt was a flask with a statically shining LED, but a little later the board was finished with a small slice of speakers. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/7nrrzTUH7-c%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhhJl7lrwqkiI6uvMuiNB3UmYgg3Mw" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How it works and how to do something similar - look under the cut. <br>  PS "Podruzhnost" materials, most likely, applies to radio amateurs. <br><a name="habracut"></a><br><h4>  How it all began </h4><br>  First we need: <br><ul><li>  Transparent flask from the boot covers (can be taken at the nearest clinic) </li><li>  Holder for the battery type CR2032 (they are different, we need a clamp on the side) </li><li>  RGB LED (I used a planar, frame size 5050, dissipating) </li><li>  A few resistors (also planar, at 100 ohm - we will power from 3V - batteries) </li><li>  A piece of fiberglass with copper foil </li><li>  Copper sulfate or ferric chloride (or what else are you used to poison boards) </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/252/fc1/ce9/252fc1ce92e79ece0dfd2d3ac83677dd.jpg" alt="image"><br>  The board is drawn elementary (I didn‚Äôt even bother to unscrew the printer, took out a marker for drawing on CDs and quickly scribbled it, and then immediately threw it into the solution, I didn‚Äôt have time to take a picture). <br>  Here is the drawing board: <br><img src="https://habrastorage.org/getpro/habr/post_images/5db/a3c/3b6/5dba3c3b65a2cce18a54cb1d29e8452e.png"><br><br>  After etching, the board should be cut to the shape of a battery holder (the easiest way to do this is to pre-drill the holes and insert the holder at the back, then circle the holder with a marker. <b>ATTENTION!</b> Polarity matters! Watch the position of the holder‚Äôs ear!) And solder the LED, resistors and holder <br><br>  Here is what comes out of it: <br><img src="https://habrastorage.org/getpro/habr/post_images/d32/d8f/1c2/d32d8f1c2cf179cef33675da3ab9a321.jpg" alt="image"><br><br>  The board does not purposely solder one resistor, I wanted to get a purple glow, for this you need to turn on the red and blue channels by turning off the green one. <br><br>  This is how the simplest lamp turns out.  We cover the board with varnish (in fact, it is not necessary, but so the paths are less likely to darken), insert the battery, pack it in a flask and go to make snowballs! <br><br><h4>  And then Ostap suffered </h4><br>  As a programmer who breathes unevenly in the direction of any microcontroller technology, I decided to adapt a small chip to the business, which will bring a little more joy to this thing, causing the LED to glow beautifully in different colors. <br><br>  To do this, I took the Atmel ATtiny45 controller widely known in narrow circles (I wanted ATtiny13, but they were not suddenly in the box, the difference is only in the memory size. The program for this luminaire will fit in ATtiny13), I drew the board in Eagle and using laser-iron technology transferred the resulting picture to the foil textolite. <br><img src="https://habrastorage.org/getpro/habr/post_images/7ef/761/b69/7ef761b693832bea03edac1a18747119.jpg" alt="image"><br>  Compared with the previous version, a capacitor for a more stable power supply and the microcontroller appeared on the board.  In terms of components, one has to manage with a little blood, since the space on the board is limited.  I didn‚Äôt even provide a programming connector, I piped wires to the pins (especially for this, the LED channels were on the pins for programming, and I brought RESET to a separate platform).  Resistors and capacitors on this board size 0805. <br><br>  While the boards were being hounded, I started the program.  In ATtiny45, the hardware output of the PWM signal is supported on PB0, PB1 legs and a few more.  PB2 was not on this list.  But the board is already drawn and etched, so I decided to make software PWM using the second timer (Timer1). <br><br>  In order to make the luminaire more flexible in setting up, I applied such a mechanism.  The chip has a ROM (EEPROM).  In the first cell we will store the number that specifies the mode of operation.  After each power up, we will increase this value by 1 and save it in the ROM.  So, pulling the battery in the connector, you can switch modes of operation.  In order not to miss the right one, I duplicated each mode (in fact, the next mode will turn on after two juggling of the battery). <br><br><div class="spoiler">  <b class="spoiler_title">All C code (for AVR-GCC compiler)</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/io.h&gt; #include &lt;avr/eeprom.h&gt; #include &lt;util/delay.h&gt; #include &lt;avr/interrupt.h&gt; #define r_pwm(pwm) OCR0A = pwm #define b_pwm(pwm) OCR0B = pwm #define g_pwm(pwm) OCR1A = pwm #define NUM_MODES 16 int main(void) { /* Init LED GPIO pins */ DDRB = 7; /* pins 0, 1, 2 */ /* Init PWM timers */ /* Timer0 is for R and G channels */ TCCR0A = (1&lt;&lt;COM0A1)|(1&lt;&lt;COM0B1)|(WGM01)|(WGM00); TCCR0B = (1&lt;&lt;CS00); /* divide by 1 */ /* Timer 1 is for B channel; enable interrupts */ TIMSK = (1&lt;&lt;OCIE1A)|(1&lt;&lt;TOIE1); TCCR1 = (1&lt;&lt;CS10); /* divide by 1 */ sei(); /* Get mode value from the EEPROM and update it */ uint8_t mode = eeprom_read_byte((uint8_t *) 1); mode++; if (mode &gt;= NUM_MODES) mode = 0; eeprom_write_byte((uint8_t *) 1, mode); uint8_t i; while(1) { switch(mode &gt;&gt; 1) { case 0: r_pwm(255); break; case 1: g_pwm(255); break; case 2: b_pwm(255); break; case 3: r_pwm(255); g_pwm(255); break; case 4: g_pwm(255); b_pwm(255); break; case 5: r_pwm(255); b_pwm(255); break; case 6: r_pwm(255); g_pwm(255); b_pwm(255); break; case 7: for (i=0; i &lt; 255; i++) { r_pwm(255-i); g_pwm(i); _delay_ms(20); } for (i=0; i &lt; 255; i++) { g_pwm(255-i); b_pwm(i); _delay_ms(20); } for (i=0; i &lt; 255; i++) { b_pwm(255-i); r_pwm(i); _delay_ms(20); } } } return 0; } ISR(TIM1_OVF_vect) { if (OCR1A != 0) PORTB |= (1&lt;&lt;2); } ISR(TIM1_COMPA_vect) { PORTB &amp;= ~(1&lt;&lt;2); }</span></span></span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Circuit diagram and PCB layout (from Eagle CAD)</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/27d/bc5/629/27dbc56297ce0f82b0ef162bf03e47f4.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/3da/4bf/889/3da4bf8898e3e15524a6905600c572b4.png"><br></div></div><br><br>  Fuse bits can be counted <a href="http://www.engbedded.com/fusecalc">here</a> , I felt that 1 MHz is enough for me for comfortable PWM and for low power consumption.  Generally speaking, fusion beats turned out to be standard for tiny45, so you can not change them. <br><br>  I was already eager to try out a new craft in practice, because, having hurriedly sprinkled varnish from a can and letting it lie under the lamp for 5 minutes, I took it and ran out into the street with a camera (it was already quite late in the evening, just suitable conditions for testing). <br><br>  And here is the result (the video does not differ from the one inserted above to attract attention): <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/7nrrzTUH7-c%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhhJl7lrwqkiI6uvMuiNB3UmYgg3Mw" frameborder="0" allowfullscreen=""></iframe><br>  Snowballs did not want to be molded at all, and yet I warmed up a handful of snow in my hands and everything turned out well! <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/yz7F9jEqpD8%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhj8P_orSsEn6KGYrV0XUKu77cJarA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Important </h4><br>  For the idea of ‚Äã‚Äãmany thanks to Comrade.  <a href="http://geektimes.ru/users/kidar/" class="user_link">Kidar</a> . <br><br>  I posted all the materials on this project in <a href="https://www.dropbox.com/sh/s3zzh69watocq4r/Esk-X37qAe">Dropbox</a> .  When the time comes, I will prepare a separate makefile, and now after unpacking: make antares &amp;&amp; make build, after which you can upload the images / antares.hex file to the chip in a convenient way. <br><br>  Thanks for attention! <br><br>  <b>UPD:</b> Updated archives with source files;  Now, a complete PDF file for self-printing is included with the printed circuit board, and in the archive with the program is a hex file with ready-made firmware. </div><p>Source: <a href="https://habr.com/ru/post/207602/">https://habr.com/ru/post/207602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207588/index.html">Coworking in the regions - open or let others open?</a></li>
<li><a href="../207590/index.html">Robotics in data centers: prospects and problems</a></li>
<li><a href="../207592/index.html">Sound Sphere - Sony SRS-BTV5 speaker system overview</a></li>
<li><a href="../207594/index.html">Not a ‚Äúlie detector‚Äù at all</a></li>
<li><a href="../207596/index.html">LG taught smart home to talk through the instant messenger Line</a></li>
<li><a href="../207604/index.html">‚ÄúSun for Plankton‚Äù - the basis of light-modeling in DIALux</a></li>
<li><a href="../207606/index.html">Hello, my name is SiTLar, I am 30 years old and I am writing a self-documenting code</a></li>
<li><a href="../207608/index.html">New Year Testing Wiren Board</a></li>
<li><a href="../207612/index.html">Node.JS + taskset == a bit of weird humor</a></li>
<li><a href="../207614/index.html">Data transfer in the vehicle monitoring system - DDF technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>