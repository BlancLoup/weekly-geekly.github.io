<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Have you made a backup?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day % habrauser% ! 

 As you know backup - must be! But just to make an archive of data - this does not mean a competent backup. When Calculate d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Have you made a backup?</h1><div class="post__text post__text-html js-mediator-article">  Good day <b>% habrauser%</b> ! <br><br>  As you know backup - must be!  But just to make an archive of data - this does not mean a competent backup.  When <a href="http://www.calculate-linux.org/">Calculate directory server-</a> based servers started appearing at our clients, the question arose of choosing the means for creating backup copies of data.  The search for ready-made solutions did not give anything sensible, so I had to write it myself. <br><a name="habracut"></a><br>  To begin, I will say that we first need from the program: <br><ol><li>  Incremental archives </li><li>  Confidence in the availability of archives </li><li>  Customization flexibility </li><li>  Work report </li></ol><br>  Clause 1 has special requirements.  Not all archivers are able to do increments from an already incremental archive, and this is precisely what we need. <br><br>  The program is written in bash.  I will not give the text of the script here for it is large enough.  I'd better comment on the default config, so, in my opinion, the features of the program will be seen better. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The configuration file contains parameter blocks: one mandatory ‚Äúmain‚Äù and additional ones.  The required block has a strictly defined name ‚Äúmain‚Äù and describes the main archiving parameters, here you can also set common archiving parameters that will be used for all additional blocks.  Additional blocks may have arbitrary names.  They describe the parameters of specific archives.  The order of the block description does not matter, the main thing is to specify which block will be processed next. <br><br>  The configuration given below describes the following archiving logic: <br><ul><li>  The first day of each month to do a full data archive (monthly archive).  It will be placed in the folder "/ backup / ARCH / Monthly /" with the name "fullsystem.tar".  If successful, the old archives older than 3 months will be deleted. </li><li>  Every Sunday to do an incremental archive from the monthly (weekly archive).  It will be placed in the folder "/ backup / ARCH / Weekly /" with the same name.  If successful, the old archives older than 4 weeks will be deleted. </li><li>  Every day to do an incremental archive from the weekly (daily archive).  It will be placed in the folder "/ backup / ARCH / Dayly /" with the same name.  Upon successful completion, old archives older than 8 days will be deleted. </li><li>  The list of files to be archived is specified in the file ‚Äúmonthly.include‚Äù, the files that should be excluded are specified in ‚Äúmonthly.exclude‚Äù </li></ul><br> <code>$ cat /etc/defconf/main.conf <br> #    <br> #     ,      <br> #      .      (m) <br> <br> main { <br> <br> #      <br> #  . <br> DEF_ARCHIVE_PATH="/backup/ARCH" <br> <br> #      <br> ARCHIVE_PATH=$DEF_ARCHIVE_PATH <br> <br> #   <br> ARCHIVE_NAME="fullsystem.tar" <br> <br> #        <br> REMOVE_DEPTH=3 <br> <br> #   tar (m) <br> TAR_ADD_PARAMS="-vR" <br> <br> #        <br> # (   ) (m) <br> TAR_ERR_EXCLUDE="0 " <br> <br> #   (   "/etc/ssmtp/ssmtp.conf", <br> #       "mutt") <br> <br> #   <br> SUBJECT="ITEq Error level: $ERROR_CODE" <br> <br> #  <br> MAILTO="logger@site.ru" <br> <br> #      (all -  , error -   , <br> #        ) <br> SENDMAIL='all' <br> <br> #        <br> NEXT=montly <br> } <br> <br> #   <br> #       <br> #      <br> #    <br> <br> montly { <br> <br> ARCHIVE_PATH="$DEF_ARCHIVE_PATH/Monthly/" <br> <br> #        <br> #    1  12; 0 -   ( 1-12  0/1) <br> #         (1-3)  <br> #   (0/3).      <br> MONTH=0 <br> #MONTH=1-12 <br> #MONTH=0/1 <br> <br> #        <br> #    1  31 <br> #      <br> DAY=1 <br> <br> #        <br> #    1  7 (1 - ) <br> #         <br> DAY_OF_WEEK=0 <br> <br> #          <br> TO_ARCHIVE_FILE_LIST="monthly.include" <br> <br> #         <br> EXCLUDE_FROM_ARCHIVE="monthly.exclude" <br> <br> #     <br> REMOVE_DEPTH=3 <br> <br> #       <br> NEXT=weekly <br> } <br> <br> #   <br> weekly { <br> ARCHIVE_PATH="$DEF_ARCHIVE_PATH/Weekly/" <br> MONTH=0 <br> DAY=0 <br> DAY_OF_WEEK=7 <br> TO_ARCHIVE_FILE_LIST="monthly.include" <br> EXCLUDE_FROM_ARCHIVE="monthly.exclude" <br> REMOVE_DEPTH=4 <br> NEXT=dayly <br> } <br> <br> #  <br> dayly { <br> ARCHIVE_PATH="$DEF_ARCHIVE_PATH/Dayly/" <br> MONTH=0/1 <br> DAY=0 <br> DAY_OF_WEEK=0 <br> TO_ARCHIVE_FILE_LIST="monthly.include" <br> EXCLUDE_FROM_ARCHIVE="monthly.exclude" <br> REMOVE_DEPTH=8 <br> NEXT=none <br> } <br></code> <br><br>  To set the objects to be archived, as well as those excluded from it, regular files are used that are accepted by tar.  These two files should be located in the folder with the config.  Also in the folder with the config is the folder "services".  In this folder, you can throw links to services that will stop immediately before archiving, and then run again.  You can also throw executable files there, in which you can describe additional actions before and after archiving.  All these files are started with the ‚Äústop‚Äù parameter before archiving and ‚Äústart‚Äù after archiving. <br><br>  To install, download the <a href="http://narod.ru/disk/18319575000/bbackup%2520(copy%25202).tar.html">bbackup.tar</a> archive and unpack it where it is not a pity, and run ‚Äúsetup.sh‚Äù. <br><br>  The very start of the program to the disgrace is simple: <br>  bbackup.sh &lt;config file&gt; <br><br>  For example: <br>  $ bbackup.sh /etc/defconf/main.conf <br><br>  But the script was created for automation, so we stuff it into crowns for daily execution. <br><br> <code>echo -e "#!/bin/sh\n/sbin/bbackup.sh /etc/bbackup/defconf/main.conf"&gt;/etc/cron.daily/bbackup.sh</code> <br> <br>  On this, perhaps I finish.  All successful backups and let them never be useful to you! <br><br>  PS Immediately I bring my apologies for some confusion and unstructuredness of this post.  I have long wanted to write it, but still my hands did not reach, therefore it was written in a fit of enthusiasm to the detriment of sleep%) <br><br></div><p>Source: <a href="https://habr.com/ru/post/80235/">https://habr.com/ru/post/80235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80224/index.html">Create a media console from a Linux phone</a></li>
<li><a href="../80227/index.html">Does Google use ColdFusion?</a></li>
<li><a href="../80230/index.html">Stephen Hawking and Carl Sagan in music</a></li>
<li><a href="../80233/index.html">Google Nexus One Review</a></li>
<li><a href="../80234/index.html">Palm: update devices, open App directory</a></li>
<li><a href="../80237/index.html">If the whole Habr decided to unite to develop an innovative project, would you take part?</a></li>
<li><a href="../80238/index.html">The daily routine of Leonardo da Vinci</a></li>
<li><a href="../80239/index.html">Thinner screen - brighter display</a></li>
<li><a href="../80241/index.html">We write explanatory CORRECT</a></li>
<li><a href="../80242/index.html">Phishing and freelance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>