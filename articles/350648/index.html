<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating and hosting a telegram bot. From A to Z</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, habrchane! No matter how hackneyed the theme of creating a bot telegram on python3, I did not find instructions showing the path from the first li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating and hosting a telegram bot. From A to Z</h1><div class="post__text post__text-html js-mediator-article">  Hi, habrchane!  No matter how hackneyed the theme of creating a bot telegram on python3, I did not find instructions showing the path from the first line of code to the bot deployment (at least all the methods I saw were a bit out of date).  In this article I want to show the process of creating a bot from writing BotFather to deploying a bot on Heroku. <br><br>  The article was a long one, I advise you to go over the contents and click on the item that interests you. <br><br>  PS Write if you need an article to create a more complex bot, i.e.  with webhucks, databases with user settings, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text"><ol><li>  <a href="https://habr.com/ru/post/350648/">BotFather.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Install and configure pipenv.</a>  <a href="https://habr.com/ru/post/350648/">First start.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Handlers.</a>  <a href="https://habr.com/ru/post/350648/">We respond to commands and messages.</a> <br><ul><li>  <a href="https://habr.com/ru/post/350648/">Basics of interaction.</a>  <a href="https://habr.com/ru/post/350648/">The answer to the commands.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Basics of interaction.</a>  <a href="https://habr.com/ru/post/350648/">Reply to text messages.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Basics of interaction.</a>  <a href="https://habr.com/ru/post/350648/">The answer to pictures, documents, audio and others.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Build a chain of answers.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Add the parser to the chain.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Theory.</a>  <a href="https://habr.com/ru/post/350648/">Methods of interaction with the bot.</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/350648/">Marcapu.</a>  <a href="https://habr.com/ru/post/350648/">Add keyboard for quick response.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Deploy the bot on Heroku.</a> </li><li>  <a href="https://habr.com/ru/post/350648/">References</a> </li><li>  <a href="https://habr.com/ru/post/350648/">Conclusion</a> </li></ol><br></div></div><br>  For a start it is worth deciding what our bot will do.  I decided to write a <s>banal</s> simple bot, which will parse and give us headlines from Habr. <br>  And so, let's start the same. <br><a name="habracut"></a><br><h2><a name="anchor1"></a>  Botfather </h2><br>  First we need to register our bot in Telegram.  For this: <br><br>  In the search we drive in @BotFather and go into a dialogue with Father Bots. <br><br>  We write / newbot.  Specify the name of the bot (what is displayed in the dialogs).  We specify his login by which it can be found. <br><br>  PS It should end with bot / bot <br><br>  Here it is.  We were given an API key and a link to the bot.  It is advisable to save the API key and go into a dialogue with the bot, so you do not have to dig into the correspondence with the BotFather <br><br>  Next, add a couple of commands to it: write / setcommands and <b>one message</b> , since  / setcommands does not add commands, but sets them from scratch, send commands to it. <br><br> <code>all -     " " <br> top -     ""</code> <br> <br>  This is where the work with BotFather is over, let's move on to the next part. <br><br><h2><a name="anchor2"></a>  Install and configure pipenv.  First start. </h2><br>  To begin with, we will create a file in which <b>bot.py</b> will be the main bot <b>code</b> .  If the bot is large, then immediately create files where you take out functions, classes, etc., otherwise the readability of the code tends to zero.  I will add parser.py <br><br>  Install <b>pipenv</b> , if it certainly does not yet exist. <br><br>  For Windows: <br><br><pre> <code class="bash hljs">pip install pipenv</code> </pre> <br>  For Linux: <br><br><pre> <code class="bash hljs">sudo pip3 install pipenv</code> </pre> <br>  Install pipenv in the project folder. <br><br><pre> <code class="bash hljs">pipenv install</code> </pre> <br>  Install the libraries of interest to us.  I will work with PyTelegramBotAPI.  Also for parsing, add BeautifulSoup4. <br><br><pre> <code class="bash hljs">pipenv install PyTelegramBotAPI pipenv install beautifulsoup4</code> </pre><br>  Start writing code! <br><br>  Open bot.py, import the libraries and create the main variables. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parser <span class="hljs-comment"><span class="hljs-comment">#main variables TOKEN = "555555555:AAAAaaaAaaA1a1aA1AAAAAAaaAAaa4AA" bot = telebot.TeleBot(TOKEN)</span></span></code> </pre><br>  Run the bot.  Check for errors. <br><br><div class="spoiler">  <b class="spoiler_title">How to start?</b> <div class="spoiler_text">  For Windows: <br><br><pre> <code class="bash hljs">python bot.py</code> </pre> <br>  For Linux: <br><br><pre> <code class="bash hljs">python3 bot.py</code> </pre> <br></div></div><br>  If there are no errors, then continue. <br><br><h2><a name="anchor3"></a>  Handlers.  Responding to commands and messages </h2><br>  It's time to teach the bot to respond to us.  It is even possible to make his answers helpful. <br><br><h4><a name="anchor3-1"></a>  Basics of interaction.  Response to commands </h4><br>  To interact with the user, i.e.  Handlers are used to respond to his commands and messages. <br><br>  Let's start with the simplest: answer the commands / start and / go <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['start', 'go']) def start_handler(message): bot.send_message(message.chat.id, ',   ,      ') bot.polling()</span></span></code> </pre> <br>  Now we will understand what it is and how it works.  We pass in the message_handler command parameter equal to the array with strings ‚Äî commands to which it will respond in the manner described below.  (He will answer all these commands in the same way).  Next, use send_message, write the chat id into it (you can get it from message.chat.id) to which to send the message and, in fact, the message itself.  You can not forget to write bot.polling () at the end of the code, otherwise the bot immediately shut down.  Why do we find out later. <br><br>  Now you can run the bot and write him / start or / go and he will answer. <br><br>  PS The message can be not only a string, but, in principle, anything. <br><br><div class="spoiler">  <b class="spoiler_title">PSS What message?</b> <div class="spoiler_text">  This is a json object that stores information about the sender, chat, and the message itself. <br><br><pre> <code class="hljs pgsql">{ <span class="hljs-string"><span class="hljs-string">'content_type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-string"><span class="hljs-string">'message_id'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'from_user'</span></span>: { <span class="hljs-string"><span class="hljs-string">'id'</span></span>: <span class="hljs-number"><span class="hljs-number">333960329</span></span>, <span class="hljs-string"><span class="hljs-string">'first_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Nybkox'</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-string"><span class="hljs-string">'nybkox'</span></span>, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> }, <span class="hljs-string"><span class="hljs-string">'date'</span></span>: <span class="hljs-number"><span class="hljs-number">1520186598</span></span>, <span class="hljs-string"><span class="hljs-string">'chat'</span></span>: { <span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'private'</span></span>, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'first_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Nybkox'</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-string"><span class="hljs-string">'nybkox'</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span>: <span class="hljs-number"><span class="hljs-number">333960329</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'all_members_are_administrators'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> }, <span class="hljs-string"><span class="hljs-string">'forward_from_chat'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'forward_from'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'forward_date'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'reply_to_message'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'edit_date'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'/start'</span></span>, <span class="hljs-string"><span class="hljs-string">'entities'</span></span>: [&lt;telebot.<span class="hljs-keyword"><span class="hljs-keyword">types</span></span>.MessageEntity <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> at <span class="hljs-number"><span class="hljs-number">0x7f3061f42710</span></span>&gt;], <span class="hljs-string"><span class="hljs-string">'audio'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'document'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'photo'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'sticker'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'video'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'voice'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'caption'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'contact'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'location'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'venue'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'new_chat_member'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'left_chat_member'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'new_chat_title'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'new_chat_photo'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'delete_chat_photo'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'group_chat_created'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'supergroup_chat_created'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'channel_chat_created'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'migrate_to_chat_id'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'migrate_from_chat_id'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'pinned_message'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> }</code> </pre> <br></div></div><br><h4><a name="anchor3-2"></a>  Basics of interaction.  Reply to text messages. </h4><br>  Now we will process the text messages of the bot.  The most important thing we need to know is that the message text is stored in message.text and that in order to process the text in message_handler you need to pass content_types = ['text']. <br><br>  Add this code here. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(content_types=['text']) def text_handler(message): text = message.text.lower() chat_id = message.chat.id if text == "": bot.send_message(chat_id, ',   -  .') elif text == " ?": bot.send_message(chat_id, ',   ?') else: bot.send_message(chat_id, ',     :(')</span></span></code> </pre> <br>  Here we added a couple of variables: we carried the text of the message (in lower case, so that there were no unnecessary problems with those who write with a caps, a fence, etc.) into the text variable, carried the message.chat.id into a separate variable, so that every time refer to message.  We also built a small branch to respond to certain messages, as well as a response to the case of an incomprehensible bot message. <br><br><div class="spoiler">  <b class="spoiler_title">Summary code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parser <span class="hljs-comment"><span class="hljs-comment">#main variables TOKEN = "555555555:AAAAaaaAaaA1a1aA1AAAAAAaaAAaa4AA" bot = telebot.TeleBot(TOKEN) #handlers @bot.message_handler(commands=['start', 'go']) def start_handler(message): bot.send_message(message.chat.id, ',   ,      ') @bot.message_handler(content_types=['text']) def text_handler(message): text = message.text.lower() chat_id = message.chat.id if text == "": bot.send_message(chat_id, ',   -  .') elif text == " ?": bot.send_message(chat_id, ',   ?') else: bot.send_message(chat_id, ',     :(') bot.polling()</span></span></code> </pre><br></div></div><br><h4><a name="anchor3-3"></a>  Basics of interaction.  The answer to pictures, documents, audio and others. </h4><br>  To answer pictures, stickers, documents, audio, etc.  you just need to change the content_types = ['text']. <br><br>  Consider an example with a picture by adding this code. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(content_types=['photo']) def text_handler(message): chat_id = message.chat.id bot.send_message(chat_id, '.')</span></span></code> </pre><br>  All content types: <br><br> <code>text, audio, document, photo, sticker, video, video_note, voice, location, contact, new_chat_members, left_chat_member, new_chat_title, new_chat_photo, delete_chat_photo, group_chat_created, supergroup_chat_created, channel_chat_created, migrate_to_chat_id, migrate_from_chat_id, pinned_message</code> <br> <br><h4><a name="anchor3-4"></a>  Build a chain of answers. </h4><br>  It's time to end with elementary actions and start something serious.  Let's try to build a chain of answers.  For this we need register_next_step_handler ().  Let's create a simple example on which we'll figure out how register_next_step_handler () works. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['start', 'go']) def start_handler(message): chat_id = message.chat.id text = message.text msg = bot.send_message(chat_id, '  ?') bot.register_next_step_handler(msg, askAge) def askAge(message): chat_id = message.chat.id text = message.text if not text.isdigit(): msg = bot.send_message(chat_id, '   ,   .') bot.register_next_step_handler(msg, askAge) #askSource return msg = bot.send_message(chat_id, ',     ' + text + ' .')</span></span></code> </pre> <br>  And so, in the first function, bot.register_next_step_handler (msg, askAge) was added, to which we send the message we want to send and the next step to which we go after the user‚Äôs response. <br><br>  In the second function, everything is more interesting, here there is a check whether the user entered a number, and if not, the function recursively calls itself, with the message ‚ÄúAge must be a number, enter again.‚Äù.  If the user has entered everything correctly, then he gets an answer. <br><br>  But there is a problem here.  You can re-invoke the command / go or / start, and a mess will begin. <br><br><img src="https://hostingkartinok.com/show-image.php?id=0208e5f23b60698e790043ada2a0d36f" alt="image"><br>  This is easy to fix, we will add a variable to check the status of the script execution. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['start', 'go']) def start_handler(message): global isRunning if not isRunning: chat_id = message.chat.id text = message.text msg = bot.send_message(chat_id, '  ?') bot.register_next_step_handler(msg, askAge) #askSource isRunning = True def askAge(message): chat_id = message.chat.id text = message.text if not text.isdigit(): msg = bot.send_message(chat_id, '   ,   .') bot.register_next_step_handler(msg, askAge) #askSource return msg = bot.send_message(chat_id, ',     ' + text + ' .') isRunning = False</span></span></code> </pre> <br>  With the construction of simple chains, we figured out, let's go further. <br><br><h4><a name="anchor3-5"></a>  Add the parser to the chain. </h4><br>  First you need the parser itself.  Note that there are additional filters in the ‚ÄúBest‚Äù and ‚ÄúEverything in a row‚Äù tabs: day, week, month and ‚â•10, ‚â•25, ‚â•50, ‚â•100, respectively. <br>  Of course, the parser can also be written to 1 function, but I will break it down into 2, it will be easier to read the code. <br><br><div class="spoiler">  <b class="spoiler_title">Parser</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urllib.request <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BeautifulSoup <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitlesFromAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(amount, rating=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'all'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> output = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, amount+<span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rating == <span class="hljs-string"><span class="hljs-string">'all'</span></span>: html = urllib.request.urlopen(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/all/page'</span></span>+ str(i) +<span class="hljs-string"><span class="hljs-string">'/'</span></span>).read() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: html = urllib.request.urlopen(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/all/'</span></span>+ rating +<span class="hljs-string"><span class="hljs-string">'/page'</span></span>+ str(i) +<span class="hljs-string"><span class="hljs-string">'/'</span></span>).read() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> urllib.error.HTTPError: print(<span class="hljs-string"><span class="hljs-string">'Error 404 Not Found'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> soup = BeautifulSoup(html, <span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) title = soup.find_all(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, class_ = <span class="hljs-string"><span class="hljs-string">'post__title_link'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> title: i = i.get_text() output += (<span class="hljs-string"><span class="hljs-string">'- "'</span></span>+i+<span class="hljs-string"><span class="hljs-string">'",\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitlesFromTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(amount, age=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'daily'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> output = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, amount+<span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: html = urllib.request.urlopen(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/top/'</span></span>+ age +<span class="hljs-string"><span class="hljs-string">'/page'</span></span>+ str(i) +<span class="hljs-string"><span class="hljs-string">'/'</span></span>).read() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> urllib.error.HTTPError: print(<span class="hljs-string"><span class="hljs-string">'Error 404 Not Found'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> soup = BeautifulSoup(html, <span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) title = soup.find_all(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, class_ = <span class="hljs-string"><span class="hljs-string">'post__title_link'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> title: i = i.get_text() output += (<span class="hljs-string"><span class="hljs-string">'- "'</span></span>+i+<span class="hljs-string"><span class="hljs-string">'",\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output</code> </pre> <br></div></div><br>  At the end, the parser returns us a string with article headers, based on our requests. <br>  We try, using the knowledge gained, to write a bot associated with the parser.  I decided to create a separate class (this is most likely the wrong method, but this already applies to python, and not to the main topic of the article), and store the data being changed in the object of this class. <br><br>  Summary Code: <br><br><div class="spoiler">  <b class="spoiler_title">bot.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parser <span class="hljs-comment"><span class="hljs-comment">#main variables TOKEN = '509706011:AAF7ghlYpqS5n7uF8kN0VGDCaaHnxfZxofg' bot = telebot.TeleBot(TOKEN) task = Task() #handlers @bot.message_handler(commands=['start', 'go']) def start_handler(message): if not task.isRunning: chat_id = message.chat.id msg = bot.send_message(chat_id, ' ?') bot.register_next_step_handler(msg, askSource) task.isRunning = True def askSource(message): chat_id = message.chat.id text = message.text.lower() if text in task.names[0]: task.mySource = 'top' msg = bot.send_message(chat_id, '   ?') bot.register_next_step_handler(msg, askAge) elif text in task.names[1]: task.mySource = 'all' msg = bot.send_message(chat_id, '   ?') bot.register_next_step_handler(msg, askRating) else: msg = bot.send_message(chat_id, '  .   .') bot.register_next_step_handler(msg, askSource) return def askAge(message): chat_id = message.chat.id text = message.text.lower() filters = task.filters[0] if text not in filters: msg = bot.send_message(chat_id, '   .   .') bot.register_next_step_handler(msg, askAge) return task.myFilter = task.filters_code_names[0][filters.index(text)] msg = bot.send_message(chat_id, '  ?') bot.register_next_step_handler(msg, askAmount) def askRating(message): chat_id = message.chat.id text = message.text.lower() filters = task.filters[1] if text not in filters: msg = bot.send_message(chat_id, '  .   .') bot.register_next_step_handler(msg, askRating) return task.myFilter = task.filters_code_names[1][filters.index(text)] msg = bot.send_message(chat_id, '  ?') bot.register_next_step_handler(msg, askAmount) def askAmount(message): chat_id = message.chat.id text = message.text.lower() if not text.isdigit(): msg = bot.send_message(chat_id, '    .  .') bot.register_next_step_handler(msg, askAmount) return if int(text) &lt; 1 or int(text) &gt; 11: msg = bot.send_message(chat_id, '    &gt;0  &lt;11.  .') bot.register_next_step_handler(msg, askAmount) return task.isRunning = False output = '' if task.mySource == 'top': output = parser.getTitlesFromTop(int(text), task.myFilter) else: output = parser.getTitlesFromAll(int(text), task.myFilter) msg = bot.send_message(chat_id, output) bot.polling(none_stop=True)</span></span></code> </pre> <br>  Then added <code>none_stop=True)</code> to <code>bot.polling</code> , because of this, the bot will not fall with every error. <br></div></div><div class="spoiler">  <b class="spoiler_title">Task.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Task</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> isRunning = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> names = [ [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'all'</span></span>] ] filters = [ [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'10'</span></span>, <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'50'</span></span>, <span class="hljs-string"><span class="hljs-string">'100'</span></span>] ] filters_code_names = [ [<span class="hljs-string"><span class="hljs-string">'daily'</span></span>, <span class="hljs-string"><span class="hljs-string">'weekly'</span></span>, <span class="hljs-string"><span class="hljs-string">'monthly'</span></span>], [<span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-string"><span class="hljs-string">'top10'</span></span>, <span class="hljs-string"><span class="hljs-string">'top25'</span></span>, <span class="hljs-string"><span class="hljs-string">'top50'</span></span>, <span class="hljs-string"><span class="hljs-string">'top100'</span></span>] ] mySource = <span class="hljs-string"><span class="hljs-string">''</span></span> myFilter = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">parser.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urllib.request <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BeautifulSoup <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitlesFromAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(amount, rating=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'all'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> output = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, amount+<span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rating == <span class="hljs-string"><span class="hljs-string">'all'</span></span>: html = urllib.request.urlopen(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/all/page'</span></span>+ str(i) +<span class="hljs-string"><span class="hljs-string">'/'</span></span>).read() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: html = urllib.request.urlopen(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/all/'</span></span>+ rating +<span class="hljs-string"><span class="hljs-string">'/page'</span></span>+ str(i) +<span class="hljs-string"><span class="hljs-string">'/'</span></span>).read() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> urllib.error.HTTPError: print(<span class="hljs-string"><span class="hljs-string">'Error 404 Not Found'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> soup = BeautifulSoup(html, <span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) title = soup.find_all(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, class_ = <span class="hljs-string"><span class="hljs-string">'post__title_link'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> title: i = i.get_text() output += (<span class="hljs-string"><span class="hljs-string">'- "'</span></span>+i+<span class="hljs-string"><span class="hljs-string">'",\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitlesFromTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(amount, age=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'daily'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> output = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, amount+<span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: html = urllib.request.urlopen(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/top/'</span></span>+ age +<span class="hljs-string"><span class="hljs-string">'/page'</span></span>+ str(i) +<span class="hljs-string"><span class="hljs-string">'/'</span></span>).read() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> urllib.error.HTTPError: print(<span class="hljs-string"><span class="hljs-string">'Error 404 Not Found'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> soup = BeautifulSoup(html, <span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) title = soup.find_all(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, class_ = <span class="hljs-string"><span class="hljs-string">'post__title_link'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> title: i = i.get_text() output += (<span class="hljs-string"><span class="hljs-string">'- "'</span></span>+i+<span class="hljs-string"><span class="hljs-string">'",\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output</code> </pre> <br></div></div><br><h4><a name="anchor3-6"></a>  Theory.  Methods of interaction with the bot. </h4><br>  We use long polling to get data about the messages from the bot. <br><br> <code>bot.polling(none_stop=True)</code> <br> <br>  There is also an option to use another method in the root - webhuki.  So the bot itself will send us data about the receipt of the message, etc.  But this method is more difficult to configure, and, for a simple exponential bot, I decided not to use it. <br><br>  Also in the additional materials will be links to everything that was used and what was said. <br><br><h2><a name="anchor4"></a>  Marcapu.  Add keyboard for quick response. </h2><br>  Finally, the main code is added.  Now you can take a break and write stamps.  I think you have repeatedly seen them, but still, I will attach a screenshot.  [SCREENSHOT] <br><br>  I will display the markups in a separate file - markups.py. <br><br>  There is nothing difficult in writing marcaps.  You just need to create a markup, specify a couple of parameters, create a couple of buttons and add them to the markup, then simply specify <code>reply_markup=markup</code> in <code>send_message</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text">  markups.py <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telebot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> types source_markup = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">2</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) source_markup_btn1 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">''</span></span>) source_markup_btn2 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">' '</span></span>) source_markup.add(source_markup_btn1, source_markup_btn2)</code> </pre><br>  In the parameters of the markup we specify the width of the string and the resizing of the buttons, otherwise they are huge. <br><br><div class="spoiler">  <b class="spoiler_title">You can of course fill in each row separately.</b> <div class="spoiler_text"><pre> <code class="python hljs">markup = types.ReplyKeyboardMarkup() itembtna = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'a'</span></span>) itembtnv = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'v'</span></span>) itembtnc = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'c'</span></span>) itembtnd = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'d'</span></span>) itembtne = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'e'</span></span>) markup.row(itembtna, itembtnv) markup.row(itembtnc, itembtnd, itembtne)</code> </pre> <br></div></div><br>  bot.py <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> task.isRunning: chat_id = message.chat.id msg = bot.send_message(chat_id, <span class="hljs-string"><span class="hljs-string">' ?'</span></span>, reply_markup=m.source_markup) bot.register_next_step_handler(msg, askSource) task.isRunning = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br></div></div><br>  Apply this knowledge to our bot. <br><br><div class="spoiler">  <b class="spoiler_title">Summary code</b> <div class="spoiler_text">  markups.py <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telebot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> types start_markup = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">1</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) start_markup_btn1 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'/start'</span></span>) start_markup.add(start_markup_btn1) source_markup = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">2</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) source_markup_btn1 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">''</span></span>) source_markup_btn2 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">' '</span></span>) source_markup.add(source_markup_btn1, source_markup_btn2) age_markup = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">3</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) age_markup_btn1 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">''</span></span>) age_markup_btn2 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">''</span></span>) age_markup_btn3 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">''</span></span>) age_markup.add(age_markup_btn1, age_markup_btn2, age_markup_btn3) rating_markup = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">3</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) rating_markup_btn1 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">' '</span></span>) rating_markup_btn2 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'10'</span></span>) rating_markup_btn3 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'25'</span></span>) rating_markup_btn4 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'50'</span></span>) rating_markup_btn5 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'100'</span></span>) rating_markup.row(rating_markup_btn1, rating_markup_btn2) rating_markup.row(rating_markup_btn3, rating_markup_btn4, rating_markup_btn5) amount_markup = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">3</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) amount_markup_btn1 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'1'</span></span>) amount_markup_btn2 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'3'</span></span>) amount_markup_btn3 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'5'</span></span>) amount_markup.add(amount_markup_btn1, amount_markup_btn2, amount_markup_btn3)</code> </pre> <br>  bot.py <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> markups <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> m <span class="hljs-comment"><span class="hljs-comment">#main variables TOKEN = '509706011:AAF7aaaaaaaaaaaaaaaaaaaAAAaaAAaAaAAAaa' bot = telebot.TeleBot(TOKEN) task = Task() #handlers @bot.message_handler(commands=['start', 'go']) def start_handler(message): if not task.isRunning: chat_id = message.chat.id msg = bot.send_message(chat_id, ' ?', reply_markup=m.source_markup) bot.register_next_step_handler(msg, askSource) task.isRunning = True def askSource(message): chat_id = message.chat.id text = message.text.lower() if text in task.names[0]: task.mySource = 'top' msg = bot.send_message(chat_id, '   ?', reply_markup=m.age_markup) bot.register_next_step_handler(msg, askAge) elif text in task.names[1]: task.mySource = 'all' msg = bot.send_message(chat_id, '   ?', reply_markup=m.rating_markup) bot.register_next_step_handler(msg, askRating) else: msg = bot.send_message(chat_id, '  .   .') bot.register_next_step_handler(msg, askSource) return def askAge(message): chat_id = message.chat.id text = message.text.lower() filters = task.filters[0] if text not in filters: msg = bot.send_message(chat_id, '   .   .') bot.register_next_step_handler(msg, askAge) return task.myFilter = task.filters_code_names[0][filters.index(text)] msg = bot.send_message(chat_id, '  ?', reply_markup=m.amount_markup) bot.register_next_step_handler(msg, askAmount) def askRating(message): chat_id = message.chat.id text = message.text.lower() filters = task.filters[1] if text not in filters: msg = bot.send_message(chat_id, '  .   .') bot.register_next_step_handler(msg, askRating) return task.myFilter = task.filters_code_names[1][filters.index(text)] msg = bot.send_message(chat_id, '  ?', reply_markup=m.amount_markup) bot.register_next_step_handler(msg, askAmount) def askAmount(message): chat_id = message.chat.id text = message.text.lower() if not text.isdigit(): msg = bot.send_message(chat_id, '    .  .') bot.register_next_step_handler(msg, askAmount) return if int(text) &lt; 1 or int(text) &gt; 5: msg = bot.send_message(chat_id, '    &gt;0  &lt;6.  .') bot.register_next_step_handler(msg, askAmount) return task.isRunning = False print(task.mySource + " | " + task.myFilter + ' | ' + text) # output = '' if task.mySource == 'top': output = parser.getTitlesFromTop(int(text), task.myFilter) else: output = parser.getTitlesFromAll(int(text), task.myFilter) msg = bot.send_message(chat_id, output, reply_markup=m.start_markup) bot.polling(none_stop=True)</span></span></code> </pre> <br></div></div><br><br>  Hooray!  With the code in principle understood.  Now the most important thing is the deployment of the bot is not heroku. <br><br><h2><a name="anchor5"></a>  Deploy the bot on Heroku. </h2><br>  First you need to register on <a href="https://heroku.com/">Heroka</a> and <a href="https://github.com/">Github</a> . <br><br>  Now we create a repository on github.  <s>(click the plus sign to the left of your avatar)</s> <br>  Now we need a Procfile (Procfile.windows for windows).  Create it and write <code>bot: python3 bot.py</code> into it <code>bot: python3 bot.py</code> <br><br>  Now we delete TOKEN from bot.py, here it is not needed, because we will upload this file to the github.  Through the same terminal that was used to launch the bot, upload files to the githab.  (Previously delete the __ pycache__ folder). <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"# HabrParser_Bot"</span></span> &gt;&gt; README.md git init git add . git add * git commit -m <span class="hljs-string"><span class="hljs-string">"Initial Commit"</span></span> -a git remote add origin origin https://github.com/name/botname.git <span class="hljs-comment"><span class="hljs-comment">#   git push -u origin master</span></span></code> </pre><br>  Git asks for a username and password, quietly enter and break the deployment of the bot to heroku.  We write everything in the same terminal. <br><br>  Now we return TOKEN to bot.py, here it is needed, because we will upload this file to the hero. <br><br><pre> <code class="hljs pgsql">heroku <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> # email   heroku <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-comment"><span class="hljs-comment">--region eu habrparserbot #    #PS         ,   . heroku addons:create heroku-redis:hobby-dev -a habrparserbot #   ! heroku buildpacks:set heroku/python git push heroku master heroku ps:scale bot=1 #   heroku logs --tail # </span></span></code> </pre><br>  To turn off the bot <pre> <code class="bash hljs">heroku ps:stop bot</code> </pre> <br>  And, do not forget before pouring on the githab and remove TOKEN from our bot.py.  After all, we do not need anyone to use it.  <s>You can of course use .gitignore and put the tokens in a separate file.</s> <br><h5>  Congratulations! </h5><br>  Work is over, the bot is working remotely. <br><br><h2><a name="anchor6"></a>  Links </h2><br>  <a href="https://github.com/Nybkox/HabrParser_Bot">Ending bot code on githaba</a> <br>  <a href="https://github.com/eternnoir/pyTelegramBotAPI">API to control the bot</a> <br>  <a href="https://github.com/Kylmakalle/heroku-telegram-bot">Pro Deploing</a> <br>  <a href="https://robots.thoughtbot.com/how-to-manage-your-python-projects-with-pipenv">Pro pipenv</a> <br>  <a href="https://www.gitbook.com/book/groosha/telegram-bot-lessons/details">Big Guide, maybe someone will come in handy</a> <br><br><h2><a name="anchor7"></a>  Conclusion </h2><br>  If someone was interested, then the purpose of writing the article is completed.  If someone wants to see an article about a more complex bot (with webhacks, a connected database with user settings, etc.) - write. <br><br><div class="spoiler">  <b class="spoiler_title">UPDATES</b> <div class="spoiler_text"><h5>  UPD1 </h5><ul><li>  Added anchors to the content. </li><li>  Changed the code flashing algorithm for githab and heroku. </li><li>  Removed version of PyTelegramBotAPI, because  Now herooku works fine with new versions. </li></ul></div></div></div><p>Source: <a href="https://habr.com/ru/post/350648/">https://habr.com/ru/post/350648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350636/index.html">Cooking Juniper Network with Ansible</a></li>
<li><a href="../350638/index.html">Hardcore Java / JVM puzzles</a></li>
<li><a href="../350640/index.html">Bathroom mosaic and Diophantine equations</a></li>
<li><a href="../350642/index.html">How I earned $ 200,000 at 16</a></li>
<li><a href="../350646/index.html">How we communicate with React components using TypeScript decorators</a></li>
<li><a href="../350654/index.html">Interview on Data Science: what is expected of you</a></li>
<li><a href="../350656/index.html">ASC scenario as the basis of timeliness and harmony in business</a></li>
<li><a href="../350658/index.html">CSS weirdness to know about</a></li>
<li><a href="../350660/index.html">GitLab 10.5 released: integration with Let's Encrypt, Gemnasium dependency checks and external CI / CD files</a></li>
<li><a href="../350662/index.html">Creating animation transitions between Activity in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>