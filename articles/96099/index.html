<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMS notifications from Nagios with little blood</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once the admin was standing in a smoking room and thinking - how could he find out during off-hours, away from the computer and the Internet, that a p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMS notifications from Nagios with little blood</h1><div class="post__text post__text-html js-mediator-article">  Once the admin was standing in a smoking room and thinking - how could he find out during off-hours, away from the computer and the Internet, that a problem had arisen on one of his servers.  You can of course put a student at the monitor with <a href="http://www.nagios.org/">Nagios</a> , so that if he called the admin and said, ‚ÄúSomething red appeared here ...‚Äù Stop.  I called.  On the mobile phone.  Nafig student SMS can be received.  The thought stopped and the admin went to drink coffee.  Then he came back and sat down at the workplace where the <a href="http://www.google.com/calendar/">Google Calendar</a> was loaded in the browser ... and the solution came by itself. <br><a name="habracut"></a><br>  So, we have configured Nagios and the desire to receive SMS about the problems encountered on your phone. <br>  For convenience, we <a href="https://www.google.com/accounts/NewAccount">register a</a> separate Google account - something like nagios_alert@your-company-domain.com and go to set up a calendar for this account.  We are interested in notifications for the calendar by default - set the notification 1 minute before the event by SMS. <br>  You also need to bind your mobile number to this account (this is done in the same place in the calendar settings). <br>  Next, follow this link: <a href="https://github.com/insanum/gcalcli">github.com/insanum/gcalcli</a> and download GCalCLI, a console utility in Python that allows you to work with the Google calendar. <br>  All that is required for the utility to work is described on the project page, there is literally a couple of Python modules. <br>  For gcalcli to work properly, you need to finish it a bit (where without it). <br>  Open the file for editing, go to line 226 and change it to this: <br><pre><code class="python hljs">feedPrefix = <span class="hljs-string"><span class="hljs-string">'https?://www.google.com/calendar/feeds/'</span></span></code> </pre> <br>  Next, we put this script somewhere more comfortable, where the account from which the Nagios-demon is spinning could launch it.  I chose / usr / bin. <br>  Next to gcalcli we put a bash-script of the following content: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # notify_sms for Nagios by Br0ziliy NOW_HOUR=`date +%-H` NOW_MIN=`date +%-M` [ $NOW_HOUR -gt 0 ] &amp;&amp; H=$(( $NOW_HOUR-1 )) || H=23 [ $NOW_MIN -lt 55 ] &amp;&amp; M=$(( $NOW_MIN+5 )) || M=59 /usr/bin/gcalcli --user nagios_alert@your-company-domain.com --pw yourpass quick "$H:$M $@"</span></span></code> </pre><br>  The script will add a ‚Äúquick‚Äù event to the calendar of the account nagios_alert@your-company-domain.com with the text that will be transmitted in the parameters (see below). <br>  I also note that the time on the Nagios server and my local time differ by 1 hour - this difference is taken into account in the script. <br>  Next, configure Nagios itself. <br>  Add the notify-service-by-sms command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">define</span></span> command{ <span class="hljs-attribute"><span class="hljs-attribute">command_name</span></span> notify-service-by-sms command_line /usr/bin/notify_sms <span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$NOTIFICATIONTYPE</span></span></span><span class="hljs-string">$ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOSTALIAS</span></span></span><span class="hljs-string">$/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SERVICEDESC</span></span></span><span class="hljs-string">$: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SERVICEOUTPUT</span></span></span><span class="hljs-string">$'</span></span> }</code> </pre><br>  Add a separate contact for SMS-notifications (so easy to use): <br><pre> <code class="hljs pgsql">define contact{ contact_name mobile mobile host_notification_period never #      service_notification_period nonworkhours # SMS      service_notification_options c,r #     service_notification_commands <span class="hljs-keyword"><span class="hljs-keyword">notify</span></span>-service-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-sms host_notification_commands <span class="hljs-keyword"><span class="hljs-keyword">notify</span></span>-host-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-email }</code> </pre><br>  Add this contact to the right group, restart Nagios - everything.  Now the admin will always know where the cho lies.  My test message arrives exactly 8 minutes after the problem has appeared (you may have more / less depending on Nagios settings). <br><br>  As for the mobile phone number - I tested it on the MTS - it works at 5. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As for paid SMS sending services, yes, I know about them, but in the title of the topic, therefore, there are words with ‚Äúlittle blood‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/96099/">https://habr.com/ru/post/96099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96091/index.html">Some aspects of the development of payment systems. Part I. Three-link without three-link</a></li>
<li><a href="../96092/index.html">Akopov was marked in VKontakte</a></li>
<li><a href="../96095/index.html">Configuring Mercurial and Visual Studio interaction</a></li>
<li><a href="../96096/index.html">Distributed computing and p2p business model</a></li>
<li><a href="../96098/index.html">Microsoft Dynamics CRM. Plug-ins (plug-ins) and extensions (add-ons)</a></li>
<li><a href="../96101/index.html">Monitor changes to network device configuration files</a></li>
<li><a href="../96104/index.html">Autoportal KhMAO</a></li>
<li><a href="../96105/index.html">How to organize an event</a></li>
<li><a href="../96108/index.html">Qmmp: continued. Alternative Interfaces</a></li>
<li><a href="../96109/index.html">Fast download</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>