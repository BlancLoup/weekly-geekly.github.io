<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Apple Push Notification Service Guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a free translation of the Apple Push Notification Service guide on raywenderlich.com and some of my additions. 

 iOS apps cannot be i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Apple Push Notification Service Guide</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/211/77a/f02/21177af02920140711eb8a1563523454.png" align="right">  <em>This article is a free translation of the Apple Push Notification Service guide on raywenderlich.com and some of my additions.</em> <br><br>  iOS apps cannot be in the background for a long time.  In order to conserve battery power, applications running in the background are allowed to perform a limited set of actions. <br><br>  But what if something interesting happens and you want to inform the users about it, even if your application is not running? <br><a name="habracut"></a><br>  For example, a user received a response on Twitter, or his favorite team won the game, or his dinner is ready.  Since the application is not running, it cannot verify and receive this data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Fortunately, Apple has provided a solution to this problem.  Instead of continuously checking events or performing any actions in the background, you can create the server side of the application that will perform these actions. <br><br>  And when the event of interest arrives, the server side will be able to send a push notification to the application!  Absolutely any push notification can perform the following three actions: <br><br><ol><li>  Show short text message. </li><li>  Play a short beep. </li><li>  Set the number on the badge application icons. </li></ol><br>  You can combine these actions as you see fit;  for example, play the sound and set the number on the badge, but do not show the message. <br><br><h2>  Short review </h2><br>  The scheme of the push-notification mechanism: <br><br><img src="https://habrastorage.org/storage2/e96/ff8/b76/e96ff8b764d4114090f84d979aeb070c.png"><br><br>  After installing the application, a pop-up message will appear confirming acceptance of push notifications. <br><br><ol><li>  iOS requests the token of the device from the Apple Push Notification Service (APNS) server. </li><li>  The application gets a token device.  We can assume that the token is the address for sending push notifications. </li><li>  The application sends a token device to your server. </li><li>  When an event occurs for your application, the server will send a push notification to APNS. </li><li>  APNS will send a push notification to the user's device. </li></ol><br>  When the user receives a push notification, a message will appear, and / or a beep will sound, and / or the badge will be updated on the application icon.  The user can open the application from the notification.  The application will receive the content of the push notification and be able to process it. <br><br>  Should I still use push notifications if local notifications and multitasking have already appeared in iOS 4.0?  Still would! <br><br>  Local notifications are time-limited events.  Only VOIP applications, navigation, and background audio playback have unlimited background execution capability.  If you need to notify users of the application (as long as it is closed) about any external event, you still need to use push notifications. <br><br>  This guide will describe in detail the work of the system of push-notifications and how to integrate it into your application. <br><br><h2>  What is needed for push notifications </h2><br>  To integrate push notifications into an application, you must: <br><br>  <strong>iPhone, iPad or iPod touch.</strong>  Push notifications do not work in the simulator, so you need a device for testing. <br><br>  <strong>Registration in the iOS Developer Program.</strong>  For each application in which the push notification mechanism will be integrated, you need to create a new App ID and provisioning profile, as well as an SSL certificate for the server.  These actions are performed on the iOS Provisioning Portal. <br><br>  If you want to completely follow the examples in this guide, you need to create a provisioning profile and an SSL certificate.  I will explain in detail how to do this. <br><br>  <strong>Server connected to the internet.</strong>  Push notifications are always sent by the server.  During the development process, you can use your own Mac as a server, but for release you need something like VPS (Virtual Private Server). <br><br>  To work with push-notifications cheap virtual hosting is not enough.  You need to run background execution on the server, install an SSL certificate, configure an outgoing TLS connection on certain ports.  Most virtual hosting providers will not allow you to do this.  Although if you contact the technical support service, then you will most likely be helped to solve all the problems.  But still, I strongly recommend using VPS. <br><br><h2>  Anatomy of push notifications </h2><br>  Your server is responsible for creating messages for push notifications.  Therefore, it is useful to know how these messages look. <br><br>  A push notification is a short message consisting of a token device, a payload (payload) and some more information.  The payload is the actual data that will be sent to the device. <br><br>  Your server should convert the payload to a JSON dictionary.  The payload for a simple push message is as follows: <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"aps"</span></span>: { <span class="hljs-string"><span class="hljs-string">"alert"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>, <span class="hljs-string"><span class="hljs-string">"sound"</span></span>: <span class="hljs-string"><span class="hljs-string">"default"</span></span> } }</code> </pre> <br>  A block bounded by curly braces contains a dictionary that consists of key-value pairs (as in NSDictionary). <br><br>  A payload is a dictionary that consists of at least one key-value pair ‚Äúaps‚Äù, the meaning of which is itself a dictionary.  In the example above, "aps" contains two fields: "alert" and "sound".  When a push notification arrives on the device, a pop-up message will appear with the text ‚ÄúHello, world!‚Äù And a standard beep will be played. <br><br>  In addition, in the "aps" you can add other fields to configure the notification.  For example: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"aps"</span></span>: { <span class="hljs-string"><span class="hljs-string">"alert"</span></span>: { <span class="hljs-string"><span class="hljs-string">"action-loc-key"</span></span>: <span class="hljs-string"><span class="hljs-string">"Open"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span> }, <span class="hljs-string"><span class="hljs-string">"badge"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } }</code> </pre><br>  Now the value of the "alert" field is a dictionary.  The ‚Äúaction-loc-key‚Äù contains alternative text for the ‚ÄúRun‚Äù button.  The ‚Äúbadge‚Äù field contains a number that will be displayed on the badge of the application icon.  Push notification will not be accompanied by a beep. <br><br>  There are quite a few ways to generate a JSON payload.  You can change the notification sound, add your own fields.  More information can be found on the Apple Developers <a href="http://developer.apple.com/library/ios/">‚ÄôLocal and Push Notification Programming Guide</a> page. <br><br>  Push notifications are pretty small;  The size of the payload cannot exceed 256 bytes.  This is about the same as it allows to contain SMS or tweet.  The push server will not spend money on new line breaks and spaces, but will generate something like this: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"aps"</span></span>:{<span class="hljs-string"><span class="hljs-string">"alert"</span></span>:<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>,<span class="hljs-string"><span class="hljs-string">"sound"</span></span>:<span class="hljs-string"><span class="hljs-string">"default"</span></span>}}</code> </pre><br>  Such a presentation is less readable, but provides enough space for more valuable information.  APNS will reject push notifications whose sizes exceed 256 bytes. <br><br><h2>  Understanding Push Notifications </h2><br><img src="https://habrastorage.org/storage2/6ac/7ab/daf/6ac7abdaf3641168b32b6aa0f289dec5.png" align="right">  <strong>They are not reliable!</strong>  There are no guarantees that push notifications will be delivered even if APNS accepts them. <br><br>  Once your server has generated a push notification, it sends it to APNS without a response.  There is no way to know the delivery status of the notification to the end user after sending.  Delivery time can vary from a few seconds to half an hour. <br><br>  In addition, i-device users may not be able to receive push notifications all the time.  For example, there is no Wi-Fi network with Internet access nearby, or the device can be turned off altogether. <br><br>  APNS will attempt to deliver the last notification sent when the device is available for reception.  But these attempts are limited in time.  After a timeout, the push notification will be lost forever! <br><br><img src="https://habrastorage.org/storage2/f82/d5d/d5a/f82d5dd5a4669ed0732915feac447461.png" align="right">  <strong>They can be expensive!</strong>  Adding push functionality to an application is fairly simple and inexpensive if you own the data.  However, if you have many users, or you need to request data, the costs increase dramatically. <br><br>  For example, you can easily notify users of changes in the RSS feed, because you control the feed and know when changes will be made - when the content on the site is updated - your server will instantly send a notification. <br><br>  But what if your application is an RSS reader that allows users to enter the URLs of their feeds?  In this case, you need to come up with a tracking mechanism for updating the added feeds. <br><br>  In practice, this means that your server needs to constantly check tapes for changes.  If you have many users, you may need to install additional servers to handle all the processes and maintain stable bandwidth.  For applications such as an RSS reader, the implementation of the push functionality can be quite expensive and not valuable to you. <br><br>  Okay, enough theory.  It is time to learn the process of implementing all these push-things.  But before embarking on the most "delicious" - programming!  - you need to perform some boring settings on the iOS Provisioning Portal.  Well, let's make them as fast as possible. <br><br><h2>  Provisioning Profiles and Certificates </h2><br><img src="https://habrastorage.org/storage2/2df/637/98c/2df63798c2adfa70473dc83f8c2372d0.png" align="right">  In order to connect push notifications to an application, you must sign it with a properly configured provisioning profile.  In addition, your server needs to connect to the APNS using an SSL certificate. <br><br>  The Provisioning profile and the SSL certificate are closely related to each other and are valid only for one App ID.  This is a protection that ensures that only your server can send push notifications to users of your application. <br><br>  As you know, for the development and release of applications use different provisioning profiles.  There are two types of push certificates for the server: <br><br><ol><li>  Development (Development).  If the application is in debug mode and a provisioning profile is signed for development (Code Signing Identity - ‚ÄúiPhone Developer‚Äù). </li><li>  Release (Production).  Applications created as Ad-Hoc or prepared for download on the App Store (Code Signing Identify - ‚ÄúiPhone Distribution‚Äù) should inform the server that they are using a certificate for release (Production certificate).  If there are inconsistencies between them, then push notifications will not be able to come into your application. </li></ol><br>  This guide will only use a certificate for development. <br><br><h2>  Generate Certificate Signing Request (CSR) </h2><br>  Remember how you logged into the iOS Provisioning Portal and created a Development Certificate after joining the iOS Developer Program?  The following steps will be similar.  But still, I advise you to carry them out exactly as described below.  Developers have most of the problems with push notifications related to certificates. <br><br>  Digital certificates are based on encryption using a public-private key.  You do not need to know anything about encryption when working with certificates, but you should be aware that the certificate is always paired with a private key. <br><br>  A certificate is a common part of this key pair.  The private key should be kept secret.  Owning it only you and no one else should have access to it.  I note that it is impossible to use a certificate without a private key. <br><br>  Whenever you request a digital certificate, you must make a request for its signature (Certificate Signing Request [CSR]).  When you create a CSR, the new key will be stored in the keychain.  You then need to send the CSR to a certification authority (in this case, the iOS Developer Portal), which will generate an SSL certificate based on the information from the CSR. <br><br>  Open the keychain utility (‚ÄúApplications ‚Üí Utilities (Other)‚Äù) and select the option ‚ÄúRequest a certificate from a certification authority ...‚Äù. <br><br><img src="https://habrastorage.org/storage2/c22/67a/566/c2267a5660ffd703837fec48bc820e42.png"><br><br>  If you do not see this menu option or a message appears with the text ‚ÄúRequest a certificate from a certificate authority with a key‚Äù (‚ÄúRequest a Certificate from a Certificate Authority with key‚Äù), then you need to download and install <a href="">WWDR Intermediate Certificate</a> .  You also need to check that no private key is allocated. <br><br>  Now before you should be a window of the certification assistant: <br><br><img src="https://habrastorage.org/storage2/380/276/5f7/3802765f7883f3661d28e7e38e41dce0.png"><br><br>  Enter e-mail here.  Developers are advised to use the same email as the one you used to register with the iOS Developer Program, but this is not necessary. <br><br>  As a common name, enter ‚ÄúPushChat‚Äù.  You can enter anything, but choose something descriptive.  Later this will make it easy to find a private key. <br><br>  Select the "Saved to disk" radio button and click "Continue."  Save the file as ‚ÄúPushChat.certSigningRequest‚Äù. <br><br><h2>  Create App ID and SSL Certificate </h2><br>  Login to the <a href="https://developer.apple.com/ios/manage/overview/index.action">iOS Provisioning Portal</a> . <br><br>  First, create a new App ID.  Each application that uses a push notification mechanism needs its own unique ID. <br><br>  Click on the ‚ÄúApp IDs‚Äù item on the sidebar and click on the ‚ÄúNew App ID‚Äù button. <br><br><img src="https://habrastorage.org/storage2/fe8/3b1/e5d/fe83b1e5d6cc3c9ba82b6e227b32d865.png"><br><br>  I filled the fields as follows: <br><br>  Description: PushChat <br>  Bundle Seed ID: default <br>  Bundle Identifier: me.evgeniy.PushChat <br><br>  It would be better if you specify your own Bundle Identifier - com.yoursite.PushChat - instead of mine.  In an Xcode project, you need to set the same bundle ID. <br><br>  A few more points: we will generate an SSL certificate that your push server will use to securely connect to APNS.  This certificate is associated with the App ID.  The server can send push notifications only to your application and to no other. <br><br>  After the App ID has been created, it will appear in the list: <br><br><img src="https://habrastorage.org/storage2/f7e/0f2/f15/f7e0f2f15bbecab96d94ccf31a59c045.png"><br><br>  In the columns ‚ÄúDevelopment‚Äù and ‚ÄúProduction‚Äù opposite ‚ÄúPush Notification‚Äù there are two orange circles with the inscription ‚ÄúConfigurable‚Äù.  This means that the App ID can use push notifications, but they still need to be configured.  Therefore, follow the link "Configure". <br><br><img src="https://habrastorage.org/storage2/70e/89b/f92/70e89bf923dbe9c0cbab1b7d671ec4f3.png"><br><br>  On the page that appears, check the box next to ‚ÄúEnable for Apple Push Notification service‚Äù.  Then click the ‚ÄúConfigure‚Äù button in the line with the Development Push SSL Certificate.  The ‚ÄúApple Push Notification service SSL Certificate Assistant‚Äù window opens: <br><br><img src="https://habrastorage.org/storage2/b42/289/89a/b4228989aac2d72d1fcb6be6724f2a81.png"><br><br>  The first thing to do is generate a Certificate Signing Request.  We have already done this, so click "Continue". <br><br><img src="https://habrastorage.org/storage2/f8a/774/ff9/f8a774ff9aad34a99537b09238d2b8ac.png"><br><br>  The next step is to upload the CSR to the Apple server.  Select the CSR file you generated earlier and click ‚ÄúGenerate‚Äù. <br><br><img src="https://habrastorage.org/storage2/fa5/ad4/6d9/fa5ad46d9307eed8c6e0ae3f18d8c95e.png"><br><br>  SSL certificate generation takes a few seconds.  When ready, click ‚ÄúContinue‚Äù. <br><br><img src="https://habrastorage.org/storage2/2fb/899/9bd/2fb8999bdab241f9f87ab8707b711a1d.png"><br><br>  To download a certificate, click ‚ÄúDownload‚Äù - it will be saved under the name ‚Äúaps_development.cer‚Äù.  After click "Done". <br><br><img src="https://habrastorage.org/storage2/f7b/759/6a0/f7b7596a060a511a7921e2df3641ecfb.png"><br><br>  Now we have a valid certificate and a push notification mechanism is available for development.  If necessary, you can reload the certificate. <br><br>  When your application is ready for release, you need to repeat the entire process to generate a Production-certificate.  All steps are similar. <br><br>  <strong>Comment.</strong>  A production certificate is valid for a year, but you can re-create it before the expiration date. <br><br>  No need to add a certificate to a keychain.  If you want to do this, then double-click on the previously downloaded aps_development.cer file (after that, the certificate will be associated with the private key). <br><br><h2>  Creating a Provisioning Profile </h2><br>  Go to the Provisioning Portal.  Click on the ‚ÄúProvisioning‚Äù link and click on the ‚ÄúNew Profile‚Äù button. <br><br><img src="https://habrastorage.org/storage2/6d8/abc/90b/6d8abc90b49f0a5b8fdac7038837d12e.png"><br><br>  I filled the fields as follows: <br><br><ul><li>  Profile Name: PushChat Development </li><li>  Certificates: select a certificate </li><li>  App ID: PushChat </li><li>  Devices: select your device (s) </li></ul><br>  This process is no different from generating any other provisioning profile.  We create a new profile, because each application that supports the push notification mechanism needs its own profile, which is associated with a specific App ID. <br><br>  Click ‚ÄúSubmit‚Äù and the profile will be generated.  The new profile will be set to ‚ÄúPending‚Äù status.  Reload the page and see that the status has changed to Active.  Now you can download the provisioning profile (file called ‚ÄúPushChat.mobileprovision‚Äù). <br><br>  Add the provisioning profile to Xcode by dragging the file to the IDE icon or by double clicking on the file. <br><br>  If your application is ready for release, then you need to repeat the process described above to create an Ad Hoc or App Store distribution profile. <br><br><h2>  Simple application </h2><br>  Previous actions were not really exciting, but they are required to perform.  I wanted to show in detail how to generate a certificate, because the developer does not do such things every day, and without them, push notifications will not work. <br><br>  Now we will create a simple application that will receive push notifications. <br><br>  Open Xcode and create a new project.  In the assistant, select ‚ÄúSingle View Application‚Äù and proceed to the next step. <br><br><img src="https://habrastorage.org/storage2/589/a8d/dfb/589a8ddfbc0d27642e879d0c78e670a9.png"><br><br>  I filled the fields as follows: <br><br><ul><li>  Product Name: PushChat </li><li>  Company Identifier: me.evgeniy </li><li>  Class Prefix: PC </li><li>  Device Family: iPhone </li><li>  Flags: ‚ÄúUse Storyboards‚Äù and ‚ÄúUse Automatic Referance Counting‚Äù </li></ul><br>  Together the Product Name and Company Identifier form the Bundle ID.  In my case it is ‚Äúme.evgeniy.PushChat‚Äù.  You must enter the Product Name and Company Identifier corresponding to the App ID that was previously created on the Provisioning Portal (com.yourname.PushChat). <br><br>  After creating the project, open PCAppDelegate.m.  Change the didFinishLaunchingWithOptions method as follows: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application didFinishLaunchingWithOptions:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)launchOptions { <span class="hljs-comment"><span class="hljs-comment">//  iOS 7   [[UIApplication sharedApplication] registerForRemoteNotificationTypes: (UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeSound | UIRemoteNotificationTypeAlert)]; //  iOS 8   // [[UIApplication sharedApplication] registerUserNotificationSettings:[UIUserNotificationSettings settingsForTypes:(UIUserNotificationTypeSound | UIUserNotificationTypeAlert | UIUserNotificationTypeBadge) categories:nil]]; // [[UIApplication sharedApplication] registerForRemoteNotifications]; return YES; }</span></span></code> </pre><br>  A call to registerForRemoteNotificationTypes tells iOS that this application wants to receive push notifications. <br><br>  Build and run the application.  To do this, you need to use the device, because the simulator does not support push notifications.  Xcode will automatically select the new provisioning profile.  If an error occurs during the launch of the application, make sure that the correct profile is selected in the Code Signing Identity. <br><br>  When the application starts, a message will appear confirming the acceptance of push notifications. <br><br><img src="https://habrastorage.org/storage2/f7a/40e/bde/f7a40ebde7097ac27fc33f8e779d322e.png"><br><br>  The application will ask for permission only once.  If the user clicks "OK", push-notifications will come, if "Deny" - will not.  Your decision can be changed in the settings. <br><br><img src="https://habrastorage.org/storage2/690/d9f/366/690d9f366dbe206cbcb3fceb2481219f.png"><br><br>  The name of your application will be added to the push notification settings.  Here, the user can enable or disable push notifications for your application, as well as customize badges, sounds, and messages. <br><br><img src="https://habrastorage.org/storage2/eeb/6e9/6ee/eeb6e96ee5b57c250d8baa0c185caaf7.png"><br><br>  Your application can determine which types of push notifications are included: <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">UIRemoteNotificationType</span></span> enabledTypes = [[<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> sharedApplication] enabledRemoteNotificationTypes];</code> </pre><br>  There is one more thing you need to add to the app in order to be able to receive push notifications.  Add the following code to PCAppDelegate.m: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application didRegisterForRemoteNotificationsWithDeviceToken:(<span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *)deviceToken { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"My token is: %@"</span></span>, deviceToken); } - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application didFailToRegisterForRemoteNotificationsWithError:(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *)error { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"Failed to get token, error: %@"</span></span>, error); }</code> </pre><br>  When your application registers to receive push notifications, it tries to get the token of the device.  This is a 32-byte unique number that uniquely identifies your device.  The token of the device can be compared with the address where push notifications will be sent. <br><br>  After starting the application, the token of your device will be displayed on the Xcode console: <br><br> <code>My token is: &lt;740f4707 bebcf74f 9b7c25d4 8e335894 5f6aa01d a5ddb387 462c7eaf 61bb78ad&gt;</code> <br> <br>  A token is an opaque binary data structure that is an object of type NSData.  For our purposes, it is enough to know the 32-byte device token.  The token can be represented as 64 hexadecimal characters.  We will use exactly this format. <br><br>  If you run the application on the simulator, the method didFailToRegisterForRemoteNotificationsWithError: will be called, which will display an error with the information that the simulator does not support push notifications. <br><br>  We are done with the app.  Now let's try push notifications in action! <br><br><h2>  Sending push notifications </h2><br>  As described earlier, to send push notifications, you must configure the server.  But for testing we will use the application for Mac OS PushMeBaby, which can also be downloaded from the <a href="https://github.com/search%3Fq%3DPushMeBaby%26amp%3Brepo%3D%26amp%3BlangOverride%3D%26amp%3Bstart_value%3D1%26amp%3Btype%3DRepositories%26amp%3Blanguage%3D">github</a> service. <br><br>  Then everything is simple - open PushMeBaby in Xcode, add the previously created SSL certificate (aps_development.cer) to the project, and then proceed to editing the ApplicationDelegate.m file.  In the init method, we make the following changes: <br><br>  Add the token of the device, which will be displayed in the Xcode console after launching the application created earlier: <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.deviceToken = <span class="hljs-string"><span class="hljs-string">@"564f77d3 c1d06866 77a907d5 31d0450a 9cb552ec 5e2373e5 f2cc2c20 ff013232"</span></span>;</code> </pre><br>  Add the payload, which was mentioned earlier (we must screen quotes): <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.payload = <span class="hljs-string"><span class="hljs-string">"{\"aps\":{\"alert\":\"Hello, world!\",\"sound\":\"default\"}}"</span></span>;</code> </pre><br>  And we set the name of the SSL certificate added to the project: <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.certificate = [[<span class="hljs-built_in"><span class="hljs-built_in">NSBundle</span></span> mainBundle] pathForResource:<span class="hljs-string"><span class="hljs-string">@"aps_development"</span></span> ofType:<span class="hljs-string"><span class="hljs-string">@"cer"</span></span>];</code> </pre><br><br><img src="https://habrastorage.org/storage2/446/411/7de/4464117de8b1de7a8e5918398260260e.png"><br><br>  Now we start the application and press the Push button.  Within a few seconds you should receive a push notification. <br><br>  With the ‚ÄúBanner‚Äù style, the push notification looks like this: <br><br><img src="https://habrastorage.org/storage2/417/f34/a1e/417f34a1eee147a8e99f8ac49e4a7806.png"><br><br>  With the style "Reminder" more familiar: <br><br><img src="https://habrastorage.org/storage2/a4b/017/b67/a4b017b6798207cee2c6c51503469033.png"><br><br>  <strong>Comment.</strong>  The notification will not appear if the application is running and active on the device.  However, the payload will come to the application and can be processed using the didReceiveRemoteNotification method: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application didReceiveRemoteNotification:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)userInfo { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"Received notification: %@"</span></span>, userInfo); }</code> </pre><br>  That's all.  All questions you are interested in can be asked in the comments;  I will try to answer them. </div><p>Source: <a href="https://habr.com/ru/post/156811/">https://habr.com/ru/post/156811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156801/index.html">ARM ChrUbuntu 12.04 Alpha - Porting Ubuntu to Samsung Chromebook</a></li>
<li><a href="../156803/index.html">The most popular programming languages</a></li>
<li><a href="../156805/index.html">A simple way to prepare reports based on rtf forms</a></li>
<li><a href="../156807/index.html">Easy copying of paper documents in Linux</a></li>
<li><a href="../156809/index.html">Optimization of games for iOS platform. Code vectorization</a></li>
<li><a href="../156813/index.html">Webinar on the topic: How to avoid the 5 most common mistakes that lead to the failure of all startups?</a></li>
<li><a href="../156817/index.html">EventTrace for Windows. High-speed transmission of driver debug messages over the network</a></li>
<li><a href="../156819/index.html">Pow - easy, fast, convenient</a></li>
<li><a href="../156821/index.html">Technology tracking and scanning using a conventional webcam</a></li>
<li><a href="../156825/index.html">Fair elections. Word cryptographers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>