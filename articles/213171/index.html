<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Test the MeteorJS application with Laika</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! This small post is devoted to Laika's MeteorJS application testing system from Arunoda Susiripala . Its features are quite interesting: 


- La...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Test the MeteorJS application with Laika</h1><div class="post__text post__text-html js-mediator-article">  Hello!  This small post is devoted to Laika's <a href="http://arunoda.me/">MeteorJS</a> application testing system from <a href="http://arunoda.me/">Arunoda Susiripala</a> .  Its features are quite interesting: <br><ul><li>  Laika runs its tests in the same way that a real application runs (using PhantomJS) </li><li>  Each test is isolated, i.e.  restart your MeteorJS application with a clean database </li><li>  You can use Meteor and Meteorite for development. Laika works great with both of them. </li><li>  You can run the test on the server and the client in one test.  This will help test such issues as permission, subscriptions and method calls. </li><li>  Since MeteorJS works in real time, you will need to test the application when running multiple clients at the same time.  Laika it can. </li><li>  The ability to use events for more accurate testing, that is, in fact, emulation of user experience </li><li>  Passing values ‚Äã‚Äãto code during test execution through arguments </li><li>  Waiting for the end of templates generation (templates) </li></ul><br><br><a name="habracut"></a><br><br><h4>  Installation </h4><br>  1. Install using npm: <br><pre><code class="bash hljs">sudo npm install -g laika</code> </pre> <br>  2. Download and install <a href="http://phantomjs.org/download.html">PhantomJS</a> . <br>  3. Run mongodb as follows: <br><pre> <code class="bash hljs">$ mongod --smallfiles --noprealloc --nojournal</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Simplest Testing App </h4><br>  Create a new application. <br><pre> <code class="bash hljs">$ meteor create meteor-laika</code> </pre><br>  Create the collections directory and the posts.js file <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// collections/posts.js Posts = new Meteor.Collection('posts');</span></span></code> </pre><br>  Create a tests directory with posts.js in it <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//tests/posts.js var assert = require('assert'); suite('Posts', function() { test('in the server', function(done, server) { server.eval(function() { Posts.insert({title: 'hello title'}); var docs = Posts.find().fetch(); emit('docs', docs); }); server.once('docs', function(docs) { assert.equal(docs.length, 1); done(); }); }); });</span></span></code> </pre><br>  Here we created a test suite with the name "Posts", in which there is one test with the name "in the server".  Accordingly, in this test, we check whether an entry is added to the collection.  To do this, we wrote the following: <br><pre> <code class="javascript hljs"> server.eval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Posts.insert({<span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'hello title'</span></span>}); <span class="hljs-comment"><span class="hljs-comment">//   var docs = Posts.find().fetch(); //    emit('docs', docs); //     });</span></span></code> </pre><br>  When we call the emit function, the once method is called with the appropriate name.  Therefore, after these operations, we get here: <br><pre> <code class="javascript hljs"> server.once(<span class="hljs-string"><span class="hljs-string">'docs'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">docs</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   assert.equal(docs.length, 1); //     ,    done(); //   });</span></span></code> </pre><br>  The test is ready.  To test the application, we write <br><pre> <code class="bash hljs">$ laika</code> </pre><br>  The following will be displayed: <br><img src="https://habrastorage.org/getpro/habr/post_images/a0a/5d3/7f0/a0a5d37f0ee1c102db265438198bf1d5.png"><br><h4>  Testing on the client and server </h4><br>  We also insert this test inside our test suite: <br><pre> <code class="javascript hljs">test(<span class="hljs-string"><span class="hljs-string">'using both client and the server'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">done, server, client</span></span></span><span class="hljs-function">) </span></span>{ server.eval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Posts.find().observe({ <span class="hljs-attr"><span class="hljs-attr">added</span></span>: addedNewPost <span class="hljs-comment"><span class="hljs-comment">//    ,   ,   addedNewPost }); function addedNewPost(post) { emit('post', post); //   "post"   post (    ) } }).once('post', function(post) { //   "post" assert.equal(post.title, 'hello title'); //     ,     done(); //   }); client.eval(function() { Posts.insert({title: 'hello title'}); //     }); });</span></span></code> </pre><br>  The result will be the following: <br><img src="https://habrastorage.org/getpro/habr/post_images/c60/156/d5c/c60156d5c20dca2b86235bda0bbd7bf2.png"><br><h4>  Test with two clients </h4><br>  Add the following code inside our test suite: <br><pre> <code class="javascript hljs">test(<span class="hljs-string"><span class="hljs-string">'using two client'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">done, server, c1, c2</span></span></span><span class="hljs-function">) </span></span>{ c1.eval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Posts.find().observe({ <span class="hljs-attr"><span class="hljs-attr">added</span></span>: addedNewPost <span class="hljs-comment"><span class="hljs-comment">//         }); function addedNewPost(post) { emit('post', post); //      ,      "post" } emit('done'); //  "done" }).once('post', function(post) { assert.equal(post.title, 'from c2'); //    ,  ,   done(); }).once('done', function() { c2.eval(insertPost); //      insertPost }); function insertPost() { Posts.insert({title: 'from c2'}); //     (  ,   ),   } });</span></span></code> </pre><br>  The result will be: <br><img src="https://habrastorage.org/getpro/habr/post_images/73a/38f/72e/73a38f72e875e6aa0394bb50bc47c963.png"><br><br>  Also, I want to note that if you use iron-router in your application, then, before testing, create at least one view, without it all tests will fall. <br><br>  There are quite a lot of examples on the site, you can see them <a href="http://arunoda.github.io/laika/examples.html">here</a> .  The record turned out to be small, but, I hope, useful for those who are beginning to understand this interesting framework.  It is a free translation of <a href="http://arunoda.github.io/laika/getting-started.html">this page</a> with some additions.  Also, it would be interesting to hear how you are testing your applications on MeteorJS at the moment and whether you are interested in laika. </div><p>Source: <a href="https://habr.com/ru/post/213171/">https://habr.com/ru/post/213171/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213151/index.html">Cambium 650 Core Solution</a></li>
<li><a href="../213155/index.html">The fourth free iOS school in St. Petersburg</a></li>
<li><a href="../213157/index.html">TCP / IP audio channel</a></li>
<li><a href="../213161/index.html">Skydrive officially renamed to OneDrive</a></li>
<li><a href="../213165/index.html">Twister now really works on Windows</a></li>
<li><a href="../213173/index.html">"Theoretical minimum" Leonard Susskind published in Russian</a></li>
<li><a href="../213177/index.html">Video reports from the Loc Kit conference</a></li>
<li><a href="../213179/index.html">ORM in PHP to be or not to be?</a></li>
<li><a href="../213181/index.html">Experience in developing an intelligent tutorial interface</a></li>
<li><a href="../213183/index.html">Application of the Pareto chart to analyze the reasons for the backlog</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>