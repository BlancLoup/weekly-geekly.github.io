<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using alternative compilers in Gentoo using the Intel Compiler Suite example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to tell you how to use Gentoo and other portage-based distributions to build packages using a compiler other than gcc. 
 The ch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using alternative compilers in Gentoo using the Intel Compiler Suite example</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to tell you how to use Gentoo and other portage-based distributions to build packages using a compiler other than gcc. <br>  The choice of alternative compilers is extensive: Intel Compiler Suite, Sun Studio Express Compilers, TenDRA C / C ++ Compiler, Tiny C Compiler and other lightweight compilers. <br>  I will consider the transition to the most popular (AFAIK) alternative compiler - icc. <br>  You may ask: why is it even necessary?  The fact is that icc optimizes code for execution on Intel processors better than gcc. <br>  Compare yourself: <br><table><tbody><tr><th>  test program </th><td>  bunzip2 linux-2.6.32.tar.bz2 </td><td>  bzip2 linux-2.6.32.tar </td><td>  oggenc -q5 testfile.wav </td><td>  lame -V4 testfile.wav </td></tr><tr><th>  average lead time (gcc) </th><td>  22.118 </td><td>  91.452 </td><td>  108.554 </td><td>  98.438 </td></tr><tr><th>  average lead time (icc) </th><td>  20.373 </td><td>  68.284 </td><td>  88.581 </td><td>  84.626 </td></tr><tr><th>  speed increase </th><td>  8.5% </td><td>  33.9% </td><td>  22.5% </td><td>  16.3% </td></tr></tbody></table><br>  Agree, very good results. <br>  Configuration of the computer on which the test was made: Intel Core 2 Duo T7250 @ 2.00 GHz;  linux 2.6.31-gentoo-r7 x86;  gcc-4.4.2;  icc-11.1.056;  All tests were performed in tmpfs - section, so as not to sin on the speed of i / o. <br><a name="habracut"></a><br><h4>  Installation </h4><br>  If you are ready, proceed with the installation. <br> <code># emerge icc</code> <br>  icc requires a license for its work, we will use the free non-commercial option, which can be obtained <a href="http://software.intel.com/en-us/articles/non-commercial-software-development/">here</a> .  When you get the .lic file, put it in / opt / intel / licenses. <br><br><h4>  Configure portage </h4><br>  Immediately I warn you that some applications are not going to icc, and some are going to, but do not work, although the icc developers strive to make it as compatible as possible with gcc.  Therefore, it cannot be said that the compiler change will be complete - something can only be collected by gcc, and we will not abandon it.  We have two options: compile all icc, and separate applications - gcc, or vice versa, leave the main compiler gcc, and icc build only some programs.  It‚Äôs up to you to decide which one to choose - if you can‚Äôt afford to poke around for a long time in the system, or just don‚Äôt want any extra problems, then you are more likely to accept the second option;  if you have enough free time and / or desire to try something new, then your first option. <br><br><h5>  The first option: the main compiler - icc, additional - gcc </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We assume that the flags for icc in make.conf are defined as ICCCFLAGS and ICCCXXFLAGS (as CFLAGS and CXXFLAGS for gcc);  the list of packages that gcc needs to build is in /etc/portage/package.gcc;  Special flags for individual packages are in /etc/portage/package.gcc-cflags and /etc/portage/package.icc-cflags. <br>  The current compiler is defined in the OCC and OCXX environment variables ‚Äî so we change them. <br>  To do this, create a script / etc / portage / bashrc with the following content: <br><br> <code>export GCC=${OCC} #     <br> export GCXX=${OCXX} <br> export OCC="icc" #   <br> export OCXX="icpc" <br> export GCCCFLAGS=${CFLAGS} #    <br> export GCCCXXFLAGS=${CXXFLAGS} <br> export CFLAGS=${ICCCFLAGS} #   <br> export CXXFLAGS=${ICCCXXFLAGS} <br> <br> [ -r ${ROOT}/etc/portage/package.gcc ] || return 0 <br> while read -a target; do <br> if [ "${target}" = "${CATEGORY}/${PN}" ]; then #      /etc/portage/package.gcc,  <br> export OCC="${GCC}" #    <br> export OCXX="${GCXX}" <br> export CFLAGS="${GCCCFLAGS}" #     <br> export CXXFLAGS="${GCCCXXFLAGS}" <br> if [ -r ${ROOT}/etc/portage/package.gcc-cflags ]; then #      /etc/portage/package.gcc-cflags,  <br> while read target flags; do <br> if [ "${target}" = "${CATEGORY}/${PN}" ]; then <br> export CFLAGS="$CFLAGS $flags" #    <br> export CXXFLAGS="$CXXFLAGS $flags" <br> break <br> fi <br> done &lt; ${ROOT}/etc/portage/package.gcc-cflags <br> fi <br> return 0 <br> fi <br> done &lt; ${ROOT}/etc/portage/package.gcc <br> <br> if [ -r ${ROOT}/etc/portage/package.icc-cflags ]; then #   icc <br> while read target flags; do <br> if [ "${target}" = "${CATEGORY}/${PN}" ]; then <br> export CFLAGS="$CFLAGS $flags" <br> export CXXFLAGS="$CXXFLAGS $flags" <br> break <br> fi <br> done &lt; ${ROOT}/etc/portage/package.icc-cflags <br> fi <br> <br> export CC_FOR_BUILD="${OCC}" #  workaround <br> <br> unset GCC <br> unset GCXX <br> unset GCCCFLAGS <br> unset GCCCXXFLAGS <br></code> <br><br><h5>  The second option: the main compiler - gcc, additional - icc </h5><br>  Similar to the previous case, only here is a list of packages collected by icc in /etc/portage/package.icc <br><br> <code>[ -r ${ROOT}/etc/portage/package.icc ] || return 0 <br> while read -a target; do <br> if [ "${target}" = "${CATEGORY}/${PN}" ]; then #      /etc/portage/package.icc,  <br> export OCC="icc" #   <br> export OCXX="icpc" <br> export CFLAGS="${ICCCFLAGS}" #     <br> export CXXFLAGS="${ICCCXXFLAGS}" <br> if [ -r ${ROOT}/etc/portage/package.icc-cflags ]; then #      /etc/portage/package.icc-cflags,  <br> while read target flags; do <br> if [ "${target}" = "${CATEGORY}/${PN}" ]; then <br> export CFLAGS="$CFLAGS $flags" #    <br> export CXXFLAGS="$CXXFLAGS $flags" <br> break <br> fi <br> done &lt; ${ROOT}/etc/portage/package.icc-cflags <br> fi <br> export CC_FOR_BUILD="${OCC}" #  workaround <br> return 0 <br> fi <br> done &lt; ${ROOT}/etc/portage/package.icc <br> <br> if [ -r ${ROOT}/etc/portage/package.gcc-cflags ]; then #   gcc <br> while read target flags; do <br> if [ "${target}" = "${CATEGORY}/${PN}" ]; then <br> export CFLAGS="$CFLAGS $flags" <br> export CXXFLAGS="$CXXFLAGS $flags" <br> break <br> fi <br> done &lt; ${ROOT}/etc/portage/package.gcc-cflags <br> fi <br> fi <br></code> <br><br>  Everything!  Your system is ready to build packages with the new compiler. <br><br><h4>  Advantages and disadvantages </h4><br><br><h5>  A plus </h5><br>  One, but fat.  Noticeable acceleration of processor-intensive processes - (de) audio / video encoding, (de) encryption, etc. <br><br><h5>  Minuses </h5><br>  1. Incomplete compatibility with gcc.  Some programs are not going to icc, some are going, but not working.  For example, programs that use the LZMA algorithm (xz-utils, p7zip) are assembled, but they do not unpack the archives ‚Äî they are broken.  I am sure that this is not the only example. <br>  2. icc links the executables with their own libraries, and if for any reason you decide to remove it, you will have to recompile all the packages it has assembled. <br>  3. icc is closed.  For some, this is not a minus, but agree that the opening of its source would not harm anyone (except Intel, of course). <br><br><h4>  Conclusion </h4><br>  I want to say that switching to other compilers is no different in essence - in the script you just need to change the icc to the selected compiler. <br><br>  I hope that this article will be useful to you. <br><br>  PS Thanks <a href="https://habrahabr.ru/users/gribozavr/" class="user_link">gribozavr</a> for an invite! </div><p>Source: <a href="https://habr.com/ru/post/83324/">https://habr.com/ru/post/83324/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83314/index.html">Google added photos of the Second World War in Google Earth</a></li>
<li><a href="../83315/index.html">Qualities of a successful entrepreneur - Sustainability (4/11)</a></li>
<li><a href="../83316/index.html">New job duties of PR-directors</a></li>
<li><a href="../83319/index.html">Creating CCK Multipoles</a></li>
<li><a href="../83321/index.html">MyRuLib - my electronic librarian</a></li>
<li><a href="../83327/index.html">Interesting economy - taxis are cheaper every day than your car</a></li>
<li><a href="../83331/index.html">Interesting economics or manipulating numbers</a></li>
<li><a href="../83332/index.html">Communicator Garmin-ASUS M20 - small and removed</a></li>
<li><a href="../83333/index.html">FBI wants to monitor Internet users</a></li>
<li><a href="../83335/index.html">Blender for school and university</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>