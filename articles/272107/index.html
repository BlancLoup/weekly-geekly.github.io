<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Server administration Resource Management with PowerShell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 Today, our administrator needed to track on network resources how many GBs were used by employees in their personal directories (disk spa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Server administration Resource Management with PowerShell</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  Today, our administrator needed to track on network resources how many GBs were used by employees in their personal directories (disk space was allocated by connecting a network drive).  We assume that the maximum allowable size of a personal resource is 1 GB.  If this size exceeds the limit, you must inform the administrator.  It is also necessary to control the sharp increase in the size of personal resources.  For example, if an employee‚Äôs personal directory increases by 200 MB per week, you need to notify the administrator. <br><br><a name="habracut"></a><br>  So, the Powershell code that implemented all the above requirements: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The function of sending mail.  The function is not universal, tailored to the task.  Those.  We take for the fact that the subject of the message, the recipient does not change.  Only the body changes, we then set it as an input parameter for the function: <br><br><pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> EmailNotification(<span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$Sender</span></span> = <span class="hljs-string"><span class="hljs-string">"audit@..."</span></span> <span class="hljs-variable"><span class="hljs-variable">$Receipt</span></span> = <span class="hljs-string"><span class="hljs-string">"levitskaks@gmail.com"</span></span> <span class="hljs-variable"><span class="hljs-variable">$Server</span></span> = <span class="hljs-string"><span class="hljs-string">"gmail.com.ua"</span></span> <span class="hljs-variable"><span class="hljs-variable">$Object</span></span> = <span class="hljs-string"><span class="hljs-string">"DirSize: "</span></span> + (Get-Date) <span class="hljs-variable"><span class="hljs-variable">$SMTPclient</span></span> = new-object System.Net.Mail.SmtpClient <span class="hljs-variable"><span class="hljs-variable">$Server</span></span> <span class="hljs-comment"><span class="hljs-comment">#Specify SMTP port if needed $SMTPClient.port = 25 #Activate SSL if needed #$SMTPclient.EnableSsl = $true #Specify email account credentials if needed $SMTPAuthUsername = "levitskaks@gmail.com" $SMTPAuthPassword = "pass" $SMTPClient.Credentials = New-Object System.Net.NetworkCredential($SMTPAuthUsername, $SMTPAuthPassword) $Message = new-object System.Net.Mail.MailMessage $Sender, $Receipt, $Object, $Mail_body #-$Message.IsBodyHtml = $true; $SMTPclient.Send($Message) }</span></span></code> </pre> <br><br>  Go to the main function.  Incoming parameters: <br>  - source directory.  A directory in which a list of directories for each employee; <br>  - maximum allowable size in bytes; <br>  - the path to save the log of work; <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Check-Size-Directory (<span class="hljs-variable"><span class="hljs-variable">$dir</span></span>, <span class="hljs-variable"><span class="hljs-variable">$GB</span></span>, <span class="hljs-variable"><span class="hljs-variable">$Logpath</span></span>) {</code> </pre><br><br>  Determine the day of the week in the year.  At the time of writing the script was 47 weeks. <br>  We are also interested in performing a check - once a week on Monday.  The logic of the check is the following: in the even week the log of ‚Äú0.log‚Äù is saved.  In odd weeks we save the file ‚Äú1.log‚Äù.  If the date of the change ‚Äú0.log‚Äù is greater than the date of the change ‚Äú1.log‚Äù, then we logically determine that the last week was even.  and check in which directory the size has increased by more than 200 MB. <br><br><pre> <code class="bash hljs">[Int32]<span class="hljs-variable"><span class="hljs-variable">$Monday</span></span> = (Get-Date -UFormat <span class="hljs-string"><span class="hljs-string">"%w"</span></span>) <span class="hljs-variable"><span class="hljs-variable">$Monday</span></span> [Int32]<span class="hljs-variable"><span class="hljs-variable">$Week</span></span> = (Get-Date -UFormat <span class="hljs-string"><span class="hljs-string">"%W"</span></span>) <span class="hljs-variable"><span class="hljs-variable">$Week</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$week</span></span>%2 -eq 0 -and <span class="hljs-variable"><span class="hljs-variable">$Monday</span></span> -eq 1){ <span class="hljs-variable"><span class="hljs-variable">$LogPathFile</span></span> = <span class="hljs-variable"><span class="hljs-variable">$LogPath</span></span> + <span class="hljs-string"><span class="hljs-string">"\" + (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$week</span></span></span><span class="hljs-string">%2).ToString() + "</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span><span class="hljs-string"><span class="hljs-string">" If (!(Test-Path -path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPathFile</span></span></span><span class="hljs-string">)){ Write-Host "</span></span> <span class="hljs-string"><span class="hljs-string">" New-Item -Path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPathFile</span></span></span><span class="hljs-string"> -ItemType File } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ToFile</span></span></span><span class="hljs-string"> = "</span></span><span class="hljs-string"><span class="hljs-string">" | Out-File </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPathFile</span></span></span><span class="hljs-string"> Write-Host "</span></span> <span class="hljs-string"><span class="hljs-string">" Get-ChildItem -path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir</span></span></span><span class="hljs-string"> | %{ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir_property</span></span></span><span class="hljs-string"> = dir </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.FullName -recurse | where {-Not </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.PSIsContainer}| Measure-Object -Property length -Sum</span></span></code> </pre><br><br>  The first required check: check the directory for a size larger than 1 GB. <br><br><pre> <code class="bash hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$dir_property</span></span>.Sum -gt <span class="hljs-variable"><span class="hljs-variable">$GB</span></span>){ <span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span>+= <span class="hljs-string"><span class="hljs-string">"  "</span></span> + <span class="hljs-variable"><span class="hljs-variable">$_</span></span>.FullName + <span class="hljs-string"><span class="hljs-string">"    1 .`n"</span></span> <span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span>+= <span class="hljs-string"><span class="hljs-string">"  "</span></span> + <span class="hljs-variable"><span class="hljs-variable">$_</span></span>.FullName + <span class="hljs-string"><span class="hljs-string">"  "</span></span> + ((<span class="hljs-variable"><span class="hljs-variable">$dir_property</span></span>.Sum)/1024/1024) + <span class="hljs-string"><span class="hljs-string">" .`n"</span></span> <span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span>+= <span class="hljs-string"><span class="hljs-string">"------------------------------------------------------------------------------------------`n"</span></span> &lt;b&gt;<span class="hljs-variable"><span class="hljs-variable">$ToFile</span></span> = <span class="hljs-variable"><span class="hljs-variable">$_</span></span>.DirectoryName + <span class="hljs-string"><span class="hljs-string">" "</span></span> + ((<span class="hljs-variable"><span class="hljs-variable">$dir_property</span></span>.Sum)/1024/1024) | Out-File <span class="hljs-variable"><span class="hljs-variable">$LogPathFile</span></span> -Append&lt;/b&gt; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">"   : "</span></span> <span class="hljs-variable"><span class="hljs-variable">$_</span></span>.FullName } } EmailNotification -Mail_body <span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span></code> </pre><br><br>  We save the directory name and its size through the separator "|", after which we will parse the contents of the file. <br><br><pre> <code class="bash hljs">&lt;b&gt;<span class="hljs-variable"><span class="hljs-variable">$ToFile</span></span> = <span class="hljs-variable"><span class="hljs-variable">$_</span></span>.DirectoryName + <span class="hljs-string"><span class="hljs-string">" "</span></span> + ((<span class="hljs-variable"><span class="hljs-variable">$dir_property</span></span>.Sum)/1024/1024) | Out-File <span class="hljs-variable"><span class="hljs-variable">$LogPathFile</span></span> -Append&lt;/b&gt;</code> </pre><br><br>  We determine which file is considered new in order to make a comparison with the file a week ago. <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span> If ((Get-Item -Path <span class="hljs-variable"><span class="hljs-variable">$LogPath</span></span>\0.log).LastWriteTime -gt (Get-Item -Path <span class="hljs-variable"><span class="hljs-variable">$LogPath</span></span>\1.log).LastWriteTime){ <span class="hljs-variable"><span class="hljs-variable">$log_content</span></span> = Get-Content (Get-ChildItem -Path <span class="hljs-variable"><span class="hljs-variable">$LogPath</span></span>\0.log) foreach (<span class="hljs-variable"><span class="hljs-variable">$data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$log_content</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$x</span></span> = <span class="hljs-variable"><span class="hljs-variable">$data</span></span>.split(<span class="hljs-string"><span class="hljs-string">"|"</span></span>) <span class="hljs-variable"><span class="hljs-variable">$xc1</span></span> = <span class="hljs-variable"><span class="hljs-variable">$x</span></span>[0] <span class="hljs-variable"><span class="hljs-variable">$xc2</span></span> = <span class="hljs-variable"><span class="hljs-variable">$x</span></span>[1] <span class="hljs-variable"><span class="hljs-variable">$log_content</span></span> = Get-Content (Get-ChildItem -Path <span class="hljs-variable"><span class="hljs-variable">$LogPath</span></span>\1.log) foreach (<span class="hljs-variable"><span class="hljs-variable">$data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$log_content</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$y</span></span> = <span class="hljs-variable"><span class="hljs-variable">$data</span></span>.split(<span class="hljs-string"><span class="hljs-string">"|"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$xc1</span></span> -eq <span class="hljs-variable"><span class="hljs-variable">$y</span></span>[0]){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(([Int32]<span class="hljs-variable"><span class="hljs-variable">$xc2</span></span> - [Int32]<span class="hljs-variable"><span class="hljs-variable">$y</span></span>[1]) -gt 200){ <span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span> += <span class="hljs-string"><span class="hljs-string">"   : "</span></span> + <span class="hljs-variable"><span class="hljs-variable">$xc1</span></span> + <span class="hljs-string"><span class="hljs-string">"`n     : "</span></span> + <span class="hljs-variable"><span class="hljs-variable">$y</span></span>[1] + <span class="hljs-string"><span class="hljs-string">" ."</span></span> + <span class="hljs-string"><span class="hljs-string">"`n     : "</span></span> + <span class="hljs-variable"><span class="hljs-variable">$xc2</span></span> + <span class="hljs-string"><span class="hljs-string">" .`n"</span></span> } } } } EmailNotification -Mail_body <span class="hljs-variable"><span class="hljs-variable">$Mail_body</span></span> } }</code> </pre><br><br>  Checking the evenness / oddness of weeks is checked by dividing by module the week received in a year: <br><br><pre> <code class="bash hljs">&lt;b&gt;<span class="hljs-variable"><span class="hljs-variable">$week</span></span>%2&lt;/b&gt;</code> </pre><br><br>  Similar checks for odd week: <br><br><pre> <code class="bash hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$week</span></span>%2 -eq 1 -and <span class="hljs-variable"><span class="hljs-variable">$Monday</span></span> -eq 1){ Write-Host <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-variable"><span class="hljs-variable">$LogPathFile</span></span> = <span class="hljs-variable"><span class="hljs-variable">$LogPath</span></span> + <span class="hljs-string"><span class="hljs-string">"\" + (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$week</span></span></span><span class="hljs-string">%2).ToString() + "</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span><span class="hljs-string"><span class="hljs-string">" If (!(Test-Path -path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPathFile</span></span></span><span class="hljs-string">)){ Write-Host "</span></span> <span class="hljs-string"><span class="hljs-string">" New-Item -Path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPathFile</span></span></span><span class="hljs-string"> -ItemType File } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ToFile</span></span></span><span class="hljs-string"> = "</span></span><span class="hljs-string"><span class="hljs-string">" | Out-File </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPathFile</span></span></span><span class="hljs-string"> Get-ChildItem -path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir</span></span></span><span class="hljs-string"> | %{ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir_property</span></span></span><span class="hljs-string"> = dir </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.FullName -recurse | where {-Not </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.PSIsContainer}| Measure-Object -Property length -Sum if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir_property</span></span></span><span class="hljs-string">.Sum -gt </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$GB</span></span></span><span class="hljs-string">){ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string">+= "</span></span>  <span class="hljs-string"><span class="hljs-string">" + </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.FullName + "</span></span>    1 .`n<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string">+= "</span></span>  <span class="hljs-string"><span class="hljs-string">" + </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.FullName + "</span></span>  <span class="hljs-string"><span class="hljs-string">" + ((</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir_property</span></span></span><span class="hljs-string">.Sum)/1024/1024) + "</span></span> .`n<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string">+= "</span></span>------------------------------------------------------------------------------------------`n<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ToFile</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.Name + "</span></span>|<span class="hljs-string"><span class="hljs-string">" + ((</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir_property</span></span></span><span class="hljs-string">.Sum)/1024/1024) | Out-File </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPathFile</span></span></span><span class="hljs-string"> -Append } else { Write-Host "</span></span>   : <span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">.FullName } } EmailNotification -Mail_body </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string"> = "</span></span><span class="hljs-string"><span class="hljs-string">" If ((Get-Item -Path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPath</span></span></span><span class="hljs-string">\1.log).LastWriteTime -gt (Get-Item -Path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPath</span></span></span><span class="hljs-string">\0.log).LastWriteTime){ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$log_content</span></span></span><span class="hljs-string"> = Get-Content (Get-ChildItem -Path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPath</span></span></span><span class="hljs-string">\1.log) foreach (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$data</span></span></span><span class="hljs-string"> in </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$log_content</span></span></span><span class="hljs-string">) { </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$data</span></span></span><span class="hljs-string">.split("</span></span>|<span class="hljs-string"><span class="hljs-string">") </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$xc1</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">[0] </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$xc2</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">[1] </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$log_content</span></span></span><span class="hljs-string"> = Get-Content (Get-ChildItem -Path </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LogPath</span></span></span><span class="hljs-string">\0.log) foreach (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$data</span></span></span><span class="hljs-string"> in </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$log_content</span></span></span><span class="hljs-string">) { </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$data</span></span></span><span class="hljs-string">.split("</span></span>|<span class="hljs-string"><span class="hljs-string">") if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$xc1</span></span></span><span class="hljs-string"> -eq </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">[0]){ if(([Int32]</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$xc2</span></span></span><span class="hljs-string"> - [Int32]</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">[1]) -gt 200){ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string"> += "</span></span>   : <span class="hljs-string"><span class="hljs-string">" + </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$xc1</span></span></span><span class="hljs-string"> + "</span></span>`n     : <span class="hljs-string"><span class="hljs-string">" + </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$y</span></span></span><span class="hljs-string">[1] + "</span></span> .<span class="hljs-string"><span class="hljs-string">" + "</span></span>`n     : <span class="hljs-string"><span class="hljs-string">" + </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$xc2</span></span></span><span class="hljs-string"> + "</span></span> .`n<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string"> } } } } EmailNotification -Mail_body </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$Mail_body</span></span></span><span class="hljs-string"> } } }</span></span></code> </pre><br><br>  To run, we determine the incoming parameters and run the check. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># :       1  $GB = 1073741824 $dir = "D:\Program Files" Check-Size-Directory -dir $dir -GB 107374 -Logpath "D:"</span></span></code> </pre><br><br>  The result of checking the message on the mail: <br><br>  Topic: DirSize: 11/27/2015 11:32:05 <br>  Date: Nov 27, 2015 11:32:05 +0200 <br>  From: sizefoldres@gmail.com <br>  To: levitskaks@gmail.com <br><br>  The size of the F: \ Shared \ PrivateData \ BRU directory exceeds the size of 1 GB. <br>  The size of the F: \ Shared \ PrivateData \ BRU directory is 1239.06250095367 MB. <br>  - <br><br>  Size of the F: \ Shared \ PrivateData \ Dan directory exceeds the size of 1 GB. <br>  The size of the F: \ Shared \ PrivateData \ Dan catalog is 1670.62088680267 MB. <br>  - <br><br>  The size of the F: \ Shared \ PrivateData \ DYA directory exceeds the size of 1 GB. <br>  The size of the F: \ Shared \ PrivateData \ DYA catalog is 7456.12028884888 MB. <br>  - <br><br>  The size of the F: \ Shared \ PrivateData \ GLU directory exceeds the size of 1 GB. <br>  The size of the F: \ Shared \ PrivateData \ GLU directory is 2198.93785953522 MB. <br>  - <br>  ... <br><br>  Content of the 0.log file: <br><br><pre> <code class="bash hljs">ActiveX|2.8662109375 AvPinTool|0.5712890625 BDE|10.4070873260498 &lt;b&gt;drivers|6.512216567993&lt;/b&gt; Drv <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Secureoken 337|0.129350662231445 eclipse-standard-kepler-SR2-win32|545.861120223999 flash|122.166826248169 FTP_Drive|0.252327919006348 Install|431.435597419739 Jabber|55.9909982681274 LibreOffice_4_3_4|215.234375 Liga9|336.688585281372 Mail (address_book)|0.141551971435547 nkicntInit|0.166786193847656 powershell_3.0|14.0534420013428 PowerShell_4_0|46.8222227096558 single|630.298968315125 Total Commander|6.67717361450195 WinImage|1.12846660614014 zabbix|1.37527465820313 |0.584843635559 CSPKeyUtil.exe|0.89208984375 jdk-8u65-windows-i586.exe|181.22908782959 jre-8u65-windows-i586.exe|47.8077087402344 LimeActiveXCrypt.cab|5.14455604553223 npp.6.7.4.Installer.exe|7.59689044952393 SkypeSetupFull_6.21.exe|34.3624038696289 winapcupsd-3.14.12.exe|5.84123229980469</code> </pre><br><br>  Contents of the 1.log file: <br><br><pre> <code class="bash hljs">ActiveX|2.8662109375 AvPinTool|0.5712890625 BDE|10.4070873260498 &lt;b&gt;drivers|276.512216567993&lt;/b&gt; Drv <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Secureoken 337|0.129350662231445 eclipse-standard-kepler-SR2-win32|545.861120223999 flash|122.166826248169 FTP_Drive|0.252327919006348 Install|431.435597419739 Jabber|55.9909982681274 LibreOffice_4_3_4|215.234375 Liga9|336.688585281372 Mail (address_book)|0.141551971435547 nkicntInit|0.166786193847656 powershell_3.0|14.0534420013428 PowerShell_4_0|46.8222227096558 single|630.298968315125 Total Commander|6.67717361450195 WinImage|1.12846660614014 zabbix|1.37527465820313 |205.584843635559 CSPKeyUtil.exe|0.89208984375 jdk-8u65-windows-i586.exe|181.22908782959 jre-8u65-windows-i586.exe|47.8077087402344 LimeActiveXCrypt.cab|5.14455604553223 npp.6.7.4.Installer.exe|7.59689044952393 SkypeSetupFull_6.21.exe|34.3624038696289 winapcupsd-3.14.12.exe|5.84123229980469</code> </pre><br><br>  The result of comparing two files: <br><br>  A sharp increase in the size of the directory: D: \ Program Files \ drivers <br>  The size of the last week was: 6.512216567993Mb. <br>  The size this week was: 276.512216567993 MB. <br><br>  The result is displayed informational. At the request of the administrator with the resource, you can perform any actions, for example, archiving and transferring, or selecting files by parameters and sending them to the repository. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/272107/">https://habr.com/ru/post/272107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272093/index.html">Network equipment at risk? Let's understand ...</a></li>
<li><a href="../272095/index.html">Corporate use of Android 5.0: security recommendations</a></li>
<li><a href="../272099/index.html">PHP 7.0.0</a></li>
<li><a href="../272101/index.html">SQLi is still in service</a></li>
<li><a href="../272105/index.html">What we should parse site. Webdriver API Basics</a></li>
<li><a href="../272115/index.html">Haskell "terrible" abstractions without mathematics and without code (almost). Part I</a></li>
<li><a href="../272117/index.html">PyNSK # 5 - the fifth meeting of the Novosibirsk Python community</a></li>
<li><a href="../272119/index.html">Few nice mancalas</a></li>
<li><a href="../272121/index.html">3CX Phone System 14 Service Pack 2 with a new console for the Secretary and WallBoard</a></li>
<li><a href="../272123/index.html">Unity in action. Multiplatform C # Development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>