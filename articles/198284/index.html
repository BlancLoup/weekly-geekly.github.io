<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to cheat Robokassu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More precisely, how to deceive compassionate individuals who take a commission for the purchase of themselves. Perhaps the title is too loud, perhaps ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to cheat Robokassu</h1><div class="post__text post__text-html js-mediator-article">  More precisely, how to deceive compassionate individuals who take a commission for the purchase of themselves.  Perhaps the title is too loud, perhaps this is not an article at all (especially considering that I have never written articles before), but some essay on a sick brain, which is time to finally get enough sleep, not to finish this online store.  And yet, during the integration of Robokassa into the online store, an interesting feature was noted that allows you to save on the purchase at the expense of those who are trying to commit commitments to the commission in favor of Robokassa on your account, and I would like to tell you about it. <a name="habracut"></a><br><br><h4>  Essence of the question </h4><br><br>  I think many of you are familiar with such a payment service as Robokassa.  This service, as usual, works with two types of clients: individuals and legal entities.  An ordinary user, buying something in our online store, expects to be billed for the amount indicated on the price tag.  The fact is obvious that to demand from the user to cover also the commission is a direct road to nowhere.  This is where the question arises, how to shift the responsibility of paying the robot box to its share on the online store itself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It would seem, what could be easier?  Surely, this setting is in your account on the site of payment.  It was not there.  Rather, it is.  But only if you are a legal entity. <br><br>  In my situation, the person to whom this store is created is a physical person.  The administration of the robocash desk prudently placed the issue of the commission in the sidebar of the personal account.  Apparently, as the most relevant.  In order not to be unfounded: <br><img src="https://habrastorage.org/getpro/habr/post_images/ce6/781/3f5/ce67813f548af457ec2d7f0eee85b113.png"><br><br>  I will not go deep into the details of how transactions work in Robokassa, the article is a little about that.  If you are interested in technical documentation, it is chewed on the official <a href="http://robokassa.ru/ru/Doc/Ru/Interface.asp">site</a> in detail <a href="http://robokassa.ru/ru/Doc/Ru/Interface.asp">.</a> <br>  Let me just say that in the process of payments, everything is based on several things: <br><ul><li>  MerchantLogin - your login in the system </li><li>  InvId - billing ID </li><li>  OutSum - the amount we want to receive. </li><li>  MerchantPass1 - technical password No. 1 for transactions (there are a total of two, the second is for receiving information on payment status) </li><li>  SignatureValue - md5 hash of the string "sMerchantLogin: nOutSum: nInvId: sMerchantPass1" </li></ul><br><br>  Actually, any tricky change of one of the values ‚Äã‚Äãincluded in the SignatureValue string will not allow the transaction to take place.  By the way, you, as a developer, can add your own shp * type parameters, which will ‚Äúsurvive‚Äù the payment and will be sent back to your server.  These parameters are also added to the signature of the transaction. <br>  Now back to the topic of the article. <br><br><h4>  Solution of the problem </h4><br><br>  The solution offered by the employees of Robokassa is alarming immediately.  It looks like this: <br><br><blockquote>  For these purposes, a special XML interface has been created: <br><br>  The method of calculating the amount received by the store - CalcOutSumm <br><br>  Description of the method: Allows you to calculate the amount receivable, based on current rates ROBOKASSA, the amount that the user will pay. <br><br>  Method parameters: MerchantLogin ‚Äî store identifier (string), IncCurrLabel ‚Äî currency label (string) for which the amount must be calculated.  If you leave it empty, the calculation will be made for all available currencies, IncSum - the amount that the user must pay. <br><br>  Request format: <a href="https://merchant.roboxchange.com/WebService/Service.asmx/CalcOutSumm%3FMerchantLogin%3Dstring%26IncCurrLabel%3Dstring%26IncSum%3Dstring">merchant.roboxchange.com/WebService/Service.asmx/CalcOutSumm?MerchantLogin=string&amp;IncCurrLabel=string&amp;IncSum=string</a> <br></blockquote><br><br>  Those.  we are invited to calculate the amount so that, taking into account the commission, it would equal the price of the goods.  The store was written on rails, and therefore all the additional parsing would take away a few lines.  And yet, even with all our desire <br><br><h4>  Where is the dog buried? </h4><br><br>  Problems begin as soon as we want to use this ‚Äúinterface‚Äù.  Suppose we want to calculate the amount for all payment methods.  As the guide says: <br><blockquote>  IncCurrLabel - currency label (string) for which you need to calculate the amount.  <b>If you leave it empty, the calculation will be made for all available currencies.</b> </blockquote><br><br>  Not.  Not true.  If you leave it empty, the server will return this response (using the <a href="https://merchant.roboxchange.com/WebService/Service.asmx/CalcOutSumm%3FMerchantLogin%3Ddemo%26IncCurrLabel%3D%26IncSum%3D3500">merchant.roboxchange.com/WebService/Service.asmx/CalcOutSumm?MerchantLogin=demo&amp;IncCurrLabel=&amp;IncSum=3500</a> link as an example. <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CalcSummsResponseData</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Result</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Code</span></span></span><span class="hljs-tag">&gt;</span></span>6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Code</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag">&gt;</span></span>   .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Result</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutSum</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutSum</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CalcSummsResponseData</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  My first thought: ‚ÄúMaybe I'm a fool and do something wrong.  Maybe you need to omit the parameter wrong? ".  But no, based on the same <a href="http://robokassa.ru/ru/Doc/Ru/Interface.aspx">documentation</a> (an example for another function, just showing the absence of meaning): <br><blockquote>  Sample request using HTTP GET: <br>  <a href="https://merchant.roboxchange.com/WebService/Service.asmx/GetRates%3FMerchantLogin%3Ddemo">merchant.roboxchange.com/WebService/Service.asmx/GetRates?MerchantLogin=demo</a> <b>&amp; IncCurrLabel = &amp;</b> OutSum = 10.45 &amp; Language = en </blockquote><br><br>  We try to omit the parameter altogether: <br><blockquote>  Missing parameter: IncCurrLabel. </blockquote><br><br>  Trouble  But we do not give up.  What can be done in this situation?  For sure!  Suppose we take the payment method identifier from the collection, count the payment amount for it separately and stuff it into a form on our website, then change outSum and recalculate the signature when the user chooses another method. <br><br>  <b>Well, I did not rush to implement it.</b> <br><br>  A bit of rough design showed that in reality everything would not be so rosy.  What am I talking about?  Let's take a closer look at <a href="http://robokassa.ru/ru/Doc/Ru/Interface.aspx">the payment initialization interface</a> . <br><br><blockquote>  sIncCurrLabel <br>  - the proposed currency of payment.  <b>The user can change it in the process of payment.</b> <br></blockquote><br><br>  Nothing has alarmed yet?  Let's think about it.  Robokassa invites us to calculate the amount ourselves, based on the user-selected payment interface.  This interface IncCurrLabel is not included in the signature.  This is logical, because  the user has the right to choose a different method on the checkout site  However, the commission for each method is calculated.  Moreover, it is offered to calculate it, on the side of our server.  We receive outSum from that interface, we push in our form, we consider the signature and we send for payment. <br><br><h5>  The essence of the whole article </h5><br>  Again. <br>  Robokassa offers us to deduct the amount of the commission from our income, based on what method of payment the user wants.  At the same time, it gives this method of payment to change when we no <b>longer have</b> control over the payment process.  What happens next? <br><br>  And then everything is simple.  The user chooses on our site the method with the largest commission.  In my memory - a bank card.  We, as good uncles, deduct about 300 rubles from the price of our goods in order to remove the burden of the commission from the buyer.  He, having got on the site of Robokassa, simply chooses payment through some Yandex or WebMoney with a meager commission.  The commission in a new way will be calculated on the site of the robocash desk based on the ‚Äúdiscount‚Äù price sent by us.  <b>Everything.</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57e/14d/41a/57e14d41a3d0185200d36355dae176eb.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/ee3/a74/0d2/ee3a740d2392a6b05e234c047f562ada.png"><br><br>  And yet, the snag is that from the moment the bills arrive at the site, if the user pays for the order, the ‚Äúsuccess‚Äù of payment will return to us.  And nobody cares that we lost money on this, in fact.  Such is the simple scheme. <br><br><h4>  What can you do? </h4><br><br><h5>  Exit number once </h5><br><h6>  Brutal </h6><br>  We can store the amount of our product and method of payment specified by the user in the very shp * parameters.  These parameters are protected from change, which means we will get them intact and safe.  Having received them back, we recalculate the amount again and see how much we received and how much we should have.  If we received less, then we were deceived and we can somehow influence the user. <br><br>  The problem here is only that a typical buyer can, by pure chance, even if we write that it is impossible to change the way in the checkout itself, to act on our own.  We will not be able to return the money in full to him if he confirms such a transaction.  So it's difficult to call it a way out. <br><br><h5>  Exit number two </h5><br><h6>  Only </h6><br>  Register at the checkout as a legal entity.  Actually, in my case, the customer decided to do just that.  In this case, you become available a single switch that solves this problem once and for all. <br><br><h5>  Exit number three </h5><br><h6>  Nonexistent </h6><br>  Robokassa could make it possible to prohibit the user to change the method of payment after the initialization of payment.  For example, enter the canChangeCurrLabel flag and push it into the transaction signature.  Then the costing interface would make sense, and we would not lose money.  What prevented - is unknown. </div><p>Source: <a href="https://habr.com/ru/post/198284/">https://habr.com/ru/post/198284/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198270/index.html">Qt Meta System over Network. Part 1 - Properties</a></li>
<li><a href="../198272/index.html">Chelyabinsk meteorite: systematized photo and video materials</a></li>
<li><a href="../198274/index.html">Metaobject Protocol for Basic Perl 5</a></li>
<li><a href="../198276/index.html">Zabbix: Backing up a small base</a></li>
<li><a href="../198280/index.html">Babel and handlebars, it's time to make friends</a></li>
<li><a href="../198286/index.html">Part 1. Detailed instructions for creating your CocoaPod</a></li>
<li><a href="../198288/index.html">Elon Musk will make a transformed submarine from "James Bond" a real vehicle-transformer</a></li>
<li><a href="../198290/index.html">Predictive interfaces</a></li>
<li><a href="../198292/index.html">Media query tips</a></li>
<li><a href="../198298/index.html">Virgin Galactic hopes to use its spacecraft for intercontinental flights</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>