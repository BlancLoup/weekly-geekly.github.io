<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GraphQL - API in a new way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is the GraphQL query language? What are the benefits of this technology and what problems will developers face when using it? How to effectively ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GraphQL - API in a new way</h1><div class="post__text post__text-html js-mediator-article">  What is the GraphQL query language?  What are the benefits of this technology and what problems will developers face when using it?  How to effectively use GraphQL?  About all this under the cut. <br><br><img src="https://habrastorage.org/webt/d4/w4/cg/d4w4cgweq81ewi6vo51e1kbw9tu.jpeg"><br><br>  The article is based on the introductory level report by <b>Vladimir Tsukur</b> ( <a href="https://habr.com/users/volodymyrtsukur/" class="user_link">volodymyrtsukur</a> ) from the <a href="https://jokerconf.com/">Joker 2017</a> conference. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YgRmgHPTXr4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  My name is Vladimir, I lead the development of one of the departments in the company WIX.  More than hundreds of millions of WIX users create websites of the most diverse directions - from business cards and shops to complex web applications where you can write code and arbitrary logic.  As a living example of a project on WIX, I would like to show you a successful website-shop <a href="https://www.unicornadoptions.com/">unicornadoptions.com</a> , which offers the opportunity to purchase a kit for taming a unicorn - the perfect gift for a child. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/2a9/7ec/db8/2a97ecdb8542ecb4aff1213a5b8690b9.jpg"><br><br>  A visitor to this site can choose the set he liked for taming a unicorn, say, pink, then see what exactly is included in this set: a toy, a certificate, an icon.  Next, the buyer has the opportunity to add the product to the cart, view its contents and place an order.  This is a simple example of a store site, and we have many such sites, hundreds of thousands.  All of them are built on the same platform, with a single backend, with a set of clients that we support, using the API for this.  About API also the speech will go further. <br><br><h2>  Simple API and its problems </h2><br>  Let's imagine what a general-purpose API (that is, one API for all stores on top of the platform) we could create to provide the functionality of the stores.  Concentrate until purely on the receipt of data. <br><br>  For the product page on such a site, the product name, its price, pictures, description, additional information and much more should be returned.  In a complete solution for stores on WIX, there are more than two dozen such data fields.  The standard solution for such a task on top of the HTTP API is to describe the <code>/products/:id</code> resource, which on a <code>GET</code> request returns product data.  The following is an example of the response data: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt today!"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>:<span class="hljs-string"><span class="hljs-string">"010"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"images"</span></span>: [   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/dd55129473e04f489806db0dc6468dd9.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/5727549e9131440dbb3cd707dce45d0f.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</span></span> ] }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/5d6/4ac/ecf5d64acd1da66df56b6aa49f5eb6be.jpg"><br><br>  Let's now look at the product catalog page.  This page will require a collection resource <i>/ products</i> .  Here are just in displaying a collection of products on the catalog page, not all product data is needed, but only the price, the name and the main image.  For example, the description, additional information, background images, etc. do not interest us. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa4/82b/0ed/aa482b0edf598fcc605eee75216e963b.png"><br><br>  Suppose, for simplicity, we decide to use the same product data model for the <code>/products</code> and <code>/products/:id</code> resources.  In the case of a collection of such products there will potentially be several.  The response scheme can be represented as follows: <br><br><pre> <code class="javascript hljs">GET /products [ {   title   price   images   description   info   ... } ]</code> </pre><br>  And now let's look at the "payload" of the response from the server for a collection of products.  Here is what the client actually uses among more than two dozen fields: <br><br> <code>{ <br> <s>"id": "59eb83c0040fa80b29938e3f",</s> <br> "title": "Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy", <br> "price": 26.99, <br> <s>"info": "Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt todayl",</s> <br> " <s>description": "Your fabulous Unicorn adoption combo pack contains:\nA 12\" Dreamy Eyes (Pink) Unicorn Soft Toy\nA blank Unicorn adoption certificate ‚Äî name your Unicorn!\nA confirmation letter\nA Unicorn badge\nA Unicorn key ring\nA Unicorn face mask (self assembly)\nA Unicorn bookmark\nA Unicorn colouring in sheet\nA A4 Unicorn posters\n2 x Unicorn postcards\n3 x Unicorn stickers",</s> <br> "images": [ <br> "http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg", <br> <s>"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg",</s> <br> <s>"http://localhost:8080/img/dd55129473604f489806db0dC6468dd9.jpg",</s> <br> <s>"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg",</s> <br> <s>"http://localhost:8080/img/5727549e9l3l440dbb3cd707dce45d0f.jpg",</s> <br> <s>"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</s> <br> ], <br> <s>...</s> <br> }</code> <br> <br>  Obviously, if I want to keep the product model simple by returning the same data, I end up with an over-fetching problem, getting in some cases more data than I need.  In this case, this manifested itself on the product catalog page, but in general, any UI screens that are somehow related to the product will potentially require only a portion (not all) of data from it. <br><br>  Let's now look at the cart page.  In the basket, besides the products themselves, there is also their quantity (in this basket), the price, as well as the total cost of the entire order: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/653/da1/ad3/653da1ad36872dff8cda2d13b28b5f45.png"><br><br>  If we continue the simple HTTP API modeling approach, then the basket can be presented through the <i>/ carts /: id</i> resource, whose view refers to the resources of the products added to this basket: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e40"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">25.98</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb88bd040fa8125aa9c400"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   } ], <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">79.96</span></span> }</code> </pre><br>  Now, for example, in order to draw a basket with three products on the frontend, you need to make four requests: one to load the basket itself, and three requests to download product data (name, price and SKU item number). <br><br>  The second problem we have is under-fetching.  The division of responsibility between the basket and product resources has led to the need to make additional requests.  There are obviously a number of shortcomings: due to <i>the</i> greater number of requests, we plant the battery of the mobile phone faster and get the full answer more slowly.  And the scalability of our solution also raises questions. <br><br>  Of course, this solution is not suitable for production.  One way to get rid of the problem is to add projection support for the basket.  One of such projections could, in addition to the data of the basket itself, return data on products.  Moreover, this projection will be very specific, because it is on the cart page that you need an inventory number (SKU) of the product.  Nowhere else has SKU been needed. <br><br><pre> <code class="plaintext hljs">GET /carts/1?projection=with-products</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a5f/3d7/901/a5f3d7901a3d60622575ae1fdf6787d1.png"><br><br>  Such a ‚Äúfitting‚Äù of resources to a specific UI usually does not end there, and we begin to generate other projections: brief information on the basket, basket projection for the mobile web, and after that - the projection for unicorns. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ff/6b5/dad/9ff6b5dad7ee3ec4e7d95790dcd2eb05.png"><br><br>  (In general, in the WIX designer, as a user, you can configure which product data you want to display on the product page and what data to show in the basket) <br><br>  And here we face difficulties: we are gardening the garden and looking for difficult solutions.  There are few standard solutions from the API point of view for such a task, and they usually depend heavily on the framework or library for describing HTTP resources. <br><br>  What's more important, now it becomes harder to work, because when the requirements on the client side change, the backend must constantly ‚Äúcatch up‚Äù and satisfy them. <br><br>  As the ‚Äúcherry on the cake,‚Äù let's consider another important problem.  In the case of a simple HTTP API, the server developer has no idea what kind of data is used by the client.  Is the price used?  Description?  One or all images? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f1/943/2d4/1f19432d49f8577cc70197bdb74a7987.png"><br><br>  Accordingly, several questions arise.  How to work with deprecated / obsolete data?  How to find out which data is really not used anymore?  How is it relatively safe to remove data from an answer without breaking most clients?  There is no answer to these questions with the usual HTTP API.  Contrary to the fact that we are optimistic and the API seems to be simple, the situation does not look so hot.  This spectrum of problems with the API came not only from WIX.  They had to deal with a large number of companies.  And now it's interesting to look at a potential solution. <br><br><h2>  GraphQL.  Start </h2><br>  In 2012, in the process of developing a mobile application, Facebook faced a similar problem.  Engineers wanted to achieve the minimum number of mobile applications to the server, while at each step receiving only the necessary data and nothing but them.  The result of their efforts was GraphQL, presented in 2015 at the React Conf conference.  GraphQL is a query description language, as well as the execution environment for these queries. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/052/9fc/00c/0529fc00c59b43faf40c8cbd4064d1ac.png"><br><br>  Consider a typical approach to working with GraphQL-servers. <br><br><h3>  We describe the scheme </h3><br>  The data scheme in GraphQL defines the types and relationships between them and does this in a strictly typed manner.  For example, imagine a simple model of a social network.  User <code>User</code> knows about his friends <code>friends</code> .  Users live in the City, and the city knows about its residents through the <code>citizens</code> field.  Here is what is graph of such a model in GraphQL: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae4/5e8/2e9/ae45e82e9610ff7abb7291fbe4671062.png"><br><br>  Of course, in order for the graph to be useful, we also need the so-called ‚Äúentry points‚Äù.  For example, such an entry point could be getting a user by name. <br><br><h3>  We are requesting data </h3><br>  Let's see what the essence of the GraphQL query language is.  Let us translate this question into this language: <i>‚ÄúFor a user with the name Vanya Unicorn, I want to know the names of his friends, as well as the name and population of the city in which Vanya lives‚Äù</i> : <br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vanya Unicorn"</span></span>) {   friends {     name   }   city {     name     population   } } }</code> </pre> <br>  And here comes the answer from the GraphQL server: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"friends"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lena"</span></span> },       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Stas"</span></span> }     ]     <span class="hljs-string"><span class="hljs-string">"city"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kyiv"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"population"</span></span>: <span class="hljs-number"><span class="hljs-number">2928087</span></span>     }   } } }</code> </pre><br>  Notice how the request form is ‚Äúin tune‚Äù with the response form.  There is a feeling that this query language was created for JSON.  With strict typing.  And all this is done in one HTTP POST request - no need to make multiple calls to the server. <br><br>  Let's see how it looks in practice.  Open the standard console for the GraphQL server, which is called Graph <i>i</i> QL (‚Äúgraph‚Äù).  For a request for a basket, I will execute the following request: <i>‚ÄúI want to receive a basket by identifier 1, all positions of this basket and product information are interested.</i>  <i>Of the information, the name, price, inventory number and images (and only the first) are important.</i>  <i>I am also interested in the quantity of these products, their price and the total cost of the basket</i> . <i>‚Äù</i> <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br>  After successful execution of the request, we will receive exactly what was asked: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf7/c04/a8e/cf7c04a8ef9d309387a6bcc935d40d10.png"><br><br><h2>  Main advantages </h2><br><ul><li>  <b>Flexible selection.</b>  The client can make a request for your specific requirements. <br></li><li>  <b>Effective sampling.</b>  Only the requested data is returned in the response. <br></li><li>  <b>Faster development.</b>  Many changes on the client can occur without the need to change anything on the server side.  For example, based on our example, you can easily show a different view of the basket for the mobile web. <br></li><li>  <b>Useful analytics.</b>  Since the client is obliged to specify the fields explicitly in the request, the server knows exactly which fields are really needed.  And this is important information for the deprecation-policy. <br></li><li>  <b>Works on top of any data source and transport.</b>  It is important that GraphQL allows you to work on top of any data source and any transport.  In this case, HTTP is not a panacea, GraphQL can also work through WebSocket, and we will touch on this point later. <br></li></ul><br>  Today GraphQL server can be done in almost any language.  The most complete version of the GraphQL server is <a href="https://github.com/graphql/graphql-js">GraphQL.js</a> for the Node platform.  In the Java community, the reference implementation is <a href="https://www.graphql-java.com/">GraphQL Java</a> . <br><br><h2>  Create GraphQL API </h2><br>  Let's take a look at how to create a GraphQL server using a specific life example. <br><br>  Consider a simplified version of an online store based on a microservice architecture with two components: <br><br><ul><li>  Cart-service, providing work with the user basket.  Stores data in a relational database and uses SQL to access data.  Very simple service, without too much magic :) <br></li><li>  A product-service providing access to the product catalog, from which, in fact, the basket is filled.  Provides HTTP API for accessing product data. <br></li></ul><br>  Both services are implemented on top of the classic Spring Boot and already contain all the basic logic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f0/1e9/560/5f01e95602be2c3d88178f1327f791c6.png"><br><br>  We intend to create GraphQL API over the Cart service.  This API is designed to provide access to the cart data and products added to it. <br><br><h3>  First version </h3><br>  We will be helped by the GraphQL reference implementation for the Java ecosystem, which we mentioned earlier - GraphQL Java. <br><br>  Add some dependencies to <code>pom.xml:</code> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>9.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java-tools<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.2.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphiql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  In addition to the previously mentioned <code>graphql-java</code> we will need the <code>graphql-java-tools,</code> library of <code>graphql-java-tools,</code> as well as the Spring Boot ‚Äústarters‚Äù for GraphQL, which will greatly simplify the first steps to create a GraphQL server: <br><br><ul><li>  <i>graphql-spring-boot-starter</i> provides a GraphQL Java quick bind mechanism with Spring Boot; <br></li><li>  <i>graphiql-spring-boot-starter</i> adds the Graphi QL interactive web console to execute GraphQL queries. <br></li></ul><br>  The next important step is to define the GraphQL service schema, our graph.  The nodes of this graph are described using <i>types</i> , and edges using <i>fields</i> .  An empty graph definition looks like this: <br><br><pre> <code class="javascript hljs">schema { }</code> </pre> <br>  In this scheme, as you remember, there are ‚Äúentry points‚Äù or top-level requests.  They are defined via the <i>query</i> field in the schema.  Let's <i>name</i> our type for entry points <i>EntryPoints</i> : <br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints }</code> </pre><br>  We define in it a basket search by identifier as the first entry point: <br><br><pre> <code class="javascript hljs">type EntryPoints { cart(id: Long!): Cart }</code> </pre><br>  <code>Cart</code> is nothing more than a <i>field</i> in terms of GraphQL.  <code>id</code> is a parameter of this field with scalar type <code>Long</code> .  Exclamation mark <code>!</code>  after specifying the type means that the parameter is required. <br><br>  It's time to determine the type of <code>Cart</code> : <br><br><pre> <code class="javascript hljs">type Cart { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: Long! items: [CartItem!]! subTotal: BigDecimal! }</code> </pre><br>  In addition to the standard <code>id</code> , the items <i>items</i> and the sum for all products <code>subTotal</code> are included in the basket.  Notice that <i>items are</i> defined as a list, as indicated by square brackets <code>[]</code> .  Items in this list are <code>CartItem</code> types.  The presence of an exclamation mark after the name of the field type <code>!</code>  indicates that the field is required.  This means that the server undertakes to return a non-empty value for this field if it was requested. <br><br>  It remains to look at the definition of the type <code>CartItem</code> , which includes a link to the product ( <i>productId</i> ), how many times it is added to the cart ( <code>quantity</code> ) and the sum of the product, recalculated to the quantity ( <code>total</code> ): <br><br><pre> <code class="javascript hljs">type CartItem { <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! quantity: Int! total: BigDecimal! }</code> </pre><br>  Everything is simple here - all fields are scalar types and are required. <br><br>  This scheme was not chosen randomly.  The Cart service already defines the Cart <code>Cart</code> and its <code>CartItem</code> elements with exactly the same names and field types as in the GraphQL scheme.  The basket model uses the Lombok library for autogenerating getters / setters, constructors, and other methods.  JPA is used for persistence in DB. <br><br>  <code>Cart</code> class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Id</span></span>   <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id;   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CartItem&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubTotal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getItems().stream()               .map(Item::getTotal)               .reduce(BigDecimal.ZERO, BigDecimal::add);   } }</code> </pre><br>  <code>CartItem</code> class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.AllArgsConstructor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Column; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Embeddable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  So, the basket ( <code>Cart</code> ) and elements of the basket ( <code>CartItem</code> ) are described both in the GraphQL scheme, in the code, and ‚Äúcompatible‚Äù with each other by the set of fields and their types.  But this is still not enough for our service to work. <br><br>  We need to clarify exactly how the " <code>cart(id: Long!): Cart</code> " entry point will work.  To do this, create an extremely simple Java configuration for Spring with beans like GraphQLQueryResolver.  GraphQLQueryResolver describes the entry points in the schema.  We define a method with a name identical to the field at the entry point ( <code>cart</code> ), make it compatible by the type of parameters, and use <code>cartService</code> to find the same basket by identifier: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLQueryResolver </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queryResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLQueryResolver () {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);       }   } }</code> </pre><br>  These changes are enough for us to get a working application.  After restarting the Cart service in the GraphiQL console, the following query will start successfully: <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     productId     quantity     total   }   subTotal } }</code> </pre> <br><h3>  On a note </h3><br><ul><li>  We use the scalar types <code>Long</code> and <code>String</code> as unique identifiers for the cart and product.  In GraphQL there is a special type for such purposes - <code>ID</code> .  Semantically, this is a better choice for this API.  Values ‚Äã‚Äãof type <code>ID</code> can be used as a key for caching. <br></li><li>  At this stage of development of our application, the internal and external domain model is completely identical.  These are the <code>Cart</code> and <code>CartItem</code> and their direct use in GraphQL resolvers.  In combat applications, these models are recommended to separate.  For GraphQL resolvers, there must be a separate model from the internal domain. <br></li></ul><br><h3>  Making API useful </h3><br>  So we got the first result, and that's great.  But now our API is too primitive.  For example, for the time being it is not possible to request useful data on a product, such as its name, price, article number, pictures, and so on.  Instead, there is only a <code>productId</code> .  Let's make the API really useful and add full support for the product concept.  Here is what its definition looks like in the schema: <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre><br>  Add the required field to the <code>CartItem</code> , and mark the outdated <code>productId</code> field: <br><br><pre> <code class="javascript hljs">type Item { <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: Int! product: Product! productId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! @deprecated(reason: <span class="hljs-string"><span class="hljs-string">"don't use it!"</span></span>) total: BigDecimal! }</code> </pre> <br>  With the scheme figured out.  Now is the time to describe how the selection for the <code>product</code> field will work.  Previously, we relied on the presence of getters in the <code>Cart</code> and <code>CartItem</code> , which allowed GraphQL Java to automatically bind values.  But here it should be recalled that there are no properties of the <code>product</code> in the <code>CartItem</code> class: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  We have a choice: <br><br><ol><li>  add the <i>product</i> property to the <i>CartItem</i> and ‚Äúteach‚Äù it to get product data; <br></li><li>  Determine how to get a <i>product</i> without changing the <i>CartItem</i> class. <br></li></ol><br>  The second way is more preferable, because in this case the model of describing the internal subject area ( <code>CartItem</code> class) will not overgrow with the details of the implementation of the Graph <i>i</i> QL API. <br><br>  The GraphQLResolver marker interface will help in achieving this goal.  By implementing it, you can determine (or redefine) exactly how to get field values ‚Äã‚Äãfor type <code>T</code>  Here is the corresponding bean in the Spring configuration: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;CartItem&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cartItemResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;CartItem&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartItem item)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(<span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,                   Product.class,                   item.getProductId());       }   }; }</code> </pre> <br>  The name of the method <code>product</code> not chosen randomly.  GraphQL Java searches for data loader methods by field name, and we just needed to define a loader for the <code>product</code> field!  An object of type <code>CartItem</code> , passed as a parameter, defines the context in which the product is selected.  Next - a matter of technology.  With the help of the <code>http</code> client of the <code>RestTemplate</code> type <code>RestTemplate</code> we perform a GET request to the Product-service and convert the result into a <code>Product</code> , which looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String id;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String title;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal price;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String sku;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;String&gt; images; }</code> </pre> <br>  These changes should be enough to implement a more interesting sample that includes the real connection between the basket and the products that have been added to it. <br><br>  After restarting the application, you can try a new query in the Graph <i>i</i> QL console. <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images     }     quantity     total   }   subTotal } }</code> </pre><br>  And here is the result of the query: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c8/778/3f4/0c87783f4f843696b9900771c2b2860e.png"><br><br>  Although the <code>productId</code> was tagged as <code>@deprecated</code> , queries with this field will continue to work.  But the Graph <i>i</i> QL console will not offer autocomplete for such fields and will highlight their use in a special way: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afc/96a/d45/afc96ad45f3f4372a8e86cf78b892acd.png"><br><br>  It's time to show the Document Explorer, part of the Graph <i>i</i> QL console, which builds on the basis of the GraphQL schema and shows information on all the specific types.  Here‚Äôs what the Document Explorer looks like for the <code>CartItem</code> type: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f83/c04/38b/f83c0438b2f906b34414b764182a37fc.png"><br><br>  But back to the example.  In order to achieve the same functionality as in the very first demo, there is still not enough overlap on the number of returned images.  After all, for a basket, for example, you need only one image for each product: <br><br><pre> <code class="javascript hljs">images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  To do this, change the schema and add a new parameter for the <i>images</i> field to the <i>Product</i> type: <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: ID! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images(limit: Int = <span class="hljs-number"><span class="hljs-number">0</span></span>): [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And in the application code we will use it again </font></font><code>GraphQLResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, only this time by type </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">productResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;Product&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Product product, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{           List&lt;String&gt; images = product.getImages();           <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));       }   }; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Again, I note that the name of the method is not accidental: it coincides with the name of the field </font></font><code>images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The context object </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gives access to the images, and </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a parameter of the field itself. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the client does not specify anything as a value for </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then our service will return all product images. </font><font style="vertical-align: inherit;">If the client has specified a specific value, then the service will return exactly as much (but not more than they are in the product). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We compile the project and wait for the server to restart. </font><font style="vertical-align: inherit;">Restarting the scheme in the console and executing the query, we see that the full query really works.</font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agree, all this is very cool. </font><font style="vertical-align: inherit;">In a short time, we not only learned what GraphQL is, but also transferred a simple microservice system to support such an API. </font><font style="vertical-align: inherit;">And it didn‚Äôt matter to us where the data came from: both the SQL and the HTTP API were well placed under the same roof.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code-First and GraphQL SPQR Approach </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You might have noticed that during the development process there was some inconvenience, namely the need to constantly keep the GraphQL scheme and code in sync. Type changes always had to be done in two places. In many cases it is more convenient to use the code-first approach. Its essence is that the scheme for GraphQL is automatically generated based on the code. In this case, you do not need to support the scheme separately. Now I will show how it looks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only the basic features of GraphQL Java are no longer enough; we will also need the GraphQL SPQR library. The good news is that GraphQL SPQR is an add-on to GraphQL Java, and not an alternative implementation of the Java Graphical SQL Server. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add the desired dependency in </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.leangen.graphql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spqr<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.9.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here is the code that implements the same functionality based on GraphQL SPQR for the basket: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CartService cartService;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartService cartService)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cartService = cartService;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"cart"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long id) </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And for the product: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RestTemplate http;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate http)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http = http;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(               <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,               Product.class,               cartItem.getProductId()       );   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"images"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext Product product,                              @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"limit"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> limit) </span></span>{       List&lt;String&gt; images = product.getImages();       <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The @GraphQLQuery annotation is used to mark field loader methods. </font><font style="vertical-align: inherit;">The annotation </font></font><code>@GraphQLContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specifies the type of sampling for the field. </font><font style="vertical-align: inherit;">And the annotation </font></font><code>@GraphQLArgument</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marks the argument parameters explicitly. </font><font style="vertical-align: inherit;">All of this is part of a single mechanism that helps GraphQL SPQR generate a circuit automatically. </font><font style="vertical-align: inherit;">Now, if you delete the old Java configuration and schema, restart the Cart service using the new features from GraphQL SPQR, then you can make sure that everything works in the same way as before.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solve the problem of N + 1 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is time to look at b </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lshih detail how the implementation of the whole request "under the hood". </font><font style="vertical-align: inherit;">We quickly created the GraphQL API, but does it work efficiently?</font></font><br><br>  Consider the following example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05c/626/303/05c62630323d9ad9eeb97999c19fcd04.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Receiving a basket </font></font><code>cart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">occurs in a single SQL query to the database. </font><font style="vertical-align: inherit;">Data on </font></font><code>items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>subtotal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">come back in the same place, because the elements of the basket loaded with the entire collection of JPA-based strategy eager fetch:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Item&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   ... }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/674/0e4/863/6740e4863b4847f782f64588e52ecc36.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When it comes to downloading data by products, then there will be exactly as many requests for a Product-service as in this basket of products. If there are three different products in the basket, then we will receive three requests to the HTTP API of the product service, and if there are ten of them, then the same service will have to answer ten such requests. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/92c/9c0/b1a/92c9c0b1a06c15f081c0eb9dc9ce8a1f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is what the communication between the Cart-Service and the Product-Service in Charles Proxy looks like: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/8df/d08/c158dfd08badf133f49499baa43c1970.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accordingly, we return to the classic N + 1 problem. Exactly the one from which they tried so hard to leave at the very beginning of the report. Undoubtedly, we have progress, because there is exactly one request between the end customer and our system. But inside the server ecosystem, performance clearly needs improvement.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I want to solve this problem by getting all the necessary products in one request. </font><font style="vertical-align: inherit;">Fortunately, the Product-service already supports this feature through a parameter </font></font><code>ids</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the collection resource:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=:id1,:id2,...,:idn</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see how you can modify the code of the selection method for the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">product</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Previous version:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,           Product.class,           cartItem.getProductId()   ); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Replace with more effective: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}"</span></span>,           Products.class,           productIds   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We did exactly three things: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marked the loader method with the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Batched</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> annotation </font><font style="vertical-align: inherit;">, making it clear to GraphQL SPQR that the download should be done by batch;</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> changed the return type and the context parameter to the list, because working with batch assumes that several objects are received and returned; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> changed the body of the method by implementing a sample of all the necessary products at once. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These changes are enough to solve our N + 1 problem. </font><font style="vertical-align: inherit;">In the Charles Proxy application window, you can now see one request for a Product-service, which returns three products at once:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c2/806/98d/5c280698dfbdf383cf44052f51a09ae8.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effective sampling by field </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We solved the main problem, but you can make the selection even faster! </font><font style="vertical-align: inherit;">Now the Product-service returns all the data, regardless of what the end customer needs. </font><font style="vertical-align: inherit;">We could improve the query and return only the requested fields. </font><font style="vertical-align: inherit;">For example, if the end customer did not request images, why do we need to transfer them to the Cart-service at all? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It's great that the HTTP API of the Product Service already supports this feature through the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">for the same collection resource:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=...?include=:field1,:field2,...,:fieldN</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the loader method, add a parameter of type Set with annotation </font></font><code>@GraphQLEnvironment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">GraphQL SPQR understands that the code in this case "asks" a list of field names that are requested for the product, and automatically fills them in:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items,                             @GraphQLEnvironment Set&lt;String&gt; fields)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}&amp;include={fields}"</span></span>,           Products.class,           productIds,           String.join(<span class="hljs-string"><span class="hljs-string">","</span></span>, fields)   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now our sample is real effective, it is devoid of the N + 1 problem and only involves the necessary data: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/592/98f/24259298fe8acb19d21e04083689d5dd.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Heavy" requests </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagine working with a user graph within a classic social network such as Facebook. </font><font style="vertical-align: inherit;">If such a system provides the GraphQL API, then nothing prevents the client from sending a request of the following nature:</font></font><br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vova Unicorn"</span></span>) {   friends {     name     friends {       name       friends {         name         friends {            name            ...         }       }     }   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the 5-6 nesting level, the full execution of such a query will lead to a sample of all users in the world. </font><font style="vertical-align: inherit;">The server certainly will not cope with such a task in one sitting and most likely will simply simply ‚Äúfall‚Äù. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are a number of measures that should be taken in order to protect against such situations:</font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limit the depth of the request. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In other words, customers should not be allowed to request data of arbitrary nesting.</font></font><br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limit query complexity. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By assigning a weight to each field and calculating the sum of the weights of all the fields in the request, you can accept or reject such requests on the server.</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For example, consider the following query: </font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title     }     quantity   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviously, the depth of such a request - 4, because the longest path within it </font></font><code>cart -&gt; items -&gt; product -&gt; title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we assume that the weight of each field is 1, then taking into account 7 fields in the query, its complexity is also 7. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In GraphQL Java, the imposition of checks is achieved by specifying additional instrumentation when creating an object </font></font><code>GraphQL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs">GraphQL.newGraphQL(schema)       .instrumentation(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChainedInstrumentation(Arrays.asList(               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryComplexityInstrumentation(<span class="hljs-number"><span class="hljs-number">20</span></span>),               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryDepthInstrumentation(<span class="hljs-number"><span class="hljs-number">3</span></span>)       )))       .build();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instrumentation </font></font><code>MaxQueryDepthInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checks the depth of the query and does not allow launching too ‚Äúdeep‚Äù queries (in this case, with a depth of more than 3). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instrumentation </font></font><code>MaxQueryComplexityInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">before the execution of the request counts and checks its complexity. If this number exceeds the specified value (20), then such a request is rejected. You can redefine the weight for each field, because some of them obviously get "heavier" than others. For example, the product field can be assigned complexity 10 through the annotation </font></font><code>@GraphQLComplexity,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supported in GraphQL SPQR:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@GraphQLComplexity</span></span>(<span class="hljs-string"><span class="hljs-string">"10"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is an example of a depth test, when it clearly exceeds the specified value: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/54c/c39/584/54cc39584792997b198370c40e8b2431.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, the instrumentation mechanism is not limited to the imposition of restrictions. </font><font style="vertical-align: inherit;">It can be used for other purposes, such as logging or tracing. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We looked at the GraphQL ‚Äúprotection‚Äù measures. </font><font style="vertical-align: inherit;">However, there are a number of techniques that should be noted regardless of the type of API:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> throttling / rate-limiting - limiting the number of requests per unit of time </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> timeouts - time limit for operations with other services, databases, etc .; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pagination - pagination support. </font></font><br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Change data through mutations </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So far, we have considered a purely data sample. </font><font style="vertical-align: inherit;">But GraphQL allows you to organically organize not only data retrieval, but also their change. </font><font style="vertical-align: inherit;">There is a mechanism for this </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the scheme for this special place is reserved - the field </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For example, adding a product to the basket can be organized through this mutation: </font></font><br><br><pre> <code class="javascript hljs">type Mutations {   addProductToCart(cartId: Long!,                    <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!,                    <span class="hljs-attr"><span class="hljs-attr">count</span></span>: Int = <span class="hljs-number"><span class="hljs-number">1</span></span>): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is similar to the definition of a field, because the mutation also has parameters and a return value. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The implementation of a mutation in the server code using GraphQL SPQR is as follows:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLMutation</span></span>(name = <span class="hljs-string"><span class="hljs-string">"addProductToCart"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addProductToCart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(       @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"cartId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long cartId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"productId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String productId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"quantity"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"1"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> quantity) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.addProductToCart(cartId, productId, quantity); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, the main part of the useful work is done inside </font></font><code>cartService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. And the task of this interlayer method is to associate it with the API. As in the case of data sampling, thanks to annotations it is </font></font><code>@GraphQL*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">very easy to understand exactly which GraphQL scheme is generated from this method definition. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the GraphQL console, you can now perform a query-mutation to add a specific product to our basket in the amount of 2:</font></font><br><br><pre> <code class="javascript hljs">mutation { addProductToCart(     cartId: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>) {   items {     product {       title     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the mutation has a return value, it can request fields using the same rules as we did for ordinary samples. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Several WIX development teams actively use GraphQL along with Scala and the Sangria library, the main implementation of GraphQL in this language. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of the useful techniques we use on WIX is support for GraphQL queries when rendering HTML. </font><font style="vertical-align: inherit;">We do this in order to generate JSON directly into the page code. </font><font style="vertical-align: inherit;">Here is an example of filling the HTML template:</font></font><br><br><pre> <code class="xml hljs">// Pre-rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-embedded-graphiql</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> {   product(productId: $productId)     title     description     price     ...   } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> But what happens at the output: </font></font><br><br><pre> <code class="xml hljs">// Rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.DATA = {   </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">product</span></span></span><span class="javascript">: {          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">title</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'GraphQL Sticker'</span></span></span><span class="javascript">,          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">description</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'High quality sticker'</span></span></span><span class="javascript">,           </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">price</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'$2'</span></span></span><span class="javascript">           ... } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Such a bundle of HTML-renderer and GraphQL-server allows us to reuse our API to the maximum and not to create an additional layer of controllers. </font><font style="vertical-align: inherit;">More than this, this technique often turns out to be advantageous in terms of performance, because after loading a page, the JavaScript application does not need to go after the first necessary data again to the backend - they are already on the page.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GraphQL Disadvantages </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Today GraphQL uses a large number of companies, including such giants as GitHub, Yelp, Facebook and many others. </font><font style="vertical-align: inherit;">And if you decide to join them, you should know not only the merits of GraphQL, but also its disadvantages, and there are a lot of them:</font></font><br><br><ul><li> -,  GraphQL <b>     </b> .  GraphQL      ,   HTTP API.  <i>Cache-Control</i>  <i>Last-Modified</i>    HTTP      GraphQL API.         ,  proxy  gateways (Varnish, Fastly  ).   , GraphQL    ,    ,   . <br></li><li>   GraphQL ‚Äî <b>    </b> .    ,         API,    ,       . <br></li><li> <b> </b>  GraphQL       .        . <br></li><li>  <b>     </b> . GraphQL ‚Äî       .     JSON  XML, , ,          GraphQL,       . <br></li><li>  GraphQL <b>   </b> . ,       HTTP   <i>PUT</i>     <i>POST</i>  -.   ,       .    GraphQL       .        . <br></li><li> <b>   </b> . ,     -: ¬´delete¬ª  ¬´kill¬ª, ¬´annihilate¬ª  ¬´terminate¬ª,    .   GraphQL API    .   HTTP          <i>DELETE</i> . <br></li><li>  <a href="https://www.youtube.com/watch%3Fv%3DG9apMqwRedA">Joker 2016   </a>   .  GraphQL <b>      </b> .  API-   ,   ,    ,     HATEOAS,     ,   ¬´ REST¬ª. ,     ,  GraphQL     . <br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is also worth remembering that if you did not manage to develop the HTTP API well, then, most likely, it will not be possible to develop the GraphQL API as well. What is most important in the development of any API? Separate the internal domain model from the external API model. Build an API based on usage scenarios, not the internal device of the application. Open only the necessary minimum of information, and not everything. Choose the correct names. Describe the graph correctly. There is a resource graph in the HTTP API, and a field graph in the GraphQL API. In both cases, this graph needs to be done qualitatively.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are alternatives in the HTTP API world, and it is not necessary to always use GraphQL when it comes to the need for complex samples. </font><font style="vertical-align: inherit;">For example, there is an OData standard that supports partial and expansion samples, like GraphQL, and works on top of HTTP. </font><font style="vertical-align: inherit;">There is a JSON API standard that works with JSON and supports the capabilities of hypermedia and complex samples. </font><font style="vertical-align: inherit;">There is also LinkRest, more about which you can learn from </font></font><a href="https://youtu.be/EsldBtrb1Qc"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://youtu.be/EsldBtrb1Qc"&gt; the report of Andrus Adamchik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on Joker 2017. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For those who want to try GraphQL, I strongly advise reading the comparison articles from engineers who are deeply versed in REST and GraphQL from practical and philosophical points of view:</font></font><br><br><ul><li> <a href="https://philsturgeon.uk/api/2017/01/24/graphql-vs-rest-overview/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://philsturgeon.uk/api/2017/01/24/graphql-vs-rest-overview/</font></font></a> <br></li><li> <a href="https://blog.runscope.com/posts/you-might-not-need-graphql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://blog.runscope.com/posts/you-might-not-need-graphql</font></font></a> <br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally about Subscriptions and </font></font><a href="https://habr.com/users/defer/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defer</font></font></a> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL has one interesting advantage over standard APIs. </font><font style="vertical-align: inherit;">In GraphQL, both synchronous and asynchronous usage scenarios can sit under the same roof. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We considered with you receiving data through </font></font><code>query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, changing the state of the server through </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but there is another goodness. </font><font style="vertical-align: inherit;">For example, the ability to organize subscriptions </font></font><code>subscriptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagine that a client wants to receive asynchronously notifications about adding a product to the basket. </font><font style="vertical-align: inherit;">Through the GraphQL API, this can be done based on this scheme:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: Queries, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations, <span class="hljs-attr"><span class="hljs-attr">subscription</span></span>: Subscriptions } type Subscriptions { productAdded(cartId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The customer can subscribe through the following request: </font></font><br><br><pre> <code class="javascript hljs">subscription { productAdded(cart: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product ...   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, each time a product is added to cart 1, the server will send a message to the subscribed client via WebSocket with the requested cart data. </font><font style="vertical-align: inherit;">Again, by continuing the GraphQL policy, only the data that the customer requested when signing up will come:</font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"productAdded"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ }     ],     <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">289.33</span></span>   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The client can now redraw the basket, without necessarily redrawing the entire page. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is convenient because both the synchronous API (HTTP) and the asynchronous API (WebSocket) can be described via GraphQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another example of using asynchronous communication is the </font></font><i><a href="https://habr.com/users/defer/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defer</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mechanism </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The basic idea is that the client chooses what data he wants to receive immediately (synchronously), and those that he is ready to receive later (asynchronously). </font><font style="vertical-align: inherit;">For example, for such a query:</font></font><br><br><pre> <code class="javascript hljs">query { feedStories {   author { name }   message   comments @defer {     author { name }     message   } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The server first returns the author and a message for each story: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"feedStories"</span></span>: [     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     },     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     }   ] } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After that, the server, having received data on the comments, will asynchronously deliver them to the client via WebSocket, specifying in the path for which particular history the comments are now ready: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"feedStories"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"comments"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶   } ] }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sample source code </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code that was used in the preparation of this report can </font></font><a href="https://github.com/vtsukur/graphql-java-store"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">be found on GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More recently, we announced the </font></font><a href="https://jpoint.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPoint 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will be held April 5-6, 2019. </font><font style="vertical-align: inherit;">More information about what to expect from the conference, you can learn from our </font></font><a href="https://habr.com/company/jugru/blog/429814/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habrapost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Until December 1st, </font></font><a href="https://jpoint.ru/tickets/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Early Bird tickets</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are still available </font><font style="vertical-align: inherit;">at the lowest price.</font></font></blockquote></div><p>Source: <a href="https://habr.com/ru/post/428517/">https://habr.com/ru/post/428517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428507/index.html">We write chat bot for VKontakte on python using longpoll</a></li>
<li><a href="../428509/index.html">How H & M tries to save itself with AI and Big Data</a></li>
<li><a href="../428511/index.html">Hydrogen energy: the beginning of a long journey</a></li>
<li><a href="../428513/index.html">500 laser pointers in one place</a></li>
<li><a href="../428515/index.html">Top 3D Shop: how we have changed over the year - the results of 2018</a></li>
<li><a href="../428521/index.html">Why on GitHub there are no friends. About Robbie Barrat, Obvious and Copyright</a></li>
<li><a href="../428523/index.html">ShadowCloud - universal cloud client</a></li>
<li><a href="../428525/index.html">RecyclerView at max speed: parsing libraries</a></li>
<li><a href="../428526/index.html">Google tax: 180 ¬∞ reversal</a></li>
<li><a href="../428528/index.html">Why revolutionaries like spicy food, or How chili got to China</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>