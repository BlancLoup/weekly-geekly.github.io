<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visual editor of letters on React + Redux. Overview, example of use and expansion</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 Hello! Not so long ago, I received the task to embed a visual email editor into our internal mailing service, because people are tire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visual editor of letters on React + Redux. Overview, example of use and expansion</h1><div class="post__text post__text-html js-mediator-article"><h2 id="vvedenie">  Introduction </h2><br><p>  Hello!  Not so long ago, I received the task to embed a visual email editor into our internal mailing service, because people are tired of typing html with their hands and composing valid email templates.  After surfing the Internet, I found 2 editors who, then, seemed to me, perfectly suited for these purposes.  Links to them at the end of the topic.  After studying them more carefully ( <em>EmailEditor was</em> written using <em>jQuery</em> , which I studied quite well at one time, and <em>Mosaico</em> was at <em>KnockoutJS</em> , I know him only superficially), I stopped at <em>EmailEditor</em> , and again plunged into the crap from which a year ago was so successful I got out with the help of <em>Angular</em> and <em>Ionic</em> , namely - files with 2-3k lines, ubiquitous and random change of DOM in various ways from different places, etc., well, you understand me). </p><br><p>  After spending more than a month trying to fix all the bugs, gash the building blocks we need to send, etc., I gave up ... I decided to try <em>Mosaico</em> and even began to actively explore <em>Knockout</em> , but the problem is that this monster (I mean <em>Mosaico</em> ) was so hard to write that <em>EmailEditor</em> didn't seem so bad.  Plus, Mosaico practically has no sane documentation, and if I intuitively understood how everything works and how to create my own units, then no intuition helped me.  Maybe it‚Äôs just that there wasn‚Äôt enough brain, patience and desire to understand, I don‚Äôt know, just take a look at the source of these editors at your leisure ... And the time was running out ... </p><br><h2 id="chto-zhe-delat">  What to do?! </h2><a name="habracut"></a><br><p>  I asked myself, and answered myself ‚ÄúOf course, reinvent the wheel! With a gold chain and crimson wheels!‚Äù.  It so happened that just at that moment for one of my pet-projects I needed to start exploring the currently popular <em>React + Redux</em> approach to building web applications.  After reading about <em>Redux</em> , it dawned on me!  Here it is!  The state of the application in one place is not the best option to build an architecture in which the <em>JSON</em> representation of the letter template will change!  And I began to write ... After a couple of weeks of sleepless nights, a prototype was presented to the authorities and it was decided to try to implement my editor.  From the repository, it can be noticeable that at the very beginning it was difficult for me to determine the structure of the template and the principles of operation, but as I studied, trying different approaches, I decided not to complicate things and still came to what I have now, namely: </p><br><ul><li>  template - letter template with blocks, where each block contains: <br><ul><li>  id is a block identifier (I use Date.now () and am not worried); </li><li>  block_type - block type (hereinafter I will explain why); </li><li>  options - styles and properties for the container and block elements, in which: <br><ul><li>  container is an object that is then directly substituted into the style of the block, i.e.  these are CSS styles; </li><li>  elements - CSS styles for block elements and parameters of type source, text (I decided to mix them together); </li></ul></li></ul></li><li>  common - common CSS settings for blocks; </li><li>  components - available to add in blocks; </li><li>  tabs - setting tabs visibility; </li><li>  tinymce_config - general TinyMCE setting for blocks using it; </li><li>  language - application localization; </li><li>  templateId - ID of the template to save \ load; </li></ul><br><p>  That's the whole store. </p><br><h2 id="obzor-raboty-s-redaktorom">  Review of work with the editor </h2><br><p>  Where to start ... Here and below, I assume that you have <em>NodeJS</em> , npm, and preferably <em>MongoDB</em> installed, and also that you have some experience with both them and the <em>React + Redux</em> stack.  Running live development is simple because the project is written using create-react-app.  So, after copying the repository, just run: </p><br><blockquote>  npm install <br>  npm start </blockquote><p>  in the project folder and in your browser the address <a href="http://localhost:3000/">http: // localhost: 3000</a> will open, where you will see something like this: </p><br><div class="spoiler">  <b class="spoiler_title">Watch</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/991/b47/e7e/991b47e7e43a41f899e576cef8e053f5.png"></p></div></div><br><p>  Of the available locales, only en and ru are currently supported, the download is directly from the <em>JSON</em> file in the translations folder and, unfortunately, I haven‚Äôt yet written whether the user locale is available to be substituted by default, but these are trivialities, this is then ... Applications - index.js in the root <em>src /</em> , the initial store is set there, and three actions are dispatched to load the locale, the list of blocks and the template taken by ID from your storage, or, if no ID is specified, the default template.  Since the launch initially occurs without any parameters, everything will be loaded from local files, server setup at this stage is not required (but will be needed for the methods of saving / loading the template, loading the image and sending a test letter). </p><br><p>  The interface is terribly simple - on the left is the settings panel and blocks, in the center is a letter template, on the sides of the template are buttons.  Blocks can be dragged onto the template (they are added as if on top of the target block, shifting everything down); when you hover over the target block, it changes color.  Here I think about how to implement the "phantom block", as in some other editors, but this is not a priority task.  When you click on a block, the tab in which the settings for the selected block are contained is activated, and this block is highlighted, and the delete block button appears, as seen in the screenshot: </p><br><div class="spoiler">  <b class="spoiler_title">Watch</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/cd2/765/f7e/cd2765f7ee754197925d25f4dbd0ac97.png"></p></div></div><br><p>  Well, if you select the general settings tab, you will see a set of settings that will be applied to all blocks, except those with the Custom style flag.  Also there is an opportunity to set the background of the template container: </p><br><div class="spoiler">  <b class="spoiler_title">Watch</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/837/8db/a10/8378dba1062644deae06e365f6eee08a.png"></p></div></div><br><p>  Clicks on the buttons allow you to save the template (you will be asked to set the name of the template, but it is easy to cut), send a test letter and delete the block (in the plans also implement Undo \ Redo functionality, now I read about it) </p><br><p>  You can also start and play around with the NodeJS server (it‚Äôs in the server_nodejs folder) by first copying the build folder that appears if you do <em>npm run build</em> in the main project folder (do not forget to <em>npm install</em> in both folders!).  What the server can do: it saves \ produces a template (? Id = your_id) and loads images, and also says 'OK' when sending a test letter =).  I think it will not be difficult to figure out the structure of the project is quite simple, I don‚Äôt like to complicate it at all ... The entry point is <em>app.js</em> , there is a <em>Controller</em> in the <em>app</em> folder - everything is there, <em>Router</em> - paths are associated and linked to the controller, and <em>TemplateModel</em> - ORM . </p><br><h2 id="nemnogo-vnutrennostey">  Some insides </h2><br><p>  In the <em>src / components</em> folder there are subfolders of <em>blocks</em> and <em>options</em> in which the block templates and settings of these blocks lie. </p><br><div class="spoiler">  <b class="spoiler_title">Block example with hr</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BlockHr = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ blockOptions }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"550"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cellPadding</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cellSpacing</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"presentation"</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"550"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{blockOptions.elements[0]}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{blockOptions.container.height}</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> BlockHr;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">An example of setting up a block with hr</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OptionsHr = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ block, language, onPropChange }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;div&gt; &lt;label&gt;{language[</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Custom style"</span></span></span></span><span class="hljs-function"><span class="hljs-params">]}: &lt;input type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"checkbox"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> checked={block.options.container.customStyle? </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'checked'</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params"> } onChange={(e</span></span></span><span class="hljs-function">) =&gt;</span></span> onPropChange(<span class="hljs-string"><span class="hljs-string">'customStyle'</span></span>, !block.options.container.customStyle, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)} /&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; &lt;hr /</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{language["Height"]}: </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"number"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{block.options.container.height}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{(e)</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> onPropChange('height', e.target.value, true)} /&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{language["Background"]}: </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"color"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{block.options.container.backgroundColor}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{(e)</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> onPropChange('backgroundColor', e.target.value, true)} /&gt;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); }; export default OptionsHr;</span></span></code> </pre> </div></div><br><p>  Also in the <em>src / components</em> folder there is a <em>Block.js</em> file, in which all blocks from <em>blocks</em> and <em>switch are</em> connected <em>... case</em> , in which the <em>block_type</em> (which I mentioned above) determines which block variant will be returned. </p><br><p>  The same principle in the <em>Options.js</em> file for settings.  And from this architecture I would like to leave as soon as possible (maybe someone has thoughts in which direction to make the transition?).  The <em>BlockList.js</em> file contains a letter template, in which you can see how everything is arranged - <em>tr&gt; td</em> elements are built in a cycle, and <em>td</em> in this case is a container inside which a block with elements is already placed.  The container settings (styles from block.options.container) are also picked up, and <em>DnD</em> logic is also implemented.  In the configuration, too, everything is quite transparent, onCnge handlers are <em>hung on the input</em> , inside of which <em>onPropChange</em> (prop, value, container ?, element_index) is called with parameters ('property to change, for example, color', new property value, element to change (container - true, element - false), element index).  In principle, this is the main idea and there is nothing more to tell =).  On the mindmap, I tried to schematically depict the work of this pipeline: </p><br><div class="spoiler">  <b class="spoiler_title">Watch</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/994/9a1/fe7/9949a1fe72d6446199fbbb860e35b175.png"></p></div></div><br><p>  PS There are two branches in the repository - <em>master</em> and <em>react_email_editor_wordpress</em> .  In principle, there are no special differences, differences in the <em>sagas / api.js files</em> (WP has its own approach to AJAX), feedback and social blocks (there are other paths to pictures ... WP zhezh).  Our editor is integrated into WP and is currently being tested. </p><br><h2 id="tak-kak-zhe-sdelat-svoy-blok">  So how do you make your block? </h2><br><p>  Very simple!  Well, I think so, because I worked with it tightly and every day ... <br>  I'll start by choosing the type of block.  Wandering through the internet, I came across one nice template: </p><br><div class="spoiler">  <b class="spoiler_title">Watch</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/7a8/56a/b5f/7a856ab5f55a4251abc348bfc348ddc9.jpg"></p></div></div><br><p>  I liked the block with three icons WEBSITES, SERVICES, SEO.  Well, I'll try to tell you how to implement such a block.  First, let's define the composition of the block.  I see 6 elements here: 3 pictures and 3 text elements, well, you can subsequently program your vision of this block.  Since I tried to make the setting as flexible as possible, you are free to come up with almost any layout (for example, 3 picture-text elements), and this will be quite realistic.  Quite a few words, go code! </p><br><p>  Open the <em>public / components.json</em> file and add the following JSON: </p><br><div class="spoiler">  <b class="spoiler_title">Block 3 icons</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">...  ... { <span class="hljs-string"><span class="hljs-string">"preview"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/3_icons.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"block"</span></span>: { <span class="hljs-string"><span class="hljs-string">"block_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"3_icons"</span></span>, <span class="hljs-string"><span class="hljs-string">"options"</span></span>: { <span class="hljs-string"><span class="hljs-string">"container"</span></span>: { <span class="hljs-string"><span class="hljs-string">"padding"</span></span>: <span class="hljs-string"><span class="hljs-string">"0 50px"</span></span>, <span class="hljs-string"><span class="hljs-string">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#333333"</span></span>, <span class="hljs-string"><span class="hljs-string">"fontSize"</span></span>: <span class="hljs-string"><span class="hljs-string">"20px"</span></span>, <span class="hljs-string"><span class="hljs-string">"customStyle"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>: <span class="hljs-string"><span class="hljs-string">"#F7F8FA"</span></span> }, <span class="hljs-string"><span class="hljs-string">"elements"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"source"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://images.vexels.com/media/users/3/136010/isolated/preview/e7e28c15388e5196611aa2d7b7056165-ghost-skull-circle-icon-by-vexels.png"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"source"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://www.1pengguna.com/1pengguna/uploads/images/tipimgdemo/kesihatan.gif"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"source"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Circle-icons-cloud.svg/2000px-Circle-icons-cloud.svg.png"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"DEADS"</span></span>, <span class="hljs-string"><span class="hljs-string">"textAlign"</span></span>: <span class="hljs-string"><span class="hljs-string">"center"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"LOVES"</span></span>, <span class="hljs-string"><span class="hljs-string">"textAlign"</span></span>: <span class="hljs-string"><span class="hljs-string">"center"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"CLOUDS"</span></span>, <span class="hljs-string"><span class="hljs-string">"textAlign"</span></span>: <span class="hljs-string"><span class="hljs-string">"center"</span></span> }] } } }, ...  ...</code> </pre> </div></div><br><p>  Thus, we have defined a block of type <em>3_icons</em> with a preview of <em>images / 3_icons.png</em> , a container and six elements.  They already have some basic style setting so that when adding it looks more or less decent.  Ok, then open GIMP (if installed) and open the <em>preview_template.xcf</em> file in it, which lies at the root of the project.  I made this piece in order to rivet the block previews.  Using simple manipulations (Cut \ Paste \ Colorize) from the original image of the template, we get a preview for the future block: </p><br><p><img src="https://habrastorage.org/web/5cd/0f5/c4d/5cd0f5c4d4ae434d9810aeeb0cccb918.png"></p><br><p>  Save it to the <em>src / images</em> folder (or <em>public / images</em> , or better in both places) and refresh the page with the editor.  You will see that a new block has been added to the position where you inserted it into <em>components.json</em> </p><br><div class="spoiler">  <b class="spoiler_title">I have it, for example, stuck after HEADER</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/ea0/530/a94/ea0530a942144bc1a214ece366b08e5e.png"></p></div></div><br><p>  Now create a block template.  Add a new <em>Block3Icons.js</em> file to the <em>src / components / blocks</em> folder: </p><br><div class="spoiler">  <b class="spoiler_title">Block3Icons.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Block3Icons = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ blockOptions, onPropChange }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> alt=<span class="hljs-string"><span class="hljs-string">"cool image"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;table width="450" cellPadding="0" cellSpacing="0" role="presentation" &gt; &lt;tbody&gt; &lt;tr&gt; &lt;td width="150"&gt; &lt;a width="150" href={blockOptions.elements[0].source}&gt; &lt;img alt={alt} width="150" src={blockOptions.elements[0].source} /&gt; &lt;/a&gt; &lt;/td&gt; &lt;td width="150"&gt; &lt;a width="150" href={blockOptions.elements[1].source}&gt; &lt;img alt={alt} width="150" src={blockOptions.elements[1].source} /&gt; &lt;/a&gt; &lt;/td&gt; &lt;td width="150"&gt; &lt;a width="150" href={blockOptions.elements[2].source}&gt; &lt;img alt={alt} width="150" src={blockOptions.elements[2].source} /&gt; &lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td style={blockOptions.elements[3]}&gt;{blockOptions.elements[3].text}&lt;/td&gt; &lt;td style={blockOptions.elements[4]}&gt;{blockOptions.elements[4].text}&lt;/td&gt; &lt;td style={blockOptions.elements[5]}&gt;{blockOptions.elements[5].text}&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;/table&gt; ); }; export default Block3Icons;</code> </pre> </div></div><br><p>  As you can see, the block is the simplest - 2 rows 3 columns.  Of the settings for elements, I have so far made available only the <em>source</em> for image elements and <em>text</em> for text elements, the styles of the container are applied in the <em>BlockList.js</em> file, which I mentioned above in the text. </p><br><p>  It's time to create a block setting.  Add a new <em>Options3Icons.js</em> file in the <em>src / components / options</em> folder: </p><br><div class="spoiler">  <b class="spoiler_title">Options3Icons.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Options3Icons = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ block, language, onFileChange, onPropChange }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> textIndex = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;div&gt; &lt;label&gt;{language[</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Custom style"</span></span></span></span><span class="hljs-function"><span class="hljs-params">]}: &lt;input type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"checkbox"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> checked={block.options.container.customStyle? </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'checked'</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params"> } onChange={(e</span></span></span><span class="hljs-function">) =&gt;</span></span> onPropChange(<span class="hljs-string"><span class="hljs-string">'customStyle'</span></span>, !block.options.container.customStyle, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)} /&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; &lt;hr /</span></span>&gt; &lt;div&gt; &lt;label&gt;{language["Color"]}: &lt;input type="color" value={block.options.container.color} onChange={(e) =&gt; onPropChange('color', e.target.value, true)} /&gt;&lt;/label&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt;{language["Background"]}: &lt;input type="color" value={block.options.container.backgroundColor} onChange={(e) =&gt; onPropChange('backgroundColor', e.target.value, true)} /&gt;&lt;/label&gt; &lt;/div&gt; &lt;hr /&gt; &lt;div&gt; &lt;label&gt; {language["URL"]} &lt;select onChange={e =&gt; imageIndex = +e.target.value}&gt; &lt;option value="0"&gt;{language["URL"]} 1&lt;/option&gt; &lt;option value="1"&gt;{language["URL"]} 2&lt;/option&gt; &lt;option value="2"&gt;{language["URL"]} 3&lt;/option&gt; &lt;/select&gt; &lt;/label&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt; {language["URL"]} {imageIndex + 1}: &lt;label&gt; &lt;input type="file" onChange={(e) =&gt; { onFileChange(block, +imageIndex, e.target.files[0]); }} /&gt; &lt;div&gt;&amp;#8853;&lt;/div&gt; &lt;/label&gt; &lt;input type="text" value={block.options.elements[+imageIndex].source} onChange={(e) =&gt; onPropChange('source', e.target.value, false, +imageIndex)} /&gt; &lt;/label&gt; &lt;/div&gt; &lt;hr /&gt; &lt;div&gt; &lt;label&gt; {language["Text"]} &lt;select onChange={e =&gt; textIndex = +e.target.value}&gt; &lt;option value="3"&gt;{language["Text"]} 1&lt;/option&gt; &lt;option value="4"&gt;{language["Text"]} 2&lt;/option&gt; &lt;option value="5"&gt;{language["Text"]} 3&lt;/option&gt; &lt;/select&gt; &lt;/label&gt; &lt;/div&gt; &lt;div&gt; &lt;label&gt; {language["Text"]} {textIndex - 2} &lt;input type="text" value={block.options.elements[+textIndex].text} onChange={e =&gt; onPropChange('text', e.target.value, false, +textIndex)} /&gt; &lt;/label&gt; &lt;/div&gt; &lt;/div&gt; ); }; export default Options3Icons;</code> </pre> </div></div><br><p>  Fine!  Almost done!  I hope that in what we have already created here, are you orienting at least a little?  In the block, everything is stupid (because it is a <em>dumb component</em> , ie, it is rendered only on the basis of its props).  In the settings, each input element (checkbox, input, etc ...) is associated with a handler, in which <em>onPropChange</em> is <em>called</em> for properties (I also mentioned this above).  Based on these properties, the block is dynamically redrawn.  It's simple.  Let's now apply the results of works and see, finally, whether it all works at all =). </p><br><p>  To do this, add to the <em>src / components / Block.js file the</em> import of a new block and the condition for its return: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//...  import'... import Block3Icons from './blocks/Block3Icons'; //... ... //...  case'... case '3_icons': return &lt;Block3Icons id={block.id} blockOptions={block.options} /&gt;; //...  ...</span></span></code> </pre> <br><p>  Do much the same thing in <em>src / containers / Options.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//...  import'... import Options3Icons from '../components/options/Options3Icons'; //... ... //...  case'... case '3_icons': return &lt;Options3Icons block={block} language={language} onFileChange={onFileChange} onPropChange={onPropChange} /&gt;; //...  ...</span></span></code> </pre> <br><p>  Now we save all the files, and if you previously run <em>npm start</em> in the project root, you should compile everything without errors.  Drag your new block onto the template, select it and play with its settings.  Here is an example of how it looks from me: </p><br><div class="spoiler">  <b class="spoiler_title">Look</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/6dd/efe/520/6ddefe520c7f49b8be2fad710eec2002.png"></p></div></div><br><h2 id="itogo">  Total </h2><br><p>  I tried to make the editor as easy to use as possible and quite comfortable in terms of the interface, and whether it turned out for me or not is of course for you to decide.  In my opinion, the editor turned out with a low entry threshold in terms of implementing and expanding the component base as opposed to <em>Mosaico</em> .  It also has a much more transparent (again as compared to <em>Mosaico</em> ) and less buggy (compared to <em>EmailEditor</em> ) implementation, which is easy to configure, expand, and rewritten to fit your needs literally in hours (less often - days). </p><br><p>  Plans to continue working on the following points: </p><br><ul><li>  styles for responsive template; </li><li>  implementation of Undo \ Redo functionality; </li><li>  make a nice design (I can not, need help ...); </li><li>  isolate TinyMCE in order not to cut it into blocks with text elements; </li><li>  use something like styled-components for the editor interface; </li><li>  update NodeJS server.  I will transfer the locales and other things from files to the database; </li><li>  transfer of blocks and settings from the project to the repository, getting rid of the switch ... case; </li><li>  maybe I'll do something like a preview of the template (but only after responsive); </li><li>  maybe I will do a "Show source code" for a serverless template upload; </li><li>  I will probably do the "phantom block" mentioned in the article; </li><li>  active work with issues and proposals of course =); </li><li>  something else, if I remember, I will add ... yes, and you write </li></ul><br><p>  I will be glad to help, advice, criticism, any feedback.  Based on this, I decide whether to continue to engage in the project =). </p><br><p>  That's all for now ... Thank you for your attention!  In the future I will write only about very large changes, if, of course, the project will be useful to someone. </p><br><h2 id="obeschannye-ssylki">  Promised Links </h2><br><ul><li>  (Good) <a href="https://mosaico.io/">Mosaico on KnockoutJS</a> </li><li>  (Bad) <a href="http://emaileditor.net/">EmailEditor on jQuery</a> </li><li>  (Ugly) <a href="https://github.com/m0sk1t/react_email_editor">My</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/329488/">https://habr.com/ru/post/329488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329476/index.html">Russian Code Cup - in the wake of the qualifying round</a></li>
<li><a href="../329478/index.html">Survival Checklist</a></li>
<li><a href="../329480/index.html">The online store's productivity is sketchy or where to start improving it</a></li>
<li><a href="../329482/index.html">A selection of free veeam tools</a></li>
<li><a href="../329484/index.html">Autopilot on your own: sensor fusion from the phone and open training data</a></li>
<li><a href="../329492/index.html">Industrial mitap # 3: safe process automation is in focus</a></li>
<li><a href="../329494/index.html">About generics in PHP and why we need them</a></li>
<li><a href="../329498/index.html">Autoboxing and unboxing in Java</a></li>
<li><a href="../329500/index.html">How we won the hackathon in New York</a></li>
<li><a href="../329506/index.html">What to do if PK Identity runs out of values?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>