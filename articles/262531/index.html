<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My system for testing and improving the quality of a GSM gateway, part one: functional and circuit level</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The second part of 

 How it all began 
 I work in a small company that develops and produces systems for recording telephone conversations. But in so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My system for testing and improving the quality of a GSM gateway, part one: functional and circuit level</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6b3/e9a/d14/6b3e9ad148694fcdaaba870fb1df3684.png"><br>  <a href="http://habrahabr.ru/post/264045/">The second part of</a> <br><br><h2>  How it all began </h2><br>  I work in a small company that develops and produces systems for recording telephone conversations.  But in some cases, customers need an analog GSM gateway as the source of the telephone line.  Previously, it was purchased and resold.  But what they bought was of poor quality and the marriage often came across - it was decided to develop it themselves.  We have developed together: a circuit designer and I am a programmer, recent graduates without development experience in analog telephony and no implementation experience in production.  It turned out, to put it mildly, not very, although the problem of marriage was solved and rather ‚Äúcontrary to‚Äù. <br><br>  But the problem is that for us, even 1% of the marriage is unacceptable: for each case, those support and developers took a lot of time for the client.  And for all of us this is unacceptable purely for reasons of professional pride.  We wanted to take such a gateway out of production, even though we had a share of each product.  It is very embarrassing when dealers about other products say: ‚ÄúDo you have a marriage at all?‚Äù, And about our ‚Äúwe are afraid to sell them, they will not buy anything from us later‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All this became a royal kick to the complete reworking of the gateway, a detailed study of the quality and development of a testing system.  What I did, and what further and tell you. <br><br><div class="spoiler">  <b class="spoiler_title">How are we from this</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1ac/dde/317/1acdde317af34c15b52105da5f79b2f9.jpg"><br>  <i>From the bottom of the board only the Chinese GSM module</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Come to this</b> <div class="spoiler_text">  Top: <br><br><img src="https://habrastorage.org/files/b20/aa0/465/b20aa04650bf45a494a829bc5e455a2e.jpg"><br><br>  Bottom: <br><br><img src="https://habrastorage.org/files/776/e0c/3db/776e0c3db6c34c98a8a43f9d89506836.jpg"><br></div></div><br>  I'll tell you how the product has completely changed and a system of testing and production support has appeared.  I'll tell you how the functional diagram has changed, explain how the electrical circuit of the modified version works.  And in the following parts I will tell you about the logs and testing algorithms and how the board is tested.  I will give a little source code.  And I will tell about the distributed automated workplace for a firmware, testing and the analysis of logs that was developed on production and at developers. <br><a name="habracut"></a><br><h2>  The first version of the gateway: analysis of errors </h2><br>  Allowed to reduce the number of marriages every ten.  And as a simple gateway, it basically works fine. <br><br>  But due to inexperience, three significant mistakes were made: <br><br>  <b>The first mistake:</b> we produce recording systems and everything is just waiting for them, but they were not in the gateway.  Dealers and customers were disappointed. <br><br>  <b>The second error:</b> ready-made low-quality modules were used, the Chinese GSM module was buggy, and the telephone interface was sensitive to any non-standard use - it burned.  Moreover, non-standard use is not a connection to 220V, but the one to which users and communications workers are accustomed to and is considered the norm.  For example, the connection to the PBX port is not intended for this: when the line source was connected to the source on the PBX. <br><br>  <b>The third mistake: the</b> overall structure is too simple, everything is done right next to it: there are no settings, even the volume and there is no stock for the firmware - it takes 99.9% of free RAM and flash.  Everything is connected directly, and not through the microcontroller.  In fact, it is not possible to refine both programmatically and circuit-wise.  The possibility of updating the firmware is also not. <br><br>  There was no provision for any production testing - just to check that it just works - to call and check that you phoned, there is a sound in both directions and the number is issued.  There was practically no interaction with production, we and they lived separately.  We did not try to collect and sort out what we have developed.  And did not even think how it will do. <br><br>  Three months is a short period of testing, the main stream of complaints was after the first year of sales, some customers who bought the gateway many years ago, are still only now beginning to use it and ask questions. <br><br>  Now many problems have been fixed: the protection was set, and the Chinese have improved the quality of GSM module firmware, but the sediment has remained.  But the settings were both absent and absent, which is very inconvenient for many: the sound in the gateway turned out to be louder and clearer than most Chinese, but for some customers it is too loud.  And what to hide - I‚Äôm on the line - hence the 99% flash usage and it‚Äôs impossible to fix or add anything in this pasta wretchedness. <br><br><h2>  Option Two: Work on the bugs </h2><br>  It was decided to completely redo everything from the organizational level to the functional and microcontroller choice.  It was necessary to make not only the device and its firmware, but also to do production testing and completely think through the interaction with the production from scratch.  Such a system so that you can log all the parameters of the product and the production process.  And so that it was not an empty bureaucracy, but a convenient tool that helps keep everything under control and look for the cause of marriages and failures.  You also need to make such circuitry and firmware so that you can manage all parameters and be able to track any parameter from any gateway, and notice that it began to deviate from the norm of such and such number when you bought such and such a batch of components. <br><br>  <b>We decided to make everything possible on the microcontroller programmatically</b> : the MC should work in a gap, process both the sound and control the telephone line with the GSM module.  Fully implement on MK sound processing and telephone line, and make it so that it can not be burned even plugging in 220 or stun.  The first option was on AVR atmega8512, and it somehow was enough to generate a beep and caller ID.  They decided to do the second option on the ARM-Cortex M3, and later on the ARM-Cortex M4 - it was necessary to implement echo cancellation themselves.  And this is a very difficult computational task of finding a global minimum in a 256-dimensional space in real-time.  In the MK there should be a stock of RAM, flush and boot process, at least 50%.  It must be possible to update the firmware of the client. <br><br>  <b>There were three people in the development team</b> - a new employee was hired.  He was instructed to do the main firmware, immediately agreeing that he takes care of all the work with customer support - so that he does everything at once perfectly.  No ‚Äúat the beginning we will roll out IT, and then we will test on users‚Äù - we have already tested it, did not like it.  And since I had experience with marriage and I knew better circuitry at that time, then I took upon myself the development of a test firmware and a quality system.  This allowed us to make two independent firmware, combat and test firmware, and to look at the circuitry from two independent points of view, comparing what they wanted and what they got in the circuitry.  And also control each other.  I did some of the work on the main firmware, and I checked, as well as taught the beginner, since  he was without work experience he had to learn a lot on his own. <br><br>  <b>It was decided to collect and sort out the first batch of gateways</b> themselves, so that they themselves could see their mistakes in technology.  Production was surveyed and their wishes were taken into account.  Later, I collected not only circuit design fees, but I also made a small batch, while the circuitry engineer was on vacation.  And also they themselves debunked several batches of 10 ... 40 pieces, which made it possible to debug test software and interaction with production. <br><br>  <b>We decided to do it on a four-layer board</b> - this was required by both the MK and GSM module and less analog noise when separate layers are allocated for the ‚Äúground‚Äù and power supply - their resistance is substantially less.  And the GSM module is very noisy - it consumes in pulses of 2 Amperes, the frequency of the pulses as if overwhelming the broadband spectrum for the entire audible range. <br><br>  <b>The GSM module was taken without a Chinese bydlokod inside</b> - an Italian design, but a Chinese one.  Its internal firmware was an order of magnitude more thoughtful and quality.  We chose a model such that the sound was immediately digital, so as not to catch analog interference at the interface between the MK and the module and reduce the number of analog circuits to a minimum. <br><br>  <b>The gateway must be able to verify itself</b> , including the telephone jack and the presence of the telephone.  This will allow to conduct self-diagnostics directly at the client at once considerably simplifying technical support.  In order for him to be able to check himself, he had to add a telephone simulator inside the gateway - so that he could pick up the phone and answer calls.  And also added measuring circuits of key parameters, such as: power supply current, voltage, power supply capacity - for example, to check that the conduits were not swollen. <br><br>  <b>The gateway was convenient to configure:</b> they made a voice menu that pronounces everything: settings, their values, allowable values, how you can change the volume, speed dial, and so on.  For this, Speex sound decode was used. <br><br>  <b>The gateway should be able to record conversations</b> .  Finally, the fact that everyone was waiting for us.  Write to a full-size SD card - the device is large and there is no point in crushing.  Moreover, microSD has more consumption and does not always support SPI.  Records are added to the card in 3 compression options: pcm, a-law, adpcm.  Log entries are also conducted in the html list with the ability to sort (in javascript) by any column. <br><br>  It was: <br><br><img src="https://habrastorage.org/files/934/8d1/b28/9348d1b2884b4f1094fe8c0b977db5f2.jpg"><br><br>  It became: <br><br><img src="https://habrastorage.org/files/309/c06/91e/309c0691e46649b1ad337eb872622805.jpg"><br><br><h2>  Circuitry </h2><br>  We put 0805 resistors with an accuracy of 1% instead of the usual 5% - this will allow us to conduct tests more accurately and get more information.  This is necessary, for example, in order to see a small tantalum capacitor in 330 microfarads, against the background of very large electrolytes connected in parallel in the range of 5,000 - 10,000 microfarads, and they filter different frequency ranges of sound.  Similarly, capacitors 0805 with an accuracy of 10%.  More accurate components allow you to avoid adjusting the firmware settings.  At the same time, the difference in cost when switching to more accurate components against the background of the total cost is scanty. <br><br><div class="spoiler">  <b class="spoiler_title">Simplified electrical circuit</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c99/213/f57/c99213f5797b442e92e67071ba90baaa.png"><br>  <i>Sorry for the hand-made, but there is no strength to fight with the new office</i> <br></div></div><br><br><h3>  Supply system </h3><br>  The gateway is powered by a purchased 12 volt 1A stabilized power supply from 220V. <br><br><div class="spoiler">  <b class="spoiler_title">Whole Food Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/fd6/bc7/229/fd6bc72292f24db1a0b9c2d65cae049c.jpg"><br></div></div><br><img src="https://habrastorage.org/files/8c4/7a5/a80/8c47a5a80f3e44dc96ef028a98a71dae.jpg"><br><br>  Immediately after the power connector is the power protection circuit, protection against reverse polarity - the usual schock diode.  Current fuse in 1A.  And an overvoltage suppressor with a 15V threshold.  Next comes the supply voltage measurement circuit with a 1: 6 divider on the resistors.  They will check the power supply, the load given by turning on and off all consumers (about 0.7A). <br><br>  After the protection and measurement scheme, the power is divided into three branches: GSM, telephone line, digital-analog power. <br>  For all three we use the pulse stabilizer chip MC34063A.  She knows how to raise and lower the voltage.  Also has current and temperature protection.  Voltage and current can be set by resistors.  Its advantages in price and ease of use, and also in efficiency, it stabilizes better with greater efficiency than linear stabilizers - it heats up less.  But it makes noise and after it it is necessary to put filters. <br><br><img src="https://habrastorage.org/files/9f0/fb3/48b/9f0fb348bfe047628525b478c2126d1c.jpg"><br><br>  For convenience of power debugging, checkpoints and solder jumpers are installed on all branches, which connect the load to the power supply.  Assembly is made without jumpers.  The installer immediately connects to the power supply and checks all the power lines at the control points.  Only after the voltage has been checked, the jumpers are sealed.  And then the test firmware is already running out. <br><br><h5>  <b>GSM power branch</b> </h5><br><img src="https://habrastorage.org/files/d6c/a57/ee1/d6ca57ee17184882ad5c94bac492f317.jpg"><br><br>  For a reliable reset of the GSM module, you must be able to control the GSM power supply - for this, at the very beginning of the branch there is a key on the field effect transistor.  Next, a stabilizer of 3.75 V and 0.5 A. The GSM module consumes 500 microns in pulses during operation.  sec x 2A, and this is very much and it is they who usually lead to sound pickup and therefore they need to be filtered out.  For this purpose, electrolytic capacitors with low internal resistance are supplied, 4 pcs to reduce it even more.  And there are tantalum and ceramic capacitors - they all filter at higher and higher frequencies.  A stabilizer also contributes to filtering - it limits consumption pulses from 2 A to 0.5 A, does not allow taking all 2A from the power supply, these pulses are taken from the capacitors, thus reducing the effect on other power lines. <br><br>  Next comes the power testing circuit - a power sensor and a test load of 2.15 Ohms, controlled from the MC via a field device, using it you can measure all the main power parameters: voltage, current, load resistance. <br><br><h5>  <b>A branch of digital and analog power</b> </h5><br><img src="https://habrastorage.org/files/991/ba8/52d/991ba852dea64a4da7cc17fe25cae3e4.jpg"><br>  The food is divided into two sub-branches: <br><ul><li>  Analogue power for op-amp output and reception of sound from the line, and for the DAC and ADC in the MC. </li><li>  Digital power for the MK and SD card, they also consume pulses, especially when recording sector on the SD card. </li></ul><br>  If you do not separate the analogue from the digit, then the client will hear the conversation when the SD card works and wakes up / falls asleep to the MC.  The power is stabilized in two stages, at the beginning it is lowered by a puller with good efficiency up to 5V, but it is noisy, therefore it is further stabilized to 3.3 by two quiet linear stabilizers.  And if you immediately put two linear, then they will be very hot because  9B will fall on them.  Also, each sub-branch has voltage meter circuits on 1: 2 dividers. <br><br><h5>  <b>Power line power supply</b> </h5><br>  The telephone line is a 48V / 60V voltage source with an internal resistance of about 700 ohms. <br><br>  During the call, the voltage should be 60 V and change the polarity 20-30 times per second, the rest of the time 48 V with constant polarity. <br>  The rise of the tube is detected by the fact that the phone loads the source and, due to the internal resistance of 700 Ohms at the connector, the voltage drops to about 10 V, at a current of about 30-40 mA. <br><br>  But power = power_current * voltage, and when the tube is lifted, the internal resistance drops 38V at 40mA.  And this is a lot of heat.  So much so that the gateway would have to do the size of an A4 sheet.  It is expensive and inconvenient for customers.  Therefore, we acted slyly: we made it so that when the tube was lifted, the source ceased to stabilize the voltage, and began to stabilize the current.  The current remains the same, and the voltage is already 2 times less than the voltage.  Less heat. <br><br>  But here a problem arises - when the current is limited, the stabilizer no longer stabilizes the voltage, and all voltage disturbances directly pass through it.  But the sound is given in the telephone line by modulation of 1V of the telephone voltage of 48V or 10V if the handset is lifted, i.e.  interference is amplified from 10 to 50 times. <br><br><img src="https://habrastorage.org/files/766/ec6/d28/766ec6d28dfb48ef909eec34c6ff9eec.jpg"><br><br>  To solve this problem, at the very beginning we put the LM1117 linear stabilizer on 10V.  And then after it is a pulse stabilizer MC34063A, which stabilizes either the voltage or the current if the tube is lifted using an already stable power supply.  In order for the stabilizer to increase both to 48V and to 60V, a variable was made in the feedback circuit: the connection of the MK leg is indicated by a red arrow, with which it shunts the resistors in the feedback (connecting to the ground), and the stabilized voltage rises to bell , the rest of the time there is Z standing.  But the impulse is noisy, so the next is a first-order P-filter on an RC circuit of 5¬µF and 4x51 Ohms.  As well as an E1SD diode, the purpose of which is to protect against currents flowing into the circuit (for example, when connecting 220V or other interference). <br><br><h3>  Telephone line source </h3><br><div class="spoiler">  <b class="spoiler_title">Whole scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/30e/655/544/30e6555440cb4033bdd9cbcbd303ffaf.jpg"><br></div></div><br>  On the left there is a telephone jack, to the right is protection in the form of a 85V suppressor and a pair of self-resetting fuses for 80mA, in parallel with them a spark gap is connected in the form of two bare pads. <br><br><div class="spoiler">  <b class="spoiler_title">It looks like this</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/cb5/34a/4bc/cb534a4bc81c48ebb4366640054d06ca.png"></div></div><br>  This protection well protects the power supply from 220V and from spark interference during a thunderstorm.  But its speed is not high enough and quick splashes can pass through to the sound, therefore, to protect against them, all the output and reception op-amp inputs are protected by additional Schottky pair diodes BAT54S that protect against voltage above the power supply and below the ground. <br><br><img src="https://habrastorage.org/files/7cc/29a/bcb/7cc29abcbca24ce5ac972a2cf50246fa.jpg"><br><br>  This is a test tube lifting circuit, with the help of its gateway it can check itself and pick up the tube itself.  The load is selected at 1kOhm because it is convenient - a 1V drop is 1mA of current. <br><br>  The line of receiving sound from the line: <br><br><img src="https://habrastorage.org/files/17f/5aa/f95/17f5aaf95a2b4823a0a1b08b0a368807.jpg"><br><br>  Made at the OS in differential switching - in such switching on, the own noise relative to the telephone line is subtracted and not heard.  Only the difference between the contacts in the telephone jack is heard.  To receive only the sound at the input are capacitors, a few pieces because  they are 50V, and the sound can have a larger swing (when calling).  The output of the shelter is an RC low-frequency filter. <br><br>  The line of sound in line: <br><br><img src="https://habrastorage.org/files/b0d/190/72e/b0d19072ed7a41ad827a6f430bf80881.jpg"><br><br>  Sound must be supplied to the telephone line with current, therefore, a current source is assembled at the OS.  At the input of the op-amp is an RC low-pass filter.  OU itself on three resistors 27 ohm maintains the voltage the same as at the input after the RC filter, thereby setting the current. <br>  OU feedback is protected. <br><br>  By issuing a sound to the line, you can check and receive the sound from the line by issuing and listening to the result, which is used in the test firmware.  It also checks the frequency response. <br><br><div class="spoiler">  <b class="spoiler_title">AFC of the real gateway and its description</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/922/908/9fa/9229089fa11f47e7ab2363702695ec56.png"><br>  By X - Hertz, by Y - decibels. <br>  At the lower frequencies there is a decrease due to input conders that separate the sound from the constant component. <br>  On medium and high decay due to RC-filters on the output and reception of sound from the line - the RC-parameters of filters are measured by this decay. <br></div></div><br>  Polarity reversal pattern: <br><br><img src="https://habrastorage.org/files/377/73c/da6/37773cda619940aab1c72000cb15392c.jpg"><br><br>  Conventional H-bridge allows you to change the polarity of the telephone line.  Made from complementary pairs of transistors. <br><br>  Diagram of telephone line internal resistance: <br><br><img src="https://habrastorage.org/files/827/07d/5a4/82707d5a4c31487c9d7ac221bc446130.jpg"><img src="https://habrastorage.org/files/f57/b0f/0dd/f57b0f0dd95a4436a111755c1497f788.png"><br><br>  Made on large resistors, they can not be burned - the tracks burn more quickly, they have large parasitic inductances and resistances - they filter noise well.  They also dissipate heat well.  And paired with an RC filter on a 0.33 conductor and 51 ohm resistors, they filter the sound well from interferences, including noise from a booster. <br><br>  Behind these huge resistors, the rest of the circuit is like a stone wall.  The rest of the telephone line source implementations that I saw were made without such resistors and were burning because of this.  Including our first version of the gateway. <br><br><h3>  USB bridge layout </h3><br><img src="https://habrastorage.org/files/1b0/fef/834/1b0fef8349464d5c899e8388d82da407.jpg"><br><br>  Chip CP2103 is used.  It is used both for communication and for flashing or resetting. <br><br>  It is convenient because in addition to the RS232 handshake lines, there are GPIO - input / output legs.  The problem is that when connected to a PC, the OS starts pulling acknowledgment lines, and the GPIO does not touch it, and if the MC reset buttons are connected to them, the gateway will be reset and the conversation will be interrupted.  Therefore, resetting and switching to the integrated bootloader mode is connected to the GPIO.  And with the help of only this bridge, the gateway is flashed both at the production site and at the customers if it is necessary to update the firmware. <br><br><h3>  GSM module circuit </h3><br><div class="spoiler">  <b class="spoiler_title">Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/8a3/9c1/f8f/8a39c1f8f55741f2a04dfecc5db68869.jpg"><br></div></div><br>  Used 2.5G dual-band Telit 868 dual module.  Those.  It will work only in the CIS countries.  The SIM card holder is a regular tray. <br><br>  Digital DVI sound (renamed I2S). <br><br><h3>  Microcontroller circuit </h3><br><div class="spoiler">  <b class="spoiler_title">Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/129/9a4/dec/1299a4dec19048939bb3868879f0b7f5.jpg"><br></div></div><br>  Used micron STM32F405RG with <br>  168k of RAM and 1024k Flush, is used by 50%. <br>  160 MHz clock frequency is used at 3/4, the main consumers are speex decode and echo cancellation <br>  MK has a temperature sensor - it is convenient to monitor the device self-heating. <br>  Also in MK there is an internal reference voltage, they can measure the reference voltage of the ADC and the supply voltage - in this way, the mic can check itself and its power supply.  And thus make sure that he measures everything else correctly. <br>  Provides power from a lithium battery - tablets for storing dates and times.  Is able to request them from the GSM network. <br>  Status indication on four red-green LEDs. <br><br><h3>  SD card </h3><br><div class="spoiler">  <b class="spoiler_title">Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c27/c64/d3c/c27c64d3c54740418ce0597fe19db07c.jpg"><br></div></div><br>  On the left you can see the on and off key, after it there are capacitors including tantalum at 330 microfarad, without it the SD card will be unstable, because  when writing and erasing large blocks of data, it can consume a lot of current per pulse. <br><br>  Further, the key is for testing the power supply by connecting a test load, as well as a supply voltage meter on the 1: 2 divider on the resistors.  The key for testing is also important in the main firmware - they can discharge the power to zero volts, if this is not done, the SD card starts to be very buggy with the next power up. <br><br>  Bottom visible dual diodes protect the SD card during a hot connection. <br>  On the right of the diagram is a card holder with push-pull mechanics - inserted-snapped in, pressed-snapped-out. <br><br>  On this with all circuitry. <br>  The board of both options was divorced in the program TOPOR. <br><br>  Continued in the next two articles.  In the second, I will tell you about the test firmware, how it works, which measuring complex with a frequency analyzer, etc.  I did in this firmware.  In the third I will tell about the distributed automated workplace, about my server, about the loader and about the interaction with the production. <br><br>  Thank you so much for your time.  I hope it was not boring. </div><p>Source: <a href="https://habr.com/ru/post/262531/">https://habr.com/ru/post/262531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262521/index.html">Arduino -> FLProg -> RS-485 -> Modbus</a></li>
<li><a href="../262523/index.html">Visual Studio Code - code editor for Linux, OS X and Windows</a></li>
<li><a href="../262525/index.html">How we ensured communication at the summits of the SCO and BRICS</a></li>
<li><a href="../262527/index.html">How to make Jenkins make your life easier and become happy</a></li>
<li><a href="../262529/index.html">Experience of development and design on AngularJS</a></li>
<li><a href="../262533/index.html">Slightly more adaptive site on 1C-Bitrix, analogue of visibility classes from bootstrap</a></li>
<li><a href="../262535/index.html">Vulnerabilities of security systems of the Ministry of Defense, FSB, FSIN, NPP, metro and federal highways</a></li>
<li><a href="../262539/index.html">How bot-to-bot can replace APIs in the near future</a></li>
<li><a href="../262541/index.html">Effective work with SQLite on the example of ICQ</a></li>
<li><a href="../262543/index.html">How to solve the entrance exam to the Yandex Data Analysis School</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>