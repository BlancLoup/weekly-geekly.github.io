<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up backup in Ubuntu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setting up backup in Ubuntu for 20 minutes. 
 To work on projects using svn, which is located on a remote virtual dedicated host running ubuntu 8.04. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up backup in Ubuntu</h1><div class="post__text post__text-html js-mediator-article"><h1>  Setting up backup in Ubuntu for 20 minutes. </h1><br>  To work on projects using svn, which is located on a remote virtual dedicated host running ubuntu 8.04.  Over time, data volumes grew, as did the criticality of these data.  The loss of something dreamed in nightmares.  From time to time I copied the repositories to the local computer.  Recently I got tired of it.  And I began to look for opportunities to automate this matter.  I will not talk about the search and options, talk about the results. <br><br>  So, we have a remote host running ubuntu, with some array of rather critical data.  It would be quite logical to set up a backup directly on the remote host, using tar for krone, rsyns, etc.  But, since  space on a virtual dedicated hosting is quite expensive and it is better to use it in the case, it would be ideal if the data were automatically copied to some local machine, where there is more than enough space on it.  In my case, this is a file service in the office, running all the same Ubuntu. <br><br><a name="habracut"></a><br><h2>  Training </h2><br>  The data will be poured using SSH, so let's first configure the public and private keys for local and remote servers.  We do this so that the program that will transfer the data can go over SSH without a password. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>$ ssh-keygen -t dsa</code> <br> <br>  Leave the default folder and make the password blank. <br>  This command should create two files in the ~ / .ssh folder (by default) - private and public key.  private is for the local machine, pub is sent to the remote. <br><br>  Now copy the private key to the /root/.ssh folder so that the root user can use it so <br><br> <code>$ cd ~/.ssh <br> $ sudo mkdir /root/.ssh <br> $ sudo cp id_dsa /root/.ssh</code> <br> <br>  Now we need to copy the public key to the remote machine from which we want to copy data.  Pre-create a backup user on a remote machine (adduser command).  Remember to give this user permissions to read the directories you want to copy. <br><br> <code>$ cat ~/.ssh/id_dsa.pub | ssh backup@remotehost.ru "cat &gt;&gt; ~/.ssh/authorized_keys2"</code> <br> <br>  Now we can try to log in via ssh to the remote machine: <br><br> <code>$ ssh backup@remotehost.ru</code> <br> <br>  In case everything is done correctly, we will be let in without a password. <br>  On the remote machine we set the normal rights to read the public key: <br><br> <code>remotehostru$ chmod 700 .ssh <br> remotehostru$ chmod 400 .ssh/authorized_keys2 <br> remotehostru$ exit</code> <br> <br><h2>  Rsnapshot setup </h2><br>  rsnapshot is a utility for creating copies of the state of rsync-based file systems.  It simplifies the creation of periodic copies from local and remote machines via ssh.  It uses, whenever possible, rigid communications that allows to reduce essentially the volume of necessary disk space.  (quote <a href="http://citkit.ru/package/rsnapshot/">from here</a> ) <br><br><h4>  Installation </h4><br>  Install rsnapshot: <br><br> <code>$ sudo apt-get install rsnapshot</code> <br> <br>  If you are using a non-debian-like distribution, rsnapshot must also be in your distribution's repositories.  For CentOS, with RPMForge enabled, this is done, for example, as follows: <br><br> <code># yum install rsnapshot</code> <br> <br>  Now we need to create a directory where we are going to store our ‚Äúsnapshots‚Äù: <br><br> <code>$ sudo mkdir /var/snapshots</code> <br> <br><h4>  Customization </h4><br>  Now you can proceed to the setting, in fact, rsnapshot: <br><br> <code>$ sudo nano /etc/rsnapshot.conf</code> <br> <br>  Instead of nano, you can use any other editor, such as vi, or gedit, if you are working in GNOME. <br>  You need to configure the following parameters: <br><br> <code>snapshot_root - ,      "". <br> <br> interval xxx yy -  -  ( hourly, daily), yy -    . : <br> interval hourly 6 <br> interval daily 7</code> <br> <br>  Means that we want to keep 6 hourly copies and 7 monthly copies.  If the specified number of copies is already available, rsnapshot will replace the old one with a newer one. <br><br>  Uncomment cmd_cp.  cmd_ssh uncomment and change to <br><br> <code>cmd_ssh /usr/bin/ssh</code> <br> <br>  Backup can be set up using the backup command &lt;where&gt; &lt;where&gt;: <br><br> <code>#  /etc/      localhost/ <br> backup /etc/ local/ <br> #  /var/svn      remotehost/ <br> backup backup@remotehost.ru:/var/svn/ remotehost/ <br></code> <br><br>  <b>Remember that spaces are not allowed in the configuration file - use only tabs.</b> <br><br><h4>  Trial run </h4><br>  Run rsnapshot: <br> <code>$ rsnapshot hourly</code> <br> <br>  The second parameter indicates the interval that we set in the configuration file. <br>  The command can be performed for a long time.  After execution, we look at what she created: <br> <code>$ ls -l /var/snapshots</code> <br> <br>  So far there should be one directory in the directory: hourly.0.  The next time rsnapshot starts, it will create directories hourly.1, hourly.2, etc., until it hits the maximum that we specified in the configuration file. <br><br><h4>  Cron setup </h4><br>  Ubuntu automatically creates the /etc/cron.d/rsnapshot file with the following contents: <br> <code>0 */4 * * * root /usr/bin/rsnapshot hourly <br> 30 3 * * * root /usr/bin/rsnapshot daily <br> 0 3 * * 1 root /usr/bin/rsnapshot weekly <br> 30 2 1 * * root /usr/bin/rsnapshot monthly</code> <br> <br>  That's all.  Now you should automatically create a snapshot of data from your remote server 6 times a day.  The data is safe, and yes even geographically distributed. <br><br>  By the way, 6 times a day does not mean that the size will be 6 times larger than if you copy only 1 time per day.  If there are no changes in the files between copies, the total size of the copies will hardly change. <br><br><h4>  Additional Information </h4><br>  With the backup_script option, you can also configure the backup of MySQL databases, and indeed everything, anything.  I did not describe this process, because  I do not use it and I can not say anything concrete. <br>  You can read more in Google.  At the request of rsnapshot gets a bunch of relevant links, though in English. <br><br>  I ask you not to scold too much, I don‚Äôt look like an administration guru (and linux), but for a long time I was looking for how easy it was to automate backups - I found a way, I decided to share. <br>  But constructive criticism and suggestions will, of course, be pleased. <br>  <b>UPD: <a href="http://kolger.ru/2008/12/ubuntu-backup-with-rsnapshot/">The same article in my blog</a></b> </div><p>Source: <a href="https://habr.com/ru/post/45912/">https://habr.com/ru/post/45912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45902/index.html">Think differently!</a></li>
<li><a href="../45903/index.html">Futuristic LED Watch</a></li>
<li><a href="../45907/index.html">Whom ‚ÄúOdnoklassniki‚Äù scared ‚ÄúGoogle‚Äù?</a></li>
<li><a href="../45910/index.html">PHP, PREG and UTF-8</a></li>
<li><a href="../45911/index.html">Twiddler2</a></li>
<li><a href="../45913/index.html">Live cook book: our culinary and software hobby</a></li>
<li><a href="../45914/index.html">Using third-party brands in a startup</a></li>
<li><a href="../45919/index.html">Monty Hall's paradox: is there any difference?</a></li>
<li><a href="../45921/index.html">Home server - AMD, Debian x64, Bind9, Apache 2, PHP5, MySQL5, Trac, Subversion and a lot of fun</a></li>
<li><a href="../45924/index.html">kawaii phone for motorola</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>