<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>API RingCloud, everything is just beginning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. Earlier RingCloud announced the launch of the REST API, which will allow our product to integrate with various CRM systems. And although its...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>API RingCloud, everything is just beginning</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/282/54e/361/28254e361465469591b7eb1be8192a51.jpg" alt="image"><br><br>  Good day.  Earlier <a href="http://ringcloud.ru/">RingCloud</a> <a href="http://megamozg.ru/company/ringcloud/blog/14380/">announced the</a> launch of the REST API, which will allow our product to integrate with various CRM systems.  And although its development is still ongoing, we are pleased to present to you the first version.  Under the cat, we consider the general architecture of this service, its principle of operation, as well as analyze usage examples. <br><a name="habracut"></a><br>  When we were just planning our service, we set goals to make it as convenient as possible for integration, and such tasks cannot be solved without a decent API.  Therefore, it was decided to give this service as much attention as possible, having built it as reliable and convenient as possible. <br><br><h2>  API key management </h2><br>  To use the API, you need a unique <i>API Key</i> and password to it, for this we go to your personal account and in the corresponding <a href="https://online.ringcloud.ru/">section</a> create a key 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/ecd/936/605/ecd9366059f64696adb91e60409fe3ff.PNG" alt="image"><br><br>  The key is generated automatically, it consists of a prefix with your account number and the key's body itself, in order to copy the key you just need to click on the line with the key.  The password is also automatically generated and to change it, if it seems too simple to you, you need to click on the icon on the right.  For each key, you must specify the access rights, this is done to delimit the privileges between your applications.  Access levels operate on the ‚ÄúRO / RW‚Äù principle and allow differentiation of permitted actions. <br><br>  Description of the RingCloud API functions currently available can be found on <a href="https://api.ringcloud.ru/docs/">the documentation page.</a> <br><br><h2>  Architecture </h2><br>  This service is based on the cluster principle, with load balancing between the nodes processing the requests.  Since the service uses HTTPS, it was decided to shift this task to the balancer.  The nodes, having processed the requests, turn to the system kernel that includes the VoIP server, database, and Redis-based cache. <br>  I must say that <a href="http://redis.io/">Redis</a> is very widely used in all RingCloud nodes, we are very pleased with it in terms of convenience and speed. <br><br>  As a balancer and WEB interface servers, we use <a href="http://nginx.org/">Nginx</a> because it completely suits us in terms of functionality and performance, the balancing functionality is perfectly implemented on it, it works fine with HTTPS, it has a very convenient configuration. <br><br><img src="https://habrastorage.org/files/d60/9db/ebb/d609dbebb7e047bf9c5c1c9b4202877c.png" alt="image"><br><br><h2>  Examples of using </h2><br>  We develop our API based on the <a href="https://ru.wikipedia.org/wiki/REST">REST</a> methodology to make it as easy to use as possible. <br>  Let's look at the principle of forming the request.  All API URLs are: <br><pre><code class="bash hljs">https://api.ringcloud.ru/&lt;&lt;url&gt;&gt;?api_key=API_KEY&amp;<span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>=HASH</code> </pre> <br>  here: <br><ul><li>  <b>url</b> - the address corresponding to the called API function </li><li>  <b>api_key</b> - API key </li><li>  <b>hash</b> - hash - calculated as md5 from the API key and password </li></ul><br>  In case of successful execution of any request (with the exception of downloading the call record file - in this case the file itself will be returned) the response from the server looks like: <br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"success"</span></span>, <span class="hljs-string"><span class="hljs-string">"message"</span></span>: null, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: <span class="hljs-string"><span class="hljs-string">"some_data"</span></span>}</code> </pre><br>  In case of an error (except for an error when loading the conversation recording file - in this case, an empty string will be returned) the response from the server is: <br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-string"><span class="hljs-string">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"some_error"</span></span>, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: null}</code> </pre><br><br>  Each response from the server contains an HTTP status code.  The table below lists the most frequently used ones. <br><br>  <b>Commonly used status codes</b> <br><table><tbody><tr><th>  HTTP status code </th><th>  Description </th></tr><tr><td>  200 </td><td>  Function completed successfully </td></tr><tr><td>  400 </td><td>  Incorrectly passed parameters.  For example, when updating data, a non-existent user was specified. </td></tr><tr><td>  403 </td><td>  API key or hash is not specified, API key does not exist or hash is calculated incorrectly. </td></tr><tr><td>  404 </td><td>  Requested url or file not found </td></tr><tr><td>  405 </td><td>  The method is not supported - instead of GET a POST request is used or vice versa. </td></tr><tr><td>  429 </td><td>  Too many requests - the limit on the frequency of requests to the API has been reached. </td></tr><tr><td>  500 </td><td>  Internal error.  Ideally, should never return. </td></tr></tbody></table><br><br>  Currently, it is possible to work with two objects (resources in REST terminology): ‚ÄúUsers‚Äù and ‚ÄúChallenges‚Äù.  With the first you can create users, get information about them and change their data.  The second object is designed to work with calls.  With it, you can make a call, as well as get information about active and perfect calls.  Further, there are certain restrictions on the frequency of calls to our API.  Let's explain the model we use.  First, restrictions are counted separately for each key.  Secondly, within the framework of a single key there are restrictions on the same type of requests, i.e.  requests with completely identical URLs.  For example, if you have only one API key, and you send two requests for changing the extension number from the same user per minute, then only the first request will be successfully processed.  But to change the internal numbers for two different users is quite possible. <br><br>  <b>Functions of the object "Users" and time constraints</b> <br><table><tbody><tr><th>  Title </th><th>  Url </th><th>  Restriction </th></tr><tr><td>  Getting a list of account users </td><td><pre> <code class="bash hljs">/v1/users</code> </pre></td><td>  1 request per second </td></tr><tr><td>  Getting information for a specific user </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;</code> </pre></td><td>  1 request per second </td></tr><tr><td>  change Password </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;/update_password</code> </pre></td><td>  1 request per second </td></tr><tr><td>  Internal number change </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;/update_extension_number</code> </pre></td><td>  1 request in 5 seconds </td></tr><tr><td>  Change email </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;/update_email</code> </pre></td><td>  1 request in 5 seconds </td></tr><tr><td>  Enable Voice Box </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;/voice_mail_box_on</code> </pre></td><td>  1 request in 5 seconds </td></tr><tr><td>  Turning off the voice box </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;/voice_mail_box_off</code> </pre></td><td>  1 request in 5 seconds </td></tr><tr><td>  Create user </td><td><pre> <code class="bash hljs">/v1/users/create</code> </pre></td><td>  1 request in 60 seconds </td></tr><tr><td>  Getting the list of records </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;/records</code> </pre></td><td>  1 request in 5 seconds </td></tr><tr><td>  download conversation recording </td><td><pre> <code class="bash hljs">/v1/users/&lt;username&gt;/records/&lt;filename&gt;</code> </pre></td><td>  1 request per second </td></tr></tbody></table><br><br>  <b>Functions of the ‚ÄúChallenges‚Äù object and time constraints</b> <br><br><table><tbody><tr><th>  Title </th><th>  Url </th><th>  Restriction </th></tr><tr><td>  Getting a list of channels for context </td><td><pre> <code class="bash hljs">/v1/calls/channels</code> </pre></td><td>  1 request in 2 seconds </td></tr><tr><td>  Getting information on the channel </td><td><pre> <code class="bash hljs">/v1/calls/channels/&lt;channel&gt;</code> </pre></td><td>  1 request in 2 seconds </td></tr><tr><td>  Call origin </td><td><pre> <code class="bash hljs">/v1/calls</code> </pre></td><td>  1 request in 5 seconds </td></tr><tr><td>  Getting a list of calls made </td><td><pre> <code class="bash hljs">/v1/calls/complite</code> </pre></td><td>  1 request in 5 seconds </td></tr><tr><td>  Get a list of current calls </td><td><pre> <code class="bash hljs">/v1/calls/active</code> </pre></td><td>  1 request in 5 seconds </td></tr></tbody></table><br><br>  <b>How call origination works</b> <br><br>  In order to make a call you will need an employee who has connected via SIP to the RingCloud server using a ‚Äúsoftphone‚Äù or a stationary SIP phone, and we will call the number.  When sending a request to the API, the system first calls the employee (let's call his subscriber A), and then, only when the employee answers, dials the number to which we plan to make a call, so we originate the call between subscriber A and subscriber B <br><img src="https://habrastorage.org/files/449/486/968/44948696827d4def97ec301678a08dda.jpg" alt="image"><br><br>  Consider a small example of a Python call to our API.  Here's how to call from the internal number assigned to the employee with the name 1679728441 to the number 7910123456: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#         import requests import hashlib import json #       ,       RingCloud API api_key = 'YOUR_API_KEY' password = 'YOUR_PASS' hash = hashlib.md5(api_key+password).hexdigest() payload = { 'user': '1679728441', 'num': '7910123456' } data = {'params': payload} #   r = requests.post("https://api.ringcloud.ru/v1/calls?api_key=%s&amp;hash=%s" % (api_key, hash), data=json.dumps(data)) print r.text</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">And the same thing in PHP:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $apiKey = <span class="hljs-string"><span class="hljs-string">'YOUR_API_KEY'</span></span>; $password = <span class="hljs-string"><span class="hljs-string">'YOUR_PASS'</span></span>; $hash = md5($apiKey . $password); $apiUrl = <span class="hljs-string"><span class="hljs-string">'https://api.ringcloud.ru/v1/calls?api_key='</span></span> . $apiKey . <span class="hljs-string"><span class="hljs-string">'&amp;hash='</span></span> . $hash; $callData = [ <span class="hljs-string"><span class="hljs-string">'params'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'num'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'7910123456'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1679728441'</span></span> ] ]; $ch = curl_init($apiUrl); curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_POST, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($callData)); $result = curl_exec($ch); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $result; <span class="hljs-comment"><span class="hljs-comment">/* { "status": "success", "message": null, "data": "Originate successfully queued" } */</span></span> <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br></div></div><br><br>  Also, in parallel with the RingCloud API development project, we are developing libraries that allow us to start using it as quickly as possible in our applications and services.  While only the first version of the PHP library is ready it is <a href="https://bitbucket.org/ringcloud/ringcloud_phapi">here.</a> <br><br>  Well, it seems that everything we wanted to share with you.  The current version of the documentation on our API can be found <a href="http://api.ringcloud.ru/docs">here</a> .  In the near future - creating a <a href="https://bitbucket.org/ringcloud/ringcloud_pyapi/overview">complete package</a> for Python to work with our API and, of course, expanding the functionality.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/258311/">https://habr.com/ru/post/258311/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258297/index.html">Commercial site security research</a></li>
<li><a href="../258301/index.html">50+ Best Bootstrap Add-ons</a></li>
<li><a href="../258303/index.html">Running load tests made with JMeter using StormRunner Load</a></li>
<li><a href="../258305/index.html">Kerio Connect 8.5 improves collaboration, security and increases usability of mobile devices.</a></li>
<li><a href="../258309/index.html">VeeamON Forum Mos√≥w</a></li>
<li><a href="../258313/index.html">Using media queries in the layout of email-letters: the pros and cons</a></li>
<li><a href="../258317/index.html">Habr, let's fix the letters?</a></li>
<li><a href="../258319/index.html">Engineer who neglects records careless</a></li>
<li><a href="../258321/index.html">Win32 / Spy.Bebloh banking trojan is used to steal online banking data</a></li>
<li><a href="../258323/index.html">How to stop worrying about backing up, or Oracle Zero Data Loss Recovery Appliance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>