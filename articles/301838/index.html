<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reversing the Android client of the music service Zaycev.net and implementing api on go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Strictly speaking, this article can be attributed to reversing only with a stretch. 


 You all know a service like zaycev.net. I‚Äôm not mistaken, assu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reversing the Android client of the music service Zaycev.net and implementing api on go</h1><div class="post__text post__text-html js-mediator-article"><p>  Strictly speaking, this article can be attributed to reversing only with a stretch. </p><br><p>  You all know a service like zaycev.net.  I‚Äôm not mistaken, assuming that everyone at least once downloaded music from him, either through a web interface or through a mobile application. </p><br><p>  <font color="red"><b>At the request of the representatives of the service, I replaced the constant in the publication, if you wish, you can request them.</b></font> <br></p><br><p>  If you are still interested, welcome under cat. </p><a name="habracut"></a><br><h1>  Part one.  Debriefing </h1><br><p>  One day, one of my good friends asked me to figure out how their official Android client works.  After downloading the client, I began to study and uploaded the test subject to Jadx (Dex to Java decompiler).  All links at the end of the article. </p><br><p>  The first thing that catches your eye is the presence of obfuscation: </p><br><img src="https://habrastorage.org/files/7c1/e3b/de5/7c1e3bde59364e23bcd9e4dfc96ceee7.png"><br><p>  Well, never mind, we will break through, not for the first time.  A quick inspection showed that the functionality we need is concentrated in the package: </p><br><blockquote>  package free.zaycev.net.api; </blockquote><br><div class="spoiler">  <b class="spoiler_title">Original Authorization Code:</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String str; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Looper.myLooper() == Looper.getMainLooper()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalThreadStateException(<span class="hljs-string"><span class="hljs-string">"Method must run in not main thread!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ae.b(ZaycevApp.ay())) { String str2 = <span class="hljs-string"><span class="hljs-string">""</span></span>; str2 = <span class="hljs-string"><span class="hljs-string">""</span></span>; str2 = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { str = (String) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(ga(<span class="hljs-string"><span class="hljs-string">"https://api.zaycev.net/external/hello"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)).get(<span class="hljs-string"><span class="hljs-string">"token"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ZaycevApp.W().equals(<span class="hljs-string"><span class="hljs-string">"4pda"</span></span>)) { str2 = str + <span class="hljs-string"><span class="hljs-string">"kmskoNdkYHDnl3ol3"</span></span>; aa(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { str2 = str + <span class="hljs-string"><span class="hljs-string">"kmskoNdkYHDnl3ol3"</span></span>; } ha(<span class="hljs-string"><span class="hljs-string">"ZAuth"</span></span>, <span class="hljs-string"><span class="hljs-string">"token - "</span></span> + str2); str2 = a(str2); str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(ga(String.format(<span class="hljs-string"><span class="hljs-string">"https://api.zaycev.net/external/auth?code=%s&amp;hash=%s"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[]{str, str2}), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)).getString(<span class="hljs-string"><span class="hljs-string">"token"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ae.b((CharSequence) str)) { ZaycevApp.ae(str); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { } str = <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { str = ZaycevApp.ay(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { MessageDigest instance = MessageDigest.getInstance(<span class="hljs-string"><span class="hljs-string">"MD5"</span></span>); instance.update(str.getBytes()); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] digest = instance.digest(); StringBuffer stringBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b : digest) { String toHexString = Integer.toHexString(b &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (toHexString.length() &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) { toHexString = <span class="hljs-string"><span class="hljs-string">"0"</span></span> + toHexString; } stringBuffer.append(toHexString); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stringBuffer.toString(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { ha((Object) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, e); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } }</code> </pre> </div></div><br><p>  As is clear from the code, the order of requests to the service is as follows: </p><br><p>  Hello, receiving Hello token: </p><br><blockquote>  <a href="https://api.zaycev.net/external/hello">https://api.zaycev.net/external/hello</a> </blockquote><br><p>  To which the server responds with a json object: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>:<span class="hljs-string"><span class="hljs-string">"I-fte8MSfXjw8bYFQkcq629iB6uLb5thZSoj3rGvlCPG4ZJzpgbFPylrtLDpw7L_qQ2EBeuBIMvA7BUWkwilS8IWUg3CWGwj8SCmdIU5I8M"</span></span> }</code> " <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>:<span class="hljs-string"><span class="hljs-string">"I-fte8MSfXjw8bYFQkcq629iB6uLb5thZSoj3rGvlCPG4ZJzpgbFPylrtLDpw7L_qQ2EBeuBIMvA7BUWkwilS8IWUg3CWGwj8SCmdIU5I8M"</span></span> }</code> </pre> <br><p>  Calculation hash: </p><br><blockquote>  hash = md5 (helloToken + "kmskoNdkYHDnl3ol3") </blockquote><br><p>  Looking ahead, I will say that the constant wired into the program (kmskoNdkYHDnl3ol3) changes from version to version, at the moment I have met 3 different constants: </p><br><blockquote>  android: "63kQw2LlpV3jv", "kmskoNdkYHDnl3ol3" <br>  ios: "d7DVdaELf" </blockquote><br><p>  Authentication, getting Access Token: </p><br><blockquote>  <a href="https://api.zaycev.net/external/auth%3Fcode%3D%25s%26hash%3D%25s">https://api.zaycev.net/external/auth?code=%s&amp;hash=%s</a> </blockquote><br><p>  To which the server responds with a json object: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>:<span class="hljs-string"><span class="hljs-string">"wnfQgLZoLErwL6g_axTTTUkCcobXGLMRZS75Zozr3oC05kWNfd07Bngjpg2VRY2GgXYPaCPqSGarqki6YU278ZO6XJP4RLdNqZMqHFwv-25iH8M_R6rSna2CmnP5OuwgTuUundxiTWqI2Am5rHA2gbU8kbB9Ya0gRJ1mHhq_MpksW3R49Fm4VBDd6vYnNUWykibWmxzxvhRBhJ2dmiKJkw"</span></span> }</code> " <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>:<span class="hljs-string"><span class="hljs-string">"wnfQgLZoLErwL6g_axTTTUkCcobXGLMRZS75Zozr3oC05kWNfd07Bngjpg2VRY2GgXYPaCPqSGarqki6YU278ZO6XJP4RLdNqZMqHFwv-25iH8M_R6rSna2CmnP5OuwgTuUundxiTWqI2Am5rHA2gbU8kbB9Ya0gRJ1mHhq_MpksW3R49Fm4VBDd6vYnNUWykibWmxzxvhRBhJ2dmiKJkw"</span></span> }</code> </pre> <br><p>  We check the performance: </p><br><pre> <code class="bash hljs">curl -X <span class="hljs-string"><span class="hljs-string">"GET"</span></span> <span class="hljs-string"><span class="hljs-string">"https://api.zaycev.net/external/track/1310964?access_token=wnfQgLZoLErwL6g_axTTTUkCcobXGLMRZS75Zozr3oC05kWNfd07Bngjpg2VRY2GgXYPaCPqSGarqki6YU278ZO6XJP4RLdNqZMqHFwv-25iH8M_R6rSna2CmnP5OuwgTuUundxiTWqI2Am5rHA2gbU8kbB9Ya0gRJ1mHhq_MpksW3R49Fm4VBDd6vYnNUWykibWmxzxvhRBhJ2dmiKJkw"</span></span></code> </pre> <br><p>  JSON-Response: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"track"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sharp Dressed Man"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bitrate"</span></span>: <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-attr"><span class="hljs-attr">"duration"</span></span>: <span class="hljs-number"><span class="hljs-number">258</span></span>, <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">4.08</span></span>, <span class="hljs-attr"><span class="hljs-attr">"created"</span></span>: <span class="hljs-number"><span class="hljs-number">1333340577000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"userId"</span></span>: <span class="hljs-number"><span class="hljs-number">2750888</span></span>, <span class="hljs-attr"><span class="hljs-attr">"userName"</span></span>: <span class="hljs-string"><span class="hljs-string">"zver19"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"artistId"</span></span>: <span class="hljs-number"><span class="hljs-number">272997</span></span>, <span class="hljs-attr"><span class="hljs-attr">"artistName"</span></span>: <span class="hljs-string"><span class="hljs-string">"ZZTop"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"lyrics"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"lyricAuthor"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"musicAuthor"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"rightPossessors"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://zaycev.net/legal/reriby"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"nETB"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pictureUrl"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://cdnimg.zaycev.net/rp/logo/29/2954-35447.png"</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"artistImageUrlSquare100"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://cdnimg.zaycev.net/artist/2729/272997-52076.jpg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"artistImageUrlSquare250"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://cdnimg.zaycev.net/artist/2729/272997-86370.jpg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"artistImageUrlTop917"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rbtUrl"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre> <br><p>  Auth token - temporary, valid approximately 24 hours after which you need to request again. </p><br><p>  After completing these simple steps, we got the Auth token, which we need to fulfill the requests to the service server.  Time to start searching for queries that are used by the program. </p><br><p>  A text search on " <a href="https://api.zaycev.net/">https://api.zaycev.net</a> " issued a list of all requests. </p><br><p>  List of API requests: </p><br><blockquote>  " <a href="https://api.zaycev.net/external/hello">https://api.zaycev.net/external/hello</a> " <br>  " <a href="https://api.zaycev.net/external/auth%3Fcode%3D%25s%26hash%3D%25s">https://api.zaycev.net/external/auth?code=%s&amp;hash=%s</a> " <br>  " <a href="https://api.zaycev.net/external/search%3Fquery%3D%25s%26page%3D%25s%26type%3D%25s%26sort%3D%25s%26style%3D%25s%26access_token%3D%25s">https://api.zaycev.net/external/search?query=%s&amp;page=%s&amp;type=%s&amp;sort=%s&amp;style=%s&amp;access_token=%s</a> " <br>  " <a href="https://api.zaycev.net/external/autocomplete%3Faccess_token%3D%25s%26code%25s">https://api.zaycev.net/external/autocomplete?access_token=%s&amp;code%s</a> " <br>  " <a href="https://api.zaycev.net/external/top%3Fpage%3D%25s%26access_token%3D%25s">https://api.zaycev.net/external/top?page=%s&amp;access_token=%s</a> " <br>  " <a href="https://api.zaycev.net/external/musicset/list%3Fpage%3D%25s%26access_token%3D%25s">https://api.zaycev.net/external/musicset/list?page=%s&amp;access_token=%s</a> " <br>  " <a href="https://api.zaycev.net/external/musicset/detail%3Fid%3D%25s%26access_token%3D%25s">https://api.zaycev.net/external/musicset/detail?id=%s&amp;access_token=%s</a> " <br>  " <a href="https://api.zaycev.net/external/genre%3Fgenre%3D%25s%26page%3D%25s%26access_token%3D%25s">https://api.zaycev.net/external/genre?genre=%s&amp;page=%s&amp;access_token=%s</a> " <br>  ‚Äú <a href="https://api.zaycev.net/external/artist/%25d%3Faccess_token%3D%25s">https://api.zaycev.net/external/artist/%d?access_token=%s</a> ‚Äù <br>  " <a href="https://api.zaycev.net/external/track/%25d%3Faccess_token%3D%25s">https://api.zaycev.net/external/track/%d?access_token=%s</a> " <br>  " <a href="https://api.zaycev.net/external/options%3Faccess_token%3D%25s">https://api.zaycev.net/external/options?access_token=%s</a> " <br>  " <a href="https://api.zaycev.net/external/track/%25d/download/%3Faccess_token%3D%25s%26encoded_identifier%3D%25s">https://api.zaycev.net/external/track/%d/download/?access_token=%s&amp;encoded_identifier=%s</a> " <br>  " <a href="https://api.zaycev.net/external/track/%25s/play%3Faccess_token%3D%25s%26encoded_identifier%3D%25s">https://api.zaycev.net/external/track/%s/play?access_token=%s&amp;encoded_identifier=%s</a> " <br>  " <a href="https://api.zaycev.net/external/bugs%3Faccess_token%3D%25s">https://api.zaycev.net/external/bugs?access_token=%s</a> " <br>  " <a href="https://api.zaycev.net/external/feedback%3Femail%3D%25s%26clientInfo%3D%25s%26text%3D%25s%26access_token%3D%25s">https://api.zaycev.net/external/feedback?email=%s&amp;clientInfo=%s&amp;text=%s&amp;access_token=%s</a> " </blockquote><br><h1>  Part two.  Let there be a code </h1><br><p>  Here we come to the final stage of our research, now we have to transfer this knowledge to the code.  We will use, as indicated, the Go language as indicated in the title of the article. I will not give you all the code, you can find it at the link at the end of the article. </p><br><div class="spoiler">  <b class="spoiler_title">Declare API reference constants</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( apiURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = <span class="hljs-string"><span class="hljs-string">"https://api.zaycev.net/external"</span></span> helloURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/hello"</span></span> authURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/auth?"</span></span> topURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/top?"</span></span> artistURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/artist/%d?"</span></span> musicSetListURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/musicset/list?"</span></span> musicSetDetileURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/musicset/detail?"</span></span> genreURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/genre?"</span></span> trackURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/track/%d?"</span></span> autoCompleteURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/autocomplete?"</span></span> searchURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/search?"</span></span> optionsURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/options?"</span></span> playURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/track/%d/play?"</span></span> downloadURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = apiURL + <span class="hljs-string"><span class="hljs-string">"/track/%d/download/?"</span></span> )</code> </pre> </div></div><br><p>  To implement, select one of the requests, for example, the TOP request of the tracks, and describe the JSON object: </p><br><div class="spoiler">  <b class="spoiler_title">ZTop struct</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ZTop struct { Page <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"page"` PagesCount <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"pagesCount"` Tracks []struct { Active <span class="hljs-type"><span class="hljs-type">bool</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"active"` ArtistID <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"artistId"` ArtistImageURLSquare100 string `<span class="hljs-type"><span class="hljs-type">json</span></span>:"artistImageUrlSquare100"` ArtistImageURLSquare250 string `<span class="hljs-type"><span class="hljs-type">json</span></span>:"artistImageUrlSquare250"` ArtistImageURLTop917 string `<span class="hljs-type"><span class="hljs-type">json</span></span>:"artistImageUrlTop917"` ArtistName string `<span class="hljs-type"><span class="hljs-type">json</span></span>:"artistName"` Bitrate <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"bitrate"` Block <span class="hljs-type"><span class="hljs-type">bool</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"block"` Count <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"count"` <span class="hljs-type"><span class="hljs-type">Date</span></span> int64 `<span class="hljs-type"><span class="hljs-type">json</span></span>:"date"` Duration string `<span class="hljs-type"><span class="hljs-type">json</span></span>:"duration"` HasRingBackTone <span class="hljs-type"><span class="hljs-type">bool</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"hasRingBackTone"` ID <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"id"` LastStamp <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"lastStamp"` Phantom <span class="hljs-type"><span class="hljs-type">bool</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"phantom"` Size float64 `<span class="hljs-type"><span class="hljs-type">json</span></span>:"size"` Track string `<span class="hljs-type"><span class="hljs-type">json</span></span>:"track"` UserID <span class="hljs-type"><span class="hljs-type">int</span></span> `<span class="hljs-type"><span class="hljs-type">json</span></span>:"userId"` } `<span class="hljs-type"><span class="hljs-type">json</span></span>:"tracks"` }</code> </pre> </div></div><br><p>  Api specific errors: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ClientError <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { msg <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self ClientError)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.msg }</code> </pre> <br><p>  Create a client: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ZClient <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { client *http.Client helloToken <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> accessToken <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> staticKey <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }</code> </pre> <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewZClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(httpClient *http.Client, token, sKey </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZClient</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> httpClient == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { httpClient = http.DefaultClient } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;ZClient{client: httpClient, accessToken: token, staticKey: sKey} }</code> </pre> <br><p>  Feature request Top list: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(zc *ZClient)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Top</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(page </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r *ZTop, err error)</span></span></span></span> { r = &amp;ZTop{} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err = zc.checkAccessToken(); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r, err } values := url.Values{} values.Add(<span class="hljs-string"><span class="hljs-string">"page"</span></span>, strconv.Itoa(page)) values.Add(<span class="hljs-string"><span class="hljs-string">"access_token"</span></span>, zc.accessToken) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := zc.fetchApiJson(topURL, values, r); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r, err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r, err }</code> </pre> <br><p>  The function that performs http requests: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(zc *ZClient)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeApiGetRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fullUrl </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, values url.Values)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp *http.Response, err error)</span></span></span></span> { req, err := http.NewRequest(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, fullUrl+values.Encode(), <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resp, err } resp, err = zc.client.Do(req) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resp, err } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> resp.StatusCode != <span class="hljs-number"><span class="hljs-number">200</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = fmt.Sprintf(<span class="hljs-string"><span class="hljs-string">"Unexpected status code: %d"</span></span>, resp.StatusCode) resp.Write(os.Stdout) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resp, ClientError{msg: msg} } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resp, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><p>  Function for the json decode: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(zc *ZClient)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchApiJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actionUrl </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, values url.Values, result </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resp *http.Response resp, err = zc.makeApiGetRequest(actionUrl, values) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> resp.Body.Close() dec := json.NewDecoder(resp.Body) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err = dec.Decode(result); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Authorization</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(zc *ZClient)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err = zc.checkStaticKey(); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> zc.hello() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(zc *ZClient)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err = zc.checkStaticKey(); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } t := &amp;ZToken{} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := zc.fetchApiJson(helloURL, url.Values{}, t); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } zc.helloToken = t.Token <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> zc.auth() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(zc *ZClient)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err = zc.checkHelloToken(); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } r := &amp;ZToken{} hash := MD5Hash(zc.helloToken + zc.staticKey) values := url.Values{} values.Add(<span class="hljs-string"><span class="hljs-string">"code"</span></span>, zc.helloToken) values.Add(<span class="hljs-string"><span class="hljs-string">"hash"</span></span>, hash) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := zc.fetchApiJson(authURL, values, r); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } zc.accessToken = r.Token <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err }</code> </pre> </div></div><br><p>  Md5 counting function: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MD5Hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { hasher := md5.New() hasher.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(text)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hex.EncodeToString(hasher.Sum(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) }</code> </pre> <br><p>  The source is available at the links below. </p><br><p>  PS: The code is very far from perfect.  If you have thoughts on his correction and improvement - I will be glad to your requests. </p><br><p>  References: </p><br><blockquote>  Jadx: <a href="https://github.com/skylot/jadx">https://github.com/skylot/jadx</a> <br>  github: <a href="https://github.com/pixfid/go-zaycevnet">https://github.com/pixfid/go-zaycevnet</a> <br>  zaycev.net_4.9.3_10.apk: <a href="http://bit.ly/1MZW7UA">http://bit.ly/1MZW7UA</a> </blockquote></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/301838/">https://habr.com/ru/post/301838/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301826/index.html">Dropbox explained why it is embedded in the operating system kernel</a></li>
<li><a href="../301828/index.html">DevConf :: Hackathon by Yii at TASS June 18-19, 2016</a></li>
<li><a href="../301830/index.html">Using the ceiling clock as an information board</a></li>
<li><a href="../301834/index.html">Semantic gap "The Semantic Gap"</a></li>
<li><a href="../301836/index.html">A piece of space in your pocket: the results of the experiment</a></li>
<li><a href="../301840/index.html">Autofill: what web developers don't know, although they should know</a></li>
<li><a href="../301842/index.html">Urban design: 4 lectures on the creation of navigation schemes in the subway and not only</a></li>
<li><a href="../301846/index.html">Game publishers in 2016: how to lose your life's work in a few seconds</a></li>
<li><a href="../301848/index.html">Project structuring in WordPress, Laravel Blade and more.</a></li>
<li><a href="../301852/index.html">Android development using qt and android studio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>