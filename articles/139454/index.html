<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing MVC Pattern for PyQt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all! 
 The article describes the implementation of the MVC design pattern for applications using PyQt, using the example of an addition pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing MVC Pattern for PyQt</h1><div class="post__text post__text-html js-mediator-article">  Good day to all! <br>  The article describes the implementation of the MVC design pattern for applications using PyQt, using the example of an addition program for two numbers.  In addition to describing the implementation of the pattern, a description is given of the process of creating an application. <br><br><a name="habracut"></a><h4>  0 Introduction </h4><br>  <a href="http://en.wikipedia.org/wiki/Model%25E2%2580%2593view%25E2%2580%2593controller">MVC</a> is a design pattern that allows you to effectively separate the data model, the presentation and processing of actions.  The MVC includes three design patterns: an <a href="http://en.wikipedia.org/wiki/Observer_pattern">observer</a> , a <a href="http://en.wikipedia.org/wiki/Strategy_pattern">strategy,</a> and a <a href="http://en.wikipedia.org/wiki/Composite_pattern">linker</a> .  The article discusses the classic MVC scheme with an active model, described in Eric Freeman's book <a href="http://www.books.ru/books/patterny-proektirovaniya-850800/%3Fshow%3D1">Design Patterns</a> . <br><br>  For further work will require: <br><ul><li>  Python 3.2 </li><li>  PyQt 4.9.1 </li><li>  IDE (I used PyCharm 2.0.2) </li></ul><br><h4>  1 Project Structure </h4><br>  <b>Let's</b> call the project <b>SimpleMVC</b> .  So that the task does not seem so trivial, we will add not <i>A</i> and <i>B</i> , but <i>C</i> and <i>D.</i>  The project consists of four modules.  The <b>Model</b> , <b>Controller,</b> and <b>View</b> modules represent the implementation of the model, controller, and view, respectively.  The <b>utility</b> module contains helper classes.  The <b>main.pyw</b> file <b>is</b> designed to run the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre>  SimpleMVC \
     Controller \
         __init__.py
         CplusDController.py
     Model \
         __init__.py
         CplusDModel.py
     Utility \
         __init__.py
         CplusDMeta.py
         CplusDObserver.py
     View \
         __init__.py
         CplusDView.py
         MainWindow.py
         MainWindow.ui
     main.pyw </pre><br><br><h4>  2 Creating a model </h4><br>  The model (first of all!) Is responsible for the application logic.  The task of <b>CplusDModel</b> is the addition of two numbers.  <b>CplusDModel.py</b> file: <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CplusDModel</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  CplusDModel     .      c, d   .   ,       .    ,    . """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> self._mC = <span class="hljs-number"><span class="hljs-number">0</span></span> self._mD = <span class="hljs-number"><span class="hljs-number">0</span></span> self._mSum = <span class="hljs-number"><span class="hljs-number">0</span></span> self._mObservers = [] <span class="hljs-comment"><span class="hljs-comment">#   @property def c( self ): return self._mC @property def d( self ): return self._mD @property def sum( self ): return self._mSum @c.setter def c( self, value ): self._mC = value self._mSum = self._mC + self._mD self.notifyObservers() @d.setter def d( self, value ): self._mD = value self._mSum = self._mC + self._mD self.notifyObservers() def addObserver( self, inObserver ): self._mObservers.append( inObserver ) def removeObserver( self, inObserver ): self._mObservers.remove( inObserver ) def notifyObservers( self ): for x in self._mObservers: x.modelIsChanged()</span></span></code> </pre> <br><br>  The model implements the observer pattern.  This means that the class must support the add, delete, and alert functions of observers.  At the same time, the model is completely independent of controllers and views. <br>  It is important that all registered observers implement a certain method that will be called by the model when they are notified (in this case, this is the <i>modelIsChanged ()</i> method).  To do this, observers must be descendants of an abstract class, inheriting which method <i>modelIsChanged ()</i> must be redefined.  <b>CplusDObserver.py</b> file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> abc <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ABCMeta, abstractmethod <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CplusDObserver</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">( metaclass = ABCMeta )</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     . """</span></span> @abstractmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">modelIsChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""         . """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br>  Of course, a ‚Äúvery flexible python‚Äù allows you to do without an abstract superclass at all or use the cunning exception <i>NotImplementedError ()</i> .  In my opinion, this may adversely affect the architecture of the application. <br>  I would like to note that using PyQt, one could use the slot-signal model.  In this case, when the state changes, the model will send a signal that all attached observers will be able to receive.  This approach seems to be less universal ‚Äî you may want to use another library in the future. <br>  In more complex systems, the functionality that implements the pattern observer (registration, deletion and notification of observers) can be separated into a separate abstract class.  Depending on the architecture, the class may not be abstract. <br><br><h4>  3 Creating a View </h4><br>  A view is a combination of graphic components and implements a linker pattern.  To create a view, use the Visual Editor <b>Designer</b> , included in the PyQt package.  Create a form based on <i>MainWindow</i> .  Form structure: <br><br><pre>  MainWindow - QMainWindow
     CentralWidget - QWidget
         lbl_equal - QLabel
         lbl_plus - QLabel
         le_c - QLineEdit
         le_d - QLineEdit
         le_result - QLineEdit </pre><br><br>  Appearance form: <br><br><img src="https://habrastorage.org/storage2/b76/06e/706/b7606e70679b071896ff0264846da0ca.png"><br><br>  To preview the form, use Ctrl + R.  Save the file in the <b>View</b> directory as <b>MainWindow.ui</b> .  Now we will generate the <b>MainWindow.py</b> file based on it.  To do this, use <i>pyuic4.bat</i> (... \ Python32 \ Lib \ site-packages \ PyQt4).  Run: <br><br><pre>  pyuic4.bat ... \ SimpleMVC \ View \ MainWindow.ui -o ... \ SimpleMVC \ View \ MainWindow.py </pre><br><br>  Instead of "..." you need to add the path to the directory with the project.  For example, the full path might look like this: <br><br><pre>  D: \ Projects \ PythonProjects \ SimpleMVC \ View \ MainWindow.ui </pre><br><br>  If there is a resource file in the project, then to convert it, you need to use <i>pyrcc4.exe</i> (... \ Python32 \ Lib \ site-packages \ PyQt4).  For Python 3.x, you must pass the -py3 flag: <br><br><pre>  pyrcc4.exe -o ... \ SimpleMVC \ View \ MainWindow_rc.py -py3 ... \ SimpleMVC \ View \ MainWindow_rc.qrc </pre><br><br>  Pay attention to "_rc".  The fact is that if a resource file is connected to our form, pyuic4.bat will automatically add at the end of the file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MainWindow_rc</code> </pre> <br><br>  Now you need to create a view class.  According to the MVC architecture, the view must be an observer.  <b>CplusDView.py</b> file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PyQt4.QtGui <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QMainWindow, QDoubleValidator <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PyQt4.QtCore <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SIGNAL <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Utility.CplusDObserver <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CplusDObserver <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Utility.CplusDMeta <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CplusDMeta <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> View.MainWindow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Ui_MainWindow <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CplusDView</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">( QMainWindow, CplusDObserver, metaclass = CplusDMeta )</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      CplusDModel. """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self, inController, inModel, parent = None )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""       . """</span></span> super( QMainWindow, self ).__init__( parent ) self.mController = inController self.mModel = inModel <span class="hljs-comment"><span class="hljs-comment">#    self.ui = Ui_MainWindow() self.ui.setupUi( self ) #      self.mModel.addObserver( self ) #      self.ui.le_c.setValidator( QDoubleValidator() ) self.ui.le_d.setValidator( QDoubleValidator() ) #        self.connect( self.ui.le_c, SIGNAL( "editingFinished()" ), self.mController.setC ) self.connect( self.ui.le_d, SIGNAL( "editingFinished()" ), self.mController.setD ) def modelIsChanged( self ): """     .     . """ sum = str( self.mModel.sum ) self.ui.le_result.setText( sum )</span></span></code> </pre> <br><br>  Notice that the view is a descendant of two classes: <b>QMainWindow</b> and <b>CplusDObserver</b> .  Both classes use different metaclasses.  Therefore, for the <b>CplusDView</b> class, <b>you</b> need to set a metaclass that will inherit the metaclasses used by QMainWindow and CplusDObserver.  In this case, it is <b>CplusDMeta</b> .  <b>CplusDMeta.py</b> file: <br><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""   ,    . pyqtWrapperType -      Qt. ABCMeta -     . CplusDMeta -   . """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PyQt4.QtCore <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyqtWrapperType <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> abc <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ABCMeta <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CplusDMeta</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">( pyqtWrapperType, ABCMeta )</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br><h4>  4 Creating a controller </h4><br>  The controller implements the pattern strategy.  The controller connects to the view to control its actions.  In this case, the implementation of the controller is very trivial.  <b>CplusDController.py</b> file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> View.CplusDView <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CplusDview <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CplusDController</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  CplusDController   .     . """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self, inModel )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     .     . """</span></span> self.mModel = inModel self.mView = CplusDview( self, self.mModel ) self.mView.show() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""        C,    c . """</span></span> c = self.mView.ui.le_c.text() self.mModel.c = float( c ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setD</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""        D,    d . """</span></span> d = self.mView.ui.le_d.text() self.mModel.d = float( d )</code> </pre> <br><br><h4>  5 Compound Components </h4><br>  It remains to combine all the components and test the program.  <b>Main.pyw</b> file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PyQt4.QtGui <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QApplication <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Model.CplusDModel <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CplusDModel <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Controller.CplusDController <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CplusDController <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> app = QApplication( sys.argv ) <span class="hljs-comment"><span class="hljs-comment">#   model = CplusDModel() #         controller = CplusDController( model ) app.exec() if __name__ == '__main__': sys.exit( main() )</span></span></code> </pre> <br><br>  Thanks for attention! <br><hr>  <a href="">Source</a> </div><p>Source: <a href="https://habr.com/ru/post/139454/">https://habr.com/ru/post/139454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139449/index.html">New life of your postal addresses in Rambler-Mail</a></li>
<li><a href="../139450/index.html">Top up in the ASA lineup</a></li>
<li><a href="../139451/index.html">Digest of new materials in Russian MSDN for February</a></li>
<li><a href="../139452/index.html">[asio :: udp] Non-cross-platform behavior</a></li>
<li><a href="../139453/index.html">Javascript malware identification</a></li>
<li><a href="../139455/index.html">Save the gnomes from the terrible, but fair Troll</a></li>
<li><a href="../139458/index.html">New PyCharm 2.1 Early Access Preview has been released</a></li>
<li><a href="../139461/index.html">Proper hosting for MODx do it yourself</a></li>
<li><a href="../139462/index.html">Igor Shoifot, start-up and investor from Silicon Valley</a></li>
<li><a href="../139466/index.html">Resources to help designers. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>