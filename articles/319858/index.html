<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>dock: a simple library of unit testing C ++ code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Although there are already libraries for unit testing C ++ code, for example, Google Test or Bandit , but  they are not written by me  here, in my opi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>dock: a simple library of unit testing C ++ code</h1><div class="post__text post__text-html js-mediator-article"><p>  Although there are already libraries for unit testing C ++ code, for example, <a href="https://github.com/google/googletest">Google Test</a> or <a href="https://github.com/banditcpp/bandit">Bandit</a> , but <del>  they are not written by me </del>  here, in my opinion, it is somehow over complicated, compared to the same JS.  There you just do, for example, <code>npm i mocha assert --save-dev</code> and you can start writing tests, but here you need to do it with pens, and in the case of <code>gtest</code> also build it with <code>cmake</code> .  Bandit connects easily, but does not know how to serialize the results into some kind of data format, <code>gtest</code> does, but needs to be collected separately.  And I do not want to choose "either this or that."  I needed to make a convenient and simple tool for my tasks.  I wanted to get a simple library without dependencies, header-only, into several files, which can be easily and quickly connected to my project, it is convenient to make changes to it (if necessary).  But, most importantly, I wanted to get convenient, machine-readable reports, and not only in <code>stdout</code> (or <code>xml</code> , as in <code>gtest</code> ), but also in any other format that I want.  Further under the cut. </p><a name="habracut"></a><br><p>  As I wrote above, the <a href="https://github.com/emdc/dock">dock</a> header-only library, which means its connection is as simple as possible: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;dock/dock.hpp&gt; using namespace dock; int main() { core().run(); return 0; }</span></span></span></span></code> </pre> <br><p>  When building, for example, in gcc, you need to transfer only the path to the folder with libraries and specify the standard of the C ++ 14 language.  I deliberately do this, because I am writing new projects in a fresh standard, and there are already my own libraries to support the old ones. </p><br><p>  The description of the tests is also made extremely simple: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> dock; Module(<span class="hljs-string"><span class="hljs-string">u8"Some module 1"</span></span>, [](DOCK_MODULE()) { Test(<span class="hljs-string"><span class="hljs-string">u8"Some test 1"</span></span>, []() { <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> value = <span class="hljs-number"><span class="hljs-number">0x10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> expectedValue = <span class="hljs-number"><span class="hljs-number">0x10</span></span>; Assert::isEqual(value, expectedValue); }); Test(<span class="hljs-string"><span class="hljs-string">u8"Some test 2"</span></span>, []() { <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> value = <span class="hljs-number"><span class="hljs-number">0x10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> expectedBorder = <span class="hljs-number"><span class="hljs-number">0x20</span></span>; Assert::isLess(value, expectedBorder); }); }); Module(<span class="hljs-string"><span class="hljs-string">u8"Some module 2"</span></span>, [](DOCK_MODULE()) { Test(<span class="hljs-string"><span class="hljs-string">u8"Some test 1"</span></span>, []() { Assert::isTrue(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }); Test(<span class="hljs-string"><span class="hljs-string">u8"Some test 2"</span></span>, []() { Assert::isTrue(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); });</code> </pre> <br><p>  For convenience, tests are grouped into modules.  They pass an object <code>std::function&lt;void(Module*)&gt;</code> , inside which tests are described directly.  Tests have approximately the same syntax, only a functional object without parameters.  So far, I have not done a check on the uniqueness of the module or test name, because it was not critical. </p><br><p>  The <code>Assert</code> library contains a simple set of <code>isTrue</code> , <code>isEquals</code> , <code>isGreater</code> , <code>isLess</code> , which by default can compare objects through the operators <code>==</code> , <code>&gt;</code> or <code>&lt;</code> .  If there are no operators, then the comparison function can be passed at the end with a parameter (for example, in the form of a lambda). </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTrue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::function&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">()&gt; fcn)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T b, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::function&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T)&gt; compareFcn = defaultEqualsFunction&lt;T&gt;)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isGreater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T b, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::function&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T)&gt; compareFcn = defaultGreaterFunction&lt;T&gt;)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T b, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::function&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T)&gt; compareFcn = defaultLessFunction&lt;T&gt;)</span></span></span></span>;</code> </pre> <br><p>  And now just what I needed: a convenient conversion of test results into the required data format.  For a start, I just want to work with the statistics of the project, look at the dynamics of the tests and similar things, and it is convenient for me to do it on JS.  Therefore, the first format I needed is JSON.  There are already three ready serializers in the repository: in JSON, in plain text and output to the console with backlighting.  Using serializers is very simple: </p><br><pre> <code class="cpp hljs">nlohmann::json outJson; <span class="hljs-function"><span class="hljs-function">JsonSerializer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serializer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(outJson, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; core().run(); core().collect(serializer); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; serializer &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre> <br><p>  And the serializer interface itself looks like this: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResultSerializer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~ResultSerializer() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;Result&gt;&amp; results)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">friend</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ostream&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>&lt;&lt;(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ostream&amp; os, ResultSerializer&amp; s); };</code> </pre> <br><p>  Those.  we can output the result anywhere, only substitute <code>std::ostream</code> and that's it.  The logic of the serializer is as follows: </p><br><ul><li>  We pass the serializer to the engine via <code>collect()</code> and it calls the <code>serialize()</code> method with the result vector. </li><li>  In the <code>&lt;&lt;</code> operator, the <code>toString()</code> method is called, which <code>std::ostream</code> string in <code>std::ostream</code> . <br>  You can make two options: either when you call <code>serialize()</code> , we immediately create the necessary string, and then either simply return it, or save the reference to the results and generate the output immediately when issued to ostream.  In any case, there is freedom of movement - the engine simply issues <code>std::vector&lt;dock::Result&gt;</code> , and what to do with it is your business :). </li></ul><br><p>  The license is free (MIT), because I do not mind and would be pleased to see its use.  The <a href="https://github.com/ikalnytskyi/termcolor">termcolor</a> and <a href="https://github.com/nlohmann/json">JSON for Modern C ++</a> libraries were used for serializers, but you can safely remove them along with unnecessary serializers. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/319858/">https://habr.com/ru/post/319858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319838/index.html">As I in one team did a redesign of a web product (cases!)</a></li>
<li><a href="../319848/index.html">"Ultimate DNS Digest": 45 materials from Habr and other resources</a></li>
<li><a href="../319852/index.html">Java examples from books and documentation</a></li>
<li><a href="../319854/index.html">"I learned something - try to explain it until you understand it yourself"</a></li>
<li><a href="../319856/index.html">Trucks and refrigerators in the cloud</a></li>
<li><a href="../319860/index.html">Bitcoin in a nutshell - Transaction</a></li>
<li><a href="../319862/index.html">Bitcoin in a nutshell - Protocol</a></li>
<li><a href="../319864/index.html">One of the easiest ways to improve your programming skills is to read someone else's code.</a></li>
<li><a href="../319866/index.html">Interesting in March: DevOpsDays in Moscow</a></li>
<li><a href="../319868/index.html">Bitcoin in a nutshell - Cryptography</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>