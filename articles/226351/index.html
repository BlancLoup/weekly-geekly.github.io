<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we built the first prototype</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! This is our second post, it opens a series of technical publications. We decided to tell more about the CamIRa architecture, the components a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we built the first prototype</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/75f/90d/ba0/75f90dba00a388f5ab9d2aafc85e3f4f.jpg" width="400" height="348">  Hi Habr!  This is our second post, it opens a series of technical publications.  We decided to tell more about the <b>CamIRa</b> architecture, the components and technologies used, as well as how we came to this.  It is time to share something with the community, especially since a lot has already accumulated, which we had to face during the implementation of our first prototype.  In this article, we will describe how you have gone from a simple program with a single IR image, to a full-fledged cloud system with a personal account. <br>  We ask interested under kat! <br><a name="habracut"></a><br><br><h4>  Prototyping </h4><br><br>  A lot of time may pass from the appearance of an idea to how it becomes something tangible, it can take months and sometimes years!  In order to reduce these very years at least to a month or two, and there is prototyping. <br>  Today, a lot of things are available for rapid prototyping, many of which are available to almost everyone.  These are all kinds of single-board computers and amateur boards with programmable microcontrollers: Raspberry Pi, Arduino, Intel Galileo, and others.  For the rapid manufacture of the body used 3D printing. <br>  We owned these tools from the very beginning, so we needed to find only a suitable IR sensor and put everything together. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Buying a sensor </h4><br><br>  A suitable option for us was the sensor used in the device IR-Blue <a href="http://www.rhworkshop.com/">RHWorkshop</a> Melexis MLX90620.  This is a rather primitive sensor with a 16x4 matrix, but already connected to the board with Bluetooth, and all the source codes for it are available on <a href="https://github.com/RHWorkshop">GitHub</a> .  For prototyping the most.  We decided to order a ready device, especially since it was much more difficult to order only the sensor from the manufacturer. <br>  Many of Habr's readers know how difficult it is to find something rare in our stores, you have to order because of the ‚Äúhillock‚Äù, besides, wait a week or even months (hello ‚ÄúRussian Post‚Äù).  We were ready for this and much more from our native mail, but could not even think that something could happen in the delivery service at the London airport! <br>  By the time the company on the kickstarter has long passed, and the remnants of IR-Blue sold on the site ( <a href="http://www.rhworkshop.com/">RHWorkshop</a> ).  We ordered one in assembly and one in the form of a set of components for self-assembly, it is a bit cheaper, and from it we would like to use the sensor itself, even it would not be necessary to drink it. <br>  By the seller‚Äôs assurance, the transport he uses delivers to Moscow in 14 days.  The seller sent us a tracker, we saw by it that the package had already arrived in London a couple of days after sending from the USA!  ‚ÄúExcellent,‚Äù we thought: what a speed.  After that we stopped following the tracker, relaxed and decided that everything was in order.  14 days have passed, there is no package, we track the tracker, it shows that the package is still in London!  They wrote to the seller, as he designed the shipment, and only he can kick the transport company.  After a short correspondence with him, it turned out that the customs officers in London did not agree with the announced price for this type of parcel.  And the most important thing is that they do nothing, they would send it back and that‚Äôs it, and they just don‚Äôt let it go, they keep it!  After discussing the situation with the seller, they decided to recall, repack and send in two parcels.  While there was a refund process, we thought that the increased shipping charge would not be an option, we were asked to return money for a set of components, but to send only the assembly. <br>  Two weeks later we received it.  The device worked steadily, but did not differ in the quality of the case and its materials.  However, like most products with kickstarter.  But the software to it is insanely buggy and capricious on different phones and different versions of Bluetooth.  After a long dance with a tambourine, we hardly managed to get a picture through our native software. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/50a/9ed/086/50a9ed0860012b5a6d56feaf9633017e.png"><br><br><h4>  Assembly </h4><br><br>  Having played enough with the device, they added a list of components for the first <b>CamIRa</b> prototype: <br>  -Raspberry Pi model B <br>  -Arduino Uno <br>  Servo drives FS90 2 pcs.  <a href="http://amperka.ru/collection/servo/product/servo-fs90">fs90</a> <br>  - Bracket for servomotors <a href="http://www.electronshik.ru/item/9g-servo-bracket-885035">9g servo bracket</a> <br>  -RaspiCam <a href="http://www.electronshik.ru/card/kamera-raspicam-dlya-raspberry-pi-119097">raspicam</a> <br>  - 16x4 Melexis MLX90620 sensor as part of the IR-Blue device <br><br>  The brain of the device is the Raspberry Pi.  General management of the device, receiving commands from the server, receiving video from RaspiCam, interacting with the Arduino is a Java application running on Malinka.  For control of servomotors, as well as reading data from an IR sensor, Arduino is engaged (in the first versions, data from the sensor were obtained directly via Bluetooth), which is controlled by Raspberry via UART / RS-232.  For this purpose, they even had to develop their own RS-232-based Raspberry-Arduino text interaction protocol. <br>  Assembly it looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc9/ea8/1ae/dc9ea81ae215c9d52801bc1c2ef67bdc.jpg"><br><br>  On top of the disassembled IR-Blue, the RaspiCam is attached with an adapter for a wide-angle lens printed on a 3D printer.  All this is installed on a bracket with servomotors and connected to the Arduino and Raspberry Pi.  By the way, we had to make our bike with a lens, since the camera had a 50 degree angle of view (FOV), which is even less than the IR sensor.  <a href="http://wiki.raspberrytorte.com/index.php%3Ftitle%3DCamera_Module_Lens_Modifcation">Upgrade</a> instructions are on the bourgeois site: <a href="http://wiki.raspberrytorte.com/index.php%3Ftitle%3DCamera_Module_Lens_Modifcation">wiki.raspberrytorte.com/index.php?title=Camera_Module_Lens_Modifcation</a> .  A small snag was that the lens holders should wait for a long time with e-bay, and in addition the distance between the mounting holes of the holders does not match the distance on the RaspiCam board.  Therefore, a 3D model was quickly drawn and printed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/728/5fd/367/7285fd367fb39fbae511f90b6a7b8a07.jpg"><br><br>  Anyone wishing to increase the viewing angles of RaspiCam, here's an adapter model: <a href="http://yadi.sk/d/qc1eqqDuSnQEU">file</a> .  It is necessary to print it out on the printer, cut the M12x0.5 thread, gently unscrew the native lens from the camera with tweezers, put the adapter on top of the adapter and screw in these lenses or <a href="http://mirsb.ru/index.php%3FproductID%3D7095">fingers2</a> .  Our experiments have shown that the Daiwon BL2120 [DW2162] lens gives the greatest angle and best quality.  It turned out to be FOV = 110 degrees, which is quite enough for an extensive coverage of a 4x5 m2 room, plus RaspiCam gives a Full HD picture. <br><br><h4>  Software component </h4><br><br>  Having finished with iron began to write software for it.  Initially, the study took source codes for the program IR-blue for iPhone with github.  But, as it often happens, it is more difficult to understand someone else‚Äôs code than to write your own, so the IR-blue code was not used.  Armed with a datasheet on the sensor, we began to develop (by the way, a little later, to process the IR images, it was tempting to take the code of the <a href="http://habrahabr.ru/post/172947/">Habr Post</a> project mentioned in our first post, but in order not to waste time, the sources were practically not even inspected).  Our first program for this "monster" looked like this (these are three fingers): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/13e/2e8/218/13e2e8218f1a6a518c848ae17f1717bb.png"><br><br>  Subsequently, it formed the basis of our service program, in which the calibration of IR sensors and servomotors is performed.  After several weeks of work, the program window looked like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/32c/014/13d/32c01413d8bed178a3c08239650db8de.png"><br><br>  In the screenshot of the program, the image of a cup with boiling water: at the top left of the sensor in the center position, in the center - a composite image of several sensor movements (IR image). <br>  Gradually debugging and testing functions directly from the PC, we began to transfer functionality to the server.  Now Malina works with the server via HTTP / S (for streaming video) and WebSockets / wss (for transferring commands).  The server part consists of several services - a video server and a WebSocket server (both are their own development in java, spinning on Tomcat) deployed to Azure (thanks to the BizSpark program), a web server with a personal account is also a Java application using the Play framework! , a set of Bootstrap + jQuery and self-written JavaScript, is deployed on GAE. <br>  As a result, the overall interaction architecture looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/86c/f44/b09/86cf44b09097508c79fdb73a8338bde2.png"><br><br>  Neither the screenshot below shows the result of the device operation with the Omron D6T-44L-06 ( <a href="http://ru.farnell.com/omron-electronic-components/d6t-44l-06/sensor-thermal-mems-4x4/dp/2218000">Omron</a> ) 4x4 sensor.  In the browser in your account on top of the streaming video (online) a thermal image is superimposed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac4/e79/70b/ac4e7970bf78c4f01468c90304160ce6.png"><br><br>  In the next article, we will tell you more about the software part, in particular about the implementation of streaming video using RaspiCam, Raspberry Pi and various libraries for converting and processing streaming video.  The next post will be useful to anyone who would like to make a full-fledged video surveillance system out of Raspberry.  If someone is not familiar with us, we recommend reading our first <a href="http://habrahabr.ru/company/camira/blog/222053/">post.</a> </div><p>Source: <a href="https://habr.com/ru/post/226351/">https://habr.com/ru/post/226351/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226339/index.html">How to assemble an electric bike in seven days</a></li>
<li><a href="../226341/index.html">We sit, do not touch anyone, we repair old headphones</a></li>
<li><a href="../226343/index.html">Gamification or gamification</a></li>
<li><a href="../226345/index.html">Recover Apple Key Aluminum after Fluid</a></li>
<li><a href="../226347/index.html">About seals, dogs, machine learning and deep learning</a></li>
<li><a href="../226355/index.html">Master or work?</a></li>
<li><a href="../226357/index.html">Implementation of cloud data backup based on Android Backup Service</a></li>
<li><a href="../226359/index.html">Sharp Infrared Range Finder</a></li>
<li><a href="../226361/index.html">Create Shaman Tambourines</a></li>
<li><a href="../226363/index.html">No cards. We pay bracelets, jackets, sounds and phones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>