<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lean Big Data on 6 Google services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello Habr! I want to tell you how we did our own Big Data. 

 Every startup wants to build something cheap, high-quality and flexible. Usually this d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lean Big Data on 6 Google services</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/fd2/925/9dc/fd29259dc4e0dd88ef4ddfe20f7dc052.png" alt="image"><br><br>  Hello Habr!  I want to tell you how we did our own Big Data. <br><br>  Every startup wants to build something cheap, high-quality and flexible.  Usually this does not happen, but we seem to have succeeded!  Below is a description of our decision and a lot of my purely subjective opinion on this matter. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And yes, the secret is that 6 Google services are used and there is almost no written own code. <a name="habracut"></a><br><br><h4>  What was needed? </h4><br>  I work in a fun Singapore startup - Bubbly, which makes a voice social network.  The trick is that you can use without a smartphone, quite a good old Nokia.  The user calls to a special number and can listen to messages, record their messages, etc.  All voice, do not even need to be able to read to use. <br><br>  In Southeast Asia, we have tens of millions of users.  But since it works through mobile operators, in other countries nobody knows about us.  These users generate a huge amount of activity that they want to register and analyze in every possible way: <br><ul><li>  Make a beautiful dashboard with key metrics updated online </li><li>  Monitor service work and errors </li><li>  Do A / B tests and analyze user behavior </li><li>  Make reports for our partners </li><li>  ... </li></ul><br>  In general, the tasks that are needed by everyone and always practically. <br><br><h4>  Why reinvent the wheel? </h4><br>  It would seem - why build something, if there are ready-made solutions?  I was guided by such motives: <br><br><h5>  1. I do not want to use Mixpanel (sorry gays!) </h5><br><ul><li>  If there is no complete control over the data, then there is always a question to which someone else‚Äôs ready-made system does not answer.  Yes, I know that there are Mixpanel export APIs and they allow a lot.  But in fact, so many times already came across such situations.  I want full control. </li><li>  A bunch of all the "hotelok" will have to be screwed into another proprietary product, which is not very convenient.  For example, SMS alert to the chief of support if something is broken.  Or special reports to third-party partners.  And such features cannot be predicted in advance. </li><li>  It is really expensive!  I know that many instead of all the data are loaded there only a random sample, in order to somehow reduce costs.  But this is a very dubious happiness in itself. </li></ul><br><h5>  2. If you want so much your ‚Äúown‚Äù solution, then why not stir up Hadoop with all the stuffing? </h5><br>  <s>Because the intestine is thin</s> .  It is really difficult! <br><br><ul><li>  It is necessary to raise the server and configure everything.  There are of course hosted Hadoop, where everything is already ‚Äúconfigured‚Äù, but you still have to deal with these settings. </li><li>  Hadoop is only storage and querying.  All the other features will have to do yourself. </li></ul><br>  MySQL for the task is clearly not suitable, because we have too much data for it. <br><br><h4>  Briefly how it works for us </h4><br><ol><li>  We upload all ‚Äúevents‚Äù from users from our servers to Google Big Query </li><li>  We use Google Spreadsheets for Big Query queries and subsequent data processing.  All logic sits in Spreadsheets and scripts tied to it. </li><li>  Next, visualize the data using Google Charts. </li><li>  We host these graphics on Google Drive </li><li>  In a single "Dash Board" these graphics are going to Google Sites </li><li>  Finally, Google Analytics is on top of Google Sites, which oversees the users of all this analytics. </li></ol><br><h4>  The advantages of this approach (no, I don‚Äôt promote Google for money, which is <s>a pity</s> ) </h4><br><h5>  Big Query - Pros </h5><br><ul><li>  This database can store a huge amount of data.  The issue of scalability is not worth it. </li><li>  It costs a penny compared to other solutions.  I write about the expenses below separately. </li><li>  In fact, any request takes less than 20 seconds.  This is very different from Hadoop, where the score is at best for minutes.  For standard, defined once and for all requests, the difference seems small.  But if you look at the data ‚Äúin free flight‚Äù (ad hoc) or repair something by trial and error, then even small pauses tear the entire workflow and reduce the efficiency of the analyst‚Äôs work at times.  And in life it turns out that only such tasks and doing all day.  A very important advantage of Big Query. </li><li>  Small buns, such as the web-interface, in fact, help a lot. </li></ul><br>  <b>Improvements:</b> <br>  I really wanted to make Big Query schemaless, just to add events to the system and not think about anything.  Therefore, a piece of code was attached to the loader, which checks the current table schema in Big Query and compares it with what it wants to load.  If there are new columns, they are added to the table via the Big Query API. <br><br><h5>  Google Spreadsheets - Pros </h5><br>  Better spreadsheets for data analysis is nothing.  This is my axiom.  For this task, Spreadsheets fits better than MS Excel (no matter how much I love it).  The reasons are: <br><ul><li>  Works with Big Query out of the box ( <a href="https://developers.google.com/apps-script/articles/bigquery_tutorial">Goolge Tutorial</a> ) </li><li>  Everything lies in the cloud and scripts can update data on a schedule. </li><li>  Cross platform!  It works equally well on PC and Mac. </li><li>  Already have a bunch of useful features - email, etc. </li></ul><br>  <b>Improvements:</b> <br>  The script from the tutorial has been slightly modified.  Now he checks every sheet in a spreadsheet.  If ‚ÄúA1‚Äù is written in cell A1, it means that the query to Big Query lies in A2.  The results of the query script will put on the same sheet. <br><br>  This is necessary so that when using, do not touch the code at all.  Created a new sheet, wrote a request, got the result. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6db/3d8/836/6db3d88362ea628f42c46e2b6221364f.png" alt="image"><br><br><h5>  Google Charts - Pros </h5><br><ul><li>  There are a lot of visualization libraries, but there is a feeling that Google has become more reliable and functional (unless of course they write off Charts as a Reader). </li><li>  Works with Spreadsheets out of the box ( <a href="https://developers.google.com/chart/interactive/docs/spreadsheets">Google Tutorial</a> ) </li><li>  They bribed them with interactive controls that allow you to play quite deeply with the data even to business people who do not use either SQL or Excel. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/22f/552/5ca/22f5525ca3ef723816ec141f1df223eb.png" alt="image"><br><br><h5>  Google Sites / Google Drive - Pros </h5><br><ul><li>  You can use Google's developed system of access rights.  You cannot give read-olny access to Dropbox, but here you can. </li><li>  Google Sites have a wysiwyg editor that I personally really like. </li><li>  After the whole system was built on Google services, I decided to use them to the end of the principle. </li></ul><br><h5>  Google Analytics </h5><br>  Recursion!  Our Dash Board has about 30 users.  Enough to analyze resource usage statistics.  Google Sites, not surprisingly, are integrated with Google Analytics in a couple of clicks.  Attendance of pages objectively shows which data is most interesting in order to improve the system in this direction. <br><br><h4>  About the cost of the decision </h4><br>  I believe that in any system the most expensive is the time required for development and man-days spent on development and support.  In this sense, this solution is ideal, since its code is almost never written.  The whole project was done by one person, in parallel with other tasks, and the first version was made in a month. <br><br>  There are, of course, suspicions that the integration between the services of Google may break (in their tutorial it can be seen that this has already happened) and it will take support efforts.  But I do not expect anything terrible. <br><br>  As for direct costs, only Big Query costs money in the whole system.  Data storage and data requests are paid for.  But it's just a penny!  We write 60 million events a day and never once more than 200 USD per month did not pay. <br><br><h4>  Important Add-in for Big Query </h4><br>  Big Query scans the entire table by default.  If events for all the time stored in one place, the requests become slower and more expensive over time. <br><br>  The most interesting is always the data for the last time, so we came to the monthly calculation of these tables.  Every month, the events table is backed up on events_201401Jan, events_201402Feb, and so on. <br><br>  To make it convenient to make such a structure, we expanded the SQL language a bit.  Fortunately, everything is controlled by its own script from Spreadsheets, and it can parse and process our requests as needed.  Added such commands: <br><ul><li>  FROMDATASET dataset - queries all tables in a data set in turn.  This is in case you need to request data for the entire period of time. </li><li>  FROMLAST table - queries the current table and the table for the last month.  This is for queries that need data for the last 7 days, for example.  So that at the beginning of the month the request returns the full 7 days, and not what is in the current month. </li></ul><br><h4>  Future plans: </h4><br><ul><li>  To cut a script starting SQL.  I want him to, apart from FROMLAST, be able to do all sorts of useful transformations like PIVOT, etc. </li><li>  Saw JavaScript for Google Charts.  I want to ideally get rid of the need to touch the code at all.  In order, like in Excel, pivot charts - to switch with one click the type of graphics, and which series on which axis, etc.  But these are global plans. </li><li>  I want to experiment with nested data.  We can sort all events from a separate user session into one record on the server.  That is, events within the session (call in our case) will be the ‚Äúchildren‚Äù of this session.  In theory, this should simplify some confused queries. </li></ul><br><br>  How it all works can be <a href="https://sites.google.com/site/leanbigdatawith6tools/">seen on the example here</a> . <br><br>  I'd like to have knowledgeable people say their opinions.  For this article and was written. <br><br>  PS I ask for errors in the text and my anglicisms to write in a personal, I will correct everything. <br><br>  PPS I'm not a programmer at all, so my code can be scary (but it works!).  I will be glad to constructive criticism. </div><p>Source: <a href="https://habr.com/ru/post/230243/">https://habr.com/ru/post/230243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230231/index.html">How we managed the training project</a></li>
<li><a href="../230233/index.html">Rebranding "Radioelectronic Technologies" will show the world in Farnborough</a></li>
<li><a href="../230235/index.html">How economic news affects the stock market</a></li>
<li><a href="../230239/index.html">Java Agent on JVM service</a></li>
<li><a href="../230241/index.html">ESA will observe the crash of a space truck in the atmosphere of the Earth from inside the ship</a></li>
<li><a href="../230247/index.html">6 tools available usability testing for websites</a></li>
<li><a href="../230249/index.html">Are you afraid of gradle as I fear it?</a></li>
<li><a href="../230251/index.html">Wiren Board Smart Home batch production experience</a></li>
<li><a href="../230253/index.html">An animator from Russia is working on creating a 3D version of the intro to Futurama.</a></li>
<li><a href="../230255/index.html">How to discuss money at the interview: the negotiation strategy for the applicant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>