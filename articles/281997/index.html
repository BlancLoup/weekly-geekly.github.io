<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A bit of reflection for C ++. Part Three: Documentation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IMPORTANT UPDATE. READ BEFORE READING ARTICLE  It was my fault that there were some misunderstandings about these publications. So I decided to add th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A bit of reflection for C ++. Part Three: Documentation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d34/db1/524/d34db1524a424101918e0567e76534c7.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">IMPORTANT UPDATE.</b>  <b class="spoiler_title">READ BEFORE READING ARTICLE</b> <div class="spoiler_text">  It was my fault that there were some misunderstandings about these publications.  So I decided to add this warning. <br><br>  In this series of articles, I wanted to put more emphasis on the development history of a certain open source library, regardless of the specific cpprt.  A story from writing source codes (with an emphasis on some interesting things that people find interesting to read in general, regardless of the library itself), to the formation of a repository (with a CMake lesson) and library promotion (where part of the promotion implies publishing this series of articles).  Such a training demo project for people who were thinking of posting their open source, but were either afraid or did not know how. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, I would not mind if the library somehow came to life and there is a minimal amount of library advertising in the articles (I tried to hide it under spoilers).  But still, the objectives of this cycle I considered more educational and, I hope, applicable in general, without regard to my library. <br><br>  Please take this into account when reading a series of articles. <br></div></div><br><br>  This article is the third and final in a cycle on the development of the <a href="https://github.com/vsemenyakin/cpprt">cpp runtime</a> library, which adds the ability to add some meta-information about C ++ classes and continue to use this information during program execution. <br><br>  This article describes how the user can interact with the library and demonstrates the clean result of the work described in the first two articles of the cycle. <br><br><div class="spoiler">  <b class="spoiler_title">Links to all articles of the cycle</b> <div class="spoiler_text">  <a href="https://habrahabr.ru/post/281993/">1. About development</a> <br>  <a href="https://habrahabr.ru/post/281995/">2. About preparation for publication</a> <br>  <a href="https://habrahabr.ru/post/281997/">3. About the result</a> <br></div></div><br><br><a name="habracut"></a><br><br>  <a href="https://github.com/vsemenyakin/cpprt">Link to library repository</a> <br>  What is stated in this article is true for commit <i>e9c34bb</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Project structure</b> <div class="spoiler_text">  <i>- Documentation ---</i> <br>  <b>readme.md</b> <br>  Readme file  It was conceived as a file, from which the familiarization with the project begins. <br><br>  <b>README.cmake</b> <br>  A file that tells how to build a library with CMake and / or additional assembly goals that come with it. <br><br>  <b>/ docs</b> <br>  Folder with the documentation ... Alas, the only thing in it now is - a link to this series of articles.  I made a mistake, postponed the documentation for last, and I didn‚Äôt have the heart to do it after three weeks of working seven days a week on this series of articles. <br><br>  <i>- cpprt library files ---</i> <br>  <b>/ include</b> <br>  A programming interface for accessing the cpprt library API. <br><br>  <b>/ src</b> <br>  The folder with the source code of the library. <br><br>  <i>- Build for popular systems ---</i> <br>  <b>/ build</b> <br>  Ready projects for some popular toolchains and IDE. <br><br>  <b>/ lib</b> <br>  Prebuilt library builds for some popular compilers. <br><br>  <i>- Additional projects ---</i> <br>  <b>/ examples</b> <br>  Folder with source code for examples ... At the moment, for one simple example demonstrating the principles of using the library. <br><br>  <b>/ tools</b> <br>  Folder with source code for tools supplied with the library. <br><br>  <i>- Build system ---</i> <br>  <b>/ build</b> <br>  An empty folder in which it is recommended to build the library and / or additional assembly goals. <br><br>  <b>CMakeLists.txt</b> <br>  CMake configuration file. <br><br>  <i>- Other files ---</i> <br>  <b>LICENCE.txt</b> <br>  The license file under which the project is distributed (MIT license). <br><br>  <b>copying.txt</b> <br>  The file with the template header for the source code files, which describes the license information. <br></div></div><br><br><h3>  Build a library and related materials </h3><br><br>  You can read about how the build system was created for the project in the second article of the cycle ( <a href="https://habrahabr.ru/post/281995/">link</a> ). <br><br>  The recommended method of assembling the library itself and the accompanying materials involves the use of <a href="https://ru.wikipedia.org/wiki/CMake">CMake</a> .  If you do not have CMake installed, you can download it <a href="https://cmake.org/download/">from here</a> . <br><br>  To build via the command line, follow these steps: <br><br>  1. Create somewhere where you want a folder within which you will be assembling.  Go to this folder: <br>  <b>mkdir {your-build-folder}</b> <br>  <b>cd {your-build-folder}</b> <br>  <i>{your-build-folder}</i> is the folder in which you will be building. <br><br>  2. Call the command to generate the configuration: <br>  <b>cmake -G "{generator-name}" {options} {cpprt-folder-path}</b> <br>  <i>{generator-name}</i> is the name of the generator for your cloud. <br>  <i>{options}</i> - a list of options for specifying what you want to collect. <br><div class="spoiler">  <b class="spoiler_title">More about options</b> <div class="spoiler_text">  Regardless of the options selected, in the generated configs (IDE files) there will always be at least one build target ‚Äî for the static build of the cpprt library itself.  In order to generate configs for building additional accompanying projects, you can use the following options (the default value of the option is specified first): <br><br>  <b>-DBUILD_ALL = {OFF / ON}</b> <br>  If this option is set to ON, configurations for all accompanying projects delivered together by the library will be generated.  Moreover, if the options for the assembly of specific assembly purposes. <br><br>  <b>-DBUILD_TOOLS = {OFF / ON}</b> <br>  If this option is set to ON, configurations will be generated for assembling the tools supplied with the library.  At the moment there is one tool - console (more on it will be <a href="https://habr.com/ru/post/281997/">further</a> ). <br><br>  <b>-DBUILD_EXAMPLES = {OFF / ON}</b> <br>  If this option is set to ON, then configurations will be generated for assembling the examples supplied with the library.  At the moment there is one example (simple_example) which describes the classic example for OOP example of the hierarchy of classes of animals. <br><br>  Additional options: <br>  <b>-DCONSOLE_WITH_EXAMPLE = {ON / OFF}</b> <br>  If this option is set to ON (the default setting is set), then the source code of the console tool will contain files describing the test class hierarchies. <br></div></div><br><br>  <i>{cpprt-folder-path}</i> is the folder that is the root of the cpprt clone repository. <br><br>  After calling the {your-build-folder} folder, configuration files for your toolchain (or for your IDE) are generated.  There is no need to configure anything further.  It is enough just to start building the necessary assembly targets (projects for IDE). <br><br><h3>  Library features </h3><br><br>  Using the API provided by the cpprt library, a class can be <i>registered</i> .  If a class is registered, then the following opportunities open for it: <br>  1. Creating a class object during program execution based on the class name in string representation. <br>  2. Access to information on the registered heirs and ancestors of the class (to the extent the information transmitted during registration). <br>  3. The ability to obtain information about the abstractness of classes. <br>  4. The ability to get the string name of the class through the methods of its objects. <br><br>  Below is a user program interface for obtaining meta-information about classes.  Here private members of a class, implementations of methods and some other husk are omitted.  Only the interface that interacts with the metadata of the registered classes: <br><br><div class="spoiler">  <b class="spoiler_title">Cpprt library interface</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ,     cpprt. // -      //     . class CPPRTRuntime { public: //---------------------------------------------------------------- //  // ,     //    .   //   ,   //    .    //       //   CPPRTRuntime. class ClassData { public: //     . //      //        // ++.     // (ns -   namespace).   //      //     . // &lt;fullName&gt; = &lt;ns&gt;::&lt;ns&gt;::&lt;ns&gt;...&lt;ns&gt;::&lt;name&gt; const char *fullName() const; const char *name() const; // ,    ,   //   , ,  //     . bool isInterface(); //   ,   //   ClassData. ICPPRTManagedClass *createObject(); }; // ,     //       //   CPPRTRuntime::observeChildren(‚Ä¶).   //      : enum ObservingFlag { //    ,     //       // . ObservingFlagWithoutInterface = 1 &lt;&lt; 0, //       //     (  // ,     ). ObservingFlagRecursive = 1 &lt;&lt; 1, //    ,     //     ,   //    ( inBaseRegistry //  CPPRTRuntime::observeChildren(‚Ä¶) ObservingFlagIgnoreBase = 1 &lt;&lt; 2 }; // ,       //    .   , //    ( ,  //  ,    ) typedef char ObservingFlags; //---------------------------------------------------------------- //  //  ,      //    inBaseRegistry   ,  //    inFlags (. ).   , //   ,   ,  //   outRegistries. //    inBaseRegistry  NULL,    // ,  ,     // ,      //  ,   . void observeChildren(ClassData *inBaseRegistry, std::vector&lt;ClassData *&gt; &amp;outRegistries, ObservingFlags inInheritFlags = 0); //        //     . ClassData *getClassData(const char *inClassName); //  ,      //   . ICPPRTManagedClass *createObject(const char *inClassName); }; //        . CPPRTRuntime &amp;cppRuntime(); //      .   //       ,   //    . typedef CPPRTRuntime::ClassData CPPRTClassData;</span></span></code> </pre> <br></div></div><br><br>  Examples of using the API to interact with metadata: <br><br>  1. Creating an object by the string name of its class: <br><pre> <code class="cpp hljs">ICPPRTManagedClass *theTestClassObject = cppRuntime().createObject(‚ÄúTestClass‚Äù);</code> </pre><br><br>  2. Printout of information about the abstractness of a class according to a pointer to an object of the base class: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printObjectClassInformation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ICPPRTManagedClass *inObject)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CPPRTRuntime::ClassData &amp;theClassData = *inObject-&gt;getClassDataRT(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; ‚ÄúClass ‚Äù &lt;&lt; theClassData.fullName() &lt;&lt; ‚Äú is ‚Äù &lt;&lt; theClassData.isInterface() ? ‚Äúabstract‚Äù : ‚Äúconcrete‚Äù &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre><br><br>  3. Listing of the names of all classes inherited from the class TestClass.  In this case, the successors of the heirs are selected recursively, abstract classes are filtered, and the meta-information for the TestClass class itself is not added to the resulting list: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;CPPRTClassData *&gt; theChildData; cppRuntime().observeChildren(TestClass::gClassData, theChildData, ObservingFlagWithoutInterface | ObservingFlagRecursive | ObservingFlagIgnoreBase); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> theIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>, theSize = theChildData.size(); theIndex &lt; theSize; ++theIndex) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; theChildData[theIndex]-&gt;fullName() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre><br><br>  4. Listing the names of all classes without ancestors: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;CPPRTClassData *&gt; theBasesData; cppRuntime().observeChildren(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, theBasesData); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> theIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>, theSize = theBasesData.size(); theIndex &lt; theSize; ++theIndex) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; theBasesData [theIndex]-&gt;fullName() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre><br><br><h3>  Class registration </h3><br><br>  Now let's look at what is needed to register classes: <br><br>  1. The class to be registered must have an ICPPRTManagedClass class in its ancestors;  it is enough that the base class of the user hierarchy inherits the ICPPRTManagedClass.  Example: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// UserClasses.h //     . //  ICPPRTManagedClass. class UserBaseClass : public ICPPRTManagedClass { . . . // &lt;-  ,    }; //   UserBaseClass  ICPPRTManagedClass, // UserInheritedClass    ICPPRTManagedClass. class UserInheritedClass : public UserBaseClass { . . . // &lt;-  ,    };</span></span></code> </pre><br><br>  2. A registered class must have methods and fields that are used by the cpprt library for work.  In order not to write them manually, it is better to use macros for registration.  There are two groups of macros: to declare the required fields and methods, and to implement. <br><br>  <b>Declaration</b>  CPPRT_DECLARATION - macro for the declaration.  Takes one argument - the name of the class that is registered (not the string with the name, but the name itself).  The code in which the macro is expanded ends with the protected access specifier.  This is done to more easily include a macro in the existing code, because if you use a macro at the beginning of a class declaration, access for all subsequent declared members of the class will remain the same as without using a macro (as in C ++, before declaring another access specifier, the declared members classes have protected access).  Example: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// UserClasses.h class UserBaseClass : public ICPPRTManagedClass { //   ,  ,   //     //   protected. CPPRT_DECLARATION(UserBaseClass) . . . // &lt;-     }; class UserInheritedClass : public UserBaseClass { //       //    ‚Äì   //   CPPRT_DECLARATION(UserInheritedClass) . . . // &lt;-     };</span></span></code> </pre><br><br>  <b>Implementation</b> .  The main part of the class meta-information is transmitted as part of the implementation macro.  These macros are divided into groups depending on the number of base classes. <br><br>  <b>CPPRT_CLASS_IMPLEMENTATION_BASE_ {N} (C, B1, ..., BN)</b> <br>  <b>CPPRT_INTERFACE_IMPLEMENTATION_BASE_ {N} (C, B1, ..., BN)</b> <br>  <i>N is the number of base classes.</i> <br>  <i>C</i> - the full name of the class for which the implementation is described. <br>  <i>B1</i> ... <i>BN</i> are the full names of the base classes.  These classes must be registered under cpprt. <br><br>  The macro with CLASS is used for registering classes whose objects can be created, and with INTERFACE for registering abstract classes.  Example: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// UserClasses.cpp CPPRT_CLASS_IMPLEMENTATION_BASE_0(UserBaseClass); CPPRT_CLASS_IMPLEMENTATION_BASE_1(UserInheritedClass, UserBaseClass);</span></span></code> </pre><br><br>  Actually, everything.  The things described are sufficient for registering a class within cpprt.  You can see a live example within the repository (the build target is <i>simple_example</i> , the -DBUILD_EXAMPLES = {OFF / ON} option to generate a project via CMake). <br><br>  Here, too, I will give an example for registering a more complex class hierarchy, the class inheritance hierarchy for some typical shooter: <br><br><div class="spoiler">  <b class="spoiler_title">WeaponClasses.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Abstract classes // Bases class IWeapon : public ICPPRTManagedClass { CPPRT_DECLARATION(IWeapon) . . . }; class IAntiAir { CPPRT_DECLARATION(IAntiAir) . . . }; // Classification by weapon type class IMachineGunWeapon : public IWeapon { CPPRT_DECLARATION(IMachineGunWeapon) . . . }; class IRocketWeapon : public IWeapon { CPPRT_DECLARATION(IRocketWeapon) . . . }; // Concrete classes // Machine guns class M16 : public IMachineGunWeapon { CPPRT_DECLARATION(M16) . . . }; class Abakan : public IMachineGunWeapon { . CPPRT_DECLARATION(Abakan) . . . }; class Uzi : public IMachineGunWeapon { CPPRT_DECLARATION(Uzi) . . . }; // Rocket weapons class Stinger : public IRocketWeapon, public IAntiAir { CPPRT_DECLARATION(Stinger) . . . }; namespace IraqEdition { class Bazuka : public IRocketWeapon { CPPRT_DECLARATION(Bazuka) . . . }; } // Tank inner classes class Tank { public: class MachineGunTurret : public Abakan, public IAntiAir { CPPRT_DECLARATION(MachineGunTurret) . . . }; class RocketTurret : public IRocketWeapon { CPPRT_DECLARATION(RocketTurret) . . . }; };</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">WeaponClasses.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Abstract classes // Bases CPPRT_INTERFACE_IMPLEMENTATION_BASE_0(IWeapon) CPPRT_INTERFACE_IMPLEMENTATION_BASE_0(IAntiAir) // Classification by weapon type CPPRT_INTERFACE_IMPLEMENTATION_BASE_1(IMachineGunWeapon, IWeapon) CPPRT_INTERFACE_IMPLEMENTATION_BASE_1(IRocketWeapon, IWeapon) // Concrete classes // Machine guns CPPRT_CLASS_IMPLEMENTATION_BASE_1(M16, IMachineGunWeapon) CPPRT_CLASS_IMPLEMENTATION_BASE_1(Abakan, IMachineGunWeapon) CPPRT_CLASS_IMPLEMENTATION_BASE_1(Uzi, IMachineGunWeapon) // Rocket weapons CPPRT_CLASS_IMPLEMENTATION_BASE_2(Stinger, IRocketWeapon, IAntiAir) CPPRT_CLASS_IMPLEMENTATION_BASE_1(IraqEdition::Bazuka, IRocketWeapon) // Tank inner classes CPPRT_CLASS_IMPLEMENTATION_BASE_2(Tank::MachineGunTurret, IRocketWeapon, IAntiAir) CPPRT_CLASS_IMPLEMENTATION_BASE_1(Tank::RocketTurret, IRocketWeapon)</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Player.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: IWeapon *_weapon; <span class="hljs-comment"><span class="hljs-comment">// Set with NULL value in constructor . . . public: // It's possible to set player's weapon by its class name. void setWeapon(const char *inName) { if (NULL != _weapon) delete _weapon; _weapon = cppRuntime().createObject(inName); } . . . };</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Testdrive.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Player thePlayer; thePlayer1.setWeapon(<span class="hljs-string"><span class="hljs-string">"Abakan"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br><br><h3>  Other features </h3><br><br>  In the framework of cpprt, it is not necessary to register all classes and you can omit all the heirs for the classes.  This can be useful, for example, to hide part of the service interface in class inheritance.  For example: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Dog.h class Dog : public Mammal, public ISerializable { CPPRT_DECLARATION(Dog) . . . }; // Dog.cpp // ISerializable       Dog //   .     , //          // .    ISerializable     // . CPPRT_CLASS_IMPLEMENTATION_BASE_1(Dog, Mammal)</span></span></code> </pre><br><br><a name="console"></a><h3>  Console tool </h3><br><br>  Together with the library, in addition to the example, the tool comes in the delivery console (console).  It provides several commands for creating objects by the string name of their classes (objects are stored in a test array), as well as for viewing inheritance hierarchies for registered classes.  A short description of the commands supported by the console: <br><br>  <b>help</b> <br>  Command that, when called, prints out short information about all commands available to the console. <br><br>  <b>print (-c) ({full-class-name})</b> <br>  If this command is called without arguments, then it prints a list of all the objects created at the moment with an indication of their classes. <br>  If the -c flag (optional flag) is passed, but the class name is not passed (optional parameter {full-class-name}), then this call prints the trees of the inherited classes for all registered classes that do not have base classes (root classes ). <br>  If, in addition to the -c flag, the {full-class-name} parameter is given, which specifies the class name, then this command prints the tree of the registered heir classes for the class with the passed name. <br><br>  <b>create {class-name} {object-name}</b> <br>  A command that creates an object of a registered class {class-name} named {object-name} in a test array of objects. <br><br>  <b>delete {object-name}</b> <br>  A command that removes an object from a test array of objects by its name. <br><br>  <b>exit</b> <br>  The command to exit the console.  Ends the execution of the console program. <br><br>  Perhaps, I told everything about the possibility of using the library.  If you want to know how all this is implemented - most of the techniques and tricks that were used in the library, I described in detail in the first article of the cycle ( <a href="https://habrahabr.ru/post/281993/">link</a> ).  Her reading is enough to understand the principles of the library. <br><br><h3>  Future plans </h3><br><br>  1. Implement the ability to bypass the inheritance tree, not only from ancestors to heirs, but also vice versa. <br><br><div class="spoiler">  <b class="spoiler_title">Prototype</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;ClassData *&gt; theParentsData; cppRuntime().observeParents(TestClass::gClassData, theParentsData, ObservingFlagWithoutInterface | ObservingFlagRecursive);</code> </pre><br></div></div><br><br>  This feature is implemented elementarily within the framework of the current implementation - you need to make internal-methods to bypass the heirs of the template, with the Boolean argument ObserveChildren, depending on which true / false value to select the metadata of the heirs / base classes for the transferred metadata. <br><br>  2. Establish normal data encapsulation for library classes.  With the current library design, many unnecessary types and methods stick out (for example, the same CPPRTRuntime class) that clutter up the library user interface. <br><br>  3. Make iterators to be able to bypass the meta-information tree for the classes.  This will save data usage when recursively traversing the tree of heirs and allows the user to walk around the class inheritance tree without violating encapsulation. <br><br><div class="spoiler">  <b class="spoiler_title">Prototype</b> <div class="spoiler_text"><pre> <code class="cpp hljs">CPPRTRuntime::iterator theIterator = cppRuntime().iteratorForClassData(TestClass::gClassData); <span class="hljs-comment"><span class="hljs-comment">//   -  TestClass   , //        ClassToFind. CPPRTRuntime::ClassData *theData = NULL; while((theData = theIterator.nextChild()) != NULL) { if (0 == strcmp(theData-&gt;name(), "ClassToFind")) { //    -    ‚Äì     theIterator.moveToChild(); } }</span></span></code> </pre><br></div></div><br><br>  Alternatively, the iterator can use the visitor design pattern (for example, as done in <a href="http://clang.llvm.org/doxygen/classclang_1_1RecursiveASTVisitor.html">clang</a> , here is a <a href="https://kevinaboos.wordpress.com/2013/07/23/clang-tutorial-part-ii-libtooling-example/">great example of use</a> ).  This approach is generally often used to bypass tree data structures. <br><br>  4. Make it possible to add user information to the classes - so that you can filter the classes according to this data upon request. <br><br><div class="spoiler">  <b class="spoiler_title">Prototype</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Classes.cpp CPPRT_CLASS_IMPLEMENTATION_BASE_1(Car, IVehicle) CPPRT_CLASS_IMPLEMENTATION_BASE_1(Bus, IVehicle) CPPRT_CLASS_IMPLEMENTATION_BASE_1(BigBus, IVehicle). //   ‚Äúbold_in_editor‚Äù   //  BigBus. addTag(‚Äúbold_in_editor‚Äù); // Using.cpp //     ,   //   ‚Äúbold_in_editor‚Äù std::vector&lt;ClassData *&gt; theChildData; cppRuntime().observeChildren(TestClass::gClassData, theChildData, ObservingFlagWithoutInterface | ObservingFlagRecursive | ObservingFlagIgnoreBase, ‚Äúbold_in_editor‚Äù); for (size_t theIndex = 0, theSize = theChildData.size(); theIndex &lt; theSize; ++theIndex) { std::cout &lt;&lt; theChildData[theIndex]-&gt;fullName() &lt;&lt; std::endl; }</span></span></code> </pre><br></div></div><br><br>  4. Make template support.  This is a very nontrivial task.  You need to think well about whether you really need (most likely, need) and how you can describe the API for using template-specific classes. <br><br>  5. To think about the possibility of working with class metadata at runtime.  For example, registering a class at runtime, or vice versa - deleting classes from the list of registered ones. <br><br><div class="spoiler">  <b class="spoiler_title">Prototype</b> <div class="spoiler_text"><pre> <code class="cpp hljs">cppRuntime().createClassData(‚ÄúMyRTClass‚Äù, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CPPRTRuntime::Fabric&lt;MyRTClass&gt;() ); . . . <span class="hljs-comment"><span class="hljs-comment">// Use registered class . . . cppRuntime().removeClassData(‚ÄúMyRTClass‚Äù);</span></span></code> </pre><br></div></div><br><br>  In principle, this functionality is available now, but it‚Äôs rather a design bug than a feature ... In general, this feature is probably dangerous and you should think well if it is needed at all. <br><br>  6. <i>Place for your suggestions</i> .  Suggest what else might be useful.  Let's discuss. <br><br><h2>  The conclusion of the article and the conclusion of the cycle </h2><br><br>  On this, perhaps, you can put a bullet.  I told everything I wanted about the cpprt library.  I hope, dear reader, you have learned something useful from this series of articles.  I would be glad even more if you right now took some library gathering dust without work on your home repository, designed it as it should and published it.  Tell people about it in some of your articles! <br><br>  Well, it will also be nice if someone, interested, will contribute to the development of the cpprt library. <br><br><div class="spoiler">  <b class="spoiler_title">About the mysterious main project</b> <div class="spoiler_text">  So, it‚Äôs interesting what the ‚Äúmain project‚Äù is? .. If you are reading this, then the plan is a success. <br><br>  The main project is a library that allows you to use data about the state of an object, transmitted for serialization, in order to generate meta-information about a given object and further use of this meta-information. <br>  I note that this approach is not new - it is often used for game projects, and even some of the cpprt analogs mentioned in the first article allow the user to set such information for the class fields at the time of class registration.  I will list here the implemented and planned features of the project, because of which, in my opinion, they should be dealt with: <br>  1. The library does not only collect metadata about the states of objects, but the collected data is also used to generate a GUI through which you can influence the states of objects.  Due to this, it is enough for the user of the library to describe the save and load methods for the object in order to get the <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BA%25D0%25BD%25D0%25BE_%25D0%25B8%25D0%25BD%25D1%2581%25D0%25BF%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25B0_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D0%25B2">GUI object inspector</a> automatically generated for it.  At the moment, the GUI is made on Qt, but the code was designed with an eye to supporting different GUIs (including the user's GUI, which can be connected by implementing the interface).  The plans to the bottom of the opportunity to try, opening up due to such a look at generating a GUI. <br>  2. I am always a fan of the concept of middleware.  I was impressed by the opportunity to find common features in a number of tools that have the same purpose, to bring this common thing into the interface, and then slip different tools under this interface, having the opportunity to choose the interface implementation ... So, it was conceived how to implement the concept of middleware.  Due to this, I want to achieve maximum ease of integration by the library user into his project, up to the transfer of the user type system to the library template classes. <br><br>  At the moment, the library is written to the state of the basic working prototype, but it requires expanding and deepening the functionality, and also requires bringing the project structure into a public form (adding documentation, examples, tests, tools, etc.). <br><br>  I was hoping to cut this library myself, but at some point I realized that I was sewing up ... Join us, become co-founders of the project.  If you are interested in any degree of everything that is written here - write in a personal, I will tell you more. <br><br>  Let's bring together the library in a proper form, publish it, make a series of articles for PR ... You never know - it will suddenly take off, and someday we will remember how we laid together the beginning of a new milestone for creating a GUI within the C ++ language? <br></div></div><br><br>  Thank you for reading all this!  I hope I managed to say at least something useful! <br><br>  <i>The author thanks readers in advance for pointing out errors in the article, constructive advice and suggestions.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Captions</b> <div class="spoiler_text">  <b>Editing article:</b> Sergey Semenyakin <br><br>  Perezalil picture from bmp to jpg at the direction of <a href="https://habrahabr.ru/users/a1ien_n3t/" class="user_link">a1ien_n3t</a> .  Thanks to him. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/281997/">https://habr.com/ru/post/281997/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281985/index.html">For the year, Google analyzed 760,000 hacking sites and announced a new tool to alert webmasters.</a></li>
<li><a href="../281989/index.html">Intel security hardware technology: a new word in the protection of biometric applications. Part one</a></li>
<li><a href="../281991/index.html">The PDO MSSQL driver (pdo_sqlsrv) for PHP7 is out</a></li>
<li><a href="../281993/index.html">Droplet of reflection for C ++. Part One: Development Retrospective</a></li>
<li><a href="../281995/index.html">Droplet of reflection for C ++. Part Two: Posting on GitHub</a></li>
<li><a href="../281999/index.html">The experience of automating difficult correspondence (Part 2. Outgoing)</a></li>
<li><a href="../282001/index.html">New course on microcontrollers - a joint project of industry and universities</a></li>
<li><a href="../282003/index.html">Setting up PhpStorm for layout on Windows</a></li>
<li><a href="../282005/index.html">How to become an IT princess</a></li>
<li><a href="../282009/index.html">RUVDS will provide BCS clients with virtual servers in the heart of the Moscow Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>