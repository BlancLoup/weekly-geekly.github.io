<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scaling is simple. Part Three - Strategies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous parts ( here and here ) we talked about the basic architectural principles of building scalable portals. Today we will continue to tal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scaling is simple. Part Three - Strategies</h1><div class="post__text post__text-html js-mediator-article">  In the previous parts ( <a href="http://habrahabr.ru/post/209202/">here</a> and <a href="http://habrahabr.ru/post/209352/">here</a> ) we talked about the basic architectural principles of building scalable portals.  Today we will continue to talk about optimizing a properly built portal.  So, scaling strategies. <br><a name="habracut"></a><br><br><h5>  The potential of local optimization is very limited. </h5><br>  Caches are a good thing to enhance the impact force of an individual component or service.  But each optimization once comes to an end.  This is the latest moment when it is worth thinking about how to maintain multiple instances of your services, in other words, how to scale your architecture.  Different types of nodes can be scaled differently.  The general rule is as follows: the closer the component is to the user, the easier it is to scale it. <br><br>  Performance is not the only reason to work on scaling.  The availability of the system to a large extent also depends on whether we can run several instances of each component in parallel, and, therefore, be able to transfer the loss of any part of the system.  The top of perfection of scaling is to be able to administer the system in an <i>elastic way</i> , that is, to adjust the use of resources to traffic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Scaling the presentation layer is usually easy.  This is the level to which web applications run in a web server or servlet container (for example, tomcat or jetty) and are responsible for generating a markup, that is, HTML, XML, or JSON. <br><br>  You can simply add and remove new servers as needed - as long as a single web server: <br><ul><li>  stateless, or </li><li>  its state is recoverable ‚Äî for example, because it consists entirely of caches, or </li><li>  their (caches) state refers to specific users and there is a guarantee that the same user will always get on the same server (session stickiness). </li></ul><br><br>  It is more difficult to scale the application level (application tier) - the level where services run.  But before moving on to the application level, let's look at the level behind it ‚Äî the database. <br>  The sad truth about scaling through the database is that it does not work.  And although from time to time representatives of various database vendors are trying to convince us again that they can scale precisely this time - at the most crucial moment they will leave us.  Little disclaimer: I'm not saying that you should not do database clusters or replication a la master / slave.  There are many reasons for using clusters and replicas, but <i>performance</i> is not one of them. <br><br>  This is the main reason why applications scale so poorly through databases: the main task of the database is only reliable data storage (ACID and all that).  Reading the data is much harder for them (before shouting ‚Äúhow‚Äù and ‚Äúwhy‚Äù, think: why do you need such a number of indexers like lucene / solar / elastic search?).  Since we cannot scale through the base, we need to scale through the application tier.  There are many reasons why this works perfectly, I will mention two: <br><ul><li>  At this level, a large part of the treatise "Knowledge of the application and its data."  We can scale, knowing what the application does and how it is used. </li><li>  Here you can work with the help of programming language tools that are much more powerful than the tools provided to us by the database level. </li></ul><br><br>  There are different strategies for scaling services. <br><br><h5>  Scaling strategies. </h5><br><br>  First you need to determine what the state of the service (state).  The state of one instance of the service is that information that is known only to him and which, accordingly, distinguishes it from other instances. <br>  A service instance is usually a JavaVM in which one copy of this service runs.  Information that defines its state is usually data that goes into the cache.  If the service has no own data at all, it is stateless (stateless).  In order to reduce the load on any service, you can run multiple instances of this service.  Strategies for allocating traffic to these instances are, in general, scaling strategies. <br><br>  The simplest strategy is Round-Robin.  In addition, each client "talking" with each instance of the service, which are used in turn, that is, one after another, in a circle.  This strategy works well as long as the services do not have a stateless state and perform simple tasks, such as sending emails through the external interface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afc/538/9b3/afc5389b3fd503c0282ab6aa78982db8.jpg" alt="Distribute calls to services on the principle of Round-Robin."><br>  <i>Scheme 5: Distribute calls to services on the principle of Round-Robin</i> <br><br>  When instances of services have states, they should be synchronized with each other, for example, by announcing changes in state via EventChannel or another Publish / Subscriber version: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cfd/b31/d24/cfdb31d24aa5a103a9a09093f2203b10.jpg" alt="Round-Robin with state synchronization"><br>  <i>Scheme 6: Round-Robin with state synchronization</i> <br><br>  In addition, each instance informs the other instances of all changes that it makes to each saved object.  In turn, the remaining instances repeat the same operation locally, changing their private state (state), and thereby maintaining the state of the service consistent (consistent) across all instances. <br><br>  This strategy works well with little traffic.  However, with its increase, there are problems with the ability to simultaneously change the same object in several instances. <br><br>  Routing is used to combat this.  In this case, routing means that the service instance is selected depending on the context.  The context can be a client, an operation or data.  Data routing, <i>sharding</i> , is the most powerful routing tool: it refers to the routing algorithm that selects the target instance of the service based on the parameters of the operation (that is, data). <br><br>  Ideally, we have a unique parameter, such as UserId, which can be easily converted to numerical form and divide with the remainder.  Separating by the number of working instances, the remainder points to the target instance of the request: all queries with the remainder 0 go to the first instance, with the remainder 1 to the second instance, and so on. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce4/c8a/7e0/ce4c8a7e09fd3ac339f42de93f653476.jpg" alt="Sharding (sharding) on ‚Äã‚Äãthe remainder"><br>  <i>Scheme 7: Sharding Remaining</i> <br><br>  This strategy has a useful side effect: due to the fact that all requests according to the same user always fall on the same instance, the data is fragmented.  This means smaller caches, if desired, fragmented databases (that is, each instance or their group has its own database) and other optimization tastes. <br><br>  With the presence of an appropriate <a href="http://en.wikipedia.org/wiki/Middleware">middleware,</a> you can step one step further and combine different strategies.  For example, you can group several instances into groups into which to distribute requests by sharding, and inside groups use Round-Robin for elasticity.  The number of such combined strategies is too large ( <a href="https://confluence.opensource.anotheria.net/display/DISTRIBUTEME/Routing%2Band%2BFailing%2BStrategies">another example</a> ) to describe them all in one post, and depends on the specific problem. <br><br>  Not always and not any data can be segmented, especially when one operation simultaneously changes two data sets in different contexts.  A classic example is the delivery of a message from user A to user B, in which both mailboxes change simultaneously.  It is impossible to find an algorithm for distributing data across instances (sharding), which ensures that user A and B boxes are in one instance of the service.  But <s>there is a ruin to the old woman</s> and there are solutions for this situation.  The simplest thing is to implicitly divide the service (ideally through middleware) so that the client knows nothing about it.  For example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e0/f6d/ab5/8e0f6dab5414b6cfe85eeeb6f286ca74.jpg" alt="Proxy services"><br>  <i>Scheme 8: Proxy Services</i> <br><br>  The task of instances of proxy services is to process and respond to reading requests, not bringing them to the master service.  Since we have much more reading than writing operations (remember the <a href="http://habrahabr.ru/post/209202/">initial installation</a> ), having saved the master service from them, we will make his life much easier.  Reading operations usually take place in the context of one (active) user and, therefore, can be ‚Äúextended‚Äù, as described above.  The remaining writing operations go through a proxy to the master, but, due to the fact that the bulk of the load remained on the proxy, much less hemorrhoids are already delivered. <br><br><h5>  Epilogue </h5><br>  Within the framework of this series ( <a href="http://habrahabr.ru/post/209202/">here</a> , <a href="http://habrahabr.ru/post/209352/">here</a> and, in fact, here) we talked about how to find the right architecture and with what tools to scale it.  I hope I convinced the reader that the time spent searching and following architectural paradigms is an investment that pays off many times in difficult times.  Slave-Proxies, Round-Robin routing or zero-cache is not what we think about first of all, starting to work on a new portal.  Yes, and do not embed them "just in case" - it is important to know how to use them and have an architecture that allows the use of such tools. <br><br>  Not every portal should scale, but those that should be able to do it quickly.  At the same time, relying solely on technology (NoSQL, etc.) means putting the steering wheel in the wrong hands, and if the choice of technology is wrong, collect fragments of your system with a broom. <br><br>  If from the very beginning you choose the right architecture, find your principles and paradigms and adhere to them, then the answer to the difficulties and challenges that arise can always be found. <br><br>  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/209758/">https://habr.com/ru/post/209758/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209742/index.html">Team work on interfaces</a></li>
<li><a href="../209744/index.html">Successful or unsuccessful, that is the question: other crowdfunding statistics</a></li>
<li><a href="../209746/index.html">NSA Spy Gadgets</a></li>
<li><a href="../209752/index.html">Selenium and BrowserMobProxy: more fun together!</a></li>
<li><a href="../209754/index.html">We write a website with news on Wt</a></li>
<li><a href="../209768/index.html">Steve Wozniak: Actually, the film was basically a lie about me.</a></li>
<li><a href="../209772/index.html">China introduced its own national operating system</a></li>
<li><a href="../209774/index.html">The interplanetary probe "Rosette", aimed at the study of the comet 67P / CG Churyumov-Gerasimenko, came out of hibernation after 2.5 years</a></li>
<li><a href="../209776/index.html">The brain processes images in 13 milliseconds.</a></li>
<li><a href="../209778/index.html">Unconfirmed transaction, or return cryptocurrency from non-existence</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>