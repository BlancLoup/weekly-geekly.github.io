<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick releases on a massive scale.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over time, the software industry has come up with several ways to release quality code more quickly and safely. Many are based on ideas like continuou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick releases on a massive scale.</h1><div class="post__text post__text-html js-mediator-article">  Over time, the software industry has come up with several ways to release quality code more quickly and safely.  Many are based on ideas like continuous integration, continuous software delivery, flexible development methodology, DevOps, and test-driven development.  All of these methodologies combine one thing: they allow developers to quickly release code in safe, small, sequential steps. <br><br>  The development processes on Facebook have grown organically from these methodologies and have included many stages of fast iterations without the strict adherence of any particular scheme.  Such a flexible, pragmatic approach allowed us to successfully launch web and mobile products on a fast schedule. <br><br>  For years, we updated Facebook's frontend three times a day using a simple strategy for the master and release branches.  Engineers selectively selected from the master branch changes in the code, which passed a series of automated tests, for inclusion in the release branch, where the daily updates came from.  In general, this method was chosen from 500 to 700 changes per day.  Once a week, we cut off a new release branch and collected changes that weren't selected during the week. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/831/f95/bdb/831f95bdb7f442b7a0f4f266de11533c.jpg"><br><a name="habracut"></a><br>  Such a system scaled well, starting with several developers in 2007 to several thousand today.  The good news is that as the number of programmers increases, the amount of work done has increased - the <a href="https://research.fb.com/publications/continuous-deployment-at-facebook-and-oanda/">speed at which the code was released scaled</a> along with the size of the team.  However, for the daily and weekly releases, it took some effort, appointing developers responsible for the releases, in addition to the available tools and automated systems.  We understood that the accumulation of more and more large portions of code for release could not last forever, as the number of developers continued to grow. <br><br>  By 2016, we came to the conclusion that the model of two branches with manual selection of fragments reached the limit.  More than 1000 changes per day were made to the master branch, and the weekly push reached 10,000 changes.  The amount of effort to coordinate and release such a large release every week has become unviable. <br><br>  In April 2016, we decided to transfer <a href="http://facebook.com/">facebook.com</a> to an almost continuous ‚Äúpush from master branch‚Äù system.  Over the next year, we gradually rolled it out, first for half of our employees, then from 0.1% to 1% of web traffic in production, then for 10%.  Each of these advances helped test the ability of our tools and processes to work with a higher frequency of pushing and getting feedback from the real world.  The main goal was to make sure that the new system improves users' perception of the site - well, at least it does not spoil it.  After almost a year of planning and development for three days in April 2017, we deployed 100% of our production servers to run the code directly from the master branch. <br><br><h2>  Continuous code delivery on a large scale. </h2><br>  While a truly uninterrupted software delivery system means that every single change quickly goes into production, the speed of developing on Facebook required creating its own system that pulls thousands of changes every few hours.  Changes in this quasi-continuous software delivery system are usually small and gradual, and very few of them are actually visible to the end user.  Each release rolls out to 100% of the production servers in several stages in a few hours, so that we can stop pushing if we notice any problems. <br><br><img src="https://habrastorage.org/web/d60/03c/7b3/d6003c7b3fb54528a9734b45a2f855b5.jpg"><br><br>  Changes that passed a series of internal automated tests and fell into the master branch are rolled out for Facebook employees.  At this stage, alerts about blocking push are provided, if we have regressed, and the emergency stop button quickly stops further release distribution.  If everything is in order, we roll out the changes for 2% of production servers, where we again collect feedback and monitor warnings, especially for extreme cases, which, when tested on our own employees, could pass unnoticed.  In the end, we roll out the changes for 100% production, and our tool Flytrap collects user reports and informs about any anomalies. <br><br>  Many changes are first held in the Gatekeeper system to roll out releases of the web and mobile versions, regardless of new features.  This helps reduce the risk that a particular update will cause problems.  If we find a problem, we simply disable Gatekeeper instead of returning to the previous version or making corrections to the next one. <br><br>  The quasi-continuous release cycle has some advantages: <br><br>  <b>No patches needed</b> .  In a system with three pushups per day, if a critical change was urgently needed that did not fit into the schedule, then a patch had to be applied.  These unplanned pushes are harmful because they require some effort on the part of the developers and may conflict with the next planned push.  With the new system, in the absolute majority of cases, changes that require a patch are simply made to the master branch and rolled up with the next release. <br><br>  <b>Better support for the global development team</b> .  We tried to adapt the three daily pushings to the work schedule of development offices in different parts of the world, but even in such conditions, one weekly release still required the attention of all developers at a specific date and time, which is not always convenient in their time zones.  A new quasi-continuous system means that all developers in any time zone can write and deliver their code when they are comfortable. <br><br>  <b>The impetus for creating new tools, automation and the processes needed for scaling</b> .  When we take on such projects, they are like a test of pressure for many of our development teams and systems.  As a result, we have improved push tools, change review tools, testing infrastructure, capacity management system, traffic routing systems, and improvements in many other areas.  The developers of all these systems wanted the quick release project to succeed.  As a result, the improvements made will help the company to better prepare for future growth. <br><br>  <b>Convenience to users</b> .  If it takes days and weeks to learn how a new code behaves, then the developer can already move on to another job.  With a continuous supply of software, engineers do not need to wait a week or more to get feedback on the changes made.  They quickly receive information that does not work, and quickly roll out small changes as they become ready, rather than waiting for the next big release.  In terms of infrastructure, the new system is much more convenient in responding to rare events that may affect people.  Ultimately, the engineers became closer to the users of the site, and the development quality and product reliability improved. <br><br><h2>  Application of continuous delivery for mobile platform </h2><br>  The transition to a quasi-continuous system on the web was made possible in part because we control the entire technological stack, we can create or improve the necessary tools.  Delivering to mobile platforms is a more difficult task, since many existing tools for developing and deploying on a mobile platform do not support fast iterations for continuous software release. <br><br>  Facebook has tried to improve the situation in this area and has released a number of free tools that are specifically sharpened for rapid mobile development.  Among them are <a href="https://nuclide.io/">Nuclide</a> , <a href="https://buckbuild.com/">Buck</a> , <a href="https://github.com/phacility/phabricator">Phabricator</a> , various libraries for iOS, <a href="https://facebook.github.io/react-native/">React Native</a> and <a href="http://fbinfer.com/">Infer</a> .  Together, these tools for building and testing allow you to produce high-quality code, ready for quick delivery to mobile platforms. <br><br>  Our continuous integration stack consists of three levels: builds, static analysis and testing. <br><br><img src="https://habrastorage.org/web/f10/6fa/b1e/f106fab1eda1403582eab302cf671764.jpg"><br><br>  As soon as the code comes from the development branch to our mobile master branches, it is first collected for all the products it can relate to.  On a mobile platform, this refers to the builds of Facebook, Messenger, Pages Manager, Instagram and other applications at each commit.  We also collect several variants of each application to ensure that all microprocessor architectures and simulators supported by this program are covered. <br><br>  As long as the builds arrive, we launch the linters and our tool for static analysis of the Infer code.  This helps to identify null-exceptions, resource and memory leaks, unused variables and risky system calls, as well as flagging inconsistencies with Facebook programming rules. <br><br>  The third parallel system, mobile automated testing, contains thousands of unit tests, integration tests and end-to-end non-breaking tests, which are performed using tools like Robolectric, XCTest, Junit and WebDriver. <br><br>  This set of tools for building and testing not only runs on each commit, but also runs several times throughout the life cycle of each change in the code.  Only under Android, we collect from 50,000 to 60,000 builds per day. <br><br><img src="https://habrastorage.org/web/24f/cbc/334/24fcbc3345b040fe8ac20a995e9f16f8.jpg"><br><br>  Using the traditional methods of continuous software delivery on our mobile stack, we moved from releases every four weeks to a two-week and then a weekly cycle.  Today, on the mobile platform, we use the same model of manual selection of changes that used to be used on the web.  Although we roll out changes to production only once a week, it is still important to pre-test the code in real conditions so that engineers get feedback from users in advance.  Every day we release release candidates for beta testers, among which there are about 1 million <a href="https://play.google.com/apps/testing/com.facebook.katana">testers for Android</a> . <br><br><img src="https://habrastorage.org/web/3d4/310/8c6/3d43108c6d104ae0bc4e1a8ad0082cd4.jpg"><br><br>  While we increased the frequency of release of releases, the number of our developers for mobile platforms increased 15 times, and the speed of development also increased significantly.  Despite this, the <a href="https://research.fb.com/publications/continuous-deployment-of-mobile-software-at-facebook-showcase/">data from 2012 to 2016 show</a> that the engineering productivity of engineers remained unchanged under Android and iOS, both in the number of lines of code and in the number of guns.  Also, the number of critical problems in mobile applications almost did not change, regardless of the number of releases, that is, the quality of the code was not affected by scaling. <br><br>  It is very pleasant to work in the field of design releases against the background of such improvements in the available tools and methodologies.  I am very proud of the Facebook teams that worked together to create, in my opinion, the world's most advanced systems for introducing web and mobile applications of this scale.  This would not have been possible without a strong release engineering team that was at the forefront of the infrastructure department.  This group on Facebook will continue to promote initiatives that improve the release process for developers and users, and will continue to share their experiences, tools and best practices. </div><p>Source: <a href="https://habr.com/ru/post/337014/">https://habr.com/ru/post/337014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337004/index.html">Andrei Ershov about the evolution of Future in Java and Scala on jug.msk.ru</a></li>
<li><a href="../337006/index.html">Microsoft Excel add-in development using Excel-DNA library</a></li>
<li><a href="../337008/index.html">Ansible Dynamic Inventory from DNS or how to waste time searching for standards</a></li>
<li><a href="../337010/index.html">Ideal OS: rebooting desktop operating systems (part 1)</a></li>
<li><a href="../337012/index.html">How to use multichannel support system in retail. Case Desk Client</a></li>
<li><a href="../337022/index.html">The digest of interesting materials for the mobile developer # 219 (August 28 - September 3)</a></li>
<li><a href="../337024/index.html">Dive into BerkeleyDB JE. Introduction to Collections API</a></li>
<li><a href="../337026/index.html">GSoC 2017 Project Report: ReactOS Apps Manager</a></li>
<li><a href="../337028/index.html">Bayes Summer | Deep | Bayes Summer School Materials in In-Depth Learning</a></li>
<li><a href="../337030/index.html">How recursion works - explanation in flowcharts and video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>