<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Blast Wave in Unity3D (displacement shader)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone, I am writing a small 2D game and in parallel I would like to talk about the implementation of some things in Unity3D. 
 Programming gr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Blast Wave in Unity3D (displacement shader)</h1><div class="post__text post__text-html js-mediator-article">  Hello everyone, I am writing a small 2D game and in parallel I would like to talk about the implementation of some things in Unity3D. <br>  Programming graphics in itself is a very interesting activity with an unlimited number of variations of the result.  In this article I will describe the implementation of the distortion of space from the blast wave. <br><img src="https://habrastorage.org/files/1b4/3c8/4a1/1b43c84a1d7f43539c3c07c115c4445c.png"><br><a name="habracut"></a><br>  Usually, any distortions in the x, y planes are made using a normal map, which stores the amount of distortion in the color component.  Through this, water surface, blast waves, hot air, etc. are realized. <br><br>  In the game that I write a lot of shots, in this regard, the number of distortions is also large: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/yX4DVUDKP7w%3Ffeature%3Doembed&amp;xid=17259,1500004,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhigpZ_NYjXnnCymYDOA4eJKWIRDHg" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of the options: a mathematical model of distortion.  We directly in the shader consider the formulas distortion at a particular point.  The disadvantage of this approach is excessive load.  After all, all these miscalculations will be made for each pixel, so in programming graphics, textures are often used, within which the mathematical values ‚Äã‚Äãof something are calculated.  In the case of the blast wave, I took this texture: <br><img src="https://habrastorage.org/files/432/007/575/432007575ef5441a9ee340d5001cde61.png"><br><br>  Create a new shader in Unity: <br><br><pre><code class="cs hljs">Shader <span class="hljs-string"><span class="hljs-string">"Hidden/DisplacementEffect"</span></span> { Properties { _MainTex (<span class="hljs-string"><span class="hljs-string">"Base (RGB)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _DisplacementTex (<span class="hljs-string"><span class="hljs-string">"Displacement rt"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _DisplacementPower (<span class="hljs-string"><span class="hljs-string">"Displacement power"</span></span>, Float) = <span class="hljs-number"><span class="hljs-number">0.025</span></span> } SubShader { Pass { CGPROGRAM <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> vertex vert_img #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> fragment frag #include "UnityCG.cginc" uniform sampler2D _MainTex; uniform sampler2D _DisplacementTex; uniform float _DisplacementPower; float4 frag(v2f_img i) : COLOR { fixed4 displacementVector = tex2D(_DisplacementTex, i.uv); fixed2 uv_distorted = i.uv + _DisplacementPower * displacementVector.xy; return tex2D(_MainTex, uv_distorted); } ENDCG } } }</span></span></code> </pre> <br><br>  There are two parameters to the input: <b>_DisplacementTex</b> and <b>_DisplacementPower</b> .  The first is our distortion texture, and the second is the strength of the distortion. <br><br>  We get the distortion force in the current pixel: <br><pre> <code class="cs hljs">float4 displacementVector = tex2D(_DisplacementTex, i.uvgrab);</code> </pre><br><br>  Shift the uv-coordinates of the current pixel with the specified force and direction obtained above. <br><pre> <code class="cs hljs">float2 uv_distorted = i.uvgrab + _DisplacementPower * displacementVector.xy; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tex2D(_MainTex, uv_distorted);</code> </pre><br><br>  In other words, each pixel in the displacement texture stores in vector color by which we must move the pixel of the picture. <br><br>  The next problem: how to extend the code to an infinite number of explosions.  To the rescue comes a render to the texture.  Create a new camera that sees only a specific layer (layer), which I called displacements. <br><br>  At the moment of the explosion, you create on the scene at the point of the explosion a sprite displacement of the texture, which is placed on the displacements layer.  This layer sees only its separate camera, which renders to a different texture. <br><img src="https://habrastorage.org/files/094/754/e29/094754e2947d483bab1a1997dd958ae0.png"><br><br>  On the screenshot above, the Camera Preview shows what the camera ‚Äúsees‚Äù the displacements layer, and below it is the game result, where the displacements layer does not fall, but the result of the shader processing is already visible. <br><br>  In the shader, which we have already written above, the following texture will get into the <b>_DisplacementTex</b> parameter (for multiple shots): <br><img src="https://habrastorage.org/files/ea0/46f/eb8/ea046feb849746d5a2614a834096b81e.png"><br><br>  In fact, the black color of the texture is zero, in this place the colors of the resulting texture do not shift.  In the same place where the color distortion texture is traced.  As a result, any number of explosions and distortions are drawn in exactly two passes: <br><ul><li>  The first pass is a render of a separate camera layer displacements of all distortions into one texture.  The texture material for all the explosions is one, so the passage is one. </li><li>  The second pass is an effect on top of the scene, which at the entrance receives a render-texture of distortion and shifts all pixels at one time at all points of the explosions. </li></ul><br>  If you are interested in this topic, I will continue to describe the effects that you see in the photo: <br><br>  - Old TV, RGB Shift and other postprocess effects <br>  - Gravitational distortion (physical part and visual) <br>  - Unique background pattern using Wang Tiles <br>  - 2D shadows from physical objects </div><p>Source: <a href="https://habr.com/ru/post/282604/">https://habr.com/ru/post/282604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282588/index.html">What are they scolding Golang for and how to fight it?</a></li>
<li><a href="../282590/index.html">Rendering drops with transparency and reflections on OpenGL</a></li>
<li><a href="../282592/index.html">Perl plugin version 1.5 released for IntelliJ IDEA</a></li>
<li><a href="../282600/index.html">Autonomous ftp-client with resume files</a></li>
<li><a href="../282602/index.html">(Why) Mail.Ru Mail includes strict DMARC</a></li>
<li><a href="../282606/index.html">Spring Go to Badoo</a></li>
<li><a href="../282608/index.html">Acronis Man: First lecture at MIPT (with online broadcast)</a></li>
<li><a href="../282610/index.html">Haordic Organization Visa (Part 2)</a></li>
<li><a href="../282612/index.html">P2P in the browser</a></li>
<li><a href="../282614/index.html">Oracle Cloud Solution Overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>