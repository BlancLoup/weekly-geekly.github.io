<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Observable.Generate and list listings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the library of reactive extensions (aka Rx - Reactive Extensions) there is a helper method Observable . Generate , which allows you to generate sim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Observable.Generate and list listings</h1><div class="post__text post__text-html js-mediator-article">  In the library of reactive extensions (aka Rx - Reactive Extensions) there is a helper method <b>Observable</b> <b>.</b>  <b>Generate</b> , which allows you to generate simple observable sequences. <br><br><pre><code class="hljs cs">IObservable&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; xs = Observable.Generate&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;( initialState: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   condition: x =&gt; x &lt; 10, //    iterate: x =&gt; x + 1, //   resultSelector: x =&gt; x.ToString() //      ); xs.Subscribe(x =&gt; Console.WriteLine("x: {0}", x));</span></span></code> </pre> <br><a name="habracut"></a><br>  <font color="#526e66"><b>NOTE</b></font> <font color="#526e66"><b><br></b></font>  <font color="#526e66">Pay attention to the explicit indication of the parameters of the generalized method.</font>  <font color="#526e66">The reason for this strange behavior (after all, the generalized parameters of the methods should be easily displayed by the compiler) is that in the C # compiler there is a known bug, as a result of which the type inference is not friendly with the named parameters.</font>  <font color="#526e66">Read more about it at</font> <a href="http://stackoverflow.com/questions/6542822/named-arguments-and-generic-type-inference-in-c-sharp-4-0">stackoverflow</a> <font color="#526e66">or</font> <a href="http://connect.microsoft.com/VisualStudio/feedback/details/678498">connect-e</a> <font color="#526e66">.</font>  <font color="#526e66">Yes, by the way, this case was fixed in Visual Studio 11.</font> <br><br>  The <b>Generate</b> method resembles a simple <b>for</b> loop, which consists of the same steps: initializing the initial value, conditions for exiting the loop, and changing the loop variable.  And if we want to generate the usual sequence in memory, then we will use the for loop inside the block of iterators: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs lua">static IEnumerable&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; GenerateSequence() { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( int x = <span class="hljs-number"><span class="hljs-number">0</span></span>; //initialState x &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; // condition x = x + <span class="hljs-number"><span class="hljs-number">1</span></span> // iterate ) { <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x.ToString(); // resultSelector } } static void Main(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>[] args) { var xs = GenerateSequence(); <span class="hljs-built_in"><span class="hljs-built_in">foreach</span></span> (var x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xs) Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"x: {0}"</span></span>, x); }</code> </pre><br><br>  Both versions of the code are equivalent, but if in the first case a <b>push</b> sequence is created (as an <b>IObservable</b> <b>of</b> <b>T</b> interface) that will independently notify you when new items arrive, in the second case we get a <b>pull-</b> sequence (as an <b>IEnumerable</b> <b>of</b> <b>T</b> interface), from which you need "pliers" to pull these elements. <br><br>  <font color="#526e66"><b>NOTE</b></font> <font color="#526e66"><br></font>  <font color="#526e66">If it is very short, then the <b>pull</b> model is such a model of application interaction with the outside world, when the application plays the leading role.</font>  <font color="#526e66">If you look at the <b>IEnumerable</b> interface, it is the calling code that ‚Äúcontrols‚Äù the element by the thread, calling the <b>MoveNext</b> method to go to the next.</font>  <font color="#526e66">In the <b>push</b> model, actions take place differently: the external environment itself notifies the application about some events (for example, the availability of new data), and the application only ‚Äúresponds‚Äù to them.</font>  <font color="#526e66">In more detail about these models, about dualism of interfaces <b>IEnumerable</b> / <b>IObservable</b> , and also about other opportunities of library of jet expansions it is possible to read in article:</font> <a href="http://sergeyteplyakov.blogspot.com/2010/11/blog-post.html">Reactive expansions and asynchronous operations</a> <font color="#526e66">.</font> <br><br>  Since the interfaces of push and pull sequences ( <b>IObservable</b> <b>of</b> <b>T</b> and <b>IEnumerable</b> <b>of</b> <b>T</b> , respectively) are so similar, we can easily think of converting from one form of the sequence to another: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span>[] ai = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>[] {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}; IObservable&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; oi = Observable.Generate( <span class="hljs-comment"><span class="hljs-comment">/*initialState:*/</span></span> ai.GetEnumerator(), <span class="hljs-comment"><span class="hljs-comment">/*condition:*/</span></span> e =&gt; e.MoveNext(), <span class="hljs-comment"><span class="hljs-comment">/*iterate:*/</span></span> e =&gt; e, <span class="hljs-comment"><span class="hljs-comment">/*resultSelector:*/</span></span> e =&gt; (<span class="hljs-type"><span class="hljs-type">int</span></span>)e.<span class="hljs-keyword"><span class="hljs-keyword">Current</span></span> ); oi.Subscribe(i =&gt; Console.WriteLine("i: {0}", i));</code> </pre><br><br>  In general, nothing criminal, and when executing this code, we expect to receive: <br><br>  one <br>  2 <br>  3 <br><br>  But what if instead of an array we want to do the same with the list: <br><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;int&gt; li = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;int&gt; {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}; IObservable&lt;int&gt; oi = Observable.Generate( <span class="hljs-comment"><span class="hljs-comment">/*initialState:*/</span></span> li.GetEnumerator(), <span class="hljs-comment"><span class="hljs-comment">/*condition:*/</span></span> e =&gt; e.MoveNext(), <span class="hljs-comment"><span class="hljs-comment">/*iterate:*/</span></span> e =&gt; e, <span class="hljs-comment"><span class="hljs-comment">/*resultSelector:*/</span></span> e =&gt; (int)e.Current ); oi.Subscribe(i =&gt; Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"i: {0}"</span></span>, i));</code> </pre><br><br>  And, quite naturally, in this case we get ... an infinite sequence of zeros. <br><br>  <font color="#526e66"><b>NOTE</b></font> <font color="#526e66"><br></font>  <font color="#526e66">Yes, I know that the easiest way to convert a simple sequence into an <b>observable</b> sequence is to use the <b>Observable</b> extension method <b>.</b></font>  <font color="#526e66"><b>ToObservable</b> , which "extends" the <b>IEnumerable</b> interface.</font>  <font color="#526e66">But suppose that we either do not know about it, or we need more complex logic available in the <b>Generate</b> method.</font> <br><br>  The reason for this behavior is that the enumerator of the <b>List</b> <b>of</b> <b>T</b> class (as well as most other BCL collections) is a structure, not a class.  And, as we know, changeable structures (after all, the enumerator changes its internal state) do not really fit in with passing by value.  As a result of this, we are constantly trying to change the copy of the enumerator, and not the original enumeror, which we transmitted in the <b>Generate</b> method. <br><br>  Modifiable structures are evil, and only the desire to optimize the code for the most common scenario of using enumerators led to the fact that the developers of BCL made them structures, not classes.  Since the most common scenario of using enumerators in C # 2.0 was to use it in the foreach loop, which did not suffer from problems with modifiable structures, it was decided to save a few processor cycles and use the enumerator for the structure, not class. <br><br>  <font color="#526e66"><strong>NOTE</strong></font> <font color="#526e66"><br></font>  <font color="#526e66">Details about why this was done in this way can be found</font> <a href="http://blogs.microsoft.co.il/blogs/sasha/archive/2010/07/05/enumerator-structs-optimizing-for-the-common-case.aspx">in one of the posts of</a> <font color="#526e66">Sasha Goldshtein, as well as</font> <a href="http://stackoverflow.com/questions/3168311/why-bcl-collections-use-struct-enumerators-not-classes">in</a> <font color="#526e66">Eric Lippert‚Äôs</font> <a href="http://stackoverflow.com/questions/3168311/why-bcl-collections-use-struct-enumerators-not-classes">response</a> <font color="#526e66">to stackoverflow.</font>  <font color="#526e66">About other problems of changeable significant types can be read in the article:</font> <a href="http://sergeyteplyakov.blogspot.com/2011/07/blog-post.html">About the harm of changeable significant types</a> <font color="#526e66">.</font> <br><br>  This problem is solved quite simply: to do this, it is enough to bring the initial enumerator value to the interface, which will lead to its packaging and subsequent modification of the ‚Äúcommon‚Äù variable located in the managed heap, and not to a copy change: <br><br><pre> <code class="hljs pgsql">IObservable&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; oi = Observable.Generate( <span class="hljs-comment"><span class="hljs-comment">/*initialState:*/</span></span> (IEnumerator&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;)li.GetEnumerator(), <span class="hljs-comment"><span class="hljs-comment">/*condition:*/</span></span> e =&gt; e.MoveNext(), <span class="hljs-comment"><span class="hljs-comment">/*iterate:*/</span></span> e =&gt; e, <span class="hljs-comment"><span class="hljs-comment">/*resultSelector:*/</span></span> e =&gt; (<span class="hljs-type"><span class="hljs-type">int</span></span>)e.<span class="hljs-keyword"><span class="hljs-keyword">Current</span></span> );</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/132314/">https://habr.com/ru/post/132314/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132307/index.html">Russian rock in the Android Market</a></li>
<li><a href="../132308/index.html">Implementing the DEEP IDLE power saving mode in the Linux kernel</a></li>
<li><a href="../132309/index.html">TELESAR V - robot for telebeeting</a></li>
<li><a href="../132312/index.html">About unnecessary Spanning Tree</a></li>
<li><a href="../132313/index.html">Cmake - we collect portable applications for Mac Os X and Windows</a></li>
<li><a href="../132315/index.html">Automatic collection and archiving of photo / video surveillance</a></li>
<li><a href="../132317/index.html">Fluent Interface Organization in Python</a></li>
<li><a href="../132318/index.html">Facebook flight search app</a></li>
<li><a href="../132319/index.html">European investors rules</a></li>
<li><a href="../132320/index.html">Let's hit gadgets on illiteracy (extension for Google Chrome)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>