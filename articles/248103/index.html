<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make QML friends with someone else's OpenGL context. Part II: Loading QML</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will try to talk about how to load QML in case you, for some reason, do not have the ability to use QQuickView , but need to work di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make QML friends with someone else's OpenGL context. Part II: Loading QML</h1><div class="post__text post__text-html js-mediator-article">  In this article I will try to talk about how to load QML in case you, for some reason, do not have the ability to use <a href="http://doc.qt.io/qt-5/qquickview.html">QQuickView</a> , but need to work directly with <a href="http://doc.qt.io/qt-5/qquickwindow.html">QQuickWindow</a> . <br>  In my case, the reason was that only QQuickWindow can work with QQuickRenderControl.  In your case, such a reason could be for example the fact that you needed to download QML not from any file, but for example from memory, which opens up the possibility of generating QML on the fly, or querying the contents of QML, or part of it, from the user interesting, right? <br><a name="habracut"></a><br>  <i>In case you did not read the beginning: <a href="http://habrahabr.ru/post/247477/">Part I is available at this link</a> .</i> <br><br>  In fact, in the task, there is practically nothing complicated, it is enough to carefully read the documentation or look at the source QQuickView. <br><br><h3>  So, everything in order </h3><br>  The first thing we need is <a href="http://doc.qt.io/qt-5/qqmlengine.html">QQmlEngine</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs cs">QQmlEngine* qmlEngine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QQmlEngine;</code> </pre> <br>  Next, we need <a href="http://doc.qt.io/qt-5/qqmlcomponent.html">QQmlComponent</a> - it is with its help that QML is loaded.  Its important feature is that, depending on the source of QML, the QQmlComponent can load it both synchronously and asynchronously. <br><br>  You can handle this as follows (this is the code used in QQuickView): <br><br><pre> <code class="hljs php"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QUrl source = QStringLiteral( <span class="hljs-string"><span class="hljs-string">"http://example.com/main.qml"</span></span> ); qmlComponent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QQmlComponent( &amp;qmlEngine, source ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( qmlComponent-&gt;isLoading() ) connect( qmlComponent, &amp;QQmlComponent::statusChanged, componentStatusChanged ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> componentStatusChanged( qmlComponent-&gt;status() );</code> </pre><br>  but personally, I am more impressed with this implementation: <br><br><pre> <code class="hljs php"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QUrl source = QStringLiteral( <span class="hljs-string"><span class="hljs-string">"http://example.com/main.qml"</span></span> ); qmlComponent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QQmlComponent( qmlEngine ); connect( qmlComponent, &amp;QQmlComponent::statusChanged, componentStatusChanged ); qmlComponent-&gt;loadUrl( source );</code> </pre><br>  Since in this case, synchronous and asynchronous downloads are processed identically (and fewer branches in the code, fewer reasons for error). <br><br>  If you need to load QML from QString, the code will look like this: <br><br><pre> <code class="hljs php"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QUrl qmlUrl = QStringLiteral( <span class="hljs-string"><span class="hljs-string">"http://example.com/main.qml"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString qml = QStringLiteral( <span class="hljs-string"><span class="hljs-string">"import QtQuick 2.0; Rectangle { color: 'green'; }"</span></span> ); qmlComponent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QQmlComponent( qmlEngine ); connect( qmlComponent, &amp;QQmlComponent::statusChanged, componentStatusChanged ); qmlComponent-&gt;setData( qml.toUtf8(), qmlUrl );</code> </pre><br>  In this case, although QML is loaded from a string, you can specify the URL with which this QML will be associated.  This is necessary if any external elements are used in the QML text (links to other QML components or files), which will be searched for relative to the transferred URL. <br><br>  Well, we just need to process the download result: <br><br><pre> <code class="hljs php">void componentStatusChanged( QQmlComponent::Status status ) { Q_ASSERT( !m_rootItem ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( QQmlComponent::Ready != status ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } QObject* rootObject = qmlComponent-&gt;create(); QQuickItem* rootItem = qobject_cast&lt;QQuickItem*&gt;( rootObject ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !rootItem ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } rootItem-&gt;setParentItem( quickWindow-&gt;contentItem() ); rootItem-&gt;setSize( QSizeF( quickWindow-&gt;width(), quickWindow-&gt;height() ) ); }</code> </pre><br>  <i>Important note: in the above code, both object ownership and error handling are deliberately completely ignored.</i> <br><br>  Actually it was all that was necessary to solve the second part of the <a href="http://habrahabr.ru/post/247477/">original problem</a> . <br><br>  The class that implements the above concept, as usual, is available on GitHub: <a href="">FboQuickView.h</a> , <a href="">FboQuickView.cpp</a> <br>  Well, as before, comments, questions, healthy criticism are welcome. <br><br>  Continued: <a href="http://habrahabr.ru/post/249383/">Part III: Processing User Input</a> </div><p>Source: <a href="https://habr.com/ru/post/248103/">https://habr.com/ru/post/248103/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248093/index.html">How we build a message handling system</a></li>
<li><a href="../248095/index.html">Update Windows 8.1 Evaluation and Windows Server 2012 R2 Evaluation to full versions</a></li>
<li><a href="../248097/index.html">Ethernet over USB to STM32F4</a></li>
<li><a href="../248099/index.html">Pointer Checker: check our pointers</a></li>
<li><a href="../248101/index.html">Simple bot for Skype on C ++ Qt (ActiveX)</a></li>
<li><a href="../248105/index.html">Internet test drive "Mechatronics and Robotics". Need help from the Community</a></li>
<li><a href="../248111/index.html">We write fast and economical JavaScript code</a></li>
<li><a href="../248113/index.html">Krita: Green coordinates or how to make a kangaroo from a dragon</a></li>
<li><a href="../248115/index.html">The sound on the chip AY-3-8910 (or Yamaha YM2149F) comes from the ZX Spectrum on the PC via USB</a></li>
<li><a href="../248117/index.html">evalidate: secure processing of custom expressions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>