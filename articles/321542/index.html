<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PIC Controller Programming Tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 PIC controllers remain popular in cases where you need to create an inexpensive, low-power, compact system that does not have high mana...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PIC Controller Programming Tools</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br>  PIC controllers remain popular in cases where you need to create an inexpensive, low-power, compact system that does not have high management requirements.  These controllers allow you to replace hardware logic with flexible software tools that interact with external devices through good ports. <br><br>  Miniature PIC controllers are good for building serial data interface converters, for implementing ‚Äúreceive-process-transfer data‚Äù functions and simple controls of automatic control systems. <br><br>  Microchip distributes MPLAB, a free integrated editing and debugging environment for programs that writes binary files to PIC microcontrollers through programmers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The interaction of MPLAB and Matlab / Simulink allows you to develop programs for PIC controllers in the Simulink environment - graphical modeling and analysis of dynamic systems.  This paper discusses the PIC controller programming tools: MPLAB, Matlab / Simulink, and the PIC-KIT3 programmer in the following sections. <br><br>  ‚Ä¢ Characteristics of the PIC12F629 miniature PIC controller <br>  ‚Ä¢ Integrated Development Environment MPLAB IDE <br>  ‚Ä¢ Connect Matlab / Simulink to MPLAB <br>  ‚Ä¢ Connecting the PIC-KIT3 programmer <br><a name="habracut"></a><br><h3>  Characteristics of a miniature PIC controller </h3><br>  The PIC12xxx family contains controllers in a miniature 8-pin package with built-in clock generator.  The controllers have a RISC-architecture and provide the execution of most processor commands in one machine cycle. <br><br>  For example, below are the characteristics of an inexpensive compact 8-bit PIC12F629 controller with multifunctional ports, low power consumption and a wide power range [1]. <br><br><blockquote>  ‚Ä¢ Architecture: RISC <br>  ‚Ä¢ VDD power supply: 2.0V to 5.5V (&lt;6.5V) <br>  ‚Ä¢ Consumption: <br>  - &lt;1.0 mA @ 5.5V, 4MHz <br>  - 20 ¬µA (type) @ 32 kHz, 2.0 V <br>  - &lt;1.0 ¬µA (type) in SLEEP @ 2.0V mode <br>  ‚Ä¢ Power Dissipation: 0.8W <br>  ‚Ä¢ Multifunctional I / O channels: 6/5 <br>  ‚Ä¢ Maximum output current of GPIO ports: 125mA <br>  ‚Ä¢ Current through programmable internal pull-up port resistors: ‚â•50 (250) ‚â§400 ¬µA @ 5.0V <br>  ‚Ä¢ Controller bit depth: 8 <br>  ‚Ä¢ Clock frequency from external oscillator: 20 MHz <br>  Machine cycle time: 200 ns <br>  ‚Ä¢ Clock frequency from internal RC oscillator: 4 MHz ¬± 1% <br>  Machine cycle time: 1¬µs <br>  ‚Ä¢ FLASH program memory: 1K <br>  Number of erase / write cycles: ‚â•1000 <br>  ‚Ä¢ RAM Data Memory: 64 <br>  ‚Ä¢ EEPROM data memory: 128 <br>  Number of erase / write cycles: ‚â•10K (-40 ¬∞ C ‚â§TA‚â§ + 125 ¬∞ C) <br>  ‚Ä¢ Specialized hardware registers: 16 <br>  ‚Ä¢ List of commands: 35 instructions, all commands are executed in one machine cycle, <br>  except for transition commands, performed in 2 cycles <br>  ‚Ä¢ Hardware stack: 8 levels <br>  ‚Ä¢ Timer / counter TMR0: 8-bit with a prescaler <br>  ‚Ä¢ Timer / counter TMR1: 16-bit with a prescaler </blockquote><br>  Additional features: <br><blockquote>  ‚Ä¢ Power On Reset (POR) <br>  ‚Ä¢ Reset timer (PWRT timer for generator start (OST <br>  ‚Ä¢ Blowdown voltage reset (BOD) <br>  ‚Ä¢ WDT Watchdog <br>  ‚Ä¢ Multiplexing -MCLR output <br>  ‚Ä¢ Interrupt system for changing the signal level at the inputs <br>  ‚Ä¢ Pull resistors individually programmable for each input <br>  ‚Ä¢ Programmable input protection <br>  ‚Ä¢ Low Power Mode SLEEP <br>  ‚Ä¢ Selection of the operating mode of the clock generator <br>  ‚Ä¢ In-circuit ICSP programming using two pins <br>  ‚Ä¢ Four user ID cells </blockquote><br>  The maximum operating temperature for the E version (extended range) is from -40 ¬∞ C to +125 ¬∞ C; <br>  Storage temperature is from -65 ¬∞ C to +150 ¬∞ C. <br><br>  The CMOS controller technology provides a completely static mode of operation, in which stopping the clock generator does not lead to the loss of logical states of the internal nodes. <br>  The PIC12F629 microcontroller has a 6-bit GPIO I / O port.  One GP3 pin of the GPIO port works only at the input, the remaining pins can be configured to work both at the input and at the output.  Each GPIO pin has an individual interrupt enable bit for changing the signal level at the inputs and the enable bit of the internal pull-up resistor. <br><br><h4>  Integrated Development Environment MPLAB IDE </h4><br>  MPLAB IDE - a free integrated development environment for software for PIC microcontrollers includes tools for creating, editing, debugging, translating and linking programs, writing machine code to microcontrollers through programmers. <br><br>  <b>Download MPLAB IDE</b> <br><br>  Free versions of MPLAB (including MPLAB 8.92) are stored <a href="http://www.microchip.com/mplab/mplab-x-ide">on the</a> Microchip <a href="http://www.microchip.com/mplab/mplab-x-ide">website</a> in the DOWNLOAD ARCHIVE section. <br><br>  <b>Project creation</b> <br><br>  An example of creating a project for a PIC controller program in MPLAB includes the following steps [2]. <br><br>  1. Call the project manager. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/14a/ec0/428/14aec04281cb4dffa5d47cac7adacfe5.png"></div><br>  2. Select the type of PIC microcontroller. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6e6/bf2/32a/6e6bf232a7da41fb9af23a5147e68f89.png"></div><br>  3. Select a compiler, for example, Microchip MPASM for the assembler. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a9a/b4c/b4a/a9ab4cb4a9e34f6aa1b17c56703331d7.png"></div><br>  4. Select the path to the project directory (Browse button ...) and enter the project name. <br><br>  5. It is possible not to connect files to a project in the Project Wizard ‚Üí Step Four window.  This can be done later, inside the active project.  The Next button opens the next window. <br><br>  6. Completion of the project creation (Finish button). <br><br>  As a result of the creation of the project FirstPrMPLAB, the MPLAB interface takes the form shown in Fig.  one. <br><br><img src="https://habrastorage.org/files/d97/0f8/c80/d970f8c804ef4373bbf8cbc0e54d8a5c.png"><br>  <i><b>Fig.</b></i>  <i><b>1</b> .</i>  <i>MPLAB v8.92 environment interface and project template.</i> <br><br>  <b>Creating a program file</b> <br>  The program can be created using any text editor.  MPLAB has a built-in editor that provides a number of advantages, for example, operational lexical analysis of the source text, as a result of which reserved words, constants, comments, user-defined names are highlighted in text. <br><br>  Creating a program in MPLAB can be done in the following sequence. <br><br>  1. Open the program editor: menu ‚Üí File ‚Üí New.  Initially, the program is named Untitled. <br><br>  2. Type or copy a program, for example, in assembly language. <br><br>  3. Save the program under a different name (menu ‚Üí File ‚Üí Save As), for example, FirstPrMPLAB.asm. <br><br><img src="https://habrastorage.org/files/a55/c66/0aa/a55c660aa6104cfb920fa1a2b39da39c.png"><br>  <i><b>Fig.</b></i>  <i><b>2</b></i>  <i>An example of the simplest program (in assembler) output signals through the ports of the controller GP0, GP1, GP2, GP4, GP5 at the maximum frequency.</i> <br><br>  The entry '1' in the register register TRISIO transfers the corresponding output buffer to the 3rd state, in this case the GP port can only work as an input.  Setting zero in TRISIO adjusts the operation of the GP port to the output. <br><br>  Note.  According to the PIC12F629 specification, the GP3 port of the microcontroller works only at the input (the corresponding bit of the TRISIO register is not reset ‚Äî it is always in '1'). <br><br>  The TRISIO and GPIO registers are located in different banks of the memory area.  Bank switching is performed with the 5th bit of the STATUS register. <br><br>  Any assembler program starts with the org directive and ends with the end directive.  Goto Metka transition provides cyclical program execution. <br><br>  The program (Fig. 2) uses the following notation. <br><br><blockquote>  LIST directive - controller type assignment <br>  __CONFIG directive - setting controller configuration bits <br>  Equ directive - assignment of a numerical value <br>  Directive org 0 - the beginning of the program from the address 0 <br>  The bsf command sets the specified register bit to 1 <br>  Command bcf - clears the bit of the specified register in 0 <br>  Movlw command - writes a constant to the register W <br>  The movwf command - copies the contents of the register W to the specified register <br>  The goto command - provides a transition without a condition to the line with a label <br>  Directive end - end of the program </blockquote><br>  <b>Setting the required microcontroller configuration</b> <br>  The configuration of the PIC12F629 microcontroller depends on the configuration word settings (2007h), which can be set in the program via the __CONFIG directive. <br><br>  Directly or through the MPLAB window: menu ‚Üí Configure ‚Üí Configuration Bits: <br><br><img src="https://habrastorage.org/files/570/1d6/a69/5701d6a696dc4afd9ee4d44be84ec4a3.png"><br><br>  Where: <br><blockquote>  <b>Bit 2-0</b> - FOSC2: FOSC0.  Choosing a clock generator <br>  111 - External RC generator.  Connects to GP5 pin.  GP4 works like CLKOUT <br>  110 - External RC generator.  Connects to GP5 pin.  GP4 works as I / O <br>  101 - Internal 4 MHz RC generator.  GP5 works as I / O.  GP4 - like CLKOUT <br>  100 - Internal 4 MHz RC generator.  GP5 and GP4 work as I / O <br>  011 - EC generator.  GP4 works as I / O.  GP5 - like CLKIN <br>  010 - HC generator.  Resonator connects to GP4 and GP5 <br>  001 - XT generator.  Resonator connects to GP4 and GP5 <br>  000 - LP generator.  Resonator connects to GP4 and GP5 <br><br>  <b>Bit 3</b> - WDTE: Watchdog Timer Setting <br>  1 - WDTE enabled <br>  0 - WDTE off <br><br>  The watchdog timer prevents the microcontroller from hanging up - it restarts the program at a certain time interval if the timer has not been reset.  The timer period is set in the OPTION_REG register.  Resetting the watchdog timer is invoked with the CLRWDT command. <br><br>  <b>Bit 4</b> - PWRTE: Enable Power On Timer: <br>  1 - PWRT is off <br>  0 - PWRT enabled <br><br>  The timer delays the microcontroller in a reset state when powering up the VDD. <br><br>  <b>Bit 5</b> - MCLR: Selecting the operating mode of the GP3 / -MCLR output <br>  1 - works as -MCLR <br>  0 - works as a GP3 I / O port <br><br>  <b>Bit 6</b> - BODEN: Enable Power- <b>On</b> Drop Voltage (typically &lt;2.0V) <br>  1 - BOR reset allowed <br>  0 - the BOR reset is disabled; the timer is automatically activated. <br><br>  When resetting the BOR, the PWRT timer is automatically activated. <br><br>  <b>Bit 7</b> - .CP: Bit protect program memory from reading by the programmer <br>  1 protection off <br>  0 protection enabled <br><br>  When protection is turned off, all program memory is erased. <br><br>  <b>Bit 8</b> - .CPD: Bit EPROM Data Memory Protection <br>  1 protection off <br>  0 protection enabled <br><br>  After disabling protection, all information will be erased. <br><br>  <b>Bit 11-9</b> - Not Used: Reads as '1'. <br><br>  <b>Bit 13-12</b> - BG1: BG0.  Power Drop Calibration Bits <br>  00 - lower calibration limit <br>  11 - upper calibration limit </blockquote><br>  <b>Adding a program to a project</b> <br><br>  An example of adding a program to a project is shown in (Fig. 3). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0e9/a17/524/0e9a1752490247bc810f4e5bd71b2c60.png"></div><br>  <i><b>Fig.</b></i>  <i><b>3</b></i>  <i>Adding the program FirstPrMPLAB.asm to the project FirstPrMPLAB.mcp</i> <br><br>  You can save project materials using the command: menu ‚Üí File ‚Üí Save Workspace. <br><br><h3>  Compilation </h3><br>  To create a binary file with the extension hex for the microcontroller firmware, it is necessary to compile the project.  The compilation is started by the menu command ‚Üí Project ‚Üí Build All.  The compilation results can be seen in the Output window (Figure 1).  If there are no errors in the program, the compiler gives a message about successful compilation: BUILD SUCCEEDED, the boot HEX file can be found in the working directory: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e9d/598/735/e9d5987350534784accc24c6a2e735d3.png"></div><br><h3>  Debugging program </h3><br>  MPLAB IDE can be used to debug a program using the MPLAB REAL ICE hardware emulator or the software simulator MPLAB SIM.  The launch of the latter is performed as shown in Fig.  four. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/45e/7a7/621/45e7a76218b84f0eba20f90977f326f6.png"></div><br>  <i><b>Fig.</b></i>  <i><b>4</b></i>  <i>Connection to MPLAB SIM simulator for debugging the program.</i> <br><br>  After launching the debugger, the MPLAB SIM tab appears in the Output window (Fig. 1), where MPLAB displays the current debugger information.  Debugger commands (Fig. 5) become active after launch. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ffb/750/121/ffb7501210f24a5195dba550240b10c4.png"></div><br>  <i><b>Fig.</b></i>  <i><b>5</b></i>  <i>Debugger commands.</i> <br><br>  Debugger Commands: <br><br>  ‚Ä¢ Run - Continuous execution of the program to a breakpoint (if it is set). <br>  ‚Ä¢ Halt - Stop the program at the current execution step. <br>  ‚Ä¢ Animate - Animation of continuous program execution. <br>  ‚Ä¢ Step Into - Perform step by step (Call calls are made in one step). <br>  ‚Ä¢ Step Over - Perform steps including Call Call commands. <br>  ‚Ä¢ Reset - Initial installation of the program.  Move the pointer to the first command. <br>  ‚Ä¢ Breakpoints - Displays a list of breakpoints.  Processing list <br><br>  When executing the program step by step, the current step is highlighted by an arrow (Fig. 6).  Continuous program execution is stopped with a Halt command or when a program reaches a breakpoint.  The breakpoint is set / removed in the program line by double clicking. <br>  An example of an assembler program that changes the state of the controller ports at maximum speed is shown in Fig.  6 (right).  The program transfers the data of b'10101010 'and b'01010101' to the GPIO port register.  Since in the GPIO register, data transfer to the controller ports is not performed by all bits, but by only 0,1,2,4 and 5, the state of the GPIO register (Fig. 6, left) differs by the values ‚Äã‚Äãb'00100010 'and b'00010101'. <br><br><img src="https://habrastorage.org/files/3dd/152/1e2/3dd1521e26bc42939ef24ce20642fa5c.png"><br>  <i><b>Fig.</b></i>  <i><b>6</b></i>  <i>The state of the controller's special-purpose registers at the time of program execution (left) and the program executed in steps (right).</i> <br><br>  In the process of debugging, you can monitor the status of registers, variables, memory in the corresponding windows opened in the View section of the main menu.  In the process of debugging, you can make changes to the program code, the contents of registers, memory, change the values ‚Äã‚Äãof variables.  After changing the code, you must recompile the program.  Changing the contents of registers, memory and values ‚Äã‚Äãof variables (windows in the View section: Special Function Register, File Register, EEPROM, Watch) does not require recompilation. <br><br>  The input signals of the microcontroller model ports can be defined in the Debugger ‚Üí Stimulus section.  Settable signal states of ports are tied to debug time (ticks). <br><br>  Sometimes the results of running the program in debug mode do not correspond to the execution of the same program in a real controller, for example, the program debugger (Fig. 6) without instructions movlw 0x07 and movwf cmcon shows that the outputs of GP0 and GP1 of the GPIO register do not change - they are in zero state, the contents of the GPIO register are alternately 0x14 and 0x20.  However, the controller that executes the program without the specified instructions shows on the oscilloscope the cyclic operation of all five outputs: 0x15 and 0x22, including GP0 and GP1 (see Fig. 7). <br><br>  Oscillograms of the controller performing the program cycles  6 (Metka ... goto Metka) are shown in Fig.  7 <br><br><img src="https://habrastorage.org/files/89a/ebe/167/89aebe1672d843b58dec2bc79c65603a.png"><br>  <i><b>Fig.</b></i>  <i><b>7</b></i>  <i>Oscillograms of GP0 output (left) and GP1 (right) of a PIC12F629 microcontroller operating from an internal 4 MHz RC oscillator.</i>  <i>The program (Fig. 6) generates the maximum frequency signals at all outputs of the controller.</i>  <i>During the period of 5.3 ¬µs signals, 5 commands are executed (6 machine cycles), the amplitude of the GP0 signal on the oscillogram is 4.6 V, the power supply of the controller is 4.75 V, measured by the programmer.</i> <br><br><h3>  Microcontroller firmware </h3><br>  To write the program to the microcontroller (controller firmware), you need to connect the microcontroller to the integrated environment MPLAB IDE through the programmer.  Connection organization is shown below in the ‚ÄúConnecting the PIC-KIT3 Programmer‚Äù section. <br><br>  Note.  The PIC12F629 controller contains a factory calibration constant for setting the frequency of the internal clock generator.  If necessary, it can be read and restored using MPLAB using the programmer. <br><br>  Commands for working with the programmer and changing its settings are in the MPLAB Programmer menu.  The type of programmer in MPLAB is selected in section: menu ‚Üí Programmer ‚Üí Select Programmer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b21/87d/400/b2187d4009dc47f1acb64eccabae6b70.png"></div><br>  <i><b>Fig.</b></i>  <i><b>8</b></i>  <i>Select a programmer to connect to the MPLAB environment.</i> <br><br>  The firmware of the microcontroller through the programmer is started by the command: menu ‚Üí Programmer ‚Üí Program.  The message about the successful firmware is shown in Fig.  9. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dab/3d8/00c/dab3d800caa6469ea8016cf1e7bf05c9.png"></div><br>  <i><b>Fig.</b></i>  <i><b>9</b></i>  <i>The launch of the microcontroller firmware and the kind of message about successful firmware.</i> <br><br>  <b>Note:</b> During the microcontroller firmware, the yellow LED flashes on the PIC-KIT3 programmer. <br><br><h3>  Connect MATLAB / SIMULINK to MPLAB </h3><br>  In the simulation system of dynamic systems Simulink (application for Matlab) in the language of graphical programming [7], you can develop programs for a family of PIC controllers with ADC / DAC, counters, timers, PWM, DMA, interfaces UART, SPI, CAN, I2C, etc. <br><br>  An example of the Simulink PIC controller program is shown in Fig.  ten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a73/c06/107/a73c06107b934f3a9c9a225c77df398c.png"></div><br>  <i><b>Fig.</b></i>  <i><b>10</b></i>  <i>An example of a program in graphical programming language for a PIC controller made in the Simulink dynamic systems simulation environment.</i> <br><br>  The interaction of development tools and compilation of programs for PIC controllers in Simulink is shown in Fig.  11 [6]. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/59c/1d6/e99/59c1d6e994d64621919381f496834c2b.png"></div><br>  <i><b>Fig.</b></i>  <i><b>11</b></i>  <i>The structure of the means of building an adequate PIC controller model in graphical programming language.</i> <br><br>  To build a development environment, the following Matlab components are needed: <br><br>  ‚Ä¢ Simulink <br>  ‚Ä¢ Real-Time Workshop Embedded Coder <br>  ‚Ä¢ Real-Time Workshop <br><br>  And the Microchip C compiler: <br><br>  ‚Ä¢ C30 for PIC24, dsPIC30 and PIC33 controllers <br>  ‚Ä¢ or C32 for PIC32 controllers <br><br><h3>  Installing Matlab Components </h3><br>  The <a href="http://www.kerhuel.eu/wiki/Download">site</a> has Simulink libraries (dsPIC Toolbox) for PIC controllers and Matlab versions from R2006a to R2012a: <br><br>  To download the library you need to register.  The programs support 100 microcontrollers from the PIC 16MC, 24F, 30F, 32MC, 33F, 56GP, 64MC, 128MC, 128GP series. <br>  Free versions work with Simulink models of PIC controllers with up to 7 I / O ports. <br><br>  To install dsPIC Toolbox - the library of PIC controllers for Matlab / Simulink is necessary [4]: <br><br>  ‚Ä¢ Download dsPIC Toolbox for the required version of Matlab. <br>  ‚Ä¢ Unzip the file in the folder in which the Simulink blocks will be installed. <br>  ‚Ä¢ Launch Matlab. <br>  ‚Ä¢ Set the current Matlab directory to the folder with the unpacked file. <br>  ‚Ä¢ Open and run the install_dsPIC_R2012a.m file, for example, a menu button or a keyboard key. <br><br>  The dsPIC libraries and examples of Simulink models are installed in the current Matlab folder (Fig. 12).  Installed blocks for modeling PIC controllers are available in the Embedded Target for Microchip dsPIC section of the Simulink library (Figure 13). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/706/b63/278/706b6327844f45f18bde3fb098e47843.png"></div><br>  <i><b>Fig.</b></i>  <i><b>12</b></i>  <i>The contents of the current directory after install_dsPIC_R2012a.m.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d8c/98a/0cc/d8c98a0cc53e4b6bae659a218f9e3155.png"></div><br>  <i><b>Fig.</b></i>  <i><b>13</b></i>  <i>Blocks installed library "Embedded Target for Microchip dsPIC".</i> <br><br>  To compile Simulink models together using Matlab and MPLAB, you need to set the path to the MPLAB directory with the MplabOpenModel.m, MplabGetBuildinfo.m and getHardwareConfigs.m files in the Matlab path variable with the highest priority: <br><br><pre><code class="hljs tex">&gt;&gt; path('c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microchip</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MPLAB</span></span></span></span> IDE<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tools</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MATLAB</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">'</span></span></span></span>,path)</code> </pre> <br><h3>  Installing the MPLAB compiler </h3><br>  MPLAB compilers are <a href="http://www.microchip.com/mplab/mplab-x-ide">on the Microchip website</a> (Download Archive ‚Üí MPLAB C Compiler for PIC24 and dsPIC DSCs).  To install the demo version of the C30 compiler, you need to download it via the link PIC24 / dsPIC v3.25 (Fig. 14) and run the received file mplabc30-v3.25-comboUpgrade.exe. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b76/ffe/5cf/b76ffe5cfc4d4a989a83b0919ed2207d.png"></div><br>  <i><b>Fig.</b></i>  <i><b>14</b></i>  <i>Compiler C versions (left) and its installation modes (right).</i> <br><br>  Note.  Work performed with the version v3.25 of the C30 compiler for PIC24 / dsPIC.  The audit showed that the next version of v3.30 does not support the joint compilation of Matlab R2012a models (dsPIC Toolbox) without errors. <br><br>  The installation exe file creates in the section c: \ Program Files (x86) \ Microchip \ a new directory mplabc30 with files: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/65b/971/6b9/65b9716b9235465ea6a957ee21e11f25.png"></div><br>  <i><b>Fig.</b></i>  <i><b>15</b></i>  <i>C30 MPLAB Compiler Directories.</i> <br><br>  <b>Simulink Programming Sequence for PIC Controllers</b> <br><br>  <b>1.</b> Create a working directory and copy into it the * .mdl examples from the example section (see. Fig. 12). <br>  <b>2.</b> Download Matlab.  Set it to the working directory. <br>  <b>3.</b> Include the path to MPLAB - the directory c: \ Program Files (x86) \ Microchip \ MPLAB IDE \ Tools \ MATLAB \: in the Matlab path variable with the highest priority: <br><br><pre> <code class="hljs tex">&gt;&gt; path('c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microchip</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MPLAB</span></span></span></span> IDE<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tools</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MATLAB</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">'</span></span></span></span>,path)</code> </pre> <br>  Note: Using the &gt;&gt; path command with no arguments results in a list of paths to the path variable in the Command Window.  You can remove the path from the path variable with the rmpath command, for example: <br><br><pre> <code class="hljs tex">&gt;&gt;rmpath(' c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microchip</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MPLAB</span></span></span></span> IDE<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tools</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MATLAB</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">'</span></span></span></span>)</code> </pre> <br>  <b>4.</b> Create a Simulink model for the PIC controller using the ‚ÄúEmbedded Target for Microchip dsPIC‚Äù library blocks (Fig. 13), or load a ready-made model, for example, Servo_ADC.mdl. <br><br>  The type of controller for which the Simulink model is developed is selected from the list in the Master&gt; PIC block (Fig. 16, Fig. 10), which should be included in the model. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/49c/468/826/49c468826e1741d99bb216738749b95f.png"></div><br>  <i><b>Fig.</b></i>  <i><b>16</b></i>  <i>The choice of the type of controller in the master block model.</i> <br><br>  <b>5.</b> Check the model configuration settings: Menu ‚Üí Simulation ‚Üí Configuration Parameters &lt;Ctrl + E&gt;.  The S Generator compiler dspic.tlc should be specified in the System target file entry line of the Code Generation section (Figure 17).  Selecting dspic.tlc adjusts all other model configuration parameters, including the step and integration method. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5d5/604/990/5d5604990bd14d6faae43b9bfbcbe1bc.png"></div><br>  <i><b>Fig.</b></i>  <i><b>17</b></i>  <i>Select the S-functions compiler dspic.tlc for PIC controller models in the section ‚Äúmain menu ‚Üí Simulation ‚Üí Configuration Parameters ‚Üí Code Generation‚Äù.</i> <br><br>  <b>6.</b> Compile the tmp_Servo_ADC.mdl model.  The launch of the compiler is shown in Fig.  18. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/501/9fd/1ab/5019fd1ab89c48d299a592f20519e212.png"></div><br>  <i><b>Fig.</b></i>  <i><b>18</b></i>  <i>Run the simulink compiler model.</i> <br><br>  As a result of a successful compilation (message: ### Successful completion of build procedure for model: Servo_ADC), a HEX file is created in the current directory for the firmware of the PIC controller and the MCP MPLAB environment project (Fig. 19). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f09/ae1/ebb/f09ae1ebb13c4bffa7921999226eeed0.png"></div><br>  <i><b>Fig.</b></i>  <i><b>19</b></i>  <i>The results of compiling the model.</i> <br><br>  The launch of the model in Matlab / Simulink is performed in the model window with a button, the conditional simulation time is set in the line: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/801/73b/519/80173b51925d4aae8bd08a86db2d2516.png"></div><br>  <b>Managing the compilation of Simulink models from MPLAB</b> <br><br>  The compilation of the Simulink model can be controlled by the commands of the Matlab / Simulink section of the MPLAB environment, for example, in the following order. <br><br>  1. Develop a PIC controller model in Matlab / Simulink.  Save the model. <br>  2. Run MPLAB. <br>  3. Select MPLAB menu ‚Üí Tools ‚Üí Matlab / Simulink and the new section will appear in the menu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ad1/f67/dd7/ad1f67dd74314871a936fb76f4c90d0a.png"></div><br>  4. In the Matlab / Simulink section, open the Simulink model, for example, Servo_ADC, with the command ‚ÄúMatlab / Simulink ‚Üí Specify Simulink Model Name ‚Üí Open ‚Üí File name ‚Üí Servo_ADC.mdl ‚Üí Open‚Äù.  The Open command launches Matlab and opens the model. <br><br>  5. Compile the model and create a MCP project using the Generate Codes or Generate Codes and Import Files commands.  The translation of the MDL model into the MCP project is performed by the TLC Matlab compiler. <br>  As a result, the MPLAB project is created: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4d5/f2a/3a2/4d5f2a3a2c2b42d0ad3796242062c505.png"></div><br><br>  with scripts of the model in the C language. <br><br>  6. Open the project: menu ‚Üí Project ‚Üí Open ‚Üí Servo_ADC.mcp (Fig. 20). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a6f/8cf/a40/a6f8cfa407684a97ba8c5bfb14cf0eba.png"></div><br>  <i><b>Fig.</b></i>  <i><b>20</b></i>  <i>The structure of the MCP project Simulink model Servo_ADC.mdl in the MPLAB environment.</i> <i><br></i>  <i>The Simulink model project is ready for editing, debugging, and compiling into machine controller codes using MPLAB.</i> <br><br><h3>  Connecting the PIC-KIT3 programmer </h3><br>  You can find out which programmers write a binary code to a specific microcontroller in the menu section ‚Üí Configure ‚Üí Select Device of MPLAB 8.92 environment.  For example, the PIC-KIT3 programmer does not support the PIC12C508A controller (Fig. 21, left figure), but works with the PIC12F629 controller (Fig. 21, right figure). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cf7/983/7fd/cf79837fd43d427280f73da30da726ce.png"></div><br>  <i><b>Fig.</b></i>  <i><b>21</b> .</i>  <i>The list of programmers for microcontroller firmware.</i> <br><br>  Information about the installed PIC-KIT3 programmer driver can be requested from the Windows device manager (Fig. 22). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bf8/02f/692/bf802f692d17460b9a75f61627d578ba.png"></div><br>  <i><b>Fig.</b></i>  <i><b>22</b></i>  <i>Information about the installed driver for the PIC-KIT3 programmer.</i> <br><br>  The connection diagram of the PIC12F629 microcontroller to the PIC-KIT3 programmer is shown in Fig.  23. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/103/06d/94c/10306d94ccff40c2abe9f27ba5cfaad0.png"></div><br>  <i><b>Fig.</b></i>  <i><b>23</b> .</i>  <i>Wiring diagram of the PIC12F629 microcontroller to the PIC-KIT3 programmer.</i> <br><br>  The PGM output of the programmer for the PIC12F629 controller firmware is not used.  The presence of PGM output for different types of PIC controllers is shown in Fig.  24. PGM output is recommended to ‚Äúpull‚Äù to the common wire (GND), through a resistor, with a rating of 1K [3]. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/287/e3f/d88/287e3fd88c714fecb8c4f95e8f713546.png"></div><br>  <i><b>Fig.</b></i>  <i><b>24</b></i>  <i>Conclusions PGM PIC controllers.</i> <br><br>  An indication of the LEDs of the Olimex PIC-KIT3 programmer is shown below: <br><br><blockquote>  Yellow - Red - Programmer Status <br>  On - Off - Connected to USB line <br>  On - On - Interaction with MPLAB <br>  Flashing - Always on - Microcontroller firmware </blockquote><br>  Do not connect the power of the microcontroller VDD (Fig. 23) to the programmer if the controller is powered from its power source. <br><br>  When powering the microcontroller from the programmer on the VDD line, it is necessary to set the operating voltage, for example, 5V by the MPLAB program (Menu ‚Üí Programmer ‚Üí Settings ‚Üí Power), as shown in Fig.  25 <br><br>  Note.  If there is no voltage on the VDD MPLAB IDE line, the following error message is displayed: PK3Err0045: You must connect <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/af5/93b/729/af593b729f7e47fb8a1887912a866ad8.png"></div><br>  <i><b>Fig.</b></i>  <i><b>25</b></i>  <i>Setting the voltage VDD on the programmer PIC-KIT3 program MPLAB IDE v8.92.</i> <br><br>  If the programmer cannot set the required voltage, for example, 5V when it is powered by USB, in which the voltage is less than 5V, MPLAB IDE gives an error message: PK3Err0035: Failed to get Device ID.  In this case, you must first measure the voltage of the programmer - read it in the menu tab ‚Üí Programmer ‚Üí Settings ‚Üí Status, and then set the voltage (not more than measured) in the menu tab ‚Üí Programmer ‚Üí Settings ‚Üí Power. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3be/a2f/9e2/3bea2f9e2eaa4e26a797df1702438449.png"></div><br>  <i><b>Fig.</b></i>  <i><b>26</b></i>  <i>Measurement (left) and setting (right) VDD voltage of the PIC-KIT3 programmer with MPLAB IDE v8.92 program.</i> <br><br>  An example of an MPLAB message for a successful connection of a microcontroller to a programmer using the menu command ‚Üí Programmer ‚Üí Reconnect is shown in Fig.  27. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/939/b31/2c2/939b312c22d44ffda2c594033c501ec5.png"></div><br>  <i><b>Fig.</b></i>  <i><b>27</b> .</i>  <i>Message MPLAB about the successful connection of the microcontroller to the programmer.</i> <br><br>  It is possible to program not only a separate PIC controller, but also a controller that is part of the working device.  To program the PIC controller, it is necessary to provide for the installation of jumpers and current-limiting resistors as shown in Fig.  28 [3]. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/39c/a6a/944/39ca6a9440cd4fd4b323350ca7bde3d6.png"></div><br>  <i><b>Fig.</b></i>  <i><b>28</b></i>  <i>Connecting the microcontroller in the electronic device to the programmer.</i> <br><br><h3>  Conclusion </h3><br>  Small-bit PIC controllers have a wide power range, low consumption and small size.  They are programmed in low level languages.  Development of programs in the Simulink graphical programming language using multiple libraries significantly reduces development and debugging time in comparison with programming at the assembler level.  Structures developed for Simulink PIC controllers can also be used for computer simulation of dynamic systems involving controllers.  However, due to code redundancy, this approach is applicable only to families of PIC controllers with sufficient resources. <br><br><div class="spoiler">  <b class="spoiler_title">Bibliographic list</b> <div class="spoiler_text">  1. <a href="http://www.microchip.ru/">PIC12F6XX</a> .  Single-chip 8-bit FLASH CMOS microcontrollers from Microchip Technology Incorporated.  PIC12F629, PIC12F675.  OOO ‚ÄúMicro-chip‚Äù.  Moscow - 2002. <br>  2. <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/MPLAB_User_Guide_51519c.pdf">Microchip.</a>  <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/MPLAB_User_Guide_51519c.pdf">MPLAB IDE.</a>  <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/MPLAB_User_Guide_51519c.pdf">User's Guide with MPLAB Editor and MPLAB SIM Simulator</a> <br>  3. <a href="http://www.5v.ru/icsp.htm">ICSP - In-Circuit Programming of PIC Controllers DOC Rev 1.03</a> (last updated 05/19/2005) <br>  4. MPLAB IDE Help: MATLAB. <br>  5. <a href="http://www.microchip.com/stellent/groups/SiteComm_sg/documents/DeviceDoc/en542925.pdf">Introduction to Microchip-SIMULINK Blocksets and MATLAB Plug-in for MPLABIDE Produced by Murali Manohara Chembarpu</a> . <br>  6. <a href="http://www.kerhuel.eu/RTWdsPIC/">Embedded Target for 16 bits PIC</a> . <br>  7. <a href="http://portalnp.ru/author/bobdavidov">Dr.</a>  <a href="http://portalnp.ru/author/bobdavidov">Bob Davidov</a> .  Portal of scientific and practical publications </div></div></div><p>Source: <a href="https://habr.com/ru/post/321542/">https://habr.com/ru/post/321542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321530/index.html">MIPSfpga and SDRAM. Part 1</a></li>
<li><a href="../321532/index.html">MIPSfpga and SDRAM. Part 2</a></li>
<li><a href="../321534/index.html">How to get the top five using data analysis?</a></li>
<li><a href="../321538/index.html">VxRail Hyper Converged Devices</a></li>
<li><a href="../321540/index.html">How to fill 100 timeshits in 2 minutes</a></li>
<li><a href="../321544/index.html">Events and streams. Part 1</a></li>
<li><a href="../321546/index.html">C # language is almost functional</a></li>
<li><a href="../321548/index.html">How smart contracts will change our lives</a></li>
<li><a href="../321550/index.html">It's hard to be a junior</a></li>
<li><a href="../321552/index.html">The first application on Spring Boot + ReactJS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>