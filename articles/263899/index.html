<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In app purchase using Soomla. Fast and easy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I had to integrate in-game purchases into my game and the question arose, what kind of plug-in for this use under Unity3D? There are things l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In app purchase using Soomla. Fast and easy</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/0b0/40d/20f/0b040d20fd16485c85cd95710aaf8eef.png"><br><br>  Recently I had to integrate in-game purchases into my game and the question arose, what kind of plug-in for this use under Unity3D?  There are things like OpenIAB, Prime31, Unibill and Soomla.  Smaller things will not be taken into account, because some of them either are not updated at all, or have some critical problems.  Who wants to know why the choice fell on Soomla, and how to integrate it, please under the cat. <br><a name="habracut"></a><br>  So, as you can see, there are a lot of plug-ins and by the name of the topic you can see which system I chose in the end, but why?  Let's consider each system separately. <br><br><h3>  Openiab </h3><br>  <u>Pros</u> : <br><ul><li>  Free </li><li>  Openness </li><li>  Large community </li><li>  Simplicity </li><li>  Good documentation </li><li>  Support for iOS and Android (Later it turned out that it was not) </li></ul><br>  <u>Cons</u> : <br><ul><li>  Almost no information about working with iOS </li><li>  Updates are very rare (Last was 4 months ago) </li></ul><br>  <u>Opinion</u> : <br>  I sin, I previously worked with this system, but only under Android, but when I decided to try to work with the iOS side, I was disappointed, OpenIAB simply did not work, because  its events did not respond, and how to initialize the store, because this system had to be abandoned, but it should be given its due, it worked flawlessly for Android, but there was no doubt about this, because even the original c ++ version was written only this OS. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Unibill </h3><br>  <u>Pros</u> : <br><ul><li>  Multiple store support </li><li>  Excellent documentation </li><li>  Simplicity and ease of learning </li></ul><br>  <u>Cons</u> : <br><ul><li>  Price ($ 175) </li><li>  The community as such is almost absent </li></ul><br>  <u>Opinion</u> : <br>  With Unibill, everything turned out to be easy.  Immediately there were questions about the price, $ 175 is not really small money, especially considering that there are cheaper analogues, so there is no right away, but if there is finance and you don‚Äôt want to spend a lot of time, then this is a great option. <br><br><h3>  Prime [31] </h3><br>  <u>Pros</u> : <br><ul><li>  Excellent documentation </li><li>  Simplicity and ease of learning </li><li>  Supports many shops, but with a reservation. </li><li>  Big community. </li></ul><br><ul><li>  Under each platform, the price of the plug is $ 70. </li></ul><br>  <u>Opinion</u> : <br>  Plug-ins from prime [31] are famous for their quality, but the price also leaves much to be desired, $ 70 for each platform is not at all the ultimate dream, but there is already a proven technology with a huge community and excellent documentation, and so on.  I needed a plug-in just under 2 platforms, the price went lower than that of Unibill, but still this option was chosen, not the following. <br><br><h3>  Soomla </h3><br>  <u>Pros</u> : <br><ul><li>  Excellent documentation </li><li>  Simplicity and ease of learning </li><li>  Supports major mobile platforms. </li><li>  Big community. </li><li>  Free </li></ul><br>  <u>Cons</u> : <br><ul><li>  Work through their personal account </li></ul><br>  <u>Opinion</u> : <br>  Soomla also seemed just an excellent option, because  it has all the advantages of prime plugins [31], but at the same time this system is completely free, although it was embarrassing to have to work through the personal account on their website, but in fact, there is almost nothing to do there, because the choice I stopped at this option. <br><br><h2>  Project Integration </h2><br>  The first thing to do (Suddenly!) Is to download the plugin itself, from the Asset Store, from the official site, there is no difference.  Both there and there the plug-in is updated almost simultaneously. <br><br>  After importing a plug-in into the project, the first thing to do is to set the settings in the editor. <br><br><img src="https://habrastorage.org/files/3cd/d30/89d/3cdd3089d26c4871b339edbe46d1bff6.png"><br><br>  In Soomla Secret, you must specify the Game Key, which you will receive when creating the application in your Soomla account.  <b>Without this, nothing will work!</b> <br><br><img src="https://habrastorage.org/files/38b/4c4/3fe/38b4c43fed9040c2878f4fc23015f93b.png"><br><br>  Debug Native and Unity Debug is your personal choice.  In Android Settings, the package name is automatically determined, and then you must actually choose which Android stores you use.  I think the API Key is clear where to get.  Receipt Validation is also your choice.  That's all, the basis we set up, it's time to go to the scripts. <br><br>  We need to actually describe our products in a separate class, so that we can buy them, for example: <br><br><div class="spoiler">  <b class="spoiler_title">Initialization of purchases</b> <div class="spoiler_text"><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Soomla.Store;// Soomla <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Soomla;// Soomla <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> dataIAP : IStoreAssets { //   IStoreAssets <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> GetVersion() { //  GetVersion,    ,          <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> VirtualCurrency[] GetCurrencies() { //   ,       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> VirtualCurrency[]{ITEM_OBJECT}; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> VirtualCurrencyPack[] GetCurrencyPacks(){ //      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> VirtualCurrencyPack[]{PACK_1_OBJECT, PACK_2_OBJECT}; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> VirtualGood[] GetGoods() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> VirtualGood[<span class="hljs-number"><span class="hljs-number">0</span></span>]; //  } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> VirtualCategory[] GetCategories() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> VirtualCategory[<span class="hljs-number"><span class="hljs-number">0</span></span>]; //      } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> const string ITEM_ID = "ITEM_ID";//    ID <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> const string PACK_1 = "ID_PACK_1";//  id,      (App Store, Google Play)    <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> const string PACK_2= "ID_PACK_2";//  id,      (App Store, Google Play)    <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static VirtualCurrency ITEM_OBJECT = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> VirtualCurrency(//     "ITEM_ID ",//  "ITEM_COIN", //  ITEM_ID //id   ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static VirtualCurrencyPack PACK_1_OBJECT = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> VirtualCurrencyPack(//      "PACK_1",//  "",//  PACK_1 ,//  id  <span class="hljs-number"><span class="hljs-number">100</span></span>, //    ITEM_ID ,//id    <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PurchaseWithMarket(PACK_1 , <span class="hljs-number"><span class="hljs-number">1.99</span></span>) //  id   ,   ( ,  ) ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static VirtualCurrencyPack PACK_2_OBJECT = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> VirtualCurrencyPack(// "PACK_2", "", PACK_2, <span class="hljs-number"><span class="hljs-number">200</span></span>, ITEM_ID , <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PurchaseWithMarket(PACK_2, <span class="hljs-number"><span class="hljs-number">5.99</span></span>) ); }</code> </pre> </div></div><br>  Thanks to the comments, more or less everything is clear, but I missed 2 things that are virtual 'benefits' and categories, they are basically needed by those who want to track the sale of even simple virtual purchases, not for real money, but even for the currency you sell for real money through the personal cabinet sumla, which we will talk about later. <br><br>  So, we have registered all our in-game purchases, but how now to transfer this data to the plugin and how to make purchases? <br><br>  And this is quite simple: <br><br><div class="spoiler">  <b class="spoiler_title">Soomla Initialization</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Soomla; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Soomla.Store; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Test { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Test () { SoomlaStore.Initialize (<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> dataIAP ());//         #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UNITY_ANDROID SoomlaStore.StartIabServiceInBg (); //  Android,       #endif } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> PayPack_1() { SoomlaStore.BuyMarketItem (StoreInfo.CurrencyPacks [<span class="hljs-number"><span class="hljs-number">0</span></span>].ItemId, "");//   } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> PayPack_2() { SoomlaStore.BuyMarketItem (StoreInfo.CurrencyPacks [<span class="hljs-number"><span class="hljs-number">1</span></span>].ItemId, "");//   } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Quit() { SoomlaStore.StopIabServiceInBg (); } }</code> </pre><br></div></div><br>  Very simple initialization, but we are also interested in the events that are available to us, and here they are (Basic): <br><br><div class="spoiler">  <b class="spoiler_title">Developments</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Soomla; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Soomla.Store; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ExampleEventHandler { //       <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ExampleEventHandler () { //,       StoreEvents.OnMarketPurchase += onMarketPurchase; //,       StoreEvents.OnItemPurchased += onItemPurchased; //,     StoreEvents.OnBillingSupported += onBillingSupported; //,      StoreEvents.OnBillingNotSupported += onBillingNotSupported; //,       StoreEvents.OnMarketPurchaseStarted += onMarketPurchaseStarted; //,       StoreEvents.OnItemPurchaseStarted += onItemPurchaseStarted; //,       StoreEvents.OnMarketPurchaseCancelled += onMarketPurchaseCancelled; //,    StoreEvents.OnSoomlaStoreInitialized += onSoomlaStoreInitialized; //,     Soomla StoreEvents.OnUnexpectedStoreError += onUnexpectedStoreError; //   #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UNITY_ANDROID &amp;&amp; !UNITY_EDITOR StoreEvents.OnIabServiceStarted += onIabServiceStarted; StoreEvents.OnIabServiceStopped += onIabServiceStopped; #endif } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onUnexpectedStoreError(<span class="hljs-type"><span class="hljs-type">int</span></span> errorCode) { SoomlaUtils.LogError ("ExampleEventHandler", "error with code: " + errorCode); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onMarketPurchase(PurchasableVirtualItem pvi, string payload, <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span>&lt;string, string&gt; extra) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onItemPurchased(PurchasableVirtualItem pvi, string payload) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onBillingSupported() { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onBillingNotSupported() { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onMarketPurchaseStarted(PurchasableVirtualItem pvi) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onItemPurchaseStarted(PurchasableVirtualItem pvi) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onMarketPurchaseCancelled(PurchasableVirtualItem pvi) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onCurrencyBalanceChanged(VirtualCurrency virtualCurrency, <span class="hljs-type"><span class="hljs-type">int</span></span> balance, <span class="hljs-type"><span class="hljs-type">int</span></span> amountAdded) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onSoomlaStoreInitialized() { } #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UNITY_ANDROID &amp;&amp; !UNITY_EDITOR <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onIabServiceStarted() { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onIabServiceStopped() { } #endif }</code> </pre> <br></div></div><br><br>  That's it, the system is fully operational. <br><br>  But now a little about the personal account of Soomla.  There you can track all transactions of your users, both with real money and with in-game currency, in order to need goods and categories, so that it is easier to keep track of everything, but to work with this thing you need to work with Soomla Highway.  But this article is not about that. <br><br>  And a few words about testing.  Testing purchases on android is easy, you have filled the build, for example, for a beta test and test it for health, but on ios you must create an account for the sandbox: <br><img src="https://habrastorage.org/files/8c5/a2a/654/8c5a2a654bc2401f9e9d0b6b94da0db1.png"></div><p>Source: <a href="https://habr.com/ru/post/263899/">https://habr.com/ru/post/263899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263887/index.html">Happy System Administrator</a></li>
<li><a href="../263891/index.html">Market research, Cortana for Android, page design of your application on the App Store - and other news of the week for a mobile developer</a></li>
<li><a href="../263893/index.html">Samsung solid-state drives are justified. The problem was in the Linux kernel</a></li>
<li><a href="../263895/index.html">Proper API design: what are ‚Äúone‚Äù, ‚Äúmany‚Äù, ‚Äúzero‚Äù and ‚Äúnothing‚Äù</a></li>
<li><a href="../263897/index.html">UI performance comparison in WPF, Qt, WinForms and FLTK</a></li>
<li><a href="../263901/index.html">Webinar second. Bug work, work tools and customer relationship building methods</a></li>
<li><a href="../263903/index.html">New critical vulnerabilities in Android: What is the problem, and how to protect</a></li>
<li><a href="../263905/index.html">‚ÄúSpeed ‚Äã‚Äãis such a feature that no one ever refuses‚Äù - an interview with Dmitry Zhemerov from JetBrains</a></li>
<li><a href="../263907/index.html">Correlation, covariance and deviation (part 3)</a></li>
<li><a href="../263909/index.html">Telerik's VirtualQueryableCollectionView weak spot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>