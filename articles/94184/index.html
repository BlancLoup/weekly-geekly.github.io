<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TV entertainment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started when several PBI DCH-4000P-S42 tuners were brought to us. 

  

 According to the characteristics, this miracle of the Chinese industry...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TV entertainment</h1><div class="post__text post__text-html js-mediator-article"> It all started when several PBI DCH-4000P-S42 tuners were brought to us. <br><br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/87/e2/87e21da72b045cece6aae65d7f6433c6.jpg"></a> <br><br>  According to the characteristics, this miracle of the Chinese industry is approaching professional tuners, but at an incomparably low price.  It was originally intended to use these tuners to replace the zoo, which began with Openboxes and Globes and ended with Vantags, as well as for implementing DVB-C in HFC and some sort of DVB-S using Mitris.  A cursory examination of the documentation showed that in addition to the initially (and not interesting) ASI, SDI, A / V, RGB, CVBS, XRL outputs required from it, it can also IP input or output with UDP / RTP (optional) and Multicast and Unicast on IP is already much more interesting and more profound, as it were.  There is such an occupational disease - be sure to touch the handles with something where there is at least a hint of network capabilities. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  The first thought was something like ‚ÄúLet's play IPTV, since it is almost inside‚Äù <br><br>  <i>Initial conditions</i> <br>  1. There is an old analogue KTV network covering about 90% of the entire city where DOCSIS 2.0 lives <br>  2. There is an FTTB network covering about 95% of all multi-storey buildings in the city and in many places intersecting with the cable TV network <br>  3. FTTB consists of switches, mainly Zyxel GS-4012F, Zyxel GS-3012F, Zyxel ES-2108, Foxgate S-6024-S2L2, S-6008-S2L2, Foxgate S-6208-S1, Foxgate S-6024-S4L2 and other zoo of the entire range of Foxgate. <br>  4. All the above devices in the manuals indicated that they can both igmp snooping and multicast support. <br>  5. The unpleasant fact of course was that 90% of all these pieces of hardware were 100Mbit / s copper subscribers, but for testing purposes all this suited completely (it was not planned to replace several hundreds of switches for ‚Äúplay‚Äù) <br><br>  <i>Black magic</i> <br>  The first thing that came to mind is to simply set up the tuner on some 6 open channels on any one transponder.  And then bend, stated in the multicast manual and poke it all into the switch located in the core of the FTTB network.  That without prolonged deliberation and was done with the test tuners available at hand.  The first suspicions of the failure of such a venture crept in 40 seconds after the <b>sudden</b> flurry of calls.  At a quick glance at the self-monitoring of switches, it turned out that when the receiver was plugged into the nuclear switch, about  of the network fell off at about the same time.  Strange, but nevertheless we repeat sticking of 1 receiver in a switch and on the panic that began almost immediately on support, we understand that the matter is not clean.  A more detailed study of the problem shows that two of the earliest Foxgate models fall out of the network, with old firmware at the sight of any even 4 megabit (1 channel in SD) multicaste.  To be precise, the earliest and cheapest 6208 generally goes to the astral before the broadcast stops and the 24 port model with IP zomboyaschik began to ping under 900ms and with a hellish packlose (well, what did you want for such ridiculous money - tobish at a price of 2 times fewer similar solutions from Zyxel). <br>  The second pebble in the garden of the original idea turned out to be that in the latest firmware available at that time for these receivers, the maximum TTL that could be indicated was 5 which somehow did not particularly agree with the realities of the existing infrastructure at that time.  In addition, I remembered DOCSIS subscribers who may also want to see a ‚Äúzomboyaschik through the Internet‚Äù. <br>  The last two factors cut off the desire to cut out selectively on L3 devices that do not tolerate multicast broadcasting, and think about other options.  Unicast on specific people from the receiver also turned out to be a stupid idea and we dropped it immediately. <br>  After a brief googling and thinking, the simplest and most obvious (and also pioneer-artisan) solution seemed to be just catching the multicast on one machine with VLC installed and wrapping the resulting image in HTTP. <br><br>  Since no one was going to buy any glands, they collected something from the pasture with a P4 2.4GHz / 1Gb RAM configuration / Some kind of screw from the desk drawer / 2 network card.  It was installed frya 7.1 and VLC 0.8.6i.  All this was collected in the following structure: <br><br><br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/62/28/62289cb8945bbad4ba3e47b6fb9cc42a.jpg"></a> <br><br>  The config vlc.cfg looked like this: <br> <code>new channel11 broadcast enabled <br> new channel12 broadcast enabled <br> ‚Ä¶. <br> setup channel11 input udp://@239.0.0.1:1234 <br> setup channel11 output #standard{access=http,mux=ts,dst=my.hostname:8011} <br> setup channel12 input udp://@239.0.0.2:1234 <br> setup channel12 output #standard{access=http,mux=ts,dst= my.hostname:8012} <br> ‚Ä¶. <br> control channel11 play <br> control channel12 play <br></code> <br><br>  Actually everything is clear and logical in it - we catch a Broadcast 239.0.0.x from the fxp0 network card and then return it from the network fxp1 already wrapped in http from ports 8011, 8012 and so on.  There are no special nuances in all this, if you do not forget to write a rout on the broadband network through the necessary interface (route_broad = "239.0.0.0/24 192.168.8.8"). <br><br>  Then you can run all this with a view script. <br><br> <code>#!/bin/sh <br> /usr/local/bin/vlc --daemon --intf telnet --telnet-password gfhjkmnfrjqgfhjkm --vlm-conf /usr/local/etc/vlc.cfg <br> sleep 3 <br> ps axv|grep vlc|awk '{print $1; exit;}' &gt; /var/run/vlc.pid <br></code> <br><br>  and start enjoying life. <br><br>  The next step was simply and naturally to transfer all this to the existing media server to which users have the maximum speed.  To do this, we collect portfwd with a config for the same two channels shown for the example: <br><br> <code>tcp { <br> 8011 {=&gt;172.40.0.121:8011} <br> } <br> <br> tcp { <br> 8012 {=&gt;172.40.0.121:8012} <br> } <br></code> <br><br>  We start the forwarder with the portfwd ‚Äìc /usr/local/etc/portfwd.cfg command and test using the same VLC.  Next, we go to Wikipedia to read the description of the M3U format and build a playlist which we will distribute to users along with the instruction how to install VLC and feed the playlist to it. <br><br> <code><a href="http://iptv.domain/"></a> <a href="http://iptv.domain/"></a> #EXTM3U <br> #EXTINF:1,MTV <br> iptv.domain:8011 <br> #EXTINF:1,QTV <br> iptv.domain:8012 <br></code> <br><br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/cd/79/cd79f1d92f5200c2d27d8362316773f7.jpg"></a> <br>  It seems that everything works, the machine of the above-mentioned ridiculous configuration retransmits 20 channels (80 Mbit stream from 4 receivers) while gritting his teeth.  Of the unpleasant effects, it is possible to note periodic VLC drops due to leaky memory, which can be treated with periodic restarts of VLC with the help of the crown, as well as the initial pioneering and dampness of the solution for obvious reasons - one user 4-4.5 Mbit, one hundred obviously already under half a gigabit.  But for the sake of interest and lack of desire to finance something more serious, it will completely come down.  In addition, users connected using DOCSIS technology will still be able to look at this, unlike other options. <br><br>  Naturally, in the same way, you can catch channels using a DVB card, or simply show a movie from a file dump - this is how the imagination works / resources allow. <br><br>  As a further development of the idea, we can consider writing a simple little gadget to billing that allows the user to create his prepaid playlist with the channels he needs and the distinction between banal imbued ones in ipfw tablets with allow / deny through the corresponding broadcast ports.  But more about that next time. <br><br>  Habrayuzer <a href="https://habrahabr.ru/users/miver/" class="user_link">miver</a> prompted to use in order to convert UDP Multicast -&gt; HTTP a product called <a href="http://sourceforge.net/projects/udpxy/">udpxy</a> which is judging by its ‚Äúdocumentation‚Äù nothing more than ‚ÄúUDP-to-HTTP multicast traffic relay daemon‚Äù.  All the same, the world is not without good people because everything just shines with speed and simplicity. <br><br>  Installation: <br> <code><a href=""></a> #wget downloads.sourceforge.net/project/udpxy/udpxy/Chipmunk-1.0/udpxy.1.0-Chipmunk-16.tgz <br> #tar zxvf udpxy.1.0-Chipmunk-16.tgz <br> #cd udpxy-1.0-Chipmunk-16/ <br> # gmake &amp;&amp; gmake install <br></code> <br><br>  Use based on our example: <br> <code>#udpxy -p 8011 -M 30 -B 2Mb -a 8.8.8.8 -c 15 <br></code> <br><br>  And a custom playlist will look like this: <br> <code><a href="http://iptv.domain/"></a> <a href="http://iptv.domain/"></a> #EXTM3U <br> #EXTINF:1,MTV <br> iptv.domain:8011/udp/239.0.0.1:1234 <br> #EXTINF:1,QTV <br> iptv.domain:8011/udp/239.0.0.2:1234 <br> .... <br></code> <br><br>  It works with a load that is not comparable lower than VLC on the same tasks already for half a day.  It seems no surprises.  The only thing that depresses is the product is well documented in C.  Actually I recommend watching uopt.h on the topic of editing options. <br><br>  <i>Afterword</i> <br>  1. I would like to express my special gratitude to habro <a href="https://habrahabr.ru/users/mkrentovskiy/" class="user_link">user mkrentovskiy</a> for their invaluable help with VLC.  Actually, all the knowledge on the subject and the theory of stream broadcasting in general is drawn from his most interesting blog (I highly recommend, some articles about wowza are worth) and in person.  Thanks again that there are people just for the sake of interest who are ready to spend their personal time helping here in such entertainments. <br>  2. As a test implementation, assembled for half a working day - it may well be.  But yes - not for serious production. <br>  3. Yes, I am not literate, I know.  Language is not native, the school did not learn, although I guess this is a weak excuse.  If you perceive the missing comma as a personal insult - I apologize in advance.  Honestly - I did not want to. <br>  4. Firmware with the ability to specify a normal TTL and a glamorous web interface appeared much later. <br>  5. It can be made simpler and ‚Äúconceptual‚Äù - to put the receiver into one switch at the end of a switch and multicast - it‚Äôs not so fun to do, and even an article from line 1 seems not so entertaining. </div><p>Source: <a href="https://habr.com/ru/post/94184/">https://habr.com/ru/post/94184/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../94176/index.html">Koldoebina.RU</a></li>
<li><a href="../94177/index.html">E-Style Telecom at the 22nd international communications exhibition</a></li>
<li><a href="../94181/index.html">Droider Chart. Release 2</a></li>
<li><a href="../94182/index.html">How do you see .NET / C # 5.0?</a></li>
<li><a href="../94183/index.html">Almost a year since closed xmlhack.ru</a></li>
<li><a href="../94185/index.html">Social networks are so social!</a></li>
<li><a href="../94187/index.html">IE8 page collapses in IE8</a></li>
<li><a href="../94189/index.html">Google AdWords Coupon for LLC</a></li>
<li><a href="../94190/index.html">3D # 2 or Illustrate! do it yourself</a></li>
<li><a href="../94191/index.html">Android 2.2 Froyo - official video from Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>