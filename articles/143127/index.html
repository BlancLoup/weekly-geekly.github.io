<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Extending Ruby with Ruby: borrowing Python function decorators</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: I offer you a translation of the start of the presentation Michael Fairley - Extending Ruby with Ruby . I translated only the fir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Extending Ruby with Ruby: borrowing Python function decorators</h1><div class="post__text post__text-html js-mediator-article">  <i>From the translator: I offer you a translation of the start of the presentation <a href="http://speakerdeck.com/u/michaelfairley/p/extending-ruby-with-ruby">Michael Fairley - Extending Ruby with Ruby</a> .</i>  <i>I translated only the first part of the three, because it has the maximum practical value and benefit, in my opinion.</i>  <i>Nevertheless, I strongly recommend that you familiarize yourself with the full presentation, in which, in addition to Python, are examples of borrowing chips from Haskell and Scala.</i> <br><br><h4>  Function decorators </h4><br>  In Python there is such a thing - decorators, which is a syntactic sugar for adding to the methods and functions of the pieces of frequently used functionality.  Now I will show you some examples of what decorators are and why they could be useful in Ruby. <br><br>  I used to work a lot with Python and function decorators are definitely something that I‚Äôm lacking since then, and besides that that can help almost all of us make our Ruby code cleaner. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Take Ruby and pretend that we need to transfer money from one bank account to another.  It seems simple, right? <br><br><pre><code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span></span> from.balance -= amount to.balance += amount from.save! to.save! <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <a name="habracut"></a><br>  We deduct the amount from the ‚Äú <i>from</i> ‚Äù account balance ... <br><br><pre> <code class="ruby hljs">from.balance -= amount</code> </pre> <br>  And we add this amount to the account balance ‚Äú <i>to</i> ‚Äù ... <br><br><pre> <code class="ruby hljs">to.balance += amount</code> </pre> <br>  And save both accounts. <br><br><pre> <code class="ruby hljs">from.save! to.save!</code> </pre> <br>  But there are a couple of shortcomings, the most obvious of which is the lack of a transaction (if ‚Äú <i>from.save!</i> ‚Äù Completes successfully and ‚Äú <i>to.save!</i> ‚Äù Is not, then the money will dissolve in the air). <br><br>  Fortunately, ActiveRecord makes solving this problem very simple.  We simply wrap our code in a transaction method block and this ensures that everything inside the block either completes successfully or not. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span></span> ActiveRecord::Base.transaction <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> from.balance -= amount to.balance += amount from.save! to.save! <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  Let's now look at the same example in Python.  A version without a transaction looks almost exactly like Ruby. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.balance -= amount to.balance += amount <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.save() to.save()</code> </pre> <br>  But it is necessary to add a transaction and the code starts to look not so elegant. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: db.start_transaction() <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.balance -= amount to.balance += amount <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.save() to.save() db.commit_transaction() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: db.rollback_transaction() <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span></code> </pre> <br>  There are 10 lines of code in this method, but only 4 of them implement our business logic. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.balance -= amount to.balance += amount <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.save() to.save()</code> </pre> <br>  The other 6 lines are a pattern for running our logic inside a transaction.  This is ugly and too verbose, but what's even worse is that you have to remember all these lines, including the correct error handling and rollback semantics. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: db.start_transaction() ... db.commit_transaction() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: db.rollback_transaction() <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span></code> </pre> <br><br>  So how do we make it more beautiful and less repeat ourselves?  There are no blocks in Python, so the focus like in Ruby will not work here.  However, Python has the ability to easily transfer and reassign methods.  Therefore, we can write a ‚Äú <i>transactional</i> ‚Äù function that will take another function as an argument and return the same function, but already wrapped in a template transaction code. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.balance -= amount to.balance += amount <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.save() to.save() send_money = transactional(send_money)</code> </pre> <br>  But what the <i>transactional</i> function might look like ... <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transactional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fn)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transactional_fn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: db.start_transaction() fn(*args) db.commit_transaction() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: db.rollback_transaction() <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transactional_fn</code> </pre> <br>  It receives the function (" <i>send_money</i> " in our example) as its only argument. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transactional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fn)</span></span></span><span class="hljs-function">:</span></span></code> </pre> <br>  Defines a new function. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transactional_fn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args)</span></span></span><span class="hljs-function">:</span></span></code> </pre> <br>  The new function contains a template for wrapping business logic into a transaction. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: db.start_transaction() ... db.commit_transaction() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: db.rollback_transaction() <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span></code> </pre> <br>  Inside the template, the original function is called, to which the arguments that were passed to the new function are passed. <br><br><pre> <code class="python hljs">fn(*args)</code> </pre> <br>  Finally, the new feature returns. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transactional_fn</code> </pre> <br>  Thus, we pass the <i>send_money</i> function to the <i>transactional</i> function that we just defined, which in turn returns a new function that does everything the same as the <i>send_money</i> function, but does it all inside a transaction.  And then we assign this new function to our ‚Äú <i>send_money</i> ‚Äù function, overriding its original content.  Now, whenever we call the " <i>send_money</i> " function, the version with the transaction will be called. <br><br><pre> <code class="python hljs">send_money = transactional(send_money)</code> </pre> <br>  And this is what I was leading to all this time.  This idiom is so often used in Python that a special syntax is added to support it - the function decorator.  And this is how you make something transactional in Django ORM. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@transactional def send_money(from, to, amount): from.balance -= amount to.balance += amount from.save() to.save()</span></span></code> </pre> <br><br><h4>  So what? </h4><br>  Now you are thinking: ‚ÄúSo what?  You have just shown how this decorator mumba jumba solves the same problem that blocks solve.  Why do we need this hat in Ruby? ‚ÄùWell, let's take a look at a case in which the blocks no longer look so elegant. <br><br>  Let us have a method that calculates the value of the n-th element in the Fibonacci sequence. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  It is slow, so we want to memorize it.  A common approach for this is to stuff ‚Äú <i>|| =</i> ‚Äù everywhere, which suffers from the same ailment as the first example with a transaction ‚Äî we mix the code of our algorithm with the additional behavior we want to surround it with. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> @fib <span class="hljs-params"><span class="hljs-params">||</span></span>= {} @fib[n] <span class="hljs-params"><span class="hljs-params">||</span></span>= <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  In addition, we have forgotten here a couple of things, such as the fact that ‚Äúnil‚Äù and ‚Äúfalse‚Äù cannot be memorized in this way: one more thing that must be constantly remembered. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> @fib <span class="hljs-params"><span class="hljs-params">||</span></span>= {} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> @fib[n] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> @fib.has_key?(n) @fib[n] = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Well, we can solve this with a block, but blocks do not have access to the name or arguments of the function that calls them, so we have to pass this information explicitly. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> memoize(<span class="hljs-symbol"><span class="hljs-symbol">:fib</span></span>, n) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  And now, if we start adding more blocks around the core functionality ... <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> memoize(<span class="hljs-symbol"><span class="hljs-symbol">:fib</span></span>, n) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> time(<span class="hljs-symbol"><span class="hljs-symbol">:fib</span></span>, n) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  ... we will have to retype the method name and its arguments again and again. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> memoize(<span class="hljs-symbol"><span class="hljs-symbol">:fib</span></span>, n) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> time(<span class="hljs-symbol"><span class="hljs-symbol">:fib</span></span>, n) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> synchronize(<span class="hljs-symbol"><span class="hljs-symbol">:fib</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  This is a rather fragile construction and it will break at the same moment as soon as we decide to change the method signature in any way. <br><br>  However, this can be solved by adding such a thing right after defining our method. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ActiveSupport::Memoizable.memoize <span class="hljs-symbol"><span class="hljs-symbol">:fib</span></span></code> </pre> <br>  And this should remind you of what we saw in Python ‚Äî when the method was modified immediately after the method itself. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># Ruby def fib(n) ... end ActiveSupport::Memoizable.memoize :fib # Python def fib(n): ... fib = memoize(fib)</span></span></code> </pre> <br>  Why didn't the Python community like this solution?  Two reasons: <br><ul><li>  you can no longer track the execution of your code from top to bottom; </li><li>  it is too easy to move a method somewhere and forget to do it with the code that came after it. </li></ul><br>  Let's take a look at our Fibonacci example in Python. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  We want to memorize it, so we decorate it with the ‚Äú <i>memoize</i> ‚Äù function. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@memoize def fib(n): if n &lt;= 1: return 1 else return fib(n - 1) + fib(n - 2)</span></span></code> </pre> <br>  And if we want to measure the time of our method or synchronize its calls, then we simply add another decorator.  That's all. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@synchronize @time @memoize def fib(n): if n &lt;= 1: return 1 else return fib(n - 1) + fib(n - 2)</span></span></code> </pre> <br>  And now I will show you how to achieve this in Ruby (using ‚Äú+‚Äù instead of ‚Äú@‚Äù and the first letter as the capital letter).  And the cool thing is that we can add this syntax to the Ruby decorator, which is very close to the Python syntax, with just 15 lines of code. <br><br><pre> <code class="ruby hljs">+Synchronized +Timed +Memoized <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br><h4>  Dive </h4><br>  Let's go back to our <i>send_money</i> example.  We want to add to it the ‚Äú <i>Transactional</i> ‚Äù decorator. <br><br><pre> <code class="ruby hljs">+Transactional <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span></span> from.balance -= amount to.balance += amount from.save! to.save! <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  ‚Äú <i>Transactional</i> ‚Äù is a subclass of ‚Äú <i>Decorator</i> ‚Äù, which we will discuss below. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transactional</span></span></span><span class="hljs-class"> &lt; Decorator </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orig</span></span></span><span class="hljs-class">, *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">, &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blk</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRecord::Base</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">transaction</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orig</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(*</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">, &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blk</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  He has only one method ‚Äú <i>call</i> ‚Äù, which will be called instead of our original method.  As arguments, he gets a method that should ‚Äúwrap‚Äù, his arguments and his block, which will be passed to him when he is called. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig, *args, &amp;blk)</span></span></span></span></code> </pre> <br>  We open transaction. <br><br><pre> <code class="ruby hljs">ActiveRecord::Base.transaction <span class="hljs-keyword"><span class="hljs-keyword">do</span></span></code> </pre> <br>  And then we call the original method inside the transaction block. <br><br><pre> <code class="ruby hljs">orig.call(*args, &amp;blk)</code> </pre> <br>  Please note that the structure of our decorator is different from the way decorators work in Python.  Instead of defining a new function that will receive arguments, our Ruby decorator will receive the method itself and its arguments with each call.  We are forced to do so because of the semantics of binding methods to objects in Ruby, which we will talk about below. <br><br>  What is inside the <i>Decorator</i> class? <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.+@ @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class"> @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clear_decorator</span></span></span><span class="hljs-class"> @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  This thing is ‚Äú <i>+ @</i> ‚Äù - the ‚Äúunary plus‚Äù operator, so this method will be called when we call ‚Äú <i>+ DecoratorName</i> ‚Äù, as we did with ‚Äú <i>+ Transactional</i> ‚Äù. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">+@</span></span></span></span></code> </pre> <br>  We also need a way to get the current decorator. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-function"> @@</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  And a way to reset the current decorator. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_decorator</span></span></span><span class="hljs-function"> @@</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nil</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  The class that wants to have methods to decorate must be extended by the ‚Äú <i>MethodDecorators</i> ‚Äù module. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bank</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extend</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MethodDecorators</span></span></span><span class="hljs-class"> +</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transactional</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">send_money</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">balance</span></span></span><span class="hljs-class"> -= </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">balance</span></span></span><span class="hljs-class"> += </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">save!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">save!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  It would be possible to expand the class at once, but I think that the best practice in this case would be to leave such a decision at the discretion of the end user. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MethodDecorators</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method_added</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">super</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorator</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unless</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorator</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clear_decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orig_method</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instance_method</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">define_method</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |*</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">, &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blk</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orig_method</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decorator</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">, *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">, &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blk</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  ‚Äú <i>Method_added</i> ‚Äù is a private class method that is called every time a new method is defined in a class, giving us a convenient way to catch the moment when the method is created. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method_added</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span></span></code> </pre> <br>  Call the parent " <i>method_added</i> ".  You can easily forget about this by overriding methods like ‚Äú <i>method_added</i> ‚Äù, ‚Äú <i>method_missing</i> ‚Äù or ‚Äú <i>respond_to?</i>  ‚Äù, But if you don‚Äôt, you can easily break other libraries. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">super</span></span></code> </pre> <br>  We get the current decorator and interrupt the function if there is no decorator, otherwise reset the current decorator.  It is important to set the decorator to zero, because then we redefine the method, which again calls our " <i>method_added</i> ". <br><br><pre> <code class="ruby hljs">decorator = Decorator.decorator <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> decorator Decorator.clear_decorator</code> </pre> <br>  We retrieve the original version of the method. <br><br><pre> <code class="ruby hljs">orig_method = instance_method(name)</code> </pre> <br>  And redefine it. <br><br><pre> <code class="ruby hljs">define_method(name) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|*args, &amp;blk|</span></span></code> </pre> <br>  ‚Äú <i>Instance_method</i> ‚Äù actually returns an object of class ‚Äú <i>UnboundMethod</i> ‚Äù, which is a method that does not know which object it belongs to, so we have to bind it to the current object. <br><br><pre> <code class="ruby hljs">m = orig_method.bind(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)</code> </pre> <br>  And then we call the decorator, passing him the original method and arguments for it. <br><br><pre> <code class="ruby hljs">decorator.call(m, *args, &amp;blk)</code> </pre> <br><br><h4>  What else? </h4><br>  Of course there are a number of incredibly important points that need to be resolved before this code can be considered ready for the production environment. <br><br><h5>  Multiple Decorators </h5><br>  The implementation I gave allows using only one decorator for each method, but we want to be able to use more than one decorator. <br><br><pre> <code class="ruby hljs">+Timed +Memoized <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br><h5>  Area of ‚Äã‚Äãvisibility </h5><br>  <i>Define_method</i> defines public methods, but we want private and protected methods that can be decorated according to their scope. <br><br><pre> <code class="ruby hljs">private +Transactional <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from, to, amount)</span></span></span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br><h5>  Class methods </h5><br>  ‚Äú <i>Method_added</i> ‚Äù and ‚Äú <i>define_method</i> ‚Äù work only for the class instance methods, so you need to think of something else so that the decorators can work for the methods of the class itself. <br><br><pre> <code class="ruby hljs">+Memoize <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br><h5>  Arguments </h5><br>  In the Python example, I showed that we can pass values ‚Äã‚Äãto the decorator.  We want us to be able to create any kind of individual instances of decorators for our methods. <br><br><pre> <code class="ruby hljs">+Retry.new(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">post_to_facebook</span></span></span><span class="hljs-function"> ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br><h4>  gem install method_decorators </h4><br>  <a href="http://github.com/michaelfairley/method_decorators">github.com/michaelfairley/method_decorators</a> <br><br>  I implemented all these features, added a comprehensive test suite and rolled it all out in the form of a gem.  Use this because I think it can make your code cleaner, improve its readability and simplify its support. </div><p>Source: <a href="https://habr.com/ru/post/143127/">https://habr.com/ru/post/143127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143118/index.html">Text to Speech on Android</a></li>
<li><a href="../143119/index.html">+1 extension for Mozilla Firefox</a></li>
<li><a href="../143122/index.html">Facebook allows you to specify whether the account owner agrees to donate internal organs</a></li>
<li><a href="../143123/index.html">The first tablet on Windows 8 from HP</a></li>
<li><a href="../143124/index.html">Podcast "Notes on Qt" s01e03</a></li>
<li><a href="../143129/index.html">Neural networks for dummies. Start</a></li>
<li><a href="../143130/index.html">Leisure Suit Larry will come again!</a></li>
<li><a href="../143131/index.html">+1 extension for Opera</a></li>
<li><a href="../143133/index.html">Electricity and water from the air - we descend from heaven to earth</a></li>
<li><a href="../143134/index.html">The company RIM introduced the OS BlackBerry 10</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>