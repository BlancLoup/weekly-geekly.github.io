<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Powershell and stack depth</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a developer, I often develop deployment scripts. In one of the projects, the task arose in front of me to automate the deployment of the project, w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Powershell and stack depth</h1><div class="post__text post__text-html js-mediator-article">  As a developer, I often develop deployment scripts.  In one of the projects, the task arose in front of me to automate the deployment of the project, which consisted of several dozen tasks, with the ability to customize the composition of the components deployed on the stand. <br><a name="habracut"></a><br>  First of all, work was carried out on the unification of tasks interfaces and the following methods were highlighted: <br><br><div class="spoiler">  <b class="spoiler_title">Deployment Task Interface</b> <div class="spoiler_text"><pre><code class="hljs lua">$Task1_Config = ...; # ,     . <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task1_CheckRequirements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {} # ,     . <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task1_CanExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($project)</span></span></span></span> {} #   . <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task1_Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($project, $context)</span></span></span></span> {}</code> </pre> <br></div></div><br>  Considering that such steps became more and more, it was becoming more and more difficult to maintain scripts in this form.  After examining possible solutions, it was decided to implement each task as a separate object: <br><br><div class="spoiler">  <b class="spoiler_title">Object Interface for Deployment Task</b> <div class="spoiler_text"><pre> <code class="hljs php"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $result = <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-Object -Typename PSObject -Property ` @{ <span class="hljs-string"><span class="hljs-string">"name"</span></span> = <span class="hljs-string"><span class="hljs-string">"Task1"</span></span> <span class="hljs-string"><span class="hljs-string">"config"</span></span> = ... } Add-Member -InputObject $result -MemberType ScriptMethod -Name CheckRequirements -Value ` { } Add-Member -InputObject $result -MemberType ScriptMethod -Name CanExecute -Value ` { Param($project) } Add-Member -InputObject $result -MemberType ScriptMethod -Name Execute -Value ` { Param($project, $context) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result }</code> </pre><br></div></div><br>  In this form, the deployment scripts worked for a long time and nothing foreshadowed trouble.  At one point, I was faced with the task of deploying to a remote server.  In powershell there is a very convenient WinRM mechanism, which we used to use very actively, and, accordingly, to solve the problem, we stopped on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The solution was unstable.  On some deployment tasks, either an error occurred or Invoke-Command showed that the remote script was executed correctly, but in fact it was interrupted. <br><blockquote>  Unable to process remote command data.  Error message: WSMan provider lead process did not return the correct answer.  Vendor in leading process may behave incorrectly. </blockquote><br><blockquote>  The WSMan has not been accepted.  A provider may be improperly. </blockquote><br>  In EventViewer, I was able to find that the process on the remote machine was terminated with an error of 1726, but no intelligible information about the error could be detected.  At the same time, the launch of the same task on the remote machine was always successful. <br><br>  In the course of numerous experiments I caught The script failed due to the call depth overflow, which determined the future direction of research. <br><br>  Since PowerShell v2, the maximum stack depth in powershell scripts is 1000 calls, in subsequent versions this value was still significantly raised and stack overflow errors never occurred. <br><br>  I decided to conduct several tests to determine the stack depth when calling locally and through WinRM.  To do this, prepared a testing tool. <br><br><div class="spoiler">  <b class="spoiler_title">Testing Toolkit</b> <div class="spoiler_text"><pre> <code class="hljs php">$ErrorActionPreference = <span class="hljs-string"><span class="hljs-string">"Stop"</span></span> $cred = <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-Object System.Management.Automation.PsCredential(...) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runLocal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sb, $cnt)</span></span></span><span class="hljs-function"> </span></span>{ Write-Host <span class="hljs-string"><span class="hljs-string">"Local $cnt"</span></span> Invoke-Command -ScriptBlock $sb -ArgumentList @($cnt) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runRemote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sb, $cnt)</span></span></span><span class="hljs-function"> </span></span>{ Write-Host <span class="hljs-string"><span class="hljs-string">"Remote $cnt"</span></span> $s = <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-PSSession <span class="hljs-string"><span class="hljs-string">"."</span></span> -credential $cred <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Invoke-Command -Session $s -ScriptBlock $sb -ArgumentList @($cnt) } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { Remove-PSSession -Session $s } }</code> </pre><br></div></div><br>  The first test determined the possible recursion depth: <br><br><div class="spoiler">  <b class="spoiler_title">Determining the depth of recursion</b> <div class="spoiler_text"><pre> <code class="hljs bash"><span class="hljs-variable"><span class="hljs-variable">$scriptBlock1</span></span> = { Param(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span> -ne 0) { <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> $(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span> - 1) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } Write-Host <span class="hljs-string"><span class="hljs-string">" Call depth: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$($(Get-PSCallStack)</span></span></span><span class="hljs-string">.Count)"</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-variable"><span class="hljs-variable">$cnt</span></span> } runLocal <span class="hljs-variable"><span class="hljs-variable">$scriptBlock1</span></span> 3000 runRemote <span class="hljs-variable"><span class="hljs-variable">$scriptBlock1</span></span> 150 runRemote <span class="hljs-variable"><span class="hljs-variable">$scriptBlock1</span></span> 160 ---------- Local 3000 Call depth: 3004 Remote 150 Call depth: 152 Remote 160 The script failed due to call depth overflow.</code> </pre><br></div></div><br>  According to the result - the local stack depth is more than 3000, remotely - a little more than 150. <br><br>  150 is a pretty big deal.  To achieve it in the real work of deployment scripts is unrealistic. <br><br>  The second test determines the possible recursion depth when using objects: <br><br><div class="spoiler">  <b class="spoiler_title">Determining the depth of recursion when using objects</b> <div class="spoiler_text"><pre> <code class="hljs bash"><span class="hljs-variable"><span class="hljs-variable">$scriptBlock2</span></span> = { Param(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span></span>() { <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = New-Object -Typename PSObject -Property @{ } Add-Member -InputObject <span class="hljs-variable"><span class="hljs-variable">$result</span></span> -MemberType ScriptMethod -Name Execute -Value ` { Param(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span> -ne 0) { <span class="hljs-variable"><span class="hljs-variable">$this</span></span>.Execute(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span> - 1) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } Write-Host <span class="hljs-string"><span class="hljs-string">" Call depth: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$($(Get-PSCallStack)</span></span></span><span class="hljs-string">.Count)"</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$result</span></span> } <span class="hljs-variable"><span class="hljs-variable">$obj</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-variable"><span class="hljs-variable">$obj</span></span>.Execute(<span class="hljs-variable"><span class="hljs-variable">$cnt</span></span>) } runLocal <span class="hljs-variable"><span class="hljs-variable">$scriptBlock2</span></span> 3000 runRemote <span class="hljs-variable"><span class="hljs-variable">$scriptBlock2</span></span> 130 runRemote <span class="hljs-variable"><span class="hljs-variable">$scriptBlock2</span></span> 135 ---------- Local 3000 Call depth: 3004 Remote 130 Call depth: 132 Remote 135 Processing data <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a remote <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> failed with the following error message: The WSMan provider host process did not <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> a proper response.</code> </pre><br></div></div><br>  The results are a bit worse.  Remotely stack depth 130-133.  But for work it is also very important. <br><br>  Further study of the original deployment scripts prompted the idea to check how try-catch blocks work: <br><br><div class="spoiler">  <b class="spoiler_title">Determining the depth of recursion using objects and try-catch</b> <div class="spoiler_text"><pre> <code class="hljs php">$scriptBlock3 = { Param($cnt) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $result = <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-Object -Typename PSObject -Property @{ } Add-Member -InputObject $result -MemberType ScriptMethod -Name Execute -Value ` { Param($cnt) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($cnt -ne <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>.Execute($cnt - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } Write-Host <span class="hljs-string"><span class="hljs-string">" Call depth: $($(Get-PSCallStack).Count)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"error"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $obj = test $obj.Execute($cnt) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">" Exception catched"</span></span> } } runLocal $scriptBlock3 <span class="hljs-number"><span class="hljs-number">130</span></span> runRemote $scriptBlock3 <span class="hljs-number"><span class="hljs-number">5</span></span> runRemote $scriptBlock3 <span class="hljs-number"><span class="hljs-number">6</span></span> ---------- Local <span class="hljs-number"><span class="hljs-number">130</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched Remote <span class="hljs-number"><span class="hljs-number">5</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched Remote <span class="hljs-number"><span class="hljs-number">6</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">8</span></span> The script failed due to call depth overflow.</code> </pre><br></div></div><br>  And here I was waiting for a huge surprise.  When using ‚Äúobjects‚Äù and generating an exceptional situation, the possible stack depth is locally about 130, and remotely only 5. <br><br><div class="spoiler">  <b class="spoiler_title">Determining the depth of recursion using try-catch without objects</b> <div class="spoiler_text"><pre> <code class="hljs php">$scriptBlock4 = { Param($cnt) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cnt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($cnt -ne <span class="hljs-number"><span class="hljs-number">0</span></span>) { test $($cnt - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } Write-Host <span class="hljs-string"><span class="hljs-string">" Call depth: $($(Get-PSCallStack).Count)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"error"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { test $cnt } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">" Exception catched"</span></span> } } runLocal $scriptBlock4 <span class="hljs-number"><span class="hljs-number">2000</span></span> runRemote $scriptBlock4 <span class="hljs-number"><span class="hljs-number">150</span></span> ---------- Local <span class="hljs-number"><span class="hljs-number">2000</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">2004</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched Remote <span class="hljs-number"><span class="hljs-number">150</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">152</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched</code> </pre><br></div></div><br>  But with the abandonment of the use of "objects" the problem disappeared.  The stack depths were at the level of the first test. <br><br>  In powershell 5, classes appeared.  Conducted a test using them: <br><br><div class="spoiler">  <b class="spoiler_title">Determining the depth of recursion using try-catch without objects</b> <div class="spoiler_text"><pre> <code class="hljs php">$scriptBlock5 = { Param($cnt) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">Class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test</span></span></span><span class="hljs-class"> </span></span>{ Execute($cnt) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($cnt -ne <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>.Execute($cnt - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } Write-Host <span class="hljs-string"><span class="hljs-string">" Call depth: $($(Get-PSCallStack).Count)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"error"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $t = [test]::new() $t.Execute($cnt) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">"Exception catched"</span></span> } } runLocal $scriptBlock5 <span class="hljs-number"><span class="hljs-number">130</span></span> runRemote $scriptBlock5 <span class="hljs-number"><span class="hljs-number">7</span></span> runRemote $scriptBlock5 <span class="hljs-number"><span class="hljs-number">8</span></span> ---------- Local <span class="hljs-number"><span class="hljs-number">130</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched Remote <span class="hljs-number"><span class="hljs-number">7</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched Remote <span class="hljs-number"><span class="hljs-number">8</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">10</span></span> The script failed due to call depth overflow.</code> </pre><br></div></div><br>  No special winnings were received.  When calling via WinRM, the stack depth was only 7 hops.  What is also not enough for the normal operation of scripts. <br><br>  Working with testing scripts, the idea came to implement objects with the hash + script block. <br><br><div class="spoiler">  <b class="spoiler_title">Determining the depth of recursion using try-catch and hash + script block</b> <div class="spoiler_text"><pre> <code class="hljs php">$scriptBlock6 = { Param($cnt) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($self, $scriptName, [parameter</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(ValueFromRemainingArguments = $true)</span></span></span></span><span class="hljs-function"><span class="hljs-params">] $args)</span></span></span><span class="hljs-function"> </span></span>{ $args2 = @($self) + $args Invoke-Command -ScriptBlock $self.$scriptName -ArgumentList $args2 } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $result = @{ } $result.Execute = { Param($self, $cnt) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($cnt -ne <span class="hljs-number"><span class="hljs-number">0</span></span>) { Call $self Execute $($cnt - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } Write-Host <span class="hljs-string"><span class="hljs-string">" Call depth: $($(Get-PSCallStack).Count)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"error"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $obj = test Call $obj Execute $cnt } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">"Exception catched"</span></span> } } runLocal $scriptBlock6 <span class="hljs-number"><span class="hljs-number">1000</span></span> runRemote $scriptBlock6 <span class="hljs-number"><span class="hljs-number">55</span></span> runRemote $scriptBlock6 <span class="hljs-number"><span class="hljs-number">60</span></span> ---------- runLocal $scriptBlock6 <span class="hljs-number"><span class="hljs-number">1000</span></span> runRemote $scriptBlock6 <span class="hljs-number"><span class="hljs-number">55</span></span> runRemote $scriptBlock6 <span class="hljs-number"><span class="hljs-number">60</span></span> Local <span class="hljs-number"><span class="hljs-number">1000</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">2005</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched Remote <span class="hljs-number"><span class="hljs-number">55</span></span> Call depth: <span class="hljs-number"><span class="hljs-number">113</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched Remote <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> catched</code> </pre><br></div></div><br>  The stack depth of 55 hops is already quite sufficient. <br><br>  The following summarizes the available stack depth in one table: <br><table><tbody><tr><td></td><td>  locally </td><td>  via winRM </td></tr><tr><td>  Function </td><td>  &gt; 3000 </td><td>  ~ 150 </td></tr><tr><td>  Object methods </td><td>  &gt; 3000 </td><td>  ~ 130 </td></tr><tr><td>  Object methods with try-catch </td><td>  ~ 130 </td><td>  <b>five</b> </td></tr><tr><td>  Function with try-catch </td><td>  &gt; 2000 </td><td>  ~ 150 </td></tr><tr><td>  Class method (ps5) with try-catch </td><td>  ~ 130 </td><td>  <b>7</b> </td></tr><tr><td>  Hash + script block with try-catch </td><td>  &gt; 1000 </td><td>  ~ 55 </td></tr></tbody></table><br>  I hope that this information will be useful not only for me!  :) </div><p>Source: <a href="https://habr.com/ru/post/320970/">https://habr.com/ru/post/320970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320960/index.html">CEF, ES6, Angular 2, TypeScript using .Net Core classes. Creating a cross-platform GUI for .Net using CEF</a></li>
<li><a href="../320962/index.html">Microservice architecture</a></li>
<li><a href="../320964/index.html">Matrix with ideas for startups</a></li>
<li><a href="../320966/index.html">CryptoAPI of the Linux kernel: development and application of Russian cryptography</a></li>
<li><a href="../320968/index.html">Over the past year, users of ad blockers have become 30% more</a></li>
<li><a href="../320972/index.html">A little Intel Xeon Phi can now get everyone</a></li>
<li><a href="../320974/index.html">On the state of affairs in the field of children's technical creativity. Immediate prospects</a></li>
<li><a href="../320976/index.html">Unconventional orientation of the PLO</a></li>
<li><a href="../320978/index.html">We invite you to Data Fest‚Å¥ February 11 and 12</a></li>
<li><a href="../320980/index.html">Criminals discovered using the ATP service in Windows Defender</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>