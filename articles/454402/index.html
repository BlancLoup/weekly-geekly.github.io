<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity's state machine architecture for organizing unit behaviors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first step in the development of my game was the development of the RTS engine. I plan to write a series of posts about the problems encountered a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity's state machine architecture for organizing unit behaviors</h1><div class="post__text post__text-html js-mediator-article">  The first step in the development of my game was the development of the RTS engine.  I plan to write a series of posts about the problems encountered and their solutions in this blog.  In this post I will tell you how organized the behavior of units. <br><br>  Reflecting on where to start this RTS engine at all, I came to the conclusion that it is worth starting with specifics and moving from it to abstraction.  The first application that came to mind was the collection of resources, or rather, the extraction of wood. <br><a name="habracut"></a><br>  Usually this process in most strategies consists in the fact that an employee, while receiving a decree to chop a tree, goes to a tree, waves a pick with an ax for him, then goes to the warehouse and starts anew. <br><br>  That is, the process looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/05c/ddf/4e2/05cddf4e2a5fc658662decf254b4ee32.png" alt="image"><br><br>  So that this picture could really claim the name of the automaton, it lacks conditions for transitions between states and initial and final states. <br><br>  Everything is simple: the machine is initialized with the state ‚ÄúI am going to chop‚Äù, and the end of the work occurs during the time of delivery.  We can express transitions between states using the following conditions: ‚Äúreached a tree‚Äù, ‚Äúchopped up a full armful of firewood‚Äù, ‚Äúreached a warehouse‚Äù, ‚Äúhanded over resources‚Äù.  If the answer is positive, the machine goes to the next state, if negative, it remains in the current state. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/051/5ed/d90/0515edd90af92dca98379f781a4a85ce.png" alt="image"><br><br>  In each of the states of the automaton, the corresponding action is called during the iteration.  The same set of actions can be performed during the transition between states. <br><br>  For example, during the iteration in the ‚ÄúI Pass‚Äù state, the resources from the unit's backpack will move to the player‚Äôs resource warehouse, and when going from the ‚ÄúI am going to cut‚Äù state to ‚ÄúRuble‚Äù state, the corresponding animation will start. <br><br>  I also note that walking itself is not an ‚Äúatomic‚Äù operation, it occurs in many behaviors and is itself a behavior, and for this reason, in fact, the behavior of tree extraction uses walking behavior within itself.  That is, a new automaton can be obtained by composing several other finite automata. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/66a/f4c/1e5/66af4c1e51968bd7c65a07c3d9958543.png" alt="image"><br><br>  By writing behaviors in this way, we get an architectural boundary between the details of the implementation of behaviors and the high-level policy of managing these behaviors.  Implementations of behavior become essentially plugins for the rest of the game, that is, changes in them will not affect the correctness of the high-level logic. <br><br>  These behaviors work by calling the iteration method from the Update event of objects of type Unit (this event fires every frame).  To communicate with the rest of the world, call IStateMachineListener methods. <br><br>  This is an example of the construction machine in my game.  When a construction team is received, the unit is sent to the indicated point, and then it goes into the state of direct construction, transferring the units of construction to the building.  When a building has accumulated enough units of construction, the construction machine ends and the unit receives a new behavior, the default behavior. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/F-3sYSvgio0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  That's all.  If you like or dislike this format, write about it in the comments! </div><p>Source: <a href="https://habr.com/ru/post/454402/">https://habr.com/ru/post/454402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454396/index.html">Installing sdl2 on major distributions</a></li>
<li><a href="../454398/index.html">From critics to algorithms: how democracy and technocracy came to the music industry</a></li>
<li><a href="../4544/index.html">The introduction of PR: a scandal in the American blogosphere</a></li>
<li><a href="../45440/index.html">Contextual advertising for various types of sites (seminar for advertisers)</a></li>
<li><a href="../454400/index.html">Daily reports on the status of virtual machines using R and PowerShell</a></li>
<li><a href="../454404/index.html">Training Cisco 200-125 CCNA v3.0. Day 6. Fill in the blanks (DHCP, TCP, ‚Äúhandshake‚Äù, common port numbers)</a></li>
<li><a href="../454406/index.html">Akihabara: Otaku nesting site</a></li>
<li><a href="../454408/index.html">Hardware bit banding CortexM3 / M4 (ARM), kernel architecture, assembler, C / C ++ 14 and a drop of metaprogramming</a></li>
<li><a href="../45441/index.html">Antispam by postfix + spamassassin</a></li>
<li><a href="../454410/index.html">New in PHP 7.4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>