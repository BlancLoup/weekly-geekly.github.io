<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Electric bike Do-it-yourself motor controller</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you already know from past posts, we have a DIY movement in our company. In his spare time, his colleagues are engaged in milling of printed circui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Electric bike Do-it-yourself motor controller</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/889/7be/05b/8897be05b8c9408499d540f635166b7a.jpg" alt="image"></p><br><p>  As you already know from past posts, we have a DIY movement in our company.  In his spare time, his colleagues are engaged in <a href="https://geektimes.ru/company/mailru/blog/286548/">milling of printed circuit boards at home</a> , make a <a href="https://geektimes.ru/company/mailru/blog/255918/">thermal imager on FLIR Lepton</a> , and also <a href="https://habrahabr.ru/company/mailru/blog/301562/">solve family differences with the help of 4 controllers and 2 smart watches</a> .  Let's continue the series of fascinating stories!  Today I will tell you how to make a controller to a three-phase electric bike with your own hands.  The purpose of creating such a controller was: </p><br><ol><li>  Study of the work of a three-phase motor under the control of the controller. </li><li>  Most controllers for electric bicycles on the market are Chinese.  Although they are relatively cheap (about 2.000 rubles depending on the power), they are an unknown box in which everything is unknown.  And immediately there are a lot of questions for her - is it economical to consume and distribute the current, how much power does it have, why does it overheat so much, does current protection work, etc. </li></ol><br><p>  At the same time, European high-quality electric bike controllers are on the market.  They are equipped with advanced functions, operate at different voltages and currents and can be programmed.  They are installed on heavy duty electric bikes.  But the price they bite - 10-20 thousand rubles. </p><br><p>  In the end, I decided to go my own way: to understand the controller's device, make its prototype, and then try to make the controller better than the Chinese controller.  At the moment, the project is in my development only and at the level of the prototype, there is no ready option yet.  I will be glad to hear your comments and advice. </p><a name="habracut"></a><br><h2 id="primenenie">  Application </h2><br><p>  Electric bikes use three-phase brushless electric motors with Hall sensors.  It should be noted that the use of such three-phase engines is quite extensive: </p><br><ul><li>  Appliances </li><li>  Office equipment </li><li>  Electric transport </li><li>  Industry </li></ul><br><h2 id="ustroystvo-dvigatelya">  Engine unit </h2><br><p>  To develop a controller, it is necessary to understand the principle of operation of the electric motor itself. </p><br><p><img src="https://habrastorage.org/files/368/ec8/746/368ec8746a0c47fc846eef03884e1ff2.png" alt="image"></p><br><p>  The motor consists of phase windings, magnets and Hall sensors that track the position of the motor shaft. </p><br><p>  Structurally, electric motors are divided into two types: inranners and outranners. </p><br><p><img src="https://habrastorage.org/files/aa7/926/634/aa7926634eb94e7e837a7263f98b6ad2.png" alt="image"></p><br><p>  Inranners magnetic plates are mounted on the shaft, and the windings are located on the drum (stator), in this case, the shaft is set in motion.  In the case of an autranner, the opposite is true: the phase windings are on the shaft, and there are magnetic plates in the drum.  This drives the drum. </p><br><p><img src="https://habrastorage.org/files/889/7be/05b/8897be05b8c9408499d540f635166b7a.jpg" alt="image"></p><br><p>  Since the bicycle wheel is mounted on the frame shaft, the type of outranner is applicable. </p><br><p><img src="https://habrastorage.org/files/f80/e5d/dfc/f80e5ddfc3b24c0da09c15377657d697.png" alt="image"></p><br><p>  In this picture there are three phases with windings interconnected.  In reality, the windings are much larger; they are evenly spaced alternating in phases around the motor circumference.  The more windings - the smoother, clearer, more elastic the engine. </p><br><p>  Three Hall sensors are installed in the engine.  Sensors respond to a magnetic field, thereby determining the position of the rotor relative to the motor stator.  Installed at intervals of 60 or 120 electrical degrees.  These degrees relate to the electrical phase rotation of the engine.  It is necessary to take into account that the more windings in the motor for each phase, the more electric revolutions occur during one physical motor-wheel revolution. </p><br><p><img src="https://habrastorage.org/files/d46/853/73c/d4685373cb7346fdb8f7f13db9f6c5ed.png" alt="image"></p><br><p>  The windings of the three phases in most cases are interconnected according to two schemes: a star and a triangle.  In the first case, the current passes from one of the phases to the other, in the second - in all three phases to varying degrees.  Sometimes these two connection schemes are combined in one engine, for example, in electric vehicles.  When starting and speeding up, the phases are connected by the star: it gives a greater moment at relatively low revolutions;  Further, after the speed has been set, a triangle is switched, as a result, the number of revolutions increases when a large torque is no longer needed.  In fact, it turns out conditionally automatic transmission of an electric motor. </p><br><h2 id="cikl-raboty">  Work cycle </h2><br><p>  To set in motion a three-phase motor, it is necessary to consider the cycle of its work for the electric revolution.  So, we have three phases - A, B, C. Each of the phases gets positive and negative polarities at a certain point in time.  Alternately, in steps, a current is passed from the ‚Äúplus‚Äù of one phase to the ‚Äúminus‚Äù of the other phase.  The result is six steps = three phases √ó two polarities. </p><br><p>  A +, A‚Äì, B +, B‚Äì, C +, C‚Äì </p><br><p><img src="https://habrastorage.org/files/c43/74f/241/c4374f241c7c485da3ea2239cb79c942.jpg" alt="image"></p><br><p>  Consider these six steps of the cycle.  Suppose that the rotor position is set at the point of the first step, then from the Hall sensors we get the code type 101, where 1 is phase A, 0 is phase B, 1 is phase C. given polarities.  As a result, the shaft turns, the sensors read the code of the new shaft position, etc. </p><br><p>  The table shows the sensor codes and the change of phase combinations for most electric motors.  To reverse the wheel (reverse), it is enough to reverse the polarity signs of the phases in reverse.  The principle of operation of the engine is quite simple. </p><br><p>  The engine cycle is presented in gif-animation. </p><br><p><img src="https://habrastorage.org/files/a3e/79a/7e0/a3e79a7e0439422bb6089314eee742f1.gif" alt="image"></p><br><h2 id="tranzistory-i-n-most">  Transistors and H-bridge </h2><br><p>  But in order to alternately supply current to each of the phases and change their polarity, transistors are needed.  We also need the transfer of large currents, high switching speed and clear opening / closing of the gates.  In this case, it is more convenient to control the valves by voltage rather than current.  Therefore, the optimal field (MOSFET) transistors.  Most often they are used in controllers.  Very rarely you can find a combined version of the transistors. </p><br><p><img src="https://habrastorage.org/files/9f7/948/2df/9f79482df9ce48ffa1fcf60ab00e0023.png" alt="image"></p><br><p>  To switch phases with changing their polarities, use the classical H-bridge (H-Bridge) of field-effect transistors. </p><br><p><img src="https://habrastorage.org/files/ae0/7eb/95f/ae07eb95f2b84eddbdea103491f76a68.png" alt="image"></p><br><p>  It consists of three pairs of transistors.  Each pair is connected to the corresponding phase of the motor winding and provides current with a value (+ or -).  The transistors responsible for switching on the phase with a positive value are called high keys.  With negative - lower.  For each step, a pair of keys is opened: the upper single phase and the lower neighboring phase.  As a result, the current passes from one phase to another and sets the motor in motion. </p><br><p><img src="https://habrastorage.org/files/746/e5a/437/746e5a43775249488e440e945e12e8ed.jpg" alt="image"></p><br><p>  It is clear from the diagram that we cannot turn on the upper and the lower keys simultaneously for the same phase: a short circuit will occur.  Therefore, it is very important to quickly switch the upper and lower keys so that a transient does not appear closure.  And the better and faster we provide switching, the less we will have losses and heating / overheating of H-bridge transistors. </p><br><p>  To start it remains to provide control of the gates of the keys of the H-bridge.  To control the H-bridge you need: </p><br><ol><li>  Read the Hall sensors. </li><li>  Determine in which position which pair of keys to include. </li><li>  Send signals to the corresponding gates of the transistors. </li></ol><br><h2 id="prototip-na-arduino">  Prototype on Arduino </h2><br><p>  At hand I had an Arduino UNO, and I decided to put together a controller based on it. </p><br><p><img src="https://habrastorage.org/files/3a7/4a5/b81/3a74a5b8119a4ef5be8a0b088542e502.jpg" alt="image"></p><br><p>  The first thing I gave to Hall sensors was a supply of 5 volts from Arduino (it‚Äôs enough for sensors).  The signal wires from the sensors connected to the digital pins of Arduino, writing a simple program for reading and processing signals from the sensors. </p><br><pre><code class="hljs pgsql">//  - const <span class="hljs-type"><span class="hljs-type">int</span></span> TRAplus = <span class="hljs-number"><span class="hljs-number">8</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> TRAminus = <span class="hljs-number"><span class="hljs-number">9</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> TRBplus = <span class="hljs-number"><span class="hljs-number">10</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> TRBminus = <span class="hljs-number"><span class="hljs-number">11</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> TRCplus = <span class="hljs-number"><span class="hljs-number">12</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> TRCminus = <span class="hljs-number"><span class="hljs-number">13</span></span>; //  const <span class="hljs-type"><span class="hljs-type">int</span></span> HallA = <span class="hljs-number"><span class="hljs-number">3</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> HallB = <span class="hljs-number"><span class="hljs-number">1</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> HallC = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">boolean</span></span> vala; <span class="hljs-type"><span class="hljs-type">boolean</span></span> valb; <span class="hljs-type"><span class="hljs-type">boolean</span></span> valc; <span class="hljs-type"><span class="hljs-type">boolean</span></span> pvala; <span class="hljs-type"><span class="hljs-type">boolean</span></span> pvalb; <span class="hljs-type"><span class="hljs-type">boolean</span></span> pvalc; <span class="hljs-type"><span class="hljs-type">int</span></span> pHall; <span class="hljs-type"><span class="hljs-type">int</span></span> turns; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { //     pinMode(TRAplus, OUTPUT); pinMode(TRAminus, OUTPUT); pinMode(TRBplus, OUTPUT); pinMode(TRBminus, OUTPUT); pinMode(TRCplus, OUTPUT); pinMode(TRCminus, OUTPUT); //     <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { //        val vala = digitalRead(HallA); valb = digitalRead(HallB); valc = digitalRead(HallC); //  .   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vala &amp;&amp; !pvala) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pHall == HallC) //  HallB    turns++; pHall = HallA; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(valb &amp;&amp; !pvalb) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pHall == HallA) //  HallC    turns++; pHall = HallB; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(valc &amp;&amp; !pvalc) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pHall == HallB) //  HallA    turns++; pHall = HallC; } digitalWrite(TRAplus, (vala &amp;&amp; !valb) ? HIGH : LOW); // vala==HIGH  valb==LOW,   HIGH,  LOW digitalWrite(TRAminus, (valb &amp;&amp; !vala) ? HIGH : LOW); digitalWrite(TRBplus, (valb &amp;&amp; !valc) ? HIGH : LOW); digitalWrite(TRBminus, (valc &amp;&amp; !valb) ? HIGH : LOW); digitalWrite(TRCplus, (valc &amp;&amp; !vala) ? HIGH : LOW); digitalWrite(TRCminus, (vala &amp;&amp; !valc) ? HIGH : LOW); pvala = vala; pvalb = valb; pvalc = valc; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(vala); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(valb); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(valc); //<span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(turns/<span class="hljs-number"><span class="hljs-number">3</span></span>); }</code> </pre> <br><p>  Then he assembled an N-bridge from field NPN transistors.  He brought to the bridge an independent power supply at 12 volts.  But when debugging, to make sure I was working, I connected six pins 5V directly from Arduino to the gates of the H-bridge.  Most field-effect transistors have a gate operating at 20 volts.  So it is impossible to do, because the N-bridge will work poorly and overheat.  But for short-term tests it will go.  Somehow, with strong overheating and scary sounds, vibrations and jolts the wheel spun slowly.  A start. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/QE33HCjZ5pk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="mostovye-drayvery">  Bridge drivers </h2><br><p>  Next came the work on the voltage of 20 volts to control the valves.  To do this, there are bridge drivers of transistors, they provide stable pulses of 20 volts to the gate and high response speed.  At first I had popular drivers for low-power L293D motors. </p><br><p><img src="https://habrastorage.org/files/f60/ac6/ae3/f60ac6ae341c4350a0f2d54b625ccf5a.png" alt="image"></p><br><p>  To control the valves it is enough, besides, they are very simple to use.  One such driver can provide power for two pairs of keys.  So I took two pieces of L293D.  I assembled the controller with these drivers, and the wheel started spinning much smoother, there were less extraneous sounds, the heating of the transistors decreased.  But with increasing speed, synchronization with the controller disappeared, a strange sound appeared, the wheel jerked, vibrated and stopped completely. </p><br><p>  At the same time, I came across two options for bridge drivers: </p><br><ul><li>  HIP4086 <br><img src="https://habrastorage.org/files/0f2/fbd/9e4/0f2fbd9e4f3f4428977e22385bfecbf1.png" alt="image"></li><li>  IR2101 <br><img src="https://habrastorage.org/files/d88/fdb/11c/d88fdb11ce6543828b9bf4394f2f50cb.png" alt="image"></li></ul><br><p>  As for the HIP4086, this is a complete bridge driver designed for a three-phase electric motor.  It seemed to me somewhat confused, and my attempts to use it in the controller were not crowned with success: it never worked for me.  In-depth understanding of the reasons did not. </p><br><p>  And I took the IR2101 - half-bridge driver, which provides the operation of the lower and upper keys for one phase.  It is easy to guess that you need three such drivers.  By the way, the driver is very easy to use, its connection is painless and easy.  It turned out this scheme: </p><br><p><img src="https://habrastorage.org/files/533/790/840/5337908406f7427cb3f3d971740608cb.png" alt="image"></p><br><p>  Printed circuit board </p><br><p><img src="https://habrastorage.org/files/adc/0fc/c4c/adc0fcc4c0c745d499821b4291971f8c.png" alt="image"></p><br><p>  And the finished result </p><br><p><img src="https://habrastorage.org/files/220/770/03e/22077003ef964558aa940f43cec55e86.jpg" alt="image"></p><br><p>  I assembled a controller with this driver and started the engine.  The situation with the work of the motor has not changed dramatically, the symptoms remain the same as in the case of the driver L293D. </p><br><h2 id="apparatnoe-preryvanie">  Hardware interrupt </h2><br><p>  And then I realized what was the matter: Arduino does not have time to process the Hall sensor readings!  Therefore, it was necessary to use Arduino pins with a hardware interrupt.  Since Arduino DNA has only two such pins, and under the sensors you need three pins, you need to take Arduino Leonardo or Iskra Neo, where there are four such pins. </p><br><p><img src="https://habrastorage.org/files/b52/39d/d00/b5239dd00fbe40659e12b1f7197f57df.png" alt="image"></p><br><p>  Rewriting the program under the interrupt and connecting Iskra Neo instead of DNA, I repeated the test. </p><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/  - const int TAH = 8; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/T ‚Äî ,  ‚Äî  (),  ‚Äî    const int TAL = 9; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/T ‚Äî ,  ‚Äî  (), L ‚Äî    const int TBH = 10; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/T ‚Äî , B ‚Äî  (), H ‚Äî    const int TBL = 11; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/T ‚Äî , B ‚Äî  (), L ‚Äî    const int TCH = 12; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/T ‚Äî , C ‚Äî  (), H ‚Äî    const int TCL = 13; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/T ‚Äî , C ‚Äî  (), L ‚Äî    /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/------------------------------------------------------------------------------------------------ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  int HallA = 3; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 1 ( ) int HallB = 1; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 2 ( ) int HallC = 0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 3 ( ) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/------------------------------------------------------------------------------------------------ volatile boolean vala; volatile boolean valb; volatile boolean valc; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/------------------------------------------------------------------------------------------------ void setup() { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     pinMode(TAH, OUTPUT); pinMode(TAL, OUTPUT); pinMode(TBH, OUTPUT); pinMode(TBL, OUTPUT); pinMode(TCH, OUTPUT); pinMode(TCL, OUTPUT); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   vala = digitalRead(HallA); valb = digitalRead(HallB); valc = digitalRead(HallC); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      attachInterrupt (digitalPinToInterrupt(HallA), changeA, CHANGE); attachInterrupt (digitalPinToInterrupt(HallB), changeB, CHANGE); attachInterrupt (digitalPinToInterrupt(HallC), changeC, CHANGE); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/LOW  ,    LOW /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/CHANGE         LOW  HIGH,   /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/RISING          LOW  HIGH /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/FALLING          HIGH  LOW } void Fases() { digitalWrite(TAH, (vala &amp;&amp; !valb) ? HIGH : LOW); digitalWrite(TAL, (valb &amp;&amp; !vala) ? HIGH : LOW); digitalWrite(TBH, (valb &amp;&amp; !valc) ? HIGH : LOW); digitalWrite(TBL, (valc &amp;&amp; !valb) ? HIGH : LOW); digitalWrite(TCH, (valc &amp;&amp; !vala) ? HIGH : LOW); digitalWrite(TCL, (vala &amp;&amp; !valc) ? HIGH : LOW); void changeA() { vala = digitalRead(HallA); Fases(); } void changeB() { valb = digitalRead(HallB); Fases(); } void changeC() { valc = digitalRead(HallC); Fases(); } void loop() { }</span></span></code> </pre> <br><p>  The wheel finally worked clearly, without vibrations, noise, it was great to gain momentum without desynchronization.  The prototype was viable.  But this is not a full-fledged controller, since it did not have a strapping with protections and the provision of high-quality PWM signal. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/siZMHDaOYfo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GBruYskYiYc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="prototip-na-baze-mikroshemy-mc33035">  MC33035 based prototype </h2><br><p>  In parallel with the development of the controller at Arduino, I considered alternatives to the logical part of the controller.  And that led me to the MC33035 chip.  This is an old development from Motorola, now it is released by ON Semiconductor.  Designed specifically for powerful three-phase motors. </p><br><p><img src="https://habrastorage.org/files/c43/cb4/874/c43cb487486d4ca49eb34e555bd23921.png" alt="image"></p><br><p><img src="https://habrastorage.org/files/962/e74/e17/962e74e174b74aa997fd379af9eb04b4.png" alt="image"></p><br><p>  This chip: </p><br><ul><li>  Responsible for the entire logical part of the controller </li><li>  Reads from Hall sensors </li><li>  Defines the position of the shaft </li><li>  Gives signals for N-bridge gates to their drivers. </li><li>  Has the ability to connect an error indicator, overheating </li><li>  Processes and transmits PWM signal (PWM) </li><li>  Carries the reverse (reverse wheel) </li></ul><br><p>  In short, the chip contains everything you need to control the motor.  Its cost is very low: on Aliexpress - about 50 rubles.  To build a full-fledged controller based on it, you need an MC33035 microcircuit, half-bridge drivers and an N-bridge of field-effect transistors.  I also assembled the controller on this chip.  It works perfectly, stably, the wheel is spinning as it should at various revolutions.  But the functionality of the microcircuit is limited, if it is necessary to tinker with various functions, display the speed, odometer, battery consumption, then again there is a need to additionally connect Arduino or something similar. </p><br><p>  Circuit with MC33035 </p><br><p><img src="https://habrastorage.org/files/701/e67/f7a/701e67f7adc446fc867e2f7d4b9d724c.png" alt="image"></p><br><p>  Printed circuit board </p><br><p><img src="https://habrastorage.org/files/cbd/86e/b04/cbd86eb044354c249586c368f5b9f450.png" alt="image"></p><br><p>  Ready option </p><br><p><img src="https://habrastorage.org/files/b1a/dbd/bc2/b1adbdbc2f1b41f08a35711f74fa4ebe.jpg" alt="image"></p><br><h2 id="itog">  Total </h2><br><p>  The main advantage of the MC33035 based controller is its ease of use.  Just buy a chip, collect the H-bridge, solder everything on the board with a small strapping - and the controller is ready.  If you just need to start the engine with a PWM signal and control it, the best option. </p><br><p>  Arduino-based controller - the option is more difficult, you need to write logic, to provide additional protection for the controller.  But for experiments, prototypes, additional functionality, the use of various engine operating modes is a suitable option.  Therefore, I decided to postpone MC33035 for the time being and continue working with Arduino. </p><br><h2 id="plany-na-buduschee-kontrollera">  Future plans for the controller </h2><br><p>  Continuing work on the controller, I plan to do the following: </p><br><ul><li>  IGBT transistors for H-bridge instead of field-effect transistors. </li><li>  Strapping with protection for current, overheating, etc. </li><li>  Full cruise control with the ability to set the desired speed. </li><li>  Flow meter  When the required distance is set, and the controller, based on this value and battery charge, discharges the battery discharge throughout the route so that there is enough charge. </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/373397/">https://habr.com/ru/post/373397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../373385/index.html">Twitter will transfer the database of Russian users in Russia in 2018</a></li>
<li><a href="../373389/index.html">China launched its first space truck into orbit</a></li>
<li><a href="../373391/index.html">Thousands selected article. How does the review in Wikipedia</a></li>
<li><a href="../373393/index.html">Bayans of great ancestors or engineering problems of the module "Science"</a></li>
<li><a href="../373395/index.html">Electric lines of the future</a></li>
<li><a href="../373399/index.html">Bitcoin & Blockchain in Irkutsk: how did the Chronobank CEO and other answers to the questions turned out to be here</a></li>
<li><a href="../373403/index.html">Seek Thermal Pro vs Seek Thermal. Is it worth it?</a></li>
<li><a href="../373405/index.html">Headshots Removal Tool - First HyperX Gaming Mouse! Find out what's special about the new Pulsefire FPS</a></li>
<li><a href="../373407/index.html">Microsoft advises not to install Creators Update for Windows 10 manually</a></li>
<li><a href="../373409/index.html">Lecture "Space Disasters", the current version</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>