<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Game Gomoku (tic-tac-toe, 5 in a row)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reading the publications on Habr√©, I found a couple of articles about the algorithms of the Gomoku game: this one and this one . In the first article,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Game Gomoku (tic-tac-toe, 5 in a row)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/5f8/ab3/830/5f8ab3830829471fbf2e76431ad98407.png" alt="image"><br>  Reading the publications on Habr√©, I found a couple of articles about the algorithms of the Gomoku game: <a href="https://habrahabr.ru/post/202264/">this one</a> and <a href="https://habrahabr.ru/post/209544/">this one</a> .  In the first article, various solutions are analyzed, but there is no implementation in the form of a game, in the second, there is a game, but the computer is ‚Äúweak‚Äù.  I decided to make my own version of the gomoku game with <s>blackjack a</s> fairly strong computer game.  Publication of what happened in the end.  For those who love to immediately fight - <a href="http://www.artemlopatin.ru/gomoku/">the game itself</a> . <br><a name="habracut"></a><br>  First I want to decide on the main points.  First, there are <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BE%25D0%25BC%25D0%25BE%25D0%25BA%25D1%2583">many varieties</a> of gomoku game, I stopped at this option: the playing field is 15x15, the crosses go first, the one who first builds 5 in a row wins.  Secondly, for simplicity I will call the game algorithm for calculating progress by computer AI. <br><br><h5>  AI theory </h5><br>  <a href="https://habrahabr.ru/users/shebeko/" class="user_link">shebeko</a> in his <a href="https://habrahabr.ru/post/202264/">article</a> considered various algorithms AI.  It is clear that with a simple enumeration of all variants of moves, while deepening for several moves, the number of required calculations goes off scale.  Therefore, it is necessary to implement some algorithm smarter brute force in the forehead. <br><br>  Reading his article, I thought about the phrase: "Gomoku is a divergent game with complete information and sudden death."  Chess is given as an example of another game with sudden death.  In my understanding, there is a huge difference between chess and Homoku: one move in chess can drastically change the balance of forces.  In chess, pieces can go far and affect a multitude of cells.  A queen or a rook can potentially attack any cell of the field in 1 move, i.e.  in 1 move, you can put so that any particular cell will be attacked (if the lines of progress and attacks are free).  In Gomoku, there is no such effect; one figure (a ‚Äústone‚Äù - a cross or a zero) can influence only 5 neighboring cells in each direction.  This is the first prerequisite to my AI algorithm. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second important assumption is that there are ‚Äúendgames‚Äù in Gomoku - patterns that lead to victory.  Remember Tarantino's rhetorical question: ‚ÄúHow long does a person count to 600?‚Äù Similarly, to build a winning line of 5 pieces, you first need to build a line of 4 (in general: out of 5 with 1 missing from the edge (line of 4) or in the middle ), on the other - no way.  Continuing the argument, we obtain that a triple is necessary for 4, and a triple for a triple. <br><br>  I assumed that such patterns of moves is something analogous to the calculation of moves in depth, since  The moves are local (they have a relatively small radius of influence, unlike chess, for example).  So, you can simply iterate through all possible templates for each potential move.  This is the second half of the AI ‚Äã‚Äãalgorithm. <br><br>  It remains to determine the potential moves - those cells of the field in which you can put a figure.  In general, potential moves are all empty (unoccupied) board cells.  Given that the moves are local, we don‚Äôt need all the cells, we can only consider the ones nearest the pieces that are already on the board.  This is the first half of the AI ‚Äã‚Äãalgorithm. <br><br><h5>  AI algorithm </h5><br><h6>  1. Identify potential moves </h6><br>  Since  influence of figures locally, it makes no sense to identify potential moves each time anew.  You can simply accumulate them. <br>  - Special situation: if at the beginning of the game the computer goes first - the move is carried out in a pre-installed cell - the center of the board (the array of potential moves consists of 1 cell). <br>  - Later, after the user's move or AI, the fields separated by 2 cells from the move cell (adjacent and adjacent to neighboring) are added to the array of potential moves, and the cell into which the move is completed is removed from this array. <br><br><h6>  2. The calculation of the importance of each cell potential moves </h6><br>  For each cell from the array of potential moves: <br>  1) 4 lines of 9 cells are collected in the middle of which the selected cell itself (2 diagonal, vertical, horizontal) <br>  2) each line is compared with all available templates.  When a cell enters the pattern, its significance increases by the weight of this pattern.  If there is a possibility to put a ‚Äúplug‚Äù in the cage, then its weight will be 2 times larger (it will be summed up from the weights of the templates of two lines). <br><br><h6>  3. Select the cells with the maximum importance </h6><br>  The calculation of the weights will be carried out separately for the attack (based on the AI ‚Äã‚Äãfigures) and protection (comparison of lines from the opponent's figures with the same patterns), then they are summarized.  And the cell with the maximum weight is the best move in terms of AI. <br><br><h5>  Possible AI improvements </h5><br>  The first improvement is the addition of templates that I missed :) <br>  The second is the implementation of the calculation algorithm for at least a couple of moves ahead in order to identify potential forks and a series of winning moves in the future.  This is, by the way, the main way I manage to beat AI - creating a series of moves in which AI is forced to close 4 in order not to lose (it essentially has no alternative to the move) and as a result of this series of moves a fork is made of two prefinal lines (for example, two quadruples), so bury them in one move is not possible. <br><br><h5>  Implementation of the game </h5><br>  The game is written in pure JavaScript (without jQuery frameworks).  The graphical interface of the game is implemented on Canvas. <br><br><h5>  Result </h5><br>  <a href="http://www.artemlopatin.ru/gomoku/">The game itself</a> , the <a href="https://github.com/artemlopatin/gomoku">source code for github</a> (MIT). <br><br>  Thanks for attention.  I hope you enjoyed reading and playing, as I realized :) <br><br>  PS A small request, if you win easily - please attach a screenshot of the game and the moves (from the console logs) to analyze and improve the algorithm. <br><br><h5>  Update 1 </h5><br>  1. By 10% increased the importance of scales for the attack.  Now the attack for AI is preferable to protection, all other things being equal.  For example, if AI and user have 4k, then AI will prefer to win. <br><br>  2. Changed the values ‚Äã‚Äãof scales by patterns.  With a clearer balance weights, you can achieve a better game AI. <br>  The weights for the templates are now: <br>  99999 - xxxxx - five in a row (final winning line) <br>  7000 - _xxxx_ - the open four <br>  4000 - _xxxx - a four-closed four (two such fours are preferable to one open, perhaps a ‚Äúmore interesting game‚Äù will be) <br>  2000 - _x_xxx, _xx_xx, _xxx_x - a half-closed four with a gap (2 such fours are equal to one open foursome and ‚Äúpreferable‚Äù to an open three; but if only 1 such four, then an open three is preferable) <br>  3000 - _xxx_ - open triple <br>  1500 - _xxx - half-closed triple <br>  800 - _xx_x, _x_xx - a half-closed triple with a gap <br>  200 - _xx_ open deuce <br>  Also, small weights (from 1 to 20-30) are around all the moves to create a ‚Äúsmall randomness of the move‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/278837/">https://habr.com/ru/post/278837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278827/index.html">Developer's life (in pictures)</a></li>
<li><a href="../278829/index.html">Notes localizer. The case of the problem of saving in games</a></li>
<li><a href="../278831/index.html">Notes localizer. Voice acting in games</a></li>
<li><a href="../278833/index.html">Aspects of localization. Major developer errors</a></li>
<li><a href="../278835/index.html">As web design rolls straight to hell</a></li>
<li><a href="../278839/index.html">Gigabit Wi-Fi in Russia</a></li>
<li><a href="../278841/index.html">Database Testing Developer Version</a></li>
<li><a href="../278843/index.html">Installing and configuring GitLab + Redmine collaboration on Debian 8 jessie + Nginx - Part 1</a></li>
<li><a href="../278845/index.html">Alljoyn: embedded view of the developer. Part 2: Linux to help us</a></li>
<li><a href="../278847/index.html">How can you simplify your life using Telegram-bot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>