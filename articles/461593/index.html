<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>API on F #. Access Role Based Application Modules</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ASP.NET Core by standard offers to configure access to api using attributes, it is possible to restrict access to users with a certain claim, you can ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>API on F #. Access Role Based Application Modules</h1><div class="post__text post__text-html js-mediator-article"><p>  ASP.NET Core by standard offers to configure access to api using attributes, it is possible to restrict access to users with a certain claim, you can define policies and bind to controllers, creating controllers for different roles <br>  This system has minuses, the biggest in that, looking at this attribute: </p><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Authorize(Roles = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Administrator"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AdministrationController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { }</code> </pre> <br><p>  We do not receive any information about what rights the administrator has. </p><a name="habracut"></a><br><p>  My task is to display all banned users for this month (not just go to the database and filter, there are certain counting rules that lie somewhere), I do <em>CTRL + N</em> on the project and look for <em>BannedUserHandler</em> or <em>IHasInfoAbounBannedUser</em> or <em>GetBannedUsersForAdmin</em> . </p><br><p>  I find the controllers marked with the attribute <em>[Authorize (Roles = "Administrator")]</em> , there may be two scenarios: </p><br><p>  <em>We do everything in the controller</em> </p><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"api/[controller]/[action]"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AdminInfoController1</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IGetUserInfoService _getInfoAboutActiveUsers; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICanBanUserService _banUserService; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICanRemoveBanUserService _removeBanUserService; <span class="hljs-comment"><span class="hljs-comment">//    action public AdminInfoController1( IGetUserInfoService infoAboutActiveUsers, ICanBanUserService banUserService, ICanRemoveBanUserService removeBanUserService) { _getInfoAboutActiveUsers = infoAboutActiveUsers; _banUserService = banUserService; _removeBanUserService = removeBanUserService; } // actions //... //... }</span></span></code> </pre> <br><p>  <em>Spread by Handlers</em> </p><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"api/[controller]/[action]"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AdminInfoController2</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { [HttpPatch(<span class="hljs-string"><span class="hljs-string">"{id}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;ActionResult&lt;BanUserResult&gt;&gt; BanUser( [FromServices] IAsyncHandler&lt;UserId, BanUserResult&gt; handler, UserId userId) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> handler.Handle(userId, HttpContext.RequestAborted); [HttpPatch(<span class="hljs-string"><span class="hljs-string">"{id}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;ActionResult&lt;RemoveBanUserResult&gt;&gt; RemoveBanUser( [FromServices] IAsyncHandler&lt;UserId, RemoveBanUserResult&gt; handler, UserId userId) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> handler.Handle(userId, HttpContext.RequestAborted); }</code> </pre> <br><p>  The first approach is not bad in that we know the access to which resources the Admin has, what dependencies it can use, I would use this approach in small applications, without a complex subject area </p><br><p>  The second one is not so talking, all dependencies are resolved in handlers, I can‚Äôt look at the constructor and understand what kind of dependency I need, this approach justifies itself when the application is complex and the controllers swell, it becomes impossible to support them.  The classic solution to this problem is the partitioning of the solution into folders / projects, the necessary services are put in each one, they are easy to find and use </p><br><p>  All this has a big drawback, the code does not tell the developer what to do, it makes you think =&gt; waste of time =&gt; implementation errors </p><br><p>  And the more you have to think, the more mistakes are made. </p><br><h3>  Introduction to Suave Routing </h3><br><p>  What if routing is built <a href="https://www.c-sharpcorner.com/article/routing-in-suave-io-web-development-with-f-sharp/">like this</a> : </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> webPart = choose [ path <span class="hljs-string"><span class="hljs-string">"/"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"Home"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/about"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"About"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/articles"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"List of articles"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/articles/browse"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"Browse articles"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/articles/details"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"Content of an article"</span></span>) ]</code> </pre> <br><p>  ''&gt; =&gt; '' - what is it?  This thing has a name, but its knowledge will not bring the reader closer to understanding how it works, so there‚Äôs no point in bringing it, it‚Äôs better to consider how it works </p><br><p>  The pipeline from Suave is written above, the same is used in Giraffe (with a different signature of functions), there is a signature: </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option&gt;</span></span></code> </pre> <br><p>  Async in this case does not play a special role (to understand how it works), omit it </p><br><pre> <code class="haskell hljs"><span class="hljs-type"><span class="hljs-type">HttpContext</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">HttpContext</span></span> option</code> </pre> <br><p>  A function with such a signature accepts an <em>HttpContext</em> , processes (deserializes the body, looks at cookies, request headers), forms a response, and if everything went well, wraps it in <em>Some</em> , if something goes wrong, returns <em>None</em> , for example ( <a href="">library function</a> ): </p><br><pre> <code class="haskell hljs"> //    async <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-type"><span class="hljs-type">OK</span></span> s : <span class="hljs-type"><span class="hljs-type">WebPart</span></span> = fun ctx -&gt; { ctx with response = { ctx.response with status = <span class="hljs-type"><span class="hljs-type">HTTP_200</span></span>.status; content = <span class="hljs-type"><span class="hljs-type">Bytes</span></span> s }} |&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> |&gt; async.<span class="hljs-type"><span class="hljs-type">Return</span></span></code> </pre> <br><p>  This function cannot "wrap the request execution flow", it always throws a new response further, with a body and status of 200, but this one can: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> path (str:string) ctx = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> path = ctx.request.rawPath <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path.<span class="hljs-type"><span class="hljs-type">StartsWith</span></span> str <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ctx |&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> |&gt; async.<span class="hljs-type"><span class="hljs-type">Return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> async.<span class="hljs-type"><span class="hljs-type">Return</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span></code> </pre> <br><p>  The last function you <a href=""><em>need</em></a> is <a href=""><em>choose</em></a> - it gets a list of different functions and selects the one that returns Some first: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> choose (webparts:(<span class="hljs-type"><span class="hljs-type">HttpContext</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Async</span></span>&lt;<span class="hljs-type"><span class="hljs-type">HttpContext</span></span> option&gt;) list) context= async{ match webparts with | [head] -&gt; return! head context | head::tail -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>! result = head context match result with | <span class="hljs-type"><span class="hljs-type">Some</span></span> _-&gt; return result | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; return! choose tail context | [] -&gt; return <span class="hljs-type"><span class="hljs-type">None</span></span> }</code> </pre> <br><p>  Well, the most important binding function (Async omitted): </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPartWithoutAsync</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option let (&gt;=&gt;) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPartWithoutAsync</span></span></span><span class="hljs-class"> ) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPartWithoutAsync</span></span></span><span class="hljs-class">) ctx : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option = let result = h1 ctx match result with | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> ctx' -&gt; h2 ctx' | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Async version</b> <div class="spoiler_text"><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option&gt; let (&gt;=&gt;) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> ) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> ) ctx : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option&gt;= async{ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx'</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx'</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class"> }</span></span></code> </pre></div></div><br><p>  "&gt; =&gt;" accepts two handlers on the left and right sides and <em>httpContext</em> , when the request arrives, the server forms an HttpContext object and passes it to the function, "&gt; =&gt;" executes the first (left) handler if it returns <em>Some ctx</em> , passes ctx at the entrance of the second handler. </p><br><p>  And why can we write like this (combine several functions)? </p><br><pre> <code class="haskell hljs"><span class="hljs-type"><span class="hljs-type">GET</span></span> &gt;=&gt; path <span class="hljs-string"><span class="hljs-string">"/api"</span></span> &gt;=&gt; <span class="hljs-type"><span class="hljs-type">OK</span></span></code> </pre> <br><p>  Because "&gt; =&gt;" accepts two WebPart functions and returns one function that accepts <em>HttpContext</em> and returns <em>Async &lt;HttpContext option&gt;</em> , and which function takes context and returns <em>Async &lt;HttpContext option&gt;</em> ? <br>  <em>Webpart</em> . </p><br><p>  It turns out that <em>"&gt; =&gt;"</em> takes WebPart for the handler and returns <em>WebPart</em> , so we can write several combinators in a row, and not just two. <br>  Details about the work of combinators can be found <a href="https://suave.io/routing.html">here.</a> <br><br></p><br><h3 id="pri-chem-tut-roli-i-ogranichenie-dostupa">  What does the role and access restriction have to do with it? </h3><br><p>  Let us return to the beginning of the article, how can we explicitly indicate to the programmer what resources can be accessed for a particular role?  It is necessary to enter this data into the pipeline so that handlers have access to the corresponding resources, I did it like this: </p><br><p><img src="https://habrastorage.org/webt/i5/oh/zi/i5ohziec88tovhgpezx11dc0lw0.png"></p><br><p>  The application is divided into parts / modules.  In the <em>AdminPart</em> and <em>AccountPart functions</em> , access to these modules of various roles is allowed, all users have access to <em>AccountPart,</em> only admin is accessing AdminPart, data is received, pay attention to the chooseP function, I have to add more functions, because the standard ones are attached to Suave types, and handlers inside <em>AdminPart</em> and <em>AccountPart now have</em> different signatures: </p><br><pre> <code class="haskell hljs">// <span class="hljs-type"><span class="hljs-type">AdminPart</span></span> <span class="hljs-type"><span class="hljs-type">AdminInfo</span></span> * <span class="hljs-type"><span class="hljs-type">HttpContext</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Async</span></span>&lt;(<span class="hljs-type"><span class="hljs-type">AdminInfo</span></span> * <span class="hljs-type"><span class="hljs-type">HttpContext</span></span>) option&gt; // <span class="hljs-type"><span class="hljs-type">AccountPart</span></span> <span class="hljs-type"><span class="hljs-type">AccountInfo</span></span>* <span class="hljs-type"><span class="hljs-type">HttpContext</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Async</span></span>&lt;(<span class="hljs-type"><span class="hljs-type">AccountInfo</span></span> * <span class="hljs-type"><span class="hljs-type">HttpContext</span></span>) option&gt;</code> </pre> <br><p>  Inside, the new features are completely identical to the original ones. </p><br><p>  Now the handler immediately has access to resources for each role, only the main <em>thing</em> needs to be added there so that you can easily navigate, for example, in <em>AccountPart</em> you can add a nickname, email, user role, friend list if it's a social network, but there is a problem: for one overwhelming most handlers I need a list of friends, but for the rest I don‚Äôt need it at all, what should I do?  Either distribute these handlers into different modules (preferably), or make access lazy (wrap in <em>unit -&gt; friends list</em> ), the main thing is not to put <em>IQueryable &lt;Friend&gt; there</em> , because this is not a service - it is a data set that defines the role </p><br><p>  I put in <em>AdminInfo</em> information about approved and banned users by the current administrator, in the context of my "application" this defines the role of the Administrator: </p><br><pre> <code class="haskell hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AdminInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ActiveUsersEmails</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BanUsersEmails</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Surname</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><p>  What is the difference from <em>Claim</em> ?  Can I make <em>User.Claims</em> in the controller and get the same thing? </p><br><p>  In typing and in talking: modules, the developer does not have to look for code examples on handlers in the same context, he creates a handler and adds it to the routing and makes it all compile </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-type"><span class="hljs-type">AccountPart</span></span> handler = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> getUserInfo ctx = async.<span class="hljs-type"><span class="hljs-type">Return</span></span> {<span class="hljs-type"><span class="hljs-type">Name</span></span>=<span class="hljs-string"><span class="hljs-string">"Al"</span></span>;<span class="hljs-type"><span class="hljs-type">Surname</span></span>=<span class="hljs-string"><span class="hljs-string">"Pacino"</span></span>} permissionHandler [<span class="hljs-type"><span class="hljs-type">User</span></span>;<span class="hljs-type"><span class="hljs-type">Admin</span></span>] getUserInfo handler</code> </pre> <br><p>  <em>getUserInfo</em> receives data for the <em>Account</em> module, has access to the context to get personal data (this is exactly this user'a, admin'a) </p><br><p>  <em>permissionHandler</em> checks for the presence of jwt token, decrypts it, and checks access, returns the original WebPart to maintain compatibility with Suave </p><br><p>  Full source code can be found on <a href="">github</a> </p><br><p>  Thanks for attention! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/461593/">https://habr.com/ru/post/461593/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461577/index.html">Part 5/2 bldg. 1: Crossroads of RocketChip Avenue and slippery instrumentation track</a></li>
<li><a href="../461579/index.html">WebMoney introduces new WMP wallets and changes the rules of the game</a></li>
<li><a href="../461583/index.html">Python to help test structural products</a></li>
<li><a href="../461589/index.html">Tic Tac Toe: Content Cycle</a></li>
<li><a href="../46159/index.html">Movable Type 4.23</a></li>
<li><a href="../461595/index.html">From theory to practice: how undergraduates of the faculty of photonics and optoinformatics study and work</a></li>
<li><a href="../4616/index.html">The secret plans of Google for 2006 became known.</a></li>
<li><a href="../46160/index.html">Google turns off experiments</a></li>
<li><a href="../461601/index.html">What a non-technical founder should know about software development</a></li>
<li><a href="../461605/index.html">Creating Tower Defense in Unity: Ballistics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>