<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visualization and decoding of data from magnetic ATM cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The subject of interest of this publication is reading and decoding data from the second track of an ATM card in the context of a shortage of equipmen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visualization and decoding of data from magnetic ATM cards</h1><div class="post__text post__text-html js-mediator-article"> The subject of interest of this publication is reading and decoding data from the second track of an ATM card in the context of a shortage of equipment and facilities. <br><br>  To begin with I will give dry theoretical knowledge.  If the theory is not interested, you can skip it. <br><a name="habracut"></a><br>  The film or track is a plastic, with applied tiny (very small) particles of a ferromagnet - a substance with residual magnetization.  A ferromagnet, besides the fact that it is damn fine and is not distinguishable in a school or repair microscope, it also has a shape similar to honeycombs, granules or crystals. <br><br>  In the process of applying to the surface, it immediately passes orientation - that is, it rotates according to the lines of the magnetic field.  This achieves some improvement in the magnetic properties of the track.  Further the fixer and a protective layer is applied.  Everything, they cannot physically change their position; changing the directions of the magnetic induction vectors (the same residual magnetization, magnetic lines) can now occur only at the molecular level.  But do not think that the strip after manufacture immediately has magnetic properties.  First, if they are, they are too small, and second, the directions of the vectors are randomly oriented and compensate for each other. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We bring such a strip into the zone of the magnetic field and wait.  We are waiting for the energy horses to jump over the barrier and the magnetic induction vectors of these particles will not coincide in magnitude with the external magnetic field vectors, and the particles themselves will not accumulate some energy and become the most real permanent magnets.  Everything, now with this strip you can attract nails and shock monkeys in the zoo. <br><br>  There is some primary magnetization that translates the virgin path from a state of lethargy into a state of residual magnetization.  For a complete picture, you need to consider a hysteresis picture; it reflects all possible magnetic states of our ferromagnets.  Among which there are two states of complete demagnetization. <br><br>  Now, closer to how everything happens when writing and reading on a real magnetic strip of a card. <br><br>  The first.  When recording, the head that creates the field near the magnetic strip actually creates the field not next to it, but in it.  To understand this, you need to remember a simple rule: the current flows along the path of least resistance.  And now let's imagine a horseshoe, yes, an ordinary horseshoe from a horse.  It has an incision; lean the horseshoe with a tear perpendicular to the strip.  This is the modern head for such records. That is the whole point of the gap, which almost touches the magnetic strip. <br><br>  We wrap the horseshoe with wire and let the electric current, the horseshoe will become an electromagnet, the magnetic field will flow along the horseshoe and in the place of the horseshoe break will meet strong resistance - air or some specially insulated dielectric. <br><br>  What remains to do the magnetic field?  Take the path of least resistance - on the most magnetic strip!  Jumping on a strip, withdraw through it.  What is good for us. <br><br>  The way of representing discrete (consider in the future - digital information) on such a strip can theoretically be very different.  You can substitute yourself in the constructor's place and try to simulate the processes of writing and reading.  At the same time in our hands the following trumps: <br><br>  - information needs to be recorded in sections of fixed length; <br>  - it is possible to record 2 types of sections on a strip, that is, with different directions of magnetic field lines (magnetic induction vectors and heaps of other quantities, which, however, we don't care).  For simplicity, we denote them as SN and NS; <br>  - it is possible to record types of SN and NS sections on a strip, but any of them may have different degrees of magnetization, that is, you can designate a gradation of the degree of magnetization for any of the sections, for example, by agreeing with you that we will assign a number from 0 to 9 to the right expressing the degree of magnetization in increasing; <br>  - reading is possible under the condition of a change in the magnetic flux of the head, which passes near the magnetized strip.  The changing magnetic flux passes through the core (all the same horseshoe itself) and as a result, a varying voltage appears at the terminals of the winding located on the core. <br><br>  Thus, it can only change when the magnetic flux changes.  And it can change in three cases: <br><br>  a) changing the directions of the magnetic field lines.  That is, the plots should go in this order: <br>  (SN) (NS) (SN).  As a result, we get, roughly speaking, 2 times the pulsating current; <br>  b) the change in the intensity of the magnetic fields of the plots.  For example, such a sequence of sections should cause the appearance / change of electric current in the head - (SN1) (SN2) (SN9) (SN3) (3 changes in the amplitude of the electric current of the head), but this is no longer - (SN5) (SN5) (SN5) (SN5) (SN5); <br>  c) combination of a and b (SN5) (NS5) (NS6). <br><br>  It seems there is no problem, take it, use any of the options to represent the zeros of discrete sections.  Yes, it's easy to record.  Problems appear when reading.  One of the main factors that puts sticks in the wheels is the speed of reading, that is, the speed of pulling the tape under the head.  Manually invented devices for manually dragging a card through them cannot afford to accurately recognize the speed without additional tricks with which the hand draws the card (this is possible, but an additional clock magnetic or other line must be made).  ATMs are simpler and sufficient accuracy can be realized. <br><br>  So what's the problem?  Well, a different speed and figs with her. <br><br>  And you try, being a simple ordinary device, disassemble the following sequence: <br>  (SN) (NS) (NS) (SN) (NS)?  (sequence 1) <br>  (1) (2) (3) (4) (5) <br><br>  What can be said about this sequence?  Only that which will cause exactly 3 times (between sections 1 and 2, 3 and 4, 4 and 5) will change the polarity of the electric field in the head. <br><br>  If we take the very first coding option 0 and 1 that changes the polarity of the magnetic field sections, then we can confidently say that SN is 1, and NS is 0, and if we get a voltage jump to the + side, we can say that the transition from 1 to 0. So, 2 plots are recognized.  But further, where 2 and 3 are next to each other - (NS) (NS) there will be no change, but it is known that the last thing on this place that was recognized by the previous voltage surge is 0!  But try, prove how many exactly zeros in this area at different speeds, two or more.  That sequence 1 is sequence 1, and not, say, this: <br>  (SN) (NS) (NS) (NS) (NS) (SN) (NS)?  (sequence 2) <br>  (1) (2) (3) (error) (error) (4) (5) <br><br>  Between 3 and 4 everything is smooth - a voltage surge occurs in the direction - and we can say that 3 is 0, and 4 is 1. There are a lot of exits from the current situation, from the synchronization line to the frequency coding.  Which is the main one in magnetic cards is the doubling of the frequency F \ 2F. <br><br>  (NS) (SN) (NS) (NS) (SN) (SN) (NS) (SN) (NS) (SN) <br>  (1) (0) (0) (1) (1) <br><br>  The meaning, I think, is clear.  For coding 1, the fact of the interpretation of voltage surges is used - doubling the frequency of polarity reversal of the sections for coding one element.  If you look better, you can see that such encoding completely eliminates the disadvantages of the encoding presented above under certain conditions. <br><br>  Suppose we stop the map at the site (NS) (NS).  You might think that the device will fail and incorrectly calculate the number of zeros, that is, it will take (NS) (NS) (NS) (NS) per 00. In fact, this will not happen, because during coding the condition for switching to the next group of sections is a change of polarity , and it does not occur and the device simply puts 0 and waits for a change in polarity (waits at least indefinitely) in order to restart its counter - the generator to recognize the next group of sections.  The question of how the device determines the frequency of occurrence of polarity shifts is, of course, interesting, but not necessary now. <br><br>  It is better to see once than read a hundred times.  We will look at the contents of the magnetic card tracks and see if it is possible at home to unambiguously understand what is written on them.  Along the way, getting some tool for visual assessment of the tracks. <br><br>  Sawdust sprinkled on a sheet of paper, under which there is a magnet, line up along the lines of force.  We need from them that they stick to the magnetized sections of the map‚Äôs tracks, exposing the treacherous ones. <br><br>  Ordinary sawdust or metal dust will not work, too large particles.  It is proposed to use toner particles for printer cartridges.  They are very carefully processed, homogeneous, and some of them are composed of magnetic pigments. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c3/c29/6b7/0c3c296b765ad2a168483977352499f3.jpg" alt="image"><br><br>  In the original sources, ideas are proposed to use a mixture of toner and starch, but this is apparently due to the fact that the idea of ‚Äã‚Äãassessing the state of the cards using toner or a special spray appeared long ago, and then the toners were specific.  Therefore, for example, we should not be leveled at France from 1999.  We will go to a modern store and purchase toner with magnetic pigments (as shown in the figure), preferably colored. <br><br>  Having sprinkled the map and knocking it on the table to shake off excess toner, we get this newly discovered world at our disposal.  On the strip you immediately see all the defects of the sections received by the card.  In some domestic cases, this may be useful. <br><br>  We must continue.  The whole interest is in reading the contents of the card with only a camera, a magnifying glass, or of course a microscope.  As will be clear further, for the analysis of the second track from the 3rd enough camera.  The pictures show pictures from an average digital camera and from a digital microscope. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4e/8ef/9a0/e4e8ef9a0049ea72ab3b4d7b68ffe8b4.jpg" alt="image"><br><br>  The entire track number 2 (ABA) entirely. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e7b/ab8/507/e7bab85074689efe752c10a8347a236d.jpg" alt="image"><br><br>  The entire track No. 2 (ABA) is entirely with landmarks in the paint program. <br><br><img src="https://habrastorage.org/files/a8a/9f3/a25/a8a9f3a2520d4c92b4abf34c01d730de.bmp"><br>  And the same path, slightly larger: <br><br><img src="https://habrastorage.org/files/1e1/74c/4db/1e174c4dbbc3406fb0c78a6e81c7a06b.jpg"><br><br>  For convenience, of course, use images from a microscope. <br><br>  So, the analysis.  But first you need to refer to the standards: <br><br>  ISO 7810 Physical Characteristics of Credit.Card Size Document <br>  ISO 7811-1 Embossing <br>  ISO 7811-2 Magnetic Stripe - Low Coercivity <br>  ISO 7811-3 Location of Embossed Characters <br>  ISO 7811-4 Location of Tracks 1 and 2 <br>  ISO 7811-5 Location of Track 3 <br>  ISO 7811-6 Magnetic Stripe - High Coercivity <br>  ISO 7813 Financial Transaction Cards <br><br>  Further in the right side of the document we look from top to bottom: <br>  - The drawing of the map and its dimensions are 3.375 √ó 2.125 inches, one inch = 2.54 cm, it turns out 85 * 54 mm.  Coincides with the size of the investigated card. <br>  - The line ‚ÄúMagnetic Stripe Encoding - Financial Transaction Cards‚Äù shows the distance from the edge of the card in inches and the characteristics of the tracks (track) as a kind of table.  There are 3 tracks, each has its own name: <br><br>  TRACK 1 IATA <br>  TRACK 2 ABA <br>  TRACK 3 THRIFT <br><br>  RECORDING DENSITY (bits per inch) recording density for each of the tracks. <br>  CHARACTER CONFIGURATION (including parity bit) "Device character", in fact, the number of bits per byte, taking into account the parity bit and INFORMATION CONTENT (including control characters) the contents of characters.  It is seen that the first track contains both numbers and letters, the second and third contain only numbers - 40 numeric characters. <br>  Below and to the left are the decoding of the track formats. <br><br>  In theory, our 2nd ABA track should contain no more than 75 bits per inch.  That is no more than 3.375 (card length) * 75 (capacity per inch) = 253.125 bits = 253 bits for the entire track.  The byte size is 5 bits, the encoding is only a digit, and 253/5 = 50 characters are obtained, but by the standard there are 40. The extra ones are sequences for synchronization at the very beginning of the track - zeroes. <br><br>  5 bit coding is described in the link below. <br><br><pre><code class="hljs erlang">--Data Bits-- Parity b1 b2 b3 b4 b5 Character Function 0 0 0 0 1 0 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">0</span></span></span><span class="hljs-params">H)</span></span> Data 1 0 0 0 0 1 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">1</span></span></span><span class="hljs-params">H)</span></span> " 0 1 0 0 0 2 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">2</span></span></span><span class="hljs-params">H)</span></span> " 1 1 0 0 1 3 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">3</span></span></span><span class="hljs-params">H)</span></span> " 0 0 1 0 0 4 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">4</span></span></span><span class="hljs-params">H)</span></span> " 1 0 1 0 1 5 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">5</span></span></span><span class="hljs-params">H)</span></span> " 0 1 1 0 1 6 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">6</span></span></span><span class="hljs-params">H)</span></span> " 1 1 1 0 0 7 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">7</span></span></span><span class="hljs-params">H)</span></span> " 0 0 0 1 0 8 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">8</span></span></span><span class="hljs-params">H)</span></span> " 1 0 0 1 1 9 <span class="hljs-params"><span class="hljs-params">(</span><span class="hljs-number"><span class="hljs-params"><span class="hljs-number">9</span></span></span><span class="hljs-params">H)</span></span> " 0 1 0 1 1 : <span class="hljs-params"><span class="hljs-params">(AH)</span></span> Control 1 1 0 1 0 ; <span class="hljs-params"><span class="hljs-params">(BH)</span></span> Start Sentinel 0 0 1 1 1 &lt; <span class="hljs-params"><span class="hljs-params">(CH)</span></span> Control 1 0 1 1 0 = <span class="hljs-params"><span class="hljs-params">(DH)</span></span> Field Separator 0 1 1 1 0 &gt; <span class="hljs-params"><span class="hljs-params">(EH)</span></span> Control 1 1 1 1 1 ? <span class="hljs-params"><span class="hljs-params">(FH)</span></span> End Sentinel</code> </pre> <br>  Well, to start, you have to start.  Having a decoding table, we will write a decryption program on-line.  And yes, we also need a dump obtained during the visualization, there it is (of course, slightly modified to hide personal data, which, by the way, the cat wept there): <br><br>  000000000000000000000000000000000000000110111111100001000010000100001010101000101011000010000100001010110101000010000100010000010100010000010001000001101001110010010101101010100010110010000010010110110011010110101001000001000010101010101100000000000000000000 <br><br>  Well, the program itself: <br><br><pre> <code class="hljs perl"> .<span class="hljs-number"><span class="hljs-number">686</span></span> ; create <span class="hljs-number"><span class="hljs-number">32</span></span> bit code .model flat, stdcall ; <span class="hljs-number"><span class="hljs-number">32</span></span> bit memory model option casemap :none ; case sensitive include \masm32\include\windows.inc include \masm32\include\masm32.inc include \masm32\include\gdi32.inc include \masm32\include\user32.inc include \masm32\include\kernel32.inc include \masm32\include\shell32.inc includelib \masm32\lib\masm32.lib includelib \masm32\lib\gdi32.lib includelib \masm32\lib\user32.lib includelib \masm32\lib\kernel32.lib .data? .data Handle_File_Input dd <span class="hljs-number"><span class="hljs-number">0</span></span> Handle_File_Result dd <span class="hljs-number"><span class="hljs-number">0</span></span> InputFile db <span class="hljs-string"><span class="hljs-string">"Content_track_2.txt"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ResultFile db <span class="hljs-string"><span class="hljs-string">"Result.txt"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> flStr OFSTRUCT &lt;&gt; NBW dd ? , <span class="hljs-number"><span class="hljs-number">0</span></span> NBR dd ?, <span class="hljs-number"><span class="hljs-number">0</span></span> title_box db <span class="hljs-string"><span class="hljs-string">"[ABA] track-decoder"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ms1 db <span class="hljs-string"><span class="hljs-string">"  :    [Start_Sentinel]       ,   .  -   ?"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ms2 db <span class="hljs-string"><span class="hljs-string">" -  "</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ms3 db <span class="hljs-string"><span class="hljs-string">"     Content_track_2.txt"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ms4 db <span class="hljs-string"><span class="hljs-string">" ,    Result.txt.  ,            ."</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> bet db <span class="hljs-number"><span class="hljs-number">254</span></span> dup (<span class="hljs-number"><span class="hljs-number">030</span></span>h) en db 0ffh Start_Sentinel db <span class="hljs-string"><span class="hljs-string">"1010"</span></span>, 0ffh ;  ;bet db <span class="hljs-string"><span class="hljs-string">"00000000000000000000000000000000000000011011111110000100001000010000101010100010101100001000010000101011010100001000010001000001010001000001000100000"</span></span> ;bey db <span class="hljs-string"><span class="hljs-string">"110100111001001010110101010001011001000001001011011001101011010100100000100001010101010110000000000000000"</span></span> result db <span class="hljs-number"><span class="hljs-number">60</span></span> DUP(<span class="hljs-number"><span class="hljs-number">0</span></span>) val_<span class="hljs-number"><span class="hljs-number">0</span></span> db <span class="hljs-string"><span class="hljs-string">'.'</span></span> ;<span class="hljs-number"><span class="hljs-number">00000</span></span> val_1 db <span class="hljs-number"><span class="hljs-number">030</span></span>h ;<span class="hljs-number"><span class="hljs-number">00001</span></span> -  val_2 db <span class="hljs-number"><span class="hljs-number">03</span></span>8h ;<span class="hljs-number"><span class="hljs-number">00010</span></span> -  val_3 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">00011</span></span> val_4 db <span class="hljs-number"><span class="hljs-number">034</span></span>h ;<span class="hljs-number"><span class="hljs-number">00100</span></span> -  val_5 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">00101</span></span>. val_6 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">00110</span></span> val_7 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">00111</span></span> val_8 db <span class="hljs-number"><span class="hljs-number">032</span></span>h ;<span class="hljs-number"><span class="hljs-number">01000</span></span> -  val_9 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">01001</span></span> val_1<span class="hljs-number"><span class="hljs-number">0</span></span> db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">01010</span></span> val_11 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">01011</span></span> val_12 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">01100</span></span> val_13 db <span class="hljs-number"><span class="hljs-number">036</span></span>h ;<span class="hljs-number"><span class="hljs-number">01101</span></span> -  val_14 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">01110</span></span> val_15 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">01111</span></span> val_16 db <span class="hljs-number"><span class="hljs-number">031</span></span>h ;<span class="hljs-number"><span class="hljs-number">10000</span></span> -  val_17 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">10001</span></span> val_18 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">10010</span></span> val_19 db <span class="hljs-number"><span class="hljs-number">03</span></span>9h ;<span class="hljs-number"><span class="hljs-number">10011</span></span> -  val_2<span class="hljs-number"><span class="hljs-number">0</span></span> db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">10100</span></span> val_21 db <span class="hljs-number"><span class="hljs-number">035</span></span>h ;<span class="hljs-number"><span class="hljs-number">10101</span></span> -  val_22 db <span class="hljs-string"><span class="hljs-string">'M'</span></span> ;<span class="hljs-number"><span class="hljs-number">10110</span></span> -  val_23 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">10111</span></span> val_24 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">11000</span></span> val_25 db <span class="hljs-number"><span class="hljs-number">033</span></span>h ;<span class="hljs-number"><span class="hljs-number">11001</span></span> -  val_26 db <span class="hljs-string"><span class="hljs-string">'S'</span></span> ;<span class="hljs-number"><span class="hljs-number">11010</span></span> -  val_27 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">11011</span></span> val_28 db <span class="hljs-number"><span class="hljs-number">037</span></span>h ;<span class="hljs-number"><span class="hljs-number">11100</span></span> -  val_29 db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">11101</span></span> val_3<span class="hljs-number"><span class="hljs-number">0</span></span> db <span class="hljs-string"><span class="hljs-string">'?'</span></span> ;<span class="hljs-number"><span class="hljs-number">11110</span></span> val_31 db <span class="hljs-string"><span class="hljs-string">'E'</span></span> ;<span class="hljs-number"><span class="hljs-number">11111</span></span> -  .code start: begin: <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> OF_READWRITE <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset flStr <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset InputFile call OpenFile cmp eax, 0ffffffffh ;     jz ext ;       mov dword ptr [Handle_File_Input], eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> FILE_BEGIN <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> NULL <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax call SetFilePointer ;     <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> Handle_File_Input call GetFileSize mov ebx, <span class="hljs-number"><span class="hljs-number">254</span></span> cmp eax, ebx ;  .     cmova eax, ebx ;   <span class="hljs-number"><span class="hljs-number">254</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> NULL <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset NBW <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset bet <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> Handle_File_Input call ReadFile ;  lea esi, [en-<span class="hljs-number"><span class="hljs-number">1</span></span>] ;   lea edi, bet ;   <span class="hljs-keyword"><span class="hljs-keyword">reverse</span></span>: cmp esi, edi jbe end_reverse mov al, byte ptr [esi] mov ah, byte ptr [edi] mov byte ptr [edi], al mov byte ptr [esi], ah dec esi inc edi jmp <span class="hljs-keyword"><span class="hljs-keyword">reverse</span></span> end_reverse: ;------  Start_Sentinel------------------------------------------- mov edi, offset bet mov al, <span class="hljs-number"><span class="hljs-number">030</span></span>h mov ecx, 0ffh repz scasb ;     <span class="hljs-string"><span class="hljs-string">"1"</span></span> mov edx, edi <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> edx, offset [Start_Sentinel+<span class="hljs-number"><span class="hljs-number">1</span></span>] ;            jnz continue_1 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset title_box <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset ms2 ;  <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> call MessageBoxA jmp ext continue_1: ;--            (  ) SS ;--      ,     -   SS (  ) ;--     SS    -          <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> edx, offset [Start_Sentinel+<span class="hljs-number"><span class="hljs-number">1</span></span>] ; edx  mov eax, edi mov ebx, offset Start_Sentinel search_SS: mov esi, eax inc eax mov ecx, -<span class="hljs-number"><span class="hljs-number">1</span></span> mov edi, ebx repz cmpsb ;     ecx   cmp cx, -<span class="hljs-number"><span class="hljs-number">6</span></span> loopnz search_SS dec eax ;   eax     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edx</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jz</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continue_2</span></span></span><span class="hljs-function"> </span></span>;     SS <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset title_box <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset ms1 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> call MessageBoxA ;     ;[ms+<span class="hljs-number"><span class="hljs-number">191</span></span>] cmp eax, <span class="hljs-number"><span class="hljs-number">1</span></span> jnz ext continue_2: mov byte ptr [result], <span class="hljs-string"><span class="hljs-string">'S'</span></span> ; dec esi ;    SS mov ecx, <span class="hljs-number"><span class="hljs-number">5</span></span> mov eax, offset [en-<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">esi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edx</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edx</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ecx</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ecx</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function"> </span></span>;   <span class="hljs-number"><span class="hljs-number">5</span></span> mov edi, offset [result+<span class="hljs-number"><span class="hljs-number">1</span></span>] mov ebx, offset val_<span class="hljs-number"><span class="hljs-number">0</span></span> pars: lodsd mov edx, eax lodsb <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">al</span></span></span><span class="hljs-function">, 30</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edx</span></span></span><span class="hljs-function">, 030303030</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shl</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dl</span></span></span><span class="hljs-function">, 4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">al</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dl</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shl</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dh</span></span></span><span class="hljs-function">, 3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">al</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dh</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bswap</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edx</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shl</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dl</span></span></span><span class="hljs-function">, 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">al</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dl</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shl</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dh</span></span></span><span class="hljs-function">, 2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">al</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dh</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlat</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stosb</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pars</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OF_READWRITE</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flStr</span></span></span><span class="hljs-function"> &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">habracut</span></span></span><span class="hljs-function"> /&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResultFile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dword</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ptr</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Handle_File_Result</span></span></span><span class="hljs-function">], </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FILE_BEGIN</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NULL</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetFilePointer</span></span></span><span class="hljs-function"> </span></span>;     <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> NULL <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset NBW <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset result <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> dword ptr [Handle_File_Result] call WriteFile ext: <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> Handle_File_Input call CloseHandle <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> Handle_File_Result call CloseHandle <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset title_box <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset ms4 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> call MessageBoxA ;     cmp eax, <span class="hljs-number"><span class="hljs-number">6</span></span> jz begin <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> call ExitProcess end start</code> </pre><br>  And finally, the result itself: <br><br>  S5224559648685547M08081211550005850000EM ... <br><br>  Which suspiciously resembles the numbers and letters scribed on the card. <br><br>  The next track is already encrypted, but this is another time. <br><br><h4>  useful links </h4><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7%25D0%25B8%25D1%2581">ru.wikipedia.org/wiki/Hysteresis</a> <br>  <a href="http://www.dataip.co.uk/Reference/MagneticCardBCD.php">www.dataip.co.uk/Reference/MagneticCardBCD.php</a> <br>  <a href="http://stripesnoop.sourceforge.net/devel/layoutstd.pdf">stripesnoop.sourceforge.net/devel/layoutstd.pdf</a> <br>  Patrick Goll's book - Magnetic cards and PC. </div><p>Source: <a href="https://habr.com/ru/post/250329/">https://habr.com/ru/post/250329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250319/index.html">Eliminate spaces, learn Android</a></li>
<li><a href="../250321/index.html">Programming on PureData. Part 0</a></li>
<li><a href="../250323/index.html">Debugging with XDebug and PhpStorm (addition)</a></li>
<li><a href="../250325/index.html">Deploying Windows Server 2012 R2 to Dell servers in BARE-METAL mode. Part 2</a></li>
<li><a href="../250327/index.html">Amazing USB flash drive device Kingston DataTraveler DT6000 and recovery of information lost due to failure</a></li>
<li><a href="../250331/index.html">Non-standard top security news: January</a></li>
<li><a href="../250333/index.html">Digest of good educational programs for IT-specialists and sympathizers: in Moscow and online</a></li>
<li><a href="../250335/index.html">How does ABAP Secure Storage work in SAP?</a></li>
<li><a href="../250337/index.html">We are forbidden to even talk about cryptocurrency?</a></li>
<li><a href="../250339/index.html">TLS hacking with cash prize</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>