<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Binding Request Traker 4.x on Ubuntu to ldap using the example of ActiveDirectory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is this RT 
 I have been using the Secure Scout application tracker in an outsourcing company for a long time now called BestPractical Request Tr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Binding Request Traker 4.x on Ubuntu to ldap using the example of ActiveDirectory</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>What is this RT</b> </h4><br>  I have been using the Secure Scout application tracker in an outsourcing company for a long time now called BestPractical Request Tracker.  Request Tracker is good because it is useless, written in Perl, undemanding of resources, flexible and allows you to tie any functionality to yourself.  There is no point in telling more, in due time <a href="https://habrahabr.ru/users/zar0ku1/" class="user_link">zar0ku1</a> wrote a good <a href="https://habrahabr.ru/post/112348/">article</a> on installing RT 3.8, then the manual <a href="https://habrahabr.ru/sandbox/96505/">refreshed a little</a> @ Spanish pilot, and <a href="https://habrahabr.ru/users/mister_j/" class="user_link">mister_j</a> even <a href="https://habrahabr.ru/post/190822/">talked</a> about RT programming. <br><br>  We will go a little further and find out how to bind RT authorization to ldap using the example of AD, so that users can create requests and track their execution using their domain account.  In addition to individualizing the tracker, you will be able to automatically update information (name, email, department, etc.) about RT users from the directory service. <br><a name="habracut"></a><br><h4>  <b>What external authorization features are built into RT</b> </h4><br>  BestPractical <a href="https://www.bestpractical.com/docs/rt/4.4/authentication.html">offers</a> us two types of authentication through an external source: using the login form (which throws the authorization request further) or bypassing the login form using the web server's capabilities to identify the user automatically (for example, NTLM).  It must be said that BestPractical recommends including both features, which we will do. <br><br>  In order not to plunge into the abyss of technical manuals, I will say this: you can tie authentication to the login form so that the domain user is automatically created in RT when entering the application portal, or you can create a script that will periodically load new users from the directory.  BestPractical, again, insists on both options. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>Enabling import uchetok from LDAP</b> </h4><br>  To connect to the domain, you need to create a regular user account in AD (or in your directory service implementation). <br><br><pre><code class="bash hljs">PS C:\&gt; New-ADUser -Name <span class="hljs-string"><span class="hljs-string">"Request Tracker"</span></span> -GivenName rt -SamAccountName rt -UserPrincipalName rt@example.com -AccountPassword (Read-Host -AsSecureString <span class="hljs-string"><span class="hljs-string">"rt_password"</span></span>)</code> </pre> <br>  On the RT host, you need to download a Perl module specially created for import purposes: <br><br><pre> <code class="bash hljs">sudo cpan -i RT::Extension::LDAPImport</code> </pre><br>  Then add the following lines to <i>/opt/rt4/etc/RT_SiteConfig.pm</i> in the RT configuration file: <br><br><pre> <code class="perl hljs">Set(@Plugins, <span class="hljs-string"><span class="hljs-string">qw(RT::Extension::LDAPImport)</span></span>); Set($LDAPHost,<span class="hljs-string"><span class="hljs-string">'domaincontroller.example.com'</span></span>); Set($LDAPUser,<span class="hljs-string"><span class="hljs-string">'example\rt'</span></span>); Set($LDAPPassword,<span class="hljs-string"><span class="hljs-string">'rt_password'</span></span>); Set($LDAPBase,<span class="hljs-string"><span class="hljs-string">'dc=example,dc=com'</span></span>); Set($LDAPFilter, <span class="hljs-string"><span class="hljs-string">' (&amp;(objectCategory=person))'</span></span>); Set($LDAPMapping, {<span class="hljs-string"><span class="hljs-string">Name =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'sAMAccountName'</span></span>, <span class="hljs-string"><span class="hljs-string">RealName =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'cn'</span></span>, <span class="hljs-string"><span class="hljs-string">EmailAddress =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'mail'</span></span> }); Set($LDAPCreatePrivileged, <span class="hljs-number"><span class="hljs-number">1</span></span>); Set($LDAPUpdateUsers, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  In this example, I specify to import all users of the domain ( <i>$ LDAPFilter</i> ), starting from the root ( <i>$ LDAPBase</i> ), pumping up their name, login and email ( <i>$ LDAPMapping</i> ).  Accounts will automatically have access to RT ( <i>$ LDAPCreatePrivileged</i> ) and information about them will be updated with each new import request ( <i>$ LDAPUpdateUsers</i> ). <br><br>  The import module allows you to import accounts from different departments, import groups, download more information about LDAP users, etc.  It‚Äôs enough for me that I showed you.  Want to know more - read the <a href="https://metacpan.org/pod/RT::Extension::LDAPImport">manual</a> on the module. <br><br>  The import process itself is simple.  For starters, you can run a test import and see how it ended: <br><br><pre> <code class="bash hljs">sudo /opt/rt4/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/plugins/RT-Extension-LDAPImport/bin/rtldapimport --debug &gt; ldapimport.debug 2&gt;&amp;1 sudo cat ldapimport.debug</code> </pre><br>  As a rule, errors occur when the firewall is enabled and the LDAP search database is incorrectly specified.  If everything went well, the import can be fully run: <br><br><pre> <code class="bash hljs">sudo /opt/rt4/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/plugins/RT-Extension-LDAPImport/bin/rtldapimport --import</code> </pre><br>  If for you, as well as it was enough for me not to divide users into groups during import, then users will by default be added to RT in the <i>Imported From LDAP</i> group.  This group will need to be given in RT the corresponding rights to the queue, or manually disassemble users.  Separately, I‚Äôll note that users don‚Äôt have any passwords yet, they cannot log in to RT, we just imported information about them into RT and can configure access levels for them. <br><br>  In order for user information to be updated regularly, you can create a task in the scheduler, for example: <br><br><pre> <code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"01 1 * * * root /opt/rt4/local/plugins/RT-Extension-LDAPImport/bin/rtldapimport --import"</span></span> &gt;&gt; /etc/crontab</code> </pre><br><h4>  <b>Authorization through an external source</b> </h4><br>  To actually send requests to a domain controller or another owner of the ldap directory, you also need a Perl module: <br><br><pre> <code class="bash hljs">sudo cpan -i RT::Authen::ExternalAuth</code> </pre><br>  In the <i>RT_SiteConfig.pm</i> configuration <i>file</i> , add the information about the downloaded plugin: <br><br><pre> <code class="perl hljs">Set(@Plugins, <span class="hljs-string"><span class="hljs-string">qw(RT::Extension::LDAPImport RT::Authen::ExternalAuth)</span></span>);</code> </pre><br>  And provide information for accessing the ldap directory: <br><br><pre> <code class="perl hljs">Set($ExternalAuthPriority, [ <span class="hljs-string"><span class="hljs-string">'My_AD'</span></span> ] ); Set($ExternalInfoPriority, [<span class="hljs-string"><span class="hljs-string">'My_AD'</span></span>] ); Set( $UserAutocreateDefaultsOnLogin, { <span class="hljs-string"><span class="hljs-string">Privileged =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> , <span class="hljs-string"><span class="hljs-string">Lang =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'ru'</span></span>} ); Set($ExternalSettings, { <span class="hljs-string"><span class="hljs-string">'My_AD'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ldap'</span></span>, <span class="hljs-string"><span class="hljs-string">'server'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'domaincontroller.example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'example\rt'</span></span>, <span class="hljs-string"><span class="hljs-string">'pass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'rt_password'</span></span>, <span class="hljs-string"><span class="hljs-string">'base'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dc=example,dc=com'</span></span>, <span class="hljs-string"><span class="hljs-string">'filter'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'(objectCategory=person)'</span></span>, <span class="hljs-string"><span class="hljs-string">'attr_match_list'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'Name'</span></span>], <span class="hljs-string"><span class="hljs-string">'attr_map'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'Name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'sAMAccountName'</span></span>, <span class="hljs-string"><span class="hljs-string">'EmailAddress'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mail'</span></span>, <span class="hljs-string"><span class="hljs-string">'RealName'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'cn'</span></span>, }, }, } );</code> </pre><br>  In this example, I again do not bind groups, import a minimum of information and point out the entire domain, starting from the root, with a base for searching information.  Who needs more - go and read the <a href="https://metacpan.org/pod/RT::Authen::ExternalAuth">manual</a> . <br><br><h4>  <b>For independent work</b> </h4><br>  <s>I should note that after connecting to ldap, the creation of local users becomes impossible, but old users from the internal database continue to successfully login.</s>  <a href="https://habrahabr.ru/users/flashick/" class="user_link">Flashick</a> suggested that in order to create local uchetok in RT you need to add <code>Set($AutoCreateNonExternalUsers, 1); <br></code> to the config <code>Set($AutoCreateNonExternalUsers, 1); <br></code> <code>Set($AutoCreateNonExternalUsers, 1); <br></code> <br>  One more thing - if ‚ÄúLog on to‚Äù is enabled in the user domain, for now disable it and next time I will tell you how to fix it. <br><br>  Next time I will talk about how to make the authorization transparent for the user, without requiring him of a password and login, receiving this information automatically. <br><br>  UPD1: <a href="https://habrahabr.ru/users/flashick/" class="user_link">Flashick</a> says that in version RT 4.4 both plug-ins already exist by default and do not need to be downloaded and installed separately. <br><br>  UPD2: throughout the process, starting from the installation, I recorded several videos in the <a href="https://www.youtube.com/playlist%3Flist%3DPLmxB7JSpraifsRUrtq2Y-il5NCLc3vKho">playlist</a> for those who like to follow the process visually. </div><p>Source: <a href="https://habr.com/ru/post/276597/">https://habr.com/ru/post/276597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276585/index.html">About using React with the canvas element</a></li>
<li><a href="../276587/index.html">Analysis of the current situation in the Russian BIM market in the field of civil engineering</a></li>
<li><a href="../276589/index.html">Introduction to IL2CPP</a></li>
<li><a href="../276593/index.html">Creating a program architecture or how to design a stool</a></li>
<li><a href="../276595/index.html">Quadcopter navigation using monocular vision</a></li>
<li><a href="../276599/index.html">What brings the idea (Objective-C) - target-action on the blocks and a lot of runtime</a></li>
<li><a href="../276603/index.html">Evgeny Kaspersky spoke about cybercrime at Innopolis University [video]</a></li>
<li><a href="../276607/index.html">Performance and memory profiling from multiple viewing angles</a></li>
<li><a href="../276609/index.html">Package Manager opkg. Offline installation of packages in the root file system image</a></li>
<li><a href="../276611/index.html">Criticism of the article ‚ÄúHow to write in C in 2016‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>