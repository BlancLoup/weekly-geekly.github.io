<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The Art of Virtual Conducting OpenStack: Working with Heat</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we described the basic principles of working with API and console utilities that control the individual components of the Ope...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The Art of Virtual Conducting OpenStack: Working with Heat</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/08a/dc9/086/08adc9086888262f268ac82dc8ba366b.png" alt="Heat" width="100%" height="100%"><br><br>  In the <a href="http://habrahabr.ru/company/selectel/blog/242001/">previous article,</a> we described the basic principles of working with API and console utilities that control the individual components of the Openstack platform (nova, cinder, glance, neutron).  Today we will look at how you can build a ready-made infrastructure from virtual devices using the Heat orchestration module. <br><a name="habracut"></a><br><br>  To work with Heat, you need the python-heat package, which is present in the repositories of most modern distributions.  If you read our previous article, then most likely you have already installed it along with the rest of the Openstack console management utilities.  If not, it can be installed from the PyPI repository using the PIP utility.  All installation instructions can be found on the Access tab in the control panel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Basic concepts </h2><br>  Before we start talking about specific practical aspects of working with Heat, we will clarify the meaning of the basic concepts - ‚Äústack‚Äù and ‚Äúpattern‚Äù. <br><br>  A stack is a collection of cloud resources (machines, logical volumes, networks, etc.) that are combined into an integral structure. <br><br>  A template is a stack description.  Usually it is presented as a text file in a special format.  The template contains a description of resources and their relationships.  At the same time, resources can be described in any order: the stack is built automatically.  The stacks created earlier can be used as a resource for description in other templates, which allows you to create so-called nested stacks. <br><br>  The structure of templates and the rules of their writing, we consider a practical example.  We will create a stack consisting of two servers, a local network and a router, through which the output to an open network will be performed. <br><br><h2>  Template Formats </h2><br>  Templates can be presented in several formats.  We will use the <a href="http://docs.openstack.org/developer/heat/template_guide/hot_spec.html" rel="nofollow">HOT</a> format.  It was created specifically for the project Heat and has a fairly simple and understandable syntax.  The format is based on YAML, so when editing text it is important to monitor the use of spaces in the indents and their hierarchy. <br>  <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-anatomy.html" rel="nofollow">CFN</a> (AWS CloudFormation) is also supported for compatibility with templates used in Amazon EC2. <br><br><h2>  Template structure </h2><br><div class="spoiler">  <b class="spoiler_title">We will create the stack using the following template</b> <div class="spoiler_text"><pre><code class="hljs pgsql">heat_template_version: <span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span><span class="hljs-number"><span class="hljs-number">-23</span></span> description: Basic <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> two servers, one network <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> one router parameters: key_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> keypair <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> assign <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> servers <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ssh authentication public_net_id: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">UUID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> network <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">outer</span></span> world server_flavor: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">UUID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> virtual hardware configurations that are <span class="hljs-keyword"><span class="hljs-keyword">called</span></span> flavors <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> openstack private_net_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> private network (L2 <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>) private_subnet_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> private network subnet (L3 <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>) router_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> router that connects private <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> networks server1_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: Custom <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> server1 virtual machine server2_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: Custom <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> server2 virtual machine image_centos7: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">UUID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> glance image <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> centos <span class="hljs-number"><span class="hljs-number">7</span></span> distro image_debian7: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: string description: <span class="hljs-type"><span class="hljs-type">UUID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> glance image <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> debian <span class="hljs-number"><span class="hljs-number">7</span></span> distro resources: private_net: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Neutron::Net properties: <span class="hljs-type"><span class="hljs-type">name</span></span>: { get_param: private_net_name } private_subnet: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Neutron::Subnet properties: <span class="hljs-type"><span class="hljs-type">name</span></span>: { get_param: private_subnet_name } network_id: { get_resource: private_net } allocation_pools: - <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>: "192.168.0.10" <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>: "192.168.0.254" <span class="hljs-type"><span class="hljs-type">cidr</span></span>: "192.168.0.0/24" enable_dhcp: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> gateway_ip: "192.168.0.1" router: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Neutron::Router properties: <span class="hljs-type"><span class="hljs-type">name</span></span>: { get_param: router_name } external_gateway_info: { "enable_snat": <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, "network": { get_param: public_net_id }} router_interface: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Neutron::RouterInterface properties: router_id: { get_resource: router } subnet_id: { get_resource: private_subnet } server1: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Nova::<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> properties: <span class="hljs-type"><span class="hljs-type">name</span></span>: { get_param: server1_name } block_device_mapping: - volume_size: <span class="hljs-number"><span class="hljs-number">5</span></span> volume_id: { get_resource: "server1_disk" } device_name: "/dev/vda" config_drive: "False" flavor: { get_param: server_flavor } image: { get_param: image_centos7 } key_name: { get_param: key_name } networks: - port: { get_resource: server1_port } server1_disk: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Cinder::Volume properties: <span class="hljs-type"><span class="hljs-type">name</span></span>: server1_disk image: { get_param: image_centos7 } size: <span class="hljs-number"><span class="hljs-number">5</span></span> server1_port: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Neutron::Port properties: network_id: { get_resource: private_net } fixed_ips: - subnet_id: { get_resource: private_subnet } server1_floating_ip: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Neutron::FloatingIP properties: floating_network_id: { get_param: public_net_id } port_id: { get_resource: server1_port } depends_on: router_interface server2: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Nova::<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> properties: <span class="hljs-type"><span class="hljs-type">name</span></span>: { get_param: server2_name } block_device_mapping: - volume_size: <span class="hljs-number"><span class="hljs-number">5</span></span> volume_id: { get_resource: "server2_disk" } device_name: "/dev/vda" config_drive: "False" flavor: { get_param: server_flavor } image: { get_param: image_debian7 } key_name: { get_param: key_name } networks: - port: { get_resource: server2_port } server2_disk: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Cinder::Volume properties: <span class="hljs-type"><span class="hljs-type">name</span></span>: server2_disk image: { get_param: image_debian7 } size: <span class="hljs-number"><span class="hljs-number">5</span></span> server2_port: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: OS::Neutron::Port properties: network_id: { get_resource: private_net } fixed_ips: - subnet_id: { get_resource: private_subnet } outputs: server1_private_ip: description: private ip <span class="hljs-keyword"><span class="hljs-keyword">within</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> subnet <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> server1 <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> installed Centos <span class="hljs-number"><span class="hljs-number">7</span></span> distro <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: { get_attr: [ server1_port, fixed_ips, <span class="hljs-number"><span class="hljs-number">0</span></span>, ip_address ] } server1_public_ip: description: floating_ip that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> assigned <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> server1 <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: { get_attr: [ server1_floating_ip, floating_ip_address ] } server2_private_ip: description: private ip <span class="hljs-keyword"><span class="hljs-keyword">within</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> subnet <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> server2 <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> installed Debian <span class="hljs-number"><span class="hljs-number">7</span></span> distro <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: { get_attr: [ server2, first_address ] }</code> </pre> <br></div></div><br>  Consider its structure in more detail. <br><br>  The template consists of several blocks.  The first one indicates the version of the template and the description format used.  Each new release of the openstack platform maintains its own set of properties and attributes, which is gradually changing.  In the examples we give, the 2013-05-23 version is used.  It supports all features implemented with the release of the Icehouse release.  The second block provides a general description of the template and its purpose. <br><br><pre> <code class="hljs pgsql">heat_template_version: <span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span><span class="hljs-number"><span class="hljs-number">-23</span></span> description: &gt; Basic <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> two servers, one network <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> one router</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Parameter block</b> <div class="spoiler_text"><pre> <code class="hljs delphi">parameters: key_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> keypair <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> assign <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> servers <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ssh authentication public_net_id: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: UUID <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> network <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> outer world <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-number"><span class="hljs-number">98863</span></span>f6c-<span class="hljs-number"><span class="hljs-number">638</span></span>e-<span class="hljs-number"><span class="hljs-number">4</span></span>b48-a377-<span class="hljs-number"><span class="hljs-number">01</span></span>f0e86f34ae server_flavor: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: UUID <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> hardware configurations that are called flavors <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> openstack private_net_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: The <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> network (L2 level) private_subnet_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: the <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> subnet (L3 level) router_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: The <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> router that connects <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> networks server1_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: Custom <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> server1 <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> machine server2_name: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: Custom <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> server2 <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> machine image_centos7: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: UUID <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> glance image <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> centos <span class="hljs-number"><span class="hljs-number">7</span></span> distro image_debian7: <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> description: UUID <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> glance image <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> debian <span class="hljs-number"><span class="hljs-number">7</span></span> distro</code> </pre><br></div></div><br>  Then we list some additional parameters that will be passed to Heat when creating the stack.  The key_name parameter specifies a pair of keys to connect to the created server via ssh.  And in the server_flavor and public_net_id parameters are the identifiers (UUID) of the ‚Äúhardware‚Äù configuration of the virtual machine and the public network.  Here we specify arbitrary names for new devices and machines. <br><br><div class="spoiler">  <b class="spoiler_title">Resource block</b> <div class="spoiler_text"><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">resources</span></span>: private_net: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Neutron</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Net</span></span></span><span class="hljs-class"> properties: name: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_net_name</span></span></span><span class="hljs-class"> } private_subnet: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Neutron</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Subnet</span></span></span><span class="hljs-class"> properties: name: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_subnet_name</span></span></span><span class="hljs-class"> } network_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_net</span></span></span><span class="hljs-class"> } allocation_pools: - start: "192.168.0.10" end: "192.168.0.254" cidr: "192.168.0.0/24" enable_dhcp: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">True</span></span></span><span class="hljs-class"> gateway_ip: "192.168.0.1" router: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Neutron</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Router</span></span></span><span class="hljs-class"> properties: name: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">router_name</span></span></span><span class="hljs-class"> } external_gateway_info: { "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">enable_snat</span></span></span><span class="hljs-class">": </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">True</span></span></span><span class="hljs-class">, "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">network</span></span></span><span class="hljs-class">": { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public_net_id</span></span></span><span class="hljs-class">}} router_interface: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Neutron</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RouterInterface</span></span></span><span class="hljs-class"> properties: router_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">router</span></span></span><span class="hljs-class"> } subnet_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_subnet</span></span></span><span class="hljs-class"> } server1: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Nova</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Server</span></span></span><span class="hljs-class"> properties: name: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server1_name</span></span></span><span class="hljs-class"> } block_device_mapping: - volume_size: 5 volume_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server1_disk</span></span></span><span class="hljs-class">" } device_name: "/dev/vda" config_drive: "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">False</span></span></span><span class="hljs-class">" flavor: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server_flavor</span></span></span><span class="hljs-class"> } image: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">image_server1</span></span></span><span class="hljs-class"> } key_name: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key_name</span></span></span><span class="hljs-class"> } networks: - port: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server1_port</span></span></span><span class="hljs-class"> } server1_disk: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cinder</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Volume</span></span></span><span class="hljs-class"> properties: name: server1_disk image: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">image_server1</span></span></span><span class="hljs-class"> } size: 5 server1_port: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Neutron</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Port</span></span></span><span class="hljs-class"> properties: network_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_net</span></span></span><span class="hljs-class"> } fixed_ips: - subnet_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_subnet</span></span></span><span class="hljs-class"> } server1_floating_ip: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Neutron</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FloatingIP</span></span></span><span class="hljs-class"> properties: floating_network_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public_net_id</span></span></span><span class="hljs-class"> } port_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server1_port</span></span></span><span class="hljs-class"> } depends_on: router_interface server2: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Nova</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Server</span></span></span><span class="hljs-class"> properties: name: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server2_name</span></span></span><span class="hljs-class"> } block_device_mapping: - volume_size: 5 volume_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server2_disk</span></span></span><span class="hljs-class">" } device_name: "/dev/vda" config_drive: "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">False</span></span></span><span class="hljs-class">" flavor: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server_flavor</span></span></span><span class="hljs-class"> } image: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">image_server2</span></span></span><span class="hljs-class"> } key_name: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key_name</span></span></span><span class="hljs-class"> } networks: - port: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server2_port</span></span></span><span class="hljs-class"> } server2_disk: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cinder</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Volume</span></span></span><span class="hljs-class"> properties: name: server2_disk image: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_param</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">image_server2</span></span></span><span class="hljs-class"> } size: 5 server2_port: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OS</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Neutron</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Port</span></span></span><span class="hljs-class"> properties: network_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_net</span></span></span><span class="hljs-class"> } fixed_ips: - subnet_id: { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_resource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private_subnet</span></span></span><span class="hljs-class"> }</span></span></code> </pre><br></div></div><br>  The next block describes the created resources: networks, router, servers and others.  In this part of the template, we describe the general local area network (private_net) and its subnet, for which the range of addresses used is indicated and DHCP support is enabled. <br><br>  The next stage is the creation of a router and an interface on it.  Through this interface, the router connects to the created local network.  Then the servers are listed.  Each server should have a port and a disk.  For the first server, in contrast to the second, a floating IP address is also specified (floating_ip), with which the external address from the public network can be associated with the gray address from the local one. <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server1_floating_ip</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">type</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">OS</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::Neutron</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::FloatingIP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">properties</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">floating_network_id</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">get_param</span></span>: public_net_id } <span class="hljs-selector-tag"><span class="hljs-selector-tag">port_id</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">get_resource</span></span>: server1_port } <span class="hljs-selector-tag"><span class="hljs-selector-tag">depends_on</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">router_interface</span></span></code> </pre><br>  Pay attention to how parameters and resources are used when describing new devices.  Above, we have provided a fragment of the description of the floating IP address resource for the first server.  In its properties, we need to specify the public network UUID, from where it will take a floating IP address (floating_network_id) and a server port UUID (port_id), with which this address will be associated.  In the get_param function, we indicate that the value should be taken from the public_net_id parameter (we will describe how to use the parameters below).  Port Id of the first server yet;  it will appear only after the server is created.  The get_resource function just indicates that immediately after creating the server1_port resource, its value should be used as the UUID for the port_id. <br><br><pre> <code class="hljs pgsql">Resource <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> failed: <span class="hljs-keyword"><span class="hljs-keyword">Conflict</span></span>: Router interface <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> subnet <span class="hljs-number"><span class="hljs-number">8958</span></span>ffad<span class="hljs-number"><span class="hljs-number">-7622</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>d98<span class="hljs-number"><span class="hljs-number">-9</span></span>fd9<span class="hljs-number"><span class="hljs-number">-6</span></span>f4423937b59 <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> router <span class="hljs-number"><span class="hljs-number">7</span></span>ee9754b-beba<span class="hljs-number"><span class="hljs-number">-4301</span></span><span class="hljs-number"><span class="hljs-number">-9</span></span>bdd<span class="hljs-number"><span class="hljs-number">-166117</span></span>c5e5a6 cannot be deleted, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> it <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> required <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> one <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more floating IPs.</code> </pre><br>  According to this message, the router cannot be removed, because floating IP addresses are attached to the network associated with this router.  It is expected that when you remove the stack, you must first remove the floating IP-addresses, and then the router and its associated network.  The problem is that all the resources of the components neutron, cinder, nova, glance are independent of each other entities, between which relationships and relationships are established. <br><br>  In most cases, Heat determines the desired order of creating resources and building relationships between them when creating a stack.  When removing a stack, these links will also be taken into account: they will determine the order in which resources are deleted.  But sometimes, as in the example above, errors occur.  Using the depends_on directive, we explicitly stated that the floating IP address is associated with the router and the interface on it.  Thanks to this connection, now the IP address will be created after the router is created and the interface on it.  When deleting, everything will happen in reverse order: first, the floating IP address will be deleted, and then the router and its interface. <br><br>  In the last section of the template, we describe the virtual device parameters we need to get their values ‚Äã‚Äãafter the stack has been created. <br><br><div class="spoiler">  <b class="spoiler_title">Output block</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">outputs: server1_private_ip: description: private ip address <span class="hljs-keyword"><span class="hljs-keyword">within</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> subnet <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> installed Centos7 distro <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: { get_attr: [ server1_port, fixed_ips, <span class="hljs-number"><span class="hljs-number">0</span></span>, ip_address]} server1_public_ip: description: floating ip that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> assigned <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> server1 <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: { get_attr: [ server1_floating_ip, floating_ip_address ]} server2_private_ip: description: private ip address <span class="hljs-keyword"><span class="hljs-keyword">within</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> subnet <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> server2 <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> installed Debian7 distro <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: { get_attr: [ server2, first_address ]}</code> </pre><br></div></div><br>  In the above fragment, we indicate that we want to obtain the following values ‚Äã‚Äãfor the resources created during the assembly process: the address of the first server in the local network, the public address of the first server (floating IP address) and the address of the second server in the local network.  For each parameter we specified its short description and the requested value.  To do this, we use the function get_attr, which requires two values, where the first is the name of the resource, the second is its attributes. <br><br>  Pay attention to the different ways of obtaining the address in the local network from the first and second servers.  Both options are valid and equivalent.  The difference is that in the first case the Neutron component is accessed (if you remember, the server1_port type is ‚ÄúOS :: Neutron :: Port‚Äù) and the first IP address is taken from the fixed_ips attribute.  In the second case, which is often mentioned in the examples of templates on the network, the nova component is accessed (the server2 resource is of the type ‚ÄúOS :: Nova :: Server‚Äù) and the first_address attribute. <br><br>  Such components of the Openstack platform as Neutron and Cinder appeared later than Nova.  Therefore, Nova used to be used for a much larger number of functions, including for managing disks and networks.  With the full development of Neutron and Cinder, this need was no longer necessary, but was left for compatibility.  The Nova policy is gradually being revised, and some functions are eventually declared obsolete.  It is possible that the first_address attribute will not be supported soon. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">value</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">get_attr</span></span>: [ server1_port, fixed_ips, <span class="hljs-number"><span class="hljs-number">0</span></span>, ip_address]} <span class="hljs-selector-tag"><span class="hljs-selector-tag">value</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">get_attr</span></span>: [ server2, first_address ]}</code> </pre><br>  For more information about the templates and the rules for their preparation can be found in the <a href="http://ck.org/developer/heat/template_guide/index.html" rel="nofollow">official manual</a> . <br><br><h2>  Stack creation </h2><br>  Having prepared the template, check it for syntax errors and for compliance with the standard: <br><br><pre> <code class="hljs pgsql">$ heat <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">validate</span></span> -f <span class="hljs-keyword"><span class="hljs-keyword">publication</span></span>.yml</code> </pre><br><div class="spoiler">  <b class="spoiler_title">If the template is correct, the output will be presented in JSON format.</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk">{ <span class="hljs-comment"><span class="hljs-comment">"Description"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"Basic template of two servers, one network and one router\n"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"Parameters"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"server2_name"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"NoEcho"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"false"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"Type"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"String"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"Description"</span></span>: <span class="hljs-comment"><span class="hljs-comment">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">"Label"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"server2_name"</span></span> }, <span class="hljs-comment"><span class="hljs-comment">"private_subnet_name"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"NoEcho"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"false"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"Type"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"String"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"Description"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"the Name of private subnet"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"Label"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"private_subnet_name"</span></span> }, <span class="hljs-comment"><span class="hljs-comment">"key_name"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">"NoEcho"</span></span>: <span class="hljs-comment"><span class="hljs-comment">"false"</span></span>, ...</code> </pre><br></div></div><br>  Then proceed directly to creating the stack: <br><br><pre> <code class="hljs pgsql">$ heat stack-<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> TESTA -f testa.yml -P key_name="testa" \ -P public_net_id="ab2264dd-bde8-4a97-b0da-5fea63191019" \ -P server_flavor="1406718579611-8007733592" \ -P private_net_name=localnet -P private_subnet_name="192.168.0.0/24" \ -P router_name=router -P server1_name=Centos7 -P server2_name=Debian7 \ -P image_server1="CentOS 7 64-bit" \ -P image_server2="ba78ce9b-f800-4fb2-ad85-a68ca0f19cb8"</code> </pre><br>  It is inconvenient to manually transfer the parameters to the Heat client each time: you can easily make a mistake.  To avoid this drawback, we will create an additional file that repeats the format of the main template, but contains only the most basic parameters. <br><br><pre> <code class="hljs go">parameters: key_name: testa public_net_id: ab2264dd-bde8<span class="hljs-number"><span class="hljs-number">-4</span></span>a97-b0da<span class="hljs-number"><span class="hljs-number">-5f</span></span>ea63191019 server_flavor: myflavor private_net_name: localnet private_subnet_name: <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> router_name: router server1_name: Centos7 server2_name: Debian7 image_server1: CentOS <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span>-bit image_server2: ba78ce9b-f800<span class="hljs-number"><span class="hljs-number">-4f</span></span>b2-ad85-a68ca0f19cb8</code> </pre><br>  In this case, creating a stack using the console utility Heat will be simplified. <br><br> <a href=""><img src="https://habrastorage.org/files/22a/7ba/538/22a7ba5389164e8faeca4ecfe37d5eb6.png" alt="image"></a> <br>  To find out the necessary values ‚Äã‚Äãof the parameters passed to Heat, we can use the standard set of utilities for working with Openstack.  For example, to find the public network identifier public_net_id, you can use Neutron: <br><br> <a href=""><img src="https://habrastorage.org/files/609/550/e32/609550e324ad47b8ad9d5f6de62d867a.png" alt="image"></a> <br>  To find out the server_flavor and image_server1 name or identifier, image_server2 you can use the corresponding utilities in the same way. <br><br><h2>  Stack operations </h2><br>  After creating the stack, you need to make sure that everything went without errors, and also to find out which IP addresses were assigned to the servers (first of all, the public IP of the first server). <br><br>  A list of all created stacks can be obtained using the heat-list command.  Her output will include information about the status of each stack: <br><br> <a href=""><img src="https://habrastorage.org/files/29d/db1/f45/29ddb1f458c74d1b881d8417d7fd75a8.png" alt="image"></a> <br><br>  The cause of the creation error can be obtained from general information about the stack.  As can be seen from the output, we incorrectly specified the UUID of the local network to which the port of the server we are creating should be connected - because of this, an error occurred.  Also, errors often occur due to the lack of free resources (limits for the number of used cores, RAM, and others are set for each project). <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"> <a href="http://http:"><img src="https://habrastorage.org/files/598/2ee/cdc/5982eecdca5544a8befa02ea7d9bc98d.png"></a> <br></div></div><br>  If the stack was created successfully, then in the general output of the stack-show command, the outputs section will also appear, containing the values ‚Äã‚Äãof interest. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/7d2/151/776/7d21517764bc49f0952ce2586aba0d4b.png"></a> <br></div></div><br>  For most cases, the output of the heat stack-show command is too large and detailed.  Finding in this output some small but important detail (for example, the IP address of the first server) is extremely difficult.  If we are only interested in the value of the floating address of the first server, then we can get it by the following command, where, after the stack name, we also indicate the conclusion we described about the public IP address: <br><br><pre> <code class="hljs pgsql">$ heat output-<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> TESTA server1_public_ip "95.213.154.192"</code> </pre><br>  Removing a stack is easy ‚Äî using the heat stack-delete command: <br><br> <a href=""><img src="https://habrastorage.org/files/8c1/a02/b0f/8c1a02b0fee0498db30516e09d995f9f.png"></a> <br>  In a situation when it is necessary to temporarily free up system resources without removing the stack itself, you can pause it with the heat action-suspend command and return it to working state later via heat action-resume. <br><br>  We considered only the most frequently used, in our opinion, stack operations (and did not concern the management of individual resources), events, stack updates during its operation, and other features.  More information can be obtained from the <a href="http://docs.openstack.org/cli-reference/content/heatclient_commands.html" rel="nofollow">official documentation</a> or with the help of the heat help command. <br><br><h2>  Conclusion </h2><br>  In this article, we learned about the basic principles of the openstack Heat orchestration module, which gives us an additional level of abstraction when working with the cloud and eliminates a lot of routine actions. <br><br>  Of course, the possibilities of Heat are not limited.  We did not mention the important ability to transfer the so-called user data (user_data) to the machine being created, which will be executed inside the machine when it is first loaded.  Strictly speaking, Heat transfers data to the machine for execution not independently, but through the Nova component.  But due to the possibility of describing the links between the resources Heath, it is possible not to limit the conditions for the execution of the transmitted data to a single machine. <br><br>  For example, you need to create several machines, one of which will act as a database server, and the rest will connect to it by IP address.  Through the use of templates, we can not think about the sequence of creating machines and their network settings.  As soon as the corresponding resources are created, all the necessary values, including the ip address of the database server, will be transferred to user_data. <br><br>  To fully utilize these features, you need to understand how the data is transmitted inside the machine and how they are processed.  We will talk about this in more detail in the next article. <br><br>  Readers who for one reason or another can not leave comments here are invited to our <a href="http://blog.selectel.ru/iskusstvo-virtualnogo-dirizhirovaniya-openstack-rabota-s-heat/">blog</a> . </div><p>Source: <a href="https://habr.com/ru/post/247307/">https://habr.com/ru/post/247307/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247285/index.html">When to use OOP, and when - OP?</a></li>
<li><a href="../247291/index.html">Internet mapping</a></li>
<li><a href="../247295/index.html">Results of the year. Analysis of what was on the market of payment systems and a forecast for the future</a></li>
<li><a href="../247297/index.html">We get the IP addresses of HTTPS clients from HAProxy (frontend) to Nginx (backend) in HTTP and TCP balancing modes</a></li>
<li><a href="../247299/index.html">Analyze text in Excel using Azure Machine Learning and Power Query</a></li>
<li><a href="../247309/index.html">‚ÄúPerfect‚Äù coin toss: The NIST Randomness Beacon</a></li>
<li><a href="../247311/index.html">Reflections on DIY: two sources, two components ...</a></li>
<li><a href="../247315/index.html">DIY Turntable for 3D scanning and shooting photo-360</a></li>
<li><a href="../247317/index.html">Eleven content marketing articles that you might have missed in 2014</a></li>
<li><a href="../247319/index.html">Flexible Scrum development methodology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>