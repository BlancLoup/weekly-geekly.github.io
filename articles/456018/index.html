<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to implement warmth from GitHub to production server using Webhook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have long been in the habit of creating repositories on GitHub. This is much more efficient than keeping everything on Google Drive or, worse, on yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to implement warmth from GitHub to production server using Webhook</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a60/7c0/b39/a607c0b396ae120f0dc052183ad0700e.jpg"><br><br>  I have long been in the habit of creating repositories on GitHub.  This is much more efficient than keeping everything on Google Drive or, worse, on your hard drive.  But here the question immediately arises: how to execute the deploy on the working server? <br><br>  Most search queries put me on Jenkins and other continuous deployment tools.  But I wanted to find a different solution.  So I went to the free service Webhook. <br><a name="habracut"></a><br><blockquote>  <b>Skillbox recommends:</b> Practical course <a href="https://skillbox.ru/agima/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DAGIMA%26utm_content%3Darticles%26utm_term%3Dwebhook">"Mobile Developer PRO"</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>We remind:</b> <i>for all readers of "Habr" - a discount of 10,000 rubles when writing to any Skillbox course on the promotional code "Habr".</i> </blockquote><br>  The technical basis of Webhook is a fresh droplet of Digital Ocean with Ubuntu 16.04 as a working server.  To reduce the number of steps required to implement the plan, all actions are performed by the root user. <br><br><h3>  Let's start with github </h3><br>  If you have a repository and you want to use it, you can skip this step - just use the SSH URI, that's all.  If not, create it and use the SSH URI too. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ea/127/1d5/3ea1271d50f0493f426c5fb8b85e8f17.png"><br><br>  Install Go and Webhook (droplet Digital Ocean). <br><br>  Before you begin, you should perform a quick update and upgrade with the fresh installer Ubuntu 16.04. <br><br><pre><code class="plaintext hljs">sudo apt update -y &amp;&amp; sudo apt upgrade -y</code> </pre> <br>  Now to install WebHook you need to install the Go programming language.  At the time of this writing, version 1.11.4 was relevant, so if you have a different version, you need to make edits. <br><br><pre> <i><code class="plaintext hljs">wget https://dl.google.com/go/go1.11.4.linux-amd64.tar.gz sudo tar -C /usr/local -xzf go1.11.4.linux-amd64.tar.gz export PATH=$PATH:/usr/local/go/bin</code></i> </pre> <br>  It's time to download the latest version of Webhook. <br><br><pre> <i><code class="plaintext hljs">go get github.com/adnanh/webhook</code></i> </pre> <br>  During the download there is no progress bar, so you just need to wait.  After completing the process, execute ~ / go / bin / webhook. <br><br>  Webhook is installed, but you need to create a directory and file structure so that everything works as it should. <br><br><pre> <i><code class="plaintext hljs">mkdir ~/webhooks mkdir ~/webhooks/deployment-tutorial touch ~/webhooks/hooks.json touch ~/webhooks/deployment-tutorial/deploy.sh chmod +x ~/webhooks/deployment-tutorial/deploy.sh</code></i> </pre> <br>  The file hooks.json is responsible for configuration and routing, and deploy.sh serves as a tool for executing the commands needed for updates from GitHub. <br><br>  The first step is to configure hooks.json by opening it in a text editor.  The file contains the configuration for endpoints that will be created after the Webhook launch, and is an array of objects, each of which is a unique endpoint. <br><br><pre> <i><code class="plaintext hljs">[{ "id": "deployment-tutorial", "execute-command": "/root/webhooks/deployment-tutorial/deploy.sh", "command-working-directory": "/root/deployed-site/", "response-message": "Executing deploy script...", "trigger-rule": { "match": { "type": "payload-hash-sha1", "secret": "The Returners", "parameter": { "source": "header", "name": "X-Hub-Signature" } } } }]</code></i> </pre> <br>  <b>Id</b> - a unique name that will be used for the endpoint URL; <br>  <b>execute-command</b> - a script that will be executed when endpoint is activated; <br>  <b>command-working-directory</b> is the directory that is used during the execution of execute-command; <br>  <b>trigger-rule</b> - an option that will be used for information security purposes; this is the secret phrase for endpoints. <br><br>  Let me remind you that all actions I perform as root, so the starting address / root.  If you log in as a regular user, you need to register / home / username, where username, which is logical, is the name of this user.  No need to use ~ /, the path must be absolute, otherwise you will get an error. <br><br>  You may have noticed that we have set up a working folder that does not yet exist.  Before you create it, you need to finish with deploy.sh. <br><br>  The script must always begin with ‚Äúshebang‚Äù.  Before opening the file, you should execute which bash.  Well, then the following commands are executed in the script: <br><br><pre> <i><code class="plaintext hljs">#!/bin/bash git fetch --all git checkout --force "origin/master"</code></i> </pre> <br>  Now both Go and Webhook are installed, so you need to configure the configuration in hooks.json and write the script responsible for the deployment.  It will change the destination directory, working from the main branch of the GitHub repository. <br><br>  Finally, it‚Äôs time to bring Webhook into active mode, replacing the 000.000.000.000 with the working IP address of Doplet. <br><br><pre> <i><code class="plaintext hljs">/root/go/bin/webhook -hooks /root/webhooks/hooks.json -ip "000.000.000.000" -verbose</code></i> </pre> <br>  During execution, you may notice the output of the URL with {id} at the end.  This will be the id of the object that is already created in the hooks.json file: deployment-tutorial. <br><br><h3>  Configure Git (Digital Ocean Droplet) </h3><br>  Server setup is not complete yet.  To complete it, you need to open a new terminal window and authenticate again on the server, while Webhook is running in the first window.  At the very beginning we asked the repository URI, now it needs to be used. <br><br>  To do this, go to the working directory specified in hooks.json and set the following: <br><br><pre> <i><code class="plaintext hljs">git init git remote add origin git@github.com:jhsu98/deployment-tutorial.git</code></i> </pre> <br>  In doing so, you need to replace the URI with your own instead of what I indicated. <br><br>  The final step is to generate SSH keys in order to connect to GitHub with their help.  In the terminal window, type ssh-keygen and confirm by pressing Enter while the keys are generated.  Then you need to display the public keys by typing cat ~ / .ssh / id_rsa.pub.  Something like this will turn out: <br><br><pre> <i><code class="plaintext hljs">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCyzJrPVOJqsTqD2R3xirTp3VNMwpmJMyLklzJg4sRQyslTUmbNNmDVO573EbXQQf2PqPQljqKDDlSaELdav4OTi1gPCoDary300yUqC/efLGHflZ6pMNuGsP2zTzerD/TMjzl1FXF1wOGTXqcC4TvGBS1bFyUY5n8wSOJ8ntZ6bBNv0zA2t7X1vH8ahIBJLKCayq9ipobKlHPYqxBt6zAoeh/ILQ0PWhGkmbGqqzqN1jcVWOefLgj4Dl8bZWORS1nkqrVg2wFC2nnibH97kZLsNrdQaeK8jUrkUWkJcUELI02mkkqh2RtBx9EwQEvsm9YuDBD9xF+HyuWoAeqcKerb root@github-webhook-tutorial</code></i> </pre> <br>  Well, now all that's left is to set up a GitHub repository and test it. <br><br><h3>  Setting up the deployment key and Webhook (GitHub) </h3><br>  In the browser, go to the settings for the repository.  First you need to add the Deployment Key. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d65/b02/3aa/d65b023aa5a398c8d6bae9d4227298bd.png"><br><br>  When adding a key, you need to set its name and insert it into the key output above.  GitHub allows you to work only with public keys, so if necessary, you need to set several keys.  Once everything is finished, the Webhook section turns. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2da/4e1/936/2da4e1936888f9c617e3938199c24731.png"><br><br>  Three fields in this section should be given special attention.  These are payload URL, content type and secret.  Payload URL - endpoint, which Webhook listens on, content type - data format, secret - custom line from hooks.json file.  In our case, this is ‚ÄúThe Returners‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7a/763/89e/f7a76389e9e6b66d1ad83eda89ef8e00.png"><br><br>  After creating Webhook, the corresponding mark should appear in the settings, which indicates that the server is available.  If you check the terminal with a working Webhook, you can see that the repository is already in operation. <br><br>  To check the workflow, copy the repository to the local machine, if this has not already been done, and make changes to the main branch.  After that, they should be displayed on the server.  Is done. <br><br>  A developer who has already performed it all several times spends about 10 minutes to set up.  But this is after hours and hours of trial and error.  Remember these four important setting features: <br><br><ul><li>  Be sure to use an absolute path for hooks.json. </li><li>  Do not deploy.sh executable file. </li><li>  Confirm SSH connections during the first ‚Äúcontact‚Äù of GitHub and the production server. </li><li>  Do not use the erroneous ‚Äúshebang‚Äù in the bash script. </li></ul><br><blockquote>  <b>Skillbox recommends:</b> <br><br><ul><li>  Two-year practical course <a href="https://iamwebdev.skillbox.ru/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DWEBDEVPRO%26utm_content%3Darticles%26utm_term%3Dwebhook">"I am a web developer PRO"</a> . </li><li>  Online course <a href="https://skillbox.ru/c-sharp/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DCSHDEV%26utm_content%3Darticles%26utm_term%3Dwebhook">"C # developer with 0"</a> . </li><li>  Practical annual course <a href="https://skillbox.ru/php/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DPHPDEV%26utm_content%3Darticles%26utm_term%3Dwebhook">"PHP developer from 0 to PRO"</a> . <br></li></ul></blockquote></div><p>Source: <a href="https://habr.com/ru/post/456018/">https://habr.com/ru/post/456018/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456002/index.html">Dedicated hearth memory and OOM Killer intervention</a></li>
<li><a href="../456004/index.html">We invite you to mitap on frontend-development in high-load services</a></li>
<li><a href="../45601/index.html">Platform 2009 is waiting for habra people</a></li>
<li><a href="../456010/index.html">How java 10 changes the way anonymous inner classes are used</a></li>
<li><a href="../456014/index.html">On the localization of products. Part 2: How is the price formed?</a></li>
<li><a href="../45602/index.html">In St. Petersburg, Tashkent, Barnaul and Batumi, the semifinals of the XXXIII Team Undergraduate Programming World Championships were held.</a></li>
<li><a href="../456020/index.html">Preparing to take over the world</a></li>
<li><a href="../456022/index.html">QIWI JS DETOX</a></li>
<li><a href="../456024/index.html">PHP 2019: Better Than You Think About It</a></li>
<li><a href="../456026/index.html">"The confrontation" NeoQUEST-2019: shoot down the drones and create a pocket VirusTotal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>