<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tutorial: Interactive SVG Cartogram Component for InstantCMS 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Difficulty: medium. 
 Time required: 30 min. 
 The article provides instructions on how to create your own component for the InstantCMS2 engine. At th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tutorial: Interactive SVG Cartogram Component for InstantCMS 2</h1><div class="post__text post__text-html js-mediator-article">  <b>Difficulty:</b> medium. <br>  <b>Time required:</b> 30 min. <br>  The article provides instructions on how to create your own component for the InstantCMS2 engine.  At the end of the article there is a link to the archive with the source code and the contents of all files from this instruction.  An example of the appearance of a component that can be created using this tutorial is shown in the illustration (the image is clickable). <br><br> <a href=""><img src="https://habrastorage.org/files/950/98f/82c/95098f82c79d4e488865fc43c16cd4ee.jpg" alt="Visual representation of the real wage level in the Russian Federation"></a> <br><br>  To begin with, a few words about the social network / community / blog social social network engine InstantCMS2.  This free CMS can be a great compromise, perhaps the best of the existing ones. <br>  The basic version already has a richer functionality than LiveStreet CMS. <br><a name="habracut"></a><br>  I don‚Äôt provide a screenshot of the comparison of the functional, because the <a href="http://www.cmsmagazine.ru/catalogue/compare_with/%3FSubmit2.x%3D39%26Submit2.y%3D8%26Submit2%3DSubmit%26cms_220%3D-1%26cms_259%3D-1">link</a> provides information not on the latest version of the InstantCMS engine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Pros and Cons of InstantCMS2 </h5><br>  Of the minuses - the number of modules, additions, those for this engine is quite limited.  The quality of technical support is a bit weak.  There is no lively active community around this engine, and registration on the forum is by invitation only.  But all these disadvantages are more than covered by the fact that the InstantCMS 2 engine is free. <br><br>  Of the benefits - out of the box is provided immediately: a forum, user profiles with the ability to add to friends, articles, blogs, news, groups, photo albums, static pages of the site.  As well as comments, RSS feeds, RSS fields, the ability to customize the main menu, normal moderation and quite convenient admin panel. <br><br>  <a href="http://www.instantcms.ru/get">Download the InstantCMS 2 engine</a> with the auto-install feature from the official project site. <br>  The installation process is well documented and intuitive. <br><br><h4>  Own component for InstantCMS2 </h4><br>  Let us proceed directly to the question of writing a separate component. <br><br>  To create a new component, create a folder in which your component will be (let's call it newcomponent) in the \ SiteDirectory \ system \ controllers \ directory, that is, the full address to the created directory will be \ SiteDirectory \ system \ controllers \ newcomponent \ - all letters in component names should be lowercase, this is important! <br><br>  Further in this folder we create the file frontend.php - this is the main file, without which the component will not work. <br><br>  In this file we create a class with the same name.  The class name matches the folder name.  And this class is inherited from the system class cmsFrontend. <br>  In this class, we have the ability to add methods that describe the actions of the component. <br>  What are component actions?  Let's take a look at the following image: <br><img src="https://habrastorage.org/files/5fe/b26/b07/5feb26b076394b32baad5ff8891a2557.png"><br><br>  Each page address consists of several segments: <br><ol><li>  / controller - The name of the component. </li><li>  / action - The name of the action.  Each component can have several actions within itself. </li><li>  / p1 / p2 / p3 / ... - Any number of parameters required for this action. </li></ol><br><br>  How is the action of the component determined?  A public method is defined in the component's class, which is called action Name of the Action with the BigBuk.  For the main page of the siteaddress.ru/newcomponent/ component, you must define the actionIndex () method.  For the internal page of the siteaddress.ru/newcomponent/act/ component, you need to define the actionAct () method. <br><br><h6>  Frontend.php file </h6><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newcomponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmsFrontend</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $template = cmsTemplate::getInstance(); $template-&gt;render(<span class="hljs-string"><span class="hljs-string">'index'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionAct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $errors = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $form = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getForm(<span class="hljs-string"><span class="hljs-string">'newForm'</span></span>); $is_submitted = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;has(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>); $newForm = $form-&gt;parse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request, $is_submitted); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($is_submitted){ $errors = $form-&gt;validate(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $newForm); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!errors) { $choropleth = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;getChoropleth($newForm); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!errors) { cmsUser::addSessionMessage(LANG_FORM_ERRORS, <span class="hljs-string"><span class="hljs-string">'error'</span></span>); } } $template = cmsTemplate::getInstance(); $template-&gt;render(<span class="hljs-string"><span class="hljs-string">'act'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'form'</span></span> =&gt; $form, <span class="hljs-string"><span class="hljs-string">'errors'</span></span> =&gt; $errors, <span class="hljs-string"><span class="hljs-string">'newForm'</span></span> =&gt; $newForm )); } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><br>  The attentive reader has noticed the use of the $ this-&gt; model-&gt; getChoropleth () method. <br>  To use the model's methods in the \ SiteDirectory \ system \ controllers \ newcomponent \ directory, create the model.php file <br>  However, we will read the data from the files, so put a stub here.  The description of the model file is for training purposes. <br><br><h6>  File model.php </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modelNewComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmsModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getChoropleth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($average_zarplata)</span></span></span><span class="hljs-function"> </span></span>{ $choropleth = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $choropleth; } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  Line $ template-&gt; render ('index');  determines the output of this template, which should be created in the \ SiteDirectory \ templates \ default \ controllers \ newcomponent \ directory.  Where \ default is the name of the used theme on the site (you can find and download a new theme from the instantcms community site and change the theme used through the admin area), the folder \ newcomponent will need to be created independently, this is the folder for the new component templates. <br>  The index.tpl.php file should be created in this folder for the main page of the component, and act.tpl.php for the internal one. <br><br><h6>  File index.tpl.php </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setPageTitle(<span class="hljs-string"><span class="hljs-string">'     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addBreadcrumb(<span class="hljs-string"><span class="hljs-string">'     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addToolButton(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'item'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'          '</span></span>, <span class="hljs-string"><span class="hljs-string">'href'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;href_to(<span class="hljs-string"><span class="hljs-string">'act'</span></span>) )); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;  &lt;/h1&gt; &lt;p&gt; &lt;/p&gt;</code> </pre><br><br>  The internal component page will contain a form for selecting parameters. <br>  First, create a folder \ forms \ in the folder of our component \ SiteDirectory \ system \ controllers \ newcomponent \. <br>  In the \ SiteDirectory \ system \ controllers \ newcomponent \ forms \ directory create the file form_newForm.php <br>  The form will be very simple, it prompts the user to select two parameters from the drop-down lists. <br><br><h6>  File form_newForm.php </h6><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">formNewcomponentnewform</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmsForm</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'fieldset'</span></span>, <span class="hljs-string"><span class="hljs-string">'childs'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fieldList(<span class="hljs-string"><span class="hljs-string">'par1'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">"1"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"2"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2"</span></span> ) )), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fieldList(<span class="hljs-string"><span class="hljs-string">'par2'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2"</span></span> ) )) ) ) ); } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br><h5>  Interactive SVG Cartogram </h5><br>  After that, let's move on to creating a template for the inner page of the / act component ‚Äî create the file act act.tpl.php and place it in the \ SiteDirectory \ templates \ default \ controllers \ newcomponent \ directory. <br>  To create a unique service, we will use the development of the <a href="http://habrahabr.ru/users/kogor/" class="user_link">KoGor</a> user (taking this opportunity, I want to convey a huge gratitude for the work done by <a href="http://habrahabr.ru/users/kogor/" class="user_link">KoGor</a> 'and a well-designed and intuitive <a href="http://habrahabr.ru/post/181766/">article</a> ) - an infogramma of the map of the Russian Federation with regional distribution. <br><br>  As a result, we should get something like this nice map of Russia: <br><img src="https://habrastorage.org/files/e42/20a/0b0/e4220a0b0fcc4f06b710b42265ccce78.png" alt="Salary level of health workers in the regions of Russia in 2014 according to the Rosstat"><br><br><div class="spoiler">  <b class="spoiler_title">File act.tpl.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setPageTitle(<span class="hljs-string"><span class="hljs-string">'     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addBreadcrumb(<span class="hljs-string"><span class="hljs-string">'       '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;href_to(<span class="hljs-string"><span class="hljs-string">''</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addBreadcrumb(<span class="hljs-string"><span class="hljs-string">'     '</span></span>); $arr_par1_id = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'1'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> , <span class="hljs-string"><span class="hljs-string">'2'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> ); $filename=<span class="hljs-string"><span class="hljs-string">'/upload/zarplata-'</span></span>.$arr_par1_id[$_GET[<span class="hljs-string"><span class="hljs-string">'par1'</span></span>]].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$_GET[<span class="hljs-string"><span class="hljs-string">'par2'</span></span>].<span class="hljs-string"><span class="hljs-string">'.csv'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span> ($_GET[<span class="hljs-string"><span class="hljs-string">'par1'</span></span>]) || !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span> ($_GET[<span class="hljs-string"><span class="hljs-string">'par2'</span></span>])) $filename=<span class="hljs-string"><span class="hljs-string">'/upload/zarplata-1-1.csv'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderForm($form, $newForm, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'method'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'get'</span></span>, <span class="hljs-string"><span class="hljs-string">'toolbar'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ), $errors); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"http://d3js.org/d3.v3.min.js"</span></span>&gt;&lt;/script&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"http://d3js.org/queue.v1.min.js"</span></span>&gt;&lt;/script&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"http://d3js.org/topojson.v0.min.js"</span></span>&gt;&lt;/script&gt; &lt;!-- &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"http://d3js.org/topojson.v1.min.js"</span></span>&gt;&lt;/script&gt; --&gt; &lt;style&gt; path { stroke:white; stroke-width: <span class="hljs-number"><span class="hljs-number">1</span></span>px; } body { font-family: Arial, sans-serif; } .city { font: <span class="hljs-number"><span class="hljs-number">10</span></span>px sans-serif; font-weight: bold; } .legend { font-size: <span class="hljs-number"><span class="hljs-number">12</span></span>px; } div.tooltip { position: absolute; text-align: center; width: <span class="hljs-number"><span class="hljs-number">150</span></span>px; height: <span class="hljs-number"><span class="hljs-number">25</span></span>px; padding: <span class="hljs-number"><span class="hljs-number">2</span></span>px; font-size: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: <span class="hljs-comment"><span class="hljs-comment">#FFFFE0; border: 1px; border-radius: 8px; pointer-events: none; } &lt;/style&gt; &lt;script type="text/javascript"&gt; var width = 720, height = 375; // Setting color domains(intervals of values) for our map var color_domain = [10000, 15000, 20000, 30000, 50000] var ext_color_domain = [0, 10000, 15000, 20000, 30000, 50000] var legend_labels = [" 10000 .", "10000-15000 .", "15000-20000 .", "20000-30000 .", "30000-50000 .", " 50000 ."] var color = d3.scale.threshold() .domain(color_domain) .range(["#ff1300", "#ff4e40", "#ff7d73", "#ffba00", "#ffcb40", "#adfcad"]); var div = d3.select("form").append("div") .attr("class", "tooltip") .style("opacity", 0); var svg = d3.select("form").append("svg") .attr("width", width) .attr("height", height) .style("margin", "10px auto"); var projection = d3.geo.albers() .rotate([-105, 0]) .center([-10, 65]) .parallels([52, 64]) .scale(500) .translate([width / 2, height / 2]); var path = d3.geo.path().projection(projection); //Reading map file and data queue() .defer(d3.json, "/upload/russia.json") .defer(d3.csv, "&lt;?php echo $filename; ?&gt;") .await(ready); //Start of Choropleth drawing function ready(error, map, data) { var rateById = {}; var nameById = {}; data.forEach(function(d) { rateById[d.RegionCode] = +d.AverageZarplata; nameById[d.RegionCode] = d.RegionName; }); //Drawing Choropleth svg.append("g") .attr("class", "region") .selectAll("path") .data(topojson.object(map, map.objects.russia).geometries) //.data(topojson.feature(map, map.objects.russia).features) &lt;-- in case topojson.v1.js .enter().append("path") .attr("d", path) .style("fill", function(d) { return color(rateById[d.properties.region]); }) .style("opacity", 0.8) //Adding mouseevents .on("mouseover", function(d) { d3.select(this).transition().duration(300).style("opacity", 1); div.transition().duration(300) .style("opacity", 1) div.text(nameById[d.properties.region] + " : " + rateById[d.properties.region]) .style("left", (d3.event.pageX) + "px") .style("top", (d3.event.pageY -30) + "px"); }) .on("mouseout", function() { d3.select(this) .transition().duration(300) .style("opacity", 0.8); div.transition().duration(300) .style("opacity", 0); }) // Adding cities on the map d3.tsv("/upload/cities.tsv", function(error, data) { var city = svg.selectAll("g.city") .data(data) .enter() .append("g") .attr("class", "city") .attr("transform", function(d) { return "translate(" + projection([d.lon, d.lat]) + ")"; }); city.append("circle") .attr("r", 3) .style("fill", "lime") .style("opacity", 0.75); city.append("text") .attr("x", 5) .text(function(d) { return d.City; }); }); }; // &lt;-- End of Choropleth drawing //Adding legend for our Choropleth var legend = svg.selectAll("g.legend") .data(ext_color_domain) .enter().append("g") .attr("class", "legend"); var ls_w = 20, ls_h = 20; legend.append("rect") .attr("x", 20) .attr("y", function(d, i){ return height - (i*ls_h) - 2*ls_h;}) .attr("width", ls_w) .attr("height", ls_h) .style("fill", function(d, i) { return color(d); }) .style("opacity", 0.8); legend.append("text") .attr("x", 50) .attr("y", function(d, i){ return height - (i*ls_h) - ls_h - 4;}) .text(function(d, i){ return legend_labels[i]; }); &lt;/script&gt;</span></span></code> </pre><br></div></div><br><br><h5>  Baseline data for cartogram </h5><br>  In order for the card to work, the last step remains.  We place the files cities.tsv, russia.json, zarplata-1-1.csv, zarplata-1-2.csv, zarplata-2-1.csv, zarplata-2-2.csv (given in the archive, the link to which is at the end of the article) in the \ SiteDirectory \ upload \ directory. <br><br>  We go to the address siteaddress.ru/newcomponent/act/ - here all the regions on the map of Russia are tinted with a dark gray color and when you hover, the name of the region appears - NaN.  To display any real data, replace the values ‚Äã‚Äãin the last column of the .csv files with numerical data. <br><br><div class="spoiler">  <b class="spoiler_title">Demo component</b> <div class="spoiler_text">  This module was developed by me for the site SalaryByudzhetnikov.RF in the section Salary Card.  Demo module can be viewed at the <a href="http://xn--80aaaeflhhdrwe6aqep1bf8t.xn--p1ai/srednyaya_zarplata_v_rossii_po_oblastyam/nakartu%3Fbyudzhetnaya_sfera%3D%25D0%25A0%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25B8%2B%25D0%25B7%25D0%25B4%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BE%25D0%25BE%25D1%2585%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%2B%2528%25D0%25B1%25D0%25BE%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B8%25D1%2586%252C%2B%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25BA%252C%2B%25D0%25B4%25D0%25B8%25D1%2581%25D0%25BF%25D0%25B0%25D0%25BD%25D1%2581%25D0%25B5%25D1%2580%25D0%25BE%25D0%25B2%2529%26v_godu%3D2014">link</a> . <br></div></div><br><br><h5>  Bonus </h5><br>  Finally, a small hint.  In the default default template in InstantCMS 2, the sidebar along with the action menu disappears as the width of the browser window decreases.  But on mobile devices, the disappearance of the sidebar and the action menu is not very convenient, because  Users have lost quite a lot of possible actions.  To change this situation, you can do the following.  Locate the theme-layout.css file in the \ templates \ default \ css \ directory and replace a piece of code in it <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* Media Queries ============================================================ */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">media</span></span> screen and (max-width: <span class="hljs-number"><span class="hljs-number">980px</span></span>) { <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">section</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>:<span class="hljs-number"><span class="hljs-number">100%</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">aside</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>:none; } } @<span class="hljs-keyword"><span class="hljs-keyword">media</span></span> screen and (max-width: <span class="hljs-number"><span class="hljs-number">800px</span></span>) { <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">section</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>:<span class="hljs-number"><span class="hljs-number">100%</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">aside</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>:none; }</code> </pre><br>  on <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* Media Queries ============================================================ */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">media</span></span> screen and (max-width: <span class="hljs-number"><span class="hljs-number">980px</span></span>) { <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">section</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>:<span class="hljs-number"><span class="hljs-number">100%</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">aside</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>:<span class="hljs-number"><span class="hljs-number">100%</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } } @<span class="hljs-keyword"><span class="hljs-keyword">media</span></span> screen and (max-width: <span class="hljs-number"><span class="hljs-number">800px</span></span>) { <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">section</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>:<span class="hljs-number"><span class="hljs-number">100%</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#body</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">aside</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>:<span class="hljs-number"><span class="hljs-number">100%</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre><br><br>  Those.  in fact, only 2 lines need to be corrected. #body aside {display: none;  } on #body aside {width: 100%! important;  } - after that, the sidebar will move down to the main column after the content in it (before the footer) when the width of the browser decreases. <br><br><h5>  Source </h5><br>  All the described scripts and files can be downloaded in the <a href="">archive</a> , which you just need to download and unpack to the root directory of your website running on InstantCMS2. <br><br>  PS For any typos, errors or inaccuracies, please write to private messages. </div><p>Source: <a href="https://habr.com/ru/post/264519/">https://habr.com/ru/post/264519/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264505/index.html">Managing dependency versions in the Maven project</a></li>
<li><a href="../264511/index.html">Optimize the Android game mTricks Looting Crown for the Intel Atom platform</a></li>
<li><a href="../264513/index.html">Writing a program to steal data from a USB-drive in Windows</a></li>
<li><a href="../264515/index.html">Updating Linux on a device based on the Altera SoC FPGA chip and gaining access to shared Windows server resources</a></li>
<li><a href="../264517/index.html">The notorious programmer: life hacking firsthand</a></li>
<li><a href="../264521/index.html">Treacherous router or why ports need to open</a></li>
<li><a href="../264523/index.html">How Easter eggs in email helped the company draw attention to its conference</a></li>
<li><a href="../264525/index.html">Free IBM Bluemix Developer Resources</a></li>
<li><a href="../264527/index.html">EXTREME'AL LACP</a></li>
<li><a href="../264531/index.html">ASR and TTS technologies for an application programmer: theoretical minimum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>