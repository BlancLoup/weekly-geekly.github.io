<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TYPO3 CMS cluster in Jelastic cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TYPO3 is a great solution for websites of all sizes, from small to corporate. This CMS makes it easy to create and manage multilingual corporate sites...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TYPO3 CMS cluster in Jelastic cloud</h1><div class="post__text post__text-html js-mediator-article">  TYPO3 is a great solution for websites of all sizes, from small to corporate.  This CMS makes it easy to create and manage multilingual corporate sites for large organizations.  Such websites can scale and adapt to any emerging needs. <br><br>  <a href="http://jelastic.com/">Jelastic</a> makes it possible to make your site on TYPO3 not only very flexible and affordable, but also stable and high-performance.  To achieve this result, you need to configure a high-availability cluster with two <b>Apache</b> application servers, an <b>NGINX</b> balancer, a <b>Memcached</b> node, and two replicated <b>MySQL databases</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a60/9e1/5dc/a609e15dc18bf4c4a69bcc01c0656d2c.png" alt="typo cluster"><br><a name="habracut"></a><br>  Memcached server is used to store Apache server sessions.  Thanks to the backup sessions, if one of the Apache servers fails, the second will ‚Äúpick up‚Äù the sessions from the Memcached node and continue processing them.  The NGINX balancer distributes traffic within the cluster.  In addition, replication of the master and slave MySQL databases improves performance, improves the reliability of data availability and the resiliency of your environment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's proceed to the step-by-step configuration of a highly available clustered TYPO3 application. <br><br><h3>  <b>A. Deploying a TYPO3 application</b> </h3><br>  First of all, you need to create the necessary Jelastic environment and deploy the TYPO3 application. <br><br>  1. Sign up (if you haven‚Äôt done this before) or log in to your Jelasti account. <br><br>  2. Click <b>Create Environment</b> . <br><br>  3. Select the <b>Apache</b> application <b>server</b> , <b>MySQL database,</b> and <b>Memcached</b> node.  Set the limits of the cloudlet and enter the environment name (for example, <i>typo-cluster</i> ).  Click <b>Create</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b58/f46/dab/b58f46dab26676eb7132432dce480c9a.png" alt="create an environment"><br><br>  4. Wait for the environment to be created. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c24/0b8/20e/c240b820e9007d12e3f3787cd9e157ac.png" alt="environment"><br><br>  5. Go to the official <a href="http://typo3.org/download/">TYPO3 website</a> and download the <b>zip</b> archive with the latest version of the application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ad/fa0/cae/3adfa0cae08dc05bc60930a9e9c7edb8.png" alt="typo site"><br><br>  6. Using the <b>Distribution Manager,</b> download the archive to the control panel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f69/38c/ffe/f6938cffea91d4ca2176fec9041b0177.png" alt="download archive"><br><br>  7. Then deploy it to the environment you just created. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48a/3af/562/48a3af562b392e2d4d3f58a4fc9659f7.png" alt="deploy application"><br><br><blockquote>  To install and run your TYPO3 application, you need to disable the <b>zend_extension</b> extension. <br>  Go to the <b>etc&gt; php.ini</b> file and comment out the following line: <br><br><pre><code class="java hljs">#zend_extension=/usr/lib64/php/modules/opcache.so</code> </pre> </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/0d8/3d5/2be/0d83d52be333a37a122acd0441911297.png" alt="disable extension"><br><br><h3>  <b>B. Configuring PHP Clustering Sessions</b> </h3><br>  High availability of PHP applications can be achieved by applying clustering of PHP sessions in the cloud.  To maintain performance in the event of an application server failure (we will add another server in the next steps of the instructions) we will use Memcached. <br><br>  1. Click the <b>Configuration</b> button for the <b>Apache</b> server.  In the configuration manager, open the file <b>etc&gt; php.ini</b> and enable the Memcached module by adding the following line: <br><br><pre> <code class="java hljs">extension=memcached.so</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a97/ae2/1ef/a97ae21efb68b571bb4def017aa2cd3a.png" alt="memcached"><br><br>  2. To activate support for working with sessions, add the following lines to the <b>Session</b> block of the <b>php.ini</b> configuration file: <br><br><pre> <code class="java hljs">session.save_handler = memcached session.save_path = <span class="hljs-string"><span class="hljs-string">"&lt;server&gt;:11211"</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/666/679/0df/6666790df2c17b47d3eb82230ddd9537.png" alt="memcached session"><br><br><blockquote>  Instead, <code>  IP  Memcached .   ,   <b></b>  Memcached   .</code> <code>  IP  Memcached .   ,   <b></b>  Memcached   .</code> <br><img src="https://habrastorage.org/getpro/habr/post_images/a44/93c/c73/a4493cc7365dbb8146f0b989b64c2724.png" alt="IP address"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/80c/bfc/8d5/80cbfc8d58036aa9192d48365beee541.png" alt="Memcached"><br><br>  3. <b>Save the</b> changes and <b>restart the</b> Apache server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a66/164/5dd/a661645ddb0b7e2a36649b2cd7a1020a.png" alt="restart server"><br><br><h3>  C. Database Setup </h3><br>  The next step is to configure MySQL database replication (master and slave) to protect the application from downtime or data loss. <br><br>  MySQL in an environment with deployed TYPO3 will be used as the main database.  For the subordinate base, you need to create a separate environment. <br><br>  Go to the Jelastic control panel and create a new environment with a <b>MySQL</b> node that will be used as a subordinate database.  Name your environments (for example, slave-db) and click <b>Create</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/214/a4f/230/214a4f230f2a68ab975733446640249b.png" alt="subordinate base"><br><br>  And now let's configure each database separately: <br><br><h4>  Master database </h4><br>  As mentioned above, we use MySQL in an environment with a deployed application (ie, <i>typo-cluster</i> ) as our main database. <br><br>  1. Click the <b>Configuration</b> button for the main database. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c3/db8/46b/7c3db846b95f85a97dee0c5b4677accc.png" alt="main base configuration"><br><br>  2. Go to the <b>my.cnf</b> file in the <b>etc</b> folder and set the following parameters, as shown in the image below (you need to uncomment only two lines): <br><br><pre> <code class="java hljs">server-id = <span class="hljs-number"><span class="hljs-number">1</span></span> log-bin = mysql-bin binlog-format=mixed</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/091/a5e/402/091a5e40279b0893e2ecf1e4aeb19ff1.png" alt="my.cnf"><br><br>  We use <i>binlog-format = mixed</i> to allow replication of operations with foreign keys. <br><br><blockquote>  Do not use <i>binlog_format = statement</i> , otherwise there will be errors later! </blockquote><br>  3. <b>Save the</b> changes and <b>Restart</b> MySQL to apply the new configuration settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e79/c94/82a/e79c9482a17dca441986d86fef1a9778.png" alt="restart mysql"><br><br>  4. Click the <b>Open in browser</b> button near the main MySQL database.  Log into the MySQL administration panel using the credentials you received via email after creating the environment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eef/158/f78/eef158f7803dcc8c81a21e4d59c7e4a0.png" alt="Open in MySQL browser"><br><br>  5. Go to the <b>Replication</b> tab and click <b>Add</b> <b>Replication Sub</b> - <b>User</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/192/ed1/fa1/192ed1fa1aee790914a9fc035910b726.png" alt="Add subordinate replication user"><br><br>  6. Enter the name and password for the replication subordinate user and click <b>OK</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e9/9ef/079/9e99ef07977edd607ee1deacd70a4d9f.png" alt="username and password for subordinate user"><br><br>  Your subordinate user has been successfully created. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/eb3/938/6d4eb3938e79950299c93a026d9a4d19.png" alt="subordinate user created"><br><br><h4>  Slave Database </h4><br>  Now let's establish a connection between the master and slave MySQL databases. <br><br>  1. Click the <b>Configuration</b> button for the subordinate database. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b63/c83/cbc/b63c83cbc90bb665b6b5e3b97fa32b8b.png" alt="subordinate base configuration"><br><br>  2. Open the file <b>etc&gt; my.cnf</b> and add the following lines: <br><br><pre> <code class="java hljs">server-id = <span class="hljs-number"><span class="hljs-number">2</span></span> slave-skip-errors = all</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/c14/cf6/421/c14cf6421bfedf7a79c465fd996b6643.png" alt="my.cnf slave mysql"><br><br>  We allow our subordinate database to skip all errors of the main one ( <i>slave-skip-errors = all</i> ) in order not to interrupt the normal operation in case of their occurrence. <br><br>  This is not recommended at the development stage to be able to find bugs, etc.  However, in this instruction, we focus on the production stage when your code has already been tested.  Any error on the side of the main base, even a minor one, can stop the subordinate or lead to out of sync. <br><br>  3. <b>Save the</b> changes and <b>Restart the</b> slave database server to apply the new configuration settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2d/a3e/e02/f2da3ee02c4ea0a6ba31bc6f1037d9f3.png" alt="restart the slave server"><br><br>  4. Log in to <b>phpMyAdmin</b> using the account information that Jelastic sent you when creating the environment for the subordinate database. <br><br>  5. Go to the <b>Replication</b> tab and click the <i><b>setting</b></i> in the <b>Replication</b> section of the <b>slave server</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0d/92a/6b1/f0d92a6b111fbf8e00f502c97312ba71.png" alt="Slave server replication"><br><br>  6. Configure the core server (enter the name, password, and host of the slave replication user). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bf/552/b3a/8bf552b3aad43c8111738c692a2830e2.png" alt="the name, password, and host of the subordinate user"><br><br>  Now the main server is configured. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/26b/017/e03/26b017e030da4e5cebac00257ccba658.png" alt="master server configured"><br><br>  7. Click on the <b>Control slave&gt; Full start</b> for the slave server to start the <i>Slave SQL</i> and <i>Slave IO</i> streams. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/713/0d0/c4e/7130d0c4e47c236f6f35989e31aefc97.png" alt="Slave SQL and Slave IO streams"><br><br>  8. Check the subordinate server status table to make sure everything is in order. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e2/79e/42f/5e279e42fbd0d63510f2848ffbbf787a.png" alt="slave server status table"><br><br>  As a result, replication is configured and all data is synchronized between the main and subordinate databases. <br><br><h3>  D. Installing TYPO3 </h3><br>  Now we can complete the installation of TYPO3. <br><br>  1. Go to the Jelastic control panel and click the <b>Open in browser</b> button for the TYPO3 environment.  Installation will begin.  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c28/4e4/fba/c284e4fba2053f99b9ccd9dc771feef1.png" alt="Open in TYPO3 browser"><br><br>  2. In the <b>Connect to your database host</b> window: <br><ul><li>  select <b>MySQL / MySQL</b> driver </li><li>  fill in the <b>Username</b> and <b>Password</b> fields with credentials of your main database (received by email when creating the environment) </li><li>  in the <b>Host</b> field enter the address of the database server </li></ul><br>  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fce/360/c3d/fce360c3d86e4fe7316aad704b5d8c71.png" alt="Connect to your database host"><br><br>  3. At the <b><i>Select database</i></b> stage, create a new database: enter a name for the TYPO3 database (for example, <i>typo_db</i> ) and click <b>Continue</b> . <br><br><blockquote>  Thanks to the database replication we configured earlier, the created database will automatically appear on both MySQL servers, master and slave. </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/a17/b30/3a1/a17b303a1a2ad37c9f6386d79cb71975.png" alt="Select database"><br><br>  4. In the next window, select the <b>Introduction package</b> .  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14a/166/99b/14a16699bbc3ac667c640395430d9945.png" alt="Introduction package"><br><br>  5. Installation will begin.  Wait a few minutes to complete it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ce/808/5d3/6ce8085d30478f5ca8f33d4a4d73c75f.png" alt="installation package"><br><br>  6. Finally, enter the password to access the TYPO3 admin panel and select the color of the TYPO3 main page. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f32/ac2/d74/f32ac2d74ac191ebcf067bf34ab97437.png" alt="image"><br><br>  Congratulations!  TYPO3 installed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84a/34c/030/84a34c030da3772887ebda21318a5e32.png" alt="TYPO3 installed"><br><br><h3>  E. Cluster Setup </h3><br>  After the TYPO3 installation has been successfully completed, we can proceed to setting up a highly available cluster. <br><br>  1. Open the Jelastic control panel and click the <b>Change Environment Topology</b> button for the environment with the TYPO3 application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b3e/c6a/0e2/b3ec6a0e23a029b4fb9c20228ed79bf1.png" alt="Change the topology of the environment"><br><br>  2. Add another Apache application server by clicking the + button (highlighted in the image below).  <b>NGINX</b> balancer will be added automatically.  Click <b>Apply</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/888/ff1/9ad/888ff19ad8a32370e18c8be47c318f28.png" alt="another apache application server"><br><br><blockquote><ul><li>  The reason that we add a second application server only after installation is that in this way we <a href="http://docs.jelastic.com/data-synchronization">synchronize all the data between two Apache nodes</a> and avoid reinstalling and configuring. </li><li>  You can also configure file synchronization between cluster servers using the instructions in the document <a href="http://docs.jelastic.com/file-synchronization">File Synchronization</a> </li></ul></blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/ff4/6bd/26b/ff46bd26b8424c3780cd9ca392b9d39b.png" alt="Open cluster in browser"><br><br>  Your highly reliable and scalable clustered solution with TYPO3 installed is ready for use.  Click <b>Open in browser</b> and get to work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e4/288/fc8/7e4288fc88055634dc6180b7c5065603.png" alt="TYPO3 is ready to use."><br><br>  Using another TYPO3 clustering method?  Please share your experience with us in the comments below. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/217213/">https://habr.com/ru/post/217213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217203/index.html">Properties framework for Qt</a></li>
<li><a href="../217205/index.html">The logic of thinking. Subtotal</a></li>
<li><a href="../217207/index.html">Invitation to Frontend Developer Conf by Artem Zakharchenko</a></li>
<li><a href="../217209/index.html">Google Cloud Platform Live: a mix of IaaS and PaaS. Moore's Law for the Clouds</a></li>
<li><a href="../217211/index.html">Spectrophotometer PHOTON RT or spectral characteristics of glasses Gunnar and Polaroid</a></li>
<li><a href="../217215/index.html">"What is proof?": A look from theoretical informatics</a></li>
<li><a href="../217225/index.html">MakeHuman: release after 12 years of development</a></li>
<li><a href="../217235/index.html">Australian shark warns of its approach to shore via Twitter</a></li>
<li><a href="../217237/index.html">Internet Archive began digitizing 40,000 VHS and Betamax video tapes</a></li>
<li><a href="../217239/index.html">A set of bike Yii developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>