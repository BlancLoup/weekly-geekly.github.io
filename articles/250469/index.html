<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to live with Docker, or why better with it than without it?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is intended for those who already know about Docker, who knows what it is for. But what to do with it does not know further. The article ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to live with Docker, or why better with it than without it?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a5e/45b/7b2/a5e45b7b267f436ab9da1ce6720d1e48.jpg"><br><br>  This article is intended for those who already know about Docker, who knows what it is for.  But what to do with it does not know further.  The article is advisory in nature and does not encroach on the title of "best practice". <br><br>  So, you may have passed the <a href="https://www.docker.com/tryit/">docker tutorial</a> , the docker seems simple and useful, but you still do not know how it can help you with your projects. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Usually there are three problems with deployment: <br><ol><li>  How do I deliver the code to the server? </li><li>  How do I run the code on the servers? </li><li>  How can I ensure that the environment in which my code runs and works is the same? </li></ol><br><br>  As with this Docker under kat will help. <a name="habracut"></a>  So let's start not with the docker, but with how we lived without it. <br><br><h4>  How do I deliver the code to the server? </h4><br>  The first thing that comes to mind is to collect everything in a package.  RPM or DEB does not matter. <br><br><h5>  Packages </h5><br><img src="https://habrastorage.org/files/8e6/de5/d40/8e6de5d405c6463dbbaf61aa53c35a05.jpg"><br>  The system already has a batch manager that can manage files, usually we expect the following from it: <br><br><ul><li>  Deliver project files to server from some storage. </li><li>  Satisfy dependencies (libraries, interpreter, etc.) </li><li>  Delete the files of the previous version and deliver the files to the current one. </li></ul><br>  In practice, it works, for now ... Imagine the situation.  You are a devOps permanently.  Those.  you spend all day automating the routine activities that admins were doing.  You have a small fleet of machines, on which you do not breed zoo from distributions.  For example, you love Centos.  And she is everywhere.  But here comes the problem: you need for one of the projects to replace libyy (which is a quest itself, found under Centos) with libxx.  Why replace - you do not know.  Most likely, the developer wrote ‚Äúas usual Krivoruk‚Äù only for libxx, and it does not work with libyy.  Well, we take vim in our hands and write rpmspecs for libxx, in parallel for new versions of libraries that are needed for building.  And about 2-3 days of exercise, and here is one of the results: <br><br><ol><li>  libxx collected, everything is fine, the task is completed </li><li>  libxx is not going to, not because, say, the system has libyy installed, which will have to be removed, but something else on the server depends on it </li><li>  libxx is not collected, there is a lack of a library that conflicts with some other library </li></ol><br><br>  Total probability to cope with the task is about 30% (although in practice, options 2 or 3 always fall out).  And if you can somehow cope with the second situation (a virtual machine is there or lxc), then the third situation will either add one more beast to your menagerie, or use hi / usr / local hello for the zeros / slakvayar, etc. <br><br>  In general, this situation is called <a href="https://ru.wikipedia.org/wiki/Dependency_hell">dependency hell</a> .  There are a lot of options for solving this problem, from simple chroot to complex projects, such as <a href="http://nixos.org/">NixOs</a> . <br><br><img src="https://habrastorage.org/files/e38/4a2/ec0/e384a2ec06714dffba0271860e0c9c6c.png"><br>  What is it for me?  Oh, yes.  As soon as you start to collect everything in packages and drive them on the same system, you will definitely have a dependency hell situation.  It can be solved in different ways.  Or for each project to fence a new repository, plus a new virtual hardware / hardware, or to introduce restrictions.  By restrictions, I mean a certain set of company policies, like: ‚ÄúWe only have libyy-vN.N here.  Who does not like the personnel department with a statement. ".  About NN, I also just said so, some libraries can not live on one server in two versions.  Restrictions give nothing in the end.  Business, and common sense, will quickly destroy them all. <br><br>  Think for yourself what is more important: to make a feature in a product that depends on updating a component of a third party, or to give Devops time to enjoy the heterogeneity of the environment. <br><br><h5>  Deploy through GIT </h5><br><img src="https://habrastorage.org/files/760/df7/702/760df7702c4f432994ca93fd64b9de88.png"><br>  Good for interpreted languages.  Not suitable for something that needs to be compiled.  And also do not get rid of dependency-hell. <br><br><h4>  How do I run the code on the servers? </h4><br>  Many questions have been invented to this question: daemontools, runit, supervisor.  We believe that this question has at least one correct answer. <br><br><h4>  How can I ensure that the environment in which my code runs and works is the same? </h4><br>  Imagine a banal situation, you are still the same DevOps, a task comes to you, you need to deploy the Eniac project (the name is taken from the name generator for the projects) on N servers, where N is more than 20. <br><br>  You drag Eniac from GIT, it is on technology known to you (Django / RoR / Go / <strike>1C</strike> ), collect it using the usual method, launch it and ... does not work.  Contact the developer, scolding him for the first number, that he as usual "Krivoruk".  And he will give you everything back, and you are already ‚Äúcursed‚Äù.  Everything works for the developer.  From the perspective of your boss, you can‚Äôt run the project.  It is you.  Since testers, the project deployed on the developer‚Äôs computer has all been accepted. <br><br>  Understand the problem.  Go ahead, you manage to run Eniac on one server, and it does not work for another N-1. <br><br><h4>  How can Docker help me? </h4><br><img src="https://habrastorage.org/files/09a/dea/b92/09adeab92f7e4a07a8ec03cb22d8851b.png"><br>  Well, first, let's understand how to use Docker as a means of delivering projects on hardware. <br><br><h5>  Private <a href="https://github.com/docker/docker-registry">Docker Registry</a> </h5><br>  What is the <a href="https://github.com/docker/docker-registry">Docker Registry</a> ?  This is what stores your data, like a WEB server, which distributes deb-packages and files with metadata for them.  You can install Docker Hub on a virtual machine in Amazon and store data in Amazon S3, or put it on your infrastructure and store data in Ceph or on file system. <br><br>  The docker registry itself can also be run by the docker.  This is just an application in python (apparently, they did not master go to write libraries to the repositories, of which the registry supports a large number). <br><br>  And how our project will get to this storage, we will sort later. <br><br><h4>  How do I run the code on the servers? </h4><br>  Now let's compare how we deliver the project to a regular package manager.  For example apt: <br><br><pre><code class="bash hljs">apt-get update &amp;&amp; apt-get install -y myuperproject</code> </pre> <br>  This command is suitable for automation.  She will do everything quietly, she will need to restart our application. <br><br>  Now an example for Docker: <br><br><pre> <code class="bash hljs">docker run -d 192.168.1.1:80/reponame/mysuperproject:1.0.5rc1 superproject-run.sh</code> </pre> <br>  And that's all.  Docker will download everything from your docker registry located at 192.168.1.1 and listening to port 80 (I have nginx here) to run, and run superproject-run.sh inside the image. <br><br>  What will happen if in the image of the 2 programs that we run, and, say, in the next release, one of them broke, but the other on the contrary, scored features that need to be rolled out.  No problems: <br><br><pre> <code class="bash hljs">docker run -d 192.168.1.1:80/reponame/mysuperproject:1.0.10 superproject-run.sh docker run -d 192.168.1.1:80/reponame/mysuperproject:1.0.5rc1 broken-program.sh</code> </pre><br>  And now we have 2 different containers, and inside them there can be completely different versions of the system file libraries, etc. <br><br><h4>  How can I ensure that the environment in which my code runs and works is the same? </h4><br>  In the case of standard virtual machines or in general, real systems will have to keep track of everything.  Well, or learn Chef / Ansible / Puppet or something else from similar solutions.  Otherwise, there is no guarantee that xxx-utils is the same version on all N servers. <br><br>  In the case of the docker, you do not need to do anything, just expand the containers from the same images. <br><br><h4>  Container Assembly </h4><br>  In order for your code to get into the docker registry (yours or global does not matter), you will have to push it there. <br><br>  You can force the developer to collect the container yourself: <br><br><ul><li>  The developer writes Dockerfile </li><li>  Makes docker tag $ imageId 192.168.1.1:80/reponame/mysuperproject:1.0.5rc1 </li><li>  And docker push push 192.168.1.1:80/reponame/mysuperproject:1.0.5rc1 </li></ul><br><br>  Or collect automatically.  I did not find anything that collects containers, so <a href="https://github.com/mosquito/lumper">here, I have collected a bicycle called lumper</a> <br><br>  The bottom line is as follows: <br><ul><li>  Install 3 components on the server lumper and RabbitMQ </li><li>  We listen to port for github hooks. </li><li>  We configure in github web-hook on our installation lumper </li><li>  Developer makes git tag v0.0.1 &amp;&amp; git push --tags </li><li>  Receives email with build results </li></ul><br><br><h4>  Dockerfile </h4><br>  In fact, there is nothing difficult.  For example, build a lumper with the help of Dockerfile. <br><br><pre> <code class="bash hljs">FROM ubuntu:14.04 MAINTAINER Dmitry Orlov &lt;me@mosquito.su&gt; RUN apt-get update &amp;&amp; \ apt-get install -y python-pip python-dev git &amp;&amp; \ apt-get clean ADD . /tmp/build/ RUN pip install --upgrade --pre /tmp/build &amp;&amp; rm -fr /tmp/build ENTRYPOINT [<span class="hljs-string"><span class="hljs-string">"/usr/local/bin/lumper"</span></span>]</code> </pre><br><br>  Here FROM speaks about the image on which the image is based.  Next, RUN launches commands preparing the environment.  ADD places the code in / tmp / build, then ENTRYPOINT specifies the entry point to our container.  So when you start by writing <b>docker run -it - rm mosquito / lumper - help you</b> will see the output - help entry point. <br><br><h4>  Conclusion </h4><br>  In order to run containers on servers there are several ways, you can either <a href="https://docs.docker.com/articles/host_integration/">write an init-script</a> or look at <a href="http://www.fig.sh/">Fig,</a> which can deploy entire solutions from your containers. <br><br>  I also deliberately bypassed the topic of port forwarding, and ip container routing. <br><br>  Also, since the technology is young, the docker has a huge community.  And <a href="https://docs.docker.com/">excellent documentation</a> .  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/250469/">https://habr.com/ru/post/250469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250455/index.html">STM32. Medical application. Tonometer. Introduction and hardware</a></li>
<li><a href="../250461/index.html">General Director of Microsoft Ukraine Nadezhda Vasilyeva: ‚ÄúToday we have something that was important in Europe 2-3 years ago‚Äù</a></li>
<li><a href="../250463/index.html">Review and assessment of the prospects for the development of the global and Russian IT markets</a></li>
<li><a href="../250465/index.html">Poll. Automated Testing</a></li>
<li><a href="../250467/index.html">How backgrounds are made in Homeworld2 from the inside</a></li>
<li><a href="../250471/index.html">We invite to the competition "Cognitive Vehicle Detection Benchmark"</a></li>
<li><a href="../250473/index.html">Facebook launched a social network for information security professionals</a></li>
<li><a href="../250475/index.html">OSEDUCONF-2015, the tenth conference ‚ÄúFree Software in Higher Education‚Äù - videotapes and overview</a></li>
<li><a href="../250481/index.html">JavaScript Garden: Objects</a></li>
<li><a href="../250485/index.html">Productive fault tolerant geographically distributed cluster operating in Active-Active scheme on IBM zEnterprise EC 12 mainframe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>