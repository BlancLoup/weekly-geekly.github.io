<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raspberry Pi cartridge from NES</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! This is a retro gaming console based on the Raspberry Pi. In the cartridge from the game console NES. An integrated screen can be used for the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raspberry Pi cartridge from NES</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/sc/kd/6i/sckd6ialjgjcnygsp6mgbbarxqo.jpeg"></div><br>  Hello!  This is a retro gaming console based on the Raspberry Pi.  In the cartridge from the game console NES.  An integrated screen can be used for the game.  When outputting the same video via HDMI, it shows the image of the game cover, as well as the core temperature, see the photo.  I suggest a little ponastalgic and read about the assembly and configuration of such a device.  Carefully, further a lot of traffic and photos. <br><a name="habracut"></a><br><h3>  Nostalgia </h3><br>  In childhood, we, who are now 25-35, loved to play consoles.  Then there was no newfangled word of the console, so I will call them that.  My acquaintance with consoles began with Dandy (clone NES).  Super Mario Bros, Contra, Ducktales, Battletoads are just <a href="https://www.digitaltrends.com/gaming/best-nes-games-ever/">some of the hits of</a> that time.  Then the whole court was going to play with my friend in Sega (Sega Mega Drive), in such hits as Sonic, Ultimate Mortal Combat 3, Contra Hard Corps and <a href="https://www.complex.com/pop-culture/the-100-best-sega-genesis-games/">more</a> .  And when the Play Station came out, I must say, she didn‚Äôt get to us right away, the Resident Evil series caused some truly scary delight. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s0/gf/wa/s0gfwacncy42u8kgyh-covaswb0.jpeg"></div><br>  This picture helped me to wipe away a tear of nostalgia.  I must say, I'm not the first who came up with the Raspberry Pi inserted into the case of the NES cartridge.  Yes, this is not my device.  And this cartridge is suitable for these purposes almost perfectly, it is small and beautiful.  And inside a lot of space.  Judge for yourself. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xd/lj/rg/xdljrg9nhjqinlh68r08_ipb29g.jpeg"></div><br>  Inside a Raspberry Pi Zero, a USB hub, and a pair of extension cords.  All sticks are planted on hot-melt glue. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Assembly </h3><br>  I wanted to collect something the same or similar.  The same cartridge was selected from NES.  Other options are either very small or they don't look very good.  As the fiery heart of a retro car made Raspberry Pi 3B.  Were purchased on Ali, also, USB connectors with convenient leads for soldering.  Here it is. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vp/pf/mt/vppfmtvulbrixf9fyl_k4s35lbc.jpeg"></div><br>  Oh yeah, you will repeat this project, do not take hit cartridges.  There are so few of them left.  Take something more common or less known.  There is also an option to take a cartridge with Ali, but the original, it warms the soul.  My 1986 release. <br><br>  You will also need a special <i>nes</i> screwdriver screwdriver if the cartridge is <i>screwed</i> into three screws.  There are also early versions of cartridges with five screws; they are unscrewed with a conventional flat-head screwdriver.  I have just this. <br><br>  From the cartridge with a stationery knife and a sheet from a hacksaw, all interfering parts are cut and sawed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eb/v2/99/ebv299uc5rqf8hnmpa8ixpplslc.jpeg"></div><br>  With the Raspberry Pi, protruding connectors were soldered.  Experts say that you can do without a soldering station, if you first carefully disassemble the connectors with pliers, and then drop out one foot.  All glued to the glue.  Between connectors USB and raspberry laid insulator of non-melting plastic.  Do not forget to connect the GND Raspberry Pi and the USB connector case (not shown in the picture above).  Otherwise some joysticks will not work. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/la/jq/n8/lajqn8luf0sfi4jrqlhfsfvtvxu.jpeg"></div><br>  The last <a href="https://retropie.org.uk/">Retropie</a> was installed on the <a href="https://retropie.org.uk/">raspberry</a> .  At first, <a href="https://www.recalbox.com/">Recalbox</a> was <a href="https://www.recalbox.com/">standing</a> , but I refused it, because it does not support the vibration of the joysticks on the Playstation 1 consoles. But I must say, the Recalbox is slightly more convenient in terms of what works out of the box and do not need to tune anything.  In Retropie a lot of settings, you can customize infinitely.  By this I liked him. <br>  That's what happened.  Connect any joysticks with xinput. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4y/8k/rt/4y8krts6wihpqs0ki5gnd17cxbk.jpeg"></div><br><br><h3>  Screen </h3><br>  Appetite comes with eating.  How about embed screen in a cartridge?  To play or display the image of the game cover.  <a href="https://www.banggood.com/Geekwrom-HD-3_5-Inch-TFT-Display-Shield-800x480-For-Raspberry-Pi-3B-2B-With-2-Keys-And-Remote-IR-p-1069730.html%3Futm_source%3Dgoogle%26utm_medium%3Dcpc_elc%26utm_content%3Dgary%26utm_campaign%3Dds-cpa-elc2-other%26gclid%3DCjwKCAjw3cPYBRB7EiwAsrc-uc1nGOtD-Sv-wMVBOmVKkX3H1kddfjtJTUhO0Gk57ohe1PkkBrUK4RoCZkMQAvD_BwE%26cur_warehouse%3DCN">Such a screen has been</a> ordered.  This is an 800 * 480 3.5 inch screen with a parallel DPI interface that uses almost all GPIO Raspberry Pi.  It works for me in 120 Hz mode (but the render is still 60 Hz), the response is instant.  The only negative is the 6-bit matrix.  Only 262,144 colors.  Although, in general, it is not particularly noticeable, judge for yourself. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bs/lh/qa/bslhqal3q5wbgn7lvlisrcktvqk.jpeg"></div> <i>Screenshot from the game Comix Zone (Clickable)</i> <i><br></i> <br>  All the legs from the screen and the Raspberry Pi were soldered.  The screen was soldered with two cables from an old IDE cable.  Under the screen installed mortgages in 5mm, it does not touch the bottom wall of the cartridge.  Electrical tape is glued around the perimeter of the display so that there are no side lights.  All glued to the glue.  On the top cover, I cut through the window and pasted glass 2mm thick. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cm/st/zo/cmstzo941-fnue36c5sz2k46o38.jpeg"></div><br>  In order to run the image output on this screen, you need to fix the config / <i>boot / config.txt</i> .  I recommend <a href="https://winscp.net/eng/docs/lang:ru">WinSCP</a> program for Windows owners, which, when connecting to Raspberry Pi via SSH, gives the presentation of files as in Total commander'e.  Very comfortably.  Especially if you run it in <i>shell</i> mode <i>sudo su -</i> , which gives access to all files. <br><br>  Unfortunately, when the DPI screen is on, video output via HDMI does not work.  Therefore, I created two <i>config files</i> in the <i>/ boot /</i> folder, one <i>config_hdmi.txt</i> , the second <i>config_dpi.txt</i> .  In the <i>config_hdmi.txt</i> config, the resolution is 1080p60Hz and overscan is removed.  <i>config_dpi.txt</i> contains the DPI screen settings. <br><br><div class="spoiler">  <b class="spoiler_title">config_dpi.txt</b> <div class="spoiler_text"><pre><code class="hljs pgsql"># uncomment <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> picture <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> HDMI <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> "safe" mode #hdmi_safe=<span class="hljs-number"><span class="hljs-number">1</span></span> disable_overscan=<span class="hljs-number"><span class="hljs-number">1</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> force a specific HDMI mode (this will force VGA) #hdmi_group=<span class="hljs-number"><span class="hljs-number">1</span></span> #hdmi_mode=<span class="hljs-number"><span class="hljs-number">1</span></span> # Sound output. <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> autodetect, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DVI, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> force HDMI. #hdmi_drive=<span class="hljs-number"><span class="hljs-number">2</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> /etc/modules <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> deprecated <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> longer supported <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">4.4</span></span> kernel # So manually <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> audio dtparam=audio=<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> config_hdmi_boost=<span class="hljs-number"><span class="hljs-number">0</span></span> # force hdmi <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> the tv can take <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">before</span></span> sending the signal <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> the hdmi output hdmi_force_hotplug=<span class="hljs-number"><span class="hljs-number">1</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> composite PAL #sdtv_mode=<span class="hljs-number"><span class="hljs-number">2</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> lirc-rpi #dtoverlay=lirc-rpi #<span class="hljs-number"><span class="hljs-number">3.5</span></span> HD tft screen <span class="hljs-number"><span class="hljs-number">800</span></span>x480 dtoverlay=dpi24 overscan_left=<span class="hljs-number"><span class="hljs-number">0</span></span> overscan_right=<span class="hljs-number"><span class="hljs-number">0</span></span> overscan_top=<span class="hljs-number"><span class="hljs-number">0</span></span> overscan_bottom=<span class="hljs-number"><span class="hljs-number">0</span></span> #Banggood framebuffer_width=<span class="hljs-number"><span class="hljs-number">800</span></span> framebuffer_height=<span class="hljs-number"><span class="hljs-number">480</span></span> dtparam=spi=<span class="hljs-keyword"><span class="hljs-keyword">off</span></span> dtparam=i2c_arm=<span class="hljs-keyword"><span class="hljs-keyword">off</span></span> enable_dpi_lcd=<span class="hljs-number"><span class="hljs-number">1</span></span> display_default_lcd=<span class="hljs-number"><span class="hljs-number">1</span></span> dpi_output_format=<span class="hljs-number"><span class="hljs-number">0x6f015</span></span> dpi_group=<span class="hljs-number"><span class="hljs-number">2</span></span> dpi_mode=<span class="hljs-number"><span class="hljs-number">87</span></span> hdmi_timings=<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">800</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">120</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">46080000</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> display_rotate=<span class="hljs-number"><span class="hljs-number">3</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you plug your tv at the same <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> your rpi <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> that the rpi switches <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the hdmi <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> give a low resolution because tv had <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> enough <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> initialize it boot_delay=<span class="hljs-number"><span class="hljs-number">3</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you don<span class="hljs-string"><span class="hljs-string">'t want the rainbow at startup #disable_splash=1 # default CEC name #cec_osd_name=recalbox dtparam=spi=off # Overclock gpu_mem_256=128 gpu_mem_512=256 gpu_mem_1024=256 overscan_scale=1 gpu_mem=256 start_x=0 enable_uart=0 avoid_safe_mode=1 kernel=zImage</span></span></code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">config_hdmi.txt</b> <div class="spoiler_text"><pre> <code class="hljs vhdl"># <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> more options <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> information see # http://rpf.io/configtxt # Some settings may impact device functionality. See link above <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> details # uncomment <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you get no picture <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> HDMI <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">"safe"</span></span> mode #hdmi_safe=<span class="hljs-number"><span class="hljs-number">1</span></span> # uncomment this <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> your display has a black border <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> unused pixels visible # <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> your display can output without overscan disable_overscan=<span class="hljs-number"><span class="hljs-number">1</span></span> # uncomment the following <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> adjust overscan. <span class="hljs-keyword"><span class="hljs-keyword">Use</span></span> <span class="hljs-built_in"><span class="hljs-built_in">positive</span></span> numbers <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> console # goes off screen, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> negative <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> too much border #overscan_left=<span class="hljs-number"><span class="hljs-number">16</span></span> #overscan_right=<span class="hljs-number"><span class="hljs-number">16</span></span> #overscan_top=<span class="hljs-number"><span class="hljs-number">16</span></span> #overscan_bottom=<span class="hljs-number"><span class="hljs-number">16</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">force</span></span> a console size. By <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> it will be display<span class="hljs-symbol"><span class="hljs-symbol">'s</span></span> size minus # overscan. #framebuffer_width=<span class="hljs-number"><span class="hljs-number">1280</span></span> #framebuffer_height=<span class="hljs-number"><span class="hljs-number">720</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hdmi display <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> detected <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> composite <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> being output hdmi_force_hotplug=<span class="hljs-number"><span class="hljs-number">1</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">force</span></span> a specific HDMI mode (this will <span class="hljs-keyword"><span class="hljs-keyword">force</span></span> VGA) hdmi_group=<span class="hljs-number"><span class="hljs-number">1</span></span> #<span class="hljs-number"><span class="hljs-number">1080</span></span>p60fps hdmi_mode=<span class="hljs-number"><span class="hljs-number">16</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">force</span></span> a HDMI mode rather than DVI. This can make audio work <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> # DMT (computer monitor) modes #hdmi_drive=<span class="hljs-number"><span class="hljs-number">2</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> increase <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> HDMI, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you have interference, blanking, <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> # no display #config_hdmi_boost=<span class="hljs-number"><span class="hljs-number">4</span></span> # uncomment <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> composite PAL #sdtv_mode=<span class="hljs-number"><span class="hljs-number">2</span></span> #uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> overclock the arm. <span class="hljs-number"><span class="hljs-number">700</span></span> MHz <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>. #arm_freq=<span class="hljs-number"><span class="hljs-number">800</span></span> # Uncomment some <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> these <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> enable the optional hardware interfaces #dtparam=i2c_arm=<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> #dtparam=i2s=<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> dtparam=spi=off # Uncomment this <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> enable the lirc-rpi module #dtoverlay=lirc-rpi # Additional overlays <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> parameters are documented /boot/overlays/README # Enable audio (loads snd_bcm2835) dtparam=audio=<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> gpu_mem_256=<span class="hljs-number"><span class="hljs-number">128</span></span> gpu_mem_512=<span class="hljs-number"><span class="hljs-number">256</span></span> gpu_mem_1024=<span class="hljs-number"><span class="hljs-number">256</span></span> overscan_scale=<span class="hljs-number"><span class="hljs-number">1</span></span> gpu_mem=<span class="hljs-number"><span class="hljs-number">256</span></span> start_x=<span class="hljs-number"><span class="hljs-number">0</span></span> enable_uart=<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br></div></div><br>  Switching configs will be our autoscript which is available on the network. <br>  \\ 192.168.x.xxx \ configs \ all \ autostart.sh or in the folder on the device /opt/retropie/configs/all/autostart.sh <br><br><div class="spoiler">  <b class="spoiler_title">autostart.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Check to see if display is not connected _NOHDMI=$(tvservice -n ) || true # Check to make sure it's not already in LCD mode _ISLCD=$(tvservice -s | grep "LCD") || true # HDMI is connected - turn off backlight LCD _HDMI=$(tvservice -s | grep "0x12000a") || true if [ -z "$_NOHDMI" ]; then if [ "$_ISLCD" ]; then printf "NO HDMI connected, LCD DPI display config already active\n" #do nothing else printf "NO HDMI connected, Switching to LCD DPI display\n" #change config to Hyperpixel and reboot since no display detected sudo cp /boot/config_dpi.txt /boot/config.txt sudo reboot now fi elif [ "$_NOHDMI" ]; then if [ "$_ISLCD" ]; then printf "HDMI is connected, but LCD DPI config is being used\n" #we need to switch to HDMI display config and reboot sudo cp /boot/config_hdmi.txt /boot/config.txt sudo reboot now elif [ "$_HDMI" ]; then printf "HDMI is connected, HDMI config detected, so turning off LCD BL\n" #we need to shut off the backlight on the Hyperpixel display since we aren't using it #don't panic, a reboot automatically resets this - it isn't a persistent value #also to do this the config.txt file needs to load the backlight module on startup #to control it even if you aren't loading the overlay driver for the display # this comment #echo 1 | sudo tee /sys/class/backlight/rpi_backlight/bl_power else #debugging catchall - shouldn't happen since we expect 0x12000a - but you never know... printf "HDMI is connected, HDMI config detected, your tv might not like 1920x1080 resolution\n" fi else #do nothing - based on previous if statements - you either have HDMI or you don't have it... printf "Debug catchall point - sorry I can't help you out - I haven't run into the error state yet!\n" fi emulationstation #auto</span></span></code> </pre><br></div></div><br>  A script was also written <i>switchscreen.sh</i> , which should be put in <i>/ home / pi / RetroPie / retropiemenu /</i> .  This script switches configs manually and is available from the main Retropie settings menu.  After its launch, it is necessary to pull out the HDMI cable, and after rebooting everything will switch back automatically.  Do not forget to register the script <br><br><pre> <code class="bash hljs">chmod +x /home/pi/RetroPie/retropiemenu/switchscreen.sh</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">switchscreen.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # Check to see if display is dpi _DPI=$(grep dpi /boot/config.txt) || true if [ "$_DPI" ]; then printf "Switch to HDMI\n" sudo cp /boot/config_hdmi.txt /boot/config.txt sudo reboot now else printf "Switch to DPI LCD\n" sudo cp /boot/config_dpi.txt /boot/config.txt sudo reboot now fi exit 0</span></span></code> </pre> <br></div></div><br>  In <i>autostart.sh</i> , traces of code are visible, <i>turning</i> off the DPI screen backlight when HDMI is turned on.  I copied this script on the Internet, so it doesn‚Äôt work on our screen.  It would be possible to be confused with transistors to turn off the power of the screen, but why, if we need to display a picture of the cover of the currently running game.  You just need to figure out what DPI is. <br><br><h4>  Parallel Display Interface (DPI) </h4><br>  DPI, as was said, is a parallel interface for screens.  Information on this interface <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/dpi/">one</a> , <a href="http://blog.reasonablycorrect.com/raw-dpi-raspberry-pi/">two,</a> and <a href="https://www.nxp.com/wcm_documents/techzones/microcontrollers-techzone/Presentations/graphics.lcd.technologies.pdf">miscalculated</a> .  Well, now it will be here, in Russian. <br><br>  All attempts to enable DPI by console commands during HDMI operation failed.  Maybe doing something wrong.  Plan B was adopted for implementation: display the image on a small screen, tugging software by the GPIO legs. <br><br>  DPI is characterized by the fact that one pixel is transmitted to the display in one clock signal clock.  Since we have a 6-bit matrix, these are 18 pins for three colors, and also there are display enable pins (indicates a valid date), h_sync (sets the zero address of the horizontal line in the display controller), v_sync (sets the zero address of the vertical line in the display controller ).  Data locking occurs on the falling edge of the clock signal.  This is known if you decipher the line ‚Äúdpi_output_format = 0x6f015‚Äù from our <i>config_dpi.txt</i> according to this terminology. <br><br><div class="spoiler">  <b class="spoiler_title">dpi_output_format</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">output_format = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xf</span></span>; rgb_order = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xf</span></span>; output_enable_mode = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; invert_pixel_clock = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">9</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; hsync_disable = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; vsync_disable = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">13</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; output_enable_disable = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">14</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; hsync_polarity = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; vsync_polarity = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">17</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; output_enable_polarity = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">18</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; hsync_phase = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; vsync_phase = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">21</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; output_enable_phase = (dpi_output_format &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x1</span></span>; output_format: <span class="hljs-number"><span class="hljs-number">1</span></span>: DPI_OUTPUT_FORMAT_9BIT_666 <span class="hljs-number"><span class="hljs-number">2</span></span>: DPI_OUTPUT_FORMAT_16BIT_565_CFG1 <span class="hljs-number"><span class="hljs-number">3</span></span>: DPI_OUTPUT_FORMAT_16BIT_565_CFG2 <span class="hljs-number"><span class="hljs-number">4</span></span>: DPI_OUTPUT_FORMAT_16BIT_565_CFG3 <span class="hljs-number"><span class="hljs-number">5</span></span>: DPI_OUTPUT_FORMAT_18BIT_666_CFG1 <span class="hljs-number"><span class="hljs-number">6</span></span>: DPI_OUTPUT_FORMAT_18BIT_666_CFG2 <span class="hljs-number"><span class="hljs-number">7</span></span>: DPI_OUTPUT_FORMAT_24BIT_888 rgb_order: <span class="hljs-number"><span class="hljs-number">1</span></span>: DPI_RGB_ORDER_RGB <span class="hljs-number"><span class="hljs-number">2</span></span>: DPI_RGB_ORDER_BGR <span class="hljs-number"><span class="hljs-number">3</span></span>: DPI_RGB_ORDER_GRB <span class="hljs-number"><span class="hljs-number">4</span></span>: DPI_RGB_ORDER_BRG output_enable_mode: <span class="hljs-number"><span class="hljs-number">0</span></span>: DPI_OUTPUT_ENABLE_MODE_DATA_VALID <span class="hljs-number"><span class="hljs-number">1</span></span>: DPI_OUTPUT_ENABLE_MODE_COMBINED_SYNCS invert_pixel_clock: <span class="hljs-number"><span class="hljs-number">0</span></span>: RGB Data changes <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> rising edge <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stable</span></span> at falling edge <span class="hljs-number"><span class="hljs-number">1</span></span>: RGB Data changes <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> falling edge <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stable</span></span> at rising edge. hsync/vsync/output_enable_polarity: <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> HDMI mode <span class="hljs-number"><span class="hljs-number">1</span></span>: inverted hsync/vsync/oe phases: <span class="hljs-number"><span class="hljs-number">0</span></span>: DPI_PHASE_POSEDGE <span class="hljs-number"><span class="hljs-number">1</span></span>: DPI_PHASE_NEGEDGE</code> </pre><br></div></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hn/ve/im/hnveimuds5y8a8yxdypngnbntjs.png"></div><br>  The sequence of bits is shown in the figure above.  Each line starting with VSYNC has a full cycle of HSYNC line cycles.  This is for one frame.  Back and Front porch are the so-called indents of the display, which are in the memory of the controller, but they are not on the screen. <br><br>  Now we will decode the string ‚Äúhdmi_timings = 480 0 16 16 24 800 0 4 2 2 0 0 0 120 0 46080000 6‚Äù from our config_dpi.txt.  There is nothing complicated, just write the parameters in order. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nn/nl/0n/nnnl0nnvr3b6-vhjhhyaarfkck8.png"></div><br>  What GPIO legs are used to convey colors is shown in this picture.  We have Mode 5. Attention, these are not legs in order, namely GPIO symbols!  The remaining signals are Clock - GPIO 0, DE - GPIO 1, VSYNC - GPIO 2, HSYNC - GPIO 3. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xj/vi/ni/xjvinid6ghfjkuk4mz8rsyzoevo.png"></div><br>  A python was quickly installed, the necessary GPIO library and a hello script were written to at least color the screen blue.  I also had cognitive dissonance, when Notepad ++ on Windows did not show indents, where they were in nano, while doing line breaks did tabulation, not spaces.  By the way, VSCode doesn‚Äôt find the same sin, how to fix it. <br><br><div class="spoiler">  <b class="spoiler_title">Python script</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> gpiozero <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LED <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sleep sleep_time = <span class="hljs-number"><span class="hljs-number">0.0</span></span> clock = LED(<span class="hljs-number"><span class="hljs-number">0</span></span>) de = LED(<span class="hljs-number"><span class="hljs-number">1</span></span>) vsync = LED(<span class="hljs-number"><span class="hljs-number">2</span></span>) hsync = LED(<span class="hljs-number"><span class="hljs-number">3</span></span>) red2 = LED(<span class="hljs-number"><span class="hljs-number">16</span></span>) red3 = LED(<span class="hljs-number"><span class="hljs-number">17</span></span>) red4 = LED(<span class="hljs-number"><span class="hljs-number">18</span></span>) red5 = LED(<span class="hljs-number"><span class="hljs-number">19</span></span>) red6 = LED(<span class="hljs-number"><span class="hljs-number">20</span></span>) red7 = LED(<span class="hljs-number"><span class="hljs-number">21</span></span>) green2 = LED(<span class="hljs-number"><span class="hljs-number">10</span></span>) green3 = LED(<span class="hljs-number"><span class="hljs-number">11</span></span>) green4 = LED(<span class="hljs-number"><span class="hljs-number">12</span></span>) green5 = LED(<span class="hljs-number"><span class="hljs-number">13</span></span>) green6 = LED(<span class="hljs-number"><span class="hljs-number">14</span></span>) green7 = LED(<span class="hljs-number"><span class="hljs-number">15</span></span>) blue2 = LED(<span class="hljs-number"><span class="hljs-number">4</span></span>) blue3 = LED(<span class="hljs-number"><span class="hljs-number">5</span></span>) blue4 = LED(<span class="hljs-number"><span class="hljs-number">6</span></span>) blue5 = LED(<span class="hljs-number"><span class="hljs-number">7</span></span>) blue6 = LED(<span class="hljs-number"><span class="hljs-number">8</span></span>) blue7 = LED(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v_sync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(frame)</span></span></span><span class="hljs-function">:</span></span> vsync.on() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(frame): clock.on() <span class="hljs-comment"><span class="hljs-comment">#sleep(sleep_time) clock.off() #sleep(sleep_time) #print("vsync") vsync.off() pass def h_sync(frame): hsync.on() for n in range(frame): clock.on() #sleep(sleep_time) clock.off() #sleep(sleep_time) #print("hsync") hsync.off() pass def clc(frame): for n in range(frame): clock.on() #sleep(sleep_time) clock.off() #sleep(sleep_time) pass red2.off() red3.off() red4.off() red5.off() red6.off() red7.off() green2.off() green3.off() green4.off() green5.off() green6.off() green7.off() blue2.on() blue3.on() blue4.on() blue5.on() blue6.on() blue7.on() clock.off() de.off() #de.on() sleep(sleep_time) v_sync(2) clc(2) for row in range(5): v_sync(2) # v_back_porch(2) clc(2) for column in range(800): h_sync(16) # h_back_porch(16) clc(16) # LCD column de.on() clc(480) de.off() # h_front_porch(24) clc(24) # v_front_porch(4) clc(4) de.off() red2.off() red3.off() red4.off() red5.off() red6.off() red7.off() green2.off() green3.off() green4.off() green5.off() green6.off() green7.off() blue2.off() blue3.off() blue4.off() blue5.off() blue6.off() blue7.off()</span></span></code> </pre><br></div></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fs/tn/6t/fstn6tcvy0uylvjdjwncu1eztq0.gif"></div><br>  Too me, Python.  It was a surprise for me that the already rendered pixels disappear.  Although what I was waiting for, it's obvious. <br><br>  It was decided to rewrite everything in C. It works faster, approximately several frames per second.  The screen ripples like on old CRT monitors or radars.  What you need.  Retro!  I put the code on <a href="https://github.com/8street/lcd_screen">GitHub</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q0/t_/jp/q0t_jphffgafbdwhtez0by7fmrs.gif"></div><br>  Access to GPIO is carried out directly through the SoC registers of the BCM2837 chip.  Code examples took <a href="https://elinux.org/RPi_GPIO_Code_Samples">here</a> . <br><br>  It all started with a very tiny program, but now the display also shows the processor and memory usage in the form of small scroll bars.  The temperature of the processor is drawn like this font. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l-/g7/uk/l-g7uktr0ivlgmwzky-jgi0_690.png"></div><br>  To run the code, you need to copy the contents of the repository to the / home / pi / lcd_screen / folder (Who knows how to write the path relative to the binary, not the working folder on C under nix? Therefore, only in this folder) and run the following commands. <br><br><pre> <code class="bash hljs">gcc ./lcd_screen/lcd.c -o ./lcd_screen/lcd chmod +x ./lcd_screen/lcd</code> </pre> <br>  Or download the binary from releases immediately.  To run, you need to type the following.  SUDO is required to access GPIO. <br><br><pre> <code class="bash hljs">sudo ./lcd_screen/lcd path/file.bmp usec_per_frame</code> </pre> <br>  Where ‚Äúpath / file.bmp‚Äù is the path to the image file, it works only with the BMP format, ‚Äúusec_per_frame‚Äù is the delay between frames in microseconds in order not to load the processor in vain. <br><br>  We automate the launch of our lcd program so that it displays the desired cover when the game is running.  Of course, the built-in scraper is used to load covers into Retropie. <br>  Install the image converter.  It will convert all formats to bmp, supported by the program.  At the same time and resize, so that the images were full screen <br><br><pre> <code class="bash hljs">sudo apt-get install imagemagick</code> </pre> <br>  In the <i>/ opt / retropie / configs / all /</i> directory, create two files: <i>runcommand-onstart.sh</i> and <i>runcommand-onend.sh</i> .  Retropie automatically executes these scripts when loading / exiting any game.  Do not forget to write chmod + x to each file. <br><br><div class="spoiler">  <b class="spoiler_title">runcommand-onstart.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh system="$1" emulator="$2" romname="$3" #with path #echo $system # LCD programm here: #find current config: dpi or hdmi _DPI=$(grep dpi /boot/config.txt) || true if ! [ "$_DPI" ]; #if hdmi then sudo killall lcd # remove path filename=$(basename "$romname") # remove extension filename="${filename%.*}" # add image path file_png="/home/pi/.emulationstation/downloaded_images/$system/$filename-image.png" file_jpg="/home/pi/.emulationstation/downloaded_images/$system/$filename-image.jpg" #if system snes and n64 then rotate image 270 degree if [ "$system" = "snes" ] || [ "$system" = "n64" ] then if test -f "$file_png"; #fing file then convert "$file_png" -resize '800x480' -type TrueColor -alpha Remove -rotate 270 /home/pi/lcd_screen/work.bmp elif test -f "$file_jpg"; then convert "$file_jpg" -resize '800x480' -type TrueColor -alpha Remove -rotate 270 /home/pi/lcd_screen/work.bmp else convert "/opt/retropie/configs/$system/launching.png" -resize '480x800' -type TrueColor -alpha Remove -rotate 180 /home/pi/lcd_screen/work.bmp fi else if test -f "$file_png"; then convert "$file_png" -resize '480x800' -type TrueColor -alpha Remove -rotate 180 /home/pi/lcd_screen/work.bmp elif test -f "$file_jpg"; then convert "$file_jpg" -resize '480x800' -type TrueColor -alpha Remove -rotate 180 /home/pi/lcd_screen/work.bmp else convert "/opt/retropie/configs/$system/launching.png" -resize '480x800' -type TrueColor -alpha Remove -rotate 180 /home/pi/lcd_screen/work.bmp fi fi #launch my lcd project sudo /home/pi/lcd_screen/lcd /home/pi/lcd_screen/work.bmp 400000 &amp; fi</span></span></code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">runcommand-onend.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh _DPI=$(sudo grep dpi /boot/config.txt) || true if ! [ "$_DPI" ]; then sudo killall lcd sudo /home/pi/lcd_screen/lcd /home/pi/lcd_screen/retropie.bmp 50000 &amp; # cp /home/pi/lcd_screen/retropie.bmp /home/pi/lcd_screen/work.bmp fi</span></span></code> </pre> <br></div></div><br>  In the startup script, the presence of a DPI connection is first checked, then an image with jpeg or png formats is searched, rotated to the desired angle, its size is changed and converted to bmp format, then my program is launched with the required parameters. <br><br><h3>  Cooling </h3><br>  Raspberry Pi 3B is more powerful than Zero, and it needs good cooling.  Especially in such a closed case.  With a small radiator visible in the photo, after half an hour of playing on any emulator, the core temperature reached 80 degrees and trotting began. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/e6/kk/er/e6kkerc14t-yzonbam_vhkmjwwc.jpeg"></div><br>  A centrifugal fan of 40 * 30 * 10 mm was ordered, but before it arrived, I just tried to cut a small plate from a 3 mm aluminum plate, measuring 80 * 30 mm.  By that time I had dropped all the GPIO pins, so they no longer interfered with the installation of the plate.  In addition, I also cut a piece of 20 * 10mm for contact with the chip and made a sandwich from the plates.  It exceeded all my expectations, a maximum of 65 degrees on the core. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g2/wa/mz/g2wamz-kibms_rwlc-mfvec4ilq.jpeg"></div><br>  So it looks inside. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wu/is/5-/wuis5-glvpqtphs9dca4t1ro0us.jpeg"></div><br><br><h3>  In the end, what </h3><br>  How is it played?  Fine!  With shouts, smashing gamepads, mutual reproaches.  Just like sometime. <br><br>  No delays and lags were noticed. <br><br>  The screen, of course, is small, only three and a half inches.  Five-inch smartphones spoiled us, but you can play.  The text is read, even small.  I prefer HDMI. <br><br>  You can come to a friend, play, portability allows.  Related accessories: cables, cables, joysticks, charging take up more space than the console itself. <br><br><h3>  Sound </h3><br>  Unfortunately, the regular sound of the Raspberry Pi leaves much to be desired.  PWM modulation with passive filtering is applied as a sound system.  Therefore, a USB DAC for PCM2704 was purchased.  Mostly because of its size. <br><br>  There is a lack of sound output when playing on a small LCD screen, so a 3W microamplifier on the NS8002 was also bought and the speaker from the 8 Ohm tablet was picked up. <br><br><div class="spoiler">  <b class="spoiler_title">USB DAC and NS8002</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/-e/kz/cq/-ekzcqqsoepridapkfdlyqyosdy.jpeg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n3/fd/vl/n3fdvlnjxigbmpxkcrs7p_zf9a8.jpeg"></div><br></div></div><br>  All this will fit under the LCD screen.  Come, I will set. <br><br><h3>  Sawing Retropie </h3><br>  The build is over.  Below are some less interesting for entertaining reading features of the settings Retropie. <br><br><div class="spoiler">  <b class="spoiler_title">Shaders</b> <div class="spoiler_text">  Most consoles that Raspberry Pi is able to emulate have a resolution of 320x240 pixels.  By today's standards it is very small.  All games acquire pronounced pixelation on modern screens. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3w/-b/_5/3w-b_5-_zrprhg8fevmnljwfjhm.png"></div><br>  The creators of Retroarch, which is part of Retropie, have attended to this issue and added support for shaders.  For example, I really like the pre <i>-</i> installed <i>xbr-lv1-noblend.glslp</i> .  He literally pulls the details out of the picture.  See below. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v-/m9/ae/v-m9aedomgloew3mkbnrbaf52zo.png"></div>  <i>Screenshot from Castlevania: Symphony of the Night game, I advise you to play it</i> <br><br>  To install a shader, go to the menu Retropie -&gt; <i>Configuration editor</i> .  Select <i>Configure basic libretro emulator options</i> , then select <i>Configure default options for all libretro emulators</i> .  Then set the <i>Video Shader Enable</i> to ‚Äútrue‚Äù and the <i>Video Shader File</i> to the desired shader.  Also set <i>Video Smoth</i> to "false", as it only blur the picture.  You can even choose something like a scanline shader that emits CRT TVs.  But this is an amateur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b5/699/a6f/0b5699a6ffc3ebebf5d3d88f9583bab8.png"></div><br>  Shader rendering is a costly operation.  With a resolution equal to and above 720p, quite noticeable jams appear on the RPi 3B.  Therefore, in the same menu, select <i>Render resolution</i> "800x600".  Do not worry if you have made changes in the <i>/boot/config.txt</i> file, as in this article a little higher, then the screen resolution for the HDMI cable will be 1080p, but the emulator will render the image at 800x600 and stretch it to full screen.  And he does it not bad.  At least, with the shader is better than without it, and the render in 1080p is useless, because the video data of the game is still drawn for a resolution of 320x240. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Setting the joysticks</b> <div class="spoiler_text">  If you have any xinput gamepad (Micro $ oft standard), it will do.  It is configured at the first launch of Retropie, or via the start button - Configure Input.  But there is a headache.  Gone overseas guys, so as not to fall on patent lawsuits, swapped the buttons with A and B, X and Y. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/um/9l/eo/um9leos1thydayxdflxs3ty4cf0.jpeg"></div><br>  If you have a xbox or similar gamepad, then you need to configure it with inverted buttons, as in NES.  Then go to Retropie -&gt; <i>Retropie Setup</i> , select <i>Configuration / tools</i> , then <i>emulationstation</i> , put in <i>Swap A / B Buttons in ES</i> "Swapped".  Then reconfigure the joystick. <br><br>  Also, I do not like how the developers of Retropie disposed of a push-button fund.  Where is the combination of buttons to make a screenshot?  Why do I need the reset button if I hit it every time?  Where are the rewind and speed buttons? <br><br>  To fix this, you need to edit the file with the name of your joystick in <i>/ opt / retropie / configs / all / retroarch-joypads /</i> .  It is also available on the <i>\\ 192.168.x.xxx \ configs \ all \ retroarch-joypads \</i> network.  After each update of Retropie through the update, the numbering of the binding flies, so I will not upload the whole config.  I will write that changed only these buttons.  They are executed when pressed simultaneously with Hotkey, usually a button with a logo in the middle of the joystick. <br><br><div class="spoiler">  <b class="spoiler_title">Button config</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">input_screenshot_btn</span></span> = <span class="hljs-string"><span class="hljs-string">"0"</span></span> input_rewind_btn = <span class="hljs-string"><span class="hljs-string">"h0left"</span></span> input_hold_fast_forward_btn = <span class="hljs-string"><span class="hljs-string">"h0right"</span></span> input_state_slot_increase_btn = <span class="hljs-string"><span class="hljs-string">"h0up"</span></span> input_state_slot_decrease_btn = <span class="hljs-string"><span class="hljs-string">"h0down"</span></span></code> </pre> <br></div></div><br>  Here the screenshots button is assigned instead of reset.  Fast forvard and rewind (rewind) are configured on the cross buttons: forward and back.  The cross and up buttons change the save slot. <br><br>  Rewind must be enabled in the <i>/opt/retropie/configs/all/retroarch.cfg</i> config.  Just do not turn on Rewind on the psx emulator, everything starts to slow down wildly.  Rewind, by default, is disabled in the psx config. <br><br>  I also want to add about Bluetooth.  I myself do not like wireless joysticks and always play with the cable.  Old school yet.  For fans of wireless joysticks, you need to purchase a Bluetooth dongle and plug it into the USB port.  It will be better and there will be no problems.  I did not check it myself, but knowledgeable people write. <br><br><h3>  Xboxdrv </h3><br>  But that's not all.  In <i>Retropie Setup</i> , you can put various ports in the package manager, for example, Openttd, Doom, or even a DOS Dosbox emulator.  But to control the joystick in them will not work.  Only the keyboard and mouse.  To fix this, you need to install the xboxdrv driver in the package manager, which can emulate keyboard presses.  Just put from source, autorun does not need to do, it does not fit all joysticks. <br><br>  Launch the script we will write ourselves under our gamepad.  Add the following lines to <i>/opt/retropie/configs/all/runcommand-onstart.sh</i> at the end of the file. <br><br><div class="spoiler">  <b class="spoiler_title">runcommand-onstart.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># xboxdrv sudo killall &gt; /dev/null 2&gt;&amp;1 xboxdrv if [ "$1" = "pc" ] || [ "$1" = "openttd" ] || [ "$1" = "doom" ] || [ "$1" = "kodi" ]; then sudo /opt/retropie/supplementary/xboxdrv/bin/xboxdrv &gt; /dev/shm/runcommand.log 2&gt;&amp;1 \ --evdev /dev/input/event0 \ --silent \ --detach-kernel-driver \ --force-feedback \ --mimic-xpad \ --trigger-as-button \ --evdev-no-grab \ --evdev-absmap ABS_X=x1,ABS_Y=y1,ABS_RX=x2,ABS_RY=y2,ABS_HAT0X=dpad_x,ABS_HAT0Y=dpad_y \ --evdev-keymap KEY_#304=a,KEY_#305=b,KEY_#307=x,KEY_#308=y,KEY_#312=lt,KEY_#313=rt,KEY_#310=lb,KEY_#311=rb,KEY_#317=tl,KEY_#318=tr,KEY_#314=back,KEY_#315=start,KEY_#316=guide \ --axismap -Y1^deadzone:3000=Y1,-Y2^deadzone:3000=Y2 \ --ui-axismap x2^deadzone:3000=KEY_LEFT:KEY_RIGHT,y2=KEY_UP:KEY_DOWN \ --ui-axismap x1^deadzone:3000=REL_X:06,y1=REL_Y:06 \ --ui-axismap dpad_x^deadzone:0=KEY_LEFT:KEY_RIGHT,dpad_y^deadzone:0=KEY_UP:KEY_DOWN \ --ui-buttonmap rt=BTN_LEFT,lt=BTN_RIGHT,start=KEY_ENTER,back=KEY_ESC,tl=KEY_4,tr=KEY_5,lb=KEY_2,rb=KEY_3,a=KEY_SPACE,b=KEY_M,x=KEY_3,y=KEY_LEFTCTRL,guide=KEY_Y \ &amp; fi</span></span></code> </pre> <br></div></div><br>  Here, $ 1 is our target system, under which xboxdrv runs.  You can add by analogy.  The lines --evdev-absmap --evdev-keymap are responsible for linking axes and buttons to your joystick.  The script above is given for the Xbox One S controller. To find out which axis and button correspond to the number or name of your joystick, you need to type the command <i>evtest</i> in the console.  At the same time, you can see which event corresponds to our joystick.  I have this / dev / input / event0 which is in the parameter --evdev. <br><br>  Parameters --ui-axismap emulate mouse axes, and --ui-buttonmap keyboard buttons.  In this example, the trigger is the mouse button, the left stick is the mouse, the right stick is the cursor keys.  Start, select - enter and esc, respectively.  The rest of the buttons are attached keyboard numbers.  Unfortunately, it was not possible to engage the crosspiece under the keyboard buttons.  For some reason, the Xbox One S joystick refuses to work. <br><br>  With such a config, strategies are perfectly played, like Theme Hospital, OpenTTD, etc. Shooters are played a little worse, but you can create similar launch scripts for shooters in the same file, changing the $ 1 parameter there. <br><br>  To ensure the normal operation of the joystick in the emulationstation, you must complete the xboxdrv after exiting the game.  To do this, add the following to the end of the <i>/opt/retropie/configs/all/runcommand-onend.sh</i> file. <br><br><div class="spoiler">  <b class="spoiler_title">runcommand-onend.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs">sudo killall &gt; /dev/null 2&gt;&amp;1 xboxdrv</code> </pre> <br></div></div><br></div></div><br><div class="spoiler">  <b class="spoiler_title">If something went wrong when updating Retropie</b> <div class="spoiler_text">  Once, I launched the Retropie update and when unpacking the kernel, the built-in Wi-Fi fell off.  The device was loading, but did not respond to any buttons, including on the connected keyboard.  There is no SSH, since there is no Wi-Fi, it does not respond to the keyboard, and the SD card is not accessible ... <br><br>  I noticed that the keyboard works when loading.  Pressed ctrl + c many times and, oh, the console!  But now how to restore Wi-Fi?  The wlan0 interface was absent from the word at all.  Running the update did not help, because it pulls files from the Internet. <br><br>  First of all, in /opt/retropie/configs/all/autostart.sh commented out the start of the emulationstation and rebooted.  After the restart, the console is loaded, the keyboard is working.  ,   wlan   .     . . <br><br><pre> <code class="bash hljs">sudo dpkg --configure -a</code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To make Retropie not look like a Linux station</font></font></b> <div class="spoiler_text">           Linux.      . <br><br><div class="spoiler"> <b class="spoiler_title">    Linux</b> <div class="spoiler_text">     Linux,    <i>/boot/cmdline.txt</i>   .    . <br><br><div class="spoiler"> <b class="spoiler_title">cmdline.txt</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">dwc_otg.lpm_enable=<span class="hljs-number"><span class="hljs-number">0</span></span> console=tty3 root=PARTUUID=f2d3cb4f<span class="hljs-number"><span class="hljs-number">-02</span></span> rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait loglevel=<span class="hljs-number"><span class="hljs-number">3</span></span> consoleblank=<span class="hljs-number"><span class="hljs-number">0</span></span> plymouth.<span class="hljs-keyword"><span class="hljs-keyword">enable</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> quiet vt.global_cursor_default=<span class="hljs-number"><span class="hljs-number">0</span></span> plymouth.<span class="hljs-keyword"><span class="hljs-keyword">enable</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> plymouth.ignore-<span class="hljs-type"><span class="hljs-type">serial</span></span>-consoles splash</code> </pre> <br></div></div><br> ,   ,     ,   . <br>      motd. <br><br><pre> <code class="bash hljs">nano /etc/motd</code> </pre> <br>   . <br><br><pre> <code class="bash hljs">sudo nano /etc/systemd/system/autologin@.service</code> </pre> <br>       <br><br><pre> <code class="hljs matlab">ExecStart=-/sbin/agetty --autologin <span class="hljs-built_in"><span class="hljs-built_in">pi</span></span> --noclear <span class="hljs-comment"><span class="hljs-comment">%I $TERM</span></span></code> </pre> <br>  On <br><br><pre> <code class="hljs perl">ExecStart=-<span class="hljs-regexp"><span class="hljs-regexp">/sbin/agetty</span></span> --skip-login --noclear --noissue --login-options <span class="hljs-string"><span class="hljs-string">"-f pi"</span></span> %I $TERM</code> </pre> <br>      <a href="https://retropie.org.uk/docs/FAQ/"></a> . <br></div></div><br> ,        ‚Äî splashscreen.   ,       .         \\192.168.x.xxx\splashscreens,      Retropie -&gt; <i>SPLASH SCREEN</i> -&gt; <i>Append Splashscreen to list</i> . <br><br> , ,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/er/n9/g6/ern9g6nb3z_5vcr5-3ussmqlk74.jpeg"></div><br>   Retropie  runcommand,           .         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fm/lk/9u/fmlk9ukwossgbtgjbpfvuy5lza4.png"></div><br>  ,   ,  <a href="https://retropie.org.uk/forum/topic/4611/runcommand-system-splashscreens"></a> . <br></div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What else can you do </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Improve can be infinite. </font><font style="vertical-align: inherit;">I will give a couple of links that you can do. </font><font style="vertical-align: inherit;">Write more interesting things to add.</font></font> Thanks for attention. <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install </font></font><a href="https://retropie.org.uk/docs/PC/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dosbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and various </font></font><a href="https://retropie.org.uk/docs/Ports/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ports</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li> <a href="https://retropie.org.uk/docs/Themes/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Put different themes emulationstation.</font></font></a> </li><li> <a href="https://raspberrypihq.com/how-to-share-a-folder-with-a-windows-computer-from-a-raspberry-pi/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Share the screenshots folder.</font></font></a> </li><li> <a href="https://github.com/zerojay/RetroPie-Extra"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install a web browser.</font></font></a> </li><li> <a href="https://www.youtube.com/watch%3Fv%3DDgQDg6SzBDg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install Retropie Web Manager</font></font></a> </li><li> <a href="https://www.youtube.com/watch%3Fv%3DxK5Nqsl6R1Q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link Raspberry Pi with the main computer Steam.</font></font></a> </li><li> <a href="https://www.youtube.com/watch%3Fv%3DzphvglmW0NQ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install Brutal Doom, finally.</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> He is worth it. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/iZ9WrEzyq3o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/422005/">https://habr.com/ru/post/422005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421991/index.html">Hosting a web application on Amazon Web Services. Cheap. Is it possible?</a></li>
<li><a href="../421993/index.html">Python interesting and useful</a></li>
<li><a href="../421995/index.html">Differences Between Website Compilation and Web Application</a></li>
<li><a href="../422001/index.html">CO2 measurement device</a></li>
<li><a href="../422003/index.html">Fixed and variable costs in software development</a></li>
<li><a href="../422007/index.html">How I did a line-interactive UPS (Part 1)</a></li>
<li><a href="../422009/index.html">Hungarian algorithm, or how mathematics helps in assigning assignments</a></li>
<li><a href="../422011/index.html">Tournament of young physicists</a></li>
<li><a href="../422013/index.html">Microsoft glasses track blood pressure</a></li>
<li><a href="../422015/index.html">Artificial Intelligence - Evolution from Applied Instrument to Personality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>