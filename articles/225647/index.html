<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IText: we take out the text from PDF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day, habrovchane! 

 Recently I faced the challenge: learn to pull text from a PDF by memorizing its position on the page. And, of course...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IText: we take out the text from PDF</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b36/dc3/f85/b36dc3f854fba76c268dd1e6de706422.jpg" alt="image" align="left"><br><br>  Good time of day, habrovchane! <br><br>  Recently I faced the challenge: learn to pull text from a PDF by memorizing its position on the page.  And, of course, in the simple task at first, the pitfalls came out.  How did you finally solve this?  The answer is under the cut. <br><a name="habracut"></a><br><h5>  A bit about PDF format </h5><br>  PDF (Portable Document Format) is a popular cross-platform document format using PostScript.  Its main purpose is to correctly display it on various operating systems, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first idea was simply to <s>invent the bicycle</s> itself, namely, to open the pdf and pull the text out.  And, trying to do this, I realized that inside the pdf is not very nicely arranged and revealed several facts that seriously complicate the task: <br><ul><li>  words can be illogically broken into pieces.  For example, the display of the word ‚Äúalgorithms‚Äù is written, roughly speaking, in three parts: display ‚Äúal‚Äù ‚Äúorit‚Äù ‚Äúwe‚Äù </li><li>  the lines in the text and the words in the lines may not appear in the order we used to read </li><li>  in some documents, spaces are set explicitly (i.e. there are commands containing ''), in others - they are formed by the fact that adjacent words are displayed from each other at some distance </li></ul><br><br>  Because the desire to parse pdf yourself disappeared instantly. <br>  ps from all this involuntarily remembered quote <blockquote>  Those who love sausage and respect the law, it‚Äôs better not to see how both are done </blockquote><br>  Then, having played with several libraries (pdfminer, pdfbox), I decided to stop at iText. <br><br><h5>  A little about iText </h5><br>  iText: a Java library designed to work with pdf (there is also a version in C #: iTextSharp).  Starting from version 5.0.0, it is freely distributed under the AGPL license (obliging to provide users with the ability to get the source code), but there is also a commercial version.  Stocked with good documentation.  And for those who want to familiarize themselves with the library in a better way, I advise a book from the creator of the library ‚ÄúiText in Action‚Äù. <br><br><h5>  Easy way to pull text from PDF </h5><br>  This code well extracts text from PDF, but does not provide any information about its location in the document. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleTextExtractor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,      -   PdfReader reader = new PdfReader(args[0]); //  ,     PDF   . for (int i = 1; i &lt;= reader.getNumberOfPages(); ++i) { TextExtractionStrategy strategy = new SimpleTextExtractionStrategy(); String text = PdfTextExtractor.getTextFromPage(reader, i, strategy); System.out.println(text); } //    reader.close(); } }</span></span></code> </pre> <br><br>  And now let's look at everything in order. <br><br>  <b>PdfReader</b> is a class that reads PDF.  It can be constructed not only from the file name, but also from the InputStream, Url or RandomAccessFileOrArray. <br><br>  <b>TextExtractionStrategy</b> is an interface that defines a text extraction strategy.  More about him - below. <br><br>  <b>SimpleTextExtractionStrategy</b> is a class that implements TextExtractionStrategy.  Despite the title, very nicely pulls text out of PDF (copes with the changeable structure of PDF, that is, if the text first comes in two columns, and then switches to normal writing in the entire page. <br><br>  <b>PdfTextExtractor</b> - a static class that contains only 2 getTextFromPage methods with one difference - are we indicating the text extraction strategy explicitly or not. <br><br><h5>  We take out the text, remembering the coordinates </h5><br>  To do this, we need to pay attention to the <b>TextExtractionStrategy</b> interface.  Namely, these two functions: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TextRenderInfo renderInfo)</span></span></span></span></code> </pre>  - when calling getTextFromPage, this function is called with every command that displays text.  TextRenderInfo stores all the necessary information: text, font, coordinates. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> string </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetResultantText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code> </pre>  - this function is called before the end of getTextFromPage and its result will be returned to the user. <br><br>  As a sample, let's learn to pull out in the simplest way pairs of the form &lt;y-coordinate of the line, text of the line&gt; for each line on the page. <br><br>  Interface implementation: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextExtractionStrategyImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextExtractionStrategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TreeMap&lt;Float, TreeMap&lt;Float, String&gt;&gt; textMap; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextExtractionStrategyImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// reverseOrder     y      textMap = new TreeMap&lt;Float, TreeMap&lt;Float, String&gt;&gt;(Collections.reverseOrder()); } @Override public String getResultantText() { StringBuilder stringBuilder = new StringBuilder(); //    for (Map.Entry&lt;Float, TreeMap&lt;Float, String&gt;&gt; stringMap: textMap.entrySet()) { //      for (Map.Entry&lt;Float, String&gt; entry: stringMap.getValue().entrySet()) { stringBuilder.append(entry.getValue()); } stringBuilder.append('\n'); } return stringBuilder.toString(); } @Override public void beginTextBlock() {} @Override public void renderText(TextRenderInfo renderInfo) { //   Float x = renderInfo.getBaseline().getStartPoint().get(Vector.I1); Float y = renderInfo.getBaseline().getStartPoint().get(Vector.I2); //           . if (!textMap.containsKey(y)) { textMap.put(y, new TreeMap&lt;Float, String&gt;()); } textMap.get(y).put(x, renderInfo.getText()); } @Override public void endTextBlock() {} @Override public void renderImage(ImageRenderInfo imageRenderInfo) {} //       y- ArrayList&lt;Pair&lt;Float, String&gt;&gt; getStringsWithCoordinates() { ArrayList&lt;Pair&lt;Float, String&gt;&gt; result = new ArrayList&lt;Pair&lt;Float, String&gt;&gt;(); for (Map.Entry&lt;Float, TreeMap&lt;Float, String&gt;&gt; stringMap: textMap.entrySet()) { StringBuilder stringBuilder = new StringBuilder(); for (Map.Entry&lt;Float, String&gt; entry: stringMap.getValue().entrySet()) { stringBuilder.append(entry.getValue()); } result.add(new Pair&lt;Float, String&gt;(stringMap.getKey(), stringBuilder.toString())); } return result; } }</span></span></code> </pre><br><br>  And the main code looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextExtractor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ PdfReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PdfReader(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= reader.getNumberOfPages(); ++i) { TextExtractionStrategyImpl strategy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextExtractionStrategyImpl(); <span class="hljs-comment"><span class="hljs-comment">// ,           PdfTextExtractor.getTextFromPage(reader, i, strategy); System.out.println("Page : " + i); for (Pair&lt;Float, String&gt; pair: strategy.getStringsWithCoordinates()) { System.out.println(pair.getKey().toString() + " " + pair.getValue()); } } reader.close(); } }</span></span></code> </pre><br><br><h5>  Notes </h5><br>  Of course, for good text extraction, you need to add all sorts of chips for correct processing of text in several columns, processing spaces that are not explicitly given, etc., but I don‚Äôt want to delve into such details within this article. <br><br>  And I would also like to note that this is only a small part of the library‚Äôs possibilities.  With it, you can create documents, add text and images to existing ones (including watermarks). <br><br>  And the link to the <a href="https://github.com/FedyuninV/itext-fun">repository</a> (oh, this AGPL) </div><p>Source: <a href="https://habr.com/ru/post/225647/">https://habr.com/ru/post/225647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225637/index.html">Ideas underlying responsive emails</a></li>
<li><a href="../225639/index.html">Mikrotik and GNS3</a></li>
<li><a href="../225641/index.html">New Optional class in Java 8, not a panacea for NullPointerException</a></li>
<li><a href="../225643/index.html">Antenna for Wi-Fi on your knee in 10 minutes</a></li>
<li><a href="../225645/index.html">Development of Iframe applications on VK API. From the first cones to the two millionth audience</a></li>
<li><a href="../225649/index.html">Creating a custom component based on a ListView</a></li>
<li><a href="../225651/index.html">How to teach a player to understand your application, not nullifying the work of artists, not offending programmers and not considering players mentally retarded</a></li>
<li><a href="../225653/index.html">MIDI Wavy: make controlled color music using Arduino and MIDI</a></li>
<li><a href="../225655/index.html">Syncthing sync + installer review on Raspberry Pi and Macbook</a></li>
<li><a href="../225657/index.html">How to legalize income from Google AdSense for PI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>