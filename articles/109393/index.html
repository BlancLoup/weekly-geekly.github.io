<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>QHessian: Qt & Hessian</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article covers the implementation of the Hessian binary web protocol on the Qt library stack. Target platform C ++. 



 Hessian is a binary web p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>QHessian: Qt & Hessian</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/354/c3b/f71/354c3bf7179b263b23a8a371f76f79b8.jpg" alt="image" align="left"><br>  The article covers the implementation of the Hessian binary web protocol on the Qt library stack.  Target platform C ++. <br><br><a name="habracut"></a><br><br>  <b>Hessian</b> is a binary web protocol designed to create useful web services (to put it simply, this thing will let you know what the weather is like outside the window from any of your applications).  Hessian was developed by Caucho Technology, Inc.  The company also developed protocol implementations for Java, Python, and ActionScript.  Third-party companies have developed implementations for almost all programming languages ‚Äã‚Äã(C ++, C #, Perl, PHP, Ruby, Objective-C, D, Erlang). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Imagine that we have a basket of apples on the server.  And we want, at the request of the client, to give him an apple.  This is where hessian will help us. <br><br>  On the server, we create a service interface (server in Java): <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> FruitService { <br> Apple   getNextApple(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  We create a similar class on the client (C ++): <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> FruitService { <br> <font color="#0000ff">public</font> : <br> Apple   getNextApple(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  When the getNextApple () method is called on the client, the hessian implementation makes a request to the server (to a similar server method) and returns the result to the client.  Hessian undertakes to deliver apples to us through the net.  In fact, it serializes the data on the server and deserializes it on the client.  Turning an apple into an array of bytes, transferring it over the network and restoring an apple from an array is the hessian task.  The rest is your task. <br><br>  <b>Qt</b> <br>  Qt as a framework is widely known and hardly needs any introduction.  I will only note that it will be a question of implementing the Hessian protocol for Qt C ++. <br><br>  In general, there are several implementations (I managed to find 2) of the protocol under C ++: <ul><li>  <a href="http://sourceforge.net/projects/hessiancpp/">hessian cpp</a> </li><li>  <a href="http://code.google.com/p/hessianorb/">hessianorb</a> </li></ul>  Hessian cpp and hessianorb are great projects and they are quite functional.  Initially, for my development I used hessianorb - it supports code generation, i.e.  allows you to create a C ++ proxy for all your services with one team (after two hours of preparation). <br><br>  Unfortunately, both implementations force you to create code that looks foreign in the Qt environment.  They require an additional library stack: hessian cpp - SSLPP, hessianorb - CURL.  This fact, of course, complicates cross-platform development.  Obviously, these libraries are needed for network data transfer, but Qt has its own layer for working with the network and I wanted to use it.  In addition, both implementations block the thread of execution when interacting with the server, while the Qt network layer is asynchronous. <br><br>  <b>Thus</b> , my goal was to create a protocol implementation based on the use of <a href="http://doc.qt.nokia.com/4.7-snapshot/qnetworkaccessmanager.html">QNetworkAccessManager</a> and its asynchronous nature. <br><br>  <b>QHessian</b> <br><br>  QHessian (hereinafter referred to as qh) is an implementation of the hessian protocol that does not use third-party libraries.  In other words, a stack of Qt libraries is sufficient for working with this implementation. <br><br>  As I mentioned earlier, the hessian task is to serialize, network, and deserialize data.  The QNetworkAccessManager takes over the full network transmission.  Serialization and deserialization of data is carried out according to the <a href="http://hessian.caucho.com/doc/hessian-serialization.html">Hessian 2.0 Serialization Protocol</a> document.  The document states that the implementation of the protocol should be able to: <ul><li>  read / write raw binary data </li><li>  read / write boolean </li><li>  read / write 64-bit millisecond date </li><li>  read / write 64-bit double </li><li>  read / write 32-bit int </li><li>  read / write 64-bit long </li><li>  read / write null </li><li>  read / write UTF8-encoded string </li><li>  read / write lists and arrays </li><li>  read / write maps and dictionaries </li><li>  read / write objects </li><li>  read / write ref for shared and circular object references </li><li>  read / write object / list reference map </li><li>  read / write class definition reference map </li><li>  read / write type (class name) reference map </li></ul>  To implement this requirement, qh uses its own type hierarchy: <ul><li>  <b>Null</b> read / write null values </li><li>  <b>Boolean</b> read / write bool </li><li>  <b>Integer</b> read / write 32-bit number (qint32) </li><li>  <b>Long</b> read / write 64-bit number (qint64) </li><li>  <b>Double</b> read / write non-integer 64-bit IEEE 754 (qreal) </li><li>  <b>String</b> read / write UTF-8 string (QString) </li><li>  <b>DateTime</b> read / write date (QDateTime) </li><li>  <b>Binary</b> read / write byte array (QByteArray) </li><li>  <b>BeginCollection</b> read / zapis start collection </li><li>  <b>EndCollection</b> read / write end of collection </li><li>  <b>BeginMap</b> read / write start map </li><li>  <b>HasMoreMap is</b> read only - check end of map </li><li>  <b>Endmap</b> read / write end map </li><li>  <b>BeginObject</b> read / write object start </li><li>  <b>EndObject</b> read / write end of object </li><li>  <b>Ref</b> read / write object reference </li></ul>  The mechanisms for working with qh copy mechanisms for working with standard input / output streams.  Those.  reading is carried out using the operator ‚Äú <b>&gt;&gt;</b> ‚Äù, and writing, respectively, using the operator ‚Äú <b>&lt;&lt;</b> ‚Äù.  Reading is from a special object QHessianReturnParser (server response parser).  And the record is in the QHessianMethodCall object (preparing the data for sending to the server). <br><br>  For example, to call the sample method of the server (Integer, String, Date) you need to run the code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">{ <br> <font color="#0000ff">using</font> <font color="#0000ff">namespace</font> QHessian:: <font color="#0000ff">in</font> ; <br> QHessian::QHessianMethodCall call( <font color="#A31515">"sample"</font> ); <br> call &lt;&lt; Long(55) &lt;&lt; <font color="#2B91AF">String</font> (‚Äú‚Äù) &lt;&lt; <font color="#2B91AF">DateTime</font> (QDateTime::currentDateTime ()); <br> call.invoke(networkManager, <br> QUrl(‚Äúhttp: <font color="#008000">//serviceUrl‚Äù), //  </font> <br> myQObject, <font color="#008000">// QObject,    </font> <br> SLOT(reply()), <font color="#008000">//    </font> <br> SLOT(error( <font color="#0000ff">int</font> , <font color="#0000ff">const</font> QString&amp;))); <font color="#008000">//    </font> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  This code will call the sample method with parameters 55, Vasily, current time.  The server response will be processed in the reply () slot of the myQObject object, or, if an error occurs, in the error slot of the myQObject object.  Let me remind you that the call is not blocking, i.e.  no need to steam with multithreading. <br><br>  Imagine that our service simply returns the data passed to it in the com.googlecode.AnswerObject object.  Then the reply response in the reply slot will be: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">void</font> MyQObject::reply() { <br> <font color="#0000ff">using</font> <font color="#0000ff">namespace</font> QHessian:: <font color="#0000ff">out</font> ; <br> <br> qint32 <font color="#0000ff">long</font> ; <br> QString <font color="#0000ff">string</font> ; <br> QDateTime  dateTime; <br> <br> QHessian::QHessianReturnParser&amp; parser = <br> *(QHessian::QHessianReturnParser*) QObject::sender(); <br> <br> parser &gt;&gt; BeginObject(‚Äúcom.googlecode.AnswerObject‚Äù) <br> &gt;&gt; Long( <font color="#0000ff">long</font> ) <br> &gt;&gt; <font color="#2B91AF">String</font> ( <font color="#2B91AF">String</font> ) <br> &gt;&gt; <font color="#2B91AF">DateTime</font> (dateTime) <br> &gt;&gt; EndObject(); <br> <br> parser.deleteLater(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  After execution, long will take the value 55, string - Vasily, dateTime - transmitted time. <br><br>  QHessian supports collections (arrays, lists, associative arrays, etc.). <br>  This could be the reading of the Polygon class from the server response: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">{ <br> <font color="#0000ff">using</font> <font color="#0000ff">namespace</font> QHessian:: <font color="#0000ff">out</font> ; <br> <br> QHessian::QHessianReturnParser&amp; parser = <br> *(QHessian::QHessianReturnParser*) QObject::sender(); <br> <br> qint32 pointCount; <br> <br> parser &gt;&gt; BeginObject( <font color="#A31515">"Polygon"</font> ); <br> parser &gt;&gt; BeginCollection(‚Äúpoints‚Äù, pointCount); <br> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i=0; i&lt;pointCount; ++i) { <br> qint32 x, y; <br> parser &gt;&gt; Integer(x) &gt;&gt; Integer(y); <br> } <br> <br> parser &gt;&gt; EndCollection(); <br> parser &gt;&gt; EndObject(); <br> parser.deleteLater(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  In this code: <ul><li>  <b>BeginObject ("Polygon");</b>  - open an object with the Polygon class; </li><li>  <b>BeginCollection (‚Äúpoints‚Äù, pointCount);</b>  - open the collection and put its length in pointCount; </li><li>  In the for loop, we read the positions of the points; </li><li>  <b>EndCollection ();</b>  - close the collection; </li><li>  <b>EndObject ();</b>  - close the object. </li></ul>  It is also possible that we do not know the type of the object, for example, the server returns an untyped List &lt;?  extends geometry&gt;.  In this case, you need to use a special peek () method, which determines whether it is possible to perform the desired read operation from the stream (an example is on the project website). <br><br>  <b>findings</b> <br>  I think that it turned out to be a completely suitable implementation of the protocol, which can be used in real applications. <br><br>  The advantages include: <ul><li>  Fully based on Qt, i.e.  No need to connect third-party libraries. </li><li>  Asynchronous nature. </li><li>  It does not require recreating the full server object model in the client application (i.e., read only what you need). </li><li>  Tested - passes all tests proposed by Caucho Technology, Inc.  plus your own stack of tests. </li><li>  Easy to use (I think). </li></ul>  By cons: <ul><li>  In qh there is no code generation.  Experience with hessianorb convinced me that code generation is not as useful as it seems.  Firstly: the environment often changes and you have to constantly perform code generation, which is not as easy to do in hessianorb as we would like;  and secondly: there is a lot of unnecessary unnecessary code (the entire object model is generated, but it is often not needed).  However, qh turned out to be quite low-level and, with a strong desire, it is possible to develop a mechanism for code generation. </li><li>  You need to know the structure of the server response. </li></ul>  References: <br>  Hessian: <a href="http://hessian.caucho.com/">http://hessian.caucho.com</a> <br>  QHessian: <a href="http://code.google.com/p/qhessian/">http://code.google.com/p/qhessian</a> <br>  QHessian FAQ: <a href="http://code.google.com/p/qhessian/wiki/FAQ">http://code.google.com/p/qhessian/wiki/FAQ</a> <br>  QHessian QA: <a href="http://code.google.com/p/qhessian/wiki/QHessian_QA">http://code.google.com/p/qhessian/wiki/QHessian_QA</a> <br><br>  Thank. <br><br>  == <br>  Thanks to Sergey Bizin for his help in developing the project and writing the article. <br><br>  UPD: <a href="http://caiiiycuk.info/qhessian-qt-hessian/">Blog</a> </div><p>Source: <a href="https://habr.com/ru/post/109393/">https://habr.com/ru/post/109393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109386/index.html">How to facilitate the work in the terminal for beginners? Answer - CLI Companion!</a></li>
<li><a href="../109387/index.html">Rendering of pictures through WPF on the example of Pivot</a></li>
<li><a href="../109389/index.html">Improving the lives of users with IPv6 and SCTP</a></li>
<li><a href="../109391/index.html">Dropbox 1.0.10 - Selective Sync and more</a></li>
<li><a href="../109392/index.html">Linux basics from the founder of Gentoo. Part 3 (2/4): Permissions Model</a></li>
<li><a href="../109394/index.html">Flags / proc / cpuinfo for x86 architecture</a></li>
<li><a href="../109395/index.html">UART and what it eats</a></li>
<li><a href="../109396/index.html">Dmitry Sklyarov cracked digital signature in Canon cameras</a></li>
<li><a href="../109398/index.html">The Men Who Stole the World (translation of the article)</a></li>
<li><a href="../109402/index.html">Phylo: an online game that helps genetic research</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>