<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About the feasibility of Selenium WebDriverWait</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The closer I get to know Selenium WebDriver, the more questions arise for me why this or that functional is executed in one way or another. In his spe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About the feasibility of Selenium WebDriverWait</h1><div class="post__text post__text-html js-mediator-article">  The closer I get to know Selenium WebDriver, the more questions arise for me why this or that functional is executed in one way or another.  In his speech, <a href="https://www.youtube.com/watch%3Fv%3DhjSu37gBSH4">"Zamorochki in Selenium WebDriver"</a> Alexey Barantsev sheds light on the subtleties of the implementation of this automation tool and distinguishes between "bugs" and "features".  In the video you will find a lot of interesting things, but still some moments remain (at least for me) in the shadows. <br><br>  In this article I want to discuss the frequently used tool to wait for an event on a page, implemented using the <a href="">WebDriverWait</a> class and its main <a href="">Until</a> method.  I wonder if WebDriverWait is needed at all, and can it be abandoned? <br><br>  Reflections will be presented in the context of C #, although I do not think that the logic of the implementation of this class will be any different for other programming languages. <br><a name="habracut"></a><br>  When creating an instance of WebDriverWait, a driver instance is passed to the constructor, which is stored in the internal <a href="">input</a> field.  The Until method assumes a delegate whose input parameter should be an IWebDriver, an instance of which is input. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's look at the source code for the <a href="">Until</a> method.  The backbone of its logic is an infinite loop with two conditions for exit from it: the occurrence of the desired event or timeout.  Additional ‚Äúbuns‚Äù are ignoring the predefined exceptions and returning the object, if the booster is not a TResult (more on this later). <br><br>  The first restriction that I see is that we always need an instance of IWebDriver, although inside the Until method (to be exact, then as an input parameter for the condition) we could easily do ISearchContext.  Indeed, in most cases we expect some element or change its properties and use FindElement (s) to find it. <br><br>  I would venture to say that using the ISearchContext would be even more logical, because the client code (class) is not just a page object, which in the search for child elements is pushed away from the page root.  Sometimes it is a class that describes a certain constituent element whose root is a different element of the page, and not the page itself.  One such example is <a href="">SelectElement</a> , which accepts a reference to the parent IWebElement in the constructor. <br><br>  Let's return to the question of initializing WebDriverWait.  This action requires a driver instance.  Those.  we always, in one way or another, need to forward an instance of IWebDriver to the client code, even if it is a class of a certain composite element (an example about SelectElement) that already accepts the "parent".  From my point of view, this is unnecessary. <br><br>  Of course, we can declare a class by analogy. <pre><code class="cs hljs">SearchContextWait : DefaultWait&lt;ISearchContext&gt;</code> </pre>  But let's not rush.  We do not need it. <br><br>  Let's see how the instance passed to the condition is used.  Usually it looks something like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebDriverWait(Driver, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">10</span></span>)); wait.Until( d =&gt; d.FindElements(By.XPath(<span class="hljs-string"><span class="hljs-string">"locator"</span></span>)).Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> );</code> </pre> <br>  The question arises, why does the condition need a ‚Äúlocal‚Äù version of the driver if it is always available from the client code?  Moreover, it is the same instance passed earlier through the constructor.  Those.  The code might look something like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebDriverWait(Driver, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">10</span></span>)); wait.Until( d =&gt; Driver.FindElements(By.XPath(<span class="hljs-string"><span class="hljs-string">"locator"</span></span>)).Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> );</code> </pre> <br>  Even Simon Stewart uses this approach in his <a href="https://youtu.be/y1pSkqIJvAw%3Ft%3D759">speech</a> . <br><br><img src="https://habrastorage.org/webt/9n/vz/u1/9nvzu1ywzvmgpmvqmicf4hekvhu.jpeg" alt="image"><br><br>  He does not write "d -&gt; d.", But writes "d -&gt; driver.", I.e.  the driver instance passed to the method is simply ignored.  But it is necessary to transmit it, because the signature of the method requires it! <br><br>  Why pass the driver inside the condition method?  Perhaps to isolate the search inside this method, as implemented in <a href="">ExpectedConditions</a> ?  Look at the implementation of the <a href="">TextToBePresentInElement</a> method.  Or <a href="">VisibilityOfAllElementsLocatedBy</a> .  Or <a href="">TextToBePresentInElementValue</a> .  In them, the transmitted driver is not even used! <br><br>  So the first thought is that we don‚Äôt need a Until method with a delegate parameter that accepts a driver. <br><br>  Let's now figure out whether the until method needs a return value?  If bool is used as a TResult, then no, it is not necessary.  After all <a href="">, if successful,</a> you get true, and <a href="">in case of failure,</a> you get a TimeoutException.  What is the informativeness of this behavior? <br><br>  And if object acts as TResult?  Suppose this construction: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebDriverWait(Driver, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">10</span></span>)); wait.IgnoreExceptionTypes(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(NoSuchElementException)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> element = wait.Until(d =&gt; d.FindElement(By.XPath(<span class="hljs-string"><span class="hljs-string">"locator"</span></span>)));</code> </pre> <br>  Those.  we are not only waiting for the element to appear, but also use it (if waited), thereby removing one extra reference to the DOM.  Good. <br><br>  Let's take a closer look at these three lines of code.  Inside the implementation of the until method, this boils down to a certain similarity (conditional code) <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { FindElement } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchElementException) {}</code> </pre> <br>  Those.  An exception will be generated each time until the element appears in the DOM.  Since the exception generation is a rather expensive event, I would prefer to avoid it, especially in those places where it is not difficult.  We can rewrite the code as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebDriverWait(Driver, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">10</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = wait.Until(d =&gt; d.FindElements(By.XPath(<span class="hljs-string"><span class="hljs-string">"locator"</span></span>)));</code> </pre> <br>  Those.  we use FindElements, which does not generate an exception.  Wait, will this structure wait for the elements to appear?  NOT!  Because, if you look at the <a href="">source code</a> , the execution of an infinite loop terminates as soon as condition returns non-null.  And FindElements returns an empty collection in case of failure, but not null.  Those.  for a list of items, using Until does not make sense. <br><br>  Well, the list is clear.  But still, how to return the found element and not generate an exception?  The code might look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebDriverWait(Driver, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">10</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> element = wait.Until(d =&gt; d.FindElements(By.XPath(<span class="hljs-string"><span class="hljs-string">"locator"</span></span>)).FirstOrDefault());</code> </pre> <br>  In this case, at each iteration of the loop, we will not just get the list of IWebElement (which may be empty), but also try to extract the first element from it.  If the elements are still not displayed on the page, we get a null (default value for object) and proceed to the next iteration of the loop.  If the element is found, we will exit the method and the element variable will be initialized with the return value. <br><br>  And yet, the second thought - the return value of the Until method is not used in most cases. <br><br>  The transferred value is unnecessary, the return value is not used.  What is the utility Until?  Only in a cycle and periodicity of a call of a condition method?  This approach is already implemented in C # in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.spinwait.spinuntil%3Fview%3Dnetframework-4.7.2">SpinWait.SpinUntil</a> method.  Its only difference is that it does not generate an timeout exception.  This can be corrected as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; condition, TimeSpan timeout</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> waited = SpinWait.SpinUntil(condition, timeout); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!waited) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeoutException(); } }</code> </pre> <br>  Those.  these few lines of code in most cases replace the logic of the whole WebDriverWait class.  Are the results worth the effort? <br><br>  <b>Update</b> <br><br>  In the comments to the article, the <a href="https://habr.com/ru/users/ksa/" class="user_link">KSA</a> user made a sensible comment about the difference between SpinUntil and Until in terms of the frequency of the condition.  For WebDriverWait, this <a href="">value is adjustable</a> and defaults to 500 milliseconds.  Those.  In the Until method, there is a delay between iterations of the loop.  While for SpinUntil, the <a href="https://referencesource.microsoft.com/">logic is</a> slightly complicated and often the wait does not exceed 1 millisecond. <br><br>  In practice, this results in a situation when, while waiting for an element appearing within 2 seconds, the Unitl method performs 4 iterations, and the SpinUntil method performs about 200 or more. <br><br>  Let's discard SpinUntil and rewrite the Wait method as follows. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; condition, TimeSpan timeout, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> evaluatedInterval = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">500</span></span></span></span></span><span class="hljs-function">)</span></span> { Stopwatch sw = Stopwatch.StartNew(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (sw.Elapsed &lt; timeout) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (condition()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Thread.Sleep(evaluatedInterval); } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeoutException(); }</code> </pre> <br><br>  We added a few lines of code, and at the same time got closer to the logic of the Until method. <br><cut></cut></div><p>Source: <a href="https://habr.com/ru/post/443754/">https://habr.com/ru/post/443754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443736/index.html">Setting up from scratch the Network UPS Tools UPS Management Service (NUT) to manage a locally connected UPS</a></li>
<li><a href="../443740/index.html">The first release of an open source product test testing tool.</a></li>
<li><a href="../443746/index.html">The gaming market, trends and forecasts - a great analytics from App Annie</a></li>
<li><a href="../443748/index.html">Presentation of Tesla Model Y - what to expect and where to look</a></li>
<li><a href="../443752/index.html">Kotlin as the future of Android application development</a></li>
<li><a href="../443756/index.html">Design classes: what is good?</a></li>
<li><a href="../443762/index.html">Using inheritance when generating web pages in pure javascript</a></li>
<li><a href="../443764/index.html">What the designer smoked: an unusual firearm</a></li>
<li><a href="../443766/index.html">We try contract programming With ++ 20 already now</a></li>
<li><a href="../443768/index.html">Monolith for hundreds of client versions: how we write and support tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>