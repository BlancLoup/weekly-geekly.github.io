<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of ASP.NET MVC 3 applications with Facebook OAuth API. Part 1: Authorization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why do you need authorization on your site through Facebook ? 
 At the moment, the social networking site Facebook has over 500 million users. Many si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of ASP.NET MVC 3 applications with Facebook OAuth API. Part 1: Authorization</h1><div class="post__text post__text-html js-mediator-article"> Why do you need authorization on your site through <a href="http://facebook.com/">Facebook</a> ? <br>  At the moment, the social networking site Facebook has over 500 million users.  Many sites provide an opportunity to log in without additional registration, where you need to fill in many fields of information about yourself.  If you have an account on Facebook, then you just need to login to the site using it.  This saves time, because registration often requires spending 5-10 minutes. <br><br>  If you implement authorization through Facebook, you will most likely be able to get more users on the site, because not everyone wants to go through the registration stage for the sake of writing a few comments. <br><br>  So let's get started ... <br><a name="habracut"></a><br>  Before creating the application, you must register your site on Facebook. <br>  <a href="http://developers.facebook.com/setup/">developers.facebook.com/setup</a> <br>  After registration you will receive 2 keys: App ID and App Secret. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's create a new ASP.NET MVC 3 application. <br><img src="http://microgeek.ru/upload/blog/gavruk/d13/d13c1a12c880bd8991ef8f0488a03703.jpg" alt="image"><br><br>  We will have to work with Json, so you can download the library <a href="http://json.codeplex.com/releases/view/64935">here</a> and connect it in the project: <br> <code>using Newtonsoft.Json.Linq;</code> <br>  Or use the NuGet package manager and write " <code>Install-Package Newtonsoft.Json</code> " <br><br>  To get started, load the JavaScript SDK to our page. <br><br><blockquote> <code><a href="http://s-c.me/21962/s"></a> <a href="http://s-c.me/21962/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  $ (document) .ready ( <font color="#0000ff">function</font> () { </li><li>  <font color="#0000ff">if</font> (document.getElementById ( <font color="#A31515">'fb-root'</font> )! = undefined) { </li><li>  <font color="#0000ff">var</font> e = document.createElement ( <font color="#A31515">'script'</font> ); </li><li>  e.type = <font color="#A31515">'text / javascript'</font> ; </li><li>  e.src = document.location.protocol + <font color="#A31515">'//connect.facebook.net/en_US/all.js'</font> ; </li><li>  e.async = <font color="#0000ff">true</font> ; </li><li>  document.getElementById ( <font color="#A31515">'fb-root'</font> ) .appendChild (e); </li><li>  } </li><li>  }); </li></ol></blockquote><br><br>  Next, we initialize our page using App Id, which was obtained when registering a domain on Facebook. <br><br><blockquote> <code><a href="http://s-c.me/21963/s"></a> <a href="http://s-c.me/21963/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  FB.init ({ </li><li>  appId: <font color="#A31515">'YOUR_APP_ID'</font> , cookie: <font color="#0000ff">true</font> , </li><li>  status: <font color="#0000ff">true</font> , xfbml: <font color="#0000ff">true</font> </li><li>  }); </li></ol></blockquote><br><br>  Let's display the login button via Facebook on the site page. <br><br><blockquote> <code><a href="http://s-c.me/21964/s"></a> <a href="http://s-c.me/21964/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">&lt;</font> <font color="#800000">fb: login-button</font> <font color="#ff0000">perms</font> <font color="#0000ff">= "email, user_checkins"</font> </li><li>  <font color="#ff0000">onlogin</font> <font color="#0000ff">= "onConnect ();"</font>  <font color="#ff0000">autologoutlink</font> <font color="#0000ff">= "false"&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">fb: login-button</font> <font color="#0000ff">&gt;</font> </li></ol></blockquote><br><br>  This uses the <code>xmlns:fb="http://www.facebook.com/2008/fbml"</code> namespace. <br>  You can generate a button <a href="http://developers.facebook.com/docs/reference/plugins/login/">here</a> . <br><br>  The <i>onlogin</i> event of the <i>fb-button button</i> is triggered after confirming or canceling authorization in the popup window. <br><br><img src="http://microgeek.ru/upload/blog/gavruk/f05/f05af2146a77c46750022fca0faeef9d.jpg" alt="image"><br><br>  On the <i>onlogin</i> event, the <i>onConnect ()</i> method is <i>called</i> , in which we receive <br>  <i>access_token</i> . <br><br><blockquote> <code><a href="http://s-c.me/21794/s"></a> <a href="http://s-c.me/21794/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">function</font> onConnect () { </li><li>  FB.getLoginStatus ( <font color="#0000ff">function</font> (response) { </li><li>  <font color="#0000ff">if</font> (response.session) { </li><li>  window.location = <font color="#A31515">"../Account/FbLogin?token="</font> + response.session.access_token; </li><li>  } <font color="#0000ff">else</font> { </li><li>  <font color="#008000">// if user cancel</font> </li><li>  } </li><li>  }); </li><li>  }; </li></ol></blockquote><br><br>  This key can be used to retrieve user information.  The <i>FbLogin ()</i> method of the <i>AccountController</i> controller is <i>called</i> , which receives information about the user: <br><br><blockquote> <code><a href="http://s-c.me/21971/s"></a> <a href="http://s-c.me/21971/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">public</font> <font color="#2b91af">ActionResult</font> FbLogin ( <font color="#0000ff">string</font> token) </li><li>  { </li><li>  <font color="#2b91af">WebClient</font> client = <font color="#0000ff">new</font> <font color="#2b91af">WebClient</font> (); </li><li>  <font color="#0000ff">string</font> JsonResult = client.DownloadString ( <font color="#0000ff">string</font> .Concat ( <font color="#A31515">"https://graph.facebook.com/me?access_token="</font> , token)); </li><li>  JObject jsonUserInfo = JObject.Parse (JsonResult); </li><li>  <font color="#2b91af">UInt64</font> facebook_userID = jsonUserInfo.Value &lt; <font color="#2b91af">UInt64</font> &gt; ( <font color="#A31515">"id"</font> ); </li><li>  <font color="#0000ff">string</font> username = jsonUserInfo.Value &lt; <font color="#0000ff">string</font> &gt; ( <font color="#A31515">"username"</font> ); </li><li>  <font color="#0000ff">string</font> email = jsonUserInfo.Value &lt; <font color="#0000ff">string</font> &gt; ( <font color="#A31515">"email"</font> ); </li><li>  <font color="#008000">// can save this information</font> </li><li>  FormsAuthentication.SetAuthCookie (username, <font color="#0000ff">true</font> ); </li><li>  <font color="#0000ff">return</font> RedirectToAction ( <font color="#A31515">"Index"</font> , <font color="#A31515">"Home"</font> ); </li><li>  } </li></ol></blockquote><br><br>  What information can be obtained from the user can be found <a href="http://developers.facebook.com/docs/reference/api/user/">here</a> . <br><br>  All <i>_LogOnPartial.cshtml</i> code: <br><br><blockquote> <code><a href="http://s-c.me/21967/s"></a> <a href="http://s-c.me/21967/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  @if (Request.IsAuthenticated) </li><li>  { </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">text</font> <font color="#0000ff">&gt;</font> Welcome <font color="#0000ff">&lt;</font> <font color="#800000">strong</font> <font color="#0000ff">&gt;</font> @ User.Identity.Name <font color="#0000ff">&lt;/</font> <font color="#800000">strong</font> <font color="#0000ff">&gt;</font> !  [@ Html.ActionLink ("Log Off", "LogOff", "Account")] <font color="#0000ff">&lt;/</font> <font color="#800000">text</font> <font color="#0000ff">&gt;</font> </li><li>  } </li><li>  else </li><li>  { </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">fb: login-button</font> <font color="#ff0000">perms</font> <font color="#0000ff">= "email, user_checkins"</font> <font color="#ff0000">onlogin</font> <font color="#0000ff">= "onConnect ();"</font>  <font color="#ff0000">autologoutlink</font> <font color="#0000ff">= "false"&gt; &lt;/</font> <font color="#800000">fb: login-button</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">= "fb-script"</font> <font color="#ff0000">st yle</font> <font color="#0000ff">= "display: inline; margin-left: 20px;"&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li><li>  @: [@ Html.ActionLink ("Log On", "LogOn", "Account")] </li><li>  } </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">script</font> language = <font color="#A31515">"javascript"</font> type = <font color="#A31515">"text / javascript"</font> &gt; </li><li>  window.fbAsyncInit = <font color="#0000ff">function</font> () { </li><li>  FB.init ({appId: <font color="#A31515">'177572352298948'</font> , status: <font color="#0000ff">true</font> , cookie: <font color="#0000ff">false</font> , xfbml: <font color="#0000ff">true</font> }); </li><li>  }; </li><li>  <font color="#0000ff">function</font> afterConnect () { </li><li>  FB.getLoginStatus ( <font color="#0000ff">function</font> (response) { </li><li>  <font color="#0000ff">if</font> (response.session) { </li><li>  window.location = <font color="#A31515">"../Account/FbLogin?token="</font> + response.session.access_token; </li><li>  } <font color="#0000ff">else</font> { </li><li>  <font color="#008000">// if user cancel</font> </li><li>  } </li><li>  }); </li><li>  }; </li><li>  $ (document) .ready ( <font color="#0000ff">function</font> () { </li><li>  <font color="#0000ff">if</font> (document.getElementById ( <font color="#A31515">'fb-root'</font> )! = undefined) { </li><li>  <font color="#0000ff">var</font> e = document.createElement ( <font color="#A31515">'script'</font> ); </li><li>  e.type = <font color="#A31515">'text / javascript'</font> ; </li><li>  e.src = document.location.protocol + <font color="#A31515">'//connect.facebook.net/en_US/all.js'</font> ; </li><li>  e.async = <font color="#0000ff">true</font> ; </li><li>  document.getElementById ( <font color="#A31515">'fb-root'</font> ) .appendChild (e); </li><li>  } </li><li>  }); </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> </li></ol></blockquote><br><br>  Before logging in: <br><img src="http://microgeek.ru/upload/blog/gavruk/fce/fce6afe92f01e0259e995bdfd02cadcb.jpg" alt="image"><br>  After authorization: <br><img src="http://microgeek.ru/upload/blog/gavruk/2cb/2cbdbd0872607e372ac6de3b9b9d6445.jpg" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/120837/">https://habr.com/ru/post/120837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120831/index.html">Statistics of users and companies of Russia in Europe</a></li>
<li><a href="../120832/index.html">Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification W3C Recommendation 07 June 2011!</a></li>
<li><a href="../120833/index.html">Cheap govnorafik with vkontakte</a></li>
<li><a href="../120834/index.html">Rostelecom is already starting to block torrent trackers</a></li>
<li><a href="../120836/index.html">List of patented gestures</a></li>
<li><a href="../120839/index.html">IIS server market share dropped to 1997 level</a></li>
<li><a href="../120842/index.html">IPO for dummies. Part I: shares, majority shareholders, control over the company</a></li>
<li><a href="../120843/index.html">Indomitable language bar or ‚ÄúGive a choice‚Äù!</a></li>
<li><a href="../120846/index.html">25% of hackers in the US are FBI informants</a></li>
<li><a href="../120847/index.html">Some more boring statistics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>