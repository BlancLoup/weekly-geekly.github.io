<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MPCMeter - indication of the progress of video viewing. Arduino + JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instead of introducing 
 Thanks to my anonymous habradumorosis for a present ( pro mini ). Long hesitated what to do with it. He waved his hand and or...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MPCMeter - indication of the progress of video viewing. Arduino + JavaScript</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>Instead of introducing</b> </h4><br>  Thanks to my anonymous habradumorosis for a <a href="http://habrahabr.ru/post/249843/">present</a> ( <i>pro mini</i> ).  Long hesitated what to do with it.  He waved his hand and ordered in addition a Chinese parcel ... <br>  After a month, it‚Äôs my time to ‚Äúflash the LED‚Äù;). <br><h4>  <b>Idea</b> </h4><br>  While the parcel was traveling, I thought that this would be done.  As a result, it was decided to do something a little more than to flash with a LED. <br>  The idea is the following - to display the progress of viewing the video using some indicator. <br><img src="https://habrastorage.org/files/7e6/2f5/257/7e62f52570214eb5b2582ae3d681845f.png"><br><h4>  <b>Task</b> </h4><br><ol><li>  pull out statistics on the film launched; </li><li>  process and transfer data to arduino; </li><li>  show progress on the indicator. </li></ol><br><h4>  <b>For impatient immediately result</b> </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/MEXRMDirKek%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhjII-Rdpt3Nsw1YiGatxbgFSSdnGg" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br><h4>  <b>Implementation</b> </h4><br><h5>  <b>1. MPC</b> </h5><br>  How many can remember, on my PC, I always installed <a href="https://mpc-hc.org/">Media PLayer Classic</a> .  It turns out MPC is able to give statistics on, let's say, the current session in the form of an html-page with the following content: <br><div class="spoiler">  <b class="spoiler_title">HTML</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>MPC-HC WebServer - Variables<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"favicon.ico"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--[if lt IE 8]&gt; &lt;div class="browser-warning"&gt;&lt;strong&gt;Warning!&lt;/strong&gt; You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href="http://browsehappy.com/"&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/div&gt; &lt;![endif]--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"filepatharg"</span></span></span><span class="hljs-tag">&gt;</span></span>D:%5cFILMS%5cIts.Always.Sunny.in.Philadelphia.S10E10.720p.WEB.rus.LostFilm.TV.mp4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"filepath"</span></span></span><span class="hljs-tag">&gt;</span></span>D:\FILMS\Its.Always.Sunny.in.Philadelphia.S10E10.720p.WEB.rus.LostFilm.TV.mp4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"filedirarg"</span></span></span><span class="hljs-tag">&gt;</span></span>D:%5cFILMS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"filedir"</span></span></span><span class="hljs-tag">&gt;</span></span>D:\FILMS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"state"</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"statestring"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position"</span></span></span><span class="hljs-tag">&gt;</span></span>1069384<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"positionstring"</span></span></span><span class="hljs-tag">&gt;</span></span>00:17:49<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"duration"</span></span></span><span class="hljs-tag">&gt;</span></span>1255210<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"durationstring"</span></span></span><span class="hljs-tag">&gt;</span></span>00:20:55<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"volumelevel"</span></span></span><span class="hljs-tag">&gt;</span></span>75<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"muted"</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"playbackrate"</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"reloadtime"</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  To achieve such functionality from it, you need to put a tick " <b>Listen to the port</b> " in the settings <br><div class="spoiler">  <b class="spoiler_title">Settings</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/240/7fc/cae/2407fccae9134125bb35900dc6689c09.png"><br></div></div><br>  All the most important is contained in the tags <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  It remains only to disassemble them and select the right. <br><h5>  <b>2. NodeJS</b> </h5><br>  We will analyze the page with the help of NodeJS.  By the way, the page is available at <a href="http://localhost/">localhost</a> : 13580 / variables.html (port from settings). <br>  All logic can be divided into 3 blocks: <br><ul><li>  MPC web server module; </li><li>  data processing module; </li><li>  module working with arduino. </li></ul><br>  Further highlights.  The whole project, along with the code, you can look at <img src="https://camo.githubusercontent.com/806d7474538d8e9f0b951ffea14cf9352985bc40/687474703a2f2f63646e312e69636f6e66696e6465722e636f6d2f646174612f69636f6e732f4b6579616d6f6f6e2d49636f4d6f6f6e2d2d6c696d697465642f31362f6769746875622d6361742e706e67" alt="image">  <a href="https://github.com/andreevich/MPCMeter">github</a> <br><div class="spoiler">  <b class="spoiler_title">Little js</b> <div class="spoiler_text">  With the help of the native http.get and promises I refer to our page. <br><pre> <code class="javascript hljs">main.prototype.get = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> that = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">done</span></span></span><span class="hljs-function">)</span></span>{ http.get(that.mpc_uri, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) </span></span>{ res.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chunk</span></span></span><span class="hljs-function">) </span></span>{ that.mpc_obj.parse(chunk) done(that.mpc_obj.get()); }); }).on(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ done(e.message); }); }) }</code> </pre><br>  Use the parse method of the mpc_obj object to parse the data <br><pre> <code class="javascript hljs">MPC_obj.prototype.parse = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = {} data.toString().split(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">line</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ,       if (match=/\&lt;p/.test(line)){ var name2 = line.match(/id\=\"(\w+)\"/)[1] if (!obj.hasOwnProperty(name2)) obj[name2]=line.substring(line.indexOf('&gt;')+1,line.lastIndexOf('&lt;')) } }) this.settings=obj; }</span></span></code> </pre><br>  At the exit, we have such an object <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">filepatharg</span></span>: <span class="hljs-string"><span class="hljs-string">'D:%5cmbrr555.avi'</span></span>, <span class="hljs-attr"><span class="hljs-attr">filepath</span></span>: <span class="hljs-string"><span class="hljs-string">'D:\\mbrr555.avi'</span></span>, <span class="hljs-attr"><span class="hljs-attr">filedirarg</span></span>: <span class="hljs-string"><span class="hljs-string">'D:%5c'</span></span>, <span class="hljs-attr"><span class="hljs-attr">filedir</span></span>: <span class="hljs-string"><span class="hljs-string">'D:\\'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">statestring</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">position</span></span>: <span class="hljs-string"><span class="hljs-string">'1023'</span></span>, <span class="hljs-attr"><span class="hljs-attr">positionstring</span></span>: <span class="hljs-string"><span class="hljs-string">'00:00:01'</span></span>, <span class="hljs-attr"><span class="hljs-attr">duration</span></span>: <span class="hljs-string"><span class="hljs-string">'114906'</span></span>, <span class="hljs-attr"><span class="hljs-attr">durationstring</span></span>: <span class="hljs-string"><span class="hljs-string">'00:01:54'</span></span>, <span class="hljs-attr"><span class="hljs-attr">volumelevel</span></span>: <span class="hljs-string"><span class="hljs-string">'77'</span></span>, <span class="hljs-attr"><span class="hljs-attr">muted</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-attr"><span class="hljs-attr">playbackrate</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">reloadtime</span></span>: <span class="hljs-string"><span class="hljs-string">'0'</span></span> }</code> </pre><br>  Preparing data for arduino <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    MPC_obj.prototype.getProgress = function(){ return (this.settings["position"]/this.settings["duration"]).toFixed(5) } //     (PWM) 1,0 -&gt; 255 MPC_obj.prototype.PWM = function(){ return (this.getProgress()*255).toFixed(0) }</span></span></code> </pre><br>  Communication with arduino occurs through the exchange of data on the com-port.  I chose library to work with com <img src="https://camo.githubusercontent.com/806d7474538d8e9f0b951ffea14cf9352985bc40/687474703a2f2f63646e312e69636f6e66696e6465722e636f6d2f646174612f69636f6e732f4b6579616d6f6f6e2d49636f4d6f6f6e2d2d6c696d697465642f31362f6769746875622d6361742e706e67" alt="image">  <a href="https://github.com/voodootikigod/node-serialport">node-serialport</a> <br>  Connect with its help to the com5 port and set the speed <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SerialPort = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'serialport'</span></span>).SerialPort; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serialPort = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SerialPort(<span class="hljs-string"><span class="hljs-string">"COM5"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">baudrate</span></span>: <span class="hljs-number"><span class="hljs-number">57600</span></span> }, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre><br>  We open the port and send our progress back to arduino every time it asks <br><pre> <code class="javascript hljs">serialPort.open(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( error ) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'failed to open: '</span></span>+error); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'open'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   arduino serialPort.on('data', function(data) { main.init(function(a){ //     serialPort.write(a); }); }); } });</span></span></code> </pre><br></div></div><br><h5>  <b>3. Arduino</b> </h5><br>  Now iron.  We have prepared data for arduino, now we will decide on that very indication.  To display progress, I chose such a very cheap voltmeter module and tweaked it a bit <br><img src="https://habrastorage.org/files/cb2/c87/17c/cb2c8717c58341609195f17c40cfcff4.png"><br><div class="spoiler">  <b class="spoiler_title">A little more detail</b> <div class="spoiler_text">  It turns out that the lid held onto ... sticky tape and was easily removed <br><img src="https://habrastorage.org/files/b1b/57c/836/b1b57c836b1f4384b3fdcba585328ede.png"><br>  Well, then the size and a pair of new panels <br><img src="https://habrastorage.org/files/7ad/b29/f46/7adb29f46d4d477a95f95dff0886a9ac.png"><br></div></div><br>  In arduino, we send data about the progress of the film and proportionally change the voltage on one of the legs of the microcontroller.  Schematic diagram (the presence of the LED to blink at the end of the session;)) <br><img src="https://habrastorage.org/files/496/a1f/5e2/496a1f5e255a4f8abfa0ab81c8099eac.png"><br>  Now let's program our microcontroller. <br>  In the inByte variable, we will read the data received on the com port.  We hang on the 3rd pin LED, and on the 9th pin - a voltmeter.  We set the exact same speed as before.  loop is our endless loop.  Every 100ms we send abstract data Serial.print ('A') to the port.  We are waiting for the response Serial.available ()&gt; 0. If MPC and a nodeJS application that returns progress are running on the PC, then we‚Äôll lightly highlight the LED on the 3rd analogWrite pin (3, 5) and transmit the analogWrite progress value (9, inByte).  The analogWrite function transmits values ‚Äã‚Äãfrom 0 to 255, which in our case corresponds to 0V to 5V.  Here you need to read about <a href="http://arduino.ru/Tutorial/PWM">PWM (PWM)</a> - it's all thanks to him. <br>  When we watched half of the movie, at this moment 255/2 = analogWrite (9, 127) will be transmitted to the 9th pin, which corresponds to 2.5V on the voltmeter.  As soon as the film is finished - we blink vigorously with a LED;) <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> inByte = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ pinMode(<span class="hljs-number"><span class="hljs-number">9</span></span>, OUTPUT); pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT); analogWrite(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); analogWrite(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); Serial.begin(<span class="hljs-number"><span class="hljs-number">57600</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.print(<span class="hljs-string"><span class="hljs-string">'A'</span></span>); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Serial.available() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { analogWrite(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); inByte = Serial.parseInt(); analogWrite(<span class="hljs-number"><span class="hljs-number">9</span></span>, inByte); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inByte==<span class="hljs-number"><span class="hljs-number">255</span></span>) analogWrite(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>); } }</code> </pre><br>  That's how it all looks live on a breadboard <br><img src="https://habrastorage.org/files/fa4/b77/813/fa4b778139cf456c8002e68dbb2c8a27.png"><br>  Yes, and on the video;) <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/MEXRMDirKek%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhjII-Rdpt3Nsw1YiGatxbgFSSdnGg" frameborder="0" allowfullscreen=""></iframe><br>  By the way, this project used just a <a href="http://habrahabr.ru/post/249843/">present</a> from the very same habromedamorosis. <br>  Ps. <br>  Next is Attiny13, as time will be - I will try to transfer everything to it. <br>  References: <br><ul><li>  <a href="http://habrahabr.ru/post/249843/">present from habradedamoroza</a> ; </li><li>  <a href="https://mpc-hc.org/">Media PLayer Classic</a> ; </li><li>  <a href="https://github.com/andreevich/MPCMeter">All project on github</a> ; </li><li>  <a href="https://github.com/voodootikigod/node-serialport">module for working with the node-serialport com port</a> ; </li><li>  <a href="http://arduino.ru/Tutorial/PWM">about PWM (PWM)</a> ; </li><li>  <a href="https://nodejs.org/">fresh NodeJS</a> ; </li><li>  <a href="http://arduino.cc/en/Main/Software">Arduino IDE</a> . </li></ul><br>  If somewhere you have written complete nonsense or you are mistaken - prompt, correct;).  Thanks for attention. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/254911/">https://habr.com/ru/post/254911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254899/index.html">Encryption in NQ Vault turned out to be an ordinary XOR, and this is not the worst</a></li>
<li><a href="../254901/index.html">Universal Nixie-module on IN-12</a></li>
<li><a href="../254905/index.html">State Mandate to Kill the Universe and Counteract This (report at Bitcoin Conference Russia 2015)</a></li>
<li><a href="../254907/index.html">Web Bundle - the case of RarJPEG lives</a></li>
<li><a href="../254909/index.html">Some practical cryptography for .NET for dummies</a></li>
<li><a href="../254915/index.html">4.04 Happy webmasters</a></li>
<li><a href="../254917/index.html">Gauges: is it worth to use them for data visualization</a></li>
<li><a href="../254921/index.html">Fast neural network for everyone</a></li>
<li><a href="../254927/index.html">(Archive) 10 reasons to try Matryoshka</a></li>
<li><a href="../254931/index.html">(Translation) Introduction to C ++ Development in UE4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>