<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do the stars count? Using InterSystems Cach√© eXtreme at Gaia</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to thank 0leo , morisson and adaptun for help in preparing the article. 

 Astrologer tools 

 As you know, tomorrow, December 19, 2013, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do the stars count? Using InterSystems Cach√© eXtreme at Gaia</h1><div class="post__text post__text-html js-mediator-article">  I would like to thank <a href="https://habrahabr.ru/users/0leo/" class="user_link">0leo</a> , <a href="https://habrahabr.ru/users/morisson/" class="user_link">morisson</a> and <a href="https://habrahabr.ru/users/adaptun/" class="user_link">adaptun</a> for help in preparing the article. <br><br><h4>  Astrologer tools </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/e09/28f/c34/e0928fc340d958aba486c18c4a59e869.jpg" align="left"><br>  As you know, tomorrow, December 19, 2013, the <a href="http://sci.esa.int/gaia/">Gaia</a> telescope will be launched.  Many have already read the <a href="http://habrahabr.ru/post/205872/">article</a> about the mission, but few know what technology the developers of the European Space Agency <a href="http://www.intersystems.ru/press/2013/gaia-mission-1yr-later.html">have chosen</a> to process and store Gaia data.  In 2011, <i>IBM DB2</i> , <i>PostgreSQL</i> , <i><a href="http://hadoop.apache.org/">Hadoop</a></i> , <i><a href="http://cassandra.apache.org/">Cassandra,</a></i> and <i>Cach√© were</i> considered candidates (more precisely, <i><a href="">Cach√© eXtreme Event Persistence</a></i> ; see, for example, <a href="http://books.google.com/books%3Fid%3Dys-e0SotvBoC%26amp%3Blpg%3DPA109%26amp%3Bots%3Dut05m7Pem5%26amp%3Bdq%3DAstrometric%2520Global%2520Iterative%2520Solution%2520Intersystems%26amp%3Bhl%3Dru%26amp%3Bpg%3DPA112">Astrostatistics and Data Mining</a> , ed. Luis Manuel Sarro) , Laurent Eyer and William O'Mullane, p. 111-112). <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Fragment of the book</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd7/c40/533/cd7c4053338b31bab8bce3d527f9e6c3.png"></div></div></div><br>  On the first four "players" of the industry knows, perhaps, almost every student.  But what is the <i>Cach√© XEP</i> ? <br><br><h4>  Java technology in Cach√© </h4><br>  If you look at the Java API stack provided by <i>InterSystems</i> , we see something like the following: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <i><a href="">Cach√© Object Binding</a></i> technology, transparently projecting an object-oriented representation of data in Java.  In <i>Cach√©</i> terms, the generated Java proxy classes are called projections (projections).  This approach is the easiest to use, since it retains the ‚Äúnatural‚Äù connections between classes in the object model, but at the same time it is distinguished by a rather low speed: quite a lot of service (meta) information describing the object model is transmitted via wires. </li><li> JDBC and various add-ons ( <i><a href="">Jalape√±o</a></i> , <i>Hibernate</i> , <i>JPA</i> ).  Here, I probably will not say anything new, except that <i>Cach√©</i> supports two levels of transaction isolation: <a href="http://java.sun.com/javase/7/docs/api/java/sql/Connection.html"><code>READ_UNCOMMITTED</code></a> and <a href="http://java.sun.com/javase/7/docs/api/java/sql/Connection.html"><code>READ_COMMITTED</code></a> ‚Äî and by default it works in <code>READ_UNCOMMITTED</code> mode. </li><li>  The <i>Cach√© eXtreme</i> family (also existing in editions for <i><a href="">.NET</a></i> and <i><a href="">Node.js</a></i> ).  This approach is characterized by direct access to low-level data representation (so-called ‚Äúglobal‚Äù - information quanta in the world of <i>Cach√©</i> ), which provides a very high speed of work. </li></ul><br><br><h4>  Handling complex events </h4><br>  If you read the name of the mentioned technology, it can be seen with the naked eye that it hints at the connection with the task of processing complex events (XEP - <i>eXtreme complex Event Processing</i> ).  This problem is solved everywhere: <br><ul><li>  in trading systems, including in algorithmic trading systems; </li><li>  in bank security systems; </li><li>  in the systems of collecting and analyzing statistics in real time (road analysis, weather forecasting, monitoring of social networks). </li></ul><br><br>  What are the current requirements for technologies that help solve the problem?  The requirements are simple and few: <br><br><ul><li>  processing (possibly including saving) in real time at least 1000 eps (events per second), and in practice we often deal with tens of thousands of transactions per second, and the products described, t. obr., belong to the class of <a href="http://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BA%25D1%2581%25D1%2582%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B9">XTP</a> systems ( <a href="http://www.cnews.ru/reviews/free/marketBD/int/intersys/">[1]</a> , <a href="http://citforum.ru/seminars/cbd2010/1_3_InterSystems.pdf">[2]</a> ); </li><li>  recognition of the correlation between the events being processed (as in the classic example: the bell ringing plus the man in black, the woman in white leading by hand, most likely means the wedding is in progress); </li><li>  <i>pattern matching</i> ( <i>pattern matching</i> ), i.e. filtering (again, in real time); </li><li>  Naturally, XML processing (as without it?); </li><li>  support for the execution of <a href="http://en.wikipedia.org/wiki/Rete_algorithm">business rules</a> ( <i>business rules</i> ); </li><li>  event handling of complex structure (with a large number of fields); </li><li>  archival storage of the event history, at least in the last 24 hours (i.e. approx. 100M events); </li><li>  finally, fault tolerance. </li></ul><br><br>  If you look at the IT market, you can immediately call the following interesting implementation: <br><ul><li>  <i>IBM WebSphere Business Events</i> ; </li><li>  <i>Sybase ESP</i> - you can even <a href="http://www.sybase.com/products/financialservicessolutions/complex-event-processing">download</a> and ‚Äútouch‚Äù a test version of the product (the distribution kit weighs about 1000 MB); </li><li>  <i>Software AG Apama CEP Platform</i> ; </li><li>  <i>TIBCO BusinessEvents</i> ; </li><li>  <i>TIBCO StreamBase</i> (TIBCO, due to several successful purchases, now have two competing products). </li></ul><br><br>  To be fair, it should be noted that <i>Cach√© eXtreme</i> technology itself is not a CEP / XEP implementation: XEP is not deciphered as <i>eXtreme Event Processing</i> , but merely as <i>eXtreme Event Persistence</i> .  However, we see no reason why the notorious CEP paradigm would be technically impossible to implement within the InterSystems technological stack with the involvement of a product such as <i><a href="">Ensemble</a></i> .  In addition, many implementations achieve similar goals using <i>Cach√© eXtreme</i> in conjunction with <a href="http://esper.codehaus.org/"><i>Esper</i></a> or <i>NEsper</i> . <br><br><h4>  Let's return to our sheep </h4><br>  If you look at the high-level architecture of <i>Cach√© eXtreme</i> , then it is quite simple: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db6/fda/5a0/db6fda5a0586bea345bcab37690e58de.png"></div><br><br>  Here, the <i><a href="">Globals API</a></i> provides fast, low-level access to globals.  The functionality of the <i>Globals API is</i> also available as a free NoSQL database - <i><a href="http://globalsdb.org/">GlobalsDB</a></i> . <br><br>  <i><a href="">Cach√© XDO</a></i> is a fast ‚Äúdynamic‚Äù data access that does not require the presence of an object model on the client side.  The closest equivalent from the Java world is <i><a href="http://en.wikipedia.org/wiki/Reflection_%2528computer_programming%2529">Reflection</a></i> . <br><br>  Finally, the module with the not quite euphonious name for the Russian ear <i><a href="">Cach√© XEP</a></i> , also based on the <i>Globals API</i> , provides fast object and quasi-relational access to data.  Object - in the sense that the API client does not need to worry about object-relational mapping: in the image and likeness of the Java object model (even in the case of complex multi-level inheritance) <a href="">, an</a> object model <a href="">is automatically created</a> at the <i>Cach√©</i> class level (or the database schema, if you go to relational view).  And quasi-relational, in the sense that <a href="">you can execute SQL queries</a> (more precisely, queries that use a subset of SQL) directly from the context of the <i>eXtreme</i> connection, and, moreover, <a href="">indexes</a> and transactions are also supported on a set of ‚Äúevents‚Äù loaded into the database. .  Of course, all downloaded data is immediately available via JDBC through a relational view (with the ability to use all the power of ANSI SQL plus the SQL extensions characteristic of the <i>Cach√©</i> dialect), but the access speed will be completely different.  Once again, as a resume, we have: <br><br><ul><li>  ‚Äúschema‚Äù import ( <i>Cach√©</i> classes are created automatically), incl. </li><li>  import hierarchy of Java classes; </li><li>  instant relational data access - you can work with <i>Cach√©</i> classes as with tables; </li><li>  index and transaction support with <i>Cach√© eXtreme</i> ; </li><li>  support for simple SQL queries using <i>Cach√© eXtreme</i> ; </li><li>  support for arbitrary SQL queries through the underlying <i>eXtreme</i> JDBC connection. </li></ul><br><br>  This approach gives some advantages over similar relational (higher access speed), and over various NoSQL solutions (immediate access to data in relational style). <br><br>  Additionally, you can say that an <i>eXtreme</i> connection can be of two types: a connection that uses JNI (but requires that the Cach√© server be available locally - the difference from the JDBC connection of the 2nd type is that data transmission over the network is not supported), and normal TCP connection, where data transmission is carried out using a standard type 4 JDBC driver. <br><br>  The ‚Äúsubtlety of tuning‚Äù of the JNI version consists solely in the need to set up the environment: <br><br><ul><li>  the <code>GLOBALS_HOME</code> variable must point to the directory containing the <i>Cach√©</i> installation, and </li><li>  <code>LD_LIBRARY_PATH</code> ( <code>DYLD_LIBRARY_PATH</code> for <i>Mac OS X</i> or <code>PATH</code> for <i>Windows</i> ) must contain <code>${GLOBALS_HOME}/bin</code> . </li></ul><br><br>  For the TCP version, it is sufficient to increase the size of the stack (stack) and heap (heap) of the <i>JVM</i> ( <code>-Xss2m -Xmx768m</code> ). <br><br><h4>  Some practice </h4><br>  The authors were interested in how <i>Cach√© eXtreme</i> behaves in the task of recording a continuous stream of data compared to popular data processing technologies.  As a source of data, historical quotes were taken from the <a href="http://www.finam.ru/">Finam</a> holding site, which can be downloaded in CSV format (the authors of the article are grateful to the creators of such a wonderful resource). <br><br><div class="spoiler">  <b class="spoiler_title">Actually resource</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/642/ba7/a0e/642ba7a0e38ff5042d374f36100c3130.png" height="361" width="640"></div></div></div><br><br>  Since it is hardly realistic to find the desired link on the site (the second and subsequent times we did not succeed), we <a href="http://www.finam.ru/analysis/profile041CA00007/default.asp">share it here</a> . <br><br>  As a result, a rather naive test was written, which completely ignores the rules for writing microtest performance in Java.  In particular, never got <i><a href="http://openjdk.java.net/projects/code-tools/jmh/">around to</a></i> screw the <i><a href="http://openjdk.java.net/projects/code-tools/jmh/">JMH</a></i> .  Some excuse can be that we do not measure the speed of the code generated by the <i>JIT</i> , but the speed with which the <i>JVM</i> code (with the exception of <i>Apache Derby</i> ) that can write to disk.  The question of <a href="http://lists.apple.com/archives/darwin-dev/2005/Feb/msg00072.html">whether the</a> hard disk <a href="http://lists.apple.com/archives/darwin-dev/2005/Feb/msg00072.html">that</a> participated in the tests obeyed the <code>fsync()</code> syscall, alas, we also ignored. <br><br>  So, in the race participated: <br><br><ul><li>  <i>Apache Derby</i> 10.9 (some well-known commercial relational DBMSs showed similar performance) </li><li>  <i>InterSystems Cach√©</i> 2013.1 (JDBC) </li><li>  <i>InterSystems Cach√©</i> 2013.1 (eXtreme) </li></ul><br><br>  Let us say at once that, due to the approximation of tests, we see no point in giving exact figures: the error is large enough, and the purpose of the article is only to demonstrate the general tendency.  For the same reasons, <strike>as well as the inability to configure GC</strike> , we do not specify the exact JDK version and the garbage collector settings: server 6u45 and 7u40 with <code>-Xmx2048m -Xss128m</code> showed similar performance on <i>Linux</i> and <i>Mac OS X.</i>  In each of the tests, about a million events were saved;  the test for each separate database was preceded by several (up to 10) ‚Äúwarming up‚Äù launches.  As for the <i>Cach√©</i> settings, the program cache (routine cache) was increased to 256 MB, and the eight-kilo byte cache database (8kb database cache) - up to 1024 MB. <br><br>  Actually, the results are as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed6/771/c7b/ed6771c7b43490a0d635a32fd03c030c.png"></div><br><br>  <i>Derby</i> and other relational DBMSs give a write speed ranging from 1000 to 1500 events / sec.  <i>Cach√©</i> in JDBC mode has a higher speed (from 6000 to 7000 eps), but this speed comes at a price: the default isolation level for transactions, as mentioned above, is <code>READ_UNCOMMITTED</code> .  Further, <i>Cach√© eXtreme</i> gives 45000-50000 eps in pure-Java mode and more than 80,000 eps when communicating with a local <i>Cach√©</i> instance via JNI.  Finally, if you take some risk and <a href="">disable the transaction log</a> (for a single current process), then on a test machine it was possible to bring the write speed for a JNI connection to 100000 eps. <br><br>  Anyone who is interested in more accurate numbers, or would like to make the tests more correct, or whom the given results touched a little, we suggest reading the <a href="https://github.com/unix-junkie/persistence-benchmark">source code</a> .  To build and run, you will need <i>JDK</i> 1.6+, <i>Git</i> , <i>Maven</i> (including the <i><a href="http://maven.apache.org/plugins/maven-install-plugin/">Maven Install Plugin</a></i> to create local artifacts of <i>Cach√© JDBC</i> and <i>Cach√© eXtreme</i> ), and finally <i>Cach√©</i> (We recommend ordering a <a href="http://intersystems.ru/aboutus/contact.html">temporary license key</a> - it's free. We also We offer universities to join the <a href="http://www.intersystems.ru/cache/education/cachecampus/">InterSystems Campus</a> program and get official Cach√© distributions with an academic license (in any case, <i>InterSystems</i> consultants are ready to help with load testing in your project). <br><br>  Comments are welcome. <br><br><h4>  Chmbls </h4><br><ul><li>  Until you got your hands to write a <i>Cach√©</i> backend for <a href="https://github.com/brianfrankcooper/YCSB/wiki">Yahoo!</a>  <a href="https://github.com/brianfrankcooper/YCSB/wiki">Cloud Serving Benchmark</a> . </li><li>  It would be interesting to learn <i>JMH</i> instead of home-grown speedometer <strike>bikes</strike> . <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/194814/">https://habr.com/ru/post/194814/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194804/index.html">City Electronic Libraries</a></li>
<li><a href="../194806/index.html">SmartProgress 2.0. We have turned goal achievement into an exciting activity.</a></li>
<li><a href="../194808/index.html">Incredible new polymer that heals itself with 97% efficiency.</a></li>
<li><a href="../194810/index.html">Broadcast launch RAD Studio XE5</a></li>
<li><a href="../194812/index.html">We organize Asterisk IP telephony in the office without learning Linux</a></li>
<li><a href="../194816/index.html">ARMs for the smallest: layout-2, interrupts and hello world!</a></li>
<li><a href="../194818/index.html">InterSystems Cach√© and NoSQL Technology</a></li>
<li><a href="../194822/index.html">Copyright: you have to take the initiative</a></li>
<li><a href="../194830/index.html">It seems that the next Android will also be "flat"</a></li>
<li><a href="../194832/index.html">ILC: why do scientists need the second Big Collider?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>