<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving parental control issues in Ubuntu with Dansguardian and Privoxy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am of the opinion that Ubuntu is quite suitable for the role of a user-friendly desktop operating system. 

 Accordingly, I believe that when buying...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving parental control issues in Ubuntu with Dansguardian and Privoxy</h1><div class="post__text post__text-html js-mediator-article"> I am of the opinion that Ubuntu is quite suitable for the role of a user-friendly desktop operating system. <br><br>  Accordingly, I believe that when buying computers and laptops, it is quite possible to save money on the cost of licensed Windows by installing a free (open) OS (remember how many, about 5 years ago, Linux laptops were sold, and how many now). <br><br>  I bought the <a href="http://www.ixbt.com/news/hard/index.shtml%3F13/74/72">Acer Aspire Revo R3700 nettop for children</a> , which, by itself, is worth a separate review (dual-core Atom + Ion), screwed it to the back of the monitor, since both support the VESA mount standard (it‚Äôs a compact monoblock), demolished the pre-installed Linpus and installed Ubuntu 10.10 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In principle, both I and my children were happy with everything - everything works quite fast (pah-pah-pah), surfing the Internet, watching photos, listening to music, playing children's and educational games - this is the nettop, in my opinion , perfect.  The only thing that depressed them were banners on various, even children's (!), Sites with all kinds of content (first of all, visual), from which I really wanted to protect children. <br><br>  It was here that I was disappointed when I found out that there was simply no built-in (regular) parental control in Ubuntu.  In Windows Vista and 7 - there is, there are many separate "Windows" programs, for example, <a href="http://habrahabr.ru/blogs/infosecurity/88669/">Internet Censor</a> (I tried it under Windows at one time, in principle, I was satisfied). <br><br><a name="habracut"></a><br>  But in Ubuntu with this tight.  I stumbled into the repository on Gnome Nanny - put it, then pulled it down.  There are terrible warnings that the Internet will now turn off and the computer will turn off, but ... nothing happens.  Perhaps the calculation was on the consciousness of children (sarcasm), although, rather, I just did not understand.  True, I did everything according to the manual, but I did not want to spend weeks finding out the reasons. <br><br>  I will also immediately state that the <a href="http://lurkmore.ru/%25D0%2590%25D0%25BA%25D0%25B0%25D0%25B4%25D0%25BE">provider</a> prohibits the use of third-party DNS, otherwise it would be possible that I simply limited myself to any OpenDNS, where, like, advertising is cut and there is a filter for adult content. <br><br>  Briefly about how my home network is built: there is a D-Link Dir-615 router, the main home computer is connected to it via a network cable, as well as the <a href="http://forum.ixbt.com/topic.cgi%3Fid%3D62:13822">Popcorn Hour A-110 media player</a> , Wi-Fi - a children's nettop, iPad, netbook, a laptop, a couple of smartphones on an android, another <a href="http://www.wdc.com/ru/products/products.aspx%3Fid%3D330">WD TV Live</a> media player and ... everything seems to be. <br><br>  Returning to the problem of parental control: I came across a program called <a href="http://dansguardian.org/">Dansguardian</a> , read, thought, decided to install. <br><br>  For experiments, I got an old <a href="http://eee-pc.ru/wiki/asus_eee_pc_701">EEE PC 701 4G</a> (just in case, maybe, who does not know: the digit in front of G means only ‚Äúthe capacity of the built-in memory (solid-state drive) in gigabytes‚Äù, and not the built-in 4G modem), put Lubuntu 10.10 on it ( By the way, Lubuntu pleased - it is undemanding to resources, because it is fast, familiar to those who are ‚Äúafter Windows‚Äù, all the hardware has literally worked ‚Äúout of the box‚Äù): <br><br> <a href="" title="Habraffe.ru"><img height="240" src="https://habrastorage.org/storage/habraeffect/ba/c0/bac09c109b3cb9abe3c88c1b1db6c2aa.png" width="400"></a> <br><br>  After that, I got two accounts, one [kid] (in square brackets, hereinafter, the account designation, which you can choose according to your taste, where kid is the child's account, parent is the parent's account) and [parent].  [kid] - with user rights, [parent] - with administrator rights. <br><br>  We go under the account of the child, open the terminal ("Start" (hehe, but how else would you call the button on the taskbar in the lower left corner?) -&gt; Standard -&gt; LXTerminal) <br><br>  We type (without square brackets, of course): <br><br> <code>su [parent]</code> <br> <br>  Enter the password.  Further: <br><br> <code>sudo apt-get install -y privoxy dansguardian</code> <br> <br>  Enter the password, follow the prompts on the screen, after which you should be installed, as you guessed, Dansguardian and Privoxy (a non-heavy proxy server - Dansguardian will actually work through it). <br><br>  Then, just in case, you can check whether privoxy is running, with the command <br><br> <code>sudo /etc/init.d/privoxy status</code> <br> <br>  After that, you need to configure the installed programs, for this we edit the configuration files: <br><br> <code>sudo leafpad /etc/privoxy/config</code> <br> <br>  We are looking for the listen-address line, we bring it to the following form (do not forget to remove the comment sign #): <br><br> <code>listen-address 127.0.0.1:8118</code> <br> <br>  We look for the accept-intercepted-requests parameter and assign it a value of 1: <br><br> <code>accept-intercepted-requests 1</code> <br> <br>  That's it, the privoxy proxy setting is complete, save, exit. <br><br>  Next, configure the dansguardian itself: <br><br> <code>sudo leafpad /etc/dansguardian/dansguardian.conf</code> <br> <br>  At the very beginning of the file it is written that it is necessary to delete the UNCOMMITED line for the settings to take effect.  Remove it.  Next, look for an uncommented line beginning with the word language and change it: <br><br> <code>language = 'russian-1251'</code> <br> <br>  It is necessary that the page with the ‚ÄúAccess denied‚Äù template be in Russian. <br><br>  We are looking for and changing the following lines (if the file is written in the same way by default, then, of course, it is not necessary to change it): <br><br> <code>filterport=8080 <br> <br> proxyip=127.0.0.1 <br> <br> proxyport-8118 <br></code> <br><br>  Save, close.  Next, restart both programs: <br><br> <code>sudo service dansguardian force-reload <br> sudo service privoxy force-reload <br></code> <br><br>  Next, launch the default browser (pre-installed Chromium), go to some thread playboy.com and see ... that it successfully loads, as before!  In order not to tear the hair on my head (as I did it a couple of days in a row), read on. <br><br>  In general, this is how it should be, because we did not change the proxy server settings in the browser.  With habitual clicks we go into the advanced settings of Chromium (‚ÄúAfter all, this is the same Chrome!‚Äù) And we see a depressing picture: <br><br> <a href="" title="Habraffe.ru"><img height="240" src="https://habrastorage.org/storage/habraeffect/ba/da/badadef1dfaf34e29ede0019c81a02fc.png" width="400"></a> <br><br>  That's right, in Lubuntu there is no ‚Äúgay‚Äù proxy server configuration interface.  As a temporary solution, we write in the terminal: <br><br> <code>sudo chromium-browser --proxy-server=127.0.0.1:8080</code> <br> <br>  The browser will start, go to playboy.com and see the following image: <br><br> <a href="" title="Habraffe.ru"><img height="240" src="https://habrastorage.org/storage/habraeffect/d6/41/d641dd98ce9cf075384e955e33ac0bb6.png" width="400"></a> <br><br>  Hurray!  But the joy is overshadowed by the fact that if we restart the browser, the proxy settings will fly off, and this is not an option.  Yes, and a child, having turned around, will learn to bypass the proxy server, by putting some Firefox and unchecking the box ‚Äúuse proxy server settings‚Äù.  So you need a more reliable option. <br><br>  And here we are come to the aid of iptables and ufw.  I will say right away that my remaining hair almost turned gray until I reached the correct settings for this whole enterprise (I understand that someone will laugh at such ‚Äúlamerism‚Äù). <br><br>  So, ufw (Uncomplicated Firewall) in Lubuntu is enabled, as I later found out, by default.  Therefore, do the following: <br><br> <code>sudo leafpad /etc/ufw/before.rules</code> <br> <br>  At the end of the file, after COMMIT, with the following line we insert the following lines: <br><br> <code># Rules for Dansguardian + Privoxy <br> <br> *nat <br> :PREROUTING ACCEPT [0:0] <br> :POSTROUTING ACCEPT [0:0] <br> :OUTPUT ACCEPT [0:0] <br> -A OUTPUT -p tcp -m tcp --dport 80 -m owner --uid-owner root -j ACCEPT <br> -A OUTPUT -p tcp -m tcp --dport 80 -m owner --uid-owner [parent] -j REDIRECT --to-port 8118 <br> -A OUTPUT -p tcp -m tcp --dport 8118 -m owner ! --uid-owner dansguardian -j REDIRECT --to-port 8080 <br> -A OUTPUT -p tcp -m tcp --dport 80 -m owner ! --uid-owner privoxy -j REDIRECT --to-port 8080 <br> <br> # don't delete the 'COMMIT' line or these rules won't be processed <br> COMMIT <br> <br></code> <br><br>  Save, close, restart: <br><br> <code>sudo ufw disable &amp;&amp; sudo ufw enable <br></code> <br><br>  Everything, now the clever child will not be able to bypass the proxy. <br><br>  Further work worth doing: <br><br><ul><li>  set up a page with the ‚ÄúAccess denied‚Äù template (for example, find a funny picture with Smeshariki and write more cheerful text that go to this site ‚ÄúUzzya!‚Äù) </li><li>  go through the directory with dansguardian carefully - everything is written in detail in the comments in the files, how and what to configure </li><li>  learn how to make a list of bad words in Russian (from dansguardian it seems to be bad with encodings different from utf-8, judging by the forums) </li><li>  it is desirable to find ready-made lists of bad Russian words on the network (so as not to make up oneself and not to excel in the mother tongue) </li></ul><br><br>  In general, judging by the description above, everything seems simple, but in fact I spent several sleepless nights trying to understand why the settings do not work. <br><br>  I look forward to comments - where, if not in them, you can get additional useful information, learn a lot of new <s>things and how you could do the same, only easier and better</s> .  The article was written, first of all, for myself (so that I could go to Habr and check the forgotten settings) and for those who, like me, suffer from parental control in Ubuntu. <br><br>  When setting up dansguardian and privoxy, the following materials helped a lot: <br><br>  <a href="http://blog.bodhizazen.net/linux/how-to-transparent-proxy/">How to transparent proxy</a> <br>  <a href="https://help.ubuntu.com/community/UFW">Ubuntu Documentation&gt; Community Documentation&gt; UFW</a> <br>  well and <a href="http://dansguardian.org/%3Fpage%3Ddocumentation">dansguardian documentation</a> <br><br>  The publication of this article was made possible by <a href="https://habrahabr.ru/users/mrcleaner/" class="user_link">MrCleaner</a> , for which he thanks a lot. </div><p>Source: <a href="https://habr.com/ru/post/119286/">https://habr.com/ru/post/119286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119281/index.html">Spree 0.60.0 released</a></li>
<li><a href="../119282/index.html">About how to create and finance public projects in the field of e-Government</a></li>
<li><a href="../119283/index.html">Specification of system calls of the Chameleon operating system (be careful, lots of pictures!)</a></li>
<li><a href="../119284/index.html">Another Canvas Guide [2]: Styling, Gradients, Shadows</a></li>
<li><a href="../119285/index.html">Context menu design</a></li>
<li><a href="../119287/index.html">3D interface of future OS from Microsoft</a></li>
<li><a href="../119289/index.html">FAQ on Gemei A330</a></li>
<li><a href="../119291/index.html">HTML5 + CSS3 + Daft Punk</a></li>
<li><a href="../119298/index.html">Microsoft can become a partner Baidu</a></li>
<li><a href="../119300/index.html">GPH Caanoo FAQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>