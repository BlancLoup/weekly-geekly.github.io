<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JavaScript hyperspace</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habrovchane! Happy cosmonautics day! 



 In one project, timed to coincide with today's holiday, designers were given the task of creating an imitati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JavaScript hyperspace</h1><div class="post__text post__text-html js-mediator-article">  Habrovchane!  Happy cosmonautics day! <br><br><img src="https://habrastorage.org/storage2/4e7/f83/544/4e7f83544bb315c1381e3a6d5edbbb5c.jpeg"><br><br>  In one project, timed to coincide with today's holiday, designers were given the task of creating an imitation of hyperspace.  After some thought, I decided that it would be more correct to use the Canvas element - there are a lot of elements for SVG, and the browser support is not so good, the video is too large, which means that the file size is too large and the download is long.  Canvas, by the way, is also not an ideal option - it heavily loads the processor and takes a relatively large amount of RAM.  But still‚Ä¶ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><div class="spoiler">  <b class="spoiler_title">Field entry</b> <div class="spoiler_text">  The code will use the reqestAnimFrame function normalizing the work of requestAnimationFrame in different browsers, and the same simple function of randomly generating an integer number.  Here is their source code: <br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.requestAnimFrame = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.requestAnimationFrame || <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.webkitRequestAnimationFrame || <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.mozRequestAnimationFrame || <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.oRequestAnimationFrame || <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.msRequestAnimationFrame || <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/* function */</span></span></span></span><span class="hljs-function"><span class="hljs-params"> callback, </span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/* DOMElement */</span></span></span></span><span class="hljs-function"><span class="hljs-params"> element</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(callback, <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">60</span></span>); }; })(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomInt</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">min, max</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor( <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * (max - min + <span class="hljs-number"><span class="hljs-number">1</span></span>) ) + min; }</code> </pre> <br></div></div><br><h5>  Approach 1. Overlay scaled image. </h5><br>  The design was a picture of the starry sky, which I decided to use.  Took, uploaded, superimposed on Canvas.  Then he added with an increase of one more pixel.  Then another.  The picture is beautiful, but somehow it will not work out. <br><br>  Full code and demo on <a href="http://jsfiddle.net/agegorin/rK8Bx/">jsfiddle</a> . <br><br>  There is nothing to comment on in the code, so just the code. <br><br>  This approach has no life for several reasons: <br><ul><li>  The original image is always the same size, and therefore it is difficult to maintain different resolutions. </li><li>  Few opportunities for customizing the resulting picture. </li><li>  To erase after a while the path already covered is quite difficult. </li><li>  Quality at high magnification is too low. </li><li>  This is an uninteresting decision. </li></ul><br><h5>  Approach 2. Combat. </h5><br>  It was decided to draw each star and train from it separately. <br><br>  Full code and demo on <a href="http://jsfiddle.net/agegorin/sdMPZ/">jsfiddle</a> .  Motion hung on mousemove event. <br><br>  So, create an array of stars, generate initial values ‚Äã‚Äãfor them.  Here, x and y, of course, the coordinates of the star, currentLife - an indicator of the current length of the plume from the star, nx, ny and life are used to reinitialize the star, after stopping.  color is one of the options in the colors array.  In principle, any color could be made at all, but a feature in limiting the number of available colors will come in handy later.  There are two arrays, so at the moment of attenuation it is necessary to show moving and fixed stars simultaneously.  Of course, this can (and, probably, even need to) be done through a single array with a separate property of a star, but further logic depends on it and therefore I am too lazy to rewrite everything. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> colors = [<span class="hljs-string"><span class="hljs-string">"white"</span></span>,<span class="hljs-string"><span class="hljs-string">"rgb(200,200,255)"</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newStar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> life = getRandomInt(<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dx = getRandomInt(<span class="hljs-number"><span class="hljs-number">0</span></span>,canvas.width); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dy = getRandomInt(<span class="hljs-number"><span class="hljs-number">0</span></span>,canvas.height); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">x</span></span> : dx, <span class="hljs-attr"><span class="hljs-attr">y</span></span> : dy, <span class="hljs-attr"><span class="hljs-attr">nx</span></span> : dx, <span class="hljs-attr"><span class="hljs-attr">ny</span></span> : dy, <span class="hljs-attr"><span class="hljs-attr">life</span></span> : life, <span class="hljs-attr"><span class="hljs-attr">currentLife</span></span> : life, <span class="hljs-attr"><span class="hljs-attr">color</span></span> : colors[getRandomInt(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stars = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> finStars = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maxStars = <span class="hljs-number"><span class="hljs-number">350</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; maxStars; i++){ finStars.push(newStar()); }</code> </pre><br><br>  Now let's talk about the star display.  Here we include simple math: <br><br><img src="http://habrastorage.org/storage2/b41/85d/805/b4185d80535f2ecb50289c4385e70900.png"><br><br>  I think it is not necessary to explain that dx refers to dy in the same way as ax to ay.  If we take dx equal to the value of currentLife, then dy = currentLife * (y - cy) / (x - cx).  In addition, each star has two states - when the plume grows and when it decreases.  Implement it simply enough in 4 values: 2 constant and 2 variables.  We draw from (var1&gt; const1? Var1: const1) to (var2 &lt;const2? Var2: const2).  We get first a growing, and then a fading star. <br><br><img src="http://habrastorage.org/storage2/ad1/44f/fc6/ad144ffc6d28aa09243bb9351b948fc1.png"><br><br>  It remains to calculate all this: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = stars[j].x, <span class="hljs-comment"><span class="hljs-comment">// (x,y) -  const1 y = stars[j].y, dx = cx - stars[j].x, dy = cy - stars[j].y; if ( Math.abs(dx) &gt; Math.abs(dy) ){ var xLife = dx &gt; 0 ? stars[j].life : - stars[j].life, // (xLife, yLife) - const2.  star.life    ""  yLife = xLife * dy / dx, xCur = dx &gt; 0 ? - stars[j].currentLife : stars[j].currentLife, // (xCur,yCur) -var1 yCur = xCur * dy / dx, xLast = dx &gt; 0 ? xCur + stars[j].life : xCur - stars[j].life, // (xLast,yLast) - var2 yLast = xLast * dy / dx, mod = "x"; } else { var yLife = dy &gt; 0 ? stars[j].life : - stars[j].life, xLife = yLife * dx / dy, yCur = dy &gt; 0 ? - stars[j].currentLife : stars[j].currentLife, xCur = yCur * dx / dy, yLast = dy &gt; 0 ? yCur + stars[j].life : yCur - stars[j].life, xLast = yLast * dx / dy, mod = "y"; } if(dx &gt; 0 &amp;&amp; dy &gt; 0) { var qx = x - ( xLife &lt; xLast ? xLife : xLast); var qy = y - ( yLife &lt; yLast ? yLife : yLast); ctx.moveTo( qx &lt; cx ? qx : cx, qy &lt; cy ? qy : cy); var sx = x - ( xCur &gt; 0 ? xCur : 0); var sy = y - ( yCur &gt; 0 ? yCur : 0); ctx.lineTo( sx &lt; cx ? sx : cx, sy &lt; cy ? sy : cy); if ( mod == "x"){ ctx.lineTo( qx &lt; cx ? qx : cx, (qy &lt; cy ? qy : cy) + 2); } else { ctx.lineTo( (qx &lt; cx ? qx : cx) + 2, qy &lt; cy ? qy : cy); } ctx.lineTo( qx &lt; cx ? qx : cx, qy &lt; cy ? qy : cy); ctx.closePath(); stars[j].nx = sx &lt; cx ? sx : cx; stars[j].ny = sy &lt; cy ? sy : cy; } if(dx &lt; 0 &amp;&amp; dy &lt; 0) { var qx = x - ( xLife &gt; xLast ? xLife : xLast); var qy = y - ( yLife &gt; yLast ? yLife : yLast); ctx.moveTo( qx &gt; cx ? qx : cx, qy &gt; cy ? qy : cy); var sx = x - ( xCur &lt; 0 ? xCur : 0); var sy = y - ( yCur &lt; 0 ? yCur : 0); ctx.lineTo( sx &gt; cx ? sx : cx, sy &gt; cy ? sy : cy); if ( mod == "x" ){ ctx.lineTo( qx &gt; cx ? qx : cx, (qy &gt; cy ? qy : cy) + 2); } else { ctx.lineTo( (qx &gt; cx ? qx : cx) + 2, qy &gt; cy ? qy : cy); } ctx.lineTo( qx &gt; cx ? qx : cx, qy &gt; cy ? qy : cy); ctx.closePath(); stars[j].nx = sx &gt; cx ? sx : cx; stars[j].ny = sy &gt; cy ? sy : cy; } if(dx &lt; 0 &amp;&amp; dy &gt; 0) { var qx = x - ( xLife &gt; xLast ? xLife : xLast); var qy = y - ( yLife &lt; yLast ? yLife : yLast); ctx.moveTo( qx &gt; cx ? qx : cx, qy &lt; cy ? qy : cy); var sx = x - ( xCur &lt; 0 ? xCur : 0); var sy = y - ( yCur &gt; 0 ? yCur : 0); ctx.lineTo( sx &gt; cx ? sx : cx, sy &lt; cy ? sy : cy); if ( mod == "x" ){ ctx.lineTo( qx &gt; cx ? qx : cx, (qy &lt; cy ? qy : cy) + 2); } else { ctx.lineTo( (qx &gt; cx ? qx : cx) + 2, qy &lt; cy ? qy : cy); } ctx.lineTo( qx &gt; cx ? qx : cx, qy &lt; cy ? qy : cy); ctx.closePath(); stars[j].nx = sx &gt; cx ? sx : cx; stars[j].ny = sy &lt; cy ? sy : cy; } if(dx &gt; 0 &amp;&amp; dy &lt; 0) { var qx = x - ( xLife &lt; xLast ? xLife : xLast); var qy = y - ( yLife &gt; yLast ? yLife : yLast); ctx.moveTo( qx &lt; cx ? qx : cx, qy &gt; cy ? qy : cy); var sx = x - ( xCur &gt; 0 ? xCur : 0); var sy = y - ( yCur &lt; 0 ? yCur : 0); ctx.lineTo( sx &lt; cx ? sx : cx, sy &gt; cy ? sy : cy); if ( mod == "x" ){ ctx.lineTo( qx &lt; cx ? qx : cx, (qy &gt; cy ? qy : cy) + 2); } else { ctx.lineTo( (qx &lt; cx ? qx : cx) + 2, qy &gt; cy ? qy : cy); } ctx.lineTo( qx &lt; cx ? qx : cx, qy &gt; cy ? qy : cy); ctx.closePath(); stars[j].nx = sx &lt; cx ? sx : cx; stars[j].ny = sy &gt; cy ? sy : cy; }</span></span></code> </pre><br><br>  Depending on which quarter our star falls in, the signs in front of the values ‚Äã‚Äãand comparisons differ, so the code is almost duplicated 4 times.  In addition, the variable mod is stored in which coordinate to be considered the leading one (that is, equate dx with currentLife or dy).  Without mod-a, stars near the y-axis will ‚Äúfly‚Äù too quickly, because of a large angle. <br><br>  And the last remark - in the original only two colors are used, therefore in one pass the drawing on the Canvas occurs only two times (since two colors are indicated).  All stars of the same color are formed in one way, after which they are displayed on the Canvas. <br><br>  It remains to wrap all this in a loop and run. <br><br><h5>  Approach 3. Right. </h5><br>  By the right approach, I mean the use of common ready-made solutions and libraries.  Finished solutions for a cursory inspection was not found.  As a library, I decided to try libcanvas.  The blessing on Habrahabr it is presented rather strongly. <br><br>  Full code and demo on <a href="http://jsfiddle.net/agegorin/UM3vR/">jsfiddle</a> .  (JSFiddle may not load the atom and libcanvas from github, so it may be necessary to reload the page several times) <br><br>  The result was the following: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> center, i, helper, stars; LibCanvas.extract(); helper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> App.Light(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Size( <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.width, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.height)); center = helper.app.rectangle.center; stars = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">350</span></span>; i++){ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(getRandomInt(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.width/<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.width),<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.height/<span class="hljs-number"><span class="hljs-number">2</span></span>), length = getRandomInt(<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>), angle = getRandomInt(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">360</span></span>), coords = [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) ], path = helper.createVector( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Path() .moveTo( coords[<span class="hljs-number"><span class="hljs-number">0</span></span>] ) .lineTo( coords[<span class="hljs-number"><span class="hljs-number">1</span></span>] ) .lineTo( coords[<span class="hljs-number"><span class="hljs-number">2</span></span>] ) .lineTo( coords[<span class="hljs-number"><span class="hljs-number">0</span></span>] )).setStyle({<span class="hljs-attr"><span class="hljs-attr">fill</span></span>:<span class="hljs-string"><span class="hljs-string">"rgb(150,150,150)"</span></span>,<span class="hljs-attr"><span class="hljs-attr">stroke</span></span>:<span class="hljs-string"><span class="hljs-string">"rgb(150,150,150)"</span></span>}); point.rotate( - angle.degree(), center); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> star = { <span class="hljs-attr"><span class="hljs-attr">point</span></span> : point, <span class="hljs-attr"><span class="hljs-attr">length</span></span> : length, <span class="hljs-attr"><span class="hljs-attr">angle</span></span> : angle, <span class="hljs-attr"><span class="hljs-attr">coords</span></span> : coords, <span class="hljs-attr"><span class="hljs-attr">live</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">setLength</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.live = <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">0</span></span>].x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.point.x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">0</span></span>].y = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.point.y; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">1</span></span>].x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">0</span></span>].x + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.live * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle.degree() ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">1</span></span>].y = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">0</span></span>].y - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.live * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle.degree() ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">2</span></span>].x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">1</span></span>].x + <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle.degree() ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">2</span></span>].y = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.coords[<span class="hljs-number"><span class="hljs-number">1</span></span>].y + <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle.degree() ); }, <span class="hljs-attr"><span class="hljs-attr">path</span></span> : path }; star.setLength(); stars.push(star); }; } setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">350</span></span>; i++){ stars[i].setLength( stars[i].live + <span class="hljs-number"><span class="hljs-number">1</span></span> ); stars[i].path.redraw(); } },<span class="hljs-number"><span class="hljs-number">10</span></span>); };</code> </pre><br><br>  I must say that here, in contrast to the combat version, adequate mathematics with trigonometry is used, but I did not begin to write on the same functionality.  The speed of code execution on libCanvas is not much different from the native method, but the code is several times smaller and the development speed is much higher.  From the very beginning, I did not use libCanvas for several reasons: I have never used it before, I got used to pure JavaScript and I was afraid that the add-in version would be noticeably slower.  As it turned out he was afraid in vain. <br><br><br><h5>  <b>UPD</b> Correct implementation on TheShock <a href="http://habrahabr.ru/users/theshock/" class="user_link">LibCanvas</a> </h5><br>  An example on <a href="http://jsfiddle.net/UM3vR/24/">jsfiddle</a> .  <a href="http://fiddle.jshell.net/UM3vR/24/show/">Looks especially nice in fullScreen</a> . <br><br>  The creation and adjustment of a star is taken out in a separate class.  For each star is determined by the speed, color and lifetime. <br><br><pre> <code class="javascript hljs">atom.declare( <span class="hljs-string"><span class="hljs-string">'Star'</span></span>, App.Element, { <span class="hljs-attr"><span class="hljs-attr">progress</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">opacity</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">configure</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> screenRectangle = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.layer.ctx.rectangle; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.animate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> atom.Animatable(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).animate; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.from = screenRectangle.getRandomPoint(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Polygon(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.from.clone(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.from.clone(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.from.clone()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle = -<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.from.angleTo(screenRectangle.center); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sin = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle.sin(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cos = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle.cos(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.progressSpeed = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.color = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> atom.Color(<span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>.random(<span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">192</span></span>)).toString(); setTimeout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fadeOut.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>.random(<span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">8000</span></span>)); }, <span class="hljs-attr"><span class="hljs-attr">fadeOut</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.animate({ <span class="hljs-attr"><span class="hljs-attr">time</span></span>: <span class="hljs-number"><span class="hljs-number">2000</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">opacity</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">onComplete</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.destroy }); }, <span class="hljs-attr"><span class="hljs-attr">onUpdate</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sin = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sin, cos = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cos, p = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape.points; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.progress += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.progressSpeed; p[<span class="hljs-number"><span class="hljs-number">1</span></span>].x = p[<span class="hljs-number"><span class="hljs-number">0</span></span>].x + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.progress * cos; p[<span class="hljs-number"><span class="hljs-number">1</span></span>].y = p[<span class="hljs-number"><span class="hljs-number">0</span></span>].y - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.progress * sin; p[<span class="hljs-number"><span class="hljs-number">2</span></span>].x = p[<span class="hljs-number"><span class="hljs-number">1</span></span>].x + <span class="hljs-number"><span class="hljs-number">2</span></span> * sin; p[<span class="hljs-number"><span class="hljs-number">2</span></span>].y = p[<span class="hljs-number"><span class="hljs-number">1</span></span>].y + <span class="hljs-number"><span class="hljs-number">2</span></span> * cos; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redraw(); }, <span class="hljs-attr"><span class="hljs-attr">renderTo</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">) </span></span>{ ctx.save(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opacity &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) ctx.set({ <span class="hljs-attr"><span class="hljs-attr">globalAlpha</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opacity }); ctx.fill( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.color ); ctx.restore(); } });</code> </pre><br><br>  Initially, fewer stars are created, and then added to the frame in the caj: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> App.Light( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Size(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.width || <span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.height || <span class="hljs-number"><span class="hljs-number">800</span></span>), { <span class="hljs-attr"><span class="hljs-attr">intersection</span></span>: <span class="hljs-string"><span class="hljs-string">'full'</span></span>, <span class="hljs-attr"><span class="hljs-attr">invoke</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">200</span></span>; i++) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Star(helper.layer); atom.frame.add(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Star(helper.layer); }); };</code> </pre><br>  // <b>UPD</b> end <br><br>  That's all and again with the day of astronautics! <br><br>  References: <br>  An example with a picture on <a href="http://jsfiddle.net/agegorin/rK8Bx/">jsfiddle</a> . <br>  ‚ÄúCombat‚Äù example on <a href="http://jsfiddle.net/agegorin/sdMPZ/">jsfiddle</a> . <br>  <a href="https://github.com/theshock/atomjs">AtomJS</a> and <a href="https://github.com/theshock/libcanvas/">libCanvas</a> for the third example. <br>  The third example is libCanvas on <a href="http://jsfiddle.net/agegorin/UM3vR/">jsfiddle</a> .  (it may not work right away due to the peculiarities of jsfiddle and github) <br>  <a href="http://iamastronaut.ru/">Promo site</a> for which the effect was created. </div><p>Source: <a href="https://habr.com/ru/post/176325/">https://habr.com/ru/post/176325/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176307/index.html">Homemade bot with camera and wifi control</a></li>
<li><a href="../176309/index.html">Created a program that can play NES-games</a></li>
<li><a href="../176313/index.html">Industrial networks in the context of the fourth industrial revolution</a></li>
<li><a href="../176319/index.html">Russian Code Cup: how it was, how it will be</a></li>
<li><a href="../176323/index.html">PlayScript</a></li>
<li><a href="../176329/index.html">Speed ‚Äã‚Äãorientation: an overview of the "elite" corporate SSD and HDD</a></li>
<li><a href="../176331/index.html">Overclocking for everyone. "Home" overclocking processor with an open multiplier</a></li>
<li><a href="../176335/index.html">Lithuanian authorities use Google Street View to search tax evaders for homeowners</a></li>
<li><a href="../176341/index.html">Russian Post has again distinguished itself: A ban on receiving international mail has been introduced in Sheremetyevo</a></li>
<li><a href="../176343/index.html">To the events in Cyprus. April theses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>