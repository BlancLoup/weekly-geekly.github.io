<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rovnix bootkit update. Article translation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a translation of an article dated July 13, 2012 by Alexander Matrosov, the link to which I found at the end of the post about the leak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rovnix bootkit update. Article translation</h1><div class="post__text post__text-html js-mediator-article">  This article is a translation of an <a href="http://www.welivesecurity.com/2012/07/13/rovnix-bootkit-framework-updated/">article</a> dated July 13, 2012 by Alexander Matrosov, the link to which I found at the end of the <a href="http://habrahabr.ru/company/eset/blog/184576/">post about the leak of Carberp sources</a> .  It seemed to me interesting and I decided to translate it. <br>  To whom it became just as interesting, welcome under cat. <br><a name="habracut"></a><br>  We have been following the activities of the Rovnix bootkit since April 2011 (hereinafter, the speech on behalf of the author - Approx. Lane).  Rovnix was the first family to use the VBR (Volume Boot Record) infection to download unsigned kernel drivers for x64 platforms.  The reason for close attention was the desire of developers Rovnix to bypass the detection of antivirus.  The first sample payload in the wild blocked Internet users from Russia and forced them to send SMS to a short number to unlock <a href="http://blog.eset.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr">(Hasta La Vista, Bootkit: Exploiting the VBR)</a> . <br><br>  These options with Internet blocking have stopped using the bootkit component in the summer of 2011.  At that time, the Rovnix framework was sold to Carberp developers responsible for the Hodprot / Origami botnet <a href="http://blog.eset.com/2011/11/21/evolution-of-win32carberp-going-deeper">(Evolution of Win32Carberp: going deeper)</a> .  Carberp developers only used this framework until the end of 2011.  We have no information about other framework sales.  We only have information confirming that the infection rate is not high with a code based on the Rovnix bootkit.  A few days ago we received some interesting samples and their quick analysis showed the Rovnix.B-like modification of the VBR infection scenario. <br>  After unpacking the dropper, we found a typical component to prepare for the next steps of installing the BkSetup.dll Rovnix bootkit module.  The compilation date of the BkSetup.dll module looked fresh and dated June 24, 2012 (of course, it is possible to fake the date, but until then the developers have not changed it). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/392/16e/12d39216eee605d0a9ac080b6cb8c3d6.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Also found version information in the resource segment BkSetup.dll.  Here she is: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/179/603/617/1796036179ba42ab43ca0c6182951f73.png" alt="image"><br><br>  The file version was changed to 2.4: earlier, Carberp used BkSetup.dll version 2.1 and stored the information in the debug line sent by C &amp; C as debug information. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab7/6b8/75a/ab76b875abcc179e44e63eac2244a88a.png" alt="image"><br><br>  The basic functionality of BkSetup.dll focuses on the process of infecting and creating hidden storage.  The scheme of appeals of the main BkSetup.dll procedures is as follows: <br><br> <a href=""><img width="300" height="110" src="https://habrastorage.org/getpro/habr/post_images/545/e18/45c/545e1845c490e3f69057ad7d28d64318.png" title="four"><br></a> <br><br>  The new sample with the new version of Rovnix bootkit is an indirect evidence of the resumption of sales activity, and in the near future we will be able to disclose the details of the relationship between Rovnix and other malware.  And now we dive into the technical details of Rovnix.D modification. <br><br><h5>  Polymorphic boot code </h5><br><br>  With the modification of Rovnix.B, the boot code used polymorphism to bypass the detection of antivirus static signatures.  Initially, the polymorphic code was found in Carberp samples using the bootkit.  The following figure shows the basics of a polymorphic code. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe0/2cb/70f/fe02cb70fbebbf90bca39dafdbbab1ec.png" alt="image"><br><br>  A simple polymorphism trick based on permutations of the main blocks of code always results in malware control over the decoded VBR code.  The main blocks of code are as follows: <br><br> <a href=""><img width="223" height="300" src="https://habrastorage.org/getpro/habr/post_images/a75/07b/f81/a7507bf810ea9c0eff7399395daab817.png" title="6"><br></a> <br><br>  [Polymorphic code Rovnix.B] <br><br>  The reason for using a polymorphic code is to bypass the detection of a static signature by antiviruses: this code can only be detected using emulation.  The emulation technique is closely related to the sandbox, where the code is executed in a safe virtual environment for the purpose of its dynamic analysis.  Differences between Rovnix.D and Rovnix.B modifications are presented in this graph: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a58/99c/d4b/a5899cd4bae58566199b23e0c97e3635.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/cf3/3f4/d80/cf33f4d80fcf74cd42b9201f7327cbbc.png" alt="image"><br><br>  [Rovnix.D option (top) and Rovnix.B option (bottom)] <br><br>  The storage location of the encrypted VBR code was also changed, and after executing the polymorphic code, control is transferred to the decrypted VBR code.  The unequal arrangement of the encrypted VBR code is as follows: <br><br> <a href=""><img width="300" height="69" src="https://habrastorage.org/getpro/habr/post_images/e81/2dc/113/e812dc1135cfe1da2613e5266bc93b38.png" title="eight"><br></a> <br><br>  We also found changes in the function of decrypting and reading the unsigned driver from the RAW sectors of the hard disk.  These sectors are not used in shared hidden storage, but only as a place to store a malicious driver that injects payloads into specified user processes on an infected machine.  The differences can be seen in the following image: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dac/d68/936/dacd6893680b5714885e84030755fae1.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/ac2/a38/f41/ac2a38f41b1f2ec13ddbb0b2ef4d1939.png" alt="image"><br><br>  [Rovnix.D option (top) and Rovnix.B option (bottom)] <br><br>  All these changes are aimed at bypassing antivirus detection and do not reflect fundamental changes in the overall structure of the Rovnix bootkit. <br><br><h5>  Hidden Storage Changes </h5><br><br>  The structure of the hidden file system is similar to the structure from previous modifications of Rovnix and has already been described in previous blog posts (Rovnix Reloaded: new step of evolution) REFERENCE HERE.  However, minor changes were found in the file system initialization code.  A strange function call was detected to read the INJECTS.SYS file from the hidden storage. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb0/6ad/dbb/fb06addbb8d629ed2292dd836ce93c8b.png" alt="image"><br><br>  This interesting feature extracts one or two paths from the INJECTS.SYS file to the files on the standard file system.  The function code is shown in the figure below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91e/167/0a1/91e1670a1067b284ddb94da71110bfc2.png" alt="image"><br><br>  Flow control will never reach the execution of this code, because the condition is always NULL and control will never be transferred to this code.  In my opinion, this modification in Rovnix.D was used for tests, and we do not see many detections in the wild.  It seems that Rovnix.D is a transitional version in preparation for something else, but at the moment we do not have a clear understanding of what it can be. <br><br><h5>  Payload </h5><br><br>  The payload module includes the ability to download and run additional modules from the C &amp; C server.  This module does not provide hooks and other malicious changes to system memory, and is generally not detected by the most common antivirus programs. <br><br>  C &amp; C Domain is rtttt-windows.com <br><br>  The payload module is multi-threaded and can communicate with a malicious driver.  To ensure synchronization, the payload generates a mutex: Global &lt;Generated_string&gt;.  The call graph for the main thread looks like this: <br><br> <a href=""><img width="300" height="67" src="https://habrastorage.org/getpro/habr/post_images/037/675/eb1/037675eb12a122a52db39d3abf8985f9.png" title="13"><br></a> <br><br>  The payload module can also send encrypted arrays to a malicious driver for subsequent writing to hidden storage and embedding in processes.  Prior to this, Rovnix did not use the functionality for multiple implementations, and provided only one payload module.  Rovnix.D can use several payloads and can be used to lease a botnet, and at the end of the lease term the payload will be changed. <br><br><h5>  Conclusion </h5><br><br>  At the moment, the changes can be seen in the perspective of complex threats for the x64 platform.  Family <br>  Sirefef (ZeroAccess) has migrated into user mode, in its latest versions (ZeroAccess: code injection chronicles) REFERENCE HERE.  Olmarik / Olmasco (TDL4 and MaxSS modifications) does not have a large number of infections in the wild and stopped developing (The Evolution of TDL: Conquering x64).  Why do rootkits / bootkits die for the 64th platform?  In my opinion, the number of ways to infect 64-bit systems is very limited, and the search for something new requires a lot of time and considerable experience from the developer.  Most bootkit infections have used MBR modifications, but this method is rather old and by now the most common antivirus programs provide a check for changing the MBR.  The Rovnix family uses other methods of infection with <br>  modifications of VBR, but a constant stream of new modifications requires a large amount of debugging information about C &amp; C.  The complexity of developing and debugging on multiple platforms is one of the reasons for the high prices of the Rovnix bootkit framework.  For example, a full-featured builder costs $ 60,000, including basic support for six months.  This is a price only for the bootkit, eliminating the cost of privilege elevation exploits in order to allow access to allow measurement to be made deep in the system. <br><br>  In the future, sophisticated stealth technologies will mainly be used for targeted attacks, since the cost of purchasing and using them is not comparable to the expected profit for typical cybercriminals.  Now we have less than ten families of x64 bootkits and their activity in the wild is also declining. <br><br>  SHA1 hashes of the mentioned Rovnix.D droppers: <br><br>  C1C0CC056D31222D3735E6801ACBA763AC024C5B <br>  764B4F0202097F2B41A2821D30A7424490BF3A42 <br><br>  Special thanks to my colleagues Pavel Smierciak and Maxim Grigoryev. <br><br>  Aleksandr Matrosov, Security Intelligence Team Lead </div><p>Source: <a href="https://habr.com/ru/post/184968/">https://habr.com/ru/post/184968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184958/index.html">Drawings in SVG format. Part 1 - Draft Standard</a></li>
<li><a href="../184960/index.html">Self build cURL for iOS and Android</a></li>
<li><a href="../184962/index.html">Travel book tester</a></li>
<li><a href="../184964/index.html">Setting up your own GIT / SVN / Mercurial server based on SCM Manager for Tomcat under Debian</a></li>
<li><a href="../184966/index.html">Home mini climate control do-it-yourself</a></li>
<li><a href="../184970/index.html">Driver for PostgreSQL on Node.js</a></li>
<li><a href="../184972/index.html">Instead of passwords tattoo and ... pills</a></li>
<li><a href="../184974/index.html">Please support the symbol of domestic currency</a></li>
<li><a href="../184978/index.html">1C + offline maps on Android</a></li>
<li><a href="../184982/index.html">SamMobile presented Android 4.3 for the smartphone Galaxy S4 Google Play edition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>