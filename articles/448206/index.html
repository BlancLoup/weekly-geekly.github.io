<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Modular development or the way there, not back</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How we came to a new approach to working with modules in the RaiffeisenBank iOS application. 

 Problem 
 In Raiffeisenbank's applications, each scree...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Modular development or the way there, not back</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/0s/ef/oc/0sefoclv1-emulwycp9cfr6ccoo.jpeg"><br>  <i>How we came to a new approach to working with modules in the RaiffeisenBank iOS application.</i> <br><br><h3>  Problem </h3><br>  In Raiffeisenbank's applications, each screen consists of several modules that are as independent of each other as possible.  "Module" we call the visual component, which has its own presentation.  When designing an application, it is very important to write logic so that the modules are independent and can be easily added or removed without refactoring. <br><a name="habracut"></a><br><h3>  What difficulties we faced: </h3><br>  <b>Highlighting abstraction over architectural patterns</b> <br>  Already at the first stage of development, it became clear that we did not want to be tied to a specific architectural pattern.  MVC is good if you want to display a page with some information.  At the same time, user interaction is minimal or not at all.  For example: the page ‚Äúabout the company‚Äù or ‚Äúuser agreement‚Äù.  VIPER is a good tool for complex modules that have their own logic for working with services, routing and a whole bunch. <br><br>  <b>Problem of interaction and encapsulation</b> <br>  Each architectural pattern has its own structure of construction and its own protocols, which impose restrictions on working with the module.  To abstract a module, you need to highlight the main <b>input / output</b> interfaces. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Routing logic selection</b> <br>  A module as a visual unit should not and cannot be aware of where and how it is shown.  The same module must and can be implemented as an independent unit on any screen or as a composition.  Responsibility for this cannot be placed on the module itself. <br><br><h3>  Previous solution: // Bad deal </h3><br>  We wrote the first solution in Objective-C, and it was based on NSProxy.  The problem of encapsulating the architectural pattern was solved by defenition, which was determined by the specified conditions, that is, the <font color="#cc0000"><b>input / output</b></font> module, which allowed to proxy any calls to the module to its <font color="#cc0000"><b>input</b></font> and receive messages, if any, via <font color="#cc0000"><b>output</b></font> . <br><br>  It was a step forward, but new difficulties arose: <br><br><ul><li>  The <font color="#cc0000"><b>proxy</b></font> interface did not guarantee the implementation of the <font color="#cc0000"><b>input</b></font> protocol; </li><li>  <font color="#cc0000"><b>Output</b></font> had to be described, even if it was not needed; </li><li>  It was necessary to add the <font color="#cc0000"><b>output</b></font> property to the <font color="#cc0000"><b>input</b></font> interface. </li></ul><br>  In addition to <font color="#cc0000">NSProxy,</font> we also implemented the routing by looking at the idea of ‚Äã‚ÄãViperMcFlurry: we made a category on the <font color="#cc0000">ViewController</font> , which began to grow as different variants of displaying the module on the screen appeared.  Of course, we divided the category, but it was still far from a good solution. <br><br>  In general ... the first pancake is lumpy, it became clear that the problem should be solved differently. <br><br><h3>  Solution: // Final </h3><br>  Realizing that with <font color="#cc0000">NSProxy</font> further no way, they took markers in their hands and went to draw.  As a result, the <font color="#cc0000"><b>RFModule</b></font> protocol was <font color="#cc0000"><b>identified</b></font> : <br><br><pre><code class="javascript hljs">@objc protocol RFModule { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> view: ViewController { get } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input: AnyObject? { get } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> output: AnyObject? { get set } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> transition: Transitioning { get set } }</code> </pre> <br>  We purposely abandoned the associated types at the protocol level, and there was a good reason for this: at that time 90% of the code was in Objective-C.  The interaction between ObjC ‚Üê ‚Üí Swift modules would not be possible. <br><br>  In order to use generics and ensure the use of modules, we introduced the <font color="#cc0000">Module</font> class, which satisfies the protocol. <br>  <font color="#cc0000">RFModule</font> : <br><br><pre> <code class="javascript hljs">final <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">I</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Any</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">O</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Any</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RFModule</span></span></span><span class="hljs-class"> </span></span>{ public typealias Input = I public typealias Output = O public <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> setOutput: ((O?) -&gt; Void)? <span class="hljs-comment"><span class="hljs-comment">//... public var input: I? { get { return inputObjc as? I} set { inputObjc = newValue as AnyObject } } public var output: O? { get { return outputObjc as? O} set { outputObjc = newValue as AnyObject } } @objc(input) public weak var inputObjc: AnyObject? @objc(moduleOutput) public weak var outputObjc: AnyObject? { didSet{ setOutput?(output) } } } @objc protocol RFModule { var view: ViewController { get } @objc(input) var inputObjc: AnyObject? { get } @objc(moduleOutput) var outputObjc: AnyObject? { get set } var transition: Transitioning { get set } } public extension RFModule { public var input: AnyObject? { return inputObjc } public var output: AnyObject? { get { return outputObjc } set { outputObjc = newValue} } }</span></span></code> </pre><br>  So we got a typed module.  And as a matter of fact in Swift class <font color="#cc0000">Module is used</font> , and in Objective-C <font color="#cc0000">RFModule</font> .  In addition, it turned out to be a handy tool when mashing types in the place where you need to create arrays: for example, <font color="#cc0000">TabContainer</font> . <br><br>  Since the DI of creating a module is in UserStory's <b>scopes</b> , and assigning the value of output to the place where it will be used cannot describe a simple setter.  <b>"SetOutput"</b> is, in fact, a <i>defenition</i> which, at the stage of assigning <font color="#cc0000">output,</font> will transfer it to the person responsible, depending on the logic of the module. <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModuleInput</span></span></span><span class="hljs-class"> </span></span>{ weak <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delegate: ModuleOutput } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Assembly</span></span></span><span class="hljs-class"> </span></span>{ func someModule() -&gt; Module&lt;ModuleInput, ModuleOutput&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> view = SomeViewController() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = Module&lt;ModuleInput, ModuleOutput&gt;(view: view, <span class="hljs-attr"><span class="hljs-attr">input</span></span>: view) { [weak view] output <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> view?.delegate = output } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> } } ... let assembly: Assembly <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = assembly.someModule() <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.output = self</code> </pre> <br>  <font color="#cc0000">Transitioning</font> is a protocol whose implementations, as the name implies, are responsible for the logic of showing and hiding a module. <br><br><pre> <code class="javascript hljs">protocol Transitioning { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> destination: ViewController? { get } <span class="hljs-comment"><span class="hljs-comment">// should be weak func perform(_ completion: (()-&gt;())?) // present func reverse(_ completion: (()-&gt;())?) // dissmiss }</span></span></code> </pre> <br>  For display it is called - <font color="#cc0000">perform</font> , for concealment - <font color="#cc0000">reverse</font> .  Despite the fact that the protocol has a <font color="#cc0000">destination</font> and at first it seems that there should be a <font color="#cc0000">source</font> .  In fact, the <font color="#cc0000">source</font> may not be, and its type is not always a <font color="#cc0000">ViewController</font> .  For example, if we need the module to open in a new window - this is a <font color="#cc0000">Window</font> , and if you need <font color="#cc0000">embed</font> , you need And parent: <font color="#cc0000">ViewController</font> And container: <font color="#cc0000">UIView</font> . <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PresentTransition</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transitioning</span></span></span><span class="hljs-class"> </span></span>{ weak <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> source: ViewController? weak <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> destination: ViewController? ... func perform(_ completion: (()-&gt;())?) { source.present(viewController: self.destinaton) } }</code> </pre> <br>  Thus, we got rid of the idea to write extensions on the <font color="#cc0000">ViewController</font> and described the logic of how we show our modules in various objects.  This gave us flexibility in routing, i.e.  Now we can show any module both independently and in a complex, and also vary between how it all appears on the screen: in the window (Window), Present, in navigation (push to navigation), embed, in the curtain (cover) . <br><br><h3>  <b>It's all?</b> </h3><br>  There is one more thing that does not give rest.  For the opportunity to easily choose the way the module is displayed and the removal of this logic from it, we paid by losing the ability to set the appearance properties.  For example, if we show it in Navigation, we need to specify what color <font color="#cc0000">barTintColor</font> should be;  or, if we show the module in the blind, there is a need to set the color of the <i>handler</i> . <br><br>  So far, we have solved this problem with the not typed appearance: Any property, and Transitioning, when opening a module, leads to the type with which it works, and, if it did it, it takes the necessary properties. </div><p>Source: <a href="https://habr.com/ru/post/448206/">https://habr.com/ru/post/448206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448190/index.html">Visual logic editor for Unity3d. Part 1</a></li>
<li><a href="../448192/index.html">Why do we need the production of AR and VR</a></li>
<li><a href="../448194/index.html">The candidate's experience in recruiting software developers. Part 2</a></li>
<li><a href="../448196/index.html">The future (or secret present) of plasma engines or how to achieve 27 max moves in the atmosphere</a></li>
<li><a href="../448202/index.html">Manage generator or fight against ADC in STM32F030</a></li>
<li><a href="../448208/index.html">20, 100, 3, 19 - InoThings in numbers</a></li>
<li><a href="../448210/index.html">A satellite cannon, a blaster and a sun-walker: funny and paradoxical projects</a></li>
<li><a href="../448212/index.html">Chinese AIBUS protocol and laboratory chemical reactor</a></li>
<li><a href="../448218/index.html">New MFP security level: imageRUNNER ADVANCE III</a></li>
<li><a href="../448220/index.html">GLTF and GLB format basics, part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>