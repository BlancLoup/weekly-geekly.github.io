<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Facebook XHP. Object Templates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite the fact that Facebook announced XHP in February 2010, there is still very little information about this template engine, although even as an ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Facebook XHP. Object Templates</h1><div class="post__text post__text-html js-mediator-article">  Despite the fact that Facebook announced XHP in February 2010, there is still very little information about this template engine, although even as an idea XHP is very interesting. <br><br>  In this article I will try to give a brief overview of XHP, the main pros and cons, and also address performance issues. <br><a name="habracut"></a><br><br><blockquote>  XHP is a PHP extension that complements the syntax of the language, on the one hand, improving the perceptibility of the front-end code and, on the other, helping to avoid XSS attacks.  [one] </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/688/9fd/56c/6889fd56c459c04a6e4b2b874bf80736.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  So, what do we need to display some HTML (XML) markup? </h5><br>  If it is rough, the following will be required: <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  HTML $html = '&lt;div id="mydiv"&gt;&lt;p&gt;, !&lt;/p&gt;&lt;/div&gt;'; echo $html;</span></span></code> </pre> <br><br>  Now the same thing using XHP: <br><pre> <code class="php hljs">$html = &lt;div id=<span class="hljs-string"><span class="hljs-string">"mydiv"</span></span>&gt;&lt;p&gt;, !&lt;/p&gt;&lt;/div&gt;; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $html;</code> </pre><br><br>  or so: <br><pre> <code class="php hljs">$html = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> :div(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'mydiv'</span></span>,), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> :p(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">', !'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $html;</code> </pre><br><br>  I think that after these examples, it has already become clear to the majority that ‚ÄúXML‚Äù is translated by the XHP extension into certain classes that describe the html-element. <br>  In this, by and large, is the whole essence of the XHP template engine.  Now you are not working with "string HTML".  From the word "absolutely", since each node is an object with its own properties. <br><br>  In addition to everything, any user content is screened, i.e.  for any non-html-element child, <b>htmlspecialchars is</b> automatically processed.  Yes, and your content received from the database will also be shielded by default, believe me, this is better for you. <br><br>  PHP: <br><pre> <code class="php hljs">$html = <span class="hljs-string"><span class="hljs-string">"&lt;div&gt;{$_POST['xss_content']}&lt;/div&gt;"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  </span></span></code> </pre><br><br>  XHP: <br><pre> <code class="php hljs">$html = &lt;div&gt;{$_POST[<span class="hljs-string"><span class="hljs-string">'xss_content'</span></span>]}&lt;/div&gt;; <span class="hljs-comment"><span class="hljs-comment">// </span></span></code> </pre><br><br>  Another feature coming from the nature of XHP is HTML (XML) built-in validation.  You cannot instantiate a class like this: <br><pre> <code class="php hljs">$html = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> myHtml(;</code> </pre><br>  This means that you can‚Äôt leave unclosed, with the wrong nesting html-elements can't (short tags are supported). <br><br><h5>  Now for the cons </h5><br><br>  The only obvious drawback of the above scheme is that from which its advantages flow - <b>each element is an object</b> . <br>  Accordingly, the layout of the 2000 nested tags is 2000 nested objects. <br><br>  What we get at the output is clear: <br><ul><li>  Increased memory consumption </li><li>  Performance degradation </li></ul><br><br>  Increased memory consumption to affect the special meaning in the framework of this article I do not see, because  XHP objects are quite simple, and quite a lot of memory is allocated for the process (640 kilobytes will be enough for everyone (s)). <br>  But creating a set of nested objects and converting XHP markup to objects should increase the rendering time.  The question is how much? <br><br>  Fortunately, one <a href="http://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B5%25D1%2580%25D0%25B4%25D0%25BE%25D1%2580%25D1%2584,_%25D0%25A0%25D0%25B0%25D1%2581%25D0%25BC%25D1%2583%25D1%2581">Rasmus Lerdorf</a> back in 2010 conducted a comparative analysis of the ‚Äúrate of fire‚Äù of XHP vs PHP native and obtained the following results [2]: <br><br><ul><li>  PHP: ~ 97% degradation (30 rps - 1300 rps) </li><li>  PHP + APC: ~ 75% degradation (330rps - 1460 rps) </li></ul><br><br>  Since <s>it was a long time ago and the</s> tests were <s>wrong</s> , they turned out to be somewhat synthetic - a tiny HTML fragment (form) was generated, I decided that I needed to carry out comparative tests on <a href="http://hhvm.com/">HHVM</a> (in which XHP support is embedded out of the box, PHP will have to build a separate module). <br><br>  Unfortunately, the description of all XHP classes remained in php files (Rasmus wrote that perhaps the problem of poor performance can be partially nihilated by transferring the declarations of base classes to the compiled module), for <a href="http://hacklang.org/">Hack, the</a> authors propose only to replace &lt;? Php with &lt;? Hh / / decl, so the only hope was on the XHP parser markup itself. <br><br>  And, of course, for rendering, I did not take 4-5 tags, but a full Layout.  The siege settings are similar to those in the example of Rasmus. <br><br>  HHVM + XHP <br><pre> <code class="bash hljs">siege -c 3 -b -t30s http://****.ru Transactions: 6003 hits Availability: 100.00 % Elapsed time: 29.54 secs Data transferred: 8.80 MB Response time: 0.01 secs Transaction rate: 203.22 trans/sec Throughput: 0.30 MB/sec Concurrency: 3.00 Successful transactions: 6003 Failed transactions: 0 Longest transaction: 0.03 Shortest transaction: 0.00</code> </pre><br><br>  HHVM + PHP <br><pre> <code class="bash hljs">siege -c 3 -b -t30s http://****.ru Transactions: 19583 hits Availability: 100.00 % Elapsed time: 29.96 secs Data transferred: 33.22 MB Response time: 0.00 secs Transaction rate: 653.64 trans/sec Throughput: 1.11 MB/sec Concurrency: 2.99 Successful transactions: 19583 Failed transactions: 0 Longest transaction: 0.02 Shortest transaction: 0.00</code> </pre><br><br>  Degradation of about 68%.  Better than 75%, but still relatively much. <br>  Why "relative"?  Because the test "application" consisted only of View, without accessing the database, without business logic and other things. <br>  In reality, it may happen that the performance degradation at the View rendering stage as a percentage will be negligible against the background of the rest of the application. <br><br>  In the end, the question of choosing one or another template engine remains with the system architect. <br><br>  Information for review: <br><ol><li>  <a href="https://www.facebook.com/notes/facebook-engineering/xhp-a-new-way-to-write-php/294003943919">XHP: A New Way to Write PHP</a> by Facebook </li><li>  <a href="http://toys.lerdorf.com/archives/54-A-quick-look-at-XHP.html">A quick look at XHP</a> by Rasmus Lerdorf </li><li>  <a href="https://github.com/facebook/xhp">XHP</a> on GitHub </li></ol></div><p>Source: <a href="https://habr.com/ru/post/229941/">https://habr.com/ru/post/229941/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229929/index.html">Why actually use micromarking. Review from Yandex</a></li>
<li><a href="../229931/index.html">Update Windows Phone 8.0 application to Windows Phone 8.1 (XAML)</a></li>
<li><a href="../229933/index.html">Wargaming Developers Contest: Seven Top Contest Questions</a></li>
<li><a href="../229937/index.html">Looking for a melody by fragment</a></li>
<li><a href="../229939/index.html">How to make friends with a hedgehog and a man: the experience of using PowerShell in web applications</a></li>
<li><a href="../229943/index.html">The notorious programmer: Informal stories and frank conversations about the IT-industry</a></li>
<li><a href="../229945/index.html">WebCamp Special Rapporteur: Mobile Day - Andrian Budantsov, co-founder of Readdle</a></li>
<li><a href="../229947/index.html">Development of a payment system for the site using CyberSource Secure Acceptance</a></li>
<li><a href="../229949/index.html">Implementation and testing of facial recognition algorithm</a></li>
<li><a href="../229953/index.html">Webinar "Using public clouds in retail"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>