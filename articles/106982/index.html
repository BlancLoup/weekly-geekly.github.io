<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visual Studio Solution Pivot Viewer. Addon to Visual Studio 2010 for visualizing the structure and code metrics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, Sergei Zvezdin ( sergun ) announced a brainstorm in order to generate a number of ideas for a possible implementation in the form of ad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visual Studio Solution Pivot Viewer. Addon to Visual Studio 2010 for visualizing the structure and code metrics</h1><div class="post__text post__text-html js-mediator-article">  Some time ago, Sergei Zvezdin ( <a href="https://habrahabr.ru/users/sergun/" class="user_link">sergun</a> ) <a href="http://blog.zwezdin.com/ru/218">announced a</a> brainstorm in order to generate a number of ideas for a possible implementation in the form of addons for Visual studio 2010. I described my Xaps Minifier and suggested another one.  The idea was to use the Silverlight PivotViewer control to visualize the source code. <br><a name="habracut"></a><br><h4>  Theory </h4><br>  PivotViewer control can be used to visualize a large amount of data and allows you to filter and sort them by any criterion.  Source code can be used as data that can be analyzed by developers / team leaders to find potential problem areas.  By such places, I mean classes, methods that should be refactored.  For example, it is very difficult to support a large class, method, etc.  Obviously, such a code is refactored. <br><br>  Thus, my addon should analyze the source code of the project, prepare the data for the PivotViewer control and display the control itself and the data in it. <br><br><h4>  High level architecture </h4><br><img src="https://habrastorage.org/storage/5e2bc7b2/70e3fdef/d8be93f7/d2e85290.png"><br>  There are several limitations when using the PivotViewer control. <br><ul><li>  You should use the Silverlight version of the control, since  There is no separate WPF version of this control.  This is because WPF does not include the MultiScaleImage (Deep Zoom) mechanism. </li><li>  You should use a separate web server to host the Silverlight application in it, because  PivotViewer control does not support local collections. </li></ul><br>  I will describe each step presented in the diagram. <br><ol><li>  I should bypass all projects, classes, methods in order to get all the information about the source code of the application.  This information will be used to build a picture in PivotViewer. </li><li>  I should deploy the web server infrastructure.  This means creating folders for the web server and for the results of processing the source code, as well as placing the web server itself on disk. </li><li>  I should serialize and save the data that was obtained during the processing of the source code. </li><li>  I should start a web server that will host the Silverlight application with the PivotViewer control onboard.  I'm going to use Cassini (a web server that is used to develop and debug web applications in Visual Studio).  It is lightweight and comes with Visual Studio. </li><li>  The application starts and opens in the Web Browser tab inside Visual Studio. </li><li>  PivotViewer control starts loading data and transforms it into internal collections, which are then rendered. </li></ol><br><h4>  Features of the implementation </h4><br><h5>  Source code processing </h5><br>  I use the same technique that I use in the <a href="http://habrahabr.ru/blogs/silverlight/98939/">XapsMinifier</a> add-on to Visual Studio.  I bypass all the project within the current loaded solution, all files within the project, all elements within the file - classes, interfaces, structures, etc.  I create one big data set that contains all the necessary elements: <br><ul><li>  Is the class abstract </li><li>  The number of parts that make up partial class / interface / structure </li><li>  Number of lines of class / interface / structure code </li><li>  The number of members (methods, properties, etc.) that contains the class / interface / structure </li><li>  Data item name </li><li>  The full name of the element (namespace + name) </li><li>  The path to the file that contains this data item. </li><li>  The name of the project where the item is located </li><li>  The programming language in which this element is written (C #, VB, Managed C ++, etc.) </li></ul><br><h5>  Web server deployment </h5><br>  In accordance with my idea, you should place a web server for each project that is processed by this utility.  Thus, I have to create a folder for the Silverlight application and for the file that contains the serialized data for the PivotViewer control.  I create the <i>_PivotViewer</i> folder in the same directory where the solution file is located.  This folder will contain a file with serialized data ( <i>PivotClassData.bin</i> ) and a <i>Server</i> folder with a ready Silverlight project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I can rely on the post-build event of the <i>WebServer</i> project to archive all the required files for publishing the web server (* .dll, * .aspx, etc.).  This archive is connected to the <i>PackageTools</i> project as an embedded resource. <br><br>  <i>Example:</i> <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$(SolutionDir)Externals\7z.exe a -r -tzip -mx9 &lt;br&gt; $(SolutionDir)PackageTools\Resources\WebServer.zip $(ProjectDir)* -x!obj &lt;br&gt; -x!properties -x!.svn -x!_svn -x!*.csproj -x!*.csproj.user &lt;br&gt; -x!*.publish.xml -x!*.bat -x!*.cs -x!*.designer.cs -x!*.pdb</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  I unpack the archive into the <i>Server</i> folder using the <i>ICSharpCode.SharpZipLib</i> library. <br><br><h5>  Data serialization </h5><br>  I use binary serialization to minimize the size of the data file and speed up the processing. <br><br><h5>  Web server launch </h5><br>  I use the following command line to run Cassini. <br><br>  <i>Example:</i> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">"C:\Program Files\Common Files\Microsoft Shared\DevServer\10.0\WebDev.WebServer40.EXE" &lt;br&gt; /port:8899 /path:" <font color="#0000ff">&lt;</font> <font color="#800000">path_to_solution_folder</font> <font color="#0000ff">&gt;</font> \_PivotViewer\Server" /vpath:"/"</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This command will launch the web server relative to the <i>&lt;solution_path&gt; \ _ PivotViewer \ Server</i> folder and the web site will be accessible at <i>http: // localhost: 8899</i> . <br><br><h5>  Application launch </h5><br>  I use the standard Visual studio extension interface to open the Web Browser tab and navigate to the required path ( <i>http: // localhost: 8899</i> ). <br><br>  <i>Example:</i> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">IVsWindowFrame frame;&lt;br&gt;IVsWebBrowsingService webVrowserService = <font color="#0000ff">this</font> .GetService( <font color="#0000ff">typeof</font> (SVsWebBrowsingService))&lt;br&gt; <font color="#0000ff">as</font> IVsWebBrowsingService;&lt;br&gt;webVrowserService.Navigate( <font color="#A31515">"http://localhost:8899/SilverlightPivotViewerTestPage.aspx"</font> ,&lt;br&gt;   ( <font color="#0000ff">uint</font> )__VSCREATEWEBBROWSER.VSCWB_FrameMdiChild, <font color="#0000ff">out</font> frame);</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h5>  Data loading </h5><br>  I do not use <a href="http://www.getpivot.com/developer-info/">simple or related collections</a> .  they require many preliminary steps.  I use the just-in time collection and the <i>Pivot_JIT_Sample</i> application to build a <i>JIT collection</i> server.  I implement the <code>CollectionFactoryBase</code> class that reads the serialized data from a file and builds the JIT collection. <br><br>  <i>Example:</i> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> MakeCollectionItem(PivotClassElementsData item, Collection collection)&lt;br&gt;{&lt;br&gt;  Guard.ArgumentNotNull(item, <font color="#A31515">"item"</font> );&lt;br&gt;  Guard.ArgumentNotNull(collection, <font color="#A31515">"collection"</font> );&lt;br&gt;&lt;br&gt;  collection.AddItem(item.Name, <font color="#0000ff">null</font> , <font color="#0000ff">null</font> ,&lt;br&gt; <font color="#0000ff">null</font> &lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Lines count"</font> , item.CodeLinesCount)&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Is Static Class"</font> , item.IsStatic.ToString())&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"File path"</font> , item.Path)&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Parts count"</font> , item.PartsCount)&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Full name"</font> , item.FullName)&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Language"</font> , item.Language)&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Members count"</font> , item.MembersCount)&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Class Name"</font> , item.Name)&lt;br&gt;      , <font color="#0000ff">new</font> Facet( <font color="#A31515">"Project name"</font> , item.ProjectName)&lt;br&gt; <font color="#008000">//, new Facet("# of switch statements", item.SwitchCount)</font> &lt;br&gt;      );&lt;br&gt;&lt;br&gt;  collection.SetFacetDisplay( <font color="#A31515">"File path"</font> , <font color="#0000ff">false</font> , <font color="#0000ff">true</font> , <font color="#0000ff">true</font> );&lt;br&gt;  collection.SetFacetDisplay( <font color="#A31515">"Full name"</font> , <font color="#0000ff">false</font> , <font color="#0000ff">true</font> , <font color="#0000ff">true</font> );&lt;br&gt;  collection.SetFacetFormat( <font color="#A31515">"Lines count"</font> , <font color="#A31515">"0"</font> );&lt;br&gt;  collection.SetFacetFormat( <font color="#A31515">"Parts count"</font> , <font color="#A31515">"0"</font> );&lt;br&gt;  collection.SetFacetFormat( <font color="#A31515">"Members count"</font> , <font color="#A31515">"0"</font> );&lt;br&gt;}&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  I do not display some parameters in the filtering area (‚ÄúFile path‚Äù, ‚ÄúFull name‚Äù), but they are available on the information panel. <br><br><h4>  Installation and use </h4><br>  This extension can be installed via the <i>Visual Studio Extension Manager</i> (Main menu-Tools-Extension Manager-Online Gallery) using the online extension store.  The current version of the application is 0.9 beta. <br><br>  In order to launch the visualization of the solution, open it in Visual studio, right-click on the solution itself in the Solution Explorer and select the menu item <i>Solution Pivot Viewer</i> . <br><br><img src="https://habrastorage.org/storage/23296b59/cae92d3e/30c64056/d3e67560.png"><br><br>  As soon as this action is triggered, the extension will begin to parse the source code, receive data for the PivotViewer control, deploy the web application with the Silverlight PivotViewer control and open the web page of the application. <br><br><img src="https://habrastorage.org/storage/48434744/52c53dab/e603b8e7/a7769eac.png"><br><br>  Having played with this extension, you can quickly and clearly get information about the application and its source code. <br><br><h4>  Known issues / limitations </h4><br>  Since this is a beta version, the extension has certain limitations and known problems. <br><ul><li>  Only one collection is supported - classes / interfaces / structures </li><li>  The extension cannot determine whether the Cassini server is running or not, and therefore an exception may occur that, however, does not affect the main function of the application. </li><li>  It uses a hard-coded port for Cassini - 8899. This means that for the expansion to work, you must make sure that the port is open and not busy </li><li>  Requires an installed Cassini server on the computer </li><li>  The application has no interface for displaying the progress of the operation or displaying the settings. </li></ul><br><h4>  Future plans </h4><br><ul><li>  Add a wizard to configure the application </li><li>  Add new collection types (files, members) </li><li>  Add screen printing feature </li><li>  Add support for MEF-based extensions to support the computation of various metrics </li></ul><br><h4>  Source texts </h4><br>  The sources for this extension are available <a href="">here</a> . <br><br><h4>  Leave your opinion </h4><br>  I would be very interested to know your opinion about this extension, what features to add, what to change, etc.  Contact us! </div><p>Source: <a href="https://habr.com/ru/post/106982/">https://habr.com/ru/post/106982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106974/index.html">Release candidates for Windows 7 SP1 and Windows Server 2008 R2 SP1 are officially available.</a></li>
<li><a href="../106976/index.html">Now getting rid of unnecessary electronics is quite simple!</a></li>
<li><a href="../106978/index.html">Fan Games Text Festival</a></li>
<li><a href="../106979/index.html">New record of range of run of the electric car without recharge</a></li>
<li><a href="../106980/index.html">Nook Color officially unveiled</a></li>
<li><a href="../106986/index.html">Mobile Hippos or HippoApp</a></li>
<li><a href="../106987/index.html">Universal manipulator</a></li>
<li><a href="../106991/index.html">About "BIZ limit" tariffs and not only</a></li>
<li><a href="../106994/index.html">Evernote 4 for Windows is here!</a></li>
<li><a href="../106997/index.html">Do you like that the link on the header of the link to Habr√© leads to an external site?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>