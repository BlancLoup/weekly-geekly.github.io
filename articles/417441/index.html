<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we outbid ordinary players and their servers or DDoS: a practical guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Talking about new projects is, of course, good, but everything does not always work out the way we want. 

 In general, we began to recall fakapas fro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we outbid ordinary players and their servers or DDoS: a practical guide</h1><div class="post__text post__text-html js-mediator-article">  Talking about new projects is, of course, good, but everything does not always work out the way we want. <br><br>  In general, we began to recall fakapas from the past, when the solution of one problem added new ones, they got carried away and decided to share a couple.  How to ban innocent players, punch your own servers, make a mistake in one letter and catch tons of negatives from users - that‚Äôs all we love. <br><br><img src="https://habrastorage.org/webt/ug/ah/u-/ugahu-bcho92pvjvqfqy46h26fa.jpeg"><br><a name="habracut"></a><br><h2>  Lost - get a ban </h2><br>  There was a time when our game War Robots was attacked by cheaters because of flaws in architecture.  There were utilities that increase the stock of health to cosmic values, which made them almost immortal.  We finally <a href="https://habr.com/company/pixonic/blog/343306/">closed the</a> task with the cheaters, but not immediately. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At first we wanted to solve the problem beautifully at the technical level: block the ability to change the parameters of the robot on the client.  We failed to do this (then, of course, we found a way).  And then the first working solution was banhammer, which calculated cheaters using a simple scheme: <br><br><ol><li>  Each robot after the match was tested for damage. </li><li>  If the damage received by the robot exceeded the value of its maximum health, then the player was recognized as a cheater, and his account was blocked. </li></ol><br>  The decision was a crutch, but effective.  Problems started because of it a little later, but first you‚Äôll have to tell a little about another bug and features of the development of synchronous mobile PvP. <br><br>  When players have a bad internet connection (and this is a normal situation in mobile games), absolutely magic things can happen when data is exchanged between client and servers.  Requests from clients come incomplete, not in that order or with a strong delay.  In general, one server bug allowed that if a connection was poor, the client could send the results of the battle two or even three times in a row.  Accordingly, players could receive 2-3 times more rewards or accidentally spend twice as many resources on repairs. <br><br>  We solved this problem rather quickly: the server profile learned to ignore the extra results of the battle from one client.  After successful testing, we have released a new version. <br><br>  This is where we are covered. <br><br>  A whole bunch of players every day began to ban Banhammer, about which we safely forgot, because  the problem of unkillable robots with an endless supply of health was far in the past.  It turned out that as soon as the player's client sent the results of one battle to the server in double, the bankhammer took it so that every dead robot was killed twice - that is,  He took damage twice his health.  And after each battle, the players flew to the packs in the ban. <br><br>  All, of course, unban and even paid compensation, but the situation is so-so, not exactly positive. <br><br><img src="https://habrastorage.org/webt/rg/le/pc/rglepcj33omwpzwitdrmijjewkk.gif"><br><br><h2>  How to arrange yourself DDoS </h2><br>  Already <a href="https://habr.com/company/pixonic/blog/346374/">wrote</a> about the evolution of our server infrastructure, and now remembered one case of that time. <br><br>  At the end of 2015, the release of the long-awaited feature in War Robots - clans.  When the update came out (and it was late at night), we opened the champagne and everything would be fine.  But it was not long to rejoice - the servers suddenly became ill.  It turned out that we made a DDoS attack with our own hands. <br><br>  How?  Very simple.  The client on the combat results screen in trying to get information about clans of players made too many requests.  And when the server responded ‚Äúleave me alone, error‚Äù, the client returned to the server without any timeout. <br><br>  The same night, we flashed a flag (we did not have time to close the champagne), which was controlled from the profile server - it completely blocked the work of the Hangar Client API.  To the players who have already joined the clans, we left this box enabled, that is, everything worked for them, because their number was not enough to secure the server. <br><br>  As a result, we began to correctly process the server's responses in the game, and in case of an error - to increase the timeout for retry request. <br><br><h2>  "Free" rating </h2><br>  A separate story is when a poor-quality realization meets the human factor.  Only now no one was banned, but on the contrary distributed a rating to the left and to the right.  In short, one night our monitoring (and we are monitoring <a href="https://habr.com/company/pixonic/blog/325040/">everything at all</a> ) recorded a very rapid growth in the rating of players. <br><br>  Then it turned out that the implementation of the scoring itself in theory allowed duplicate data.  But no one would pay attention to this if the administrator on duty due to a typo in one letter accidentally restarted the server, which should not have been working.  It was he who began to double the players ratings. <br><br>  I had to urgently release the fix and go through the base to remove all the extra points that had time to accrue.  To prevent this from happening - on all servers, we cut out the old scheme for calculating points and ruled out the possibility of erroneous launching of services where they should not work.  It was necessary to do this from the very beginning, of course, but it would be too boring. <br><br><h2>  Priceless prize </h2><br>  There was another typo with a typo, but much more serious. <br><br>  Somehow on Halloween we launched a new gucah lottery.  If anyone does not know, Gach is the mechanic of getting an item from several different ones at random.  In the lottery, the player had a limited visible set of prizes of different value.  For each discovery, the player received 1 prize, this prize was removed from the set, and the opening price increased each time.  Thus, the player could buy all the prizes of the lottery guaranteed, and the lucky ones took out the most valuable prizes at the first discoveries (and, accordingly, received them very cheaply). <br><br>  In general, we dabbed a feature with sweat and blood for the event, tested it, laid it out.  Launch, update graphics ... Hurray!  They rushed up! .. And at the same time tons of negativity in the community hit us, that we allegedly deceive our players. <br><br>  After half an hour, the lottery had to be turned off.  Yes, we really cheated the players.  But the matter was not at all in the chances or the prizes - the matter was in one letter. <br><br>  The lottery interface shows the cost of the current opening (the one that increased each time), for example, PRICE: 100 Gold.  Here's what the concept looked like (note that the idea on each card also additionally indicates the price of opening it): <br><br><img src="https://habrastorage.org/webt/ns/a6/xv/nsa6xvnjqudlstg_m2veg5-ohxm.jpeg"><br><br>  And this is how it went on sale, when as a result of a series of "improvements" PRICE (price for participation in the lottery) for the designer suddenly turned into a PRIZE (prize): <br><br><img src="https://habrastorage.org/webt/1u/s9/lh/1us9lhgsdyfunbhmvsfdfpji_d8.jpeg"><br><br>  At the same time, because of the confusion before the release and the bad check from each individual card, the price for discovery was lost, which all together confused the players. <br><br>  And they reflexively pressed the button until they spent all the hard.  Well, what, the "prize" is increased with each purchase.  And so it was in 18 languages.  At the same time, we also had locales on the client, so even one letter could be fixed only through a hotfix. <br><br>  As a result, the situation was unfolded, additional check points were entered, gold was returned to the players and the locales were written down on the server so that nothing like this would happen again. <br><br>  It's time to enter the hashtag <i># kosyakinaprode</i> </div><p>Source: <a href="https://habr.com/ru/post/417441/">https://habr.com/ru/post/417441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417429/index.html">Set up a convenient npm project for yourself and the team or a little about modern front-end tools</a></li>
<li><a href="../417431/index.html">Anti-interviews</a></li>
<li><a href="../417435/index.html">In the config Aliens: Colonial Marines found a typo, because of which for four years the game AI buggy</a></li>
<li><a href="../417437/index.html">Projector vs flat panel. Try on an ophthalmologist's robe and find out why size matters</a></li>
<li><a href="../417439/index.html">The Intel Core i7-8086K (Part 1)</a></li>
<li><a href="../417443/index.html">Organic matter on Mars could have been discovered 40 years ago if a different method of analysis were used.</a></li>
<li><a href="../417445/index.html">Optimizing the rendering of scenes from the Disney cartoon "Moana". Part 2</a></li>
<li><a href="../417447/index.html">Expedition to the mysterious fairy circles in the Namib Desert</a></li>
<li><a href="../417449/index.html">Jurassic World: Can we really resurrect dinosaurs?</a></li>
<li><a href="../417451/index.html">Five common mistakes novice managers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>