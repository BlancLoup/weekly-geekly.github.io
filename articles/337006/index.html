<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Microsoft Excel add-in development using Excel-DNA library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I present to your attention a step-by-step guide for developing an add-in for Excel. 
 Excel-DNA is a free open-source library for crea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Microsoft Excel add-in development using Excel-DNA library</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  I present to your attention a step-by-step guide for developing an add-in for Excel. <br>  Excel-DNA is a free open-source library for creating Excel extensions.  Project site <a href="https://excel-dna.net/">excel-dna.net</a> <br><br>  Throughout this tutorial, we will develop an add-in that allows you to download data from a third-party site to the current page by pressing a button.  So, let's begin. <br><a name="habracut"></a><br><h2>  Add-in development </h2><br>  To begin, create a new project of the Class Library type, let's call it cryptostar.  Let's connect the excel-dna library: <br><br> <code>Install-Package ExcelDna.AddIn <br> Install-Package ExcelDna.Integration <br> Install-Package ExcelDna.Interop</code> <br> <br>  Now we can start implementation.  We will use <a href="https://api.coinmarketcap.com/v1/ticker/">api.coinmarketcap.com/v1/ticker</a> API as a data source, the query returns an array of objects containing information about various digital currencies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs json">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"bitcoin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bitcoin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"symbol"</span></span>: <span class="hljs-string"><span class="hljs-string">"BTC"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rank"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"4512.7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price_btc"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"24h_volume_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"2711790000.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"market_cap_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"74640450605.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"available_supply"</span></span>: <span class="hljs-string"><span class="hljs-string">"16540087.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"total_supply"</span></span>: <span class="hljs-string"><span class="hljs-string">"16540087.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_1h"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_24h"</span></span>: <span class="hljs-string"><span class="hljs-string">"-7.03"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_7d"</span></span>: <span class="hljs-string"><span class="hljs-string">"3.95"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"last_updated"</span></span>: <span class="hljs-string"><span class="hljs-string">"1504391067"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"ethereum"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ethereum"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"symbol"</span></span>: <span class="hljs-string"><span class="hljs-string">"ETH"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rank"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"336.689"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price_btc"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0740905"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"24h_volume_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"1402470000.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"market_cap_usd"</span></span>: <span class="hljs-string"><span class="hljs-string">"31781255657.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"available_supply"</span></span>: <span class="hljs-string"><span class="hljs-string">"94393508.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"total_supply"</span></span>: <span class="hljs-string"><span class="hljs-string">"94393508.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_1h"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.36"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_24h"</span></span>: <span class="hljs-string"><span class="hljs-string">"-13.01"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"percent_change_7d"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.84"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"last_updated"</span></span>: <span class="hljs-string"><span class="hljs-string">"1504391070"</span></span> } ]</code> </pre> <br>  First, let's write the data loader: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Ticker</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> symbol { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? rank { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> price_usd { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? price_btc { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> market_cap_usd { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? available_supply { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? total_supply { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> percent_change_1h { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> percent_change_24h { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> percent_change_7d { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> last_updated { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataLoader</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Ticker[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadTickers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HttpWebRequest request = (HttpWebRequest)WebRequest.Create(<span class="hljs-string"><span class="hljs-string">"https://api.coinmarketcap.com/v1/ticker/"</span></span>); request.Method = <span class="hljs-string"><span class="hljs-string">"GET"</span></span>; request.ContentType = <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = request.GetResponse()) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = response.GetResponseStream()) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> responseReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(stream)) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> data = responseReader.ReadToEnd(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringReader(data)) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsonReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonTextReader(sr)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = JsonSerializer.CreateDefault() .Deserialize&lt;Ticker[]&gt;(jsonReader); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items; } } } }</code> </pre><br>  I will not explain this code, since it is quite simple and has a rather indirect relation to our topic. <br><br>  Now we can get data in the form of an array of objects of the <i>Ticker</i> class.  It's time to learn how to display this data on the current page. <br><br>  To display the data, we need an instance of the class <i>Microsoft.Office.Interop.Excel.Application</i> .  It provides access to the Excel object model, through it we will be able to get an object-page (worksheet) and write our data in the right cells.  Let's write a class to write data to the page. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataRender</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RenderData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Ticker[] tickers</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  dynamic        Excel dynamic xlApp = ExcelDnaUtil.Application; //    var ws = xlApp.ActiveSheet; //        if (ws == null) return; //    ws.Cells.Clear(); //   reflection    var props = typeof(Ticker).GetProperties(); for (var j = 0; j &lt; props.Length; j++) { var prop = props[j]; var cell = ws.Cells[1, j + 1]; cell.Value2 = prop.Name; cell.Font.Bold = true; } //      ,       Range.          ,          . object[,] data = new object[tickers.Length, props.Length]; for (var i = 0; i &lt; tickers.Length; i++) { for (var j = 0; j &lt; props.Length; j++) { var val = props[j].GetValue(tickers[i], null); data[i, j] = val; } } var startCell = ws.Cells[2, 1]; var endCell = ws.Cells[1 + tickers.Length, props.Length]; var range = ws.Range[startCell, endCell]; range.Value2 = data; var firstCell = ws.Cells[1, 1]; //  ,       ws.Range[firstCell, endCell].Columns.AutoFit(); } }</span></span></code> </pre><br>  When working with an object model, we must remember that we work with references to COM objects.  In the main Excel thread, we can safely use these objects and not worry about releasing the links ( <i>Marshal.ReleaseComObject</i> ), however, if we want to use the object model from a separate stream, we have two options: <br><br><ol><li>  Independently monitor all used objects and clear links to them.  This approach is fraught with errors and I do not recommend it. </li><li>  ExcelDna provides the ability to add a task for execution in the main thread; for this purpose, the <i>ExcelAsyncUtil.QueueAsMacro</i> method is <i>used</i> , example of use: <br><br><pre> <code class="cs hljs">ExcelAsyncUtil.QueueAsMacro(() =&gt;{ Excel.Application xlApp = (Excel.Application)ExcelDnaUtil.Appplication; xlApp.StatusBar=<span class="hljs-string"><span class="hljs-string">"Sending request..."</span></span>; });</code> </pre></li></ol><br>  Thus, we have learned to display data on the page.  Let's get to work with the user interface.  ExcelDna allows you to make changes to the standard Ribbon, add new tabs and buttons to it.  Create your own tab and place a button on it.  By clicking on the button, data will be downloaded to the current page.  To do this, we must inherit from the ExcelRibbon class and override the GetCustomUI method, the method returns a <a href="https://msdn.microsoft.com/en-us/library/aa942866.aspx">RibbonXML</a> with a description of our add-in interface. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ComVisible(true)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RibbonController</span></span> : <span class="hljs-title"><span class="hljs-title">ExcelRibbon</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCustomUI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> RibbonID</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">@" &lt;customUI xmlns='http://schemas.microsoft.com/office/2006/01/customui' loadImage='LoadImage'&gt; &lt;ribbon&gt; &lt;tabs&gt; &lt;tab id='tab1' label='Cryptostar'&gt; &lt;group id='group1' label='Cryptostar'&gt; &lt;button id='button1' image='bitcoin' label='Get Data' onAction='OnButtonPressed'/&gt; &lt;/group &gt; &lt;/tab&gt; &lt;/tabs&gt; &lt;/ribbon&gt; &lt;/customUI&gt;"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnButtonPressed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IRibbonControl control</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataLoader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataLoader(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tickers = dataLoader.LoadTickers(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataRender = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataRender(); dataRender.RenderData(xlApp, tickers); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e) { MessageBox.Show(e.ToString()); } } }</code> </pre><br>  We announced a button located on a tab and a group called cryptostar.  The button has an onAction = 'OnButtonPressed' handler, when you press the button, the <i>OnButtonPressed</i> method in the <i>RibbonController</i> class will be called. <br><br>  In addition to the handler, we specified an image for the button: image = 'bitcoin'.  The name of the image is set in the configuration file - Cryptostar-AddIn.dna.  This file is automatically added to the project when nuget is connected.  Example: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bitcoin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bitcoin.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Pack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><h2>  Build and Debug </h2><br>  Our plugin is ready, let's try to build it.  Press F5.  After that we get a set of * .xll files: <br>  Cryptostar-AddIn64-packed.xll, Cryptostar-AddIn-packed.xll, Cryptostar-AddIn.xll, Cryptostar-AddIn64.xll <br>  We see that the resulting files differ both in bit depth and in the presence of the word packed.  With digit capacity everything is clear, you need to choose the one that matches the digit capacity with Excel.  What is the difference between packed and not packed add-ins?  ExcelDNA allows you to package plug-in dependencies in an .xll file.  Dependencies can be any files used in the project, such as external libraries or images.  Dependencies are set in the configuration file, it looks like this: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DnaLibrary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Cryptostar Add-In"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RuntimeVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v4.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ExternalLibrary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Cryptostar.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ExplicitExports</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LoadFromBytes</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Pack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Newtonsoft.Json.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ExplicitExports</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LoadFromBytes</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Pack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bitcoin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bitcoin.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Pack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DnaLibrary</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Pay attention to the attribute Pack = ‚Äùtrue‚Äù, it indicates that this file should be packaged. <br><br>  If we use unpacked add-ins, then all its dependencies should be in the same directory as it. <br><br>  Now select the appropriate .xll file and run it.  If you did everything correctly, then after opening Excel you will see a new Cryptostart tab and a Get Data button, and when you click on it, the page will be filled with data on currencies: <br><br><img src="https://habrastorage.org/web/289/c47/e25/289c47e25d8d4fae97ffc4ca061dbb84.PNG"><br><br>  Unfortunately, programs rarely work the first time, so we may need a debugger.  Configuring ExcelDna add-in debugging is simple.  To do this, in the project properties on the Debug tab, select the Start External Program and set the path to Excel.exe, in my case this is G: \ Program Files \ Microsoft Office \ Office14 \ Excel.exe.  In the start options, we write the name of the packaged add-in file, taking into account the digit capacity of Excel.  For example, Cryptostar-AddIn64-packed.xll.  Everything, now we can press F5 and fully debug add-in. <br><br><h2>  Make installer </h2><br>  So, add-in is done, debugged, tested and ready to go.  The question is how to distribute it.  One of the options to entrust the installation of add-in'a user.  This is done through the Excel interface, on the developer tab tab-&gt; Add-ins-&gt; Browse specify the path to the .xll file.  This method will work only if the .xll file is signed with a certificate and the certificate is present at the <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/install/trusted-root-certification-authorities-certificate-store">trusted root certification authorities store</a> .  How to create a certificate and sign a file with it is well <a href="https://stackoverflow.com/questions/84847/how-do-i-create-a-self-signed-certificate-for-code-signing-on-windows">described here</a> . <br><br>  An alternative way is to write your own add-in installation program, which would register the necessary keys in the registry and thus register our add-in.  This task is not easy, because  It is necessary to take into account different versions of Excel in which the paths and keys in the registry differ.  But fortunately, this problem has already been solved and there is a template for the project - the installer that performs the necessary actions.  The template can be taken <a href="https://github.com/Excel-DNA/WiXInstaller">here</a> . <br><br><h2>  Conclusion </h2><br>  As a result, we got acquainted with the Excel-DNA library and went the whole way from developing an add-in to debugging it and creating an installer. <br><br>  The source code of the project is available <a href="https://github.com/abakumovoleg/cryptostar">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/337006/">https://habr.com/ru/post/337006/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336994/index.html">Getting rid of fragment state saving libraries using pure kotlin</a></li>
<li><a href="../336998/index.html">Fast rendering of ocean waves on mobile devices</a></li>
<li><a href="../337000/index.html">History of predictions of transitions from 1 500 000 BC. till 1995</a></li>
<li><a href="../337002/index.html">Kotlin aftertaste, part 2</a></li>
<li><a href="../337004/index.html">Andrei Ershov about the evolution of Future in Java and Scala on jug.msk.ru</a></li>
<li><a href="../337008/index.html">Ansible Dynamic Inventory from DNS or how to waste time searching for standards</a></li>
<li><a href="../337010/index.html">Ideal OS: rebooting desktop operating systems (part 1)</a></li>
<li><a href="../337012/index.html">How to use multichannel support system in retail. Case Desk Client</a></li>
<li><a href="../337014/index.html">Quick releases on a massive scale.</a></li>
<li><a href="../337022/index.html">The digest of interesting materials for the mobile developer # 219 (August 28 - September 3)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>