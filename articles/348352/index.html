<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to work with Jira plugin from ScriptRunner or how to avoid code duplication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to discuss the problem of duplicating code in Adaptivist ScriptRunner. 
 When you start writing scripts in ScriptRunner, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to work with Jira plugin from ScriptRunner or how to avoid code duplication</h1><div class="post__text post__text-html js-mediator-article">  In this article I would like to discuss the problem of duplicating code in Adaptivist ScriptRunner. <br>  When you start writing scripts in ScriptRunner, you usually write all the code in one script and then add this script to the post function, validator, condition, and the like. <br><br>  Everything goes well until you find an error in the code, or there are no changes in the business requirements.  At this point, you realize that you need to fix not one script, but several scripts with changed logic, and even worse, you do not remember which scripts you need to correct. <br><br>  You can run a search in the directory where the scripts are located, but as practice shows, this solution almost always leaves bugs in the code. <br>  This is a classic duplication problem. <br>  Let's try to get rid of code duplication. <br><a name="habracut"></a><br><h4>  Method 1 </h4><br>  The easiest way to solve a problem is to create an auxiliary class, which will contain the common parts of the code, and the groovy script will access this auxiliary class. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's try to implement it. <br><br>  First, create a helper class named UtilHelper.groovy in the scripts / groovy / util directory: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> groovy.util; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UtilHelper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"util helper message"</span></span>; } }</code> </pre> <br>  Then we create a post function called postfunction.groovy in the scripts / groovy / directory.  In this function post, we will call the getMessage function from our helper class. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> groovy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.util.UtilHelper; log.error(UtilHelper.getMessage())</code> </pre> <br>  In order not to complicate the example, we will not add a post function to the business process, but call it from the script console (Script Console): <br><br><img src="https://habrastorage.org/webt/ea/xi/v-/eaxiv-oayktuhllssb1rypoc1jk.png" alt="image"><br><br>  We received a message from the UitlHelper.groovy file.  So our method 1 worked. <br>  Now I would like to talk about the pitfalls of this method: <br><br>  I tested this code on ScriptRunner version 5.2.2 <br><br><ol><li>  If I add the postfunction.groovy file as an inline script to the script console, <br>  then the UitlHelper class is not always located for import. </li><li>  I originally created postfunction.groovy in the scripts / groovy directory, and then moved the file to the scripts / groovy / util directory.  But despite this, I could still import the class from the scripts / groovy / directory. </li></ol><br>  On earlier versions of ScriptRunner, the following problems are possible: <br><br><ol><li>  A static compilation error occurs due to the fact that the compiler cannot find the class being imported by the UtilHelper.  When the script is run, the script runs without errors. </li><li>  If you make changes to the helper class, the script does not see the changes in the helper class until you make changes to the script. </li></ol><br>  To avoid the problems of this method of implementation, as well as get a number of additional benefits, I would suggest a different way to solve the issue with duplicate code. <br><br><h4>  Method 2 </h4><br>  This method is based on the fact that we have a plugin that contains common code.  Thus, we could use common code both in our plugins and in ScriptRunner. <br><br>  In my <a href="https://habrahabr.ru/company/raiffeisenbank/blog/347744/">previous article,</a> I talked about how to make a plugin that can be accessed from other plugins.  The plugin was called jira-library.  The plugin provided the LibraryService service with the getLibraryMessage function.  Let's try to call this function. <br><br>  The jira-library plugin can be found <a href="https://bitbucket.org/alex1mmm/jira-library">here</a> .  The plugin must be assembled with the <code>atlas-mvn package </code> installed in Jira. <br><br>  Next, we need to write a script on ScriptRunner, which will refer to the jira-library plugin.  The annotations @WithPlugin and @PluginModule are used for this.  @WithPlugin allows you to import jira-library plugin classes, and @PluginModule allows you to embed (inject) LibraryService into a script.  Read in detail about the principle of operation of these annotations <a href="https://scriptrunner.adaptavist.com/latest/jira/scripting-other-plugins.html">here</a> . <br><br>  The script will look like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.onresolve.scriptrunner.runner.customisers.PluginModule <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.onresolve.scriptrunner.runner.customisers.WithPlugin <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.matveev.alexey.tutorial.library.api.LibraryService <span class="hljs-meta"><span class="hljs-meta">@WithPlugin</span></span>(<span class="hljs-string"><span class="hljs-string">"ru.matveev.alexey.tutorial.library.jira-library"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@PluginModule</span></span> LibraryService libraryService log.error(libraryService.getLibraryMessage()</code> </pre> <br>  Let's try to run it in the script console: <br><br><img src="https://habrastorage.org/webt/eu/dy/b1/eudyb1wra48ygtvwk_ph8w-rfcu.png" alt="image"><br><br>  The screenshot shows that the message from the jira-library plugin is displayed.  So our solution works. <br><br>  With this method of implementation, the following problems arise: <br><br><ul><li>  In the version above 5.1.  The script only works as inline.  In order for the script to work from the file, you need to write a script like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.onresolve.scriptrunner.runner.customisers.PluginModule <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.onresolve.scriptrunner.runner.customisers.WithPlugin <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.matveev.alexey.tutorial.library.api.LibraryService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.onresolve.scriptrunner.runner.ScriptRunnerImpl <span class="hljs-meta"><span class="hljs-meta">@WithPlugin</span></span>(<span class="hljs-string"><span class="hljs-string">"ru.matveev.alexey.tutorial.library.jira-library"</span></span>) LibraryService pl = ScriptRunnerImpl.getPluginComponent(LibraryService) log.error(pl.getLibraryMessage())</code> </pre> <br><br>  <a href="https://productsupport.adaptavist.com/browse/SRJIRA-2388">Bug is</a> open in Adaptivist. </li></ul><br>  The advantages of this approach are as follows: <br><br><ul><li>  You can make common code for both developed plugins and scripts in ScriptRunner </li><li>  You can implement in your own plugin what ScriptRunner does not support, and then use the functionality of the plugin in ScriptRunner.  For example, in this way you can implement <a href="https://en.wikipedia.org/wiki/Feature_toggle">feature toggle rotation</a> .  You can create a webwork type module that allows you to enable or disable some kind of functionality and place it in the plugins section.  Then you can export a service that will inform the script in ScriptRunner whether the required functionality is enabled.  If enabled, the script will perform the necessary actions. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/348352/">https://habr.com/ru/post/348352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348340/index.html">29% of websites are vulnerable to a DOS attack even by one machine (CVE-2018-6389)</a></li>
<li><a href="../348344/index.html">Leakpocalypse: Rust can surprise unpleasantly</a></li>
<li><a href="../348346/index.html">New industry requirements: Certification Centers stop issuing 3-year SSL certificates from March 1, 2018</a></li>
<li><a href="../348348/index.html">It is dangerous to use EDS in Kazakhstan</a></li>
<li><a href="../348350/index.html">Updating strings on the fly in mobile apps: part 2</a></li>
<li><a href="../348354/index.html">How ZFS Stores Data</a></li>
<li><a href="../348356/index.html">Transition from AngularJS to Angular: goals, plans and rules for transferring elements (1/3)</a></li>
<li><a href="../348358/index.html">10 Gigabit Ethernet: Newbie Tips</a></li>
<li><a href="../348360/index.html">OpenVPN OSPF between two servers, multiple tunnels</a></li>
<li><a href="../348362/index.html">Where in Siberia to talk about IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>