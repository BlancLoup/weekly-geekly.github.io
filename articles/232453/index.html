<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build in local notifications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is the worst thing about uninstalling the app? That's right, the loss of communication with the audience and the inability to inform that the app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We build in local notifications</h1><div class="post__text post__text-html js-mediator-article">  What is the worst thing about uninstalling the app?  That's right, the loss of communication with the audience and the inability to inform that the application has changed the address of registration and the name of the package.  Push notifications solve the task, but it is rather troublesome and not always convenient.  And sometimes expensive. <br><br><img src="https://habrastorage.org/files/c55/b0b/087/c55b0b0870324faa815746e792358e62.png"><br><br>  Therefore, we will write our own, simple as a drum and reliable as a tank ‚Äî local push notifications.  The code has turned out to be universal, and in principle, it can be used as an alternative to the usual "push", for example, for the newsletter that a new version of the application has been released or for rating, and for anything. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Let's start with the config.  This is a plain text file in json-format. <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"notifications"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> , <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sorry we are deleted from GPlay"</span></span> , <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"Please click for download new app"</span></span> , <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-number"><span class="hljs-number">105</span></span> , <span class="hljs-string"><span class="hljs-string">"action"</span></span>: <span class="hljs-string"><span class="hljs-string">"market://search?q=freemp"</span></span> , <span class="hljs-string"><span class="hljs-string">"locale"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru_Ru"</span></span> } ] }</code> </pre> <br><br>  Where <br>  - id: unique number of message <br>  - title: title of message <br>  - text: text of message <br>  - version: if not set message for all (optional) <br>  - action: default action (optional) <br>  - locale: optional <br><br>  We place this file, for example, on a githaba and add a link to it: <br><br>  public static final String MESSAGEURL = " <a href="">github.com/recoilme/freemp/blob/master/message.json?raw=true</a> "; <br><br>  Then, somewhere in the onCreate area, the main activity is called: <br>  new UpdateUtils (activity); <br><br>  Is done.  With the setting over.  Now how it works. <br><br>  When you start the application checks the array of notifications and shows the following message from those that were not shown earlier. <br>  Upon subsequent start-up, it shows the following and so on until notifications are over.  This way you can organize a message queue.  I do not know yet exactly why, but it will certainly come in handy. <br><br>  There are two types of filters: <br>  version - if you specify, for example, 105 - it will be shown only in version 105 of the application.  You can, for example, write for version 105 users that version 106 is released) <br>  locale - text locale, for example, if you need to make a message in Russian, for Russian-speaking users <br><br>  The action parameter is optional, this is the Uri that will be called when you click on the notification.  You can, for example, send it to the market or to another activity (including your own). <br><br>  Actually that's all.  Quite simply, and at the same time will allow to level the damage from the possible removal.  Well, or to establish a dialogue with users. <br><br>  The code in action can be found here: <a href="https://github.com/recoilme/freemp">https://github.com/recoilme/freemp</a> <br>  But actually this is one file.  Perhaps the library will develop, add the ability to download updates or something like that.  In the meantime, the code comfortably fits here: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.freemp.android; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Notification; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.NotificationManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.PendingIntent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.net.Uri; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.AsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.preference.PreferenceManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v4.app.NotificationCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.text.TextUtils; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.http.HttpResponse; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.http.client.methods.HttpGet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.http.impl.client.DefaultHttpClient; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.json.JSONArray; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.json.JSONException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.json.JSONObject; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.BufferedReader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.InputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.InputStreamReader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Locale; <span class="hljs-comment"><span class="hljs-comment">/** * Created by recoil on 06.08.14. * example file: { "notifications": [{ "id":1, "title":"Sorry we are deleted from GPlay", "text":"Please click for download new app", "version":105 , "action":"market://search?q=freemp", "locale":"ru_Ru"}] } - id: unique number of message - title: title of message - text: text of message - version: if not set message for all (may be not set) - action: default action (may be not set) - locale: may be not set */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdateUtils</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String MESSAGEURL = <span class="hljs-string"><span class="hljs-string">"https://github.com/recoilme/freemp/blob/master/message.json?raw=true"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Context context; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Activity activity; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> versionCode; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String locale; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateUtils</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Activity activity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.activity = activity; context = activity.getApplicationContext(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Update().execute(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Update</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Void... params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { versionCode = context.getPackageManager() .getPackageInfo(context.getPackageName(), <span class="hljs-number"><span class="hljs-number">0</span></span>).versionCode; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (PackageManager.NameNotFoundException e) { e.printStackTrace(); } locale = Locale.getDefault().toString(); String response = <span class="hljs-string"><span class="hljs-string">""</span></span>; DefaultHttpClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultHttpClient(); HttpGet httpGet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpGet(MESSAGEURL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { HttpResponse httpResponse = client.execute(httpGet); InputStream content = httpResponse.getEntity().getContent(); BufferedReader buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BufferedReader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(content)); String s = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((s = buffer.readLine()) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { response += s; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPostExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!TextUtils.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>,result)) { JSONObject jsonResult = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { jsonResult = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONObject(result); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JSONException e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//process notifications if exists JSONArray notifications = jsonResult.optJSONArray("notifications"); if (notifications==null) { return; } if (context==null) { return; } //string with showed messages String showedMessages = PreferenceManager.getDefaultSharedPreferences(context).getString(MESSAGEURL,""); for (int i=0;i&lt;notifications.length();i++) { JSONObject jsonNotification = notifications.optJSONObject(i); if (jsonNotification==null) break; final int version = jsonNotification.optInt("version",-1); if (version&gt;0 &amp;&amp; version!=versionCode) { continue; } final String localeTarget = jsonNotification.optString("locale","all"); if (!TextUtils.equals("all",localeTarget) &amp;&amp; !TextUtils.equals(localeTarget,locale)) { continue; } final int id = jsonNotification.optInt("id"); if (showedMessages.contains(id+";")) { continue; } else { showedMessages+=id+";"; PreferenceManager.getDefaultSharedPreferences(context).edit().putString(MESSAGEURL,showedMessages).commit(); Intent intent = null; if (!TextUtils.equals("",jsonNotification.optString("action",""))) { // if has action add it intent = new Intent(Intent.ACTION_VIEW, Uri.parse( jsonNotification.optString("action",""))); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); } else { // if no - just inform intent = new Intent(activity,activity.getClass()); } PendingIntent pIntent = PendingIntent.getActivity(context, id, intent, 0); // if you don't use support library, change NotificationCompat on Notification Notification noti = new NotificationCompat.Builder(context) .setContentTitle(jsonNotification.optString("title","")) .setContentText(jsonNotification.optString("text","")) .setSmallIcon(R.drawable.icon)//change this on your icon .setContentIntent(pIntent).build(); NotificationManager notificationManager = (NotificationManager) context.getSystemService(context.NOTIFICATION_SERVICE); // hide the notification after its selected noti.flags |= Notification.FLAG_AUTO_CANCEL; notificationManager.notify(id, noti); break; } } } } } }</span></span></code> </pre><br><br>  I would be glad if it is not useful for anyone to use it for the purposes for which it was created) </div><p>Source: <a href="https://habr.com/ru/post/232453/">https://habr.com/ru/post/232453/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../232443/index.html">Two examples of commercial censorship: the hotel fines visitors for negative reviews, and the restaurant wins in court</a></li>
<li><a href="../232445/index.html">Why is mobile unsafe by default</a></li>
<li><a href="../232447/index.html">Monitor communication links on HP MSR NG routers</a></li>
<li><a href="../232449/index.html">Anonymous interview with a former participant in the cutting scene - 2</a></li>
<li><a href="../232451/index.html">Developer Updates for Windows</a></li>
<li><a href="../232455/index.html">Properly choose a cloud call center</a></li>
<li><a href="../232459/index.html">How not to stay hungry or unlimited passage to the dining room</a></li>
<li><a href="../232461/index.html">The first release of Visual Studio Tools for Unity 1.9 after purchasing SyntaxTree</a></li>
<li><a href="../232463/index.html">Comparison of audio recognition algorithms for Second Screen</a></li>
<li><a href="../232469/index.html">Saxophone first printed on a 3D printer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>