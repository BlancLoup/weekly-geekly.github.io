<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MySQL getting blocking restrictions (konberentov) when deleting records, mini HowTo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes, I will not say that often, rather even rarely, a designated task arises, to find out - which tables in the tables block the deletion of the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MySQL getting blocking restrictions (konberentov) when deleting records, mini HowTo</h1><div class="post__text post__text-html js-mediator-article"> Sometimes, I will not say that often, rather even rarely, a designated task arises, to find out - which tables in the tables block the deletion of the current record by their external links. <br><a name="habracut"></a><br><br>  1. You need a MySQL version higher than 5.1.16, starting from this version, a table describing the REFERENTIAL_CONSTRAINTS consternates appeared in the official information_schema database. <br>  2. The required request, for the sake of which this post was written: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> information_schema.referential_constraints.<span class="hljs-built_in"><span class="hljs-built_in">table_name</span></span>, information_schema.key_column_usage.<span class="hljs-built_in"><span class="hljs-built_in">column_name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.referential_constraints <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.key_column_usage <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> information_schema.key_column_usage.constraint_schema = information_schema.referential_constraints.constraint_schema <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> information_schema.key_column_usage.<span class="hljs-built_in"><span class="hljs-built_in">constraint_name</span></span> = information_schema.referential_constraints.<span class="hljs-built_in"><span class="hljs-built_in">constraint_name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> information_schema.referential_constraints.constraint_schema = <span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> delete_rule = <span class="hljs-string"><span class="hljs-string">'RESTRICT'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> information_schema.referential_constraints.referenced_table_name = :<span class="hljs-keyword"><span class="hljs-keyword">table</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here we select the tables and their foreign keys that have RESTRICT DELETE_RULE on the current table. <br><br>  P.S.  The mistake of the constrint, for which I was fussing with this garden, in PHP (PDO) I catch as follows: <br><br><pre> <code class="hljs ruby">try { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> pdo execute() } catch (Exception $e) { <span class="hljs-regexp"><span class="hljs-regexp">/** * Find constraints error */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (strpos($e-&gt;getMessage(), <span class="hljs-string"><span class="hljs-string">'SQLSTATE[HY000]'</span></span>) !== <span class="hljs-literal"><span class="hljs-literal">false</span></span> &amp;&amp; strpos($e-&gt;getMessage(), <span class="hljs-string"><span class="hljs-string">'General error: 1451'</span></span>)) <span class="hljs-params"><span class="hljs-params">||</span></span> (strpos($e-&gt;getMessage(), <span class="hljs-string"><span class="hljs-string">'SQLSTATE[23000]'</span></span>) !== <span class="hljs-literal"><span class="hljs-literal">false</span></span> &amp;&amp; strpos($e-&gt;getMessage(), <span class="hljs-string"><span class="hljs-string">'Integrity constraint violation: 1451'</span></span>)) ) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> look <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> constraints } }</code> </pre><br><br>  P.P.S. <br>  Live applications when needed: <br>  The current database scheme includes 55 tables with large branching (the scheme has been refined many times over 3 years of life), 4 CMF client applications work with data from this database (different subcircuits), the database is checked for checking the referential integrity of the database tools, about the impossibility of deleting the record on which there are links also to indicate these links. </div><p>Source: <a href="https://habr.com/ru/post/77641/">https://habr.com/ru/post/77641/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../77634/index.html">Writing a voice menu script for Asterisk</a></li>
<li><a href="../77637/index.html">Google's Liquid Galaxy</a></li>
<li><a href="../77638/index.html">RightJS v1.5.0 saw the light</a></li>
<li><a href="../77639/index.html">About working with customers, developing and implementing software</a></li>
<li><a href="../77640/index.html">And again on the monetization of widgets</a></li>
<li><a href="../77642/index.html">Hackers are robbing phishers</a></li>
<li><a href="../77644/index.html">Personal Cabinets are activated on all QIWI terminals (QIWI)</a></li>
<li><a href="../77645/index.html">Russian users of pirated Windows XP will receive automatic notifications</a></li>
<li><a href="../77646/index.html">Paper "Computerra" all</a></li>
<li><a href="../77648/index.html">OAuth: protocol description in simple and understandable language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>