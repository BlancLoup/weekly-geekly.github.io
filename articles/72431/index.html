<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Progressbar and threads in PyGTK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently there was a need and desire to get acquainted with PyGTK. There is practically no literature in Russian on this issue, and what Google finds ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Progressbar and threads in PyGTK</h1><div class="post__text post__text-html js-mediator-article">  Recently there was a need and desire to get acquainted with PyGTK.  There is practically no literature in Russian on this issue, and what Google finds in various blogs is a bit obsolete.  Also I was surprised to find that the PyGTK theme is not very popular in Habr√© either. <br><br>  So, I will not talk about the layout of the interface elements, because such articles already exist.  I‚Äôll tell you about the next step: creating an application that does some work, displaying its progress in the process. <br><a name="habracut"></a><br>  For example, let's write a primitive GUI for two functions of the convert utility (ImageMagick package).  Our program will take four values: <br><ul><li>  size, how to reduce the image </li><li>  quality </li><li>  catalog with the images themselves </li><li>  directory where to save </li></ul><br>  The interface itself will create in the glade.  <b>Importantly</b> , the project must be in GtkBuilder format. <br><br><div style="text-align:center;"><img src="http://img73.imageshack.us/img73/3365/converte.png" alt="Glade GUI"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then two examples of code, the first - ordinary, and the second, with the creation of a separate thread for image processing.  Examples two - to visually make sure whether there is a sense of messing with the threads. <br><br>  Skeleton of the program: <br><br> <code>#!/usr/bin/python <br> # coding: utf-8 <br> <br> <font color="#800000">try</font> <font color="#808030">:</font> <br> <font color="#800000">import</font> sys <font color="#808030">,</font> pygtk <br> pygtk <font color="#808030">.</font> require <font color="#808030">(</font> <font color="#0000e6">'2.0'</font> <font color="#808030">)</font> <br> <font color="#800000">except</font> <font color="#808030">:</font> <br> <font color="#800000">print</font> <font color="#0000e6">'    PyGTK'</font> <br> sys <font color="#808030">.</font> <font color="#e34adc">exit</font> <font color="#808030">(</font> <font color="#008c00">1</font> <font color="#808030">)</font> <br> <br> <font color="#800000">import</font> gtk <font color="#808030">,</font> os <font color="#808030">,</font> time <br> <br> <font color="#800000">class</font> GUI <font color="#808030">(</font> object <font color="#808030">)</font> <font color="#808030">:</font> <br> <font color="#800000">def</font> <font color="#e34adc">__init__</font> <font color="#808030">(</font> self <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> wTree <font color="#808030">=</font> gtk <font color="#808030">.</font> Builder <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#696969">#   </font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> add_from_file <font color="#808030">(</font> <font color="#0000e6">"convert.glade"</font> <font color="#808030">)</font> <br> <font color="#696969">#  </font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> connect_signals <font color="#808030">(</font> self <font color="#808030">)</font> <br> self <font color="#808030">.</font> window1 <font color="#808030">=</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"window1"</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> progressdialog <font color="#808030">=</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"progressdialog"</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> progressbar_label <font color="#808030">=</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"progressbar_label"</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> window1 <font color="#808030">.</font> show <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#696969">#   </font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"size"</font> <font color="#808030">)</font> <font color="#808030">.</font> set_value <font color="#808030">(</font> <font color="#008c00">100</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"quality"</font> <font color="#808030">)</font> <font color="#808030">.</font> set_value <font color="#808030">(</font> <font color="#008c00">95</font> <font color="#808030">)</font> <br> <br> self <font color="#808030">.</font> progressbar <font color="#808030">=</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"progressbar"</font> <font color="#808030">)</font> <br> <br> <font color="#800000">def</font> on_cancel <font color="#808030">(</font> self <font color="#808030">,</font> widget <font color="#808030">)</font> <font color="#808030">:</font> <br> gtk <font color="#808030">.</font> main_quit <font color="#808030">(</font> <font color="#808030">)</font> <br> <br> <font color="#800000">def</font> on_progressdialog_close <font color="#808030">(</font> self <font color="#808030">,</font> <font color="#808030">*</font> args <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> stop <font color="#808030">=</font> <font color="#e34adc">True</font> <br> self <font color="#808030">.</font> progressdialog <font color="#808030">.</font> hide <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#800000">return</font> <font color="#e34adc">True</font> <br> <br> <font color="#800000">if</font> <font color="#e34adc">__name__</font> <font color="#808030">=</font> <font color="#808030">=</font> <font color="#0000e6">"__main__"</font> <font color="#808030">:</font> <br> app <font color="#808030">=</font> GUI <font color="#808030">(</font> <font color="#808030">)</font> <br> gtk <font color="#808030">.</font> main <font color="#808030">(</font> <font color="#808030">)</font> <br></code> <br><br>  We will add the main on_start method, which displays the progress bar, receives user instructions, generates a list of files (we exclude directories) and is directly involved in processing. <br><br> <code><font color="#800000">def</font> on_start <font color="#808030">(</font> self <font color="#808030">,</font> widget <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> progressdialog <font color="#808030">.</font> show <font color="#808030">(</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> stop <font color="#808030">=</font> <font color="#e34adc">False</font> <br> <font color="#696969">#   GUI</font> <br> self <font color="#808030">.</font> size <font color="#808030">=</font> <font color="#e34adc">int</font> <font color="#808030">(</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"size"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_value <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> quality <font color="#808030">=</font> <font color="#e34adc">int</font> <font color="#808030">(</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"quality"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_value <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> from_dir <font color="#808030">=</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"from_dir"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_current_folder <font color="#808030">(</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> to_dir <font color="#808030">=</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"to_dir"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_current_folder <font color="#808030">(</font> <font color="#808030">)</font> <br> <br> files <font color="#808030">=</font> <font color="#808030">[</font> <font color="#808030">]</font> <br> all_files <font color="#808030">=</font> os <font color="#808030">.</font> listdir <font color="#808030">(</font> self <font color="#808030">.</font> from_dir <font color="#808030">)</font> <br> <font color="#800000">for</font> f <font color="#800000">in</font> all_files <font color="#808030">:</font> <br> fullname <font color="#808030">=</font> os <font color="#808030">.</font> path <font color="#808030">.</font> join <font color="#808030">(</font> self <font color="#808030">.</font> from_dir <font color="#808030">,</font> f <font color="#808030">)</font> <br> <font color="#800000">if</font> os <font color="#808030">.</font> path <font color="#808030">.</font> isfile <font color="#808030">(</font> fullname <font color="#808030">)</font> <font color="#808030">:</font> <br> files <font color="#808030">.</font> append <font color="#808030">(</font> f <font color="#808030">)</font> <br> <br> count <font color="#808030">=</font> <font color="#e34adc">len</font> <font color="#808030">(</font> files <font color="#808030">)</font> <br> i <font color="#808030">=</font> <font color="#008000">1.0</font> <br> <font color="#800000">for</font> <font color="#e34adc">file</font> <font color="#800000">in</font> files <font color="#808030">:</font> <br> <font color="#696969"># </font> <br> <font color="#800000">if</font> self <font color="#808030">.</font> stop <font color="#808030">:</font> <br> <font color="#800000">break</font> <br> <br> self <font color="#808030">.</font> progressbar_label <font color="#808030">.</font> set_text <font color="#808030">(</font> <font color="#e34adc">file</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> progressbar <font color="#808030">.</font> set_fraction <font color="#808030">(</font> i <font color="#808030">/</font> count <font color="#808030">)</font> <br> <br> os <font color="#808030">.</font> popen <font color="#808030">(</font> <font color="#0000e6">'convert -resize '</font> <font color="#808030">+</font> <font color="#e34adc">str</font> <font color="#808030">(</font> self <font color="#808030">.</font> size <font color="#808030">)</font> <font color="#808030">+</font> <font color="#0000e6">' -quality '</font> <font color="#808030">+</font> <font color="#e34adc">str</font> <font color="#808030">(</font> self <font color="#808030">.</font> quality <font color="#808030">)</font> <font color="#808030">+</font> <font color="#0000e6">' '</font> <font color="#808030">+</font> os <font color="#808030">.</font> path <font color="#808030">.</font> join <font color="#808030">(</font> self <font color="#808030">.</font> from_dir <font color="#808030">,</font> <font color="#e34adc">file</font> <font color="#808030">)</font> <font color="#808030">+</font> <font color="#0000e6">' '</font> <font color="#808030">+</font> os <font color="#808030">.</font> path <font color="#808030">.</font> join <font color="#808030">(</font> self <font color="#808030">.</font> to_dir <font color="#808030">,</font> <font color="#e34adc">file</font> <font color="#808030">)</font> <font color="#808030">)</font> <br> <br> <font color="#696969">#   </font> <br> <font color="#800000">while</font> gtk <font color="#808030">.</font> events_pending <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">:</font> <br> gtk <font color="#808030">.</font> main_iteration <font color="#808030">(</font> <font color="#808030">)</font> <br> <br> time <font color="#808030">.</font> sleep <font color="#808030">(</font> <font color="#008c00">5</font> <font color="#808030">)</font> <br> i <font color="#808030">+</font> <font color="#808030">=</font> <font color="#008c00">1</font> <br> <br> self <font color="#808030">.</font> progressdialog <font color="#808030">.</font> hide <font color="#808030">(</font> <font color="#808030">)</font> <br></code> <br><br>  We display our dialog box, load the values ‚Äã‚Äãfrom the GUI and generate a list of files.  Next, run a loop with a search through the list of files. <br><br>  First of all, we check if the stop flag indicates that the processing stops if self.stop (set by the on_progressdialog_close button on the Cancel button or close the dialog box).  Further, in the process we change the text and the percentage of processing in the progress bar, and also run the convert utility itself with the necessary parameters. <br><br>  Important piece of code <br> <code><font color="#800000">while</font> gtk <font color="#808030">.</font> events_pending <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">:</font> <br> gtk <font color="#808030">.</font> main_iteration <font color="#808030">(</font> <font color="#808030">)</font> <br></code> <br><br>  Without it, our dialog box simply does not appear, and the interface will freeze until processing is complete.  This is because our loop blocks the interface redrawing (main loop) until it completes.  The above code returns control to the main loop for a short time. <br><br>  Also, I specifically added time.sleep (5), and if someone has a fast computer, they may not notice that during the actual processing (or sleep) the interface does not respond to events. <br><br><h4>  Threads </h4><br>  With threads in PyGTK, unknowingly had to tinker.  In the beginning, you need to call gtk.gdk.threads_init (), and all further gtk calls should be framed with gtk.threads_enter () and gtk.threads_leave (), such is the specifics. <br><br> <code><font color="#696969">#!/usr/bin/python</font> <br> <font color="#696969"># coding: utf-8</font> <br> <br> <font color="#800000">try</font> <font color="#808030">:</font> <br> <font color="#800000">import</font> sys <font color="#808030">,</font> pygtk <br> pygtk <font color="#808030">.</font> require <font color="#808030">(</font> <font color="#0000e6">'2.0'</font> <font color="#808030">)</font> <br> <font color="#800000">except</font> <font color="#808030">:</font> <br> <font color="#800000">print</font> <font color="#0000e6">'    PyGTK'</font> <br> sys <font color="#808030">.</font> <font color="#e34adc">exit</font> <font color="#808030">(</font> <font color="#008c00">1</font> <font color="#808030">)</font> <br> <br> <font color="#800000">import</font> threading <font color="#808030">,</font> gtk <font color="#808030">,</font> os <font color="#808030">,</font> time <br> <br> <font color="#800000">class</font> GUI <font color="#808030">(</font> object <font color="#808030">)</font> <font color="#808030">:</font> <br> <font color="#800000">def</font> <font color="#e34adc">__init__</font> <font color="#808030">(</font> self <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> wTree <font color="#808030">=</font> gtk <font color="#808030">.</font> Builder <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#696969">#   </font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> add_from_file <font color="#808030">(</font> <font color="#0000e6">"convert.glade"</font> <font color="#808030">)</font> <br> <font color="#696969">#  </font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> connect_signals <font color="#808030">(</font> self <font color="#808030">)</font> <br> self <font color="#808030">.</font> window1 <font color="#808030">=</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"window1"</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> dialog <font color="#808030">=</font> <font color="#800080">{</font> <br> <font color="#0000e6">"progressdialog"</font> <font color="#808030">:</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"progressdialog"</font> <font color="#808030">)</font> <font color="#808030">,</font> <br> <font color="#0000e6">"progressbar_label"</font> <font color="#808030">:</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"progressbar_label"</font> <font color="#808030">)</font> <font color="#808030">,</font> <br> <font color="#0000e6">"progressbar"</font> <font color="#808030">:</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"progressbar"</font> <font color="#808030">)</font> <br> <font color="#800080">}</font> <br> self <font color="#808030">.</font> window1 <font color="#808030">.</font> show <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#696969">#   </font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"size"</font> <font color="#808030">)</font> <font color="#808030">.</font> set_value <font color="#808030">(</font> <font color="#008c00">100</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"quality"</font> <font color="#808030">)</font> <font color="#808030">.</font> set_value <font color="#808030">(</font> <font color="#008c00">95</font> <font color="#808030">)</font> <br> <br> <br> <font color="#800000">def</font> on_cancel <font color="#808030">(</font> self <font color="#808030">,</font> widget <font color="#808030">)</font> <font color="#808030">:</font> <br> gtk <font color="#808030">.</font> main_quit <font color="#808030">(</font> <font color="#808030">)</font> <br> <br> <font color="#800000">def</font> on_progressdialog_close <font color="#808030">(</font> self <font color="#808030">,</font> <font color="#808030">*</font> args <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> work <font color="#808030">.</font> stop <font color="#808030">(</font> <font color="#808030">)</font> <br> self <font color="#808030">.</font> dialog <font color="#808030">[</font> <font color="#0000e6">'progressdialog'</font> <font color="#808030">]</font> <font color="#808030">.</font> hide <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#800000">return</font> <font color="#e34adc">True</font> <br> <br> <font color="#800000">def</font> on_start <font color="#808030">(</font> self <font color="#808030">,</font> widget <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> dialog <font color="#808030">[</font> <font color="#0000e6">'progressdialog'</font> <font color="#808030">]</font> <font color="#808030">.</font> show <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#696969"># </font> <br> self <font color="#808030">.</font> data <font color="#808030">=</font> <font color="#800080">{</font> <br> <font color="#0000e6">'size'</font> <font color="#808030">:</font> <font color="#e34adc">int</font> <font color="#808030">(</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"size"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_value <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">)</font> <font color="#808030">,</font> <br> <font color="#0000e6">'quality'</font> <font color="#808030">:</font> <font color="#e34adc">int</font> <font color="#808030">(</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"quality"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_value <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">)</font> <font color="#808030">,</font> <br> <font color="#0000e6">'from_dir'</font> <font color="#808030">:</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"from_dir"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_current_folder <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">,</font> <br> <font color="#0000e6">'to_dir'</font> <font color="#808030">:</font> self <font color="#808030">.</font> wTree <font color="#808030">.</font> get_object <font color="#808030">(</font> <font color="#0000e6">"to_dir"</font> <font color="#808030">)</font> <font color="#808030">.</font> get_current_folder <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#800080">}</font> <br> <br> files <font color="#808030">=</font> <font color="#808030">[</font> <font color="#808030">]</font> <br> all_files <font color="#808030">=</font> os <font color="#808030">.</font> listdir <font color="#808030">(</font> self <font color="#808030">.</font> data <font color="#808030">[</font> <font color="#0000e6">'from_dir'</font> <font color="#808030">]</font> <font color="#808030">)</font> <br> <font color="#800000">for</font> f <font color="#800000">in</font> all_files <font color="#808030">:</font> <br> fullname <font color="#808030">=</font> os <font color="#808030">.</font> path <font color="#808030">.</font> join <font color="#808030">(</font> self <font color="#808030">.</font> data <font color="#808030">[</font> <font color="#0000e6">'from_dir'</font> <font color="#808030">]</font> <font color="#808030">,</font> f <font color="#808030">)</font> <br> <font color="#800000">if</font> os <font color="#808030">.</font> path <font color="#808030">.</font> isfile <font color="#808030">(</font> fullname <font color="#808030">)</font> <font color="#808030">:</font> <br> files <font color="#808030">.</font> append <font color="#808030">(</font> f <font color="#808030">)</font> <br> <br> self <font color="#808030">.</font> work <font color="#808030">=</font> Worker <font color="#808030">(</font> self <font color="#808030">.</font> dialog <font color="#808030">,</font> self <font color="#808030">.</font> data <font color="#808030">,</font> files <font color="#808030">)</font> <br> self <font color="#808030">.</font> work <font color="#808030">.</font> start <font color="#808030">(</font> <font color="#808030">)</font> <br> <br> <br> <font color="#800000">if</font> <font color="#e34adc">__name__</font> <font color="#808030">=</font> <font color="#808030">=</font> <font color="#0000e6">"__main__"</font> <font color="#808030">:</font> <br> gtk <font color="#808030">.</font> gdk <font color="#808030">.</font> threads_init <font color="#808030">(</font> <font color="#808030">)</font> <br> app <font color="#808030">=</font> GUI <font color="#808030">(</font> <font color="#808030">)</font> <br> gtk <font color="#808030">.</font> gdk <font color="#808030">.</font> threads_enter <font color="#808030">(</font> <font color="#808030">)</font> <br> gtk <font color="#808030">.</font> main <font color="#808030">(</font> <font color="#808030">)</font> <br> gtk <font color="#808030">.</font> gdk <font color="#808030">.</font> threads_leave <font color="#808030">(</font> <font color="#808030">)</font> <br></code> <br><br>  Our code has changed a bit.  We have created the self.dialog dictionary, which is useful to us below, and the on_start method, now only prepares the data and launches a new thread, in which the non-blocking interface of our program is directly processed. <br><br>  Create a class Worker: <br> <code><font color="#800000">class</font> Worker <font color="#808030">(</font> threading <font color="#808030">.</font> Thread <font color="#808030">)</font> <font color="#808030">:</font> <br> <font color="#696969">#  </font> <br> stopthread <font color="#808030">=</font> threading <font color="#808030">.</font> Event <font color="#808030">(</font> <font color="#808030">)</font> <br> <br> <font color="#800000">def</font> <font color="#e34adc">__init__</font> <font color="#808030">(</font> self <font color="#808030">,</font> dialog <font color="#808030">,</font> data <font color="#808030">,</font> files <font color="#808030">)</font> <font color="#808030">:</font> <br> threading <font color="#808030">.</font> Thread <font color="#808030">.</font> <font color="#e34adc">__init__</font> <font color="#808030">(</font> self <font color="#808030">)</font> <br> self <font color="#808030">.</font> dialog <font color="#808030">=</font> dialog <br> self <font color="#808030">.</font> data <font color="#808030">=</font> data <br> self <font color="#808030">.</font> files <font color="#808030">=</font> files <br> <br> <font color="#800000">def</font> run <font color="#808030">(</font> self <font color="#808030">)</font> <font color="#808030">:</font> <br> count <font color="#808030">=</font> <font color="#e34adc">len</font> <font color="#808030">(</font> self <font color="#808030">.</font> files <font color="#808030">)</font> <br> i <font color="#808030">=</font> <font color="#008000">1.0</font> <br> <font color="#800000">for</font> <font color="#e34adc">file</font> <font color="#800000">in</font> self <font color="#808030">.</font> files <font color="#808030">:</font> <br> <font color="#696969">#   </font> <br> <font color="#800000">if</font> <font color="#808030">(</font> self <font color="#808030">.</font> stopthread <font color="#808030">.</font> isSet <font color="#808030">(</font> <font color="#808030">)</font> <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> stopthread <font color="#808030">.</font> clear <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#800000">break</font> <br> <br> self <font color="#808030">.</font> dialog <font color="#808030">[</font> <font color="#0000e6">'progressbar'</font> <font color="#808030">]</font> <font color="#808030">.</font> set_fraction <font color="#808030">(</font> i <font color="#808030">/</font> count <font color="#808030">)</font> <br> self <font color="#808030">.</font> dialog <font color="#808030">[</font> <font color="#0000e6">'progressbar_label'</font> <font color="#808030">]</font> <font color="#808030">.</font> set_text <font color="#808030">(</font> <font color="#e34adc">file</font> <font color="#808030">)</font> <br> <br> os <font color="#808030">.</font> popen <font color="#808030">(</font> <font color="#0000e6">'convert -resize '</font> <font color="#808030">+</font> <font color="#e34adc">str</font> <font color="#808030">(</font> self <font color="#808030">.</font> data <font color="#808030">[</font> <font color="#0000e6">'size'</font> <font color="#808030">]</font> <font color="#808030">)</font> <font color="#808030">+</font> <font color="#0000e6">' -quality '</font> <font color="#808030">+</font> <font color="#e34adc">str</font> <font color="#808030">(</font> self <font color="#808030">.</font> data <font color="#808030">[</font> <font color="#0000e6">'quality'</font> <font color="#808030">]</font> <font color="#808030">)</font> <font color="#808030">+</font> <font color="#0000e6">' '</font> <font color="#808030">+</font> os <font color="#808030">.</font> path <font color="#808030">.</font> join <font color="#808030">(</font> self <font color="#808030">.</font> data <font color="#808030">[</font> <font color="#0000e6">'from_dir'</font> <font color="#808030">]</font> <font color="#808030">,</font> <font color="#e34adc">file</font> <font color="#808030">)</font> <font color="#808030">+</font> <font color="#0000e6">' '</font> <font color="#808030">+</font> os <font color="#808030">.</font> path <font color="#808030">.</font> join <font color="#808030">(</font> self <font color="#808030">.</font> data <font color="#808030">[</font> <font color="#0000e6">'to_dir'</font> <font color="#808030">]</font> <font color="#808030">,</font> <font color="#e34adc">file</font> <font color="#808030">)</font> <font color="#808030">)</font> <br> <br> time <font color="#808030">.</font> sleep <font color="#808030">(</font> <font color="#008c00">2</font> <font color="#808030">)</font> <br> i <font color="#808030">+</font> <font color="#808030">=</font> <font color="#008c00">1</font> <br> <font color="#696969">#  </font> <br> self <font color="#808030">.</font> stopthread <font color="#808030">.</font> clear <font color="#808030">(</font> <font color="#808030">)</font> <br> <font color="#696969">#   </font> <br> self <font color="#808030">.</font> dialog <font color="#808030">[</font> <font color="#0000e6">'progressdialog'</font> <font color="#808030">]</font> <font color="#808030">.</font> hide <font color="#808030">(</font> <font color="#808030">)</font> <br> <br> <font color="#800000">def</font> stop <font color="#808030">(</font> self <font color="#808030">)</font> <font color="#808030">:</font> <br> self <font color="#808030">.</font> stopthread <font color="#808030">.</font> set <font color="#808030">(</font> <font color="#808030">)</font> <br></code> <br><br>  We had to override the constructor (__init__) so that it took parameters.  These are dialog dictionaries (I said, it will be useful), data (size, quality, and two directories) and a list of files. <br>  In the run method we put what needs to be performed at the start - i.e.  processing itself. <br><br>  That's all, as they say "The result on the face." <br><br>  I want to note, in this example, the calculation of the percentage of completion and its change for the dialogue, occur directly in the working thread.  This is considered a bad tone, and if the thread were not one, it would not have worked (it would have worked with errors more precisely). <br><br>  A slightly enhanced version of our program looks like this. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a7/737/6d3/7a77376d397f91a3c4219e1cdd906361.png" alt="Simple Images Converter"></div><br><br>  You can read about the features and download it <a href="http://notes.if.ua/sic_ru">here</a> . <br><br>  <a href="">Archive source</a> . <br><br>  UPD: <br>  <a href="https://habrahabr.ru/users/alex3d/" class="user_link">alex3d</a> recalled that if you match the manual, in Worker.run the lines <br> <code>self.dialog['progressbar'].set_fraction(i/count) <br> self.dialog['progressbar_label'].set_text(file)</code> <br>  need to wrap in <br>  gtk.threads_enter () / gtk.threads_leave (). </div><p>Source: <a href="https://habr.com/ru/post/72431/">https://habr.com/ru/post/72431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../72422/index.html">Swarm: a distributed computing language in the cloud</a></li>
<li><a href="../72424/index.html">Do you have compact fluorescent energy-saving lamps in your home and do they suit you?</a></li>
<li><a href="../72425/index.html">Space Community Game Review</a></li>
<li><a href="../72427/index.html">Reducing the size of the winsxs folder</a></li>
<li><a href="../72429/index.html">Nokia N900 May Not Support MMS</a></li>
<li><a href="../72432/index.html">Black holes on your desk? Yes it's real</a></li>
<li><a href="../72434/index.html">Use Linux to work with online banks</a></li>
<li><a href="../72435/index.html">MacKinsey has launched a discussion about paid access.</a></li>
<li><a href="../72437/index.html">Uncharted 2: Among Thieves</a></li>
<li><a href="../72441/index.html">Bug in RSS Habra?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>