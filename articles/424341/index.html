<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Elm. Comfortable and awkward. Composition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to talk about Elm 0.18 . 


 Elm. Comfortable and awkward 
 Elm. Comfortable and awkward. Json.Encoder and Json.Decoder 
 Elm. Comfortable...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Elm. Comfortable and awkward. Composition</h1><div class="post__text post__text-html js-mediator-article"><p>  We continue to talk about <a href="http://elm-lang.org/">Elm 0.18</a> . </p><br><p>  <a href="https://habr.com/post/424215/">Elm.</a>  <a href="https://habr.com/post/424215/">Comfortable and awkward</a> <br>  <a href="https://habr.com/post/424437/">Elm.</a>  <a href="https://habr.com/post/424437/">Comfortable and awkward.</a>  <a href="https://habr.com/post/424437/">Json.Encoder and Json.Decoder</a> <br>  <a href="https://habr.com/post/424979/">Elm.</a>  <a href="https://habr.com/post/424979/">Comfortable and awkward.</a>  <a href="https://habr.com/post/424979/">Http, Task</a> </p><br><p>  In this article we will consider the issues of the Elm application architecture and possible options for implementing the component development approach. </p><br><p>  As a task, consider the implementation of a drop-down window that allows a registered user to add a question.  In the case of an anonymous user offers to log in or register first. </p><a name="habracut"></a><br><p>  We also assume that later it may be necessary to implement the reception of other types of user-generated content, but the logic of working with authorized and anonymous users will remain the same. </p><br><h2 id="nelovkaya-kompoziciya">  Awkward composition </h2><br><p>  <a href="https://github.com/relabsoss/elm-comfortable-and-clumsy/tree/master/composition_clumsy">Source code of a naive implementation</a> .  As part of this implementation, we will all be stored in one model. </p><br><p>  All data required for authorization and user polling are in the model at the same level.  The same situation with messages (Msg). </p><br><pre><code class="hljs vbscript">type alias Model = { user: User , ui: Maybe Ui -- Popup <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> open <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> value equals <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> , login: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , password: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , question: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , message: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> } type Msg = OpenPopup | LoginTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | PasswordTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | Login | QuestionTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | SendQuestion</code> </pre> <br><p>  The interface type is described as the union type Ui, which is used with the Maybe type. </p><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ui</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">LoginUi</span></span> -- <span class="hljs-type"><span class="hljs-type">Popup</span></span> shown <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> authentication form | <span class="hljs-type"><span class="hljs-type">QuestionUi</span></span> -- <span class="hljs-type"><span class="hljs-type">Popup</span></span> shown <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> textarea to leave user question</code> </pre> <br><p>  Thus, ui = Nothing describes the absence of a drop-down window, and Just - the popup is open with a specific interface. <br></p><p>  In the update function, a pair, message, and user data are mapped.  Depending on this pair, various actions are performed. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.user) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span></code> </pre> <br><p>  Suppose when you click on the button ‚ÄúOpen popup‚Äù generated message OpenPopup.  The OpenPopup message in the update function is processed in various ways.  For an anonymous user, an authorization form is generated, and for an authorized user, a form in which you can leave a question. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.user) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-comment"><span class="hljs-comment">-- Anonymous user message handling section (OpenPopup, Anonymous) -&gt; ( { model | ui = Just LoginUi, message = "" }, Cmd.none) -- Authenticated user message handling section (OpenPopup, User userName) -&gt; ( { model | ui = Just QuestionUi, message = "" }, Cmd.none)</span></span></code> </pre> <br><p>  Obviously, this approach may have problems with the growth of application functions: </p><br><ol><li>  there is no grouping of data in the model and messages.  Everything lies in one plane.  Thus, there are no component boundaries, a change in the logic of one part is more likely to affect the rest; </li><li>  code reuse is possible according to the copy-paste principle with all the ensuing consequences. </li></ol><br><h2 id="udobnaya-kompoziciya">  Convenient composition </h2><br><p>  <a href="https://github.com/relabsoss/elm-comfortable-and-clumsy/tree/master/composition_comfortable">The source code is a convenient implementation</a> .  As part of this implementation, we will try to divide the project into independent components.  Permissible dependencies between components. </p><br><p>  Project structure: </p><br><ol><li>  in the Type folder, user-defined types are declared; </li><li>  Custom components are declared in the Component folder; </li><li>  the file Main.elm input point of the project; </li><li>  The login.json and questions.json files are used as test data of the server's response to authorization and saving information about the question, respectively. </li></ol><br><h1 id="polzovatelskie-komponenty">  Custom components </h1><br><p>  Each component, based on the architecture of the language, should contain: </p><br><ol><li>  Model (Model); </li><li>  messages (Msg); </li><li>  result of performance (Return); </li><li>  initialization function (init); </li><li>  mutation function (update); </li><li>  view function. </li></ol><br><p>  Each component may contain a subscription (subscription) if necessary. </p><br><p><img src="https://habrastorage.org/webt/rh/xg/0q/rhxg0qxlorqpoiyv-sljcbmec68.jpeg" alt="image"><br>  Fig.  1. Chart activity component </p><br><h1 id="inicializaciya">  Initialization </h1><br><p>  Each component must be initiated, i.e.  must be received: </p><br><ol><li>  model; </li><li>  command or list of commands that should initialize the state of the component; </li><li>  result of execution.  The result of the execution at the time of initialization may need to be valid for checking the user's authorization, as in the examples for this article. </li></ol><br><p>  The argument list of the initialization function (init) depends on the logic of the component and can be arbitrary.  Initialization functions may be several.  Suppose that for the authorization component there are two options for initialization: with a session token and with user data. </p><br><p>  The code that uses the component, after initialization, must send commands to the elm runtime using the <a href="https://package.elm-lang.org/packages/elm/core/latest/Platform-Cmd">Cmd.map</a> function. </p><br><h2 id="mutaciya">  Mutation </h2><br><p>  The update component function must be called for each component message.  As a result, the function returns a triple: </p><br><ol><li>  New model or new state (Model); </li><li>  command or command list for Elm runtime (Cmd Msg).  As commands, there may be commands to execute HTTP requests, interact with ports, and so on; </li><li>  the result of the execution (Maybe Return).  The type <a href="https://package.elm-lang.org/packages/elm/core/latest/Maybe">Maybe</a> has two states Nothing and Just a.  In our case, Nothing - no result, Just a - there is a result.  For example, for authorization, the result could be Just (Authenticated UserData) - the user is authorized with UserData data. </li></ol><br><p>  The code that uses the component, after mutation, must update the component model and transfer the commands to the Elm runtime using the <a href="https://package.elm-lang.org/packages/elm/core/latest/Platform-Cmd">Cmd.map</a> function. </p><br><p>  The required arguments of the update function, in accordance with the Elm application architecture: </p><br><ol><li>  message (Msg); </li><li>  model (Model). </li></ol><br><p>  If necessary, the list of arguments can be added. </p><br><h1 id="predstavlenie">  Representation </h1><br><p>  The view function is called at the moment when it is necessary to insert the component view into the overall application view. </p><br><p>  The required argument of the view function should be the component model.  If necessary, the list of arguments can be added. </p><br><p>  The result of the view function must be passed to the <a href="https://package.elm-lang.org/packages/elm/html/latest/Html">Html.map</a> function. </p><br><h1 id="integraciya-v-prilozhenie">  Application integration </h1><br><p>  The <a href="https://github.com/relabsoss/elm-comfortable-and-clumsy/tree/master/composition_comfortable">example</a> describes two components: <a href="">Auth</a> and <a href="">Question</a> .  Components described above principles.  Consider how they can be integrated into the <a href="">application</a> . </p><br><p>  First, let's define how our application should work.  On the screen there is a button, when clicked on which: </p><br><ol><li>  for an unauthorized user, the authorization form is displayed; after authorization, the form for placing the question; </li><li>  For an authorized user, the question posting form is displayed. </li></ol><br><p>  To describe the application you need: </p><br><ol><li>  Model (Model); </li><li>  messages (Msg); </li><li>  application start point (main); </li><li>  initialization function (init); </li><li>  mutation function; </li><li>  presentation function; </li><li>  subscription function. </li></ol><br><h1 id="model">  Model </h1><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> alias </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ui</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Maybe</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ui</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ui</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AuthUi</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Auth</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QuestionUi</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Question</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span></span></code> </pre> <br><p>  The model contains information about the user (user) and the type of the current interface (ui).  The interface can either be in the default state (Nothing) or one of the components Just a. </p><br><p>  To describe the components, we use the Ui type, which links (tags) each component model with a specific variant from the set type.  For example, the AuthUi tag links the authorization model (Component.Auth.Model) with the application model. </p><br><h1 id="soobscheniya">  Messages </h1><br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Msg = OpenPopup | AuthMsg <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Auth.Msg | QuestionMsg <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Question.Msg</code> </pre> <br><p>  In messages, you need to tag all component messages and include them in application messages.  The AuthMsg tag and QuestionMsg link the messages of the authorization component and the user‚Äôs request, respectively. </p><br><p>  An OpenPopup message is required to process a request to open an interface. </p><br><h1 id="funkciya-main">  Main function </h1><br><pre> <code class="hljs pgsql">main : Program Never Model Msg main = Html.program { init = init , <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> , subscriptions = subscriptions , <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> }</code> </pre> <br><p>  An application entry point is described typically for an Elm application. </p><br><h1 id="funkciya-inicializacii">  Initialization function </h1><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">init</span></span> : ( <span class="hljs-type"><span class="hljs-type">Model</span></span>, <span class="hljs-type"><span class="hljs-type">Cmd</span></span> <span class="hljs-type"><span class="hljs-type">Msg</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> = ( initModel, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> ) initModel : <span class="hljs-type"><span class="hljs-type">Model</span></span> initModel = { user = <span class="hljs-type"><span class="hljs-type">Anonymous</span></span> , ui = <span class="hljs-type"><span class="hljs-type">Nothing</span></span> }</code> </pre> <br><p>  The initialization function creates a starting model and does not require the execution of commands. </p><br><h1 id="funkciya-mutacii">  Mutation function </h1><br><div class="spoiler">  <b class="spoiler_title">Function source code</b> <div class="spoiler_text"><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.ui) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (OpenPopup, <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span>) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Auth.init model.user <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (authModel, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi questionModel, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> userData }, Cmd.batch [Cmd.map AuthMsg commands, Cmd.map QuestionMsg questionCommands] ) (authModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| AuthUi authModel }, Cmd.map AuthMsg commands ) (AuthMsg authMsg, Just (AuthUi authModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Auth.update authMsg authModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi questionModel, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> userData }, Cmd.batch [Cmd.map AuthMsg commands, Cmd.map QuestionMsg questionCommands] ) (newAuthModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| AuthUi newAuthModel }, Cmd.map AuthMsg commands ) (QuestionMsg questionMsg, Just (QuestionUi questionModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Question.update questionMsg questionModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Question.Saved <span class="hljs-built_in"><span class="hljs-built_in">record</span></span>)) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span> }, Cmd.map QuestionMsg commands ) (newQuestionModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi newQuestionModel }, Cmd.map QuestionMsg commands ) _ -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">model</span></span>, Cmd.none )</code> </pre> </div></div><br><p>  Since  the model and messages to the application are connected; we will process the message pair (Msg) and the interface type (model.ui: Ui). </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.ui) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span></code> </pre> <br><h1 id="logika-raboty">  Work logic </h1><br><p>  If the OpenPopup message is received and the default interface is specified in the model (model.ui = Nothing), then we initialize the Auth component.  If the Auth component reports that the user is authorized, we initialize the Question component and save it to the application model.  Otherwise, save the component model to the application model. </p><br><pre> <code class="hljs swift">(<span class="hljs-type"><span class="hljs-type">OpenPopup</span></span>, <span class="hljs-type"><span class="hljs-type">Nothing</span></span>) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> model.user of (authModel, commands, <span class="hljs-type"><span class="hljs-type">Just</span></span> (<span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.<span class="hljs-type"><span class="hljs-type">Authenticated</span></span> userData)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (questionModel, questionCommands, <span class="hljs-number"><span class="hljs-number">_</span></span>) = <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Question</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">QuestionUi</span></span> questionModel, user = <span class="hljs-type"><span class="hljs-type">User</span></span> userData }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.batch [<span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">QuestionMsg</span></span> questionCommands] ) (authModel, commands, <span class="hljs-number"><span class="hljs-number">_</span></span>) -&gt; ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">AuthUi</span></span> authModel }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands )</code> </pre> <br><p>  If a message is received with the AuthMsg a tag and the authorization interface is specified in the model (model.ui = Just (AuthUi authModel)), then we pass the component message and the component model to the Auth.update function.  As a result, we get a new component model, commands and results. </p><br><p>  If the user is authorized, we initialize the Question component, otherwise we update the interface data in the application model. </p><br><pre> <code class="hljs swift">(<span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> authMsg, <span class="hljs-type"><span class="hljs-type">Just</span></span> (<span class="hljs-type"><span class="hljs-type">AuthUi</span></span> authModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.update authMsg authModel of (<span class="hljs-number"><span class="hljs-number">_</span></span>, commands, <span class="hljs-type"><span class="hljs-type">Just</span></span> (<span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.<span class="hljs-type"><span class="hljs-type">Authenticated</span></span> userData)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (questionModel, questionCommands, <span class="hljs-number"><span class="hljs-number">_</span></span>) = <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Question</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">QuestionUi</span></span> questionModel, user = <span class="hljs-type"><span class="hljs-type">User</span></span> userData }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.batch [<span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">QuestionMsg</span></span> questionCommands] ) (newAuthModel, commands, <span class="hljs-number"><span class="hljs-number">_</span></span>) -&gt; ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">AuthUi</span></span> newAuthModel }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands )</code> </pre> <br><p>  Similarly to the Auth component, messages for the Question component are processed.  If the question is successfully placed, the interface changes to the default (model.ui = Nothing). </p><br><pre> <code class="hljs pgsql">(QuestionMsg questionMsg, Just (QuestionUi questionModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Question.<span class="hljs-keyword"><span class="hljs-keyword">update</span></span> questionMsg questionModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Question.Saved <span class="hljs-type"><span class="hljs-type">record</span></span>)) -&gt; ( { model | ui = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span> }, Cmd.map QuestionMsg commands ) (newQuestionModel, commands, _) -&gt; ( { model | ui = Just &lt;| QuestionUi newQuestionModel }, Cmd.map QuestionMsg commands )</code> </pre> <br><p>  All other cases are ignored. </p><br><pre> <code class="hljs lisp"> _ -&gt; ( <span class="hljs-name"><span class="hljs-name">model</span></span>, Cmd.none )</code> </pre> <br><h1 id="funkciya-predstavleniya">  Presentation function </h1><br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">view</span></span> : Model -&gt; Html Msg <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> model = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> model.ui <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Nothing -&gt; div [] [ div [] [ button [ Events.onClick OpenPopup ] [ <span class="hljs-literal"><span class="hljs-literal">text</span></span> <span class="hljs-string"><span class="hljs-string">"Open popup"</span></span> ] ] ] Just (AuthUi authModel) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Auth.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span> authModel |&gt; Html.<span class="hljs-keyword"><span class="hljs-keyword">map</span></span> AuthMsg Just (QuestionUi questionModel) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Question.<span class="hljs-keyword"><span class="hljs-keyword">view</span></span> questionModel |&gt; Html.<span class="hljs-keyword"><span class="hljs-keyword">map</span></span> QuestionMsg</code> </pre> <br><p>  The view function, depending on the type of interface (model.ui), either generates the default interface or calls the component view function and maps the message type of the component to the message type of the application (Html.map). </p><br><h1 id="funkciya-podpiski">  Subscription feature </h1><br><pre> <code class="hljs vbscript">subscriptions : Model -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> Msg subscriptions model = <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span>.none</code> </pre> <br><p>  No subscription. </p><br><h1 id="dalee">  Further </h1><br><p>  This example is slightly more convenient, but rather naive.  What is missing: </p><br><ol><li>  blocking interaction with the application during the boot process; </li><li>  data validation.  Requires a separate conversation; </li><li>  really a drop-down box with the ability to close. </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/424341/">https://habr.com/ru/post/424341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424331/index.html">Kubernetes 1.12: a review of major innovations</a></li>
<li><a href="../424333/index.html">My experience of dating and working with the Robot Framework</a></li>
<li><a href="../424335/index.html">Let there be light</a></li>
<li><a href="../424337/index.html">Code in the style of Ruby: competently, beautifully and rationally. Beginner Example</a></li>
<li><a href="../424339/index.html">Tandem author and expert: how to make it effective?</a></li>
<li><a href="../424343/index.html">Collaboration and access rights in DentalTap</a></li>
<li><a href="../424345/index.html">How I studied data science</a></li>
<li><a href="../424349/index.html">"Calendar tester" for September. Optimize tests</a></li>
<li><a href="../424353/index.html">Background: the state Internet search engine "Sputnik" and its complex history</a></li>
<li><a href="../424355/index.html">Die casting: how it works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>