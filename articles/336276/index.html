<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I created a monitoring system for computers at work and moved the service to Amazon AWS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear% user%. Today I will talk about how I wrote a simple system that allows you to get computer configuration and information about who logged...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I created a monitoring system for computers at work and moved the service to Amazon AWS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/77d/b78/a4b/77db78a4b0824c628a7f29b7067aae4c.png" alt="image"><br>  Hello, dear% user%.  Today I will talk about how I wrote a simple system that allows you to get computer configuration and information about who logged in to computers at work, and how I transferred it to Amazon AWS, making a service for general use.  This article can also be considered as partly a detailed guide on how to raise your web server, mail, sending letters and properly configure it on Amazon AWS.  And yes, this article can be categorized - I am promoting.  To whom it became interesting welcome under kat.  Carefully there will be a lot of screenshots. <br><a name="habracut"></a><br><br><h2>  Prehistory </h2><br>  Once we received a call from a warehouse manager in the helpdesk.  I answered his call.  He asked me about whether it was possible to find a computer by serial number.  He could not find who uses this computer, to which I replied it is of course impossible.  This conversation brought me to the idea, but what if we created a system in which the entire configuration of the computer would be displayed, including its serial number and who logged in on it.  Write a client application in C #, send everything to a web server with a simple interface to control all this. <br><br><h2>  Server part </h2><br>  I asked system administrators to allocate a separate server for Windows Server 2012 R2.  Installed on it XAMPP.  Added Apache and Mysql to services so that if the server is restarted, the site will not run.  Created the opermon database, added tables. <br>  The web interface is written using a self-written mvc engine.  Project structure: <br><ul><li>  Configs - the configuration file for communication with the database is stored here </li><li>  Controllers - classes are stored here </li><li>  Locale - localization </li><li>  Views - the pages themselves, with styles, pictures and javascript </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the root folder, create the index.php file and write the code: <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> session_start(); spl_autoload_register(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($class)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'./app/controllers/'</span></span> . $class . <span class="hljs-string"><span class="hljs-string">'.php'</span></span>; }); $api = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Api($_GET); $controller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Controller($_GET, $_POST); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><br>  In the Controllers folder there are many classes describing the behavior of the system.  One of the important classes is the class Controller.php.  This class is a controller that accepts GET and POST requests in __construct ($ get, $ post) from index.php.  After receiving a specific request, it shows a specific page. <br>  The Api class is used to receive ajax requests and process them.  The system management console is loaded only once.  All subsequent actions are carried out using javascript and ajax requests. <br><br>  The system design was inspired by Microsoft Azure.  I'll give the screenshots of the final result below: <br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/037/b9c/ca3/037b9cca32da459ba50ab59b78fc9f97.png" alt="image"><br><br><img src="https://habrastorage.org/web/5aa/42e/cf3/5aa42ecf3e4b48bf9cf7969c87916cc2.png" alt="image"><br><br><img src="https://habrastorage.org/web/46e/df2/9e3/46edf29e3a4944fa9229acfe9ed085aa.png" alt="image"><br><br><img src="https://habrastorage.org/web/37e/302/dcf/37e302dcf3f44db4a262b2fb5a41e6d1.png" alt="image"><br><br><img src="https://habrastorage.org/web/241/2e4/74b/2412e474bf6b4ff2a262c045d0e5015d.png" alt="image"><br><br><img src="https://habrastorage.org/web/50f/dfe/829/50fdfe8290c84e659d84512d2d0636d7.png" alt="image"><br></div></div><br><br>  It should be noted that before making a commercial version on Amazon AWS, I completely rewrote the system by making it safer, focused on general use, and simply removed some of the functions due to uselessness, but the essence remained the same. <br><br><h2>  Client part </h2><br>  The client part of this system is a simple service application written in c #.  When loading, the service opens the configuration file located at% windows_path% \ OperMonitorSystem.xml.  The structure of this xml file: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OperMonitorSystem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Server</span></span></span><span class="hljs-tag">&gt;</span></span>http://servername/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Server</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OperMonitorSystem</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In order for the service to catch user session events, you should add to the service initialization: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.CanHandleSessionChangeEvent = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br><br>  You should add a function that catches session changes: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSessionChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SessionChangeDescription changeDescription</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (changeDescription.Reason) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SessionChangeReason.SessionLogon: <span class="hljs-comment"><span class="hljs-comment">//  break; case SessionChangeReason.SessionLogoff: //  break; case SessionChangeReason.SessionLock: //  break; case SessionChangeReason.SessionUnlock: //  case SessionChangeReason.RemoteConnect: //  case SessionChangeReason.RemoteDisconnect: //  } base.OnSessionChange(changeDescription); }</span></span></code> </pre><br><br>  Using the WebClient class, a POST request is sent to the server.  WMI requests are used to get the computer configuration. <br>  The client part can be installed manually on each computer (if there are not a lot of them) or deployed by Group Policy. <br>  The idea of ‚Äã‚Äãcreating a service arose after I wrote <a href="https://habrahabr.ru/post/333056/">this article</a> , or rather, after these comments: <br><img src="https://habrastorage.org/web/184/496/f4f/184496f4f75743b2bb72f074f435a298.png" alt="image"><br><br>  During the rewriting of the system, it was necessary to enter some unique code for each user - hashid.  This is a kind of sequence of random numbers and letters written through a dash, which is created once during the registration of the user.  Hashid is very similar in appearance to the serial key of Windows operating systems.  After paying for the required subscription, each installer drops the installer, in which his unique hashid is registered.  That is why hashid data is entered in the database and this will ensure that an unauthorized user cannot see another user's computers. <br><br>  I decided to put the system on Amazon AWS.  Amazon AWS gives a year of free use of all the features of the system, of course not without limitations.  Register on Amazon AWS.  During registration, a call will be sent to your mobile phone to confirm your account.  During the call, you will need to dial the numbers on the phone.  Unfortunately, registration in this way did not work for me.  I dialed the required numbers, but the answering machine required everything to dial the numbers and nothing happened.  Then I turned to the support service, described my situation to them.  They ordered a personal identity check on a call from a support worker.  Soon a support worker called me to make sure that it was me and confirmed my account.  It should be noted that Amazon support is very polite and loyal to users.  Moving on to the fun part ‚Äî setting up Amazon AWS.  All that is written below I managed through a long search for trial and error.  Using this guide, you can completely adjust everything and raise without resorting to searching or something else. <br><br><h2>  Set up Amazon AWS </h2><br><br><h3>  Route 53 </h3><br>  First we need to buy a domain name.  I chose opermon.com.  Why opermon: <br><ul><li>  Oper - from the word operator </li><li>  Mon - from the word monitor </li></ul><br><br><ol><li>  Go to Route 53 <br><img src="https://habrastorage.org/web/6ba/37d/86b/6ba37d86b0b548388eb80a1d214b6049.png" alt="image"><br></li><li>  Click on the ‚ÄúCreate Hosted Zone‚Äù button.  On the right side of the menu, enter the address, comment and select the ‚ÄúPublic Hosted Zone‚Äù.  Public Hosted Zone - means that the name you write will be available to the whole world.  It should be noted that renting a domain name at Amazon AWS costs different prices.  In my case, it cost 12 US dollars.  Paid once a year.  Within 24 hours the domain name will be ready for use. <br><img src="https://habrastorage.org/web/28f/d83/32d/28fd8332d41b49cf9c9903ea7cbe6acd.png" alt="image"><br></li></ol><br><br><h3>  Amazon EC2 </h3><br><ol><li>  Go to EC2 <br><img src="https://habrastorage.org/web/314/938/e17/314938e174304a709755beb8807a99c5.png" alt="image"><br></li><li>  Select the item on the right "Instances" <br><img src="https://habrastorage.org/web/568/7e7/351/5687e73516b74406b15f3184fa8ef141.png" alt="image"><br></li><li>  Click ‚ÄúLaunch Instance‚Äù <br><img src="https://habrastorage.org/web/e6c/982/3e4/e6c9823e4ab44e47b2f1680947b56139.png" alt="image"><br></li><li>  Put a tick "Free tier only" and select "Select" as shown in the screenshot. <br><img src="https://habrastorage.org/web/062/3d2/516/0623d25169d341488e642a0805c4bb41.png" alt="image"><br></li><li>  Click "Next: Configure Instance Details" <br><img src="https://habrastorage.org/web/f8e/38d/dc1/f8e38ddc166c4afba4ac443277d0887c.png" alt="image"><br></li><li>  Click "Next: Add storage" <br><img src="https://habrastorage.org/web/efe/d6b/44e/efed6b44ed3943d3bd6c02116218b51a.png" alt="image"><br></li><li>  Specify the size of the disk.  In my case, 8 gigabytes is enough.  Click "Next: Add tags" <br><img src="https://habrastorage.org/web/316/743/755/316743755b794550920b3a10f6b00b89.png" alt="image"><br></li><li>  Click "Next: Configure Security Group" <br><img src="https://habrastorage.org/web/fd1/8a6/2af/fd18a62af42341f1be83d4d52a918564.png" alt="image"><br></li><li>  Click "Add new rule".  Choose from the list of HTTP, Source, select Anywhere.  This procedure is necessary so that when we install apache on our server, we would have access to our web site from the outside.  Click "Review and Launch". <br><img src="https://habrastorage.org/web/264/ba7/ca6/264ba7ca61894fc5b6147f5394761b30.png" alt="image"><br></li><li>  Click on the "Launch" button. <br><img src="https://habrastorage.org/web/1ae/a45/967/1aea4596778f4da2afd971b8b403a38c.png" alt="image"><br></li><li>  In this window, select from the drop-down list ‚ÄúCreate a new key pair‚Äù, enter the name and click on the button ‚ÄúDownload Key Pair‚Äù.  After that, the "Launch Instances" button will become active.  The downloaded .pem file must be copied to different storage locations.  In no case can you lose this file.  Using this pem file we will connect to our instance via WinSCP and Putty (the article will describe how to configure them). <br><img src="https://habrastorage.org/web/672/866/24c/67286624c2494abbbd6c373411ae616f.png" alt="image"><br></li><li>  After 5 minutes, our server will rise and we will be able to connect to it.  Standard account "ec2-user".  We will configure it so that when typing the address in the browser, the web site of the elevated one will be opened (further we will describe how to configure it) on our server.  Go to the ‚ÄúInstances‚Äù section, select the virtual machine we just created and look at the ‚ÄúPublic DNS‚Äù and Public IPv4 address.  I look like this: <br><img src="https://habrastorage.org/web/54c/e2d/5ff/54ce2d5ff1f54a1b8364ab9eb57e45c3.png" alt="image"><br>  We copy this data to ourselves.  Now we need him <br></li><li>  Go to Route 53. Select the domain we purchased.  Select the first A record.  In the right menu we add the Public IPv4 address of our instance. <br><img src="https://habrastorage.org/web/e3b/9ca/f82/e3b9caf82cfb4f48876010c3f55779fd.png" alt="image"><br></li><li>  Click "Create record set".  In the right-hand side menu that opens, select "Cname - canonical name" from the list.  In the field "Name" enter "www".  In the field ‚ÄúValue‚Äù enter the ‚ÄúPublic DNS‚Äù address of our instance and click ‚ÄúCreate‚Äù <br><img src="https://habrastorage.org/web/9d1/9cd/334/9d19cd334f7b4afcb43fac0d6d828009.png" alt="image"><br></li></ol><br><br>  Changes will take effect within 24 hours. <br><br><h3>  Configure the Putty and WinSCP application </h3><br>  Let's start with Putty.  Download Putty to your computer and install it. <br><br><ol><li>  Open Puttygen first (the application is located in the Start menu, in the Putty folder).  Click "Load" and select the .pem file we downloaded when we raised the EC2 instance: <br><img src="https://habrastorage.org/web/624/b1b/641/624b1b6416874192b9afa135b0ead709.png" alt="image"><br><img src="https://habrastorage.org/web/ebd/2ac/a89/ebd2aca897f24e3092a8d6e4aa24b583.png" alt="image"><br><img src="https://habrastorage.org/web/fbb/23f/dde/fbb23fdde18e4c85887acc11e2dca13c.png" alt="image"><br></li><li>  Click on the button ‚ÄúSave private key‚Äù and save the file <br><img src="https://habrastorage.org/web/734/3d8/d6c/7343d8d6ce014924a99950aa47720075.png" alt="image"><br></li><li>  Open Putty.  In the "Host name" write "Ip" address or "Public dns" instance address <br><img src="https://habrastorage.org/web/537/aa8/9d2/537aa89d2ea545a68f8cfebcbb562c6a.png" alt="image"><br></li><li>  In the menu on the left, select the Connection-&gt; SSH-&gt; Auth section and select the .ppk file that we just created in Puttygen. <br><img src="https://habrastorage.org/web/e77/8ab/41e/e778ab41ee474bdba7b41ae9dcb39068.png" alt="image"><br></li><li>  On the left in the menu, go to the Session section, enter the text ‚Äúlinux‚Äù in the ‚ÄúSaved sessions‚Äù field and click on the ‚ÄúSave‚Äù button.  In the list of sessions we will see how linux was added. <br><img src="https://habrastorage.org/web/642/f04/849/642f048490234de5a01aab3cef28639e.png" alt="image"><br></li><li>  Thus, the next time we need to connect to the server, we just need to select the configuration we just saved and click on the Open button. <br><img src="https://habrastorage.org/web/afe/307/9eb/afe3079eb52e4e10a517e92bb0b7512a.png" alt="image"><br></li></ol><br><br>  Let's go to WinSCP.  Download WinSCP to your computer and install it. <br><ol><li>  In the "Host Name" write the "Ip" address or "Public dns" instance address.  The username is ‚Äúec2-user‚Äù.  Password left blank.  Click on the "More" button <br><img src="https://habrastorage.org/web/b7d/481/af0/b7d481af003f4a209249fb4b93537468.png" alt="image"><br></li><li>  In the Authentication menu, select the .ppk file and click "OK" <br><img src="https://habrastorage.org/web/f20/3e1/f99/f203e1f99a95411c88edea1f0af28b62.png" alt="image"><br></li><li>  We click on the "Save" button so that the next time we do not configure the connection.  We will see how a connection was added to the menu on the left. <br><img src="https://habrastorage.org/web/378/f09/158/378f09158be947fdaa90c18d7c1f35f8.png" alt="image"><br></li></ol><br><br><h3>  Amazon RDS </h3><br>  Create a relational mysql database. <br><br><ol><li>  Open Amazon RDS <br><img src="https://habrastorage.org/web/832/7c0/638/8327c06383674d67be1a6ab43b322ec0.png" alt="image"><br></li><li>  Click on the button "Select" <br><img src="https://habrastorage.org/web/19c/c03/3a0/19cc033a0ea7471b83216c872e7ec08e.png" alt="image"><br></li><li>  Select Dev / Test, and click "Next Step" <br><img src="https://habrastorage.org/web/795/30b/05f/79530b05f2004256a8066ee70eca8155.png" alt="image"><br></li><li>  Enter the database ID (I have opermon), username and password.  Click "Next step" <br><img src="https://habrastorage.org/web/7de/ba7/64d/7deba764da6b40218011ae137966ec89.png" alt="image"><br></li><li>  Select the VPC that was created when creating the EC2 instance, set the name of our database and click ‚ÄúLaunch DB instance‚Äù <br><img src="https://habrastorage.org/web/e0c/25d/ab8/e0c25dab86874b93a95149a8e570ae37.png" alt="image"><br></li><li>  Go to the management console RDS section "Instances".  After 5 minutes, our database will become available and the address of our database will be written at the Endpoint site.  We need it. <br><img src="https://habrastorage.org/web/1ae/c48/15a/1aec4815a94049c8b7e580bebd4d3e4e.png" alt="image"><br></li></ol><br><br><h3>  We set up our instance </h3><br>  Open Putty and connect to our instance. <br><br><ol><li>  Install apache <br><pre> <code class="bash hljs">sudo yum install -y httpd24 php56 php56-mysqlnd</code> </pre><br></li><li>  After installation, run it. <br><pre> <code class="bash hljs">sudo service httpd start</code> </pre><br></li><li>  We give access to the www folder <br><pre> <code class="bash hljs">sudo groupadd www sudo usermod -a -G www ec2-user</code> </pre><br></li><li>  Exit the Putty program and reconnect to our instance and set the commands. <br><pre> <code class="bash hljs">sudo chmod 2775 /var/www find /var/www -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> d -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> sudo chmod 2775 {} + find /var/www -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> sudo chmod 0664 {} +</code> </pre><br></li></ol><br>  Now in WinSCP we can go to the / var / www / directory and upload our web site, engine, html there - whatever. <br><br><h3>  Install phpmyadmin </h3><br>  Open Putty and connect to our instance. <br><br><ol><li>  Install phpmyadmin <br><pre> <code class="bash hljs">sudo yum-config-manager --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> epel sudo yum install -y phpMyAdmin</code> </pre><br></li><li>  We find our external ip using extraneous services and write a command <br><pre> <code class="bash hljs">sudo sed -i -e <span class="hljs-string"><span class="hljs-string">'s/127.0.0.1/__/g'</span></span> /etc/httpd/conf.d/phpMyAdmin.conf</code> </pre><br>  If your ip has changed, then we write the command <br><pre> <code class="bash hljs">sudo tail -n 1 /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/httpd/access_log | awk <span class="hljs-string"><span class="hljs-string">'{ print $1 }'</span></span> ____ sudo sed -i -e <span class="hljs-string"><span class="hljs-string">'s/__/_/g'</span></span> /etc/httpd/conf.d/phpMyAdmin.conf</code> </pre><br></li><li>  Restart apache server for changes to take effect. <br><pre> <code class="bash hljs">sudo service httpd restart</code> </pre><br></li><li>  Now you need to configure phpmyadmin so that it connects to our database. <br><pre> <code class="bash hljs">sudo chmod -R 777 /etc/phpMyAdmin</code> </pre><br></li><li>  Open WinSCP, go to the address / etc / phpmyadmin, copy the file config.inc.php and open it in any text editor.  We find the lines shown below and change them to our own: <br><pre> <code class="php hljs">$cfg[<span class="hljs-string"><span class="hljs-string">'Servers'</span></span>][$i][<span class="hljs-string"><span class="hljs-string">'host'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Endpoint     '</span></span>; $cfg[<span class="hljs-string"><span class="hljs-string">'Servers'</span></span>][$i][<span class="hljs-string"><span class="hljs-string">'port'</span></span>] = <span class="hljs-string"><span class="hljs-string">'3306'</span></span>; $cfg[<span class="hljs-string"><span class="hljs-string">'Servers'</span></span>][$i][<span class="hljs-string"><span class="hljs-string">'user'</span></span>] = <span class="hljs-string"><span class="hljs-string">' '</span></span>; $cfg[<span class="hljs-string"><span class="hljs-string">'Servers'</span></span>][$i][<span class="hljs-string"><span class="hljs-string">'password'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>;</code> </pre><br></li><li>  Save the file and overwrite it on the server.  There will be an error stating that the file has been overwritten, but the attributes have not been changed.  Click "skip" and enter the command in Putty: <br><pre> <code class="bash hljs">sudo chmod -R 755 /etc/phpMyAdmin</code> </pre><br>  If this command is not done, then phpmyadmin will refuse to open, referring to the fact that the permissions on the files have been changed and do not comply with the security policy. <br></li></ol><br><br><h3>  Set up WorkMail </h3><br><div class="spoiler">  <b class="spoiler_title">What is WorkMail?</b> <div class="spoiler_text">  Amazon WorkMail is a robust managed business email and calendaring service that supports existing email clients for desktops and mobile email clients.  Amazon WorkMail gives users the ability to easily access their email, contacts, and calendars using a convenient email client, including Microsoft Outlook, email applications for iOS and Android, any IMAP-enabled email clients, as well as directly through a web browser. <br></div></div><br><br><ol><li>  Do a search on the Amazon AWS console and find WorkMail <br><img src="https://habrastorage.org/web/36d/1d3/afc/36d1d3afc5ae4d3cad45cc675a8d1ca3.png" alt="image"><br></li><li>  Choose Add Organization <br><img src="https://habrastorage.org/web/cbb/447/c50/cbb447c508ed4047814e9cbeb18a923e.png" alt="image"><br></li><li>  Click "Quick setup" <br><img src="https://habrastorage.org/web/b00/440/8ef/b004408efee14addbc46b1d176e9e3d2.png" alt="image"><br></li><li>  Enter the name of the organization and click on "Create".  In my case, the organization has already been created, so I will click on the ‚Äúopermon‚Äù in the list in the second screenshot. <br><img src="https://habrastorage.org/web/934/e95/580/934e9558015648cfb900e8141721f4ca.png" alt="image"><br></li><li>  Go to the section "Domains" and click "Add domain" <br><img src="https://habrastorage.org/web/826/88c/3f7/82688c3f7807421da7f55b0f14880631.png" alt="image"><br></li><li>  Enter the domain name and click "Add domain" <br><img src="https://habrastorage.org/web/dd6/6bd/e02/dd66bde0267b4e229e78bd215a33a91a.png" alt="image"><br></li><li>  A page will open in which all the entries you need to enter in Route 53, in the settings of our domain name.  Write the settings I think you can do yourself. <br><img src="https://habrastorage.org/web/dd6/6bd/e02/dd66bde0267b4e229e78bd215a33a91a.png" alt="image"><br>  Then come back here <br></li><li>  Go to the section "Users" click "Create user" <br><img src="https://habrastorage.org/web/f5e/15e/7cf/f5e15e7cfb7046bd8a1417519a4c4c10.png" alt="image"><br></li><li>  Enter the first name, last name, the displayed name and click "Next step" <br><img src="https://habrastorage.org/web/ed2/00f/cc6/ed200fcc6d864d7b97c7a133999bc749.png" alt="image"><br></li><li>  Set an email address, choose your domain.com from the list, set a password and click "Add user" <br><img src="https://habrastorage.org/web/9ba/a06/c06/9baa06c063844285a20a318b465b32ee.png" alt="image"><br></li></ol><br><br>  Now we can go to the mail by going to <a href="https://xn--_-7sbfkf5bif1g.awsapps.com/mail">your_domain.awsapps.com / mail</a> . <br><br><h3>  Configure Amazon SES </h3><br><ol><li>  Open Amazon SES, go to the ‚ÄúDomains‚Äù section and click on ‚ÄúVerify a new domain‚Äù.  In the window that opens, enter the address (in my case it is opermon.com) and click on "Verify this domain" <br><img src="https://habrastorage.org/web/c37/00c/23f/c3700c23f66e4a0093140ac5180660bf.png" alt="image"><br></li><li>  This window will open.  The data recorded in this window will need to be entered again in Route 53. <br><img src="https://habrastorage.org/web/9a0/2af/7cb/9a02af7cb9d246dc81b1c3891635f89a.png" alt="image"><br></li><li>  Go to the Email addresses section and click "Verify a New Email Address", enter the email address previously created in WorkMail and click on "Verify This Email Address".  After some time, a letter with a confirmation link will be sent to our address.  Open the mail and click on the confirmation link.  This procedure is necessary so that in the service letters sent by our web site, the system and others, we could use the sender's address created earlier in WorkMail. <br><img src="https://habrastorage.org/web/3f6/798/e49/3f6798e4937541499d15514965db865f.png" alt="image"><br></li><li>  Go to the section "Create my SMTP credentials".  The SMTP server address should be written somewhere. <br><img src="https://habrastorage.org/web/78d/0b0/e48/78d0b0e4879343189b4d2046356f6232.png" alt="image"><br></li><li>  Click "Create" <br><img src="https://habrastorage.org/web/02b/e3d/fb7/02be3dfb7263427a927b04891d3677e1.png" alt="image"><br></li><li>  The account has been created, we copy the login and password and store it somewhere.  We will need them too. <br><img src="https://habrastorage.org/web/5e0/157/030/5e0157030cfd4aa882ebd7400f203aed.png" alt="image"><br></li></ol><br><br><h3>  Set up a script to send letters </h3><br>  In its samopinny engine there is a class Mail.  It looks like this: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'app/class/mail/PHPMailerAutoload.php'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpermonMail</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($subject = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'none'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $email, $name, $surname, $text_body = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $text_altbody = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $config = parse_ini_file(<span class="hljs-string"><span class="hljs-string">'app/config/mail.ini'</span></span>); $mail = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPMailer; $mail-&gt;isSMTP(); $mail-&gt;Host = $config[<span class="hljs-string"><span class="hljs-string">'MAIL_HOST'</span></span>]; $mail-&gt;SMTPAuth = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $mail-&gt;Username = $config[<span class="hljs-string"><span class="hljs-string">'MAIL_USERNAME'</span></span>]; $mail-&gt;Password = $config[<span class="hljs-string"><span class="hljs-string">'MAIL_PASSWORD'</span></span>]; $mail-&gt;SMTPSecure = <span class="hljs-string"><span class="hljs-string">'ssl'</span></span>; $mail-&gt;Port = <span class="hljs-number"><span class="hljs-number">465</span></span>; $mail-&gt;setFrom($config[<span class="hljs-string"><span class="hljs-string">'MAIL_SETFROMEMAIL'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'MAIL_SETFROMNAME'</span></span>]); $mail-&gt;addAddress($email, $name.<span class="hljs-string"><span class="hljs-string">' '</span></span>.$surname); $mail-&gt;isHTML(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $mail-&gt;Subject = $subject; $mail-&gt;Body = $text_body; $mail-&gt;AltBody = $text_altbody; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$mail-&gt;send()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $mail-&gt;ErrorInfo; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  As you can see from the code, PHPMailer is used.  You can find it on github. <br><br>  And so finally after all this, the system has earned.  When registering, a confirmation code is sent to users (not for nothing, we used Amazon SES and WorkMail), the website itself opens (Amazon EC2 with apache installed on it) and you can see records in the database (phpmyadmin).  I attach screenshots of the finished system: <br><div class="spoiler">  <b class="spoiler_title">The result is why we fought so much</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/77d/b78/a4b/77db78a4b0824c628a7f29b7067aae4c.png" alt="image"><br><br><img src="https://habrastorage.org/web/91d/471/f8d/91d471f8de344063ba7ce54977706952.JPG" alt="image"><br><br><img src="https://habrastorage.org/web/d71/62f/901/d7162f9010444f8ca644ceae76be1af1.png" alt="image"><br><br><img src="https://habrastorage.org/web/026/bd2/099/026bd209970a4f8d847ad862bedd375c.png" alt="image"><br><br><img src="https://habrastorage.org/web/eec/da8/e59/eecda8e5939747b9a5b36a1320df6dff.JPG" alt="image"><br></div></div><br><br>  Unfortunately, I don‚Äôt know how to do an installer collection in the system itself.  Plus, in the country in which I live, the business type of PayPal account is not supported, so I could not write the payment function directly in the system.  These aspects I have to do manually. <br><br>  Thank you all for your attention! </div><p>Source: <a href="https://habr.com/ru/post/336276/">https://habr.com/ru/post/336276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336264/index.html">One step closer to C ++ 20. Results of the meeting in Toronto</a></li>
<li><a href="../336266/index.html">Advanced Jekyll</a></li>
<li><a href="../336268/index.html">ReactiveX 2.0 with examples, or grokay reactive programming 2.0. Part 1: Observable vs Flowable, Backpressure</a></li>
<li><a href="../336270/index.html">Brief reaction to Xored material</a></li>
<li><a href="../336272/index.html">Types of models</a></li>
<li><a href="../336278/index.html">Using the system API in Sailfish OS</a></li>
<li><a href="../336280/index.html">Angular Basics: HttpClient</a></li>
<li><a href="../336282/index.html">Trafaret as a parser. JSON Schema implementation</a></li>
<li><a href="../336284/index.html">Blockchain: The Future of IT Professionals</a></li>
<li><a href="../336286/index.html">Reed-Solomon codes. Part 1 - the theory of simple language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>