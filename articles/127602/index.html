<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Amazon ElastiCache small review - does it need a typical web project?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On August 22, Amazon announced a new service in AWS - Amazon ElastiCache. On Habr√© about this, too, wrote . 

 Service compatible protocol with Memcac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Amazon ElastiCache small review - does it need a typical web project?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/39931c23/5ff56edd/f1ac93b0/104460fa.gif" align="left">  On August 22, Amazon <a href="http://aws.amazon.com/about-aws/whats-new/2011/08/22/announcing-amazon-elasticache/">announced a</a> new service in AWS - Amazon ElastiCache.  On Habr√© about this, too, <a href="http://habrahabr.ru/blogs/cloud_computing/126911/">wrote</a> . <br><br>  Service compatible protocol with Memcached. <br><br>  Let's see how it works and whether it has practical value for web developers and system administrators. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To get started, you need to select the ElastiCache item in the AWS administrative interface and specify the details of your bank card with which payment will be made. <br><br>  After that, you can proceed to the actual launch. <br><br><img src="https://habrastorage.org/storage1/1f26ca86/9542a17b/de867da7/b1bfe6cf.png"><br><br>  <b>Please note</b> - the service is currently available only in one of five regions, in the US East (Virginia). <br><br>  The key concept of ElastiCache is Cache Cluster. <br><br>  Inside the cluster, you can start (manually or automatically) the required number of nodes. <br><br>  Starting a new cluster, we set its parameters: <br><br><img src="https://habrastorage.org/storage1/256d9d61/71877d14/e98e47ee/6a8fad3f.png"><br><br>  <b>Important points:</b> <br><ul><li>  <b>Node Type</b> - the physical characteristics of each node in the cluster (RAM, CPU).  <b>In the same cluster, all nodes must be of the same configuration!</b>  Only their number will vary. </li><li>  <b>Engine</b> - in fact, it‚Äôs not just protocol compatibility with memcached, and that‚Äôs what is - memcached itself.  Perhaps in the future there will be some other options. </li></ul><br>  Further we set <b>Security Group</b> and <b>Cache Parameter Group</b> . <br><br>  Cache Parameter Group so far (?) Is the only one and so far (?) Is not configured. <br><br>  On setting up the Security Group I want to stop a little more. <br><br><img src="https://habrastorage.org/storage1/4c8806ce/729ec4df/32b28041/a59cb6d1.png"><br><br>  In the group settings, the name of the Security Group for EC2 is indicated - those virtual machines that will have access to the cache cluster nodes. <br><br>  And also AWS Account ID. <br><br>  Some "thin" moments: <br><ul><li>  In EC2 Security Group it is the <b>name of the group</b> that is indicated, and not the identifier of the form sg- * (as I myself first thought).  If you specify any incorrect data, in most cases there will not even be any intelligible error message. </li></ul><br>  The fact that it is necessary to indicate the name of the group more or less clearly follows only from the <a href="http://docs.amazonwebservices.com/AmazonElastiCache/latest/APIReference/API_AuthorizeCacheSecurityGroupIngress.html">API</a> description: <br><br> <code><a href="https://elasticache.us-east-1.amazonaws.com/"></a> elasticache.us-east-1.amazonaws.com <br> ?Action=AuthorizeCacheSecurityGroupIngress <br> &amp; <b>EC2SecurityGroupName</b> =default <br> &amp;CacheSecurityGroupName=mygroup <br> &amp;EC2SecurityGroupOwnerId=1234-5678-1234 <br> &amp;Version=2011-07-15 <br> &amp;SignatureVersion=2 <br> &amp;SignatureMethod=HmacSHA256 <br> &amp;Timestamp=2011-02-12T01%3A29%3A15.746Z <br> &amp;AWSAccessKeyId=YOUR-ACCESS-KEY <br> &amp;Signature=YOUR-SIGNATURE</code> <br> <br><ul><li>  Since all firewall management is carried out at the EC2 Security Group level, you will not be able to open access to Amazon ElastiCache from arbitrary networks.  That is, you can work with this service only from other Amazon services (in general, EC2). </li><li>  Since not only EC2 Security Group is indicated, but also AWS Account ID, it is possible to give access from another account. </li></ul><br><br>  As a result, after all the settings have been made, the required number of cache cluster nodes is launched (I experimented with one node).  EndPoint is defined for each node - just a pair of <b>host: port</b> that our application can access. <br><br>  * * * <br><br>  <b>We turn to practical tests!</b>  <b>:)</b> <br><br>  For the experiments, I took two CMS: the most popular commercial - 1C-Bitrix, and the most popular open source - Joomla (data on popularity - from <a href="http://itrack.ru/research/cmsrate/">the iTrack rating</a> ). <br><br>  <b>Bitrix</b> <br><br>  To use memcache as storage for the cache, you can use two options: <br><br>  1. <a href="http://dev.1c-bitrix.ru/api_help/perfomance/perfmon_panel.php">Specify</a> in the dbconn.php configuration file: <br><br> <code>define("BX_CACHE_TYPE", "memcache"); <br> define("BX_MEMCACHE_HOST", "testcache.lfffta.0001.use1.cache.amazonaws.com"); <br> define("BX_MEMCACHE_PORT", "11211");</code> <br> <br>  2. Alternatively (only on <a href="http://www.1c-bitrix.ru/products/cms/editions/">older editions of</a> ‚ÄúWeb Cluster‚Äù and ‚ÄúBusiness Web Cluster‚Äù) specify the required number of memcached servers in the administrative interface in the product settings (plus this method in that any number of servers can be specified, and not one that allows you to use a distributed cache): <br><br><img src="https://habrastorage.org/storage1/16f7e6ec/cd4eba89/8dc32919/388e5f7a.png"><br><br>  For tests on the EC2 virtual machine (small), a demo version of ‚Äú1C-Bitrix‚Äù 10.0 is installed with sample content from the distribution kit (‚ÄúOnline Store‚Äù).  The machine is deployed in the same AZ (Availability Zone), in which our Cache Cluster is raised - to minimize the impact of the network. <br><br>  Since we do not need a large detailed test, and we only want to evaluate the speed of the project when using Amazon ElastiCache, I did not use full-fledged tools for load testing (such as tsung or JMeter), but limited myself to simple ab. <br><br>  We make 500 requests in 2 threads (I‚Äôll say right away that I ran the tests several times to get average values). <br><br>  According to the method of testing someone may have comments.  I will note once again - I compare only two things: the work of sites without using Amazon ElastiCache and with it.  Absolute numbers are not interesting, only relative data. <br><br> <code><a href="http://ec2-xx-xx-xx-0.compute-1.amazonaws.com/"></a> # ab -n 500 -c 2 ec2-xx-xx-xx-0.compute-1.amazonaws.com</code> <br> <br>  The first test is using the standard cache (disk is the EC2 virtual machine file system): <br><br><pre>  Document Path: /
 Document Length: 25910 bytes

 Concurrency Level: 2
 Time taken for tests: 53.748 seconds
 Complete requests: 500
 Failed requests: 0
 Write errors: 0
	 Total transferred: 13324000 bytes
	 HTML transferred: 12955000 bytes
	 Requests per second: 9.30 [# / sec] (mean)
 Time per request: 214.993 [ms] (mean)
 Time per request: 107.497 [ms] (mean, across all concurrent requests)
 Transfer rate: 242.09 [Kbytes / sec] received

 Connection Times (ms)
               min mean [+/- sd] median max
 Connect: 0 0 0.8 0 19
 Processing: 51 215 313.9 197 5090
 Waiting: 51 215 313.9 196 5090
 Total: 51 215 313.9 197 5090 </pre><br><br>  <b>9.3 requests per second</b> <br><br>  We connect ElastiCache and do new tests: <br><br><pre>  Concurrency Level: 2
 Time taken for tests: 67.987 seconds
 Complete requests: 500
 Failed requests: 0
 Write errors: 0
 Total transferred: 13323973 bytes
 HTML transferred: 12954973 bytes
 Requests per second: 7.35 [# / sec] (mean)
 Time per request: 271.947 [ms] (mean)
 Time per request: 135.973 [ms] (mean, across all concurrent requests)
 Transfer rate: 191.39 [Kbytes / sec] received

 Connection Times (ms)
               min mean [+/- sd] median max
 Connect: 0 0 0.0 0 0
 Processing: 114 272 101.1 279 1293
 Waiting: 114 272 101.1 279 1293
 Total: 114 272 101.1 279 1293 </pre><br><br>  <b>7.35 requests per second</b> <br><br>  Slower! <br><br>  The local disk cache works more efficiently than memcached, with which we ‚Äúcommunicate‚Äù via TCP / IP.  (I‚Äôll note at once that locally raised memcached is also faster on the same machine.) <br><br>  * * * <br><br>  <b>Look at Joomla</b> <br><br>  Conditions for tests are similar - to the EC2 virtual machine (also small, in the same AZ) we put Joomla 1.7 with a sample demo content. <br><br>  Run the test - the same ab: <br><br><pre>  Concurrency Level: 2
 Time taken for tests: 107.028 seconds
 Complete requests: 500
 Failed requests: 0
 Write errors: 0
 Total transferred: 8247000 bytes
 HTML transferred: 8068000 bytes
 Requests per second: 4.67 [# / sec] (mean)
 Time per request: 428.110 [ms] (mean)
 Time per request: 214.055 [ms] (mean, across all concurrent requests)
 Transfer rate: 75.25 [Kbytes / sec] received

 Connection Times (ms)
               min mean [+/- sd] median max
 Connect: 0 0 0.0 0 0
 Processing: 159 428 797.5 388 17777
 Waiting: 159 428 797.5 388 17777
 Total: 159 428 797.5 388 17777 </pre><br><br>  <b>4.67 requests per second</b> <br><br>  Somehow slowly ... <br><br>  Go to the admin area and see that caching is turned off by default. <br><br>  It can be enabled, there are two modes - conservative and progressive. <br><br>  We use standard storage - file system.  In the first case, <b>6.6 requests per second are</b> obtained, in the second - <b>7.2</b> : <br><br><pre>  Concurrency Level: 2
 Time taken for tests: 69.440 seconds
 Complete requests: 500
 Failed requests: 0
 Write errors: 0
 Total transferred: 8036000 bytes
 HTML transferred: 7857000 bytes
 Requests per second: 7.20 [# / sec] (mean)
 Time per request: 277.761 [ms] (mean)
 Time per request: 138.880 [ms] (mean, across all concurrent requests)
 Transfer rate: 113.01 [Kbytes / sec] received

 Connection Times (ms)
               min mean [+/- sd] median max
 Connect: 0 0 0.7 0 17
 Processing: 123 277 72.3 267 852
 Waiting: 123 277 72.4 267 852
 Total: 123 277 72.3 267 852 </pre><br><br>  We connect for storage of memcache. <br><br>  Generally speaking, as conceived by Joomla developers, this can be done through the administrative interface. <br><br>  However, the ability to basically use memcache is checked by this code: <br><br> <code>public static function test() <br> { <br> if ((extension_loaded('memcache') &amp;&amp; class_exists('Memcache')) != true ) { <br> return false; <br> } <br> <br> $config = JFactory::getConfig(); <br> $host = $config-&gt;get('memcache_server_host', 'localhost'); <br> $port = $config-&gt;get('memcache_server_port', 11211); <br> <br> $memcache = new Memcache; <br> $memcachetest = @$memcache-&gt;connect($host, $port); <br> <br> if (!$memcachetest) { <br> return false; <br> } else { <br> return true; <br> } <br> }</code> <br> <br>  If the test function returns false, memcache will not be in the menu for selecting storage. <br><br>  That is, for the initial indication of the connection parameters, we need to either explicitly set the parameters in the configuration.php configuration file, or run the ‚Äúdefault‚Äù memcached (localhost: 11211). <br><br>  Specify in configuration.php: <br><br> <code>public $memcache_persist = '1'; <br> public $memcache_compress = '0'; <br> public $memcache_server_host = 'testcache.lfffta.0001.use1.cache.amazonaws.com'; <br> public $memcache_server_port = '11211';</code> <br> <br>  Testing: <br><br><pre>  Concurrency Level: 2
 Time taken for tests: 140.928 seconds
 Complete requests: 500
 Failed requests: 3
    (Connect: 0, Receive: 0, Length: 3, Exceptions: 0)
 Write errors: 0
 Non-2xx responses: 3
 Total transferred: 8002436 bytes
 HTML transferred: 7823370 bytes
 Requests per second: 3.55 [# / sec] (mean)
 Time per request: 563.712 [ms] (mean)
 Time per request: 281.856 [ms] (mean, across all concurrent requests)
 Transfer rate: 55.45 [Kbytes / sec] received

 Connection Times (ms)
               min mean [+/- sd] median max
 Connect: 0 0 0.0 0 0
 Processing: 142 563 397.1 461 3942
 Waiting: 142 563 397.1 460 3942
 Total: 142 564 397.1 461 3942 </pre><br><br>  <b>3.55 requests</b> <br><br>  Expected - slower.  :( <br><br>  But unexpectedly - even slower than without using a cache at all.  :( <br><br>  At once I will say that in the end I tried to take another Cache Cluster for tests, with more powerful cache nodes.  Got an extra small performance boost compared to the "test sample". <br><br>  * * * <br><br>  <b>We summarize</b> <br><br>  In short, for medium-sized projects (most of which), Amazon ElastiCache does not make much sense at the moment ... :( <br><ul><li>  Configuration is comparable (if not more difficult) with setting up a local memcached on the same (or other) instance. </li><li>  The price is comparable to EC2 (small ElastiCache 1.3 GB - $ 0.095 per hour, small EC2 1.7 GB - $ 0.085 per hour). </li><li>  Can only be used with other AWS services. </li><li>  Separate EndPoint for each node (and not for the entire Cache Cluster as a whole) allow you to use scaling features, etc.  only in those products in which you can connect more than one memcached server (as, for example, in the same 1C-Bitrix web cluster). </li></ul><br>  When it is possible, necessary and useful to use ElastiCache: <br><ul><li>  On large projects where a huge (and - importantly - scalable both upward and downward) cache is required.  ElastiCache allows you to use a very large number of different metrics in CloudWatch (from the amount of transferred data and hits to CPU Utilization and the amount of used / unused memory) by which you can set certain rules for automatic scaling. </li><li>  In those projects where the availability of cache servers is critical (ElastiCache monitors the status of the cache cluster nodes and automatically restores them in case of any problems). </li></ul><br>  Generally speaking, of course, Amazon is moving in the right direction, providing more and more "cloud" services.  The more choice the user has, the better. <br><br>  Well, with ElastiCache, I hope, over time, it will be possible to work faster and cheaper. </div><p>Source: <a href="https://habr.com/ru/post/127602/">https://habr.com/ru/post/127602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127593/index.html">The mechanism for the exercise of their legal rights by the owners of personal data</a></li>
<li><a href="../127595/index.html">Startup in Russian: today and tomorrow</a></li>
<li><a href="../127596/index.html">Apple resumed sales of Final Cut Studio Pro</a></li>
<li><a href="../127597/index.html">Google Searched Queries</a></li>
<li><a href="../127599/index.html">An interesting feature of PCoIP in VMware View</a></li>
<li><a href="../127603/index.html">Access Oracle Database with ADO.NET Entity Framework</a></li>
<li><a href="../127604/index.html">Alyosha Popovich vs Tugarin Snake or how I struggled with spam</a></li>
<li><a href="../127605/index.html">HTC Titan, HTC Radar and HTC Mozart officially presented</a></li>
<li><a href="../127606/index.html">Motivate correctly - give bream</a></li>
<li><a href="../127608/index.html">The tender for the game about the Great Patriotic War for 90 million</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>