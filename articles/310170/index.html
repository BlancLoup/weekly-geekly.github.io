<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forcing to caching: fasten L2 Apache Ignite cache to Activiti</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It often happens that there is a good library, but something is missing in it, some pearl buttons. So it‚Äôs to me with Activiti , a rather popular busi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Forcing to caching: fasten L2 Apache Ignite cache to Activiti</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e57/9dc/358/e579dc358bf54b169825fb6300943284.jpg" align="left">  It often happens that there is a good library, but something is missing in it, some pearl buttons.  So it‚Äôs to me with <a href="http://activiti.org/">Activiti</a> , a rather popular business process engine with BPMN 2.0 support, valuable for its Java nativeness.  Without going into details of the internal structure of this open source product, it is quite obvious that in his work he uses a variety of data: metadata of business process definitions, instance data and historical data.  For their storage, Activiti uses a DBMS, allowing you to choose from DB2, H2, Oracle, MySQL, MS SQL and PostgreSQL.  This engine is very good, and is used not only for small crafts.  Perhaps the question of support for caching database accesses in this product arose not only from me.  At least once he <a href="https://forums.activiti.org/content/cache-activiti">asked the developers</a> , who responded to it in the sense that the metadata is cached, but for the rest of the data there is not much point in this and it is not easy.  In principle, it is possible to agree about the absence of a big sense - the data of a specific instance or its historical data with a small probability can be reused.  But the scenario, when this still happens, is also possible.  For example, if we have a cluster of Activiti servers with a common base.  In general, a person with an inquisitive mind may well want to have a decent cache in Activiti.  For example, use <a href="https://ignite.apache.org/">Apache Ignite for this</a> . <br><br>  Under a cat an example of the decision of this problem, the code is laid out on <a href="https://github.com/kvmorozov/CachedActiviti">GitHub</a> . <br><a name="habracut"></a><br><h2>  Thinking of the task </h2><br>  What do we have for this?  First of all, the developer-guaranteed cache of process definitions <a href="">stored</a> in java.util.HashMap, which cannot be called an enterprise solution.  For access to the database, Activiti uses the Mybatis library, which, of course, caching supports.  For its operation, Mybatis uses xml configurations, and Activiti has a lot of these xml, and they contain definitions of queries of approximately the following form: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"selectJob"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parameterType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">resultMap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jobResultMap"</span></span></span><span class="hljs-tag">&gt;</span></span> select * from ${prefix}ACT_RU_JOB where ID_ = #{id, jdbcType=VARCHAR} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The links below provide a habostat on how to cross Apache Ignite with Mybatis.  From it, it becomes clear that if the <b>select</b> tag was set to <b>useCache = "true"</b> , and the cache type was specified ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.mybatis.caches.ignite.IgniteCacheAdapter"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  ... that would be almost enough.  It also indicates the micro-library org.mybatis.caches: mybatis-ignite in which there are exactly 2 classes and no specifics of Mybatis.  That is, quite a common solution. <br><br>  Although Activiti lives on GitHub and you can fork it, make changes to Mybatis configs and enjoy caching, I suggest not to go this way.  This condemns us to maintaining our own version of a rather rather big project created for the sake of making foolish changes.  But Activiti supports Spring Boot and this opens up new perspectives.  For the experiment, the latter was taken at the time of writing the 4th beta of Activiti version 6.0. <br><br><h2>  Decision </h2><br>  Sql queries in Mybatis are described by the org.apache.ibatis.mapping.MappedStatement class, which, as it is not difficult to guess, has an <i>isUseCache</i> method.  MappedStatement objects are returned by the org.apache.ibatis.session.Configuration class, which has a <i>getMappedStatement</i> method.  And the configuration is created in the org.activiti.spring.SpringProcessEngineConfiguration class, which is injected during the Spring Boot autoconfiguration process.  Thus, it is necessary to somehow influence the result returned by the MappedStatement class.  Unfortunately, there are no very simple ways to do this, and I haven‚Äôt found anything better than to instruct everything using the cglib library, which comes to us with the spring.  The algorithm is briefly like this: override the Spring Boot autoconfiguration for the SpringProcessEngineConfiguration object, which manages the Activiti configuration, replacing the object with its instrumented version, which returns the instrumented Configuration object, which returns the new MappedStatement objects (unfortunately, this is the final class, you cannot instruct it with cglib) who think they should use the cache.  And yes, the new Configuration object knows about the existence of Apache Ignite.  It may sound complicated, but in fact everything is transparent (just in case the link on the cglib guide is attached). <br><br><div class="spoiler">  <b class="spoiler_title">The final code will be</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>(name = <span class="hljs-string"><span class="hljs-string">"javax.persistence.EntityManagerFactory"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(ActivitiProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CachedJpaConfiguration</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaProcessEngineAutoConfiguration</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SpringProcessEngineConfiguration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">springProcessEngineConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( DataSource dataSource, EntityManagerFactory entityManagerFactory, PlatformTransactionManager transactionManager, SpringAsyncExecutor springAsyncExecutor)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCachedConfig(<span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.springProcessEngineConfiguration (dataSource, entityManagerFactory, transactionManager, springAsyncExecutor)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SpringProcessEngineConfiguration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCachedConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> SpringProcessEngineConfiguration parentConfig)</span></span></span><span class="hljs-function"> </span></span>{ Enhancer enhancer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Enhancer(); CallbackHelper callbackHelper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CallbackHelper(SpringProcessEngineConfiguration.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[<span class="hljs-number"><span class="hljs-number">0</span></span>]) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method.getName().equals(<span class="hljs-string"><span class="hljs-string">"initMybatisConfiguration"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (MethodInterceptor) (obj, method1, args, proxy) -&gt; getCachedConfiguration( (org.apache.ibatis.session.Configuration) proxy.invokeSuper(obj, args)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NoOp.INSTANCE; } } }; enhancer.setSuperclass(SpringProcessEngineConfiguration.class); enhancer.setCallbackFilter(callbackHelper); enhancer.setCallbacks(callbackHelper.getCallbacks()); SpringProcessEngineConfiguration result = (SpringProcessEngineConfiguration) enhancer.create(); result.setDataSource(parentConfig.getDataSource()); result.setTransactionManager(parentConfig.getTransactionManager()); result.setDatabaseSchemaUpdate(<span class="hljs-string"><span class="hljs-string">"create-drop"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> org.apache.ibatis.session.<span class="hljs-function"><span class="hljs-function">Configuration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCachedConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(org.apache.ibatis.session.Configuration configuration)</span></span></span><span class="hljs-function"> </span></span>{ Enhancer enhancer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Enhancer(); enhancer.setSuperclass(org.apache.ibatis.session.Configuration.class); enhancer.setCallback(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachedConfigurationHandler(configuration)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (org.apache.ibatis.session.Configuration) enhancer.create(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CachedConfigurationHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvocationHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> org.apache.ibatis.session.Configuration configuration; CachedConfigurationHandler(org.apache.ibatis.session.Configuration configuration) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.configuration = configuration; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.configuration.addCache(IgniteCacheAdapter.INSTANCE); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object proxy, Method method, Object[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ Object originalResult = method.invoke(configuration, args); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method.getName().equals(<span class="hljs-string"><span class="hljs-string">"getMappedStatement"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCachedMappedStatement((MappedStatement) originalResult); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> originalResult; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> MappedStatement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCachedMappedStatement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MappedStatement mappedStatement)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MappedStatement .Builder(mappedStatement.getConfiguration(), mappedStatement.getId(), mappedStatement.getSqlSource(), mappedStatement.getSqlCommandType()) .databaseId(mappedStatement.getDatabaseId()) .resource(mappedStatement.getResource()) .fetchSize(mappedStatement.getFetchSize()) .timeout(mappedStatement.getTimeout()) .statementType(mappedStatement.getStatementType()) .resultSetType(mappedStatement.getResultSetType()) .parameterMap(mappedStatement.getParameterMap()) .resultMaps(mappedStatement.getResultMaps()) .cache(IgniteCacheAdapter.INSTANCE) .useCache(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .build(); } }</code> </pre><br></div></div><br>  Pay attention to the line: <br><br><pre> <code class="java hljs">result.setDatabaseSchemaUpdate(<span class="hljs-string"><span class="hljs-string">"create-drop"</span></span>);</code> </pre> <br>  Here we have provided the automatic creation of Activiti tables.  Do not do this in production. <br><br>  Now you need to connect Ignite.  I will not describe its installation and configuration here, the version was used 1.7.0.  In the simplest version that I used, it is enough just to download and unpack it.  Its configuration in the application can be done in two ways: via xml, since Ignite is a Spring application, or by Java code.  I chose the second option: <br><br><div class="spoiler">  <b class="spoiler_title">The simplest config for Ignite in Java</b> <div class="spoiler_text"><pre> <code class="java hljs"> IgniteConfiguration igniteCfg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteConfiguration(); igniteCfg.setGridName(<span class="hljs-string"><span class="hljs-string">"testGrid"</span></span>); igniteCfg.setClientMode(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); igniteCfg.setIgniteHome(<span class="hljs-string"><span class="hljs-string">"&lt;IGNITE_HOME&gt;"</span></span>); CacheConfiguration config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CacheConfiguration(); config.setName(<span class="hljs-string"><span class="hljs-string">"myBatisCache"</span></span>); config.setCacheMode(CacheMode.LOCAL); config.setStatisticsEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); config.setWriteSynchronizationMode(CacheWriteSynchronizationMode.FULL_SYNC); igniteCfg.setCacheConfiguration(config); TcpDiscoverySpi tcpDiscoverySpi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TcpDiscoverySpi(); TcpDiscoveryJdbcIpFinder jdbcIpFinder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TcpDiscoveryJdbcIpFinder(); jdbcIpFinder.setDataSource(dataSource); tcpDiscoverySpi.setIpFinder(jdbcIpFinder); tcpDiscoverySpi.setLocalAddress(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>); igniteCfg.setDiscoverySpi(tcpDiscoverySpi); TcpCommunicationSpi tcpCommunicationSpi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TcpCommunicationSpi(); tcpCommunicationSpi.setLocalAddress(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>); igniteCfg.setCommunicationSpi(tcpCommunicationSpi);</code> </pre><br></div></div><br>  The IgniteCacheAdapter class, in which this configuration lies, is based on a simplified version of the class from the org.mybatis.caches library: mybatis-ignite.  Actually, that's all, our requests are cached.  Pay attention to the specified path to the runtime Ignite, here it is necessary to substitute your own. <br><br><h2>  results </h2><br>  You can test the application using the calls of the REST services described in the guide [2], there is a simple business process for reviewing the summary.  By running several times, you can see the statistics, the collection of which was enabled with the config.setStatisticsEnabled (true) command: <br><br><pre> <code class="java hljs">Ignition.ignite(<span class="hljs-string"><span class="hljs-string">"testGrid"</span></span>).getOrCreateCache(<span class="hljs-string"><span class="hljs-string">"myBatisCache"</span></span>).metrics();</code> </pre> <br>  In the debug you can see these metrics, in particular, the number of reads from the cache and the number of misses.  After 2 process launches 16 readings and 16 misses.  That is, the cache never hit. <br><br><h2>  findings </h2><br>  Specifically, in the considered example, as it turned out, L2 cache is not needed.  But it was a very simple and not indicative example.  Perhaps in a more complex topology and with a different nature of the load, with several users, the picture will be different.  As they say, we will look for ... <br><br>  The article also showed the possibility of not very rude intervention in a large library for a significant change in its behavior. <br><br><h2>  Links </h2><br><ul><li>  [1] <a href="https://github.com/kvmorozov/CachedActiviti">GitHub sample code</a> </li><li>  [2] <a href="https://habrahabr.ru/company/at_consulting/blog/280452/">Article about using Apache Ignite as MyBatis L2 cache</a> </li><li>  [3] <a href="https://spring.io/blog/2015/03/08/getting-started-with-activiti-and-spring-boot">Getting started with Activiti and Spring Boot</a> </li><li>  [4] <a href="https://dzone.com/articles/cglib-missing-manual">cglib manual</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/310170/">https://habr.com/ru/post/310170/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310160/index.html">Installing Quartus II on CentOS</a></li>
<li><a href="../310162/index.html">Progrobot: programming language help bot</a></li>
<li><a href="../310164/index.html">Linux debugging tools</a></li>
<li><a href="../310166/index.html">Modern web development for schoolchildren</a></li>
<li><a href="../310168/index.html">The potential benefits of iOS 10 for developing and testing mobile applications (Translated article)</a></li>
<li><a href="../310172/index.html">Functional programming jargon</a></li>
<li><a href="../310174/index.html">Exposing antivirus tests</a></li>
<li><a href="../310176/index.html">Logeek Night in Voronezh</a></li>
<li><a href="../310180/index.html">What is such a Data? Or again about MapReduce</a></li>
<li><a href="../310182/index.html">The problem of dissonance between the narrative and the gameplay</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>