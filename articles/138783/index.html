<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimizing work with templates in Backbone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I, like many others, started my acquaintance with the Backbone javascript framework with the todo-tutorial , on the basis of which the framework was u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimizing work with templates in Backbone</h1><div class="post__text post__text-html js-mediator-article">  I, like many others, started my acquaintance with the Backbone javascript framework with the <a href="http://documentcloud.github.com/backbone/examples/todos/index.html">todo-tutorial</a> , on the basis of which the framework was used further in my projects. <br><br>  But tutorials end, and working days begin. <br><br><a name="habracut"></a><br>  I think many people know such a piece of code (from the above tutorial): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.AppView = Backbone.View.extend({ <span class="hljs-comment"><span class="hljs-comment">// Instead of generating a new element, bind to the existing skeleton of // the App already present in the HTML. el: $("#todoapp"), // Our template for the line of statistics at the bottom of the app. statsTemplate: _.template($('#stats-template').html()), ...</span></span></code> </pre> <br><br>  Let's see more: <br><ul><li>  declaration of the AppView type must be done after the DOM tree is ready, that is, it is wrapped in jQuery (function () {...}), which is not always convenient. </li><li>  The statsTemplate template is loaded during the view declaration stage so that instances can use it without additional loading and processing. </li><li>  the template is located at the bottom of the html page and is loaded into the DOM when the page loads </li></ul><br><br>  Of course, for small applications there are no questions.  And if the application is large and contains dozens of templates? <br>  Why load and initialize all templates at once?  We may not need most of them. <br><br><h4>  Loading templates </h4><br><br>  It would be nice to load templates only when we need them and cache them. <br><br>  Based on this, we will write the bootloader: <br><pre> <code class="javascript hljs"> Core.Template = { <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: {}, <span class="hljs-comment"><span class="hljs-comment">//     pending: {}, //  callback-,       load: function(url, callback) { callback = callback || function() {}; if (this.cache[url]) { //   ,   callback callback(this.cache[url]); return; } //  callback   if (this.pending[url]) { this.pending[url].push(callback); return; } this.pending[url] = [callback]; jQuery.ajax({ //  url : url, dataType: 'text', complete: function(resp) { var cache = this.cache[url] = _.template(resp.responseText); //      _.each(this.pending[url], function(cb) { //   cb(cache); }); delete this.pending[url]; //   }.bind(this), error: function() { throw new Error("Could not load " + url); } }); } };</span></span></code> </pre><br><br>  Downloading the template by ajax, we have an additional opportunity to cache it using the browser. <br>  The queue is made to ensure that the loader does not load the template for each type of model from our collection, but did it once and passed the template ready for work to each type. <br><br>  I hope that comments on the code are enough to understand how everything works. <br>  Next, we need to teach our views to work with templates in new ways. <br><br><h4>  Base view class for working with templates </h4><br><br>  We write the base class of the form so that it can work with our template loader. <br><br><pre> <code class="javascript hljs"> Core.View = Backbone.View.extend({ <span class="hljs-attr"><span class="hljs-attr">renderQueue</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">//     initialize: function() { if (this.templateUrl) { Core.Template.load(this.templateUrl, function(data) { this.template = data; //   if (this.renderQueue !== false) { //     _.each(this.renderQueue, function(item) { this._render.apply(this, item); }.bind(this)); this.renderQueue = false; } }.bind(this)); } }, _render: function() {}, //        render render: function() { if (!this.template) { //     -      this.renderQueue = this.renderQueue || []; this.renderQueue.push(arguments); return this; } return this._render.apply(this, arguments); //   } });</span></span></code> </pre><br><br>  Thus, if templateUrl is passed in our view parameters, then we load the template, otherwise we work according to the usual logic. <br>  The only difference from the standard behavior, the direct rendering function is put into the _render method.  In principle, nothing prevents to rewrite the code that wraps everything in the render method, but it seemed so more convenient and easier for me. <br><br><h4>  Using </h4><br><br>  What in practice? <br>  This is how the modified part of the code shown at the beginning of the article will look like: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.AppView = Core.View.extend({ <span class="hljs-attr"><span class="hljs-attr">el</span></span>: $(<span class="hljs-string"><span class="hljs-string">"#todoapp"</span></span>), <span class="hljs-comment"><span class="hljs-comment">//    templateUrl: '/templates/app.html', initialize: function() { AppView.__super__.initialize.apply(this); //    ... }, //  render  _render  statsTemplate  template _render: function() { this.$('#todo-stats').html(this.template({ total: Todos.length, done: Todos.done().length, remaining: Todos.remaining().length })); }, ...</span></span></code> </pre><br><br>  Done! <br><br>  Loader code is available <a href="http://github.com/glibin/backbone-template-loader">here</a> . <br>  An example of a modified todo-tutorial can be found <a href="http://glibin.github.com/backbone-template-loader">here</a> . <br>  If interested, what has changed in todo: <a href="https://github.com/glibin/backbone-template-loader/commit/ce1928d2b9a95ffb6bb9115edffb5aa7f95a246c">diff</a> <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/138783/">https://habr.com/ru/post/138783/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138771/index.html">Debugging iframe applications directly in the vk.com environment using php + xdebug</a></li>
<li><a href="../138777/index.html">New Visual Studio 11 Interface</a></li>
<li><a href="../138778/index.html">Project Management: the film "The Man Who Changed Everything"</a></li>
<li><a href="../138779/index.html">Vulnerable by definition</a></li>
<li><a href="../138780/index.html">Google, Microsoft and Netflix want to add DRM to HTML5</a></li>
<li><a href="../138784/index.html">HowTo: continuous integration of Django to Jenkins using Selenium</a></li>
<li><a href="../138785/index.html">Deploying Java applications to Windows Azure using ant</a></li>
<li><a href="../138786/index.html">Taming Windows Server Core</a></li>
<li><a href="../138788/index.html">Digium launches its own IP phones</a></li>
<li><a href="../138791/index.html">PostGIS + Mapnik + TileCache on FreeBSD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>