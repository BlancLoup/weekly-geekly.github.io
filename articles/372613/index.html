<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I stepped on a rake and figured out with the NanoPi2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About 3 months ago, I got the idea to make a race on typewriters controlled via the Internet. 

 Analogue micro- racing and race tarantasov . Both of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I stepped on a rake and figured out with the NanoPi2</h1><div class="post__text post__text-html js-mediator-article">  About 3 months ago, I got the idea to make a race on typewriters controlled via the Internet. <br><br>  Analogue micro- <a href="https://habrahabr.ru/post/146321/">racing</a> and <a href="https://habrahabr.ru/post/146321/">race tarantasov</a> .  Both of these projects have stalled, for one reason or another. <br><br>  I began to select a single-board, which would be most suitable for this project.  You could use virt2real or Raspberry PI, well, or in extreme cases, tp-link tl-mr3020 with CyberWRT on board. <br><a name="habracut"></a><br>  But I came <a href="http://wiki.friendlyarm.com/wiki/index.php/NanoPi_2">across a NanoPi2</a> board, which, as I thought then, is a complete clone of the Raspberry PI, only smaller in size, and with WI-FI on board. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I ordered a fee in the amount of 2 pieces and began to expect when they would come, the seller was not very decent from Blagoveshchensk and first told me one thing, then the other, promised various buns in the form of gifts. <br><br>  But somehow, after 1.5 months, the fees came to me.  I want to pay tribute to the Chinese, when I ordered additional cameras from them for this board, they came in 1.5 weeks. <br><br>  Actually, when the boards arrived, I started installing modules for my project. <br><br>  The first deep disappointment struck me when I was unable to connect a Logitech c270 camera.  I tried various programs under Debian, which I have installed as an operating system.  In the end, I achieved the translation of the video stream into the grid, it turned out that the configuration file in the <a href="https://ru.wikipedia.org/wiki/Motion_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B0_%25D0%25B2%25D0%25B8%25D0%25B4%25D0%25B5%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B1%25D0%25BB%25D1%258E%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F)">Motion</a> program changed, and those variables that had to be changed were called differently.  I upload the working configuration file for Motion <a href="https://drive.google.com/open%3Fid%3D0BzXeM83ZneW2SFZ2M0VIRnlOWVU">here</a> <br><br>  Installation of motion is simple to disgrace. <br><pre><code class="bash hljs">-----------  ----------- <span class="hljs-comment"><span class="hljs-comment"># apt-get update # apt-get upgrade -----------  Motion ----------- # apt-get install motion ----------- ,    (   Logitech c270). ----------- #lsusb -----------</span></span></code> </pre> <br>  The console gives us something like this. <br><br><pre> <code class="bash hljs">Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 001 Device 002: ID 046d:0825 Logitech, Inc. Webcam C270 Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code> </pre><br><br>  Where the 2nd line shows us that the camera is connected to our computer. <br><br>  Next we need to fix the configuration file. <br><br>  We pass to the folder / etc / motion and replace the file motion.conf (with the one I posted above by reference).  For this, I use WinSCP. <br><br>  Well, then the most interesting thing began, it was necessary to somehow manage the GPIO outputs.  As I wrote earlier, the board was an incomplete clone of the Raspberry Pi.  So all the libraries for working with GPIO, from the malinki were overboard. <br><br>  I found 2 <a href="https://github.com/friendlyarm/matrix-python">matrix-python</a> and <a href="https://github.com/friendlyarm/matrix">matrix</a> libraries.  But unfortunately both libraries didn't suit me very much. <br><br>  In the first, there was functionality for working with GPIO, but there was no functionality for working with PWM to connect a servo drive.  The second turned out to be at all on C, and I am not very friendly with the sami. <br><br>  In general, I began to deal with <b>ctypes</b> , I‚Äôll immediately tell you that a lot of copies were broken, it would connect to the library, but function calls returned various errors such as contact could not be used.  I even started looking for a freelancer who would help me to make a wrapper for the <b>matrix</b> library, I found a couple of people but they were busy and I didn‚Äôt have time to talk specifically with a person on Skype.  And then it dawned on me, we must completely repeat the code, which was cited as an example in C. <br><br>  The very first attempt, even without one of the functions, was crowned with success; well, I did not think that the <b>boardInit ()</b> function actually initialized the library.  And that's what came out of it. <br><br>  The program works with PWM in Python. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * lib = cdll.LoadLibrary(<span class="hljs-string"><span class="hljs-string">'/root/matrix-master/lib/libfahw.so'</span></span>) lib.boardInit() os.system(<span class="hljs-string"><span class="hljs-string">"modprobe matrix_pwm"</span></span>) lib.PWMPlay(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>) i = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> i &lt; <span class="hljs-number"><span class="hljs-number">1000</span></span>: print(i) i = i + <span class="hljs-number"><span class="hljs-number">10</span></span> time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) lib.PWMPlay(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, i) lib.PWMStop(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br><br>  Program for working with GPIO on Python. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * lib = cdll.LoadLibrary(<span class="hljs-string"><span class="hljs-string">'/root/matrix-master/lib/libfahw.so'</span></span>) lib.boardInit() os.system(<span class="hljs-string"><span class="hljs-string">"modprobe matrix_gpio_int"</span></span>) lib.exportGPIOPin(<span class="hljs-number"><span class="hljs-number">22</span></span>) lib.setGPIODirection(<span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) lib.setGPIOValue(<span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>) lib.setGPIOValue(<span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) lib.unexportGPIOPin(<span class="hljs-number"><span class="hljs-number">22</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-number"><span class="hljs-number">222</span></span></code> </pre><br><br>  Accordingly, in order to start working with the library, it is necessary to download it from the <a href="https://github.com/friendlyarm/matrix">site</a> and install it. <br><br>  At the moment, I have already deployed the server on Flask, on the NanoPi2, and are already starting to connect the servo drive and the engine of the broken son's machine. </div><p>Source: <a href="https://habr.com/ru/post/372613/">https://habr.com/ru/post/372613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../372601/index.html">Intel Joule: details</a></li>
<li><a href="../372605/index.html">Linux 25 years</a></li>
<li><a href="../372607/index.html">Google Neural Network Compresses Photos Better JPEG</a></li>
<li><a href="../372609/index.html">Lenovo Phab 2 Pro - the world's first smartphone with Tango</a></li>
<li><a href="../372611/index.html">The 99.9% ghostly galaxy consists of dark matter and contains almost no stars.</a></li>
<li><a href="../372615/index.html">VKontakte plans to launch an internal money transfer system</a></li>
<li><a href="../372617/index.html">Why we still do not have new generation batteries?</a></li>
<li><a href="../372619/index.html">Ask Ethan # 85: Hubble vs. the Big Bang</a></li>
<li><a href="../372621/index.html">Why the National Encyclopedic Portal has no chance against Wikipedia</a></li>
<li><a href="../372623/index.html">Digital heroin: how screens turn children into psychotic addicts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>