<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino Leonardo as a SegaMegaDrive Gamepad Adapter-> USB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Recently I discovered in myself two long forgotten old gamepads from SMD, the prefix itself was lost for a long time and gamepads all this ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino Leonardo as a SegaMegaDrive Gamepad Adapter-> USB</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  Recently I discovered in myself two long forgotten old gamepads from SMD, the prefix itself was lost for a long time and gamepads all this time were gathering dust, but they are workers and they don‚Äôt raise the ‚Äúlive‚Äù devices.  I decided to connect them to a computer, at least some use for them, and as an adapter we use Arduino Leonardo. <br><a name="habracut"></a><br><h4>  SMD gamepad protocol </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/6ba/ff8/fa8/6baff8fa827eb257de3fe12736c6fd89.png" alt="image"><br>  In the simplest case, getting the data looks like this: <br><br><table><tbody><tr><th>  PIN </th><th>  Direction </th><th>  Select = LOW </th><th>  Select = HIGH </th></tr><tr><td>  one </td><td>  IN </td><td>  UP </td><td>  UP </td></tr><tr><td>  2 </td><td>  IN </td><td>  DOWN </td><td>  DOWN </td></tr><tr><td>  3 </td><td>  IN </td><td>  HIGH </td><td>  LEFT </td></tr><tr><td>  four </td><td>  IN </td><td>  HIGH </td><td>  Right </td></tr><tr><td>  five </td><td>  Out </td><td>  5v </td><td>  5v </td></tr><tr><td>  6 </td><td>  IN </td><td>  A </td><td>  B </td></tr><tr><td>  7 </td><td>  Out </td><td>  Select </td><td>  Select </td></tr><tr><td>  eight </td><td>  Out </td><td>  GND </td><td>  GND </td></tr><tr><td>  9 </td><td>  IN </td><td>  Start </td><td>  C </td></tr></tbody></table><br>  Indicators change depending on the change of the Pin. <br>  As you can see here there are not enough 4 keys. <br>  Getting them is a bit complicated: you need to make 2 changes to Select LOW-&gt; HIGH with an interval of 1.1-1.2 milliseconds, after which the pins 1,2,3,4 become LOW, and with another change to Select LOW-&gt; HIGH, Z values ‚Äã‚Äãappear on them Y, X, Mode, respectively. <br><br><table><tbody><tr><th>  Select </th><th>  PIN 1 </th><th>  PIN 2 </th><th>  PIN 3 </th><th>  PIN 4 </th></tr><tr><td>  LOW </td><td>  UP </td><td>  DOWN </td><td>  LOW </td><td>  LOW </td></tr><tr><td>  HIGH </td><td>  UP </td><td>  DOWN </td><td>  LEFT </td><td>  Right </td></tr><tr><td>  LOW </td><td>  UP </td><td>  DOWN </td><td>  LOW </td><td>  LOW </td></tr><tr><td>  HIGH </td><td>  UP </td><td>  DOWN </td><td>  LEFT </td><td>  Right </td></tr><tr><td>  LOW </td><td>  LOW </td><td>  LOW </td><td>  LOW </td><td>  LOW </td></tr><tr><td>  HIGH </td><td>  Z </td><td>  Y </td><td>  X </td><td>  MODE </td></tr><tr><td>  LOW </td><td>  HIGH </td><td>  HIGH </td><td>  HIGH </td><td>  HIGH </td></tr><tr><td>  HIGH </td><td>  UP </td><td>  DOWN </td><td>  LEFT </td><td>  Right </td></tr><tr><td>  LOW </td><td>  UP </td><td>  DOWN </td><td>  LOW </td><td>  LOW </td></tr></tbody></table>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Library </h4><br>  For convenience, I wrote a simple library to work with a gamepad. <br><br><div class="spoiler">  <b class="spoiler_title">SMDjoystick.h</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _SMDJOYSTICK_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _SMDJOYSTICK_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Arduino.h&gt; /** SegaMegaDrive gamepad arduino library by AsGreyWolf **/ enum{ SMD_A=0, SMD_B, SMD_C, SMD_EMPTY_1, SMD_X, SMD_Y, SMD_Z, SMD_MODE, SMD_EMPTY_2, SMD_START, SMD_EMPTY_3, SMD_EMPTY_4, SMD_UP, SMD_DOWN, SMD_LEFT, SMD_RIGHT, SMD_MAX_KEYS }; class SMDjoystick{ public: SMDjoystick(int upPin,int downPin,int leftPin,int rightPin,int aPin,int selectPin,int startPin); bool read(int key); uint16_t read(); private: int up; int down; int left; int right; int a; int select; int start; }; #endif</span></span></span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">SMDjoystick.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SMDjoystick.h"</span></span></span><span class="hljs-meta"> SMDjoystick::SMDjoystick(int upPin,int downPin,int leftPin,int rightPin,int aPin,int selectPin,int startPin):up(upPin),down(downPin),left(leftPin),right(rightPin),a(aPin),select(selectPin),start(startPin){ pinMode(up,INPUT); pinMode(down,INPUT); pinMode(left,INPUT); pinMode(right,INPUT); pinMode(a,INPUT); pinMode(start,INPUT); pinMode(select,OUTPUT); } uint16_t SMDjoystick::read(){ uint16_t data=0; digitalWrite(select,LOW); data+=!digitalRead(a)&lt;&lt;SMD_A; data+=!digitalRead(start)&lt;&lt;SMD_START; data+=!digitalRead(up)&lt;&lt;SMD_UP; data+=!digitalRead(down)&lt;&lt;SMD_DOWN; delayMicroseconds(1200); digitalWrite(select,HIGH); data+=!digitalRead(left)&lt;&lt;SMD_LEFT; data+=!digitalRead(right)&lt;&lt;SMD_RIGHT; data+=!digitalRead(a)&lt;&lt;SMD_B; data+=!digitalRead(start)&lt;&lt;SMD_C; digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); digitalWrite(select,HIGH); data+=!digitalRead(up)&lt;&lt;SMD_Z; data+=!digitalRead(down)&lt;&lt;SMD_Y; data+=!digitalRead(left)&lt;&lt;SMD_X; data+=!digitalRead(right)&lt;&lt;SMD_MODE; digitalWrite(select,LOW); digitalWrite(select,HIGH); return data; } bool SMDjoystick::read(int key){ bool val=false; switch(key){ case SMD_UP: val=!digitalRead(up); break; case SMD_DOWN: val=!digitalRead(down); break; case SMD_LEFT: digitalWrite(select,HIGH); val=!digitalRead(left); break; case SMD_RIGHT: digitalWrite(select,HIGH); val=!digitalRead(right); break; case SMD_START: digitalWrite(select,LOW); val=!digitalRead(start); break; case SMD_A: digitalWrite(select,LOW); val=!digitalRead(a); break; case SMD_B: digitalWrite(select,HIGH); val=!digitalRead(a); break; case SMD_C: digitalWrite(select,HIGH); val=!digitalRead(start); break; case SMD_X: digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); digitalWrite(select,HIGH); val=!digitalRead(left); digitalWrite(select,LOW); digitalWrite(select,HIGH); break; case SMD_Y: digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); digitalWrite(select,HIGH); val=!digitalRead(down); digitalWrite(select,LOW); digitalWrite(select,HIGH); break; case SMD_Z: digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); digitalWrite(select,HIGH); val=!digitalRead(up); digitalWrite(select,LOW); digitalWrite(select,HIGH); break; case SMD_MODE: digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); delayMicroseconds(1200); digitalWrite(select,HIGH); digitalWrite(select,LOW); digitalWrite(select,HIGH); val=!digitalRead(right); digitalWrite(select,LOW); digitalWrite(select,HIGH); break; } return val; }</span></span></code> </pre><br></div></div><br>  SMDjoystick.read (SMD_id) allows you to read the value of 1 button. <br>  SMDjoystick.read () returns a uint16_t with all button values ‚Äã‚Äãsuitable for <a href="http://www.imaginaryindustries.com/blog/%3Fp%3D80">JoyState</a> . <br><br><h4>  Example </h4><br>  We connect to Leonardo: <br><br><table><tbody><tr><th>  Gamepad pin </th><th>  Arduino pin </th></tr><tr><td>  one </td><td>  2 </td></tr><tr><td>  2 </td><td>  3 </td></tr><tr><td>  3 </td><td>  four </td></tr><tr><td>  four </td><td>  five </td></tr><tr><td>  five </td><td>  5v </td></tr><tr><td>  6 </td><td>  6 </td></tr><tr><td>  7 </td><td>  7 </td></tr><tr><td>  eight </td><td>  GND </td></tr><tr><td>  9 </td><td>  eight </td></tr></tbody></table><br><br><div class="spoiler">  <b class="spoiler_title">Keyboard Keyboard Emulation Example</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SMDjoystick.h&gt; SMDjoystick j(2,3,4,5,6,7,8); uint16_t data=0; void setup() { Keyboard.begin(); } uint16_t lastdata; char keys[]={ 'f', 'r', ' ', 0, KEY_LEFT_SHIFT , KEY_TAB , KEY_BACKSPACE, KEY_ESC, 0, KEY_RETURN, 0, 0, 'w', 's', 'a', 'd' }; void loop() { data=j.read(); for(int i=0;i&lt;SMD_MAX_KEYS;i++){ if(keys[i]==0) continue; bool c=(data&gt;&gt;i)&amp;1; if(c!=((lastdata&gt;&gt;i)&amp;1)){ if(c)Keyboard.press(keys[i]); else Keyboard.release(keys[i]); } } lastdata=data; delay(10); }</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">USB stick key emulation example</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SMDjoystick.h&gt; SMDjoystick j(2,3,4,5,6,7,8); JoyState_t s; uint16_t data; void setup() { s.xAxis=128; s.yAxis=128; s.zAxis=128; s.xRotAxis=128; s.yRotAxis=128; s.zRotAxis=128; s.throttle=128; s.rudder=128; s.hatSw1=0; s.hatSw2=0; } void loop() { data=j.read(); s.buttons=data; Joystick.setState(&amp;s); }</span></span></span></span></code> </pre><br></div></div><br>  Everything, now you can use the gamepad shogi like any USB gamepad. <br><br>  <a href="https://github.com/AsGreyWolf/SMDjoystick/">GitHub repository</a> <br><br>  Sources: <br>  <a href="http://www.hardwarebook.info/Mega_Drive_Joystick">www.hardwarebook.info/Mega_Drive_Joystick</a> <br>  <a href="http://applause.elfmimi.jp/md6bpad-e.html">applause.elfmimi.jp/md6bpad-e.html</a> <br><br>  UPD: <br>  Added an example of keyboard key emulation. <br>  Removed timer <br>  Added repository </div><p>Source: <a href="https://habr.com/ru/post/250507/">https://habr.com/ru/post/250507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250495/index.html">Security links for email newsletters</a></li>
<li><a href="../250497/index.html">[Moscow, 02.19.2015] Dmitry Lenev - Lock Managers in MySQL</a></li>
<li><a href="../250499/index.html">How SSD caching by means of a hypervisor in the VMware cloud works</a></li>
<li><a href="../250501/index.html">Application Insights - we collect telemetry of Windows Phone and Windows applications</a></li>
<li><a href="../250505/index.html">Convenient use of WPS in Mikrotik</a></li>
<li><a href="../250511/index.html">How to start developing iron using FPGAs - step by step instructions</a></li>
<li><a href="../250513/index.html">Node v0.12.0</a></li>
<li><a href="../250517/index.html">We develop analytics system</a></li>
<li><a href="../250519/index.html">Free training on Microsoft courses on Software Assurance vouchers at TC MUK (Kiev)</a></li>
<li><a href="../250523/index.html">Lock-free data structures. Concurrent maps: rehash, no rebuild</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>