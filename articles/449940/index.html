<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to squeeze 16 GB of memory onto a motherboard that does not support such a volume</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I put 16 GB of memory on one of my computers. It has a motherboard Foxconn P55MX with Core i5 750. It would be possible to replace this ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to squeeze 16 GB of memory onto a motherboard that does not support such a volume</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I put 16 GB of memory on one of my computers.  It has a motherboard <a href="http://www.foxconnchannel.com/ProductDetail.aspx%3FT%3Dmotherboard%26U%3Den-us0000474">Foxconn P55MX</a> with Core i5 750. It would be possible to replace this old CPU, but it still works fine and does everything that I need. <br><br>  That's what's interesting.  The motherboard does not officially support 16 GB of RAM.  The specifications on the above page indicate that a maximum of 8 GB is supported.  There are only two slots on the board, so I suspected that the 8 GB bars were just rare when the motherboard came out.  I decided to try anyway.  In many cases, motherboards support more RAM than the manufacturer officially claims. <br><a name="habracut"></a><br>  I made sure that the latest BIOS version (version 946F1P06) was installed and inserted two of my 8 GB slats.  Then I downloaded Ubuntu 16.04, and everything worked fine.  I decided that my theory that the board supports more memory than stated in the documentation turned out to be correct, and forgot about it.  I liked working with extra RAM and I was happy that the game paid off. <br><br>  But a few months later, I tried to load Windows 10. Basically, the computer runs on Linux.  Only sometimes you need to load Windows to check something.  That's when the fun began. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When GRUB appeared, I selected Windows 10 in the menu and pressed Enter.  The Windows boot screen appeared briefly, and then I was immediately greeted by the blue screen of death. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/51f/9cd/dd3/51f9cddd3a764d2900cc7c4d508a6895.jpg"><br><br>  Stop code: ACPI_BIOS_ERROR.  I googled a lot and found out that the essence of some kind of problem with ACPI-tables in the BIOS.  Among other things, ACPI tables tell the operating system how to configure hardware.  Attempting to boot from the Windows installation USB drive resulted in the same error.  So, I think, Foxconn did not lie.  This computer really does not support 16 GB of RAM.  Returning to 8 GB led to a successful download.  RAM tests also went great, so it's not a bad memory bar. <br><br>  I tried to contact Foxconn support for a BIOS fix, but I didn't get an answer.  The email address is listed on their website, but it does not work.  Perhaps Foxconn no longer deals with motherboards.  It seems that they also do not provide support. <br><br>  At this point, an ordinary person would simply give up, accepting 8 GB of memory or buying a new computer.  But I did not want to give up so easily.  I knew that theoretically a computer could use 16 GB, because it worked perfectly in Linux.  So I started learning ACPI and experimenting with BIOS settings. <br><br>  I found an interesting BIOS section where you can play with some memory settings.  One of the parameters was the ‚ÄúMemory Remap Feature‚Äù.  She was on.  The BIOS documentation states that the option allows "overlapping PCI memory" for mapping above total physical memory.  An Internet search indicated that it should be turned on when downloading to a 64-bit OS.  Just for the sake of experiment, I turned it off, and Windows really booted!  However, she said that she could use less than 4 GB of RAM.  But it was nice: I had a way to get into Windows without having to physically remove the memory bar. <br><br>  Ubuntu is the same.  With the memory remapping feature disabled, it limited me to less than 4 GB of RAM.  At the moment I was sure that there was some kind of memory mapping problem.  I decided to study the ACPI_BIOS_ERROR error and its causes in more detail - and came across <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/bug-check-0xa5--acpi-bios-error">this excellent</a> debugging <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/bug-check-0xa5--acpi-bios-error">document</a> for Microsoft drivers, which explains ACPI_BIOS_ERROR error checking. <br><br>  According to the document, it was necessary to find four error parameters that were previously displayed on a blue screen in older versions of Windows.  Windows 10 by default hides all information, but you can re-enable the display of additional error information by adding an entry to the registry.  Here is a <a href="https://superuser.com/a/1035736">great answer to superuser.com, which showed me the right direction</a> . <br><br>  After the corresponding editing of the registry, I again enabled the memory reassignment function in the BIOS and loaded Windows.  BSOD now showed four additional codes in the upper left corner: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca8/b84/1b4/ca8b841b41a29db074612e89530e8fc9.jpg"><br><br>  Perfectly!  Thus, parameter 1 is 0x0000000000000002.  The Microsoft documentation says that parameter 1, equal to 0x02, means a problem with processing the list of resources for root busses PCI.  Since parameters 2, 3, and 4 look like crazy values, these are probably pointers.  And if there are only pointers here, Microsoft says that the problem is that the PCI decoding area overlaps with the list of memory areas returned by the BIOS E820 interface. <br><br>  Okay.  There is a lot of information, but you can start a study from something.  I found information on how to call the E820 BIOS provides information on memory areas.  Then I returned to Linux and looked at all the information about kernel startup using the dmesg command, paying particular attention to the E820 and ACPI.  Here is what was found: <br><br><pre>  BIOS-e820: [mem 0x0000000000000000-0x000000000009ebff] usable
 BIOS-e820: [mem 0x000000000009ec00-0x000000000009ffff] reserved
 BIOS-e820: [mem 0x00000000000e0000-0x00000000000fffff] reserved
 BIOS-e820: [mem 0x0000000000100000-0x00000000cf77ffff] usable
 BIOS-e820: [mem 0x00000000cf780000-0x00000000cf78dfff] ACPI data
 BIOS-e820: [mem 0x00000000cf78e000-0x00000000cf7cffff] ACPI NVS
 BIOS-e820: [mem 0x00000000cf7d0000-0x00000000cf7dffff] reserved
 BIOS-e820: [mem 0x00000000cf7ed000-0x000000ccfffffff] reserved
 BIOS-e820: [mem 0x00000000fee00000-0x00000000fee00fff] reserved
 BIOS-e820: [mem 0x00000000ffb00000-0x00000000ffffffff] reserved
 BIOS-e820: [mem 0x0000000100000000-0x000000042fffffff] usable </pre><br>  Later I saw this: <br><br><pre>  acpi PNP0A08: 00: ignoring host bridge window [mem 0x400000000-0xfffffffff
 window] (conflicts with System RAM [mem 0x100000000-0x42fffffff])
 PCI host bridge to bus 0000: 00
 pci_bus 0000: 00: root bus resource [io 0x0000-0x0cf7 window]
 pci_bus 0000: 00: root bus resource [io 0x0d00-0xffff window]
 pci_bus 0000: 00: root bus resource [mem 0x000a0000-0x000bffff window]
 pci_bus 0000: 00: root bus resource [mem 0x000d0000-0x000dffff window]
 pci_bus 0000: 00: root bus resource [mem 0xd0000000-0xdfffffff window]
 pci_bus 0000: 00: root bus resource [mem 0xf0000000-0xfed8ffff window]
 pci_bus 0000: 00: root bus resource [bus 00-ff] </pre><br>  Yeah!  See the conflict warning?  I would not notice it, but after installing the memory Linux began to display this message with each boot.  I tried to boot into Linux with the BIOS memory remapping feature disabled.  In this case, the last e820 area disappeared from 0x100000000 to 0x42fffffffff, and thus the conflict message also disappeared, and another ‚Äúbus root resource‚Äù appeared in the list with the main bridge window from 0x400000000 to 0xfffffffff. <br><br>  So what happens?  Linux works with 16 GB because it notices a conflict and ignores the conflicting PCI range provided by ACPI, while Windows raises its hands in disgust and spits out the blue screen: ‚ÄúYour BIOS has a problem!‚Äù I can't blame Windows.  Indeed, there is an overlap, so it can be understood that it is confused. <br><br>  At that moment I was not sure whether to continue.  The last 768 MB of memory from 0x400000000 to 0x42fffffffff is mapped to the beginning of a huge area of ‚Äã‚Äãmemory space that the motherboard uses for PCI.  It is clear that if a motherboard expects a PCI there, something really bad can happen.  So the motherboard only supports 15.25 GB of RAM, right? <br><br>  But ... on Linux, everything works just fine, without the support of this additional PCI matching area!  What if you somehow change the ACPI tables so that a large PCI range starts with 0x430000000 instead of 0x400000000, that is, immediately after the end of the physical RAM.  Then the conflict would disappear, and most of the PCI matching window still remained available. <br><br>  Challenge accepted. <br><br>  I started digging through the ACPI tables.  Fortunately, Linux makes it very easy to make dumps.  There are special tools for this, but the tables can be easily found in sysfs: <br><br><pre>  / sys / firmware / acpi / tables </pre><br>  Here they are.  I was also pleased that GRUB has the ability to replace your ACPI tables with new versions.  Therefore, if you find out which table is involved, you can install a new version of this table using GRUB.  Theoretically, Windows would be happy with this. <br><br>  Among other tools, I used <a href="https://linux.die.net/man/1/iasl">iasl</a> to parse various ACPI tables and find the value 0x400000000 for replacement.  Most likely, this value is in byte order (little-endian) and 64 bits in size, so I ran <a href="https://github.com/ReFirmLabs/binwalk">binwalk</a> to search all table files: <br><br><pre>  binwalk -R '\ x00 \ x00 \ x00 \ x00 \ x04 \ x00 \ x00 \ x00' * </pre><br>  One result was found in the OEMB table.  The next 64-bit word after it was 0x1000000000, slightly more than the final address in the conflict message of the main bridge window.  Very promising clue.  The OEMB table is special because it is not a standard table according to the ACPI specifications.  Linux complains about an invalid checksum, but I don‚Äôt think it matters.  I guess you guess what I did next.‚Ä¶ <br><br>  I made a copy of the OEMB table, replacing byte 0x00 immediately before byte 0x04 with 0x30 to change the value to 0x430000000 (remember that this is the reverse of the order).  I put this modified copy in the /boot/oemb.dat file.  Then I used GRUB to replace the OEMB table with my copy, temporarily inserting the following command into the list of boot commands (entering the letter 'e' in GRUB after selecting Ubuntu): <br><br><pre>  acpi --exclude = OEMB /boot/oemb.dat </pre><br>  The idea is that it tells GRUB to load all the ACPI tables except for the OEMB table, then load the contents of /boot/oemb.dat and add it as an additional table.  This effectively replaces the old OEMB table with the new OEMB table. <br><br>  Well, I downloaded Linux and ... <br><br><pre>  acpi PNP0A08: 00: ignoring host bridge window [mem 0x400000000-0xfffffffff
 window] (conflicts with System RAM [mem 0x100000000-0x42fffffff]) </pre><br>
    . WTF?  ,   PCI   - ,     ,    .  ,    OEMB  ,    .<br>
<br>
      iasl    DSDT.  ,   DSDT      <code>_CRS</code>,      .<br>
<br>
<pre>iasl -d DSDT</pre><br>
  .dsl     _CRS,    PCI,     .  DSDT   ,     .     _CRS   .       ,   _CRS       ,   0xCF78E064.      Linux  dmesg   :<br>
<br>
<pre>ACPI: Early table checksum verification disabled
ACPI: RSDP 0x00000000000F9820 000014 (v00 ACPIAM)
ACPI: RSDT 0x00000000CF780000 000044 (v01 012110 RSDT0821 20100121 MSFT 00000097)
ACPI: FACP 0x00000000CF780200 000084 (v01 012110 FACP0821 20100121 MSFT 00000097)
ACPI: DSDT 0x00000000CF780460 006FE7 (v01 946F1  946F1P06 00000000 INTL 20051117)
ACPI: FACS 0x00000000CF78E000 000040
ACPI: APIC 0x00000000CF780390 00008C (v01 012110 APIC0821 20100121 MSFT 00000097)
ACPI: MCFG 0x00000000CF780420 00003C (v01 012110 OEMMCFG  20100121 MSFT 00000097)
ACPI: OEMB 0x00000000CF78E040 000082 (v01 012110 OEMB0821 20100121 MSFT 00000097)
ACPI: HPET 0x00000000CF78A460 000038 (v01 012110 OEMHPET  20100121 MSFT 00000097)
ACPI: GSCI 0x00000000CF78E0D0 002024 (v01 012110 GMCHSCI  20100121 MSFT 00000097)
ACPI: DMAR 0x00000000CF790100 000090 (v01 AMI    OEMDMAR  00000001 MSFT 00000097)
ACPI: SSDT 0x00000000CF7917C0 000363 (v01 DpgPmm CpuPm    00000012 INTL 20051117)</pre><br>
!      OEMB.       .        OEMB?<br>
<br>
     dmesg    OEMB.    ,   ,      ,  GRUB    ,  OEMB,    .   ,   DSDT      0xCF78E064   OEMB. -     ,  -    . .<br>
<br>
    DSDT,        OEMB,   ,      ,     GRUB     ,     OEMB.<br>
<br>
    .  GRUB    <code>write_byte</code>, <code>write_word</code>, <code>write_dword</code>  <code>read_</code>.   GRUB       OEMB?    BIOS' . ,    RAM,     .<br>
<br>
   .            GRUB:<br>
<br>
<pre>write_byte 0xCF78E0B5 0x30</pre><br>
<br>
   0x00    0x04   0x30,  64-   PCI     0x0000000430000000.       OEMB,   Linux   ,    , , ,   .<br>
<br>
   Linux      dmesg  PCI.<br>
<br>
<pre>PCI host bridge to bus 0000:00
pci_bus 0000:00: root bus resource [io  0x0000-0x0cf7 window]
pci_bus 0000:00: root bus resource [io  0x0d00-0xffff window]
pci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff window]
pci_bus 0000:00: root bus resource [mem 0x000d0000-0x000dffff window]
pci_bus 0000:00: root bus resource [mem 0xd0000000-0xdfffffff window]
pci_bus 0000:00: root bus resource [mem 0xf0000000-0xfed8ffff window]
pci_bus 0000:00: root bus resource [mem 0x430000000-0xfffffffff window]
pci_bus 0000:00: root bus resource [bus 00-ff]</pre><br>
!  0x430000000-0xfffffffffff       ,     .  ,  Linux    ,     Windows    .<br>
<br>
!      Windows  16  RAM,   GRUB       write_byte.  Windows 10, ,   .    -  Windows, ,      RAM,   .   !<br>
<br>
     GRUB,    /etc/grub.d/00_patchbios  :<br>
<br>
<pre># This file patches the BIOS in my Foxconn P55MX motherboard to work
# properly when I have 16 GB of RAM installed. It's a nasty hack.
# Basically, the BIOS is hardcoded in the OEMB ACPI table
# to have a PCI address range from 0x400000000 to 0xfffffffff, but
# that overlaps with 16 GB of RAM being installed, because the RAM
# uses up (among other ranges) 0x100000000 to 0x42fffffff.
# This patch changes the table to actually list a PCI range of:
# 0x430000000 to 0xfffffffff
echo "write_byte 0xCF78E0B5 0x30" </pre><br>
      <code>sudo update-grub</code>.       GRUB.<br>
<br>
  ,   .            PCI  - .  ,      RAM.  Linux    16  RAM,      . ,     PCI/PCIe  - ,   ,    , ,   . ,     ,          ,    ACPI   BIOS  .<br>
<br>
,    ,    ! ,  -    . ,       .</div><p>Source: <a href="https://habr.com/ru/post/449940/">https://habr.com/ru/post/449940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../449932/index.html">Search for tasks in JIRA (simple language). Part 2: Advanced Search</a></li>
<li><a href="../449934/index.html">3D printing with metals: 5 obvious advantages on a practical example</a></li>
<li><a href="../449936/index.html">Why is it difficult to work in a multinational team?</a></li>
<li><a href="../449938/index.html">Developers vs. Business</a></li>
<li><a href="../44994/index.html">Google has posted a free access to the photo magazine LIFE</a></li>
<li><a href="../449942/index.html">How we test the feature from TK to post-production and maintain friendly relations within the team</a></li>
<li><a href="../449944/index.html">Docker: bad advice</a></li>
<li><a href="../449946/index.html">Tales Developer 1C: Admin</a></li>
<li><a href="../449948/index.html">Javascript: 7 useful things</a></li>
<li><a href="../44995/index.html">History of one logo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>