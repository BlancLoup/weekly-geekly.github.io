<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Duke Nukem 3D Source Code Analysis: Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[The translation of the first part is here .] 

 Inherited code 
 Build is an outstanding engine, and the many games that used it brought great and de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Duke Nukem 3D Source Code Analysis: Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ab4/56b/848/ab456b84893971cb5b6702d755bea49f.jpg" alt="image"><br><br>  <i>[The translation of the first part is <a href="https://habrahabr.ru/post/323426/">here</a> .]</i> <br><br><h1>  Inherited code </h1><br>  <i>Build</i> is an outstanding engine, and the many games that used it brought great and deserved fame to both Ken Silverman and 3D Realms. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Ken Silverman fulfilled the terms of the contract: he provided a binary file of a stunning 3D engine with <a href="http://fabiensanglard.net/duke3d/BUILDINF.TXT">well-documented methods and resource formats</a> .  In recognition of his achievements, 3D Realms <a href="">indicated his name in the credits</a> as "Ken 'I can do that' Silverman" (Ken "I can do it" Silverman).  But <i>Build's</i> development was focused on features and speed, not the convenience of porting and reading.  After studying the code, I think that open source developers have avoided it for the following reasons: <br><br><ul><li>  It is discouragingly difficult to read and learn from it. </li><li>  It was not portable. </li></ul><br>  In this article, I have listed some of the difficulties encountered.  I also released the Chocolate Duke Nukem 3D port to solve these problems.  I wanted people to remember what level of genius was needed to create a 3D engine at the time.  In addition, I wanted them to realize how a teenager driven by passion could contribute to one of the greatest games of all time. <br><a name="habracut"></a><br><h2>  Difficulty in understanding </h2><br><ul><li>  The entire code base consists of only three modules, so it‚Äôs difficult in mind to break them down into sub-modules. </li><li> <code>typedef</code> and <code>struct</code> not used internally (used only for public data: <code>sectortype</code> , <code>walltype</code> and <code>spritetype</code> ).  Only arrays of primitive data types are used (for example: <a href="">GRP file system</a> ): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> numgroupfiles = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> gnumfiles[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> groupfil[MAXGROUPFILES] = {<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> groupfilpos[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *gfilelist[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> *gfileoffs[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> filegrp[MAXOPENFILES]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> filepos[MAXOPENFILES]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> filehan[MAXOPENFILES]</code> </pre> <br></li><li>  There are few comments.  Therefore, mathematical methods are difficult to understand (for example: <a href="">inside</a> ): <br><br><pre> <code class="cpp hljs">inside (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> y, <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> sectnum){ walltype *wal; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> i, x1, y1, x2, y2; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> cnt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((sectnum &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (sectnum &gt;= numsectors)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-number"><span class="hljs-number">-1</span></span>); cnt = <span class="hljs-number"><span class="hljs-number">0</span></span>; wal = &amp;wall[sector[sectnum].wallptr]; i = sector[sectnum].wallnum; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>{ y1 = wal-&gt;yy; y2 = wall[wal-&gt;point2].yy; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((y1^y2) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ x1 = wal-&gt;xx; x2 = wall[wal-&gt;point2].xx; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x1^x2) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) cnt ^= x1; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cnt ^= (x1*y2-x2*y1)^y2; } wal++; i--; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(cnt&gt;&gt;<span class="hljs-number"><span class="hljs-number">31</span></span>); }</code> </pre> <br></li><li>  The drawing procedures were written in a manually optimized x86 assembler.  Later they were ported back to C, but they are still <a href="">incredibly difficult to read</a> . </li><li>  Symbolic names are sometimes <a href="">contradictory</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> xb1[MAXWALLSB], yb1[MAXWALLSB], xb2[MAXWALLSB], yb2[MAXWALLSB]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> rx1[MAXWALLSB], ry1[MAXWALLSB], rx2[MAXWALLSB], ry2[MAXWALLSB]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> p2[MAXWALLSB], thesector[MAXWALLSB], thewall[MAXWALLSB];</code> </pre> <br></li><li>  In the code there are <a href="">mysterious</a> "magic" numbers (especially when manipulating the walls, floor and ceiling). </li><li>  The main translation modules (game.c and engine.c) are so large that they slow down the IDE.  Sometimes right up to xcode crash. </li></ul><br><h3>  Porting complexity </h3><br><ul><li>  It assumes the use of processor with direct byte order (Little-Endian). </li><li>  Use in the <code>long</code> type engine assumes that the data will always be 32 bits long. </li><li>  32-bit addresses are assumed and they are processed as integers. </li><li>  Manually optimized x86 assembler without C code counterpart </li><li>  120 cycles per frame are expected: this is how the DOS timer worked. </li><li>  No layer of abstraction.  Raw calls file system / renderer. </li></ul><br><h2>  Lost resources </h2><br>  Ken Silverman once contributed to the creation of the <a href="http://www.jonof.id.au/">JonoF</a> port and published many explanations for his algorithms.  Unfortunately, the <a href="http://www.jonof.id.au/forum/">forum is no longer working</a> because of spam.  It seems that all this valuable information is lost! <br><br><blockquote>  I regretfully closed the forum on the site.  Because of the spam bots, it became impossible to manage it, and although there is valuable content in the posts, my time and the moderator time are not worth it. <br><br>  If you want to keep in touch with the community, then I suggest to refer to the forums on Duke4.net. </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/41e/b1f/e07/41eb1fe07d58a77521e39fac0a00c806.png" alt="image"><br><br><h1>  Chocolate Duke Nukem 3D </h1><br>  <a href="https://github.com/fabiensanglard/chocolate_duke3D">Chocolate Duke Nukem 3D</a> is a Duke Nukem 3D port for <u>training</u> .  Its main goal is to streamline the code so that programmers can conveniently get knowledge from it and are better aware of what it was like to program game engines in the 90s. <br><br>  Like an archaeologist working with bones, it was important for me to keep everything ‚Äúas it is,‚Äù and to get rid of ‚Äúdust‚Äù only, focusing on: <br><br><ul><li>  Readability: make the code easy to understand. </li><li>  Portability: make the code easy to compile, run, and conduct experiments. </li></ul><br><h3>  Binary code </h3><br>  This is a port for game developers who want to learn about Duke Nukem 3D architecture and source code.  If you just want to play a game, I recommend using <a href="http://eduke32.com/">EDuke32</a> . <br><br>  If you still want to play Chocolate Duke Nukem 3D, then simply download the source code, which is a XCode / Visual Studio project, and build it: <a href="https://github.com/fabiensanglard/chocolate_duke3D">link to the source code</a> . <br><br><h2>  Portability </h2><br>  Lack of portability was a problem.  Now Chocolate Duke Nukem 3D is compiled under Windows, Intel MacOS X and Linux.  Here is how it was done: <br><br><ul><li>  <u>Using internal type aliases</u> now provides the correct size of integers.  The <code>long</code> type was used everywhere, because during development it was believed that this type would always be 32 bits long.  This is one of the reasons why the engine could not be compiled in 64-bit mode.  Used <code>int32_t</code> from standard <code>inttypes.h</code> . </li><li>  <u>Getting rid of <code>char</code></u> for arithmetic operations: since depending on the platform it can be <code>signed</code> or <code>unsigned</code> , using <code>char</code> for mathematical calculations led to an unpleasant shift;  <code>char</code> should only be used for strings.  For arithmetic operations in <i>Build</i> , <code>int8_t</code> or <code>uint8_t</code> from <code>inttypes.h</code> now explicitly used, which guarantees the presence of a sign. </li><li>  <u>Elimination of platform-specific API</u> .  When the accuracy of the SDL timer was average, the port had problems ensuring the required 120 cycles per frame.  Now the engine either uses SDL or provides a platform implementation for POSIX and Windows. </li></ul><br>  The code has become much more portable, but still not ready for 64 bits: you need to work more on the interface between the <i>engine</i> <i>module</i> and the <i>drawing module</i> , in which memory addresses are processed as 32-bit integers.  It is necessary to spend many hours for this part, and I am not sure that I can spend so much time. <br><br><h2>  Comprehensibility </h2><br>  Most of the effort went into simplifying the readability of the code.  Here is how I achieved this: <br><br><h2>  Reassign Modules </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/6c4/b4a/9cc/6c4b4a9cca94bc5e619d184cbc95f6f8.png"><br><br>  The "vanilla" source code essentially consisted of three broadcast modules: <br><br><ul><li>  <code>Engine.c</code> : approximately 95% of the code. </li><li>  <code>ac</code> : contains a rough C implementation of what was once an optimized assembler. </li><li>  <code>cache1d.c</code> : contains the caching system and the GRP file system. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/31e/6bb/ffb/31e6bbffb412acaf60ad33c060115510.png"><br><br>  The code was repartitioned into modules, giving a clear idea of ‚Äã‚Äãwhat is contained inside: <br><ul><li>  <code>Engine.c</code> : Now 50% of the code is in it. </li><li>  <code>display.c</code> : buffers of SDL surfaces in which the screen is rendered, palette utilities. </li><li>  <code>draw.c</code> : implementation of assembler procedures in C. </li><li>  <code>tiles.c</code> : sprite engine. </li><li>  <code>filesystem.c</code> : everything to create an abstraction of the GRP file system. </li><li>  <code>network.c</code> : multiplayer mode is not here. </li><li>  <code>cache.c</code> : random memory allocator and caching service. </li><li>  <code>math.c</code> : most fixed-point arithmetic functions here. </li></ul><br>  I was tempted to break <code>Engine.c</code> into a frontend and backend in imitation of the Quake3 / Doom3 architecture, which consists of two parts, exchanging data via the stack.  But as a result, I decided that I would be too distant from the spirit of the original engine, so I rejected this idea. <br><br><h2>  Data structure </h2><br>  For data exchange with the <i>game module</i> through <a href="">build.h,</a> the <i>Build</i> engine used a <code>struct</code> , but inside everything was organized through arrays of primitive data types, without a <code>struct</code> and <code>typedef</code> . <br><br>  I made changes, especially in the part related to the definition of visible surfaces (Visual Surface Determination) and the file system: <br><br>  <a href="">Before</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> numgroupfiles = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> gnumfiles[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> groupfil[MAXGROUPFILES] = {<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> groupfilpos[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *gfilelist[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> *gfileoffs[MAXGROUPFILES]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> filegrp[MAXOPENFILES]; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> filepos[MAXOPENFILES]; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> filehan[MAXOPENFILES];</code> </pre> <br>  <a href="">After</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    GRP: // - 12     // - 4     typedef uint8_t grpIndexEntry_t[16]; typedef struct grpArchive_s{ int32_t numFiles ;//   . grpIndexEntry_t *gfilelist ;//,   . int32_t *fileOffsets ;//,   . int32_t *filesizes ;//,   . int fileDescriptor ;//fd      . uint32_t crc32 ;//    GRP: Duke Shareware, Duke plutonimum  .... } grpArchive_t; //  GRP     typedef struct grpSet_s{ grpArchive_t archives[MAXGROUPFILES]; int32_t num; } grpSet_t;</span></span></code> </pre> <br><h2>  Improving symbolic names </h2><br>  I changed those variable names that were of little help in understanding their purpose: <br><br>  <a href="">Before</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> xb1[MAXWALLSB], yb1[MAXWALLSB], xb2[MAXWALLSB], yb2[MAXWALLSB]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> rx1[MAXWALLSB], ry1[MAXWALLSB], rx2[MAXWALLSB], ry2[MAXWALLSB]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> p2[MAXWALLSB], thesector[MAXWALLSB], thewall[MAXWALLSB];</code> </pre> <br>  <a href="">After</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> vector_index_e {VEC_X=<span class="hljs-number"><span class="hljs-number">0</span></span>,VEC_Y=<span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> screenSpaceCoo_index_e {VEC_COL=<span class="hljs-number"><span class="hljs-number">0</span></span>,VEC_DIST=<span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> <span class="hljs-keyword"><span class="hljs-keyword">vector_t</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> coo2D_t[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//  ,      . //       . typedef struct pvWall_s{ vector_t cameraSpaceCoo[2]; //      .    vector_index_e. int16_t sectorId; // ,    ,    . int16_t worldWallId; //     . coo2D_t screenSpaceCoo[2]; //      .    screenSpaceCoo_index_e. } pvWall_t; //       . pvWall_t pvWalls[MAXWALLSB];</span></span></code> </pre> <br><h2>  Comments and documentation </h2><br><ul><li>  <u>Documentation:</u> since the posts on the JoFo forum are lost, I hope that the <a href="https://habrahabr.ru/post/323426/">first part of the article on Build guts</a> will help developers understand the high-level architecture of the engine. </li><li>  <u>Comments:</u> I tried to put the most effort into this point.  I am absolutely sure of the advantage of the abundance of comments in the code ( <a href="http://fabiensanglard.net/doom3/dmap.php">Dmap</a> is a great example of source code, where there are more comments than code). </li></ul><br><h2>  "Magic" numbers </h2><br>  I did not have time to get rid of all the "magic" numbers.  Replacing decimal literals with <code>enum</code> or <code>#define</code> will significantly improve readability of the code. <br><br><h2>  Memory allocation </h2><br>  In <i>Chocolate Duke,</i> I tried to avoid global variables.  Especially if they are used during the lifetime of the frame.  In such cases, the memory used will be on the stack: <br><br>  <a href="">Before</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> globalzd, globalbufplc, globalyscale, globalorientation; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> globalx1, globaly1, globalx2, globaly2, globalx3, globaly3, globalzx; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> globalx, globaly, globalz; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> sectorborder[<span class="hljs-number"><span class="hljs-number">256</span></span>], sectorbordercnt; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> tablesloaded = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> pageoffset, ydim16, qsetmode = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>  <a href="">After</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* FCS:      ( -     nextsector &gt;= 0).   ,        . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scansector</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sectnum)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//,  ,   . short sectorsToVisit[256], numSectorsToVisit; . . . }</span></span></code> </pre> <br>  <u><b>Note:</b></u> Be careful when using the stack frame to store large variables.  The following code was normally executed when compiling into clang and gcc, but resulted in an error in Visual Studio: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> initgroupfile(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *filename) { <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> buf[<span class="hljs-number"><span class="hljs-number">16</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> i, j, k ; grpArchive_t* archive ; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> crcBuffer[ <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">20</span></span>] ; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Loading %s ...\n"</span></span>, filename) ; . . . }</code> </pre> <br>  A stack overflow error occurs because by default, Visual Studio reserves only 1 MB for the stack.  Attempting to use <code>chkstk</code> results in a stack overflow, which is not good at <code>chkstk</code> digesting.  This code will run normally in Clang on Mac OS X. <br><br><h2>  Source </h2><br>  Source code <a href="https://github.com/fabiensanglard/chocolate_duke3D">is available on Github</a> . </div><p>Source: <a href="https://habr.com/ru/post/323684/">https://habr.com/ru/post/323684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323672/index.html">Instagram redesign: experience analyzing and rethinking the interface</a></li>
<li><a href="../323674/index.html">Getting started in STM32CubeMX. Part 3</a></li>
<li><a href="../323676/index.html">GameDev from scratch: From the hackathon to your own game development studio. Part 2</a></li>
<li><a href="../323680/index.html">Thief: creating a narrative with level design and mechanics</a></li>
<li><a href="../323682/index.html">The problem of saving context in asynchronous programming in scala</a></li>
<li><a href="../323686/index.html">Great overview of the best designers of mobile applications in 2017</a></li>
<li><a href="../323688/index.html">LIFT: Learned Invariant Feature Transform</a></li>
<li><a href="../323692/index.html">Universal grammar analyzer of natural languages ‚Äã‚Äãfrom scratch. Release 1</a></li>
<li><a href="../323694/index.html">How Discord stores billions of messages</a></li>
<li><a href="../323696/index.html">Lectures Technopark. The course "Algorithms and data structures" (autumn 2016)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>