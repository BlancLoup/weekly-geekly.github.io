<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Return small graphics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Holivary about where to store pictures - in the database or in the file system - not a rare thing even for Habr. There is no unambiguous approach here...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Return small graphics</h1><div class="post__text post__text-html js-mediator-article">  Holivary about where to store pictures - in the database or in the file system - not a rare thing even for Habr.  There is no unambiguous approach here and there can be no, but if you look at the situation from the position of optimizing content delivery, then a reasonable compromise becomes a little more obvious, in my opinion. <a name="habracut"></a><br><br>  It is clear that there is no sense to store large images in the database.  There are many reasons for this, and all of them have been known to everyone for a long time; we have not yet considered FileStream.  However, the task often arises to give a large number of small things from one page ‚Äî for example, avatars on blogs or social networks, picture previews for news in tapes, etc., i.e.  relatively light graphics, but in commercial quantities.  The trouble is that the return of each such picture creates a separate connection to the server, as a result, loading one page generates several dozen requests for the return of any small file, the total amount of which on the page can not exceed hundreds of kilobytes.  For current channels, this is nothing, but a bunch of requests to the server when rendering the page is bad. <br><br>  Quite interesting is the decision, in which all this trifle pot-bellied will be given in one stream.  Thus, we reduce the number of server requests by an order of magnitude, which means we increase the site‚Äôs resistance to DDoS attacks.  As a nice bonus - the prospect of usability to be pumped: all the pictures will appear on the page immediately (without the effect of ‚Äúloading‚Äù), at the same time and without the ‚Äúholes‚Äù.  A small pause before their appearance does not count, subjectively, such a load looks ‚Äúfaster‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It looks like this: in the text of the HTML file placeholders are placed with IDs corresponding to the maps in the database.  Javascript ‚Äúruns through‚Äù placeholders and forms an XMLHTTP query string, in response to which the server returns an array of base64-encoded strings, which, again, javascript distributes src corresponding placeholders. <br><br>  As a result, instead of receiving a couple of dozens of individual images weighing 2-5kB each, we get a JSON line with a volume of 50-100kB for one asynchronous request.  That is, a) already AFTER the main text content is loaded and rendered, and b) much faster due to the features of text data streaming. <br><br>  <a href="http://demo.gregory.pp.ru/image/index.html">Working example</a> (avatars nadergany from the network). <br><br>  The code can be viewed in the source page.  The PHP servlet (works with SQLite) looks like this: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> ob_start(); $dbh = sqlite_open(<span class="hljs-string"><span class="hljs-string">'data/img'</span></span>, <span class="hljs-number"><span class="hljs-number">0666</span></span>, $sqliteerror); $sth = sqlite_query($dbh, <span class="hljs-string"><span class="hljs-string">"SELECT *, ROWID AS id FROM img WHERE ROWID IN ("</span></span>.trim($_GET[<span class="hljs-string"><span class="hljs-string">'q'</span></span>]).<span class="hljs-string"><span class="hljs-string">") LIMIT 20"</span></span>); $res = sqlite_fetch_all($sth, SQLITE_ASSOC); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($res); sqlite_close($dbh); ob_end_flush(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><br>  What do you say, quite a stupid idea?  Or did I invent the bicycle? </div><p>Source: <a href="https://habr.com/ru/post/157661/">https://habr.com/ru/post/157661/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157647/index.html">Create a module "New Mail" for Magento (Part 1)</a></li>
<li><a href="../157649/index.html">InterSystems recruits interns</a></li>
<li><a href="../157651/index.html">Google increases the energy efficiency of the Chrome browser in a number of scenarios up to 25%</a></li>
<li><a href="../157655/index.html">Handspring Visor Edge or Short adaptation course for time travelers</a></li>
<li><a href="../157657/index.html">ShuttlePRO v2 controller from Contour Design: Overview, appointment and first impressions of use</a></li>
<li><a href="../157663/index.html">Apple may refuse Intel processors</a></li>
<li><a href="../157665/index.html">Lumia 920 and Lumia 820 in Moscow</a></li>
<li><a href="../157671/index.html">Is there a simple assessment of the quality of optimization of the application?</a></li>
<li><a href="../157673/index.html">Lo-dash</a></li>
<li><a href="../157675/index.html">One day of the Internet: statistics, figures, facts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>