<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing Magic 8-Ball for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Based on the post Sharik, answering questions 

 In this article, we will write a localized Magic 8-Ball for Android, which you can ask a question, sh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing Magic 8-Ball for Android</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/5d/3e/5d3e826ce3a674cd87776cf4da84b7f9.png"><img src="https://habrastorage.org/storage/habraeffect/9b/c7/9bc7b667c8592e8639468ef1770524cc.png"><br><br>  Based on the post <a href="http://habrahabr.ru/blogs/i_am_advertising/102381/">Sharik, answering questions</a> <br><br>  In this article, we will write a localized Magic 8-Ball for Android, which you can ask a question, shake and get an answer.  A slight vibration will alert us that shaking is enough. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The article is intended for those who have already written Hellowworld for Android and are going to go further in this direction.  The full version of the source code lies on <a href="http://code.google.com/p/magic-8-ball/">google code</a> .  You can also try the magic-8-ball 1.1.apk file in the <a href="http://code.google.com/p/magic-8-ball/downloads/list">download</a> tab. <br><br>  For successful work, we will need the installed jdk, android sdk, eclipse and ADT plugin.  How to do this is available written <a href="http://habrahabr.ru/blogs/android/98704/">here</a> . <br><a name="habracut"></a><br><h4>  Localization </h4><br>  The geography of Android devices is extensive, so the issue of localization occupies a key place in developing applications for this platform.  Fortunately, we do not have to reinvent the wheel, Google has taken care of the programmers in this matter. <br><br>  So, the concept of application localization is as follows: we create several sets of resources, the first is the default <font color="#008000">res / values ‚Äã‚Äã/ strings.xml</font> , the rest are for the locale <font color="#008000">res / values- &lt;qualifiers&gt; /strings.xml</font> , for example, values-en for English or values-ja for Japanese.  When Android starts, it selects which resources to download based on the locale of the device itself.  By the way, resources in Android are not only text strings, but also layouts, sound files, graphics, and other static data. <br><br>  For our application, we will create <font color="#008000">res / values ‚Äã‚Äã/</font> , <font color="#008000">res / values-en</font> and <font color="#008000">res / values-ru</font> folders, in which will be strings.xml files.  These files contain the application name, headers, and magic ball responses, which are stored in the responses array.  It looks like this: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="utf-8"</font> ? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">resources</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="app_name"</font> <font color="#0000ff">&gt;</font> Magic 8-Ball <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="shake_me_caption"</font> <font color="#0000ff">&gt;</font> Shake Me <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="press_menu_shake_caption"</font> <font color="#0000ff">&gt;</font> Press Menu\n- Shake <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="menu_shake_caption"</font> <font color="#0000ff">&gt;</font> Shake <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="menu_preferences_caption"</font> <font color="#0000ff">&gt;</font> Preferences <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="preferences_section_title"</font> <font color="#0000ff">&gt;</font> Magic 8-ball Preferences <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="shake_count_id"</font> <font color="#0000ff">&gt;</font> shakeCount <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">string</font> <font color="#ff0000">name</font> <font color="#0000ff">="shake_count_title"</font> <font color="#0000ff">&gt;</font> Shake count <font color="#0000ff">&lt;/</font> <font color="#800000">string</font> <font color="#0000ff">&gt;</font> <br> ... <br> <font color="#0000ff">&lt;</font> <font color="#800000">string-array</font> <font color="#ff0000">name</font> <font color="#0000ff">="responses"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> As I see\nit, yes <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> It is\ncertain <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> It is\ndecidedly\nso <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> Most\nlikely <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> Outlook\ngood <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> Signs point\nto yes <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> Without\na doubt <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> Yes <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> Yes -\ndefinitely <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> ... <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> Very\ndoubtful <font color="#0000ff">&lt;/</font> <font color="#800000">item</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">string-array</font> <font color="#0000ff">&gt;</font> <br> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">resources</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Another nuance, android developer's guide warns us about the need to have an exact copy of some localization as a default resource, most often - English.  And he gives an example that if the string in the <font color="#008000">res / values ‚Äã‚Äã/ strings.xml file</font> , which is in <font color="#008000">res / values-en / strings.xml</font> and used in the application, is not <font color="#008000">enough</font> , everything can be compiled without problems, but in locale other than English the user will see the error message and the Force Close button. <br><br><h4>  Layout, animation and vibration </h4><br>  It's just that the background image has an inverted image of the cosmos.  On it lies an ImageView with a ball, and our message will be shown using TextView.  Main.xml code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="utf-8"</font> ? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">FrameLayout</font> <font color="#ff0000">xmlns:android</font> <font color="#0000ff">="http://schemas.android.com/apk/res/android"</font> <br> <font color="#ff0000">android:layout_width</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:layout_height</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:background</font> <font color="#0000ff">="@drawable/bg"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">ImageView</font> <font color="#ff0000">android:layout_width</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:layout_height</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:src</font> <font color="#0000ff">="@drawable/eight_ball"</font> <br> <font color="#ff0000">android:layout_gravity</font> <font color="#0000ff">="center_vertical"</font> <br> <font color="#ff0000">android:layout_margin</font> <font color="#0000ff">="10px"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">LinearLayout</font> <font color="#ff0000">xmlns:android</font> <font color="#0000ff">="http://schemas.android.com/apk/res/android"</font> <br> <font color="#ff0000">android:orientation</font> <font color="#0000ff">="vertical"</font> <br> <font color="#ff0000">android:layout_width</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:layout_height</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:gravity</font> <font color="#0000ff">="center"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">TextView</font> <font color="#ff0000">android:id</font> <font color="#0000ff">="@+id/MessageTextView"</font> <br> <font color="#ff0000">android:layout_width</font> <font color="#0000ff">="wrap_content"</font> <br> <font color="#ff0000">android:layout_height</font> <font color="#0000ff">="wrap_content"</font> <br> <font color="#ff0000">android:layout_gravity</font> <font color="#0000ff">="center"</font> <br> <font color="#ff0000">android:background</font> <font color="#0000ff">="@drawable/triangle"</font> <br> <font color="#ff0000">android:text</font> <font color="#0000ff">="@string/shake_me_caption"</font> <br> <font color="#ff0000">android:focusable</font> <font color="#0000ff">="false"</font> <br> <font color="#ff0000">android:gravity</font> <font color="#0000ff">="center_vertical|center"</font> <font color="#ff0000">android:layout_marginTop</font> <font color="#0000ff">="14dip"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">TextView</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">LinearLayout</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">FrameLayout</font> <font color="#0000ff">&gt;</font></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  For the answer that appears, we will use AlphaAnimation.  This class is most appropriate for our task, allowing objects to appear and disappear using the alpha level of the object. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> showMessage( <font color="#2B91AF">String</font> message) { <br> TextView triangle = (TextView) findViewById(R.id.MessageTextView); <br> triangle.setVisibility(TextView.INVISIBLE); <br> triangle.setText(message); <br> <br> AlphaAnimation animation = <font color="#0000ff">new</font> AlphaAnimation(0, 1); <br> animation.setStartOffset(Defaults.START_OFFSET); <br> triangle.setVisibility(TextView.VISIBLE); <br> animation.setDuration(Defaults.FADE_DURATION); <br> triangle.startAnimation(animation); <br> <br> vibrator.vibrate(Integer.parseInt(preferences.getString( <br> getString(R. <font color="#0000ff">string</font> .vibrate_time_id), Defaults.VIBRATE_TIME))); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Before answering, Magic 8-Ball will vibrate for the time of VIBRATE_TIME taken from the settings (see below).  By default, this value is 250ms.  Vibration of short duration (50ms) can be used in applications as a response to user actions.  To work correctly with the Vibrator class, you need to remember to declare use-permission in the AndroidManifest.xml file: <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">uses-permission</font> <font color="#ff0000">android:name</font> <font color="#0000ff">="android.permission.VIBRATE"</font> <font color="#0000ff">/&gt;</font></font></code> <br><br><h4>  Menu </h4><br>  To begin with, we implement the ability to get an answer using the menu.  Create a menu.xml file in the <font color="#008000">res / menu /</font> folder that contains the Shake and Preference buttons. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="utf-8"</font> ? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">menu</font> <font color="#ff0000">xmlns:android</font> <font color="#0000ff">="http://schemas.android.com/apk/res/android"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#ff0000">android:id</font> <font color="#0000ff">="@+id/shake"</font> <br> <font color="#ff0000">android:title</font> <font color="#0000ff">="@string/menu_shake_caption"</font> <br> <font color="#ff0000">android:icon</font> <font color="#0000ff">="@android:drawable/ic_menu_always_landscape_portrait"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">item</font> <font color="#ff0000">android:id</font> <font color="#0000ff">="@+id/preferences"</font> <br> <font color="#ff0000">android:title</font> <font color="#0000ff">="@string/menu_preferences_caption"</font> <br> <font color="#ff0000">android:icon</font> <font color="#0000ff">="@android:drawable/ic_menu_preferences"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">menu</font> <font color="#0000ff">&gt;</font></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In the Magic8Ball class, we will write two such methods: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@Override <br> <font color="#0000ff">public</font> boolean onCreateOptionsMenu(Menu menu) { <br> MenuInflater menuInflater = getMenuInflater(); <br> menuInflater.inflate(R.menu.menu, menu); <br> <font color="#0000ff">return</font> super.onCreateOptionsMenu(menu); <br> } <br> <br> @Override <br> <font color="#0000ff">public</font> boolean onOptionsItemSelected(MenuItem item) { <br> <font color="#0000ff">switch</font> (item.getItemId()) { <br> <font color="#0000ff">case</font> R.id.shake: <br> showMessage(getAnswer()); <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> <font color="#0000ff">case</font> R.id.preferences: <br> startActivity( <font color="#0000ff">new</font> Intent( <font color="#0000ff">this</font> , Preferences. <font color="#0000ff">class</font> )); <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The MenuInflater class is used to create Menu objects from an xml file.  We get to the onOptionsItemSelected method at the moment when the menu item is selected, which is what the name of the method tells us.  When you click on the Shake button, we will get an answer.  About the Preferences button will tell the chapter Settings. <br><br><h4>  Working with sensor </h4><br>  To interact with the sensor, we need to implement the SensorEventListener interface.  He declared two methods: <br><ul><li>  onAccuracyChanged, called when the accuracy of the sensor has changed, we do not need it </li><li>  OnSensorChanged, called when the sensor values ‚Äã‚Äãchange, we even need this very much. </li></ul><br>  Another important point is that in order to work with the sensor, we need to find it and register with SensorManager. <br><blockquote> <code><font color="black">sensorManager = (SensorManager)getSystemService(Context.SENSOR_SERVICE); <br> sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);</font> <br></code> </blockquote><br>  Note that we receive a sensor with the attribute Sensor.TYPE_ACCELEROMETER, which means that the data coming into the onSensorChanged method will be in units of acceleration (m / s ^ 2).  The values ‚Äã‚Äãalong the three axes X, Y and Z will correspond to the values ‚Äã‚Äãof event.values ‚Äã‚Äã[0], event.values ‚Äã‚Äã[1], event.values ‚Äã‚Äã[2] of class SensorEvent. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">void</font> onSensorChanged(SensorEvent <font color="#0000ff">event</font> ) { <br> <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .sensor.getType() == Sensor.TYPE_ACCELEROMETER) <br> <font color="#0000ff">if</font> (isShakeEnough( <font color="#0000ff">event</font> .values[0], <font color="#0000ff">event</font> .values[1], <font color="#0000ff">event</font> .values[2])) <br> showMessage(getAnswer()); <br> } <br> <br> <font color="#0000ff">private</font> boolean isShakeEnough( <font color="#0000ff">float</font> x, <font color="#0000ff">float</font> y, <font color="#0000ff">float</font> z) { <br> <font color="#0000ff">double</font> force = 0.0d; <br> force += <font color="#2B91AF">Math</font> .pow((x - lastX) / SensorManager.GRAVITY_EARTH, 2.0); <br> force += <font color="#2B91AF">Math</font> .pow((y - lastY) / SensorManager.GRAVITY_EARTH, 2.0); <br> force += <font color="#2B91AF">Math</font> .pow((z - lastZ) / SensorManager.GRAVITY_EARTH, 2.0); <br> force = <font color="#2B91AF">Math</font> .sqrt(force); <br> <br> lastX = x; <br> lastY = y; <br> lastZ = z; <br> <br> <font color="#0000ff">if</font> (force &gt; Float.parseFloat(preferences.getString( <br> getString(R. <font color="#0000ff">string</font> .threshold_id), Defaults.THRESHOLD))) { <br> shakeCount++; <br> <font color="#0000ff">if</font> (shakeCount &gt; Integer.parseInt(preferences.getString( <br> getString(R. <font color="#0000ff">string</font> .shake_count_id), Defaults.SHAKE_COUNT))) { <br> shakeCount = 0; <br> lastX = 0; <br> lastY = 0; <br> lastZ = 0; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The lifetime of our Activitiy is controlled by Android, and we do not need our application to vibrate from random shakes in our pocket, so we stop working with the sensor as soon as the application becomes inactive.  Also, if the sensor is not found, then we do not offer to shake the device. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@Override <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onResume() { <br> super.onResume(); <br> registerSensorListener(); <br> <font color="#0000ff">if</font> (isSensorRegistered()) <br> showMessage(getString(R. <font color="#0000ff">string</font> .shake_me_caption)); <br> <font color="#0000ff">else</font> <br> showMessage(getString(R. <font color="#0000ff">string</font> .menu_shake_caption)); <br> } <br> <br> @Override <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onPause() { <br> unregisterSensorListener(); <br> super.onPause(); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  Settings </h4><br>  Finally, we got to the settings.  Testing on various phones has shown the need to set the shake force threshold.  Between HTC Wildfire, Motorola Milestone and, for example, Highscreen Zeus, this value differed three times.  This challenges us: <br><ol><li>  You need a settings window where the user can manually set the threshold value and other parameters. </li><li>  These settings should be stored somewhere and read from somewhere. </li></ol><br>  Here, two ready-made PreferenceActivity classes for displaying settings and SharedPreferences for storing them come to our aid.  Now in more detail. <br><br>  PreferenceActivity is a class that visually shows us a hierarchy of preference objects.  It loads content from the xml file using the addPreferencesFromResource method.  It automatically interacts with the object of the SharedPreferences class and saves the settings to the specified key.  Create an xml file of our settings and inflate our PreferenceActivity. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="utf-8"</font> ? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">PreferenceScreen</font> <font color="#ff0000">xmlns:android</font> <font color="#0000ff">="http://schemas.android.com/apk/res/android"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">PreferenceCategory</font> <font color="#ff0000">android:title</font> <font color="#0000ff">="@string/preferences_section_title"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">EditTextPreference</font> <br> <font color="#ff0000">android:key</font> <font color="#0000ff">="@string/shake_count_id"</font> <br> <font color="#ff0000">android:defaultValue</font> <font color="#0000ff">="4"</font> <br> <font color="#ff0000">android:title</font> <font color="#0000ff">="@string/shake_count_title"</font> <br> <font color="#ff0000">android:summary</font> <font color="#0000ff">="@string/shake_count_summary"</font> <br> <font color="#ff0000">android:dialogTitle</font> <font color="#0000ff">="@string/shake_count_dialogTitle"</font> <br> <font color="#ff0000">android:inputType</font> <font color="#0000ff">="number"</font> <br> <font color="#ff0000">android:numeric</font> <font color="#0000ff">="integer"</font> <br> <font color="#ff0000">android:maxLength</font> <font color="#0000ff">="1"</font> <br> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">EditTextPreference</font> <br> <font color="#ff0000">android:key</font> <font color="#0000ff">="@string/threshold_id"</font> <br> <font color="#ff0000">android:defaultValue</font> <font color="#0000ff">="2.75f"</font> <br> <font color="#ff0000">android:title</font> <font color="#0000ff">="@string/threshold_title"</font> <br> <font color="#ff0000">android:summary</font> <font color="#0000ff">="@string/threshold_summary"</font> <br> <font color="#ff0000">android:dialogTitle</font> <font color="#0000ff">="@string/threshold_dialogTitle"</font> <br> <font color="#ff0000">android:inputType</font> <font color="#0000ff">="numberDecimal"</font> <br> <font color="#ff0000">android:numeric</font> <font color="#0000ff">="decimal"</font> <br> <font color="#ff0000">android:maxLength</font> <font color="#0000ff">="4"</font> <br> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">EditTextPreference</font> <br> <font color="#ff0000">android:key</font> <font color="#0000ff">="@string/vibrate_time_id"</font> <br> <font color="#ff0000">android:defaultValue</font> <font color="#0000ff">="250"</font> <br> <font color="#ff0000">android:title</font> <font color="#0000ff">="@string/vibrate_time_title"</font> <br> <font color="#ff0000">android:summary</font> <font color="#0000ff">="@string/vibrate_time_summary"</font> <br> <font color="#ff0000">android:dialogTitle</font> <font color="#0000ff">="@string/vibrate_time_dialogTitle"</font> <br> <font color="#ff0000">android:inputType</font> <font color="#0000ff">="number"</font> <br> <font color="#ff0000">android:numeric</font> <font color="#0000ff">="integer"</font> <br> <font color="#ff0000">android:maxLength</font> <font color="#0000ff">="3"</font> <br> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">PreferenceCategory</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">PreferenceScreen</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The root element of the preference xml file should always be PreferenceScreen.  Nested elements can also be different subclasses of Preference (including also PreferenceScreen).  In our file, all nested elements are EditTextPreference.  This class is useful for showing the user a dialog box in which TextEdit he can enter a value.  Now more about some of the EditTextPreference attributes: <br><ul><li>  android: key = "@ string / shake_count_id" - the key by which we refer to SharedPreferences to read or write the value </li><li>  android: title = "@ string / shake_count_title" - title (inscription in large letters in PreferenceActivity) </li><li>  android: summary = "@ string / shake_count_summary" - a brief description of the option </li><li>  android: dialogTitle = "@ string / shake_count_dialogTitle" - popup dialog header </li><li>  android: numeric = "integer" - indicate that the input method must be numeric </li></ul><br>  Create a new activity with settings (see Preferences.java) and do not forget to specify it in AndroidManifest: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">activity</font> <font color="#ff0000">android:name</font> <font color="#0000ff">=".activities.Preferences"</font> <br> <font color="#ff0000">android:label</font> <font color="#0000ff">="@string/app_name"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">activity</font> <font color="#0000ff">&gt;</font></font></code> </blockquote> <br><img src="https://habrastorage.org/storage/habraeffect/3e/d1/3ed1eb8e5515fefc3d7c038cc239381a.png"><img src="https://habrastorage.org/storage/habraeffect/76/8b/768bd52fdecafa9ffd81b474c8ef4156.png"><br><br>  Now, the user can change the values ‚Äã‚Äãof some settings, it remains for us to begin to read them correctly.  To get an instance of SharedPreferences, we will call the PreferenceManager.getDefaultSharedPreferences (this) method.  We have the keys for which we store the data, how do we read them? .. For example, the vibration time is: vibrator.vibrate (Integer.parseInt (preferences.getString (getString (R.string.vibrate_time_id), Defaults.VIBRATE_TIME))) ); <br><br>  Unfortunately, preferences.getInt (...) stubbornly throws a ClassCastException.  This seems to be due to the fact that the preferences are stored as strings.  The remaining values ‚Äã‚Äãare read on the same principle.  By changing the value of the threshold, we can make sure that a different force is needed to shake the ball in response. <br><br>  <b>PS</b> <br>  What else can be added to the application?  It can be made more user friendly.  For example, add a track bar instead of a window with values ‚Äã‚Äãto change the threshold of sensitivity, and when you first start, ask to shake to automatically calibrate the ball.  You can also create an answer editor in the application so that the user can add them according to their locale. <br></div><p>Source: <a href="https://habr.com/ru/post/108948/">https://habr.com/ru/post/108948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../108932/index.html">Microsoft continues to support Creative Commons!</a></li>
<li><a href="../108934/index.html">Not another social network or how we decided to create our own social network (Part 2 - organizing the information space on news portals)</a></li>
<li><a href="../108936/index.html">Unusual laptop with two touch screens: Acer Iconia</a></li>
<li><a href="../108938/index.html">A group of enthusiasts has developed a technology for surfing the web using Kinect</a></li>
<li><a href="../108947/index.html">Injection MSIL code into a third-party assembly using Mono.Cecil. Implementing AOP principles in NET</a></li>
<li><a href="../108950/index.html">Migrating physical Linux servers to Microsoft Hyper-V hypervisor virtual environment</a></li>
<li><a href="../108951/index.html">We draw a fluorescent acrylic on a solid surface</a></li>
<li><a href="../108955/index.html">How to trick NET.Reflector</a></li>
<li><a href="../108957/index.html">Modified firmware ports from Nokia C6 to 5530/5800</a></li>
<li><a href="../108958/index.html">Accelerating the distribution of pictures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>