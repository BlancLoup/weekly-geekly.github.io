<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vertica + Anchor Modeling = start growing your mycelium</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I wrote an article on Habr√© . It also promised to continue in a couple of weeks. But, as you know, they have been waiting for the promis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vertica + Anchor Modeling = start growing your mycelium</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I wrote <a href="https://habrahabr.ru/post/227111">an article on Habr√©</a> .  It also promised to continue in a couple of weeks.  But, as you know, they have been waiting for the promised three years - and indeed, three years have passed since then.  If you do not remember from the time of that article, then I remind you - I work in Avito, I build a repository based on Vertica. <br>  From what has changed - now I can not just write an article, but do it in a company blog.  And, I hope, not once.  Self-PR is over, now to the point. <br><br> <a href="https://habrahabr.ru/company/avito/blog/322510/"><img src="https://habrastorage.org/getpro/habr/post_images/f85/431/1e7/f854311e73a3feb120c933381b112bde.png"></a> <br><a name="habracut"></a><br>  My repository is based on the <a href="http://www.anchormodeling.com/">Anchor Modeling</a> methodology.  In 2013, this choice of methodology was, in many ways, a leap of faith.  Now, after almost 4 years, we can say that the jump was a success.  The first article gave quite a lot of arguments for Anchor Modeling.  Now these arguments remained true, but faded into the background. <br><br>  Today, the main argument for using Anchor Modeling + Vertica is one: almost unlimited growth is possible.  Growth in volume, rate of receipt and in diversity - all that is called 3V (Volume, Velocity, Variety), and that characterizes big data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Imagine that your vault is a little mycelium.  It starts with one dispute, and then begins to grow, covering meter by meter, twining the trees until a multi-ton monster turns out ... whose growth does not stop ... does not stop at all. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f0/ca3/50b/1f0ca350b418733c20d9a3410abe27a5.png"><br><br>  Imagine yourself in the place of the repository architect.  It is good when you can estimate at the start the approximate data volumes, integrable systems, data analysis algorithms.  Then you can choose the data model and processing platform for your situation.  And not the fact that in this case, the choice of Vertica + Anchor Modeling will be optimal. <br><br><h2>  Essence One - Anchor </h2><br><br><img src="https://habrastorage.org/getpro/habr/post_images/098/f5c/f33/098f5cf33c9cc45f54c490e892432b6a.png"><br><br>  Anchor is a noun, a real-world object.  Item, user, payment.  Accordingly, each noun has its own table.  Anchor table should store ONLY a surrogate key (in Vertica, the best key is an <a href="https://my.vertica.com/docs/7.2.x/HTML/index.htm">int</a> ) and several technical fields.  Conceptually, Anchor is only needed for one task - to load each unique product / user / payment only once.  Avoid reloading, and remember at what point and from which system the original entry came.  Everything. <br>  To understand how the task of identifying the product / user / payment is solved, go to the second entity. <br><br><h2>  Essence Two - Attribute </h2><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a08/e29/704/a08e297047690e8b737f474781a82b13.png"><br><br>  Attribute is a table for storing a property, an attribute of an object.  Names of goods, username and date of birth of the user, the amount of payment.  One property of the object is one Attribute table.  The ten properties of the object (name, surname, date of birth, gender, registration address, ...) - ten Attribute tables.  It's simple.  It is difficult for the psyche, because the number of tables at the beginning is very scary, but simple. <br>  Each Attribute-table contains a surrogate key of the object, which is a link to the corresponding Anchor, a field for the attribute value, and, optionally, a date for historicity and technical fields.  Accordingly, the Attribute-table for the name (Name) of the buyer (Customer) should be called S_Customer_Name and contain the fields Customer_id (surrogate key), Name (attribute value) and Actual_date (date for SC2 historicity).  As you can see, the name of the table and the names of all its fields are uniquely determined by its contents (the name of the buyer). <br><br>  What nuance adds Vertica? ... Everything is simple, all Attribute tables for one Anchor must be <a href="https://my.vertica.com/docs/7.2.x/HTML/index.htm">identically segmented</a> : segmented by the surrogate key hash, sorted by the surrogate key and by the date of historicity.  A simple rule, following which, you will receive a guarantee that all the join between Attribute-tables of one Anchor will be <a href="https://my.vertica.com/docs/7.2.x/HTML/index.htm">MERGE JOIN</a> - the most efficient join in Vertica.  Similarly, the specified segmentation ensures the optimality of the window functions necessary for maintaining ETL operations with SC2 historicity on a single date. <br><br>  In the previous section, a description of the approach to identifying objects was announced: a string of data about the user arrives - how to understand, is this user already in Anchor, or is he new?  Naturally, the answer to this question is sought in the attributes.  The main advantage of Anchor Modeling is the ability to use some attributes first (full name), and then start using other attributes (full name + TIN).  And taking into account the historicity. <br><br><h2>  Essence Three - Tie </h2><br><br><img src="https://habrastorage.org/files/d9d/034/a09/d9d034a0968942a2893e3c154f1913ce.png"><br><br>  Tie is a table for storing links between objects.  For example, a table for storing the fact that the buyer has citizenship in a particular country.  Accordingly, the table should contain the surrogate key of the left object (customer_id), the right object (country_id) and, if necessary, the date of historicity and technical fields. <br><br>  From the point of view of Vertica, the following nuance is added - the Tie table should be created with two projections - segmented along the left surrogate and segmented along the right surrogate.  So that at least one of the JOINs of this table was a MERGE JOIN. <br><br>  An important nuance from the point of view of simulations - Anchor Modeling is very different from Data Vault in that in Data Vault you can hang data (satellites) on a link (link), and in Anchor Modeling data (Attribute) can be hung only on Anchor, on Tie it is impossible ( important - DO NOT).  This seemingly redundant constraint allows you to more accurately model the real physical world.  For example, the traditional connection with properties in the Data Vault is the fact that a product is sold to a customer whose property is the amount of the sale.  Anchor Modeling makes you think a little and understand that the fact of selling a product to a customer is not an element of the real world, but an abstraction.  An element of the real world is a check (piece of paper) with a number, date, etc.  Accordingly, in Anchor the described example is described by three Anchor - Buyer, Check, Item, and two Tie: Buyer-Check and Check-Item. <br>  <i>(An attentive reader will notice that even the example picture at the beginning of the section is not entirely correct. The fact of citizenship is recorded by a certain document (passport), and it is more accurate to present the specified data through Anchor with a passport).</i> <i><br><br></i> <h2>  Total - 4 years with Anchor Modeling </h2><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b3c/169/60d/b3c16960d07062b4e4e801c937787ea7.png"><br><br>  When you first read about Anchor Modeling, it becomes scary. <br>  Scary to drown in the tables.  Fear is fair, it is important not to stop it.  The above illustration shows the growth rate of the amount of each type of table in Avito over 4 years (the right graph is the total amount of Anchor + Attribute + Tie). <br><br>  Let me remind you the first graph in the article - Avito storage at the end of 2016 included data from more than 29 source systems.  As you can see, there are many tables.  But not terribly much.  It can be said that a large jump in the number of tables occurs at the beginning, and then, due to the increasing reuse of old tables, the growth rate decreases.  The sharp jump in the number of tables at the end of 2016 is due to the connection of an unusually large number of new systems and demonstrates that, despite the size of the system, it is still capable of expanding. <br><br>  The second reason to fear a large number of tables is the complexity of the analysis from external analysts. <br><br>  On the way to deal with such fears, I will discuss in the next article.  I hope this time it will not have to wait for another three years :) In the meantime, you can study the records of my speeches on the topic at <a href="https://www.youtube.com/watch%3Fv%3D_GAY3EQLk2Y">seminars</a> , <a href="http://www.highload.ru/2015/abstracts/1878.html">conferences</a> and <a href="https://www.brighttalk.com/webcast/13185/242829/riski-vnedrenija-hranilishcha-bolshih-dannyh-4-goda-hpe-vertica-v-avito">webinars</a> . <br><br>  Ps.  Lars has completed his online course for those who want to understand the nuances of Anchor Modeling. <br>  <a href="http://anchor.teachable.com/courses/enrolled/124660">anchor.teachable.com/courses/enrolled/124660</a> .  Recommend.  There's even one video about Avito's case :). </div><p>Source: <a href="https://habr.com/ru/post/322510/">https://habr.com/ru/post/322510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322498/index.html">11 steps to high email deliverability</a></li>
<li><a href="../322500/index.html">The CDN provider Cloudflare has injected the contents of its server‚Äôs memory into arbitrary webpage code.</a></li>
<li><a href="../322502/index.html">Downloading audio from mail.ru</a></li>
<li><a href="../322504/index.html">Generation of polygonal maps for games</a></li>
<li><a href="../322508/index.html">15 oddities in ruby ‚Äã‚Äãthat you should know</a></li>
<li><a href="../322512/index.html">Conversion and payment types in traffic arbitration</a></li>
<li><a href="../322514/index.html">Neural network imitation game</a></li>
<li><a href="../322520/index.html">Smart feeder: Machine Learning, Raspberry Pi, Telegram, a little learning magic + assembly instructions</a></li>
<li><a href="../322524/index.html">Unscientific revolution: how the lack of real research is ruining technological projects</a></li>
<li><a href="../322526/index.html">Another node.js library ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>