<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make remote access more secure with a token?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2016, Avast decided to experiment with exhibitors at the Mobile World Congress. Employees of the company created three open Wi-Fi points at the air...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make remote access more secure with a token?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uh/hn/vz/uhhnvzhtvwpdue0jq-ej2nnvg_k.jpeg"></div><p>  In 2016, Avast decided to <a href="https://press.avast.com/en-us/avast-wi-fi-hack-experiment-demonstrates-reckless-behavior-of-mobile-world-congress-attendees">experiment</a> with exhibitors at the Mobile World Congress.  Employees of the company created three open Wi-Fi points at the airport near the booth for registering visitors to the exhibition and called them the standard names ‚ÄúStarbucks‚Äù, ‚ÄúMWC Free WiFi‚Äù and ‚ÄúAirport_Free_Wifi_AENA‚Äù.  In 4 hours, 2000 people connected to these points. </p><br><p>  As a result of the experiment, a report was compiled, in which Avast employees analyzed the traffic of all people connected to open Wi-Fi points.  Personal information was also disclosed to 63% of those who connected: logins, passwords, email addresses, etc.  If the report that was not presented at the exhibition, the participants in the experiment would never have understood that someone had access to their data. </p><br><p>  We are connecting to the network of our company from home, hotel or cafe and we do not even understand how much damage we can cause. </p><a name="habracut"></a><br><p>  According to statistical studies, more than 40 percent of company employees work remotely at least one day a week. </p><br><p>  But it turns out that an employee working remotely via the Internet is much more vulnerable than a local user and poses a potential threat to the company.  Therefore, the security of remote users should be given special attention. </p><br><h2>  Threat factors </h2><br><p>  A remote user workstation generates, in comparison with a local office workstation, three additional threat factors: </p><br><ol><li>  Remote user is outside the physical control of the organization.  Proof is required that it is an employee of the company that connects to the corporate resource, and not an attacker. </li><li>  Remote user data is distributed through channels that are outside the control area of ‚Äã‚Äãthe organization.  This data is subject to interception, unauthorized alteration and ‚Äúmixing‚Äù of extraneous traffic. </li><li>  For a remote workplace, the company itself cannot provide physical security.  Also, the computer used may not meet configuration requirements. </li></ol><br><p>  Therefore, when organizing remote access, three basic principles of information security should be observed: </p><br><ul><li>  <i>confidentiality</i> (important information should be available only to a limited circle of people); </li><li>  <i>integrity</i> (changes of information leading to its loss or distortion should be prohibited); </li><li>  <i>availability</i> (information should be available to authorized users when they need it). </li></ul><br><h2>  How to protect remote access? </h2><br><p>  To organize the work of remote employees, you can use the following protection mechanisms: </p><br><ul><li>  reliable user authentication tool (passwords, hardware, biometric data, etc.); </li><li>  access control system (centralized access control to the company's IT resources); </li><li>  VPN organization tool (hardware, software, firewall extensions, etc.); </li><li>  means of resisting attacks (protection of the internal network and employees from attacks). </li></ul><br><p>  We will talk about one of the protection mechanisms - this is VPN. </p><br><h2>  Why do I need a VPN? </h2><br><p>  A VPN connection provides a more secure connection to the corporate network and the Internet. </p><br><img src="https://habrastorage.org/webt/al/w-/w2/alw-w2avqi6yvojikf7oi02dez0.jpeg"><br><p>  VPN applications: </p><br><ul><li>  Internet access; </li><li>  access to the corporate network from the outside; </li><li>  integration of corporate network components. </li></ul><br><p>  Your company's network infrastructure can be prepared to use a VPN using software or hardware. </p><br><p>  There are a large number of paid and free VPN services. </p><br><p>  Such services mainly work on 4 protocols: </p><br><ol><li>  <b>IPSec</b> , operating in transport and tunnel modes.  Encrypting messages in a data packet using transport mode is called the payload, and encrypting the entire packet is called tunneling. </li><li>  <b>PPTP</b> is a point-to-point tunnel protocol that uses a tunnel method in which data is stored as PPP packets.  They, in turn, are placed in IP packets and transmitted to the destination. </li><li>  <b>L2TP</b> is a second-level tunneling protocol that runs on two primary nodes: the L2TP access concentrator (LAC), the L2TP network server (LNS).  LAC is a device that terminates a call, while LNS authenticates PPP packets. </li><li>  <b>TLS and SSL</b> are cryptographic protocols that use a combination of authentication and encryption to communicate between a server and a client. </li></ol><br><img src="https://habrastorage.org/webt/n0/tz/gj/n0tzgj4sjgqwkub0bncbfvuqfoe.png"><br><p>  There are also VPN services for corporate use.  One of the most famous is OpenVPN.  It is a safe and inexpensive service. </p><br><p>  Its advantages are: </p><br><ol><li>  Security.  The use of several cryptographic protocols (HMAC, 3DES, AES, RSA) and a 2048-bit key enable reliable encryption of all data. </li><li>  The flexible features of OpenVPN allow you to run a connection through Proxy / Socks, using various protocols and with the forced blocking of the DHCP protocol, as well as through firewalls. </li><li>  Supported by most devices, including Apple iOS and Google Android. </li></ol><br><h2>  Can I make a VPN connection without using third-party programs? </h2><br><p>  Sometimes it makes no sense to use third-party services if similar capabilities are built into the operating system. </p><br><p>  We want to demonstrate how to set up a secure SSTP VPN connection using standard Windows features. </p><br><p>  The VPN connection is secured in such a case through traffic encryption mechanisms using a digital certificate (SSL) provided by the VPN server.  During the installation of the VPN connection, the client operating system software verifies the certificate of the VPN server, in particular, checks whether the server certificate has been revoked, and whether it is worth checking whether the root certificate of the Certificate Authority that issued the certificate for the VPN server is trusted.  That is why one of the requirements for successful SSTP VPN connections is the ability to automatically update the list of root certificates over the Internet. </p><br><p>  SSTP is a modern and secure protocol.  An additional advantage is its ability to work through the universally accessible HTTPS protocol port (TCP 443), which is used for ordinary web browsing, that is, the SSTP VPN connection will work through almost any Internet connection. </p><br><h2>  VPN and two-factor authentication </h2><br><p>  By itself, the VPN connection is encrypted.  But using a login and password for authentication in a VPN is completely insecure.  But there is a way out - this is two-factor authentication.  It allows the user to verify his identity in two ways.  It is desirable to use a hardware tool (a token or a smart card) to configure it.  Then, when establishing a VPN connection, the user does not need a password, but the device itself and its PIN code. </p><br><p>  The main advantage of a hardware device when using a VPN is the uniqueness of the private key.  It is caused by the fact that the private key from the device cannot be copied and reproduced.  After all, if the authentication tool does not have uniqueness, then it is impossible to be sure that the user who received access is the very user to whom this access was assigned. </p><br><p>  In the case of using a password, the situation is quite different.  Anyone who specifically or accidentally recognized your password can use it without your knowledge.  This means that he can do whatever he wants on behalf of the password owner.  It is rather difficult to track this situation, especially if the attacker is technically savvy. </p><br><h2>  Configure the VPN server </h2><br><p>  We will begin setting up a VPN connection by deploying a simple VPN server based on Windows Server 2012 R2. </p><br><p>  Such a server installed on standard equipment can be used for a small office network with the need for remote connection organization for several dozen employees (30-50 people). </p><br><h3>  VPN server configuration </h3><br><p>  Open the <b>Server Manager</b> and click the <b>Add Roles and Components</b> link. </p><br><p>  Choose the role of <b>Remote Access</b> . </p><br><img src="https://habrastorage.org/webt/tv/bs/qa/tvbsqaevlbyzetjo6wkkuy6mdnc.jpeg"><br><br><p>  Choose the <b>DirectAccess and VPN</b> role service <b>(RAS)</b> . </p><br><img src="https://habrastorage.org/webt/bs/cv/rz/bscvrzmj8ppgyy2urgyqxthfsto.jpeg"><br><br><p>  Click the <b>[Install]</b> button.  As a result, the installation process of the remote access role will start. </p><br><img src="https://habrastorage.org/webt/dq/gn/6k/dqgn6kitrqwlozh4czpkpn7vbfq.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  In the Initial Remote Access Setup Wizard, select <b>Deploy VPN Only</b> . </p><br><p>  After that we will add the server.  In the <b>Routing and Remote Access</b> window, select the <b>Action</b> menu item and the <b>Add server</b> sub-item.  Next, we confirm the addition. </p><br><p>  Click on the name of the added server with the right mouse button and select <b>Configure and enable routing and remote access</b> . </p><br><img src="https://habrastorage.org/webt/dx/2n/j4/dx2nj4cqdbwkdk1jkdzbgrct2ye.jpeg"><br><br><p>  Select the item <b>Special configuration</b> . </p><br><img src="https://habrastorage.org/webt/05/fn/i_/05fni_rteske939wjr-rgauot1u.jpeg"><br><br><p>  As a custom configuration, select <b>Access to a virtual private network (VPN)</b> . </p><br><img src="https://habrastorage.org/webt/p1/mz/co/p1mzcolkwqpzclgvgo56xfz3vjo.jpeg"><br><br><p>  We will start the service, for this we will click on the <b>[Start the service]</b> button. </p><br><img src="https://habrastorage.org/webt/de/ig/1t/deig1t__0qccs2z1yy8sszxyuhe.jpeg"><br><br><p>  The server is almost ready. </p><br><p>  For example, we use the simplest and most obvious way - we will set a statistical pool of addresses for 5 users. </p><br><p>  Open the properties of the added server. </p><br><img src="https://habrastorage.org/webt/tw/ls/ii/twlsiitm8jght6dgih24mz6encu.jpeg"><br><br><p>  Select the <b>Statistical Address Pool</b> item and click the <b>[Add]</b> button. </p><br><p> In the <b>New IPv4 Address Range</b> window, specify the starting and ending IP address. </p><br><img src="https://habrastorage.org/webt/2d/l-/md/2dl-mdf5099wuei0h3_wrqmmyrq.jpeg"><br><br><p>  Click the <b>[Apply]</b> button </p><br><img src="https://habrastorage.org/webt/hw/nv/h_/hwnvh_swl04xkorc0-r0r2ss8ra.jpeg"><br><br><p>  The role of remote access is configured, now we will open ports in the firewall. </p><br><h3>  Opening Firewall Ports </h3><br><p>  For <b>the TCP protocol,</b> open ports <b>1723</b> and <b>443</b> . </p><br><img src="https://habrastorage.org/webt/b_/qo/pf/b_qopfefjtq_ujvyawj9pbkwthm.jpeg"><br><br><p>  For <b>the UDP protocol,</b> open ports <b>1701</b> , <b>500</b> and <b>50</b> . </p><br><img src="https://habrastorage.org/webt/9c/4e/ii/9c4eiifyxzjhemydrajp0b_1kai.jpeg"><br><br><p>  In the next step, we configure the local security policy. </p><br><h3>  Setting local security policy </h3><br><p>  Open the list of local security policies and select the <b>Assign user rights</b> item. </p><br><img src="https://habrastorage.org/webt/80/xa/dk/80xadkue7q6jg9g6sivigc9jqh0.jpeg"><br><br><p>  Select the policy <b>Allow logon through Remote Desktop Services</b> . </p><br><p>  Click the <b>[Add user or group]</b> button. </p><br><img src="https://habrastorage.org/webt/ax/bb/qw/axbbqwkchtii1ttxu8wo7wanj_a.jpeg"><br><br><p>  Find the name of the Subdivision <b>Domain Users</b> and add it. </p><br><p>  Well, the penultimate step will be setting up access for specific users. </p><br><h3>  Setting access for a specific user </h3><br><p>  Open <b>Server Manager</b> , select <b>Tools,</b> and select <b>Active Directory Users and Computers</b> . </p><br><p>  Find the name of the user you need, go to his <b>Properties</b> , on the <b>Incoming Calls</b> tab, select the <b>Allow Access option</b> .  Click the <b>[Apply]</b> button. </p><br><img src="https://habrastorage.org/webt/in/yx/st/inyxstkhcbzie6eesqgkf6qjzue.png"><br><br><p>  And finally, let us check whether remote access is allowed in the system properties. </p><br><p>  To do this, open the properties of the system, select the <b>Configure Remote Access</b> <b>option</b> and select the <b>Allow remote connections to this computer</b> check box. </p><br><img src="https://habrastorage.org/webt/ph/wl/fm/phwlfm0k4yzurr0eb8gcdkmy5se.jpeg"><br><br><p>  That's it, the server setup is now complete.  Now we will configure the VPN connection on the computer that will be used for remote access. </p><br><h2>  Configure VPN Connection </h2><br><p>  Setting up a VPN on a computer with Windows 10 is extremely simple.  To implement it, you will need account information (login, password), server IP address and Internet connection.  To organize the hardware two-factor authentication, you will need a token. </p><br><p>  No additional programs need to be installed, Windows itself already has everything. </p><br><p>  Let's get down to setting it up.  As an example of hardware, I will use the device for secure storage of keys and certificates <a href="https://www.rutoken.ru/products/all/rutoken-ecp-pki/">Rutoken EDS PKI</a> . </p><br><img src="https://habrastorage.org/webt/nr/cr/m8/nrcrm8wi6a_zgvgfkh5e4zmw7rs.jpeg"><br><br><p>  To configure the connection, we need a certificate that contains policies Smart Card Logon and Client Authentication. </p><br><p>  The process of creating such a certificate, we have previously described.  Link to the description <a href="https://habrahabr.ru/company/aktiv-company/blog/327232/">here</a> . </p><br><p>  Open the <b>Network and</b> Sharing <b>Center</b> .  Click the link <b>Create and configure a new connection or network</b> . </p><br><img src="https://habrastorage.org/webt/bd/60/cf/bd60cfbxikcczdiusptjfghm1t8.jpeg"><br><br><p>  The <b>Configure Connection or Network</b> window opens.  Select the Connection to the workplace item and click on the <b>[Next]</b> button. </p><br><p>  Click the link <b>Use my Internet connection (VPN)</b> . </p><br><img src="https://habrastorage.org/webt/4l/t6/6k/4lt66koan-hnkbqbqsitif0snfk.jpeg"><br><br><p>  In the field <b>Internet address</b> we indicate the data of the VPN server. </p><br><p>  In the <b>Name</b> field of the <b>target object</b> we specify the name of the VPN connection. </p><br><p>  Select the <b>Use smart card</b> checkbox and click on the <b>Create</b> button. </p><br><img src="https://habrastorage.org/webt/uj/kt/8c/ujkt8cmyrggvoaszsslt5srs9s0.jpeg"><br><br><p>  VPN connection created.  But we need to change its parameters. </p><br><p>  Open the <b>Network and</b> Sharing <b>Center</b> window again and click on the <b>Change adapter settings</b> link. </p><br><img src="https://habrastorage.org/webt/nh/zr/vn/nhzrvn1mag6uc1_4lffdiauh-qa.jpeg"><br><br><p>  In the <b>Network Connections</b> window, right-click on the name of the created VPN connection and select <b>Properties</b> . </p><br><img src="https://habrastorage.org/webt/uv/ul/v8/uvulv8aqxyn1k0hst-wg-u8cjpo.jpeg"><br><br><p>  Go to the <b>Security</b> tab and select the following options. </p><br><img src="https://habrastorage.org/webt/c6/b9/bu/c6b9buavtycbslovdmpw8yovtiy.jpeg"><br><br><p>  Such VPN connection settings are enough to successfully connect via a secure VPN protocol to the specified network.  However, after the VPN connection is made, all network traffic from the computer will by default be directed to the gateway of the specified network.  This can lead to the fact that during connection to a VPN, working with Internet resources will not be possible.  In order to eliminate this problem, go to the <b>Network</b> tab, click on the <b>IP version 4 line (TCP / IPv4)</b> and click on the <b>Properties</b> button. </p><br><img src="https://habrastorage.org/webt/un/a6/3c/una63clr1pbd2edzjx3bthvanku.jpeg"><br><br><p>  On the IP version 4 properties page, click the <b>[Advanced]</b> button. </p><br><p>  Clear the <b>Use default gateway on remote network</b> box. </p><br><img src="https://habrastorage.org/webt/zc/g9/mp/zcg9mp68sev5pidgelcaxn7bjau.jpeg"><br><br><p>  Confirm all changes made.  The configuration process is complete. </p><br><p>  Now let's check the connection. </p><br><p>  In the taskbar on the desktop, click on the icon <b>Access to the Internet</b> and select the VPN connection created.  The <b>Settings</b> window opens. </p><br><p>  Click on the name of the VPN connection and click on the <b>Connect</b> button. </p><br><img src="https://habrastorage.org/webt/lu/u9/hf/luu9hf3gvmmqoktzncoaa5qaqhq.jpeg"><br><br><p>  Enter the PIN of the token and click the <b>[OK] button</b> . </p><br><img src="https://habrastorage.org/webt/hi/qg/bg/hiqgbgdqm_8fobdid2ftvkdonmo.jpeg"><br><br><p>  As a result, the created VPN connection will be established. </p><br><p>  To check the status of the VPN connection, open the <b>Network Connections</b> window, find the name of the created connection.  Its status must be ‚ÄúConnected‚Äù. </p><br><img src="https://habrastorage.org/webt/dz/qo/fm/dzqofmxwkcizvlx2s71va2sjnyc.jpeg"><br><br><p>  To break a VPN connection in the same window, find the created connection, right-click on its name and select <b>Connect / Disconnect</b> . </p><br><h2>  We summarize </h2><br><p>  When a VPN connection is established, all traffic begins to pass through the VPN server. </p><br><p>  The reliability of protecting VPN traffic lies in the fact that even if an attacker somehow intercepts the transmitted data, they will still not be able to use it, since the data is encrypted. </p><br><p>  And if you install special traffic control applications and configure them, you can successfully filter traffic.  For example, automatically check it for viruses. </p><br><p>  Hopefully we managed to convince you that VPN is easy, affordable, and most importantly safe! </p><br></div><p>Source: <a href="https://habr.com/ru/post/343638/">https://habr.com/ru/post/343638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343628/index.html">DevDay about microservices. Record the best reports</a></li>
<li><a href="../343630/index.html">Indie developer started phone tech support, and that's what happened</a></li>
<li><a href="../343632/index.html">How much does a CRM system cost?</a></li>
<li><a href="../343634/index.html">Announcement of the meeting WordPress Meetup # 4 in Kharkov</a></li>
<li><a href="../343636/index.html">XML string constructor from PHP array</a></li>
<li><a href="../343640/index.html">Greenplum 5: first steps in open source</a></li>
<li><a href="../343642/index.html">Mother's architect: how we collected mobile architectures and pleased our parents</a></li>
<li><a href="../343644/index.html">Forced Introduction to Configuration Management Systems</a></li>
<li><a href="../343646/index.html">Overview of important legal requirements of the Facebook platform</a></li>
<li><a href="../343648/index.html">The battlefield is augmented reality. Part II: how to recognize the object and show the 3D model</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>