<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ORM or how to forget about database design</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the author 
 A year has passed since I changed the profession of a network administrator to the profession of a programmer. This year was a lot o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ORM or how to forget about database design</h1><div class="post__text post__text-html js-mediator-article"><h4>  From the author </h4><br>  A year has passed since I changed the profession of a network administrator to the profession of a programmer.  This year was a lot of unusual and strange.  I managed to work closely with sqlalchemy, take a look at ponyorm, play around with hibernate and nhibernate, refresh models from django ... and you know what?  All the code that I saw was associated with the consequences of the monkey's activity with a supply of grenades ... it turned out that letting programmers to the database is not the best idea.  Under the cut a lot of pain and hatred, but suddenly someone will come in handy. <br><a name="habracut"></a><br>  Before I begin, I want to enter a couple of assumptions: <br><ol><li>  All text is IMHO </li><li>  All names and cases are synthetic.  Any coincidence with real projects and characters is an accident. </li><li>  The author has big problems with the Great and Mighty (fight through personal messages) </li></ol><br><br><h4>  What is ORM? </h4><br>  Before you teach someone the mind, you should understand what the term ORM is.  According to the analogue of <a href="https://ru.wikipedia.org/wiki/ORM">TSB</a> , the abbreviation ORM hides the bourgeois Object-relational mapping, which in Pushkin‚Äôs language means ‚ÄúObject-relational mapping‚Äù and means ‚Äúprogramming technology that links databases with concepts of object-oriented programming languages‚Äù ... i.e. .  ORM - a layer between the database and the code that the programmer writes, which allows the objects created in the program to be added / received to / from the database. <br>  It's simple!  Create an object and put in the database.  Need the same object?  Take from the database!  Brilliant!  BUT!  Programmers forget about the first little letter of abraviatury and write everything into the same table!  Starting from the properties of objects, which is logical, and ending with the foreign key, which has nothing to do with the object!  And, worst of all, many tons of howto and example are promoting this approach ... it seems to me that the root cause lies in the constant balancing between "I am a programmer" and "I am an architect of the database", but since  ORM multiply and multiply - the voice of the programmer weighs on the architect.  All, there is no further pain, only imho. <br><br><h4>  ‚ÄúWho are you, Mr. Brooks?‚Äù Or ‚ÄúWhat is an object?‚Äù </h4><br>  How to define "what is an object" in ORM?  How many people will be able to convey the whole meaning from the first time?  Let me try. <br>  Suppose we all live in the territory of Belarus / Ukraine / Russia, just like me.  According to the law, same-sex marriage and polygamy are prohibited in the country.  At the same time, there is the concept of ‚Äúmilitary duty‚Äù and other ‚Äúspecific‚Äù properties for each sex.  What follows from this? <br><ol><li>  For each sex it is advisable (but not essential) to have their own nameplate. </li><li>  Somewhere you need to store information about the husband and wife accessories </li></ol><br>  ‚ÄúSo this is OneToOne!  Classic!  What's so complicated?  We define fkey at the line for males or females and run further ‚Äù- aha, I can read minds.  BUT!  A year later, our software became interesting to the Arab sheikhs and they are perplexed, so, no more than 1 wife?!?!  And who should add fkey?  Male?  Female?  And if everything is in the same table - who will write and will accompany the logic checking that the middle-aged lady will not have a spouse? <br>  Unclear?  OK.  Let's pseudocode: <br> <code>man_1 = new Man()</code> <br> <code>man_1.name = ""</code> <br> <code>woman_1 = new Woman()</code> <br> <code>woman_1.name = ""</code> <br> <code>???</code> <br>  What's next? <br>  <code>man_1.wife = woman_1</code> or <code>woman_1.husband = man_1</code> <br>  And how to keep this in the database?  No way!  In the example, the obviously wrong approach to the data structure! <br>  The name property of the woman_1 and man_1 objects is a property of the ORM object, while the wife property of the man_1 object and the husband of the woman_1 object are already relations of ORM objects!  THIS IS DIFFERENT PROPERTIES! <br>  Still not clear?  OK.  Let's get to the question in a more humanitarian language. <br>  There is Ivan and there is Tatiana.  If they are banned then?  Right!  They will not change!  And if you tear off Ivan‚Äôs hands (or another important organ) and shave Tatiana‚Äôs hair, they will change!  So, marriage is a relationship of obets, and hands and hair are properties of objects.  Everything, I do not know how else to explain. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Heavy OOP Legacy </h4><br>  At the very least, we have come to understand the object.  It became quite clear who is who.  But how to save this in the database?  Some comrades with clever faces and long beards advocate the statement "everything is an object."  Let's try to stick to the same thing, since we are considering ORM.  Suppose we use different tables for the objects Man and Woman.  Where will we keep the ‚Äúobject‚Äù of their relationship?  Right!  IN A SEPARATE TABLE!  Let's call her <code>woman_and_man</code> .  In the table so far there will be only 2 columns representing fkey: man_id and woman_id. <br>  ‚ÄúWait, my dear, this is already ManyToMany of some kind!‚Äù - aha, I still read your thoughts!  In principle, I agree with you, with one minor amendment.  If you define the correct constraint for the woman_and_man table, it turns into OneToOne with a flick of the wrist.  Do not believe?  We try! <br>  For the OneToOne case, we need to follow these rules: <br><ol><li>  One woman cannot have more than one male husband </li><li>  One man cannot have more than one female wife </li></ol><br>  We introduce the appropriate constraint: <br><ol><li>  the value of man_id must be unique and not null </li><li>  The woman_id value must be unique and non-null within the woman_and_man table. </li></ol><br>  Everything!  We have OneToOne! <br>  Send software for export to the UAE - change the constraint for man_id and get ManyToOne / OneToMany!  Please note that the structure of the tables will not change, only constraint will change! <br>  We send software for export to a country with mutual polygamy / polyandry (and there are such ?!) - change the constraint for the woman_id and get ManyToMany!  Please note that the structure of the tables will not change, only constraint will change! <br>  Check your ORM - you will find an example of using OneToOne / ManyToOne / OneToMany through add.  the table. <br><br><h4>  Dedicated to critics </h4><br>  After expressing my thoughts to the manager, I received the expected reaction: ‚ÄúWhy is it so difficult?  KISS! ‚Äù <br>  I had to "gain experience": <br><br>  There were cases with cyclic connections between objects containing among the fkey properties and the backup / serialization task of this outrage in xml / json.  No, backups are made, so later to restore this disgrace is damn difficult ... you need to strictly monitor what properties are created during restoration / deserialization, and then re-run through the objects and restore the connections between them.  Adhering to the rules above - you must first restore the objects, and only then the connection between them.  Since  This information is stored in different tables / entities - the logic was linear and simple. <br><br>  For each attack, ‚Äútake Mongu and do not worry‚Äù or ‚Äúdocument-oriented database drives‚Äù, I always came to the same result that no one else could cover: <br>  I can create a schema in a relational database that will retain an arbitrary data structure (arbitrary documents), but can you ensure data integrity at a relational database level in a document-oriented database?  I could not reach this level. <br>  Does anyone bother with multiple pieces of duplicate documents with an arbitrary level of nesting?  No, I know that their storage is optimized and just do you, what's the difference?  But still. <br><br>  PS This is not the whole "stream of consciousness" associated with the ORM.  There are also a couple of paragraphs for null, a couple for optimizing queries and deferred loading of objects, a paragraph for relationship properties (yeah, it happens), but is it relevant?  I ask critics to speak in comments.  I will include particularly acute and interesting questions in the sequel. </div><p>Source: <a href="https://habr.com/ru/post/237889/">https://habr.com/ru/post/237889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237879/index.html">JetBrains distributes free products to students</a></li>
<li><a href="../237881/index.html">Guide to creating startups, part 4: the most important thing for a startup</a></li>
<li><a href="../237883/index.html">Welcome to the 23rd Moscow Django Meetup</a></li>
<li><a href="../237885/index.html">We understand the protocol 2-wire JTAG</a></li>
<li><a href="../237887/index.html">Backblaze updated HDD reliability statistics</a></li>
<li><a href="../237891/index.html">WGDC Competition: Latest Recommendations and Jury Composition</a></li>
<li><a href="../237893/index.html">The main types of search queries that online store users use, is your website ready for them? (Part 1)</a></li>
<li><a href="../237899/index.html">Using SmtpClient to send mail via Yandex SMTP server with SSL</a></li>
<li><a href="../237903/index.html">Bitcoin rate is growing again: Paypal has allowed Bitcoin payments in US online stores</a></li>
<li><a href="../237905/index.html">PayPal Announces Collaboration With Bitcoin Payment Processors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>