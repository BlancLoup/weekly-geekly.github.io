<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vulnerabilities smart contracts Etherium. Code examples</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With this post I begin a series of articles on the topic of security of Ethereum smart contracts. I think this topic is very relevant, since the numbe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vulnerabilities smart contracts Etherium. Code examples</h1><div class="post__text post__text-html js-mediator-article">  With this post I begin a series of articles on the topic of security of Ethereum smart contracts.  I think this topic is very relevant, since the number of developers is growing avalanche-like, and there is no one to protect them from the ‚Äúrake‚Äù.  For now - translations ... <br><br><h3>  1. Scanning Live Ethereum of Unchecked-Send Error Contracts </h3><br><p>  Original - <a href="http://hackingdistributed.com/2016/06/16/scanning-live-ethereum-contracts-for-bugs/">Scanning Live Ethereum Contracts for the "Unchecked-Send ..."</a> </p><br>  Authors: <a href="http://hackingdistributed.com/zikai/">Zikai Alex Wen</a> and <a href="http://hackingdistributed.com/amiller/">Andrew Miller</a> <br><br><p>  Programming smart contracts in Ethereum is known to be error prone <a href="https://eprint.iacr.org/2015/460.pdf">[1]</a> .  We recently saw several <br>  high-end smart contracts, such as <a href="http://www.kingoftheether.com/postmortem.html">King of the Ether</a> and <a href="">The DAO-1.0</a> , contained vulnerabilities caused by programming errors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since March 2015, smart contract programmers have been warned about the specific programming risks that may arise when contracts send messages to each other <a href="">[6]</a> . <br><br>  Several programming guides recommend how to avoid common mistakes (in official Ethereum documents <a href="http://solidity.readthedocs.io/en/stable/types.html">[3]</a> and in an independent manual from UMD <a href="https://mc2-umd.github.io/ethereumlab/docs/serpent_tutorial.pdf">[2]</a> ).  Although these dangers are sufficiently understandable to avoid them, the consequences of such an error are terrible: money can be blocked, lost or stolen. <br><br>  How common are the errors resulting from these hazards?  Are there still vulnerable, but live contracts for the block chain Ethereum?  In this article, we answer this question by analyzing contracts on the live block-chain Ethereum using a new analysis tool that we developed. <br></p><br><a name="habracut"></a><h3>  What is the "unchecked-send" error? <br></h3><br><p>  To send a broadcast to another address, the easiest way is to use the <strong>send</strong> keyword.  It acts as a method defined for each object.  For example, the following code snippet can be found in a smart contract that implements a board game. <br></p><br><p></p><pre><code class="plaintext hljs">/*** Listing 1 ***/ if (gameHasEnded &amp;&amp; !( prizePaidOut ) ) { winner.send(1000); //    prizePaidOut = True; }</code> </pre> <br><p>  The problem here is that the <strong>send</strong> method may fail.  If it does not work, the winner will not receive the money, but the variable prizePaidOut will be set to True. <br><br>  There are two different cases in which the <strong>winner.send ()</strong> function can fail.  We will make out the difference between them later.  The first case is that the address of the <strong>winner</strong> is a contract (and not a user account), and the code of this contract generates an exception (for example, if it uses too much ‚Äúgas‚Äù).  If this is the case, then perhaps in this case it is a ‚Äúmistake of the winner‚Äù.  The second case is less obvious.  The Ethereum virtual machine has a limited resource called ‚Äú <strong>callstack</strong> ‚Äù (call stack depth), and this resource can be used by another contract code that was executed earlier in the transaction.  If the <strong>callstack is</strong> already consumed at the time the <strong>send</strong> command is executed, the command will fail, regardless of how the <strong>winner is</strong> defined.  The prize of the winner will be destroyed not through his fault! </p><br><br>  How can you avoid this error? <br><br>  The Ethereum documentation contains a brief warning about this potential hazard <a href="http://solidity.readthedocs.io/en/stable/types.html">[3]</a> : ‚ÄúThere is some danger when using <strong>send ‚Äî the</strong> transfer fails if the call stack has a depth of 1024 (this can always be caused by the caller), and fails if the recipient ends with ‚Äúgas.‚Äù Therefore, to ensure safe transmission of air, always check the return value of <strong>send</strong> or even better: use a template in which the recipient withdraws money. " <br><p>  Two sentences.  The first is to check the return value of <strong>send</strong> to see if it completed successfully.  If not, then generate an exception to roll the state back. </p><br><p></p><pre> <code class="plaintext hljs"> /*** Listing 2 ***/ if (gameHasEnded &amp;&amp; !( prizePaidOut ) ) { if (winner.send(1000)) prizePaidOut = True; else throw; }</code> </pre> <br><p>  This is an adequate fix for the current example, but not always the right solution.  Suppose we modify our example so that when the game is over, the winner and the loser roll back their status.  An obvious use of the ‚Äúofficial‚Äù solution would be the following: <br></p><br><p></p><pre> <code class="plaintext hljs">/*** Listing 3 ***/ if (gameHasEnded &amp;&amp; !( prizePaidOut ) ) { if (winner.send(1000) &amp;&amp; loser.send(10)) prizePaidOut = True; else throw; }</code> </pre> <br><p>  However, this is a mistake because it introduces an additional vulnerability.  While this code protects the <strong>winner</strong> from a <strong>callstack</strong> attack, it also makes the <strong>winner</strong> and <strong>loser</strong> vulnerable to each other.  In this case, we want to prevent the <strong>callstack</strong> attack, but continue to execute if the <strong>send</strong> command does not work for some reason. <br><br>  Therefore, even the best practice (recommended in our ‚ÄúProgrammer‚Äôs Guide for Ethereum and Serpent‚Äù, although it is equally applicable to Solidity), is to check the availability of the <strong>callstack</strong> resource.  We can define a <strong>callStackIsEmpty ()</strong> macro that will return an error if and only if the <strong>callstack is</strong> empty. </p><br><p></p><pre> <code class="plaintext hljs">/*** Listing 4 ***/ if (gameHasEnded &amp;&amp; !( prizePaidOut ) ) { if (callStackIsEmpty()) throw; winner.send(1000) loser.send(10) prizePaidOut = True; }</code> </pre> <br><p>  Better yet, the recommendation from the Ethereum documentation - ‚ÄúUse a template in which the recipient takes the money‚Äù is a bit mysterious, but has an explanation.  The suggestion is to reorganize your code so that the effect of a <strong>send</strong> failure is isolated, and only affects one recipient at a time.  Below is an example of this approach.  However, this tip is also anti-pattern.  It assumes responsibility for checking the <strong>callstack</strong> by the recipients themselves, which makes it likely that they will fall into the same trap. <br></p><br><p></p><pre> <code class="plaintext hljs">/*** Listing 5 ***/ if (gameHasEnded &amp;&amp; !( prizePaidOut ) ) { accounts[winner] += 1000 accounts[loser] += 10 prizePaidOut = True; } ... function withdraw(amount) { if (accounts[msg.sender] &gt;= amount) { msg.sender.send(amount); accounts[msg.sender] -= amount; } }</code> </pre> <br><p>  Many highly intelligent contracts are vulnerable.  Lottery "King of the Ether of the Throne" - the most famous case of this error <a href="http://www.kingoftheether.com/postmortem.html">[4]</a> .  This error was not noticed until the amount of 200 airs (worth more than $ 2,000 at today's price) could not get a legitimate lottery winner.  Corresponding code in King of the Ether is similar to the code in Listing 2 Fortunately, in this case, the contract developer was able to use the unrelated function in the contract as a ‚Äúmanual override‚Äù to release the stuck means.  A less scrupulous administrator could use the same function to steal the air! <br></p><cut></cut><br>  Continued <a href="https://habr.com/post/430684">Scanning Live Ethereum of Unchecked-Send Error Contracts.</a>  <a href="https://habr.com/post/430684">Part 2</a> </div><p>Source: <a href="https://habr.com/ru/post/430602/">https://habr.com/ru/post/430602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430580/index.html">Top Django Framework Books</a></li>
<li><a href="../430590/index.html">Germany has developed requirements for home routers</a></li>
<li><a href="../430592/index.html">Client Internet in an isolated QEMU virtual machine using port tunneling through the SPICE channel</a></li>
<li><a href="../430596/index.html">How to prepare a grocery strategy? Product Manager's Guide</a></li>
<li><a href="../430600/index.html">Mars - from chocolate to robots</a></li>
<li><a href="../430604/index.html">Technologies used in the PVS-Studio code analyzer to search for errors and potential vulnerabilities</a></li>
<li><a href="../430606/index.html">Group-IB Webinar: "Forensic Investigation of RDP Artifacts in Windows"</a></li>
<li><a href="../430610/index.html">How to safely get rid of their electronic devices</a></li>
<li><a href="../430612/index.html">As in the 1980s, people downloaded radio games</a></li>
<li><a href="../430614/index.html">Black Friday 2018 at Madrobots</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>