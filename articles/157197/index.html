<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple automation of versioning and building a C / C ++ project in Ruby</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose that, as in my case, you first encountered the need 
 minimizing the movement on the way from the SVN source to the NSIS installer with associ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple automation of versioning and building a C / C ++ project in Ruby</h1><div class="post__text post__text-html js-mediator-article">  Suppose that, as in my case, you first encountered the need <br>  minimizing the movement on the way from the SVN source to the NSIS installer with associated auto-increment version of the project.  In manual mode, it looks like this: <br><ul><li>  We register the new version in the corresponding project source.  Whether it is necessary for users or as diagnostic information is irrelevant. </li><li>  We collect the project files necessary for setup. </li><li>  We update the version inside the nsi file, because we use it in the windows at the installation stage and in the name of the resulting setup file. </li></ul><br>  The vulnerability of this practice is found during rush jobs, when one or several of these items are missing, as a result of which the user is left with unmatched components. <br><br>  Without pretending to be new, the scripts offered below automate the assembly of C / C ++ Visual Studio projects with almost one click and will be useful, first of all, in a single development. <br><br><a name="habracut"></a>  It assumes the use of the ABCD format, where A and B rarely and manually change, and the following two parameters are updated with each release compilation: <br><ul><li>   - SVN revision number; </li><li>  D is the build number that is incremented. </li></ul><br>  The first script updates the version of the file through a special header, which, connecting to the resource file .rc, changes the attributes of the compiled project file.  The second script uses them to generate the NSIS installer, the name of which will reflect all the information about the current version, for example, MyApp-1.0.837.1.exe.  This guarantees the automation of the above assembly steps. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Autoincrementing implementation </h4><br>  To get the SVN revision number, we will use the base utility SubWCRev.exe, and for the autoincrement of the build number we cannot do without the Pre-Build Event, as it was done, for example, <a href="http://www.xakep.ru/post/23780/">here</a> or <a href="http://support.microsoft.com/kb/237870">here</a> . <br><br>  Create a VersionInfo.h file: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> __VERSION_INFO_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __VERSION_INFO_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_NAME </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MyApp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION 1,0,,0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION_S </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_DATE </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  and connect it to the .rc file (indicating the path where it was saved): <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../src/VersionInfo.h"</span></span></span></span></code> </pre><br>  Change the version of the final binaries, which will be needed later for .nsi: <br><pre> <code class="bash hljs"> FILEVERSION APP_VERSION PRODUCTVERSION APP_VERSION</code> </pre><br>  In the task of the script VersionBuild.rb after each execution <br><pre> <code class="bash hljs">C:\Ruby193\bin\ruby VersionBuild.rb VersionInfo.h</code> </pre><br>  includes modifying VersionInfo.h by inserting special keywords $ WCREV $ and $ WCNOW = $ from SubWCRev.exe: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION 1,0,$WCREV$,1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION_S </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"1.0.$WCREV$.1"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_DATE </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"$WCNOW=%d.%m.%Y %H:%M$"</span></span></span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION 1,0,$WCREV$,2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION_S </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"1.0.$WCREV$.2"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_DATE </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"$WCNOW=%d.%m.%Y %H:%M$"</span></span></span></span></code> </pre><br><pre> <code class="cpp hljs">...</code> </pre><br>  Subsequent call <br><pre> <code class="bash hljs">SubWCRev.exe .. VersionInfo.h VersionInfo.h</code> </pre><br>  substitute actual values ‚Äã‚Äãof the SVN revision number and date, for example <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION 1,0,29,2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_VERSION_S </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"1.0.29.2"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APP_DATE </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"01.11.2012 20:09"</span></span></span></span></code> </pre><br>  When implementing VersionBuild.rb, regular expressions are used so that formatting is preserved (spaces / tabs): <br><pre> <code class="ruby hljs">FNAME = ARGV[<span class="hljs-number"><span class="hljs-number">0</span></span>] file = File::read(FNAME) ANY_IN_QUOTES = Regexp.new(<span class="hljs-string"><span class="hljs-string">'"[^"]*"'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replaceVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">#   APP_VERSION matcher = Regexp.new('APP_VERSION\s*[^\r\n]*') line = file.match(matcher)[0] old_ver = /(\d+),(\d+),(.*),(\d+)/ line.match(old_ver) new_ver = [$1, $2, "$WCREV$", $4.to_i + 1] line.sub!(old_ver, new_ver.join(",")) file.sub!(matcher, line) #   APP_VERSION_S matcher = Regexp.new('APP_VERSION_S\s*' + ANY_IN_QUOTES.source) line = file.match(matcher)[0] line.sub!(ANY_IN_QUOTES, '"' + new_ver.join(".") + '"') file.sub!(matcher, line) end def replaceDate(file) #   APP_DATE matcher = Regexp.new('APP_DATE\s*' + ANY_IN_QUOTES.source) date = file.match(matcher)[0] date.sub!(ANY_IN_QUOTES, '"$WCNOW=%d.%m.%Y %H:%M$"') file.sub!(matcher, date) end replaceVersion(file) replaceDate(file) File::write(FNAME, file)</span></span></code> </pre><br>  To avoid an increase in compile time in a large project, it is recommended not to include VersionInfo.h in the project headers, but to add additional proxy files: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Version.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"VersionInfo.h"</span></span></span><span class="hljs-meta"> const char *Version() { return APP_VERSION_S; } const char *BuildDate() { return APP_DATE; }</span></span></code> </pre><br><br><h4>  Setup implementation </h4><br>  Below is a standard NSIS file for installing one exe (located in the same folder) with the creation of shortcuts on the desktop and in Start. <br><pre> <code class="bash hljs">!include <span class="hljs-string"><span class="hljs-string">"MUI.nsh"</span></span> ;     ;!define APP_NAME <span class="hljs-string"><span class="hljs-string">"MyApp"</span></span> ;!define MAJOR_VERSION <span class="hljs-string"><span class="hljs-string">"1"</span></span> ;!define MINOR_VERSION <span class="hljs-string"><span class="hljs-string">"0"</span></span> ;!define SVN_REVISION <span class="hljs-string"><span class="hljs-string">"29"</span></span> ;!define BUILD_NUMBER <span class="hljs-string"><span class="hljs-string">"2"</span></span> ;!define APP_VERSION <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${MAJOR_VERSION}</span></span></span><span class="hljs-string">.</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${MINOR_VERSION}</span></span></span><span class="hljs-string">.</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SVN_REVISION}</span></span></span><span class="hljs-string">.</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BUILD_NUMBER}</span></span></span><span class="hljs-string">"</span></span> ;!define SETUP_NAME <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${APP_NAME}</span></span></span><span class="hljs-string">-</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${APP_VERSION}</span></span></span><span class="hljs-string">.exe"</span></span> Name <span class="hljs-variable"><span class="hljs-variable">${SETUP_NAME}</span></span> OutFile <span class="hljs-variable"><span class="hljs-variable">${SETUP_NAME}</span></span> InstallDir <span class="hljs-variable"><span class="hljs-variable">$PROGRAMFILES</span></span>\<span class="hljs-variable"><span class="hljs-variable">${APP_NAME}</span></span> VIProductVersion <span class="hljs-variable"><span class="hljs-variable">${APP_VERSION}</span></span> VIAddVersionKey <span class="hljs-string"><span class="hljs-string">"ProductName"</span></span> <span class="hljs-variable"><span class="hljs-variable">${APP_NAME}</span></span> VIAddVersionKey <span class="hljs-string"><span class="hljs-string">"Comments"</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> VIAddVersionKey <span class="hljs-string"><span class="hljs-string">"CompanyName"</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> VIAddVersionKey <span class="hljs-string"><span class="hljs-string">"LegalTrademarks"</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> VIAddVersionKey <span class="hljs-string"><span class="hljs-string">"LegalCopyright"</span></span> <span class="hljs-string"><span class="hljs-string">"¬© "</span></span> VIAddVersionKey <span class="hljs-string"><span class="hljs-string">"FileDescription"</span></span> <span class="hljs-variable"><span class="hljs-variable">${APP_NAME}</span></span> VIAddVersionKey <span class="hljs-string"><span class="hljs-string">"FileVersion"</span></span> <span class="hljs-variable"><span class="hljs-variable">${APP_VERSION}</span></span> !define MUI_ABORTWARNING !insertmacro MUI_PAGE_WELCOME !insertmacro MUI_PAGE_COMPONENTS !insertmacro MUI_PAGE_DIRECTORY !insertmacro MUI_PAGE_INSTFILES !insertmacro MUI_PAGE_FINISH !insertmacro MUI_UNPAGE_WELCOME !insertmacro MUI_UNPAGE_CONFIRM !insertmacro MUI_UNPAGE_INSTFILES !insertmacro MUI_UNPAGE_FINISH !insertmacro MUI_LANGUAGE <span class="hljs-string"><span class="hljs-string">"Russian"</span></span> Section <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${APP_NAME}</span></span></span><span class="hljs-string"> (required)"</span></span> SetOutPath <span class="hljs-variable"><span class="hljs-variable">$INSTDIR</span></span> File <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${APP_NAME}</span></span></span><span class="hljs-string">.exe"</span></span> WriteUninstaller <span class="hljs-string"><span class="hljs-string">"uninstall.exe"</span></span> SectionEnd Section <span class="hljs-string"><span class="hljs-string">"Uninstall"</span></span> Delete <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$INSTDIR</span></span></span><span class="hljs-string">\*.*"</span></span> Delete <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SMPROGRAMS</span></span></span><span class="hljs-string">\${APP_NAME}\*.*"</span></span> Delete <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESKTOP</span></span></span><span class="hljs-string">\${APP_NAME}.lnk"</span></span> RMDir <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SMPROGRAMS</span></span></span><span class="hljs-string">\${APP_NAME}"</span></span> RMDir <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$INSTDIR</span></span></span><span class="hljs-string">"</span></span> SectionEnd Section <span class="hljs-string"><span class="hljs-string">"Start Menu and Desktop Shortcuts"</span></span> CreateDirectory <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SMPROGRAMS</span></span></span><span class="hljs-string">\${APP_NAME}"</span></span> CreateShortCut <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SMPROGRAMS</span></span></span><span class="hljs-string">\${APP_NAME}\Uninstall.lnk"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$INSTDIR</span></span></span><span class="hljs-string">\uninstall.exe"</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$INSTDIR</span></span></span><span class="hljs-string">\uninstall.exe"</span></span> 0 CreateShortCut <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESKTOP</span></span></span><span class="hljs-string">\${APP_NAME}.lnk"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$INSTDIR</span></span></span><span class="hljs-string">\${APP_NAME}.exe"</span></span> SectionEnd</code> </pre><br>  And instead of manually setting the constants! Define, we use the transfer of the constants APP_NAME and APP_VERSION to the makensis.exe utility.  This is done by the SetupBuild.rb script, which takes the name of the compiled binary file as input: <br><pre> <code class="bash hljs">C:\Ruby193\bin\ruby SetupBuild.rb MyApp.exe</code> </pre><br>  For example, if after compiling MyApp.exe it had APP_VERSION_S = "1.0.29.2", then the script will request the string version from the file attributes and, if successful, will create the installation file MyApp-1.0.29.2.exe, otherwise the log file from NSIS will be opened notepad. <br><br>  SetupBuild.rb source code: <br><pre> <code class="ruby hljs">NSIS_MAKE = <span class="hljs-string"><span class="hljs-string">'"C:\Program Files (x86)\NSIS\makensis.exe"'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'win32ole'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">versionOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fname)</span></span></span></span> fso = WIN32OLE.new(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fso.GetFileVersion(fname) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg)</span></span></span></span> fso = WIN32OLE.new(<span class="hljs-string"><span class="hljs-string">"WScript.Shell"</span></span>) fso.Popup msg <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> SRC_FNAME = File::expand_path(ARGV[<span class="hljs-number"><span class="hljs-number">0</span></span>]) APP_NAME = File::basename(SRC_FNAME, <span class="hljs-string"><span class="hljs-string">'.*'</span></span>) params = Hash.new params[<span class="hljs-string"><span class="hljs-string">'APP_NAME'</span></span>] = APP_NAME params[<span class="hljs-string"><span class="hljs-string">'APP_VERSION'</span></span>] = versionOf(SRC_FNAME) params[<span class="hljs-string"><span class="hljs-string">'SETUP_NAME'</span></span>] = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{APP_NAME}</span></span></span><span class="hljs-string">-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{params[</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'APP_VERSION'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">.exe"</span></span> <span class="hljs-comment"><span class="hljs-comment"># /D        NSIS ( !define) cmd = params.map{|key, val| "/D#{key}=#{val}"}.join(" ") LOG_FNAME = "#{APP_NAME}_#{$0}.log" r = system("#{NSIS_MAKE} #{cmd} #{APP_NAME}.nsi &gt; #{LOG_FNAME}") if r File::delete(LOG_FNAME) else system('notepad', LOG_FNAME) end</span></span></code> </pre><br><br><h4>  Using </h4><br>  The test SVN project at Visual Studio 2008 is <a href="https://ruby-nsis.googlecode.com/svn/trunk">here</a> . <br><br>  To install required: <br><ul><li>  <a href="http://nsis.sourceforge.net/Download">NSIS</a> </li><li>  <a href="http://rubyinstaller.org/downloads/">Ruby</a> (default installation paths were used) </li></ul><br>  For release in Project-&gt; Properties-&gt; Build Events-&gt; Pre-Build Event-&gt; Command Line is set <br><pre> <code class="bash hljs">C:\Ruby193\bin\ruby <span class="hljs-string"><span class="hljs-string">"..\src\VersionBuild.rb"</span></span> <span class="hljs-string"><span class="hljs-string">"..\src\VersionInfo.h"</span></span> SubWCRev.exe .. <span class="hljs-string"><span class="hljs-string">"..\src\VersionInfo.h"</span></span> <span class="hljs-string"><span class="hljs-string">"..\src\VersionInfo.h"</span></span></code> </pre><br>  When running setup \ SetupBuild.bat with contents <br><pre> <code class="bash hljs">C:\Ruby193\bin\ruby SetupBuild.rb MyApp.exe</code> </pre><br>  The setup file MyApp-1.0.xyexe will be generated, where x is the SVN version number, y is the sequential number of the compilation. <br><br>  If you place SetupBuild.bat in the Post-Build Event, the installer will be built at each recompilation. </div><p>Source: <a href="https://habr.com/ru/post/157197/">https://habr.com/ru/post/157197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157177/index.html">Is there a future for OpenOffice?</a></li>
<li><a href="../157179/index.html">The local learning rate of neuron weights in the back-propagation error algorithm</a></li>
<li><a href="../157181/index.html">Curiosity made a self portrait</a></li>
<li><a href="../157187/index.html">Compatibility with habra editor for MODx Evo</a></li>
<li><a href="../157193/index.html">Independent developer makes a remake of Descent</a></li>
<li><a href="../157199/index.html">PDF generation on the server in Ruby</a></li>
<li><a href="../157203/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, number 3 (10/20/2012 - 11/02/2012)</a></li>
<li><a href="../157205/index.html">The effectiveness of automatic application testing</a></li>
<li><a href="../157207/index.html">Ping-flooding attack using WinPcap</a></li>
<li><a href="../157211/index.html">Indication of the subscriber's status in the queue on the phone with BLF buttons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>