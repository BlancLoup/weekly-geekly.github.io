<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Habra Illumination or Experiments in an Isolated Python Environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Test the latest version of your favorite framework. Run an application with a specific set of libraries. Install the necessary libraries in the list o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Habra Illumination or Experiments in an Isolated Python Environment</h1><div class="post__text post__text-html js-mediator-article"> Test the latest version of your favorite framework.  Run an application with a specific set of libraries.  Install the necessary libraries in the list of dependencies.  How to solve all these tasks without affecting the system files?  This article focuses on virutalenv and pip utilities. <br><a name="habracut"></a><br>  The vitrualenv utility is designed to create isolated Python environments.  An environment is the interpreter itself and a set of libraries for it.  The pip utility organically complements easy_install, making installation of packages even easier.  Detailed information about all the utilities that virutalenv and pip give a developer, you can find out by visiting the pages <a href="http://pypi.python.org/pypi/virtualenv">pypi.python.org/pypi/virtualenv</a> and <a href="http://pypi.python.org/pypi/pip">pypi.python.org/pypi/pip</a> .  I will show by example how all this can be used to experiment with projects in the Python language. <br><br>  The essence of this project is very simple.  This small console program named hl.py will color the source code of the scripts to be inserted into the habratopic.  Through the command line, it takes the path to the file with the source code and the language, and in response prints the desired html code.  For example, she paints herself like this: <br><pre> <code class="hljs sql">$ ./ht.py ./hl.py python Traceback (most recent <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">last</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">File</span></span> <span class="hljs-string"><span class="hljs-string">"./hl.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>&gt; pkg_resources.require(<span class="hljs-string"><span class="hljs-string">'lxml==2.2.2'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">File</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/lib/python2.6/dist-packages/pkg_resources.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">626</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> require needed = self.resolve(parse_requirements(requirements)) <span class="hljs-keyword"><span class="hljs-keyword">File</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/lib/python2.6/dist-packages/pkg_resources.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">524</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> DistributionNotFound(req) <span class="hljs-comment"><span class="hljs-comment"># XXX put more info here pkg_resources.DistributionNotFound: lxml==2.2.2</span></span></code> </pre> <br>  Oops, does not work.  The message indicates that the lxml distribution kit of version 2.2.2 is not installed.  Let's see what is in Ubuntu: <br> <code>$ apt-cache show python-lxml | grep -E ^Version <br> Version: 2.1.5-1ubuntu2 <br></code> <br>  There really is something similar, but definitely not the version that this program requires.  And how do you know what lxml is?  We use the yolk utility (http://pypi.python.org/pypi/yolk). <br> <code>$ yolk -f summary -M lxml <br> bash: yolk:    <br> $ apt-cache search yolk <br> $</code> <br>  Why didn't the Ubuntu developers make a package for such a useful utility? ... <br><br>  However, this is not a problem.  We have the opportunity to make our own Python environment that does not depend on the quirks of the creators of the distribution of the operating system.  Save the following script as vipsetup and make it executable: <br><pre> <code class="hljs mel">#!/bin/sh # Setup virtual environment <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> and pip # Usage: # vipsetup [directory] ENV_DIR=<span class="hljs-string"><span class="hljs-string">"$1"</span></span> VIRTUALENV_BIN=<span class="hljs-string"><span class="hljs-string">'virtualenv'</span></span> VIRTUALENV_ARGS=<span class="hljs-string"><span class="hljs-string">'--no-site-packages'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ ! -f $ENV_DIR/bin/activate ]; then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ! type <span class="hljs-string"><span class="hljs-string">"$VIRTUALENV_BIN"</span></span>; then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ! type <span class="hljs-string"><span class="hljs-string">"easy_install"</span></span>; then echo <span class="hljs-string"><span class="hljs-string">"Error: easy_install executable not found."</span></span> echo <span class="hljs-string"><span class="hljs-string">"To install easy_install type:"</span></span> echo <span class="hljs-string"><span class="hljs-string">" sudo apt-get install python-setuptools"</span></span> exit <span class="hljs-number"><span class="hljs-number">1</span></span> fi TMPDIR=<span class="hljs-string"><span class="hljs-string">`mktemp -d -t ve.XXXXXXXXXX`</span></span> || exit <span class="hljs-number"><span class="hljs-number">1</span></span> PYTHONPATH=$TMPDIR easy_install --install-dir=$TMPDIR virtualenv || exit <span class="hljs-number"><span class="hljs-number">1</span></span> PYTHONPATH=$TMPDIR $TMPDIR/virtualenv <span class="hljs-string"><span class="hljs-string">"$@"</span></span> $VIRTUALENV_ARGS || exit <span class="hljs-number"><span class="hljs-number">1</span></span> rm -rf $TMPDIR <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $VIRTUALENV_BIN <span class="hljs-string"><span class="hljs-string">"$@"</span></span> $VIRTUALENV_ARGS || exit <span class="hljs-number"><span class="hljs-number">1</span></span> fi fi <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ ! -e $ENV_DIR/bin/pip ]; then $ENV_DIR/bin/easy_install pip || exit <span class="hljs-number"><span class="hljs-number">1</span></span> fi echo <span class="hljs-string"><span class="hljs-string">""</span></span> echo <span class="hljs-string"><span class="hljs-string">"Installation complete"</span></span> echo <span class="hljs-string"><span class="hljs-string">"* To activate virtual environment type:"</span></span> echo <span class="hljs-string"><span class="hljs-string">" . $ENV_DIR/bin/activate"</span></span> echo <span class="hljs-string"><span class="hljs-string">"* To install python package type:"</span></span> echo <span class="hljs-string"><span class="hljs-string">" $ENV_DIR/bin/pip install &lt;package&gt;"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"$PIP_DOWNLOAD_CACHE"</span></span> ]; then echo <span class="hljs-string"><span class="hljs-string">"* To enable cache for downloads"</span></span> echo <span class="hljs-string"><span class="hljs-string">" set environment variable PIP_DOWNLOAD_CACHE with a path"</span></span> fi</code> </pre> <br>  Create a new isolated environment using the commands: <br> <code>$ mkdir -p /tmp/testenv <br> $ cd /tmp/testenv <br> $ vipsetup . <br> $ . /bin/activate <br> (testenv) $ <br></code> <br>  Now install yolk using the pip command: <br> <code>(testenv) $ pip install yolk <br> ... <br> (testenv) $ yolk -f summary -M lxml <br> summary: Powerful and Pythonic XML processing library combining libxml2/libxslt with the ElementTree API. <br></code> <br>  Here is a description.  Install the required lxml version: <br> <code>(testenv) $ pip install lxml==2.2.2 <br></code> <br>  Now, everything is ready to run our program: <br> <code>(testenv) $ ./hl.py ./hl.py python <br> <font color="#808080">#!/usr/bin/env python</font> &lt;br&gt; <font color="#ff7700">import</font> pkg_resources&lt;br&gt; <br> pkg_resources. <font>require</font> <font>(</font> <font color="#483d8b">'lxml==2.2.2'</font> <font>)</font> &lt;br&gt; <br> &lt;br&gt; <font color="#ff7700">from</font> lxml. <font>html</font> <font color="#ff7700">import</font> parse, submit_form, tostring&lt;br&gt; <br> &lt;br&gt; <font color="#ff7700">def</font> highlight <font>(</font> <font color="#dc143c">code</font> , language <font>)</font> :&lt;br&gt; <br> SERVICE = <font color="#483d8b">'http://highlight.hohli.com/'</font> &lt;br&gt; <br> doc = parse <font>(</font> SERVICE <font>)</font> &lt;br&gt; <br> form = doc. <font>getroot</font> <font>(</font> <font>)</font> . <font>forms</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> &lt;br&gt; <br> form. <font>fields</font> <font>[</font> <font color="#483d8b">'language'</font> <font>]</font> = language&lt;br&gt; <br> form. <font>fields</font> <font>[</font> <font color="#483d8b">'use_font'</font> <font>]</font> = <font color="#ff4500">1</font> <font color="#808080"># for habrahabr</font> &lt;br&gt; <br> form. <font>fields</font> <font>[</font> <font color="#483d8b">'code'</font> <font>]</font> = <font color="#dc143c">code</font> &lt;br&gt; <br> form. <font>action</font> = form. <font>action</font> <font color="#ff7700">or</font> form. <font>base_url</font> <font color="#808080"># hack</font> &lt;br&gt; <br> ans = parse <font>(</font> submit_form <font>(</font> form <font>)</font> <font>)</font> &lt;br&gt; <br> highlited = ans. <font>getroot</font> <font>(</font> <font>)</font> . <font>cssselect</font> <font>(</font> <font color="#483d8b">'.source .src'</font> <font>)</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> &lt;br&gt; <br> <font color="#ff7700">return</font> <font color="#483d8b">''</font> . <font>join</font> <font>(</font> <font>[</font> tostring <font>(</font> x <font>)</font> <font color="#ff7700">for</font> x <font color="#ff7700">in</font> highlited <font>]</font> &lt;br&gt; <br> <font>)</font> . <font>replace</font> <font>(</font> <font color="#483d8b">'0&lt;/font&gt;'</font> , <font color="#483d8b">'0 &lt;/font&gt;'</font> <font color="#808080"># fix habrahabr</font> &lt;br&gt; <br> <font>)</font> . <font>replace</font> <font>(</font> <font color="#483d8b">'blockquote&gt;'</font> , <font color="#483d8b">'code&gt;'</font> <font>)</font> <font color="#808080"># fix format</font> &lt;br&gt; <br> &lt;br&gt; <font color="#ff7700">if</font> __name__ == <font color="#483d8b">"__main__"</font> :&lt;br&gt; <br> <font color="#ff7700">import</font> <font color="#dc143c">sys</font> &lt;br&gt; <br> <font color="#ff7700">def</font> main <font>(</font> <font color="#66cc66">*</font> args, <font color="#66cc66">**</font> kwargs <font>)</font> :&lt;br&gt; <br> fh = <font color="#dc143c">sys</font> . <font>stdin</font> <font color="#ff7700">if</font> args <font>[</font> <font color="#ff4500">0</font> <font>]</font> == <font color="#483d8b">'-'</font> <font color="#ff7700">else</font> <font color="#008000">file</font> <font>(</font> args <font>[</font> <font color="#ff4500">0</font> <font>]</font> <font>)</font> &lt;br&gt; <br> language = args <font>[</font> <font color="#ff4500">1</font> <font>]</font> &lt;br&gt; <br> <font color="#dc143c">code</font> = <font color="#008000">unicode</font> <font>(</font> fh. <font>read</font> <font>(</font> <font>)</font> <font>)</font> &lt;br&gt; <br> <font color="#ff7700">print</font> highlight <font>(</font> <font color="#dc143c">code</font> , language <font>)</font> &lt;br&gt; <br> <font color="#ff7700">return</font> <font color="#ff4500">0</font> &lt;br&gt; <br> <font color="#dc143c">sys</font> . <font>exit</font> <font>(</font> main <font>(</font> <font color="#66cc66">*</font> <font color="#dc143c">sys</font> . <font>argv</font> <font>[</font> <font color="#ff4500">1</font> : <font>]</font> <font>)</font> <font>)</font> &lt;br&gt; <br></code> <br>  Here it is, all so colorful.  Enjoy.  :) And write down somewhere a list of dependencies, as a keepsake: <br> <code><font color="#7a0874">(</font> testenv <font color="#7a0874">)</font> $ pip freeze <font color="#000000">|</font> <font color="#c20cb9">tee</font> requirements.txt&lt;br&gt; <br> lxml==2.2.2 <br> wsgiref==0.1.2 <br> yolk==0.4.1 <br></code> <br>  If necessary, quickly restore using the command: <br> <code>(testenv) $ pip install -r requirements.txt <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PS: if the practical utility of this experiment seemed doubtful to you, do: <br> <code>(testenv) $ deactivate <br> $ rm -rf /tmp/testenv <br></code>  and we will assume that there was nothing.  ;) <br></div><p>Source: <a href="https://habr.com/ru/post/70353/">https://habr.com/ru/post/70353/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70346/index.html">First Moscow Startup Weekend</a></li>
<li><a href="../70348/index.html">How big and diverse is our IT world! /?</a></li>
<li><a href="../70349/index.html">Emulation of old (and not only) consoles on GNU / Linux</a></li>
<li><a href="../70351/index.html">Google Chrome Frame - HTML5 for IE users</a></li>
<li><a href="../70352/index.html">Spree 0.9.0 released</a></li>
<li><a href="../70354/index.html">Firestarter! Part # 1 White Hat</a></li>
<li><a href="../70355/index.html">Online Store on Google App Engine (UPD: 1/20/2010)</a></li>
<li><a href="../70356/index.html">Google SketchUp 7.1</a></li>
<li><a href="../70359/index.html">Posting to Twitter links to the topic Habrahabra</a></li>
<li><a href="../70360/index.html">Change the password of the root or any other account in Mac OS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>