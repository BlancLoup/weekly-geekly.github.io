<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic staircase lighting with Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! In this post I want to share with the habro community about how I happened to make an automatic staircase lighting in my two-story cottage. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic staircase lighting with Arduino</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/00a/36b/690/00a36b69099bb1719b178dfa5b6941c1.jpg" align="left">  Good day!  In this post I want to share with the habro community about how I happened to make an automatic staircase lighting in my two-story cottage.  I will begin with a small sad retreat. <br>  About four months ago, returning from work in complete darkness, I did not slip well and broke two metatarsal bones (fingers) on my left foot.  For a whole month I had to fall in bed, as stepping on my foot was incredibly painful.  Then he was limp without a plaster for another half month (those who had fractures would immediately understand me).  After this sad story, I began to think about the automation of staircase lighting.  After playing a little with search queries, I found a very simple solution for myself on this <a href="http://www.thekanes.org/projects/automated-led-stairs-howto">blog</a> , just based on my favorite Arduino microcontroller.  The scheme did not cause any difficulties, but it scared the number and length of the wires that I had to mount.  Before that, I did not do anything like that.  Buying ready-made solutions or hiring someone is expensive.  Within a month I ordered the necessary components and unhurriedly assembled it on my stairs in a few days.  Everyone who is interested in what came of it, welcome under the cut (careful traffic)! <br><a name="habracut"></a><br><h4>  Components </h4><br>  I will give an approximate cost of all the components that were used in the work.  Most of the components purchased in the shops of my city are therefore all in rubles. <br><table width="584"><tbody><tr><td>  <a href="http://www.ebay.com/itm/Pro-Mini-Atmega-168-5V-16MHz-your-project-Arduino-compatible-/280852829119%3Fpt%3DLH_DefaultDomain_0%26amp%3Bhash%3Ditem41642213bf">Arduino Pro Mini</a> </td><td>  300 r </td></tr><tr><td>  <a href="http://www.ebay.com/itm/New-Arduino-Ultrasonic-Module-HC-SR04-Distance-Sensor-New-condition%3Fitem%3D280778106586%26amp%3Bcmd%3DViewItem%26amp%3B_trksid%3Dp5197.m7%26amp%3B_trkparms%3Dalgo%253DLVI%2526itu%253DUCI%2526otn%253D3%2526po%253DLVI%2526ps%253D63%2526clkid%253D7916305586107749541">Ultrasonic Module HC-SR04 Distance Sensor</a> - 2 pcs </td><td>  230 r </td></tr><tr><td>  <a href="http://escor.ru/catalog/product/importnye_mic/m5450b7/">LED driver M5450</a> </td><td>  88 r </td></tr><tr><td>  <a href="http://escor.ru/catalog/product/importnye_mic/l78m05cv/">Voltage Regulator L78M05CV</a> </td><td>  26 r </td></tr><tr><td>  <a href="http://escor.ru/catalog/product/fotorezistory/fr_764/">Photoresistor FR-764</a> </td><td>  16 r </td></tr><tr><td>  Cable channel 20x10 mm - 10 M </td><td>  100 r </td></tr><tr><td>  Wire 2x0.12 - 100 M (with a margin for tapes) </td><td>  190 r </td></tr><tr><td>  Wire 4x0.12 - 20 M (for sensors) </td><td>  60 r </td></tr><tr><td>  <a href="http://escor.ru/catalog/product/smd_0603/lsp0603w15_white_30sm/">LED Strip LSP0603W15 White</a> - 17 pieces of 30 cm </td><td>  1020 r </td></tr><tr><td>  Small things: textolite 15x15 cm, ferric chloride, drill 0.9 mm, <br>  PLS pin connectors, BLS connectors, heat shrink tubing, <br>  capacitors and resistors </td><td>  200 r </td></tr><tr><td>  The power supply unit 12B (it is the case) from the Parus 4 alarm system </td><td>  Is free </td></tr></tbody></table><br><h4>  Prototype </h4><br>  I debugged the firmware for Arduino, like everything else, on a breadboard using ordinary LEDs. <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/P3VavirDJws%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhjihPalNQBzGTNpkAv7EBJnUJ8qmQ" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Scheme </h4><br>  With the help of the notorious environment for the design of <a href="http://en.wikipedia.org/wiki/Eagle_(program)">Eagle CAD</a> , <a href="">the author‚Äôs scheme</a> and a printed circuit board were improved.  Here I added a voltage regulator to 5 V, changed the sensors from 3-pin expensive <a href="http://www.parallax.com/tabid/768/ProductID/92/Default.aspx">Ping</a> to four-pin cheap <a href="http://www.ebay.com/itm/New-Arduino-Ultrasonic-Module-HC-SR04-Distance-Sensor-New-condition%3Fitem%3D280778106586%26amp%3Bcmd%3DViewItem%26amp%3B_trksid%3Dp5197.m7%26amp%3B_trkparms%3Dalgo%253DLVI%2526itu%253DUCI%2526otn%253D3%2526po%253DLVI%2526ps%253D63%2526clkid%253D7916305586107749541">HC-SR04</a> .  In order for the staircase lighting to work only in the dark, a Soviet photoresistor FR-764 was added to the circuit (you can also use another one). <br><br><img src="https://habrastorage.org/storage2/7f2/086/d3e/7f2086d3e069de909a56d182e259a883.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/468/ab2/280/468ab2280e4ad821777bc749cb699fed.jpg"><br><br><img src="https://habrastorage.org/storage2/db9/228/16d/db922816d5de621eb1ab6acd74a538db.jpg"><br><br><h4>  Sketch </h4><br>  The sketch uses a freely distributed <a href="http://code.google.com/p/arduino-m5451-current-driver/">library</a> for working with the LED driver <a href="http%253A%252F%252Fwww.grifo.com%252FPRESS%252FDOC%252FST%252FM5450_51.pdf%26amp%3Bei%3DqCCWT7bxBs2VOseD-dIN%26amp%3Busg%3DAFQjCNEVxGj1T8qkxwZWeCqFcJovk4fojg%26amp%3Bsig2%3D5JaQC5bYA4twzYDAmJKKkw">M5450</a> , as well as a <a href="http://iteadstudio.com/application-note/arduino-library-for-ultrasonic-ranging-module-hc-sr04/">library</a> for working with the ultrasonic range finder HC-SR04. <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">#include "lightuino3.h" #include "Ultrasonic.h" //     #define TRIG_PIN 12 #define ECHO_PIN 13 //     #define TRIG2_PIN 10 #define ECHO2_PIN 11 //   Ultrasonic OurModuleUp(TRIG_PIN, ECHO_PIN); //   Ultrasonic OurModuleDown(TRIG2_PIN, ECHO2_PIN); // pins 0, 1 used by Serial const unsigned char DataPin = 6; const unsigned char clockPin = 7; //    const long lightSpacing = 280; //    const long lightHold = 10000; //   const long pingReadDelay = 50; //      const float minBottomIn = 33.0f; const float minTopIn = minBottomIn; LightuinoSink sinks(clockPin, DataPin, 100, 4); boolean bClimbStarted = false; boolean bDescentStarted = false; int val; void setup() { Serial.begin(9600); pinMode(DataPin, OUTPUT); pinMode(clockPin, OUTPUT); delay(1000); sinks.set(0,0,0); } void loop() { val = analogRead(0); //    if (val&gt;=1020){ UltrasonicDownFire();//   if(bClimbStarted) { bClimbStarted = false; bDescentStarted = false; climbLightSequence(); } else { //    UltrasonicUpFire(); if(bDescentStarted) { bClimbStarted = false; bDescentStarted = false; descentLightSequence(); } } delay(pingReadDelay); } } //   void UltrasonicUpFire() { if((OurModuleUp.Ranging(INC) &lt; minTopIn) &amp;&amp; (OurModuleUp.Ranging(INC) &gt; 0)) { // Serial.println("Top sensor tripped."); bDescentStarted = true; } } //  ] void UltrasonicDownFire() { if((OurModuleDown.Ranging(INC) &lt; minTopIn) &amp;&amp; (OurModuleDown.Ranging(INC) &gt; 0)) { // Serial.println("Bottom sensor tripped."); bClimbStarted = true; } } void climbLightSequence(){ LedsOnDown(); } void LedsOnDown(){ // byte ledState[9]; for (int j=0;j&lt;9;j++) { ledState[j] = B00000000; } // for (int k=1;k&gt;=0;k--) { for (int j=8;j&gt;=1;j--) { ledState[k] = (ledState[k] &gt;&gt; 1) + 128; sinks.set(ledState); delay(lightSpacing); } } // delay(lightHold); // for (int k=1;k&gt;=0;k--) { for (int j=8;j&gt;=1;j--) { ledState[k] = (ledState[k] &gt;&gt; 1); sinks.set(ledState); delay(lightSpacing); } } delay(pingReadDelay); } void descentLightSequence(){ LedsOnUp(); } void LedsOnUp(){ // byte ledState[9]; for (int j=0;j&lt;9;j++) { ledState[j] = B00000000; } // for (int k=0;k&lt;=1;k++) { for (int j=0;j&lt;9;j++) { ledState[k]=(ledState[k] &lt;&lt; 1) + 1; sinks.set(ledState); delay(lightSpacing); } } delay(lightHold); for (int k=0;k&lt;=1;k++) { for (int j=0;j&lt;9;j++) { ledState[k]=(ledState[k] &lt;&lt; 1); sinks.set(ledState); delay(lightSpacing); } } delay(pingReadDelay); }</span></span></code> </pre> <br><h4>  A little bit about the installation </h4><br>  Since I have the simplest wooden staircase (without a landing board), the mounting of LED strips was carried out from the end of each step. <br><img src="http://habrastorage.org/storage2/7ed/b40/a1a/7edb40a1a0f5590c49708b719b4eee3e.jpg"><br><br>  The cable channel runs along the entire length with the wires laid and glued to liquid nails.  LED strips initially have a sticky side, they stick perfectly on the tree. <br><img src="http://habrastorage.org/storage2/113/f16/bdb/113f16bdb08475a725d0ec9c50a877f8.jpg"><br><br>  Sensors were installed at the beginning of each first step at the top and bottom of the stairs.  As a fastener, I used ordinary flush-mounted backing plates. <br><img src="http://habrastorage.org/storage2/952/9b6/7d7/9529b67d75a583d03a0b622d79946a84.jpg"><br><br>  A dead battery was thrown out of the case of the power supply unit for the alarm; our controller easily fitted into its place. <br><img src="http://habrastorage.org/storage2/a77/6f1/439/a776f14391559300c7dcae743425618b.jpg"><br><br>  The lid is in place.  Place the controller under the landing. <br><img src="http://habrastorage.org/storage2/ae7/4fd/9b5/ae74fd9b5bfc1318315d8a9f0ea710e5.jpg"><br><br><h4>  Result </h4><br>  In fact, the video does not reflect the real picture.  The staircase is lit much more beautiful and brighter. <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/tSw2xWd9zGQ%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhiScGtVx8JBk5_c53loKAfseasvAw" frameborder="0" allowfullscreen=""></iframe><br><br>  <a href="http://lukjanow.ru/%3Fdl_id%3D56">Download all the necessary files in one archive</a> <br><br>  <b>UPD!</b>  Slightly finalized the <a href="http://lukjanow.ru/2013/01/automatic-illumination-stairs-arduino-update/">scheme</a> .  Added support for PWM and high power LED strips. <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/eBius-KsbDU%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhgkHpFnKQdkyKwn_KfDAsg0pTqiIw" frameborder="0" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/cVy3zc9QzQY%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhj9WaAbg_NMZkA78fCZB2xHuvRZTw" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>Group</b> <a href="http://vk.com/ledstairs"><b></b></a><b><a href="http://vk.com/ledstairs">VKontakte vk.com/ledstairs</a> (photo, video)</b> </div><p>Source: <a href="https://habr.com/ru/post/142685/">https://habr.com/ru/post/142685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142672/index.html">ASP.NET MVC 3 server on Synology NAS - solution</a></li>
<li><a href="../142676/index.html">About approaches to comparing file versions</a></li>
<li><a href="../142677/index.html">Program, aport!</a></li>
<li><a href="../142680/index.html">Participation in Google Summer of Code 2012. Part One: Proposal Submission</a></li>
<li><a href="../142684/index.html">[Poll] Photoshop and Linux. Usage patterns</a></li>
<li><a href="../142688/index.html">The Habrahabr ribbon is now provided with the ‚ÄúAll‚Äù tab, and this tab contains not only blog entries, but also questions</a></li>
<li><a href="../142689/index.html">Knee monitoring</a></li>
<li><a href="../142690/index.html">How does a programmer think</a></li>
<li><a href="../142694/index.html">Droider Show # 37. Holivar, senseless and merciless</a></li>
<li><a href="../142696/index.html">Accessibility - OS test for people with disabilities (Part 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>