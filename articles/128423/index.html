<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple synthesizer for Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 Two weeks ago, I purchased the Arduino Duemilanove. I flashed a LED, played with LCD, and then through the list from the Examples folder. He...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple synthesizer for Arduino</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/3d07ba4f/ad4dcdcb/7a89f9a0/32f955d9.jpg"><br><br>  Hello. <br><br>  Two weeks ago, I purchased the Arduino Duemilanove.  I flashed a LED, played with LCD, and then through the list from the Examples folder.  He stopped at the standard example of <a href="http://www.arduino.cc/en/Tutorial/Melody">Play Melody</a> and decided to develop it a bit.  I‚Äôll say at once that I‚Äôm a teapot in creating and processing sound, therefore the terms and effects for the future synthesizer (if you can call it that) are invented in the process. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Functions </h4><br><img src="https://habrastorage.org/storage1/af063ef4/3c00787c/3925b788/a32ba42b.jpg"><br><br><h5>  Keys </h5><br>  Only four keys with a difference of about 130 Hz, the frequency increases from left to right.  More buttons were not at hand, I used small ones that came with Arduino. <br><br><h5>  Effect </h5><br>  This button changes the frequency multiplier function.  The function changes with a given step and at a given interval, and even if the key is not clamped, the effect will continue.  For example, if you select the function X * X (where X changes from 0 to 1) you get something like a disco-shot.  So far there are only three effects in the code: sin (x) (0; 3.14), x * x (0; 1), 1-x (0; 1). <br><br><h5>  Record </h5><br>  Everything is simple here, at each iteration we write the frequency value to the array, and when the array is full, we reproduce its values ‚Äã‚Äãin a loop.  True, playing against the background of the received ‚Äúsample‚Äù does not work, playing the keys creates an additional delay and it slows down a lot (whoever has a solution, I will be glad).  Later added a LED next to the button that glows while recording. <br><br><h5>  Bit </h5><br>  Changes the gap between the individual double signals and the width of the signals.  If you hold down the key and twist B, the sound is similar to the gradual stopping of the jumping ball and vice versa. <br><br><h5>  Frequency </h5><br>  Changes the intervals between individual signals. <br><br><h4>  Scheme </h4><br>  Six buttons, two potentiometers, a speaker and a LED + Arduino.  The speaker and buttons are connected in succession to the digital inputs 2, 3, 4, 5, 6, 7, 8, LED to 13;  potentiometers to analog inputs 0 and 1; <br><br><h4>  Code </h4><br><pre><code class="hljs vbscript">#include &lt;Math.h&gt; float M=<span class="hljs-number"><span class="hljs-number">1</span></span>; float x=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> F,N,i,pl,d1,d2,d3,d4,d5,d6; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> eff=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> limit=<span class="hljs-number"><span class="hljs-number">0</span></span>; float st; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> arr[<span class="hljs-number"><span class="hljs-number">700</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> rec=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> buf=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> beat=<span class="hljs-number"><span class="hljs-number">0</span></span>; void play(<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> F,<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> N, float M){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;N/<span class="hljs-number"><span class="hljs-number">50</span></span>;i++){ digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, HIGH); delayMicroseconds((F+<span class="hljs-number"><span class="hljs-number">1000</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>*M); digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, LOW); delayMicroseconds((F+<span class="hljs-number"><span class="hljs-number">1000</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>*M); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(N!=<span class="hljs-number"><span class="hljs-number">50</span></span>){ delay(N*<span class="hljs-number"><span class="hljs-number">0.1</span></span>); } } void button(<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> num){ F-=<span class="hljs-number"><span class="hljs-number">150</span></span>*(num<span class="hljs-number"><span class="hljs-number">-1</span></span>); pl=<span class="hljs-number"><span class="hljs-number">1</span></span>; eff=buf; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(eff!=<span class="hljs-number"><span class="hljs-number">0</span></span>){ x=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rec==<span class="hljs-number"><span class="hljs-number">1</span></span>){ arr[<span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>]=F+<span class="hljs-number"><span class="hljs-number">1000</span></span>; } } void setup() { pinMode(<span class="hljs-number"><span class="hljs-number">8</span></span>, INPUT); pinMode(<span class="hljs-number"><span class="hljs-number">7</span></span>, INPUT); pinMode(<span class="hljs-number"><span class="hljs-number">6</span></span>, INPUT); pinMode(<span class="hljs-number"><span class="hljs-number">5</span></span>, INPUT); pinMode(<span class="hljs-number"><span class="hljs-number">4</span></span>, INPUT); pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, INPUT); pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, OUTPUT); pinMode(<span class="hljs-number"><span class="hljs-number">13</span></span>, OUTPUT); } void <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { F = analogRead(A0); N = analogRead(A1); d1 = digitalRead(<span class="hljs-number"><span class="hljs-number">3</span></span>); d2 = digitalRead(<span class="hljs-number"><span class="hljs-number">4</span></span>); d3 = digitalRead(<span class="hljs-number"><span class="hljs-number">5</span></span>); d4 = digitalRead(<span class="hljs-number"><span class="hljs-number">6</span></span>); d5 = digitalRead(<span class="hljs-number"><span class="hljs-number">7</span></span>); d6 = digitalRead(<span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x&gt;limit){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buf&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>){ buf=eff; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { buf=<span class="hljs-number"><span class="hljs-number">0</span></span>; } eff=<span class="hljs-number"><span class="hljs-number">0</span></span>; x=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rec==<span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>++; arr[<span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>]=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pl==<span class="hljs-number"><span class="hljs-number">0</span></span>){ delayMicroseconds(F); } digitalWrite(<span class="hljs-number"><span class="hljs-number">13</span></span>, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rec==<span class="hljs-number"><span class="hljs-number">2</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>++; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(eff==<span class="hljs-number"><span class="hljs-number">0</span></span>){ pl=<span class="hljs-number"><span class="hljs-number">0</span></span>; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ x+=st; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(N&lt;<span class="hljs-number"><span class="hljs-number">50</span></span>){ N=<span class="hljs-number"><span class="hljs-number">50</span></span>; eff=buf; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d1==<span class="hljs-number"><span class="hljs-number">1</span></span>){ button(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d2==<span class="hljs-number"><span class="hljs-number">1</span></span>){ button(<span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d3==<span class="hljs-number"><span class="hljs-number">1</span></span>){ button(<span class="hljs-number"><span class="hljs-number">3</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d4==<span class="hljs-number"><span class="hljs-number">1</span></span>){ button(<span class="hljs-number"><span class="hljs-number">4</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d5==<span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buf&gt;<span class="hljs-number"><span class="hljs-number">3</span></span>){ buf=<span class="hljs-number"><span class="hljs-number">0</span></span>; } eff=buf; eff++; pl=<span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d6==<span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rec==<span class="hljs-number"><span class="hljs-number">0</span></span>){ rec=<span class="hljs-number"><span class="hljs-number">1</span></span>; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rec==<span class="hljs-number"><span class="hljs-number">2</span></span>){ rec=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rec==<span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; arr[<span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>]!=<span class="hljs-number"><span class="hljs-number">0</span></span>){ play(arr[<span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>],N,<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pl==<span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(eff==<span class="hljs-number"><span class="hljs-number">0</span></span>){ play(F,N,<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(eff==<span class="hljs-number"><span class="hljs-number">1</span></span>){ limit=<span class="hljs-number"><span class="hljs-number">3.14</span></span>; st=<span class="hljs-number"><span class="hljs-number">0.025</span></span>; M=<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(x); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(eff==<span class="hljs-number"><span class="hljs-number">2</span></span>){ limit=<span class="hljs-number"><span class="hljs-number">1.2</span></span>; st=<span class="hljs-number"><span class="hljs-number">0.01</span></span>; M=x*x; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(eff==<span class="hljs-number"><span class="hljs-number">3</span></span>){ limit=<span class="hljs-number"><span class="hljs-number">1</span></span>; st=<span class="hljs-number"><span class="hljs-number">0.025</span></span>; M=x+<span class="hljs-number"><span class="hljs-number">0.5</span></span>; } play(F,N,M); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rec==<span class="hljs-number"><span class="hljs-number">1</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>&gt;<span class="hljs-number"><span class="hljs-number">698</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; rec=<span class="hljs-number"><span class="hljs-number">2</span></span>; digitalWrite(<span class="hljs-number"><span class="hljs-number">13</span></span>, LOW); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>&gt;<span class="hljs-number"><span class="hljs-number">698</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">timer</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><h4>  Housing </h4><br><img src="https://habrastorage.org/storage1/f4f24b8f/a2cf6253/a3244a04/7e048093.jpg"><br><br>  Since this does not pretend to a finished device, I made a cardboard case, assembled the circuit on the breadboard and placed it inside.  Soldering iron remained untouched. <br><br><h4>  Improvements </h4><br>  An obvious improvement in keys is to connect a keyboard, where each key changes resistance to a single analog input.  You can add a mini-jack output for recording directly to a computer or connecting to an amplifier, make up a whole library of effects ... the list is limited by your imagination. </div><p>Source: <a href="https://habr.com/ru/post/128423/">https://habr.com/ru/post/128423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128416/index.html">Game developers will gather in Dnepropetrovsk on Ciklum Game Developers Saturday</a></li>
<li><a href="../128417/index.html">HTC Sensation XE with Beats Audio for the most demanding</a></li>
<li><a href="../128419/index.html">AMD Bulldozer New World Record Overclocking Processors</a></li>
<li><a href="../128420/index.html">Installing FreeBSD 9.0-BETA2 as DomU in PV mode</a></li>
<li><a href="../128422/index.html">Twitter bot on C #</a></li>
<li><a href="../128424/index.html">Evernote extension for Chrome improved copying articles</a></li>
<li><a href="../128425/index.html">Itanium Poulson: what's new</a></li>
<li><a href="../128426/index.html">Master Part Chart with Highcharts and jQuery UI</a></li>
<li><a href="../128427/index.html">How to stop worrying and start working?</a></li>
<li><a href="../128428/index.html">6 sad squids cuddle tenderly</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>