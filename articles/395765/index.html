<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Serious access control system on an unserious basis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! We want to tell a story about how we created the ACS (collected) almost from what was at hand. Namely, a microcontroller with a network interfa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Serious access control system on an unserious basis</h1><div class="post__text post__text-html js-mediator-article">  Hello!  We want to tell a story about how we created the ACS (collected) almost from what was at hand.  Namely, a microcontroller with a network interface, a pair of cheap Chinese readers, an rs232 tcp server, rs232 to rs485 interface converters, an Android tablet, and the turnstile itself (or rather, what remained of it after previous attempts to launch an ACS in the enterprise ‚Äî this mainly mechanical part). <br><br>  <i><b>The article contains a lot of pictures!</b></i> <br><br><img src="https://habrastorage.org/files/5f3/147/6c0/5f31476c0b9b42e0a1695a390819e617.jpg"><br><a name="habracut"></a><br>  Not so long ago, at one enterprise, the question arose of installing an ACS.  Prior to this, the enterprise had already attempted to introduce access systems, but over time the cards were lost, the equipment went down.  For some reason there was no proper maintenance.  And those who, say, controlled the very access to the territory, somehow resisted innovations and, in fact, simply pressed the lock button for those who forgot or lost the pass. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i><b>I just want to warn you that we are never professionals in electrical engineering, so in this article you can see a lot of ‚Äúpain‚Äù (especially for electronics) and not the best solutions.</b></i>  <i><b>Constructive criticism is welcome.</b></i> <br><br><h4>  Turnstile </h4><br>  The turnstile got us about here in this state.  In fact, there is only a mechanic;  the electrodes have survived the LEDs of the arrows, electromagnets with lock actuators and reed switches. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2e2/1d7/1c8/2e21d71c885f4301a69252081312bad3.jpg"></div><br><br>  To control the internal stuffing, such a circuit was assembled - these are transistor switches with a relay.  We need to control 2 green arrows with 2 red and 2 electromagnets to open the entrance or exit.  Total 4 keys, two of which include a green arrow and an electromagnet, the other two include red arrows (the turnstile has a normal state, all locks are closed). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3ec/997/811/3ec99781191642098363de56f35d6c71.jpg"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/171/ed9/0cb/171ed90cb4804ba0b79752982b3bc5bc.jpg"></div><br><br>  Yes, yes, I know - the ration is terrible. <br><br>  Placed the finished board in the body that came in size. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/eab/903/d01/eab903d01de44ce0b1d53c10fb0c6c26.jpg"></div><br><br><h4>  Controller </h4><br>  So, now the illumination and locks work for us, but someone has to manage this, receive signals from the reed switch when scrolling through the turntable.  To do this, we used the Ethernet module to control external circuits / loads and monitor / measure various parameters (voltage, temperature, etc.) over a local area network (LAN) <a href="http://kernelchip.ru/Jerome.php">Jerome</a> , which was bought for a long time for other purposes, but just gathering dust. <br><br>  A brief description of what it is: <br><ul><li>  Ethernet (LAN) control module </li><li>  Web interface </li><li>  I / O lines: 22 pieces </li><li>  Pulse counter: 4 pieces </li><li>  PWM output, USART, 4 x ADC </li><li>  Open TCP / IP command interface </li><li>  CAT System - Managed Event Response </li></ul><br><br><img src="https://habrastorage.org/files/9e8/db6/77c/9e8db677c0fd401eb53a626b4a11c450.jpg"><br><br>  At the time of the start of this project, we could go into the web interface and give a signal to the line where the LED could be connected, or as in our case, the transistor switch and, miracle! ‚ÄîThe LED is lit, the transistor switch is triggered, the relay clicks. <br><br>  By the way, this is how it looks like: <br><br><img src="https://habrastorage.org/files/bdd/b0f/300/bddb0f3002134c45a7d87f9596952c07.jpg"><br><br>  Lines can work, either at the entrance or at the exit. <br><br>  In order to improve the module, we placed the board in the case from the RJ45 socket. <br><br><img src="https://habrastorage.org/files/32d/88d/d5c/32d88dd5cb8a4f2e83c157ac4be135b1.jpg"><img src="https://habrastorage.org/files/b9a/468/fba/b9a468fbac6a418c9dd82980c6518774.jpg"><br><br>  Now it was necessary to organize the connection to the pins, here we are assisted by the same case from the Rj45 socket and the connectors themselves: <br><br><img src="https://habrastorage.org/files/143/781/ba5/143781ba50e8490a8b119e3825024447.jpg"><img src="https://habrastorage.org/files/740/5ec/9f0/7405ec9f007644a996b10b3aa3843688.jpg"><br><br>  As a result, in the second part of our improvised case for the module there are 2 RJ 45 connectors. Here, as if with an eye to the future, one to control the turnstile, the second to control the barrier or gate.  After assembly, we get just such a box with three Rj45 connectors and one power supply for the module.  It turned out compact and generally neat: <br><br><img src="https://habrastorage.org/files/f11/a55/fff/f11a55ffff1e4f7b8f440e425450d536.jpg"><img src="https://habrastorage.org/files/305/8fb/48a/3058fb48ac6544b48eb8dd8690e78134.jpg"><br><br><h4>  Reader </h4><br>  As mentioned above, the project was created from what was on hand and there was not much to choose from, so the cheap RFID reader 13.56Mhz rs232 was taken as the basis.  Initially, we wanted to make a classic - there is a separate reader on each side (entrance / exit), respectively, we read the card on reader No. 1 - it means we are entering the territory, counted on reader No. 2 - it means we are leaving the territory.  And here the question arose how to distinguish between readers?  Maybe he has some ID?  Connect read card analyze data, no, the reader transmits only the ID card.  It would seem that everything.  Looking for other readers?  But no, this is not our way.  First, we changed our mind to use two readers on each side and installed only one.  This means that the system now monitors where the visitor is located on or off the site.  The initial position is not on site.  In this embodiment, there are both disadvantages and advantages. <br><br>  <b>Minuses:</b> <br><ul><li>  you need to remember and store the position of the visitor </li><li>  it is impossible to go through two or more people on one map (or rather, you can, but the spinner will have to be scrolled several times, since the lock opens depending on the position of the visitor) <br></li></ul><br><br>  <b>Pros:</b> <br><ul><li>  you cannot pass on one card to two or more people (this is important when taking into account the ‚Äúworking time‚Äù) </li><li>  reader savings </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/969/f08/930/969f08930dc044c9ba0afc7211f6141d.png"></div><br><br>  During operation in this mode, we are faced with a problem.  Time records are kept for the employees of the customer‚Äôs company (came, left, how many were, how many were not).  In addition to employees of the customer‚Äôs company, there are a large number of tenant employees for them, time accounting is not needed.  And to account for time is important to take into account the direction of the transition. <br><br>  The ‚Äúsmartest‚Äù people tried to pass by several people with their passes (apparently, based on early experience in other companies), but this was not the case.  During the passage, the transition status ‚Äúon the territory‚Äù changed and upon the next reading the turnstile was already opened to the exit.  This introduced many into a stupor, had to explain, write ads, but there were those who understood, rotated the turnstile and read the card again and then passed.  But such a regime was perceived as hostile by angry remarks that the system was not working.  It is clear what consequences the passage did not lead through the checkpoint, in our case it is the gate that is open, and the people try to slip through, gaining problems for themselves at the checkpoint.  The decision was not long in coming, we are filtering employees by company and those who need to keep records, walk as expected, all the rest walk freely, both locks open for them regardless of the direction of the transition.  And the people began to walk in crowds on one card. <br><br><h4>  Guest Cards </h4><br>  Yes, there are maps for visitors in our system.  This card allows the visitor to enter the territory and exit.  And then the legitimate question arises: how to make it so that the cards do not go along with the visitor?  After all, security is not always in place (auto inspection, smoking, toilet, etc., etc.).  Naturally need a card reader, it's obvious to everyone.  But initially the idea was this - the second reader remained (saved), it was assumed that he would stand by the guard and at the exit the visitor would give the card to the guard in his hands, and he would read it on the reader, thereby releasing the visitor.  But, for the reasons already mentioned, we had to abandon such a regime.  Began to think how to solve this puzzle.  If you take a ready card reader, the price tag is very biting, even for a simple model.  But we make the access control system from what is on hand - do not forget about it!  They took a piece of plexiglass that was not transparent and glued together such a gutter. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6ca/0bf/31b/6ca0bf31b5174d9aa05e122b4eb466dd.jpg"></div><br><br>  The reader was attached to the bottom of the gutter.  The idea is that the visitor puts the card in the slot, it flies along the chute and, flying over the reader, is read.  Collected, tested - works.  This is what a ready-made "card reader" looks like (in the lower right part of the window). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c02/b40/94c/c02b4094c70642c9b834eba1bd2c8124.jpg"></div><br><br>  Naturally, everything is as it should be: the cards are folded in the tray. <br><br>  And this is how it looks from the outside: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/14a/8f0/b7f/14a8f0b7f3fa4f458c439f34728d7371.jpg"></div><br><br><div class="spoiler">  <b class="spoiler_title">Demonstration of the card reader</b> <div class="spoiler_text"><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/PTKPsrt0rBc%3Ffeature%3Doembed&amp;xid=25657,15700019,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj4HcQHmi0Iwfo3HNxOgTBAEpowWw" frameborder="0" allowfullscreen=""></iframe></div></div><br><br>  The only thing at the time of video recording there is no card tray yet. <br><br>  Oh yes.  I almost forgot.  How do we still distinguish between readers?  And let's see what is inside the creation of ‚ÄúCelestial‚Äù. <br>  Disassembled, nothing special.  Everything!  We definitely need readers who can transfer their ID.  But, ‚Äúthis is not our way‚Äù - we thought once again, and figured out how to distinguish between readers. <br><br><img src="https://habrastorage.org/files/d33/251/72f/d3325172f6724bc6bc8fadecc255256c.jpg"><br><br>  See the LED with three legs?  It is two-color, usually lights red, and when read it lights up green.  Resolved, take the signal from this LED. <br><br>  We assemble a simple circuit optocoupler + transistor.  What for?  About this is a long history, but this option has remained historically, did not begin to alter.  This scheme also lights up the LED.  as the original in the process out of order.  The essence of what?  Remember the jerome module?  It can be configured lines as the output and the input.  So we set up the necessary lines at the input, we connect the circuit to the corresponding pins and catch the incoming signal.  More precisely, Jerome himself will tell us when a signal appears on the line we need.  In this uncomplicated way, we distinguish readers. <br><br><img src="https://habrastorage.org/files/13e/3a7/25a/13e3a725afc94f89b0e5cd091b3b1d44.jpg"><img src="https://habrastorage.org/files/686/42c/071/68642c071cf14545b19233f747294fde.jpg"><br><br>  So, as the whole system we have is built on TCP technology, and readers rs232.  It was decided to use the rs232 / rs485 tcp server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/962/e4d/5ce/962e4d5cedfb40f58d772ccc0f633b2e.jpg"></div><br><br>  But bad luck - the rs232 connector is one, and there are two readers.  But there are still rs485, we recall the opunks that on rs485 you can "hang" many devices.  We do it our way, we buy interface converters rs232 to rs485 and connect in parallel, we read in turn - both readers work, hooray!  So all is well. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/365/1c2/b7c/3651c2b7c01348ceb45fb92081af41ac.jpg"></div><br><br>  The interior of the cabinet: <br><br><img src="https://habrastorage.org/files/0c7/608/834/0c76088348bf4087b9be157331743d8f.jpg"><br><br><h4>  The tablet </h4><br>  Finally, the center of our entire system is an Android tablet.  An application is written for him.  In this article, I will not describe the application, its work and the internal structure, as it draws on a separate article.  I will confine myself to photographs and video demonstration of the work.  If anyone is interested in Habr√©, we have already published two articles ( <a href="https://habrahabr.ru/post/283586/">one</a> , <a href="https://habrahabr.ru/post/302226/">two</a> ) on this project.  It describes the structural and dynamic models of access control.  Separately, it is worth mentioning that a bunch of <b><a href="http://cordova.apache.org/">Apache Cordova</a></b> , <b><a href="https://github.com/jxcore/jxcore-cordova">JXCore technologies</a></b> (this is the node.js for mobile platforms) and, well, without them, HTML and CSS were used to develop this application.  But we have cross-platform!  In our case, there are two versions of the application and both are working.  This is an Android version (basic) for Windows PCs.  That makes it possible in case of failure of either a tablet or a PC to quickly restore the work of the access control system. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/367/f35/8fc/367f358fce004da5b3781db3562c43e5.jpg"></div><br><br><div class="spoiler">  <b class="spoiler_title">Video demonstration of the application</b> <div class="spoiler_text"><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/HFEhE23wwaI%3Ffeature%3Doembed&amp;xid=25657,15700019,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgb1Q5eYQ28lDa6MyeqE_win6roPg" frameborder="0" allowfullscreen=""></iframe></div></div><br><br>  In general, in spite of so little practical experience in all areas that this project has affected, we managed to build an ACS that is actually implemented and works to this day on a real enterprise in real conditions.  Using at the same time not the best equipment and not the best solutions, and perhaps the best in this context.  Thank you for your attention we will be happy to answer questions. </div><p>Source: <a href="https://habr.com/ru/post/395765/">https://habr.com/ru/post/395765/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../395755/index.html">We measure the concentration of CO2 in the apartment with the help of MH-Z19</a></li>
<li><a href="../395757/index.html">Vinton Cerf - Columbus, who opened the Internet</a></li>
<li><a href="../395759/index.html">Hair, feathers and scales have a common ancestor.</a></li>
<li><a href="../395761/index.html">Other chess</a></li>
<li><a href="../395763/index.html">D-Link products are vulnerable</a></li>
<li><a href="../395767/index.html">When size is not important, the descendant of ToyRep is a 3D printer from China.</a></li>
<li><a href="../395769/index.html">"Sound factory": How to create a sound design for the movie</a></li>
<li><a href="../395771/index.html">It did happen: Putin signed the ‚ÄúSpring package.‚Äù Communication tariffs will grow 2-4 times</a></li>
<li><a href="../395773/index.html">Special project: Solar power station on autocamp. Part 2</a></li>
<li><a href="../395775/index.html">Sociable cars on the roads of the future</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>