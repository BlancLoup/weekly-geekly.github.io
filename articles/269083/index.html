<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rapid Java CRUD Development: Downshifting with 1C: Enterprise</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In connection with the latest events in the world arena and the depreciation of the national currency, for programmers, ‚Äú1C: Enterprise‚Äù has a difficu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rapid Java CRUD Development: Downshifting with 1C: Enterprise</h1><div class="post__text post__text-html js-mediator-article">  In connection with the latest events in the world arena and the depreciation of the national currency, for programmers, ‚Äú1C: Enterprise‚Äù has a difficult time.  Many are fired, and at the same time competition from newcomers is increasing, and quite a lot of them are appearing on the market - which you will not complain about, since working as a teacher in the training center at Moscow State Technical University.  Bauman, I myself put my hand to it, issuing evidence with a generous hand. <br><br>  At the same time, prospects for the development of other languages ‚Äã‚Äãare opening up, since work for a foreign customer has suddenly become profitable again.  Also, interest in open source software at all levels of the technological stack, and most of all, in ‚Äúimport-substituting‚Äù DBMSs like PostgreSQL, MySQL, has increased. <br><br>  Once again at the inter-project fork, I got some free time to talk about my experience in implementing several Java projects and what it was like after many years of development on 1C.  There is a sense to listen, if only because the number of views of a Java developer‚Äôs resume, according to my estimates, is now 5 times longer than the summary of 1Snik. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I want to share the example of 2 of my OpenSource projects laid out on GitHub: <br><br>  ‚Ññ1.  <a href="https://github.com/nikita1andreev/QuickDev">Implements the basic functionality of rapid development, available in 1C</a> . <br>  ‚Ññ2.  <a href="https://github.com/nikita1andreev/FlexReporting">It implements a report generation mechanism with user settings of the ‚Äúpivot table‚Äù type, a simplified analogue of the ACS (data composition system in 1C)</a> . <br><br>  For a start, on the first project. <a name="habracut"></a>  I started to create a database for one organization.  And very soon met with the first obstacles.  Not that mastering the banal CRUD was so difficult - I knew Java, but the matter was not in the language: I was born a vitruoz - a virtuoso and you die, even as Mussorgsky sang - you will not drink genius. <br><br>  But ... how to reach the previous development speed?  In small 1C projects, it is necessary to constantly modify the database, adding details, entities, and customer requirements often change as the game progresses.  And being a ‚Äúlazy 1Sniki‚Äù (c), I somehow got used to that by adding an entity or making changes to an entity, you can press 1 (one) button, after which the database will be restructured, the program will be started, and the changes can be seen in the form of a list , and in the form of an element independently generated by the platform.  If the requisite refers to a new directory, new forms of the list, the choice, the element will be automatically created for it. <br><br>  What can you say about Java ... In fact, you can add props to the class code - Eclipse allows you to create a getter and a setter in semi-automatic mode, and after the mentioned 1 button (F11), the database under ORM Hibernate will indeed be supplemented with a new table or a new column ( if you enable hibernate.hbm2ddl.auto = update, although many are against this approach, it‚Äôs clear that we‚Äôll turn it off at production). <br><br>  Let's take an example.  Suppose we had a class ‚ÄúContacts‚Äù, and we decided to add the ‚ÄúContact status‚Äù attribute to it, the list of which will be stored in a separate directory, which we should immediately give to the user to edit.  Then we make changes to the class (the changes are marked with ‚Äúpluses‚Äù, the getters and setters are created by Eclipse): <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  <a href="http://habrahabr.ru/users/entity/" class="user_link">Entity</a> <br>  <a href="http://habrahabr.ru/users/table/" class="user_link">Table</a> (name = "contacts") <br>  @Synonym (text = "Contacts") <br>  @Forms (element = "") <br>  public class Contacts implements java.io.Serializable { <br><br>  @Synonym (text = "Code") <br>  private int id; <br>  @Synonym (text = "Last Name") <br>  private string f; <br>  @Synonym (text = "Name") <br>  private String i; <br>  @Synonym (text = "Patronymic") <br>  private string o; <br>  @Synonym (text = ‚ÄúStatus‚Äù) // ++++++++++++++++++++++++++ <br>  private Contact_Status status;  // ++++++++++++++++++++++++++ <br>  @Synonym (text = "Address") <br>  private String address; <br>  @Synonym (text = "Phone") <br>  private String phone; <br>  @Synonym (text = "Other") <br>  private String description; <br><br>  public Contacts () { <br>  } <br><br>  public Contacts (int id, String f, String i, String o, <br>  Contact_Status status, // +++++++++++++++++++++++++++ <br>  String address, String phone, String description) { <br>  this.id = id; <br>  this.f = f; <br>  this.i = i; <br>  this.o = o; <br>  this.status = status;  // ++++++++++++++++++++++++++ <br>  this.address = address; <br>  this.phone = phone; <br>  this.description = description; <br>  } <br><br>  <a href="http://habrahabr.ru/users/id/" class="user_link">Id</a> <br>  @GeneratedValue (strategy = GenerationType.IDENTITY) <br>  @Column (name = "id") <br>  public int getId () { <br>  return this.id; <br>  } <br><br>  public void setId (int id) { <br>  this.id = id; <br>  } <br>  @Synonym (text = "Last Name") <br>  public String getF () { <br>  return this.f; <br>  } <br><br>  public void setF (String f) { <br>  this.f = f; <br>  } <br>  public String getI () { <br>  return this.i; <br>  } <br><br>  public void setI (String i) { <br>  this.i = i; <br>  } <br>  public String getO () { <br>  return this.o; <br>  } <br><br>  public void setO (String o) { <br>  this.o = o; <br>  } <br>  // {++++++++++++++++++++++++++ <br>  @ManyToOne (targetEntity = Contact_Status.class, cascade = {CascadeType.ALL} <br>  <a href="http://habrahabr.ru/users/notfound/" class="user_link">NotFound</a> (action = NotFoundAction.IGNORE) <br>  @JoinColumn (name = "contact_status", referencedColumnName = "id", nullable = true, insertable = false, updatable = true) <br>  // by Eclipse <br>  public Contact_Status getStatus () { <br>  return this.status; <br>  } <br><br>  public void setStatus (Contact_Status status) { <br>  this.status = status; <br>  } <br>  //} ++++++++++++++++++++++++++ <br>  public String getAddress () { <br>  return this.address; <br>  } <br><br>  public void setAddress (String address) { <br>  this.address = address; <br>  } <br>  public String getPhone () { <br>  return this.phone; <br>  } <br><br>  public void setPhone (String phone) { <br>  this.phone = phone; <br>  } <br>  public String getDescription () { <br>  return this.description; <br>  } <br><br>  public void setDescription (String description) { <br>  this.description = description; <br>  } <br><br>  public String toString () { <br>  return this.f + "" + this.i + "" + this.o; <br>  } <br>  } <br></div></div><br>  Well, we add the very entity ‚ÄúStatuses‚Äù, simple as a log (I usually copy some and change the names): <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  // {++++++++++++++++++++++++++ <br>  <a href="http://habrahabr.ru/users/entity/" class="user_link">Entity</a> <br>  <a href="http://habrahabr.ru/users/table/" class="user_link">Table</a> (name = "contact_status") <br>  @Synonym (text = "Statuses") <br>  @Forms (element = "") <br>  public class Contact_Status implements java.io.Serializable { <br>  @Synonym (text = "Code") <br>  private int id; <br>  @Synonym (text = "Name") <br>  private String name; <br><br>  <a href="http://habrahabr.ru/users/id/" class="user_link">Id</a> <br>  @GeneratedValue (strategy = GenerationType.IDENTITY) <br>  @Column (name = "id") <br>  // by Eclipse <br>  public int getId () { <br>  return id; <br>  } <br>  public void setId (int id) { <br>  this.id = id; <br>  } <br>  public String getName () { <br>  return name; <br>  } <br>  public void setName (String name) { <br>  this.name = name; <br>  } <br>  public String toString () { <br>  return name; <br>  } <br>  } <br>  //} ++++++++++++++++++++++++++ <br></div></div><br>  If we discard the code created by Eclipse, it will remain quite a bit, and since I work with text faster than running through the menu in the 1C: Configurator, I think that the result is already quite good.  This is me about the database. <br><br>  But what about the interface? <br><br>  The Java community is popular with the Swing UI framework.  But all the examples for it performed specific tasks, for some reason I could not find a universal solution that could be used everywhere. <br><br>  There was no corny decent form editor.  NetBeans is not bad, but it blocks the configuration code, which is terribly annoying, and in Eclipse the windowsBilder plugin constantly re-reads this code, and it slows down incredibly - and often crashes.  Plus inside the anonymous classes of handlers created by him, the rest of the form elements are not visible - a brilliant move.  For some reason, IDEA was even more annoying when braking, although it would seem that the SSD on M.2 should have solved these problems. <br><br>  As a result, the task ‚Äúadd an entity and drop it on a form‚Äù requires a lot of code and time, compared to 1C. <br><br>  They will ask: ‚Äúmany‚Äù - this is how much, haven't you, my dear? <br><br>  I will answer.  Conducting trainings for the RP, I, as a preface to one of the blocks from scratch, made the simplest inventory accounting contour in 4 minutes 35 seconds (4:35, Karl!), Including entering into the database a test example from two documents.  The training participants measured the time, and then I asked them with pathos - if everything is so simple, where are the millions of budgets spent? <br><br>  But I had no idea how to achieve comparable development speed of the finished application, even using a project template with already connected DBMS drivers (PostgreSQL, MySQL, Oracle DB or whatever you have), ORM Hibernate and Swing (in fact, Swingx is in pure Swing There are no decent elements like JXTreeTable).  Obviously, the template should include powerful customization classes.  And I decided to make them on my knee. <br><br>  If we draw a parallel with 1C, the table field tied to the form requisite (for example, a dynamic list) is JXTable or JXTreeTable tied to the so-called TableModel.  Without thinking twice, I inherited from the standard tabular and tree model, added an entity class with which we work and the query text: <br><br><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanTableModel</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultTableModel</span></span></span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-type"><span class="hljs-type">Class</span></span> beanClass; <span class="hljs-comment"><span class="hljs-comment">// , " "   1 private String qtext; //    1 ... }</span></span></code> </pre> <br>  Most importantly, JXTable can call the getValueAt (int row, int col) method on its TableModel.  As for JXTreeTable, there it is getValueAt (ArrayNode node, col), where node is public class ArrayNode extends DefaultMutableTreeTableNode is the top of the tree. <br><br>  According to the qtext request, the data is pulled out of the database, this can occur both at once in a large chunk, and as needed (when calling getValueAt), with the implementation of the cache and paging.  There is no paging in the posted demo; it is implemented through the next added annotation, for example @Paging, and the addition of model classes with a buffer. <br><br>  The output of the table should contain this data, but the user needs to display a limited list of columns, with the correct names, and a certain width.  How to ensure that Russian names are set by default? .. For this, when describing an entity in addition to persistent annotations, you had to create your Synonym annotation that you have already seen in the listing (and the version on GitHub already supports on-line switching between any number languages ‚Äã‚Äãby specifying text, textEng, textDe, and adding language ‚ÄúEng‚Äù, ‚ÄúDe‚Äù ...) to global props. <br><br>  In order not to get up twice, I added the name of the form classes with the Forms annotation to element, list, select.  It is clear that this should be the descendants of JFrame. <br><br>  But the task was to make the program, like the 1C: Enterprise platform itself, create default forms (otherwise there are 4:35 on a new entity), therefore in the example class Contacts the annotation is empty - @Forms (element = ""), although earlier referenced the VContacts form class. <br><br>  As colleagues have already guessed, the creation of columns in BeanTableModel, as well as the creation of details in the automatically created forms of the elements of our entities, takes place with the help of reflection, that is, working with the metadata of the entity.  I immediately stumbled upon 2 ways to iterate over metadata elements: in the usual way (in the FormElement class) and through the Introspector (in the models). <br><br>  So, we brought the data to the table using the model.  It can be said that such a table is the basis of a list or selection form.  Now it would be nice to implement its behavior - opening the form of the element (adding and editing), deleting, selecting, and so on. <br><br><img src="https://habrastorage.org/files/204/a1b/67d/204a1b67d63a4cb585e632a9ba752ca5.jpg" alt="image"><br><br>  It was possible to connect the actions of the buttons on JToolbar with the table in an extremely ugly way - by scanning the elements inside the common parent.  Horrified, I carried it out to a separate class, ut (from the word ‚Äúutilities‚Äù) - in order not to see again.  But the goal was achieved. <br><br>  My bike allowed: <br><br>  1. Continue using the form editor to position elements on the form. <br>  2. Configure the behavior of these elements in small blocks of code (xml would work here, but I don‚Äôt like a large number of files, I‚Äôm confusing them): <br><br><pre> <code class="hljs cs">ContactTable.setTreeTableModel(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BeanTreeTableModel(<span class="hljs-string"><span class="hljs-string">"select * from contacts"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, Contacts.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayNode(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[<span class="hljs-number"><span class="hljs-number">0</span></span>]))); ArrayList&lt;HashMap&gt; tt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt; &gt;(); tt.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(ut.newHashMap(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList &lt; &gt;(Arrays.asList(<span class="hljs-string"><span class="hljs-string">"name,title,width"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"‚Ññ"</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>)))); ... tt.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(ut.newHashMap(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt; &gt;(Arrays.asList(<span class="hljs-string"><span class="hljs-string">"name,title,width"</span></span>, <span class="hljs-string"><span class="hljs-string">"phone"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>)))); ut.TuneTreeColumns(ContactTable, tt); ut.TuneToolbar(Contacts_toolBar, ContactTable);</code> </pre><br>  And input fields with selection buttons have a setting of 1 line of type: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ut</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.linkFormObjectElements</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">FormElement</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.this</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">d</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getName</span></span>(),<span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">t2</span></span>);</code> </pre><br>  3. If you are lazy, you can not create any forms at all for secondary entities, so that the program does them automatically, based on the classes themselves and annotations.  And these forms can open even if there are 20 links, the CRUD ‚ÄúSelect, Add, Edit, Delete, Update‚Äù functionality will work.  This means that the student will be able to slap his laboratory work with the base for the library in 10 minutes without coming into creation. <br><br><img src="https://habrastorage.org/files/d05/c12/230/d05c1223063245d7b2f62fde485982ee.jpg" alt="image"><br><br>  What next? .. Java provides much more extensive features than the built-in 1C language, but it is more concise.  Since most objects (ArrayList, HashMap and others) are the same, in principle you can even try to write an interpreter, but I‚Äôm much more interested in extending the SQL query language by dereferencing, totals, and virtual tables.  Obviously, this task is not solved through ORM. <br><br>  The second article will tell about the design of the tool for flexible generation of user reports, which is just in tune with the topic of requests, so there it will be discussed in more detail. <br><br>  Until new meetings. </div><p>Source: <a href="https://habr.com/ru/post/269083/">https://habr.com/ru/post/269083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269073/index.html">RedHat Acquires Ansible</a></li>
<li><a href="../269075/index.html">Web Camp 2015: how it was</a></li>
<li><a href="../269079/index.html">SanDisk and HP Begin Collaboration on Memory-Driven Computing Technology</a></li>
<li><a href="../26908/index.html">Re: Are Yandex.Fotki good?</a></li>
<li><a href="../269081/index.html">Puli: Resource Management in php applications</a></li>
<li><a href="../269085/index.html">Porting the blog from yii1.1. * To yii2</a></li>
<li><a href="../269087/index.html">Testing NVIDIA GRID + VMware Horizon</a></li>
<li><a href="../269089/index.html">Browser Development Design ‚ÄúSocial Browser Bar‚Äù</a></li>
<li><a href="../26909/index.html">School site - what should it be?</a></li>
<li><a href="../269095/index.html">iOs debug master</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>