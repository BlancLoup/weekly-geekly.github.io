<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to handle errors correctly: silence is not always good</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have never had any particular opinion regarding error handling. If I started working with existing code, I continued to perform the task on which th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to handle errors correctly: silence is not always good</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f67/c0b/7cc/f67c0b7cc12a761d7e4e6561cc9dad1f.png"><br><br>  I have never had any particular opinion regarding error handling.  If I started working with existing code, I continued to perform the task on which the author of the source worked;  if I wrote code from scratch, I did what seemed correct to me. <br><br>  But recently I ran into a problem, a bug that manifested itself due to a "silent" error in the code.  I realized that there is something to think about.  Maybe I can‚Äôt change the way that errors are handled in the entire code base I‚Äôm working on, but something can definitely be optimized. <br><a name="habracut"></a><br><blockquote>  <b>We remind:</b> <i>for all readers of "Habr" - a discount of 10,000 rubles when recording for any Skillbox course on the promotional code "Habr".</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Skillbox recommends:</b> Online <a href="https://skillbox.ru/java/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DJAVDEV%26utm_content%3Darticles%26utm_term%3Dsilentfaults">Profession Java Developer</a> Educational Course. <br><br></blockquote><br><h3>  Not always worth chopping off the shoulder </h3><br>  The first step in the issue of error handling should be to understand when ‚Äúerror‚Äù is not ‚Äúerror!‚Äù.  Of course, it all depends on the business logic of your application, but in general, some bugs are obvious and can be fixed without problems. <br><br><ul><li>  Do you have a date range where the ‚Äúbefore‚Äù is before the ‚Äúfrom‚Äù?  Change the order. </li><li>  Do you have a phone number that starts with + or contains a dash where you do not expect special characters to appear?  Remove them. </li><li>  Null collection - a problem?  Make sure you initialize this before accessing (using <a href="https://en.wikipedia.org/wiki/Lazy_initialization">lazy initialization</a> or a constructor). </li></ul><br>  Do not interrupt the execution of the code due to errors that you can correct, and, of course, do not interfere with the actions of users of your service or application.  If you are able to understand the problem and solve it on the fly - just do it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/edd/c78/1b1/eddc781b1768c27d6e643cf555b65731.jpg"><br><br><h3>  Return Null or other magic numbers </h3><br>  Zero values, ‚Äì1 where a positive number is expected, and other magic return values ‚Äã‚Äã‚Äî all this is caused by the devil, which transfers the responsibility for error checking to the calling function. <br><br>  With them, your code will be full of such blocks that will make the application logic unclear: <br><br><pre><code class="python hljs">return_value = possibly_return_a_magic_value() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> return_value &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>: handle_error() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: do_something() other_return_value = possibly_nullable_value() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> other_return_value <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: handle_null_value() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: do_some_other_thing()</code> </pre> <br>  Well, or simpler, but also bad: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = returnSomethingWhichCouldBeNull(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = item?.Property?.MaybeExists; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.HasValue) { DoSomething(); }</code> </pre> <br>  Passing null into methods is also a problem, although in some developers you may find places where the methods start with a few lines of input validation.  But in fact, all this is not necessary.  Most modern languages ‚Äã‚Äãprovide not one, but several tools at once, allowing you to clearly indicate what you expect.  They also skip useless checks, for example, defining parameters as non-zero or having an appropriate decorator. <br><br><h3>  Error codes </h3><br>  Here is the same problem as with null and other similar values, when an unnecessary complication of code is added. <br><br>  For example, you can use this structure to return an error code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> errorCode; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = getSomething(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> errorCode); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (errorCode != <span class="hljs-number"><span class="hljs-number">0</span></span>) { doSomethingWithResult(result); }</code> </pre> <br>  The result can be displayed as follows: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Result</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Item { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// At least "ErrorCode" is an enum public ErrorCode ErrorCode { get; set; } = ErrorCode.None; public IsError { get { return ErrorCode != ErrorCode.None; } } } public class UsingResultConstruct { ... var result = GetResult(); if (result.IsError) { switch (result.ErrorCode) { case ErrorCode.NetworkError: HandleNetworkError(); break; case ErrorCode.UserError: HandleUserError(); break; default: HandleUnknownError(); break; } } ActuallyDoSomethingWithResult(result); ... }</span></span></code> </pre> <br>  This is really not the best code.  It turns out that Item can still be empty.  In fact, there is no guarantee (other than an agreement) that when the result is error free, you can safely access the Item. <br><br>  After you finish all this processing, you still have to convert the bug code into an error message and do something with it.  Sometimes it happens that because of the excessive complexity of the code, this message itself is not displayed as it should. <br><br>  There is an even more serious problem: if you or someone else changes the internal implementation to handle the new invalid state with the new error code, the whole structure will stop working altogether. <br><br><h3>  If it didn't work out the first time, try again. </h3><br>  Before proceeding, it is worth emphasizing that the ‚Äúsilent‚Äù failure of the program is bad.  An unexpected problem may arise at the most inopportune moment - for example, at the weekend, when you cannot quickly fix it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/40c/c92/810/40cc9281004ffdb45ace66b498749d6b.jpg"><br><br>  If you read <a href="https://www.oreilly.com/library/view/clean-code/9780136083238/">Clean Code</a> , then you are most likely wondering, why not just ‚Äúthrow‚Äù an exception?  If not, then most likely you think that exceptions are the root of evil.  I used to think so too, but now I think a little differently. <br><blockquote>  An interesting, at least for me, nuance is that the default implementation for a new method in C # is to create a NotImplementedException exception, whereas for the new method in Python, the default is ‚Äúpass‚Äù. <br><br>  As a result, most often we introduce the ‚Äúsilent error‚Äù setting for Python.  I wonder how many developers have spent a lot of time in order to understand what is happening and why the program does not work.  But in the end, after many hours, they found that they forgot to implement the placeholder method. </blockquote>  But take a look at this: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyDataObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyDataObject toUpdate</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_dbConnection == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbConnectionError(); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newVersion = _dbConnection.Update(toUpdate); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVersion == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } MyDataObject result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyDataObject(newVersion); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (DbConnectionClosedException dbcc) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbConnectionError(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MyDataObjectUnhappyException dou) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MalformedDataException(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnknownErrorException(); } }</code> </pre> <br>  Of course, exceptions alone will not protect you from creating unreadable and unmanaged code.  You must apply exceptions as a well-thought-out and well-considered strategy.  Otherwise, if the project is too large, your application may be in an inconsistent state.  Conversely, if the project is too small, you will get chaos. <br><br>  To prevent this from happening, I advise you to keep in mind this: <br><br>  Consistency above all else  You should always make sure that the application is consistent.  If this means that you have to wrap each pair of lines with a try / catch block, just hide it all in another function. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: do_this() do_that() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: something_bad_happened() <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: cleanup_resource()</code> </pre> <br>  Error consolidation is required.  Well, if you provide different types of processing of different types of errors.  However, you need it, not the users.  For them, display the only exception, so that users simply know that something went wrong.  Details - your area of ‚Äã‚Äãresponsibility. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyDataObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyDataObject toUpdate</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newVersion = _dbConnection.Update(toUpdate); MyDataObject result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyDataObject(newVersion); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (DbConnectionClosedException dbcc) { HandleDbConnectionClosed(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UpdateMyDataObjectException(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MyDataObjectUnhappyException dou) { RollbackVersion(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UpdateMyDataObjectException(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UpdateMyDataObjectException(); } }</code> </pre> <br>  It is worth catching exceptions immediately.  It is better to intercept them at the lowest level.  Maintain consistency and hide the details as described above.  Error handling should be left to the top level of the application.  If everything is done correctly, you will be able to separate the flow of the logic of the application itself from the error handling flow.  This will allow you to write clear, readable code. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_api</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: item = get_something_from_the_db() new_version = do_something_to_item(item) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> new_version <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ex: handle_high_level_exception(ex)</code> </pre> <br>  So far this is all, and if you want to discuss the topic of errors and their processing, we will. <br><br><blockquote>  <b>Skillbox recommends:</b> <br><br><ul><li>  Practical course <a href="https://skillbox.ru/agima/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DAGIMA%26utm_content%3Darticles%26utm_term%3Dsilentfaults">"Mobile Developer PRO"</a> . </li><li>  Online course <a href="https://skillbox.ru/c-sharp/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DCSHDEV%26utm_content%3Darticles%26utm_term%3Dsilentfaults">"From # developer from scratch</a> . <a href="https://skillbox.ru/c-sharp/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DCSHDEV%26utm_content%3Darticles%26utm_term%3Dsilentfaults">"</a> </li><li>  Two-year practical course <a href="https://iamwebdev.skillbox.ru/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DWEBDEVPRO%26utm_content%3Darticles%26utm_term%3Dsilentfaults">"I am a web developer PRO"</a> . </li></ul></blockquote></div><p>Source: <a href="https://habr.com/ru/post/441148/">https://habr.com/ru/post/441148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441134/index.html">Emotions, independent work</a></li>
<li><a href="../441136/index.html">Long-term storage of Prometheus metrics (Alexey Palazhchenko, Percona)</a></li>
<li><a href="../441140/index.html">Development under WebAssembly: real rake and examples</a></li>
<li><a href="../441142/index.html">12 points of growth conversion, or content that really sells</a></li>
<li><a href="../441146/index.html">Industrial wireless networks: which one to choose?</a></li>
<li><a href="../441150/index.html">The first acquaintance with the HTTP protocol by writing a simple Java Web server</a></li>
<li><a href="../441152/index.html">How to minimize errors when integrating with external services: the online broker experience</a></li>
<li><a href="../441158/index.html">How ethics became the most expensive problem of Silicon Valley, and philosophy - its most practical solution</a></li>
<li><a href="../441160/index.html">How to learn to determine when to say ‚Äúno‚Äù</a></li>
<li><a href="../441166/index.html">We get the master password from the password manager 1Password 4 blocked</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>