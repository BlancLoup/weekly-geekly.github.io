<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing Kubernetes on Hetzner Cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to talk about installing Kubernetes on the Hetzner Cloud. 

 Ubuntu Linux 18.04 is installed on my work computer and all...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing Kubernetes on Hetzner Cloud</h1><div class="post__text post__text-html js-mediator-article">  In this article, I would like to talk about installing Kubernetes on the Hetzner Cloud. <br><br>  Ubuntu Linux 18.04 is installed on my work computer and all the examples will involve the use of this operating system. <br><br>  We will use the <a href="https://github.com/xetys/hetzner-kube">hetzner-kube utility</a> to work with Hetzner Cloud and build Kubernetes cluster.  Install it on your local computer. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">$ wget https://github.com/xetys/hetzner-kube/releases/download/0.3.1/hetzner-kube-linux-amd64 $ chmod a+x ./hetzner-kube-linux-amd64 $ sudo mv ./hetzner-kube-linux-amd64 /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/hetzner-kube</code> </pre> <br>  To use the hetzner-kube utility and its authorization in the Hetzner Cloud, you must create the Token API through the Hetzner Cloud Console <a href="https://console.hetzner.cloud/">https://console.hetzner.cloud</a> .  At the top, select Select a project -&gt; Default, select the Access item in the left menu, then go to the API tokens section, click on the Generate API Token button. <br><br>  As a result, the Token API will be generated and it will need to be specified in the configuration of the hetzner-kube utility. <br><br><pre> <code class="bash hljs">$ hetzner-kube context add k8s Token: &lt;PASTE TOKEN HERE&gt; added context <span class="hljs-string"><span class="hljs-string">'k8s'</span></span></code> </pre><br>  Next, we need to generate an SSH key that will be used to access the servers in the Hetzner Cloud.  To do this, use the ssh-keygen utility: <br><br><pre> <code class="bash hljs">$ ssh-keygen -t rsa Generating public/private rsa key pair. Enter file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> to save the key (~/.ssh/id_rsa): Enter passphrase (empty <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> no passphrase): Enter same passphrase again: Your identification has been saved <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ~/.ssh/id_rsa. Your public key has been saved <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ~/.ssh/id_rsa.pub. The key fingerprint is: SHA256:1bwptZ8lPiAhtA37/2U1G7HsC+aE7qMVCtVIfN3OLzk lx4241@LX4241-LINUX The key<span class="hljs-string"><span class="hljs-string">'s randomart image is: +---[RSA 2048]----+ | +. . . | | ..*o+ . . | | +o=.+ o. | | .+ o +.oo| | .S +.= .*+| | . .+o+E+*| | . o.+==o| | o.+..+.| | .oo.... | +----[SHA256]-----+</span></span></code> </pre> <br>  As a result, two files ~ / .ssh / id_rsa (private key) and ~ / .ssh / id_rsa.pub (public key) will be created in your home directory. <br><br>  Add a public ssh key to Hetzner Cloud: <br><br><pre> <code class="bash hljs">$ hetzner-kube ssh-key add --name k8s sshKeyAdd called SSH key k8s(95430) created</code> </pre><br>  Building the Kubernetes cluster directly is very easy: <br><br><pre> <code class="bash hljs">$ hetzner-kube cluster create --name k8s --ssh-key k8s --master-count 1 --worker-count 1 2018/08/02 13:57:57 Creating new cluster NAME:k8s MASTERS: 1 WORKERS: 1 ETCD NODES: 0 HA: <span class="hljs-literal"><span class="hljs-literal">false</span></span> ISOLATED ETCD: <span class="hljs-literal"><span class="hljs-literal">false</span></span> 2018/08/02 13:57:58 creating server <span class="hljs-string"><span class="hljs-string">'k8s-master-01'</span></span>... --- [======================================] 100% 2018/08/02 13:58:18 Created node <span class="hljs-string"><span class="hljs-string">'k8s-master-01'</span></span> with IP 159.69.54.228 2018/08/02 13:58:18 creating server <span class="hljs-string"><span class="hljs-string">'k8s-worker-01'</span></span>... --- [======================================] 100% 2018/08/02 13:58:37 Created node <span class="hljs-string"><span class="hljs-string">'k8s-worker-01'</span></span> with IP 159.69.51.140 2018/08/02 13:58:37 sleep <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 10s... k8s-master-01 : complete! 100.0% [==============] k8s-worker-01 : complete! 100.0% [==============] 2018/08/02 14:02:50 Cluster successfully created!</code> </pre> <br>  This command will automatically create virtual servers in Hetzner Cloud and install the specified number of master / worker nodes of the Kubernetes cluster on them.  By default, CX11 virtual servers will be used. <br><br>  Later, using the hetzner-kube utility, it is also easy to change the Kubernetes cluster configuration by adding a worker node.  For example, add 2 worker nodes: <br><br><pre> <code class="plaintext hljs">$ hetzner-kube cluster add-worker --name k8s --nodes 2</code> </pre><br>  Unfortunately, it is not possible to change the configuration of the master node using the hetzner-kube utility without completely re-creating the Kubernetes cluster at this point in time. <br><br>  To work with Kubernetes cluster, the utility kubectl is used.  Detailed instructions for installing it for different operating systems can be found <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">at the following link</a> . <br><br>  In order to work with the created Kubernetes cluster using the kubectl command, you must save the locally configuration of the created cluster as follows: <br><br><pre> <code class="bash hljs">$ hetzner-kube cluster kubeconfig k8s create file kubeconfig configured</code> </pre> <br>  The configuration file is saved in ~ / .kube / config. <br><br>  Now we come to the most interesting part - configuring the resulting Kubernetes cluster. <br><br>  To begin with, we will create the basic resources needed for future application deployment.  More information can be found at the <a href="">following link</a> . <br><br><pre> <code class="bash hljs">$ curl https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml | kubectl apply -f - % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 6170 100 6170 0 0 13987 0 --:--:-- --:--:-- --:--:-- 14022 namespace <span class="hljs-string"><span class="hljs-string">"ingress-nginx"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"default-http-backend"</span></span> created service <span class="hljs-string"><span class="hljs-string">"default-http-backend"</span></span> created configmap <span class="hljs-string"><span class="hljs-string">"nginx-configuration"</span></span> created configmap <span class="hljs-string"><span class="hljs-string">"tcp-services"</span></span> created configmap <span class="hljs-string"><span class="hljs-string">"udp-services"</span></span> created serviceaccount <span class="hljs-string"><span class="hljs-string">"nginx-ingress-serviceaccount"</span></span> created clusterrole <span class="hljs-string"><span class="hljs-string">"nginx-ingress-clusterrole"</span></span> created role <span class="hljs-string"><span class="hljs-string">"nginx-ingress-role"</span></span> created rolebinding <span class="hljs-string"><span class="hljs-string">"nginx-ingress-role-nisa-binding"</span></span> created clusterrolebinding <span class="hljs-string"><span class="hljs-string">"nginx-ingress-clusterrole-nisa-binding"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"nginx-ingress-controller"</span></span> created</code> </pre> <br>  We add the ingress-nginx service, which will process requests on ports 80 (http) and 443 (https) and redirect them further to our application.  Instead of XXXX, we specify the list of external IPs of our nodes in the Kubernetes cluster, which will process requests from the Internet (these can be either master or worker nodes, since LoadBalancer is not available in Hetzner Cloud at this time). <br><br>  Create a file called ingress-nginx.yaml and the following contents: <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Service metadata: name: ingress-nginx namespace: ingress-nginx spec: type: ports: - name: http port: 80 targetPort: 80 protocol: TCP - name: https port: 443 targetPort: 443 protocol: TCP selector: app: ingress-nginx externalIPs: - XXXX - XXXX</code> </pre> <br><br><pre> <code class="bash hljs">$ kubectl apply -f ingress-nginx.yaml service <span class="hljs-string"><span class="hljs-string">"ingress-nginx"</span></span> configured</code> </pre> <br><br>  We check that nginx-ingress-controller and default-http-backend are running. <br><br><pre> <code class="bash hljs">$ kubectl get pods -n ingress-nginx NAME READY STATUS RESTARTS AGE default-http-backend-55c6c69b88-hvl4x 1/1 Running 0 51m nginx-ingress-controller-6658c97f58-d6jkg 1/1 Running 0 51m</code> </pre> <br><br>  Add A record to your domain and wait until the information about them appears in DNS.  For example: <br><br><pre> <code class="bash hljs">Type: A Name: echo.example.com Value: XXXX</code> </pre><br><br>  If you entered several external IP addresses in ingress-nginx.yaml, you can create several identical DNS records with these IP addresses.  In this case, requests for your domain will be distributed between these IP addresses and load balancing will occur. <br><br>  In this example, to work with https, we will generate a self-signed SSL certificate. <br><br><pre> <code class="bash hljs">$ openssl req -newkey rsa:2048 -nodes -keyout echo.example.com.key -x509 -days 365 -out echo.example.com.crt Generating a 2048 bit RSA private key ..+++ .............+++ writing new private key to <span class="hljs-string"><span class="hljs-string">'echo.example.com.key'</span></span> ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter <span class="hljs-string"><span class="hljs-string">'.'</span></span>, the field will be left blank. ----- Country Name (2 letter code) [AU]:UA State or Province Name (full name) [Some-State]:Kyiv Locality Name (eg, city) []:Kyiv Organization Name (eg, company) [Internet Widgits Pty Ltd]:Super Company Ltd Organizational Unit Name (eg, section) []:echo.example.com Common Name (eg server FQDN or YOUR name) []:echo.example.com Email Address []:info@echo.example.com $ cat echo.example.com.key | base64 | tr -d <span class="hljs-string"><span class="hljs-string">'\n'</span></span> &lt;YOUR PRIVATE KEY&gt; $ cat echo.example.com.crt | base64 | tr -d <span class="hljs-string"><span class="hljs-string">'\n'</span></span> &lt;YOUR CERTIFICATE&gt;</code> </pre> <br><br>  Now add our application.  As an example, the simple echoserver is selected.  Create a file called app.yaml and the following contents: <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Namespace metadata: name: echoserver --- kind: Secret metadata: name: echo.example.com-tls namespace: echoserver type: kubernetes.io/tls data: tls.crt: &lt;YOUR CERTIFICATE&gt; tls.key: &lt;YOUR PRIVATE KEY&gt; --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: echoserver namespace: echoserver spec: replicas: 1 template: metadata: labels: app: echoserver spec: containers: - image: gcr.io/google_containers/echoserver:1.0 imagePullPolicy: Always name: echoserver ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: name: echoserver namespace: echoserver spec: ports: - name: http port: 80 targetPort: 8080 protocol: TCP selector: app: echoserver --- apiVersion: extensions/v1beta1 kind: Ingress metadata: name: echoserver namespace: echoserver annotations: kubernetes.io/ingress.class: "nginx" spec: tls: - hosts: - echo.example.com secretName: echo.example.com-tls rules: - host: echo.example.com http: paths: - path: / backend: serviceName: echoserver servicePort: 80</code> </pre> <br><pre> <code class="bash hljs">$ kubectl apply -f app.yaml namespace <span class="hljs-string"><span class="hljs-string">"echoserver"</span></span> configured deployment <span class="hljs-string"><span class="hljs-string">"echoserver"</span></span> unchanged service <span class="hljs-string"><span class="hljs-string">"echoserver"</span></span> configured ingress <span class="hljs-string"><span class="hljs-string">"echoserver"</span></span> unchanged</code> </pre> <br><br>  That's all)) Check the result: <br><br><pre> <code class="bash hljs">$ curl https://echo.example.com/ CLIENT VALUES: client_address=(<span class="hljs-string"><span class="hljs-string">'10.244.3.2'</span></span>, 32860) (10.244.3.2) <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=GET path=/ real path=/ query= request_version=HTTP/1.1 SERVER VALUES: server_version=BaseHTTP/0.6 sys_version=Python/3.5.0 protocol_version=HTTP/1.0 HEADERS RECEIVED: Accept=*/* Connection=close Host=echo.example.com User-Agent=curl/7.58.0 X-Forwarded-For=10.244.0.0 X-Forwarded-Host=echo.example.com X-Forwarded-Port=80 X-Forwarded-Proto=http X-Original-URI=/ X-Real-IP=10.244.0.0 X-Request-ID=7a4f4aabf9a0043ea2b1ca91bd1a3adf X-Scheme=http</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/419323/">https://habr.com/ru/post/419323/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419311/index.html">Industrial lamps from the domestic manufacturer Effest with a good color rendering index</a></li>
<li><a href="../419313/index.html">Buffett's testament or what financial consultants are silent about</a></li>
<li><a href="../419315/index.html">Engine life after the death of the rocket</a></li>
<li><a href="../419319/index.html">How to run Istio using Kubernetes in production. Part 1</a></li>
<li><a href="../419321/index.html">SamsPcbGuide Part 7: Tracing Signal Lines. Differential pairs</a></li>
<li><a href="../419325/index.html">Relocate student to France</a></li>
<li><a href="../419327/index.html">Interface List Guide in MikroTik</a></li>
<li><a href="../419329/index.html">Digital events in Moscow from 6 to 12 August</a></li>
<li><a href="../419331/index.html">Hacken Continuum: an electronic instrument with acoustic responsiveness</a></li>
<li><a href="../419333/index.html">Tic-tac-toe on DNS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>