<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ORM or object-relational projector</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we bring to your attention an excerpt from the book by Sergey Tarasov ‚ÄúDefragmentation of the brain. Soft-building from the inside ‚Äù , which is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ORM or object-relational projector</h1><div class="post__text post__text-html js-mediator-article">  Today we bring to your attention an excerpt from the book by Sergey Tarasov <b>‚ÄúDefragmentation of the brain.</b>  <b>Soft-building from the inside ‚Äù</b> , which is being prepared for release in our publishing house. <br><br><h4>  <b>Hiding the database or how to cross a hedgehog with a snake</b> </h4><br>  Having mentioned one of the largest pillars of modern soft-building - the world of OOP, one cannot ignore the other - the world of relational databases.  I deliberately inserted the adjective ‚Äúrelational‚Äù in relation to all major DBMSs, although in the 1970s such a generalization would be inappropriate. <br><br>  Nevertheless, it was precisely relational DBMS that in the 1980s managed to free programmers from knowing unnecessary details of organizing physical data storage, isolating themselves from them by logical level structures and the standardized SQL language to access information.  It also turned out that most of the data formats used by the programs fit well on the model of two-dimensional tables and the relationships between them.  These two factors predetermined the success of relational DBMSs, and as a rewarding prize the community received a rigorous mathematical theory in the basis of the technology. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  Unlike the relational world, the PLO developed by practical engineers rather spontaneously, based on the needs of the programming community, and therefore had no strict theory under it.  Attempts to bring one such to the PLO retroactively failed.  The maximum result was achieved by the authors declared by the UML standard, which, however, is still mainly used as illustrative code for pictures.  But a bad standard is better than none. <br><br>  Both relational and object models refer to the logical level of software system design.  They are orthogonal and in essence represent two views on the same essence.  This means that you can implement the same system while remaining in the framework of only one relational-procedural approach, or by following exclusively the OOP. <br>  In practice, a situation has arisen where programs are written mainly using OOP, whereas data is stored in relational databases.  Without touching on the question of the feasibility of such a crossover ‚Äúhedgehog with a snake‚Äù, we take the situation as a given.  From which it follows the necessity of mapping (projection) of objects on relational structures and back. <br><br>  In view of the absence of the formal theoretical base under the PLO, this task is unsolvable in the general case, but is feasible in particular.  The component of the software system that implements the mapping is called ORM (Object-Relational Mapping) or the object-relational projector - ORP.  A full ORM can be a very non-trivial component, exceeding the complexity of the rest of the system.  Therefore, although many developers have successfully used their own private implementations, in the industry over the past 10 years, several widely used frameworks have emerged that perform the projection task as well. <br><br>  An overview of object-relational projection tools was not planned within the framework of the book.  They are already enough in the network, including my little one, made back in 2005, but not very outdated.  Therefore, the following examples will mainly concern the <b>NHibernate</b> framework. <br><br>  There is a very important point in the technology of displaying objects on an RDBMS, the understanding of which largely determines the success of your project.  I have repeatedly heard the opinion of programmers that, for a domain layer, the projector-generated SQL is the equivalent of translating a high-level language into an assembler of a target processor.  This opinion is not just deeply erroneous, but at a rapid pace leads the team to the creation of difficult-to-maintain systems with inherent and practically unrecoverable performance problems. <br><br>  Simply put, as soon as you think about SQL as a kind of assembler in relation to the OOP language you use, you immediately get into a very bad story. <br><br>  SQL is a high-level declarative specialized language of the fourth generation, in contrast to the same Java or C #, still belonging to the third generation of imperative languages.  A single SQL statement for three dozen lines that performs something more complicated than sampling by key will require more than C # lines to achieve the same result at times, if not an order of magnitude. <br><br>  This situation leads ORM developers to create their own SQL-like language for manipulating objects and already translate it into a sequel (HQL - Hibernate Query Language - SQL-like query language used in Hibernate / NHibernate).  Or use SQL directly with dynamic conversion of the result into a collection of objects. <br><br>  Otherwise, the application programmer is doomed to retrieve from the database and then process large data arrays directly in his application.  Similarly, the table data was processed in the absence of embedded SQL by developers on early versions of Clipper in the late 80s.  There it was called "navigation processing."  I think the term is appropriate here. <br><br>  In the era of mass transition from Clipper-like programs and file-server technologies to client-server RDBMS, many applications and their developers continued to use the navigation approach.  Applications worked slowly, often blocking work in a multi-user environment.  Because for effective work with RDBMS, it is necessary to use approaches oriented to processing sets on the server, assuming that the developer has the skills to work with declarative languages. <br><br>  However, having received the ORM, the programmer often returns to the navigation approaches of processing arrays of data outside the RDBMS only with the difference that now this array, I hope, does not represent the contents of the whole table. <br><br>  Why?  The lack of knowledge of RDBMS is attempted to be replaced by additional levels of abstractions.  In fact, the opposite happens: the levels of abstraction do not hide the details of the object storage layer from the programmer, but, on the contrary, its incompetence in the field of databases from the DBMS.  Until some time. <br><br>  Despite the thick layer of abstractions provided by an ORM like Hibernate, it is almost impossible to make an application work effectively with RDBMS without the knowledge of the relevant principles of the orthogonal world and the SQL language. <br><br>  But attempts continue.  Some are still developing projectors for their internal needs, often very light.  Others are looking for simplification and access to noSQL.  But the winners are still having ‚Äúbase‚Äù competencies programmers and consultants who earn on those who do not possess them. <br><br><h4>  <b>How ORM is commonly used</b> </h4><br>  On soft-building presentations, they often draw beautiful schemes for the separation of presentation layers, business logic and stored data.  The blue dream of a novice programmer is to use only one medium and language to develop all layers and forget about the need for knowledge of relational DBMS, reducing their purpose to some kind of ‚Äúintelligent file system.‚Äù  The word SQL causes negative associations associated with something ancient, not to mention triggers or stored procedures.  Good people appear on the horizon, with books of different gurus about domain-oriented development under the arm, telling the newcomers something like: ‚ÄúGuys, relational DBMS is a relic of a protracted era 30 years ago.  Now everything is built on the PLO.  And there is a wonderful thing - ORM.  Start using it and forget about the heavy legacy of the past! ‚Äù <br><br>  The guys accept the offer.  Further evolution of the development of the system is approximately as follows. <br>  Initially, the ORM framework is selected for display.  Already at this stage, it turns out that the situation is bad with theory and standards.  It would be good to be on the alert, but a presentation showing how in 10 minutes you can create the basis of an application such as a contacts notebook is fascinating.  Resolved! <br><br>  We begin to implement the domain model.  Add classes, properties, relationships.  We generate database structure or connect to existing one.  We build an interface for managing objects of type CRUD.  Everything is quite simple.  At least it seems quite comparable with the manipulations of the DataSet.  Those who know about them, of course, because not everyone suspects about the existence of tabular forms of data life in the application outside of the DBGrid display grids. <br><br>  As soon as the developers have implemented the CRUD-logic, the main action begins.  Using the sequel directly is now difficult.  Without touching the display strategies and the problems of portability of the application between the DBMS, in fact, each SQL query with connections, rising into the domain, is accompanied by a specific projection of the table result on the class created on this occasion.  Therefore, you have to use your own query language ORM.  Non-standard, without debugging and profiling tools.  If it is, the language is generally available in this ORM.  To support the appropriate integration environment. NET allows you to use LINQ, which allows you to catch some errors at the compilation stage. <br><br>  Compare the expressiveness of the language with a simple example, which I will leave without comment. <br><br>  <i>SQL</i> <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> task_queue <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> id_task <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> id_task_origin = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><br>  <i>NHibernate HQL</i> <br><pre> <code class="sql hljs">IList&lt;TaskQueue&gt; queues = session .CreateQuery("from TaskQueue where Task.Id in (2, 3, 15) and TaskOrigin.Id = 10") .List&lt;TaskQueue&gt;();</code> </pre><br><br>  <i>NHibernate without HQL with criteria</i> <br><pre> <code class="sql hljs">IList&lt;TaskQueue&gt; queues = session.CreateCriteria() .Add(Expression.In("Task.Id", someTasks.ToArray())) .Add(Expression.Eq("TaskOrigin.Id", 10)) .List&lt;TaskQueue&gt;();</code> </pre><br>  <i>LINQ (NHibernate)</i> <br><pre> <code class="sql hljs">IList&lt;TaskQueue&gt; queues = session .Query&lt;TaskQueue&gt;() .Where(q =&gt; someTasks.Contains(q.Task.Id) &amp;&amp; q.TaskOrigin.Id == 10).ToList();</code> </pre><br><br>  Suddenly it turns out that its own query language generates far from optimal SQL.  When the database is relatively small, hundreds of thousands of records in the longest tables, and the queries are not too complex, even a non-optimal sequel will not cause obvious problems in many cases.  The user will wait a little. <br><br>  However, requests like ‚Äúselect employees whose salary during the last year did not exceed the average for the previous year‚Äù already cause problems at the level of the embedded language.  Then the developers often go the only possible way: we select a collection of objects and, in cycles, we filter and calculate, calling the methods of related objects.  Or use the same LINQ over the selected array.  The number of intermediate short SQL queries to the DBMS during such processing of collections can amount to tens of thousands. <br><br></div><p>Source: <a href="https://habr.com/ru/post/165327/">https://habr.com/ru/post/165327/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165317/index.html">Safe "ctrl + v" in the terminal</a></li>
<li><a href="../165319/index.html">The first certified Android prefix for downloading torrents</a></li>
<li><a href="../165321/index.html">For holivaru about managers - about the results and products</a></li>
<li><a href="../165323/index.html">We are driving a car with 2GIS</a></li>
<li><a href="../165325/index.html">DVD-RX fighting protection</a></li>
<li><a href="../165329/index.html">Getting rid of duplicate end-to-end code in PHP: code refactoring with AOP</a></li>
<li><a href="../165337/index.html">Visualization of computer usage statistics with R</a></li>
<li><a href="../165339/index.html">Zero-day vulnerability in Firefox 18 and Opera 12.12</a></li>
<li><a href="../165341/index.html">Samsung Galaxy Nexus with Ubuntu Phone OS is shown at CES 2013</a></li>
<li><a href="../165343/index.html">Run arbitrary code in Rails</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>