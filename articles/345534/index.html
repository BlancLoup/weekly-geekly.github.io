<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I wrote my own ERP system, ver. 2.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My last article caused a lot of questions and comments from readers. Indeed it turned out quite crumpled, did not describe everything. I want to try a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I wrote my own ERP system, ver. 2.0</h1><div class="post__text post__text-html js-mediator-article">  My last <a href="https://habrahabr.ru/post/345274/">article</a> caused a lot of questions and comments from readers.  Indeed it turned out quite crumpled, did not describe everything.  I want to try again to present this case, describing it based on the questions received in the comments. <br><br>  So, given: a branch of a large restaurant business network specializing in the delivery of orders to the house. <br><a name="habracut"></a><br>  Several kitchens scattered around the city.  Each kitchen has an order taker, cooks, packaging of the finished product, and delivery men.  Customers drop their orders through the site, a mobile application, or call the order taker.  Ideally, after confirming the order in an hour, this order should be with the client.  Those.  the total time for preparation and packaging is 20 minutes, the delivery time is 40 minutes (here it must be said that the case takes place in the city of Millionaire, with appropriate distances and level of traffic jams).  In addition to information on the actual composition of the order, the client informs the method of payment (cash / card, whether the change is required, from what amount) and the delivery address. <br><br>  <i>The main problems of the existing system can be formulated as follows:</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <b>Lack of proper control over employees at each stage</b> : <br><ul><li>  except cooks, no one knows the current load on the kitchen, except couriers - the current load on them. </li><li>  Late arrivals are not recorded (if the courier is late for more than 15 minutes - this is not a great credit for the whole company). </li><li>  It is difficult to predict how many days chefs, couriers need. </li><li>  Permanent forgetting by couriers of the second package, if the order is large, transfer to the kitchen / package, and other resulting things. </li></ul></li><li>  <b>Errors in the delivery addresses</b> , due to which the courier does not always understand where to go: incorrect writing of the streets, house numbers that are physically absent, and other problems due to the lack of control over the correctness of this information. </li><li>  <b>Lack of distribution of orders across the kitchens</b> .  The load on the kitchen should be about the same.  That is, each order must be distributed by points based on workload and traffic jams.  It is impossible to implement without implementing the control from p. </li></ol><br>  Of course, there must also be full support for the cash desk (parishioners / consumables for delivery, cash payment, all kinds of technical flights, for example, to buy food), shifts - for every period of time the point has to be responsible, who manages the cashier, orders, performs other important actions.  And other little things that are probably not worth listing here.  TK is great. <br><br>  Many will ask: what about warehouse logistics?  How to account for damaged goods, the logic of purchases, etc.?  It was decided to implement in the next stage.  As well as unloading consumables / ward in 1s, posting salaries through it and so on.  That is, first the implementation of operational control, and then accounting. <br><br>  Why it was impossible to take a ready-made implementation and integrate into this business?  There is no such market.  Before starting to cooperate with me, the customer was ready to pay a considerable amount of money for the finished system completed for his needs.  But this was not found. <br>  Just a special wish of the customer was that everything worked smartly.  Its current system, cloudy, barely tosses in the browser on i3.  And when, at peak loads, an average of 1 order comes in a minute, watching a few second lags of the interface is a real loss of customers, and, accordingly, money.  But the system also had to be with a single server. <br><br><h3>  So, I took the project. </h3><br>  The development tool was chosen Rad Studio.  The studio for some reason is not very popular, but in this case, I, firstly, wanted to get a single code on all devices, since I alone can‚Äôt afford to prescribe the same data structure several times in several development environments, but then, with any change, rule in 10 places.  And secondly, I get a compiled application on all platforms, which theoretically should always work quickly.  But above all, I was worried about speed at the operator‚Äôs workplace. <br><br>  The first thing needed is integration with the existing system.  Orders from it must fall into a new one without any delay.  A small use of the sniffer showed that their program polls the server once a minute, and, if there is a new order, it prints pdf.  After half a day my program was ready, which completely copied the original protocol (up to a byte, thanks that the source code for the delphi component is available and there you can easily correct the http header without bothering with the raw socket), but in addition to printing a parsil on the printer, these pdf and read out the order, loading it into the database. <br><br>  There is such a wonderful program <a href="https://github.com/ottosmops/pdftotext">pdftotext</a> .  Run with parameters <br> <code>‚Äìenc UTF-8 ‚Äìraw</code> <br> <br>  And we have a .txt file that can be parsed without any problems by extracting all the necessary information. <br>  But this method carried some limitations.  Firstly, not all the necessary information was unloaded, and the operator had to refill a couple of fields (for example, change), and secondly, it was just a synchronization of orders.  For example, delivery flights had to be formed both there and there.  Therefore, a proxy was written, which analyzed all the information passing through it - the whole protocol was there for non-encrypted JSON and this problem was solved. <br><br>  The second problem is the address base.  It is clear that you need to download FIAS, load it into the database.  But first, the entire base is not needed, apartments are not needed, outdated records, etc., and in fact it‚Äôs not the address itself that is interesting, but the coordinate where to take it.  I decided to unload only settlements, streets and houses.  And in the table of houses for each added field recording coordinates.  But since, to put it mildly, not all houses are in FIAS, we had to add the ability to manually enter the house (and the streets, of course, just in case), but in a format that, in subsequent updates of the database, we could match this entry, and bind the corresponding GUID . <br>  For geocoding, I connected Yandex.  In our city he is now the best.  So, the address from the PDF is first parsed on the street, house, floor, apartment, and so on, then we look in the database if there is this house, we look at the coordinates.  If there are no coordinates, we will geocode, checking for ~ 30 km from the city center, since some points appear in the Far East or Siberia, and there is no settlement at all.  With this glitch, Yandex did not understand. <br><br>  If there is no such address, then we look at the previous uploads.  Suddenly, this combination of ‚Äústreet-house‚Äù has already been encountered, then we take the coordinates from there.  That is, if the street, for example, is written in the original database with an error, then it is enough to fix it 1 time, and not in each new order. <br>  Displays addresses using Yandex cards via api 1.1.  It does not require a developer ID for all the needs that I needed.  The truth was a serious limitation for TWebBrowser (a component that displays any web page, in this case a map) in it you can run any script from the main program at the right time, but it is not possible to accept the data in any form.  However, there is an interesting hack - when you need to accept data, you need to execute the script: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplyPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-string"><span class="hljs-string">'http://ya.ru/1.htm?&amp;P&amp;&amp;'</span></span>; text = text + <span class="hljs-string"><span class="hljs-string">'['</span></span> + placemark.getGeoPoint().getY(); text = text + <span class="hljs-string"><span class="hljs-string">','</span></span> + placemark.getGeoPoint().getX()+<span class="hljs-string"><span class="hljs-string">']'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location = text; };</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">And in:</b> <div class="spoiler_text">  Run the script: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CMapElement</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplyEditPoint</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> assigned(control) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF CLIENT_BUILD}</span></span> (control <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TTMSFMXWebBrowser).ExecuteJavascript(<span class="hljs-string"><span class="hljs-string">'ApplyPoint();'</span></span>); <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  And then: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CMapElement</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WebBrowser1DidFinishLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ASender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s,s2 : <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; p : integer; co : ArrMapCoord; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> assigned(control) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF CLIENT_BUILD}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$IFDEF MSWINDOWS}</span></span> s :=(control <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TTMSFMXWebBrowser).FWebBrowser.GetRealURL; <span class="hljs-meta"><span class="hljs-meta">{$ELSE}</span></span> assert(false); <span class="hljs-meta"><span class="hljs-meta">{$endif}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos(<span class="hljs-string"><span class="hljs-string">'ya.ru'</span></span>, s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> AlreadyReload <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> p := Pos(<span class="hljs-string"><span class="hljs-string">'?&amp;'</span></span>,s); delete(s,<span class="hljs-number"><span class="hljs-number">1</span></span>,p+<span class="hljs-number"><span class="hljs-number">1</span></span>); s2 := s; p := Pos(<span class="hljs-string"><span class="hljs-string">'&amp;&amp;'</span></span>,s); delete(s,<span class="hljs-number"><span class="hljs-number">1</span></span>,p+<span class="hljs-number"><span class="hljs-number">1</span></span>); delete(s2,p,<span class="hljs-number"><span class="hljs-number">9999</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s2 = <span class="hljs-string"><span class="hljs-string">'P'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment">//   (  ) begin WeEditPoint := false; self.DecodePolyString(s,co); if Length(co) = 1 then begin AddressPoint.la := co[0].la; AddressPoint.lo := co[0].lo; end; AlreadyReload := true; end else if s2 = 'R' then //   begin WeCalcRoute := false; if Assigned(g_CurrentScriptRunner) then begin g_CurrentScriptRunner.OnExternalAction('MapRouteDist',s); end; end else if StrToInteger(s2,p) then begin Polys[p-1].Poly := s; end; AlreadyReload := true; LoadMap; end; MapLoaded := true; {$ENDIF} end;</span></span></code> </pre> <br></div></div><br>  That is, we begin to load the page with the parameters that are encoded in the url, and at the call-back stage, we filter this moment.  Such a hack makes using a browser in Delphi very flexible: without problems, move the marker on the map, find out the length of the route, edit the delivery geopoligons, and so on. <br><br>  Well, it's all necessary to somehow link.  I wanted to make not just an ERP system for a specific customer.  I wanted it to be quite universal, to be configured from the configuration file, and all the logic and interfaces were not tied to the executable file itself.  Now the entire configuration is contained in a single xml file.  This file with the entire structure of the database, with all the interfaces and scripts is read by the server, and then the necessary parts are given to the clients. <br><br>  I also wrote an editor for the interfaces and event handler scripts.  Separate scripts are executed when changing any field of certain tables, checking the possibility of this change, and also produce related things (generation of receivers for example).  All components of their own, as they have very different properties than the standard.  For example, in the columns of the tables, it is immediately indicated what to withdraw, as well as to display text or an icon, for example, card payments / cash. <br><br>  The script system was written using <a href="http://alexboiko.narod.ru/prod.html">Pascalc</a> .  The library is over 15 years old, but it is very successful: lightweight, easily expandable and modifiable for any need.  Therefore, we enable the compiler directive to follow the Pascal standard on mobile devices <br> <code>{$ZEROBASEDSTRINGS OFF}</code> <br> <br>  We make several edits like Destroy-&gt; Free, remove the use of win api and here the scripts work without any problems under any OS, and the library will process such a script: <br><br><div class="spoiler">  <b class="spoiler_title">Script example</b> <div class="spoiler_text"><pre> <code class="delphi hljs">CurOrderState := GetNewValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'OrderState'</span></span>); LastOrderState := GetOldValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'OrderState'</span></span>); IsCashbackOnCurier := GetNewValue(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'CashbackOnDeliverer'</span></span>) = <span class="hljs-string"><span class="hljs-string">'True'</span></span>; PayType := GetNewValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'PayType'</span></span>); OldPayType := GetOldValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'PayType'</span></span>); OrderTurn := GetNewValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'Turn'</span></span>); CurTurn := GetConstantValue(<span class="hljs-string"><span class="hljs-string">'CurrentTurn'</span></span>); OrderNo := GetNewValue(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'OrderNo'</span></span>); OrderPrice := GetNewValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'Price'</span></span>); PaySum := GetNewValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'PaySum'</span></span>); LastPaySum := GetOldValueF(<span class="hljs-string"><span class="hljs-string">'Orders'</span></span>,<span class="hljs-string"><span class="hljs-string">'PaySum'</span></span>); CurTurn := GetConstantValue(<span class="hljs-string"><span class="hljs-string">'CurrentTurn'</span></span>); CurCashbox := GetConstantValue(<span class="hljs-string"><span class="hljs-string">'CurrentCashbox'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OrderTurn &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (OrderTurn &lt;&gt; CurTurn) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'      .  ‚Ññ'</span></span>+IntToStr(OrderNo)); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LastOrderState = <span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LastOrderState = <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LastOrderState &lt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (CurOrderState = <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> TransactionCanAccept; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CurOrderState &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (CurTurn &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'  .     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CurOrderState &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (CurCashbox &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (CurOrderState &lt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ShowMessage(<span class="hljs-string"><span class="hljs-string">'  .     '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,     . if IsCashbackOnCurier then begin if PaySum &lt;&gt; LastPaySum then begin ShowMessage('    '); exit; end; Price := GetNewValueF('Orders','Price'); LastPrice := GetOldValueF('Orders','Price'); if Price &lt;&gt; LastPrice then begin ShowMessage('    '); exit; end; end; //   if (CurOrderState &gt;= 6) and (CurOrderState &lt; 8) and (PayType = 1) and (not IsCashbackOnCurier) then begin if (PaySum - OrderPrice) &gt; 0 then begin ss := '    ‚Ññ'+IntToStr(OrderNo); CreateCashboxDoc(ss,1,OrderPrice - PaySum); IsCashbackOnCurier := True; SetValue('Orders','CashbackOnDeliverer',True); end; end; //      if (CurOrderState &lt; 6) and IsCashbackOnCurier then begin if (PaySum - OrderPrice) &gt; 0 then begin CreateCashboxDoc('     ‚Ññ'+IntToStr(OrderNo),1,PaySum - OrderPrice); IsCashbackOnCurier := False; SetValue('Orders','CashbackOnDeliverer',False); end; end; //    if (CurOrderState &gt;= 8) and IsCashbackOnCurier then begin if (PaySum - OrderPrice) &gt; 0 then begin ss := '    ‚Ññ'+IntToStr(OrderNo); CreateCashboxDoc(ss,1,PaySum - OrderPrice); IsCashbackOnCurier := False; SetValue('Orders','CashbackOnDeliverer',False); end; end; //      if (CurOrderState = 9) and (LastOrderState &lt;&gt; 9) and (PayType = 1) then begin ss := '    ‚Ññ'+IntToStr(OrderNo); CreateCashboxDoc(ss,2,OrderPrice); end; //           if (LastOrderState &lt; 3) and (CurOrderState &gt;= 3) then begin if CurTurn &lt;= 0 then begin ShowMessage('  .    .'); exit; end; SetValue('Orders','Turn',CurTurn); CurFilial := GetConstantValue('FilialID'); SetValue('Orders','Filial',CurFilial); end; if (CurOrderState &lt;= 2) and (LastOrderState &gt; 2) then begin SetValue('Orders','Turn',0); end; TransactionCanAccept;</span></span></code> </pre><br></div></div><br>  That is, there will be a check of the shift, the ticket office, if necessary, parishioners / consumables will be discharged, etc.  Also, if you change something in this algorithm, you do not need to re-recompile the program and update everything everywhere.  Enough for the client to re-sign.  Unfortunately, there was some haste in the case of prescribing an API for scripts.  Therefore, for example, the constants specified in the tables in the databases here are just numeric values.  But since this can be rewritten at any time, and the code is not complicated at all and not large, I decided to leave it for now. <br><br>  The next important case is the operator‚Äôs program.  All data is in the cloud, you need to receive them without delay, generate changes and so on.  I decided to get away from the connection with the server in real time.  Why do you need to drag the same record 100 times, if you can cache it in RAM, and apply at any time? <br>  I preempt all actual orders, customers, addresses, etc., into memory. That is, not the whole table, which would be stupid, and the memory will end quickly, but only that part of the table that is needed.  Like the cache in the processor.  If there is data in it, we‚Äôll contact you right away; if not, you‚Äôll have to wait until the server returns it.  The mechanism of ‚Äúsubscribing to changes‚Äù of tables was also registered: if a record of a table has changed, all subscribers will be notified about this with new data.  As a result, the comfort of working with the application in terms of latency has become maximum.  Reaction to changes in the filter, reordering, opening an order, etc. - all instantly. <br><br>  Then a separate courier application was created.  It sends the track to the server in the background.  That is, the operator can observe the movement of couriers in real time.  Also, to confirm delivery of the order, the courier must be within a certain radius from the point of delivery.  If at this moment there is no Internet, the program will transmit information that the order is delivered as soon as the Internet appears.  Naturally, you can run the Yandex-navigator from the program, which will automatically pave the way to the address;  You can view all the addresses on the map or call the customer by pressing 2 buttons, and so on. <br><br>  All this was tested and earned on one branch ‚Äúin combat‚Äù conditions.  There were no complaints.  More precisely, at first there were a couple of problems with the courier application - it did not work very responsively if the Internet connection was bad.  I additionally cached data, made a series of optimizations, and everything began to work without any lags. <br><br>  But the project did not receive further development.  The customer indicated the following reasons: <br><br><ol><li>  Run ‚Äúon the cold‚Äù courier application 4 seconds.  Too long. </li><li>  It is necessary to change the programming language and completely rewrite everything because of claim 1. </li></ol><br>  On this we parted. <br><br>  Such is the story.  I now have not fully completed the system for the restaurant business with delivery and a hole in the budget.  Now I think what to do with it.  Throw - sorry.  But the market is very narrow and quite closed. </div><p>Source: <a href="https://habr.com/ru/post/345534/">https://habr.com/ru/post/345534/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345524/index.html">How the concept helps not to get stuck in the development of a new product for years</a></li>
<li><a href="../345526/index.html">Modify Python in 6 minutes</a></li>
<li><a href="../345528/index.html">Personal Financial Management System</a></li>
<li><a href="../345530/index.html">Avito X: people - people</a></li>
<li><a href="../345532/index.html">Building a RESTful web API on the InterSystems platform - 2</a></li>
<li><a href="../345538/index.html">40-year-old taxi driver from Tambov became a programmer</a></li>
<li><a href="../345542/index.html">How changing two lines of code can take several days</a></li>
<li><a href="../345546/index.html">Asynchronous loading of large datasets into Tensorflow</a></li>
<li><a href="../345550/index.html">How EdTech Leaders Earn</a></li>
<li><a href="../345552/index.html">Service Workers. Instructions for use</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>