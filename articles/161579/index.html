<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>It‚Äôs possible to take and make an MFP from a cheap scanner in GNU \ Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The challenge is to help your company save money. Do not buy expensive xerox 3300mfp MFPs for ~ 22 thousand rubles, but do with improvised or cheaper ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>It‚Äôs possible to take and make an MFP from a cheap scanner in GNU \ Linux</h1><div class="post__text post__text-html js-mediator-article">  The challenge is to help your company save money.  Do not buy expensive xerox 3300mfp MFPs for ~ 22 thousand rubles, but do with improvised or cheaper means. <br><br>  <b>Tasks:</b> <br>  1. Scan to a network folder <br>  2. Photocopy documents <br>  3. Make pdf from scanned image <br><br>  <b>What we have:</b> <br>  1. PC running Kubuntu 12.04.1x64 (Test version. In the future there will be a transfer to a diskless nettop on an atom'e + Ubuntu (Centos?) Server) <br>  2. Already old HP p1505n printer <br>  3. HP Scanjet G2710 Scanned Trial 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Before taking on the task, it was necessary to find out what the cheapest scanners are in stock in my city, and whether <a href="http://ru.wikipedia.org/wiki/SANE">SANE</a> has them in the <a href="http://www.sane-project.org/sane-supported-devices.html">list of supported models</a> . <br>  The choice fell on 2 scanners, G2710 and BearPaw.  HP was chosen based on the fact that under BearPaw it is necessary to upload a file with drivers, and we need the easiest option.  It is not known how much this file will be stored on file hosting services, but if suddenly what happens, it is better to have a ‚Äúsparse‚Äù solution. <br><br>  After studying the forums, the solution was found quickly.  A bunch of sane + <a href="http://scanbuttond.sourceforge.net/">scanbuttond is required</a> .  Despite outdated information on the <a href="http://scanbuttond.sourceforge.net/">official website scanbuttond</a> , the latest builds, at least in turnips, are more recent.  Both utilities are in standard repositories.  Used them without any PPA. <br><br>  Versions of utilities: <br><img src="https://habrastorage.org/storage2/561/d7a/50e/561d7a50e53faf98d592bcd5e3e8f9d2.png"><br><br>  Through sane, the scanner earned without any dancing with a tambourine.  But the question arose - how to use the 3 buttons on the board?  This is where scanbuttond helps us.  We put the utility.  Rule the config.  In default Ubunt, it is located in /etc/scanbuttond/initscanner.sh.example.  Copy the example to the working version (I use vi, so copy-paste carefully, don't forget to change vi to the name of your favorite editor): <br><pre><code class="bash hljs">cp /etc/scanbuttond/initscanner.sh{.example,} &amp;&amp; vi /etc/scanbuttond/initscanner.sh</code> </pre>  and write to the end of the line <br><pre> <code class="bash hljs">scanimage -L</code> </pre><br>  We save. <br>  We connect the scanner, we do sane-find-scanner.  If everything is ok, we run scanbuttond in the terminal with the -f key and press the buttons on the scanner (after running scanbuttond -f, I have ~ 7 seconds to go before it starts processing clicks). <br><br><img src="https://habrastorage.org/storage2/7d0/79e/d1f/7d079ed1f71d604dd03acbce84d3cf70.png"><br><br>  By "exhaust" you can see what number each button has.  We write or memorize their numbers, after which we edit the configuration of handling clicks. <br><pre> <code class="bash hljs">cp /etc/scanbuttond/buttonpressed.sh{.example,} &amp;&amp; vi /etc/scanbuttond/buttonpressed.sh</code> </pre><br><br>  The developer (s) tried and threw us some ready-made examples that will help us implement our plans. <br>  On line 16 we have two variables of interest - TMPFILE and TMPFILE_PDF.  For them we prescribe the path to where the scanned documents and documents converted into pdf will be placed, respectively. <br><br>  For example: <br><br><pre> <code class="bash hljs">TMPFILE=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SAVEPATH}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DATE1}</span></span></span><span class="hljs-string">scan.jpeg"</span></span> TMPFILE_PDF=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SAVEPATH}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DATE1}</span></span></span><span class="hljs-string">scan.pdf"</span></span></code> </pre><br><br>  The variables $ DATE1, $ DATE2 and $ SAVEPATH are written by me above and look like this: <br><pre> <code class="bash hljs">DATE1=$(date +%Y_%m_%d_%H%M%S) DATE2=$(date +%Y_%m_%d_%H:%M:%S) SAVEPATH=<span class="hljs-string"><span class="hljs-string">"/home/panda/Scan/"</span></span></code> </pre><br>  SAVEPATH, of course, can be anything.  Well, or almost any.  It is planned to use the connected network folder via fstab, so there should be no problems. <br>  I did not touch the remaining 2 variables TMPFILE_PS and LOCKFILE, because their default values ‚Äã‚Äãcompletely suit me. <br><br>  Now for the button settings.  I have it as follows <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 1) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DATE2</span></span></span><span class="hljs-string"> -- Button 1 has been pressed on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -ne <span class="hljs-string"><span class="hljs-string">'\007'</span></span> &gt; /dev/null 2&gt;&amp;1 mplayer /usr/share/sounds/KDE-K3B-Insert-Medium.ogg &gt; /dev/null 2&gt;&amp;1 scanimage --resolution 300 --device-name <span class="hljs-variable"><span class="hljs-variable">$2</span></span> --mode Color -x 210 -y 297 | pnmtops -width=8.27 -height=11.69 &gt; <span class="hljs-variable"><span class="hljs-variable">$TMPFILE_PS</span></span> ps2pdf <span class="hljs-variable"><span class="hljs-variable">$TMPFILE_PS</span></span> <span class="hljs-variable"><span class="hljs-variable">$TMPFILE_PDF</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DATE2</span></span></span><span class="hljs-string"> -- PDF create done"</span></span> ;; 2) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DATE2</span></span></span><span class="hljs-string"> -- Button 2 has been pressed on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -ne <span class="hljs-string"><span class="hljs-string">'\007'</span></span> &gt; /dev/null 2&gt;&amp;1 mplayer /usr/share/sounds/KDE-K3B-Insert-Medium.ogg &gt; /dev/null 2&gt;&amp;1 SCAN_OPTIONS=<span class="hljs-string"><span class="hljs-string">"--resolution 300"</span></span> scanimage --device-name <span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-variable"><span class="hljs-variable">$SCAN_OPTIONS</span></span> | pnmtops -width=8.27 -height=11.69 | lpr -J <span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-variable"><span class="hljs-variable">$PRINTER</span></span> lockfile-remove <span class="hljs-variable"><span class="hljs-variable">$LOCKFILE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DATE2</span></span></span><span class="hljs-string"> -- Print done"</span></span> ;; 3) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DATE2</span></span></span><span class="hljs-string"> -- Button 3 has been pressed on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -ne <span class="hljs-string"><span class="hljs-string">'\007'</span></span> &gt; /dev/null 2&gt;&amp;1 mplayer /usr/share/sounds/KDE-K3B-Insert-Medium.ogg &gt; /dev/null 2&gt;&amp;1 scanimage --resolution 300 --mode Color --format=jpeg -x 210 -y 297 --device-name <span class="hljs-variable"><span class="hljs-variable">$2</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">$TMPFILE</span></span> convert <span class="hljs-variable"><span class="hljs-variable">$TMPFILE</span></span> -quality 70 <span class="hljs-variable"><span class="hljs-variable">$TMPFILE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DATE2</span></span></span><span class="hljs-string"> -- Scan image done"</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre><br><br>  From the code it is clear that the first button makes a PDF from the received image, the second one scans and prints to the printer by default (photocopy), and the third one simply scans. <br>  <b>Note:</b> It should be noted that when scanning I use the convert utility included in the imagemagic package.  Through it we get jpeg with an acceptable image size. <br><br>  I also have type events on each button. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -ne <span class="hljs-string"><span class="hljs-string">'\007'</span></span> &gt; /dev/null 2&gt;&amp;1</code> </pre><br>  and <br><pre> <code class="bash hljs">mplayer /usr/share/sounds/KDE-K3B-Insert-Medium.ogg &gt; /dev/null 2&gt;&amp;1</code> </pre><br><br>  The first beeps speaker (which is relevant for the server without X), and the second through mplayer displays an audio notification (relevant for machines with X, since the first item for some reason works only from tty {1-6}).  This is done in order to understand that the button on the scanner was pressed.  Because the buttons are different, sometimes they are crooked and it is not clear if the button is pressed or not.  It is clear that all this can be commented out or left to taste. <br><br>  You can enable beeper by commenting out lines in /etc/modprobe.d/blacklist.conf <br><br><pre> <code class="bash hljs">blacklist snd_pcsp</code> </pre><br>  and <br><pre> <code class="bash hljs">blacklist pcspkr</code> </pre><br><br>  Those.  should look like this: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#blacklist snd_pcsp</span></span></code> </pre><br>  and <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#blacklist pcspkr</span></span></code> </pre><br><br>  or install the beep package and invoke it in a script. <br><br>  It remains to write all this miracle in autorun.  Create the /etc/init.d/scan file and write to it: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash killall scanbuttond scanbuttond -f &gt;&gt; /home/panda/Scan/scanlog.log 2&gt;&amp;1 &amp;</span></span></code> </pre><br><br>  I made myself logging, which looks like this: <br><br><img src="https://habrastorage.org/storage2/c95/186/cdd/c95186cdd6593a313e4fe9a2ab704ff2.png"><br><br>  You can redirect output to / dev / null, and to / var / log / as you wish.  My business is to offer;) <br><br>  We give the right to perform and write in rc.d: <br><pre> <code class="bash hljs">chmod +x /etc/init.d/scan &amp;&amp; update-rc.d scan defaults 80</code> </pre><br><br>  Actually on this setting is over.  Where to put images, logging format, the availability of it - it all depends on your imagination, the benefit of any script can be specified in scanbuttond. <br><br>  <b>Total:</b> <br>  This method is suitable for those places where there is already a printer and a PC on which this whole thing can be hung.  In order not to buy more expensive multifunction devices, it is easier to buy a scanner.  If you buy a nettop + printer + scanner, then the prices in our city are: <br>  Nettop ~ 10 000 r <br>  Printer ~ 1 550 r <br>  Scanner ~ 3500 r <br><br>  Total ~ 15 000 rubles (if you take everything from scratch) against ~ 22 000 rubles for a network multifunction device (with the function to scan into a network folder) that we took to the departments.  For myself, I solved the problem with savings, because  took only a scanner. <br><br>  <b>Thanks for attention.</b> <br><br>  <b>PS</b> Full listing /etc/scanbuttond/buttonpressed.sh cleared of all superfluous: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh DATE1=$(date +%Y_%m_%d_%H%M%S) DATE2=$(date +%Y_%m_%d_%H:%M:%S) SAVEPATH="/home/panda/Scan/" TMPFILE="${SAVEPATH}${DATE1}scan.jpeg" TMPFILE_PDF="${SAVEPATH}${DATE1}scan.pdf" TMPFILE_PS="/tmp/scan.ps" LOCKFILE="/tmp/scan.lock" # Lock file handling and GNOME examples for buttons 2, 3, 4 below contributed # by Lutz M√ºller &lt;lutz@topfrose.de&gt;. if ! lockfile-create --retry 2 $LOCKFILE; then echo "$DATE1 -- Error: scanning already in progress for $2" exit fi rm -f $TMPFILE rm -f $TMPFILE_PDF rm -f $TMPFILE_PS case $1 in 1) echo "$DATE2 -- Button 1 has been pressed on $2" echo -ne '\007' &gt; /dev/null 2&gt;&amp;1 mplayer /usr/share/sounds/KDE-K3B-Insert-Medium.ogg &gt; /dev/null 2&gt;&amp;1 scanimage --resolution 300 --device-name $2 --mode Color -x 210 -y 297 | pnmtops -width=8.27 -height=11.69 &gt; $TMPFILE_PS ps2pdf $TMPFILE_PS $TMPFILE_PDF echo "$DATE2 -- PDF create done" ;; 2) echo "$DATE2 -- Button 2 has been pressed on $2" echo -ne '\007' &gt; /dev/null 2&gt;&amp;1 mplayer /usr/share/sounds/KDE-K3B-Insert-Medium.ogg &gt; /dev/null 2&gt;&amp;1 SCAN_OPTIONS="--resolution 300" scanimage --device-name $2 $SCAN_OPTIONS | pnmtops -width=8.27 -height=11.69 | lpr -J $2 $PRINTER lockfile-remove $LOCKFILE echo "$DATE2 -- Print done" ;; 3) echo "$DATE2 -- Button 3 has been pressed on $2" echo -ne '\007' &gt; /dev/null 2&gt;&amp;1 mplayer /usr/share/sounds/KDE-K3B-Insert-Medium.ogg &gt; /dev/null 2&gt;&amp;1 scanimage --resolution 300 --mode Color --format=jpeg -x 210 -y 297 --device-name $2 &gt; $TMPFILE convert $TMPFILE -quality 70 $TMPFILE echo "$DATE2 -- Scan image done" ;; esac lockfile-remove $LOCKFILE</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/161579/">https://habr.com/ru/post/161579/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161569/index.html">GTA: Vice City came to iOS and Android</a></li>
<li><a href="../161571/index.html">Who is joking at Hollywood studios?</a></li>
<li><a href="../161573/index.html">After the planes and rules</a></li>
<li><a href="../161575/index.html">Tulpa - pocket schizophrenia for geeks or a real imaginary friend</a></li>
<li><a href="../161577/index.html">New File button on Github</a></li>
<li><a href="../161581/index.html">Inline-block as a replacement for float</a></li>
<li><a href="../161583/index.html">We delete old unnecessary DHCP reservations of IP addresses</a></li>
<li><a href="../161585/index.html">In Russian iTunes Store got pornography from the domain .XXX</a></li>
<li><a href="../161591/index.html">AWS CLI utilities now for PowerShell</a></li>
<li><a href="../161595/index.html">StoreVirtual - a new name for Lefty</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>