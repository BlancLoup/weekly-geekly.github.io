<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating audio plug-ins, part 5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All posts series: 
 Part 1. Introduction and setup 
 Part 2. Learning Code 
 Part 3. VST and AU 
 Part 4. Digital Distortion 
 Part 5. Presets and GUI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating audio plug-ins, part 5</h1><div class="post__text post__text-html js-mediator-article">  All posts series: <br>  <a href="http://habrahabr.ru/post/224911/">Part 1. Introduction and setup</a> <br>  <a href="http://habrahabr.ru/post/225019/">Part 2. Learning Code</a> <br>  <a href="http://habrahabr.ru/post/225457/">Part 3. VST and AU</a> <br>  <a href="http://habrahabr.ru/post/225751/">Part 4. Digital Distortion</a> <br>  <a href="http://habrahabr.ru/post/225755/">Part 5. Presets and GUI</a> <br>  <a href="http://habrahabr.ru/post/226439/">Part 6. Signal synthesis</a> <br>  <a href="http://habrahabr.ru/post/226573/">Part 7. Receive MIDI Messages</a> <br>  <a href="http://habrahabr.ru/post/226823/">Part 8. Virtual Keyboard</a> <br>  <a href="http://habrahabr.ru/post/227475/">Part 9. Envelopes</a> <br>  <a href="http://habrahabr.ru/post/227601/">Part 10. Refinement GUI</a> <br>  <a href="http://habrahabr.ru/post/227791/">Part 11. Filter</a> <br>  <a href="http://habrahabr.ru/post/227827/">Part 12. Low-frequency oscillator</a> <br>  <a href="http://habrahabr.ru/post/228267/">Part 13. Redesign</a> <br>  <a href="http://habrahabr.ru/post/231513/">Part 14. Polyphony 1</a> <br>  <a href="http://habrahabr.ru/post/231923/">Part 15. Polyphony 2</a> <br>  <a href="http://habrahabr.ru/post/232153/">Part 16. Antialiasing</a> <br><hr><br><br>  Let's add some presets for the plugin and create a [relatively] nice interface. <br><a name="habracut"></a><br><h2>  Presets </h2><br>  Preset - this is the setting that allows you to store specific values ‚Äã‚Äãof the parameters.  At the moment, in our code, presets consist of names and values ‚Äã‚Äãfor all parameters, but, as we will see later, other data can be stored here.  Presets are sometimes called programs. <br><br>  First, let's make the GUI window wider.  Change the corresponding constant in <i>resource.h</i> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// GUI default dimensions #define GUI_WIDTH 400</span></span></code> </pre> <br><br>  In <i>DigitalDistortion.h, we will</i> declare a <code>private</code> member function of the class: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> mThreshold; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePresets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;   DigitalDistortion.cpp  <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DigitalDistortion::CreatePresets() { MakePreset(<span class="hljs-string"><span class="hljs-string">"clean"</span></span>, <span class="hljs-number"><span class="hljs-number">100.0</span></span>); MakePreset(<span class="hljs-string"><span class="hljs-string">"slightly distorted"</span></span>, <span class="hljs-number"><span class="hljs-number">80.0</span></span>); MakePreset(<span class="hljs-string"><span class="hljs-string">"woooo"</span></span>, <span class="hljs-number"><span class="hljs-number">40.0</span></span>); MakePreset(<span class="hljs-string"><span class="hljs-string">"waaaa"</span></span>, <span class="hljs-number"><span class="hljs-number">20.0</span></span>); MakePreset(<span class="hljs-string"><span class="hljs-string">"buzzz!!!"</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>); }</code> </pre><br><br>  <code>MakePreset</code> takes the preset name and values ‚Äã‚Äãfor all parameters as arguments.  The order of the arguments is defined in <code>enum EParams</code> at the top of the file. <br>  Note that the parameter values ‚Äã‚Äãvary from 0 to 100, not from 0 to 1. These values ‚Äã‚Äãrefer to the <code>kThreshold</code> parameter, not to the <code>mThreshold</code> variable. <br><br>  Instead of calling the <code>MakeDefaultPreset</code> function at the end of the constructor, write a call to <code>CreatePresets</code> : <br><br><pre> <code class="cpp hljs">DigitalDistortion::DigitalDistortion(IPlugInstanceInfo instanceInfo) : IPLUG_CTOR(kNumParams, kNumPrograms, instanceInfo), mThreshold(<span class="hljs-number"><span class="hljs-number">1.</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// ... CreatePresets(); }</span></span></code> </pre><br><br>  Finally, we need to change the constant that is passed when the base class constructor is called (this is somewhere around the 13th line): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> kNumPrograms = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre><br><br>  If the value of this constant is greater than the actual number of presets, the rest will simply be called ‚ÄúEmpty‚Äù. <br><br>  Run the build of VST2.  You may have to remove the plugin from the track and reload it in order for the freshly written presets to appear.  They can be changed using the drop-down list, which is located directly above the plug-in GUI.  Try different - the handle rotates according to the value in the preset. <br>  I remind you that <code>OnParamChange</code> is called when each parameter changes. <br>  To the right of the drop-down menu there is a button that opens the presets menu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d69/37c/227/d6937c2279c9f9de562bc4ea196f7772.jpg"><br><br>  Try renaming the preset and twisting the knob.  Its position will not be remembered if you remove the plugin from the track and load it again.  To save this data, click the <i>‚ÄúExport VST patch / bank file (.fxp / .fxb) ...‚Äù</i> and save the <i>test.fxb</i> file to your desktop.  Now remove the plugin, add it again and load this file with the settings. <br>  VST plug-ins for storing a separate preset use <i>FXP</i> format, and <i>FXB</i> for storing a bank of presets. <br><br>  Run the target AU (you may first have to go to the Edit Scheme so that it runs along with the host).  REAPER defaults to ‚ÄúNo preset‚Äù, but in the drop-down list all the presets are in place and everything works as it should.  Saving presets in the plugin works differently - we cannot import and export preset banks.  The processes of saving / loading are described by Oli Larkin in more detail in <a href="http://forum.cockos.com/showpost.php%3Fp%3D969598">this post</a> . <br><br>  It's time to finally start creating a beautiful interface! <br><br><h2>  GUI </h2><br>  We want to achieve this result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffa/516/2e7/ffa5162e78ba41c60171dd16542d7e6f.jpg"><br><br>  This is certainly not awesome cool, but we will learn how to add graphics and, even more interesting, how to make a rotating pen. <br>  Download <a href="">this tiff</a> with design.  Open in Photoshop (or whatever you like) and take a look at the different layers and groups. <br>  As you can see, the only thing that changes is a pen.  So the rest can be simply saved in one png: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cde/0cb/b2a/cde0cbb2a82a636190c3a49106cb25dc.png"><br><br><h3>  Add background for Mac builds </h3><br>  Save the picture above to your desktop.  In Xcode in Project Navigator, expand the <i>Resources</i> folder and drag the background image there: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/233/5f2/6fc/2335f26fc975969f5a7ea311b5d99c96.jpg"><br><br>  It is necessary to put a tick in front of the <i>Copy items in folder</i> and add our image for all targets: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7a/180/995/f7a1809951e3488c650475c061008f89.jpg"><br><br><h3>  Add background for builds on Windows </h3><br>  In Visual Studio, adding resources (such as graphics) is a bit different.  Adding for all Targets on Macs means that the image will be included in the <i>.app</i> , <i>.vst</i> and <i>.component files</i> that you provide to your users.  In Visual Studio, to do this, first drop our image into the project <i>\ resources \ img</i> subfolder, and then edit the <i>.rc</i> file in the project.  In this case, <i>DigitalDistortion.rc</i> .  His hat looks like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"resource.h"</span></span></span><span class="hljs-meta"> KNOB_ID PNG KNOB_FN</span></span></code> </pre><br><br>  First, <i>resource.h is</i> connected, so that all <code>#define</code> from it are available in this file.  The next line announces that a pen will be added.  To add a background, add this line: <br><br><pre> <code class="cpp hljs">BACKGROUND_ID PNG BACKGROUND_FN</code> </pre><br><br>  After a minute, add <code>BACKGROUND_ID</code> and <code>BACKGROUND_FN</code> to <i>resource.h</i> . <br>  Every time we add an image to the project, we need to add a similar line. <br><br><h3>  Background image </h3><br>  Let's pick up our picture in the plugin.  Somewhere around the 60th line in the <i>resource.h</i> file you need to resize the window: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// GUI default dimensions #define GUI_WIDTH 280 #define GUI_HEIGHT 230</span></span></code> </pre><br><br>  and add a unique ID and image file name: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Unique IDs for each image resource. #define KNOB_ID 101 #define BACKGROUND_ID 102 // Image resource locations for this plug. #define KNOB_FN "resources/img/knob.png" #define BACKGROUND_FN "resources/img/background.png"</span></span></code> </pre><br><br>  In <i>DigitalDistortion.cpp,</i> you need to change the constructor to use our file instead of red: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// pGraphics-&gt;AttachPanelBackground(&amp;COLOR_RED); pGraphics-&gt;AttachBackground(BACKGROUND_ID, BACKGROUND_FN);</span></span></code> </pre><br><br>  It was easy.  Let's collect the APP and admire the picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a07/d1e/690/a07d1e690c78d46cfa618ba3b1637fdf.jpg"><br><br><h3>  A pen </h3><br>  The handle is a little tricky.  It has a texture and reflections, it consists of several layers.  When you twist the knob, the metal rotates, but the lamp on the ceiling does not (hopefully).  So some components must rotate, and some related to lighting, should not.  Therefore, we can not save the pen as one picture and twist it in the process. <br>  I did this: the pen has a base that does not rotate;  on top of it is a metallic texture that rotates;  and on top of all this are reflections that do not rotate.  All three parts are presented separately (here I added a black background, just so that the borders and light parts could be seen): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c5/928/71f/1c592871febfe90566f87ba5f889ea7c.png"><br><br>  For our task there is a very good tool: KnobMan.  This is a free program, especially for creating pens.  <a href="http://www.g200kg.com/en/software/knobman.html">Download</a> , run, and open the <a href="">file</a> I prepared in it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/791/66c/e22/79166ce2223075fae06e63672b78bd39.jpg"><br><br>  All I did here was add three layers and slightly change some coordinates so that the metal texture rotates correctly.  If you want to understand the program better, read the <a href="http://www.g200kg.com/en/docs/knobman/overview.html">manual</a> . <br>  Export this handle (Cmd + E on Mac, Ctrl + E on Windows) and name the file knob.png (or download <a href="">mine</a> ).  In this png there are 128 frames for different positions of the handle, and only metal with an arrow rotates.  That is necessary. <br><br>  In Xcode, delete the existing <i>knob.png</i> (right click, <i>Delete</i> ).  In the dialog that appears, select <i>Move to Trash</i> .  Now drag the new <i>knob.png</i> into the <i>img</i> folder and do the same as we did with the background image. <br>  Since the file name has not changed, we do not need to change <i>resource.h</i> .  Switch to <i>DigitalDistortion.cpp</i> right away; change the <code>enum ELayout</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ELayout { kWidth = GUI_WIDTH, kHeight = GUI_HEIGHT, kThresholdX = <span class="hljs-number"><span class="hljs-number">79</span></span>, kThresholdY = <span class="hljs-number"><span class="hljs-number">62</span></span>, kKnobFrames = <span class="hljs-number"><span class="hljs-number">128</span></span> };</code> </pre><br><br>  As you can see, we don‚Äôt even have to specify for the WDL that the new pen is bigger.  We only need to specify the number of frames and set the coordinates. <br>  Start VST2 and see how the frames change when you turn the knob.  However, I was confused by the fact that the plugin is called distortion, and with the handle turned out 100%, we have clear sound. <br><br><h3>  Handle direction </h3><br><br>  Somewhere around the 90th row, you need to make changes: <br><br><pre> <code class="cpp hljs">mThreshold = <span class="hljs-number"><span class="hljs-number">1</span></span> - (GetParam(kThreshold)-&gt;Value() / <span class="hljs-number"><span class="hljs-number">100.</span></span>);</code> </pre><br><br>  To prevent division by zero, which we talked about earlier, you need to change the default value to <code>0</code> , and the maximum value to <code>99.99</code> (approximately line 30): <br><br><pre> <code class="cpp hljs">GetParam(kThreshold)-&gt;InitDouble(<span class="hljs-string"><span class="hljs-string">"Threshold"</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">99.99</span></span>, <span class="hljs-number"><span class="hljs-number">0.01</span></span>, <span class="hljs-string"><span class="hljs-string">"%"</span></span>);</code> </pre><br><br>  Now everything should work as it should.  From the semantic point of view, it would be good to rename the <code>Threshold</code> variable to something like <code>DistortionAmount</code> , since the only thing that represents the threshold value is the <code>mThreshold</code> variable. <br><br><h3>  Interim results </h3><br>  With a minimal amount of theoretical bells and whistles, we have created a working distortion with a custom interface.  This gave us a general idea of ‚Äã‚Äãwhat plugin development involves. <br>  Now that we have this understanding, we can proceed to more interesting things.  Next time I will talk about the synthesis of sound waves. <br><br>  Files with all the results of the work can be <a href="">downloaded</a> . <br><br><h3>  Additional materials </h3><br>  There are many free examples for KnobMan <a href="http://www.kvraudio.com/forum/viewtopic.php%3Ft%3D232629">here</a> and <a href="http://radorec.com/-skins/20-free-vst-knobs">here</a> . <br><br>  When creating the GUI, I used <a href="http://psd.tutsplus.com/tutorials/interface-tutorials/creating-a-cool-brushed-metal-surface-in-photoshop/">this</a> Photoshop tutorial.  Thanks to the author! <br><br>  And thanks <a href="http://www.g200kg.com/">g200kg</a> for KnobMan! <br><br>  Original articles: <br>  <a href="http://martin-finke.de/blog/articles/audio-plugins-006-presets/">martin-finke.de/blog/articles/audio-plugins-006-presets</a> <br>  <a href="http://martin-finke.de/blog/articles/audio-plugins-007-gui/">martin-finke.de/blog/articles/audio-plugins-007-gui</a> </div><p>Source: <a href="https://habr.com/ru/post/225755/">https://habr.com/ru/post/225755/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225741/index.html">UK rewrites the rules of the road under the "robot"</a></li>
<li><a href="../225743/index.html">Qualifying round of the Russian Code Cup 2014: results and analysis of tasks</a></li>
<li><a href="../225745/index.html">Python, tone shift and Pianoputer</a></li>
<li><a href="../225749/index.html">Do I need support LaTeX on Habr√©?</a></li>
<li><a href="../225751/index.html">Creating audio plug-ins, part 4</a></li>
<li><a href="../225757/index.html">The controversy around high-frequency trading is gaining momentum again</a></li>
<li><a href="../225761/index.html">Creating a game in front of your eyes - part 6: Let's talk about PR indie games</a></li>
<li><a href="../225763/index.html">It's time to donate your stethoscope to the museum.</a></li>
<li><a href="../225765/index.html">Gigabyte BRIX miniature PC for only $ 130</a></li>
<li><a href="../225767/index.html">Google Translate update (parts of speech and synonyms)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>