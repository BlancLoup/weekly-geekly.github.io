<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Registration and authorization of the user on the site - one click - through the custom Facebook button. 2017</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, I began to develop one project for the fan. The basic idea of ‚Äã‚Äãthe project is simple: a platform where everyone can bet on anything, make bets, d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Registration and authorization of the user on the site - one click - through the custom Facebook button. 2017</h1><div class="post__text post__text-html js-mediator-article">  So, I began to develop one project for the fan.  The basic idea of ‚Äã‚Äãthe project is simple: a platform where everyone can bet on anything, make bets, deals and WITHOUT any restrictions.  An entertaining project in its essence. <br><br>  And of course there was the question Convenient authorization of users with the least "friction".  After thinking a bit, I chose authorization through Facebook, but I think I‚Äôll not stop at this and you‚Äôll read some more articles, with authorization through Google Acc, VK and Tweet. <br><br><img src="http://easy-bet.org/image/habr.jpg" alt="image"><br>  So to the point!  I found several topics on the Internet that describe the issue of authorization, some information helped me, but I didn‚Äôt find one that would solve the task I had set, so, having completed the task, I decided to write this article. <br><a name="habracut"></a><br>  <b>MADE:</b> User registration in the database and his authorization on the site with one click of the Custom button (any picture to your taste) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  1. REGISTRATION OF AN APPLICATION IN FB: </h2><br>  <b>but.</b>  <a href="https://developers.facebook.com/apps/">https://developers.facebook.com/apps/</a> <br>  <b>b.</b>  We register the application, register the address of your site, the data acceptance page for the answer, and much more.  The interface is very friendly, Facebook loves us.  Therefore, I will not list everything and everything.  From there we will need the <u>application ID and site address.</u> <br><br><h2>  2. FRONT END: </h2><br>  I give a complete working example from my site.  By clicking on the link, the function is called: ‚Äúfb_login ()‚Äù, the function first checks ‚Äúis the user logged in to Facebook?‚Äù If YES, takes his ID and sends it to BackEnd, if NO, then calls the Facebook login form. <br><br>  fb_login () - initiates communication with the FB <br>  handle_fb_data () - is engaged in receiving and forwarding user data from FB to BackEnd <br><br><pre><code class="javascript hljs">&lt;a <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"fb_login_btn"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"fb_login();return false;"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/image/fb_login.png"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">border</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_fb_data</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">)</span></span>{ FB.api(<span class="hljs-string"><span class="hljs-string">'/me'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Successful login for: '</span></span> + response.name); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'  : '</span></span>+<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(response)); <span class="hljs-comment"><span class="hljs-comment">// alert('  : '+JSON.stringify(response)); $.ajax({ type: 'post', url: '/do/reg/fb', data: response, success: function(msg) { console.log(msg); if ((msg=='')||(msg=='')){window.location.reload();} }, error: function(){} }) }); } function fb_login(){ FB.getLoginStatus(function(response) { if (response.authResponse) { console.log('Welcome! Fetching your information.... '); handle_fb_data(response); } else { console.log('      ,   '); FB.login(function(response){ if (response.authResponse) { console.log('Welcome! Fetching your information.... '); handle_fb_data(response); } else { console.log('     '); } }); } }, { scope: 'email,id' }); } window.fbAsyncInit = function() { FB.init({ appId : '{  ID }', cookie : true, // enable cookies to allow the server to access // the session xfbml : true, // parse social plugins on this page version : 'v2.8' // use graph api version 2.8 }); }; // Load the SDK asynchronously (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/sdk.js"; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk')); &lt;/script&gt;</span></span></code> </pre> <br>  Well, actually, on the front-end everything, now consider BackEnd. <br><br><h2>  3. BEC AND </h2><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;session-&gt;userdata(<span class="hljs-string"><span class="hljs-string">'logged_in'</span></span>) != <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ){ <span class="hljs-comment"><span class="hljs-comment">// 1.   ,    . // 2.  ,  ,          FB_ID //  ,    // 3.     ,        // ,               , .. "" $query = $this-&gt;db-&gt;get_where('users', array('fb_id' =&gt; $_POST['id'])); if ($query-&gt;num_rows() &gt; 0) { foreach ($query-&gt;row_array() as $key =&gt; $value) { $userdata[$key] = $value; } $userdata["logged_in"] = true; //,         -  ,  ,     if ($this-&gt;session-&gt;userdata('bet_code_last') != false) { $data = array( 'start_user_id' =&gt; $userdata['id'] ); $this-&gt;db-&gt;where('bet_code', $this-&gt;session-&gt;userdata('bet_code_last')); $this-&gt;db-&gt;update('bet', $data); $this-&gt;session-&gt;sess_destroy(); } $this-&gt;session-&gt;set_userdata($userdata); echo ''; } else { $data = array( 'fb_id' =&gt; $_POST['id'], 'lang' =&gt; 'en', 'name' =&gt; $_POST['name'], ); // ,       ,         if( preg_match('/[-]/i', $_POST['name']) ){$data['lang']='ru';} $this-&gt;db-&gt;insert('users', $data); //      ,      ;) $data["logged_in"] = true; $this-&gt;session-&gt;set_userdata($data); echo ''; } }else{echo '  ';} }</span></span></code> </pre> <br>  In PHP code, functions are used to access the database from the Codeigniter framework.  Well, in general, I described the whole process, I hope that it is very clear and accessible. <br><br><h2>  Notes: </h2><br>  <b>1.</b> Then, with blood, he himself thought that it would be better to check the status first, and then call the login form (on the front-end), which was not in one of the descriptions explicitly. <br><br>  <b>2.</b> After the data is entered into the session, the page is still not updated, so I update it here with this line, in those moments when BackEnd confirms that it has done everything it needs: <br>  if ((msg == 'registered') || (msg == 'logged in')) {window.location.reload ();} <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/325514/">https://habr.com/ru/post/325514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325502/index.html">Spectral analysis of signals from non-linear links of ACS in Python</a></li>
<li><a href="../325504/index.html">We automate everything: the new version of OneBox Next (CRM + ERP) is available for free</a></li>
<li><a href="../325508/index.html">Posting 3CX on Google Compute Engine</a></li>
<li><a href="../325510/index.html">Teach TensorFlow to draw Cyrillic</a></li>
<li><a href="../325512/index.html">Report and presentations with Moscow JS in the Superjob office</a></li>
<li><a href="../325516/index.html">Conference DUMP-2017: Section "Testing"</a></li>
<li><a href="../325518/index.html">Authenticating OAuth2 in-app using Google Sign-In. Continuous access to Google APIs</a></li>
<li><a href="../325522/index.html">Bash scripts: start</a></li>
<li><a href="../325524/index.html">Do new GitHub terms of use conflict with copyright?</a></li>
<li><a href="../325526/index.html">Do we need neural networks?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>