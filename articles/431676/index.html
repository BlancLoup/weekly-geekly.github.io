<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tactful robot: can listen and does not interrupt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Speech recognition (hereinafter - ASR, Automatic Speech Recognition) is used when creating bots and / or IVR, as well as for automated polls. Voximpla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tactful robot: can listen and does not interrupt</h1><div class="post__text post__text-html js-mediator-article">  Speech recognition (hereinafter - ASR, Automatic Speech Recognition) is used when creating bots and / or IVR, as well as for automated polls.  Voximplant uses ASR provided by the ‚Äúcorporation of good‚Äù - Google recognition works quickly and with high accuracy, but ... As always, there is one nuance.  A person can pause even in short sentences, while we need a guarantee that the ASR will not take a pause as the end of the answer.  If the ASR thinks that the person has finished speaking, then after the ‚Äúanswer‚Äù the scenario can turn on voice synthesis with the following question - at the same time the person will continue to speak and get a bad user experience: the bot / IVR interrupts the person.  Today we will tell how to deal with it, so that your users are not upset by communicating with the iron assistants. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ez/dh/s6/ezdhs6vpm2jez3otuop_r8kc8n8.jpeg"></div><a name="habracut"></a><br><h2>  Concept </h2><br>  The goal is to ask a question and listen to the person, without interrupting and waiting for the end of his answer.  ASR is represented by a <a href="https://voximplant.com/docs/references/voxengine/asr">separate module</a> , where there is an <a href="https://voximplant.com/docs/references/voxengine/asr/asrevents">ASR.Result</a> event - it triggers when a person has finished speaking.  The specificity of the work of ASR from Google is that ASR.Result with the recognized text will return as soon as the person makes at least a short pause and google decides that the spoken phrase is recognized and completed. <br><br>  To give a person the ability to pause, you can use the <a href="https://voximplant.com/docs/references/voxengine/asr/asrevents">ASR.InterimResult</a> event.  In it, the ASR in the recognition process returns all the ‚Äúraw‚Äù text, correcting and changing it depending on the context - and so on until the ASR.Result is triggered.  Thus, an ASR.InterimResult event <b>is an indication that a person is currently saying something</b> .  We will focus only on him and see how long it does not come.  And intermediate recognized texts received from ASR.Result - add. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, it will look like this: <br><br><pre><code class="javascript hljs">asr.addEventListener(ASREvents.InterimResult, e =&gt; { clearTimeout(timer) timer = setTimeout(stop, <span class="hljs-number"><span class="hljs-number">3000</span></span>) }) asr.addEventListener(ASREvents.Result, e =&gt; { answer += <span class="hljs-string"><span class="hljs-string">" "</span></span> + e.text }) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br><h2>  We reveal the essence.  Timers </h2><br>  To work properly with pauses, you can create a special object: <br><br><pre> <code class="javascript hljs">timeouts = { <span class="hljs-attr"><span class="hljs-attr">silence</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">pause</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">duration</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre> <br>  After asking a question, a person often thinks for a few seconds.  The timer for silence at the very beginning is better to set 6-8 seconds, we will save the timer ID in the <b>timeouts.silence</b> parameter. <br><br>  The pauses in the middle of the answer are optimal in 3-4 seconds, so that the person could think, but did not suffer in anticipation, when he finished.  This is the <b>timeouts.pause</b> parameter. <br><br>  A general timer for the whole answer, <b>timeouts.duration,</b> is useful if we don‚Äôt want a person to talk for too long.  It will also protect us from cases when a person is in a noisy room with background voices that will be taken by us for the client's speech.  And also from the cases when we got on another robot that talks with our robot in a circle. <br><br>  So at the beginning of the script we connect the ASR module, declare variables and create a <b>timeouts</b> object: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(Modules.ASR) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> call, asr, speech = <span class="hljs-string"><span class="hljs-string">""</span></span> timeouts = { <span class="hljs-attr"><span class="hljs-attr">silence</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">pause</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">duration</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br><h2>  Incoming call </h2><br>  When an incoming call arrives in the script, the <a href="https://voximplant.com/docs/references/voxengine/appevents">AppEvents.CallAlerting</a> event is <a href="https://voximplant.com/docs/references/voxengine/appevents">fired</a> .  Create a handler for this event: answer the call, greet the client, start recognition after the greeting.  And let's also let the person kill the robot from the middle of the question asked (details - a little further). <br><br><div class="spoiler">  <b class="spoiler_title">AppEvents.CallAlerting handler</b> <div class="spoiler_text"><pre> <code class="javascript hljs">VoxEngine.addEventListener(AppEvents.CallAlerting, e =&gt; { call = e.call <span class="hljs-comment"><span class="hljs-comment">//    .     Connected call.answer() call.addEventListener(CallEvents.Connected, e =&gt; { call.say(",      . , ,        ?", Language.RU_RUSSIAN_FEMALE) //    4          setTimeout(startASR, 4000) //        call.addEventListener(CallEvents.PlaybackFinished, startSilenceAndDurationTimeouts) }); call.addEventListener(CallEvents.Disconnected, e =&gt; { VoxEngine.terminate() }) })</span></span></code> </pre> </div></div><br>  You can see that the <b>startASR</b> and <b>startSilenceAndDurationTimeouts</b> functions <b>are</b> <b>called</b> - <b>let</b> 's <b>look</b> at what it is and why. <br><br><h2>  Recognition and timeouts </h2><br>  Recognition is implemented in the <b>startASR</b> function.  It creates an ASR instance and sends the human voice to this instance, it also contains handlers for <a href="https://voximplant.com/docs/references/voxengine/asr/asrevents">ASREvents.InterimResult</a> and <a href="https://voximplant.com/docs/references/voxengine/asr/asrevents">ASREvents.Result events</a> .  As we said above, here we treat ASR.InterimResult as a sign that a person is saying.  The event handler clears the previously created timeouts, sets a new value for <b>timeouts.pause,</b> and finally stops the synthesized voice (like this, a person can interrupt the bot).  The ASREvents.Result handler simply concatenates all final answers in a <b>speech</b> variable.  Specifically, in this scenario, <b>speech</b> is not used at all, but if you wish, you can <a href="httprequestresult">transfer it</a> to your backend, for example. <br><br><div class="spoiler">  <b class="spoiler_title">startASR</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startASR</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ asr = VoxEngine.createASR({ <span class="hljs-attr"><span class="hljs-attr">lang</span></span>: ASRLanguage.RUSSIAN_RU, <span class="hljs-attr"><span class="hljs-attr">interimResults</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }) asr.addEventListener(ASREvents.InterimResult, e =&gt; { clearTimeout(timeouts.pause) clearTimeout(timeouts.silence) timeouts.pause = setTimeout(speechAnalysis, <span class="hljs-number"><span class="hljs-number">3000</span></span>) call.stopPlayback() }) asr.addEventListener(ASREvents.Result, e =&gt; { <span class="hljs-comment"><span class="hljs-comment">//    speech += " " + e.text }) //    ASR call.sendMediaTo(asr) }</span></span></code> </pre> </div></div><br>  The <b>startSilenceAndDurationTimeouts</b> function ... Records the values ‚Äã‚Äãof the corresponding timers: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startSilenceAndDurationTimeouts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ timeouts.silence = setTimeout(speechAnalysis, <span class="hljs-number"><span class="hljs-number">8000</span></span>) timeouts.duration = setTimeout(speechAnalysis, <span class="hljs-number"><span class="hljs-number">30000</span></span>) }</code> </pre> <br><h2>  And some more features </h2><br>  <b>SpeechAnalysis</b> stops recognition and analyzes text from <b>speech</b> (which is obtained from <b>ASREvents.Result</b> ).  If there is no text, then we repeat the question;  if there is text, then politely say goodbye and hang up. <br><br><div class="spoiler">  <b class="spoiler_title">speechAnalysis</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">speechAnalysis</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ASR stopASR() const cleanText = speech.trim().toLowerCase() if (!cleanText.length) { //     ,       , // ..     ,   , ,    handleSilence() } else { call.say( "   !  !", Language.RU_RUSSIAN_FEMALE ) call.addEventListener(CallEvents.PlaybackFinished, () =&gt; { call.removeEventListener(CallEvents.PlaybackFinished) call.hangup() }) } }</span></span></code> </pre> </div></div><br>  A <b>handleSilence</b> is responsible for repeating the question: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleSilence</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ call.say(<span class="hljs-string"><span class="hljs-string">",   . , ,        ?"</span></span>, Language.RU_RUSSIAN_FEMALE) <span class="hljs-comment"><span class="hljs-comment">//    3          setTimeout(startASR, 3000) call.addEventListener(CallEvents.PlaybackFinished, startSilenceAndDurationTimeouts) }</span></span></code> </pre> <br>  Finally, the helper function to stop the ASR: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopASR</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ asr.stop() call.removeEventListener(CallEvents.PlaybackFinished) clearTimeout(timeouts.duration) }</code> </pre> <br><h2>  Together </h2><br><div class="spoiler">  <b class="spoiler_title">script listing</b> <div class="spoiler_text"><div class="oembed"><script type="text/javascript" src="https://gist.github.com/52d8da94c147f3033f8e058ad9195f4b.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css"><div id="gist93369720" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-asr-js" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-asr-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-asr-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">require</span>(<span class="pl-smi">Modules</span>.<span class="pl-c1">ASR</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-asr-js-LC2" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-asr-js-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-k">let</span> call,</td>
      </tr>
      <tr>
        <td id="file-asr-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-asr-js-LC4" class="blob-code blob-code-inner js-file-line">    asr,</td>
      </tr>
      <tr>
        <td id="file-asr-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-asr-js-LC5" class="blob-code blob-code-inner js-file-line">    speech <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-asr-js-LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-asr-js-LC7" class="blob-code blob-code-inner js-file-line">timeouts <span class="pl-k">=</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-asr-js-LC8" class="blob-code blob-code-inner js-file-line">  silence<span class="pl-k">:</span> <span class="pl-c1">null</span>,</td>
      </tr>
      <tr>
        <td id="file-asr-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-asr-js-LC9" class="blob-code blob-code-inner js-file-line">  pause<span class="pl-k">:</span> <span class="pl-c1">null</span>,</td>
      </tr>
      <tr>
        <td id="file-asr-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-asr-js-LC10" class="blob-code blob-code-inner js-file-line">  duration<span class="pl-k">:</span> <span class="pl-c1">null</span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-asr-js-LC11" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-asr-js-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-asr-js-LC12" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-asr-js-LC13" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span>  CallAlerting ,       </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-asr-js-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">VoxEngine</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">AppEvents</span>.<span class="pl-smi">CallAlerting</span>, <span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-asr-js-LC15" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-asr-js-LC16" class="blob-code blob-code-inner js-file-line">  call <span class="pl-k">=</span> <span class="pl-smi">e</span>.<span class="pl-smi">call</span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-asr-js-LC17" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-asr-js-LC18" class="blob-code blob-code-inner js-file-line">  <span class="pl-c"><span class="pl-c">//</span>    .     Connected </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-asr-js-LC19" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">call</span>.<span class="pl-en">answer</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-asr-js-LC20" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">call</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">Connected</span>, <span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-asr-js-LC21" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">call</span>.<span class="pl-en">say</span>(<span class="pl-s"><span class="pl-pds">"</span>,      . , ,        ?<span class="pl-pds">"</span></span>, <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-asr-js-LC22" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-asr-js-LC23" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span>    4         </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-asr-js-LC24" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">setTimeout</span>(startASR, <span class="pl-c1">4000</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-asr-js-LC25" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span>       </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-asr-js-LC26" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">call</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, startSilenceAndDurationTimeouts)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-asr-js-LC27" class="blob-code blob-code-inner js-file-line">  });</td>
      </tr>
      <tr>
        <td id="file-asr-js-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-asr-js-LC28" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">call</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">Disconnected</span>, <span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-asr-js-LC29" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">VoxEngine</span>.<span class="pl-c1">terminate</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-asr-js-LC30" class="blob-code blob-code-inner js-file-line">  })</td>
      </tr>
      <tr>
        <td id="file-asr-js-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-asr-js-LC31" class="blob-code blob-code-inner js-file-line">})</td>
      </tr>
      <tr>
        <td id="file-asr-js-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-asr-js-LC32" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-asr-js-LC33" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">startASR</span>() {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-asr-js-LC34" class="blob-code blob-code-inner js-file-line">  asr <span class="pl-k">=</span> <span class="pl-smi">VoxEngine</span>.<span class="pl-en">createASR</span>({</td>
      </tr>
      <tr>
        <td id="file-asr-js-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-asr-js-LC35" class="blob-code blob-code-inner js-file-line">    lang<span class="pl-k">:</span> <span class="pl-smi">ASRLanguage</span>.<span class="pl-c1">RUSSIAN_RU</span>,</td>
      </tr>
      <tr>
        <td id="file-asr-js-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-asr-js-LC36" class="blob-code blob-code-inner js-file-line">    interimResults<span class="pl-k">:</span> <span class="pl-c1">true</span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-asr-js-LC37" class="blob-code blob-code-inner js-file-line">  })</td>
      </tr>
      <tr>
        <td id="file-asr-js-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-asr-js-LC38" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-asr-js-LC39" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">asr</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">ASREvents</span>.<span class="pl-smi">InterimResult</span>, <span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-asr-js-LC40" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">clearTimeout</span>(<span class="pl-smi">timeouts</span>.<span class="pl-smi">pause</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-asr-js-LC41" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">clearTimeout</span>(<span class="pl-smi">timeouts</span>.<span class="pl-smi">silence</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-asr-js-LC42" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-asr-js-LC43" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">timeouts</span>.<span class="pl-smi">pause</span> <span class="pl-k">=</span> <span class="pl-c1">setTimeout</span>(speechAnalysis, <span class="pl-c1">3000</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-asr-js-LC44" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">call</span>.<span class="pl-en">stopPlayback</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-asr-js-LC45" class="blob-code blob-code-inner js-file-line">  })</td>
      </tr>
      <tr>
        <td id="file-asr-js-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-asr-js-LC46" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-asr-js-LC47" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">asr</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">ASREvents</span>.<span class="pl-smi">Result</span>, <span class="pl-smi">e</span> <span class="pl-k">=&gt;</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-asr-js-LC48" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span>   </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-asr-js-LC49" class="blob-code blob-code-inner js-file-line">    speech <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">e</span>.<span class="pl-c1">text</span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-asr-js-LC50" class="blob-code blob-code-inner js-file-line">  })</td>
      </tr>
      <tr>
        <td id="file-asr-js-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-asr-js-LC51" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-asr-js-LC52" class="blob-code blob-code-inner js-file-line">  <span class="pl-c"><span class="pl-c">//</span>    ASR</span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-asr-js-LC53" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">call</span>.<span class="pl-en">sendMediaTo</span>(asr)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-asr-js-LC54" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-asr-js-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-asr-js-LC55" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-asr-js-LC56" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">startSilenceAndDurationTimeouts</span>() {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-asr-js-LC57" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">timeouts</span>.<span class="pl-smi">silence</span> <span class="pl-k">=</span> <span class="pl-c1">setTimeout</span>(speechAnalysis, <span class="pl-c1">8000</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-asr-js-LC58" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">timeouts</span>.<span class="pl-smi">duration</span> <span class="pl-k">=</span> <span class="pl-c1">setTimeout</span>(speechAnalysis, <span class="pl-c1">30000</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-asr-js-LC59" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-asr-js-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-asr-js-LC60" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-asr-js-LC61" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">speechAnalysis</span>() {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-asr-js-LC62" class="blob-code blob-code-inner js-file-line">  <span class="pl-c"><span class="pl-c">//</span>   ASR</span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-asr-js-LC63" class="blob-code blob-code-inner js-file-line">  <span class="pl-en">stopASR</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-asr-js-LC64" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">const</span> <span class="pl-c1">cleanText</span> <span class="pl-k">=</span> <span class="pl-smi">speech</span>.<span class="pl-en">trim</span>().<span class="pl-c1">toLowerCase</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-asr-js-LC65" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-asr-js-LC66" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">cleanText</span>.<span class="pl-c1">length</span>) {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-asr-js-LC67" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span>     ,       , </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-asr-js-LC68" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"><span class="pl-c">//</span> ..     ,   , ,   </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-asr-js-LC69" class="blob-code blob-code-inner js-file-line">    <span class="pl-en">handleSilence</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-asr-js-LC70" class="blob-code blob-code-inner js-file-line">  } <span class="pl-k">else</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-asr-js-LC71" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">call</span>.<span class="pl-en">say</span>(</td>
      </tr>
      <tr>
        <td id="file-asr-js-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-asr-js-LC72" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>   !  !<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-asr-js-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-asr-js-LC73" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-asr-js-LC74" class="blob-code blob-code-inner js-file-line">    )</td>
      </tr>
      <tr>
        <td id="file-asr-js-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-asr-js-LC75" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">call</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, () <span class="pl-k">=&gt;</span> {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-asr-js-LC76" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">call</span>.<span class="pl-c1">removeEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-asr-js-LC77" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">call</span>.<span class="pl-en">hangup</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-asr-js-LC78" class="blob-code blob-code-inner js-file-line">    })</td>
      </tr>
      <tr>
        <td id="file-asr-js-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-asr-js-LC79" class="blob-code blob-code-inner js-file-line">  }</td>
      </tr>
      <tr>
        <td id="file-asr-js-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-asr-js-LC80" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-asr-js-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-asr-js-LC81" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-asr-js-LC82" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">handleSilence</span>() {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-asr-js-LC83" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">call</span>.<span class="pl-en">say</span>(<span class="pl-s"><span class="pl-pds">"</span>,   . , ,        ?<span class="pl-pds">"</span></span>, <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-asr-js-LC84" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-asr-js-LC85" class="blob-code blob-code-inner js-file-line">  <span class="pl-c"><span class="pl-c">//</span>    3         </span></td>
      </tr>
      <tr>
        <td id="file-asr-js-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-asr-js-LC86" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">setTimeout</span>(startASR, <span class="pl-c1">3000</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-asr-js-LC87" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">call</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, startSilenceAndDurationTimeouts)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-asr-js-LC88" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-asr-js-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-asr-js-LC89" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-asr-js-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-asr-js-LC90" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">stopASR</span>() {</td>
      </tr>
      <tr>
        <td id="file-asr-js-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-asr-js-LC91" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">asr</span>.<span class="pl-c1">stop</span>()</td>
      </tr>
      <tr>
        <td id="file-asr-js-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-asr-js-LC92" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">call</span>.<span class="pl-c1">removeEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-asr-js-LC93" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">clearTimeout</span>(<span class="pl-smi">timeouts</span>.<span class="pl-smi">duration</span>)</td>
      </tr>
      <tr>
        <td id="file-asr-js-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-asr-js-LC94" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">asr.js</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div></div></div><br>  The final scenario shows how to ‚Äúennoble‚Äù a straight-line robot, adding a little tact and attention to it.  Surely this method is not the only possible one, so if you have any thoughts on how you can elegantly finish the usual interaction between the bot and the person, share in the comments.  But those who want something more advanced and suddenly did not read our DialogFlow tutorial - we <a href="https://habr.com/company/Voximplant/blog/412663/">recommend that you read it</a> . </div><p>Source: <a href="https://habr.com/ru/post/431676/">https://habr.com/ru/post/431676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431656/index.html">CraSSh: breaking all modern browsers with CSS calculations</a></li>
<li><a href="../431660/index.html">Game features with ECS: we add kits to the shooter</a></li>
<li><a href="../431664/index.html">Antenna Phase Center Antenna and its search in Ansys HFSS</a></li>
<li><a href="../431668/index.html">What's new in GoLand 2018.3</a></li>
<li><a href="../431670/index.html">Zen and the art of clean code support</a></li>
<li><a href="../431678/index.html">There is a mobile developer in the forest, he sees - Kotlin is on fire. He sat down in Kotlin and burned</a></li>
<li><a href="../431682/index.html">Marriott leaked personal data to 500 million customers</a></li>
<li><a href="../431686/index.html">In addition to IoT: Mirai botnet started attacking machines on Linux</a></li>
<li><a href="../431688/index.html">How Clang Compiles a Function</a></li>
<li><a href="../431690/index.html">We solve crackme from Kaspersky Lab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>