<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating Internet Radio on Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, `whoami`. 

 In this post I will tell you about one of the methods of automation of Internet broadcasting - not the most reliable, but the most bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating Internet Radio on Linux</h1><div class="post__text post__text-html js-mediator-article">  Hi, `whoami`. <br><br>  In this post I will tell you about one of the methods of automation of Internet broadcasting - not the most reliable, but the most budget.  Immediately I warn you that this system is sharpened to use it under Linux, although with the help of the ‚Äúcarpentry tool‚Äù familiar to many, you can also implement it under Windows.  This article is designed for beginners IT-Schnick, so many points I tried to "chew".  How I did it, it's up to you, my dear reader, but if I managed to interest you, please under the cat. <br><a name="habracut"></a><br><h4>  Foreword </h4><br>  So, first let me describe the goals that I set for myself: <br>  1. Broadcasting non-stop 24/7/365 (not counting the power outages in the house). <br>  2. Broadcast schedule.  That is, at a certain time interval of the day, compositions of a certain style / genre should be played on the air. <br>  3. Support hot plug and unplug master / dj. <br>  4. Site Requirements: <br>  4.a.  A modest implementation of voting for sounding compositions and, accordingly, the rating TOP-20/30 / how many. <br>  4.b.  Information about the current track, the current style / genre and, if necessary, the number of listeners. <br><br>  Now a little about what was in my ‚Äústash‚Äù (more precisely, in the closet): <br>  - 2003 home computer, AMD Athlon 1.8 GHz, which has long been working as a home server (by the way, I reduced the clock frequency to 1.1 GHz to save power); <br>  - Gentoo Linux operating system; <br>  - access to the global network ~ 10Mbit / s + dedicated IP; 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Setting up an Icecast server </h4><br>  So let's go.  I will not describe the installation of programs, because  in most distributions, they are available in the repositories and installed / assembled as a single command. <br><br>  Icecast 2.3.2 was chosen as the server, as the source client for non-stop ices (I don‚Äôt remember the version). <br><br>  After installation, you need to configure Icecast as follows. <br><br>  File /etc/icecast2/icecast.xml: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icecast</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">limits</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sources</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">burst-size</span></span></span><span class="hljs-tag">&gt;</span></span>32768<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">burst-size</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">threadpool</span></span></span><span class="hljs-tag">&gt;</span></span>5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">threadpool</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">limits</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authentication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">admin-user</span></span></span><span class="hljs-tag">&gt;</span></span>admin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">admin-user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">admin-password</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">admin-password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authentication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url-timeout</span></span></span><span class="hljs-tag">&gt;</span></span>15<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url-timeout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url</span></span></span><span class="hljs-tag">&gt;</span></span>http://dir.xiph.org/cgi-bin/yp-cgi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url-timeout</span></span></span><span class="hljs-tag">&gt;</span></span>15<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url-timeout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url</span></span></span><span class="hljs-tag">&gt;</span></span>http://www.oddsock.org/cgi-bin/yp-cgi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yp-url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hostname</span></span></span><span class="hljs-tag">&gt;</span></span>_IP_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hostname</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listen-socket</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>__<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">!‚Äî</span></span></span><span class="hljs-tag">  </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">8000</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">--</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listen-socket</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fileserve</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fileserve</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--,    :   Icecast,    ,  ,     xml-    ,    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paths</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">basedir</span></span></span><span class="hljs-tag">&gt;</span></span>/usr/share/icecast<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">basedir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logdir</span></span></span><span class="hljs-tag">&gt;</span></span>/var/log/icecast<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logdir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">webroot</span></span></span><span class="hljs-tag">&gt;</span></span>/home/www/icecast<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">webroot</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">adminroot</span></span></span><span class="hljs-tag">&gt;</span></span>/home/www/icecast/admin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">adminroot</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">alias</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/status.xsl"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paths</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">accesslog</span></span></span><span class="hljs-tag">&gt;</span></span>access.log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">accesslog</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">errorlog</span></span></span><span class="hljs-tag">&gt;</span></span>error.log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">errorlog</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loglevel</span></span></span><span class="hljs-tag">&gt;</span></span>3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loglevel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   -.       , ..      ices,     . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount-name</span></span></span><span class="hljs-tag">&gt;</span></span>/non-stop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>_-<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max-listeners</span></span></span><span class="hljs-tag">&gt;</span></span>___<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max-listeners</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">charset</span></span></span><span class="hljs-tag">&gt;</span></span>cp1251<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">charset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">public</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">public</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-name</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- , Habr.FM Non-Stop --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-description</span></span></span><span class="hljs-tag">&gt;</span></span>24/7 Non-stop music<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-url</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">genre</span></span></span><span class="hljs-tag">&gt;</span></span>Electronic<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">genre</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">!-‚Äî</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">--</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitrate</span></span></span><span class="hljs-tag">&gt;</span></span>128<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitrate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>audio/mpeg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subtype</span></span></span><span class="hljs-tag">&gt;</span></span>mp3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subtype</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   mp3,    . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hidden</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hidden</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    mountpoint  ,        --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount-name</span></span></span><span class="hljs-tag">&gt;</span></span>/live<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>__<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max-listeners</span></span></span><span class="hljs-tag">&gt;</span></span>100<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">max-listeners</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     : ,        mountpoint /live,      ,   ( )   -.      ,        /live.     . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fallback-mount</span></span></span><span class="hljs-tag">&gt;</span></span>/non-stop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fallback-mount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fallback-override</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fallback-override</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fallback-when-full</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fallback-when-full</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">charset</span></span></span><span class="hljs-tag">&gt;</span></span>cp1251<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">charset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">public</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">public</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-name</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-description</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-url</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stream-url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">genre</span></span></span><span class="hljs-tag">&gt;</span></span>Electronic<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">genre</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitrate</span></span></span><span class="hljs-tag">&gt;</span></span>128<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitrate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>audio/mpeg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subtype</span></span></span><span class="hljs-tag">&gt;</span></span>mp3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subtype</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hidden</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hidden</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">security</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">chroot</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">chroot</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeowner</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>icecast<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ,      Icecast --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span>nogroup<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeowner</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">security</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">icecast</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4>  Ices setting </h4><br>  With the setting of ices everything is easier: <br><br>  File /etc/ices.conf: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ices:Configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:ices</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.icecast.org/projects/ices"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Playlist</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--      (    ). --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">File</span></span></span><span class="hljs-tag">&gt;</span></span>/home/PUBLIC/Music/playlist.m3u<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">File</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Randomize</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Randomize</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   , ..    . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag">&gt;</span></span>builtin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Module</span></span></span><span class="hljs-tag">&gt;</span></span>ices<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Crossfade</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Crossfade</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   ,   (.  &lt;Reencode&gt;) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Playlist</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Server</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Hostname</span></span></span><span class="hljs-tag">&gt;</span></span>localhost<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Hostname</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Port</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Protocol</span></span></span><span class="hljs-tag">&gt;</span></span>http<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Protocol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Server</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Background</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Background</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Verbose</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Verbose</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base_Directory</span></span></span><span class="hljs-tag">&gt;</span></span>/tmp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Base_Directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Stream</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   &lt;Server&gt; (. ) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Server</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Hostname</span></span></span><span class="hljs-tag">&gt;</span></span>localhost<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Hostname</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Port</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Protocol</span></span></span><span class="hljs-tag">&gt;</span></span>http<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Protocol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Server</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Mountpoint</span></span></span><span class="hljs-tag">&gt;</span></span>/non-stop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Mountpoint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--       , ..    . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Genre</span></span></span><span class="hljs-tag">&gt;</span></span>Electronic<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Genre</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag">&gt;</span></span>24/7 Non-stop music<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">URL</span></span></span><span class="hljs-tag">&gt;</span></span>_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">URL</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bitrate</span></span></span><span class="hljs-tag">&gt;</span></span>128<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bitrate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Public</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Public</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    . ices        ,      ,      . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reencode</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reencode</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Samplerate</span></span></span><span class="hljs-tag">&gt;</span></span>-1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Samplerate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Channels</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Channels</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Stream</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ices:Configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  So, the Icecast server is configured, and you can already start it (usually, /etc/init.d/icecast start). <br>  Ices is also set, but it's too early to start it, because there is no playlist for non-stop. <br>  Actually we will fix it now ... <br><br><h4>  Playlist Formation </h4><br>  A small preface.  I was not raising this radio station alone, but with a friend who has a much larger supply of music on his computer than I did.  Previously, a virtual private network (VPN) was made between our computers and the server, so we could safely share files.  It was decided to store all the tracks for non-stop in a separate directory on the server, which is available in the samba-ball, and in which my colleague can download the tracks (and maybe delete). <br><br>  The directory structure is simple: <br><br>  Music <br>  --Genre1 <br>  ---- File1.mp3 <br>  ---- File2.mp3 <br>  ---- ... <br>  ---- playlist.m3u <br>  --Genre2 <br>  ---- File1.mp3 <br>  ---- File2.mp3 <br>  ---- ... <br>  ---- playlist.m3u <br>  ... <br>  playlist.m3u <br><br>  Those.  There are several subdirectories for various styles in the main Music catalog (remember, I was talking about a non-stop schedule?).  Each such subdirectory contains mp3-files and one playlist. <br><br>  So let's start with a small BASH script for creating playlists for all styles. <br><br>  Music_find.sh file (thanks to <a href="https://habrahabr.ru/users/differentlocal/" class="user_link">differentlocal</a> for simplifying my script) <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #     MUSICDIR=/home/PUBLIC/Music cd $MUSICDIR for i in *; do cd $MUSICDIR/$i find `pwd` -name "*.mp3" &gt; playlist.m3u done</span></span></code> </pre><br>  <i>Note: for people far from electronic music, I explain that Breaks, Chill, Hardcore are just styles of electronic music.</i> <br><br>  And since my colleague is far from Linux, and cannot access SSH and run this script after updating the contents of the directory, it was decided to entrust this mission to the Great Krona: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># crontab -e 10,40 * * * * /root/scripts/radio/music_find.sh</span></span></code> </pre><br>  Now every 30 minutes the script will run and update playlists. <br><br>  However, if you haven‚Äôt yet forgotten, the ‚Äúmain‚Äù playlist was specified in the ices config, which is not formed in this script. <br><br>  Here you need to remember the schedule.  The idea is simple to ugliness: at a certain time (according to the schedule of the broadcast) copy and replace the desired playlist in the root directory of the music (in my case / home / PUBLIC / Music).  At first I thought to implement the schedule completely on BASH, but then I remembered that good Kron is always ready to help us and do all the dirty work for us.  Thus, a script appeared that implements the change of the playlist according to the schedule. <br><br>  However, first lyrical digression ... <br><br>  Do you remember when configuring ices I turned off the randomization function?  You probably wondered why?  There are two reasons: <br>  1. God knows how ices performs randomization.  I used to (sorry) as much as possible to control the situation.  Therefore, it is better to do randomization the way you want your soul to calm down. <br>  2. If you read this article, you probably know the term "jingle".  So, if it is intended to insert jingles on the air (for example, every three tracks), then ices is powerless, because  he does not know what it is.  This is another reason to write your own randomization program. <br><br>  BASH, of course, is a good thing, but for this task I chose the C ++ language.  Below is the source code of a C ++ program that simply reads the contents of a playlist file created earlier (the name is passed to it as a parameter), mixes and writes to the same file. <br><br>  The source code of the randomization program: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;fstream&gt; #include &lt;cstdlib&gt; #include &lt;ctime&gt; #include &lt;string&gt; #include &lt;vector&gt; using namespace std; int main(const int argc, const char *argv[]) { if (argc&lt;2) { cout &lt;&lt; "ERROR: no argument recieved." &lt;&lt; endl; return 1; } vector&lt;string&gt; list; string line; ifstream infile(argv[1]); if (infile.fail()) return 1; cout &lt;&lt; "Using file: " &lt;&lt; argv[1] &lt;&lt; endl; while (!infile.eof()) { getline(infile,line); list.push_back(line); } infile.close(); cout &lt;&lt; "End of file reached." &lt;&lt; endl; int n = list.size(); if (n&gt;1) { cout &lt;&lt; "Begin shuffle." &lt;&lt; endl; srand(time(0)); string temp; for (int i=0; i&lt;(n-1); i++) { int r = i + (rand() % (ni)); temp = list[i]; list[i] = list[r]; list[r] = temp; } cout &lt;&lt; "Finished shuffle." &lt;&lt; endl; ofstream outfile(argv[1]); for (int i=0; i&lt;n; i++) outfile &lt;&lt; list[i] &lt;&lt; endl; outfile.close(); cout &lt;&lt; "File succuessfully updated." &lt;&lt; endl; return 0; } return 1; }</span></span></span></span></code> </pre><br>  In this program, I did not implement jingle insertion, but I sincerely hope that you, my dear reader, if necessary, will easily tune this code for your needs or, even better, write your own. <br><br><h4>  Schedule implementation </h4><br>  So, the lyrical digression is over, let's return to the schedule: <br><br>  The playlist_update file: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash MUSICDIR=/home/PUBLIC/Music cd $MUSICDIR cp -f $1/playlist.m3u playlist.m3u /root/scripts/radio/shuffle playlist.m3u &gt;&gt; /dev/null echo "$1" &gt; /home/www/HabrFM.ru/genre_non-stop.txt if ps -A | grep ices then killall -HUP ices else /etc/init.d/ices start fi</span></span></code> </pre><br>  First, the script performs copying with the replacement of the desired playlist file, then starts the program of randomization, writes the current genre into a text file (why, you will find out later) <br>  and sends a ‚Äúreread playlist‚Äù signal ices.  If ices has completed its work before, the script will launch it again.  It is important to know that ices will start playing a new playlist only when it finishes playing the current track.  Therefore, the schedule will not look very elegant, but it can be entrusted to our friend Kron. <br><br>  I give an example with my own styles: <br><pre> <code class="bash hljs">crontab -e 58 01 * * * /root/scripts/radio/playlist_update Breaks 58 03 * * * /root/scripts/radio/playlist_update Chill 58 09 * * * /root/scripts/radio/playlist_update Dance 58 14 * * * /root/scripts/radio/playlist_update House 58 17 * * * /root/scripts/radio/playlist_update Trance 58 21 * * * /root/scripts/radio/playlist_update Hardstyle 58 23 * * * /root/scripts/radio/playlist_update Hardcore</code> </pre><br>  Ta-da-dam!  Now the construction of the broadcast schedule is completed.  When there is no DJ, he plays a non-stop on schedule, when a DJ appears - the listeners are automatically redirected to his ‚Äúair‚Äù.  However, if you remember, there are still unrealized tasks concerning the site. <br><br><h4>  Database of musical compositions </h4><br>  Oh yeah, I completely forgot.  To implement the voting system, I used a MySQL database.  So work, my friend, to acquire such, if you have not already done so. <br><br>  So, we need to store in the database information about all the tracks that are present in the ‚Äúroot music directory‚Äù.  We need to create a database (in my example, this is radio), and in it there are two tables of the following structure: <br><br>  Table songs <br>  id INT (11) AUTO_INCREMENT PRIMARY_KEY <br>  Genre VARCHAR (15) <br>  Title VARCHAR (100) <br>  Filename VARCHAR (200) <br>  Rate INT (11) <br><br>  Table votes <br>  id int (11) <br>  ip VARCHAR (16) <br><br>  Now about the sad.  Firstly, not all mp3 files (even licensed ones) have correct ID3 tags, and most of them do not have them.  Secondly, I could not find a script to read ID3 tags from files.  So I had to make some sacrifices.  Namely: using the TagScanner program, manually edit the ID3 tags of all files, and then use the same program to rename the files according to their already correct ID3 tags.  I selected the following template: <br><br>  &lt;counter&gt;.  &lt;Artist&gt; - &lt;Composition&gt; .mp3 <br><br>  I will not describe in this article work with this program.  Let me just say that it is crucial to save ALL ID3 tags <b>NOT</b> in UTF-8.  In the program settings there is a corresponding option.  in addition, all '&amp;' characters must be replaced with, for example, ‚Äúand‚Äù.  The program allows you to do this at once for all files. <br><br>  OK, suppose we now have the correct file names that match the pattern, and the database has the correct structure.  Further, actually, one more script, but already in PHP (so do not forget to install it at your leisure). <br><br>  File db_update.php: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/php &lt;?php $MUSICDIR="/home/PUBLIC/Music"; $hostname = "localhost"; $username = "radio"; //     $password = "12345"; //   $dbName = "radio"; //   mysql_connect($hostname,$username,$password) OR die("Can't connect to database."); mysql_select_db($dbName) or die(mysql_error()); $Gen = array('Dance','House','Trance','Hardstyle','Hardcore','Chill','Breaks','Pumping'); $sql = "SELECT * FROM radio.songs"; $all = mysql_query($sql); $num_before = mysql_num_rows($all); echo "There are $num_before records in database.\n"; echo "\n"; echo "Searching for non-existing file names...\n"; $deleted = 0; while($row = mysql_fetch_array($all, MYSQL_ASSOC)) { $id = $row['id']; $db_filename = $row['Filename']; $exist = @fopen($db_filename,"r"); if (!$exist) { echo "Deleting: [$id] $db_filename\n"; $sql = "DELETE FROM radio.songs WHERE id=$id"; mysql_query($sql); $deleted++; } } if (!$deleted) { echo "Nothing deleted.\n"; } else { echo "Total deleted: $deleted records.\n"; } echo "\n"; $added = 0; echo "Searching for new tracks...\n"; for ($i=0;$i&lt;count($Gen);$i++) { $genre=$Gen[$i]; $fp = fopen("$MUSICDIR/$genre/playlist.m3u","r"); while (!feof($fp)) { $filename = fgets($fp); if (strpos($filename,".mp3")) { $filename = substr($filename,0,strlen($filename)-1); $sql = sprintf("SELECT * FROM radio.songs WHERE Filename='%s'",mysql_real_escape_string($filename)); $res = mysql_query($sql); $num = mysql_num_rows($res); if ($num == 0) { $title = strstr($filename," "); $start = strpos($filename,". ")+2; $len = strpos($filename,".mp3") - $start; $title = substr($filename,$start,$len); $filename = substr($filename,0,strpos($filename,".mp3")+4); $sql = sprintf("INSERT INTO radio.songs ( `id`, `Genre`, `Title`, `Filename`, `Rate` ) VALUES ( NULL, '$genre', '%s', '%s', '0' )", mysql_real_escape_string($title),mysql_real_escape_string($filename)); mysql_query($sql) or die(mysql_error()); $added++; echo "Adding $filename\n"; } } } } if (!$added) { echo "Nothing added.\n"; } else { echo "Total added: $added records.\n"; } echo "\n"; $sql = "SELECT * FROM radio.songs"; $all = mysql_query($sql); $num_after = mysql_num_rows($all); if ($num_before == $num_after) { echo "There are still $num_after records in database.\n"; } else { echo "There are $num_after records in database.\n"; } mysql_close(); ?&gt;</span></span></code> </pre><br>  The above script first deletes records about tracks from the database that are no longer in the corresponding directory, and then adds new ones, if any. <br><br>  It would be logical to run this script immediately after creating playlists, so add one line to the music_find.sh file (after replacing the path with your own): <br><br><pre> <code class="bash hljs">/root/scripts/radio/db_update.php</code> </pre><br>  Now when creating playlists, the information in the database will be automatically updated. <br><br>  The second table (votes) leave for a snack. <br><br><h4>  Collection of broadcast information </h4><br>  Here I will not particularly go into details.  Your attention is invited to a php-script, recording the name of the current track, style and number of listeners in text files.  It is assumed that these files are in the root of our site, i.e.  if you, my friend, do not have a web server installed, then hurry to install it. <br><br>  File icecast_status.php: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/php &lt;?php $STATS_FILE = 'http://IP__:_/status.xsl'; $DOCROOT = '/var/www/HabrFM.ru'; //   $hostname = "localhost"; $username = "radio"; //     $password = "12345"; //   $dbName = "radio"; //   mysql_connect($hostname,$username,$password) OR die("Can't connect to database."); mysql_select_db($dbName) or die(mysql_error()); for($i=1;$i&lt;13;$i++) { $fp = fopen($STATS_FILE,'r'); if(!$fp) { die("Unable to connect to Icecast server."); } $stats_file_contents = ''; while(!feof($fp)) { $stats_file_contents .= fread($fp,1024); } fclose($fp); $radio_info = array(); $radio_info['genre'] = ''; $radio_info['listeners'] = ''; $radio_info['now_playing'] = ''; $temp = array(); $search_for = "&lt;td\s[^&gt;]*class=\"streamdata\"&gt;(.*)&lt;\/td&gt;"; $search_td = array('&lt;td class="streamdata"&gt;','&lt;/td&gt;'); if(preg_match_all("/$search_for/siU",$stats_file_contents,$matches)) { foreach($matches[0] as $match) { $to_push = str_replace($search_td,'',$match); $to_push = trim($to_push); array_push($temp,$to_push); } } $radio_info['listeners'] = $temp[5]; $radio_info['now_playing'] = $temp[9]; if(strpos($stats_file_contents,'/live')) { $radio_info['genre'] = "DJ On-Air"; } else { $fp = fopen("$DOCROOT/genre_non-stop.txt","r"); $radio_info['genre'] = fgets($fp); fclose($fp); $radio_info['genre'] = substr($radio_info['genre'],0,strlen($radio_info['genre'])-1); } if ($radio_info['genre'] == "DJ On-Air"){ $rate = "1000+"; } else { $sql = sprintf("SELECT * FROM songs WHERE ( Genre='%s' AND Title='%s' )", mysql_real_escape_string($radio_info['genre']), mysql_real_escape_string($radio_info['now_playing'])); $res = mysql_query($sql) or die(); $row = mysql_fetch_array($res, MYSQL_ASSOC); $rate = $row['Rate']; $id = $row['id']; } $fp = fopen("$DOCROOT/now_playing.txt","w"); fputs($fp,$radio_info['now_playing']); fclose($fp); $fp = fopen("$DOCROOT/id.txt","w"); fputs($fp,$id); fclose($fp); $fp = fopen("$DOCROOT/listeners.txt","w"); if ($radio_info['listeners'] &gt; 0) { fputs($fp,'&lt;span style="color:green; font-weight: bold;"&gt;'.$radio_info['listeners'].'&lt;/span&gt;'); } else { fputs($fp,'&lt;span style="color:black; font-weight: bold;"&gt;'.$radio_info['listeners'].'&lt;/span&gt;'); } fclose($fp); $fp = fopen("$DOCROOT/genre.txt","w"); fputs($fp,$radio_info['genre']); fclose($fp); $fp = fopen("$DOCROOT/rate.txt","w"); if ($rate &gt; 0) { fputs($fp,'&lt;span style="color:green; font-weight: bold;"&gt;+'.$rate.'&lt;/span&gt;'); } if ($rate &lt; 0) { fputs($fp,'&lt;span style="color:red; font-weight: bold;"&gt;'.$rate.'&lt;/span&gt;'); } if ($rate == 0) { fputs($fp,'&lt;span style="color:black; font-weight: bold;"&gt;'.$rate.'&lt;/span&gt;'); } fclose($fp); sleep(5); } ?&gt;</span></span></code> </pre><br><br>  This script must be run every minute, and it runs 12 times with delays of 5 seconds.  This ‚Äúbicycle‚Äù is connected with the fact that our friend Kron does not imply the existence of time units less than 1 minute.  And we need to update this information at least once every 5 seconds. <br><br>  Well, ask Krona (for the last time) to run this script every minute: <br><br><pre> <code class="bash hljs">crontab -e */1 * * * * /root/scripts/radio/icecast_status.php</code> </pre><br>  OK, now there are already 5 great files in the root of our site: <br>  ‚Ä¢ now_playing.txt - artist and name of the current track; <br>  ‚Ä¢ id.txt - a unique number in the database of the current composition; <br>  ‚Ä¢ genre.txt - style of the track, if it plays non-stop, or the string ‚ÄúDJ On-Air‚Äù, if there is a DJ on the air; <br>  ‚Ä¢ listeners.txt - the number of listeners (including HTML formatting: if it is greater than 0, then in green, if zero - in black); <br>  ‚Ä¢ rate.txt - track rating (also including HTML formatting). <br><br>  Wow, we almost got what we wanted (or what I wanted).  It remains to implement the vote and, in fact, display the necessary information on the site. <br><br><h4>  Voting for compositions </h4><br>  The first thing I thought about when I wanted to implement the vote was - how to block repeated votes for one track?  Usually they use cookies, but I have never worked with them (yes, this also happens), and decided to block by IP address.  Therefore, there are only two fields in the votes table: id and ip. <br><br>  The vote.php file (should be located at the root of the site): <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//, ,     $DOCROOT = '/var/www/HabrFM.ru'; $hostname = "localhost"; $username = "radio"; $password = "12345"; $dbName = "radio"; mysql_connect($hostname,$username,$password) OR die("Can't connect to database."); mysql_select_db($dbName) or die(mysql_error()); $fp = fopen("$DOCROOT/id.txt", "r"); $id = fgets($fp); fclose($fp); $sql = sprintf("SELECT * FROM votes WHERE ( id='%s' AND ip='%s' )", $id, mysql_real_escape_string($_SERVER['REMOTE_ADDR'])); $res = mysql_query($sql); $num = mysql_num_rows($res); if ($num == 0) { $type = $_GET['type']; if ($type == 'plus') { $sql = sprintf("UPDATE songs SET Rate=Rate+1 WHERE id='%s'", $id); } else { if ($type == 'minus') { $sql = sprintf("UPDATE songs SET Rate=Rate-1 WHERE id='%s'", $id); } else { die('Irregular argument.'); } } if (mysql_query($sql)) { $sql = sprintf("INSERT INTO votes (`id`, `ip`) VALUES ('%s', '%s')", $id, mysql_real_escape_string($_SERVER['REMOTE_ADDR'])); mysql_query($sql); echo '  .'; } else { echo ' .'; } } else { echo "     ."; } mysql_close(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  This script takes one parameter - the type of voting (for or against).  Accordingly, the challenge <br><pre> <code class="php hljs">vote.php?type=plus</code> </pre> <br>  will add 1 rating to the current track, and <br><pre> <code class="php hljs">vote.php?type=minus</code> </pre> <br>  takes 1 rating. <br><br><h4>  Display information on the site </h4><br>  So, there is a vote.  It remains, except that to display on the site all the necessary information.  I will not provide specific HTML code.  Just to remind you, if you suddenly forgot about the existence of the wonderful jQuery framework. <br><br>  Let elements or with id = 'now_playing' for the name of a track, with id = 'genre' for the genre, etc., be in the right places of the HTML code. <br>  Then it is convenient to embed the following call (of course, the jQuery library needs to be added to the site directory and connected): <br><pre> <code class="javascript hljs">&lt;script&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"now_playing.txt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">)</span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#now_playing"</span></span>).html(html); } }); $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"genre.txt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">)</span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#genre"</span></span>).html(html); } }); $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"listeners.txt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">)</span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#listeners"</span></span>).html(html); } }); $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"rate.txt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">)</span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#rate"</span></span>).html(html); } }); } $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ show(); setInterval(<span class="hljs-string"><span class="hljs-string">'show()'</span></span>,<span class="hljs-number"><span class="hljs-number">5000</span></span>); }); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>  And then every 5 seconds the information on the page will be updated (and without reloading the page). <br><br>  Remember, at the beginning of the article, I announced the display of the TOP20 rating?  Yes, that would be great. <br><br>  So, the last script that produces a table of the best (type = 1) or worst (type = 2) tracks of a particular style / genre in the following format: <br>  |  Composition |  Rating | <br><br>  File top20.php (better to finish the tool under your site): <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $Gen = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'Dance'</span></span>,<span class="hljs-string"><span class="hljs-string">'House'</span></span>,<span class="hljs-string"><span class="hljs-string">'Trance'</span></span>,<span class="hljs-string"><span class="hljs-string">'Hardstyle'</span></span>,<span class="hljs-string"><span class="hljs-string">'Hardcore'</span></span>,<span class="hljs-string"><span class="hljs-string">'Chill'</span></span>,<span class="hljs-string"><span class="hljs-string">'Breaks'</span></span>,<span class="hljs-string"><span class="hljs-string">'Pumping'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    :) $hostname = "localhost"; $username = "radio"; $password = "12345"; $dbName = "radio"; mysql_connect($hostname,$username,$password) OR die("Can't connect to database."); mysql_select_db($dbName) or die(mysql_error()); $genre = $_GET["genre"]; $type = $_GET["type"]; echo "&lt;br&gt;\n"; if (!(in_array($genre,$Gen))) { die("Irregular argument."); } $sql = sprintf("SELECT Title, Rate FROM songs WHERE (Genre='%s'",mysql_real_escape_string($genre)); if ($type==1) { $sql = $sql . " AND Rate&gt;0) ORDER BY Rate DESC LIMIT 20"; } else if ($type==2) { $sql = $sql . " AND Rate&lt;0) ORDER BY Rate ASC LIMIT 20"; } else { die("Irregular argument"); } $res = mysql_query($sql); if (mysql_num_rows($res)&gt;0) { echo '&lt;table border="1" style="font-family: Verdana,Geneva; font-size: 10;" cellspacing="0" width="100%"&gt;'; echo "\n"; echo '&lt;tr&gt;&lt;td align="left"&gt;‚Ññ&lt;/td&gt;&lt;td align="left" width="100%"&gt; - &lt;/td&gt;&lt;td align="right"&gt;&lt;/td&gt;&lt;/tr&gt;'; echo "\n"; } else { echo "   .     -       ."; } $i = 1; while ($row = mysql_fetch_array($res, MYSQL_ASSOC)) { echo "&lt;tr&gt;"; echo '&lt;td align="left"&gt;' . $i . '.&lt;/td&gt;'; echo '&lt;td align="left"&gt;' . $row['Title'] . '&lt;/td&gt;'; echo '&lt;td align="right"&gt;' . $row['Rate'] . '&lt;/td&gt;'; echo "&lt;/tr&gt;\n"; $i++; } if (mysql_num_rows($res)&gt;0) { echo '&lt;/table&gt;'; } mysql_close(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  That's all.  Next, you need to embed this script in the right place of the HTML code (you can use the same jQuery, only without setInterval ('show ()', 5000). But this I leave to you, my young friend, as homework. <br><br>  I sincerely hope that my story will be useful to you or just interesting. </div><p>Source: <a href="https://habr.com/ru/post/131116/">https://habr.com/ru/post/131116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131110/index.html">Test can not be pardoned</a></li>
<li><a href="../131111/index.html">MySQL replication one-slave-multi-master</a></li>
<li><a href="../131112/index.html">Secrets of Meterpreter Payload</a></li>
<li><a href="../131113/index.html">Configuring cisco aaa + tac_plus (tacacs +)</a></li>
<li><a href="../131115/index.html">The role of business processes in interface design</a></li>
<li><a href="../131117/index.html">Memory Minesweeper</a></li>
<li><a href="../131118/index.html">Repair "flooded" laptop keyboard</a></li>
<li><a href="../131120/index.html">RIM supports open source libraries for the BlackBerry PlayBook platform.</a></li>
<li><a href="../131121/index.html">Face detection in iOS 5 SDK</a></li>
<li><a href="../131122/index.html">Google is preparing to launch a music store in the coming weeks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>