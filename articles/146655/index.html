<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic control of architecture in Visual Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you do not know, but I recognized myself in this picture. You see, when an application architecture is designed, everything is beautiful, logical a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic control of architecture in Visual Studio</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/09d/788/32f/09d78832fd07b02164944c90547b4bc5.png"><br>  As you do not know, but I recognized myself in this picture.  You see, when an application architecture is designed, everything is beautiful, logical and corresponds to the best international practices.  But in the process of work, when faced with the limitations imposed by the architecture, we often think: ‚ÄúI‚Äôm breaking a little here, this will save me an hour of development time.  Well, then, as time will be, I will correct it. ‚Äù  But, for some reason, this time never comes.  In my opinion, the only way to force yourself, as a programmer, to follow the developed architecture, is to teach the development environment to show all deviations and crutches as compilation errors.  In this case, if the code is bad, it will immediately be fixed, but if the architecture is outdated, then it will be fixed.  Those.  in the code storage will always be the code corresponding to the planned architecture. <br>  A couple of words about what will be rolled up: <br>  1. A small preamble. <br>  2. Restoration of the architecture of the existing project. <br>  3. Configure Visual Studio and TFS to automatically control the architecture. <br>  There are a lot of pictures under the cut and the desire to try everything described. <br><a name="habracut"></a><br>  So, the promised preamble.  Almost a year ago, Dmitry Andreev ( <a href="http://habrahabr.ru/users/dmandreev/" class="user_link">dmandreev</a> ) already published <a href="http://habrahabr.ru/company/microsoft/blog/129073/">an article</a> on this topic.  I read this article with great pleasure, and, in fact, it was she who prompted me to address the issue of applying the Layer Diagram in the application development process.  By the way, having read this far, have you already gone over the above link and read what Dmitry has written?  No, well then, let me wait for you, and then we go on.  I am waiting. <br>  Ok, now that you and I have a common understanding of the Layer Diagram, you can finish with the preamble and move on to practical work. <br><h5>  Preparation of a demonstration project </h5><br>  To demonstrate the work with the Layer Diagram, I will take a project a little closer to reality than Dmitry considered.  Let us have a data access layer (I will use the Entity Framework) and, in fact, a layer of client applications which will also have a layered structure (MVVM).  At the client level, the model will be taken from the first layer, but the View and ViewModel layers will be spread over several assemblies. <br>  So, these four projects look after creation: <br><img src="https://habrastorage.org/storage2/b3a/b4d/2cd/b3ab4d2cd0a28a975996eb8c40727bf4.png"><br>  I think everything changes the default Namespace for the assemblies being created?  Well, in this example, for 3 client builds, I will replace the Default Namespace: <br><img src="https://habrastorage.org/storage2/9d1/26d/70d/9d126d70d703dcdb85f575b07924b773.png"><br>  Add a database and an Entity Model to the DAL project.  In client projects, we create the View and ViewModel folders.  Add test components and classes to them: <br><img src="https://habrastorage.org/storage2/19c/da1/1e3/19cda11e356ca4865ce722579a1e87ff.png"><br>  Adding links between projects, references between the created components and classes, you can get a dependency graph of the following form: <br><img src="https://habrastorage.org/storage2/b56/fb1/7fe/b56fb17fe5e73e849fb992562c5df930.png"><br>  If splitting into layers goes at the level of assemblies, then due to the prohibition of cyclic references between assemblies (otherwise it is impossible to determine the order of construction), only the problem of ‚Äúcirculation through the layer‚Äù (which is just considered in Dmitry‚Äôs article) is possible.  If in the project, as in this case, the layers are spread over several assemblies, and within the same assembly there are representatives of different layers, dragging projects / files from the Solution Explorer into the Layer Diagram is not effective.  And here comes Architecture Explorer, which is called from the main menu: Architecture -&gt; Windows -&gt; Architecture Explorer.  Immediately after opening it will look like: <br><img src="https://habrastorage.org/storage2/d6b/a57/33e/d6ba5733ea4f8bf0b477f4c694a9b4aa.png"><br>  Frankly, when I read about this tool for the first time, I immediately fell in love with it.  Such opportunities for analyzing dependencies, which is simply breathtaking.  And although you can write about him a lot and enthusiastically, as he does not allow to <b>automatically</b> control the architecture, more about him in another time. <br><h5>  Restore layer diagrams from solution artifacts </h5><br>  Once the scene is ready, we release the actors.  Add a model project to the solution, add a Layer Diagram to it already: <br><img src="https://habrastorage.org/storage2/ec6/f15/4dd/ec6f154dd4c6be907ed2c7f45dc72d25.png"><br>  Yes, here we can drag layers out of the Toolbox, draw dependencies, then transfer classes from client projects to the layers for a long time and hard.  And all this only so that the next day, when the developer adds a new class, about which we do not know, and it is not tied to the layers, and therefore the test will stop working.  To avoid this, we need the Architecture Explorer. <br><img src="https://habrastorage.org/storage2/7a9/da4/d98/7a9da4d9849338f9900d6b789535e5f2.png"><br>  Please note that all the ViewModel classes are in the same namespace (well, let it be in 3-5 in the real project), and we can now add to the layer diagram not classes, but the entire namespace.  Select them and, without creating any layers, drag them to our Layer Diagram: <br><img src="https://habrastorage.org/storage2/3f8/1c9/bb2/3f81c9bb29fbd55c38f5852ace835149.png"><br>  By the way, we can use the drag and drop functionality of projects from the Solution Explorer.  With Shift, we select ClientApp1, ClientApp2 and Base.Library in it, grab the left mouse button and drag it to the free space in the Layer Diagram: <br><img src="https://habrastorage.org/storage2/baa/e0d/65d/baae0d65d342134bbfc8551a2a4279b9.png"><br>  Rename the new layer to Presentation, select two layers (View and View Model) and drag them to the Presentation layer: <br><img src="https://habrastorage.org/storage2/708/4f1/2b6/7084f12b6fb5231c88f1a82decfdacad.png"><br>  Almost everything is ready, lacking only links.  To generate them, just call the context menu on the Layer Diagram and select the Generate Dependencies option: <br><img src="https://habrastorage.org/storage2/2a1/387/c9c/2a1387c9c76ed7c1e0e609aae5453244.png"><br>  Now, our diagram of layers has taken the finished form: <br><img src="https://habrastorage.org/storage2/994/212/e84/994212e84f192c6b6e4283535f21c90d.png"><br>  If you have a question about the arrow from ViewModel to View, then you can look at the opinions on this topic, or maybe take part in the discussion, on the <a href="http://social.msdn.microsoft.com/Forums/ru-RU/fordesktopru/thread/86eaed80-4cbe-47c3-8c87-b0a77cf9e8fb">MSDN forum</a> . <br><h5>  Automatic architecture control </h5><br>  Well, and the last moment, how to make the layer diagram automatically, at every construction, check that the code corresponds to the architecture?  In fact, quite simple.  For demonstration, I‚Äôll add a component to ClientApp1, which will directly access the data access layer: <br><img src="https://habrastorage.org/storage2/582/3bc/b96/5823bcb965aae897b1a9502762254967.png"><br>  Run the build and see: Build succeeded.  In order for builds to fail during architecture errors, you must open the model properties from Solution Explorer (via the context menu or select and press F4) and enable the architecture check: <br><img src="https://habrastorage.org/storage2/313/9e4/fce/3139e4fce037ee1f2193df4ff27b557b.png"><br>  Once again, we run the construction and see that we have architecture errors: <br><img src="https://habrastorage.org/storage2/224/e97/993/224e97993be96ef98937c86718533568.png"><br>  Double click on the error, immediately drive to the place where the crutch is clogged. <br>  Of course, dependency checking leads to an increase in compilation time, so you can build two solutions, one with which the developers work (do not include the Modeling Project), and the second, with the same set of projects and the Modeling Project, for automatic builds in Team Foundation Server.  In this case, at workplaces, construction is faster, and the architecture is monitored on the server, and, due to construction errors, bugs can be generated immediately. <br>  Before proceeding to the conclusions, a small remark.  Everything described in this article works in both Visual Studio 2010 and Visual Studio 2012. The only thing required is a version of Ultimate or Premium.  If you do not have a license for the appropriate version of Visual Studio 2010, then the Release Candidate version of Visual Studio 2012 Ultimate can be downloaded <a href="http://www.microsoft.com/visualstudio/11/ru-ru/downloads">here</a> . <br><h5>  findings </h5><br>  1. Layer Diagram is a toolkit, about which you should at least know, and start to apply in new projects <br>  2. Automatic architecture check will reduce the number of "crutches" hammered in a hurry or for not knowing <br>  3. Proper namespace naming and use of the Architecture Explorer can significantly reduce the time to restore the architecture. <br>  Ps If in this article I forgot to tell you about something, then please do not swear at me much, and read the original sources: <a href="http://msdn.microsoft.com/ru-ru/library/dd409365">Visualization of the existing code</a> . </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/146655/">https://habr.com/ru/post/146655/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146649/index.html">Google Tablet Nexus 7 officially submitted (upd)</a></li>
<li><a href="../146650/index.html">Google I / O - what's new?</a></li>
<li><a href="../146651/index.html">Valve Announces Source Filmmaker</a></li>
<li><a href="../146652/index.html">Polaroid released a new type of ‚Äúinstant‚Äù camera.</a></li>
<li><a href="../146653/index.html">New video about the possibilities of Project Glass</a></li>
<li><a href="../146656/index.html">Online access to Google Chrome bookmarks</a></li>
<li><a href="../146657/index.html">MTS will cut torrents</a></li>
<li><a href="../146658/index.html">Google Glass will be sold at 1.5 thousand dollars per unit, the amount is limited</a></li>
<li><a href="../146659/index.html">Robot wins in stone-paper-scissors in 100% of cases</a></li>
<li><a href="../146660/index.html">Hone Bluetooth Dongle helps keep your keys safe.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>