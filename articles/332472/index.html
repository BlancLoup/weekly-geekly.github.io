<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of the backdoor group TeleBots</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On June 27, companies in Ukraine and other countries became victims of a large-scale cyber attack by the coder DiskCoder.C (aka ExPetr, PetrWrap, Pety...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of the backdoor group TeleBots</h1><div class="post__text post__text-html js-mediator-article">  On June 27, companies in Ukraine and other countries became victims of a large-scale cyber attack by the coder <a href="http://www.virusradar.com/en/Win32_Diskcoder.C/description">DiskCoder.C</a> (aka ExPetr, PetrWrap, Petya, or NotPetya).  Malware disguised as a regular extortioner - encrypts data and requires a ransom for the decryption key.  But, since the authors seek to inflict maximum damage, the chances of data recovery are minimized. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/ca5/6e2/f35/ca56e2f35d9a470e9f43ae5435b27ce8.jpeg"></div><br>  In the <a href="https://habrahabr.ru/company/eset/blog/332058/">last report,</a> we pointed out the connection of DiskCoder.C epidemic with the TeleBots cyber group and other attacks on Ukrainian companies.  In this article we will reveal the details about the initial vector of infection. <br><br><a name="habracut"></a><h3>  The story of malicious updates </h3><br>  The Cyber ‚Äã‚ÄãPolice Department of the National Police of Ukraine <a href="https://www.facebook.com/cyberpoliceua/posts/536947343096100">confirmed the</a> information from ESET and other anti-virus vendors that the legitimate MEDoc software was used by attackers to launch DiskCoder.C at the initial stage of the attack.  However, until now there were no details on how this operation was implemented. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the course of our research, we discovered a complex hidden backdoor embedded in one of the legitimate modules of MEDoc.  It is unlikely that the attackers did this without having access to the source code of MEDoc. <br><br>  The file name of the backdoor module is <code>ZvitPublishedObjects.dll</code> .  It is written using the .NET Framework.  This file is 5 MB in size and contains legitimate code that can be called by other components, including the main executable file MEDoc <code>ezvit.exe</code> . <br><br>  We studied all MEDoc updates released in 2017, and found that at least three updates contained a backdoor module: <br><br><ul><li>  10.01.175-10.01.176 of April 14 </li><li>  10.01.180-10.01.181 of May 15 </li><li>  10.01.188-10.01.189 of June 22 </li></ul><br>  Check the dates.  <a href="https://www.welivesecurity.com/2017/05/23/xdata-ransomware-making-rounds-amid-global-wannacryptor-scare/">The attack</a> with Win32 / Filecoder.AESNI.C (XData) began three days after the update 10.01.180-10.01.181;  DiskCoder.C - five days after the update of 10.01.188‚Äì10.01.189.  Four updates in the period from April 24 to May 10 and seven - from May 17 to June 21 did not contain a malicious module. <br><br>  An interesting point is connected with the encoder AESNI.C.  The MEDoc update of May 15 contained a backdoor, and the following, of May 17, did not.  Perhaps this is due to a relatively small number of infections - the attackers launched the encryptor on May 18, when most MEDoc users have already installed a secure update. <br><br>  The timestamps of the studied files suggest that they were compiled on the same day or the day before. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/afb/90f/892/afb90f89298540f1b5e3defe21f15b8c.png"></div><br>  <i>Figure 1. The timestamp of the update module compilation with backdoor, released on May 15th.</i> <br><br>  Figure 2 shows the differences between the class list of <code>ZvitPublishedObjects.dll</code> module <code>ZvitPublishedObjects.dll</code> with and without backdoor, using the ILSpy .NET Decompiler. <br><br><img src="https://habrastorage.org/web/295/c9d/b66/295c9db66fdf4fbb9fa465b3d4e543eb.png"><br>  <i>Figure 2. List of module classes with backdoor (left) and without (right).</i> <br><br>  The class containing the main backdoor is called <code>MeCom</code> , it is located in the <code>ZvitPublishedObjects.Server</code> namespace. <br><br><img src="https://habrastorage.org/web/408/bc4/b6d/408bc4b6da414e6383d595d86ceaea53.png"><br>  <i>Figure 3. The MeCom class with malicious code, as shown in ILSpy .NET Decompiler.</i> <br><br>  The methods of the MeCom class are called from the <code>IsNewUpdate</code> method in the <code>UpdaterUtils</code> and <code>ZvitPublishedObjects.Server</code> .  The <code>IsNewUpdate</code> method <code>IsNewUpdate</code> called periodically to check if an update is available.  The module with backdoor of May 15 is implemented a little differently and has fewer functions than the module of June 22. <br><br>  Each Ukrainian company is assigned a legal entity identifier - a code according to the EDRPOU (Unified State Register of Enterprises and Organizations of Ukraine).  This is useful for attackers - by code you can identify the organization using the MEDoc version with backdoor.  Next, attackers can use various tactics to work with its network - it all depends on the goals. <br><br>  Since MEDoc is used for accounting, it can be assumed that EDRPOU codes will be found on the machines on which this software is installed.  Malicious code injected into the <code>IsNewUpdate</code> method collects codes from the application.  One account in MEDoc can be used for accounting of several organizations, therefore the backdoor code collects all possible EDRPOU codes. <br><br><img src="https://habrastorage.org/web/b72/ac2/b37/b72ac2b371404847b38e7a088f4adc3a.png"><br>  <i>Figure 4. Code collecting codes.</i> <br><br>  In addition to the EDRPOU codes, the backdoor from the MEDoc application collects information about the proxy and mail service settings, including logins and passwords. <br><br>  <b>Attention!</b>  <b>ESET recommends that all MEDoc users change their passwords for proxy servers and email accounts.</b> <br><br>  The malicious code writes information collected to the Windows registry under the key <code>HKEY_CURRENT_USER\SOFTWARE\WC</code> using the values ‚Äã‚Äãof the values <code>Cred</code> and <code>Prx</code> .  If these values ‚Äã‚Äãexist on the computer, it is likely that a backdoor visited it. <br><br>  And the most interesting part.  The backdoor does not use external servers as C &amp; C, their role is performed by MEDoc requests to its official server <b>upd.me-doc.com [.] Ua</b> to check for updates.  The only difference from the legitimate request is that the backdoor sends the collected information to the cookie. <br><br><img src="https://habrastorage.org/web/31f/daf/b92/31fdafb9243e4d499ed3c09c61f3bba7.png"><br>  <i>Figure 5. HTTP backdoor request that contains EDMER codes in cookies.</i> <br><br>  We did not perform a retrospective analysis of the MEDoc server.  However, as we reported in the last report, there are signs that he was compromised.  Therefore, we assume that the attackers used the server software, which allowed us to distinguish requests from compromised and clean machines. <br><br><img src="https://habrastorage.org/web/e55/2af/275/e552af2758a648d79dcabaab293637a3.png"><br>  <i>Figure 6. Backdoor code that adds cookies to the request.</i> <i><br></i> <br>  Of course, the authors of the backdoor provided the ability to control the infected machine.  The code gets a binary blob from the official MEDoc server, decrypts it using the Triple DES algorithm, and then unpacks it using GZip.  The result is an XML file that can contain several commands at once.  The ability to remote control turns the backdoor into a fully functional platform for cyber espionage and sabotage. <br><br><img src="https://habrastorage.org/web/52d/67a/07d/52d67a07dd0a44e7b3786d2ee6d990d0.png"><br>  <i>Figure 7. The backdoor code decrypts incoming operator commands.</i> <br><br>  The table below shows the possible commands: <br><br><img src="https://habrastorage.org/web/89d/e1d/f09/89de1df09d0e4c7085a0c35a174364b2.png"><br><br>  It is worth noting that the team 5, named by the authors of Malvar AutoPayload, fully corresponds to how DiskCoder.C was launched on ‚Äúzero patients‚Äù - the machines that started the network infection. <br><br><img src="https://habrastorage.org/web/159/2af/7a0/1592af7a02264e91a3626539bee4c237.png"><br>  <i>Figure 8. The AutoPayload function was used to execute DiskCoder.C.</i> <br><br><h3>  findings </h3><br>  As the study shows, the operation was carefully planned and implemented.  We assume that attackers had access to the source code of the MEDoc application.  They had time to study the code and embed a hidden complex backdoor in it.  The size of the MEDoc application is about 1.5 GB, and we haven‚Äôt yet had enough time to check if there are any other backdoors in it. <br><br>  We still have to answer a number of questions.  How long has the backdoor been used?  What commands and malware, in addition to DiskCoder.C and AESNI.C, were sent through this channel?  What other infrastructures have been compromised, but not yet used by the cyber group behind this attack? <br><br>  Thanks for the help of colleagues Fr√©d√©ric Vachon and Thomas Dupuy. <br><br><h3>  Infection Indicators (IoC) </h3><br>  <b>Detection by ESET products:</b> <br> <code>MSIL/TeleDoor.A</code> <br> <br>  <b>Legitimate server used by malware authors:</b> <br> <code>upd.me-doc.com[.]ua</code> <br> <br>  <b>Registry key:</b> <br> <code>HKEY_CURRENT_USER\SOFTWARE\WC</code> <br> <br>  <b>SHA-1 hashes:</b> <br> <code>7B051E7E7A82F07873FA360958ACC6492E4385DD <br> 7F3B1C56C180369AE7891483675BEC61F3182F27 <br> 3567434E2E49358E8210674641A20B147E0BD23C</code> </div><p>Source: <a href="https://habr.com/ru/post/332472/">https://habr.com/ru/post/332472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332462/index.html">What if throwing all the excess out of the database into a distributed cache is our experience using Hazelcast</a></li>
<li><a href="../332464/index.html">Color segmentation for dummies</a></li>
<li><a href="../332466/index.html">The market of detection and recognition systems: Emotions and "emotional calculations"</a></li>
<li><a href="../332468/index.html">How to pass an interview in a dream company? Tips from timlidov IT companies</a></li>
<li><a href="../332470/index.html">It's about time: a secure corporate instant messenger from a Russian integrator will be shown in Digital October</a></li>
<li><a href="../332474/index.html">Backup scripts to the Google Cloud Platform (GCP) cloud in five minutes</a></li>
<li><a href="../332476/index.html">We design storage for video surveillance</a></li>
<li><a href="../332478/index.html">Try to work less to fit your culture</a></li>
<li><a href="../332482/index.html">We rewrite the home project on microservices (Java, Spring Boot, Gradle)</a></li>
<li><a href="../332484/index.html">Growing up on Python problems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>