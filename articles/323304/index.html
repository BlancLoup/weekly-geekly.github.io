<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are looking for and analyzing errors in the code Media Portal 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Media Portal 2 is an open source media center software that allows you to watch videos, photos, listen to music and more. For us, the developers of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are looking for and analyzing errors in the code Media Portal 2</h1><div class="post__text post__text-html js-mediator-article">  Media Portal 2 is an open source media center software that allows you to watch videos, photos, listen to music and more.  For us, the developers of the <i>PVS-Studio</i> static analyzer, this is another opportunity to check an interesting project, tell people (and developers including) about the errors found and, in turn, once again show the capabilities of our analyzer. <br><br><div style="text-align:center;"><img src="http://www.viva64.com/media/images/content/b/0481_Media_Portal/image1.png" alt="Picture 9"></div><a name="habracut"></a><br><h2>  About Media Portal 2 </h2><br>  The project description is taken <a href="https://ru.wikipedia.org/wiki/MediaPortal">from Wikipedia</a> : <br><br>  <i>MediaPortal</i> allows the computer to solve various entertainment-oriented tasks, such as recording, pausing and rewinding television broadcasts, like <i>DVR</i> systems (such as <i>TiVo</i> ).  Other functionality includes watching videos, listening to music with building dynamic playlists based on data from the music social network Last.fm, launching games, recording radio broadcasts and viewing image collections.  <i>MediaPortal</i> supports a system of plug-ins and design schemes, allowing to extend the basic functionality. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The overwhelming part of the project is written in C #.  There are separate modules written in C ++.  As far as I understand, the developers of Media Portal 2 use in their work on the ReSharper project.  I make this conclusion in connection with its mentioning in the <i>.gitignore</i> file.  We do not like the idea of ‚Äã‚Äãcomparing ReSharper and PVS-Studio, since these are tools of different types.  But, as you can see, using ReSharper does not prevent us from finding real errors in the code. <br><br><h2>  Test results </h2><br>  3321 files participated in the check.  In total, they contained 512,435 lines of code.  As a result of checking in the server project at the first (high) level, 72 warnings were received.  Of these, 57 explicitly or indirectly pointed out errors, typos, problem and strange places in the code.  At the second level (average), 79 warnings were received.  In my subjective opinion, the 53 warnings correctly indicated problematic or strange places in the code.  We will not consider the third (low) level of warnings, as these are warnings with a low level of confidence and, as a rule, among them there are a lot of false positives or there are warnings that are not relevant for many types of projects. <br><br><p><img src="http://www.viva64.com/media/images/content/b/0481_Media_Portal/image2.png" alt="Picture 1"></p><br><br>  The analyzer revealed 0.2 errors per 1000 lines of code.  The percentage of false positives is only 27%, which is a very good result. <br><br>  I‚Äôll just make a reservation that it‚Äôs pretty hard to determine what the programmer meant when writing this or that code, so the places that I thought were wrong could have perverted logic and work fine within a particular algorithm, but if this code is reused in another a person who does not know all the nuances of implementation, then with a high degree of probability this can lead to errors.  I also want to note that the article presents not all errors. <br><br>  So, we proceed to the consideration of the most interesting of the errors found.  In more detail, the authors of the project will be able to study the errors by requesting a temporary license from us and performing the verification themselves.  Also, dear readers, if you are a non-commercial developer, then I suggest you use the <a href="http://www.viva64.com/ru/b/0457/">free version of</a> our static analyzer.  Its functionality is absolutely identical with a paid license, so it is ideal for students, individual developers and enthusiast teams. <br><br><h3>  Typos with Copy-Paste </h3><br><p><img src="http://www.viva64.com/media/images/content/b/0481_Media_Portal/image3.png" alt="Picture 2"></p><br><br>  I‚Äôll start, perhaps, with a number of fairly common mistakes, when a programmer, having copied one block of code, inadvertently forgot to replace one or more variables in it. <br><br>  V3127 Two code fragments were found.  Perhaps, this is a typo and an 'AllocinebId' variable should be used instead of a 'CinePassionId' MovieRelationshipExtractor.cs 126 <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (movie.CinePassionId &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ids.Add(ExternalIdentifierAspect.SOURCE_CINEPASSION, movie.CinePassionId.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (movie.CinePassionId &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= ids.Add(ExternalIdentifierAspect.SOURCE_ALLOCINE, movie.AllocinebId.ToString());</span></span></code> </pre> <br>  Such errors are very difficult to find in the usual Code Review.  Since the code is very heavily plastered, it is likely that the programmer simply does not notice the defect.  Looking at the line marked with a comment, you can see that in the second <i>if</i> block, the word <i>Allocine is used</i> instead of <i>CinePassion everywhere</i> , but in the verification condition you probably forgot to replace the variable <i>CinePassionId</i> with <i>AllocinebId</i> . <br><br>  In addition to this error, the V3127 diagnostics has found some more interesting typos that show all the danger of Copy-Paste. <br><br>  V3127 Two code fragments were found.  Perhaps, this is a typo and 'Y' variable should be used instead of 'X' PointAnimation.cs 125 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> distx = (to.X - <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.X) / duration; distx *= timepassed; distx += <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.X; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> disty = (to.X - <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.Y) / duration; <span class="hljs-comment"><span class="hljs-comment">// &lt;= disty *= timepassed; disty += from.Y;</span></span></code> </pre> <br>  V3127 Two code fragments were found.  Perhaps this is a typo and 'X' variable should be used instead of 'Y' Point2DList.cs 935 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> dx1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[upper].Y - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[middle].X; <span class="hljs-comment"><span class="hljs-comment">// &lt;= double dy1 = this[upper].Y - this[middle].Y;</span></span></code> </pre> <br>  V3127 Two code fragments were found.  Perhaps this is a typo and 'attrY' variable should be used instead of 'attrX' AbstractSortByComparableValueAttribute.cs 94 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (attrX != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { valX = (T?)aspectX.GetAttributeValue(attrX); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (attrY != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { valX = (T?)aspectX.GetAttributeValue(attrX); <span class="hljs-comment"><span class="hljs-comment">// &lt;= }</span></span></code> </pre> <br>  In all cases, in the first block, calculations are performed with the <i>X</i> axis, and in the second block, with the <i>Y</i> axis.  If you look at the lines marked with comments, you can see that the programmer forgot to replace <i>X</i> with <i>Y</i> or vice versa during Copy-Paste of one of the blocks. <br><br><h3>  Access via null link </h3><br>  Programming languages ‚Äã‚Äãevolve, but the main ways to shoot yourself in the foot remain.  In the code section below, the programmer first checks whether the <i>BannerPath</i> variable is <i>not</i> zero.  If, however, it is still zero, then the <i>Equals</i> method checks its equality to the empty string, which in fact may be a potential cause of the <i>NullReferenceException</i> exception. <br><br>  V3080 Possible null dereference.  Consider inspecting 'BannerPath'.  TvdbBannerWithThumb.cs 91 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ThumbPath == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; (BannerPath != <span class="hljs-literal"><span class="hljs-literal">null</span></span> || BannerPath.Equals(<span class="hljs-string"><span class="hljs-string">""</span></span>))) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { ThumbPath = String.Concat("_cache/", BannerPath); }</span></span></code> </pre> <br>  This piece of code is rather strange, considering the code under verification.  In my opinion, the check should work if the <i>BannerPath</i> variable <i>is</i> not null and an empty string. <br><br>  Then the corrected version could look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ThumbPath == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(BannerPath)) { ThumbPath = String.Concat(<span class="hljs-string"><span class="hljs-string">"_cache/"</span></span>, BannerPath); }</code> </pre> <br><h3>  Incorrect operator priority </h3><br><p><img src="http://www.viva64.com/media/images/content/b/0481_Media_Portal/image4.png" alt="Picture 3"></p><br><br>  I propose to consider another equally interesting triggering associated with the wrong priority of logical operators. <br><br>  V3130 Priority of the '&amp;&amp;' operator is higher than that of the '||  operator.  Possible missing parentheses.  BinaryCacheProvider.cs 495 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config.EpisodesLoaded || !checkEpisodesLoaded &amp;&amp; config.BannersLoaded || !checkBannersLoaded &amp;&amp; config.ActorsLoaded || !checkActorsLoaded;</code> </pre> <br>  The programmer who wrote this code apparently did not take into account that the <i>logical AND</i> operator <i>(&amp;&amp;)</i> has a higher priority than the <i>logical OR</i> operator <i>(||)</i> .  Again, once again, I advise you to explicitly indicate the order of operations and separate them with brackets. <br><br>  Another error due to incorrect operator precedence.  The programmer did not take into account that the <i>+</i> operator has a higher priority than the operator <i>??</i>  . <br><br>  V3022 Expression '"Invalid header name:" + name' is always not null.  The operator '??'  is excessive.  HttpRequest.cs 309 <br><br><pre> <code class="cs hljs">...(<span class="hljs-string"><span class="hljs-string">"Invalid header name: "</span></span> + name ?? <span class="hljs-string"><span class="hljs-string">"&lt;null&gt;"</span></span>);</code> </pre> <br>  As a result, if the name variable is zero, it will be added to the string <i>‚ÄúInvalid header name:‚Äù</i> as an empty string, and will not be replaced with the expression <i>"&lt;null&gt;"</i> .  In itself, this is not a gross mistake and in this context will not lead to a fall. <br><br>  The corrected version would look like this: <br><br><pre> <code class="cs hljs">...(<span class="hljs-string"><span class="hljs-string">"Invalid header name: "</span></span> + (name ?? <span class="hljs-string"><span class="hljs-string">"&lt;null&gt;"</span></span>));</code> </pre> <br><h3>  Typo after type casting </h3><br>  Another fairly common typo made by inattention.  Notice the <i>other</i> and <i>obj</i> variables. <br><br>  V3019 Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'obj', 'other'.  EpisodeInfo.cs 560 <br><br><pre> <code class="cs hljs">EpisodeInfo other = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EpisodeInfo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (TvdbId &gt; 0 &amp;&amp; other.TvdbId &gt; 0) return TvdbId == other.TvdbId; ....</span></span></code> </pre> <br>  In this part of the code, the <i>obj</i> variable is first explicitly <i>cast</i> to the <i>EpisodeInfo</i> type, and the result of the cast is written to the <i>other</i> variable.  Notice that further the variable <i>other</i> is used everywhere, but the variable <i>obj is</i> checked for <i>null</i> .  If the <i>obj</i> variable is of a type other than the one to which it leads, then further work with the <i>other</i> variable will result in an exception. <br><br>  The corrected part of the code will look like this: <br><br><pre> <code class="cs hljs">EpisodeInfo other = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EpisodeInfo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (other == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TvdbId &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; other.TvdbId &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TvdbId == other.TvdbId; ....</code> </pre> <br><h3>  Double assignment </h3><br>  Another interesting error found by the static analyzer.  The code section below will not make sense, since the <i>Released</i> variable will always be set to zero. <br><br>  V3008 The 'Released' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 57, 56. OmDbSeasonEpisode.cs 57 <br><br><pre> <code class="cs hljs">DateTime releaseDate; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DateTime.TryParse(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> releaseDate)) Released = releaseDate; <span class="hljs-comment"><span class="hljs-comment">// &lt;= Released = null; // &lt;=</span></span></code> </pre> <br>  Most likely the expression with zeroing should be in the <i>else</i> block.  Then the corrected version of this code section would look like this: <br><pre> <code class="cs hljs">DateTime releaseDate; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DateTime.TryParse(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> releaseDate)) Released = releaseDate; <span class="hljs-comment"><span class="hljs-comment">// &lt;= else Released = null; // &lt;=</span></span></code> </pre> <br><h3>  When in the minute is not always 60 seconds </h3><br><p><img src="http://www.viva64.com/media/images/content/b/0481_Media_Portal/image5.png" alt="Picture 4"></p><br><br>  V3118 Milliseconds component of TimeSpan is used, which does not constitute the full time interval.  Possibly 'TotalMilliseconds' value was intended instead.  Default.cs 60 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForNextFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> msToNextFrame = _msPerFrame - (DateTime.Now - _frameRenderingStartTime).Milliseconds; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msToNextFrame &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) Thread.Sleep(TimeSpan.FromMilliseconds(msToNextFrame)); }</code> </pre> <br>  Another fairly common typo, arising from the not quite obvious implementation of the <i>TimeSpan</i> type.  The programmer apparently did not know that the <i>Milliseconds</i> property of an object of type <i>TimeSpan</i> does not return the total number of milliseconds in this time interval, but the residual number of milliseconds. <br><br>  For example, if we have a time span of 1 second 150 milliseconds, then the call to the <i>Milliseconds</i> method will return us only 150 milliseconds.  If you need to return a total quantity, you must use the <i>TotalMilliseconds</i> property.  For this example, it will be 1150 milliseconds. <br><br>  The correct version would look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> msToNextFrame = _msPerFrame - (DateTime.Now - _frameRenderingStartTime).TotalMilliseconds;</code> </pre> <br><h3>  Wrong order of arguments </h3><br>  Another mistake from the category of inadvertent misprints.  The <i>TryCreateMultimediaCDDriveHandler</i> method accepts enumerations of identifiers for video, images and audio in the specified sequence. <br><br>  V3066 PossibleCreateMultimediaCDDriveHandler method.  RemovableMediaManager.cs 109 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> MultimediaDriveHandler </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryCreateMultimediaCDDriveHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DriveInfo driveInfo, IEnumerable&lt;Guid&gt; videoMIATypeIds, IEnumerable&lt;Guid&gt; imageMIATypeIds, // &lt;= IEnumerable&lt;Guid&gt; audioMIATypeIds</span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// &lt;= { .... }</span></span></span></span></code> </pre> <br>  Since these parameters have the same types - the programmer did not pay attention to the fact that when passing arguments to the method, I messed up the image and audio: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ....() { MultimediaDriveHandler.TryCreateMultimediaCDDriveHandler(driveInfo, Consts.NECESSARY_VIDEO_MIAS, Consts.NECESSARY_AUDIO_MIAS, <span class="hljs-comment"><span class="hljs-comment">// &lt;= Consts.NECESSARY_IMAGE_MIAS) // &lt;= }</span></span></code> </pre> <br><h3>  The condition is always false </h3><br>  This code is rather strange, so I wondered for a long time whether to include it in the article: <br><br>  V3022 Expression 'IsVignetteLoaded' is always false.  TvdbFanartBanner.cs 219 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsVignetteLoaded) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { Log.Warn(....); return false; } try { if (IsVignetteLoaded) // &lt;= { LoadVignette(null); } ....</span></span></code> </pre> <br>  I can assume that the first check was added for debugging purposes, and apparently the programmer forgot to remove it.  As a result, it blocks the second check, which can lead to incorrect operation of the program. <br><br><h3>  Excess check, or gross typo? </h3><br>  V3001 There are identical sub-expressions 'screenWidth! = _ScreenSize.Width' to the left |  operator.  MainForm.cs 922 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bitDepth != _screenBpp || screenWidth != _screenSize.Width || screenWidth != _screenSize.Width) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { .... }</span></span></code> </pre> <br>  Check out the latest check.  Most likely the programmer wanted to check the width and height, but after Copy-Paste he forgot to replace <i>Width</i> with <i>Height</i> in the last test. <br><br>  The analyzer also found another similar error: <br><br>  V3001 There are identical sub-expressions "p == null" ||  operator.  TriangulationConstraint.cs 141 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">uint</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateContraintCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> TriangulationPoint p, TriangulationPoint q</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || p == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { throw new ArgumentNullException(); } .... }</span></span></code> </pre> <br>  If we look at the body of the method in more detail, we can notice that the <i>p</i> parameter is checked twice for <i>null</i> , and the logic of this method also implies the use of the <i>q</i> parameter.  Most likely, the right part of the check should contain checking the variable <i>q</i> instead of <i>p</i> . <br><br><h3>  Forgotten condition or some more copy-paste </h3><br>  As you can see, most of the errors in this article are typos during Copy-Paste, and the following error is no exception. <br><br>  V3003 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 452, 462. Scanner.cs 452 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (style == NumberStyles.Integer) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ivalue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(num, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> ivalue)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ivalue; .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (style == NumberStyles.Integer) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { return double.Parse(num); }</span></span></code> </pre> <br>  In both tests, the <i>style</i> variable is compared with the same value in the enumeration.  As a consequence, the second check will never be performed.  If we take into account the fact that in the first check the string is converted to an integer, and in the second check - to a floating point number.  Most likely the condition of the second check should look like this: <br><br><pre> <code class="cs hljs">.... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (style == NumberStyles.Double) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { return double.Parse(num); }</span></span></code> </pre> <br><h2>  Conclusion </h2><br><p><img src="http://www.viva64.com/media/images/content/b/0481_Media_Portal/image6.png" alt="Picture 5"></p><br><br>  In this project, there were other errors, typos, shortcomings.  But they did not seem interesting to me to describe them in the article.  In general, I can say that the code base of the project is poorly readable and contains many strange places.  Most of them were not described in the article, but I still attribute them to the poor style of writing code.  This could include using the <i>foreach loop</i> to get the first element of the collection and exit from it using <i>break</i> at the end of the first iteration, numerous redundant checks, large solid-cast blocks of code, etc. <br><br>  <i>Media Portal 2</i> developers can easily find all the shortcomings using the <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> tool.  You can also look for errors in your projects using the static analyzer proposed above. <br><br>  I want to remind you that the main advantage of static analysis is its regular use.  Download and check one-time code - this is not serious.  For example, programmers watch the compiler warnings regularly, rather than turning them on every 3 years before one of the releases.  With regular use, a static analyzer will save a lot of time searching for typos and errors. <br><br><h2>  IMPORTANT </h2><br>  We decided to try a new format to popularize static code analysis and the PVS-Studio tool.  Now we will record streams and demonstrate how to use PVS-Studio to find errors, deal with bugs and false positives.  We will answer questions and practice interactive communication with the audience, trying to adapt to their interests and show what most corresponds to the wishes of the audience. <br><br>  The first stream devoted to this article.  In online mode, we show you how to check a Media Portal 2 project and find errors.  This is the first experiment, so please treat with understanding.  We warn you in advance that due to inexperience we may face technical overlays.  However, we ask all readers to join the viewing.  If you like the format, we will practice such events regularly. <br><br>  The stream will be held today (03/06/2017) at 15:00.  We are waiting for all <a href="https://www.twitch.tv/pvs_studio_ru">pvs_studio_ru</a> ! <br><br>  And, of course, we offer everyone to subscribe to our channel. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0481/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Ivan Kishchenko.  <a href="http://www.viva64.com/en/b/0481/">Brief analysis of Media Portal 2 bugs</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/323304/">https://habr.com/ru/post/323304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323294/index.html">Testing problems: why 100% code coverage is bad</a></li>
<li><a href="../323296/index.html">We connect VKontakte SDK for Xamarin.Forms</a></li>
<li><a href="../323298/index.html">Windows Server 2016 and Hyper-V Integration Services</a></li>
<li><a href="../323300/index.html">The Turing Competition for Student Theory. computer science and discrete mathematics</a></li>
<li><a href="../323302/index.html">Encryption algorithm based on elementary cellular automata</a></li>
<li><a href="../323306/index.html">How IT professionals work. Leonid Vyhovsky, systems architect, LiveTex</a></li>
<li><a href="../323308/index.html">We repeat the design of applications that have received Apple award</a></li>
<li><a href="../323310/index.html">The book ‚ÄúGrokayem algorithms. Illustrated manual for programmers and curious</a></li>
<li><a href="../323312/index.html">Authentication and voice identification using Microsoft cognitive services</a></li>
<li><a href="../323314/index.html">Proper communication on the example of volleyball</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>