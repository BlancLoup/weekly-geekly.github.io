<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Notification system from the console to Telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the past, there were often situations where there is a demanding task that takes a long time, but it is advisable to respond quickly after the end,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Notification system from the console to Telegram</h1><div class="post__text post__text-html js-mediator-article"><p>  In the past, there were often situations where there is a demanding task that takes a long time, but it is advisable to respond quickly after the end, what to do?  Of course, write a program ... </p><br><p>  The first version simply used notify-send, but time showed some inconvenience to the process.  Since the operations were very demanding of the car, the car became un-usable at that moment and wanted to go and drink coffee.  But return when the process is complete.  Therefore, the idea of ‚Äã‚Äãa program appeared, which can be added to the console pipeline or wrapped like a sudo program and at the end sends you a notification to the chat.  Thus, you will see the notification both on the desktop and on the phone. </p><a name="habracut"></a><br><p>  For those who do not want to read, but want to try.  (Linux only) </p><br><ol><li>  Register <a href="https://telegram.me/Terminal_snitch_bot">with the bot</a> and get the token with the command / config </li><li>  Download client </li><li>  Run! <br><pre><code class="bash hljs">wget https://ice2heart.com/snitch chmod +x snitch SNITCH_USER_ID=&lt;here_is_your_uuid&gt; ./snitch sleep 10</code> </pre> </li></ol><br><h2 id="server">  Server </h2><br><p>  The idea was simple, we need a simple server that will receive the message and send it to the user. </p><br><p>  And since I did not want to bother with registering, storing and managing accounts, I decided to do it as it seemed to me simply (and now it seems, but I'm not sure that this is good). </p><br><p>  Using a bot, a person receives a unique uuid v4, with which he then goes to the server.  Authorization on the client chat side, but I only keep a couple of uuid-internal IDs. </p><br><p>  Therefore, taking node.js as a server and adding a bit of koa, nedb, node-telegram-bot-api, I assembled the server part, the architecture initially meant more gateway to the chats, but there were no cases and therefore there was only one telegram left. </p><br><p>  Also, I did not want to put the js application on the Internet directly, so using the magic of the docker, I added a proxy server caddy.  Why he?  Because I like the format of the configuration files. </p><br><p>  The server turned out simple, but sufficient for work. </p><br><p>  Therefore, we got such a simple docker-compose file, we also need a key for the bot, which we put in the .env file so as not to save our keys in the github, which is not good. </p><br><p>  So to run, we need docker, docker-compose and a key for bot carts to get your own, you have to contact <a href="https://telegram.me/BotFather">botfather</a> . <br>  After that, docker-compose up and our server is ready for work. </p><br><h2 id="klient">  Customer </h2><br><p>  For the client, I decided to take go for the simple reason that it is going into 1 binary file, which can then be easily distributed. </p><br><p>  There were two main ideas about the client. </p><br><ol><li>  We build in the pipeline, collect the log (not implemented), send the message to close the pipeline. </li><li>  We wrap the application, for example sudo, upon completion we send a log and a message with a return code. </li></ol><br><p>  During the implementation, there was no easy way to find out the return code of the previous program in the pipeline, which unfortunately reduces the joy of using the program in the pipeline. <br>  For configuration, I chose environment variables, because they allow you to easily copy the settings from the machine to the machine, plus they are easily replaced. </p><br><p>  As a result, the installation becomes as simple as possible. </p><br><ol><li>  Downloading the binary </li><li>  Register in PATH </li><li>  We set the SNITCH_USER_ID variable into the shell configuration with your uuid </li><li>  Done, you're great! </li></ol><br><p>  Now you can run long commands in the form of <code>snitch make</code> and at the end we will receive a message that the application has ended and we will even know, successfully or not. </p><br><p>  To build, I made a small script that simply called r.  He will build the go app and skip it through upx.  And at the output we get a beautiful statically linked binary. </p><br><p>  <a href="https://github.com/ice2heart/terminal_snitch">You can find the source code here.</a> </p><br><p>  And when everything is ready, you can access the bot with the command / config <br>  And he will create an entry about our user and return uuid. <br>  Also, you can always be removed from the database, for this there is a command / delete </p><br><p>  Thus, we got a fairly simple but effective application that notifies us about the completed task, easily and naturally, even when we drink coffee. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/425707/">https://habr.com/ru/post/425707/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425695/index.html">Reports about the battle of CI and CD, orchestration and secrets of OpenStack</a></li>
<li><a href="../425697/index.html">KotlinConf 2018 - keyout and first videos</a></li>
<li><a href="../425701/index.html">IoT Security Week 38: vulnerabilities in MikroTik, D-Link and TP-Link routers</a></li>
<li><a href="../425703/index.html">Kafka in Wargaming: a blitz</a></li>
<li><a href="../425705/index.html">Replication from Percona Server for MySQL to PostgreSQL using the pg_chameleon tool</a></li>
<li><a href="../425709/index.html">We made a memo for the Chinese who came to you</a></li>
<li><a href="../425711/index.html">Losses in mismatched line</a></li>
<li><a href="../425713/index.html">Integration of HTML engine in native Windows application - choice and architecture</a></li>
<li><a href="../425715/index.html">Educational program in chemistry: acid reversing of microcircuits (how to expose a crystal of a microcircuit for its subsequent photographing)</a></li>
<li><a href="../425717/index.html">Neural Network for C ++ Developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>