<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the experience of testing a relational database for NoSQL technology</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tarantool is an open, high-performance data warehouse. Such system characteristics as simplicity and performance largely determine the area of ‚Äã‚Äãits a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the experience of testing a relational database for NoSQL technology</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://tarantool.org/">Tarantool</a> is an open, high-performance data warehouse.  Such system characteristics as simplicity and performance largely determine the area of ‚Äã‚Äãits applicability.  On the scale of storage solutions, Tarantool lies somewhere in the middle between traditional relational systems, such as MySQL, and data caching solutions, such as memcached.  The system is based on a persistent data store, fully mapped to RAM, and high-performance indexes for accessing data based on hashes and binary trees. <br><br>  In my first months of working on Tarantool, I tried to create testing tools similar to the one I had in my previous open source project - MySQL. <a name="habracut"></a><br><br>  Because  tools like <a href="http://dev.mysql.com/doc/refman/5.5/en/mysql-test-suite.html">mysql-test-run, mysqltest,</a> pushbuild are little known outside the MySQL ecosystem, I will describe what we managed to create, in several blog posts, each will be devoted to a separate component. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In short, modern open source projects use a set of tools that allow them to be developed in a ‚Äúcivilized‚Äù way.  Some projects use only part of the toolkit, but the automation of the full development cycle, in my opinion, allows to achieve the best results. <br><br>  We are talking about the following automation components: <br><br>  - automated regression testing, <br>  - tools for functional and unit testing, <br>  - automatic continuous integration testing, <br>  - automatic creation of packages and distributions for product installation. <br><br>  These tools, assembled and working together, determine the habitat of each new feature added to the product, accompany development throughout the cycle, allow engineers to create better code, eliminate routine, give the project a whole opportunity to grow. <br><br>  I have to admit that when I started working on the automation task, I did not fully know what I would have to face. <br><br>  Tarantool is a key / value repository that can be distributed, but I approached the task, paying maximum attention to the issues of functional regression testing, that is, as it was done in MySQL. <br><br>  My initial understanding of NoSQL was that it was just a more efficient storage, which, however, provides only part of the functionality of a full-fledged DBMS. <br>  I was not quite right. <br><br>  <b>Functional testing Tarantool</b> <br><br>  Tarantool provides its customers with a simple binary protocol that supports the basic set of commands for working with data - GET, PUT, SET, DELETE. <br><br>  Administrative commands, such as 'SAVE SNAPSHOT', 'SHOW STAT', are sent in text as a separate administrative port. <br><br>  A separate port for the administration is necessary if only because at the moment Tarantool does not support any authorization scheme. <br><br>  By the beginning of my work on the project in Tarantool, there were already several functional tests, but they did not work in automated mode.  In a nutshell, if this test is written by you, you most likely will not use it. <br><br>  Unlike existing tests, I was looking for a testing language in which it would be equally easy to write tests as well as to understand those already written.  This was supposed to be a language that Tarantool developers and testing engineers could speak. <br><br>  It was also important to be able to create test scripts for all errors found in the new environment. <br><br>  Of course, for an ex-SQL programmer, SQL looked very attractive.  In the end, for SQL, at least there is a standard, whereas the ‚Äúlanguages‚Äù of modern NoSQL systems do not even have a common subset. <br><br>  So, SQL was chosen as the language for writing tests.  In terms of SQL, Tarantool provides 4 data manipulation operators: INSERT, SELECT, UPDATE, DELETE. <br><br>  Of course, the SQL grammar is much richer than the functionality of Tarantool, but this, in my opinion, was acceptable.  It was not a very pleasant surprise that the part of the storage key / value functional was impossible to express in terms of SQL. <br><br>  First of all, Tarantool does not operate relations (sets of tuples), like the SQL standard, but key / value pairs.  There are no multiple operations, and even those operations that work with several tuples, in fact, combine several operations into a package, and do not work with the set as a whole. <br>  In SQL terms, this means that all operators that manipulate data must contain a WHERE clause and a link to a unique key. <br><br>  Further, the objects of the Tarantool database are addressed by index, not by name.  Instead of SQL ‚Äútables‚Äù, ‚Äúkey spaces‚Äù (namespaces) are used, numbered from 0 to N. <br><br>  At the same time, in each space, which, in fact, consists of many different-sized tuples, there can be several indices for different fields or combinations of fields. <br>  The data is accessed by index number (instead of ‚Äúindex‚Äù the term ‚Äúkey‚Äù is also often used, but I prefer to call an individual value rather than a data structure) rather than the number or name of a column.  Index number 0 is always considered a primary key. <br><br>  OK, Tarantool's SQL grammar has been shortened to allow only identifiers that end in numbers. <br><br>  Then, because  the key space has no dimension or fixed structure, there is no possibility to work only with a part of the tuple - all operators, with the exception of UPDATE, work with the entire tuple. <br><br>  SELECT SQL, therefore, can only accept '*'. <br><br>  When the grammar abbreviation was completed, I found that Tarantool allows INSERT, UPDATE and DELETE to return the old value of the tuple as a return value.  For this purpose, there was no suitable construction in the standard SQL subset. <br>  But in general, I achieved my goal - the creation of a micro-language with a simple, well-known, easy-to-understand syntax. <br><br>  Because  I chose Python as the programming language for the automation infrastructure, and the YAPPS library was used to create the SQL parser.  <a href="http://kostja-osipov.livejournal.com/32262.html">I wrote</a> about the advantages and disadvantages of this solution <a href="http://kostja-osipov.livejournal.com/32262.html">separately in my blog.</a> <br><br>  In order not to skip administrative commands through the parser, I simply added a regular expression that allows you to filter them from SQL queries at an early stage.  Such commands were sent directly to the server through the administrative port. <br><br>  The result was a fairly convenient command line client, on which you could easily write tests: <br><br> <code>kostja@shmita:~/work/tarantool/test$ ./tarantool <br> tarantool&gt; select * from t0 where k0 = 1 <br> No match <br> tarantool&gt; insert into t0 values (1, "My first tuple" <br> Insert OK, 1 row affected <br> tarantool&gt; select * from t0 where k0 = 1 <br> Found 1 tuple: <br> [1, 'My first tuple'] <br> tarantool&gt; save snapshot <br> --- <br> ok <br> ... <br> tarantool&gt; show info <br> --- <br> info: <br> version: "1.3.2-264-ga7bb270" <br> uptime: 73 <br> pid: 22101 <br> wal_writer_pid: 22102 <br> lsn: 2 <br> recovery_lag: 0.000 <br> recovery_last_update: 0.000 <br> status: primary <br> ... <br></code> <br><br>  The next component was the automation of the test run, written in a new language.  I will write about this in a separate article. <br><br>  PS Yes, Tarantool is an open source product, and everything I've done is already available <a href="http://www.github.com/mailru/tarantool">in the main project tree on github</a> . <br><br>  Trying how it works is simple enough: clone the source code, install the necessary libraries (mostly we are talking about Python libraries), compile (cmake. &amp;&amp; make), start the server (cd test &amp;&amp; ./run --start-and-exit) and connect to it using the new client (cd test &amp;&amp; ./tarantool). </div><p>Source: <a href="https://habr.com/ru/post/113421/">https://habr.com/ru/post/113421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113412/index.html">Sony accidentally retweeted the PlayStation jailbreak code</a></li>
<li><a href="../113413/index.html">Internet company: right and mistakes</a></li>
<li><a href="../113414/index.html">Russian investors have invested in a collective intelligence support startup</a></li>
<li><a href="../113419/index.html">Extreme agile - I dance alone</a></li>
<li><a href="../113420/index.html">KISS + Ruby = load server fast</a></li>
<li><a href="../113423/index.html">Who is cheaper?</a></li>
<li><a href="../113425/index.html">iPad and news: a small overview of the best apps</a></li>
<li><a href="../113426/index.html">Release Flash Player 10.2</a></li>
<li><a href="../113427/index.html">RAID-4 / RAID-DP - turning disadvantages into advantages</a></li>
<li><a href="../113429/index.html">C ++, C-style coercion and unexpected consequences of their combination</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>