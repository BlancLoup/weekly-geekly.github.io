<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tired of writing PropertyDrawer in Unity? There is a better way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, I participated in the development of the game on Unity. I spent a lot of time on tools for colleagues: a level editor for a game desi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tired of writing PropertyDrawer in Unity? There is a better way</h1><div class="post__text post__text-html js-mediator-article"><p>  Not so long ago, I participated in the development of the game on Unity.  I spent a lot of time on tools for colleagues: a level editor for a game designer, convenient databases for artists. </p><br><p>  For obvious reasons, in programming interfaces under Unity, we cannot always use automatic layout ( <em>convenient</em> GUILayout tools), and often we have to manually cut <abbr title="Rect">rectangles</abbr> and draw interfaces using GUI class tools.  This work is tedious, associated with a large number of errors, and the code is difficult to maintain.  Over time, the thought familiar to every programmer arose: <del>  I'll write my bike! </del>  <strong>"There must be a better way!"</strong>  .  For details, I invite under the cat. </p><br><p><img src="https://habrastorage.org/webt/59/e8/37/59e8375d80d3d665463074.png"><br>  <em>The picture for attracting attention is taken <a href="">from here</a> .</em> </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">First of all, the most understandable reasons</b> <div class="spoiler_text"><p>  GUILayout to calculate the size of the drawn fields, calls the OnGUI method twice: </p><br><ul><li> In the first run with <code>event.type == EventType.Layout</code> draws nothing, it only collects data about all components to be drawn in order to calculate the size of the rectangle for each of them; </li><li>  During the second pass, all elements are drawn for real. </li></ul><br><p>  Do not forget about the overhead for calculating rectangles.  Thus, the understandable reasons here are <strong>optimization</strong> . </p><br><p>  Thanks to this logic, the developer is waiting for the brain-blowing artifacts of drawing and bugs, when in samopisnye editors (most often it refers to the heirs of EditorWindow), he mixes up the use of both GUILayout and GUI methods.  For example, if <code>GUILayoutUtility.GetLastRect()</code> or GUILayoutUtility.GetRect () is used <code>GUILayoutUtility.GetLastRect()</code> and the result is stored in the field, or the logic is tied to delegates and callbacks. </p><br><p>  Problems are well treated by checking in critical places: </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">if</span></span> (<span class="hljs-type"><span class="hljs-type">Event</span></span>.current.<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> != </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EventType</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Layout</span></span></span><span class="hljs-class">) { ... }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">About my attitude to cutting rectangles</b> <div class="spoiler_text"><p>  The very first time I read the PropertyDrawer <a href="https://docs.unity3d.com/ScriptReference/PropertyDrawer.html">documentation</a> , I was terrified of working with rectangles.  They suggest doing it this way: </p><br><pre> <code class="hljs pgsql">// Calculate rects var amountRect = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect(position.x, position.y, <span class="hljs-number"><span class="hljs-number">30</span></span>, position.height); var unitRect = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect(position.x + <span class="hljs-number"><span class="hljs-number">35</span></span>, position.y, <span class="hljs-number"><span class="hljs-number">50</span></span>, position.height); var nameRect = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect(position.x + <span class="hljs-number"><span class="hljs-number">90</span></span>, position.y, position.width - <span class="hljs-number"><span class="hljs-number">90</span></span>, position.height); // Draw fields - passs GUIContent.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> so they are drawn <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> labels EditorGUI.PropertyField(amountRect, property.FindPropertyRelative("amount"), GUIContent.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>); EditorGUI.PropertyField(unitRect, property.FindPropertyRelative("unit"), GUIContent.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>); EditorGUI.PropertyField(nameRect, property.FindPropertyRelative("name"), GUIContent.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>);</code> </pre> <br><p>  Often in <a href="http://www.vrusso.com.br/2014/07/unity3d-tutorials-custom-editor-inspector-property-drawers-and-editor-windows/">tutorials</a> they do this (I changed the code a bit to emphasize the particular approach to working with rectangles): </p><br><pre> <code class="hljs vhdl">// Draw first field position.<span class="hljs-literal"><span class="hljs-literal">width</span></span> -=<span class="hljs-number"><span class="hljs-number">200</span></span>; EditorGUI.PropertyField (position, <span class="hljs-keyword"><span class="hljs-keyword">property</span></span>.FindPropertyRelative(<span class="hljs-string"><span class="hljs-string">"level"</span></span>), GUIContent.none); // Shift rect <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> draw second field position.x = position.<span class="hljs-literal"><span class="hljs-literal">width</span></span> + <span class="hljs-number"><span class="hljs-number">20</span></span>; position.<span class="hljs-literal"><span class="hljs-literal">width</span></span> = position.<span class="hljs-literal"><span class="hljs-literal">width</span></span> - position.<span class="hljs-literal"><span class="hljs-literal">width</span></span> - <span class="hljs-number"><span class="hljs-number">10</span></span>; EditorGUI.PropertyField (position, <span class="hljs-keyword"><span class="hljs-keyword">property</span></span>.FindPropertyRelative(<span class="hljs-string"><span class="hljs-string">"type"</span></span>), GUIContent.none );</code> </pre> <br><p>  It should be noted that at that moment I did not know about the possibilities of GUILayout.  Imagine my horror when I decided that this is the only way to draw a UI that Unity can offer? </p><br><p>  Years passed, I wrote a lot of interfaces using both GUI and GUILayout, but I could not reconcile with this situation.  In my <a href="https://habrahabr.ru/post/340858/">next article,</a> I'm going to tell you how I stopped worrying and started cutting rectangles correctly. </p></div></div><br><h1 id="dogovorimsya-o-terminah">  Agree on terms </h1><br><ul><li>  In this article, I use the expression <strong>Standard Inspector</strong> , meaning the standard field drawing mechanism in the inspector (Standard Editor); </li><li>  I also use a <strong>database</strong> expression, meaning ScriptableObject, although all the following text also applies to MonoBehaviour; </li><li>  speaking the <strong>GUI</strong> , I do not distinguish between the GUI classes and EditorGUI;  with <strong>GUILayout</strong> the same story. </li></ul><br><h1 id="sut-problemy">  The essence of the problem </h1><br><p>  When a newcomer to Unity wants to bring these or other settings to the inspector, he simply <del>  makes the field public </del>  adds to the <code>[SerializeField]</code> field and enjoys the simplicity and convenience of the editor.  But when his database grows, a harsh reality awaits him: the standard inspector <strong>is terrible</strong> . </p><br><p>  Pros: </p><br><ul><li>  Just add <del>  water </del>  attribute (in the best traditions of <a href="https://ru.wikipedia.org/wiki/POJO"><abbr title="Plain old java object">POJO</abbr></a> ); </li><li>  The programmer no longer spends precious man-hours in an attempt to convince the DG that he does not need to put this or that feature into the database (I know from my own experience with json databases on self-written engines). </li></ul><br><p>  Minuses: </p><br><ul><li>  you must constantly deploy nested blocks in the Inspector; </li><li>  It is impossible to look around the entire database, which creates a lot of problems in moments of <em>"Did I not forget what?"</em>  and <em>"You need to double-check everything for the last time!"</em>  ; </li><li>  information in this form is perceived as a solid text, there is nothing for the eye to catch on, sometimes it is difficult to separate all the properties of one object from the properties of another (it is partially treated using decorators like <code>[Header]</code> , <code>[Range]</code> , etc.); </li><li>  the space is used irrationally: under the boolean value allocated as much space as under the string. </li></ul><br><div class="spoiler">  <b class="spoiler_title">A little pain</b> <div class="spoiler_text"><p>  Probably every programmer encountered a problem: he added <code>[SerializeField]</code> , but nothing appeared in the inspector?  All the magic is that the class of the field must have the attribute <code>[Serializable]</code> , which does not always come to mind. </p></div></div><br><p>  For clarity, consider a simple database of heroes of the popular saga (contains the most important characteristics of the characters): </p><br><div class="spoiler">  <b class="spoiler_title">This awful standard inspector</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimplePeopleDatabase</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Human[] people; [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Human</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Gender gender; [SerializeField, Tooltip(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> earedness; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Gender { Undefined = <span class="hljs-number"><span class="hljs-number">0</span></span>, Male = <span class="hljs-number"><span class="hljs-number">1</span></span>, Female = <span class="hljs-number"><span class="hljs-number">2</span></span>, } }</code> </pre> <br><p><img src="https://habrastorage.org/webt/59/e2/15/59e215905f06a782236456.png"></p></div></div><br><p>  It looks good when there are 5 characters in the list, but with an increase in the size of the database, the convenience and beauty of the standard inspector makes itself felt. </p><br><p>  Fortunately, the developers of Unity make us an offer that we simply cannot refuse: write your own editor.  We will not write the whole CustomEditor, just change the rendering of the Human class: write HumanPropertyDrawer.  I put it in the same file for simplicity of presentation, but in real projects I do not advise to do this: I have often met situations when, with a sufficient level of fatigue, I get into git on Friday evening <code>using UnityEditor;</code>  not wrapped in preprocessor directives. </p><br><div class="spoiler">  <b class="spoiler_title">A beautiful version of the database</b> <div class="spoiler_text"><pre> <code class="hljs vala"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UNITY_EDITOR <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; #endif [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimplePeopleDatabaseWithCustomEditor</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScriptableObject</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Human[] people; [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Human</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Gender gender; [SerializeField, Tooltip(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> earedness; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Gender { Undefined = <span class="hljs-number"><span class="hljs-number">0</span></span>, Male = <span class="hljs-number"><span class="hljs-number">1</span></span>, Female = <span class="hljs-number"><span class="hljs-number">2</span></span>, } #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UNITY_EDITOR [CustomPropertyDrawer(typeof(Human))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HumanPropertyDrawer</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyDrawer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> space = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> OnGUI(Rect rect, SerializedProperty property, GUIContent label) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> indent = EditorGUI.indentLevel; EditorGUI.indentLevel = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstLineRect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect( x: rect.x, y: rect.y, width: rect.width, height: EditorGUIUtility.singleLineHeight ); DrawMainProperties(firstLineRect, property); EditorGUI.indentLevel = indent; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DrawMainProperties(Rect rect, SerializedProperty human){ rect.width = (rect.width - <span class="hljs-number"><span class="hljs-number">2</span></span>*space) / <span class="hljs-number"><span class="hljs-number">3</span></span>; DrawProperty(rect, human.FindPropertyRelative(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)); rect.x += rect.width + space; DrawProperty(rect, human.FindPropertyRelative(<span class="hljs-string"><span class="hljs-string">"gender"</span></span>)); rect.x += rect.width + space; DrawProperty(rect, human.FindPropertyRelative(<span class="hljs-string"><span class="hljs-string">"earedness"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DrawProperty(Rect rect, SerializedProperty property){ EditorGUI.PropertyField(rect, property, GUIContent.none); } } #endif }</code> </pre> <br><p><img src="https://habrastorage.org/webt/59/e2/15/59e215905dc1b129437827.png"></p></div></div><br><p>  In principle, it looks good.  The database even with dozens of characters fits on the screen.  But what is good for the game designer is bad for the programmer: how much code he had to write, what can we say about his support.  When the number of fields changes, dances begin with cutting a line, when adding a complex field (another class with several fields), one has to describe all its fields. </p><br><p>  The complexity of maintaining the code leads to its inertia: every time the database needs to be "slightly changed", there will be many problems with parted positions, changed field names, etc.  When reflection appears in the code, you can simply forget about refactoring the code: standard IDE tools can no longer cope.  The errors that appear are not detected at the compilation stage, and in order to notice them, it is necessary that someone look into this database in the inspector. </p><br><p>  Pros: </p><br><ul><li>  no nested blocks and extra clicks; </li><li>  database size has been significantly reduced, space is used efficiently; </li><li>  each object in the database has a meaning separation from the rest; </li><li>  unbelievable flexibility of approach - the programmer can adjust to any changes and make the database as convenient as possible. </li></ul><br><p>  Minuses: </p><br><ul><li>  need to write additional code; </li><li>  <strong>many</strong> problems with code editor support; </li><li>  due to difficulties with the support of the editor, the working code rots; </li><li>  tips disappeared from the fields (those from the <code>[Tootip]</code> attribute), which no one expected. </li></ul><br><p>  All the disadvantages of the first option are fully resolved, but there is not a trace of its advantages. </p><br><div class="spoiler">  <b class="spoiler_title">Just for example, add each character one more field 'Pets'</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UNITY_EDITOR <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; #endif [CreateAssetMenu] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PeopleDatabaseWithCustomEditor : ScriptableObject { [SerializeField] private Human[] people; [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Human { [SerializeField] private string <span class="hljs-type"><span class="hljs-type">name</span></span>; [SerializeField] private Gender gender; [SerializeField, Tooltip("  ")] private <span class="hljs-type"><span class="hljs-type">int</span></span> earedness; [SerializeField] private Pet[] pets; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> enum Gender { Undefined = <span class="hljs-number"><span class="hljs-number">0</span></span>, Male = <span class="hljs-number"><span class="hljs-number">1</span></span>, Female = <span class="hljs-number"><span class="hljs-number">2</span></span>, } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Pet { [SerializeField] private PetType <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>; [SerializeField] private string <span class="hljs-type"><span class="hljs-type">name</span></span>; [SerializeField, Tooltip("     ?")] private <span class="hljs-type"><span class="hljs-type">bool</span></span> combat; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> enum PetType { Undefined = <span class="hljs-number"><span class="hljs-number">0</span></span>, Wolf = <span class="hljs-number"><span class="hljs-number">1</span></span>, Dragon = <span class="hljs-number"><span class="hljs-number">2</span></span>, Raven = <span class="hljs-number"><span class="hljs-number">3</span></span>, } #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UNITY_EDITOR [CustomPropertyDrawer(typeof(Human))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> HumanPropertyDrawer : PropertyDrawer { private const <span class="hljs-type"><span class="hljs-type">float</span></span> space = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override <span class="hljs-type"><span class="hljs-type">float</span></span> GetPropertyHeight(SerializedProperty property, GUIContent label){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EditorGUIUtility.singleLineHeight + EditorGUI.GetPropertyHeight(property.FindPropertyRelative("pets"), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override <span class="hljs-type"><span class="hljs-type">void</span></span> OnGUI(Rect rect, SerializedProperty property, GUIContent label) { <span class="hljs-type"><span class="hljs-type">int</span></span> indent = EditorGUI.indentLevel; EditorGUI.indentLevel = <span class="hljs-number"><span class="hljs-number">0</span></span>; var firstLineRect = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect( x: rect.x, y: rect.y, width: rect.width, height: EditorGUIUtility.singleLineHeight ); DrawMainProperties(firstLineRect, property); var petsRect = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect( x: rect.x, y: rect.y + firstLineRect.height, height: rect.height - firstLineRect.height, width: rect.width ); DrawPets(petsRect, property.FindPropertyRelative("pets")); // Separator var lastLine = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect( x: rect.x, y: rect.y + rect.height - EditorGUIUtility.singleLineHeight / <span class="hljs-number"><span class="hljs-number">2</span></span>, width: rect.width, height: <span class="hljs-number"><span class="hljs-number">1</span></span> ); EditorGUI.DrawRect(lastLine, Color.gray); EditorGUI.indentLevel = indent; } private <span class="hljs-type"><span class="hljs-type">void</span></span> DrawMainProperties(Rect rect, SerializedProperty human){ rect.width = (rect.width - <span class="hljs-number"><span class="hljs-number">2</span></span>*space) / <span class="hljs-number"><span class="hljs-number">3</span></span>; DrawProperty(rect, human.FindPropertyRelative("name")); rect.x += rect.width + space; DrawProperty(rect, human.FindPropertyRelative("gender")); rect.x += rect.width + space; DrawProperty(rect, human.FindPropertyRelative("earedness")); } private <span class="hljs-type"><span class="hljs-type">void</span></span> DrawProperty(Rect rect, SerializedProperty property){ EditorGUI.PropertyField(rect, property, GUIContent.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>); } private <span class="hljs-type"><span class="hljs-type">void</span></span> DrawPets(Rect rect, SerializedProperty petsArray){ var countRect = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect( x: rect.x, y: rect.y, height: EditorGUIUtility.singleLineHeight, width: rect.width ); var label = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> GUIContent("Pets"); petsArray.arraySize = EditorGUI.IntField(countRect, label, petsArray.arraySize); var petsRect = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rect( x: rect.x + EditorGUIUtility.labelWidth, y: rect.y, width: rect.width - EditorGUIUtility.labelWidth, height: <span class="hljs-number"><span class="hljs-number">18</span></span> ); petsArray.isExpanded = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; petsArray.arraySize; i++){ petsRect.y += petsRect.height; EditorGUI.PropertyField(petsRect, petsArray.GetArrayElementAtIndex(i)); } petsArray.isExpanded = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } [CustomPropertyDrawer(typeof(Pet))] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PetPropertyDrawer : PropertyDrawer { private const <span class="hljs-type"><span class="hljs-type">float</span></span> space = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override <span class="hljs-type"><span class="hljs-type">void</span></span> OnGUI(Rect rect, SerializedProperty property, GUIContent label) { <span class="hljs-type"><span class="hljs-type">int</span></span> indent = EditorGUI.indentLevel; EditorGUI.indentLevel = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> combatFlagWidth = <span class="hljs-number"><span class="hljs-number">20</span></span>; rect.width = (rect.width - <span class="hljs-number"><span class="hljs-number">2</span></span>*space - combatFlagWidth) / <span class="hljs-number"><span class="hljs-number">2</span></span>; DrawProperty(rect, property.FindPropertyRelative("type")); rect.x += rect.width + space; DrawProperty(rect, property.FindPropertyRelative("name")); rect.x += rect.width + space; rect.width = combatFlagWidth; DrawProperty(rect, property.FindPropertyRelative("combat")); EditorGUI.indentLevel = indent; } private <span class="hljs-type"><span class="hljs-type">void</span></span> DrawProperty(Rect rect, SerializedProperty property){ EditorGUI.PropertyField(rect, property, GUIContent.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>); } } #endif }</code> </pre> <br><p><img src="https://habrastorage.org/webt/59/e2/15/59e21590a6aef078764266.png"></p><br><p>  Although the result looks good, it is difficult to convey in words all the emotions regarding this code.  And even worse to imagine what will happen next. </p></div></div><br><h1 id="reshenie-problemy">  Solution to the problem </h1><br><p>  The first thing that comes to mind: someone has already encountered such a problem, let's go look in the AssetStore.  And we find in it a lot of assets, aimed at improving the standard inspector: they allow placing buttons (calling methods of the object) in the inspector, preview of textures, add the possibility of branching and much more.  But almost all of them are paid, and most of them follow the <em>‚Äúone field - one line‚Äù</em> paradigm, and the functions added by them only further increase the vertical size of the database. </p><br><p>  In general, enough introductions, it's time to talk about why we all gathered here.  I wrote my asset: <code>OneLine</code> . </p><br><p>  What does OneLine do?  Draws in one line the field marked by the attribute, along with all the nested fields (it will be clear in the examples below). </p><br><div class="spoiler">  <b class="spoiler_title">Use OneLine in the first example.</b> <div class="spoiler_text"><p>  Add the attribute <code>[OneLine]</code> to draw in one line and <code>[HideLabel]</code> to hide the unnecessary in our case title, eating up a third of the length of the line. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> OneLine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimplePeopleDatabaseWithOneLine</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { [SerializeField, OneLine, HideLabel] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Human[] people; [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Human</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Gender gender; [SerializeField, Tooltip(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> earedness; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Gender { Undefined = <span class="hljs-number"><span class="hljs-number">0</span></span>, Male = <span class="hljs-number"><span class="hljs-number">1</span></span>, Female = <span class="hljs-number"><span class="hljs-number">2</span></span>, } }</code> </pre> <br><p><img src="https://habrastorage.org/webt/59/e2/15/59e215908284b296642059.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Use OneLine in the second animal example.</b> <div class="spoiler_text"><p>  Stretching margins in width in OneLine looks weird with dynamic arrays (and the list of pets is just that), so we rigidly set the width to all fields with the <code>[Width]</code> attribute.  This time the picture is clickable. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> OneLine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PeopleDatabaseWithOneLine</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { [SerializeField, OneLine, HideLabel] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Human[] people; [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Human</span></span> { [SerializeField, Width(<span class="hljs-number"><span class="hljs-number">130</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; [SerializeField, Width(<span class="hljs-number"><span class="hljs-number">75</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Gender gender; [SerializeField, Tooltip(<span class="hljs-string"><span class="hljs-string">"  "</span></span>), Width(<span class="hljs-number"><span class="hljs-number">25</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> earedness; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Pet[] pets; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Gender { Undefined = <span class="hljs-number"><span class="hljs-number">0</span></span>, Male = <span class="hljs-number"><span class="hljs-number">1</span></span>, Female = <span class="hljs-number"><span class="hljs-number">2</span></span>, } [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Pet</span></span> { [SerializeField, Width(<span class="hljs-number"><span class="hljs-number">60</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PetType type; [SerializeField, Width(<span class="hljs-number"><span class="hljs-number">100</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; [SerializeField, Tooltip(<span class="hljs-string"><span class="hljs-string">"     ?"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> combat; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> PetType { Undefined = <span class="hljs-number"><span class="hljs-number">0</span></span>, Wolf = <span class="hljs-number"><span class="hljs-number">1</span></span>, Dragon = <span class="hljs-number"><span class="hljs-number">2</span></span>, Raven = <span class="hljs-number"><span class="hljs-number">3</span></span>, } }</code> </pre> <br><p> <a href=""><img src="https://habrastorage.org/webt/59/e2/15/59e21590b2e1f991105554.png"></a> </p><br><p>  It turns out quite widely, but when working with a database, it is quite possible to stretch it to the full screen.  In future versions, I plan to give OneLine the ability to draw too large fields in a few lines. </p></div></div><br><p>  How does all this work?  Mainly due to the ability to write a PropertyDrawer for an attribute.  On what the attribute hangs, it draws and draws.  Plus a bit of reflection, the help of the decompiled code of Unity libraries on the githaba and a little imagination.  I will write about the main difficulties on the way later. </p><br><p>  OneLine features: </p><br><ul><li>  Everything works right out of the box: we add one attribute to the field and everything inside it is drawn in one line; </li><li>  If "out of the box" does not look very good, there is a possibility of customization (highlighting fields, controlling width, etc.); </li><li>  Normally handle hints ( <code>[Tooltip]</code> ) in the code; </li><li>  Free, responsive community (github) <del>  from one person </del>  ready to help; </li></ul><br><p>  OneLine Restrictions: </p><br><ul><li>  If you hang it on an array, it will continue to be drawn as usual, but its elements will each be drawn in its own line; </li><li>  The library is young, it didn‚Äôt manage to acquire many features, but there are still some bugs to catch. </li></ul><br><h2 id="kak-eto-rabotaet">  How it works: </h2><br><p>  At first everything seemed simple: recursively go through all the fields and draw everything that meets on the way, in one line.  In life, everything turned out to be more complicated: </p><br><ul><li>  To calculate the rectangles, we go through the graph of children in depth, we determine its relative width for each based on the <strong>weight</strong> (weight) and <strong>additional width</strong> (width); </li><li>  To do this, we understand how it is possible to find out from SerializedProperty what field we have: a leaf, a node or an array (which is a special case of a node).  By the way, did you know that a SerializedProperty pointing to a string returns <code>property.isArray == true</code> ?  Here I did not know; </li><li>  at the same time, we understand how using <code>property.propertyPath</code> and reflection to get all the attributes hanging on the field (and again the crutches associated with arrays); </li><li>  wading through the wilds of special cases and exceptions; </li><li>  we season with decorations like <code>[HideLabel]</code> and <code>[Highlight]</code> ; </li><li>  optimize; </li><li>  ... </li><li>  enjoy the result. </li></ul><br><h1 id="prepyatstviya-na-puti">  Obstacles on the way </h1><br><p>  It should be noted that many of the problems on the road are obstacles that Unity itself is putting before us.  As a result, some kind of workaround is necessary to solve problems, including relying on the knowledge of the implementation of certain parts of the editor and reflection. </p><br><p>  This approach leads to the fragility of the code, because in the next version of the editor OneLine may suddenly stop working correctly.  On the one hand, I hope this does not happen.  On the other hand, problems need to be solved in any case, and the open API necessary for this is not and is not expected. </p><br><div class="spoiler">  <b class="spoiler_title">Missing tip</b> <div class="spoiler_text"><p>  When I wrote databases for artists, I constantly set up detailed field hints with <code>[Tooltip]</code> , replacing the documentation.  With this attribute in the inspector it is enough to hover the mouse on the field, and a pop-up little cloud will tell you everything about it. </p><br><p>  <strong>Problem:</strong> as I wrote earlier, a simple call to `EditorGUI.PropertyField (rect, property, content) does not draw hints.  Interestingly, SerializedProperty contains the <a href="https://docs.unity3d.com/ScriptReference/SerializedProperty-tooltip.html">tootlip</a> property (note the comprehensive documentation), but it always turned out to be empty when I was accessing it.  <abbr title="What am I doing wrong?">Chyadt</abbr> ? </p><br><p>  <strong>Solution:</strong> we take the <code>SerializedProperty.propertyPath</code> and with reflexion in our hands we crawl along the path from the very beginning (pay attention to the arrays), when we crawl to the end, we can learn all the attributes of the field.  I use this method of getting field attributes not only for working with prompts. </p><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static T[] GetCustomAttributes&lt;T&gt;(this SerializedProperty property) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">Attribute</span></span> { string[] <span class="hljs-type"><span class="hljs-type">path</span></span> = property.propertyPath.Split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>); <span class="hljs-type"><span class="hljs-type">bool</span></span> failed = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; var <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = property.serializedObject.targetObject.GetType(); FieldInfo field = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-type"><span class="hljs-type">path</span></span>.Length; i++) { field = <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>.GetField(<span class="hljs-type"><span class="hljs-type">path</span></span>[i], BindingFlags.<span class="hljs-built_in"><span class="hljs-built_in">Public</span></span> | BindingFlags.NonPublic | BindingFlags.DeclaredOnly | BindingFlags.FlattenHierarchy | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = field.FieldType; //    : .fieldName //    : .fieldName.<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>.data[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-type"><span class="hljs-type">int</span></span> next = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (next &lt; <span class="hljs-type"><span class="hljs-type">path</span></span>.Length &amp;&amp; <span class="hljs-type"><span class="hljs-type">path</span></span>[next] == "Array") { i += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>.IsArray) { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>.GetElementType(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>.GetGenericArguments()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> field.GetCustomAttributes(typeof(T), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">Cast</span></span>&lt;T&gt;() .ToArray(); }</code> </pre> <br><hr></div></div><br><div class="spoiler">  <b class="spoiler_title">Blinking EditorGUI.DrawRect</b> <div class="spoiler_text"><p>  In a large database, a long line containing many fields may look too "even", that is, the problem "there is nothing to catch on."  I was faced with the task of providing a mechanism for highlighting particularly important fields in a line. <br>  In accordance with the policy of the party, the selection of the field will produce an attribute <code>[Highlight]</code> . </p><br><p>  The implementation is very simple: </p><br><ul><li>  using the same tool as in the case of the hint, we find the <code>[Highlight]</code> attribute on the field; </li><li>  Before drawing the field, call <code>EditorGUI.DrawRect(rect, color);</code>  and tint the rectangle with the desired color. </li></ul><br><p>  <strong>Problem:</strong> as a result of the known Unity <a href="https://issuetracker.unity3d.com/issues/propertydrawer-editorgui-dot-drawrect-disappears-when-unfocused">bug</a> (which is marked <em>Won't fix</em> ), the backlight appears and disappears. </p><br><p>  <strong>Solution:</strong> described <a href="http://answers.unity3d.com/questions/377207/drawing-a-texture-in-a-custom-propertydrawer.html">here</a> .  It looks easy.  Interestingly, for what reason did Unity developers refuse to repair it? </p><br><hr></div></div><br><div class="spoiler">  <b class="spoiler_title">Not disappearing decorators</b> <div class="spoiler_text"><p>  The main feature of OneLine is that it should work out of the box: add one attribute and everything is drawn in one line.  But life always suits us all sorts of pod.  And one of them: decorators.  These attributes are <code>[Header]</code> , <code>[Space]</code> (and any others that you can write yourself, extending DecoratorDrawer).  It turned out that with the usual call of `EditorGUI.PropertyField (rect, property, content) all decorators are also drawn. </p><br><p>  <strong>Problem:</strong> <br><img src="https://habrastorage.org/webt/59/e4/90/59e490dac3773311184293.png"></p><br><p>  <strong>Solution:</strong> At first I tried to find a workaround and even asked for <a href="http://answers.unity3d.com/questions/1394991/how-to-preserve-drawing-decoratordrawer-like-heade.html">Unity Answers</a> , but with no result.  Then I rummaged in UnityEditor.dll decompiled source code ( <a href="https://github.com/MattRix/UnityDecompiled">here</a> ), and got the following solution: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(EditorGUI) .GetMethod(<span class="hljs-string"><span class="hljs-string">"DefaultPropertyField"</span></span>, BindingFlags.NonPublic | BindingFlags.Static) .Invoke(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[]{rect, property, GUIContent.none});</code> </pre> </div></div><br><h1 id="gde-skachat">  Where can I download </h1><br><p>  The current version of OneLine <a href="https://github.com/slavniyteo/one-line/releases/download/0.2.0/one-line_v0.2.0.unitypackage">v0.2.0</a> . <br>  You can follow the situation on the <a href="https://github.com/slavniyteo/one-line">githaba</a> .  The readme functional is described in more detail. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/340536/">https://habr.com/ru/post/340536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340522/index.html">BEM + React: flexible design system architecture</a></li>
<li><a href="../340524/index.html">How to make a Public API to be used</a></li>
<li><a href="../340528/index.html">Implementing Mars IS Service Introduction Process</a></li>
<li><a href="../340530/index.html">Modern Web-platform: how to relax and have fun? A practical guide, part 1</a></li>
<li><a href="../340534/index.html">ROS, ELM and Bug</a></li>
<li><a href="../340538/index.html">UFADEVCONF 2017 Conference Overview</a></li>
<li><a href="../340540/index.html">Russian AI Cup 2017 - to all fans of StarCraft and C & C is dedicated</a></li>
<li><a href="../340544/index.html">A dozen Linux tricks that really save a lot of time</a></li>
<li><a href="../340550/index.html">Code review humanly (part 1)</a></li>
<li><a href="../340552/index.html">How we updated the search tips in Yandex and found the correct metric for them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>