<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Money to the wind: why your anti-phishing does not detect phishing sites and how Data Science will make it work?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, phishing is the easiest and most popular way for cybercriminals to steal money or information. There is no need to go far for examples. Last...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Money to the wind: why your anti-phishing does not detect phishing sites and how Data Science will make it work?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ls/rw/4f/lsrw4fika632n5382tabh8rchnc.jpeg" alt="image"><br><br>  Recently, phishing is the easiest and most popular way for cybercriminals to steal money or information.  There is no need to go far for examples.  Last year, leading Russian enterprises were faced with an unprecedented attack - the attackers massively registered fake resources, exact copies of the sites of fertilizer and petrochemical manufacturers, to conclude contracts on their behalf.  The average damage from such an attack - from 1.5 million rubles, not to mention the reputational damage suffered by the company.  In this article, we‚Äôll talk about how to effectively detect phishing sites using resource analysis (CSS, JS images, etc.) rather than HTML, and how Data Science can solve these problems. <a name="habracut"></a><br><br>  Pavel Slipenchuk, Machine Learning Systems Architect, Group-IB 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Phishing epidemic </h3><br>  According to Group-IB, more than 900 clients of various banks are victims of only financial phishing in Russia every day - this figure is 3 times the daily number of victims of malware.  The damage from a phishing attack on the user varies from 2,000 to 50,000 rubles.  Fraudsters do not just copy the website of a company or a bank, their logos and company colors, content, contact details, register a similar domain name, they also actively advertise their resources in social networks and search engines.  For example, they are trying to display links to their phishing sites in the tops of the query ‚ÄúTransfer money to the card‚Äù.  Most often, fake websites are created precisely in order to steal money when transferring from card to card or when paying instantly for the services of cellular operators. <br><blockquote>  Phishing (from phishing, from fishing - fishing, fishing) - a type of Internet fraud, the purpose of which is to fraudulently force the victim to provide the fraudster with the confidential information he needs.  Most often, passwords of access to a bank account are stolen to further steal money, social network accounts (to extort money or send spam on behalf of the victim), sign up for paid services, send mail or infect a computer, making it a link in the botnet. </blockquote>  By means of attacks, you should distinguish between 2 types of phishing, targeted at users and companies: <br><br><ol><li>  Phishing sites that copy the original resource of the victim (banks, airlines, online stores, businesses, government agencies, etc.). </li><li>  Phishing mailings, e-mail, sms, messages in social networks, etc. </li></ol><br>  Attacks on users are often done by loners, and the threshold for entry into this segment of the criminal business is so low that minimal ‚Äúinvestment‚Äù and basic knowledge are enough for implementation.  Phishing kits, the developers of phishing sites that can be freely purchased on the Darknet on hacker forums, also contribute to the spread of this type of fraud. <br><br>  Attacks on companies or banks are arranged differently.  They are carried out by more technically savvy attackers.  As a rule, large industrial enterprises, online stores, airlines, and most often banks are chosen as victims.  In most cases, phishing comes down to sending an email with an infected file attached.  In order for such an attack to be successful, in the ‚Äústaff‚Äù of the grouping it is necessary to have specialists in writing malicious code, programmers to automate their activities, and people who are able to conduct initial reconnaissance on the victim and find weaknesses in it. <br><br>  In Russia, according to our estimates, there are 15 criminal groups engaged in phishing aimed at financial institutions.  The amount of damage is always small (ten times less than from bank Trojans), but the number of victims that they lure to their sites is daily estimated at thousands.  About 10‚Äì15% of visitors to financial phishing sites themselves enter their data. <br><br>  When a phishing page appears, the account goes for hours, and sometimes even for minutes, as users incur serious financial, and in the case of companies, reputational damage as well.  For example, some successful phishing pages were available for less than a day, but were able to cause damage to amounts from 1,000,000 rubles. <br><br>  In this article we will focus on the first type of phishing: phishing sites.  Resources that are ‚Äúsuspected‚Äù of phishing can be easily detected using various technical means: honeypots, crawlers, etc., however, it is problematic to make sure that they are really phishing ones and identify the attacked brand.  We will analyze how to solve this problem. <br><br><h3>  Fishing </h3><br>  If a brand does not follow its reputation, it becomes an easy target.  It is necessary to intercept the initiative from the criminals immediately after the registration of their fake sites.  In practice, the search phishing page is divided into 4 stages: <br><br><ol><li>  Formation of a set of suspicious URLs for phishing scans (crawler, honeypots, etc.). </li><li>  Formation of a set of phishing addresses. </li><li>  The classification of already detected phishing addresses in the direction of the activity and the technology being attacked, for example, ‚ÄúRBS :: Sberbank Online‚Äù or ‚ÄúRBS :: Alfa-Bank‚Äù. </li><li>  Search for the donor page. </li></ol><br>  The implementation of points 2 and 3 falls on the shoulders of specialists in Data Science. <br><br>  After that, you can already take active steps to block the phishing page.  In particular: <br><br><ul><li>  Add URLs to the blacklists of Group-IB products and products of our partners; </li><li>  automatically or manually send letters to the owner of the domain zone with a request to remove the phishing URL; </li><li>  send letters to the security of the attacked brand; </li><li>  etc. </li></ul><br><img src="https://habrastorage.org/webt/tt/vt/00/ttvt00-hmcdh-tnpjiqxs3lub3c.png" alt="image"><br><br><h3>  HTML based methods </h3><br>  The classic solution to the problem of checking suspicious addresses for phishing and automatic detection of the affected brand are various ways of parsing HTML source pages.  The simplest is to write regular expressions.  It's funny, but this trick still works.  Even today, most novice phishers simply copy content from the original site. <br><br>  Phishing kits can also develop highly effective anti-phishing systems.  But in this case, you need to explore the HTML-page.  In addition, these solutions are not universal - the base of the ‚Äúwhales‚Äù is necessary for their development.  Some phishing kits may be unknown to the researcher.  And, of course, the analysis of each new ‚Äúwhale‚Äù is a rather laborious and expensive process. <br><br>  All phishing detection systems based on HTML page analysis stop working after obfuscating HTML.  And in many cases, simply changing the frame of the HTML page. <br><br>  According to Group-IB, at the moment such phishing sites are no more than 10% of the total number, but skipping even one can be costly for the victim. <br><br>  Thus, it is enough for a fisher to bypass a blocking to simply change the HTML framework, less often to obfuscate an HTML page (by confusing markup and / or loading content through JS). <br><br><h3>  Formulation of the problem.  Resource Based Method </h3><br>  Methods based on the analysis of the resources used are much more efficient and universal for detecting phishing pages.  A resource is any file that is loaded when rendering a web page (all images, cascading style sheets (CSS), JS files, fonts, etc.). <br><br>  In this case, you can build a bichromatic graph, where some vertices will be addresses suspicious of phishing, and others - the resources associated with them. <br><br><img src="https://habrastorage.org/webt/b5/wn/t_/b5wnt_ucalicjxykvozqhnrwv48.png" alt="image"><br><br>  There is a clustering problem - to find a set of such resources, which own a sufficiently large number of different URLs.  By constructing such an algorithm, we can decompose any bipartite graph into clusters. <br><br>  The hypothesis is that, based on real data, it is quite possible to say that the cluster contains a set of URLs that belong to the same brand and are generated by one phishing kits.  Then, to test this hypothesis, each such cluster can be sent for manual verification to CERT (Information Security Incident Response Center).  The analyst, in turn, would state the status of the cluster: +1 (‚Äúapproved‚Äù) or ‚Äì1 (rejected).  An analyst would also assign an attacked brand to all approved clusters.  At this "manual work" ends - the rest of the process is automated.  On average, one approved group has 152 phishing addresses (data for June 2018), and sometimes even clusters of 500‚Äì1000 addresses come across!  The analyst spends about 1 minute approving or denying the cluster. <br><br>  Then all the rejected clusters are removed from the system, and all their addresses and resources after some time are fed back to the input of the clustering algorithm.  As a result, we get new clusters.  And again we send them to check, etc. <br><br>  Thus, for each newly received address, the system should do the following: <br><br><ol><li>  Extract all the resources for a site. </li><li>  Check for ownership of at least one previously approved cluster. </li><li>  If the URL belongs to a cluster, automatically extract the brand name and perform an action for it (notify the customer, delete the resource, etc.). </li><li>  If it is impossible to put a single cluster on the resources, add the address and resources to the bipartite graph.  In the future, this URL and resources will participate in the formation of new clusters. </li></ol><br><img src="https://habrastorage.org/webt/sm/eq/vg/smeqvgik_1kozfi1k4lehxxpso0.png" alt="image"><br><br><h3>  Simple resource clustering algorithm </h3><br>  One of the most important nuances that a Data Science specialist in information security must take into account is the fact that his opponent is a man.  For this reason, the conditions and data for analysis change very quickly!  A solution that perfectly fixes a problem now, after 2-3 months, can stop working in principle.  Therefore, it is important to create either universal (clumsy) mechanisms, if possible, or the most flexible systems that can be quickly finalized.  Data Science Specialist in IB will not be able to solve the problem once and for all. <br><br>  Standard clustering methods do not work due to the large number of features.  Each resource can be represented as a boolean sign.  However, in practice, we get from 5,000 website addresses per day, and each of them contains on average 17.2 resources (data for June 2018).  The curse of dimension does not even allow to load data into memory, let alone build some kind of clustering algorithms. <br><br>  Another idea is to try to cluster into clusters using various collaborative filtering algorithms.  In this case, it was necessary to create another sign - belonging to a particular brand.  The task will be to ensure that the system must predict the presence or absence of this feature for the remaining URLs.  The method gave positive results, however, had two drawbacks: <br><br><ol><li>  for each brand it was necessary to create its own sign for collaborative filtering; </li><li>  needed a training set. </li></ol><br>  Recently, more and more companies want to protect their brand on the Internet and ask to automate the detection of phishing sites.  Each new brand, taken under protection, would add a new attribute.  Yes, and create a learning sample for each new brand - this is an additional manual labor and time. <br><br>  We began to look for a solution to this problem.  And found a very simple and effective way. <br>  To begin with, we construct a pair of resources using the following algorithm: <br><br><ol><li>  Take all kinds of resources (we denote them as a), for which at least N1 addresses, we denote this relationship as # (a) ‚â• N1. </li><li>  We construct all possible pairs of resources (a1, a2) and select only those for which there will be at least N2 addresses, i.e.  # (a1, a2) ‚â• N2. </li></ol><br>  Then, we similarly consider pairs consisting of pairs obtained in the previous paragraph.  As a result, we get fours: (a1, a2) + (a3, a4) ‚Üí (a1, a2, a3, a4).  Moreover, if at least one element is present in one of the pairs, instead of quadruples we get triples: (a1, a2) + (a2, a3) ‚Üí (a1, a2, a3).  From the resulting set, we leave only those fours and triples, which correspond to at least N3 addresses.  And so on‚Ä¶ <br><br><img src="https://habrastorage.org/webt/st/mf/lt/stmfltpbu-zezk6a_xuzczq0fyy.png" alt="image"><br><br>  You can get a variety of resources of arbitrary length.  We limit the number of steps to U. Then N1, N2 ... NU are the parameters of the system. <br><br>  The values ‚Äã‚ÄãN1, N2 ... NU are the parameters of the algorithm, they are set manually.  In the general case, we have CL2 different pairs, where L is the amount of resources, i.e.  the complexity for constructing pairs will be O (L2).  Then a quad is created from each pair.  And in theory, we may get O (L4).  However, in practice, these pairs are much smaller, and with a large number of addresses, the O (L2log L) dependence was obtained empirically.  At the same time, the next steps (transformations of twos into fours, fours into eights, etc.) are negligible. <br><br>  It should be noted that L is the number of nonclustered URLs.  All URLs that can already be attributed to any previously approved cluster are not included in the clustering sample. <br><br>  At the output, you can create many clusters consisting of the largest possible sets of resources.  For example, if there is (a1, a2, a3, a4, a5) that satisfies the Ni boundaries, you should remove from the set of clusters (a1, a2, a3) and (a4, a5). <br><br>  Then each received cluster is sent to a manual check, where the CERT analyst assigns it a status: +1 (‚Äúapproved‚Äù) or ‚Äì1 (‚Äúrejected‚Äù), and also indicates what URLs that fall into the cluster are phishing or legitimate sites. <br>  When adding a new resource, the number of URLs may decrease, remain the same, but never increase.  Therefore, for any resources a1 ... aN, the relation is valid: <br><br>  # (a1) ‚â• # (a1, a2) ‚â• # (a1, a2, a3) ‚â• ... ‚â• # (a1, a2, ..., aN). <br><br>  Therefore, it is reasonable to set the parameters: <br><br>  N1 ‚â• N2 ‚â• N3 ‚â• ... ‚â• NU. <br><br>  At the exit, we give out all sorts of groups to check.  In fig.  1 at the very beginning of the article shows the real clusters for which all resources are images. <br><br><h3>  Using the algorithm in practice </h3><br>  Note that now completely eliminate the need to explore phishing kits!  The system automatically clusters and finds the phishing page you need. <br><br>  Every day the system receives from 5,000 phishing pages and constructs only from 3 to 25 new clusters per day.  For each cluster, a list of resources is unloaded, a lot of screenshots are created.  This cluster is sent to CERT analytics for confirmation or refutation. <br><br>  When running, the accuracy of the algorithm was low - only 5%.  However, after 3 months the system kept the accuracy from 50 to 85%.  In fact, accuracy does not matter!  The main thing is that analysts have time to view the clusters.  Therefore, if the system, for example, generates about 10,000 clusters per day and you have only one analyst, you will have to change the system parameters.  If not more than 200 per day, this is a task feasible for one person.  As practice shows, on average, visual analysis takes about 1 minute. <br><br>  The completeness of the system is about 82%.  The remaining 18% are either unique phishing cases (so they cannot be grouped), or phishing, which has a small amount of resources (there is nothing to group), or phishing pages that have gone beyond the boundaries of the N1, N2 ... NU parameters. <br><br>  An important point: how often to launch a new clustering on fresh, undelivered URLs?  We do this every 15 minutes.  At the same time, depending on the amount of data, the clustering time itself takes 10‚Äì15 minutes.  This means that after the appearance of a phishing URL, there is a 30-minute lag in time. <br><br>  Below are 2 screenshots from the GUI system: signatures for detecting phishing on VKontakte and Bank Of America. <br><br><img src="https://habrastorage.org/webt/vq/m7/3b/vqm73bfeno9v_vysptjhkyx1i-y.jpeg" alt="image"><br><br><img src="https://habrastorage.org/webt/nu/ss/gp/nussgpgk3tfeifimslph9nj4she.jpeg" alt="image"><br><br><h3>  When the algorithm does not work </h3><br>  As mentioned above, the algorithm does not work in principle, if the boundaries specified by the parameters N1, N2, N3 ... NU are not reached, or if the amount of resources is too small to form the necessary cluster. <br><br>  Fisher can bypass the algorithm, creating unique resources for each phishing site.  For example, in each image you can change one pixel, and for loaded JS- and CSS-libraries use obfuscation.  In this case, it is necessary to develop an algorithm of a comparable hash (perceptual hash) for each type of loaded documents.  However, these questions are beyond the scope of this article. <br><br><h3>  We connect all together </h3><br>  We connect our module with classic HTML regulars, data obtained from Threat Intelligence (cyber intelligence system), and we get a completeness of 99.4%.  Of course, this is completeness on data that has already been pre-classified by Threat Intelligence as suspicious of phishing. <br><br>  Nobody knows what completeness on all possible data, since it is impossible in principle to cover the entire Darknet, however, according to Gartner, IDC and Forrester reports, Group-IB is one of the leading international suppliers of Threat Intelligence solutions according to its capabilities. <br><br>  And what to do with unclassified phishing pages?  On the day they get about 25-50.  They can be checked manually.  In general, in any task that is quite difficult for Data Sciense, there is always manual labor in the field of information security, and any statements about 100% automation are marketing fiction.  The task of Data Sciense specialist is to reduce manual labor by 2‚Äì3 orders of magnitude, making the work of the analyst as effective as possible. <br><br>  Article published on <a href="http://www.jetinfo.ru/stati/vybroshennye-dengi-pochemu-vash-antifishing-ne-detektiruet-fishingovye-sajty-i-kak-zastavit-ego-rabotat">JETINFO</a> </div><p>Source: <a href="https://habr.com/ru/post/420269/">https://habr.com/ru/post/420269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420259/index.html">Singapore Aging Dashboard</a></li>
<li><a href="../420261/index.html">What will we measure? How to choose the right ML-metrics for business tasks</a></li>
<li><a href="../420263/index.html">ServiceNow-conference "Knowledge18"</a></li>
<li><a href="../420265/index.html">Seven Scrum Implementation Problems We Didn't Know About</a></li>
<li><a href="../420267/index.html">The authors of the game 0 AD - well done</a></li>
<li><a href="../420271/index.html">Empathy training: stimulating the brain's neural connections with a video game</a></li>
<li><a href="../420273/index.html">How is the long-distance passenger car</a></li>
<li><a href="../420275/index.html">Major conferences on the Internet of things in 2018-2019. Russia and the world</a></li>
<li><a href="../420277/index.html">After the gold rush is over: blockchain technology perspectives</a></li>
<li><a href="../420281/index.html">6. Check Point for maximum. Ips. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>