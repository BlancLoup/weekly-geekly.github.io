<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Storing the date in mysql, taking into account the time zone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An article on how to avoid confusion with the dates stored in mysql. 
 This confusion arises for two reasons: 
 1. Different territories of our planet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Storing the date in mysql, taking into account the time zone</h1><div class="post__text post__text-html js-mediator-article"><a href=""><img src="https://habrastorage.org/getpro/habr/post_images/765/c5b/7fb/765c5b7fb820f1c41870544d03a11c28.png" alt="image"></a> <br>  An article on how to avoid confusion with the dates stored in mysql. <br>  This confusion arises for two reasons: <br>  1. Different territories of our planet have a different time shift. <br>  2. Some countries are switching to summer time and back ( <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B0%25D0%25B9%25D0%25BB:DaylightSaving-World-Subdivisions.png">map with countries switching to summer time</a> ). <br><br>  Many solve these problems in different ways.  Someone makes a date shift in SQL queries, someone in php.  Someone stores dates in TIMESTAMP, someone in DATETIME.  I searched many sources, but nowhere did I find the right solution to this problem in Russian.  In the native documentation on mysql I found information on how to achieve the correct automatic conversion of TIMESTAMP in local time, but here, too, its pitfalls. <br><br>  If in php, setting up a time zone is easy, then mysql has difficulty, especially if you have limited access to the mysql server and some tables have not yet been installed there. <br><a name="habracut"></a><br>  What is the difference between the storage formats for the TIMESTAMP and DATETIME dates, I hope you know. <br>  The TIMESTAMP value is an absolute time value that is independent of local settings.  In any country, on any computer it is the same.  Therefore, in most cases it is better to store the date in TIMESTAMP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you make a request <br> <code>SELECT `timestamp_field` FROM table</code> <br>  You will get the date in the yyyy-mm-dd hh: mm: ss format. <br>  It would seem that everything is simple.  And this simplicity is too tempting, and it is because of it that problems can arise, because you need to specify which time zone the user is given a date for. <br>  And there is a solution: you can set the zone by request <br><br> <code>SET time_zone='+03:00'</code> <br> <br>  where '+03: 00' is the current date shift from London zero time. <br>  But after this request, mysql starts to incorrectly handle the daylight saving time. <br>  If the time_zone value is set to SYSTEM (default), daylight saving time is correctly processed. <br>  For example, it is summer now and summertime is in effect. <br>  We need to translate to the local time TIMESTAMP stored in the database.  Its value is 946681261 (this is '2000-01-01 01:01:01' Kiev time) <br>  Make a request: <br><br> <code>SET time_zone = 'SYSTEM'; <br> SELECT NOW(), FROM_UNIXTIME(946681261);</code> <br> <br>  We get the result: <br><table><tbody><tr><td>  NOW () </td><td>  FROM_UNIXTIME (946681261) </td></tr><tr><td>  2009-09-14 16:00:40 </td><td>  2000-01-01 01:01:01 </td></tr></tbody></table><br><br>  Now we change the time zone <br> <code>SET time_zone = '+03:00'; <br> SELECT NOW(), FROM_UNIXTIME(946681261);</code> <br> <br><table><tbody><tr><td>  NOW () </td><td>  FROM_UNIXTIME (946681261) </td></tr><tr><td>  2009-09-14 16:00:40 </td><td>  2000-01-01 02:01:01 </td></tr></tbody></table><br>  As you can see, instead of the expected '2000-01-01 01:01:01' we got an hour more time.  While the current time is displayed correctly. <br>  You can configure mysql as needed (well, if you have full access to the database) and set the time zone in the format <br><br> <code>SET time_zone = 'America/Toronto';</code> <br> <br>  After that, it may seem that all problems will disappear.  But there may also be surprises. <br>  For example, in 2007 in the USA, Mexico and Canada there were some changes in the daylight saving rules.  And since the data on time zones are entered manually in mysql, you must monitor the relevance of the data.  Worse: for example, if you use the PHP language, you must ensure that the data on the time zones in mysql correspond to the data in PHP - and this is much more complicated. <br><br>  That's why the best solution if you use PHP is as follows: <br>  1. Store the date in mysql in TIMESTAMP <br>  2. Always in PHP to set the time zone of the user function <br> <code>date_default_timezone_set()</code> <br>  3. Get the TIMESTAMP value from the database and transfer it to the required format in PHP function <br> <code>date($format, $timestamp);</code> <br> <br>  At least until <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B1%25D0%25BB%25D0%25B5%25D0%25BC%25D0%25B0_2038_%25D0%25B3%25D0%25BE%25D0%25B4%25D0%25B0">2038</a> you can be sure that there is no confusion with dates. <br><br>  <b>Update:</b> transferred to the MySQL blog </div><p>Source: <a href="https://habr.com/ru/post/69614/">https://habr.com/ru/post/69614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../69603/index.html">Viliv S7 on sale for $ 629</a></li>
<li><a href="../69604/index.html">Away3d Universe - Episode 2: In the beginning it was .... # 000000</a></li>
<li><a href="../69607/index.html">Need For Speed ‚Äã‚ÄãSHIFT: Russian song in the soundtrack of the game</a></li>
<li><a href="../69610/index.html">A new competition for startups has appeared in the Urals - ‚ÄúSuccessful Start 2009‚Äù</a></li>
<li><a href="../69611/index.html">I want 3 !!! My work on the bugs on the idea of ‚Äã‚Äãinterface unification</a></li>
<li><a href="../69615/index.html">Ubuntu 9.04 vs. fiscal registrar (cash register)</a></li>
<li><a href="../69616/index.html">The simplest generation of an odt file from an existing one</a></li>
<li><a href="../69617/index.html">Processing 1.0 and almost the law of the world</a></li>
<li><a href="../69620/index.html">Dial-in server as a network recovery tool</a></li>
<li><a href="../69622/index.html">Can a simple user participate in the development of the Linux kernel? Why it is needed and what causes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>