<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ES5 Harmony Proxy - changing the semantics of JavaScript inside JavaScript itself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Proxies are new JavaScript objects for which the programmer must define their behavior. The standard behavior of all objects is defined in the JavaScr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ES5 Harmony Proxy - changing the semantics of JavaScript inside JavaScript itself</h1><div class="post__text post__text-html js-mediator-article">  Proxies are new JavaScript objects for which the programmer must define their behavior.  The standard behavior of all objects is defined in the JavaScript engine, which is most often written in C ++.  Proxies allow the programmer to define almost any behavior of the JavaScript object, they are useful for writing basic objects or function wrappers or for creating abstractions of virtual objects and provide an API for meta-programming.  Now Proxy is not included in the standard, but its standardization is planned in ECMAScript Harmony.  To avoid confusion, I will clarify that these Proxies have nothing to do with proxy servers. <br><br><h4>  Where can they be used </h4><br>  1. General intermediate abstractions <br>  2. Creation of virtual objects: wrappers of existing objects, remote (from a word far) objects, lazy creation of objects (Example ORM - Ruby ActiveRecord, Groovy GORM) <br>  3. Transparent logging, tracing, profiling <br>  4. Implementing domain-specific languages <br>  5. Dynamic interception of nonexistent methods, creation of missing methods (__ noSuchMethod__) <br>  6. Base for specific iterators <br><a name="habracut"></a><br><h4>  Concepts </h4><br>  1. This language feature is called the ‚Äúcomprehensive mechanism‚Äù (orig. Catch-all mechanism) - this name is used to describe this feature.  The text will use the original title. <br>  2. Another name for the concept of a "comprehensive mechanism" - intermediary (original. Intercession API) <br>  3. The object that handles the property is called the handler. <br>  4. The object whose properties are replaced is called a proxy - proxy <br>  5. The object / method that creates proxy objects is called a proxy factory. <br>  6. The methods included in the handler that handle any behavior are called traps / interceptors traps (by analogy with operating systems) <br>  7. The proxy can be exciting / active (orig. Trapping) or be dissolved (orig. Fixed) <br><br><h4>  How to work with them - API </h4><br>  There are two types of proxy factories.  One for objects another for functions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Proxy constructor:</b> <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> proxy = <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.create(handler, proto);</code> </pre> <br>  <b>Proxy Designer:</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> proxy = <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.createFunction(handler, callTrap, constructTrap);</code> </pre> <br>  <b>proto</b> is an optional parameter that defines the prototype proxy <br>  <b>callTrap</b> is a function that will replace the original function when directly calling a proxy function (the example below will explain everything).  Important: this replacement function (callTrap) coincides with this replaced. <br>  <b>constructTrap</b> is an optional parameter ‚Äî a function that will replace the original constructor function when called via new.  Important: this replacement function (constructTrap) is always undefined.  If constructTrap is not passed, then callTrap is used in which this delegates from proxy.prototype (the usual behavior of ES5 constructors, Chapter 13.2.2) <br>  <b>handler</b> - an object that defines the behavior of the proxy.  This object should always contain base traps. <br><br><h5>  Basic Traps / Interceptors (Fundamental traps) </h5><br>  How to read it: <code>: function(, __) -&gt; {  } //  </code> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">getOwnPropertyDescriptor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) -&gt; </span></span>{PropertyDescriptor | <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>} <span class="hljs-comment"><span class="hljs-comment">// Object.getOwnPropertyDescriptor(proxy, name) getPropertyDescriptor: function(name) -&gt; {PropertyDescriptor | undefined} // Object.getPropertyDescriptor(proxy, name) (not in ES5) getOwnPropertyNames: function() -&gt; {String[]} // Object.getOwnPropertyNames(proxy) getPropertyNames: function() -&gt; {String[]} // Object.getPropertyNames(proxy) (not in ES5) defineProperty: function(name, propertyDescriptor) -&gt; {Mixed} // Object.defineProperty(proxy,name,pd) delete: function(name) -&gt; {Boolean} // delete proxy.name fix: function() -&gt; {{String:PropertyDescriptor}[]|undefined} // Object.{freeze|seal|preventExtensions}(proxy) }</span></span></code> </pre> <br><br><h5>  Derived traps </h5><br>  These interceptors are optional, if they are not defined, the default logic will be used. <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">has</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) -&gt; </span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>} <span class="hljs-comment"><span class="hljs-comment">// if (name in proxy) ... hasOwn: function(name) -&gt; {Boolean} // ({}).hasOwnProperty.call(proxy, name) get: function(receiver, name) -&gt; {Mixed} // receiver.name; set: function(receiver, name, val) -&gt; {Boolean} // receiver.name = val; enumerate: function() -&gt; {String[]} // for (name in proxy)         keys: function() -&gt; {String[]} // Object.keys(proxy)      }</span></span></code> </pre> <br>  By default, the <a href="http://wiki.ecmascript.org/doku.php%3Fdo%3Dshow%26id%3Dharmony:proxies">following logic</a> will be executed <br>  In the form of a table you can see <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Proxy">here.</a> <br><br>  Derivatives of traps are called "derivatives" because they can be defined by basic traps.  For example, a has trap can be defined using a getPropertyDescriptor hook (check returns undefined or not).  With the help of derivatives of interceptors, it is possible to emulate properties with less cost, so they were defined.  The fix trap was introduced to allow proxies to interact with <code>Object.preventExtensions</code> , <code>Object.seal</code> and <code>Object.freeze</code> .  A non-extensible, sealed or frozen object (non-extensible, sealed, frozen) must in some way restrict the freedom of the handler (i.e.  what he should return in future calls to <code>set, get</code> so forth.  For example, if the previous call to <code>handler.get(p, ‚Äúfoo‚Äù)</code> returned not undefined, then future calls to <code>handler.get(p, "foo")</code> must return the same value if the object is frozen.  Each time a proxy tries to freeze, seal, block (non-extensible, sealed or frozen) the trap <code>"fix"</code> called. <br>  <b>The fix handler has 2 options:</b> <br>  1. reject request (fix should return undefined), then a TypeError exception will be thrown. <br>  2. execute the query and return the object description in the form <code>{String:PropertyDescriptor}[]</code> in this case, the ‚Äúcomprehensive mechanism‚Äù will create a new object based on the object description.  At this point, all references to the handler are deleted (it can be deleted by the garbage collector).  In this case, the proxy is called dissolved. <br><br><h4>  Examples </h4><br><br><h5>  Hello, proxy! </h5><br>  The following piece of code creates a proxy that interrupts access to the properties and returns the value ‚ÄúHello, p‚Äù for each property ‚Äúp‚Äù: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.create({ <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">proxy, name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span>+ name; } }); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.write(p.World); <span class="hljs-comment"><span class="hljs-comment">//  'Hello, World'</span></span></code> </pre> <br>  <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxy_examples/helloproxy.html">Living example</a> <br><br><h5>  Simple profiler </h5><br>  Create a simple wrapper that counts how many times what property was obtained: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeSimpleProfiler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> forwarder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ForwardingHandler(target); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> count = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); forwarder.get = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rcvr, name</span></span></span><span class="hljs-function">) </span></span>{ count[name] = (count[name] || <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target[name]; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">proxy</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.create(forwarder, <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(target)), get stats() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count; } }; }</code> </pre> <br>  The makeSimpleProfiler function takes as its argument the object we want to monitor.  It returns an object that has 2 properties: the proxy itself and stats - the number of calls. <br>  <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxy_examples/profiler.html">Living example</a> <br><br>  The ForwardingHandler function in line two functions makeSimpleProfiler creates a simple forwarding proxy that transparently delegates all operations performed on the proxy to the target object.  Here's what she looks like: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForwardingHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target = obj; } ForwardingHandler.prototype = { <span class="hljs-attr"><span class="hljs-attr">has</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target; }, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rcvr,name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target[name]; }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rcvr,name,val</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target[name]=val;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">delete</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target[name]; } enumerate: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> props = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target) { props.push(name); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; }, <span class="hljs-attr"><span class="hljs-attr">iterate</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> props = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enumerate(), i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i === props.length) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">StopIteration</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props[i++]; } }; }, <span class="hljs-attr"><span class="hljs-attr">keys</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target); }, ... }; <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.wrap = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.create(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ForwardingHandler(obj), <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(obj)); }</code> </pre> <br>  The full version of this feature can be found <a href="">here</a> .  This forwarding handler is likely to become <a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dharmony:proxy_defaulthandler">part of the standard</a> . <br><br><h5>  Remote objects </h5><br>  Proxies allow you to create virtual objects that can emulate remote objects or existing objects.  To demonstrate, let's create a wrapper around an existing library for remote communication in JavaScript.  The web_send Tyler Close library can be used to create remote connections to objects located on the server.  Now we can call methods on HTTP POST requests using this remote connection.  Unfortunately, remote connections cannot be used as objects. <br>  Let's compare.  To call a remote function, initially it was necessary to call: <br><pre> <code class="javascript hljs">Q.post(ref, <span class="hljs-string"><span class="hljs-string">'foo'</span></span>, [a,b,c]);</code> </pre> <br>  Using proxies, we can make this call more natural, write our wrapper: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Obj</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ref</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.create({ <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rcvr, name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.slice.call(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q.post(ref, name, args); }; } }); }</code> </pre> <br>  Now we can do like this <code>Obj(ref).foo(a,b,c)</code> . <br><br><h5>  Emulation __noSuchMethod__ </h5><br>  Using Proxy, it is possible to emulate the __noSuchMethod__ hook in browsers that do not support it (but this is not relevant now). <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{}; MyObject.prototype = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create(NoSuchMethodTrap); MyObject.prototype.__noSuchMethod__ = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">methodName, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span>+ methodName; }; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyObject().foo() <span class="hljs-comment"><span class="hljs-comment">// returns 'Hello, foo'</span></span></code> </pre> <br>  This object uses a NoSuchMethodTrap proxy in which the get trap replaces the original __noSuchMethod__. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NoSuchMethodTrap = <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.create({ <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rcvr, name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name === <span class="hljs-string"><span class="hljs-string">'__noSuchMethod__'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"receiver does not implement __noSuchMethod__ hook"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.slice.call(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.__noSuchMethod__(name, args); } } } });</code> </pre> <br>  <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxy_examples/noSuchMethod.html">Living example</a> <br><br><h5>  Higher order messages </h5><br>  Higher-order messages are messages that receive other messages as an argument, as described <a href="http://www.metaobject.com/papers/Higher_Order_Messaging_OOPSLA_2005.pdf">here</a> . <br>  Higher-order messages are similar to higher-order functions, but they are more capacious in code.  Using a proxy is very easy to create higher order messages.  Consider the special object "_", which rewrites messages into functions: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msg = _.foo(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) msg.selector; <span class="hljs-comment"><span class="hljs-comment">// "foo" msg.args; // [1,2] msg(x); // x.foo(1,2)</span></span></code> </pre> <br>  msg is a function that uses one argument as if it were defined as <code>function(z) { return z.foo(1,2); }</code>  <code>function(z) { return z.foo(1,2); }</code> .  The following example is a direct interpretation of the SVP from the aforementioned documents, but written with more capacious code: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> words = <span class="hljs-string"><span class="hljs-string">"higher order messages are fun and short"</span></span>.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.prototype.longerThan = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length &gt; i; }; <span class="hljs-comment"><span class="hljs-comment">//        document.write(words.filter(_.longerThan(4)).map(_.toUpperCase())); //       : // words.filter(function (s) { return s.longerThan(4) }) // .map(function (s) { return s.toUpperCase() })</span></span></code> </pre> <br>  Here is the object code "_": <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     var _ = Proxy.create({ get: function(_, name) { return function() { var args = Array.prototype.slice.call(arguments); var f = function(rcvr) { return rcvr[name].apply(rcvr, args); }; f.selector = name; f.args = args; return f; } } });</span></span></code> </pre> <br>  <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxy_examples/hom.html">Living example</a> <br><br><h5>  Base Object Emulation </h5><br>  Proxies enable Javascript programmers to emulate the weirdness of basic objects, such as DOM.  This allows the authors of libraries to wrap the base objects in order to ‚Äútame‚Äù them (approx. Sandboxes) or correct them to reduce cross-browser incompatibility. <br><br><h5>  Proxy functions </h5><br>  The previous examples used objects.  Here is a simple example of a proxy function: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> simpleHandler = { <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">proxy, name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// can intercept access to the 'prototype' of the function if (name === 'prototype') return Object.prototype; return 'Hello, '+ name; } }; var fproxy = Proxy.createFunction( simpleHandler, function() { return arguments[0]; }, // call trap function() { return arguments[1]; }); // construct trap fproxy(1,2); // 1 new fproxy(1,2); // 2 fproxy.prototype; // Object.prototype fproxy.foo; // 'Hello, foo'</span></span></code> </pre> <br>  <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxy_examples/hellofproxy.html">Living example</a> <br><br>  Proxy functions open up possibilities for writing special idioms that were not available to us in pure JavaScript.  First of all, proxy functions can create a function (callable object) from any object: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeCallable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, call, construct</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.createFunction( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ForwardingHandler(target), call, construct || call); }</code> </pre> <br>  Second, proxy functions can be used to create pseudo-classes whose entities are instances callable. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Thing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* initialize state, etc */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> makeCallable(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* actions to perform when instance is called like a function */</span></span> }); }</code> </pre> <br><h4>  Experiments with new semantics </h4><br>  For lovers of the language: Proxies can be used to create "standard" objects and JavaScript functions in JavaScript itself.  The ability to change the semantics of JavaScript objects within JavaScript greatly simplifies the mechanism for making minor changes to the semantics for conducting experiments.  Partial implementation of semantics inside JavaScript can be observed in the <a href="http://wiki.ecmascript.org/doku.php%3Fdo%3Dshow%26id%3Dharmony:proxies">default trap values</a> .  Another example: <a href="https://github.com/DavidBruant/ProxyArray">JavaScript arrays</a> inside JavaScript using Proxy. <br><br><h4>  Proxy tips </h4><br><h5>  Avoid recursion </h5><br>  Avoid implicit toString calls inside traps.  Be careful with the receiver argument of the get and set traps.  The receiver represents a link to the proxy, therefore implicitly calling get and set will result in infinite recursion.  For example, calling console.log (receiver) for debugging inside a setter will call the toString method, which will cause infinite recursion. <br><pre> <code class="javascript hljs">get: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">receiver, name</span></span></span><span class="hljs-function">) </span></span>{ print(receiver); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target[name]; }</code> </pre> <br>  If <code>p</code> is a proxy that uses the trap above, then calling <code>p.foo</code> will result in an infinite loop: First, the <code>get</code> trap will be called with <code>name="foo"</code> , which prints the <code>receiver</code> (ie, <code>p</code> ).  This results in a call to <code>p.toString()</code> , which will call the trap again this time with <code>name="toString"</code> .  And so on. <br><br><h5>  Proxy as handlers </h5><br>  Proxy handlers can themselves be proxies.  The proxy tracer below domains this pattern, it is used to create a "tunneling" of all operations for the processor through one get trap. <br><br><img src="http://brendaneich.com/brendaneich_content/uploads/meta-level-shifting.png" alt="image"><br><br><h6>  Proxy Tracer / Proxy Probe </h6><br>  <a href="http://code.google.com/p/es-lab/source/browse/trunk/src/proxies/tracer.html">Tracer</a> simply prints a description of all operations that he processed.  This is very useful for debugging or for studying the work of a proxy. <br>  <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxy_examples/tracer.html">Living example</a> <br><br>  <a href="http://code.google.com/p/es-lab/source/browse/trunk/src/proxies/probe.html">A probe</a> has a logic similar to a tracer, it logs all meta-level operations applied to it. <br>  <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxy_examples/probe.html">Living example</a> <br><br><h4>  When can it be used? </h4><br>  Now only Firefox 4.0 supports proxies.  There is a proxy implementation for Node.js as an extension: <a href="http://github.com/bmeck/node-overload">node-overload</a> (partial support) <a href="https://github.com/isaacs/node-proxy">node-proxy</a> (almost full support).  In any case, Proxies will be added to the standard so that it will soon appear in your browser! <br><br><h4>  Additional resources </h4><br>  1. <a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dharmony:proxies">ECMAScript Harmony</a> <br>  2. <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Proxy">Documentation</a> on The Mozilla Developer Network <br>  3. Standard Development: The first part of this is <a href="http://www.youtube.com/watch%3Fv%3DA1R8KGKkDjU">Google Tech Talk</a> and <a href="http://soft.vub.ac.be/~tvcutsem/proxies/assets/proxies.pdf">this is the paper</a> shown on <a href="http://www.dynamic-languages-symposium.org/">DLS 2010</a> . <br>  4. Brendan Eich, in his <a href="http://brendaneich.com/2010/11/proxy-inception/">blog</a> briefly explains the basics of Proxy. <br>  5. Partial <a href="https://bugzilla.mozilla.org/buglist.cgi%3Fquery_format%3Dadvanced%26short_desc%3Dharmony%2520proxies%26bug_status%3DUNCONFIRMED%26bug_status%3DNEW%26bug_status%3DASSIGNED%26bug_status%3DREOPENED%26bug_status%3DVERIFIED%26short_desc_type%3Dallwordssubstr%26component%3DJavaScript%2520Engine%26resolution%3D---%26resolution%3DDUPLICATE">list of</a> open Proxy problems in Firefox 4. <br>  6. <a href="http://www.slideshare.net/BrendanEich/metaprog-5303821%3Ffrom%3Dss_embed">Slides</a> Brendan Eich from his salary on jsconf <br><br><h4>  Resources used in the article </h4><br>  1. <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Proxy">MDC Proxy (DRAFT)</a> <br>  2. <a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dharmony:proxies">ES5 Catch-all Proxies</a> <br>  3. <a href="http://brendaneich.com/2010/11/proxy-inception/">Proxy Inception</a> (Brendan Eich) <br>  4. <a href="http://soft.vub.ac.be/~tvcutsem/proxies/">Tutorial: Harmony Proxies</a> (Tom Van Cutsem) <br><br>  If you do not understand something, please ask your questions or watch the <a href="http://www.slideshare.net/BrendanEich/metaprog-5303821%3Ffrom%3Dss_embed">slides</a> .  Suggestions, suggestions, criticism is welcome! </div><p>Source: <a href="https://habr.com/ru/post/117915/">https://habr.com/ru/post/117915/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117909/index.html">A simple, seemingly javascript question.</a></li>
<li><a href="../117910/index.html">Control over the financial condition of the enterprise and analysis of the results of its activities in real time</a></li>
<li><a href="../117912/index.html">PORN PLAYING</a></li>
<li><a href="../117913/index.html">Cyrillic .org domains will earn today</a></li>
<li><a href="../117914/index.html">Have you ever written parsers?</a></li>
<li><a href="../117916/index.html">Distribution Alt Linux received a certificate FSTEC</a></li>
<li><a href="../117917/index.html">Multimaster replication for firebird in python</a></li>
<li><a href="../117918/index.html">Asynchronous punch</a></li>
<li><a href="../117922/index.html">CRM for students</a></li>
<li><a href="../117924/index.html">The first online concert of Yuri Shevchuk at 720p</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>