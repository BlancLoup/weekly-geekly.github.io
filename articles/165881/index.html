<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>System of automatic assembly of mobile applications Alawar Build System</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 In this post we want to share the experience of creating an automated system for assembling mobile applications, in our case, games for the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>System of automatic assembly of mobile applications Alawar Build System</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  In this post we want to share the experience of creating an automated system for assembling mobile applications, in our case, games for the iOS platform. <br><br>  We are faced with the need to automate the assembly and deployment to test devices, when the size of the fleet of devices has exceeded two dozen, and the number of projects simultaneously in QA has reached 30+.  With such volumes, the deployment of the build to test devices using ‚ÄúBuild &amp; Run‚Äù in Xcode began to noticeably slow down the QA process.  It was decided to automate the process of assembling and uploading builds to devices. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our updated build system consists of three main components: <br><ul><li>  Repositories with source codes of projects; </li><li>  Build server; </li><li>  Server distribution of builds on devices. </li></ul><br><br>  The process of passing a project version from developers to testers is as follows: <br><ul><li>  The developer makes a commit version to the repository; </li><li>  The build server starts the build of the corresponding project; </li><li>  In the case of a successful build, the build is laid out on the distribution server; </li><li>  The final IPA is installed on the device ‚Äúover the air‚Äù. </li></ul><br><img src="https://habrastorage.org/storage2/5a9/586/733/5a958673384d9f88218d2156d5cccaf5.jpg"><br><br><a name="habracut"></a><br>  Let us dwell in more detail on each of the main components. <br><br><h6>  Repositories </h6><br>  We use Subversion as a source code repository, this hard currency is easy to use, the client is on a Mac from any iOS developer out of the box.  There are only two subtle points with SVN: <br><ul><li>  By default, the SVN client is configured to ignore the * .a mask, this leads to the fact that static library files are not added to the repository.  This setting must be overridden on all client machines. </li><li>  To start the project build in automatic mode, we have an onAfterCommit hook set up that checks in the comments to the commit the presence of the ‚ÄúREADY‚Äù tag, with which the developer marks the version ready for build and transfer to QA. </li></ul><br><br><h6>  Build server </h6><br>  We chose <a href="http://jenkins-ci.org/">Jenkins</a> , deployed on a Mac server, as the core of the build server.  Jenkins is open, free, easy to install and configure, easily expanded by third-party plugins and is actively supported. <br>  The actual build of the project consists in checking the source code and invoking the xcodebuild command with the appropriate parameters. <br>  The main (assembly) part is a bash script that looks like this: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   xcodebuild -target "${TARGET}" -configuration "{$CONFIGURATION}" -project "${XCODEPROJ}" CODE_SIGN_IDENTITY="${CERTIFICATE}" PROVISIONING_PROFILE="${PROVISIONING_ID}" CONFIGURATION_BUILD_DIR="${CONFIGURATION_BUILD_DIR}" #   $XCODEPROJ, $TARGET  $CONFIGURATION      #  $CONFIGURATION_BUILD_DIR  ,      app #   $CERTIFICATE  $PROVISIONING_ID     ()     #   IPA xcrun -sdk iphoneos PackageApplication -v "${APPLICATION_NAME}.app" -o "${WORKSPACE}/orig_${APP_NAME}.ipa" #     curl -f -k --form "data[email]=${AIRONAPP_USER}" --form "data[password]=${AIRONAPP_PASSWORD}" --form "data[application]=${AIRONAPP_ID}" --form "data[ipa_file]=@${IPA_FILE}" ${AIRONAPP_URL}/api/1.0/http/uploadIPA</span></span></code> </pre> <br><br>  Given that our developers are working on different versions of XCode, we support the build with four different versions (as of the moment of writing the post): 4.2.1, 4.3.1, 4.5.1 and 4.5.2.  By default, the latter is used, with the ability to specify a specific version for a specific project.  This feature turned out to be particularly relevant at the moment when the Unity3D game engine had a known compatibility bug with iOS SDK 6.0 and XCode 4.5.x.  (Fix was released in Unity3D version 3.5.6) After the build, the received app is packaged in ipa using the PackageApplication utility, and the resulting ipa file is sent to the distribution server of the builds.  If the assembly ‚Äúcollapses‚Äù for some reason, the developer receives by mail the full console log with all error messages.  Both Alawar release managers (to be able to start building a project manually) and external developers have access to Jenkins, for example, in order to get dSYM files for analyzing crash logs. <br><br>  We use Mac Mini Server (Core i7 4 * 2.7GHz, 16Gb RAM, 1Tb HDD) as a hardware, this configuration confidently copes with the simultaneous assembly of four game projects.  The average assembly time does not exceed 15 minutes (for projects of the ‚Äúhidden object‚Äù genre, where the size of the final ipa file is 400-600Mb).  Jenkins is configured to work in 1 master with 4 assemblers.  Of the installed plugins can be noted: <br><ul><li>  Subversion Release Manager - allows you to explicitly specify the revision for manual assembly; </li><li>  Log Parser - parses the console output of XCode according to predefined templates and makes easy navigation through errors; </li><li>  Clang Scan-Build - runs a static analyzer and generates reports of potential leaks; </li><li>  Priority Sorter - allows you to set projects priorities and collect more urgent / important in the first place. </li></ul><br><br><h6>  Server distribution builds "by air" </h6><br>  As a service for the distribution of ipa-files, we use a ready-made solution from Arello Mobile - the <a href="http://www.aironapp.com/">AirOnApp</a> service.  In fact, this is an analogue TestFlight with additional "buns", such as: <br><ul><li>  The service is deployed on our server platform in the office, which saves us from external traffic; </li><li>  The ability to conveniently add new devices to the team account from the admin panel AirOnApp; </li><li>  The ability to publish applications in the App Store from the same admin panel. </li></ul><br>  In addition to the build distribution server, we use a small client application to which a push notification containing a link to install the build is sent to a successful build. <br><br>  To date, we have received: <br><ul><li>  Stable automated build and deployment of builds.  It allows you to conveniently and quickly accept the version from the developers, make sure that the source codes are correct and spread the build to test devices with minimal human participation. </li><li>  A clear scheme of versioning projects.  With this scheme, any participant in the process always knows which version of the application is installed on the device, in which version a bug is found, etc. </li><li>  A handy toolkit for working with an Apple account.  It allows you to add a new device to your account, add it also to provisional profiles, re-sign builds with updated provisioning, submit applications to the store. </li></ul><br><br>  In the future, we plan to implement support for the automatic assembly of applications for all major platforms with which we work (MacOS, Android, Windows, Windows 8, etc.), creating a cluster of collectors on several physical machines running corresponding OS with a single Jenkins admin panel . <br><br>  I would be happy to answer your questions in the comments or hear stories about how such problems are solved in your company. </div><p>Source: <a href="https://habr.com/ru/post/165881/">https://habr.com/ru/post/165881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165869/index.html">Whois: practical user guide</a></li>
<li><a href="../165873/index.html">IT specialists focus their resume on teamwork, hard work and analytical mind</a></li>
<li><a href="../165875/index.html">Tactile transforming keyboard for touchscreen displays presented at CES 2013</a></li>
<li><a href="../165877/index.html">Testing in Mail.Ru Group</a></li>
<li><a href="../165879/index.html">Algorithms for the struggle of Ukrainian IT specialists with VAT</a></li>
<li><a href="../165883/index.html">Voice informer via Skype for 1C: Enterprise</a></li>
<li><a href="../165887/index.html">Shield and sword in RBS systems. Applied solution</a></li>
<li><a href="../165893/index.html">The brightest events of the gaming industry 2012-2013 | Video digest Geek Week, special issue</a></li>
<li><a href="../165895/index.html">Extra join in SQL queries</a></li>
<li><a href="../165897/index.html">Substitution DSDT via GRUB2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>