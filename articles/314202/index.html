<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ServiceStack & .NET Core</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A month and a half ago, ServiceStack, a popular framework for creating web services and applications, finally released a .NET Core release. In this re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ServiceStack & .NET Core</h1><div class="post__text post__text-html js-mediator-article">  A month and a half ago, ServiceStack, a popular framework for creating web services and applications, finally released a .NET Core release.  In this review, I want to tell you a little about the platform packages themselves and what will have to be redone in my projects using ServiceStack in order to port them to the .NET Core platform. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  It should immediately say that the project team tried their best.  I was able to adapt my mediocre research project with a couple of dozens of services to new realities in almost one day. <br><br>  What was the profit from the transfer?  Definitely - objectively increased the speed of responses and query processing.  For individual methods, the response time decreased by 3 times.  On average, the performance increase was 30% percent.  Of course, the main point is that the overhead projector has decreased due to the lack of the System.Web library and the whole ASP.NET subsystem on the whole, on which the main project ServiceStack is based. <br><br><h4>  Main libraries </h4><br>  The authors did not do .NET Core support directly in the main package, and released a separate set of packages under the new version 1.0- * ( <b>1.0.25</b> at the time of this writing) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The set of packages is quite extensive: <br><br><ul><li>  ServiceStack.Text.Core </li><li>  ServiceStack.Interfaces.Core </li><li>  ServiceStack.Client.Core </li><li>  ServiceStack.HttpClient.Core </li><li>  ServiceStack.Common.Core </li><li>  ServiceStack.Redis.Core </li><li>  ServiceStack.OrmLite.Core </li><li>  ServiceStack.OrmLite.Sqlite.Core </li><li>  ServiceStack.OrmLite.SqlServer.Core </li><li>  ServiceStack.OrmLite.PostgreSQL.Core </li><li>  ServiceStack.Core </li><li>  ServiceStack.Mvc.Core </li><li>  ServiceStack.Server.Core </li><li>  ServiceStack.ProtoBuf.Core </li><li>  ServiceStack.Wire.Core </li><li>  ServiceStack.Aws.Core </li><li>  ServiceStack.RabbitMq.Core </li><li>  ServiceStack.Stripe.Core </li><li>  ServiceStack.Admin.Core </li><li>  ServiceStack.Api.Swagger.Core </li><li>  ServiceStack.Kestrel </li></ul><br>  and is the same code base as in the main project, with small differences in individual points.  Perhaps, for most of the tasks presented by the pacts, it will be more than enough to port your code with minimal cost. <br><br>  The code of the current packages matches, subjectively, by 98-99%.  There are differences in places that require support for the .net core infrastructure.  To be perfectly accurate, these packages fully support .NET Standard 1.6.  Those.  can actually be used under all platforms that implement it, and since  Currently 1.6 is the latest version of the standard, then these are all modern platforms.  Learn more about the <a href="https://docs.microsoft.com/en-us/dotnet/articles/standard/library">.NET Standard Library</a> . <br><br><h4>  Features of the current version </h4><br><h5>  Containers </h5><br>  ServiceStack has used its own DI container, <b>Funq</b> , for centuries.  ASP.NET infrastructure did not provide any other.  Of course, you could replace the current <b>Funq</b> with another favorite container, but in general, the functionality of the built-in was more than <b>enough</b> . <br><br>  In the Core version, you can continue to use the built-in <b>Funq</b> , but now ServiceStack builds it into the .NET Core infrastructure DI container.  In fact, you can now configure the container from 2 places: <br><br>  From the method: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { } ... }</code> </pre> <br>  As the platform proposes and from the method: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ServicesHost</span></span> : <span class="hljs-title"><span class="hljs-title">AppHostBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Container container</span></span></span><span class="hljs-function">)</span></span> { } ... }</code> </pre><br>  As it was all the time.  However, it is necessary to take into account the main thing - with this approach, a ‚Äúvisibility zone‚Äù of services now appears.  Services declared in the <b>Startup</b> class can be enabled from all points of the application.  Services that will be configured inside the <b>Configure</b> overload will only be visible inside the ServiceStack.  Infrastructure. NET Core will not see them. <br><br><h5>  Logging </h5><br>  Now all ServiceStack logging is proxied to the standard .NET Core logger.  Those.  now you do not need to use third-party libraries to extend SS logging.  It is enough to use such to expand logging of the built-in <b>LoggerFactory</b> . <br><br><h5>  ServiceStack.Authentication </h5><br>  Since  <b>DotNetOpenAuth is</b> not ported to .NET Core, then everything that was associated with this dependency is not working now.  I do not use this functionality, so I don‚Äôt have the details of how it is now ‚Äúbroken‚Äù. <br><br><h5>  SOAP </h5><br>  All that is associated with it in the current version is not fully supported. <br><br><h5>  Mini profiler </h5><br>  The useful thing on the main platform, in the Core does not work, because  requires a dependency on <b>System.Web</b> . <br><br>  On the other changes and supported and not supported features can be found <a href="http://docs.servicestack.net/">here</a> . <br><br><h4>  How to start porting </h4><br><h5>  Convert the project </h5><br>  There are 2 main ways to port to .NET Core: <br><br>  <strong>1.</strong> Convert the current folder to a project by adding <b>project.json</b> files, almost standard for all <b>* .xproj</b> , a file containing the <b>main</b> function and a <b>Starupt.cs</b> file (in fact, the name can be anything) <br><br>  <strong>2.</strong> Create an empty ASP.NET Core App and simply add files from the old project. <br><br>  The second option is preferable, because  requires a little less effort to transform and fit the current project. <br><br><h5>  Add links to </h5><br>  There is no need to invent anything, just add the standard ServiceStack packages: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNetCore.Diagnostics"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNetCore.Server.IISIntegration"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNetCore.Server.Kestrel"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.Extensions.Configuration"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.Extensions.Configuration.FileExtensions"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.Extensions.Configuration.Json"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.Extensions.Configuration.Binder"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.Extensions.Logging.Debug"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microsoft.NETCore.App"</span></span>: { <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"platform"</span></span> }, <span class="hljs-string"><span class="hljs-string">"System.Diagnostics.Tools"</span></span>: <span class="hljs-string"><span class="hljs-string">"4.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"NLog.Extensions.Logging"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rtm-alpha4"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.Api.Swagger.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.Client.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.Common.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.Interfaces.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.ProtoBuf.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.Redis.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"ServiceStack.Text.Core"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.25"</span></span>, <span class="hljs-string"><span class="hljs-string">"System.Reflection.TypeExtensions"</span></span>: <span class="hljs-string"><span class="hljs-string">"4.1.0"</span></span> }</code> </pre><br>  I have also added an extension for logging NLog, because  The project used it earlier.  Configuration is done through the nlog.config file, which is no different from older versions. <br><br><h5>  Change Sturtup.cs </h5><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ILoggerFactory _loggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ILogger _logger; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IHostingEnvironment env, ILoggerFactory loggerFactory</span></span></span><span class="hljs-function">)</span></span> { _loggerFactory = loggerFactory; _loggerFactory.AddNLog(); _logger = _loggerFactory.CreateLogger(GetType()); env.ConfigureNLog(<span class="hljs-string"><span class="hljs-string">$"nlog.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{env.EnvironmentName}</span></span></span><span class="hljs-string">.config"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .SetBasePath(env.ContentRootPath) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>, optional: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, reloadOnChange: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{env.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>, optional: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) .AddEnvironmentVariables(); Configuration = builder.Build(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfigurationRoot Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { OrmLiteConfig.DialectProvider = SqlServer2012Dialect.Provider; services.TryAddSingleton&lt;IHttpContextAccessor, HttpContextAccessor&gt;(); services.AddSingleton(Configuration); services.AddScoped&lt;IDbConnectionFactory&gt;(p =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OrmLiteConnectionFactory(Configuration.GetConnectionString(<span class="hljs-string"><span class="hljs-string">"DefaultConnection"</span></span>))); services.AddScoped&lt;IRedisClientsManager&gt;(p =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicRedisClientManager(Configuration.GetConnectionString(<span class="hljs-string"><span class="hljs-string">"RedisConnectionString"</span></span>))); services.AddSingleton&lt;ServicesHost&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder app, IHostingEnvironment env</span></span></span><span class="hljs-function">)</span></span> { _logger.LogInformation(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventId(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">"Startup started"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = (AppHostBase)app.ApplicationServices.GetService(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ServicesHost)); app.UseServiceStack(host); } }</code> </pre><br>  I use the approach when everything is in a container, so even the main <b>ServicesHost</b> class also fits in the container.  This allows later in the constructor to get the necessary dependencies without resorting to resolving them on their own. <br><br>  In many projects earlier, Singleton from the <b>System.Web</b> space was used to access the current Http context.  Now this class is not available in .Net Core. You need to use the following service: <br><br><pre> <code class="cs hljs">services.TryAddSingleton&lt;IHttpContextAccessor, HttpContextAccessor&gt;();</code> </pre><br>  Here you need to know that the value in <b>HttpContextAccessor.HttpContext</b> will be different from <b>null</b> , only when there is any request from outside.  In other cases, it always contains <b>null</b> . <br><br>  Methods for connecting configuration files can be used not only for <b>appsettings</b> , but also for any other lines, for example, for the <b>nlog</b> configuration <br><br><pre> <code class="cs hljs">env.ConfigureNLog(<span class="hljs-string"><span class="hljs-string">$"nlog.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{env.EnvironmentName}</span></span></span><span class="hljs-string">.config"</span></span>);</code> </pre><br>  In the main container, all dependencies that are in the project (data access layers, external services, etc.) are also configured.  Inside the ServiceStack you should leave only a very limited number, which no one outside SS will ever use. <br><br><h5>  ServicesHost Changes </h5><br>  This is the main container class for configuring the ServiceStack environment and is usually already in the old project.  In each project, it can be called differently, but the essence is that this class is inherited from the class <b>AppHostBase</b> , if in a ported project it is not, then it is necessary to inherit from this class: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ServicesHost</span></span> : <span class="hljs-title"><span class="hljs-title">AppHostBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IHttpContextAccessor _accessor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IAppSettings _settings; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ILogFactory _loggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IRedisClientsManager _redisClientsManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServicesHost</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IHttpContextAccessor accessor, IAppSettings settings, ILogFactory loggerFactory, IRedisClientsManager redisClientsManager</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">StringsConstants.SERVICES_NAME, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-function"><span class="hljs-params">(AuthService</span></span></span><span class="hljs-function">).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAssembly</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>))</span></span> { _accessor = accessor; _settings = settings; _loggerFactory = loggerFactory; _redisClientsManager = redisClientsManager; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Container container</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    ConfigurePlugins(); container.RegisterValidators(typeof(RegistrationRequestValidator).GetAssembly()); ConfigureBinders(); //      ConfigureGlobalRequestFilters(); //     SetConfig(new HostConfig { ApiVersion = StringsConstants.API_VERSION, #if !DEBUG EnableFeatures = Feature.Json | Feature.ProtoBuf | Feature.Html, WriteErrorsToResponse = false, #else EnableFeatures = Feature.Html | Feature.Json | Feature.RequestInfo | Feature.Metadata | Feature.ProtoBuf, WriteErrorsToResponse = true, #endif DebugMode = _settings.Get("DebugMode", false), LogFactory = _loggerFactory, Return204NoContentForEmptyResponse = true, DefaultRedirectPath = "/swagger-ui/", MapExceptionToStatusCode = { {typeof(DomainException), (int) HttpStatusCode.InternalServerError} } }); } ..... }</span></span></code> </pre><br>  In my case, the standard functionality of request validation is configured inside the ServiceStack, since  it is not used anywhere else. <br><br>  The complexity of transferring this file to .NET Core depends on the project.  If you use only standard SS functionality and other third-party packages that are already ported to .NET Core, then changes to the file may be minimal. <br><br><h5>  System.Configuration </h5><br>  This is one of the ‚Äúsickest‚Äù places when porting from classic ASP.NET to .NET Core.  ServiceStack, in its implementation of abstraction, <b>IAppSettings</b> used and used work with old <b>app / web.config</b> files.  In order to enable it to work with <b>appsettings.config,</b> you just need to implement your version of <b>IAppSettings</b> .  The class is actually quite simple and uses part of the infrastructure of the ServiceStack itself: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppSettings</span></span> : <span class="hljs-title"><span class="hljs-title">AppSettingsBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppSettings</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationRoot root, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tier = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new ConfigurationManagerWrapper(root</span></span></span><span class="hljs-function">))</span></span> { Tier = tier; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetNullableString(name); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConfigurationManagerWrapper</span></span> : <span class="hljs-title"><span class="hljs-title">ISettings</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IConfigurationRoot _root; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; _appSettings; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigurationManagerWrapper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationRoot root</span></span></span><span class="hljs-function">)</span></span> { _root = root; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Dictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAppSettingsMap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_appSettings == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dictionary = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> appSettingsSection = _root.GetSection(<span class="hljs-string"><span class="hljs-string">"appSettings"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (appSettingsSection != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> child <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> appSettingsSection.GetChildren()) { dictionary.Add(child.Key, child.Value); } } _appSettings = dictionary; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _appSettings; } <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Implementation of ISettings public string Get(string key) { string str; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!GetAppSettingsMap().TryGetValue(key, out str)) return null; return str; } public List&lt;string&gt; GetAllKeys() { return GetAppSettingsMap().Keys.ToList(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br>  Now just add the dependency to the container: <br><br><pre> <code class="cs hljs">services.AddSingleton&lt;IAppSettings, AppSettings&gt;();</code> </pre><br>  And that's it - the settings from the <b>appSettings</b> section in the <b>appsettings.config</b> file <b>are</b> in your pocket. <br><br><h4>  Conclusion </h4><br>  What I described above is all (!) Changes (little things with renaming some interfaces and forwarding them to other classes are a matter of a short time), which I added to the project written on the full version of ServiceStack, what would it work with its Core version . <br><br>  All that concerns OrmLite, Redis, Text, Client and other useful packages didn‚Äôt require any changes at all.  And it is very beneficial distinguishes, for example, the same OrmLite from EF.  In order to port a project written in EF from a full .NET to .Core, you will have to expend quite a few efforts.  There is no need for any manipulations at all - everything just works. <br><br>  If you used ServiceStack in your projects on full .NET, the transition to .NET Core can take quite a bit of time.  The SS team tried to make everything as compatible as possible and hey, it was quite possible.  Of course, the ServiceStack is paid, but no one forbids you to use the open source code of the project for your personal purposes. <br><br>  And at the end of a small life hack, how to remove restrictions on use during development (those that are - never enough): <br><br>  1. Download to your <b><a href="https://github.com/ServiceStack/ServiceStack.Text">github.com/ServiceStack/ServiceStack.Text</a></b> <br>  2. Change the limits in the file <b>LicenseUtils.cs</b> or disable the call to checks <br>  3. We collect Core project <br>  4. Copy files from bin \ Release \ netstandart1.3 to% HOME% \. Nuget \ packages \ ServiceStack.Text.Core \ {your version} \ lib \ netstandart1.3 <br>  5. Profit! <br><br>  If there is a new version, you will have to do all the steps again.  And do not be afraid, until you delete the entire cache - "your" assembly does not get stuck. <br><br>  <b>PS:</b> oh yeah ... now everything works not on iis, but in the docker container. <br><br>  <b>UPD:</b> In the commentary, <a href="https://habrahabr.ru/users/scratch/" class="user_link">Scratch</a> proposed a less invasive option to bypass the restrictions, but for the Core version it will be slightly different: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ServiceStackHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceStackHelper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyNetStandardPclExport(); PclExport.Instance = instance; NetStandardPclExport.Provider = instance; Licensing.RegisterLicense(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Help</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyNetStandardPclExport</span></span>: <span class="hljs-title"><span class="hljs-title">NetStandardPclExport</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> LicenseKey </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VerifyLicenseKeyText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> licenseKeyText</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LicenseKey { Expiry = DateTime.MaxValue, Hash = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty, Name = <span class="hljs-string"><span class="hljs-string">"Habr"</span></span>, Ref = <span class="hljs-string"><span class="hljs-string">"1"</span></span>, Type = LicenseType.Enterprise }; } } }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/314202/">https://habr.com/ru/post/314202/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314190/index.html">Why Code School CEO Greg Pollack left the company</a></li>
<li><a href="../314192/index.html">Thermal Resistance: Production Process</a></li>
<li><a href="../314194/index.html">Interesting bookmarks UX / UI-designer</a></li>
<li><a href="../314196/index.html">Announcement of Sync.NET mitap # 3</a></li>
<li><a href="../314198/index.html">WildData: easy data access framework</a></li>
<li><a href="../314204/index.html">Automatically generated CMS using your ready-made GraphQL scheme</a></li>
<li><a href="../314206/index.html">November 2 - the most IT day of the year</a></li>
<li><a href="../314208/index.html">Announce Dart Sass</a></li>
<li><a href="../314210/index.html">Development Indie RPG: analysis of two years of development</a></li>
<li><a href="../314212/index.html">Monitoring Docker Hosts, Containers, and Container Services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>