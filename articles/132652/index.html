<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Decoding Siri</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The guys from the French company Applidium exactly a month after the release of the iPhone 4S reversed the Siri personal assistant protocol. Below is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Decoding Siri</h1><div class="post__text post__text-html js-mediator-article">  The guys from the French company Applidium exactly a month after the release of the iPhone 4S reversed the Siri personal assistant protocol.  Below is a translation of the <a href="http://applidium.com/en/news/cracking_siri/">article</a> , which describes the process of reverse engineering and the interesting facts that have been revealed to the researchers. <br><a name="habracut"></a><br>  October 14, 2011 Apple introduced the new iPhone 4S.  One of the new features was the Siri system - a personal assistant.  Siri handles requests in natural language to interact with the user. <br><br>  Apple narrated that Siri <a href="http://www.apple.com/iphone/features/siri-faq.html">sends data to a remote server</a> (probably, therefore, Siri only works over 3G or WiFi).  As soon as our hands got a brand new iPhone 4S, we decided to find out how this thing works. <br><br>  Today, we still managed to break and open the Siri protocol.  As a result, we can now use the Siri recognition engine on any device.  Yes, this means that now anyone can write an application for Android, which will use the very Siri!  Or use Siri on the iPad.  And we want to share our knowledge with you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Demonstration </h4><br>  Probably, this is the most successful demo function for converting speech to text via Siri.  We created a simple sound recording in which the phrase ‚Äúautonomous demo of Siri‚Äù is pronounced (autonomous demo of Siri), and we got a wonderful result! <br><br>  <a href="">Sample_Siri_speech_to_text.zip</a> (70.78K) <br><br>  This sample never went through any iPhone, but despite this, we managed to get Siri to analyze it for us. <br><br><h4>  Digging into the protocol - a brief technical introduction </h4><br>  In Applidium we make mobile apps.  The best way to communicate with a remote server is HTTP, since this protocol works almost everywhere and always, in many ways. <br><br>  The easiest way to intercept HTTP traffic is to create a proxy server controlled by you, configure iPhone to use it, and look at what passes through our proxy.  Thus, we pinned tcpdump to the network gateway, and realized that the Siri traffic was sent over TCP to port 443, on the server 17.174.4.4. <br><br>  Turning to <a href="https://17.174.4.4/">17.174.4.4</a> on the desktop, we noticed that this server provides the certificate guzzoni.apple.com.  So it turned out that Siri was accessing the guzzoni.apple.com server via the HTTPS protocol. <br><br>  As you know, ‚ÄúS‚Äù in HTTPS means ‚Äúsecure‚Äù: all traffic between the client and the server is encrypted with HTTPS.  Therefore, we could not just read it using a sniffer.  In this case, the simplest solution is to fake HTTPS using a fake DNS server, and look at what comes to our server.  The guys behind Siri did everything right: they check that the guzzoni certificate is valid, so you don‚Äôt have to pretend.  Well ... they made a check that it is valid, but you can add your own "root certificate", which will allow you to mark any certificate and make it valid. <br><br>  Therefore, all we needed was to install a custom SSL certificate authority, add it to our iPhone 4S, and sign with our help a purely our fake certificate, like ‚Äúguzzoni.apple.com‚Äù.  And it worked: Siri sent commands to our own HTTPS server!  Looks like someone at Apple missed that detail though. <br><br>  It was then that we realized that the Siri protocol is opaque.  Let's look at the Siri HTTP request.  The request body is binary (we'll talk about this later), and here are the headers: <br><br> <code>ACE /ace HTTP/1.0 <br> Host: guzzoni.apple.com <br> User-Agent: Assistant(iPhone/iPhone4,1; iPhone OS/5.0/9A334) Ace/1.0 <br> Content-Length: 2000000000 <br> X-Ace-Host: 4620a9aa-88f4-4ac1-a49d-e2012910921</code> <br> <br>  Some interesting things you can learn from this: <br><br><ul><li>  The request uses the custom ‚ÄúACE‚Äù method, rather than the more familiar GET. </li><li>  The URL is also requested as ‚Äú/ ace‚Äù. </li><li>  Content-Length is almost 2 GB.  Which obviously does not conform to the HTTP standard. </li><li>  X-Ace-host is a bit like a GUID.  After experimenting with several iPhone 4S, we realized that this value is most likely associated with a real device (very similar to UDID). </li></ul><br><br>  Now let's go to the body.  The body contains raw binary data.  When we first looked at him through the eyes of a hex editor, we noticed that it always started with 0xAACCEE.  It seems to be the headline!  Unfortunately, we did not understand anything of what was after him. <br><br>  That's when we took some time to think.  As people who are engaged in the development of mobile applications, we know;  There is one thing that is very important when it comes to working with the network - it is compression.  The bandwidth is often limited, therefore, as a rule, it is a very good idea to compress everything that we transmit.  And what is the most common library for data compression?  zlib: <a href="http://zlib.net/">zlib.net</a> .  This library is really efficient and powerful (and of course, it is half French!).  Therefore, we tried to pump our binary data through zlib.  But it didn't work out, we lacked a zlib header.  That's when we thought: ‚Äúhmmm, we already have this AACCEE header in the request body.  Maybe there is something else?  ".  We, developers, like to keep data packed.  Three bytes is not a good length for the header.  Let there be four.  Thus, we tried to unpack the data after the fourth byte.  And it worked! <br><br>  Now, when we unpacked the data, we received some new binary data.  It is not very clear how, but some parts of this data were text.  Among them, our attention was drawn to bplist00.  Hooray!  This is probably some kind of binary plist data.  After we played enough with this binary stream, we realized that it consisted of the following parts: <br><br><ul><li>  Parts starting with 0x020000xxxx are ‚Äúplist‚Äù packages, xxxx is the size of the plist binary data followed by a header. </li><li>  Parts starting with 0x030000xxxx are ‚Äúping‚Äù packets sent by the iPhone to Siri servers to maintain the connection.  Here xx is the ping number. </li><li>  Parts beginning with 0x040000xxxx are ‚Äúpong‚Äù packages sent by the Siri server as responses to ping packages.  Similarly, xx is the number of the pong-sequence number. </li></ul><br><br>  Decoding binary plist content is very simple; you can do it on Mac OS X using the ‚Äúplutil‚Äù command (via the command line).  Or in Ruby using the CFPropertyList gem on any other platform. <br><br><h4>  What we learned </h4><br>  We really learned a few interesting things about how the iPhone 4S communicates with Apple servers: <br><br><h5>  Audio data </h5><br>  The iPhone 4S does send raw audio to the server.  It is compressed with the <a href="http://www.speex.org/">Speex</a> audio codec, which makes sense because this codec is specifically designed for VoIP. <br><br><h5>  Identification </h5><br>  The iPhone 4S sends ids everywhere.  So if you want to use Siri on a different device, you still have to have the ID of at least one iPhone 4S.  Of course, we will not publish ours, but it is very easy to get it using the tools we have already written about.  Of course, Apple can in theory blacklist the identifier, but as long as you use it for personal use, everything should be fine. <br><br><h5>  Actual content </h5><br>  The protocol is, in fact, very, very talkative.  Your iPhone sends tons of things to the Apple server.  And these servers respond to him with an incredible amount of information.  For example, when you use text-to-speech, the Apple server even sends a trust rating and timestamp for each word. <br><br><h4>  What's next? </h4><br>  <a href="https://github.com/applidium/Cracking-Siri">Here is a collection of tools</a> that we wrote to help us understand the protocol.  They are written mainly in Ruby (because it is an amazingly simple language), some parts in C, and some in Objective-C.  Their development is not really finished, but this should be sufficient for those who can technically write a Siri application. <br><br>  Let's see what fun things you do with Siri!  And let's see how long Apple will need to change their security policy. </div><p>Source: <a href="https://habr.com/ru/post/132652/">https://habr.com/ru/post/132652/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132645/index.html">Flash / Flex and Silverlight go away. When do I need to go to HTML5?</a></li>
<li><a href="../132646/index.html">Design patterns for Android development. Part 4 - Saving data. Domain Model, Repository, Singleton and BDD</a></li>
<li><a href="../132648/index.html">Want to build a successful software business?</a></li>
<li><a href="../132650/index.html">We invite you to a series of Windows Phone 7 Student Camps in different cities of Russia</a></li>
<li><a href="../132651/index.html">Proactive approach</a></li>
<li><a href="../132653/index.html">Error time zone for Ukraine in the calendar. Do not miss the meeting!</a></li>
<li><a href="../132654/index.html">Moment.js: easy work with dates</a></li>
<li><a href="../132655/index.html">Sony Ericsson has confirmed the upgrade of the entire line of Xperia to Android 4.0</a></li>
<li><a href="../132656/index.html">In each .net application, memory is reserved for three exceptions.</a></li>
<li><a href="../132657/index.html">Other startups or ThinkQuest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>