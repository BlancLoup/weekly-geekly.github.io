<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Single page wordpress plugin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why do people love wordpress? Because it's easy to work with him. It does not have the flexibility of great CMS like Joomla and Drupal, which means yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Single page wordpress plugin</h1><div class="post__text post__text-html js-mediator-article">  Why do people love wordpress?  Because it's easy to work with him.  It does not have the flexibility of great CMS like Joomla and Drupal, which means you won‚Äôt get confused.  And it is also very popular - which means you can find plug-ins for all occasions. <br><br>  Not for nothing, <a href="http://lurkmore.to/CMS">despite the condemnation of Lurkmore.ru</a> , Wordpress is used by the <a href="http://herbsutter.com/">Coat of Arms of Sutter</a> , <a href="http://www.markshuttleworth.com/">Mark Shuttleworth</a> , and many more.  For example me. <br><br>  I often refer to other blogs in my posts.  And I got the idea - why not show next to the nickname of the person to whom I refer, also the icon of his service?  For example, a bird from Twitter or a letter B from blogspot?  Similar functionality exists, for example, on Wikipedia, and many blog hosting sites allow it (for example, Dreamwidth). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is how the wordpress plugin for <em>Rikki's WP Social Icons</em> was born.  Allows for one click to add a link to an account in any service, from a social network to GitHub. <br><a name="habracut"></a><br><h1>  What for? </h1><br>  There are many articles on how to write plugins for Wordpress correctly, but not one of them contained a word about the bugs I encountered in the process.  Therefore, I write down my impressions - all of a sudden someone will face the same thing, but he does not know how to decide.  And I point out all the improvements that are usually omitted in the training examples. <br><br>  During the work, I used quite a lot of source codes of other plug-ins, as well as Jenyay developments (references to his series of articles are given in the appendix).  But the "artisanal" implementation was not enough.  Plugin is so convenient that every end user can modify it himself.  So, you need to do so to add to it the support of a new service was a matter of five minutes and one reinstallation. <br><br>  Especially it helped that I was going to use this plugin <i>myself</i> (i.e., <i>eat dog food</i> , as our American colleagues say).  And it was my agony with the first sketches that prompted me where and what could be improved. <br><br><h1>  We program </h1><br><h2>  We design </h2><br>  To begin with, writing wordpress plugins is not <em>easy</em> , but <em>very simple</em> .  You do not need to create any classes from something inherited from there, nor to subjugate with the formats, nor follow any tricky specifications.  ‚ÄúEvents‚Äù are rendered into special objects that work approximately as event-s in ‚Äúlarge‚Äù applications. <br><br>  First you need to think carefully about what we need.  And we need a way to mark individual words, which would be visible when editing, and was automatically converted into a link in posts, pages and RSS. <br><br>  Shortcode works very well - a special tag surrounded by square brackets and specially sharpened for processing by plugins.  They also appeared in version 2.5, which was released back in 2008, so there are no special compatibility problems. <br><br>  What format should we accept from the user?  Because  the final HTML code will differ only in the icon and url th, it would be logical to have one shortcode and one function that would process it.  Additional information can be passed through the parameters, which is very convenient.  In addition, the less shortcodes we create, the less chance that we will come into conflict with some other plugin. <br><br>  My shortcode looked like this: <br><br>  [userid] <br><br>  Its parameters are: <br><br>  'id' is an optional parameter.  id, under which our hero is registered on the service.  For example.  torvalds-family. <br><br>  'type'- service <br><br>  'url' is an optional parameter.  the url we want to refer to (for example, a profile or some kind of separate blog post). <br><br>  And use it like this: <br><br> <code>[userid type="blogspot" id="torvalds-family"]Linus Torvalds[/userid] <br></code> <br><br>  or so: <br><br> <code>[userid type="blogspot" url="http://blogspot.com"]blogspot[/userid] <br></code> <br><br><h2>  We write the core </h2><br><br>  Now we create the structure for our plugin (see <a href="https://github.com/rikkimongoose/rikkis-wp-social-icons">on GitHub</a> ) and throw in our miniature kernel in rikkis-wp-social-icons.php: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">socialusers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $options = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"blogspot"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.blogspot.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"ljuser"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.livejournal.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"ljcomm"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://livejournal.com/community/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"liruboy"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://www.liveinternet.ru/users/%s/"</span></span>, <span class="hljs-string"><span class="hljs-string">"lirugirl"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://www.liveinternet.ru/users/%s/"</span></span>, <span class="hljs-string"><span class="hljs-string">"vk"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://vk.com/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"twitter"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://twitter.com/#!/%s/"</span></span>, <span class="hljs-string"><span class="hljs-string">"facebook"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://www.facebook.com/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"google_plus"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"https://plus.google.com/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"wordpress"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.wordpress.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"habrahabr"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.habrahabr.ru/"</span></span>, <span class="hljs-string"><span class="hljs-string">"github"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://github.com/users/%s/"</span></span> ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socialusers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!function_exists (<span class="hljs-string"><span class="hljs-string">'add_shortcode'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; add_shortcode(<span class="hljs-string"><span class="hljs-string">'userid'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (&amp;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-string"><span class="hljs-string">'icon_func'</span></span>) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">icon_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($atts, $content=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$content) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; extract( shortcode_atts ( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>), $atts ) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$type || !array_key_exists($type, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;options) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $content; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) $id = $content; $userinfo_url = esc_url(($url) ? $url : sprintf(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;options[$type], trim($id))); $userpic_url = esc_url(plugins_url( <span class="hljs-string"><span class="hljs-string">"js/img/$type.gif"</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;span style='white-space: nowrap; display: inline !important;'&gt;&lt;a href='$userinfo_url' ref='nofollow'&gt;&lt;img src='$userpic_url' alt='[info]' width='17' height='17' style='vertical-align: bottom; border: 0; padding-right: 1px;vertical-align:middle; margin-left: 0; margin-top: 0; margin-right: 0; margin-bottom: 0;' /&gt;&lt;/a&gt;&lt;a href='$userinfo_url' ref='nofollow'&gt;&lt;b&gt;$content&lt;/b&gt;&lt;/a&gt;&lt;/span&gt;"</span></span>; } } $socialusers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> socialusers();</code> </pre><br><br>  To avoid the conflict of variable names, we put all our challenges in one class socialusers.  The options variable stores the id and URLs of the services we are going to refer to, replacing the username with% s.  In the js / img folder we put gif-ki with the corresponding icons. <br><br>  In the constructor, we check if Wordpress supports shortcode, and, if not, we don‚Äôt do anything.  It is not good for a user to fall down Wordpress just because he uses the old version. <br><br>  If everything is in order, we add a new shortcode, indicating the function icon_func from the same class instance as a handler. <br><br>  icon_func - it is very short and very interesting.  It comes with 2 parameters: <br><br>  $ atts - an array of attributes <br>  $ content - text between tags <br><br>  The user will see instead of shortcode what this function returns.  It is here (in the last return) that the final code of our block is formed. <br><br>  According to the advice from the comments, all the incoming ‚Äúlines‚Äù are checked via esc_url so that there are no security holes. <br><br>  Two lines are noteworthy: <br><pre> <code class="php hljs">extract( shortcode_atts ( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>), $atts ) ); &lt;/&lt;source&gt;     $atts       &lt;source lang=<span class="hljs-string"><span class="hljs-string">"php"</span></span>&gt; plugins_url( <span class="hljs-string"><span class="hljs-string">"js/img/$type.gif"</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span> );</code> </pre><br><br>  Gets url icons by type, relative to the current directory.  This is what the __FILE__ attribute is for.  If it does not exist (and the authors of some plugins and examples have clearly not heard of it), then you have to insert the name of the plug-in directory and still it may not work. <br><br>  Equally important is trim () for $ id.  The fact is that if you double-click on a word in the Wordpress editor, it will highlight the <i>word along with the space after it</i> .  As a result, we will get the name of the account with a completely inappropriate space and the link will not work. <br><br>  In principle, already in this form (17 lines of code + 14 lines of settings) our plugin can be installed and used.  A real hacker despises window interfaces :).  You can try to pack php and pictures in zip and install them in wordpress, as a regular plugin installs. <br><br>  I highly recommend setting up local Apache + PHP + mySQL for such experiments, and Wordpress in addition to them.  Debugging will go much more fun - for example, instead of installing-reinstalling, you can simply replace the files in the appropriate directory. <br><br><h2>  Add buttons </h2><br><br>  A separate component <a href="http://www.tinymce.com/">tinyMCE</a> is responsible for editing posts and pages in Wordpress.  To pull it from the main PHP, you need to slightly expand our original form: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">socialusers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $options = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"blogspot"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.blogspot.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"ljuser"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.livejournal.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"ljcomm"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://livejournal.com/community/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"liruboy"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://www.liveinternet.ru/users/%s/"</span></span>, <span class="hljs-string"><span class="hljs-string">"lirugirl"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://www.liveinternet.ru/users/%s/"</span></span>, <span class="hljs-string"><span class="hljs-string">"vk"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://vk.com/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"twitter"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://twitter.com/#!/%s/"</span></span>, <span class="hljs-string"><span class="hljs-string">"facebook"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://www.facebook.com/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"google_plus"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"https://plus.google.com/%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"wordpress"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.wordpress.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"habrahabr"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://%s.habrahabr.ru/"</span></span>, <span class="hljs-string"><span class="hljs-string">"github"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://github.com/users/%s/"</span></span> ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socialusers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!function_exists (<span class="hljs-string"><span class="hljs-string">'add_shortcode'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; add_shortcode(<span class="hljs-string"><span class="hljs-string">'userid'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (&amp;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-string"><span class="hljs-string">'icon_func'</span></span>) ); add_filter( <span class="hljs-string"><span class="hljs-string">'mce_buttons_3'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-string"><span class="hljs-string">'mce_buttons'</span></span>) ); add_filter( <span class="hljs-string"><span class="hljs-string">'mce_external_plugins'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-string"><span class="hljs-string">'mce_external_plugins'</span></span>) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">icon_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($atts, $content=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$content) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; extract( shortcode_atts ( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>), $atts ) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$type || !array_key_exists($type, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;options) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $content; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) $id = $content; $userinfo_url = esc_url(($url) ? $url : sprintf(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;options[$type], trim($id))); $userpic_url = esc_url(plugins_url( <span class="hljs-string"><span class="hljs-string">"js/img/$type.gif"</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;span style='white-space: nowrap; display: inline !important;'&gt;&lt;a href='$userinfo_url' ref='nofollow'&gt;&lt;img src='$userpic_url' alt='[info]' width='17' height='17' style='vertical-align: bottom; border: 0; padding-right: 1px;vertical-align:middle; margin-left: 0; margin-top: 0; margin-right: 0; margin-bottom: 0;' /&gt;&lt;/a&gt;&lt;a href='$userinfo_url' ref='nofollow'&gt;&lt;b&gt;$content&lt;/b&gt;&lt;/a&gt;&lt;/span&gt;"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mce_external_plugins</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($plugin_array)</span></span></span><span class="hljs-function"> </span></span>{ $plugin_array[<span class="hljs-string"><span class="hljs-string">'rikkisocialicons'</span></span>] = plugins_url (<span class="hljs-string"><span class="hljs-string">'js/rikkis-wp-social-icons-editor_plugin.js'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $plugin_array; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mce_buttons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($buttons)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_merge($buttons, array_keys(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;options)); } } $socialusers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> socialusers();</code> </pre><br><br>  Everything is simple here - mce_external_plugins loads JavaScript, in which it will generate buttons, and mce_buttons puts all the keys from the options dictionary there. <br><br>  Now we have to write JavaScript for the buttons.  Alas, tinyMCE is embedded in Wordpress so firmly that the <a href="http://ottopress.com/2010/passing-parameters-from-php-to-javascripts-in-plugins/">standard way to transfer parameters from PHP to JavaScript for Wordpress plugins</a> will not work here.  Of course, one could try to get them through JSon and make sure that the correction needs to be made really <i>only in one place</i> .  But this is the case when a <i>minor</i> convenience can cause <i>significant</i> problems. <br><br>  The framing of the tinyMCE plugin is pretty standard: <br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ tinymce.create(<span class="hljs-string"><span class="hljs-string">'tinymce.plugins.RikkiSocialIconsPlugin'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">init</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ed, url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   } }, getInfo : function() { return { //   ,     }; } }); tinymce.PluginManager.add('rikkisocialicons', tinymce.plugins.RikkiSocialIconsPlugin); })();</span></span></code> </pre><br><br>  Adding one button that frames a selected text fragment with some kind of our shortcode tag looks like this: <br><br><pre> <code class="javascript hljs">ed.addCommand(<span class="hljs-string"><span class="hljs-string">'mce-blogspot'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newcontent = <span class="hljs-string"><span class="hljs-string">'[userid type="blogspot"]'</span></span> + tinyMCE.activeEditor.selection.getContent({<span class="hljs-attr"><span class="hljs-attr">format</span></span> : <span class="hljs-string"><span class="hljs-string">'raw'</span></span>}) + <span class="hljs-string"><span class="hljs-string">'[/userid]'</span></span>; tinyMCE.activeEditor.selection.setContent(newcontent); }); ed.addButton(<span class="hljs-string"><span class="hljs-string">'blogspot'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">title</span></span> : <span class="hljs-string"><span class="hljs-string">'blogspot'</span></span>, md : <span class="hljs-string"><span class="hljs-string">'mce-blogspot'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span> : url + <span class="hljs-string"><span class="hljs-string">'/img/blogspot.gif'</span></span> });</code> </pre><br><br>  Of course, a user who has become accustomed to the fact that our plugin is setting itself up will want to try to generate buttons in a loop: <br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ tinymce.create(<span class="hljs-string"><span class="hljs-string">'tinymce.plugins.RikkiSocialIconsPlugin'</span></span>, { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newButtons = [<span class="hljs-string"><span class="hljs-string">"ljuser"</span></span>, <span class="hljs-string"><span class="hljs-string">"ljcomm"</span></span>, <span class="hljs-string"><span class="hljs-string">"liruman"</span></span>, <span class="hljs-string"><span class="hljs-string">"lirugirl"</span></span>, <span class="hljs-string"><span class="hljs-string">"ljr"</span></span>, <span class="hljs-string"><span class="hljs-string">"vk"</span></span>, <span class="hljs-string"><span class="hljs-string">"twitter"</span></span>]; tinymce.create(<span class="hljs-string"><span class="hljs-string">'tinymce.plugins.LjusersPlugin'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">init</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ed, url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newButtonsLength = newButtons.length, i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; newButtonsLength){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemTitle = newButtons[i]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemCommand = <span class="hljs-string"><span class="hljs-string">'mce'</span></span>+itemTitle; ed.addCommand(itemCommand, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newcontent = <span class="hljs-string"><span class="hljs-string">'[userid type="'</span></span>+itemTitle+<span class="hljs-string"><span class="hljs-string">'"]'</span></span> + tinyMCE.activeEditor.selection.getContent({<span class="hljs-attr"><span class="hljs-attr">format</span></span> : <span class="hljs-string"><span class="hljs-string">'raw'</span></span>}) + <span class="hljs-string"><span class="hljs-string">'[/userid]'</span></span>; tinyMCE.activeEditor.selection.setContent(newcontent); }); ed.addButton(itemTitle, { <span class="hljs-attr"><span class="hljs-attr">title</span></span> : itemTitle, <span class="hljs-attr"><span class="hljs-attr">cmd</span></span> : itemCommand, <span class="hljs-attr"><span class="hljs-attr">image</span></span> : url + <span class="hljs-string"><span class="hljs-string">'/img/'</span></span>+itemTitle+<span class="hljs-string"><span class="hljs-string">'.gif'</span></span> }); i++; } }, <span class="hljs-attr"><span class="hljs-attr">getInfo</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">longname</span></span> : <span class="hljs-string"><span class="hljs-string">'Rikki\'s WP Social Icons'</span></span>, <span class="hljs-attr"><span class="hljs-attr">author</span></span> : <span class="hljs-string"><span class="hljs-string">'Rikki Mongoose'</span></span>, <span class="hljs-attr"><span class="hljs-attr">authorurl</span></span> : <span class="hljs-string"><span class="hljs-string">'http://rikkimongoose.ru'</span></span>, <span class="hljs-attr"><span class="hljs-attr">infourl</span></span> : <span class="hljs-string"><span class="hljs-string">'http://rikkimongoose.ru/projects/rikkis-wp-social-icons/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">version</span></span> : <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> }; } }); tinymce.PluginManager.add(<span class="hljs-string"><span class="hljs-string">'rikkisocialicons'</span></span>, tinymce.plugins.RikkiSocialIconsPlugin); })();</code> </pre><br><br>  And that's right - shouldn't robots work for a programmer? <br><br>  If you generate the buttons in this way, and then go to the editor, you will immediately feel pride in your skill.  The buttons indicated in the array are lined up in a row, and on each one is the same icon that the site visitor or RSS feed reader will see.  Very comfortably! <br><br>  This code looks great, but it has only one drawback - it <b>does not work</b> .  This is the <b>first bug</b> that traps you in tinyMCE.  At first glance, the buttons look very ordinary - but if you click on them, it turns out that <i>each of them inserts a shortcode with the last element</i> - in our case, with twitter. <br><br>  We'll have to write everything by <s>hand</s> through the circuit, as suggested in the comments.  Like this: <br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newButtons = [<span class="hljs-string"><span class="hljs-string">"ljuser"</span></span>, <span class="hljs-string"><span class="hljs-string">"google_plus"</span></span>, <span class="hljs-string"><span class="hljs-string">"wordpress"</span></span>, <span class="hljs-string"><span class="hljs-string">"habrahabr"</span></span>, <span class="hljs-string"><span class="hljs-string">"github"</span></span>]; tinymce.create(<span class="hljs-string"><span class="hljs-string">'tinymce.plugins.RikkiSocialIconsPlugin'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">init</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ed, url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> newButtons) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemTitle = newButtons[i]; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">itemTitle</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemCommand = <span class="hljs-string"><span class="hljs-string">'mce'</span></span>+itemTitle; ed.addCommand(itemCommand, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newcontent = <span class="hljs-string"><span class="hljs-string">'[userid type="'</span></span>+itemTitle+<span class="hljs-string"><span class="hljs-string">'"]'</span></span> + tinyMCE.activeEditor.selection.getContent({<span class="hljs-attr"><span class="hljs-attr">format</span></span> : <span class="hljs-string"><span class="hljs-string">'raw'</span></span>}) + <span class="hljs-string"><span class="hljs-string">'[/userid]'</span></span>; tinyMCE.activeEditor.selection.setContent(newcontent); }); ed.addButton(itemTitle, { <span class="hljs-attr"><span class="hljs-attr">title</span></span> : itemTitle, <span class="hljs-attr"><span class="hljs-attr">cmd</span></span> : itemCommand, <span class="hljs-attr"><span class="hljs-attr">image</span></span> : url + <span class="hljs-string"><span class="hljs-string">'/img/'</span></span>+itemTitle+<span class="hljs-string"><span class="hljs-string">'.gif'</span></span> }); })(itemTitle); } }, <span class="hljs-attr"><span class="hljs-attr">getInfo</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">longname</span></span> : <span class="hljs-string"><span class="hljs-string">'Rikki\'s WP Social Icons'</span></span>, <span class="hljs-attr"><span class="hljs-attr">author</span></span> : <span class="hljs-string"><span class="hljs-string">'Rikki Mongoose'</span></span>, <span class="hljs-attr"><span class="hljs-attr">authorurl</span></span> : <span class="hljs-string"><span class="hljs-string">'http://rikkimongoose.ru'</span></span>, <span class="hljs-attr"><span class="hljs-attr">infourl</span></span> : <span class="hljs-string"><span class="hljs-string">'http://rikkimongoose.ru/projects/rikkis-wp-social-icons/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">version</span></span> : <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> }; } }); tinymce.PluginManager.add(<span class="hljs-string"><span class="hljs-string">'rikkisocialicons'</span></span>, tinymce.plugins.RikkiSocialIconsPlugin); })();</code> </pre><br><br>  Testing has shown that this option works fine.  Glory to the commentators! <br><br>  This option is already much better - each button knows its place and works as it should. <br><br>  Finally, there is a <b>second bug</b> that depends solely on you.  And, although Wordpress, tinyMCE and even Internet Explorer are to blame except for not very convenient error handling, it can spoil a lot of blood for you. <br><br>  A possible error concerns the function tinymce.PluginManager.add (param1, param2).  Please write it <b>very carefully</b> . <br><br>  <b>param1</b> must match the key to which we added the id array of new buttons in our php file.  In my case there should be ' <i>rikkisocialicons</i> ' (because in PHP we have $ plugin_array [' <i>rikkisocialicons</i> ']). <br>  <b>param2</b> must match what is being created via tinymce.create ().  In my case, it is tinymce.plugins.RikkiSocialIconsPlugin, (because we have written in the script tinymce.create (' <i>tinymce.plugins.RikkiSocialIconsPlugin</i> ') <br><br>  If any of this doesn‚Äôt match, your editor‚Äôs panel will have a panel with buttons, and the console will report the error ' <i>k is undefined</i> ' that occurred ... of course, in compressed jQuery.min.js, so neither debugging nor watch call will not be the slightest opportunity. <br><br><h2>  How to add an icon for service X? </h2><br>  First, it's a good idea to go <a href="https://github.com/rikkimongoose/rikkis-wp-social-icons">to GitHub</a> and see - has suddenly appeared a fork with the desired icon?  If not, then we save ourselves. <br><ol><li>  Save it in gif format in the same directory as the rest of the icons </li><li>  We add one more parameter to $ options, where the key matches the name of gif, and the URL is with the url that needs to be substituted, and the user name is replaced with% s (taking this opportunity, send my regards to all C ++ programmers who are in this place sure to experience nostalgia). </li><li>  If you want a button to go to JavaScript, add an element with the same id to the array newButtons </li><li>  Pack everything in ZIP </li><li>  Disable and remove the old version of the plugin.  Do not worry, shortcode in your posts will not be affected. </li><li>  Download the updated version, activate it and enjoy </li></ol><br><br>  The order of the buttons depends on the order in the PHP file. <br><br><h1>  That's all! </h1><br><br>  The plugin <a href="http://wordpress.org/extend/plugins/rikkis-wp-social-icons/">is in the Wordpress directory</a> .  In the same place, or <a href="https://github.com/rikkimongoose/rikkis-wp-social-icons/">on GitHub</a> , you can please the author, having informed that now your stand-alone blog is also decorated with fashionable icons.  And you can also add a project with icons of dreamwidth or some other xanga. <br><br><h1>  Add to catalog </h1><br><br>  The last step is to add the plugin to the Wordpress directory so that it can be found by a standard search. <br><br>  Of course, you need to remember to add pre-readme.txt and standard comments in the header of the plugin.  Otherwise, the user will not be able to find out what he puts. <br><br>  The whole procedure is described in detail in a <a href="http://digwp.com/2010/03/add-plugin-to-wordpress-plugin-repository/">large English manual</a> . <br><br>  And for those who can not wait - here is a short step by step guide: <br><br><ol><li>  Go to <a href="http://wordpress.org/">wordpress.org</a> and create an account there </li><li>  Get the password.  Go under it and go to <a href="http://wordpress.org/extend/plugins/add/">the add plugin page</a> .  Throw a link to the ZIP there, write the name and description, and send Post. </li><li>  Now you have to wait.  The plug-in from the manual was reviewed at 18 o'clock, with my time was set at 4:00. When the review was over and everything turned out, an <i>empty</i> SVN-directory will appear on the server in which you will need to upload your project </li><li>  Create a folder locally, checkout there and copy our plug-in to trunc.  <b>Compressing the ZIP is not necessary</b> - after a commit, the trunc script on the server will compress everything automatically. </li><li>  We commit. </li><li>  Go to the page <a href="http://wordpress.org/extend/plugins/rikkis-wp-social-icons/">http://wordpress.org/extend/plugins/rikkis-wp-social-icons/</a> .  Instead of rikkis-wp-social-icons, substitute the name of your plugin. </li><li>  Go to the page <a href="http://wordpress.org/extend/plugins/">http://wordpress.org/extend/plugins/</a> and look carefully at the list of Newest Plugins.  Here it is, our handsome! </li></ol><br><br>  If something is not working - refer to the large manual.  Everything is very detailed there. <br><br><h1>  see also </h1><br><ol><li>  <a href="http://wordpress.org/extend/plugins/rikkis-wp-social-icons/">In the wordpress directory</a> </li><li>  <a href="https://github.com/rikkimongoose/rikkis-wp-social-icons/">Official representation on GitHub</a> </li><li>  <a href="">Download from GitHub</a> </li><li>  Original article from Jenyay - <a href="http://jenyay.net/Programming/WPPlugins1">part 1</a> , <a href="http://jenyay.net/Programming/WPPlugins2">part 2</a> , <a href="http://jenyay.net/Programming/WPPlugins3">part 3</a> . </li></ol><br><br>  The author will be grateful to everyone who takes patronage over the github version of the project and will develop it further. <br></div><p>Source: <a href="https://habr.com/ru/post/147699/">https://habr.com/ru/post/147699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147694/index.html">Rovio has released a new game Amazing Alex for iOS and Android</a></li>
<li><a href="../147695/index.html">trrtrr.net: Open IP Telephony Seminars</a></li>
<li><a href="../147696/index.html">"Dialogue 2012": competition in analyzing the tonality of texts and the competition of syntactic analyzers</a></li>
<li><a href="../147697/index.html">Windows Store Economics and Developer Opportunities</a></li>
<li><a href="../147698/index.html">Setting up email alerts for various system events</a></li>
<li><a href="../147701/index.html">Next-generation Xbox can probably be upgraded</a></li>
<li><a href="../147704/index.html">Aftershock: how we will live after the notorious bill. Tips experienced</a></li>
<li><a href="../147705/index.html">On Google+, you can now combine normal and work profiles.</a></li>
<li><a href="../147706/index.html">Digg site bought for $ 500 thousand</a></li>
<li><a href="../147707/index.html">SOLUTIONS FOR KYOCERA SAFETY</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>