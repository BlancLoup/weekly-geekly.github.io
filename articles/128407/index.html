<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with a three-phase synchronous motor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It happened to me, by the nature of my activity, to write a program for overclocking the promotion and control of a three-phase synchronous motor . Ne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with a three-phase synchronous motor</h1><div class="post__text post__text-html js-mediator-article">  It happened to me, by the nature of my activity, to write a program for <s>overclocking the</s> promotion and control of a three-phase <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25BD%25D1%2585%25D1%2580%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25B0%25D1%2588%25D0%25B8%25D0%25BD%25D0%25B0">synchronous motor</a> .  Next, I will try to describe in detail how I implemented it. <br><br><a name="habracut"></a>  The engine spin chart looks like this: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/f35/8f7/f17/f358f7f17247e5542d4e7aebcde8e75e.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, it is necessary not only to increase the frequency, but also the amplitude, and it does not grow from zero, but from 4 volts and at a frequency of 80 Hz, should reach its maximum.  Well, because  it is a three-phase motor, then there should be 3 sinusoids, moreover, shifted relative to each other by 120 degrees.  Also, an additional condition was that at 80 Hz the engine would exit no less than 30s, so I decided to use a second per hertz (100 Hz is achieved for 100s). <br><br>  In the controller with which I work there is just 3 <a href="http://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B8%25D1%2580%25D0%25BE%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25B8%25D0%25BC%25D0%25BF%25D1%2583%25D0%25BB%25D1%258C%25D1%2581%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">PWMs</a> and I decided to use them, and not <s>bother</s> to mess with external DACs. <br><br>  The first problem I encountered is that the signal from the PWM output will only be positive, i.e.  the sinusoid will be above zero, for this it was necessary to break it into half-waves and build them separately.  This is what a sine wave will look like with a minimum amplitude. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/656/78d/a3b/65678da3b5e0fc529f12f95e0c5c1d0b.png" alt="image"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c68/d59/776/c68d59776549d4427171858060d9e45f.png" alt="image"><br><br>  But at the maximum. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/099/4a3/304/0994a330446feb1d45547730c4fc9486.png" alt="image"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/050/b8e/40a/050b8e40a662e6d9aa93ba369c23e71a.png" alt="image"><br><br>  to get a positive half wave: <br><pre><code class="cpp hljs">DCH = <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>[ptrA]; DCH = DCH + <span class="hljs-number"><span class="hljs-number">128</span></span>;</code> </pre> <br>  negative: <br><pre> <code class="cpp hljs">DCH = <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>[ptrA]; DCH = <span class="hljs-number"><span class="hljs-number">128</span></span> - DCH;</code> </pre><br>  As can be seen from the following figure, now my sine wave is spinning near the value 128, now it is enough to shift the signal by hardware and set the zero to 128 and it will become bipolar. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/332/6ee/322/3326ee322e839a9b91cd84c17ef36b0e.png" alt="image"><br><br>  Sinusoid consists of 128 points, this is more than enough.  After the low-pass filter is almost perfectly smooth.  The amplitude also grows rather smoothly (the coefficient table consists of 80 values), multiply by the value from the table and discard the low byte: <br><br><pre> <code class="cpp hljs">ampS = amp[fctr]; DCH = DCH*ampS; DCH = DCH&gt;&gt;<span class="hljs-number"><span class="hljs-number">8</span></span>;</code> </pre><br>  To increase the frequency, I used the 16-bit timer TMR0, the value of its period is taken from a table that consists of 100 values ‚Äã‚Äã(from 1 to 100 Hz).  The formula for the calculation is as follows: <b>65535-sec / clk / smpl / Hz</b> , where Hz varies from 1 to 100. <br><ul><li>  65535 - the maximum value of the 16-bit timer </li><li>  sec - 1s in nanoseconds, a value of 1,000,000,000 </li><li>  clk - duration of 1 clock cycle in nanoseconds, with quartz at 32 MHz is 125 </li><li>  smpl - the number of points per period, a value of 128 </li></ul><br>  The program was developed for the PIC17 microcontroller using the <a href="http://www.bknd.com/cc7a/index.shtml">CC7A</a> compiler of the Norwegian company B Knudsen Data. <br><br>  Here, in fact, a table of values ‚Äã‚Äãfor the timer. <br><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CDATA_START 0x300 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> cdata[CDATA_START] #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> cdata[] = 0x153B, 0x8A9D, 0xB1BE, 0xC54E, 0xD10B, 0xD8DE, 0xDE75, 0xE2A7, 0xE5E9, 0xE885, 0xEAA7, 0xEC6F, 0xEDF0, 0xEF3A, 0xF058, 0xF153, 0xF230, 0xF2F4, 0xF3A4, 0xF442, 0xF4D1, 0xF553, 0xF5CA, 0xF637, 0xF69B, 0xF6F7, 0xF74D, 0xF79D, 0xF7E7, 0xF82C, 0xF86C, 0xF8A9, 0xF8E2, 0xF917, 0xF94A, 0xF97A, 0xF9A7, 0xF9D1, 0xF9FA, 0xFA21, 0xFA45, 0xFA68, 0xFA89, 0xFAA9, 0xFAC7, 0xFAE4, 0xFB00, 0xFB1B, 0xFB34, 0xFB4D, 0xFB65, 0xFB7B, 0xFB91, 0xFBA6, 0xFBBA, 0xFBCE, 0xFBE1, 0xFBF3, 0xFC04, 0xFC15, 0xFC26, 0xFC36, 0xFC45, 0xFC54, 0xFC62, 0xFC70, 0xFC7E, 0xFC8B, 0xFC98, 0xFCA4, 0xFCB1, 0xFCBC, 0xFCC8, 0xFCD3, 0xFCDE, 0xFCE8, 0xFCF2, 0xFCFC, 0xFD06, 0xFD10, 0xFD19, 0xFD22, 0xFD2B, 0xFD34, 0xFD3C, 0xFD44, 0xFD4C, 0xFD54, 0xFD5C, 0xFD63, 0xFD6B, 0xFD72, 0xFD79, 0xFD80, 0xFD86, 0xFD8D, 0xFD93, 0xFD9A, 0xFDA0, 0xFDA6</span></span></code> </pre><br><br>  2 more tables with sine values ‚Äã‚Äãand amplitude coefficients, respectively. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>[<span class="hljs-number"><span class="hljs-number">128</span></span>]= { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">43</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">85</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">109</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>, <span class="hljs-number"><span class="hljs-number">119</span></span>, <span class="hljs-number"><span class="hljs-number">121</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">121</span></span>, <span class="hljs-number"><span class="hljs-number">119</span></span>, <span class="hljs-number"><span class="hljs-number">117</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">109</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">85</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span>, <span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">43</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">43</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">85</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">109</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>, <span class="hljs-number"><span class="hljs-number">119</span></span>, <span class="hljs-number"><span class="hljs-number">121</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">121</span></span>, <span class="hljs-number"><span class="hljs-number">119</span></span>, <span class="hljs-number"><span class="hljs-number">117</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">109</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">85</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span>, <span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">43</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> amp[<span class="hljs-number"><span class="hljs-number">80</span></span>]= { <span class="hljs-number"><span class="hljs-number">86</span></span>, <span class="hljs-number"><span class="hljs-number">88</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">93</span></span>, <span class="hljs-number"><span class="hljs-number">95</span></span>, <span class="hljs-number"><span class="hljs-number">97</span></span>, <span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">103</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>, <span class="hljs-number"><span class="hljs-number">108</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">114</span></span>, <span class="hljs-number"><span class="hljs-number">116</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>, <span class="hljs-number"><span class="hljs-number">121</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">129</span></span>, <span class="hljs-number"><span class="hljs-number">131</span></span>, <span class="hljs-number"><span class="hljs-number">133</span></span>, <span class="hljs-number"><span class="hljs-number">136</span></span>, <span class="hljs-number"><span class="hljs-number">138</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>, <span class="hljs-number"><span class="hljs-number">142</span></span>, <span class="hljs-number"><span class="hljs-number">144</span></span>, <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">151</span></span>, <span class="hljs-number"><span class="hljs-number">153</span></span>, <span class="hljs-number"><span class="hljs-number">155</span></span>, <span class="hljs-number"><span class="hljs-number">157</span></span>, <span class="hljs-number"><span class="hljs-number">159</span></span>, <span class="hljs-number"><span class="hljs-number">161</span></span>, <span class="hljs-number"><span class="hljs-number">164</span></span>, <span class="hljs-number"><span class="hljs-number">166</span></span>, <span class="hljs-number"><span class="hljs-number">168</span></span>, <span class="hljs-number"><span class="hljs-number">170</span></span>, <span class="hljs-number"><span class="hljs-number">172</span></span>, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">176</span></span>, <span class="hljs-number"><span class="hljs-number">179</span></span>, <span class="hljs-number"><span class="hljs-number">181</span></span>, <span class="hljs-number"><span class="hljs-number">183</span></span>, <span class="hljs-number"><span class="hljs-number">185</span></span>, <span class="hljs-number"><span class="hljs-number">187</span></span>, <span class="hljs-number"><span class="hljs-number">189</span></span>, <span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">194</span></span>, <span class="hljs-number"><span class="hljs-number">196</span></span>, <span class="hljs-number"><span class="hljs-number">198</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">202</span></span>, <span class="hljs-number"><span class="hljs-number">204</span></span>, <span class="hljs-number"><span class="hljs-number">207</span></span>, <span class="hljs-number"><span class="hljs-number">209</span></span>, <span class="hljs-number"><span class="hljs-number">211</span></span>, <span class="hljs-number"><span class="hljs-number">213</span></span>, <span class="hljs-number"><span class="hljs-number">215</span></span>, <span class="hljs-number"><span class="hljs-number">217</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">222</span></span>, <span class="hljs-number"><span class="hljs-number">224</span></span>, <span class="hljs-number"><span class="hljs-number">226</span></span>, <span class="hljs-number"><span class="hljs-number">228</span></span>, <span class="hljs-number"><span class="hljs-number">230</span></span>, <span class="hljs-number"><span class="hljs-number">232</span></span>, <span class="hljs-number"><span class="hljs-number">235</span></span>, <span class="hljs-number"><span class="hljs-number">237</span></span>, <span class="hljs-number"><span class="hljs-number">239</span></span>, <span class="hljs-number"><span class="hljs-number">241</span></span>, <span class="hljs-number"><span class="hljs-number">243</span></span>, <span class="hljs-number"><span class="hljs-number">245</span></span>, <span class="hljs-number"><span class="hljs-number">247</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">252</span></span>, <span class="hljs-number"><span class="hljs-number">254</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span> };</code> </pre><br><br>  The timer interrupt handler looks like this. <br><br><pre> <code class="cpp hljs">TMR0_service: { T0IF = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    sPRODL = PRODL; sPRODH = PRODH; sTBLPTRH = TBLPTRH; sTBLPTRL = TBLPTRL; sFSR0 = FSR0; sFSR1 = FSR1; if (herz &lt; 100) { if (ptrA == 127) TMR0_inc(); } TMR0_set(); if (ptrA == 127) ptrA = 0; if (ptrB == 127) ptrB = 0; if (ptrC == 127) ptrC = 0; ptrA++; //   .  1-  ptrB++; //   .  2-  ptrC++; //   .  3-  if (herz&gt;=79) { if (ptrA &lt; 64) { DCH = sin[ptrA]; //   DCH = DCH + 128; } else { DCH = sin[ptrA]; //   DCH = 128 - DCH; } PW1DCH = DCH; if (ptrB &lt; 64) { DCH = sin[ptrB]; //   DCH = DCH + 128; } else { DCH = sin[ptrB]; //   DCH = 128 - DCH; } PW2DCH = DCH; if (ptrC &lt; 64) { DCH = sin[ptrC]; //   DCH = DCH + 128; } else { DCH = sin[ptrC]; //   DCH = 128 - DCH; } PW3DCH = DCH; } else { fctr = herz-1; //   ampS = amp[fctr]; //   if (ptrA &lt; 64) { DCH = sin[ptrA]; //   DCH = DCH*ampS; DCH = DCH&gt;&gt;8; DCH = DCH + 128; } else { DCH = sin[ptrA]; //   DCH = DCH*ampS; DCH = DCH&gt;&gt;8; DCH = 128 - DCH; } PW1DCH = DCH; if (ptrB &lt; 64) { DCH = sin[ptrB]; //   DCH = DCH*ampS; DCH = DCH&gt;&gt;8; DCH = DCH + 128; } else { DCH = sin[ptrB]; //   DCH = DCH*ampS; DCH = DCH&gt;&gt;8; DCH = 128 - DCH; } PW2DCH = DCH; if (ptrC &lt; 64) { DCH = sin[ptrC]; //   DCH = DCH*ampS; DCH = DCH&gt;&gt;8; DCH = DCH + 128; } else { DCH = sin[ptrC]; //   DCH = DCH*ampS; DCH = DCH&gt;&gt;8; DCH = 128 - DCH; } PW3DCH = DCH; } TBLPTRH = sTBLPTRH; TBLPTRL = sTBLPTRL; PRODL = sPRODL; PRODH = sPRODH; FSR0 = sFSR0; FSR1 = sFSR1; }</span></span></code> </pre><br>  The main program. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ GLINTD = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   // --    --&gt; TBLPTRL = 0; TBLPTRH = 3; // 0x300 #asm TABLRD 0,1,WREG ;      TLRD 1,sTMR0H ;       TABLRD 0,1,sTMR0L ;       #endasm // &lt;-- // --  TMR0 --&gt; T0IE = 1; //     TMR0 T0STA = 32; //   , 1:1 // &lt;-- // --   --&gt; PR1 = 253; //   = 32000000 / 4 / 253 = 31620  PW1DCL = PW2DCL = PW3DCL = 0; PW1DCH = 64; //   1-  PW2DCH = 46; //   2-  PW3DCH = 83; //   3-  // &lt;-- // --   --&gt; rtc = 0; herz = 1; //   1  ptrA = 0; //   1-  ptrB = 85; //   2-  ptrC = 42; //   3-  TMR1ON = 1; //  TMR1 PWM1ON = PWM2ON = PWM3ON = 1; //   TMR0_set(); //  TMR0 // &lt;-- GLINTD = 0; //   while(1); }</span></span></code> </pre><br><br>  Two subroutines for working with a timer. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TMR0_set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TMR0L = sTMR0L; TMR0H = sTMR0H; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TMR0_inc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rtc++; <span class="hljs-comment"><span class="hljs-comment">//    if (rtc == herz) { rtc = 0; herz++; TBLPTRL = TBLPTRL - 1; #asm TABLRD 0,1,WREG ;      TLRD 1,sTMR0H ;       TABLRD 0,1,sTMR0L ;       #endasm sTBLPTRH = TBLPTRH; sTBLPTRL = TBLPTRL; } }</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/128407/">https://habr.com/ru/post/128407/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128399/index.html">Twitter launches web analytics tool</a></li>
<li><a href="../128400/index.html">Congratulations Happy New Year in Brainfuck Style</a></li>
<li><a href="../128401/index.html">ReactOS, Medvedev and ‚Ç¨ 1 000 000</a></li>
<li><a href="../128403/index.html">Microsoft released Windows 8 Developer Preview</a></li>
<li><a href="../128405/index.html">FreeRADIUS for WPA & WPA2 Enterprise: Windows 7, Android, Symbian, iPhone</a></li>
<li><a href="../128408/index.html">Consulting and technical support</a></li>
<li><a href="../128409/index.html">Moscow government opens data</a></li>
<li><a href="../128410/index.html">IdeaPad Y570: a powerful laptop at a reasonable price</a></li>
<li><a href="../128413/index.html">Bureaucracy 2.0</a></li>
<li><a href="../128414/index.html">Creating an international startup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>