<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3G Modem and MikroTik</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that the Internet was gone at home. I have two wired operators connected and both have become unavailable. Later it turne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>3G Modem and MikroTik</h1><div class="post__text post__text-html js-mediator-article">  It all started with the fact that the Internet was gone at home.  I have two wired operators connected and both have become unavailable.  Later it turned out that in the next house turned off the electricity.  After bored for another hour without the Internet, I remembered the <b>ZTE MF112</b> 3G modem.  I connected it to a computer, but this was not enough, I also wanted a working Wi-Fi in the apartment.  For this reason, I connected it to my <b>MikroTik RouterBoard 951g-2hnd</b> .  That's what I'll tell you. <br><img src="https://habrastorage.org/storage2/a9d/7bc/5f2/a9d7bc5f267c5f689d34ff01a846dd61.png" alt="image"><br><a name="habracut"></a><br><h4>  Modem setup </h4><br>  <b>MikroTik RouterBoard 951g-2hnd has</b> one <b>USB</b> port.  For convenience, I connected a 3G modem through a small USB extension cable and proceeded to the settings: <br><br>  We look at what devices are available to us via USB: <br> <code>system resource usb print</code> <br> <code># DEVICE VENDOR NAME SPEED</code> <br> <code>1 1:2 ZTE,Incorporated ZTE WCDMA Technologies MSM 480 Mbps</code> <br> <div class="spoiler">  <b class="spoiler_title">In WinBox</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/0f7/a95/9ad/0f7a959ad1fa5d852fb30b5a23a89fd1.png" alt="image"></div></div><br><br>  We look at the ports, and most importantly the number of channels (3 channels from 0 to 2): <br> <code>port print</code> <br> <code>Flags: I - inactive</code> <br> <code># NAME CHANNELS USED-BY BAUD-RATE</code> <br> <code>0 usb1 3 9600</code> <br> <div class="spoiler">  <b class="spoiler_title">In WinBox</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/aff/fd1/c31/afffd1c3166aa832db87edd3e49e67a8.png" alt="image"></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's connect to the modem and configure its operation (select the channel by searching, waiting for the <b>AT</b> command to respond with <b>OK</b> . I did it with channel 1 and channel 2.): <br> <code>system serial-terminal port=usb1 channel=1</code> <br> <code>[Ctrl-A is the prefix key]</code> <br> <code>AT</code> <br> <code>OK</code> <br> <br>  First, reset to factory settings: <br> <code>AT&amp;F</code> <br> <code>OK</code> <br> <br>  Let's look at our modem: <br> <code>ATI</code> <br> <code>Manufacturer: ZTE CORPORATION</code> <br> <code>Model: MF112</code> <br> <code>Revision: BD_MF112V1.0.0B01</code> <br> <code>IMEI: 35***********54</code> <br> <code>+GCAP: +CGSM,+DS,+ES</code> <br> <code>OK</code> <br> <br>  Check network / SIM lock <br> <code>AT+ZSEC?</code> <br> <code>+ZSEC: 3,0</code> <br> <code>OK</code> <br> <br>  here <b>+ ZSEC: N, X</b> <br>  <b>N</b> - Network lock status: <br>  0 Initialize Encryption (Minor SEC_ITEMS) <br>  1 network lock errors.  (SEC_ITEMS Minor) <br>  2 Network lock <br>  3 unlocked or fix MCC / MNC <br><br>  <b>X</b> - SIM lock status: <br>  0 No action <br>  1 Network Lock <br>  2 (U) SIM Cards Lock <br>  3 Network Lock and (U) SIM Card Lock <br><br>  Signal level: <br> <code>AT+CSQ</code> <br> <code>+CSQ: 17,99</code> <br> <code>OK</code> <br> <br>  In decibels ( <b>X</b> = 17): <b>-113 + X * 2</b> = -113 + 17 * 2 = -79 dB <br><br>  Find out SIM IMSI number: <br> <code>AT+CIMI</code> <br> <code>25***********56</code> <br> <code>OK</code> <br> <br>  Next, disable the virtual CDROM: <br> <code>AT+ZCDRUN=E</code> <br> <code>Enter download mode result(0:FAIL 1:SUCCESS):1</code> <br> <code>OK</code> <br> <br> <code>AT+ZCDRUN=8</code> <br> <code>Close autorun state result(0:FAIL 1:SUCCESS):1</code> <br> <code>OK</code> <br> <br>  Select the mode of operation: <br>  <i>AT + ZSNT = 0,0,0</i> (Auto) - default <br>  <i>AT + ZSNT = 0,0,1</i> Automatic network selection: GSM + WCDMA, GSM preference <br>  <i>AT + ZSNT = 0,0,2</i> Automatic network selection: GSM + WCDMA, WCDMA preference <br>  <i>AT + ZSNT = 1.0.0</i> Automatic network selection: GSM only <br>  <i>AT + ZSNT = 2.0.0</i> Automatic network selection: WCDMA only <br>  <i>AT + ZSNT = 0,1,0</i> Manual network selection: GSM + WCDMA <br>  <i>AT + ZSNT = 1,1,0</i> Manual network selection: GSM only <br>  <i>AT + ZSNT = 2,1,0</i> Manual network selection: WCDMA only <br><br>  I selected <i>Automatic network selection: GSM + WCDMA, WCDMA preference</i> : <br> <code>AT+ZSNT=0,0,2</code> <br> <code>OK</code> <br> <br>  All now save the data in the current profile: <br> <code>AT&amp;W</code> <br> <code>OK</code> <br> <br>  Hit <i>Ctrl-A</i> <br> <code>[Q - quit connection] [B - send break]</code> <br> <code>[A - send Ctrl-A prefix] [R - autoconfigure rate]</code> <br> <br>  and <i>Q</i> <br> <code>Welcome back!</code> <br> <div class="spoiler">  <b class="spoiler_title">In WinBox</b> <div class="spoiler_text">  There is no possibility to work with <i>serial-terminal</i> </div></div><br><br><h4>  Connection setup </h4><br>  To do this, we need the following source data (example on the MTS operator): <br><ul><li>  <b>APN</b> : internet.mts.ru </li><li>  <b>Phone</b> : * 99 # </li><li>  <b>User</b> : mts </li><li>  <b>Password</b> : mts </li></ul><br><br>  Besides: <br><ul><li>  port to which the modem is connected: usb1 </li><li>  data and info numbers of channels: 2 and 1 (selected by search) </li></ul><br><br>  A new connection <b>ppp-out1</b> should appear in the interfaces: <br> <code>interface print</code> <br> <code>Flags: D - dynamic, X - disabled, R - running, S - slave</code> <br> <code># NAME TYPE MTU L2MTU MAX-L2MTU MAC-ADDRESS</code> <br> <code>12 X ppp-out1 ppp-out</code> <br> <br>  Set it up: <br><img src="https://habrastorage.org/storage2/820/66e/356/82066e3568e52c70b20e7b6a1198daac.png" alt="image"><br><img src="https://habrastorage.org/storage2/7f9/413/af0/7f9413af03d085476ae07de465dc4247.png" alt="image"><br><br>  and connect: <br><img src="https://habrastorage.org/storage2/811/081/1bb/8110811bb9616b538b66a001a07c686d.png" alt="image"><br><br><h4>  Receiving / Sending SMS </h4><br>  Internet is, but you have to pay for it, and for this you need to follow the balance.  For this, I used the <a href="http://www.chel.mts.ru/mob_connect/help/selfservices/sms-helper/">SMS assistant</a> .  <b>USSD</b> requests can also be used (# 100 # to find out the balance from MTS), but they are only available via the console, a command like this: <br> <code>AT+CUSD=1,#100#,15</code> <br>  In response, we get: <br> <code>OK</code> <br>  And after a while the line: <br> <code>+CUSD: 0,"00420061006C0061006E00630065003A00370031002C0032003000720020",72</code> <br>  The message <b>‚Äú00420061006C0061006E00630065003A00370031002C0032003000720020‚Äù</b> is a message in <b>UCS-2</b> encoding that can be decrypted using <a href="http://www.columbia.edu/kermit/ucs2.html">this</a> resource. <br>  This approach is not very convenient, for this reason it is more appropriate to use SMS-assistant. <br><br>  At MTS, in order to receive an SMS with a balance, you need to send a message to number 111 with text 11. This is done like this (the channel was selected by enumeration): <br> <code>tool sms send usb1 phone-number=111 message=11 channel=1</code> <br> <br>  Next, read the incoming messages and wait for ours ( <b>secret</b> is any line): <br> <code>tool sms set channel=1 port=usb1 keep-max-sms=10 receive-enabled=yes secret=blabla</code> <br> <code>tool sms inbox print</code> <br> <div class="spoiler">  <b class="spoiler_title">In WinBox</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/431/3c6/9a3/4313c69a372c141c68eb7e13c8af641a.png" alt="image"></div></div><br><br>  We receive an empty message from 111. The fact is that Mikrotik can only work with text SMS messages, but there is no PDU. <br>  It is necessary to force the SMS assistant to send messages in text form.  To do this, send an SMS to the number <b>+79126313431</b> with the text <b>Eng</b> (This is for the MTS operator): <br><br> <code>tool sms send usb1 phone-number=+79126313431 channel=1 message=Eng</code> <br> <br>  We look: <br> <code>tool sms inbox print</code> <br> <code># PHONE TIMESTAMP MESSAGE</code> <br> <code>0 +79126313431 Jul/30/2013 14:08:40 GMT +6 Now you are a default language user</code> <br> <code>1 111 Jul/30/2013 14:07:33 GMT +6</code> <br> <br>  Try again to get the balance: <br> <code>tool sms send usb1 phone-number=111 message=11 channel=1</code> <br>  We look: <br> <code>tool sms inbox print</code> <br> <code># PHONE TIMESTAMP MESSAGE</code> <br> <code>0 111 Jul/30/2013 14:09:20 GMT +6 Vash balans:117,5 rub. sms</code> <br> <code>1 +79126313431 Jul/30/2013 14:08:40 GMT +6 Now you are a default language user</code> <br> <code>2 111 Jul/30/2013 14:07:33 GMT +6</code> <br> <br>  Now we can receive SMS messages. <br><br><h4>  Rate </h4><br>  I will describe only MTS.  I had his SIM card (actually, like the modem - but it is <a href="http://www.google.ru/%3Fq%3DZTE%2BMF112%2BMTS%2BUNLOCK">fixable</a> ) <br><br>  Tariff: <a href="http://www.chel.mts.ru/mob_connect/tariffs/tariffs/supermts/">Super MTS</a> and the main thing is the option <a href="http://www.chel.mts.ru/mobil_inet_and_tv/internet_phone/additionally_services/minibit/">"Minibit"</a> , which allows you to pay for the Internet, only on the day when we need it - 15 rubles.  The minus is the daily quota of 5 MB, then the speed drops to 32 Kbps. <br><br>  Tariff: <a href="http://www.chel.mts.ru/mob_connect/tariffs/tariffs/connect4/">Connect-4</a> (The transition to this tariff is not available from all tariffs) and the option <a href="http://www.mts.ru/mobil_inet_and_tv/internet_comp/additionally_services/unlim_day/">‚ÄúInternet per day‚Äù</a> , it allows you to pay for the Internet, only on the day when we need it - 30 rubles.  Minus is the daily quota of 250 MB, then the speed drops to 64Kbps. <br><br>  If anyone knows more profitable similar tariffs / options, then please share. <br><br>  This is how I organized an emergency Internet channel just in case. </div><p>Source: <a href="https://habr.com/ru/post/188424/">https://habr.com/ru/post/188424/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188404/index.html">What should we build an online store? Or how I started selling online</a></li>
<li><a href="../188406/index.html">CoffeeScript and AngularJS</a></li>
<li><a href="../188418/index.html">Mercurial Utility</a></li>
<li><a href="../188420/index.html">Intel Power Monitoring Tool - on guard energy efficiency</a></li>
<li><a href="../188422/index.html">Quip: word processor from Google Maps and FriendFeed</a></li>
<li><a href="../188430/index.html">Seven skills of a professional programmer</a></li>
<li><a href="../188432/index.html">First PyPy3 beta released with Python 3 support</a></li>
<li><a href="../188436/index.html">Habrahabr now accepts images for blog posts for permanent storage</a></li>
<li><a href="../188438/index.html">Dependency Injection in Unity3d</a></li>
<li><a href="../188440/index.html">Security asterisk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>