<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing a phased script using AJAX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I was looking for a more or less simple and universal means for organizing the step-by-step work of the script, but I did not find anything. Even a qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing a phased script using AJAX</h1><div class="post__text post__text-html js-mediator-article">  I was looking for a more or less simple and universal means for organizing the step-by-step work of the script, but I did not find anything.  Even a <a href="http://habrahabr.ru/qa/25101/">question in QA asked</a> , everywhere only common phrases.  Therefore I decided to make such a tool myself. <br><br><h2>  What is it all for? </h2><br>  Sometimes it is necessary to process a very large file with a script, for example, for import.  Naturally, the time of the script increases in proportion to the file size or the number of lines in it. <br><br>  I would like to break the processing of the file into several parts and run the script to work in parts. <br><img src="https://habrastorage.org/getpro/habr/post_images/9b7/43d/abc/9b743dabc1573d6479b81b8d9e30164b.png" alt="image"><br>  The principle of implementation has long been known - the exchange of data between the server and the client: <br>  The client runs the script, it performs several iterations and returns to the client the line number on which it stopped.  After that, the client makes a new request, in which the script sends this number and the script continues to work further. <br><a name="habracut"></a><br><h2>  Actually the code itself </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For the work we need: <br><br><div class="spoiler">  <b class="spoiler_title">index.html</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>ScriptOffset -      <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://yandex.st/jquery/1.7.1/jquery.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"scriptoffset.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"scriptoffset.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"offset"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"offset"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"progress"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width: 0%;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"runScript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"run"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"refreshScript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">scriptoffset.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//    Ajax if ($_SERVER['HTTP_X_REQUESTED_WITH'] != 'XMLHttpRequest') {return;} //      action        . $action = $_POST['action']; if (empty($action)) {return;} $count = 50; $step = 1; //      $url = $_POST['url']; if (empty($url)) return; $offset = $_POST['offset']; // ,     $offset = $offset + $step; if ($offset &gt;= $count) { $sucsess = 1; } else { $sucsess = round($offset / $count, 2); } //     (       ) $output = Array('offset' =&gt; $offset, 'sucsess' =&gt; $sucsess); echo json_encode($output);</span></span></code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">scriptoffset.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCookie</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, offset</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ws=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!offset &amp;&amp; !url) { ws.setMinutes(<span class="hljs-number"><span class="hljs-number">10</span></span>-ws.getMinutes()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ws.setMinutes(<span class="hljs-number"><span class="hljs-number">10</span></span>+ws.getMinutes()); } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie=<span class="hljs-string"><span class="hljs-string">"scriptOffsetUrl="</span></span>+url+<span class="hljs-string"><span class="hljs-string">";expires="</span></span>+ws.toGMTString(); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie=<span class="hljs-string"><span class="hljs-string">"scriptOffsetOffset="</span></span>+offset+<span class="hljs-string"><span class="hljs-string">";expires="</span></span>+ws.toGMTString(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCookie</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cookie = <span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> search = <span class="hljs-string"><span class="hljs-string">" "</span></span> + name + <span class="hljs-string"><span class="hljs-string">"="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> setStr = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> end = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cookie.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { offset = cookie.indexOf(search); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (offset != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { offset += search.length; end = cookie.indexOf(<span class="hljs-string"><span class="hljs-string">";"</span></span>, offset) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (end == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { end = cookie.length; } setStr = <span class="hljs-built_in"><span class="hljs-built_in">unescape</span></span>(cookie.substring(offset, end)); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(setStr); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showProcess</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, sucsess, offset, action</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#url, #refreshScript'</span></span>).hide(); $(<span class="hljs-string"><span class="hljs-string">'.progress'</span></span>).show(); $(<span class="hljs-string"><span class="hljs-string">'#runScript'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'!'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'.bar'</span></span>).text(url); $(<span class="hljs-string"><span class="hljs-string">'.bar'</span></span>).css(<span class="hljs-string"><span class="hljs-string">'width'</span></span>, sucsess * <span class="hljs-number"><span class="hljs-number">100</span></span> + <span class="hljs-string"><span class="hljs-string">'%'</span></span>); setCookie(url, offset); $(<span class="hljs-string"><span class="hljs-string">'#runScript'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.href=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.href }); scriptOffset(url, offset, action); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scriptOffset</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, offset, action</span></span></span><span class="hljs-function">) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"http://bfmn.ru/scriptoffset/scriptoffset.php"</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-string"><span class="hljs-string">"action"</span></span>:action , <span class="hljs-string"><span class="hljs-string">"url"</span></span>:url , <span class="hljs-string"><span class="hljs-string">"offset"</span></span>:offset }, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ data = $.parseJSON(data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(data.sucsess &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { showProcess(url, data.sucsess, data.offset, action); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setCookie(); $(<span class="hljs-string"><span class="hljs-string">'.bar'</span></span>).css(<span class="hljs-string"><span class="hljs-string">'width'</span></span>,<span class="hljs-string"><span class="hljs-string">'100%'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'.bar'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#runScript'</span></span>).text(<span class="hljs-string"><span class="hljs-string">''</span></span>); } } }); } $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = getCookie(<span class="hljs-string"><span class="hljs-string">"scriptOffsetUrl"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = getCookie(<span class="hljs-string"><span class="hljs-string">"scriptOffsetOffset"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (url &amp;&amp; url != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { $(<span class="hljs-string"><span class="hljs-string">'#refreshScript'</span></span>).show(); $(<span class="hljs-string"><span class="hljs-string">'#runScript'</span></span>).text(<span class="hljs-string"><span class="hljs-string">''</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#url'</span></span>).val(url); $(<span class="hljs-string"><span class="hljs-string">'#offset'</span></span>).val(offset); } $(<span class="hljs-string"><span class="hljs-string">'#runScript'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> action = $(<span class="hljs-string"><span class="hljs-string">'#runScript'</span></span>).data(<span class="hljs-string"><span class="hljs-string">'action'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = $(<span class="hljs-string"><span class="hljs-string">'#offset'</span></span>).val(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = $(<span class="hljs-string"><span class="hljs-string">'#url'</span></span>).val(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">'#url'</span></span>).val() != getCookie(<span class="hljs-string"><span class="hljs-string">"scriptOffsetUrl"</span></span>)) { setCookie(); scriptOffset(url, <span class="hljs-number"><span class="hljs-number">0</span></span>, action); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { scriptOffset(url, offset, action); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }); $(<span class="hljs-string"><span class="hljs-string">'#refreshScript'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> action = $(<span class="hljs-string"><span class="hljs-string">'#runScript'</span></span>).data(<span class="hljs-string"><span class="hljs-string">'action'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = $(<span class="hljs-string"><span class="hljs-string">'#url'</span></span>).val(); setCookie(); scriptOffset(url, <span class="hljs-number"><span class="hljs-number">0</span></span>, action); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }); });</code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">scriptoffset.css</b> <div class="spoiler_text"><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">13px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: middle; <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#CCCCCC</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">3px</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#808080</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">13px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">26px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">18px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">243px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">-moz-transition</span></span>: border <span class="hljs-number"><span class="hljs-number">0.2s</span></span> linear <span class="hljs-number"><span class="hljs-number">0s</span></span>, box-shadow <span class="hljs-number"><span class="hljs-number">0.2s</span></span> linear <span class="hljs-number"><span class="hljs-number">0s</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.1) inset; } <span class="hljs-selector-class"><span class="hljs-selector-class">.btn</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">13px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span> <span class="hljs-number"><span class="hljs-number">8px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#0064CD</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-image</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">-moz-linear-gradient</span></span>(center top , #049CDB, #0064CD); <span class="hljs-attribute"><span class="hljs-attribute">background-repeat</span></span>: repeat-x; <span class="hljs-attribute"><span class="hljs-attribute">border-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.1) <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.1) <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.25); <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#FFFFFF</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: middle; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">3px</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span> <span class="hljs-number"><span class="hljs-number">3px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> -<span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.25); <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: none; } <span class="hljs-selector-class"><span class="hljs-selector-class">.btn</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-position</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> -<span class="hljs-number"><span class="hljs-number">15px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.btn</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:active</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span> <span class="hljs-number"><span class="hljs-number">4px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.25) inset, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.05); } <span class="hljs-selector-class"><span class="hljs-selector-class">.progress</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">13px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: middle; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#F7F7F7</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-image</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">-moz-linear-gradient</span></span>(center top , #F5F5F5, #F9F9F9); <span class="hljs-attribute"><span class="hljs-attribute">background-repeat</span></span>: repeat-x; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">4px</span></span> <span class="hljs-number"><span class="hljs-number">4px</span></span> <span class="hljs-number"><span class="hljs-number">4px</span></span> <span class="hljs-number"><span class="hljs-number">4px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.1) inset; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">28px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">250px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">overflow</span></span>: hidden; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; } <span class="hljs-selector-class"><span class="hljs-selector-class">.progress</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.bar</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#0E90D2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-image</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">-moz-linear-gradient</span></span>(center top , #149BDF, #0480BE); <span class="hljs-attribute"><span class="hljs-attribute">background-size</span></span>: <span class="hljs-number"><span class="hljs-number">40px</span></span> <span class="hljs-number"><span class="hljs-number">40px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">-moz-box-sizing</span></span>: border-box; <span class="hljs-attribute"><span class="hljs-attribute">-moz-transition</span></span>: width <span class="hljs-number"><span class="hljs-number">0.6s</span></span> ease <span class="hljs-number"><span class="hljs-number">0s</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-repeat</span></span>: repeat-x; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> -<span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, 0.15) inset; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#FFFFFF</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">float</span></span>: left; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">12px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align</span></span>: left; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span> <span class="hljs-number"><span class="hljs-number">8px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">13px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">#333</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">white-space</span></span>: nowrap; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.form</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">150px</span></span> auto <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">500px</span></span>; }</code> </pre><br></div></div><br>  For registration css took a few rules from Bootstrap. <br><br><h5>  What is the result </h5><br>  In the url field we specify, for example, a link to the file that needs to be processed, and run the script.  A progress bar appears, and we sit and wait for it to crawl to 100% to see the result of the work. <br><br>  When working with this solution: <br><ul><li>  We can set the number of processed lines per iteration (in the script itself); </li><li>  The user is shown a real progress bar, and not an endless "twist" - if the progress bar is in the middle, then half of the file is processed; </li><li>  The user can stop the execution of the script.  In this case, the offset is recorded in cookies for 10 minutes so that the script can continue to work from the same place. </li><li>  If the user refreshes the page, he will be prompted to continue the script from the stop or restart (also thanks to cookies). </li></ul><br><br>  If the community has examples of implementing such a functional or even ready-made solutions for step-by-step work with scripts, I will be grateful for the links in the comments. <br><br>  <b>UPD.</b>  Solution adapted for MODX <a href="http://community.modx-cms.ru/blog/tips_and_tricks/9126.html">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/153731/">https://habr.com/ru/post/153731/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../153719/index.html">How GPS tracker became a logger or a simple and cheap way to organize monitoring of physical parameters of remote objects</a></li>
<li><a href="../153721/index.html">Redirect static web pages appeared on Amazon S3</a></li>
<li><a href="../153723/index.html">Sony Xperia J goes on sale</a></li>
<li><a href="../153727/index.html">ABBYY FineScanner and Yandex.Disk - beautiful copies of documents are always at hand</a></li>
<li><a href="../153729/index.html">Review of two cradle for HTC Desire S by Mugen Power</a></li>
<li><a href="../153733/index.html">Video review tablet Bliss Pad T7012</a></li>
<li><a href="../153735/index.html">Some life tips for the developer</a></li>
<li><a href="../153737/index.html">Telefunken headphones: a first look at a new product for an old brand</a></li>
<li><a href="../153739/index.html">Emulator Radio-86RK JavaScript / Reboot</a></li>
<li><a href="../153745/index.html">CSS3 browser support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>