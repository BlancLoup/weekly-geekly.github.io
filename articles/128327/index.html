<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GIF Steganography</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Greetings. 
 Not so long ago, when I was studying at the university, there was a term paper on the discipline ‚ÄúSoftware methods of info...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GIF Steganography</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Greetings. <br>  Not so long ago, when I was studying at the university, there was a term paper on the discipline ‚ÄúSoftware methods of information protection‚Äù.  According to the task, it was necessary to make a program embedding the message in the GIF format files.  Decided to do in Java. <br><br>  In this article I will describe some theoretical points, as well as how this small program was created. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Theoretical part </h4><br><h5>  GIF format </h5><br>  GIF (English Graphics Interchange Format - the format for the exchange of images) - the storage format of graphic images, is able to store compressed data without loss of quality in the format up to 256 colors.  This format was developed in 1987 (GIF87a) by CompuServe for transferring raster images over networks.  In 1989, the format was modified (GIF89a), support for transparency and animation was added. <br><br>  GIF files have a block structure.  These blocks always have a fixed length (or it depends on certain flags), so it‚Äôs almost impossible to err where the block is.  The structure of the simplest non-animated GIF-format GIF89a: <br><br><img src="https://habrastorage.org/storage2/02a/3f0/c16/02a3f0c165051decac97c41afed09f39.gif"><br><br>  Of all the blocks of the structure in this case, we will be interested in the block of the global palette and the parameters responsible for the palette: <br><ul><li> <code>CT</code> - the presence of a global palette.  If this flag is set, then immediately after the logical screen descriptor a global palette should begin. </li><li>  <code>Size</code> - the size of the palette and the number of colors of the image.  Values ‚Äã‚Äãof this parameter: </li></ul><br><table><tbody><tr><th>  Size </th><th>  Number of colors </th><th>  Palette size, byte </th></tr><tr><td>  7 </td><td>  256 </td><td>  768 </td></tr><tr><td>  6 </td><td>  128 </td><td>  384 </td></tr><tr><td>  five </td><td>  64 </td><td>  192 </td></tr><tr><td>  four </td><td>  32 </td><td>  96 </td></tr><tr><td>  3 </td><td>  sixteen </td><td>  48 </td></tr><tr><td>  2 </td><td>  eight </td><td>  24 </td></tr><tr><td>  one </td><td>  four </td><td>  12 </td></tr><tr><td>  0 </td><td>  2 </td><td>  6 </td></tr></tbody></table><br><br><h5>  Encryption methods </h5><br>  The following methods will be used as encryption methods for messages in image files: <br><ul><li>  LSB (Least Significant Bit, least significant bit) method </li><li>  Palette addition method </li></ul><br>  <b>The LSB method</b> is a common method of steganography.  It consists in replacing the last significant bits in the container (in our case, the global palette bytes) with the bits of the message to be hidden. <br><br>  The program will use the last two bits in bytes of the global palette as part of this method.  This means that for a 24-bit image, where the color of the palette is three bytes for red, blue, and green, after embedding the message in it, each component of the color will change by a maximum of 3/255 gradation.  Such a change, firstly, will be imperceptible or difficult for the human eye, and secondly, it will not be distinguishable on low-quality output devices. <br><br>  The amount of information will directly depend on the size of the image palette.  Since the maximum size of a palette is 256 colors and, if you write two bits of a message to a component of each color, the maximum length of the message (at the maximum palette in the image) is 192 bytes.  After the message is embedded in the image, the file size does not change. <br><br>  <b>A palette expansion method</b> that works only for the GIF structure.  It will be most effective in images with a palette of small sizes.  Its essence is that it increases the size of the palette, thereby giving additional space to record the necessary bytes in place of bytes of colors.  If we consider that the minimum size of the palette is 2 colors (6 bytes), then the maximum size of the message being injected can be 256 √ó 3‚Äì6 = 762 bytes.  The disadvantage is low crypto-security; you can read the embedded message using any text editor, if the message has not been subjected to additional encryption. <br><br><h4>  Practical part </h4><br><h5>  Program design </h5><br>  All the necessary tools for implementing encryption and decryption algorithms will be in the <code>com.tsarik.steganography</code> package.  This package includes the <code>Encryptor</code> interface with the <code>encrypt</code> and <code>decrypt</code> methods, the <code>Binary</code> class, which provides the ability to work with arrays of bits, as well as the exception classes <code>UnableToEncryptException</code> and <code>UnableToDecryptException</code> , which should be used in <code>Encryptor</code> error methods for encoding and decoding errors, respectively. <br><br>  The main program package <code>com.tsarik.programs.gifed</code> will include a program class being run with a static <code>main</code> method that allows it to run the program;  class that stores the parameters of the program;  and packages with other classes. <br><br>  The implementation of the algorithms themselves will be represented in the package <code>com.tsarik.programs.gifed.gif</code> classes <code>GIFEncryptorByLSBMethod</code> and <code>GIFEncryptorByPaletteExtensionMethod</code> .  Both of these classes will implement the <code>Encryptor</code> interface. <br><br>  Based on the structure of the GIF format, you can create a general algorithm for embedding a message in the image palette: <br><br><img src="https://habrastorage.org/storage2/dc9/2a1/991/dc92a19917a79a7632a1d4452458ed53.png"><br><br>  To determine the presence of a message in an image, it is necessary to add a certain sequence of bits to the beginning of the message, which the decoder reads first and checks for correctness.  If it does not match, it is considered that there is no hidden message in the image.  Next you need to specify the length of the message.  Then the text of the message itself. <br><br>  The class diagram of the entire application: <br><br><img src="https://habrastorage.org/storage2/0fd/ef0/deb/0fdef0debcb167b86d4bdb219437a4b9.png"><br><br><h5>  Implementation of the program </h5><br>  The implementation of the entire program can be divided into two components: the implementation of the <code>Encryptor</code> interface encryption and decryption methods, in the <code>GIFEncryptorByLSBMethod</code> and <code>GIFEncryptorByPaletteExtensionMethod</code> , and the implementation of the user interface. <br><br>  Consider the class <code>GIFEncryptorByLSBMethod</code> . <br><br><img src="https://habrastorage.org/storage2/dc4/a0d/eb4/dc4a0deb4ffc3fe9ea8b3eb5cb79d853.png"><br><br>  The <code>firstLSBit</code> and <code>secondLSBit</code> contain the bit numbers of each byte of the image into which the message is to be entered and from where.  The <code>checkSequence</code> field stores a check bit sequence to ensure recognition of the embedded message.  The static <code>getEncryptingFileParameters</code> method returns the parameters of the specified file and the characteristics of the potential message. <br><br>  The algorithm method <code>encrypt</code> class <code>GIFEncryptorByLSBMethod</code> : <br><br><img src="https://habrastorage.org/storage2/fee/867/4f4/fee8674f4b815bb0ff7720b2fa25abdd.png"><br><br>  And its code: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File in, File out, String text)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UnableToEncodeException, NullPointerException, IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NullPointerException(<span class="hljs-string"><span class="hljs-string">"Input file is null"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (out == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NullPointerException(<span class="hljs-string"><span class="hljs-string">"Output file is null"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NullPointerException(<span class="hljs-string"><span class="hljs-string">"Text is null"</span></span>); } <span class="hljs-comment"><span class="hljs-comment">// read bytes from input file byte[] bytes = new byte[(int)in.length()]; InputStream is = new FileInputStream(in); is.read(bytes); is.close(); // check format if (!(new String(bytes, 0, 6)).equals("GIF89a")) { throw new UnableToEncodeException("Input file has wrong GIF format"); } // read palette size property from first three bits in the 10-th byte from the file byte[] b10 = Binary.toBitArray(bytes[10]); byte bsize = Binary.toByte(new byte[] {b10[0], b10[1], b10[2]}); // calculate color count and possible message length int bOrigColorCount = (int)Math.pow(2, bsize+1); int possibleMessageLength = bOrigColorCount*3/4; int possibleTextLength = possibleMessageLength-2;// one byte for check and one byte for message length if (possibleTextLength &lt; text.length()) { throw new UnableToEncodeException("Text is too big"); } int n = 13; // write check sequence for (int i = 0; i &lt; checkSequence.length/2; i++) { byte[] ba = Binary.toBitArray(bytes[n]); ba[firstLSBit] = checkSequence[2*i]; ba[secondLSBit] = checkSequence[2*i+1]; bytes[n] = Binary.toByte(ba); n++; } // write text length byte[] cl = Binary.toBitArray((byte)text.length()); for (int i = 0; i &lt; cl.length/2; i++) { byte[] ba = Binary.toBitArray(bytes[n]); ba[firstLSBit] = cl[2*i]; ba[secondLSBit] = cl[2*i+1]; bytes[n] = Binary.toByte(ba); n++; } // write message byte[] textBytes = text.getBytes(); for (int i = 0; i &lt; textBytes.length; i++) { byte[] c = Binary.toBitArray(textBytes[i]); for (int ci = 0; ci &lt; c.length/2; ci++) { byte[] ba = Binary.toBitArray(bytes[n]); ba[firstLSBit] = c[2*ci]; ba[secondLSBit] = c[2*ci+1]; bytes[n] = Binary.toByte(ba); n++; } } // write output file OutputStream os = new FileOutputStream(out); os.write(bytes); os.close(); }</span></span></code> </pre><br><br>  The algorithm and source code for the <code>decrypt</code> method of the class <code>GIFEncryptorByLSBMethod</code> : <br><br><img src="http://habrastorage.org/storage2/907/154/e2d/907154e2db90b653f3a8c6cf64909f7a.png"><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File in)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UnableToDecodeException, NullPointerException, IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NullPointerException(<span class="hljs-string"><span class="hljs-string">"Input file is null"</span></span>); } <span class="hljs-comment"><span class="hljs-comment">// read bytes from input file byte[] bytes = new byte[(int)in.length()]; InputStream is = new FileInputStream(in); is.read(bytes); is.close(); // check format if (!(new String(bytes, 0, 6)).equals("GIF89a")) { throw new UnableToDecodeException("Input file has wrong GIF format"); } // read palette size property from first three bits in the 10-th byte from the file byte[] b10 = Binary.toBitArray(bytes[10]); byte bsize = Binary.toByte(new byte[] {b10[0], b10[1], b10[2]}); // calculate color count and possible message length int bOrigColorCount = (int)Math.pow(2, bsize+1); int possibleMessageLength = bOrigColorCount*3/4; int possibleTextLength = possibleMessageLength-2; // one byte for check and one byte for message length int n = 13; // read check sequence byte[] csBits = new byte[checkSequence.length]; for (int i = 0; i &lt; 4; i++) { byte[] ba = Binary.toBitArray(bytes[n]); csBits[2*i] = ba[firstLSBit]; csBits[2*i+1] = ba[secondLSBit]; n++; } byte cs = Binary.toByte(csBits); if (cs != Binary.toByte(checkSequence)) { throw new UnableToDecodeException("There is no encrypted message in the image (Check sequence is incorrect)"); } // read text length byte[] cl = new byte[8]; for (int i = 0; i &lt; 4; i++) { byte[] ba = Binary.toBitArray(bytes[n]); cl[2*i] = ba[firstLSBit]; cl[2*i+1] = ba[secondLSBit]; n++; } byte textLength = Binary.toByte(cl); if (textLength &lt; 0) { throw new UnableToDecodeException("Decoded text length is less than 0"); } if (possibleTextLength &lt; textLength) { throw new UnableToDecodeException("There is no messages (Decoded message length (" + textLength + ") is less than Possible message length (" + possibleTextLength + "))"); } // read text bits and make text bytes byte[] bt = new byte[textLength]; for (int i = 0; i &lt; bt.length; i++) { byte[] bc = new byte[8]; for (int bci = 0; bci &lt; bc.length/2; bci++) { byte[] ba = Binary.toBitArray(bytes[n]); bc[2*bci] = ba[firstLSBit]; bc[2*bci+1] = ba[secondLSBit]; n++; } bt[i] = Binary.toByte(bc); } return new String(bt); }</span></span></code> </pre><br><br>  The implementation of the <code>GIFEncryptorByPaletteExtensionMethod</code> class will be similar, only the method of storing / reading information is different. <br><br>  The <code>MainFrame</code> class describes ‚Äúwrappers‚Äù <code>encryptImage(Encryptor encryptor)</code> : <code>encryptImage(Encryptor encryptor)</code> and <code>decryptImage(Encryptor encryptor)</code> , processing the results of <code>Encryptor</code> interface methods and interacting with the user, that is, opening a file selection dialog, showing error messages, etc. ;  as well as other methods: <code>openImage()</code> , allowing the user to select an image, <code>exit()</code> , exiting the application.  These methods are called from the Actions of the corresponding menu items.  In this class, the following additional methods are implemented: <code>createComponents()</code> - creating form components, <code>loadImageFile(File f)</code> - loading an image into a special component from a file.  The implementation of the <code>GIFEncryptorByPaletteExtensionMethod</code> class <code>GIFEncryptorByPaletteExtensionMethod</code> similar to the implementation of the <code>GIFEncryptorByLSBMethod</code> class, the main difference lies in the way in which you write and read message bytes from a palette. <br><br><h4>  Work program </h4><br><h5>  LBS method </h5><br>  Suppose there is such an image: <br><br><img src="http://1450822360694546842926"><br><br>  In this image, the palette consists of 256 colors (this is how Paint preserves).  The first four colors: white, black, red, green.  The remaining colors are black.  The sequence of bits in the global palette will be as follows: <br><br>  111111 <u>11</u> 111111 <u>11</u> 111111 <u>11</u> 000000 <u>00</u> 000000 <u>00</u> 000000 <u>00</u> 111111 <u>11</u> 000000 <u>00</u> 000000 <u>00</u> 000000 <u>00</u> 111111 <u>11</u> 000000 <u>00</u> ... <br><br><img src="http://habrastorage.org/storage2/2b0/0b1/be7/2b00b1be7dabb57705bbb8e6d5a9ad22.png"><br><br>  After the message is inserted, the underlined bits will be replaced by the bits from the message.  The resulting image is almost the same as the original. <br><br><table><tbody><tr><th>  Original </th><th>  Image with embedded message </th></tr><tr><td><img src="http://1450822360694546842926" alt="Original"></td><td><img src="http://habrastorage.org/storage2/40a/820/144/40a820144ba0d93c26533d6e5f9367f6.gif" alt="Image with embedded message"></td></tr></tbody></table><br><br><h5>  Palette expansion method </h5><br>  Opening the image in which the message is placed by this method, you can find the following picture: <br><br><img src="http://habrastorage.org/storage2/dcf/d5a/04b/dcfd5a04bbdec41431fe0bb1e5f2d561.png"><br><br>  It is clear that for a full-fledged espionage activity, this method will not work, and it may require additional encryption of the message. <br><br>  Encryption / decryption in animated images works, as in normal static images, and the animation is not disturbed. <br><br>  Sources used: <br><ul><li>  <a href="http://ru.wikipedia.org/wiki/Gif">http://ru.wikipedia.org/wiki/Gif</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B5%25D0%25B3%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D1%258F">http://ru.wikipedia.org/wiki/Steganography</a> </li><li>  <a href="http://home.onego.ru/~chiezo/gif.htm">http://home.onego.ru/~chiezo/gif.htm</a> </li></ul><br><br>  Download: <br><ul><li>  <a href="https://bitbucket.org/phts-home/gifed/downloads/">The program</a> </li><li>  <a href="https://bitbucket.org/phts-home/gifed/src/">Sources</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/128327/">https://habr.com/ru/post/128327/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128321/index.html">Validating JavaScript with Valid8</a></li>
<li><a href="../128322/index.html">Steam in rubles</a></li>
<li><a href="../128323/index.html">Yandex begins to struggle with re-optimized texts</a></li>
<li><a href="../128324/index.html">The path of the freelancer. The road to success or gaining customer confidence</a></li>
<li><a href="../128325/index.html">Congratulations on the holiday programmer and programmer!</a></li>
<li><a href="../128328/index.html">"Calls" in the Odnoklassniki iPhone application</a></li>
<li><a href="../128329/index.html">How can I learn more, or why I will participate in the school CSEDays</a></li>
<li><a href="../128330/index.html">Creating a server infrastructure in a small business in a modest budget</a></li>
<li><a href="../128331/index.html">A pack of hungry wolves</a></li>
<li><a href="../128332/index.html">EU Neighbors Three Years Later</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>