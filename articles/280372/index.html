<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interactive video and what it eats</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Six months ago, over a cup of coffee, the programmer, the director, and the game designer had a friendly conversation on the subject of cinema becomin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interactive video and what it eats</h1><div class="post__text post__text-html js-mediator-article"> Six months ago, over a cup of coffee, the programmer, the director, and the game designer had a friendly conversation on the subject of cinema becoming boring.  ‚ÄúYes, the special effects are getting steeper, the amount of D becomes more, but this is now a little who can be surprised.  People cling plot.  Now imagine that someday we will watch movies that you can control? ‚Äù <br>  ‚ÄúI would kill John Connor.‚Äù <br>  ‚ÄúI wouldn‚Äôt have thrown away my elder wand and become a bad wizard.‚Äù <br>  ‚ÄúAnd I would use the flywheel of time on the spot of Potter to save his parents, and not klyuvkryla. <br><br><img src="https://habrastorage.org/files/1c7/ee2/d96/1c7ee2d96be4435d833a62ea107b57ca.jpg"><br><br>  And, as they say, it started ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Last week we <a href="https://habrahabr.ru/company/innopolis_university/blog/279847/">asked</a> Habrazhiteli whether it was interesting to learn about the technical aspects of creating a game.  Now we are ready to present the fruits of our work and tell us what difficulties we faced, how we struggled with them and what results we got. <br><a name="habracut"></a><br>  Links to demo and production versions are at the bottom of the article. <br><br>  <b>Objective</b> : to design an interactive video (in other words, to pull the Heavy Rain and Mass Effect experience on the video) <br><br>  Immediately answer your question: ‚ÄúWhy on the video?  Why not set the game environment and complete freedom of action? " <br><br>  We have come to the conclusion that there are already such games, and nothing gives a greater presence effect than high-quality video, and you will not get stuck in textures.  We decided to run on the web and not be confronted with the problem of releasing the product on DVD and the other delights of gamedev.  Moreover, the quality of the Internet connection for the current day in most cases allows you to watch full hd videos without prior download. <br><br>  To create the MVP, we decided not to fence several plot lines and took the path of a single storyline divided into specific checkpoints with dead-end branches. <br><br>  <b>Work with management</b> <br><br>  Since all of this should be public and work in the browser, our choice fell on <b>JavaScript</b> (‚Äúonly JavaScript, only hardcore!‚Äù ¬© our programmer). <br><br>  The QTE-model of management was chosen, similar to the management of the (stressful) scenes in Heavy Rain: at a certain point in time, buttons / series of buttons appear that you have to press.  I managed to press - well, I did not have time - I lost some of my health / self-esteem.  If the level of health falls to 0, a transition to a dead-end path will occur at the nearest checkpoint. <br><br>  It was decided to borrow elements of the game interface from desktop and console games.  As a result, we have: the avatar of the main character, his emotions, thoughts, pulse and health. <br><br>  Before us it became necessary to display a lot of custom things. <br><br>  Using <b>html</b> in our case implies a large load on the <b>DOM</b> , each update of which caused restructuring and redrawing of all objects, and, sooner or later, we would have rested against the computer resources. <br><br>  It was decided to change the output tool and use <b>Canvas</b> , which allows us to do custom things and redraw them when we need to.  At the moment we are faced with the fact that there are many static elements on one canvas, which are rarely updated, and elements that are updated very often.  And when you redraw a frequent element, heavy elements can be redrawn.  In the future, we think either to raise 2 canvases (for frequently changing and rarely changing), or rarely changing to make html (the load on the DOM will be minimal). <br><br>  <b>Controls used by us:</b> <br>  1) scrolling the mouse - formally responsible for running the main character on the video.  If you do not turn the mouse wheel for 2.5 seconds, the health / self-esteem will start to fall very quickly. <br>  2) The keystroke is responsible for some actions of the main character on the video (the control model resembles a typical shooter: WASD - directions, E - action, SPACE - jump, etc.) <br>  ‚Ä¢ Incorrectly pressed / not pressed key - takes away the level of health.  A certain time is given for pressing the key. <br>  ‚Ä¢ Enter a series of keys <br>  ‚Ä¢ Enter individual phrases and sentences <br><br><img src="https://habrastorage.org/files/08e/d3b/752/08ed3b752d50484ea6f08d74160382a8.png" alt="image"><br><br>  About keystrokes it is worth mentioning that the reaction of all people is different. <br><br>  <b>Solution</b> : we collect statistics on the delay time at which the keys are pressed (from the moment the key appeared to the moment it was pressed).  Every time we need to show the next key, we show it with an average advance for the user.  As a result, the user presses a key almost at the moment when it is necessary to perform an action.  The very first key in this approach does not solve anything and serves to initialize anticipation (almost as in sapper: the first field can never be a mine).  But you need to press this key so that further control is comfortable.  For this feature had to enter the weight of the keys.  And in the first series of keys in the first video, the maximum weight (incorrectly pressing / not pressing the key immediately resets the health level to zero. In our case, it is easier to send the user to a dead end and to the replay than to allow him to play with uncomfortable, late control)  Naturally, the control model does not depend on the language keyboard layout: an event is waiting for a key, not a letter. <br><br>  In the future, we plan to expand the control with a mouse on a given trajectory, as well as add the ability to interact with several objects (for example, the frame goes into slowmotion and in a few seconds you need to select an object from those presented in the frame). <br><br>  The entire control model is superimposed on the video by triggering a specific event at a particular point in time. <br><br>  <b>Work with video</b> <br><br>  When working with browsers, we encountered some limitations, for example, in Google Chrome, you can simultaneously preload 10 video files (we didn‚Äôt fit into this restriction even with our first MVP).  Due to the fact that Safari is the same Web Kit, the behavior in it is very similar.  For Firefox, the situation was similar.  I had to look for another solution. <br><br>  <b>Option 1</b> .  There is a pool of subject and dead-end video tracks.  While the user interacts with the current storyline, in the background, the next storyline and deadlock are preloaded.  As soon as he reaches the checkpoint (a fraction of a second before the end of the current video), we look at how cool the user has played and show him either the ending of the current track, or let it go further along the plot.  All that is no longer needed is deleted. <br><br><img src="https://habrastorage.org/files/8c6/46b/0e1/8c646b0e1d5f4b379bab69d4ce3d6131.jpg"><br><br>  <b>Total</b> : 1 file is playing, two in the preload.  Previous deleted. <br><br>  <b>Pros</b> : Easily sync footage (done at the video production level, when the last frame of the current track is the beginning of the next storyline and stub branch) <br><br>  <b>Minuses</b> : Easy frieze at the place of transition from one track to another. <br><br>  <b>Option 2</b> .  One long storyline and a dead end pool.  A checkpoint is defined by a certain timing, on which the transition to a dead-end branch is made.  In the background, the next deadlock is preloaded. <br><br><img src="https://habrastorage.org/files/b68/7d0/801/b687d08015fa4976831e709cf6b5362e.jpg"><br><br>  <b>Total</b> : 1 is lost, 1 is preloaded.  Removed only previous dead ends. <br><br>  <b>Pros</b> : There is no frieze when the user moves along the storyline. <br><br>  <b>Minuses</b> : It is almost impossible to synchronize the frame of transition to a dead end, because the event of a change of position in the video file comes at some intervals that we can not influence in any way.  As a result, the transition to a dead end does not begin with the desired frame, and even with the frieze. <br><br>  <b>Option 3</b> : All video tracks in one file, synchronized by transition time (in one large file, all videos are played in parallel at one time).  Using WebGL, we will be able to display a portion of this file that is equal in size to one particular video file inside.  It sounds scary, seemingly awkward, but still want to try in the near future. <br><br><img src="https://habrastorage.org/files/523/4d7/90b/5234d790b2114cfc8f262cec6e15e7da.jpg"><br><br>  <b>Pros</b> : In theory, the free model: the transition from one part from video to another is one frame of drawing and at 60 fps it is 1/60 of a second. <br><br>  <b>Minuses</b> : The size of the resulting file is not clear yet and how browsers will react to it. <br>  The question arises how to work with sound, most likely you will have to conjure over its synchronization.  In the above options, the sound is sewn to the video tracks. <br><br>  <b>The main disadvantage of all three approaches</b> : if the user has made critical errors at the beginning of the current storyline, then he will continue moving along the plot to the nearest checkpoint with zero health. <br><br>  <b>Solution</b> : we shorten the plot branches as much as possible so that the ‚Äúretribution‚Äù for the committed or imperfect action is immediate.  At the moment, some tracks have a timing of about 5 seconds.  The optimal timing of a single video track after testing on the focus group of about 1,000 people was 15‚Äì20 sec. <br><br>  Yes, looking at it, you will say: ‚Äú <i>Here and does not smell like managing a video series, the maximum that it will pull is a pseudo-control</i> ‚Äù. <br><br>  It really is.  No matter how hard we try, we can‚Äôt talk about complete freedom of control over video.  For cinema, in our opinion, absolute freedom of control is not required.  What is the difference that you give the main character for breakfast, buckwheat or oatmeal?  Put sneakers or sneakers on him.  By management, we mean key actions that can affect the course of the plot: there should be a lot of them and they should be very dynamic.  Every minute chases, fights, shootouts, the choice of dialogue phrases - in one word <a href="https://www.youtube.com/watch%3Fv%3Do1L7I9LujCI">Hardcore</a> , only with a joystick in hand.  Managing melodrama is not for this approach. <br><br>  As a result, I chose <b>Option 1 for</b> working with video. <br><br>  From the point of view of production from the post production, the most difficult part was to hide the ‚Äúteleportation‚Äù of the hero from location to location and some computer graphics.  The number of assembly joints in the 5-minute video was more than 20. Separate attention was paid to the sound: every sound was recorded on the site.  The number of parallel audio tracks is more than 100. <br><br>  <b>Some server history</b> <br><br>  Initially, we tried to run on the web under the hardware we had, and watched the slideshow.  Taking into account the expected load, the question arose of starting a content server that is designed to deliver large amounts of video with a good channel.  Plus, the cheapest traffic is from the <b>CDN</b> , and the video sequence is loaded to the user from the physical server nearest to it.  As a result, all the statics was created under the CDN, the site, scripts and statistics work under a different server. <br><br>  <b>Production</b> <br><br>  It was a test of willpower, fortitude, limits of physical and psychological capabilities of a person.  At the shooting was assigned a week.  At this time, included: writing a script, location scouting, search for extras, shooting themselves.  On average, the shooting day lasted 18-20 hours. <br><br>  By the way, the pedometer of the main character did not digest such a volume of data and died.  Runtastic producer, who ran 5 times less than the main character, showed 91 km of the distance covered in a week. <br><br>  Some scenes were simple, some demanded colossal preparations and were shot in pieces on different days.  Some of the scenes were written blindly without <b>playback</b> .  For example, there was only 5 minutes to go to the stage with Kaspersky: 6 takes in a row with the hope that there would be a shot and then select the best one from the available ones.  The weather contributed 5 kopecks: suitable flight conditions were needed for filming the intro.  As a result, they waited for them on the 6th shooting day.  There was only 20 minutes on the stage until the fire was set.  As a result, he sat down and we took off with our hands.  Also problems with copters were waiting for the last scene.  According to the scenario, at one point in time, in a confined space surrounded by tons of metal structures, five copters were to fly.  The sensors went crazy, the copters threw from side to side.  And on the shooting of this scene, we also had 20 minutes in view of the tests (the largest hexacopter blew one battery per takeoff, and in between times, with its air flow, scattered smaller copters).  Benefit at the helm were piloting aces (students of Innopolis University, who are engaged in robotics) <br><br>  <b>Testers go to paradise out of turn</b> <br><br>  This video haunts them in nightmares.  They know what a man of the crowd was wearing, sitting on an orange pear-chair on the left of the last but one row on a frame with a timing of 1:55 min (do not look for: blue T-shirt and blue pants).  They know how many doors were open, how many steps the main character took, how his pulse changed, and so on.  The number of replays exceeded 3000 times in 2 weeks, which is approximately 250 hours of viewing and gameplay.  The moments of the appearance of the keys were set with an accuracy of 3 decimal places.  Shifting the timing of one event for a split second could break the next series of buttons while waiting.  Therefore, a lot of attention was paid to testing the control model.  In short, testers can pass this game without losing a single unit of self-esteem ... With one hand ... Blindfolded ... <br><br>  <b>Innopolis University</b> <br><br>  Special thanks to the <b>University of Innopolis</b> , which supported our development and helped bring them to life.  Before that, we had 2 products that were not posted on the network, lived only in localhost and waited in the wings.  After their presentation at the university of the future, the idea of ‚Äã‚Äãa new product was born.  In the end, having crossed game development, video production, programming and cinema, we helped the IT university team show selection as exciting as no one in the world had done before. <br><br>  <b>In the near future</b> <br><br>  We plan to refactor and rewrite to <b>TypeScript</b> , since it has support for objects and classes, which is absent in <b>JavaScript</b> and in the latter implemented through crutches, plus we will get high in terms of performance code. <br><br>  Plan launch under mobile browsers and touchscreen control options. <br><br>  Now we are preparing a pilot with a timing of about 40 minutes, several storylines and various ‚Äúbuns‚Äù.  Plans for the distant future potestit camera, which writes the video in 360 and adapt the product for vr points. <br><br>  <b>Here are the promised links</b> <br><br>  <a href="http://demo.runtolife.com/">Demo version</a> (for which we were almost killed in reality. Valiant police thought that a real abduction was taking place. Responding to 4 armed clowns in business suits on a tinted transporter at 4 am was lightning fast. Fortunately, after 20 minutes of discussion, Kazan police officers understood reacted to startups from IT Park).  On the basis of this tie, we are developing the <a href="https://boomstarter.ru/projects/ivp/run_to_live_begi_chtoby_zhit">current full-length project</a> . <br><br>  <a href="http://get-in.innopolis.ru/">Be IT Hero</a> is a production version developed for <a href="http://university.innopolis.ru/">Innopolis University</a> .  Where, as in the city of the future, try to launch similar technologies? <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/280372/">https://habr.com/ru/post/280372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280358/index.html">Monolithic repositories in Git</a></li>
<li><a href="../280360/index.html">Report from Moscow Python Meetup March 18</a></li>
<li><a href="../280362/index.html">Video reports from Zabbix Moscow Meetup 2016</a></li>
<li><a href="../280364/index.html">An exploit for vulnerabilities in Cisco UCS Manager: is the devil so scary?</a></li>
<li><a href="../280370/index.html">Tips, libraries and additional materials on CSS-animation</a></li>
<li><a href="../280374/index.html">Measuring code coverage tests on Android using JaCoCo</a></li>
<li><a href="../280376/index.html">In simple words: We deal with "cloud" services.</a></li>
<li><a href="../280378/index.html">man! (Go => D) .concurrency</a></li>
<li><a href="../280380/index.html">We solve the problem of interception and substitution of DNS queries. DNSCrypt in Yandex Browser</a></li>
<li><a href="../280382/index.html">Yii framework code parsing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>