<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MongoDB: $ or VS $ in - what is faster?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to the cut, there will be a very small comparison of the performance of MongoDB in the cases of using $ or and $ in logical operations in qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MongoDB: $ or VS $ in - what is faster?</h1><div class="post__text post__text-html js-mediator-article">  According to the cut, there will be a very small comparison of the performance of MongoDB in the cases of using $ or and $ in logical operations in queries.  I hope that this note will save someone working time. <br><a name="habracut"></a><br>  Tests run on MongoDB 2.4.9 <br>  Suppose there is a collection of documents in MongoDB.  To simplify the understanding of the essence - let it be documents with exactly two fields. <br><pre><code class="php hljs">$m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MongoClient(<span class="hljs-string"><span class="hljs-string">'mongodb://mongodb01,mongodb02,mongodba/?replicaSet=pkrs'</span></span>); $mdb = $m-&gt;selectDB(<span class="hljs-string"><span class="hljs-string">'test'</span></span>); $collection = $mdb-&gt;selectCollection(<span class="hljs-string"><span class="hljs-string">'test'</span></span>); $collection-&gt;drop(); $collection-&gt;ensureIndex(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $collection-&gt;insert(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; $i, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; $j)); } }</code> </pre> <br>  The collection will be only 10K documents.  Yes, it was possible to use batchInsert here, but I do not want to complicate the understanding of the main essence of the note. <br><br>  It is necessary to regularly (several times per second) sample up to 1000 documents.  The condition of the sample is a set of unrelated pairs <b>i</b> and <b>j</b> . <br>  Since  I started working with MongoDB less than a month ago, then the first thing that came to my mind was this kind of query: <br><pre> <code class="php hljs">$orArray = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $orArray[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; $i, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; $j); } } $query = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$or'</span></span> =&gt; $orArray);</code> </pre><br>  The fact that data here is in order is just for example, in order not to bother with business logic.  In reality, as I noted above, pairs <b>i</b> and <b>j</b> are in no way connected with each other and go in a chaotic order. <br>  Having tried to fulfill this request, my eyes opened wide with an unpleasant surprise - the request was executed for <b>more than 2 seconds</b> !  Above in the code, you can see that the index was created. <br>  It was generally unacceptable. <br>  I decided to make sure that the network does not slow down here, but the point is in the request. <br>  For the test will make the following query: <br><pre> <code class="php hljs">$query = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$lt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$lt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>));</code> </pre><br>  The result for the data volume is the same, but the request is already starting to be performed <b>0.01 seconds</b> . <br>  It became clear that you need to look for a workaround.  And he was found.  According to the logic of the query, it was suggested to use $ in instead of $ or.  But I could not find how to use $ in right away for pairs of values.  If there is such a method, I will be very grateful for the hint. <br>  Since I do not know how to make $ in two fields, then we introduce an artificial field as follows (we blind the values ‚Äã‚Äãof i and j through the underscore "_"): <br><pre> <code class="php hljs">$collection-&gt;ensureIndex(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ij'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $collection-&gt;insert(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; $i, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; $j, <span class="hljs-string"><span class="hljs-string">'ij'</span></span> =&gt; $i.<span class="hljs-string"><span class="hljs-string">'_'</span></span>.$j)); } }</code> </pre><br>  And then our request becomes the following: <br><pre> <code class="php hljs">$inArray = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $inArray[] = $i.<span class="hljs-string"><span class="hljs-string">'_'</span></span>.$j; } } $query = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ij'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$in'</span></span> =&gt; $inArray));</code> </pre><br>  And ‚Äúlo and behold!‚Äù We receive our data in just <b>0.01 seconds</b> (and it all began with ‚Äúmore than 2 seconds‚Äù). <br>  Googling for a bit, I found the following explanation for this phenomenon: when queried with the $ or MongoDB construct, it allegedly makes several queries and then "sleeps" the results.  Not sure if this statement is correct, but I haven‚Äôt yet found another. <br><br>  PS Conclusion: do not abuse $ or <br>  PPS In the code below you can see how I measured the time.  If someone doesn‚Äôt know, I‚Äôll clarify that when you call find () the request is not executed!  Only a MongoCursor object is created.  And only when the first document is requested, the request itself goes.  Therefore, time slices are removed at the first iteration of the document acquisition cycle. <br><div class="spoiler">  <b class="spoiler_title">PPPS If it will be interesting to someone to drive tests at home, then here is the whole source code:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MongoClient(<span class="hljs-string"><span class="hljs-string">'mongodb://mongodb01,mongodb02,mongodba/?replicaSet=pkrs'</span></span>); $mdb = $m-&gt;selectDB(<span class="hljs-string"><span class="hljs-string">'test'</span></span>); $collection = $mdb-&gt;selectCollection(<span class="hljs-string"><span class="hljs-string">'test'</span></span>); $collection-&gt;drop(); $collection-&gt;ensureIndex(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $collection-&gt;insert(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; $i, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; $j)); } } $orArray = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $orArray[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; $i, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; $j); } } $query = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$or'</span></span> =&gt; $orArray); testQuery(<span class="hljs-string"><span class="hljs-string">'OR Query'</span></span>, $collection, $query); $query = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$lt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$lt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>)); testQuery(<span class="hljs-string"><span class="hljs-string">'Range Query'</span></span>, $collection, $query); $collection-&gt;drop(); $collection-&gt;ensureIndex(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ij'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $collection-&gt;insert(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; $i, <span class="hljs-string"><span class="hljs-string">'j'</span></span> =&gt; $j, <span class="hljs-string"><span class="hljs-string">'ij'</span></span> =&gt; $i.<span class="hljs-string"><span class="hljs-string">'_'</span></span>.$j)); } } $inArray = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$j) { $inArray[] = $i.<span class="hljs-string"><span class="hljs-string">'_'</span></span>.$j; } } $query = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ij'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'$in'</span></span> =&gt; $inArray)); testQuery(<span class="hljs-string"><span class="hljs-string">'IN Query'</span></span>, $collection, $query); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testQuery</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($testName, $collection, $query)</span></span></span><span class="hljs-function"> </span></span>{ $cursor = $collection-&gt;find($query); $cursor-&gt;batchSize(<span class="hljs-number"><span class="hljs-number">1000</span></span>); $start = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $first = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($cursor <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $doc) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($first) { $time1 = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $first = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } $time2 = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $resultFirst = $time1 - $start; $resultOther = $time2 - $time1; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"{$testName} - First: {$resultFirst} Other: {$resultOther}&lt;br /&gt;\n"</span></span>; }</code> </pre><br></div></div><br>  <b>UPD 1</b> <a href="http://habrahabr.ru/users/dim_s/" class="user_link">dim_s</a> advised instead of the composite (and from the test above it is clear that the composite was used) to make two separate indexes.  Having done so, the request processing speed accelerated by about 10 times (up to 0.2 seconds), but it still loses to the variant with $ in 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I spread what gives out explain: <br><div class="spoiler">  <b class="spoiler_title">Explain ($ or with composite index)</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* 0 */</span></span> { <span class="hljs-string"><span class="hljs-string">"clauses"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"cursor"</span></span> : <span class="hljs-string"><span class="hljs-string">"BtreeCursor i_1_j_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"isMultiKey"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"n"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjects"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscanned"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjectsAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"scanAndOrder"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"indexOnly"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"nYields"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"nChunkSkips"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"millis"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"indexBounds"</span></span> : { <span class="hljs-string"><span class="hljs-string">"i"</span></span> : [ [ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ] ], <span class="hljs-string"><span class="hljs-string">"j"</span></span> : [ [ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ] ] } }, { <span class="hljs-string"><span class="hljs-string">"cursor"</span></span> : <span class="hljs-string"><span class="hljs-string">"BtreeCursor i_1_j_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"isMultiKey"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"n"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjects"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscanned"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjectsAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"scanAndOrder"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"indexOnly"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"nYields"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"nChunkSkips"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"millis"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"indexBounds"</span></span> : { <span class="hljs-string"><span class="hljs-string">"i"</span></span> : [ [ <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> ] ], <span class="hljs-string"><span class="hljs-string">"j"</span></span> : [ [ <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> ] ] } } ], <span class="hljs-string"><span class="hljs-string">"n"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjects"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscanned"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjectsAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"millis"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"server"</span></span> : <span class="hljs-string"><span class="hljs-string">"mongodb01:27017"</span></span> }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Explain ($ or with two separate indices for i and j)</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* 0 */</span></span> { <span class="hljs-string"><span class="hljs-string">"clauses"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"cursor"</span></span> : <span class="hljs-string"><span class="hljs-string">"BtreeCursor i_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"isMultiKey"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"n"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjects"</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">"nscanned"</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjectsAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-string"><span class="hljs-string">"scanAndOrder"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"indexOnly"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"nYields"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"nChunkSkips"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"millis"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"indexBounds"</span></span> : { <span class="hljs-string"><span class="hljs-string">"i"</span></span> : [ [ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ] ] } }, { <span class="hljs-string"><span class="hljs-string">"cursor"</span></span> : <span class="hljs-string"><span class="hljs-string">"BtreeCursor i_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"isMultiKey"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"n"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjects"</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">"nscanned"</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjectsAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-string"><span class="hljs-string">"scanAndOrder"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"indexOnly"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"nYields"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"nChunkSkips"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"millis"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"indexBounds"</span></span> : { <span class="hljs-string"><span class="hljs-string">"i"</span></span> : [ [ <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> ] ] } } ], <span class="hljs-string"><span class="hljs-string">"n"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjects"</span></span> : <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"nscanned"</span></span> : <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjectsAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-string"><span class="hljs-string">"millis"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"server"</span></span> : <span class="hljs-string"><span class="hljs-string">"mongodb01:27017"</span></span> }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Explain ($ in with artificially entered index)</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* 0 */</span></span> { <span class="hljs-string"><span class="hljs-string">"cursor"</span></span> : <span class="hljs-string"><span class="hljs-string">"BtreeCursor ij_1 multi"</span></span>, <span class="hljs-string"><span class="hljs-string">"isMultiKey"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"n"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjects"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscanned"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedObjectsAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"nscannedAllPlans"</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"scanAndOrder"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"indexOnly"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"nYields"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"nChunkSkips"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"millis"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"indexBounds"</span></span> : { <span class="hljs-string"><span class="hljs-string">"ij"</span></span> : [ [ <span class="hljs-string"><span class="hljs-string">"1_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"1_1"</span></span> ], [ <span class="hljs-string"><span class="hljs-string">"2_2"</span></span>, <span class="hljs-string"><span class="hljs-string">"2_2"</span></span> ] ] }, <span class="hljs-string"><span class="hljs-string">"server"</span></span> : <span class="hljs-string"><span class="hljs-string">"mongodb01:27017"</span></span> }</code> </pre><br></div></div><br>  <b>UPD 2 I</b> drove the test on the latest version of MongoDB 2.6 <br>  Indeed, the initial version (composite index for two fields) works much faster there!  Namely, in 0.07 seconds.  But at the same time, the variant with the index of the form i_j is still in 0.006 - 0.01 seconds (that is, approximately 10 times faster) </div><p>Source: <a href="https://habr.com/ru/post/219913/">https://habr.com/ru/post/219913/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219903/index.html">Habrahabru - 8 years</a></li>
<li><a href="../219905/index.html">Data encryption in a public cloud - control and quiet sleep of the customer</a></li>
<li><a href="../219907/index.html">PHP extension dom_varimport: fast conversion of nested arrays to DOMDocument</a></li>
<li><a href="../219909/index.html">The basic rules of indie gamedev. Part 3</a></li>
<li><a href="../219911/index.html">Cryptography - FSTECU!</a></li>
<li><a href="../219919/index.html">"Orbit" - a simulator of space programs for the development of nearby planets</a></li>
<li><a href="../219925/index.html">Why did Windows Azure become just Azure? Introduction to the platform for users of Linux, Open Source, Oracle DB, Android, iOS and other tools</a></li>
<li><a href="../219927/index.html">Again vkontakte: about the old in a new way</a></li>
<li><a href="../219929/index.html">Introducing New Nokia Imaging SDK 1.2 BETA and SensorCore SDK Developer Toolkits</a></li>
<li><a href="../219941/index.html">Another 2048, now triangular</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>