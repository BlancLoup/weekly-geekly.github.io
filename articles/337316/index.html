<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accidental deletion of root files</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You quietly wander through the $HOME directory, thinking about your business. 

 $ whoami 
 > user 
 
 $ pwd 
 > /home/user 
 
 But something is bothe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accidental deletion of root files</h1><div class="post__text post__text-html js-mediator-article"> You quietly wander through the <code>$HOME</code> directory, thinking about your business. <br><br> <code>$ whoami <br> &gt; user <br> <br> $ pwd <br> &gt; /home/user</code> <br> <br>  But something is bothering you.  It's like a little pebble (little rock) caught in a shoe.  You take off your shoes to see what's wrong. <br><br> <code>$ ls -lah ./left-shoe <br> ---------- 1 root root 4 May 30 13:20 little-rock</code> <br> <br>  Strange.  He is here, but as if he does not belong to you.  He was left <code>root</code> , Rock Tamer, and only he decides his fate. <br><a name="habracut"></a><br> <code># bash -c "echo 'You stay here' &gt; /home/user/left-shoe/little-rock" <br> # chmod 0000 /home/user/left-shoe/little-rock</code> <br> <br>  You reach into your pocket for a phone to quickly call him through <code>sudo</code> .  Suddenly, you feel a surge of strength (due to watching Gladiator last night) and decide to put off the phone in order to test your power. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>$ rm -f ./left-shoe/little-rock <br> $ ls -lah ./left-shoe/little-rock <br> ls: cannot access little-rock: No such file or directory</code> <br> <br>  You look down at your trembling hands, trying to understand: did all this really happen?  Yes.  You really did it.  Without Rock Tamer.  But how? <br><br>  The little pebble in your shoe had no idea what was waiting for it.  As can be seen from his reincarnation, no one had <a href="http://linuxcommand.org/lc3_lts0090.php">any permits</a> for him ( <code>--- --- ---</code> ).  No readings, no records, no action from anyone (owner, group, others). <br><br><h2>  Trick </h2><br>  What happened here is that Rock Tamer has forgotten that you are even more powerful than himself when you are in <code>$HOME</code> .  And that's why. <br><br>  To be able to do something with the file, first of all you need to find it in the directory.  The listing of directory contents is controlled by the execution flag.  If the user has permission to execute in this directory, he can see its contents.  Also, the execution flag for the directory gives access to the <code>inode</code> for the files in this folder, which is crucial in this context, since the deletion process <a href="https://linux.die.net/man/2/unlinkat">detaches the</a> file. <br><br>  Then, the removal process.  Renaming or moving a file does not include a <code>write()</code> system call.  In practice, we don‚Äôt need any permissions to delete a file and we don‚Äôt care who owns it.  The only requirement is to have permissions to write to the parent directory (and the execution flag for the parent directory). <br><br>  The <code>$HOME</code> directory naturally meets both of these requirements from the user's point of view. <br><br><h2>  Anti trick </h2><br>  If Rock Tamer really didn‚Äôt want strangers to touch his pebbles, he would do the following: <br><br> <code># chattr +i /home/user/left-shoe/little-rock</code> <br> <br>  This operation ensures the immutability of the file, which, among other things, prevents its deletion.  Excerpt from the manual: <br><br><blockquote>  <i>The file with the attribute 'i' cannot be changed: it cannot be deleted or renamed, a link cannot be created to this file and no data can be written to it.</i>  <i>Only the superuser or process owning CAP_LINUX_IMMUTABLE can set or remove an attribute.</i> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/337316/">https://habr.com/ru/post/337316/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337306/index.html">Docker Basics in X hours and Y days</a></li>
<li><a href="../337308/index.html">Lannisters always pay their debts! (and technical too)</a></li>
<li><a href="../337310/index.html">Mathematical modeling of traffic flows</a></li>
<li><a href="../337312/index.html">11 free cyrillic fonts</a></li>
<li><a href="../337314/index.html">Object to iterate, iterator and generator</a></li>
<li><a href="../337318/index.html">Our way to the green cart</a></li>
<li><a href="../337320/index.html">Dagger2 and architectural component "ViewModel"</a></li>
<li><a href="../337324/index.html">FullStack 2017 in London: details</a></li>
<li><a href="../337328/index.html">How we taught the Yandex.Taxi application to predict a destination</a></li>
<li><a href="../337330/index.html">What programming language to choose to work with data?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>