<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GnuPG on smart cards. What it looks like ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Almost everyone knows what GPG is. Many use it. Some even know that it is possible to store secret keys on external media such as a smart card. I want...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GnuPG on smart cards. What it looks like ...</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8c9/820/b29/8c9820b2987c212c1509dda917482772.jpg" alt="image" align="left"><br>  Almost everyone knows what GPG is.  Many use it.  Some even know that it is possible to store secret keys on external media such as a smart card.  I want to describe how it all looks in practice. <br><br>  A couple of days ago a pair of ‚ÄúOpenPGP SmartCard v2‚Äù came to me.  They were <a href="http://shop.kernelconcepts.de/index.php%3Flanguage%3Den">ordered</a> from their official distributor - <a href="http://shop.kernelconcepts.de/index.php%3Flanguage%3Den">shop.kernelconcepts.de/index.php?language=en</a> .  The price of one card at the moment is 17.14 euros.  Two ordered cards were sent by something like a registered letter and the transfer cost me 5 euros, which is very good.  I was also pleased that the cards passed through customs without any problems.  I'm not sure that this will be the case with a large number, but for personal use, I think, you can order safely enough. <br><br><a name="habracut"></a>  And here they are with me ... <br><img src="https://habrastorage.org/getpro/habr/post_images/dc9/527/f8c/dc9527f8cfc85ad114a1f6d45d1834b6.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Both are packed in separate bags and in each memo about PIN codes by default and about three attempts of input. <br><br>  A little earlier, to study various smart cards, I purchased a SCR331 card reader.  OpenPGP cards they read no worse than others. <br><br>  First of all, to work (Ubuntu 10.04 LTS), you need to start the pcscd service.  After that we insert the card and do the pcsc_scan command.  If everything is normal, the technical data of the card is displayed in the console. <br><br>  Next, we try to view the map via gpg (there are already keys on the map): <br><br><pre> $ gpg --card-status
 gpg: detected reader SCM SCR 331 (21121046203464) 00 00 '
 Application ID ...: D2760001240102000005000010C00000
 Version ..........: 2.0
 Manufacturer .....: ZeitControl
 Serial number ....: 000010C0
 Name of cardholder: [not set]
 Language prefs ...: de
 Sex ..............: [not installed]
 URL of public key: [not set]
 Login data .......: [not set]
 Private DO 1 .....: [not installed]
 Private DO 2 .....: [not installed]
 Signature PIN ....: forced
 Key attributes ...: 2048R 1024R 2048R
 Max.  PIN lengths.: 32 32 32
 PIN retry counter: 3 0 3
 Signature counter: 6
 Signature key ....: 4F3B 52C3 23FF 3931 6774 E694 3D10 7955 72D5 82DB
       created ....: 2011-10-18 11:52:30
 Encryption key ....: 82CB 2DB7 7DDD 6E56 5CB6 21B9 598A 49D6 B3F3 F028
       created ....: 2011-10-18 11:52:30
 Authentication key: F159 6F7E D472 5CD0 7161 F00E 554E 78F8 CABD 115C
       created ....: 2011-10-18 11:52:30
 General key info ..: pub 2048R / 72D582DB 2011-10-18 John Smith &lt;john@smith.org&gt;
 sec&gt; 2048R / 72D582DB created: 2011-10-18 valid until: never     
                       card number: 0005 000010C0
 ssb&gt; 2048R / CABD115C Created: 2011-10-18 Pass until: never     
                       card number: 0005 000010C0
 ssb&gt; 1024R / B3F3F028 created: 2011-10-18 valid until: never     
                       card number: 0005 000010C0
</pre><br><br>  With the help of the ‚Äúgpg --card-edit‚Äù command you can change your personal data: owner's name, preferred language, gender, and others.  Very interesting field "URL of public key", but more on that later. <br><br>  Also, using the ‚Äúgpg --card-edit‚Äù command, you can generate keys on the card.  In this procedure, the public key and the pseudo-secret key are inserted into the GPG database in the file system, in which the secret key itself is replaced by a stub, indicating that it is actually located on the smart card. <br><br>  Well, what's next?  Then I personally became interested in two questions: <br><ol><li>  Is it possible to make a backup copy of your regular key on the card in order to use it in case of loss of the usual one? </li><li>  Is the key on the smart card self-sufficient, for example, with its help, to organize work from another's computer? </li></ol><br><br><h2>  Backup copy of the existing key </h2><br>  Based on my experiments, I assume that the optimal order for creating a backup copy of your key on the card is as follows: <br><ol><li>  Create a backup key secret on disk using the command ‚Äúgpg --export-secret-key &lt;key id&gt;‚Äù; </li><li>  Enter the key with the command ‚Äúgpg - edit-key &lt;key id&gt;‚Äù; </li><li>  Go to the part of the secret keys with the command "toggle"; </li><li>  The keytocard command transfers the key for signing.  In the next dialog, select the line "Key for signing"; </li><li>  Switch to the next key, which is used for encryption, with the command ‚Äúkey 1‚Äù; </li><li>  Using the keytocard command, we transfer the key to the card.  In the next request, gpg should give one option - ‚ÄúKey for encryption‚Äù.  Choose it and wait for the transfer. </li><li>  Exit with the command ‚Äúsave‚Äù; </li><li>  Delete the secret key with the command ‚Äúgpg --delete-secret-key &lt;key id&gt;‚Äù; </li><li>  Restoring the secret key from the backup copy with the command ‚Äúgpg --import &lt;file name&gt;‚Äù; </li></ol><br>  After that you will have backup copies of your secret keys on your card. <br><br><h2>  Key self-sufficiency on a smart card </h2><br>  In the process of studying, it turned out that in order to ‚Äúload‚Äù the description of secret keys from a smart card, the GPG database must have a public key associated with the keys on the card (the usual public key of the bundle). <br><br>  Then to ‚Äúsynchronize‚Äù the database with the card, it is enough to execute the ‚Äúgpg --card-status‚Äù command.  After it has been executed, secret key stubs will be created in the GPG database and the key can be fully used. <br><br>  In order not to carry your public key everywhere with you, you can use its location on the Internet (as a file available via http or on one of the key servers) and specify the location of your public key in the URL of public key card parameter.  I checked the operation of this property, indicating in it the url of the hkp server on which my public key is present. <br><br>  If there is a correct entry in the map parameter ‚ÄúURL of public key‚Äù, preparing the card for work at a new place (of course, if you have access to the Internet) is reduced to the execution of two commands: <br><ol><li>  gpg --card-edit and the subsequent fetch command in the gpg shell; </li><li>  gpg - card-status </li></ol><br>  After that you have your full-featured key on the system and can work with it. <br><br><h2>  Using </h2><br>  Using GPG with a smart card is almost the same as normal use.  In addition, instead of the key phrase, you need to enter the PIN code of the card.  If the card is not inserted into the card reader, a message about the necessity to insert a card is displayed during key operations in the console mode. <br><br>  Unfortunately, it turned out that the version of the GPA shell (0.9.0) that I have is not able to work correctly with the keys on the smart card.  For some reason, she does not expect to enter the PIN code of the card, but immediately indicates that the operation cannot be completed.  Although, somewhere in the next window the pin-code request window hangs.  Perhaps in other shells the situation is better.  Well, and, of course, I am glad that at least everything works fine from the console. <br><br>  In general, storing secret keys on a smart card is, of course, much more secure than in a key database on a computer or on a flash drive.  And, of course, much more convenient when moving and the need to organize work with GPG from unfamiliar computers. </div><p>Source: <a href="https://habr.com/ru/post/130754/">https://habr.com/ru/post/130754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130748/index.html">Web Standards Days, Minsk 2011</a></li>
<li><a href="../130750/index.html">GLONASS is built into iPhone 4S</a></li>
<li><a href="../130751/index.html">Windows iCloud Control Panel</a></li>
<li><a href="../130752/index.html">RIW starts with Farminers: 200,000 rubles to a start-up winner</a></li>
<li><a href="../130753/index.html">Speech Synthesis in Chrome</a></li>
<li><a href="../130759/index.html">Using a smartphone as a keylogger for PC</a></li>
<li><a href="../130761/index.html">Bootstrapping like stupidity or cowardice?</a></li>
<li><a href="../130762/index.html">Programming Championships and more</a></li>
<li><a href="../130763/index.html">The recipe for cooking Xubuntu, or a netbook for a spouse</a></li>
<li><a href="../130764/index.html">46,000 people completed their first homework in ai-class</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>