<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Min-Long Chou: What I designed for Uncharted 4. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The official release of the game Uncharted 4 has already taken place, and now I can tell you exactly what I was developing for this project. Basically...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Min-Long Chou: What I designed for Uncharted 4. Part 2</h1><div class="post__text post__text-html js-mediator-article">  The official release of the game Uncharted 4 has already taken place, and now I can tell you exactly what I was developing for this project.  Basically, I was busy creating artificial intelligence for a non-player character (NP) from a single game and for bots from a multiplayer, and also worked on some game logic.  In this part of the article I will talk about transport management, the behavior of the NP in the dialogues and the localization of the game in Chinese. <br><br><img src="https://habrastorage.org/web/201/1ed/604/2011ed60477d4d428186147e84f7529c.jpg"><br><a name="habracut"></a><br><br>  The previous part of the article is <a href="https://habrahabr.ru/company/plarium/blog/328190/">here.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Doctors </h3><br>  Doctors from multiplayer mode had to set up a completely new type of behavior that is not found in any single player in a single game: watch out for wounded allies and repeat the behavior of the players in the shelter. <br><br><img src="https://habrastorage.org/web/4ed/001/a52/4ed001a5239741619e973cb56532187c.png"><br><br>  Doctors are trying to imitate the behavior of the players in the shelter and keep as close as possible, if necessary, to quickly come to the rescue.  If an ally is wounded nearby, the medic will revive him, provided that the player is not injured at the moment.  If a player has a RevivePak mod, doctors will throw a first aid kit (RevivePak) before running to the rescue - this helps save time for recovery.  When throwing a first-aid kit, the logic and animation of a grenade throw is completely repeated, with the only exception that a first-aid kit is used instead of a grenade. <br><br><img src="https://habrastorage.org/web/a3f/e45/8f3/a3fe458f32d34f21845e7d23251200e4.png"><br><br><h3>  Stealth </h3><br>  Another novelty in the game is the high grass areas, which increase the player's secrecy and allow you to sneak in unnoticed.  We plotted grass plots so that, from the point of view of game logic, it would be clear when the player becomes imperceptible.  Initially, we planned to instruct the artists on the backgrounds to create a collision model for grass sections in Maya.  But communication between artists and designers greatly increased the iteration time.  Therefore, we chose a different approach and stopped at the markup of the plots, as shown below.  Designers got a new tag that allows you to mark up areas with high accuracy.  Having these additional data, we can also estimate the points of secrecy based on whether they are in the grass or not.  This optimizes the behavior of the TM, allowing them to understand when the player enters the stealth mode, and repeat after him. <br><br><img src="https://habrastorage.org/web/a21/0b7/1e0/a210b71e0954425ca36f85ea44080705.png"><br><br><h3>  Alarm levels </h3><br>  Since there is no hearing mode in Uncharted 4, as in The Last of Us, it was necessary to think of a way to inform the player about the threats in order not to take him by surprise.  Therefore, we have implemented color alarm indicators, which are based on data about the perception of the environment by opponents.  Indicators notify the player that the opponent will now notice (white) or has already noticed (yellow) suspicious activity near itself, or has discovered the player (orange).  Together with the indicator, we use a buzzing sound on the background that creates tension, as well as a sharp and short sound (as in The Last of Us), signaling that the presence of the player has become known. <br><br><img src="https://habrastorage.org/web/c72/6eb/6e5/c726eb6e5a6e4a8c89789fd8b0f72e2f.png"><br><br><h3>  Inspections </h3><br>  This is one of the last major features of the game, in the development of which I participated.  There was a period when rallies were held in Naughty Dog almost every week under the direction of Bruce Straley or Neil Drackmann.  At these meetings, special attention was paid to the development of AI in the game, and almost every one of them made a decision to change or modify something in the inspection system.  With it, we had to go through a lot of iterations, before it turned out that, as a result, it was included in the final version. <br><br>  When opponents notice something suspicious, they go to inspect the relevant site.  Usually this is caused by two circumstances: the found body or the signs of the immediate presence of the player.  An adversary who has noticed a suspicious activity will try to call one of his buddies nearby to conduct an inspection together.  The one who is closest to the source of suspicious activity becomes an inspector, and the other - an observer.  Accordingly, the one who noticed can get any of these roles, and especially for this we have worked through various options for the dialogs: ‚ÄúI noticed something there, I'll go check it out‚Äù or ‚ÄúI noticed something there, go check it out‚Äù. <br><br>  To make the beginning and end of the inspection look natural, we varied the actions of the opponents and the time to normalize their alarm indicators.  Thus, the inspector and the observer will not act mechanically, simultaneously performing the same actions. <br><br><img src="https://habrastorage.org/web/bd2/30e/60b/bd230e60bfeb43f2be650ac395d51af6.png"><br><br>  If a body is found, the inspector will immediately understand that the player is somewhere nearby.  He will finally come out of the state of rest and tell the others to start looking for a player.  The detected body will also be highlighted, so that the player knows exactly what has issued it. <br><br><img src="https://habrastorage.org/web/fd2/cd6/56a/fd2cd656a16f49ae9ee08164a1a4de54.png"><br><br>  At higher levels of difficulty during inspections, opponents may behave more aggressively, increasing the chances of finding a player who is hiding in the grass.  At the Crushing difficulty level, opponents will always behave aggressively during inspections. <br><br><h3>  Dialogue behavior </h3><br>  Dialogue behavior refers to logic that forces characters to react to each other‚Äôs cues in a certain way: with gestures, attitudes, etc. Previously, The Last of Us development team took several months to manually write reaction characters for all dialogues. .  But we did not want to do the same amount of work.  We had some dialogs with manually-written behavior, but we needed a system that would take care of the other replicas.  Animators got the parameters to adjust the speed of turning the head, the maximum angle of rotation, the duration of the look, etc., and in the end we managed to achieve good results. <br><br><img src="https://habrastorage.org/web/734/180/3fd/7341803fdc5740419a909bcf0dcc33e3.png"><br><br><h3>  Transport management </h3><br>  One of the first difficulties with the driving system, which arose when testing at the level of Madagascar, was that when it collided with the wall or machine of the enemy, the player‚Äôs jeep suddenly lost speed.  As a result, the player was behind the convoy and lost the level. <br><br>  I suggested temporarily limiting the angular velocity and changing the direction of the linear velocity in a collision.  In the end, this simple solution turned out to be very effective, and now the risk of losing due to a sharp loss of speed is minimal. <br><br><img src="https://habrastorage.org/web/6be/64b/6fe/6be64b6fee1545dba088c229c7569f54.png"><br><br><h3>  Vehicle damage </h3><br>  In Uncharted 4, for the first time in the entire history of the line, it became possible to drive vehicles.  In previous parts, the NPs were driving and the movement was carried out strictly along fixed routes. <br><br>  I helped design the damage system.  There are many ways to disable the enemy's transport: shoot at it a sufficient number of times, kill the driver, knock down a motorcycle, or ram and turn the opponent's jeep with your jeep.  Depending on the chosen method with passengers, this or that animation will be played.  Realistic images are created through the use of ragdolls with all the laws of physics.  As a result, the animation goes smoothly into the physical simulation of the wreckage. <br><br><img src="https://habrastorage.org/web/91f/d18/0fc/91fd180fc8404641970b382859f726a3.png"><br><br>  To imitate the destruction of a motorcycle from a collision, we used two types of data: the intersection of its invisible frame in the XZ planes (see image below) and the point of contact with the player's car.  Based on these data, the system selects one of four animations of destruction. <br><br>  As for the jeep's coup, for this, the rotational deviation of the jeep from the desired direction of movement is checked with the coup threshold. <br><br><img src="https://habrastorage.org/web/a3d/213/1a4/a3d2131a4c9c42f78462e8bb3923e409.png"><br><br>  When playing a destruction animation, there is a chance that a car or motorcycle will pass through the wall.  To solve this, we used a sphere stretched from the point of the ideal position of the transport along the path, as if it had not been destroyed, to the point where the transport itself is located.  If the sphere comes into contact with the surface, the transport shifts in the direction of the normal to the point of contact, as far as the degree of penetration requires.  All this happens gradually, over many frames, and thus the collision is prevented. <br><br><img src="https://habrastorage.org/web/e3a/ff0/c39/e3aff0c3948a4b87ac4baa5f4fd1f1a6.png"><br><br>  We also developed a particularly spectacular form of transport disruption, for which a number of special animations of destruction, context-sensitive and able to interact with the environment, were created.  Animators and designers placed a number of so-called windows along the curves along which the movement of traffic is expected.  If a player destroys an enemy transport unit within such a window, a special destruction animation is triggered.  One example is the epic explosion of a jeep in demo 2015 E3. <br><br><h3>  Bayer Matrix and Dithering </h3><br>  We didn‚Äôt want the camera to simply cut off objects of the environment when it comes too close to them.  This was especially true for foliage.  Therefore, we decided to blur pixels in pixel shaders as they approach the camera.  Using transparency would be too expensive, and besides, there is a lot of foliage in the game and this could affect performance.  We resorted to <a href="https://en.wikipedia.org/wiki/Dither">dithering</a> .  When combining the pixel distance from the camera with the <a href="https://en.wikipedia.org/wiki/Ordered_dithering">Bayer</a> structured <a href="https://en.wikipedia.org/wiki/Ordered_dithering">matrix,</a> part of the pixels were completely cut off, creating the illusion of transparency. <br><br><img src="https://habrastorage.org/web/3e1/ee2/75d/3e1ee275d7f24991a70704dd08297060.png"><br><br>  Initially, we used the Bayer 8x8 matrix, as <a href="https://en.wikipedia.org/wiki/Ordered_dithering">described here</a> .  But it seemed to me that it was too small, moreover, after it, there were artifacts in the form of concentric circles in the picture.  I wanted to use a 16x16 Bayer matrix, but it was not found on the Internet.  As a result, I tried to analyze and rework the 8x8 matrix pattern and revealed a pattern in it.  Of course, you could do it manually, but I wanted to have a little fun, and I wrote a tool to generate Bayer matrices for any power of two. <br><br><img src="https://habrastorage.org/web/5e2/fe4/901/5e2fe4901f554cc9b8904846aac65179.gif"><br><br>  Replacing the matrix, we have made significant progress in the fight against artifacts. <br><br><img src="https://habrastorage.org/web/6d9/8ac/d2a/6d98acd2a5074c3ebf29df0d0376057c.png"><br><br><h3>  Delay sound during an explosion </h3><br>  This is a very minor edit, but I would still like to mention it.  A couple of weeks before the release of the 2015 E3 demo, I noticed one thing: during the explosion of the tower, the sound from the explosion came immediately, and not with a delay.  It was wrong, because Sally and Neith were at a decent distance from her.  I reported this miscalculation, and as a result, the sound delay was added to the final version of the video. <br><br><h3>  Localization in Traditional Chinese </h3><br>  It so happened that I was able to familiarize myself with the localization into traditional Chinese just two weeks before the release of the game.  To my surprise, I discovered several errors there.  Most of them were due to a literal translation from English, as a result of which the text looked unnatural.  I did not expect to complete the entire game in Chinese in such a short time, simultaneously revealing translation errors.  Therefore, I asked several people from the QA department to go through separate chapters of the game in Chinese and record it on video.  Then I looked through all the videos and noted the errors found in them, after which I transferred all the materials to the localization team.  Thus, we managed to correct all errors in time. <br><br><h3>  That's all </h3><br>  That's all I wanted to tell.  I hope you enjoyed my article. </div><p>Source: <a href="https://habr.com/ru/post/328360/">https://habr.com/ru/post/328360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328348/index.html">Making any object thread safe</a></li>
<li><a href="../328352/index.html">Top 10 Mistakes Made by Django Developers</a></li>
<li><a href="../328354/index.html">Comparison of PVS-Studio C # and static analyzer built into Visual Studio based on the code of the CruiseControl.NET project</a></li>
<li><a href="../328356/index.html">As we did the third internship in iOS and Android development at Redmadrobot</a></li>
<li><a href="../328358/index.html">Fatty programs - we study the factor of memory part B</a></li>
<li><a href="../328362/index.html">Accelerate std :: shared_mutex 10 times</a></li>
<li><a href="../328364/index.html">Crystal High Performance Services, Newbie Introduction</a></li>
<li><a href="../328366/index.html">Build 2017: text translation. Day 2</a></li>
<li><a href="../328368/index.html">Distributed data structures (part 2, how it's done)</a></li>
<li><a href="../328370/index.html">Should I buy ECC memory?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>