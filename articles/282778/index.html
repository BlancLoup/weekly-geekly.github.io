<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Journey to Onionland: hacking a hidden service from the darknet in the task NeoQUEST-2016</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While registration for the St. Petersburg ‚Äúconfrontation‚Äù of NeoQUEST-2016 continues, which anyone can visit, we continue to review the tasks of the o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Journey to Onionland: hacking a hidden service from the darknet in the task NeoQUEST-2016</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/57e/459/0b5/57e4590b5c11436390d2239bc21fd7f7.png">  While registration for the St. Petersburg <a href="http://neoquest.ru/">‚Äúconfrontation‚Äù of NeoQUEST-2016</a> continues, which anyone can visit, we continue to review the tasks of the online stage. <br><br>  And next in turn is the task ‚ÄúThese bitter onion tears‚Äù, in which the participants were to break into the hidden service, located on Onionland darknet.  Access to such services is possible only through the Tor network and only by name, but otherwise they are no different from ordinary sites.  There were two fundamentally different ways to solve the task: <br><ul><li>  manual vulnerability search; </li><li>  setting up a web vulnerability scanner to work with .onion sites. </li></ul><br>  Analysis of both methods - under the cut! <br><a name="habracut"></a><br><h4>  <b>Initial data</b> </h4><br>  Participants were given the address of the site cx7b2vy6foxjlzsh.onion and the user name randomradon, whose password had to be obtained. <br><br>  The pseudo-top-level domain .onion indicates that the site is on the Tor network.  To enter such a site, you need to use either Tor Browser, or services like tor2web or onion.city.  Anyway, once on the site, you can see the following picture: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/63e/6db/c08/63e6dbc08e6a4ca580d2e1a3d14c8bac.PNG"><br><br>  Here the opinions of participants on what to do next, diverged.  Someone was looking for a vulnerability "manually", someone used a web vulnerability scanner to work with .onion-sites.  Consider both ways. <br><br><h4>  <b>Method 1 - look for the vulnerability "manually"</b> </h4><br>  Browsing the site does not give anything interesting, except for numerous indications that the site is under construction.  This hints at the possible presence of debug pages.  Indeed, having tried various standard names, you can find the test.html page with some forms. <br><br><img src="https://habrastorage.org/files/add/a81/1ed/adda811edd0b4039acb5701a93c1719d.PNG"><br><br>  The last form sends a request to the server and contains a SQL injection (this can be detected, for example, by leaving the input field empty when the form is submitted). <br><br><img src="https://habrastorage.org/files/b4c/938/4f7/b4c9384f7a04405d8c2b5c1ac853a541.PNG"><br><br>  Next you need to understand what the server returns.  The simplest query indicates that the md5 hash is returned from a single query result: <br><br><pre><code class="php hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> UNION SELECT <span class="hljs-number"><span class="hljs-number">1</span></span>; --</code> </pre> <br><br>  The next step is to retrieve the available databases.  Obviously, a query like this: <br><br><pre> <code class="php hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> UNION SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA LIMIT <span class="hljs-number"><span class="hljs-number">1</span></span> OFFSET <span class="hljs-number"><span class="hljs-number">0</span></span>; --</code> </pre><br><br>  cannot retrieve the name, as it returns the hash of the database name, not the name itself.  This can be bypassed by spelling the names using the SUBSTR () function and determining the extracted letter by the hash: <br><br><pre> <code class="php hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> UNION SELECT SUBSTR(SCHEMA_NAME, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) FROM INFORMATION_SCHEMA.SCHEMATA LIMIT <span class="hljs-number"><span class="hljs-number">1</span></span> OFFSET <span class="hljs-number"><span class="hljs-number">0</span></span>; --</code> </pre><br><br>  The database contains three schemes: <br><ul><li>  information_schema </li><li>  test </li><li>  torsite </li></ul><br>  Next, using queries like <br><br><pre> <code class="php hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> UNION SELECT SUBSTR(TABLE_NAME, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=<span class="hljs-string"><span class="hljs-string">"TORSITE"</span></span> LIMIT <span class="hljs-number"><span class="hljs-number">1</span></span> OFFSET <span class="hljs-number"><span class="hljs-number">0</span></span>; --</code> </pre><br><br>  You can get the tables in torsite (test was empty): <br><ul><li>  key </li><li>  message </li><li>  user </li></ul><br>  Then, in a similar way, you can get table fields, see that passwords are stored in the user table, retrieve the randomradon user password (stored as a hash), and draw a hash (for example, using online services or rainbow tables). <br><br><h4>  <b>Method 2 - use scanners</b> </h4><br>  The easiest way to find a vulnerability in a site is to use a vulnerability scanner!  But to configure the scanner to work with hidden services Tor - not such an easy task.  The main problem is that many scanners rely on the site‚Äôs IP address.  The Tor network does not use IP addresses, and the scanners do not work correctly. <br><br>  The popular <a href="https://nmap.org/">Nmap</a> scanner can be configured to work on the darken Tor.  To do this, do the following: <br><ol><li>  Download and install a special version of nmap-nseportscan-socks4a </li><li>  Add the entry ‚Äú127.0.0.1 cx7b2vy6foxjlzsh.onion‚Äù to the hosts file, this avoids the error of the name resolution cx7b2vy6foxjlzsh.onion </li><li>  Download and run Tor </li><li>  Run nmap as root using the following parameters: <br></li></ol>  sudo ./nmap -sK --script connectscan, &lt;script list&gt; --proxy socks4a: //127.0.0.1: 9050 cx7b2vy6foxjlzsh.onion ‚ÄìF <br><br>  Nmap does not find vulnerabilities, but it detects a potentially interesting test page: <br><br><img src="https://habrastorage.org/files/d41/fc3/2b4/d41fc32b47574204acf32671efd10c9d.png"><br><br>  After examining the code of the page, in one of the scripts you can find a query that ‚Äúmisses‚Äù Nmap: <br><br><img src="https://habrastorage.org/files/fe8/18a/6d9/fe818a6d9f1649a499cf2259d629bed4.png"><br><br>  To explore a separate query, it is more convenient to use Sqlmap.  This tool supports work with .onion-sites, no special configuration is needed, the launch is carried out by the command: <br><br>  python sqlmap.py -u "cx7b2vy6foxjlzsh.onion/qwertyqwerty.php" --data = "id = 1" --tor --tor-port = 9050 --tor-type = SOCKS5 <br><br>  Sqlmap detects SQLi vulnerability: <br><br><img src="https://habrastorage.org/files/13d/0ef/18f/13d0ef18f09f42ce83dfe44053706f5a.PNG"><br><br>  Then, using Sqlmap, you can pull out all the necessary information about the database: <br><br><img src="https://habrastorage.org/files/21d/efb/e00/21defbe009ab4efea3b3d8b3bcd1a633.PNG"><br><br>  Sqlmap receives data even though it is returned as a hash.  Impossibility of direct data retrieval is bypassed with the help of Time-based blind SQLi and Boolean-based blind SQLi techniques.  Both techniques extract information character by character, the value of the symbol is found in a binary search: with each request, the next character is compared with a certain number. <br><br>  When using the first technique, SLEEP () is inserted into the request if the condition is met;  By the time it takes to respond to a request, Sqlmap understands whether the condition has been met or not.  When using the second technique, Sqlmap compares the result of the query with some previously obtained pattern and, based on this, determines whether the condition was fulfilled. <br><br>  Time-based blind SQLi is not suitable for use on the Tor network due to large (and often random) delays;  but Boolean-based blind SQLi works fine.  Character by character, Sqlmap "sucks" the database. <br><br><h4>  <b>To be continued</b> </h4><br>  Usually darknet is associated with mysterious, secret networks, the dark corners of which are teeming with illegal activities: managing botnets, selling drugs, etc. Such a presentation is not quite true, because illegal content is not at all the main purpose of the darknet.  However, it cannot be denied that there are really dangerous hidden sites and services. <br><br>  Fewer tasks of the online stage remain to be disassembled, and less time is left before the ‚Äúconfrontation‚Äù, in the program of which there are a lot of reports on a wide variety of topics!  We will talk about Intel ME security, how to find bots in social networks, talk about the vulnerability of public wireless networks, ‚Äúclimb‚Äù into the processor, discuss Intel SGX and Intel MPX, tell you what dangers await ‚Äúmods‚Äù - users of all kinds of ‚Äúsmart‚Äù Gadgets, and <a href="http://neoquest.ru/">much much more</a> ! </div><p>Source: <a href="https://habr.com/ru/post/282778/">https://habr.com/ru/post/282778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282764/index.html">Why PostgreSQL is better than other open source SQL databases. Part 1</a></li>
<li><a href="../282766/index.html">4 tools on the shelves. Project Management with WBS, Gantt Chart, CPM and Time-Cost</a></li>
<li><a href="../282770/index.html">Recovering PostgreSQL data after pg_control loss</a></li>
<li><a href="../282772/index.html">The digest of interesting materials from the world of Drupal # 20</a></li>
<li><a href="../282776/index.html">Linux programming interface</a></li>
<li><a href="../282780/index.html">The path of the laplacian. Part 2</a></li>
<li><a href="../282782/index.html">About the unconventional way to use a computer mouse</a></li>
<li><a href="../282784/index.html">The art of rx</a></li>
<li><a href="../282786/index.html">Internet bees, or the green future of M2M applications</a></li>
<li><a href="../282788/index.html">Evolution of programming languages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>