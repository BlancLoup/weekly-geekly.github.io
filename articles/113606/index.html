<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visitor pattern for handling exception hierarchy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Exceptions in C ++ are one of the most serious mechanisms of a language. Providing powerful enough features for analyzing and handling errors. But wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visitor pattern for handling exception hierarchy</h1><div class="post__text post__text-html js-mediator-article">  Exceptions in C ++ are one of the most serious mechanisms of a language.  Providing powerful enough features for analyzing and handling errors.  But working with exceptions is not always that convenient. <br><br>  In this article I want to share the solution that is successfully used in the project with which I am currently working.  I think the most shrewd ones have already understood what my idea is.  To whom it is still interesting, I propose to sort out more. <br><br><a name="habracut"></a>  The project with which I am working now has a plugin architecture, with its own plugins for working with resources, the console, and many more things.  Not so long ago, we started writing unit tests for new modules, and the very first task we faced was to get rid of the use of other plug-ins in code.  This resulted in a new approach to the design of modules, and the exceptions here occupied one of the main roles. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We have accepted that exceptions do not store any messages about an error that has occurred (since they will have to be crawled into resources).  At best, through what () you can get the file and the line from where the exception was thrown.  For each type of error, its own type of exception must correspond.  The exception class must store only the values ‚Äã‚Äãrequired for error analysis.  Our system is relatively large, and with this approach, each plug-in has a hierarchy of 7 to 20 exceptions. <br><br>  The first problem we encountered is the duplication of the code.  In the best case, each plug-in has three points from where the code that generates exceptions can be called, and each such point has a large catch list, where each type of exception displays its own error text or some other processing is performed.  With the addition of new exceptions it becomes even more fun, the programmer should skip at least one point to catch exceptions, and a potential bug appears.  Of course, such situations are immediately covered by the unit or component tests and are detected quickly, but as they say: ‚Äúthe best correction of an error is to eliminate the possibility of its occurrence‚Äù. <br><br>  The idea is that the exceptions of each module should have its own base class with methods for the work of the visitors mechanism: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Exceptions { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBase</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( IVisitor &amp; _visitor )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; }; } <span class="hljs-comment"><span class="hljs-comment">// namespace Exceptions</span></span></code> </pre> <br>  Also, a visitor interface is created in which the methods are declared for ‚Äúvisiting‚Äù all types of module exceptions: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Exceptions { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IVisitor</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~IVisitor() {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CannotOpenFile </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; _exception )</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( NotHaveSpace </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; _exception )</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; }; } <span class="hljs-comment"><span class="hljs-comment">// namespace Exceptions</span></span></code> </pre><br>  An implementation of exceptions would look something like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Exceptions { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CannotOpenFile</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IBase { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: CannotOpenFile( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; _filePath ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> () : m_path( _filePath ) { } <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; getPath() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_path; } <span class="hljs-comment"><span class="hljs-comment">/*virtual*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( IVisitor &amp; _visitor )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ _visitor.visit( *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> m_path; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotHaveSpace</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IBase { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">/*virtual*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( IVisitor &amp; _visitor )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ _visitor.visit( *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ); } }; } <span class="hljs-comment"><span class="hljs-comment">// namespace Exceptions</span></span></code> </pre><br>  Instead of catching all types of exceptions, only the base type is caught, and to handle such an exception, a visitor with the necessary purpose is used: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*_argc*/</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*_argv[]*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = EXIT_SUCCESS; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { MyFile file; file.open( <span class="hljs-string"><span class="hljs-string">"file.my"</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( Exceptions::IBase <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; _exception ) { Exceptions::Visitors::<span class="hljs-function"><span class="hljs-function">Messenger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visitor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">cerr</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>; _exception.accept( visitor ); result = EXIT_FAILURE; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br>  The Exceptions :: Visitors :: Messenger visitor will look something like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Exceptions { <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Visitors { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Messenger</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IVisitor { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Messenger( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ostream &amp; _outputStream ) : m_outputStream( outputStream ) {} <span class="hljs-comment"><span class="hljs-comment">/*virtual*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CannotOpenFile </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; _exception )</span></span></span><span class="hljs-function"> </span></span>{ m_outputStream &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Cannot open file: "</span></span> &lt;&lt; _exception.getPath() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*virtual*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( NotHaveSpace </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*_exception*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ m_outputStream &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Not have space for saving file"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ostream &amp; m_outputStream; }; } <span class="hljs-comment"><span class="hljs-comment">// namespace Visitors } // namespace Exceptions</span></span></code> </pre><br>  The catch list disappears, duplication of code, too.  All processing code is submitted to visitors, which can easily be used from several places.  Also with this approach, you can be sure that you will catch all the exceptions of the module with which you work and at the same time process each of them correctly.  When expanding the list of exceptions, you can be sure that the developer will not be able to skip adding processing to any place, since by adding your class to the base class of the visitor, all other visitors simply do not compile until each of them implements the necessary processing for a particular case. <br><br><h5>  When should you use this approach </h5><br><ul><li>  The project uses a large hierarchy of exceptions, or simply a large number of exceptions that may be worth summarizing; </li><li>  points of the same catch and exception handling are more than one. </li></ul><br><h5>  Positive sides </h5><br><ul><li>  Allows writing more flexible exception handlers; </li><li>  allows to use one handler in several places; </li><li>  virtually eliminates the ability to "forget" to add processing of exceptions in all places where it is necessary. </li></ul><br><h5>  Negative sides </h5><br><ul><li>  Creating additional objects each time (classes of visitors) for exception handling; </li><li>  for each exception there must be a unique type of exception. </li></ul><br><h5>  Afterword </h5><br>  This approach is not something new, and I do not want to open a new design pattern.  In this article I tried to share a solution that seemed to me optimal for solving my problems.  I hope this experience will be useful to you. <br></div><p>Source: <a href="https://habr.com/ru/post/113606/">https://habr.com/ru/post/113606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113601/index.html">qutIM for Symbian - a requiem for a dream ...</a></li>
<li><a href="../113602/index.html">Mobile menagerie, or where are we going?</a></li>
<li><a href="../113603/index.html">Google will introduce two-step verification for all users</a></li>
<li><a href="../113604/index.html">Children's fiction with a human face</a></li>
<li><a href="../113605/index.html">GTK + third version released</a></li>
<li><a href="../113607/index.html">Proxmox VE 2.0 beta has been released!</a></li>
<li><a href="../113608/index.html">Nokia's Symbian farewell</a></li>
<li><a href="../113610/index.html">Sony SCL - Playground Experiment</a></li>
<li><a href="../113611/index.html">Parsing the Wave File in JavaScript</a></li>
<li><a href="../113612/index.html">Nokia and Microsoft: at the end of an eventful day</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>