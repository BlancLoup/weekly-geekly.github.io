<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Node.JS Get rid of require () forever</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Analyzing the source codes of past projects, the popularity rating of direct function calls showed that a direct call of require() is found in the cod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Node.JS Get rid of require () forever</h1><div class="post__text post__text-html js-mediator-article"> Analyzing the source codes of past projects, the popularity rating of direct function calls showed that a direct call of <code>require()</code> is found in the code of node-modules almost as often as <code>Array#forEach()</code> .  The most annoying thing is that we most often connect the modules <code>"util"</code> , <code>"fs"</code> and <code>"path"</code> , a little less often <code>"url"</code> .  The presence of other connected modules depends on the task of the module.  Moreover, speaking of the <code>"util"</code> module, it is loaded into the memory of the node-process even if you have never connected it. <br><br>  In the last article, <a href="http://habrahabr.ru/post/259281/">Node.JS Loading Modules on Demand,</a> I talked about the possibility of automatically loading a module when it first accessed its named link.  To be honest, at the time of writing this article, I was not sure that such an approach would not cause the strange behavior of the node-process.  But, today I can proudly <code>demandLoad()</code> that <code>demandLoad()</code> has been in production for half a year already.  As we just did not drive it ... This is the load testing of a specific process, and the work of <code>demandLoad()</code> in the worker-processes of clusters, and the work of the process under a small load for a long time.  Results were compared using <code>demandLoad()</code> and using <code>require()</code> .  No significant deviations in comparison were observed. <br><br>  Today we are not talking about the stability of <code>demandLoad()</code> .  If anyone is interested, ask questions in the comments, take screenshots, I can tell you about the methods and tools of testing, other possibilities of using the approach.  Today, as follows from the title of the article, we will get rid of those who already get bored with <code>require()</code> in the caps of each node-module. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <em>I note in advance that I do not in any way agitate to use the proposed method in production.</em>  <em>The practice is stated for familiarization and does not pretend to the status of "true-practice".</em>  <em>Loud headline just to attract attention.</em> <br><a name="habracut"></a><br>  Suppose we are working on a project called <code>"mytestsite.com"</code> , and we have it here: <br><br><pre> <code class="hljs javascript">~<span class="hljs-regexp"><span class="hljs-regexp">/projects/my</span></span>testsite.com</code> </pre> <br>  Create an executable file of our project, for example, at: <br><br><pre> <code class="hljs pgsql">~/projects/mytestsite.com/lib/bin/<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.js</code> </pre> <br>  Inside we will try to call the connected modules without prior <code>require()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(util.inspect(url.parse(<span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/'</span></span>)));</code> </pre> <br>  Now create the <code>"require-all.js"</code> file somewhere, outside of all projects. <br>  For example, here: <br><br><pre> <code class="hljs javascript">~<span class="hljs-regexp"><span class="hljs-regexp">/projects/g</span></span>eneral/<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>-all.js</code> </pre> <br>  According to the <a href="https://nodejs.org/dist/latest-v5.x/docs/api/globals.html">documentation</a> , all the predefined variables and constants of each node-module are <code>global</code> properties.  Accordingly, we can define our own global objects.  So we must do with all the modules we use. <br><br>  Fill <code>require-all.js</code> list of all used modules in all projects: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      "util", // ..        "console". //  console.log(),      , //     util.inspect() global.util = require('util'); //      , : demandLoad(global, 'fs', 'fs'); demandLoad(global, 'path', 'path'); demandLoad(global, 'url', 'url'); //      npm-, : demandLoad(global, 'express', 'express'); // , , ,     : demandLoad(global, 'routes', './../mytestsite.com/lib/routes'); //  demandLoad function demandLoad(obj, name, modPath){ //      //       . }</span></span></code> </pre><br>  You can represent the list of modules as an array or map ( <code>Map</code> ), and, for example, walk on it / her in a loop so as not to repeat a line of code with a call to <code>demandLoad()</code> .  You can, for example, read the list of used npm-modules from <code>package.json</code> .  If, for example, the number of modules used is very high, and you do not want to clutter up the global scope, you can define, for example, an empty object <code>m</code> ( <code>let m = {}</code> ), define <code>m</code> in <code>global</code> ( <code>global['m'] = m</code> ), and already apply <code>demandLoad()</code> to <code>m</code> .  As they say, to whom it is more convenient. <br><br>  Now, it remains only to run this farm.  Add the <code>--require</code> key to the node launch (versions&gt; = 4.x): <br><br><pre> <code class="bash hljs">node --require ~/projects/general/require-all.js \ ~/projects/mytestsite.com/lib/bin/server.js</code> </pre><br>  No errors.  The script worked as it should: <br><br><pre> <code class="hljs pgsql">Url { protocol: <span class="hljs-string"><span class="hljs-string">'https:'</span></span>, slashes: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, auth: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, host: <span class="hljs-string"><span class="hljs-string">'habrahabr.ru'</span></span>, port: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, hostname: <span class="hljs-string"><span class="hljs-string">'habrahabr.ru'</span></span>, hash: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">search</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, query: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, pathname: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-type"><span class="hljs-type">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, href: <span class="hljs-string"><span class="hljs-string">'https://habrahabr.ru/'</span></span> }</code> </pre> <br>  If you have many projects, for the convenience of deploying projects, you can create your own <code>require-all.js</code> within each project separately. <br><br><pre> <code class="bash hljs">node --require ~/projects/mytestsite.com/lib/require-all.js \ ~/projects/mytestsite.com/lib/bin/server.js</code> </pre> <br>  Extending the latter case, I note, you can even use several such <code>require-all.js</code> at the same time: <br><br><pre> <code class="bash hljs">node --require ~/projects/general/require-all.js \ --require ~/projects/mytestsite.com/lib/require-all.js \ ~/projects/mytestsite.com/lib/bin/server.js</code> </pre> <br>  As noted in the <a href="http://habrahabr.ru/post/273405/">comment below</a> , the <code>--require</code> + <code>global</code> bundle can also be used to extend / overload standard node features. <br><br>  Finally, I repeat from the previous article: If <code>demandLoad()</code> is not defined in our file (1) (whence we call <code>demandLoad()</code> ), but in some file (2), with file (1) and file (2) located in different directories, the last parameter must pass the full path to the module, for example: <br><br><pre> <code class="javascript hljs">demandLoad(global, <span class="hljs-string"><span class="hljs-string">'routes'</span></span>, path.join(__dirname, <span class="hljs-string"><span class="hljs-string">'./../mytestsite.com/lib/routes'</span></span>));</code> </pre> <br>  Otherwise, that <code>require()</code> that is called from <code>demandLoad()</code> will search for a module relative to the folder where that same file (2) is located with the description of <code>demandLoad()</code> , instead of looking for a module relative to file (1), from where we call <code>demandLoad()</code> . <br><br>  Thanks for attention.  All successful refactoring! </div><p>Source: <a href="https://habr.com/ru/post/273405/">https://habr.com/ru/post/273405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273393/index.html">The simplest cellular automata and their practical application</a></li>
<li><a href="../273395/index.html">Jedi Escape: May the gyroscope arrive with you</a></li>
<li><a href="../273397/index.html">Let the scrolling be with you: theory and practice on the camera in the platform [2/2]</a></li>
<li><a href="../273401/index.html">Python-> Cython-> C ++, and COM to boot: writing a framework for autotests</a></li>
<li><a href="../273403/index.html">Some CSS CSS Tips</a></li>
<li><a href="../273407/index.html">Birthday of the founder of the oldest hacker club Chaos Computer Club</a></li>
<li><a href="../273411/index.html">How not to present the results of the static analyzer</a></li>
<li><a href="../273413/index.html">The algorithm for choosing the size of the image for social networks: Guide from the expert Buffer</a></li>
<li><a href="../273415/index.html">Artistic approach to downloading images</a></li>
<li><a href="../273417/index.html">Advent of Code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>