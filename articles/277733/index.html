<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of one configuration "umbrella"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will talk about the experience of supplying and configuring numerous interconnected products (non-participants call it simply ‚Äúthe c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of one configuration "umbrella"</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/026/488/8cd/0264888cd4fd49b69d56c3463dfbdf9f.jpg"><br>  In this article I will talk about the experience of supplying and configuring numerous interconnected products (non-participants call it simply ‚Äúthe creation of installers‚Äù). <br><br>  So imagine a set of applications scattered across several servers: 12 pieces.  Applications are heterogeneous, developed by different companies at different times.  Various integration methods have been implemented, from primitive exports / imports through a file system to advanced web-based services.  Applications use SQL Server and Oracle databases.  All of these applications work in hundreds of different end-user environments. <br><br>  Installing and configuring all this costs a lot of work and resources.  Ok, set.  And updates that should be issued for accounting systems in accordance with changes in legislation?  Scaling applications?  And the new functionality?  What about new customers with their ‚Äúspecial‚Äù configurations?  Manually is expensive and time consuming if you have, say, 150 clients and at least 2 updates of such a ‚Äúmonster‚Äù per year. <br><a name="habracut"></a><br>  Our answer to all these questions is the creation of an installation ‚Äúumbrella‚Äù - a bootstrapper and combing everything under it.  Many customers themselves can now install or upgrade without our help and additional payment for the services of the company's consultants.  The number of customers is growing, and the amount of work for support is decreasing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here, in fact, about our "umbrella".  Is it a "bicycle"?  Yes, to some extent.  However, clearly with electric drive and built-in GPS navigation.  Although, perhaps, not the latest version. <br><br><img src="https://habrastorage.org/files/e7b/3a2/36a/e7b3a236a2ce4590a1d7b40afc0ee96f.png"><br><br>  Is this the perfect solution?  No, but it works and brings real benefits from its implementation.  Current products cannot be efficiently delivered without it. <br><br>  And, sorry, "umbrella".  Then that's it :) <br><br><img src="https://habrastorage.org/files/70e/f08/ae7/70ef08ae7ab04ff598dec5014693e675.jpg"><br><br><h2>  Why is all this necessary? </h2><br>  The packaging of all these applications has long been engaged in a dedicated team using InstallShield.  It was necessary to deliver installation packages in various configurations, customizing them for specific requirements and client environments, and supporting various scaling options. <br><br><img src="https://habrastorage.org/files/286/236/eee/286236eee8cf46e0a128fa4a26c1d0e4.jpg"><br><br>  As a result, it happened and so ... <br><br>  Comes, it means, the task of packaging.  The first question is right there: <br>  - And what is the deadline for this task? <br>  Answer: <br>  - The day before yesterday! <br><br>  At once all the architectural delights evaporate from the head in such a situation.  Not?  That is, everything should already be ready.  As a surgeon for an emergency operation - the tools on the table and in stock.  In this case, the ‚Äúbad‚Äù pekedzhing, as the last link, is to blame for disrupting the deadlines.  Sometimes it‚Äôs just like a grenade without checks ‚Äî tell the next one. <br><br>  The business value of peking, so to say, is not in the first place - ‚Äúsomehow wrap up, so that it works and that's all.‚Äù  And it is not at all obvious that, due to the lack of any new feature, well, maybe a couple of customers will suffer, and without proper packaging, they will not get everything.  Well, if the installer spoils the environment with a huge number of clients? <br><br>  As a result, each of the application development projects lived its own life and something integrated grew only in the process of packaging the entire solution. <br><br>  <i>What did not suit us?</i> <br><ol><li>  Speed ‚Äã‚Äãand predictability of delivery times.  Regardless of how qualified and great the team is, it‚Äôs impossible to rewrite half of the application in a week. </li><li>  Large budget peking did not suit the customer. </li><li>  The need for costly licensing and specialization of employees in this area. </li><li>  The process of developing installers was not sufficiently transparent and understandable to the customer. </li></ol><br>  What happened and how does it work? <br><br><h2>  Decision itself </h2><br>  From the user's point of view, this is a folder with executable files of the ‚Äúengine‚Äù of an umbrella, several XML ‚Äúmatrices‚Äù, utilities for configuration and diagnostics, among them the famous setup.exe. <br><br>  This is the hierarchy of the directories supplied to the end user of the product. <br><img src="https://habrastorage.org/files/833/4d1/c8c/8334d1c8c90b41b79d94326bc0202670.png"><br><br><h2>  User view </h2><br>  The user runs the famous setup.exe - our product.  Displays the user interface in the corporate style of the company.  There is a choice of installation kit.  But, in fact, where our matrix works, the system calculates the dependencies by itself: if another product is required to install a product, it adds it as mandatory. <br><br>  In accordance with the choice of products, the user is asked to enter one or another number of installation parameters in the user interface.  Moreover, if a group of packages requires the same parameter, all this is automatically grouped into one UI element.  If the user has not selected a product for this setting, it is also not displayed. <br><br>  During the installation, we generate a batch file with parameterization of each package in ProgramData at the entrance, then after installation we get 2 logs - one from the umbrella in XML, the second from each installer.  And in the first there are links for easy diagnosis.  There is also a special utility for viewing. <br><br>  And if the package fell off?  Copy-paste into a separate .cmd from the generated command file and comfortable debugging directly on the environment without launching the ‚Äúumbrella‚Äù, but with its parameterization.  It is very convenient to cling to the process of .NET Custom Action for debugging.  Paradise versus VBS.  Especially since our framework when changing the system environment variable all messages from the Custom Actions MSI issues in the message box, cling on - I don't want to.  ;) <br><br>  <i>And immediately the question "What about the upgrade?"</i> <br>  We write to the registry, and in a single system area for our products.  So we define the parameters of the installed applications, we migrate the settings from there, if the manual change of parameters is not supported.  Otherwise we read from configs or merzhim them. <br><br>  We use MSI only in Major Upgrade mode.  Patches did not take root, although this possibility exists in the system.  However, now the size of the package has not become so critical, and with its competent development and testing - a full upgrade will not cause problems either. <br><br><h2>  From the developer‚Äôs side </h2><br>  Now the practice is such that we start peking as early as possible and automate it immediately.  Even if the new application has only one page, you can already install it! <br><br>  The process is not too complicated, described in several points below. <br><ol><li>  The developer enters the portal, downloads the toolkit, according to the documentation, doesn‚Äôt he forget what.  Fills in the specification of pekedzhingu, if he does not himself. </li><li>  It is convinced that the project can collect and all the files in place. </li><li>  Configures the toolkit in accordance with the required configuration (for example, depending on the type of application - client, web server or just a database) and generates an installer template. </li><li>  Assembles the installer, tests, automates in accordance with the examples. </li><li>  Enters the umbrella portal, imports command line parameters from the package, and binds them to the user interface. </li><li>  Exports a matrix for testing or release on a carrier with our shell engine and dependent products. </li><li>  Installs. </li></ol><br>  It is possible to automatically install, done through Silent mode.  You can launch it remotely or by event via Windows Scheduler or PowerShell.  Now it‚Äôs immediately clear where development is delayed: by the application or peking team :) <br><br><h2>  History of creation </h2><br>  In the beginning it was very important to find successful examples that could be oriented.  At that time there were not many of them, and there were virtually no flexible solutions. <br><br>  We looked at the VS VS, and even wrote to Microsoft, it was not flexible enough.  And the scope is different.  They did not have plans to enter the market with something customer-oriented.  I was a little surprised that they didn‚Äôt have a common practice in this area, but we decided that the rich had their quirks.  We will go the other way. <br><br>  We also communicated with <a href="http://www.flexerasoftware.com/">Flexera</a> (at that time called Acresso Software) - asked if they could offer something ready within a reasonable time.  A <a href="https://community.flexerasoftware.com/showthread.php%3F197183-InstallShield-2012-wishlist">large thread</a> was started in the forum with product wishes and a long, representative conversation with the company's management took place.  There we described our product requirements and how we see the final decision.  Terms from them have not received.  Three years later, the <a href="http://www.flexerasoftware.com/producer/products/software-installation/installshield-software-installer/">InstallShield Suite Flexera</a> appeared, which is now supplied with InstallShield Premier, in which many of our ideas are guessed :) <br><br><h3>  Prototyping </h3><br>  In the beginning, we made a couple of prototypes that allowed us to understand the budget and technical aspects of the solution. <br>  A very good idea was storing the application dependency matrix in XML, which would be supplied with the product. <br><br>  The simplicity and compatibility of WIX Deployment Tools Foundation made it possible to integrate .NET code into MSI without any problems.  Previously, even if it was possible to pull the .NET method from InstallShield, the problem with the links to the libraries spoiled life.  Actually, how to use in the installation process the functionality of libraries not from Global Assembly Cache is a mystery (there are several options, but they are all rather laborious), and inconvenient.  The DTF is simply a container, where everything that the library refers to automatically enters.  No "manual" work. <br><br>  The functionality for repacking the Silverlight XAP file to change the configuration inside has become critical for the transition from VBScript, which is still used today.  Further .NET Custom Actions began to be used everywhere. <br><br>  It was suggested to refuse the MSI user interface when installing a set of applications: one absence of an event to change the contents of the text box is worth it.  Who, by the way, and still there. <br><br>  For separate installation of the UI application, the Windows Installer was saved, but strictly standardized.  As a result, we got a little hot with the user interface in one of the first prototypes, because it was also supposed to be in XML.  The idea was excellent, a year later it was implemented by Microsoft in WPF, therefore it was actually recognized as a result unsuccessful and replaced with it. <br><br>  Agreed that the sample will take the Microsoft Office installer.  The Office team, as far as I remember, developed the Windows Installer - there is no reason not to trust them.  The friendliness of its installation at the highest level - you can simply click on Next and get a workable product.  We wanted the same thing. <br><br><h4>  Prototype 1 </h4><br>  Just a bootstrapper, with configurable options for running MSI.  InstallShield for installers. <br>  It turned out not enough - it will not save from a mess with dependencies, and the interface for all cases does not write. <br><br><h4>  Prototype 2 </h4><br>  .NET, XML everywhere.  WIX as an engine for installers. <br>  It turned out that there was too much code (in particular, describing the packages themselves), a rather complicated structure for WIX XML projects.  The XML GUI engine was also quite voluminous.  In the process of use, it turned out that error diagnostics and solution support are too time consuming.  Quickly the source of the problem is not localized and not corrected. <br><br><h4>  Prototype 3 </h4><br>  Database and export from DataSet to XML for the bootstrapper, UI to WPF, own toolkit for creating installation packages. <br>  This decision was already viable - it was decided to stop at it. <br><br><h4>  Unrealized ideas </h4><br>  Several ideas have never been tested: <br><ul><li>  Service similar to Windows Installer to support product bundles. </li><li>  Compile a set of products into a large MSI package in accordance with the user's choice. </li></ul><br><br><h3>  Editing the dependency matrix </h3><br>  Let's return to our installers.  With the XML matrix, everything was fine, except that it was almost impossible to work with data for several users at the same time.  Errors when entering, validation dependencies - need an editor. <br><br>  We came to the idea of ‚Äã‚Äãstoring and editing the matrix in a SQL Server database and exporting it to the XML that comes with the installer. <br><img src="https://habrastorage.org/files/cc1/eaf/f02/cc1eaff02d7647d2871127f1b1df2867.png"><br><br>  According to the results, the ‚Äúreadability‚Äù and ‚Äúmodifiability‚Äù of the XML file suffered greatly, and the dependence on the editor increased.  However, there were specialists who managed to edit this manually if this situation arises.  But now there is usually "pens" climb only for experiments. <br><br><h2>  What are the options on the modern market? </h2><br>  We, of course, see what's new on the market.  If we see a solution covering our requirements, we can switch to it. <br><br>  Here is some comparison of our solution with others available in the market. <br><table border="1"><tbody><tr><td width="170">  <b>Characteristic</b> <br></td><td width="142">  <b>InstallShield Suite</b> <br></td><td width="156">  <b>WIX Burn</b> <br></td><td width="156">  <b>Our product</b> <br></td></tr><tr><td width="170">  Product dependency checking <br></td><td width="142">  Not <br></td><td width="156">  Not <br></td><td width="156">  there is <br></td></tr><tr><td width="170">  Centralized multi-user editor <br></td><td width="142">  Not <br></td><td width="156">  Not <br></td><td width="156">  there is <br></td></tr><tr><td width="170">  Storage of component installation parameters <br></td><td width="142">  XML <br></td><td width="156">  XML <br></td><td width="156">  SQL Server, XML <br></td></tr><tr><td width="170">  Developer User Interface <br></td><td width="142">  InstallShield <br></td><td width="156">  XML <br></td><td width="156">  Silverlight client <br></td></tr><tr><td width="170">  Dynamically changeable user interface <br></td><td width="142">  Not <br></td><td width="156">  Not <br></td><td width="156">  Yes <br></td></tr><tr><td width="170">  Interface availability for automation <br></td><td width="142">  Yes, starting from version 2015 <br></td><td width="156">  No, you can implement XML-based <br></td><td width="156">  Yes WCF <br></td></tr><tr><td width="170">  Interface for extensions <br></td><td width="142">  C ++ plugins <br></td><td width="156">  .NET <br></td><td width="156">  .NET <br></td></tr><tr><td width="170">  Work with the application database <br></td><td width="142">  Not <br></td><td width="156">  Not <br></td><td width="156">  SQL Server <br></td></tr><tr><td width="170">  Estimated Integrated Product Installer <br></td><td width="142">  InstallShield <br></td><td width="156">  WIX <br></td><td width="156">  InstallShield + WIX DTF <br></td></tr><tr><td width="170">  Built-in Active Directory Configuration <br></td><td width="142">  Not <br></td><td width="156">  Not <br></td><td width="156">  there is <br></td></tr></tbody></table><br><h2>  Our solution is in the details. </h2><br>  It was adopted by C #, MVVM and SQL Server - a standard tool, not like VBScript. <br><br>  <b>InstallShield - MSI Project Editor</b> <br>  <i>Pros:</i> <br><ul><li>  Quick diagnosis and correction of problems, everything is immediately visible in the full-featured GUI. </li><li>  The possibility of a gradual transition. </li><li>  The customer already uses this package extensively. </li><li>  Stability - you can manage to implement your product based on this solution. </li></ul><br>  <i>Minuses:</i> <br><ul><li>  <a href="https://store.flexerasoftware.com/en/productselect.aspx">The huge cost of licenses</a> : $ 2,800 one-time with an annual renewal to receive updates - another $ 480 regularly.  Some savings have been achieved on using the Professional version, since the Suite ‚Äúumbrella‚Äù is ours.  As far as I know, Microsoft has achieved savings with special offers, but for many years loyalty of special discounts has not been achieved. </li><li>  Not all of the functionality works correctly, sometimes it works intentionally incorrectly to maintain compatibility. </li></ul><br>  <b>C # is the main programming language ("inside" and outside MSI, in the "umbrella")</b> <br>  <i>Pros:</i> <br><ul><li>  Increased development speed and solution flexibility. </li></ul><br>  <i>Minuses:</i> <br><ul><li>  Dependence on .NET (in our case this is not critical, since almost all applications use it so). </li></ul><br>  <b>WPF - UI Bootstrapper</b> <br>  <i>Pros:</i> <br><ul><li>  The solution is easier, easier to maintain. </li><li>  Automatic binding, easily implemented "flexible" user interface. </li></ul><br>  <i>Minuses:</i> <br><ul><li>  Less customization options.  For example, they refused to store the description of UI in the database. </li></ul><br>  <b>SQL Server - Dependency Matrix Storage</b> <br>  <i>Pros:</i> <br><ul><li>  Access to information for multiple users. </li><li>  The solution in perspective allows replacing the customer's information system based on SharePoint. </li><li>  More reliable storage and validation of information. </li></ul><br>  <i>Minuses:</i> <br><ul><li>  The need to support a centralized server. </li><li>  Higher development costs. </li></ul><br>  <b>Silverlight - UI editor of products and their dependencies</b> <br>  <i>Pros:</i> <br><ul><li>  Wide range of user interface settings and user input controls. </li><li>  Multiplayer mode. </li></ul><br>  <i>Minuses:</i> <br><ul><li>  Dependence on the plugin, the difficulty with translating the application to a more current version. </li><li>  Now the decision is already morally outdated due to the termination of Silverlight support. </li></ul><br>  All this, of course, we will try to consider in detail if there is such interest among the readers. <br><br><h2>  Installers - before and after the umbrella </h2><br>  Actually, all of the above was started for the sake of installing and configuring the final products.  So let's talk about the installers of products. <br><br>  Error number 1 that was made - we began to write an ‚Äúumbrella‚Äù before the development of the pekedzha completely settled down.  Because of this, there are excessive product requirements.  For example, several types of dependencies were implemented, of which only two are actually used.  The article will not go this vicious way! <br><br>  Not everyone likes MSI.  And we always had MSI, and even not always InstallShield, and even not always WIX in other cases.  In general, a decent solyanka, such a rich ... <br><img src="https://habrastorage.org/files/dee/cb2/ed5/deecb2ed5242484299debb33216b1b54.jpg"><br>  <i>Composition: WIX, InstallShield, Wise, InstallScript, VBScript, .NET</i> <br><br>  From the beginning about why this is bad - bitty packages.  And why is this sure to vybesit you, if you start to put it on the stream. <br><br>  This is what could be ... <br><img src="https://habrastorage.org/files/668/090/6f5/6680906f55634221a2152375eabf70df.png"><br><br>  And everything is good, but everyone has their own standards and limitations.  This results in total chaos in terms of functionality and parameterization.  And if the installer is not at all based on MSI, then the popular Orca editor from the Windows SDK will not help to find that cherished parameter.  In addition, WISE, for example, is no longer supported. <br><br>  <b>Typical options</b> <br><ol><li>  The all-in-one installer based on InstallScript, as a probable interpretation of Wise or on the basis of any other scripting engine.  It only works with the GUI and tries to install all related components before installing the product.  As a rule, a lot of code inside, completely unpredictable parameterization and support for the ‚Äúsilent‚Äù mode.  Removal is usually dirty, implemented on the residual basis.  Upgrade - the same way.  This is a rewrite. </li><li>  MSI with InstallScript and VBS inserts.  Can be created by various development environments from InstallShield to WIX.  Strong side - do not depend on the availability of .NET.  But who has Windows now without it?  Among the shortcomings - the complexity of the development and support.  Awkward debug.  Parameterization is chaotic.  Usually silent mode somehow works.  This is left as possible as is.  Or rewrite if something does not suit. </li><li>  A good option.  MSI on WIX or InstallShield with WIX DTF.  But a mess with the parameters can be.  We lead to a common denominator. </li></ol><br>  As a result, InstallShield was left based on our generated template and WIX installers.  Both use the WIX DTF with our wrappers.  The container setup.exe was abandoned altogether; you need to be able to see what's inside. <br><br><h3>  Parameterization </h3><br>  If in .NET we have a real OOP (interfaces, classes that we can override, modify and inherit), then there is no MSI.  If not, then you need to come up with something - we have these prefixes and naming conventions.  If now in managed languages ‚Äã‚Äãthis is considered a sign of bad tone (but we sin, we still sin in the user interface for some reason), then for the Windows Installer - just right. <br><br>  That is, so we call the properties (CIF - abbreviated Common Installation Framework) MSI, in simple terms "property". <br><br>  If the package contains our standard properties, the installer processes them and supports, in this case, the configuration of Active Directory: <br>  CIF_AD_USER <br>  CIF_AD_PASSWORD <br><br>  Non-standard properties (for example, if an application has several users) are configured by separate input fields, or are overridden manually in advanced settings: <br>  APP_AD_USER <br>  APP_AD_PASSWORD <br><br>  Why upper case?  For those used inside MSI, we allow the use of both registers.  For all external interfaces - only the top.  Why?  InstallShield is not case-sensitive everywhere (system search, for example). <br><br>  Redundant options will not cause problems if MSI does not use them - just ignore them.  Therefore, a standard set of parameters is always transferred, which simplifies the addition of a new product and minimizes the required amount of documentation or related communication. <br><br>  How do we pass parameters to installers?  Considered 2 options: <br><ol><li>  Via command line </li><li>  Through transforms </li></ol><br>  Chose the first option.  Cause?  Trite easier.  Yes, and the batch file is easier to edit.  It is better to use one, the most universal, approach.  Restrictions on the length of the line we have not reached. <br><br><h3>  Custom actions, log and exception handling </h3><br>  With input parameters sorted out.  And what about the logs?  InstallScript is generally binary.  How to understand that the installation failed in the process?  Error codes may be different.  How to understand what went wrong during the execution of the very VBS CA written 3 years ago? <br><br>  <b>Need standardization:</b> <br><ol><li>  The need to support a standard set of parameters for installing and updating the product. </li><li>  Diagnostics and error handling during installation. </li><li>  Setting the packaging process to flow. </li><li>  Addition of the built-in InstallShield configuration tools for working with XML, IIS, etc. Avoiding ‚Äúflashing black windows‚Äù. </li></ol><br>  As a rule of good tone, the recommendation is to use the WIX Deployment Tools Foundation for InstallShield.  Then it was not so obvious. <br><br>  What we lacked in InstallShield Professional was the various IIS settings and the order in which they were applied during the upgrade.  We also didn‚Äôt like how InstallShield works with XML (many applications didn‚Äôt work because the elements were crookedly closed, their order changed) - the functionality of reformatting and working with XML fragments increased.  Now we are going to the text file changes and our own XML engine. <br><br>  Such an architecture is the result. <br><img src="https://habrastorage.org/files/e48/32a/9ff/e4832a9fff844fdb99448cfefdfcd16b.png"><br><br>  On the picture: <br><ul><li>  Green - implemented on the basis of patterns, implemented as templates and snippets based on VS SDK. </li><li>  Orange - reused code within MSI. </li><li>  Red - reused code outside of MSI. </li></ul><br>  What is good WIX .NET custom action - interface MSI DLL.  As a result of the assembly, the test-box automatically forms a zip container with all associated libraries: if you rename to ZIP, you can see the contents, packed libraries, etc. <br><br>  The logic and dependencies are stored separately.  As a result, the library can be reused from PowerShell, MS Build, or from our configuration umbrella.  Not to mention that if someone wants to configure something directly from the application. <br><br>  How can we debug the installer?  Very simple - we set the CIF_DEBUG system environment variable to 1 and each of our CAs will write not to the log already, but to the Message Box.  There are a lot of options to pick up and see from the inside what is happening. <br><br>  How is this done?  All MSI service functions are performed by a special Core library that serves as a level of abstraction over the Microsoft Deployment Tools Foundation.  It is easy to throw the output on the GUI. <br><br>  It's still quite simple to make an exe from a custom action - the only difference is in the constructor, and the output is already going to the console!  This is in case of "quick check on the environment." <br><br><h3>  .NET Custom Actions </h3><br>  We have a lot of different .NET Custom Actions, we use the following naming convention: <br>  [Subject] [Action] [Execution Type] ([Parametrization Type]) <br><br>  <i>Example:</i> <br>  XmlMergeNodesDef - deferred execution in system context custom action, merges nodes in configuration files <br>  MsiParseStringImOut - immediate execution, generates several new properties on the output, so the type "out". <br><br>  What we have not yet fully resolved is that we have not abandoned the heaps of actions that pass the ‚Äúdeferred in system context‚Äù parameters to custom actions.  They still have and they have the extension ‚Äú_SetCAProp‚Äù <br><br>  <i>Example:</i> <br>  CIF_XmlMergeNodesDef_SetCAProp - passes parameters to the deferred custom action of the same name. <br><br>  How did we solve the problem of passing parameters?  In the template, a single .NET CA TemplatePrepare manages everything.  It is generated automatically by our toolkit by the specified parameters. <br><br>  We use a using construction that declares the beginning and end of the custom action code after the standard WIX binding.  Opening bracket - automatically posts a greeting to the log with the version of the library, closing says goodbye.  Each line has a standard prefix with the name custom action and timestamp, for example: <br><blockquote>  CIF CA NetServicesStopIm 06: 27: 56.1707871: Starts with CIF Core 3.7.0.15 -&gt; Windows Installer Log, parameters in CustomActionData <br>  CIF CA NetServicesStopIm 06: 27: 56.1707871: SplitData splitting property CustomActionData <br>  CIF CA NetServicesStopIm 06: 27: 56.1707871: SplitData found 1 parameter values ‚Äã‚Äãin "with delimiter" | " <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: Searching for property references in "AppFabricEventCollectionService | AppFabricWorkflowManagementService | AppFabricCachingService |" ... <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: Searching for property references in "" ... <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: No properties detected. <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: Get property AppFabricEventCollectionService | AppFabricWorkflowManagementService | AppFabricCachingService <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: Searching for property references in "8" ... <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: No properties detected. <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: Get property InstanceId = 8 <br>  CIF CA NetServicesStopIm 06: 27: 56.1863471: {InstanceId} replaced with "8" <br>  CIF CA NetServicesStopIm 06: 27: 56.2488510: Ends <br></blockquote><br>  Note that it is very easy to read - for the scroll just click on "Find the next entry."  By timestamp with milliseconds, you can see how much this or that action takes a lot of time (sometimes because of the wrong parameter, something too voluminous is processed at a higher level, for example). <br><br><h2>  Conclusion, conclusions, advantages and disadvantages of the decision </h2><br>  As a result - now people on application development projects are engaged in these projects.  And the people involved in the configuration, in fact, she and engaged. <br>  If something new needs to be configured, then there is a process from creating a user story in the backlog to getting a result in the form of a new library, described in the documentation with examples. <br><br>  <i>Minuses:</i> <br><ul><li>  Cost of solution development and support </li><li>  Longer process of delivery of the decision in comparison with purely cloudy options </li></ul><br>  <i>Pros:</i> <br><ul><li>  The possibility of selling products for installation on the environment of customers </li><li>  Full control over application configuration </li><li>  The ability to supply various options for "sets" of products </li><li>  Better product testing </li><li>  Rapid changes to the product and diagnosis of the causes of incorrect configuration </li><li>  Reducing the number of incidents related to the configuration, as a result, lower costs for their support and higher level of product satisfaction </li></ul><br>  In general, the goal was achieved, although the decision matured a little later than we would like.  So we wish you clear weather and do not fall under the rain, but if that happens, then be ready with an umbrella!  :) <br><img src="https://habrastorage.org/files/2a9/ba8/b95/2a9ba8b95e5140768026b651d37d70e0.jpg"></div><p>Source: <a href="https://habr.com/ru/post/277733/">https://habr.com/ru/post/277733/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277721/index.html">Mesh router is easy</a></li>
<li><a href="../277723/index.html">Asymmetric solutions. ICS Information Security in Energy</a></li>
<li><a href="../277725/index.html">Microsoft Android emulator cooling beer with IoT and Windows 10 and The Maker Show for those who like to solder</a></li>
<li><a href="../277727/index.html">Another implementation of the is_function <T> metafunction for C ++ 98/03</a></li>
<li><a href="../277729/index.html">Build a hybrid Android application</a></li>
<li><a href="../277737/index.html">Lazy list in C ++</a></li>
<li><a href="../277739/index.html">Zabbix 3.0: Encryption</a></li>
<li><a href="../277741/index.html">Backup and transfer of data in the browser Vivaldi</a></li>
<li><a href="../277743/index.html">IP PBX Askozia and Push Notifications in Telegram</a></li>
<li><a href="../277747/index.html">Anatomy of ransomware for Android, part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>