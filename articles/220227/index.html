<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What gets into deny ip any any?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most implementations of access lists imply the behavior of ‚Äúeverything that is not allowed is forbidden‚Äù. A reasonable approach, taking into account t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What gets into deny ip any any?</h1><div class="post__text post__text-html js-mediator-article"> Most implementations of access lists imply the behavior of ‚Äúeverything that is not allowed is forbidden‚Äù.  A reasonable approach, taking into account the fact that when designing, we expect in advance one or another type of traffic in a certain direction: if we have a subscriber or a peering partner connected, it means there should not be data from other IP on this interface, and if we have Internet access, where do private addresses come from?  And maybe it's all for nothing?  Maybe there is no parasitic traffic and an absolute ban in the ACL is only the transfer of resources.  After all, the operator itself provides the clients with the addresses, and the peer-to-peer partners and upstream providers are communication service brothers who must understand the complexity and delicacy of the situation.  Unfortunately, this is not the case. <br>  The participants of the round table dedicated to DDoS, held at <a href="http://tech.yandex.ru/events/yac/2013/talks/1135/">YaC2013,</a> complained very much that with all the existing recommendations no one tries to deal with the security of their networks.  That is, one should start first with oneself (with telecom operators), at least fight IP spoofing. <br>  From what <code>deny ip any any</code> protects you can see further, just examples from monitoring logs. <a name="habracut"></a><br><br>  Our network is a provider with subscribers, peering partners and uplinks: <img src="https://habrastorage.org/getpro/habr/post_images/fcf/9fb/a28/fcf9fba28ca566bc7cd4fbaf26d4fc1d.png" alt="image"><br><br>  First, the first interface (one of) <b>int1</b> in the direction of subscribers, and a simple list of access to the input: <br><blockquote><pre> <code class="bash hljs">10 permit icmp any any (1483430 matches) 20 permit tcp any any established (26903 matches) 30 permit ip 10.100.x.0 0.0.0.255 any (923840 matches) 40 deny ip any any (201 matches)</code> </pre> </blockquote><br>  Allowed ICMP, already established connections and traffic only from the connected part of the subscriber network.  We look that got. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Deny any by subscribers </h4><br><h5>  1. Many public source addresses, and one public destination address.  None of the addresses belong to us: </h5><br><blockquote><pre> <code class="bash hljs">denied tcp 81.200.20.77(64112) -&gt; 25.189.67.187(44335) denied tcp 46.147.230.241(60676) -&gt; 25.189.67.187(44335) denied tcp 95.154.77.187(49623) -&gt; 25.189.67.187(44335) denied udp 95.54.131.126(10000) -&gt; 25.189.67.187(44335) denied udp 95.221.80.35(20743) -&gt; 25.189.67.187(44335) denied tcp 212.92.250.137(52335) -&gt; 25.189.67.187(44335) denied tcp 93.124.112.244(62817) -&gt; 25.189.67.187(44335)</code> </pre> </blockquote><br>  In this case, the destination address is included in the unit belonging to the <a href="https://apps.db.ripe.net/search/query.html%3Fsearchtext%3D25.189.67.187%26searchSubmit%3Dsearch">Department of Defense of Great Britain</a> .  It would seem that here is a manifestation of network solidarity - with the world on a thread and do not need any anti-DDoS funds.  But in fact, this is just out of control <a href="http://en.wikipedia.org/wiki/Hamachi_(software)">Hamachi</a> with its illegal global IP addresses, when the traffic goes not through a tunnel, but through a common routed space, that is, the UK, however, it gets. <br><br><h5>  2. Source - name servers, mostly real: </h5><br>  Local our network <br><blockquote><pre> <code class="bash hljs">denied udp 10.10.0.2(domain) -&gt; 169.254.32.112(31049) denied udp 10.10.1.2(domain) -&gt; 169.254.37.66(52758) denied udp 10.10.1.2(domain) -&gt; 10.75.144.128(36985)</code> </pre> </blockquote><br>  Google <br><blockquote><pre> <code class="bash hljs">denied udp 8.8.8.8(domain) -&gt; 172.22.81.195(7116) denied udp 8.8.8.8(domain) -&gt; 169.254.32.112(17726) denied udp 8.8.8.8(domain) -&gt; 169.254.32.112(21974)</code> </pre> </blockquote><br>  Megaphone <br><blockquote><pre> <code class="bash hljs">denied udp 83.149.22.14(domain) -&gt; 172.22.81.195(32844)</code> </pre> </blockquote><br>  Beeline <br><blockquote><pre> <code class="bash hljs">denied udp 217.118.66.243(domain) -&gt; 10.193.166.57(31159) denied udp 217.118.66.243(domain) -&gt; 10.205.222.222(42160) denied udp 217.118.66.243(domain) -&gt; 10.204.57.217(53646) denied udp 217.118.66.243(domain) -&gt; 10.198.108.220(2125)</code> </pre> </blockquote><br>  Mts <br><blockquote><pre> <code class="bash hljs">denied udp 217.74.244.2(domain) -&gt; 10.108.170.22(31425) denied udp 217.74.244.2(domain) -&gt; 10.77.119.212(43896) denied udp 217.74.244.3(domain) -&gt; 10.86.224.44(25234)</code> </pre> </blockquote><br>  Private address <br><blockquote><pre> <code class="bash hljs">denied udp 192.168.1.1(domain) -&gt; 169.254.48.228(59050)</code> </pre> </blockquote><br>  Destination addresses do not have addresses belonging to our network.  But since the servers are real, it can be assumed that in some case the internal structure of the addressing system that is currently connected or previously connected to the provider‚Äôs subscriber can be revealed. <br><br><h5>  3. Many public source addresses (sometimes addresses from the subscriber network) and one destination address in the subscriber network: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 5.76.188.102(6881) -&gt; 10.100.178.87(49001) denied udp 178.185.77.225(14548) -&gt; 10.100.178.87(16414) denied udp 83.149.44.138(3251) -&gt; 10.100.178.87(64375) denied tcp 10.100.38.30(51167) -&gt; 10.100.178.87(64375) denied udp 178.216.69.13(1375) -&gt; 10.100.172.135(21787)</code> </pre> </blockquote><br>  Interestingly, the source of this traffic is the host, with the exact address specified as the destination. <br><br><h5>  4. Close in form to the previous version, but as a destination address is a private address that does not belong to any of the known nodes in the network: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 82.238.44.240(42300) -&gt; 172.16.8.83(52987) denied udp 82.255.186.101(20344) -&gt; 172.16.8.83(52987) denied tcp 79.31.185.28(53369) -&gt; 172.16.8.83(52987) denied tcp 10.100.34.79(50984) -&gt; 192.168.137.1(13472) denied tcp 10.100.236.119(54821) -&gt; 192.168.137.1(13472) denied tcp 188.244.185.76(2503) -&gt; 192.168.137.1(13472) denied udp 86.176.51.60(36740) -&gt; 169.254.12.28(29970) denied udp 171.7.208.183(27161) -&gt; 169.254.12.28(29970) denied udp 24.53.252.132(24874) -&gt; 169.254.12.28(29970) denied udp 89.110.5.117(36505) -&gt; 172.20.10.4(14957) denied tcp 80.255.155.125(60134) -&gt; 172.20.10.4(14957) denied tcp 128.70.16.74(51952) -&gt; 172.20.10.4(14957) denied tcp 178.140.142.84(64797) -&gt; 10.0.16.19(61789) denied tcp 88.215.186.103(59343) -&gt; 10.0.16.19(61789) denied tcp 80.77.41.98(54474) -&gt; 10.0.16.19(61789)</code> </pre> </blockquote><br>  Here, as in the previous case, the traffic source node has one of the addresses specified as the destination address on the interface.  These two cases remained a mystery to me - who, how and why? <br><br><h5>  5. One private source address and multiple public destination addresses (sometimes addresses from the subscriber network): </h5><br><blockquote><pre> <code class="bash hljs">denied udp 192.168.0.17(45927) -&gt; 93.185.249.103(43213) denied tcp 192.168.0.17(52596) -&gt; 82.208.126.93(58025) denied udp 192.168.0.17(45927) -&gt; 46.72.40.240(19047) denied udp 192.168.0.5(22475) -&gt; 188.18.233.101(42763) denied tcp 192.168.0.5(57165) -&gt; 109.61.147.132(46895) denied udp 192.168.1.3(28199) -&gt; 136.169.166.182(42584) denied udp 192.168.1.3(28199) -&gt; 94.41.133.198(46843) denied udp 192.168.0.101(43137) -&gt; 10.100.44.151(49393) denied udp 192.168.0.101(43137) -&gt; 10.100.26.39(20080) denied udp 192.168.0.101(43137) -&gt; 10.100.72.63(35692)</code> </pre> </blockquote><br>  Probably the most explainable.  Due to the fact that the address is permanent, it is either configured second on the main interface, or on another device in the subscriber‚Äôs network, or is used by one of the applications. <br><br>  The above options are found in many places are the most widespread, the rest are only isolated cases. <br><br><h5>  6. Source - public address of the provider's network: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 203.0.113.18(26585) -&gt; 213.67.20.238(6112)</code> </pre> </blockquote><br><h5>  7. Appointment - public address of the provider's network: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 62.148.7.195(17278) -&gt; 203.0.113.65(40178) denied udp 62.148.7.195(19176) -&gt; 203.0.113.65(40180) denied udp 62.148.7.195(16186) -&gt; 203.0.113.65(40182) denied udp 62.148.7.195(19970) -&gt; 203.0.113.65(40184)</code> </pre> </blockquote><br>  These cases should be clarified, since all subscribers are behind NAT and have private addressing, the appearance of the public address of the provider as the source, exactly like the destination address is not at all usual. <br><br><h5>  8. ‚ÄúStrange‚Äù even in this context, addresses and protocols: </h5><br><blockquote><pre> <code class="bash hljs">denied 154 73.246.67.151() -&gt; 128.106.162.245() denied all 175.223.240.56() -&gt; 64.0.0.0() denied tcp 64.8.0.1(61445) -&gt; 0.0.0.1(128)</code> </pre> </blockquote><br>  Most of what has been investigated and somehow explained does not apply to any deliberate or malicious actions, often these are configuration errors, mostly automatic, when a second provider is connected (usually 3G modems), using various tunnel programs (like Hamachi, in first case) or P2P clients. <br><br><h4>  Deny any from the peering partner </h4><br>  Now let's look at the traffic from the peering partner's partner <b>int2</b> : BGP junction and only known public addresses.  The access list is a bit more complicated; in addition to the previous, separate rules for private networks were made: <br><blockquote><pre> <code class="bash hljs">10 permit icmp any any (1360250 matches) 20 permit tcp any any established (199798954 matches) 30 permit bgp host 192.0.2.1 host 192.0.2.2 (11887 matches) 40 permit ip 192.0.2.0 0.0.0.255 203.0.113.0 0.0.0.255 (775443105 matches) 50 deny ip 10.0.0.0 0.255.255.255 any (1280 matches) 60 deny ip 172.16.0.0 0.15.255.255 any (2 matches) 70 deny ip 192.168.0.0 0.0.255.255 any (1335 matches) 80 deny ip 169.254.0.0 0.0.255.255 any 90 deny ip 127.0.0.0 0.255.255.255 any 100 deny ip host 0.0.0.0 any 110 deny ip host 255.255.255.255 any 120 deny ip any any (540 matches)</code> </pre> </blockquote><br>  It is worth paying attention to the ratio of the number of <code>deny</code> matches and <code>permit</code> rules in relation to the previous ACL.  Incomprehensible things happen less, about 1 deny per 200000 permit, in the previous example this ratio is 1 to 5000, which tells us about the presence of a controlled network structure, which is present in our partner and which is not present in our subscribers.  But in this case, too, something is leaking. <br><br><h5>  1. Rules 50,60,70 - access from private addresses not belonging to us, nor peering to a partner, to our public addresses: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 192.168.0.101(6881) -&gt; 203.0.113.251(6881) denied udp 192.168.0.249(47597) -&gt; 203.0.113.147(23392) denied udp 10.112.112.112(63973) -&gt; 203.0.113.249(42873) denied tcp 192.168.0.57(57055) -&gt; 203.0.113.38(37654)</code> </pre> </blockquote><br>  There are not many events, but it can be assumed that this case has something in common with option 5 in the previous section. <br><br><h5>  2. But deny ip any any showed, suddenly, the expected events - attempts to access the interface address 192.0.2.2 from public addresses not belonging to the peering partner: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 5.255.68.168(7678) -&gt; 192.0.2.2(123) denied udp 84.105.139.67(42440) -&gt; 192.0.2.2(161)</code> </pre> </blockquote><br>  The address is globally routable, and there is never a lack of security for those who want to test the strength of the network.  In fairness, it should be noted that similar cases occur in the internal network, but they are cut off by another protection mechanism, so this was not noticeable in the examples above. <br><br><h4>  Deny any from the Internet </h4><br>  It remains to see what to expect from the Internet <b>int3</b> .  The access list is the same as before, but access is now possible from all addresses, and not only from previously known ones. <br><blockquote><pre> <code class="bash hljs">10 permit icmp any any (142814260 matches) 20 permit tcp any any established (29633491483 matches) 30 permit bgp host 198.51.100.1 host 198.51.100.2 (1727903 matches) 40 permit ip any 203.0.113.0 0.0.0.255 (23122741548 matches) 50 deny ip 10.0.0.0 0.255.255.255 any (447026 matches) 60 deny ip 172.16.0.0 0.15.255.255 any (121911 matches) 70 deny ip 192.168.0.0 0.0.255.255 any (191732 matches) 80 deny ip 169.254.0.0 0.0.255.255 any (1733 matches) 90 deny ip 127.0.0.0 0.255.255.255 any (3415 matches) 100 deny ip host 0.0.0.0 any (46 matches) 110 deny ip host 255.255.255.255 any (9 matches) 120 deny ip any any (1278 matches)</code> </pre> </blockquote><br>  Immediately attracts the attention of a greater variety of source addresses including 0.0.0.0 and 255.255.255.255.  For the rest, we have almost the same as with the peering partner. <br><br><h5>  1. Private address from publicly routable space to the public address of the provider: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 192.168.0.106(61104) -&gt; 203.0.113.84(18636) denied tcp 10.0.3.49(54996) -&gt; 203.0.113.243(21603) denied udp 10.240.77.25(38170) -&gt; 203.0.113.106(25175) denied tcp 172.20.56.135(49995) -&gt; 203.0.113.210(60623) denied tcp 10.60.33.69(49388) -&gt; 203.0.113.206(54312)</code> </pre> </blockquote><br><h5>  2. Same as the first case, but as a source, the public address from our network: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 203.0.113.18(56425) -&gt; 203.0.113.21(6502)</code> </pre> </blockquote><br><h5>  3. Access to the docking address of the router, the same as in the case of peering partner: </h5><br><blockquote><pre> <code class="bash hljs">denied udp 116.10.191.170(6000) -&gt; 198.51.100.2(22) denied udp 5.152.192.210(5135) -&gt; 198.51.100.2(5060)</code> </pre> </blockquote><br>  This time the ports are ssh and sip. <br><br>  That's probably all.  The fundamental difference between working with external connections is the lack of attempts to access not our addresses.  All packages came where necessary, though not always from those addresses that would be appropriate in this situation.  Also, in relative terms, outwardly nonsense external networks arrive much less than from their own subscribers.  That is, the presence of an administrator on the network solves almost all problems. <br><br>  Of course, not being a network security specialist, I don‚Äôt always understand what this or that line means that was banned, but I didn‚Äôt find anything that was openly malicious, as I said above, basically configuration errors.  In any case - be vigilant, protect yourself from external, and first of all from internal threats, so that we all feel calmer. </div><p>Source: <a href="https://habr.com/ru/post/220227/">https://habr.com/ru/post/220227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220211/index.html">Transition to PHP 5.5 and unit tests</a></li>
<li><a href="../220213/index.html">Welcome to Skyforge closed beta.</a></li>
<li><a href="../220215/index.html">We disassemble Sony Xperia Z2, the new flagship with an unusual cooling system</a></li>
<li><a href="../220219/index.html">We distribute 500K to the organization of circles of robotics</a></li>
<li><a href="../220225/index.html">HackDay City: from idea to prototype project for a city in 48 hours!</a></li>
<li><a href="../220229/index.html">JSCS: JavaScript Code Style</a></li>
<li><a href="../220231/index.html">Chat bot applications via skype, jabber and whatsapp</a></li>
<li><a href="../220233/index.html">Creating a Custom Scope in JEE and Spring</a></li>
<li><a href="../220235/index.html">History of one internationalization</a></li>
<li><a href="../220237/index.html">12 little-known CSS features</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>