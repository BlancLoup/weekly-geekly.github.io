<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of Clojure Web Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I will try to show the basics of creating web applications in Clojure. There will be no complex logic and fashionable frameworks. A number of li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of Clojure Web Applications</h1><div class="post__text post__text-html js-mediator-article">  Today I will try to show the basics of creating web applications in Clojure.  There will be no complex logic and fashionable frameworks.  A number of libraries will be used to work with primitives.  As far as I mention, I will try to briefly explain what functionality they provide. <br><br>  The web application architecture in primitives consists of a web server that sends requests to handlers depending on the path, parameters, method.  The handler executes certain code, queries the database, works with the file system.  After processing the request, a response is generated and sent to the client. <br><br>  Our application will take one value through the form, take the second value from the database, add them, and return the result to the client.  In this case, the entered value will replace the old one in the database.  Stupid, useless and not interesting logic - I know. <br><a name="habracut"></a><br>  To develop an application on Clojure, we need, of course, Clojure and a number of auxiliary libraries.  First of all we <s>swing Cloj</s> , SUDDENLY, <a href="https://github.com/technomancy/leiningen/">Leiningen</a> .  Indeed, to write on Clojure, you can not install Clojure right away, but download Leiningen.  It is a utility for building Clojure projects with support for the usual range of tasks, including dependencies, and extensible plugins.  For details, send to <a href="https://github.com/technomancy/leiningen/">the project page</a> or to <a href="http://alexott.net/ru/clojure/ClojureLein.html">Alex Ott</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So let's get started: <br><pre><code class="hljs tex">D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dev</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clojure</span></span></span></span>&gt;lein new web-clojure-demo Created new project in: D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dev</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clojure</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web</span></span></span></span>-clojure-demo</code> </pre> <br>  What just happened?  Leiningen created a project folder with the following hierarchy: <br><pre> <code class="hljs cmake">src/ web_clojure_demo/ core.clj <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/ web_clojure_demo/ <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/ core.clj .gitignore README <span class="hljs-keyword"><span class="hljs-keyword">project</span></span>.clj</code> </pre><br>  First of all, we are interested in the project.clj file.  Structurally, it contains the usual Clojure source code: <br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">defproject</span></span> web-clojure-demo <span class="hljs-string"><span class="hljs-string">"1.0.0-SNAPSHOT"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:description</span></span> <span class="hljs-string"><span class="hljs-string">"FIXME: write description"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:dependencies</span></span> [[org.clojure/clojure <span class="hljs-string"><span class="hljs-string">"1.2.1"</span></span>]])</code> </pre><br>  Leiningen uses the contents of this file to work with the project.  It is possible to specify various directives that can be read in the documentation.  We are primarily interested in the dependency section.  It can specify the libraries that are used in the application.  When executing the <i>lein deps</i> command, Leiningen will automatically place all dependencies in the lib / folder, and, if necessary, download them from the repository. <br><br>  We will use a number of libraries that need to be specified in the section <i>: dependencies</i> : <br><ul><li>  <a href="https://github.com/richhickey/clojure-contrib/">clojure-contrib</a> - contains various useful features not included in the standard library of the language: functions for working with strings and input / output streams, additional functions for working with collections, monads, etc. </li><li>  <a href="https://github.com/mmcgrana/ring">ring</a> is a library that provides a number of abstractions over HTTP. </li><li>  <a href="https://github.com/weavejester/compojure/">compojure</a> - contains a set of macros and functions for creating web applications.  Is a wrapper over the ring. </li><li>  clj-redis - client library for Redis.  In this example, I will use this NoSQL repository.  For relational solutions, I advise you to look towards ClojureQL. </li><li>  <a href="https://github.com/cgrand/enlive">enlive</a> is a library for creating an HTML response to a client.  Notable in that it completely makes the logic of the patterns. </li></ul><br>  To debug the application, we need a plugin for Leiningen.  Just add one more section to the project.clj <i>: dev-dependencies</i> . <br>  Now it looks like this: <br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">defproject</span></span> web-clojure-demo <span class="hljs-string"><span class="hljs-string">"1.0.0-SNAPSHOT"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:description</span></span> <span class="hljs-string"><span class="hljs-string">"FIXME: write description"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:dependencies</span></span> [[org.clojure/clojure <span class="hljs-string"><span class="hljs-string">"1.2.1"</span></span>] [org.clojure/clojure-contrib <span class="hljs-string"><span class="hljs-string">"1.2.0"</span></span>] [ring/ring-jetty-adapter <span class="hljs-string"><span class="hljs-string">"0.2.5"</span></span>] [compojure <span class="hljs-string"><span class="hljs-string">"0.6.2"</span></span>] [clj-redis <span class="hljs-string"><span class="hljs-string">"0.0.9"</span></span>] [enlive <span class="hljs-string"><span class="hljs-string">"1.0.0-SNAPSHOT"</span></span>]] <span class="hljs-symbol"><span class="hljs-symbol">:dev-dependencies</span></span> [[lein-ring <span class="hljs-string"><span class="hljs-string">"0.4.0"</span></span>]] <span class="hljs-symbol"><span class="hljs-symbol">:ring</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:handler</span></span> web-clojure-demo.core/engine})</code> </pre><br>  Next, open the <i>src / web_clojure_demo / core.clj file</i> .  For now, it contains only a namespace declaration.  Add the necessary dependencies and the following code to it: <br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">ns</span></span> web-clojure-demo.core (<span class="hljs-symbol"><span class="hljs-symbol">:use</span></span> compojure.core) (<span class="hljs-symbol"><span class="hljs-symbol">:use</span></span> [ring.adapter.jetty <span class="hljs-symbol"><span class="hljs-symbol">:only</span></span> [run-jetty]]) (<span class="hljs-symbol"><span class="hljs-symbol">:use</span></span> [ring.util.response]) (<span class="hljs-symbol"><span class="hljs-symbol">:require</span></span> [compojure.route <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> route] [compojure.handler <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> handler] [clj-redis.client <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> redis] [net.cgrand.enlive-html <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> html])) (<span class="hljs-name"><span class="hljs-name">def</span></span> db (<span class="hljs-name"><span class="hljs-name">redis/init</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:url</span></span> <span class="hljs-string"><span class="hljs-string">"redis://127.0.0.1:6379"</span></span>})) (<span class="hljs-name"><span class="hljs-name">defn</span></span> parse-input [a] (<span class="hljs-name"><span class="hljs-name">Integer/parseInt</span></span> a)) (<span class="hljs-name"><span class="hljs-name">html/deftemplate</span></span> page-index <span class="hljs-string"><span class="hljs-string">"web_clojure_demo/index.html"</span></span> [ctxt] [<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> <span class="hljs-string"><span class="hljs-string">"Awesome application"</span></span>) [<span class="hljs-symbol"><span class="hljs-symbol">:#old</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> ctxt)) [<span class="hljs-symbol"><span class="hljs-symbol">:#msg2</span></span>] (<span class="hljs-name"><span class="hljs-name">html/set-attr</span></span> <span class="hljs-string"><span class="hljs-string">"style"</span></span> <span class="hljs-string"><span class="hljs-string">"display: none"</span></span>)) (<span class="hljs-name"><span class="hljs-name">html/deftemplate</span></span> page-summary <span class="hljs-string"><span class="hljs-string">"web_clojure_demo/index.html"</span></span> [ctxt] [<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> <span class="hljs-string"><span class="hljs-string">"Awesome application"</span></span>) [<span class="hljs-symbol"><span class="hljs-symbol">:#old</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> ctxt)) [<span class="hljs-symbol"><span class="hljs-symbol">:#msg2</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-name"><span class="hljs-name">str</span></span> <span class="hljs-string"><span class="hljs-string">"Summary is "</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:sum</span></span> ctxt)))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> summary [value] (<span class="hljs-name"><span class="hljs-name">let</span></span> [old (<span class="hljs-name"><span class="hljs-name">redis/get</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span>)] (<span class="hljs-name"><span class="hljs-name">redis/set</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span> value) (<span class="hljs-name"><span class="hljs-name">page-summary</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">:sum</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> (<span class="hljs-name"><span class="hljs-name">parse-input</span></span> value) (<span class="hljs-name"><span class="hljs-name">parse-input</span></span> old)) <span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> old}))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> index [] (<span class="hljs-name"><span class="hljs-name">let</span></span> [old (<span class="hljs-name"><span class="hljs-name">redis/get</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span>)] (<span class="hljs-name"><span class="hljs-name">page-index</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> old}))) (<span class="hljs-name"><span class="hljs-name">defroutes</span></span> main-routes (<span class="hljs-name"><span class="hljs-name">GET</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> [] (<span class="hljs-name"><span class="hljs-name">index</span></span>)) (<span class="hljs-name"><span class="hljs-name">POST</span></span> <span class="hljs-string"><span class="hljs-string">"/some_action"</span></span> [value] (<span class="hljs-name"><span class="hljs-name">summary</span></span> value)) (<span class="hljs-name"><span class="hljs-name">route/not-found</span></span> <span class="hljs-string"><span class="hljs-string">"Page not found"</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> engine (<span class="hljs-name"><span class="hljs-name">handler/site</span></span> main-routes))</code> </pre><br>  Next we place the template <i>index.html</i> : <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg1"</span></span></span><span class="hljs-tag">&gt;</span></span>Old value: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"old"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/some_action"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"value"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ok"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  As you noticed, it does not contain any special tags. <br>  Next, through the console, you need to update the dependencies and start the debugging web server: <br><pre> <code class="hljs tex">D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dev</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clojure</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web</span></span></span></span>-clojure-demo&gt;lein deps Copying 19 files to D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dev</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clojure</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web</span></span></span></span>-clojure-demo<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lib</span></span></span></span> Copying 17 files to D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dev</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clojure</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web</span></span></span></span>-clojure-demo<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lib</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dev</span></span></span></span> D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dev</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clojure</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web</span></span></span></span>-clojure-demo&gt;lein ring server 2011-03-31 22:23:25.125::INFO: Logging to STDERR via org.mortbay.log.StdErrLog 2011-03-31 22:23:25.125::INFO: jetty-6.1.14 2011-03-31 22:23:25.203::INFO: Started SocketConnector@0.0.0.0:3000 Started server on port 3000</code> </pre><br>  If you go back to the project.clj, you will notice that we added the attribute <i>: ring {: handler web-clojure-demo.core / engine}</i> .  It allows the Leiningen internal web server to send all requests to our handler during the testing of the application.  This is very convenient because this Leiningen plugin uses several stubs, which, for example, allow you to update the source code without rebooting the web server. <br><br>  Let's see what's going on inside. <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">def</span></span> db (<span class="hljs-name"><span class="hljs-name">redis/init</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:url</span></span> <span class="hljs-string"><span class="hljs-string">"redis://127.0.0.1:6379"</span></span>}))</code> </pre><br>  This code gets a connection to the Redis repository.  Variable db we will continue to use for work. <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">defroutes</span></span> main-routes (<span class="hljs-name"><span class="hljs-name">GET</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span> [] (<span class="hljs-name"><span class="hljs-name">index</span></span>)) (<span class="hljs-name"><span class="hljs-name">POST</span></span> <span class="hljs-string"><span class="hljs-string">"/some_action"</span></span> [value] (<span class="hljs-name"><span class="hljs-name">summary</span></span> value)) (<span class="hljs-name"><span class="hljs-name">route/not-found</span></span> <span class="hljs-string"><span class="hljs-string">"Page not found"</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> engine (<span class="hljs-name"><span class="hljs-name">handler/site</span></span> main-routes))</code> </pre><br>  This code defines handlers for various requests.  In this case, compojure libraries are used.  The <i>site</i> macro creates a handler function that supports the necessary functionality for typical sites such as sessions, cookies, parameters, etc. The <i>main-routes</i> list contains a list of radical requests and handler functions.  If none of the handlers is suitable, <i>not-found is</i> triggered. <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">defn</span></span> index [] (<span class="hljs-name"><span class="hljs-name">let</span></span> [old (<span class="hljs-name"><span class="hljs-name">redis/get</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span>)] (<span class="hljs-name"><span class="hljs-name">page-index</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> old}))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> summary [value] (<span class="hljs-name"><span class="hljs-name">let</span></span> [old (<span class="hljs-name"><span class="hljs-name">redis/get</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span>)] (<span class="hljs-name"><span class="hljs-name">redis/set</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span> value) (<span class="hljs-name"><span class="hljs-name">page-summary</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">:sum</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> (<span class="hljs-name"><span class="hljs-name">parse-input</span></span> value) (<span class="hljs-name"><span class="hljs-name">parse-input</span></span> old)) <span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> old})))</code> </pre><br>  These are the functions that process our requests.  The first of them takes the value in the database and calls the function to generate a response from the template, the second adds the value in the database and the transmitted one and also causes the response to be generated. <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">html/deftemplate</span></span> page-index <span class="hljs-string"><span class="hljs-string">"web_clojure_demo/index.html"</span></span> [ctxt] [<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> <span class="hljs-string"><span class="hljs-string">"Awesome application"</span></span>) [<span class="hljs-symbol"><span class="hljs-symbol">:#old</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> ctxt)) [<span class="hljs-symbol"><span class="hljs-symbol">:#msg2</span></span>] (<span class="hljs-name"><span class="hljs-name">html/set-attr</span></span> <span class="hljs-string"><span class="hljs-string">"style"</span></span> <span class="hljs-string"><span class="hljs-string">"display: none"</span></span>)) (<span class="hljs-name"><span class="hljs-name">html/deftemplate</span></span> page-summary <span class="hljs-string"><span class="hljs-string">"web_clojure_demo/index.html"</span></span> [ctxt] [<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> <span class="hljs-string"><span class="hljs-string">"Awesome application"</span></span>) [<span class="hljs-symbol"><span class="hljs-symbol">:#old</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> ctxt)) [<span class="hljs-symbol"><span class="hljs-symbol">:#msg2</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-name"><span class="hljs-name">str</span></span> <span class="hljs-string"><span class="hljs-string">"Summary is "</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:sum</span></span> ctxt))))</code> </pre><br>  The macro deftemplate creates a function that accepts the <i>ctxt</i> parameter, loads the html template and converts it according to the specified rules, in our case it is the task of content or the change of styles.  The Enlive library allows for much more interesting manipulations with html. <br><br>  This is how our application works: <br><br><img src="http://mboga.org/03717ja7pv0grtdb0hbluvodq0a6tg51.png" alt="image"><br><img src="http://mboga.org/1q263vqfrldqfe2oo8u7lu9rnnjn1voh.png" alt="image"><br><img src="http://mboga.org/0p8bgqf9nh8pnnbcqmov6fgpx1q9wl17.png" alt="image"><br><img src="http://mboga.org/0o3uhfoa48h8rc2l11g9mkodalp9w99m.png" alt="image"><br><img src="http://mboga.org/30nvquubwgbnjiddj1odgdjjdps0gno0.png" alt="image"><br><img src="http://mboga.org/3bgqd73xcki9qtbvtl5ntk1grt5lv3ou.png" alt="image"><br><br>  Oops! <br>  Correct this misunderstanding.  Edit the code: <br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">html/deftemplate</span></span> page-summary <span class="hljs-string"><span class="hljs-string">"web_clojure_demo/index.html"</span></span> [ctxt] [<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> <span class="hljs-string"><span class="hljs-string">"Awesome application"</span></span>) [<span class="hljs-symbol"><span class="hljs-symbol">:#old</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> ctxt)) [<span class="hljs-symbol"><span class="hljs-symbol">:#msg2</span></span>] (<span class="hljs-name"><span class="hljs-name">html/content</span></span> (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:error</span></span> ctxt) (<span class="hljs-symbol"><span class="hljs-symbol">:error</span></span> ctxt) (<span class="hljs-name"><span class="hljs-name">str</span></span> <span class="hljs-string"><span class="hljs-string">"Summary is "</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:sum</span></span> ctxt))))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> summary [value] (<span class="hljs-name"><span class="hljs-name">let</span></span> [old (<span class="hljs-name"><span class="hljs-name">redis/get</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span>)] (<span class="hljs-name"><span class="hljs-name">try</span></span> (<span class="hljs-name"><span class="hljs-name">let</span></span> [ a (<span class="hljs-name"><span class="hljs-name">parse-input</span></span> value) b (<span class="hljs-name"><span class="hljs-name">parse-input</span></span> old)] (<span class="hljs-name"><span class="hljs-name">redis/set</span></span> db <span class="hljs-string"><span class="hljs-string">"value"</span></span> value) (<span class="hljs-name"><span class="hljs-name">page-summary</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">:sum</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> ab) <span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> old})) (<span class="hljs-name"><span class="hljs-name">catch</span></span> NumberFormatException e (<span class="hljs-name"><span class="hljs-name">page-summary</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:old</span></span> old <span class="hljs-symbol"><span class="hljs-symbol">:error</span></span> <span class="hljs-string"><span class="hljs-string">"Number Format Exception"</span></span>})))))</code> </pre><br>  Now our application correctly processes inappropriate data.  In case of an error, a message will be displayed to the client. <br><img src="http://mboga.org/1noa1683utdlp678hevn4vjx50k5h7k9.png" alt="image"><br><br><h4>  Conclusion </h4><br>  If I poorly covered any part, please let me know about it - I will add an article.  In case of questions, please do not be shy.  Healthy and not very criticism is also welcome. <br>  The source code for this example can be found in the <a href="https://github.com/kondratovich/web-clojure-demo">repository</a> . </div><p>Source: <a href="https://habr.com/ru/post/116595/">https://habr.com/ru/post/116595/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116587/index.html">Mocking private in javascript</a></li>
<li><a href="../116589/index.html">The world's largest indoor photograph</a></li>
<li><a href="../116591/index.html">Good hosting does not happen much or OVH goes to Russia</a></li>
<li><a href="../116592/index.html">JQuery 1.5.2 released</a></li>
<li><a href="../116594/index.html">What kind of people are needed in UX teams. Great hunt!</a></li>
<li><a href="../116596/index.html">BugDNS - April Fools Internet</a></li>
<li><a href="../116599/index.html">Author Chrome Adblock released for beta testing gadget glasses that block the usual advertising on the streets</a></li>
<li><a href="../116600/index.html">Bromine Behavior Innovations</a></li>
<li><a href="../116601/index.html">Fix performance drop when copying / uploading files to Ubuntu</a></li>
<li><a href="../116602/index.html">Simple OCR for .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>