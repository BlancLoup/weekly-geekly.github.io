<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring video surveillance systems with Zabbix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zabbix monitoring system has long established itself as an easy-to-install and configure solution that helps maintain servers, sites, networks, etc., ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring video surveillance systems with Zabbix</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/be/dh/eo/bedheoeqfnmcznk20l7myp1eqm8.jpeg"><br><br>  Zabbix monitoring system has long established itself as an easy-to-install and configure solution that helps maintain servers, sites, networks, etc., and many administrators choose it to solve their problems thanks to stable 24/7 operation and flexible configuration options.  Despite this, there are very few online instructions for setting up zabbix for video surveillance, which prompted us to write this article. <br><br><h2>  Why do you need monitoring </h2><br>  Basically, the zabbix system is used by experienced users, for whom its installation and configuration are not particularly difficult.  But what about the rest?  In this article we will try to help understand the basics of the work and show the main points for further self-study of the zabbix monitoring system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will talk about installing a Zabbix server and agent on Windows and Linux.  We will answer the question of how to set up notifications about loss of communication with cameras, high CPU load on the server, problems with client sites, and touch on standard templates a bit. <br><a name="habracut"></a><br>  It is worth saying that in <a href="https://devline.ru/sistema_videonabljudenija/">IP-video surveillance</a> each element has its own IP-address, therefore it is desirable that the elements of the system with which we will work have static IP-addresses for more convenient configuration of the monitoring system. <br><br><h2>  Zabbix: launch and configuration </h2><br>  So, Zabbix software is built on the principle of "server - agent". <br><br>  The server collects and stores all the information, with its help you can quickly view the monitoring history, the configured nodes, and add new nodes, rules, etc. <br><br>  The agent is installed on the computer from which you are interested. <br><br>  Zabbix server part runs under Linux system.  Since this article is intended for people who will encounter this OS for the first time, we recommend starting with the Ubuntu operating system, it is more friendly to beginners.  All information on it can be found in the official Russian community <a href="http://ubuntu.ru/">ubuntu.ru</a> .  There you can also see installation instructions on a PC or on a virtual machine, for example, Oracle VM VirtualBox. <br><br>  After starting the system, you must immediately update the packages of your OS. <br><br>  To do this, open the console ctrl + alt + t and enter the command <br><br><pre><code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> &amp;&amp; sudo apt <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span></code> </pre> <br>  You may have to wait a few minutes for all the packages to be updated. <br><br>  We also need a text editor: <br><br><pre> <code class="hljs swift">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install mcedit</code> </pre> <br>  Next, we translate the system language into Russian: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> locale-gen ru_RU</code> </pre> <br>  To work with zabbix, you need to install a MySQL database and an Apache web server: <br><br><pre> <code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> mysql-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> mysql-<span class="hljs-keyword"><span class="hljs-keyword">client</span></span> apache2</code> </pre> <br>  Set a password for the root user from MySQL. <br><br><img src="https://habrastorage.org/webt/cl/9t/3s/cl9t3sks5axbhlrcqpfklzhhhxs.jpeg"><br><br>  Now install the necessary PHP dependencies: <br><br><pre> <code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> php-mbstring php-bcmath php-<span class="hljs-keyword"><span class="hljs-keyword">xml</span></span></code> </pre> <br>  And restart Apache: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> service apache2 reload</code> </pre> <br>  Then you can begin to install the monitoring system itself.  Step-by-step instruction is described on the <a href="https://www.zabbix.com/ru/download%3Fzabbix%3D3.4%26os_distribution%3Dubuntu%26os_version%3Dxenial%26db%3DMySQL">official Zabbix website</a> , let's go through them together: <br><br>  1) Choose our platform for the Zabbix server.  As a database we use MySQL. <br><br>  2) Download and install the Zabbix repository: <br><br><pre> <code class="hljs ruby">wget <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/repo.zabbix.com/zabbix</span></span><span class="hljs-regexp"><span class="hljs-regexp">/3.4/ubuntu</span></span><span class="hljs-regexp"><span class="hljs-regexp">/pool/main</span></span><span class="hljs-regexp"><span class="hljs-regexp">/z/zabbix</span></span>-release/zabbix-release_3.<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>+xenial_all.deb sudo dpkg -i zabbix-release_3.<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>+xenial_all.deb sudo apt update</code> </pre> <br>  3) Install zabbix-server-mysql, zabbix-frontend-php and zabbix-agent, <br><br><pre> <code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> zabbix-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-mysql zabbix-frontend-php zabbix-<span class="hljs-keyword"><span class="hljs-keyword">agent</span></span></code> </pre> <br>  4) Create a MySQL database for Zabbix: <br><br><pre> <code class="hljs pgsql">sudo mysql -uroot ‚Äìp mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> zabbix <span class="hljs-type"><span class="hljs-type">character</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">collate</span></span> utf8_bin; mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">grant</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> <span class="hljs-keyword"><span class="hljs-keyword">privileges</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> zabbix.* <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> zabbix@localhost identified <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; mysql&gt; quit</code> </pre> <br>  Now fill the database, it will take some time: <br><br><pre> <code class="hljs pgsql">cd /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/doc/zabbix-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-mysql/ zcat <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>.gz | mysql -uzabbix -p zabbix</code> </pre> <br>  5) Configuring Zabbix server configurations: <br><br>  Open the configuration file through a text editor. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> mcedit /etc/zabbix/zabbix_server.conf</code> </pre> <br>  And fill in the following fields: <br><br><pre> <code class="hljs">DBHost=localhost DBName=zabbix DBUser=zabbix DBPassword=</code> </pre> <br>  6) The following 2 steps are swapped. <br><br>  Set the time zone in the web server settings: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> mcedit /etc/apache2/conf-available/zabbix.conf</code> </pre> <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IfModule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mod_php7.c</span></span></span><span class="hljs-tag">&gt;</span></span> php_value max_execution_time 300 php_value memory_limit 128M php_value post_max_size 16M php_value upload_max_filesize 2M php_value max_input_time 300 php_value always_populate_raw_post_data -1 php_value date.timezone Europe/Moscow <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IfModule</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IfModule</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mod_php5.c</span></span></span><span class="hljs-tag">&gt;</span></span> php_value max_execution_time 300 php_value memory_limit 128M php_value post_max_size 16M php_value upload_max_filesize 2M php_value max_input_time 300 php_value always_populate_raw_post_data -1 php_value date.timezone Europe/Moscow <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IfModule</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And restart it: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> service apache2 reload</code> </pre> <br>  7) Done, you can run the Zabbix server: <br><br><pre> <code class="hljs pgsql">sudo systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> zabbix-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> sudo systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> zabbix-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br>  We make a small check: <br><br><pre> <code class="hljs pgsql">systemctl status zabbix-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> zabbix-agent</code> </pre> <br>  The following message should appear: <br><br><img src="https://habrastorage.org/webt/yy/ol/bg/yyolbgjhb964lsodtyqea_sd__m.jpeg"><br><br><h2>  Configuring the Zabbix web interface </h2><br>  Now you can go to the Zabbix web-interface, for this you need to enter in the browser: <br><br><pre> <code class="hljs objectivec">http:<span class="hljs-comment"><span class="hljs-comment">//localhost/zabbix</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">We are greeted by the setup wizard.</b> <div class="spoiler_text">  For the most part, we‚Äôll click next. <br><br><img src="https://habrastorage.org/webt/df/yw/zy/dfywzycyqbxltojtap8lyzkrgzy.jpeg"><br><br><img src="https://habrastorage.org/webt/yn/hf/hj/ynhfhjzweqgru4fm3i_ezkhv_ss.jpeg"><br><br><img src="https://habrastorage.org/webt/nk/vf/cn/nkvfcn9x9-ywwxnadt3r_zlcg9q.jpeg"><br><br><img src="https://habrastorage.org/webt/bz/3e/hk/bz3ehksro3twjchgysvmb17qdpi.jpeg"><br><br><img src="https://habrastorage.org/webt/xl/l-/rh/xll-rh69ks2v8feu8_9xxedmv30.jpeg"><br><br>  Here you need to enter the previously set password. <br><br><img src="https://habrastorage.org/webt/xi/wc/qk/xiwcqkfvfwovgkxkm9qhuo39c8q.jpeg"><br><br><img src="https://habrastorage.org/webt/0u/wd/sc/0uwdsc_nkcpaxkhjq3ai8ktxwgc.jpeg"><br><br><img src="https://habrastorage.org/webt/yq/y0/le/yqy0leokkuozbjbmshor4xxlexg.jpeg"><br><br>  At the end, the authorization window will appear, by default the user is Admin, the password is zabbix. </div></div><br><div class="spoiler">  <b class="spoiler_title">We change the language through the user settings.</b> <div class="spoiler_text">  Go to profile. <br><br><img src="https://habrastorage.org/webt/xj/ty/pq/xjtypq4-iinuuojuosrgybwesi0.jpeg"><br><br>  Choosing Russian language. <br><br><img src="https://habrastorage.org/webt/ub/vm/-2/ubvm-2evis4gk2vvkfemapfrbau.jpeg"><br><br>  Change the password from zabbix to your own and click Update. <br><br><img src="https://habrastorage.org/webt/6j/nl/hi/6jnlhivypqbsfoht6imgb7hnbbm.jpeg"><br></div></div><br><h2>  Monitoring settings, templates, triggers <br></h2><br><h3>  Zabbix server </h3><br>  We now turn to the main point, namely setting up monitoring. <br><br>  Go to "Settings" - "Host groups". <br><br><img src="https://habrastorage.org/webt/ga/xq/f1/gaxqf135gsmh1zuqpg9vgyh_-gy.jpeg"><br><br>  Here we will see the previously created system groups, you do not need to delete them. <br><br>  Click "Create a host group".  Fill in the group name, for example, Networks.  We do not add nodes yet.  Click "Add". <br><br><img src="https://habrastorage.org/webt/t6/qh/fz/t6qhfzxy5_nmmfxcsw-erldnrwk.jpeg"><br><br>  We will also need a group for our templates, click "Create a group of network nodes", in the "Name" field we write: Templates for Networks.  Click "Add". <br><br><img src="https://habrastorage.org/webt/ok/ph/ek/okphekuaoy1h_ty-jkkqrweg34u.jpeg"><br><br><h3>  Templates </h3><br>  Now let's move on to the templates: ‚ÄúSettings‚Äù - ‚ÄúTemplates‚Äù - ‚ÄúCreate a Template‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">Since we work with IP cameras and servers, the first template is to make a node check by pinging.</b> <div class="spoiler_text">  Enter the name of the template, for example, Ping Template.  We add our group Templates for Networks and we can add a description by the ‚ÄúAdd‚Äù button. <br><br><img src="https://habrastorage.org/webt/to/eh/lv/toehlvjqgiprztnqdhpg6mbp3mm.jpeg"><br><br>  Now we can select a group for templates to see our templates. <br><br><img src="https://habrastorage.org/webt/da/vl/xs/davlxsyq3ywssbdiankktotp37e.jpeg"><br><br>  Add a data item to the template, to do this, click "Data items" - "Create data items". <br><br>  In the field "Name" we indicate Ping. <br><br>  "Key" - click "Select" and select the first key.  It will return 1 if successful ping and 0 if unsuccessful, that's enough for us. <br><br><img src="https://habrastorage.org/webt/pw/d3/y6/pwd3y6sqwxw7hrfejpvvahcbmvw.jpeg"><br><br>  All parameters are set by default, therefore we delete everything that is in square brackets: <br><blockquote>  "Type of information" - select "Numeric (positive integer)". <br><br>  The field "Unit of measurement" is left blank. <br><br>  ‚ÄúUpdate interval‚Äù - here we select the ping interval, for example 60 s. <br><br>  ‚ÄúHistory retention period‚Äù - in order to reduce the size of the database, put 1 d. <br><br>  "The storage period of the dynamics of change" - 5 d. </blockquote><br><img src="https://habrastorage.org/webt/9s/qi/lh/9sqilh5wwvzoey1ib9a5ymddw3q.jpeg"><br><br>  Click "Add". </div></div><br><div class="spoiler">  <b class="spoiler_title">And you also need to know the percentage of lost packets.</b> <div class="spoiler_text">  Add immediately one more element - the percentage of lost packets. <br><br>  Click "Create a data item". <br><blockquote>  In the "Name" field, specify the lost packet. <br><br>  "Key" - click "Select" and select the second key. <br><br>  Also delete everything that is in square brackets. <br><br>  "Type of information" - "Numeric (floating point)". <br><br>  "Unit of measurement" - enter "%". <br><br>  "Update Interval" - 60 s. <br><br>  ‚ÄúHistory retention period‚Äù - 1 d. <br><br>  "The storage period of the dynamics of change" - 5 d. </blockquote><br>  Click "Add". <br><br><img src="https://habrastorage.org/webt/_z/4x/gx/_z4xgxdiyqrz3-stnolla65ns5m.jpeg"></div></div><br><h3>  Charts </h3><br>  To visualize the information, we need charts.  Select "Charts" and click "Create a graph." <br><br><img src="https://habrastorage.org/webt/e_/j8/by/e_j8by-cfzgtygpmfxlta2uy2g4.jpeg"><br><blockquote>  In the "Name" enter Ping. <br><br>  Uncheck ‚ÄúDisplay Triggers‚Äù. <br><br>  ‚ÄúData elements‚Äù - ‚ÄúAdd‚Äù - choose our Ping. </blockquote><br><img src="https://habrastorage.org/webt/vv/c8/hl/vvc8hl1or4deyaynlfrveryo9zi.jpeg"><br><br>  Also add the lost packet. <br><br><img src="https://habrastorage.org/webt/ur/lq/lm/urlqlm0gqlznnifk4vj9-ldyzke.jpeg"><br><br>  Click "Add". <br><br><h3>  Setting up remote server monitoring </h3><br><div class="spoiler">  <b class="spoiler_title">Now we give an example of setting up monitoring of a remote server.</b> <div class="spoiler_text">  Now, for example, let's add our remote server, which has a white IP address. <br><br>  Go to "Setup" - "Network nodes" - "Create a network node." <br><br><img src="https://habrastorage.org/webt/c1/za/qw/c1zaqw8rxssvqmjykvezrrwvsqi.jpeg"><br><br>  Set the name, IP-address, description (optional) and go to the addition of the template. <br><br><img src="https://habrastorage.org/webt/0i/si/aw/0isiawgyighkoedegt7yrv4jdkg.jpeg"><br><br>  In the templates, in the "Connect with new templates" field, select our template for the network and click "Add" twice. <br><br><img src="https://habrastorage.org/webt/qu/yh/s7/quyhs7gijxovyqfcc6drc_s3pj4.jpeg"><br><br>  In the nodes of the network can be seen adding our site.  It has two data elements, a graph and an active state. <br><br><img src="https://habrastorage.org/webt/g7/u7/59/g7u7592lrdsqmshrytxsak2f5cw.jpeg"><br><br>  Now we specifically turn off the network for a few minutes and see the graphs. <br><br>  ‚ÄúMonitoring‚Äù - ‚ÄúCharts‚Äù - choose our group, node and schedule. <br><br><img src="https://habrastorage.org/webt/vl/i5/al/vli5al7s4ad2qeiwb3zchanvqhu.jpeg"><br><br><img src="https://habrastorage.org/webt/_k/ur/hh/_kurhhn-ecr5a1ub2bgocehwefq.jpeg"></div></div><br><h3>  Send Setup </h3><br><div class="spoiler">  <b class="spoiler_title">To receive notifications about problems in the system, set up sending notifications</b> <div class="spoiler_text">  Go to the "Administration" - "Ways to notify." <br><br>  Select and delete standard methods. <br><br><img src="https://habrastorage.org/webt/cp/h_/qf/cph_qfi6zcz2omh2y-kgyhwxw8y.jpeg"><br><br>  Now create a new way using the button "Create a way to alert." <br><br>  Fill in the settings of our smtp-server. <br><br><img src="https://habrastorage.org/webt/ou/zh/1o/ouzh1oxoltlcw-_yrw4suaqbvwq.jpeg"><br><br>  Next you need to fill in the data of users who will be sent mail. <br><br>  Go to the "Administration" - "Users".  We select our user: Admin - ‚ÄúAlerts‚Äù - ‚ÄúAdd‚Äù - in the field ‚ÄúSend to‚Äù we enter our mail - ‚ÄúAdd‚Äù. <br><br><img src="https://habrastorage.org/webt/bx/bm/jk/bxbmjka2ijhxaxik1fgyh-r5tqo.jpeg"><br><br>  Now we will create a trigger that, when triggered, will require sending an email message. <br><br>  ‚ÄúSettings‚Äù -&gt; ‚ÄúNetwork nodes‚Äù -&gt; ‚ÄúTriggers‚Äù -&gt; ‚ÄúCreate trigger‚Äù. <br><br><img src="https://habrastorage.org/webt/ug/lh/op/uglhopz0lqyc-7p2kwtuptznblc.jpeg"><br><br>  Add our item. <br><br><img src="https://habrastorage.org/webt/8u/0y/yk/8u0yyk7fwdxzofoemcpju82qdwo.jpeg"><br><br><blockquote>  ‚ÄúName‚Äù - enter Ping fail. <br><br>  ‚ÄúImportance‚Äù is set independently, here ‚ÄúAverage‚Äù. </blockquote><br>  "Add". <br><br>  Create an action that will send us alerts when triggers are triggered. <br><br>  ‚ÄúSetup‚Äù - ‚ÄúActions‚Äù - ‚ÄúEvent Source‚Äù - ‚ÄúTriggers‚Äù - ‚ÄúCreate Action‚Äù. <br><br><img src="https://habrastorage.org/webt/os/fy/dm/osfydmk87jpejqoe5xwdva9mfe0.jpeg"><br><br>  Enter the name of the action, delete the standard condition and add our own type ‚ÄúTrigger‚Äù - ‚ÄúSelect‚Äù. <br><br><img src="https://habrastorage.org/webt/ts/jn/6i/tsjn6ildu9rkh-7mgfo4n9blxiw.jpeg"><br><br>  In the "New condition" field, click "Add" and go to the "Operations" tab. <br><br>  Here you can choose the duration, subject and text of the message.  Leave them by default. <br><blockquote>  "The default operation step duration" - set 10 m. <br><br>  ‚ÄúSend to users‚Äù - choose our user. <br><br>  "Send only through" - email. </blockquote>  Add our action. <br><br><img src="https://habrastorage.org/webt/_7/wn/sb/_7wnsb_kkjaozpgarszibdpd5iu.jpeg"><br><br>  Turn off the network for verification. <br><br><img src="https://habrastorage.org/webt/tx/z0/by/txz0bylbxoodgpqa5oc2kxx2oss.jpeg"><br><br>  We go to the "Monitoring" - "Problems" and see our mistake. <br><br><img src="https://habrastorage.org/webt/z-/tm/ej/z-tmejfjho7joxpnlui6xcobo-4.jpeg"><br><br>  We check mail and see a letter about the problem. <br><br><img src="https://habrastorage.org/webt/i1/9g/kt/i19gktuvljrtazckrcwluubjjo4.jpeg"><br><br>  After receiving the letter and fixing the problem, you can click on ‚ÄúNo‚Äù in the ‚ÄúConfirmed‚Äù column in the ‚ÄúProblem Monitoring‚Äù and confirm the event by setting yourself a note. </div></div><br><h2>  Zabbix client </h2><br>  Above shows a small part of the work with zabbix, now we proceed to the most interesting.  Our goal is to put the server under control, namely the load on the central processor. <br><br>  So, let's start, with this will help us zabbix-agent. <br><br><div class="spoiler">  <b class="spoiler_title">Windows agent</b> <div class="spoiler_text">  Let's start with the Windows agent. <br><br>  It can be downloaded from the official Zabbix website by selecting the zabbix-agent for windows. <br><br><img src="https://habrastorage.org/webt/je/uj/su/jeujsu3vlur8xi5rsh-udu4c03k.jpeg"><br><br>  After you need to create a folder in which our agent will lie, for example: C: / Program Files / zabbix. <br><br>  In the downloaded file, go to the bin folder and, depending on the bitness of your operating system, go to the win32 or win64 folder.  The following describes the actions for a 64-bit OS: <br><br>  /zabbix_agents_3.4.6.win.zip/bin/win64 and from this folder we copy 3 files zabbix_agentd, zabbix_get and zabbix_sender into the folder C: / Program Files / zabbix;  Next, copy the /zabbix_agents_3.4.6.win.zip/conf folder to the C: / Program Files / zabbix folder. <br><br>  It should turn out like this: <br><br><img src="https://habrastorage.org/webt/a9/ev/vv/a9evvvqfdracwuhzwzl86npimp0.jpeg"><br><br>  Now you need to configure the configuration file in C: / Program Files / zabbix / conf /.  Open zabbix_agentd.win.conf and change the following lines: <br><br><blockquote>  LogFile = c: /zabbix_agentd.log <br>  change to <br>  LogFile = C: / Program Files / zabbix / zabbix_agentd.log; <br><br>  # LogFileSize = 1 <br>  change to <br>  LogFileSize = 100; <br><br>  # EnableRemoteCommands = 0 <br>  change to <br>  EnableRemoteCommands = 1; <br><br>  Server = 127.0.0.1 <br>  we specify the IP address of our server on which there is a zabbix-server <br>  Server = 192.168.1.105; <br><br>  # ListenPort = 10050 <br>  change to <br>  ListenPort = 10050; <br><br>  ServerActive = 127.0.0.1 <br>  we specify the IP address of our server on which there is a zabbix-server <br>  ServerActive = 192.168.1.105. </blockquote><br>  We save. <br><br>  Next we need to open a command prompt in admin mode. <br><br>  Install the service: <br><br><pre> <code class="hljs erlang"><span class="hljs-string"><span class="hljs-string">"C:/Program files/zabbix/zabbix_agentd.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:/Program files/zabbix/conf/zabbix_agentd.conf"</span></span> ‚Äìinstall.</code> </pre> <br><br>  We start the service: <br><br><pre> <code class="hljs erlang"><span class="hljs-string"><span class="hljs-string">"C:/Program files/zabbix/zabbix_agentd.exe"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:/Program files/zabbix/conf/zabbix_agentd.conf"</span></span> ‚Äìstart.</code> </pre> <br><br><img src="https://habrastorage.org/webt/jr/fd/fb/jrfdfberxsvkhj-0kjqtpfpb0ju.jpeg"><br><br>  Now you need to create a rule for the firewall. <br><br>  Go to the "Control Panel" - "System and Security" - "Windows Defender Firewall" - "Advanced Settings" - "Inbound Rules" - "Create a Rule".  Select "For the program" - "Next" - "Path of the program."  Specify the path to zabbix_agentd - ‚ÄúNext‚Äù - ‚ÄúAllow connection‚Äù - ‚ÄúNext‚Äù.  We tick off all profiles - ‚ÄúNext‚Äù - ‚ÄúName‚Äù - zabbix-agent - ‚ÄúNext‚Äù. <br><br>  Is done. </div></div><br><div class="spoiler">  <b class="spoiler_title">Linux agent</b> <div class="spoiler_text">  For Linux, installing a zabbix agent is much easier.  Moreover, some of the work has already been completed during the installation of the zabbix server. <br><br>  On the video surveillance server, you need to download and install the zabbix repository: <br><br><pre> <code class="hljs ruby">wget <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/repo.zabbix.com/zabbix</span></span><span class="hljs-regexp"><span class="hljs-regexp">/3.4/ubuntu</span></span><span class="hljs-regexp"><span class="hljs-regexp">/pool/main</span></span><span class="hljs-regexp"><span class="hljs-regexp">/z/zabbix</span></span>-release/zabbix-release_3.<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>+xenial_all.deb sudo dpkg -i zabbix-release_3.<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>+xenial_all.deb sudo apt update</code> </pre> <br>  Then install the client <br><br><pre> <code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> zabbix-<span class="hljs-keyword"><span class="hljs-keyword">agent</span></span></code> </pre> <br>  Configuring the configuration file is the same as for the windows version, with the exception of the LogFile parameter, which does not need to be touched: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> mcedit /etc/zabbix/zabbix_agentd.conf</code> </pre> <br>  Restart zabbix-agent: <br><br><pre> <code class="hljs swift">sudo /etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/zabbix-agent restart</code> </pre> <br>  Is done. </div></div><br><div class="spoiler">  <b class="spoiler_title">Getting information from the agent</b> <div class="spoiler_text">  Find out the name of the node on which there is a zabbix-agent.  For Windows, this can be viewed in the system properties. <br><br><img src="https://habrastorage.org/webt/xa/cf/_d/xacf_d3qvoydnun6br6vwuvi_sg.jpeg"><br><br>  For Linux, you can use the traceroute IP address command. <br><br><img src="https://habrastorage.org/webt/sm/ji/hd/smjihdtoqrbihcu7eettcm-gjww.jpeg"><br><br>  Now go to the web interface of the zabbix server.  Go to "Settings" - "Network nodes" - "Create a network node." <br><br><blockquote>  ‚ÄúHost name‚Äù - we indicate the name of our host, for example, Oleg-PC. <br><br>  ‚ÄúVisible name‚Äù - we specify a name that is understandable to us, for example Server Oleg-PC. <br><br>  "Agent Interfaces" - enter the IP address of our agent 192.168.1.100. </blockquote><br>  Go to the tab "Templates" and in the "Connect with new templates" click "Select". <br><br>  We use the standard template. <br><br>  Select the Templates / Operating Systems group and select the Template OS Windows template.  Double click "Add". <br><br><img src="https://habrastorage.org/webt/u2/ra/oy/u2raoyd50-nhvlkzimlygg12rvy.png"><br><br>  Similarly, the setting of information receipt from a server based on Linux is configured. <br><br>  So we get the mapping of two servers. <br><br><img src="https://habrastorage.org/webt/js/gc/cf/jsgccfd0w04vzdzdlvw62xqnd5o.png"><br><br>  We go to the "Monitoring" - "Charts", choose our group Networks - the server-ubuntu network node and see what graphs are available to us. <br><br><img src="https://habrastorage.org/webt/9v/2v/y9/9v2vy98yvzkzu8fntlrxoqwtaoy.png"><br><br>  On the Windows server, we look the same. <br><br><img src="https://habrastorage.org/webt/pt/0e/vx/pt0evxil6acbsoalbau8x8snqem.png"><br><br>  We have standard triggers that you can customize actions for.  For example: <br><br>  let's go to ‚ÄúSettings‚Äù - ‚ÄúActions‚Äù - ‚ÄúEvent Source‚Äù - ‚ÄúTriggers‚Äù - ‚ÄúCreate Action‚Äù. <br><blockquote>  "Name" - High load CPU. </blockquote><br>  Remove the standard condition and add a new one. <br><br><img src="https://habrastorage.org/webt/lk/9j/km/lk9jkmz9gz_bqgn37rsdelwqxkc.png"><br><br>  In the "Operations", as well as before, we set up receiving email messages. <br><br>  Thus, we will receive notifications when CPU is high on this node. <br><br>  Full instructions on the agent can be obtained here. </div></div><br><h2>  Templates for server monitoring </h2><br>  Standard templates can greatly help save time.  But it is better to use your own templates. <br><br><div class="spoiler">  <b class="spoiler_title">For example, create a template to monitor the amount of free memory.</b> <div class="spoiler_text">  Add another group called My test server and a template called Test agent. <br><br>  Place our group in a template and create a new data item in it. <br><br><blockquote>  "Name" - change for example to My Free memory. <br><br><pre>  ‚ÄúKey‚Äù - choose vm.memory.size [&lt;mode&gt;], instead of &lt;mode&gt; set available. </pre><br>  View the full list of modes can be in the official documentation. <br><br>  ‚ÄúType of information‚Äù - ‚ÄúNumeric‚Äù (positive integer). <br><br>  "Unit of measurement" - "B" (bytes). <br><br>  "Update Interval" - 10 m. <br><br>  ‚ÄúHistory retention period‚Äù - set the number of days that we want to store the history, for example, 3 d. <br><br>  ‚ÄúThe storage period of the dynamics of change‚Äù - change to 10 d. <br></blockquote><br><img src="https://habrastorage.org/webt/ai/mn/hc/aimnhcuzjdbmbcydegs61ekqnr0.png"><br><br>  Click "Add", add a trigger. <br><br><blockquote>  "Name" - Not enough free memory. <br><br>  ‚ÄúImportance‚Äù is high. <br><br>  In the field "Expression" we add our data element, then we select the function "Last (most recent) T value &lt;N" (set N value to "1,000,000,000"). <br></blockquote><br>  Thus, when the amount of free memory is less than 1 GB, our trigger will work. <br><br><img src="https://habrastorage.org/webt/3x/7z/rb/3x7zrblydj--ubpqx7qhne8npzg.png"><br><br>  After adding a data item, click "Add". <br><br>  We attach this template to our network node, as we did before. <br><br>  For clarity, we create a graph, the name for which can be set in Russian, for example, ‚ÄúFree memory‚Äù. <br><br><img src="https://habrastorage.org/webt/io/bv/sh/iobvsht78ekg0tmvco1jrh6pnoy.png"><br><br>  Create an action with sending a notification to the mail. <br><br><img src="https://habrastorage.org/webt/ib/cc/cj/ibcccjcelv5oafkboylawsl40iw.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Camera access monitoring</b> <div class="spoiler_text">  In the ‚ÄúLine‚Äù video surveillance system, it is possible to send simple GET requests to the server and receive a response from it, which will greatly assist us in monitoring the system.  The full specification can be found at the link: <a href="https://devline.ru/aboutweb/">devline.ru/aboutweb</a> . <br><br>  Let's consider the request for a separate frame from camera number 9 on our server. <br><br>  General view of the request (numbering of cameras from 0) <br><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/localhost:9786/cameras</span></span><span class="hljs-regexp"><span class="hljs-regexp">/8/image</span></span></code> </pre> <br><br>  Go to the menu "Settings" - "Templates".  At the template, click on the "Web", then "Create a web script." <br><br>  A full description of the fields can be found here. <br><br>  Fill in the fields: <br><br><blockquote>  "Name" - Check camera office; <br><br>  "Update Interval" - 5 m; <br><br>  ‚ÄúAttempts‚Äù - 3; <br><br>  ‚ÄúAgent‚Äù - Zabbix. </blockquote><br><img src="https://habrastorage.org/webt/gs/lq/_j/gslq_jzdjcvzhh70lschokzwjxg.png"><br><br>  Go to the "Steps" section and add a step with the following characteristics: <br><br><blockquote>  ‚ÄúName‚Äù - we come up with the name of the step; <br><br>  ‚ÄúURL‚Äù - from the specification we take the request for a frame: <a href="http://127.0.0.1/">127.0.0.1</a> : 9786 / cameras / 8 / image ‚Äù; <br><br>  ‚ÄúFollow redirects‚Äù - uncheck; <br><br>  ‚ÄúDownload headers only‚Äù - note; <br><br>  "Waiting time" - 15 s; <br><br>  ‚ÄúRequired status codes‚Äù - 200. </blockquote><br><img src="https://habrastorage.org/webt/ck/7a/ar/ck7aar5snzfekoems4brnfir1jm.png"><br><br>  Go to the section "Authentication": <br><br><blockquote>  "HTTP authentication" is simple; <br><br>  ‚ÄúUser‚Äù and ‚ÄúPassword‚Äù - data for connecting to the ‚ÄúLine‚Äù server. </blockquote><br><img src="https://habrastorage.org/webt/ww/3q/mv/ww3qmvuu4wmbo5r0v1goqc11gki.png"><br><br>  Click "Add". <br><br>  Go to the "Monitoring" - "Web". <br><br>  We see our web monitoring. <br><br><img src="https://habrastorage.org/webt/x3/cc/np/x3ccnpr98url3aucpftgky_hlhu.png"><br><br>  Now in this template we will create the trigger. <br><br><blockquote>  ‚ÄúName‚Äù - specify the name for our trigger. <br><br>  ‚ÄúExpression‚Äù - create an expression with the data element ‚ÄúFailed step of scenario - Check camera office. <br><br>  ‚ÄúFunction‚Äù - ‚ÄúLast (most recent) T value is NOT N‚Äù. <br><br>  "N" - set to 200. </blockquote><br><img src="https://habrastorage.org/webt/fq/fm/4k/fqfm4kyl08sfraltdxezfachsls.png"><br><br>  Click "Add". <br><br>  Next, configure the action with our trigger. <br><br><img src="https://habrastorage.org/webt/1f/ms/e_/1fmse_9fctpmywfznxcstkx5g-0.png"><br><br><img src="https://habrastorage.org/webt/mg/xa/o_/mgxao_2qyv81durvoogke_s3rus.png"><br><br>  Turn off the camera and check the mail. <br><br><img src="https://habrastorage.org/webt/80/ja/op/80jaopvgmj0irtdf1f6cpxcqzqu.jpeg"></div></div><br><h2>  "Cloud Line" </h2><br>  Additionally, monitoring server availability can be configured using the <a href="https://devline.ru/cloud/">free Line Cloud service</a> .  To do this, you must register the server based on the software "Line" in the service. <br><br>  To do this, open the ‚ÄúObservation Post‚Äù, then go to the ‚ÄúAdministration‚Äù menu, in the ‚ÄúNetwork‚Äù tab, select the ‚ÄúServices‚Äù item. <br><br>  The next step is to put a tick "Enable Dynamic DNS", enter a valid email address, the desired domain name and click "Register". <br><br>  Further, a confirmation code will be sent to the specified box, which must be entered to complete the registration. <br><br>  After entering the code, you must click "Confirm". <br><br>  This completes the process of enabling the Dynamic DNS service and registering a domain name. <br><br>  Next, go to the Line Cloud service and go to the Monitoring tab.  Here we put a tick "Enable monitoring" and enter the email, which will receive letters.  You can also specify a phone number to send sms-messages (the cost of one SMS will be 3 rubles). <br><br><h2>  Reactions <br></h2><br>  Camera monitoring can be configured using reactions in the Line software itself. <br><br>  To do this, go to the "Administration" - "Reactions" - "Add a reaction." <br><br><blockquote>  Time - we leave "Always." <br>  The condition - "Missing signal from the camera." <br>  Action - ‚ÄúSend Email‚Äù. </blockquote><br>  We fill our mail, choose which camera to send frames from, and set the interval to 5 minutes. <br><br><img src="https://habrastorage.org/webt/wx/hv/id/wxhvid93ruan8gqe4_racfaaa24.png"><br><br><h2>  Zabbix and video surveillance </h2><br>  So, we have reviewed the main ways of working with the zabbix monitoring system.  This is by no means all of its capabilities, but we hope that this article has benefited you and was interesting.  We hope that with this knowledge you will be able to continue to customize the monitoring of your video surveillance system.  If you have any questions, we will be happy to answer them in the comments. <br><br>  We also offer to share your experience in the comments.  What tools for monitoring network / servers / routers / sites do you use? </div><p>Source: <a href="https://habr.com/ru/post/371325/">https://habr.com/ru/post/371325/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../371309/index.html">The strange and high-speed world of racing on drones</a></li>
<li><a href="../371313/index.html">How to make a watch from the old navigator on Windows CE</a></li>
<li><a href="../371315/index.html">Work on carriers around the globe</a></li>
<li><a href="../371317/index.html">Alfa-Insurance Leaks Personal Data</a></li>
<li><a href="../371321/index.html">8 ideas - what to print as a gift for March 8</a></li>
<li><a href="../371329/index.html">Why are some clocks in Europe slower due to Kosovo and Serbia?</a></li>
<li><a href="../371331/index.html">The study calls into question adult neurogenesis</a></li>
<li><a href="../371333/index.html">People against robots. Some Californians show aggression towards robility</a></li>
<li><a href="../371335/index.html">Kaspersky Lab specialists uncovered a malware that had gone unnoticed for the last 6 years</a></li>
<li><a href="../371337/index.html">Google has opened the code for the search engine exoplanets according to data from "Kepler"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>