<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Manipulation of numbers through LDAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When integrating different PBXs among themselves or when connecting to a telecom operator, the question often arises of how a large number of numbers ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Manipulation of numbers through LDAP</h1><div class="post__text post__text-html js-mediator-article">  When integrating different PBXs among themselves or when connecting to a telecom operator, the question often arises of how a large number of numbers can be converted.  And in most cases there is no relationship between the numbers.  Alternatively, you can use the number conversion table for this, but it does not look very nice, and management will not be the easiest in this case.  The simplest, especially in the corporate market, is using the LDAP protocol for this purpose. <br><a name="habracut"></a><br>  Why LDAP, and not some other mechanism, such as an external file.  Everything is quite simple - AD is used in most companies as a corporate standard, where all the necessary information about employees is stored, namely, with their data, in this case, manipulations are required.  So why create some kind of parallel database if it already exists in your infrastructure?  Where and how such manipulations can be applied - there are a lot of options, I will only list the most popular ones I meet. <br><ul><li>  FMC service, when your mobile operator is ready to give you your extension numbers to your PBX, but the mobile phone remains in the caller‚Äôs number.  There may be a task in converting the employee's mobile number to the employee's internal number for correct display.  Accordingly, we need to find the record in AD, with the corresponding mobile number, and substitute the internal number of this AD record as the caller's number. </li><li>  The process of migration from one PBX to another.  You have two PBXs and your task is to smoothly migrate from one PBX to another, while you cannot migrate selected areas of numbers, but you need to migrate several numbers from a different range.  In this case, several fields are used, where one PBX corresponds to one field, and the second PBX corresponds to the second field.  Depending on which field the number is in, the call should be routed there. </li><li>  If we talk about Skype For Business functionality - Call via Work, then this functionality may simply be necessary, since with this functionality there may be a lot of tasks, how should the number be displayed when calling from Skype For Business on the PBX and under what number it should go this number is out. </li><li>  Well, those cases that may arise.  And as my practice shows, requests, where it is convenient to use this functionality as a result, arise quite often. </li></ul><br>  Now how it is configured. <br><br>  In order to make it clearer, we give the problem.  You need the internal number of the employee 1234 in the outgoing number, replace it with his mobile phone 89997776655. The internal number of the employee is in the telephoneNumber attribute, and the mobile number is in the Mobile attribute. <br><br>  In order to get started with LDAP, you need to enable the LDAP service on Mediant.  To do this, open VoIP-&gt; Services-&gt; LDAP 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/f92/912/263/f9291226347149c6bb52977903c8107a.png"><br><br>  LDAP Service - Enable, after which the gateway / SBC must be overloaded. <br><br>  A very important point that needs to be determined right away is the LDAP Cache.  That is, whether the gateway / SBC will remember the information that it received from LDAP or not.  And if so, how often he will update it.  This is done to ensure that with a large number of requests Mediant does not heavily load the LDAP server and process requests as quickly as possible. <br><br>  After that, we need to configure a connection to the LDAP server.  Go to: Configuration tab&gt; VoIP menu&gt; Services&gt; LDAP&gt; LDAP Configuration Table: <br><br><img src="https://habrastorage.org/files/bb5/88b/77e/bb588b77e1c6458895db73911b278cb2.png"><br><br>  Here you can configure the IP address of the server and its purpose.  I will describe only a number of parameters on this page, since most of the parameters are understandable by name: <br><ol><li>  LDAP Bind DN is the name of the account that is used to log into the LDAP server.  It can be written in one of the following formats: <br><ul><li>  CN = Administrator, CN = Users, DC = domain, DC = com </li><li>  administrator@domain.com </li><li>  domain \ administrator </li></ul></li><li>  It is also important to choose what you use LDAP for (type parameter) <br><ul><li>  Control (default) - means that this server will be used to signal voice traffic.  Actually, that option which we consider in this example. </li><li>  Management - when this option is selected, the LDAP server is used to check the access authorization for the voice gateway control. </li></ul></li></ol><br>  By default, Mediant does not use encryption, and authorization on the LDAP server occurs using the Simple method. <br>  After successfully connecting to the LDAP server, it should have ‚ÄúConnected‚Äù status. <br><br>  After connecting to the LDAP server, you need to configure the DN where the search will be performed.  This is done in: Configuration tab&gt; VoIP menu&gt; Services&gt; LDAP&gt; LDAP Configuration Table. <br><br><img src="https://habrastorage.org/files/f64/1de/8ec/f641de8ec9bc4b1799fcf6be02bcf7ab.png"><br><br>  At this stage, we configured the interface to the LDAP server and defined the area where we will search for objects.  In order to do the conversion to SIP, you need to configure Call Setup Rules, where we define how we do the object search in LDAP and what attribute we get from LDAP. <br><br>  LDAP rules are configured: Configuration tab&gt; VoIP menu&gt; Services&gt; Call Setup Rules. <br><br><img src="https://habrastorage.org/files/927/b34/396/927b34396d69410ab6d6b2397c47c1ca.png"><br><br>  Here we describe each parameter separately: <br><ol><li>  Rules Set ID: The number of the rule set.  Sometimes it is required to use several rules, in this case several rules are configured with one Rule Set ID. </li><li>  Attribute To Query: Specifies the query string on the LDAP server.  The syntax is pretty simple.  All static data is entered in single quotes, all variables are entered without quotes.  There must be a ‚Äú+‚Äù sign between them.  Example: 'telephoneNumber =' + param.call.src.user.  The list of possible variable parameters is presented below. </li><li>  Attribute to Get: The attribute that we are trying to get from LDAP for further work with it.  In our example, this is a mobile phone number: mobile.  This parameter is entered without quotes.  If you want to get more than one attribute, in this case they are written separated by commas. </li><li>  Condition: This parameter defines the condition under which this rule works.  In our case it will be: ldap.attr.mobile exists.  (The mobile attribute exists).  Examples of other conditions: <br><ul><li>  param.call.dst.user == '1234' </li><li>  ldap.found! exists (LDAP entry not found) </li><li>  ldap.err exists (error while searching for LDAP) </li><li>  Regular expressions can also be used. </li></ul></li><li>  Action Subject: Determines which call parameter we will modify.  In our case it will be: param.call.src.user </li><li>  Action Type: What we will do with this call parameter (Add / Remove / Modify / Add Prefix / Add Suffix / Remove prefix / Remove suffix / Exit (stop Rule Set ID and do not apply the following rules) / Run Rules Set (switch to another rule). In our case - Modify </li><li>  Action Value: A parameter that determines what we will do.  In our example, we need to substitute the source in the number - the mobile phone number: ldap.attr.mobile.  The syntax for this parameter is identical to Attribute to Query.  (If Exit is configured in the action type, then the value of this parameter must be false or true. That is, if a match is made, exit or not from the Rule Set ID). </li></ol><br>  The list of parameters that can be used: <br><ul><li>  param.call.dst.user (destination number) </li><li>  param.call.src.user (caller number) </li><li>  param.call.src.name (caller name) </li><li>  param.call.redirect (call forwarding number) </li><li>  param.call.src.host (the domain of the call source is in the from field) </li><li>  param.call.dst.host (call destination domain - in the to field) </li></ul><br>  After we set up a manipulation rule, we must apply it for those calls where it is required.  This is done in the call routing settings in the Call Setup Rules Set ID parameter.  After that, the rule created by us will be applied to those calls that will be routed according to this rule, thus we can flexibly configure those cases when LDAP manipulation is required. <br>  You can also use LDAP integration for the following tasks: <br><ol><li>  Authorization of access to Mediant only for users who belong to a particular group. </li><li>  Call Routing <br><ul><li>  To route a call, based on which attribute the desired call parameter is in. </li><li>  Parallel call to several directions for each attribute of the LDAP server. </li><li>  Sequential calls to several numbers that are in the attributes of the LDAP server. </li></ul></li></ol></div><p>Source: <a href="https://habr.com/ru/post/259503/">https://habr.com/ru/post/259503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259491/index.html">Motion sensor for switching radio stations - part II</a></li>
<li><a href="../259493/index.html">Monitoring Server with Wiren Board NetMon-1</a></li>
<li><a href="../259495/index.html">HiDPI in Linux</a></li>
<li><a href="../259497/index.html">Type casting in PHP == stool with two legs?</a></li>
<li><a href="../259501/index.html">As I drove Baldu-2, or in search of the optimal algorithm</a></li>
<li><a href="../259505/index.html">Free textbook of electronics, computer architecture and low-level programming in Russian</a></li>
<li><a href="../259511/index.html">On the electronic document flow in Russia, its cheerful parochial features and the situation in general</a></li>
<li><a href="../259513/index.html">One day in the village. Skolkovo Startup Village</a></li>
<li><a href="../259515/index.html">Salt and Ansible - Python configuration management systems - video from DevConf 2014</a></li>
<li><a href="../259517/index.html">How to programmer to make money on the stock market, thinking only about the code: StockSharp and ITinvest competition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>