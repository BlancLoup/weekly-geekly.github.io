<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco Switch and Hewlett Packard Enterprise Switch Virtualization Technologies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I would like to talk about two fairly similar switch virtualization technology, which allows you to combine several switches into one logical on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco Switch and Hewlett Packard Enterprise Switch Virtualization Technologies</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b21/ef5/477/b21ef5477d544cd4a81513804c941502.png"><br><br>  Today I would like to talk about two fairly similar switch virtualization technology, which allows you to combine several switches into one logical one.  It will be about Cisco Virtual Switching System (VSS) technology and HPE Intelligent Resilient Framework (IRF).  As part of this article, we will take a closer look at how VSS technology works, after which we will talk about IRF technology. <br><a name="habracut"></a><br>  Both technologies (VSS and IRF) allow us to combine switches using ordinary Ethernet ports.  In general, these technologies can be attributed to the technology of stacking.  But both vendors still try to call them virtualization technologies.  Cisco generally avoids the word stack in relation to VSS. <br><br>  <b>Cisco VSS</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      VSS technology allows you to combine two physical switches into one logical switch.  But unlike more classic stacking technologies (StackWise, FlexStack), not any specialized cables, but Ethernet ports are used to connect switches between each other.  Thus, switches can be located at a relatively large distance from each other. <br><br>  After merging, the switches begin to operate as one logical (Figure 1).  Both switches are active and provide packet forwarding.  In this case, both switches are controlled by one of the devices.  In other words, the data processing level (data plane) is active on both devices.  But the level of control (control plane) is only on one.  Recall that the control plane (I propose to use the foreign name in the future) is responsible for the logic of the switch: handling all network protocols (L2 / L3), forming the routing table, filling in the CEF, ACL, QoS tables, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/43c/82c/769/43c82c769850454ead2f08ae36287caa.png"></div><br>  VSS technology is supported on the following Cisco switches: <br><br><ul><li>  Cisco 4500E and 4500X </li><li>  Cisco 6500E and 6800 </li></ul><br>  But to take any two such devices and combine them using VSS technology will not work.  First, not all supervisors, not all line cards, and also not all service modules support VSS technology.  For example, for the 6500E, VSS technology is supported on the Sup720-10GE and Sup2T supervisors.  Secondly, VSS technology works only between identical platforms, for example, between two 4500X or two 6500E + Sup2T.  Packing devices (line cards and service modules) may vary.  The chassis size for 4500E and 6500E switches may also vary.  There are many nuances, so it is highly desirable to see the actual requirements for hardware, software versions and licenses on the vendor's website. <br><br>  After we combined the two switches together, the overall system performance is doubled.  This is because both switches are responsible for handling packets.  Thus, we get: <br><br><ul><li>  up to 1.6 Tbps for 4500X series switches </li><li>  up to 1.8 Tbit / s for 4500E series switches with Sup 8-E supervisor, </li><li>  and up to 4 Tbps for 6500E / 6800 Series Switches with Sup2T Supervisor. </li></ul><br>  The VSS architecture is shown in Figure 2. One of the switches is chosen as the main switch, the second switch as the backup switch.  On the main switchboard, the control plane becomes active (Active), and on the backup switch it enters the Hot Standby state. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/482/387/141/4823871411544e7da559eedc0440800e.png"></div><br>  The active control plane controls the operation of both switches.  Also in the process of operation, the state is constantly synchronized between the active control plane on the main switch and the control plane on the backup switch to ensure fault tolerance.  Management and synchronization are performed through a special channel - Virtual Switch Link (VSL). <br><br>  The VSL channel is a direct connection between two switches (no intermediate devices allowed).  To ensure the VSL channel, the switches are connected to each other through normal Ethernet ports.  But when I talk about ordinary ports, I‚Äôm a little cunning.  As you might guess, these ports also have certain requirements and these requirements vary depending on the switch platform.  A special header - Virtual Switch Header (32 bytes long) is added to all packets that are transmitted through the VSL channel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/aab/5a5/036/aab5a503676c4854923e7ece1e5d2043.png"></div><br>  VSL can consist of several physical channels (which is actually recommended to do).  This is necessary for the resiliency of our system, as well as obtaining the necessary bandwidth.  Aggregation is performed using PAgP or LACP protocols.  Those.  we can maximally have 8 active channels combined into one logical VSL.  For example, if we use 10 Gbit / s ports, we will get up to 80 Gbit / s with the aggregation of 8 such channels. <br><br>  I think many have noticed that the VSL channel is analogous to a stack bus.  Therefore, it is very interesting to look at the traffic that goes through it: <br><br><ul><li>  system control traffic (traffic of protocols supporting the operation of the VSS virtual switch, including state synchronization between the switches), </li><li>  network control traffic (traffic addressed to the control plane but received by the backup switch: CDP, VTP, STP, EIGRP / OSPF, etc.), </li><li>  user traffic (including broadcast and multicast), </li><li>  service traffic (for example, SPAN). </li></ul><br>  During the discussion, we somehow dwell in more detail on each type of traffic. <br>  So, after the switches are started, protocols go into battle that provide the initial initialization of VSS: <br><br><ul><li>  Link Management Protocol (LMP) </li><li>  Role Resolution Protocol (RRP) </li></ul><br>  LMP verifies that the VSL link is up and the devices see each other.  RRP checks the hardware and software compatibility of devices, and also determines who will be the main switch and who is the backup. <br><br>  Control plane on the main switch performs two functions.  The first one provides the logic of the switch operation: programming the switch based on the configuration, processing all network protocols (L2 / L3), creating a routing table, CEF tables, managing ports, etc.  The second function is to populate all the hardware tables (FIB, Adjacency, ACL, QoS, etc.) on both switches to ensure the processing of user traffic (at the hardware level).  The control plane on the backup switch is in a hot standby state.  At the same time, the state of the active control plane is constantly synchronized with the backup one.  This is necessary in order to ensure the continuous operation of our virtual switch in case of failure of the main physical switch. <br><br>  The following information is synchronized: device boot parameters, their configuration, the status of network protocols and various tables (running on the active control plane), the state of devices (line cards, ports). <br><br>  The transfer of control data and state synchronization between the main and backup switches are performed using specialized protocols: <br><br><ul><li>  Serial Communication Protocol (SCP) - provides communication between the processor and the line cards (both local and on the remote switch) </li><li>  Inter-process Communication Packets (IPC) - provides communication between processors of distributed devices </li><li>  Inter-Card Communication (ICC) - provides communication between line cards </li></ul><br>  All of these protocols relate to the system control traffic that is transmitted between the switches over the VSL channel and form a logical control channel (Inter-Chassis Ethernet Out Band Channel - EOBC). <br><br>  State synchronization between switches is handled by stateful switching (SSO).  This mechanism appeared quite a long time ago.  For example, it is used to reserve supervisors within a single switch 6500. It is also used in VSS technology (they didn‚Äôt come up with something new).  But as we remember, SSO does not allow to synchronize the status of routing protocols.  So, when switching to a backup switch, dynamic routing protocols are started from scratch.  That automatically terminates all L3 connections with remote devices.  Those.  we get a temporary loss of communication with the outside world.  To solve this problem, SSO technology works in conjunction with Non-Stop Forwarding (NSF) technology.  This technology performs the following tasks: it ensures the transmission of L3 packets at the moment of switching (it actually freezes the old records of all routes), notifies remote routers that they do not need to break the connection, and also requests them all the necessary information to build a new routing table.  Of course, the remote devices must in this case also support the NSF technology (to be NSF-aware, so to speak). <br><br>  By the way, for reference: the backup switch takes up to 13 seconds to completely restart the dynamic routing process.  Therefore, without the NSF technology would be very sad. <br><br>  And how quickly will switching to the second switch in case of the first failure?  The vendor in this regard gives the average figure of 200 ms.  For the 6500E (apparently for the 6800 too) in some cases it can reach 400 msec (as it were, the costs of architecture distribution). <br><br>  As for the control plane, one more thing is worth noting.  Since the active control plane is only on one of the switches, all traffic of the network protocols is processed by them.  For example, dynamic routing protocol traffic (OSPF, EIGRP, etc.) must ultimately fall on the active control plane.  So, if he first got to the backup switch, this traffic will be transmitted to the main switch through the VSL channel.  In this case, the response packets can be sent directly from the main switch (priority option), and can be transmitted through the backup.  It depends on several things: the type of network protocol and the presence of a direct channel from the main switch to the receiver. <br><br>  If we are dealing with 4500E / 6500E / 6800 switches, we can install two supervisors in each of them (dubbed duplicated, so to speak).  VSS also supports this configuration (called Quad-Supervisor).  This is necessary in the case when we do not want to lose the overall system performance, in case of failure of one of the supervisors.  For all options except Sup2T, the second supervisor in the chassis works in a cold standby (Route Processor Redundancy).  This means that the second supervisor goes into working mode (becomes backup in the VSS section) only after the restart of the entire chassis.  In the case of Sup2T, the second supervisor in the same chassis works in SSO mode and no reboot is required. <br><br>  Now let's talk about transferring user traffic through a VSS virtual switch.  Still, this is his main task.  One of the main reasons for using VSS is the ability to aggregate multiple channels coming to different switches (in terms of Cisco, Multichassis EtherChannel (MEC)).  We are talking about connecting to a virtual switch external devices (for example, other switches). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e3c/b7d/44a/e3cb7d44a4104423b827cf3c0e1cc0cf.jpg"></div><br>  When we aggregate several channels into one logical one within VSS, one of the dynamic aggregation protocols (PAgP or LACP) or static EtherChannel (ON mode) can be used.  For the distribution of traffic within the logical channel responsible mechanism based on the hash function.  The hash function is applied to certain header fields of the transmitted traffic.  For example, the hash function may be applied to the value of the IP address of the sender.  In this case, if at us two channels are aggregated, then on the first channel traffic flows will be transmitted, whose IP addresses of the sender are even, and on the second channel - odd.  This allows you to distribute traffic flows between different channels combined into one etherchannel.  In more complex cases, several parameters can influence the choice of a channel at once (for example, Src IP + Dst IP + Src Port + Dst Port). <br><br>  In the case of VSS, the following rule always works: first of all, local communication channels are used to transmit traffic within the MEC (Figure 5).  This is done in order not to load the VSL channel.  I note that this statement for the 6500E / 6800 is true for both the MEC case and the Equal Cost Multipath case (if the connectivity between the virtual switch and the neighboring device goes through separate L3 channels). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e1b/75c/647/e1b75c647f714150bc5e235f78534293.png"></div><br>  And it does not matter what we have the total bandwidth for each switch.  In our example, even with a double connection between SW2 and SW3, packets arriving at SW1 and addressed to recipients for SW3 will always go through a single local port.  But if this connection is broken (or, initially, SW3 switch was connected only to SW2), all traffic will go through the VSL channel (Figure 6). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bf2/6c9/b5d/bf26c9b5d5d14ba5b74c5b40580e84c3.png"></div><br>  From here we conclude that the recommended VSS operation scheme is the connection of devices to both VSS switches at the same time (Figure 7).  In this case, our traffic will be distributed between both VSS switches and we will get an almost twofold increase in the performance of the entire system compared to one switch.  Otherwise, we load the VSL channel and lose in the overall system performance (spending the power of both switches on processing one traffic stream). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5bc/ae5/96e/5bcae596ee61469f9b81d5d2c7dab47f.png"></div><br>  To improve the performance of the mechanisms for balancing traffic within the MEC channels, the following functions have been added for VSS technology: <br><br><ul><li>  Adaptive hash distribution - when adding and removing channels, the system tries to keep traffic flows on the same channels as they were. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d2e/9e6/7cd/d2e9e67cd03546bc9487df4347f6da13.png"></div><br>  In our example (Figure 8), when adding the third channel, only the 7th and 8th traffic flows will be affected. </li><li>  The options for balancing traffic between channels are extended (for example, a VLAN number can be used), and an additional pseudo-random Unique ID is also used.  All this is added to prevent the effect of polarization of traffic (when traffic is mainly transmitted through certain channels, underloading others). </li></ul><br>  In order to finish with user traffic, I would like to note one more thing.  Through the VSL channel will also be transmitted traffic that is sent to all devices within the VLAN.  Such traffic can include broadcast traffic, traffic for which there is no data on the recipient's MAC address (unknown unicast) and multicast traffic. <br><br>  So, we found out that both switches handle traffic, while all management is focused on one of them.  The VSL channel is used as a common connecting bus through which at least control and synchronization information is transmitted.  Through this same channel, the backup switch learns that the main switch is "dead."  But what will happen if this channel breaks, while both switches will be healthy?  The answer is simple, the main switch will remain active, but the backup switch will consider that his colleague has failed, and accordingly will also become active (this is all about the control plane).  And since the configuration of these switches is one, we will get two absolutely identical devices with identical addressing on the network.  I think it is not necessary to say what this will lead to.  In order to avoid such a situation, at least you should not break the VSL channel.  But it does not always depend on us, so there is a mechanism that allows you to minimize the consequences of breaking the VSL channel.  This mechanism uses one of three methods for detecting a faulty situation: <br><br><ul><li>  Enhanced PAgP </li><li>  Fast hello </li><li>  IP BFD </li></ul><br>  After it is determined that both switches have become active due to a VSL link break, the following actions are performed: <br><br><ol><li>  A switch that was active before the VSL link broke down disables all interfaces except VSL and interfaces for which it is specified in manual mode that they do not need to be disabled.  This behavior allows the network to continue to work further, though on a single switch, but without collisions. </li><li>  As soon as the VSL channel is restored, the switch that was initially active will reboot.  After reboot, it will become backup. </li></ol><br>  Thus, when a situation occurs with two active switches, in the end, the one that was initially redundant remains active.  Let's see how each of the voiced methods works. <br><br>  In the case of Enhanced PAgP (approx. PAgP - proprietary protocol), an external device is used as a ‚Äúlitmus test‚Äù.  Each VSS switch sends a special PAgP message through local ports within the same MEC logical channel through which the external switch is connected (Figure 9).  This message contains the identifier of the active VSS switch.  Having received the ePAgP packet, the remote device sends it in the opposite direction.  If everything is fine, both switches send the same VSS active switch ID.  If both switches become active, each of them will send messages with its own identifier (Figure 10).  And since the remote device sends such messages back, both switches will realize that a bad situation has occurred. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/035/65a/e17/03565ae17ee841afabf0d8cb6afa5088.png"></div><br>  And how quickly will the failed situation be detected in this case?  As soon as the switch, which was originally a backup, becomes active, it immediately sends an ePAgP message with its ID.  Thus, the time to detect a failed situation is a fraction of seconds.  Of course, the remote device must also support ePAgP.  Such support exists on switches 2960, 3750 (but not on the stack), etc. <br><br>  The next mechanism is Fast Hello.  In this case, an additional straight L2 channel is made between the VSS switches (without intermediate devices).  Within this channel, the switches exchange VSLP Fast Hello messages.  And if the VSL channel fell, but VSLP Fast Hello packages continue to go, we have a bad situation.  The time of detecting a failed situation is a fraction of seconds (VSLP Fast Hello messages when a VSL channel is dropped are transmitted at intervals of 200 ms). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/313/ca5/a7d/313ca5a7dfab4f12b650a44e7011457c.png"></div><br>  The last detection mechanism is BFD IP (Bidirectional Forwarding Detection).  This mechanism is very similar to the operation of Fast Hello, but slower (the detection time is in seconds).  It can work through the direct channel L3.  This mechanism is not recommended to use because of its slowness.  Moreover, in the latest releases of iOS, it is missing. <br><br>  It is recommended to use simultaneously two mechanisms for detecting a faulty situation (VSL channel break). <br>  And so, in general, the main points of the work of technology Cisco VSS, we considered.  Remained a small touch - recommended design using VSS.  Consider two options: <br><br><ul><li>  To communicate with other equipment use multiple L3 channels. </li><li>  To communicate with other equipment use one L3 channel over the aggregated logical MEC </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f7f/397/aba/f7f397aba50a43c8913fbc47752f7417.png"></div><br>  In the first case, the processing of a channel break or failure of an active VSS switch will occur by means of a dynamic routing protocol.  In this case, since we will have several equal routes (along the route for each L3 channel), the total bandwidth will be aggregated at the expense of Equal Cost Multipath (ECMP).  Actually, ECMP will be responsible for distributing traffic across VSS switches.  In the second case, the processing of a channel break or failure of an active VSS switch will be handled by hardware due to the operation of Multichassis EtherChannel.  Thanks to the means of balancing traffic between channels (hash functions), MEC will also be responsible for distributing traffic across VSS switches. <br><br>  Immediately see the advantages of MEC in relation to ECMP.  We have fewer logical connections with the neighbor (only one connection), a smaller route table (from one neighbor we accept only one copy of the routes) and less load in case of failure of one of the channels (in fact, it does not exist, because the logical channel even with the loss of one physical will continue to work).  Plus, to understand this configuration is more simple. <br><br>  But what about the switching time?  For unicast traffic in both cases this time is the same.  But for multicast, no.  In the case of multicast traffic, the time of network convergence for ECMP is much longer. <br><br>  From all this conclusion: it is recommended to use the connection option with one logical connection (MEC). <br><br>  I would like to briefly touch upon another solution that basically uses VSS technology.  This solution is Cisco Catalyst Instant Access.  The idea is to get one large virtual switch within the network. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e67/027/83f/e6702783ffc34f419cd82f38d108b049.png"></div><br>  In this case, two 6500E / 6800 switches with Sup2T supervisors and specialized line cards, which are combined using VSS technology, are installed in the core of the network (Instant Access parent).  The switches of the access level (Instant Access client) use Cisco switches 6800ia or 3560CX (there can be up to 42).  It should be noted that the IA clients switches do not have local switching functions, and absolutely all packets will be transmitted to the kernel switches (IA parent).  However, the price of such switches, it seems to me, does not quite correspond to their functionality.  But this is a separate conversation. <br><br><div class="spoiler">  <b class="spoiler_title">VSS technology implementation example</b> <div class="spoiler_text">  Configuring VSS technology is easy.  Starting with Cisco IOS XE version 3.6.0E (IOS 15.2 (2) E), you can use a simplified configuration scheme, Easy VSS, to combine two switches into one virtual switch.  The two switches are connected to each other and should be visible at the L3 level.  Next, we introduce the command to convert to VSS mode on the switch, which we will have the main one: <br><br>  SwitchA # switch convert mode easy-virtual-switch <br><br>  Specify the ports that will form the VSL channel (switches should already be connected to each other through these ports): <br><br>  SwitchA (easy-vss) # VSL Te1 / 1/15 Te1 / 1/16 <br><br>  After that, both switches will reboot to switch to VSS mode.  This completes the minimum setting. <br><br>  If we configure VSS in the classical way, in fact, the scheme is not very complicated.  On both switches we configure the following: <br><br><ul><li>  Virtual Domain (Virtual Switch Domain) and the number of the switch in it: <br><br>  SwitchA (config) # switch virtual domain 2 <br>  SwitchA (config-vs-domain) # switch 1 <br><br>  SwitchB (config) # switch virtual domain 2 <br>  SwitchB (config-vs-domain) # switch 2 <br><br></li><li>  VSL Port Channel: <br><br>  SwitchA (config) # interface port-channel 1 <br>  SwitchA (config) # switchport <br>  SwitchA (config-if) # switch virtual link 1 <br>  SwitchA (config-if) # no shutdown <br><br>  SwitchB (config) # interface port-channel 2 <br>  SwitchB (config) # switchport <br>  SwitchB (config-if) # switch virtual link 2 <br>  SwitchB (config-if) # no shutdown <br><br></li><li>  Add physical ports to the created PortChannel for the VSL channel: <br><br>  SwitchA (config) # interface range tengigabitethernet 1 / 15-16 <br>  SwitchA (config-if) # channel-group 1 mode on <br><br>  SwitchB (config) # interface range tengigabitethernet 1 / 15-16 <br>  SwitchB (config-if) # channel-group 2 mode on <br><br></li><li>  We start conversion on both switches to VSS mode: <br><br>  SwitchA # switch convert mode virtual <br>  SwitchB # switch convert mode virtual </li></ul><br>  After the switches switch to VSS mode, the QoS settings for the VSL channel will be automatically added to the configuration.  Additionally (optionally) we can configure the detection of the situation with two active control plane, in the event of a VSL channel rupture.  And also set the MAC address of the virtual switch (by default it is set dynamically). <br><br>  Let's now see what we get after combining switches using the example of the Cisco 4500X: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/31c/729/b73/31c729b735ef4c59b340393506c03b57.jpg"></div><br>  The first switch has become primary / active (VSS Active, id = 1), and the second one is redundant (VSS Standby, id = 2).  The control plane of the first switch became active (Control Plane State = ACTIVE), and the control plane of the second switch became active (Control Plane State = STANDBY), in hot standby mode (Current Software state = STANDBY HOT (switchover target)).  To ensure fault tolerance, we use the SSO mechanism (Operating Redundancy Mode = Stateful Switchover).  We also see that the data plane on both switches is active (Fabric State = ACTIVE). <br><br>  The following information shows which ports we use for the VSL channel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a89/00f/791/a8900f7910e54e33a5a5566696bcc511.jpg"></div><br>  As we see, ports Te1 / 1/15 and Te1 / 1/16 are used under the VSL channel.  LMP is running between the switches.  Through both ports, using the LMP protocol, we see the second switch (Hello bidir). <br><br>  At this point, the discussion of the work of Cisco VSS I propose to complete and go to the HPE IRF solution. </div></div><br>  <b>HP Enterprise IRF</b> <br><br>  About the HPE IRF solution can be described in less detail than with Cisco VSS.  This is due to the fact that the information on this technology is not so much and most often it is rather superficial.  Although it may be for the better, you don‚Äôt need to ‚Äúkill‚Äù the brain in an attempt to deal with the details.  On the other hand, the feeling that you are working with a certain black box does not leave you. <br><br>  In general, if we are talking about two HPE switches that are stacked (the vendor admits this definition), the work of IRF and VSS is very similar.  One of the switches is selected as the master (Master), the second becomes the slave (Slave).  Traffic is handled by both switches (i.e. the data plane is active on both devices).  The control is exercised by the main switch (it will have an active control plane), while its state is synchronized with the slave. <br><br>  As a "stack bus" using conventional Ethernet ports.  On some models, even 1 Gb / s ports can be used for this, but in most cases ports of at least 10 Gb / s are required.  Between the switches, an IRF channel is made (analogous to the VSL channel).  All packages add an additional header (IRF tag). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a4e/f30/6c2/a4ef306c23894720bfdf1149e74472ee.png"></div><br>  Since the current state of the control plane is synchronized between the switches inside the stack, the failure of the main switch does not stop the traffic.  This behavior is similar to the operation of Cisco SSO.  Unlike Cisco VSS, synchronization also includes the status of routing protocols.  And since the switching takes a rather short time (the vendor claims 50 ms), neighboring devices do not have time to detect the failure of one of the switches and break the L3 connections.  Therefore, an analogue technology Cisco NSF is not required. <br><br>  Like in VSS technology, the IRF stack supports the aggregation of links connected to different stack switches.  To ensure the harmonization of the parameters of the logical channel, the LACP protocol is used. <br><br>  As for the temporary indicator, they look pretty good with IRF technology.  For example, the 50 ms indicated above are not the average value, but the maximum.  In a number of documents indicated that in fact the switch will happen faster.  The same applies to the switching time of traffic flows in the case of adding / deleting physical channels as part of aggregation into one logical one.  The value is given - 2 ms.  At Cisco, this value is 200 ms.  With such temporal indicators, no hash adaptive functions are required. <br><br>  In the event that the IRF channel is broken and both switches decide to become active, the IRF works using a similar algorithm with Cisco VSS.  One of the switches retains its role as the main one, the second switch enters the recovery state (Recovery-state).  In this state, it disables all ports except IRF and those ports for which in manual mode indicates that they do not need to be disabled.  As soon as the IRF channel is restored, the switch that was in the recovery state will reboot.  After the reboot, it will become the slave. <br><br>  Multi-active detection schemes are also very similar to those we looked at in Cisco VSS.  HPE IRF supports the following options: <br><br><ul><li>  LACP MAD (work is similar to Cisco Enhanced PAgP) </li><li>  BFP MAD (work similar to Cisco IP BFP) </li><li>  ARP MAD (Gratuitous ARP is used, containing the identifier of the active device) </li><li>  ND MAD (uses Neighbor Discovery NS packets for IPv6) </li></ul><br>  HPE recommends using LACP or BFP MAD, since these mechanisms are the fastest.  ARP and ND MAD are slower and require the use of STP (which is a little unexpected).  By the way, the mechanisms use different logic to select the switch that remains the main (master), so HPE does not recommend using them together (namely, LACP together with the others). <br><br>  Now let's see how HPE IRF differs from Cisco VSS. <br><br>  First, IRF technology is supported on a wider model range of switches.  In fact, this is the basic stacking technology, which is also available on relatively cheap A3100 switches and on expensive modular 12900s. You can stack switches of only one model range, albeit with a small exception (switches from 5800 and 5820 series and 5900 and 5920 will work together ). <br><br>  Secondly, IRF technology allows stacking up to nine switches (for some models this value is limited to four).  There are two possible connection topologies of switches within the framework of the IRF: bus and ring. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cea/ba6/76d/ceaba676dc484468bc0eedebce2acaa8.png"></div><br>  The ring connection option is recommended, as it is more fault tolerant.  If one connection is broken, we will not get a situation with two active IRF switch groups. <br><br>  Judging by the description of the technology, after the switches are combined into an IRF stack, they begin to exchange some kind of hello-packages to build a common stack topology.  Further, based on this topology, packets are transmitted within the IRF stack.  Unfortunately, more detailed information could not be found. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before completing the IRF review, it is necessary to say about the development of this technology - enhanced IRF (eIRF). eIRF allows you to build a more hierarchical structure that includes two levels - the core and the access level (Clos architecture is used).</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/981/16b/26e/98116b26e9594f13a17e40cbd143fddd.png"></div><br> ,     ( Spine   Clos),     (   Controlling Bridges ‚Äî CB).    IRF    . ,     ( Leaf   Clos),            (   Port Extenders ‚Äì PE).  PE (       PEX)              .           30   .         .  Nothing like?  ,    Cisco ‚Äì  Instant Access. <br><br><div class="spoiler"> <b class="spoiler_title">   IRF</b> <div class="spoiler_text">      IRF. <br><br>   member ID.       member ID = 1, member ID     : <br><br> [Sysname2] irf member 1 renumber 2 <br> Renumbering the member ID may result in configuration change or loss. Continue? [Y/N]:y <br> [Sysname2] quit <br> {Sysname2} reboot <br><br>  ,       IRF  (    ): <br><br> [Sysname1] interface range ten-gigabitethernet 1/0/7 to ten-gigabitethernet 1/0/8 <br> [Sysname1-if-range] shutdown <br><br> [Sysname2] interface range ten-gigabitethernet 2/0/7 to ten-gigabitethernet 2/0/8 <br> [Sysname2-if-range] shutdown <br><br>     IRF : <br><br> [Sysname1] irf-port 1/1 <br> [Sysname1-irf-port2/1] port group interface ten-gigabitethernet 1/0/7 <br> [Sysname1-irf-port2/1] port group interface ten-gigabitethernet 1/0/8 <br><br> [Sysname2] irf-port 2/1 <br> [Sysname2-irf-port2/2] port group interface ten-gigabitethernet 2/0/7 <br> [Sysname2-irf-port2/2] port group interface ten-gigabitethernet 2/0/8 <br><br>  ,       IRF : <br><br> [Sysname1] interface range ten-gigabitethernet 1/0/7 to ten-gigabitethernet 1/0/8 <br> [Sysname1-if-range] undo shutdown <br> [Sysname1-if-range] quit <br> [Sysname1] save <br><br> [Sysname2] interface range ten-gigabitethernet 2/0/7 to ten-gigabitethernet 2/0/8 <br> [Sysname2-if-range] undo shutdown <br> [Sysname2-if-range] quit <br> [Sysname2] save <br><br>  IRF : <br><br> [Sysname1] irf-port-configuration active <br> [Sysname2] irf-port-configuration active <br><br>    ,   , .  IRF .      MAD. <br><br>   ,      .   (MemberID=1)     (Master),   (MemberID=2)   (Standby). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fd8/16a/1cb/fd816a1cb7264c9eaaa7facc44c97c2e.png"></div><br>   ,     IRF : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e2c/2b2/02c/e2c2b202cc5f4083ae0351a2afa1538e.png"></div><br>     IRF: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/937/bb9/36a/937bb936a2c2429194ebaa20dbe1f004.png"></div><br>   ,       IRF-Port1    (MemberID=1)  IRF-Port2    (MemberID=2). </div></div><br>  ,      ,     ,        ,        IRF. <br><br>  <b>Conclusion</b> <br><br>     ,   .   ,  ¬´     ?¬ª  . -,                         . -,      . , IRF      .   Cisco       . VSS    .   ?  And so on. -,      ,      ,   ,  ,    . <br><table><tbody><tr><th></th><th>  Cisco VSS </th><th>  HPE IRF </th></tr><tr><td>  Where is supported </td><td>  4500X, 4500E, 6500E, 6800 </td><td>  3100, 3600, 5120, etc. </td></tr><tr><td>  ,    </td><td>  2 </td><td>  9 </td></tr><tr><td>     </td><td>  (SSO/NSF) </td><td>  Yes </td></tr><tr><td>  Switching speed in case of failure of the main switch </td><td>  200-400 ms </td><td> 50  </td></tr><tr><td>     </td><td> VSL , Ethernet- </td><td>  IRF channel, Ethernet ports </td></tr><tr><td>  Situation Detection Technologies with Two Active Switches </td><td> ePAgP, Fast Hello, IP BFD </td><td> LACP, BFD, ARP, ND </td></tr><tr><td>  Preventing network problems in case of a VSL / IRF channel break </td><td>  Port blocking </td><td>  Port blocking </td></tr><tr><td>    </td><td>  Instant access </td><td>  eIRF </td></tr></tbody></table>  And finally.    ,          (  )     ,        . <br><br>  <b>Bibliography</b> <br><br>  Cisco VSS <br><br> <a href="http://www.cisco.com/c/en/us/td/docs/solutions/Enterprise/Campus/VSS30dg/campusVSS_DG.html">Campus 3.0 Virtual Switching System Design Guide</a> <br> <a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst6500/ios/15-1SY/config_guide/sup2T/15_1_sy_swcg_2T/virtual_switching_systems.html">Release 15.1SY Supervisor Engine 2T Software Configuration Guide, Virtual Switching Systems (VSS)</a> <br> <a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst6500/ios/15-1SY/config_guide/sup720/15_1_sy_swcg_720/virtual_switching_systems.html">Release 15.1SY Supervisor Engine 720 Software Configuration Guide, Virtual Switching Systems (VSS)</a> <br> <a href="http://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/XE3-8-0E/15-24E/configuration/guide/xe-380-configuration/vss.html">Catalyst 4500 Series Switch Software Configuration Guide, IOS XE 3.8.0E and IOS 15.2(4)E, Virtual Switching Systems (VSS)</a> <br><br>  HPE IRF <br><br> <a href="http://www8.hp.com/h20195/v2/GetDocument.aspx%3Fdocname%3D4AA5-3379ENW%26cc%3Dus%26lc%3Den">HP Intelligent Resilient Fabric (IRF) ‚Äî Frequently Asked Questions</a> <br> <a href="http://h20565.www2.hpe.com/hpsc/doc/public/display%3Fsp4ts.oid%3D5221896%26docId%3Demr_na-c04566741%26docLocale%3Den_US">HP 5920 &amp; 5900 Switch Series IRF Configuration Guide</a> <br> <a href="http://h10032.www1.hp.com/ctg/Manual/c03941563">HP FlexFabric 12900 Switch Series IRF Configuration Guide</a> <br> <a href="http://www.h3c.com/portal/Products___Solutions/Technology/IRF/Technology_White_Paper/201407/833367_57_0.htm">H3C IRF Technology White Paper</a> </div><p>Source: <a href="https://habr.com/ru/post/271595/">https://habr.com/ru/post/271595/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271585/index.html">We need less powerful programming languages.</a></li>
<li><a href="../271587/index.html">Microsoft has withdrawn the updated Windows 10 from the download portal</a></li>
<li><a href="../271589/index.html">IBM Watson taught to discuss world-class problems</a></li>
<li><a href="../271591/index.html">Centralized Email Alerts</a></li>
<li><a href="../271593/index.html">Micro-conference UX-Environment ‚Ññ26: Design Education in Russia</a></li>
<li><a href="../271597/index.html">Corporate phishing</a></li>
<li><a href="../271601/index.html">Intensive German: how ABBYY Compreno teaches new languages</a></li>
<li><a href="../271605/index.html">EOIP & DD-WRT for connecting two apartments into one network or all for Remote Play</a></li>
<li><a href="../271611/index.html">YouTube Phenomenon: Thinking Locally to Be Global</a></li>
<li><a href="../271621/index.html">About programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>