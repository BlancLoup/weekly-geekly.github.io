<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vkomg. Development of the next useless service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have always been interested in various ‚Äúbuns‚Äù for social networks in terms of marketing. Namely, how quickly this next nonsense will go into mass us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vkomg. Development of the next useless service</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="http://dimon4eg.info/files/habr/1c.png" alt="image"><br>  I have always been interested in various ‚Äúbuns‚Äù for social networks in terms of marketing.  Namely, how quickly this next nonsense will go into mass use and how much effort will be spent to achieve this effect.  Below I will tell the result of what I learned from the example of our last work, <a href="http://vkomg.com/">vkomg.com</a> <br><br>  For several years I have been working as a freelance in an American web development company.  The work is quite standard for the average freelance desktop: refinement of the curved code inherited from the past developers of the project, buns and plugins for CMS, sometimes quite large-scale startups.  All this, of course, is good.  But it has long been known that small, seemingly useless things do not bring the return much more.  Therefore, one day, after seeing new profiles on Facebook, we developed a service for creating the next <s>useless</s> funny avatar effect. <br><img src="http://dimon4eg.info/files/habr/2c.png" alt="image" align="left" width="250"><br>  A couple of days ago, when I saw that exactly the same block appeared on my native VKontakte with photos near the main photo, we had the idea to remake the existing Facebook project <a href="http://www.vkomg.com/">on VKontakte</a> on the very first day. <br>  Having achieved quite interesting results in the United States, without having laid out any funds from one‚Äôs own pocket for promotion, starting with just one link in one‚Äôs own profile, it became very interesting what results Russia would show. <br>  Specific figures, history, results and pieces of code in the continuation of the post. <br><br>  <b>UPD: Habraeffekt in action.</b>  <b>We swear with technical support for non-compliance with the promised maximum load of reality.</b> <br>  <b>UPD2: Hoster corrected.</b>  <b>The server is in full health.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Where to begin? </h4><br>  PHP was chosen as the language for developing the first Facebook version.  Already had the baggage of ready-made pieces of code, and the launch of previously other analogues was one of the main requirements.  This was the main reason for choosing this language. <br>  The main features and requirements were: <br><ul><li>  Ajax download photo file with progress indicator; </li><li>  Preloading interface elements for greater user convenience; </li><li>  Easy opportunity to position the mask on the photo; </li><li>  Preview; </li><li>  The ability to download finished photos in one archive; </li><li>  The ability to display photos horizontally without reloading the page; </li><li>  The absence of any material investment in advertising. </li></ul><br><h4>  Mask and file format </h4><br>  The heart, of course, is far from the crop photo script, but the JS mask, which allows the user to visually select exactly that piece of the picture that will be used as a future userpic. <br><img src="http://dimon4eg.info/files/habr/3c.png" alt="image"><br><br>  Of course, like any other lazy developers, we rushed to look for ready-made scripts that could be refined to exactly the functionality that we need.  After viewing a few dozen pages issued by various search engines, it became clear that you would have to write your own mask from scratch.  All ready-made solutions were either very crooked, or they required no less time to finalize them than writing their own script from scratch.  Everything was done in a crazy rush, so about the design of the mask in the form of a normal, adequate plug-in for jQuery could not speak.  After the main functionality is completed, I plan to rewrite the script from scratch in the form of a normal jQuery plugin with the possibility of easy use in subsequent products. <br><br>  The next interesting, but rather simple task in solving the problem was to flip the photo horizontally.  It was necessary to do this without reloading the page and, without any additional preprocessing of the photo on the server and with the support of all browsers.  The solution came pretty quickly.  Reflection is done by simply adding this css class to the photo container. <br><br> <code>.flip-x { <br> -moz-transform: scaleX(-1); <br> -webkit-transform: scaleX(-1); <br> -o-transform: scaleX(-1); /*  Opera */ <br> transform: scaleX(-1); <br> filter: fliph; /*  IE */ <br> } <br></code> <br><br>  In practice, I easily made sure that this method works fine in all browsers, including Opera and IE.  Nevertheless, this method has one major, but very insignificant disadvantage.  If you apply this class to the img tag, then when you try to save a picture with the browser, the unreflected original will be saved. <br>  All server image conversions are performed using <a href="http://www.imagemagick.org/script/index.php">ImageMagick</a> .  Horizontal reflection, for example, is performed as follows: <br><br> <code>system("convert -flop /path/to/file/original.jpg /path/to/file/tmp.jpg");</code> <br> <br>  Also, thanks to ImageMagick, it's easy to get support for a huge number of formats.  Not only standard jpg, gif and png.  Since the user receives jpg as a result, it makes sense to use the converter at the photo upload stage. <br><br> <code>system("convert /path/to/file/original.ext /path/to/file/out.jpg",$result); <br> if ($result===0) { <br> //   . <br> }</code> <br> <br><h4>  Loader </h4><br>  The process of uploading photos is also an important point that should be given enough attention.  Since everything was created in a terrible hurry, the first version of the bootloader was an elementary enctype = "multipart / form-data" form containing two elements: a file selection field and a submit button.  Already on the first day, we started receiving messages from users complaining about the inability to download the file.  After analyzing the messages, it turned out that they can be divided into 2 categories: <br><ul><li>  <b>"I click to download the file, but it writes to me that you first need to choose a file, but how can I choose it, if I can't even download anything?"</b> (Yes, yes ... utter nonsense, but do not underestimate the folly of users, these people clicked the submit button, not selecting the file in the first field. They believed that you first had to click the ‚ÄúUpload photo‚Äù button, which led to an inevitable error, which they were unable to comprehend) </li><li>  <b>‚ÄúI select the file, click on‚Äú Upload photo ‚Äùand everything hangs.</b>  <b>Why?</b>  (The user is trying to upload a file that is too large in size, or its connection speed is rather low) </li></ul><br>  The solution to this problem is obvious.  The fact that the lack of a normal bootloader will undermine usability was also obvious from the beginning, but haste, as always, spoils everything.  Unimportant, at first glance, moments will cause many problems in the future. <br>  To fix the situation, a jQuery plugin called <a href="http://www.uploadify.com/">Uploadify was used</a> . <br><br><img src="http://dimon4eg.info/files/habr/4.png" alt="image"><br><br>  The plugin makes it easy to implement file loading with an indicator of the loading process.  The method is fairly standard: using an element on flash for asynchronous data transfer.  The main advantage of this plugin is ease of configuration (a huge number of parameters and callbacks) and the ability to customize the appearance using CSS <br><br><img src="http://dimon4eg.info/files/habr/5.png" alt="image"><br><br>  It should also provide a use case for haters flush.  (using the same standard form for users without Flash).  The first query to the search engine gives an interesting result: a <a href="http://www.featureblend.com/javascript-flash-detection-library.html">library for determining the version of Flash</a> with all sorts of unthinkable methods. <br><br>  HTML contains two forms at once: the usual multipart and a form with flash elements.  The default flash form is hidden from the user's eyes. <br><br> <code>if(FlashDetect.installed) { <br> $('#plainform').hide(); <br> $('#ajaxform').show(); <br> }</code> <br> <br>  Thus, the regular form is easily replaced by the Uploadify form, provided that the end user has Flash. <br><br><h4>  Preview </h4><br><img src="http://dimon4eg.info/files/habr/6c.png" alt="image"><br><br>  Preview is another thing that makes life easier for a simple user.  The idea is simple: generate pictures, position pictures with CSS on a universal blank for the background.  I will not go into details.  The only thing worth mentioning here is the popup script.  Most recently, I ran into a product called <a href="http://www.gettopup.com/">TopUp</a> , which showed itself quite convincingly and over the long history of use did not cause any problems. <br><br><h4>  Preload </h4><br>  To improve the user experience on the form page, it was decided to preload all the pictures used on the mask page (for example, all the TopUp media resources so that the pop-up window appears instantly, without loading before the user's eyes).  Moreover, the loading of these elements should not affect the rendering speed of the page with the loader.  The first thing that came to mind was uploading images using JS: <br><br> <code>function preload(sources) <br> { <br> var images = []; <br> for (i = 0, length = sources.length; i &lt; length; ++i) { <br> images[i] = new Image(); <br> images[i].src = sources[i]; <br> } <br> } <br> $(window).load(function() { <br> $("#preload").attr('src','preload-step2.php'); <br> preload([ <br> "res/images/preview.png", <br> "res/images/top_up/dashboard/sprite.png", <br> "res/images/top_up/dashboard/close_link.png", <br> "res/images/top_up/dashboard/bottom_left.png", <br> "res/images/top_up/dashboard/top_right.png", <br> "res/images/top_up/dashboard/bottom_right.png", <br> .......................... <br> .......................... <br> "res/images/btn-flip.gif"] <br> ) <br> });</code> <br> <br><h4>  Watermark </h4><br>  Next came the question of creating a translucent watermark.  Remembering how many manipulations are required to implement a watermark with GD, I decided to use the same ImageMagick for this purpose. <br><br> <code>system("composite -gravity south -alpha on /path/to/file/watermark.png /path/to/file/profile.jpg /path/to/file/profile.jpg');</code> <br> <br><img src="http://dimon4eg.info/files/habr/7.png" alt="image"><br><br><h4>  Deleting obsolete files </h4><br>  Since the user will take the archive with the result not immediately, but after some time, it is necessary to provide a script for deleting obsolete temporary files.  For each user, a temporary directory is created containing all the files for this session.  Task: daily delete all directories created more than 24 hours ago. <br><br> <code>#!/bin/bash <br> for i in `find /path/to/dirs/ -maxdepth 1 -type d -mtime +1 -print`; do rm -rf $i; done</code> <br> <br><h4>  Numbers </h4><br>  And now, the most interesting is the result. <br>  No effort or money was spent on promoting the Facebook original.  All we did was change our own userpics and published the url in the news feed for our friends to see.  However, the Facebook original yesterday reached a traffic of 4,000 unique visitors per day (a very immodest result, for a project less than a month old). <br><br><img src="http://dimon4eg.info/files/habr/8.png" alt="image"><br><br>  VkOMG began likewise.  Change your own avatar and publish your status from a URL + one target advertisement with a budget of 25 rubles, which brought only 50 referrals to the official VKontakte page (namely to the VK page, and not to an external url). <br>  Nevertheless, here are our modest results for 4 days of work: <br><ul><li>  1st day - 24 unique visitors, 56 avatars created. </li><li>  2nd day - 246 users, 542 avatars created. </li><li>  3rd day - 440 unique users, 1408 avatars created </li><li>  4th day - 890 users - 2486 avatars was created. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/112901/">https://habr.com/ru/post/112901/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112890/index.html">Found alternative to silicon, better than graphene</a></li>
<li><a href="../112896/index.html">New Google office in London</a></li>
<li><a href="../112898/index.html">ColoBridge - for the love of the Internet</a></li>
<li><a href="../112899/index.html">ARM has released new Cortex chips</a></li>
<li><a href="../112900/index.html">Identification in Yandex.Money through Alfa-Bank</a></li>
<li><a href="../112904/index.html">Porsche for the poor</a></li>
<li><a href="../112907/index.html">We process pictures with Photoshop and ExtendScript Toolkit</a></li>
<li><a href="../112908/index.html">Basic recommendations for improving security * nix web server</a></li>
<li><a href="../112910/index.html">UsedAppleJuice.TV - Japanese animation online</a></li>
<li><a href="../112912/index.html">JQuery 1.5 was released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>