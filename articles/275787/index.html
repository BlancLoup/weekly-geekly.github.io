<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VPLS. Label Distribution with BGP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Any engineer who has experienced MPLS knows that tags can be distributed in two ways: DU (Downstream Unsolicited) and DD (Downstream On-Demand). In th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VPLS. Label Distribution with BGP</h1><div class="post__text post__text-html js-mediator-article">  Any engineer who has experienced MPLS knows that tags can be distributed in two ways: DU (Downstream Unsolicited) and DD (Downstream On-Demand).  In the first case, the router begins to generate tags and send all its LDP neighbors to the prefixes to which it is next-hop.  In the second case, the LSR will generate a pre-prefix label and transmit it only at the request of the upstream router.  An example of the first case is the LDP protocol, the second case is RSVP-TE.  And how are tags distributed in VPLS?  Let's see. <a name="habracut"></a><br><br>  First, what is VPLS and why is it needed?  Virtual Private LAN Services is LAN emulation for geographically (and not only) distributed networks.  Virtual L2 connections are created between separated client sites (or data center elements), as a result of which the client sees the provider's network as a connection to the switch (to which its other sites are also connected): <br><img src="https://habrastorage.org/files/8e7/3b3/b4d/8e73b3b4d09849cfa658305409872a1d.jpg"><br>  Picture taken from the site inetzero. <br><br>  There are two implementations of VPLS.  One implementation provides BGP signaling (Draft Compell), the second establishes target LDP sessions between PE routers (Draft Martini). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the second case, everything is simple.  The tags are distributed according to the Downstream Unsolicited principle using Label mapping of LDP messages with the FEC 128 type (the highlighted line is the generated tag): <br><img src="https://habrastorage.org/files/210/2e6/288/2102e6288b2c410f95a3f057d39ee6b0.jpg"><br>  It‚Äôs harder to understand how VPLS tags are distributed using BGP as an alarm (Compell Draft).  This VPLS implementation uses control plane for the following tasks: <br><br>  1. Automatic search for PE routers to which client sites are connected. <br><br>  2. Distribution of MPLS tags for the implementation of a fully connected L2 topology between client sites. <br><br>  First you need to create on each PE router to which client's sites are connected, routing instance with VPLS type: <br><pre><code class="cpp hljs">routing-instances { vpls-bgp-cutomer1 { instance-type vpls; interface ge<span class="hljs-number"><span class="hljs-number">-0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1.0</span></span>; route-distinguisher <span class="hljs-number"><span class="hljs-number">100</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>; vrf-target { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> target:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> target:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>; } protocols { vpls { site-range <span class="hljs-number"><span class="hljs-number">5</span></span>; no-tunnel-services; site ce1 { site-identifier <span class="hljs-number"><span class="hljs-number">1</span></span>; } } } } }</code> </pre> <br>  Configure BGP alarm.  For this type of VPLS, we need to enable address family l2vpn signaling: <br><pre> <code class="cpp hljs">root<span class="hljs-meta"><span class="hljs-meta"># show protocols bgp group internal { type internal; local-address 10.1.1.1; family l2vpn { signaling; } neighbor 10.3.3.3; }</span></span></code> </pre><br>  We configure interfaces in the direction of the client (for example, as follows): <br><pre> <code class="cpp hljs">root<span class="hljs-meta"><span class="hljs-meta"># show interfaces ge-0/0/1 vlan-tagging; encapsulation vlan-vpls; unit 0 { encapsulation vlan-vpls; vlan-id 512; family vpls; }</span></span></code> </pre><br>  and do not forget to increase the MTU value on the interfaces towards the core of the network, the so-called core-face interfaces. <br><br>  Now you can see if our connection is established: <br><pre> <code class="cpp hljs">root<span class="hljs-meta"><span class="hljs-meta"># run show vpls connections Layer-2 VPN connections: Legend for connection status (St) EI -- encapsulation invalid NC -- interface encapsulation not CCC/TCC/VPLS EM -- encapsulation mismatch WE -- interface and instance encaps not same VC-Dn -- Virtual circuit down NP -- interface hardware not present CM -- control-word mismatch -&gt; -- only outbound connection is up CN -- circuit not provisioned &lt;- -- only inbound connection is up OR -- out of range Up -- operational OL -- no outgoing label Dn -- down LD -- local site signaled down CF -- call admission control failure RD -- remote site signaled down SC -- local and remote site ID collision LN -- local site not designated LM -- local site ID not minimum designated RN -- remote site not designated RM -- remote site ID not minimum designated XX -- unknown connection status IL -- no incoming label MM -- MTU mismatch MI -- Mesh-Group ID not available BK -- Backup connection ST -- Standby connection PF -- Profile parse failure PB -- Profile busy RS -- remote site standby SN -- Static Neighbor VM -- VLAN ID mismatch Legend for interface status Up -- operational Dn -- down Instance: vpls-bgp-cutomer1 Local site: ce1 (1) connection-site Type St Time last up # Up trans 2 rmt Up Jan 16 20:50:51 2016 1 Remote PE: 10.3.3.3, Negotiated control-word: No Incoming label: 262154, Outgoing label: 262145 Local interface: lsi.1048832, Status: Up, Encapsulation: VPLS Description: Intf - vpls vpls-bgp-cutomer1 local site 1 remote site 2</span></span></code> </pre><br>  As you can see the connection is established.  On the output below you can see that between the client‚Äôs routers the OSPF neighborhood has risen and routes to loopbacks have appeared: <br><pre> <code class="cpp hljs">R7(config)# *Jan <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">54.554</span></span>: %OSPF<span class="hljs-number"><span class="hljs-number">-5</span></span>-ADJCHG: Process <span class="hljs-number"><span class="hljs-number">1</span></span>, Nbr <span class="hljs-number"><span class="hljs-number">20.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> on GigabitEthernet1/<span class="hljs-number"><span class="hljs-number">0.512</span></span> from LOADING to FULL, <span class="hljs-function"><span class="hljs-function">Loading Done </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R7</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#sh R7(config)#do sh ip rou R7(config)#do sh ip route Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2 E1 - OSPF external type 1, E2 - OSPF external type 2 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2 ia - IS-IS inter area, * - candidate default, U - per-user static route o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP + - replicated route, % - next hop override Gateway of last resort is not set 100.0.0.0/8 is variably subnetted, 4 subnets, 2 masks C 100.0.0.0/24 is directly connected, GigabitEthernet1/0.512 L 100.0.0.2/32 is directly connected, GigabitEthernet1/0.512 O 100.1.1.1/32 [110/2] via 100.0.0.1, 00:00:54, GigabitEthernet1/0.512 C 100.1.1.2/32 is directly connected, Loopback0 R7(config)#do ping 100.1.1.1 Type escape sequence to abort. Sending 5, 100-byte ICMP Echos to 100.1.1.1, timeout is 2 seconds: !!!!! Success rate is 100 percent (5/5), round-trip min/avg/max = 24/40/88 ms</span></span></span></span></code> </pre><br>  Packets transmitted over the network will look like this (which MTU you need to install, you can calculate it yourself): <br><img src="https://habrastorage.org/files/0df/ef4/e6f/0dfef4e6f7754ed081a2eb33240848a2.jpg"><br>  Everything is working.  Now let's see which tags are distributed between sites: <br><pre> <code class="cpp hljs">Instance: vpls-bgp-cutomer1 Local site: ce1 (<span class="hljs-number"><span class="hljs-number">1</span></span>) connection-site Type St Time last up # Up trans <span class="hljs-number"><span class="hljs-number">2</span></span> rmt Up Jan <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Remote PE: <span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>, Negotiated control-word: No Incoming label: <span class="hljs-number"><span class="hljs-number">262154</span></span>, Outgoing label: <span class="hljs-number"><span class="hljs-number">262145</span></span> Local interface: lsi<span class="hljs-number"><span class="hljs-number">.1048832</span></span>, Status: Up, Encapsulation: VPLS Description: Intf - vpls vpls-bgp-cutomer1 local site <span class="hljs-number"><span class="hljs-number">1</span></span> remote site <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><pre> <code class="cpp hljs">Instance: vpls-bgp-customer1 Local site: ce2 (<span class="hljs-number"><span class="hljs-number">2</span></span>) connection-site Type St Time last up # Up trans <span class="hljs-number"><span class="hljs-number">1</span></span> rmt Up Jan <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Remote PE: <span class="hljs-number"><span class="hljs-number">10.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, Negotiated control-word: No Incoming label: <span class="hljs-number"><span class="hljs-number">262145</span></span>, Outgoing label: <span class="hljs-number"><span class="hljs-number">262154</span></span> Local interface: lsi<span class="hljs-number"><span class="hljs-number">.1048576</span></span>, Status: Up, Encapsulation: VPLS Description: Intf - vpls vpls-bgp-customer1 local site <span class="hljs-number"><span class="hljs-number">2</span></span> remote site <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  We are interested in this output line: <br>  Incoming label: 262154, Outgoing label: 262145 <br><br>  That is, PE1 will use label 262145 to send a packet from CE1 to CE2, and with label 262154, PE1 will accept packets going from CE2 to CE1.  But how are these tags generated and transmitted?  We will understand in more detail.  To do this, we‚Äôll see a dump of BGP session traffic between PE1 and PE2 (now a BGP session is established between peers, but in real life 99% of the cases use route reflectors): <br><img src="https://habrastorage.org/files/3a3/70c/a0a/3a370ca0a145446aa7c214066fde938f.jpg"><br>  The first signaling problem is solved with the help of the notorious Route Target and Route Distinguisher.  In the extended community line of the above dump, the RT value is visible, as with L3VPN, it is used to filter the routing information.  Automatic lookup requires this type of routing-instance to have a configured RD value (by the way, it can be the same within a single VPLS domain). <br><br>  We now need to understand how the label distribution mechanism is implemented.  Of interest to us is the string NLRI.  The line contains several values, but unlike L3VPN or VPLS LDP Signaling, there is no exact indication of the generated label.  Let us analyze each value of this field. <br><br>  The first two fields I think everyone understands: <br>  <b>RD 100: 0.0.0.100</b> - this is RD (I think everyone knows what RD is, and no need to explain) <br>  <b>CE-ID</b> - here is the Site-id configured by network administrators. <br><br>  But the following three parameters are not familiar to us.  The fact is that VPLS (draft Compella) distributes tags not one by one, but in blocks of 8 (by default) tags in a block.  These fields characterize the distributed block of labels. <br><br>  <b>Label-Block Offcet</b> is a label offset from the label base; <br>  <b>Label-Block Size</b> - the size of the label block, in JunOS by default it is equal to 8 labels; <br>  <b>Label Base</b> is a tag block database. <br><br>  Now the math begins.  The PE router to which the client's site is connected sends a message to all the other BGP Update PE routers, containing: <br>  1. RD <br>  2. CE-ID <br>  3. Label-Block Offcet <br>  4. Label-Block Size <br>  5. Label Base <br><br>  Since VPLS is a set of LSPs nested in other LSPs, we need to know: <br>  1. With what tag to send a package to any site <br>  2. From which site did the packet arrive with the specified label <br><br>  The PE router, having received the above BGP Upgrade message, performs the following operations.  using data from a neighbor: <br><br>  <b>Outgoing Label = Label Base Remote Site - Label-Block Offcet Remote Site + your Site ID</b> <br><br>  In our case, PE2 will perform the following operations: the value of the base 262153, subtracts the value of the label shift (we have 1) and adds its Site-ID to this value.  This will be the outgoing tag to the site from which the BGP Update message came: <br><br>  We obtain that, from the CE2 site to get to the CE1 site, PE2 must send a packet with the tag: 262153 (base) -1 (shift) +2 (site-id) = 262154.  We are looking at the conclusion: <br><pre> <code class="cpp hljs">Instance: vpls-bgp-customer1 Local site: ce2 (<span class="hljs-number"><span class="hljs-number">2</span></span>) connection-site Type St Time last up # Up trans <span class="hljs-number"><span class="hljs-number">1</span></span> rmt Up Jan <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Remote PE: <span class="hljs-number"><span class="hljs-number">10.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, Negotiated control-word: No Incoming label: <span class="hljs-number"><span class="hljs-number">262145</span></span>, Outgoing label: <span class="hljs-number"><span class="hljs-number">262154</span></span> Local interface: lsi<span class="hljs-number"><span class="hljs-number">.1048576</span></span>, Status: Up, Encapsulation: VPLS Description: Intf - vpls vpls-bgp-customer1 local site <span class="hljs-number"><span class="hljs-number">2</span></span> remote site <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  That's right, the outgoing label is 262154. Now, PE1, receiving a packet with the specified label 262154, knows that this packet was sent from PE2 of the CE2 site. <br><br>  The incoming label is calculated in the same way, only the base value and the shift are taken on their own (generated by us for other PE routers), and the site-id of the necessary PE router is used as the site identifier: <br><br>  <b>Incoming label = your Label Base - your Label-Block Offcet + Site ID of the remote site</b> <br><br>  Let's change the configuration and perform the calculation again.  Now we have the maximum number of sites 10, and our sites have identifiers 9 (CE1) and 6 (CE2) (there is no sense to configure the remaining 8 sites to understand the principle, since the calculations will be the same, but they will be more).  Try again to calculate the value of the labels.  Let's look at traffic dumps: <br>  From PE1 to PE2: <br><img src="https://habrastorage.org/files/0d2/3f8/a0e/0d23f8a0e47c4d4aa28269ae300fde14.jpg"><br>  From PE2 to PE1: <br><img src="https://habrastorage.org/files/d0f/89e/cdc/d0f89ecdc6934e828c350086e5e867d5.jpg"><br>  We have such data. <br>  From PE1: <br>  RD <b>100: 0.0.0.100</b> <br>  CE-ID <b>9</b> <br>  Label-Block Offcet <b>1</b> <br>  Label-Block Size <b>8</b> <br>  Label Base <b>262169</b> <br><br>  From PE2: <br>  RD <b>200: 0.0.0.200</b> <br>  CE-ID <b>6</b> <br>  Label-Block Offcet <b>1</b> <br>  Label-Block Size <b>8</b> <br>  Label Base <b>262153</b> <br><br>  Now let's calculate what incoming and outgoing tags should be at the sites. <br><br>  PE1 (site 9): <br>  Inbound label from site 6: 262169-1 + 6 = <b>174</b> <br>  Outgoing label to site 6: 262153-1 + 9 = <b>161</b> <br><br>  PE2 (site 6): <br>  Inbound tag from site 9: 262153-1 + 9 = <b>161</b> <br>  Outgoing label to site 9: 262169-1 + 6 = <b>174</b> <br><br>  And check the calculations made: <br><br>  On PE1: <br><pre> <code class="cpp hljs">Instance: vpls-bgp-cutomer1 Local site: ce1 (<span class="hljs-number"><span class="hljs-number">9</span></span>) connection-site Type St Time last up # Up trans <span class="hljs-number"><span class="hljs-number">6</span></span> rmt Up Jan <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Remote PE: <span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>, Negotiated control-word: No Incoming label: <span class="hljs-number"><span class="hljs-number">262174</span></span>, Outgoing label: <span class="hljs-number"><span class="hljs-number">262161</span></span> Local interface: lsi<span class="hljs-number"><span class="hljs-number">.1048833</span></span>, Status: Up, Encapsulation: VPLS Description: Intf - vpls vpls-bgp-cutomer1 local site <span class="hljs-number"><span class="hljs-number">9</span></span> remote site <span class="hljs-number"><span class="hljs-number">6</span></span></code> </pre><br>  On PE2: <br><pre> <code class="cpp hljs">Instance: vpls-bgp-customer1 Local site: ce2 (<span class="hljs-number"><span class="hljs-number">6</span></span>) connection-site Type St Time last up # Up trans <span class="hljs-number"><span class="hljs-number">9</span></span> rmt Up Jan <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Remote PE: <span class="hljs-number"><span class="hljs-number">10.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, Negotiated control-word: No Incoming label: <span class="hljs-number"><span class="hljs-number">262161</span></span>, Outgoing label: <span class="hljs-number"><span class="hljs-number">262174</span></span> Local interface: lsi<span class="hljs-number"><span class="hljs-number">.1048577</span></span>, Status: Up, Encapsulation: VPLS Description: Intf - vpls vpls-bgp-customer1 local site <span class="hljs-number"><span class="hljs-number">6</span></span> remote site <span class="hljs-number"><span class="hljs-number">9</span></span></code> </pre><br>  As you can see, we calculated everything correctly. <br><br>  If you still do not understand how this mechanism works, I ask you <s>to have funny pictures</s> under the spoiler <div class="spoiler">  <b class="spoiler_title">in pictures</b> <div class="spoiler_text">  Consider this topology: <br><img src="https://habrastorage.org/files/f56/b20/cf0/f56b20cf048343a385f5d6ba7bcfa868.jpg"><br>  VPLS will create a fully connected topology between all three client sites: <br><img src="https://habrastorage.org/files/113/ed4/7c9/113ed47c934841dab6fa9205cab422f7.jpg"><br>  PE1 sends to PE2 and PE3 BGP Update messages with the data indicated in the illustration: <br><img src="https://habrastorage.org/files/e68/88e/a90/e6888ea90ca44c37b953765408fc263a.jpg"><br>  PE2 and PE3 calculate the values ‚Äã‚Äãof outgoing tags to PE1 using the formula, and PE1 calculates incoming tags from PE2 and PE3: <br><img src="https://habrastorage.org/files/110/429/6d0/1104296d0bdf4fb19746ecea1ed3aad3.jpg"><br>  The following images illustrate the process described above on PE2: <br><img src="https://habrastorage.org/files/64b/371/30d/64b37130d8314b96a52c20f3f6ea0a67.jpg"><br>  And on PE3: <br><img src="https://habrastorage.org/files/19f/221/f9c/19f221f9c0de46d48328d9072236fca6.jpg"><br>  As a result, all PE routers have both incoming and outgoing tags for all sites: <br><img src="https://habrastorage.org/files/013/77a/b1c/01377ab1c46245029cdceb3236c3fc0d.jpg"><br></div></div><br>  I want to add that if a client has for example 10 or 12 sites, then we need not one standard block of tags, but two.  Therefore, in the BGP Update message there can be several values ‚Äã‚Äãfor the shift of the tags and the base: <br><img src="https://habrastorage.org/files/30d/2ea/f72/30d2eaf725744cf68912ff504ca4ac6d.jpg"><br>  And one more addition - JunOS by default uses a block of 8 tags, even if you need to connect only two or three sites.  But using the set label-block-size command, you can change the number of labels in a block.  JunOS supports 2, 4, 8, or 16 tags per block.  But keep in mind that if you change this value on an already running VPLS domain, then all connections established in this VPLS domain will be broken and re-installed, with new parameters. </div><p>Source: <a href="https://habr.com/ru/post/275787/">https://habr.com/ru/post/275787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275771/index.html">Pets vs cattle</a></li>
<li><a href="../275779/index.html">Microsoft sent a request for appruv ChakraCore support implementation in Node.js along with the V8 engine</a></li>
<li><a href="../275781/index.html">The digest of interesting materials for the mobile developer # 137 (on January 18-24)</a></li>
<li><a href="../275783/index.html">Swift improve performSegueWithIdentifier or convenient router with storyboards</a></li>
<li><a href="../275785/index.html">How to use SQL DB in student Microsoft AZURE from Dreamspark</a></li>
<li><a href="../275789/index.html">Tricky C # Questions</a></li>
<li><a href="../275795/index.html">Example of creating a web application using the Vaadin libraries</a></li>
<li><a href="../275797/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ195 (January 18 - 24, 2016)</a></li>
<li><a href="../275801/index.html">Rust and Blab's Paradox</a></li>
<li><a href="../275803/index.html">Service Monitoring with Prometheus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>