<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic notification of readers about the news using VKontakte. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First part 

 In the first part, we learned how to automatically publish entries on our wall, today we will add blackjack and sluts to add pictures to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic notification of readers about the news using VKontakte. Part 2</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/blogs/social_networks/113968/" title="First part">First part</a> <br><br>  In the first part, we learned how to automatically publish entries on our wall, today we <strike>will</strike> add <strike>blackjack and sluts</strike> to add pictures to links automatically.  This time I will not give ready-made php functions, as they are described in the first part, and now I will only describe the php files and parameters that we need to pass to them. <br><br>  After the first part I received a large number of messages, most of which were devoted to what I demonstrated in the article the possibility of publishing on my own wall, and I did not show automatic publication on the wall of the Group or the Official page.  Therefore, I will start with what parameters you need to pass. <br><a name="habracut"></a><br><h4>  Official page </h4><br>  You must be a member of the page administrators to be able to post news.  Consider we need the parameters that are passed to al_wall.php when publishing a simple message: <br><pre><code class="php hljs">act =&gt; <span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'delete'</span></span> al =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> facebook_export =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> status_export =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> friends_only =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> hash =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> message =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> note_title =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> official =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> to_id =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> type =&gt; <span class="hljs-string"><span class="hljs-string">'all'</span></span> media =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> media_type =&gt; <span class="hljs-string"><span class="hljs-string">'photo'</span></span></code> </pre> <br><ul><li>  In the act parameter we pass the necessary action - either 'post' to publish the message, or 'delete' to delete it.  Moreover, when deleting, you must also pass the parameter 'post', which contains the page id and the message sequence number on the wall, for example, 11111_32; </li><li>  The facebook_export and status_export parameters are used to export to Facebook and Twitter services, if they are linked to the page; </li><li>  The hash parameter is already familiar to us, it can be found when opening a page or group in a block with parameters called post_hash; </li><li>  It is worth noting that the note_title parameter is omitted, that is, no notes will be created, instead your entry will be cut if it exceeds the allowable size; </li><li>  In to_id it is worth passing your official page id or group with a minus sign in front, for example, '-11111'; </li><li>  It remains to consider the media and media_type, in the first you should pass an internal link to the desired object, and in the second its type.  For example, media =&gt; '1111_1213232213', media_type =&gt; 'photo'.  In this case, the specified photo will be attached to the record.  The type can also be 'audio', 'video'.  If you pass the type 'share', and in 'media' a pointer to a photo, then in the message link this photo will be in the tooltip.  Just need not forget to add three more parameters known to us for the link - url, title and description </li></ul><br>  Alas, but so far I have not found a way to publish a message-photo together with a message-link as it was done on the page Habrahabr VKontakte. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Upload photos </h4><br>  In fact, when downloading a picture, the main thing is not to forget about the proxy, and then everything is quite simple.  So, to upload a picture, we will use the share.php file, which is intended for publishing external links.  Here is an example of POST parameters that need to be passed to it: <br><br><pre> <code class="php hljs">act =&gt; a_photo url =&gt; image =&gt; extra =&gt;</code> </pre><br>  In the url parameter, you pass your link, in the image parameter - a link to the desired image, and you can ignore the extra parameter.  I note that if you use CURL, as I did in the last part, then do not forget the following: <br><pre> <code class="php hljs">curl_setopt($ch, CURLOPT_REFERER, <span class="hljs-string"><span class="hljs-string">'http://vkontakte.ru/share.php'</span></span>); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  We need the second parameter, because after sending a POST request, share.php will redirect the request (by returning 302 errors and passing the Location parameter) to upload.php with the necessary server and the necessary parameters, which I think makes no sense.  In turn, upload.php will redirect the request to complete.php, which, depending on the success, will produce either an error or the result we need. <br><br>  Option with error: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.domain = location.host.toString().match(</span><span class="hljs-regexp"><span class="javascript"><span class="hljs-regexp">/[a-zA-Z]*\.[a-zA-Z]*$/</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]; parent.onUploadFail(</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' '</span></span></span><span class="javascript">); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This means that most likely your link to the picture is incorrect or invalid.  The option we need looks like this: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.domain = location.host.toString().match(</span><span class="hljs-regexp"><span class="javascript"><span class="hljs-regexp">/[a-zA-Z]*\.[a-zA-Z]*$/</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]; parent.onUploadDone(</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">, {</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"user_id"</span></span></span><span class="javascript">:</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1234567</span></span></span><span class="javascript">,</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"photo_id"</span></span></span><span class="javascript">:</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">235889241</span></span></span><span class="javascript">}); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here it is, the very photo_id that needs to be transmitted when placing a photo on the wall, in this case, the full composite id: 1234567_235889241.  Just, isn't it? <br><br>  To get a direct path to the uploaded photo, you need to send a request to al_photo.php, which I haven‚Äôt fully understood yet, in particular, it‚Äôs not clear what kind of hash it requires to verify the request.  If someone understands - tell :). <br><br>  It is worth noting that you can place a link with a picture in the tooltip not only through al_wall.php as I described above, but also through share.php, for this you need to send the request to share.php again with a lot of parameters.  I will put comments where difficulties may arise: <br><pre> <code class="php hljs">act: <span class="hljs-string"><span class="hljs-string">'a_submit'</span></span> <span class="hljs-comment"><span class="hljs-comment">//  hash: shareHash //   onDomReady,      share.php  ,   window.shareHash title: //   url: //  share_title: //   share_text: //   share_comment: //   image_url: //   ,     onUploadFail photo_owner_id: // id   photo_id: // id,    privacy_</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">note:</span></span></span><span class="hljs-comment"> 0 //    0 privacy_notecomm: 0 //    0 to_status: 1 // 1,    status_export: //     to_</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">note:</span></span></span><span class="hljs-comment"> // ,      1,   </span></span></code> </pre><br>  In general, through share.php, you can publish video and audio, upload them to the server through the extra and extra_data parameters, but I don‚Äôt see any urgent need for this. <br><br>  I think that while this is more than enough, when I find a way to combine links and photos in one message, I will write how this can be done.  Or I will hope that they will open such functionality for Groups and Official Pages.  I note only that if you upload a photo via the VKontakte interface on the Official page, then photo_id will be assigned as '[-id page] _ [number_photo]', and when viewing the photo, the author will be your page or group. <br><br>  This effect can also be achieved through the script, if the parameters are not transferred to share.php, but directly to upload.php, but in this case we need to know a lot more parameters, including two different hash parameters, so I don‚Äôt consider this way has become. <br><br>  Separate request to ask questions on the topic in the comments, and not through personal mail, because most of the questions are the same and you have to explain the same thing every time :). <br><img src="https://habrastorage.org/getpro/geektimes/post_images/18f/b29/e91/18fb29e91d6ef2364aeb53ee69f7822d.png"><br><br>  <b>UPD</b> : At the request of the comments sketched out a simple class and an example of use. <br>  Take here: <a href="https://github.com/xbreaker/vk.wallpost">github.com/xbreaker/vk.wallpost</a> </div><p>Source: <a href="https://habr.com/ru/post/115658/">https://habr.com/ru/post/115658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115650/index.html">New commenting system in Google Docs</a></li>
<li><a href="../115653/index.html">Notification of JavaScript errors in the address bar</a></li>
<li><a href="../115654/index.html">Opera 11.10 beta 1 - the first fish</a></li>
<li><a href="../115655/index.html">Two more ways to make stereo photos. Fast and free</a></li>
<li><a href="../115657/index.html">Website creation by means of maven</a></li>
<li><a href="../115661/index.html">Measuring the distance to the object and its speed</a></li>
<li><a href="../115663/index.html">Google fights AdWords' replica ads</a></li>
<li><a href="../115665/index.html">PHP 5.3.6 release</a></li>
<li><a href="../115666/index.html">Firefox 4 may be released next week.</a></li>
<li><a href="../115668/index.html">Cheers, Blackberry Playbook in Russia !!! Have questions?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>