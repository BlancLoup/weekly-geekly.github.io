<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Redmine. How to write plugins</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my previous post, I tried to describe in detail all the details of installing Redmine on Linux Ubuntu. In this, I want to talk about the subtleties...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Redmine. How to write plugins</h1><div class="post__text post__text-html js-mediator-article">  In <a href="http://habrahabr.ru/company/monandco/blog/198496/">my previous post,</a> I tried to describe in detail all the details of installing Redmine on Linux Ubuntu.  In this, I want to talk about the subtleties of writing plug-ins under Redmine, about the main possibilities of changing the functionality of the standard Redmine, about the pitfalls that met my team along the way. <br><br>  I think this article will be useful to those who are already familiar with the basics of the Ruby on Rails framework and want to start developing plugins for Redmine. <br><br>  First of all, it is necessary to divide all Redmine plug-ins into two categories: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first one includes those plug-ins that do not actually affect the functionality of the standard Redmine.  In fact, these are ordinary Rails applications inside Redmine, there are few difficulties with them, so they are of little interest.  There is a <a href="http://www.redmine.org/projects/redmine/wiki/Plugin_Tutorial">good tutorial</a> on the official Redmine website <a href="http://www.redmine.org/projects/redmine/wiki/Plugin_Tutorial">that describes in detail how to create a plugin for voting</a> . <br><br>  Everything is a little more complicated when the plugin has to change the built-in functionality! <br><a name="habracut"></a><br>  Let's start with the team that creates the folder structure for the Redmine plugin.  Let our plugin be called Luxury Buttons.  Go to the root folder of Redmine, run the command that creates the folder structure: <br><br><pre><code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$cd</span></span> /usr/share/srv-redmine/redmine-2.3 <span class="hljs-variable"><span class="hljs-variable">$rails</span></span> generate redmine_plugin LuxuryButtons</code> </pre> <br>  After executing the command, the luxury_buttons folder should appear in the plugins folder with the following structure: <br><img src="https://habrastorage.org/getpro/habr/post_images/250/cd7/b3e/250cd7b3e2b22003ade98d6bb61fed4c.png" align="left"><br>  In the lib folder, you should immediately add a folder that matches the name of the plugin, i.e.  folder luxury_buttons (hereinafter the patch <i>folder</i> ).  In this folder, further on, there will be patch files of various Redmine methods. <br><br>  Why did we call this folder as the plugin was called?  This is just a recommendation, the folder can be called differently, but here comes the first pitfall: if in another plugin the name of this folder matches, and the name of the patch file matches, then one of the patch files simply does not apply!  Therefore, I recommend calling the <i>patch folder</i> with the same name as the plug-in.  This method minimizes the occurrence of errors! <br><br><br><br><br><br><br><br><br><br><h4>  When a plugin should add something to the view. </h4><br>  Suppose we need to add something to the standard Redmine view.  The easiest and most inappropriate way to do this is to rewrite the view inside the plugin.  This is usually done by copying a view file from the Redmine core to the corresponding plugin directory and further editing this file.  For example, in one of our plugins, we rewrite the view with the form for saving the request. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a4e/fc5/f04/a4efc5f040e5f965b1a3761ccfa4964b.png"><br><br>  Why do so badly: <br><br><ul><li>  You doom yourself to constant monitoring of the relevance of your view.  If something changes in the new version of Redmine in this view, you will lose this functionality.  Monitoring the relevance of a view is quite difficult. </li><li>  If another plugin appears that rewrites the same view, either your view or another viewport will be applied.  Which view is used depends on the order of the plugins. </li></ul><br>  Therefore, it is better to use alternative methods. <br><br><h5>  Hooks </h5><br>  A hook in a view is such a line of code that allows you to embed your content into the view.  To find a hook, you just need to search for the substring "hook" in all Redmine files, or you can use <a href="http://www.redmine.org/projects/redmine/wiki/Hooks_List">this table</a> . <br><br><h6>  Hook connection </h6><br>  We try to keep all hook connections in a single file.  This file needs to be included in init.rb like this: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'luxury_buttons/view_hooks'</span></span></code> </pre><br>  The contents of the file itself may be: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LuxuryButtons</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LuxuryButtons</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hooks</span></span></span><span class="hljs-class"> &lt; Redmine::Hook::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewListener</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render_on</span></span></span><span class="hljs-class">( :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view_issues_form_details_top</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lu_buttons</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view_issues_form_details_top</span></span></span><span class="hljs-class">') </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render_on</span></span></span><span class="hljs-class">( :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view_layouts_base_html_head</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lu_buttons</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">page_header</span></span></span><span class="hljs-class">') </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render_on</span></span></span><span class="hljs-class">( :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view_issues_show_description_bottom</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial</span></span></span><span class="hljs-class"> =&gt; "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lu_buttons</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button_bar</span></span></span><span class="hljs-class">" ) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render_on</span></span></span><span class="hljs-class">( :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view_issues_history_journal_bottom</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial</span></span></span><span class="hljs-class"> =&gt; "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lu_buttons</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">journal_detail</span></span></span><span class="hljs-class">") </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  The name of the first module should coincide with the name of the plug-in, the second with the name of the <i>patch folder</i> . <br><br>  Inside the class, there are functions that show which hook should be rendered to which template. <br><br>  If two plugins use the same hook, then the contents from both the first and second plugins will appear in the views.  Those.  hooks do not rewrite each other. <br><br>  There are two problems with hooks: <br><ul><li>  Hook may not be. </li><li>  Sometimes you need to remove something from the view, and the hook allows you to only add. </li></ul><br>  The only way we found to solve these problems is to use jQuery to modify the content on the page when the view has already been rendered. <br><br>  The easiest way to do this is to use the view_layouts_base_html_head hook; it allows you to insert content into the page header.  We need to insert a link to connect the js-file with the logic of cutting or adding certain DOM elements.  In order for this js file not to be loaded on pages where it is not needed, it is better to load its loading into a conditional expression.  Those.  to cut the file loading by the action and the controller.  For example: <br><br><pre> <code class="ruby hljs"> &lt;% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> controller_name == <span class="hljs-string"><span class="hljs-string">'issues'</span></span> &amp;&amp; action_name == <span class="hljs-string"><span class="hljs-string">'update'</span></span> %&gt; &lt;%= javascript_include_tag <span class="hljs-symbol"><span class="hljs-symbol">:luxury_buttons_common</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:plugin</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:luxury_buttons</span></span> %&gt; &lt;% <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> %&gt;</code> </pre><br>  The folder ‚Äúluxury_buttons_common.js‚Äù must be in the folder's assets / javascript folder: <br><br><pre> <code class="javascript hljs">jQuery(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       });</span></span></code> </pre><br>  Sometimes, more competently, embed the js-file connection string not through the hook ‚Äúview_layouts_base_html_head‚Äù, but through a certain hook that embeds the content on a limited number of pages that we need.  For example, if we need to add or cut something on the task page, then you can use the "view_issues_form_details_bottom" hook. <br><br>  In this case, in order for the file to be connected not into the body of the document, but into the header, you need to use the construct: <br><br><pre> <code class="ruby hljs">&lt;% content_for <span class="hljs-symbol"><span class="hljs-symbol">:header_tags</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> %&gt; &lt;%= javascript_include_tag <span class="hljs-symbol"><span class="hljs-symbol">:luxury_buttons_common</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:plugin</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:luxury_buttons</span></span> %&gt; &lt;% <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> %&gt;</code> </pre><br>  True, with the method of "content_for" in plug-ins, from version to version <a href="http://www.redmine.org/issues/11105">there are difficulties</a> . <br><br><h4>  How to change the methods of models, controllers and helpers. </h4><br>  Changing (patching) methods is in many ways similar to changing views and has similar problems. <br><br><h5>  Hooks in controllers and models </h5><br>  In controllers and models there are also hooks.  They are connected differently.  In init.rb there should be a line that connects a specific hook.  For example, a hook that is called before saving a new task: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'luxury_buttons/controller_issues_new_before_save_hook'</span></span></code> </pre><br>  In the patching directory there should be a file ‚Äúcontroller_issues_new_before_save_hook.rb‚Äù, for example, with the following contents: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LuxuryButtons</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerIssuesNewBeforeSaveHook</span></span></span><span class="hljs-class"> &lt; Redmine::Hook::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewListener</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">controller_issues_new_before_save</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">={}) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">] &amp;&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">issue</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">not</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">issue</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">assigned_to_id</span></span></span><span class="hljs-class">].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil?</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">and</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">issue</span></span></span><span class="hljs-class">][:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">assigned_to_id</span></span></span><span class="hljs-class">].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to_s</span></span></span><span class="hljs-class">=='' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">issue</span></span></span><span class="hljs-class">].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">assigned_to_id</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">issue</span></span></span><span class="hljs-class">].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">issue</span></span></span><span class="hljs-class">].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new_record?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">and</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Setting</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plugin_luxury_buttons</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">assign_to_author</span></span></span><span class="hljs-class">'] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> '' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  The name of the module must match the name of the plug-in, the name of the class with the name of the file. <br><br>  In this case, we will implement the ability to automatically assign a new task to the author. <br><br><h5>  Method patching </h5><br>  As in views, the necessary hooks in Redmine are by no means always.  And then you need to patch the methods of the model, helper or controller. <br><br>  First, you need to connect the patch file in init.rb.  For example, we need to patch the ‚Äúread_only_attribute_names‚Äù method of the ‚ÄúIssue‚Äù model. <br><br><pre> <code class="ruby hljs">Rails.application.config.to_prepare <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Issue.send(<span class="hljs-symbol"><span class="hljs-symbol">:include</span></span>, LuxuryButtons::IssuePatch) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  The <i>patching folder</i> should contain the file ‚Äúissue_patch.rb‚Äù, of the following content: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LuxuryButtons</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IssuePatch</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">included</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extend</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassMethods</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">send</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InstanceMethods</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class_eval</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alias_method_chain</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read_only_attribute_names</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">luxury_buttons</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassMethods</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InstanceMethods</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read_only_attribute_names_with_luxury_buttons</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read_only_attribute_names_without_luxury_buttons</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Setting</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plugin_luxury_buttons</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hidden_fields_into_new_issue_form</span></span></span><span class="hljs-class">'] &amp;&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new_record?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hidden_fields</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Setting</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plugin_luxury_buttons</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hidden_fields_into_new_issue_form</span></span></span><span class="hljs-class">'] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> += </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hidden_fields</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  By construction <br><br><pre> <code class="ruby hljs">alias_method_chain <span class="hljs-symbol"><span class="hljs-symbol">:read_only_attribute_names</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:luxury_buttons</span></span></code> </pre><br>  we generate two methods, "read_only_attribute_names_with_luxury_buttons" and "read_only_attribute_names_without_luxury_buttons". <br><br>  The first method will now be called instead of the standard method of the read_only_attribute_names model, the second method is an alias for the standard read_only_attribute_names method. <br><br>  The combination of the two methods can patch the standard Redmine method.  In our example, we first call the standard Redmine method, which returns an array of values, and then add values ‚Äã‚Äãto this array. <br><br>  If something changes in the standard Redmine method in the new version, then the chances that our patching will work correctly are much more than if we simply rewrote the standard Redmine method by adding our own logic to it. <br><br>  Important!  There are <a href="http://www.redmine.org/issues/11035">some problems with patching User model</a> in Redmine.  For correct patching, you need to explicitly include the following files: <br><br><pre> <code class="ruby hljs">require_dependency <span class="hljs-string"><span class="hljs-string">'project'</span></span> require_dependency <span class="hljs-string"><span class="hljs-string">'principal'</span></span> require_dependency <span class="hljs-string"><span class="hljs-string">'user'</span></span></code> </pre><br>  The article does not contain everything that I would like to say about writing plugins under Redmine.  I tried to collect basic methodologies and pitfalls.  I hope the article will be useful. </div><p>Source: <a href="https://habr.com/ru/post/201064/">https://habr.com/ru/post/201064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201046/index.html">New version of Intel SDK for OpenCL applications</a></li>
<li><a href="../201048/index.html">Filtering by the registry of prohibited sites for Internet providers</a></li>
<li><a href="../201054/index.html">Attempt to transition from Entity Framework 5 to 6 or DataBase-First = Code-First + chart browser</a></li>
<li><a href="../201058/index.html">Security certification and personal data</a></li>
<li><a href="../201062/index.html">Furious bulls: how Wall Street became dependent on "high-speed" trades. Part 1</a></li>
<li><a href="../201066/index.html">Loss of accuracy from Double to Float or "Where are the pennies missing?"</a></li>
<li><a href="../201068/index.html">Nokia Lumia 525 & Lumia 720 Dual Sim. We wait?</a></li>
<li><a href="../201070/index.html">Neurocam: iPhone as an analog of Google Glass?</a></li>
<li><a href="../201072/index.html">BitTorrent Sync: speed up to 90 megabytes / s and open API</a></li>
<li><a href="../201074/index.html">Log in to VK with OAuth 2.0 under Windows 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>