<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we squeezed the balls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yesterday night we laid out a decision-making ball to participate in 10K Apart , a competition for the best web application up to 10KB using only clie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we squeezed the balls</h1><div class="post__text post__text-html js-mediator-article">  Yesterday night we <a href="http://10k.aneventapart.com/Entry/298">laid out a</a> decision-making ball to participate in <a href="http://10k.aneventapart.com/">10K Apart</a> , a competition for the best web application up to 10KB using only client technologies. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/d9/af/d9af6a3e7c73bf288e46eea46aeede82.png" alt="Decision-making ball"></div><br>  And if some of them were engaged in the <a href="http://habrahabr.ru/blogs/webdev/102153/">compression of the code with the help of PNG</a> , then we solved the inverse problem - we compressed PNG with the help of js code. <br><br><a name="habracut"></a><br><h4>  1. The story with the ball and the result </h4><br>  On Sunday evening, I needed an online ball from the movie ‚ÄúRoute 60‚Äù.  Not finding the right option, wrote my primitive ball.  After thinking about whether to post it on the Internet, I slightly finished the look and laid it out.  I wrote a small post on Habr and <i>suddenly I</i> liked the ball a lot. <br>  The next day, I moved the balloon to another hosting and registered a separate domain for it. <br>  It would seem that this is all over, but ... <br><br><h4>  2. Offer to participate in the competition </h4><br>  On Monday morning, we talked to <a href="http://habrahabr.ru/users/bazilxp/" class="user_link">bazilxp</a> and he offered to participate in the <a href="http://10k.aneventapart.com/">10K Apart</a> contest.  Naturally, I knew about this competition, but I did not have the desire to participate, nor the time for this.  I replied that he could take the ball and take part himself.  <a href="http://habrahabr.ru/users/bazilxp/" class="user_link">bazilxp</a> promised to spend the evening squeezing the ball. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  3. Task </h4><br>  The next day it turned out that everything is not as simple as we had supposed.  The original version of the ball occupied 45 Kb, of which the main part (38 Kb) is a picture with a ball, 5 Kb is a picture with a translucent blue triangle (which is in the center) and the rest is html, js css.  How can I reduce the size of all this? <br><br><img src="https://habrastorage.org/storage/habraeffect/ca/b1/cab1f44dd7fbcace34bb223b0133bdf5.gif" alt="Half ball" align="right"><br><h4>  4. Picture with a ball - 38 Kb, PNG </h4><br>  The picture everywhere used gradient fill and, of course, I would like to reduce its size <i>without loss of quality</i> . <br><ul><li>  The first thing we did was reduce the number of colors (up to 8 bits per color), leaving the PNG format: the size of the image was reduced to 31 Kb; </li><li>  Then <a href="http://habrahabr.ru/users/bazilxp/" class="user_link">bazilxp</a> got the idea to make the picture symmetrical and cut off half of it.  The full ball was supposed to be drawn on canvas using the reflection of the original image (which <a href="http://habrahabr.ru/users/bazilxp/" class="user_link">bazilxp</a> implemented).  As a result, the size of the page was reduced to 16 kb and a small crutch appeared on js, resolving the situation when the picture was not loaded into the browser by the time the ball began to be drawn. </li><li>  After that we tried to save our half ball in the GIF.  The result occupied 8 Kb + a slight loss of quality became noticeable, but overall it looked tolerable. </li></ul>  At this time, they stopped tormenting the ball. <br><br><h4>  5. The problem with the blue triangle - 5.5 Kb, PNG </h4><br>  In our opinion, when viewing, the illusion should have been created that the text was written on a blue triangle inside the ball.  Accordingly, when changing the text, the blue triangle with letters should disappear smoothly, and then smoothly appear with new text. <br>  Perhaps the easiest solution was to remove the blue triangle altogether, but after thinking about it, we discarded this option. <br>  So: <ul><li>  First of all, as in the case of the ball, we reduced the number of colors, but the file size has practically not decreased. </li><li>  Further, it should be said that the triangle has borders in which transparency gradually flows from 1 to 0. When the triangle is superimposed on the black background of the ball image, it seems that the borders are slightly blurred, thereby greatly improving the overall appearance of the page.  It was decided to get rid of transparency, replacing it with a smooth flow to black color and put everything in the GIF.  Due to this, the size of the picture with a triangle has decreased to 3.5 Kb. </li><li>  Unexpectedly, the idea came to draw a half of a blue triangle on a half ball.  Then the animation of the disappearance and appearance of the triangle could be organized by drawing a triangle in black with varying levels of transparency.  As a result, we got rid of the picture with a triangle, but the size of the picture with the ball grew by 1.7 kb </li></ul><br><br>  At this point we had: <ol><li>  picture with a half of a ball and a half of a blue triangle, 9.7 Kb </li><li>  html + js + css, 4.5 Kb (the code on js has grown greatly due to drawing on the canvas element) </li></ol><br><br>  I will not describe how we compressed html / js / css - these methods are known to all.  Unfortunately, they did not help us: after all that occurred to us, the total file size was 11,300 bytes. <br><br>  It was decided to draw the ball completely with JavaScript hands on the canvas element. <br><br><h4>  6. Drawing </h4><br>  After the end of the working day, I sat in a coffee house, opened the <a href="https://developer.mozilla.org/en/canvas_tutorial">tutorial</a> and began to draw.  <a href="http://habrahabr.ru/users/bazilxp/" class="user_link">bazilxp</a> did the same at home (by the way, he sits in China and his time zone is different by +6 hours). <br>  Drawing the ‚Äúeight‚Äù at the top of the ball and calculating the JavaScript coordinates for the gradient that blurs the edges of the blue triangle turned out to be the most difficult for us (I had to remember trigonometry, which I haven‚Äôt done for 5 years). <br>  As a result, after about 5 hours (by 23 hours in Moscow) we had a ready-made, wherever possible, tested page, which almost completely repeated the original page with the ball.  At the same time, the size of all files, including css and favicon.ico, even without code compression, was 7.65 KB.  I went home, and <a href="http://habrahabr.ru/users/bazilxp/" class="user_link">bazilxp</a> - to register our ball for participation in the competition. <br><br>  You can observe the result (as well as support our ball by voting) on <a href="http://10k.aneventapart.com/Entry/298">the ball page</a> on the contest website. <br><br>  - <br>  That's how it was.  I still do not know what will come of it.  Many great applications participate in the contest and I don‚Äôt count on the victory.  But this is not very important.  Regardless of the results of the competition, there was a feeling that we did a big, complex and beautiful thing.  And the main thing - we both got great pleasure from the process. <br><br>  Thanks for attention. <br><br>  Shl.  Finally, screenshots of the drawing steps with the ball: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/96/8c/968c1d1a4689ae9fa6f690a98a22fe2a.png" alt="Ball drawing steps"></div><br><br>  UPD: <i>I will write immediately about SVG, because</i>  <i>Questions about this have already started</i> <br><br>  Now I also think that SVG is less laborious, but the morning before yesterday, unfortunately, I did not know anything at all about the canvas or SVG. <br><br>  We grabbed the first thing that came to hand. <br><br>  In any case, I do not think that we have wasted time, because  Got experience.  It is very important for me. <br><br>  UPD2: <i>About gray background</i> <br>  Such a picture is observed on Mac and Safari under Windows. <br><img src="http://grab.by/65lT" alt="image" align="left"><br><br>  Themselves to blame: forgot to fill the canvas background by default. <br><br>  Unfortunately, now it's too late to change something. </div><p>Source: <a href="https://habr.com/ru/post/102583/">https://habr.com/ru/post/102583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../102573/index.html">Fedora 14 (Laughlin) Alpha released</a></li>
<li><a href="../102576/index.html">Our HTML5 Player</a></li>
<li><a href="../102578/index.html">Emotions in neural networks</a></li>
<li><a href="../102580/index.html">Broken links - were, are and ... so be it !!!</a></li>
<li><a href="../102582/index.html">Google Translator and the Magic Point</a></li>
<li><a href="../102585/index.html">Logitech Anywhere Mouse MX - Darkfield Notebook Mouse</a></li>
<li><a href="../102588/index.html">Inkscape 0.48 released</a></li>
<li><a href="../102593/index.html">Beta Firefox 4: new update released - how will it affect web developers?</a></li>
<li><a href="../102594/index.html">Today is the release of Miranda IM 0.9</a></li>
<li><a href="../102595/index.html">Catch up</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>