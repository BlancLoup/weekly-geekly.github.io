<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Check Intel IPP Samples for Windows - continued</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Progress does not stand still. My favorite static code analyzer PVS-Studio is also developing. And recently I realized that those projects that we hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Check Intel IPP Samples for Windows - continued</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/aa2/2c0/21c/aa22c021c9014b14737fbd464504b5ef.gif" alt="PVS-Studio vs IPP Samples. Continue."><br>  Progress does not stand still.  My favorite static code analyzer PVS-Studio is also developing.  And recently I realized that those projects that we have already tested can be completely checked again.  Writing about this new article is somehow strange and is unlikely to be interesting.  However, I still need to do one such article.  It will be another argument in favor of the assertion that the real benefits of static analysis can be obtained only with its regular use, and not in case-by-case checks.  So, let's see what we managed to find the new interesting in the Intel IPP Samples project. <br><a name="habracut"></a><br>  The previous post ‚ÄúIntel IPP Samples for Windows - work on the bugs‚Äù [ <a href="http://www.viva64.com/go.php%3Furl%3D741">1</a> ] was published on January 27, 2011.  It took about 9 months.  During this time, many of the errors described in the article were corrected in IPP Samples.  There were several library updates.  However, since the developers from Intel were not interested in PVS-Studio, the test turned out to be a one-time.  And now you can see well what new interesting errors the analyzer will find after 9 months of its development. <br><br>  We will not indulge in idle talk, because we are programmers, and we will quickly move on to code examples.  The analysis was performed by <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> 4.37 (the previous note relates to version 4.10).  Of course, not all defects will be given, but only interesting and not very repetitive.  Anyone who wants to see all the pitfalls can <a href="http://www.viva64.com/ru/b/0092/">use</a> PVS-Studio and study the report.  But we are not here for this. <br><br><h2>  Classic indefinite behavior </h2><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, Ipp32s size&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HadamardFwdFast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(..., Ipp16s* pDst)</span></span></span><span class="hljs-function"> </span></span>{ Ipp32s *pTemp; ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>;j++) { a[<span class="hljs-number"><span class="hljs-number">0</span></span>] = pTemp[<span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] + pTemp[<span class="hljs-number"><span class="hljs-number">1</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>]; a[<span class="hljs-number"><span class="hljs-number">1</span></span>] = pTemp[<span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] - pTemp[<span class="hljs-number"><span class="hljs-number">1</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>]; a[<span class="hljs-number"><span class="hljs-number">2</span></span>] = pTemp[<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] + pTemp[<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>]; a[<span class="hljs-number"><span class="hljs-number">3</span></span>] = pTemp[<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] - pTemp[<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>]; pTemp = pTemp++; pDst[<span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] = (Ipp16s)(a[<span class="hljs-number"><span class="hljs-number">0</span></span>] + a[<span class="hljs-number"><span class="hljs-number">2</span></span>]); pDst[<span class="hljs-number"><span class="hljs-number">1</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] = (Ipp16s)(a[<span class="hljs-number"><span class="hljs-number">1</span></span>] + a[<span class="hljs-number"><span class="hljs-number">3</span></span>]); pDst[<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] = (Ipp16s)(a[<span class="hljs-number"><span class="hljs-number">0</span></span>] - a[<span class="hljs-number"><span class="hljs-number">2</span></span>]); pDst[<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>] = (Ipp16s)(a[<span class="hljs-number"><span class="hljs-number">1</span></span>] - a[<span class="hljs-number"><span class="hljs-number">3</span></span>]); pDst = pDst++; } ... }</code> </pre> <br>  PVS-Studio diagnostic messages: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      V567 Undefined behavior.  The 'pTemp' variable  me umc_me_cost_func.h 168 <br><br>  V567 Undefined behavior.  The variable is variable.  me umc_me_cost_func.h 174 <br><br>  Just a canonical example, which is given in articles to demonstrate undefined behavior [ <a href="http://www.viva64.com/go.php%3Furl%3D665">2</a> ].  It is impossible to say whether the variables pTemp and pDst will increase or not, as they change twice within the same sequence point.  The result depends on the compiler and optimization settings. <br><br>  There is also an arc of similar code snippet: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> VC1BRC_I::CompleteFrame(ePType picType) { ... m_Quant.LimIQuant = m_Quant.LimIQuant--; ... m_Quant.IQuant = m_Quant.IQuant--; ... }</code> </pre> <br><br><h2>  Undefined behavior and prefix increment </h2><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveOnNextFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_nFrames&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { m_pFrame[m_curIndex] = <span class="hljs-number"><span class="hljs-number">0</span></span>; m_curIndex = (++m_curIndex)%m_maxN; m_nFrames--; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V567 Undefined behavior.  The 'm_curIndex' variable being modified while being used between sequence points.  vc1_enc umc_vc1_enc_planes.h 630 <br><br>  And here is another example of undefined behavior.  Although the prefix increment is used here, in fact, it changes nothing.  All the same here is one point of the sequence, and the variable m_curIndex changes 2 times.  Theoretically, the compiler can create the following pseudocode: <br><br>  A = m_curIndex + 1; <br><br>  B = A% m_maxN; <br><br>  m_curIndex = B; <br><br>  m_curIndex = A; <br><br>  In practice, this is unlikely to happen, and the variable will be immediately increased, but you can‚Äôt rely on it at all. <br><br><h2>  Typo in object name </h2><br><pre> <code class="cpp hljs">IPLFUN(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>, iplMpyRCPack2D, (IplImage* srcA, IplImage* srcB, IplImage* dst)) { ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (srcA-&gt;depth == IPL_DEPTH_8U ) || (srcB-&gt;depth == IPL_DEPTH_8U ) || (srcB-&gt;depth == IPL_DEPTH_16U) || (srcB-&gt;depth == IPL_DEPTH_16U) || (srcA-&gt;depth == IPL_DEPTH_1U ) || (srcB-&gt;depth == IPL_DEPTH_1U ) ) ... }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V501 There are identical sub-expressions' (srcB-&gt; depth == 16)  operator.  ipl iplmpy2d.c 457 <br><br>  If you look at the code, you can see crept typo.  Lost verification: "(srcA-&gt; depth == IPL_DEPTH_16U)". <br><br><h2>  Partial buffer flush </h2><br><pre> <code class="cpp hljs">UMC::Status VC1EncoderADV::SetMEParams_I_Field(UMC::MeParams* MEParams) { UMC::Status umcSts UMC::UMC_OK; <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(MEParams,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(MEParams)); ... }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V512 A call of the memset function will lead to underflow of the buffer MEParams.  vc1_enc umc_vc1_enc_adv.cpp 1767 <br><br>  Only part of the buffer is cleared, since sizeof (MEParams) returns the size of the pointer, not the structure.  To calculate the correct size, the pointer must be dereferenced: ‚Äúsizeof (* MEParams)‚Äù. <br><br><h2>  Copy-Paste Error </h2><br><pre> <code class="cpp hljs">Status VC1VideoDecoder::ResizeBuffer() { ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(m_pContext &amp;&amp; m_pContext-&gt;m_seqLayerHeader &amp;&amp; m_pContext-&gt;m_seqLayerHeader-&gt;heightMB &amp;&amp; m_pContext-&gt;m_seqLayerHeader-&gt;heightMB) ... }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V501 There are identical sub-expressions 'm_pContext-&gt; m_seqLayerHeader-&gt; heightMB' the operator.  vc1_dec umc_vc1_video_decoder.cpp 1351 <br><br>  Most likely, to simplify the line copied, but forgot to fix it.  It seems to me that it should have been like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(m_pContext &amp;&amp; m_pContext-&gt;m_seqLayerHeader &amp;&amp; m_pContext-&gt;m_seqLayerHeader-&gt;heightMB &amp;&amp; m_pContext-&gt;m_seqLayerHeader-&gt;widthMB)</code> </pre> <br><br><h2>  Array bounds </h2><br><pre> <code class="cpp hljs">Ipp32f pa_nb_long[NUM_CHANNELS][<span class="hljs-number"><span class="hljs-number">2</span></span>][MAX_PPT_LONG]; <span class="hljs-function"><span class="hljs-function">MP3Status </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mp3enc_psychoacousticInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ch = <span class="hljs-number"><span class="hljs-number">0</span></span>; ch &lt; NUM_CHANNELS; ch++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; MAX_PPT_LONG; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; j++) state-&gt;pa_nb_long[ch][j][i] = (Ipp32f)<span class="hljs-number"><span class="hljs-number">1.0e30</span></span>; } ... }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V557 Array overrun is possible.  The value of 'j' index could reach 2. mp3_enc mp3enc_psychoacoustic_fp.c 361 <br><br>  This code causes a segmentation fault.  The variable 'j' can take the value 2. However, only the numbers 0 and 1 are valid. Most likely, the loop should look like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; j++)</code> </pre> <br>  Were found and other cycles that are likely to lead to going beyond the arrays. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> Ipp32f samplefbout[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">18</span></span>][<span class="hljs-number"><span class="hljs-number">32</span></span>]; samplefbout fbout_data[NUM_CHANNELS]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mp3enc_scale_factor_calc_l2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MP3Enc *state)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ch = <span class="hljs-number"><span class="hljs-number">0</span></span>; ch &lt; stereo + state-&gt;com.mc_channel; ch++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (t = <span class="hljs-number"><span class="hljs-number">0</span></span>; t &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; t++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (sb = <span class="hljs-number"><span class="hljs-number">0</span></span>; sb &lt; sblimit_real; sb++){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">12</span></span>; j++) fbout[j] = state-&gt;fbout_data[ch][<span class="hljs-number"><span class="hljs-number">0</span></span>][t * <span class="hljs-number"><span class="hljs-number">12</span></span> + j][sb]; ... }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V557 Array overrun is possible.  The value of 't * 12 + j' index could reach 35. mp3_enc mp3enc_quantization_12_fp.c 275 <br><br>  If the situation is possible, that t == 2, and j == 11, then the array will go beyond the bounds.  How this code should look like, I find it difficult to answer. <br><br>  Using the 'samplefbout' array doesn't do everything at all smoothly.  Another code snippet: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> Ipp32f samplefbout[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">18</span></span>][<span class="hljs-number"><span class="hljs-number">32</span></span>]; samplefbout fbout_data[NUM_CHANNELS]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mp3enc_join_LR_l2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MP3Enc *state)</span></span></span><span class="hljs-function"> </span></span>{ Ipp32s sb, j; Ipp32s sblimit_real = state-&gt;com.sblimit_real; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (sb = <span class="hljs-number"><span class="hljs-number">0</span></span>; sb &lt; sblimit_real; sb++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">36</span></span>; j++) state-&gt;fbout_data[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][j][sb] = <span class="hljs-number"><span class="hljs-number">0.5f</span></span> * (state-&gt;fbout_data[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][j][sb] + state-&gt;fbout_data[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][j][sb]); }</code> </pre> <br>  PVS-Studio diagnostic messages: <br><br>  V557 Array overrun is possible.  The value of 'j' index could reach 35. mp3_enc mp3enc_quantization_12_fp.c 639 <br><br>  V557 Array overrun is possible.  The value of 'j' index could reach 35. mp3_enc mp3enc_quantization_12_fp.c 640 <br><br><h2>  Using one variable for two cycles </h2><br><pre> <code class="cpp hljs">JERRCODE CJPEGDecoder::DecodeScanBaselineNI(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; m_scan_ncomps; c++) { block = m_block_buffer + (DCTSIZE2*m_nblock*(j+(i*m_numxMCU))); <span class="hljs-comment"><span class="hljs-comment">// skip any relevant components for(c = 0; c &lt; m_ccomp[m_curr_comp_no].m_comp_no; c++) { block += (DCTSIZE2*m_ccomp[c].m_nblocks); } ... } ... }</span></span></code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V535 The variable 'c' is being used for this loop.  jpegcodec jpegdec.cpp 4652 <br><br>  The problem with this code is that the 'c' variable is used in both the outer and nested loops.  Depending on the boundary values ‚Äã‚Äãof the cycles, this code may not process all the data or lead to an infinite loop. <br><br><h2>  Uncorrected errors </h2><br>  Many of the errors described in the first article were corrected.  But some IPP Samples developers either didn‚Äôt pay attention or thought that these were not errors.  For example, a similar situation with this fragment: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">vm_file* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm_file_fopen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vm_char* fname, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vm_char* mode)</span></span></span><span class="hljs-function"> </span></span>{ ... mds[<span class="hljs-number"><span class="hljs-number">3</span></span>] = FILE_ATTRIBUTE_NORMAL | (islog == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : FILE_FLAG_NO_BUFFERING; ... }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V502 Perhaps the '?:' Operator was different.  The '?:' Operator has a lower than the '|'  operator.  vm vm_file_win.c 393 <br><br><h2>  Strange code </h2><br>  There are quite a few sections of code that are hard to say, a real error or just a redundant code.  I will give a few examples. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ec_fb_GetSubbandNum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* stat)</span></span></span><span class="hljs-function"> </span></span>{ _fbECState* state = (_fbECState*)stat; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (state-&gt;freq - state-&gt;freq); }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V501 There are identical to the left and the right of the '-' operator: state-&gt; freq - state-&gt; freq speech ec_fb.c 253 <br><br>  Very strange feature.  Here, or strangely struggled with unused variables, or the operator 'return' should return the result of another expression. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">AACStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alsdecGetFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state-&gt;msbFirst == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; num; i++) { *tmpPtr = *srcPrt; tmpPtr += state-&gt;numChannels; srcPrt++; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; num; i++) { *tmpPtr = *srcPrt; tmpPtr += state-&gt;numChannels; srcPrt++; } } ... }</code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V523 The 'then' statement is equivalent to the 'else' statement.  aac_dec als_dec_api.c 923 <br><br>  Well what can I say?  Suspicious!  Why do we need two identical cycles under different conditions? <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rrGetNextBunch_Spiral</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x,y; ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> _begine; ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> _begine; ... }</code> </pre> <br>  PVS-Studio diagnostic messages: <br><br>  V571 Recurring check.  The 'if (x &lt;0)' condition was already verified in line 1025. 3d-viewer rrdemosupport.cpp 1026 <br><br>  V571 Recurring check.  The 'if (y &lt;0)' condition was already verified in line 1028. 3d-viewer rrdemosupport.cpp 1029 <br><br>  Strange duplicate checks. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Status </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">H264ENC_MAKE_NAME</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(H264CoreEncoder_UpdateRefPicMarking)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* state)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// set frame_num to zero for this picture, for correct // FrameNumWrap core_enc-&gt;m_pCurrentFrame-&gt;m_FrameNum = 0; core_enc-&gt;m_pCurrentFrame-&gt;m_FrameNum = 0; ... }</span></span></code> </pre> <br>  PVS-Studio diagnostic message: <br><br>  V519 The 'core_enc-&gt; m_pCurrentFrame-&gt; m_FrameNum' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1804, 1805. h264_enc umc_h264_video_encoder_tmpl.cpp.h 1805 <br><br>  Randomly copied the string?  Or would you like to reset another variable?  Unclear. <br><br><h2>  Conclusion </h2><br>  Try integrating static analysis into your project development process.  At first, this seems like a waste of effort.  But then you will feel how unusual and pleasant it is to receive an error message, even before you start testing a newly written code snippet.  You will also observe with interest whether something will be found or not after the release of the next version of the analyzer. <br><br><h2>  Bibliographic list </h2><br><ol><li>  Andrey Karpov.  Intel IPP Samples for Windows - work on the bugs.  <a href="http://www.viva64.com/go.php%3Furl%3D741">http://www.viva64.com/go.php?url=741</a> </li><li>  Elena Sagalaeva.  Sequence points.  <a href="http://www.viva64.com/go.php%3Furl%3D665">http://www.viva64.com/go.php?url=665</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/130070/">https://habr.com/ru/post/130070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130059/index.html">We start voting</a></li>
<li><a href="../130061/index.html">GPS creator against spying on a suspect‚Äôs location without a court order</a></li>
<li><a href="../130065/index.html">Official Google Dart Language Presentation</a></li>
<li><a href="../130067/index.html">Highlighting visited links in Google search results</a></li>
<li><a href="../130068/index.html">Are you afraid to upload your music collection to Google Music?</a></li>
<li><a href="../130072/index.html">Review Manager - saving time and nerves</a></li>
<li><a href="../130073/index.html">Remote access via Chrome Remote Desktop</a></li>
<li><a href="../130074/index.html">VHF echo repeaters</a></li>
<li><a href="../130075/index.html">‚ÄúCreating a National Software Platform is an important step towards building an information society‚Äù</a></li>
<li><a href="../130081/index.html">Japanese cloned teeth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>