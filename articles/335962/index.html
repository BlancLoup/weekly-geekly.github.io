<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parametric modeling in CAD SolveSpace: "The ways of the Solver are inscrutable" or "Newton's Wormholes"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At first glance, the task of applying dimensional constraints to a drawing seems no more difficult than an exercise from a school textbook. It was the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parametric modeling in CAD SolveSpace: "The ways of the Solver are inscrutable" or "Newton's Wormholes"</h1><div class="post__text post__text-html js-mediator-article"><p>  At first glance, the task of applying dimensional constraints to a drawing seems no more difficult than an exercise from a school textbook.  It was the same to me when I first learned about it.  At that time I worked in a company that was developing a <a href="http://www.simpleanswers.co.uk/case-study-3d-house-estimator.html">software system for designing individual houses</a> with the preparation of turnkey project documentation.  In this project, I was developing an algorithm for generating multi-sloped roofs, and later on the entire geometric core based on Boolean operations, so I followed the further history from afar.  At some certain point, the customer wanted the designers to simply specify the size of the rooms, the corners of the bay windows and the width of the doorways, and the program would automatically calculate all other parameters of the external and internal design of the house.  This idea arose at the customer spontaneously, and therefore urgently needed to be done ‚Äújust like in <a href="https://ru.wikipedia.org/wiki/CATIA">CATIA</a> ‚Äù.  Our team leader approached the solution of the problem with enthusiasm and began to develop a prototype.  He solved hundreds of equations in MathCAD, the whole office was littered with graphs of private solutions for two, three, four points ... His initial assumption that the problem could be solved analytically, failed: there was 2005 in the yard, and that meant that it was impossible was to find at least some information on this topic.  As a result, after two months of intense research, this functionality had to be <strong>excluded</strong> . <br>  <a href="https://habrahabr.ru/post/324160/">Part 1: Introduction</a> <br>  <a href="https://habrahabr.ru/post/324514/">Part 2: Sketch</a> <br>  <a href="https://habrahabr.ru/post/325770/">Part 3: Degrees of freedom and constraint equations</a> <br>  <a href="https://habrahabr.ru/post/335962/">Part 4: "The ways of the Solver are inscrutable" or "Newton's Wormholes"</a> <br><img src="https://habrastorage.org/web/17f/c80/f96/17fc80f960a5436084f68d191a3d9c27.png"></p><a name="habracut"></a><br><h1 id="metod-nyutona">  Newton's method </h1><br><p>  This story ended sadly, since the problem of solving geometric constraints in the general case comes down to solving a <strong>system of nonlinear equations</strong> that modern mathematicians <strong>do not know how</strong> to solve in analytical form.  Therefore, all that remains in the conditions of modern realities is to use a method named after the great genius of apple insights: <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%259D%25D1%258C%25D1%258E%25D1%2582%25D0%25BE%25D0%25BD%25D0%25B0">the Newton method</a> .  This method allows you to find the zero (root) of any non-linear function (equation) by an iterative method with quadratic convergence.  This means that the number of exact significant digits <strong>doubles</strong> with each iteration of the method.  In simple words, calculating the zero function with a high degree of accuracy is achieved in a relatively small number of iterations.  In most practical cases, 5‚Äì12 iterations are sufficient. </p><br><p>  With the forced necessity of applying the Newton method, the situation becomes more dramatic: after all, this method does not guarantee us convergence even with solutions, and the success of finding a solution mainly depends on the initial value of the parameters at the start of the method.  In addition, this method does not allow us to find all the zeros of the function or the roots of the equation, since the result converges to the first root.  Therefore, the design engineer still has to draw a drawing that is closest to the final result.  If the initial approximation of the parameters is too far from the solution, Newton's method may not converge, or converge to an unexpected solution. </p><br><p><img src="https://habrastorage.org/web/233/e95/e36/233e95e364ba41fb9ec5a0cec03f672a.png"></p><br><p>  <strong>Illustration of the discrepancy of Newton's method</strong> applied to the function f (x) = x ^ {3} -2x + 2.  Take zero as the initial approximation.  The first iteration gives the unit as an approximation.  In turn, the second again gives zero.  The method will loop and no solution will be found.  In general, building a sequence of approximations can be <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2581%25D0%25BA%25D0%25B0%25D0%25B4_%25D0%25B1%25D0%25B8%25D1%2584%25D1%2583%25D1%2580%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B9">very confusing</a> . </p><br><p>  In view of the foregoing, Newton's method can be treated as a magic black box that can give us an answer if he found it, but cannot tell if there is a solution if the method does not converge.  <strong>The ways of making decisions are inscrutable</strong> , as can be seen on the following images of the way of reaching a solution (the trace of each point of the drawing is visualized, the coordinates of the points are recorded at each of the steps of the Newton method): </p><br><p><img src="https://habrastorage.org/web/067/7e6/d7b/0677e6d7bd4549b3b8975a0d30a44565.png"><br><img src="https://habrastorage.org/web/fd1/8b1/69f/fd18b169f15d4c29901b3597d90bab7c.png"></p><br><p>  Newton's Wormholes </p><br><h1 id="kak-zhe-pobedit-chervey-somneniy">  How to win the "Worms of Doubt"? </h1><br><h2 id="uluchshaem-shodimost-dekompoziciya-zadachi">  We improve the convergence (decomposition of the problem) </h2><br><p>  In order to improve the convergence of the method and the speed of its work, usually used clever <a href="http://www.iis.nsk.su/files/abstracts/ershov.pdf">methods of decomposition of the</a> original problem.  Analyzing the degrees of freedom and equations, one can split the drawing into various independent groups so that these parts can be solved separately, and then, fixing the values ‚Äã‚Äãof the parameters already obtained, solve the system of equations finally.  The decomposition methods make it possible to greatly improve both the convergence and the speed of the algorithm due to the fact that we do not solve the entire system of equations, but several small systems of equations.  The algorithmic complexity of Newton's method has a <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581_P">polynomial</a> character, which means we can get significant benefits if we solve the system ‚Äúpiece by piece‚Äù.  But the implementation of such a decomposition requires the development of an algorithm that will be tied to the geometric interpretation of the original equations, that is, it will operate with terms of the subject domain, and this limits the scope of the solver to only geometric problems.  For example, decomposition for a two-dimensional case will not work very effectively for a three-dimensional one, and most likely, such a problem should be solved separately. </p><br><h2 id="uvelichivaem-tochnost-obuslovlennost-sistemy-uravneniy">  Increase accuracy (conditionality of the system of equations) </h2><br><p>  The basis of the implementation of Newton's method for solving systems of nonlinear equations is <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25B0%25D1%2580%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">the linearization method</a> .  The equation is solved in steps, and at each step the nonlinear functions are represented as linear, which allows instead of a system of nonlinear equations to solve a system of linear equations.  As a result, the convergence of Newton's method depends on the accuracy of solving this system of linear equations.  The more accurate the solution at each step, the faster and more stable Newton's method converges, and the less other problems, leading to the fact that the solution is not found. </p><br><p>  In mathematics, there is the concept of <a href="http://orloff.am.tpu.ru/chisl_metod/Lab3/cond.htm">conditionality of a system of equations</a> .  In simple words, it is a certain value that can tell us how accurate (reliable) the solution of this system of equations will be.  As an example, the solution of the simplest equation can be given, which in the abstract world of mathematics can be considered as a special case of the system of equations </p><br><p>  <strong>ax + b = 0.</strong> </p><br><p>  His decision: </p><br><p>  <strong>x = -b / a</strong> </p><br><p>  If we use a geometric interpretation, then <strong>ax + b</strong> is the equation of a line, and its intersection with the x-axis is the solution of the equation.  Now imagine that the source data ( <strong>a</strong> , <strong>b</strong> ) for this equation is given with some degree of accuracy.  In this case, the smaller the value of <strong>a</strong> , and the straight line is closer to the parallelism of the x-axis, the greater the ambiguity of the solution.  For small relative changes of <strong>a</strong> , the <strong>x</strong> values ‚Äã‚Äãwill change significantly.  If we consider a system of many equations, then in the course of solving the error can accumulate, and the result of the solution will be more similar to the <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D0%25B8%25D0%25BC%25D0%25B0%25D1%2582_%25D0%259C%25D0%25B0%25D1%2580%25D1%2581%25D0%25B0">characteristics of the weather conditions of the remote planets</a> than to the correct result of solving a system of linear equations.  Therefore, a very important point is to control the condition number of the system of equations and take a number of measures to bring the system to a form in which you can get the best accuracy. </p><br><p> An example of when this problem may manifest itself may be the inconsistency of equations in magnitudes.  For example, using geometric constraints, we can create a triangle by fixing the lengths of the two sides and the angle between them.  The length constraint equation is written in millimeters, and the angle constraint, for example, is given through the cosine equality.  The inconsistency of these values ‚Äã‚Äãcan serve as a reason for implementing various loss of accuracy scenarios: when we make small triangles of the size of the order of millimeters, we can get fairly good accuracy, but when we start to solve the same equations, but with lengths of the order of kilometers, we will get completely different relative accuracy result.  This happens because the lengths vary significantly, while the values ‚Äã‚Äãof the cosines of the corners remain in a constant range of values.  I <strong>believe</strong> that one of the solutions to the problem of inconsistency of equations can be the formation of a system of equations in a <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B4%25D0%25BD%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B4%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25BA%25D0%25BE%25D0%25BE%25D1%2580%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25B0%25D1%2582">homogeneous coordinate system</a> , using the methods of <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B3%25D0%25B5%25D0%25BE%25D0%25BC%25D0%25B5%25D1%2582%25D1%2580%25D0%25B8%25D1%258F">projective geometry</a> , but this conclusion is a <strong>premonition</strong> , in view of my very modest knowledge in the field of projective geometry in particular, and all of mathematics whole  There is a possibility that this topic has already been disclosed, but it is possible that someone will be able to find in it a way to defend a couple of dissertations. </p><br><h2 id="uvelichivaem-proizvoditelnost">  We increase productivity </h2><br><p>  The algorithmic complexity of solving a system of nonlinear equations by the Newton method is mainly determined by the complexity of solving a system of linear equations.  For example, the original <a href="http://solvespace.com/index.pl">SolveSpace,</a> according to <a href="https://en.wikipedia.org/wiki/Jonathan_Westhues">Jonathan Vesthyu</a> , author of <strong>SolveSpace</strong> , uses <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%2593%25D0%25B0%25D1%2583%25D1%2581%25D1%2581%25D0%25B0">the Gauss method</a> , which has the algorithmic complexity <strong>O (n ^ 3)</strong> , as the method of solution.  This is not very fast if you suddenly want to solve large sketches containing thousands of equations and unknowns.  But given the fact that the matrix of a system of linear equations is almost all zeros and is very <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B5%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D0%25B0">sparse</a> , algorithms with lower algorithmic complexity can be used to solve. </p><br><p>  An additional advantage of writing equations in symbolic form is the possibility of their preliminary symbolic optimization.  Such an operation, for example, is the abbreviation of such.  But a serious performance increase can be achieved by symbolically solving some equations by the substitution method.  For example, in <strong>SolveSpace, the</strong> method of symbolic substitution solves such constraints as coincidence of points and horizontal position / verticality.  The use of this method can significantly reduce the number of equations and unknowns that serve as input data for the Newton method.  You can learn more about how symbolic expressions are arranged <a href="https://youtu.be/EjSJ3oLa9xY">in this video</a> . </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Despite the fact that the topic of solving systems of nonlinear equations seems initially simple, it contains many pitfalls and fundamental problems.  I believe that there is still work to be done in this area, since, apart from geometric applications, solving systems of nonlinear equations can be useful in many areas: from solving costs optimization problems to using artificial intelligence systems. </p><br><p>  <a href="https://habrahabr.ru/post/324160/">Part 1: Introduction</a> <br>  <a href="https://habrahabr.ru/post/324514/">Part 2: Sketch</a> <br>  <a href="https://habrahabr.ru/post/325770/">Part 3: Degrees of freedom and constraint equations</a> <br>  <a href="https://habrahabr.ru/post/335962/">Part 4: "The ways of the Solver are inscrutable" or "Newton's Wormholes"</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/335962/">https://habr.com/ru/post/335962/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335948/index.html">Key Criteria for Choosing and Evaluating an Internet Promotion Agency</a></li>
<li><a href="../335952/index.html">Multiformat banners in Tinkoff.ru and the approach to the layout of responsive banners in Google AdWords</a></li>
<li><a href="../335954/index.html">ReactOS versus Windows XP SP3: the epic battle in 3DMark</a></li>
<li><a href="../335958/index.html">Implementation, analog and adaptation for ‚Äúpure‚Äù javascript JavaScript jQuery () functions; and adjacent to it</a></li>
<li><a href="../335960/index.html">Playfully bash'im</a></li>
<li><a href="../335964/index.html">How cloud service Drimkas Cabinet copes with spontaneous loads</a></li>
<li><a href="../335966/index.html">Celesta and Flute: Creating Business Logic in the Java Ecosystem</a></li>
<li><a href="../335968/index.html">Cloning the Lode Runner game from the first PC in the USSR "BK-0010" plus a few words about the programming of games in the late 80s</a></li>
<li><a href="../335970/index.html">We break haks completely. We read machine codes as an open book.</a></li>
<li><a href="../335972/index.html">Game model of behavior in the market of two competing firms in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>