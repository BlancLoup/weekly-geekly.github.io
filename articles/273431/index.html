<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn English with Scala on Future and Actor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I decided to tighten up my English here. In particular, I wanted to significantly expand the vocabulary. I know that there are a lot of programs that ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn English with Scala on Future and Actor</h1><div class="post__text post__text-html js-mediator-article">  I decided to tighten up my English here.  In particular, I wanted to significantly expand the vocabulary.  I know that there are a lot of programs that help to do this in a game form.  The catch is that I don't like gaming.  I prefer the old fashioned way.  A piece of paper where the table with the words, transcription and translation.  And we teach him to teach.  And we check our knowledge, for example, by closing the column with the translation.  In general, as I taught it at the university. <br><br>  I heard about the fact that there are 3000 of the most frequently used words, selected on the OxfordDictionary site.  Here is this list of words: <a href="http://www.oxfordlearnersdictionaries.com/wordlist/english/oxford3000/Oxford3000_A-B/">www.oxfordlearnerserstiontion.com/wordlist/english/oxford3000/Oxford3000_A-B</a> Well, I decided to take the Russian translation from here: <a href="http://www.translate.ru/dictionary/en-ru/">www.translate.ru/dictionary/en-ru</a> One problem only, everything is on these sites well, not at all in the format that can be printed and taught.  As a result, the idea was born to program it all.  But to do this not as a sequential algorithm, but to separate everything.  What would pumping and parsing all the words took not (3000 words * 2 sites) / 60 seconds = 100 minutes.  This is if you give 1 second to pump out and rasparsivanija pages to extract the translation and transcription (in reality, I think it is 3 times longer, while we open the connection, while we close, etc. and etc.). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4bc/eae/7ea/4bceae7ea882594409931ec9c01da0eb.jpg" alt="image"><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I broke the task into two large blocks at once.  The first block is blocking I / O - downloading a page from the site.  The second block is computational operations, not blocking, but loading the CPU: parsing the page to extract the translation and transcription and add the results of the parsing to the dictionary. <br><br>  I decided to do blocking operations in the thread pool using Future from Scala.  Computational problems, I decided to scatter Akka by 3 actors.  Using the TDD technique, at first I wrote a test to my bricks of the future application. <br><br><pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlatSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Matchers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Table Of Content extractor"</span></span> should <span class="hljs-string"><span class="hljs-string">"download and extract content from Oxford Site"</span></span> in { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> content:<span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.getTableOfContent content.size should be (<span class="hljs-number"><span class="hljs-number">10</span></span>) content.find(_ == <span class="hljs-string"><span class="hljs-string">"AB"</span></span>) should be (<span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-string"><span class="hljs-string">"AB"</span></span>)) content.find(_ == <span class="hljs-string"><span class="hljs-string">"UZ"</span></span>) should be (<span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-string"><span class="hljs-string">"UZ"</span></span>)) } <span class="hljs-string"><span class="hljs-string">"Words list extractor"</span></span> should <span class="hljs-string"><span class="hljs-string">"download words from page"</span></span> in { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> future: <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]]]] = <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.getWordsFromPage(<span class="hljs-string"><span class="hljs-string">"AB"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wordsTry:<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]]] = <span class="hljs-type"><span class="hljs-type">Await</span></span>.result(future,<span class="hljs-number"><span class="hljs-number">60</span></span> seconds) wordsTry should be a <span class="hljs-symbol"><span class="hljs-symbol">'success</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> words = wordsTry.get words.get.find(_ == <span class="hljs-string"><span class="hljs-string">"abandon"</span></span>) should be (<span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-string"><span class="hljs-string">"abandon"</span></span>)) } <span class="hljs-string"><span class="hljs-string">"Words list extractor"</span></span> should <span class="hljs-string"><span class="hljs-string">"return None from empty page"</span></span> in { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> future: <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]]]] = <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.getWordsFromPage(<span class="hljs-string"><span class="hljs-string">"AB"</span></span>, <span class="hljs-number"><span class="hljs-number">999</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wordsTry:<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]]] = <span class="hljs-type"><span class="hljs-type">Await</span></span>.result(future,<span class="hljs-number"><span class="hljs-number">60</span></span> seconds) wordsTry should be a <span class="hljs-symbol"><span class="hljs-symbol">'success</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> words = wordsTry.get words should be(<span class="hljs-type"><span class="hljs-type">None</span></span>) } <span class="hljs-string"><span class="hljs-string">"Russian Translation"</span></span> should <span class="hljs-string"><span class="hljs-string">"download translation and parse"</span></span> in { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> page: <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]] = <span class="hljs-type"><span class="hljs-type">LingvoSite</span></span>.getPage(<span class="hljs-string"><span class="hljs-string">"test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageResultTry: <span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]= <span class="hljs-type"><span class="hljs-type">Await</span></span>.result(page,<span class="hljs-number"><span class="hljs-number">60</span></span> seconds) pageResultTry should be a <span class="hljs-symbol"><span class="hljs-symbol">'success</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageResult = pageResultTry.get pageResult.contains(<span class="hljs-string"><span class="hljs-string">""</span></span>) should be(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-type"><span class="hljs-type">LingvoSite</span></span>.parseTranslation(pageResult).get should be(<span class="hljs-string"><span class="hljs-string">""</span></span>) } <span class="hljs-string"><span class="hljs-string">"English Translation"</span></span> should <span class="hljs-string"><span class="hljs-string">"download translation and parse"</span></span> in { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> page: <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]] = <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.getPage(<span class="hljs-string"><span class="hljs-string">"test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageResultTry: <span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = <span class="hljs-type"><span class="hljs-type">Await</span></span>.result(page,<span class="hljs-number"><span class="hljs-number">60</span></span> seconds) pageResultTry should be a <span class="hljs-symbol"><span class="hljs-symbol">'success</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageResult = pageResultTry.get pageResult.contains(<span class="hljs-string"><span class="hljs-string">"examination"</span></span>) should be(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.parseTranslation(pageResult).get should be((<span class="hljs-string"><span class="hljs-string">"test"</span></span>, <span class="hljs-string"><span class="hljs-string">"an examination of somebody's knowledge or ability, consisting of questions for them to answer or activities for them to perform"</span></span>)) } }</code> </pre> <br><br>  Note.  Functions that can return the result of calculations have Try [...].  Either Success or Result or Failure and Exception.  Functions that will call often and have blocking i / o operations have a result, like Future [Try [...]].  Those when calling the function immediately returns Future in which there are long i / o operations.  Moreover, they go inside Try and can end with errors (for example, the connection is broken). <br><br>  The application itself is initialized in Top3000WordsApp.scala.  The system of actors rises.  Actors are created.  The parsing of the list of words is started, which in parallel launches the pumping out of the English and Russian pages with transcription and translation.  In the case of a successful page jump, the transfer of the contents of the pages to the actors for parsing, extracting the translation and transcription, is triggered.  The result of the transfer is transmitted by the actors to the final dictionary actor who accumulates all the results in one place.  And by pressing enter, the system of actors goes into shutdown.  And the actor DictionaryActor, receiving a signal about this, saves the collected dictionary to the file dictionaty.txt <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Top3000WordsApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> system = <span class="hljs-type"><span class="hljs-type">ActorSystem</span></span>(<span class="hljs-string"><span class="hljs-string">"Top3000Words"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dictionatyActor = system.actorOf(<span class="hljs-type"><span class="hljs-type">Props</span></span>[<span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>], <span class="hljs-string"><span class="hljs-string">"dictionatyActor"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> englishTranslationActor = system.actorOf(<span class="hljs-type"><span class="hljs-type">Props</span></span>(classOf[<span class="hljs-type"><span class="hljs-type">EnglishTranslationActor</span></span>], dictionatyActor), <span class="hljs-string"><span class="hljs-string">"englishTranslationActor"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> russianTranslationActor = system.actorOf(<span class="hljs-type"><span class="hljs-type">Props</span></span>(classOf[<span class="hljs-type"><span class="hljs-type">RussianTranslationActor</span></span>], dictionatyActor), <span class="hljs-string"><span class="hljs-string">"russianTranslationActor"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mapGetPageThreadExecutionContext = <span class="hljs-type"><span class="hljs-type">ExecutionContext</span></span>.fromExecutor(<span class="hljs-type"><span class="hljs-type">Executors</span></span>.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">16</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mapGetWordsThreadExecutionContext = <span class="hljs-type"><span class="hljs-type">ExecutionContext</span></span>.fromExecutor(<span class="hljs-type"><span class="hljs-type">Executors</span></span>.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">16</span></span>)) start() scala.io.<span class="hljs-type"><span class="hljs-type">StdIn</span></span>.readLine() system.terminate() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span></span>() = { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> concurrent.<span class="hljs-type"><span class="hljs-type">ExecutionContext</span></span>.<span class="hljs-type"><span class="hljs-type">Implicits</span></span>.global <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.getTableOfContent.par.foreach(letterGroup =&gt; { getWords(letterGroup, <span class="hljs-number"><span class="hljs-number">1</span></span>) }) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWords</span></span></span></span>(letterGroup: <span class="hljs-type"><span class="hljs-type">String</span></span>, pageNum: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> executor = mapGetWordsThreadExecutionContext <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.getWordsFromPage(letterGroup, pageNum).map(tryWords =&gt; { tryWords <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Success</span></span>(<span class="hljs-type"><span class="hljs-type">Some</span></span>(words)) =&gt; words.par.foreach(word =&gt; { parse(word,letterGroup,pageNum) }) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Success</span></span>(<span class="hljs-type"><span class="hljs-type">None</span></span>) =&gt; <span class="hljs-type"><span class="hljs-type">Unit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Failure</span></span>(ex) =&gt; println(ex.getMessage) } }) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span></span>(word: <span class="hljs-type"><span class="hljs-type">String</span></span>, letterGroup: <span class="hljs-type"><span class="hljs-type">String</span></span>, pageNum: <span class="hljs-type"><span class="hljs-type">Int</span></span>)= { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> executor = mapGetPageThreadExecutionContext <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.getPage(word).map(tryEnglishPage =&gt; { tryEnglishPage <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Success</span></span>(englishPage) =&gt; { englishTranslationActor ! (word, englishPage) getWords(letterGroup, pageNum + <span class="hljs-number"><span class="hljs-number">1</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Failure</span></span>(ex) =&gt; println(ex.getMessage) } }) <span class="hljs-type"><span class="hljs-type">LingvoSite</span></span>.getPage(word).map(_ <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Success</span></span>(russianPage) =&gt; { russianTranslationActor !(word, russianPage) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Failure</span></span>(ex) =&gt; println(ex.getMessage) }) } }</code> </pre><br><br>  Please note that the algorithm is divided into the start, getWords, parse functions.  This is done because each phase of the task requires its own thread pool, which is passed implicitly, like the ThreadExecutionContext.  At first, I had only one getWords function, for a recursive call.  But everything worked very slowly, since at the top level of the algorithm, threading rested the entire pool of threads and at the very bottom there were eternal expectations, when would they give me a free thread to work.  And just at the bottom of the largest number of operations. <br><br>  Here is the implementation of downloading and parsing from sites. <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OxfordSite</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> getPageThreadExecutionContext = <span class="hljs-type"><span class="hljs-type">ExecutionContext</span></span>.fromExecutor(<span class="hljs-type"><span class="hljs-type">Executors</span></span>.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">16</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseTranslation</span></span></span></span>(content: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Try</span></span>[(<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">String</span></span>)] = { <span class="hljs-type"><span class="hljs-type">Try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Browser</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> doc = browser.parseString(content) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spanElement: <span class="hljs-type"><span class="hljs-type">Element</span></span> = doc &gt;&gt; element(<span class="hljs-string"><span class="hljs-string">".phon"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> str = <span class="hljs-type"><span class="hljs-type">Jsoup</span></span>.parse(spanElement.toString).text() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> transcription = str.stripPrefix(<span class="hljs-string"><span class="hljs-string">"BrE//"</span></span>).stripSuffix(<span class="hljs-string"><span class="hljs-string">"//"</span></span>).trim <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> translation = doc &gt;&gt; text(<span class="hljs-string"><span class="hljs-string">".def"</span></span>) (transcription,translation) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPage</span></span></span></span>(word: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]] = { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> executor = getPageThreadExecutionContext <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-type"><span class="hljs-type">Try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> html = <span class="hljs-type"><span class="hljs-type">Source</span></span>.fromURL(<span class="hljs-string"><span class="hljs-string">"http://www.oxfordlearnersdictionaries.com/definition/english/"</span></span> + (word.replace(' ','-')) + <span class="hljs-string"><span class="hljs-string">"_1"</span></span>) html.mkString } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWordsFromPage</span></span></span></span>(letterGroup: <span class="hljs-type"><span class="hljs-type">String</span></span>, pageNum: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]]]] = { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">ExecutionContext</span></span>.<span class="hljs-type"><span class="hljs-type">Implicits</span></span>.global <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-type"><span class="hljs-type">Try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> html = <span class="hljs-type"><span class="hljs-type">Source</span></span>.fromURL(<span class="hljs-string"><span class="hljs-string">"http://www.oxfordlearnersdictionaries.com"</span></span> + <span class="hljs-string"><span class="hljs-string">"/wordlist/english/oxford3000/Oxford3000_"</span></span> + letterGroup + <span class="hljs-string"><span class="hljs-string">"/?page="</span></span> + pageNum) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> page = html.mkString <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Browser</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> doc = browser.parseString(page) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ulElement: <span class="hljs-type"><span class="hljs-type">Element</span></span> = doc &gt;&gt; element(<span class="hljs-string"><span class="hljs-string">".wordlist-oxford3000"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> liElements: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">Element</span></span>] = ulElement &gt;&gt; elementList(<span class="hljs-string"><span class="hljs-string">"li"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (liElements.size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Some</span></span>(liElements.map(_ &gt;&gt; text(<span class="hljs-string"><span class="hljs-string">"a"</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTableOfContent</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> html = <span class="hljs-type"><span class="hljs-type">Source</span></span>.fromURL(<span class="hljs-string"><span class="hljs-string">"http://www.oxfordlearnersdictionaries.com/wordlist/english/oxford3000/Oxford3000_A-B/"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> page = html.mkString <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Browser</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> doc = browser.parseString(page) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ulElement: <span class="hljs-type"><span class="hljs-type">Element</span></span> = doc &gt;&gt; element(<span class="hljs-string"><span class="hljs-string">".hide_phone"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> liElements: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">Element</span></span>] = ulElement &gt;&gt; elementList(<span class="hljs-string"><span class="hljs-string">"li"</span></span>) <span class="hljs-type"><span class="hljs-type">List</span></span>(liElements.head &gt;&gt; text(<span class="hljs-string"><span class="hljs-string">"span"</span></span>)) ++ liElements.tail.map(_ &gt;&gt; text(<span class="hljs-string"><span class="hljs-string">"a"</span></span>)) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LingvoSite</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> getPageThreadExecutionContext = <span class="hljs-type"><span class="hljs-type">ExecutionContext</span></span>.fromExecutor(<span class="hljs-type"><span class="hljs-type">Executors</span></span>.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">16</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseTranslation</span></span></span></span>(content: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = { <span class="hljs-type"><span class="hljs-type">Try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Browser</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> doc = browser.parseString(content) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spanElement: <span class="hljs-type"><span class="hljs-type">Element</span></span> = doc &gt;&gt; element(<span class="hljs-string"><span class="hljs-string">".r_rs"</span></span>) spanElement &gt;&gt; text(<span class="hljs-string"><span class="hljs-string">"a"</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPage</span></span></span></span>(word: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Try</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]] = { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> executor = getPageThreadExecutionContext <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-type"><span class="hljs-type">Try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> html = <span class="hljs-type"><span class="hljs-type">Source</span></span>.fromURL(<span class="hljs-string"><span class="hljs-string">"http://www.translate.ru/dictionary/en-ru/"</span></span> + java.net.<span class="hljs-type"><span class="hljs-type">URLEncoder</span></span>.encode(word,<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) html.mkString } } } }</code> </pre><br><br>  The data structures that the actors work with. <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Word</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">word: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, transcription: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Option</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">] = </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">None</span></span></span></span><span class="hljs-class"><span class="hljs-params">, russianTranslation:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Option</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">] = </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">None</span></span></span></span><span class="hljs-class"><span class="hljs-params">, englishTranslation: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Option</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">] = </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">None</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RussianTranslation</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">word:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, translation: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnglishTranslation</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">word:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, translation: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transcription</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">word:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, transcription: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre><br><br>  Actors who take in the downloaded pages for parsing and forward the translation and transcription to the actor DictionaryActor <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnglishTranslationActor</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">dictionaryActor: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ActorRef</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Actor</span></span></span><span class="hljs-class"> </span></span>{ println(<span class="hljs-string"><span class="hljs-string">"EnglishTranslationActor"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receive</span></span></span><span class="hljs-function"> </span></span>= { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (word: <span class="hljs-type"><span class="hljs-type">String</span></span>, englishPage: <span class="hljs-type"><span class="hljs-type">String</span></span>) =&gt; { <span class="hljs-type"><span class="hljs-type">OxfordSite</span></span>.parseTranslation(englishPage) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Success</span></span>((transcription, translation)) =&gt; { dictionaryActor ! <span class="hljs-type"><span class="hljs-type">EnglishTranslation</span></span>(word,translation) dictionaryActor ! <span class="hljs-type"><span class="hljs-type">Transcription</span></span>(word,transcription) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Failure</span></span>(ex) =&gt; { println(ex.getMessage) } } } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RussianTranslationActor</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">dictionaryActor: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ActorRef</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Actor</span></span></span><span class="hljs-class"> </span></span>{ println(<span class="hljs-string"><span class="hljs-string">"RussianTranslationActor"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receive</span></span></span><span class="hljs-function"> </span></span>= { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (word: <span class="hljs-type"><span class="hljs-type">String</span></span>, russianPage: <span class="hljs-type"><span class="hljs-type">String</span></span>) =&gt; { <span class="hljs-type"><span class="hljs-type">LingvoSite</span></span>.parseTranslation(russianPage) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Success</span></span>(translation) =&gt; { dictionaryActor ! <span class="hljs-type"><span class="hljs-type">RussianTranslation</span></span>(word, translation) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Failure</span></span>(ex) =&gt; { println(ex.getMessage) } } } } }</code> </pre><br><br>  An actor who accumulates a dictionary with translations and transcriptions and after the shutdown system of actors writes the entire dictionary in dictionary.txt <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DictionaryActor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Actor</span></span></span><span class="hljs-class"> </span></span>{ println(<span class="hljs-string"><span class="hljs-string">"DictionaryActor"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postStop</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { println(<span class="hljs-string"><span class="hljs-string">"DictionaryActor postStop"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fileText = <span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>.words.map{<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (_, someWord)=&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> transcription = someWord.transcription.getOrElse(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> russianTranslation = someWord.russianTranslation.getOrElse(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> englishTranslation = someWord.englishTranslation.getOrElse(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-type"><span class="hljs-type">List</span></span>(someWord.word, transcription , russianTranslation , englishTranslation).mkString(<span class="hljs-string"><span class="hljs-string">"|"</span></span>) }}.mkString(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) scala.tools.nsc.io.<span class="hljs-type"><span class="hljs-type">File</span></span>(<span class="hljs-string"><span class="hljs-string">"dictionary.txt"</span></span>).writeAll(fileText) println(<span class="hljs-string"><span class="hljs-string">"dictionary.txt saved"</span></span>) <span class="hljs-type"><span class="hljs-type">System</span></span>.exit(<span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receive</span></span></span><span class="hljs-function"> </span></span>= { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Transcription</span></span>(wordName, transcription) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newElement = <span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>.words.get(wordName) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Some</span></span>(word) =&gt; word.copy(transcription = <span class="hljs-type"><span class="hljs-type">Some</span></span>(transcription)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Word</span></span>(wordName,transcription = <span class="hljs-type"><span class="hljs-type">Some</span></span>(transcription)) } <span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>.words += wordName -&gt; newElement println(newElement) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">RussianTranslation</span></span>(wordName, translation) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newElement = <span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>.words.get(wordName) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Some</span></span>(word) =&gt; word.copy(russianTranslation = <span class="hljs-type"><span class="hljs-type">Some</span></span>(translation)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Word</span></span>(wordName,russianTranslation = <span class="hljs-type"><span class="hljs-type">Some</span></span>(translation)) } <span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>.words += wordName -&gt; newElement println(newElement) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">EnglishTranslation</span></span>(wordName, translation) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newElement = <span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>.words.get(wordName) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Some</span></span>(word) =&gt; word.copy(englishTranslation = <span class="hljs-type"><span class="hljs-type">Some</span></span>(translation)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Word</span></span>(wordName,englishTranslation = <span class="hljs-type"><span class="hljs-type">Some</span></span>(translation)) } <span class="hljs-type"><span class="hljs-type">DictionaryActor</span></span>.words += wordName -&gt; newElement println(newElement) } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DictionaryActor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> words = scala.collection.mutable.<span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">Word</span></span>]() }</code> </pre><br><br>  What are the conclusions?  On my Mac Book Pro, this script worked for about 1 hour while I was writing this article.  I interrupted him by pressing enter and here is the result: <br><br><pre> <code class="bash hljs">bash-3.2$ cat ./dictionary.txt |wc -l 1809</code> </pre><br><br>  Then, I ran the script again and left it for several hours.  When I returned, I had a processor loaded 100% and there were errors in the console about the garbazh collector, by pressing enter, my program could not save the result of its work to a file.  Such a diagnosis, writing on Future and par.map or par.foreach is nice and convenient, of course, but it's really hard to understand how it all works at the thread level and where the bottle neck is.  In the end, I plan to rewrite all the actors.  Besides, I will use pools of actors.  What, for example, 4 actors pumped out and parsed the pages with lists of words, 18 actors pumped out pages with translations, 4 actors read the pages, extracting translations and transcriptions, and 1 actor added everything to the dictionary. <br><br>  The current implementation in branch v0.1 <a href="">github.com/evgenyigumnov/top3000words/tree/v0.1</a> The version where everything is rewritten to actors with pools will be in brunch v0.2, well, in master, a little later.  Can anyone have any thoughts on what I was doing wrong in the current version?  Well, maybe tips throw on the new version? <br><br>  The github project is available: <a href="https://github.com/evgenyigumnov/top3000words">github.com/evgenyigumnov/top3000words</a> <br><br>  Run project tests: sbt test <br>  Run application: sbt run <br>  Well, how tired of waiting, pressing enter and reading the contents of the file dictionary.txt in the current folder <br><br>  PS <br>  As a result, I made the final version v0.2, which parses 10 minutes in 30 threads.  <a href="">github.com/evgenyigumnov/top3000words/tree/v0.2</a> <br>  At the end of the enter no need to click.  Everything is done on the actors.  In Future, only blocking i / o wraps are heavy. </div><p>Source: <a href="https://habr.com/ru/post/273431/">https://habr.com/ru/post/273431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273421/index.html">We become professional PHP developers. Part 1: Missing Link</a></li>
<li><a href="../273423/index.html">Children and parents on the web: the story of hacking services VTech</a></li>
<li><a href="../273425/index.html">Quickly raised is not considered to be dropped. Increase resiliency of embedded systems</a></li>
<li><a href="../273427/index.html">Unit Tests in ABAP</a></li>
<li><a href="../273429/index.html">Development of plug-ins for Atlassian JIRA</a></li>
<li><a href="../273433/index.html">Primary values ‚Äã‚Äãof the secondary market. Arguments and Facts</a></li>
<li><a href="../273435/index.html">Oracle Database 12c: Performance Tuning</a></li>
<li><a href="../273437/index.html">Security Week 51: Zero Day in Joomla, Twitter warns MacKeeper database leak</a></li>
<li><a href="../273439/index.html">On the open data of the Federal Treasury. Report to the next public council in February 2016</a></li>
<li><a href="../273441/index.html">Demo ‚Äî Review of the Dell EVO Solution: rail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>