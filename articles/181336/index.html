<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino: Automatic staircase lighting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing to explore the capabilities of the Arduino platform, I decided to highlight the stairs of the country house. 

 First of all, I studied sim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino: Automatic staircase lighting</h1><div class="post__text post__text-html js-mediator-article">  Continuing to explore the capabilities of the Arduino platform, I decided to highlight the stairs of the country house. <br><img src="https://habrastorage.org/storage2/b93/b89/4f0/b93b894f0cae5e1dca4fb69bb8109b4d.jpg" align="right"><br>  First of all, I studied similar projects on the Internet, and found <a href="http://geektimes.ru/users/rimidalw/" class="user_link">Rimidalw</a> <a href="http://habrahabr.ru/post/142685/">excellent work</a> .  After analyzing the experience of others and gaining confidence, I began to implement my project. <br><img src="https://habrastorage.org/storage2/e0c/417/de7/e0c417de78ac2332616b095be8151cb1.gif" align="right"><br><h4>  Purpose: </h4><br>  <b>"Automatic lighting of the stairs at night"</b> <br><br><br><h4>  Tasks: </h4><br><hr>  1) <b>Assemble the control circuit</b> <hr><br><ul><li>  The brain of the whole structure is the <a href="http://arduino.ru/Hardware/ArduinoBoardProMini">Arduino Mini</a> </li><li>  The sensors are two <a href="http://www.ladyada.net/learn/sensors/pir.html">PIR-sensors</a> </li><li>  To increase the pins, the <a href="http://www.nxp.com/documents/data_sheet/74HC_HCT595.pdf">74HC595</a> chip </li><li>  LED strips are controlled by IC <a href="http://www.ti.com/lit/ds/symlink/uln2003a.pdf">ULN2003A</a> </li><li>  Light Sensor <a href="http://cxem.net/arduino/arduino10.php">Phototransistor</a> </li><li>  <a href="http://www.chipdip.ru/product/pd-45a/">Power supply</a> with two outputs +12 and +5 </li></ul><a name="habracut"></a><br><img src="https://habrastorage.org/storage2/2c0/c44/1d2/2c0c441d270a5bd1e3110eb84f55a9a8.jpg"><br><hr>  2) <b>Make a printed circuit board and case</b> <hr><br>  I learned how to design quickly, I tried many CAD programs, <b>EAGLE</b> turned out to be the most convenient.  And one of the <a href="http://radiokot.ru/lab/hardwork/06/">ways of making was</a> explained and demonstrated by a friend who is fond of this topic.  <a href="https://docs.google.com/file/d/0B7mjQCYtg0hsOUdleFdIdlZRNVE/edit%3Fusp%3Dsharing">FILES (brd, sch)</a> <br><img src="https://habrastorage.org/storage2/c80/953/407/c8095340763e336db0c421e9ba927958.jpg" align="right"><br><img src="https://habrastorage.org/storage2/460/1ae/40f/4601ae40f7001fbee0be5e74f3503c09.jpg"><br><br><br>  The entire device is made with a <b>separate unit</b> with connectors, so that in case of a breakdown or upgrade, you can change the control module or the working body. <br><img src="https://habrastorage.org/storage2/c02/efe/4b2/c02efe4b2d49d628315d19ff58559de2.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>A box</b> made from getinaksa.  The connectors are torn off unnecessary devices and glued to cold welding. <br><br><img src="https://habrastorage.org/storage2/fb5/6ad/c16/fb56adc163d4fb0ac7ecd7da97e9e515.jpg"><br><hr>  3) <b>Write a program</b> <hr><br><div class="spoiler">  <b class="spoiler_title">The code is hidden HERE &gt;&gt;</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DS_Pin = <span class="hljs-number"><span class="hljs-number">11</span></span>; <span class="hljs-comment"><span class="hljs-comment">//pin 14 DS/SDI on the 75HC595   int ST_Pin = 8; //pin 12 ST_CP/RCLK on the 75HC595   int SH_Pin = 12; //pin 11 SH_CP/SRCLK on the 75HC595   const int PIR1 = 5;//  - const int PIR2 = 6;//  - int sensorPin = A0;//  // ****** int OverTime =15000; //      () const int N=14; //-  int Qck_tm = 300; //     int Wt_tm = 2000; //      int L=30; //    // ****** int a1,a2; //     long pM=0; //  millis() long pM1=0; //  millis() long pM10=0; //  millis() unsigned int sensorValue = 0; //    int registers[N+1]; //   boolean b2=false; //     boolean b3=false; //       void setup(){ pinMode(PIR1, INPUT); pinMode(PIR2, INPUT); pinMode(DS_Pin, OUTPUT); pinMode(ST_Pin, OUTPUT); pinMode(SH_Pin, OUTPUT); Serial.begin(9600); clearRegisters(); writeRegisters(); } //    void clearRegisters(){ for(int i = N; i &gt;= 0; i--){ registers[i] = LOW; } } //  void writeRegisters(){ digitalWrite(ST_Pin, LOW); for(int i = N; i &gt;= 0; i--){ digitalWrite(SH_Pin, LOW); int val = registers[i]; digitalWrite(DS_Pin, val); digitalWrite(SH_Pin, HIGH); } digitalWrite(ST_Pin, HIGH); } //     void setRegister(int index, int value){ registers[index] = value; } //   void LightON(boolean a){ b2=true; if(a) for (int k=0;k&lt;=N;) { a1=digitalRead(PIR1); if ( a1==HIGH &amp;&amp; millis() - pM1 &gt; 1000) { pM1 = millis(); } if (millis() - pM &gt; Qck_tm) { pM = millis(); setRegister(k, HIGH); writeRegisters(); k++; } } else for (int k=N;k&gt;=0;) { a2=digitalRead(PIR2); if ( a2 == HIGH &amp;&amp; millis() - pM1 &gt; 1000) { pM1 = millis(); } if (millis() - pM &gt; Qck_tm) { pM = millis(); setRegister(k, HIGH); writeRegisters(); k--; } } } //   void LightOFF(boolean a){ b2=false; if(a){ int k=0; while(k&lt;=N) { a1=digitalRead(PIR1); if (a1== HIGH){ LightON(true); break; } if (millis() - pM &gt; Qck_tm){ pM = millis(); setRegister(k, LOW); writeRegisters(); k++; }}} else { int k=N; while(k&gt;=0) { a2=digitalRead(PIR2); if (a2 == HIGH){ LightON(false); break; } if (millis() - pM &gt; Qck_tm){ pM = millis(); setRegister(k, LOW); writeRegisters(); k--; }}} } void loop(){ sensorValue = analogRead(sensorPin); //     Serial.println(sensorValue, DEC); if (sensorValue &lt; L){ a1=digitalRead(PIR1); if ( a1 == HIGH &amp;&amp; a2== LOW)//     { pM=millis(); LightON(true); while (b2) { a2=digitalRead(PIR2); if (a2 == HIGH &amp;&amp; millis() - pM10 &gt; 1000 || (millis() - pM &gt; OverTime)) { pM10 = millis(); LightOFF(true); }}} a2=digitalRead(PIR2); if (a2 == HIGH &amp;&amp; a1 == LOW) { pM=millis(); LightON(false); while (b2) { a1=digitalRead(PIR1); if (a1== HIGH &amp;&amp; millis() - pM10 &gt; 1000 || (millis() - pM &gt; OverTime)) { pM10 = millis(); LightOFF(false); }}}}}</span></span></code> </pre> <br>  Since there was no access stairs, I had to experiment on models from micro-bulbs, unfortunately she did not live up to the stage of writing the article. </div></div><br><hr>  4) <b>Make installation on the stairs</b> <hr><br>  <u>The most time-consuming and tedious stage of work</u> , it was necessary to lay a 40m cable and solder about 80 conductors. <br>  Control equipment placed under the stairs. <br><img src="https://habrastorage.org/storage2/09e/26f/645/09e26f645ea2c573987aa28de6e2e865.jpg" align="right"><br><img src="https://habrastorage.org/storage2/223/a94/e5d/223a94e5d3b1853a84db59a450f40a05.jpg"><br>  <b>The wires are</b> removed in the cable channels. <br>  <b>The sensors are</b> hidden under the first steps above and below, their placement was experimentally, the main task is to limit the viewing angle so as not to include the stairs in vain. <br>  <b>The phototransistor is</b> installed in the center of the staircase, where the light is the worst, so the staircase works perfectly even in cloudy weather. <br>  <b>LED strips are</b> glued on the back sides of the steps so as not to hit the eyes when climbing up.  Since the tapes were of different companies and IP, I had to alternate them across the step, which was even original. <br><img src="https://habrastorage.org/storage2/42d/d4f/4c5/42dd4f4c56fadee6e4d45debb3ffc24a.jpg" align="right"><br><img src="https://habrastorage.org/storage2/623/87c/ee7/62387cee7c3ed6dc9ec52c72c7a88c45.jpg"><br>  It took 3 days to complete the installation of all the equipment, there are still <b>flaws in the design</b> : <br><ul><li>  <b>The sensors are</b> glued to double-sided tape, I want to secure them more reliably. </li><li>  Better <b>disguise the conductors</b> under the steps </li><li>  Move <b>power and control units</b> to close them with a curtain </li></ul><br><hr>  5) <b>Calculate costs</b> <hr><br><img src="https://habrastorage.org/storage2/f3f/5fb/032/f3f5fb032282e9109ff2cd5631fa6c37.jpg"><br><br><h3>  ***VIDEO*** </h3><br><hr><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/KMqqa4e1mwI%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhgXkxxUuzbIR-3Z-Wpa71EivzTPVw" frameborder="0" allowfullscreen=""></iframe><br><hr><br><hr>  6) <b>Conclusion:</b> <hr><br>  It turned out even better than I imagined.  In general, the project can be refined indefinitely, but at the beta-version stage it works stably and reliably. <br>  Naturally, this device does not open America, but certainly COOL, when an idea is born from the head into the world and begins to work.  Good luck and inexhaustible creative inspiration to all! <br><hr>  7) <b>If I started a project now, would I do it differently?</b> <hr><br><ul><li>  <b>The connectors</b> should be installed on the board, the device will become more compact, and the soldering will be two times smaller. </li><li>  The <b>ULN2003A</b> chip <b>is</b> replaced with a normal LED driver, or with a transistor chip, so that the PWM (smooth start) feature can appear. </li><li>  To use a less sophisticated <b>power supply</b> , the usual LED for 12V is quite suitable.  Arduino feed through stabilizer at 5V. </li><li>  And, of course, ideally, use <b>four sensors</b> , or two range finders along the stairs to accurately determine the number of people and their behavior on the stairs. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/181336/">https://habr.com/ru/post/181336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181326/index.html">Return of the "browser for geeks"? A word in defense of Opera Next 15 (philosophical topic)</a></li>
<li><a href="../181328/index.html">Laravel 4 released</a></li>
<li><a href="../181330/index.html">GlacierWorks and Microsoft have created an interactive site on Everest</a></li>
<li><a href="../181332/index.html">How to beat Candy Crush Saga</a></li>
<li><a href="../181334/index.html">The Ministry of Culture proposes to fine users of file-sharing networks for 5000 rubles</a></li>
<li><a href="../181338/index.html">Adding animation to the ListView</a></li>
<li><a href="../181342/index.html">Using artificial immune systems to solve symbolic regression</a></li>
<li><a href="../181344/index.html">A little more about 2D graphics for Android</a></li>
<li><a href="../181350/index.html">Warner Bros. and NBC Universal demanded the removal of the address of the file hosting Mega from the Google search results</a></li>
<li><a href="../181354/index.html">Scalable networks in Openstack. Part 2: VlanManager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>