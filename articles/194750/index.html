<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another tacacs +</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think about tacacs + its settings, policies, ACL and others said, and even more so written more than enough. But, that always bothered me in tacas +...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another tacacs +</h1><div class="post__text post__text-html js-mediator-article"> I think about tacacs + its settings, policies, ACL and others said, and even more so written more than enough.  But, that always bothered me in tacas + - something was always missing.  Some incompleteness of something ... <a name="habracut"></a><br>  For example, you can not set a banner on the entrance to a group of hosts, you can only by separation.  You cannot apply identical settings to a group of hosts, you can only individually.  And it will be typed from heels of such cavils.  Maybe I don‚Äôt know something, but for now, that‚Äôs how it is for me. <br>  At the previous work, I saw an unusual tacacs +, which was completely different from the standard one.  And now, after some time, I found it.  And not just found, but implemented in a small desk. <br>  It will be about the project: <a href="http://www.pro-bono-publico.de/projects/tac_plus.html">www.pro-bono-publico.de/projects/tac_plus.html</a> .  The article will be somewhat in the spirit of <i>"How-to"</i> , I hope someone it will be useful. <br><br>  Initial data: <br>  The server, with debian wheezy on board, which already has tacacs + and tftp installed by me from the repositories. <br><br>  We proceed to the installation and configuration of the new tacacs + (of course, remove the old tacacs +). <br>  We will collect it using checkinstall.  We need some libraries and <b>gcc-multilib</b> .  We put: <br> <code>apt-get install flex bison libtool gcc-multilib checkinstall</code> <br>  Preparing for assembly: <br> <code>./configure</code> <br>  And collect: <br> <code>checkinstall</code> <br> <blockquote>  From the first time to collect will not work, as the compiler will swear at the missing directories.  Therefore, create them immediately: <br><pre> <code class="bash hljs">mkdir /home/USER/tacacs-sourse/PROJECTS/build/linux-3.2.0-4-amd64-x86_64 mkdir /home/USER/tacacs-sourse/PROJECTS/build/linux-3.2.0-4-amd64-x86_64/mavis mkdir /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/mavis</code> </pre> <br>  <b>tacacs-sourse</b> is the directory where we unpacked the sources. <br></blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the end we will receive a package that will be safely installed in the system and the <s>kittens will be alive will</s> not spoil any dependencies. <br><br>  Next, the most interesting part is the <b>configuration</b> . <br>  On the network, I used tacacs + for <b>cisco</b> , <b>juniper</b> , <b>zelax</b> , <b>qutech</b> . <br><br>  But, let's proceed to the configuration of tacacs + itself: <br>  To begin with, it is worth creating a directory where the configuration file will be stored, I have this <b>/ etc / tacacs + /</b> .  Next, create the configuration file itself, I have <b>tacacs.conf</b> .  We set 600 permissions on the folder and file so that no outsider can peep the config. <br><br>  Further, I will give a simple example of a configuration file with comments: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/local/sbin/tac_plus id = spawnd { listen = { port = 49 } ## tacacs   49  } id = tac_plus { accounting log = /var/log/tacacs/tac_plus.log ##    (, ,    ),     600   logrotate mavis module = external ## mavis  (    ).  ,       ldap. { exec = /usr/local/lib//mavis/mavis_tacplus_passwd.pl } login backend = mavis ###       host = world { welcome banner = "\nWe are watching you! We know your ip: %%c\n" failed authentication banner ="\nYou are the %%u?\n" motd banner = "\nHello %%u. Today is %A!" key = WeryLongAndSequreKey ##  address = 0.0.0.0/0 } ###     -  ...  #  group = admin { default service = permit service = exec { set priv-lvl = 15 } service = junos-exec { set local-user-name = remote-super-users } #  juniper,   } #     group = noob { default service = deny service = exec { set priv-lvl = 15 } service = junos-exec { set local-user-name = remote-read-only } service = shell { cmd = show { permit .* } cmd = ping { permit .* } cmd = traceroute { permit .* } } } ### ACL     ,     tacacs+.   ,  ACL       192.168.0.5.      bad password. acl = noobilo { nas = 192.168.0.5 } ###   user = prootik { member = admin login = crypt bla-bla-bla service = shell { set priv-lvl = 15 } } user = noob { acl = noobilo member = noob login = crypt la-la-la service = shell { set priv-lvl = 15 } } }</span></span></code> </pre><br><br>  User passwords are stored encrypted in md5 or DES.  According to the documentation, this can be done as follows: <br><pre> <code class="bash hljs">openssl passwd -1 &lt;clear_text_password&gt; openssl passwd -crypt</code> </pre> <br><br>  As you have noticed, all users are given privileges of 15 level by default (cisco).  However, users of the <b>noob</b> group will still be able to execute only commands that they explicitly allow.  It seems to me convenient, it is not necessary to constantly enter the password to the privileged mode. <br><br>  The possibilities of ACL are wider here than in standard tacacs +, but the syntax is great.  For a more detailed study, you should smoke man.  In this article, I will not dwell on the ACL. <br><br>  And so, we got quite a working tacas +.  Let's try to run it: <br><br> <code>tac_plus /etc/tacacs+/tacacs.conf &amp;</code> <br> <br>  In the processes we will see something like this: <br> <code>71745 ? Ss 0:00 tac_plus: 0 connections, accepting up to 480 more <br> 71746 ? Ss 0:00 tac_plus: 0 connections <br> 71747 ? Ss 0:00 tac_plus: 0 connection</code> <br> <br>  It is really convenient to see how many users currently use the system (especially when you want to stop it)? <br><br>  On the website <a href="http://www.pro-bono-publico.de/">www.pro-bono-publico.de</a> .  There is an example init script, I changed it a little to fit my needs: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # # Start-stop script for tac_plus # # (C)2001-2010 by Marc Huber &lt;Marc.Huber@web.de&gt; # $Id: etc_init.d_tac_plus,v 1.1 2011/07/22 17:04:03 marc Exp $ # # chkconfig: 2345 99 99 # description: Starts and stops the tac_plus server process. # &lt;code&gt;PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/sbin/ export PATH DEFAULT=/etc/default/tacplus-tac_plus PROG=/usr/local/sbin/tac_plus CONF=/etc/tacacs+/tacacs.conf PIDFILE=/var/run/tac_plus.pid NAME=tac_plus [ -f "$DEFAULT" ] &amp;&amp; . "$DEFAULT" for FILE in $PROG $CONF ; do if ! [ -f "$FILE" ] ; then echo $FILE does not exist. DIE=1 fi done if [ "$DIE" != "" ] ; then echo Exiting. exit 1 fi start () { /bin/echo -n "Starting $NAME: " if $PROG -bp $PIDFILE $CONF then echo "done." else echo "failed." fi } restart () { PID=`cat $PIDFILE 2&gt;/dev/null` /bin/echo -n "Restarting $NAME: " if [ "x$PID" = "x" ] then echo "failed (service not running)" else kill -1 $PID 2&gt;/dev/null echo "initiated." fi } stop () { PID=`cat $PIDFILE 2&gt;/dev/null` /bin/echo -n "Stopping $NAME: " if [ "x$PID" = "x" ] then echo "failed ($NAME is not running)" else kill -9 $PID 2&gt;/dev/null rm -f $PIDFILE echo "done." fi } case "$1" in stop) stop ;; status) PID=`cat $PIDFILE 2&gt;/dev/null` if [ "x$PID" = "x" ] then echo "$NAME is not running." exit 1 fi if ps -p $PID 2&gt;/dev/null &gt;&amp;2 then echo "$NAME ($PID) is running." exit 0 fi echo "$NAME ($PID) is not running but pid file exists." ;; start|restart|force-reload|reload) if $PROG -P $CONF ;then if [ "$1" = "start" ] then stop 2&gt;/dev/null &gt;&amp;2 start else restart fi else cat &lt;&lt;EOT ******************************************************************************** * Unable to $1 $NAME ... please fix the configuration problem * indicated above. ******************************************************************************** EOT exit 1 fi ;; *) echo "Usage: $0 {start|stop|restart|force-reload|reload|status}" exit 1 ;; esac exit 0</span></span></code> </pre><br><br>  We give the script execution rights (chmod + x).  Call him for example tac_plus and throw in <b>/etc/init.d</b> .  Everything.  Now you can stop, start, restart tacas + using <b>service tac_plus start / stop / restart</b> . <br><br>  And for the complete Feng Shui we add tacacs + to the autoload: <br>  <code>update-rc.d tac_plus defaults</code> . <br><br>  The server part is ready.  Let's move on to setting up active equipment.  In fact, everything is simple, only juniper distinguished himself.  For cisco, I think there is no sense in citing (for zelax and qutech it is almost identical), but for juniper I will give it.  By the way, the documentation describes how to make friends juniper and tacacs +.  At one time, I had a great tinker with it. <br><br>  Config for juniper: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system authentication-order tacplus <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system authentication-order password <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system tacplus-server &lt;ip &gt; port 49 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system tacplus-server &lt;ip &gt; secret WeryLongAndSequreKey <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system tacplus-server &lt;ip &gt; timeout 10 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system accounting events login <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system accounting events change-log <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system accounting events interactive-commands <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> system accounting destination tacplus server &lt;ip &gt; secret WeryLongAndSequreKey <span class="hljs-comment"><span class="hljs-comment">#      ,   juniper         / set system login user remote-super-users full-name "User template for remote super-users" uid 2013 class super-user set system login user remote-read-only full-name "User template for remote read-only" uid 2014 class read-only #       , : set system login class remote-getconf permissions [ view-configuration configure ] set system login user remote-getconfig full-name "User template for remote getconf" uid 2015 class remote-getconf</span></span></code> </pre><br><br><blockquote>  Even with tacacs + enabled, you can get to juniper as root.  This is done so that you can get into the shell.  By tacacs + account, you get right into cli. </blockquote><br><br>  Also, I strongly recommend to allocate a control subnet and hang ACLs on all devices, with access only from this subnet. <br><br>  And now, here are some screenshots: <br><br><img src="http://habrastorage.org/getpro/habr/post_images/74e/20d/acd/74e20dacdd80f3eac3dd4383ca86f59f.png" alt="image"><br><br><img src="http://habrastorage.org/getpro/habr/post_images/e23/52c/8d0/e2352c8d0a8de12ab0a8c838bd81d2f7.png" alt="image"><br><br>  ZY  To the issue of stability.  In the past, the system used a bunch of administrators and there were several thousand devices.  Everything was, in principle, good. <br>  At the current location - a few dozen devices and five users, everything is fine. </div><p>Source: <a href="https://habr.com/ru/post/194750/">https://habr.com/ru/post/194750/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194738/index.html">Guide to designing relational databases. Cascade delete data</a></li>
<li><a href="../194740/index.html">Sooner or later we will have to do it.</a></li>
<li><a href="../194742/index.html">How we shot NY 41x41</a></li>
<li><a href="../194746/index.html">AJAX in Joomla components! 2.5</a></li>
<li><a href="../194748/index.html">Overview of the stand-case with a Micro USB keyboard for a 7 "tablet</a></li>
<li><a href="../194758/index.html">Scale a real-life project database using SQL Azure Federations. Part 3: Migration</a></li>
<li><a href="../194760/index.html">Side Effects Cryptography</a></li>
<li><a href="../194764/index.html">RailsClub'Moscow 2013. Conference news</a></li>
<li><a href="../194774/index.html">The coolest PC system unit (DIY)</a></li>
<li><a href="../194776/index.html">How the creators of Pivotal Tracker work ... On the development, management and hiring of people</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>