<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java App Bundlers Review</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, last time I wrote about a tool for building JavaFXPackager applications. There were 2 ways to build the application, but none of them could be con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java App Bundlers Review</h1><div class="post__text post__text-html js-mediator-article">  So, <a href="http://habrahabr.ru/post/178481/">last time</a> I wrote about a tool for building JavaFXPackager applications.  There were 2 ways to build the application, but none of them could be conveniently called just from the code.  But we are Java programmers.  And for such pipe programmers from version 8u20, a special API in JavaFXPackager was created in the JDK, which allows you to just take and assemble a bundle from your binaries.  One problem is that this API is undocumented.  But it does not matter, we will understand. <br><a name="habracut"></a><br><h4>  Information sources </h4><br>  The primary source would naturally be JavaDoc, which, however, is also not publicly available.  Therefore, we will build it ourselves from the <a href="http://hg.openjdk.java.net/openjfx/8u-dev/rt">source</a> .  Without forcing readers to do it, I‚Äôll just post it: <a href="http://ginz.bitbucket.org/fxpackager-javadoc/">ginz.bitbucket.org/fxpackager-javadoc</a> .  Of course, it will not be out of place to have the source code, as the API is badly documented. <br><br><h4>  Introduction </h4><br>  What class makes the first to attract attention?  Apparently, the <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/Bundler.html">Bundler</a> interface with this specification: <br><br><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// action methods File execute(Map&lt;String,? super Object&gt; params, File outputParentDir); boolean validate(Map&lt;String,? super Object&gt; params); // information methods Collection&lt;BundlerParamInfo&lt;?&gt;&gt; getBundleParameters(); String getBundleType(); String getDescription(); String getID(); String getName();</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Methods are clearly divided into 2 types: methods that produce actions with already given parameters and methods that give information about this bundler. <br><br>  The execute takes a Map of parameters and an output directory as parameters and creates a bundle in this directory in some expected format.  But we can expect the correct execution only if validate passes without exceptions, and they can throw 2 types of them: UnsupportedPlatformException and ConfigException, the telling names of which suggest that if you throw out the first one, you simply use a bandler that is not supported by your platform.  The second is discarded if you have something wrong with the parameters passed. <br><br>  And what generally can be passed as parameters to these methods?  Most of the keys in these methods are in all static instances of the <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/BundlerParamInfo.html">BundlerParamInfo</a> class, most of which (common cross-platform parameters) are in the <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/StandardBundlerParam.html">StandardBundlerParam</a> class, and more specific (platform-dependent), as a rule, are in the <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/Bundler.html">Bundler</a> classes themselves: <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/linux/LinuxAppBundler.html">LinuxAppBundler</a> , <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/windows/WinExeBundler.html">WinExeBundler,</a> and so on.  Although it is not entirely clear how this class is generally related to what we put in params, which we pass execute.  In fact, it turns out that the id obtained by getID () is the key in this Map, and the value must be of the type that has been parameterized by the BundlerParamInfo. <br><br><h4>  And how to get copies of bandlers? </h4><br>  The easiest way to get all possible ‚Äúpre-installed‚Äù <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/Bundler.html">Bundlers</a> through the static <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/Bundlers.html">createBundlersInstance</a> method of the <a href="http://ginz.bitbucket.org/fxpackager-javadoc/com/oracle/tools/packager/Bundlers.html">Bundlers</a> interface (Warning, HOT: Java 8): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;Bundler&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSuitableBundlers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Bundlers.createBundlersInstance() .getBundlers() .stream() .filter(bundler -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { bundler.validate(Collections.emptyMap()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedPlatformException ex) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ConfigException ignored) { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }).collect(Collectors.toList()); }</code> </pre><br><br>  Thus, we not only received all the ‚Äúpre-installed‚Äù bundlers, but also filtered them according to the platform principle: as a rule, it is impossible to collect packages for one platform to another. <br><br><h4>  And what, no examples ?! </h4><br>  And, exactly, you can try to stop theorizing and draw some example. <br><br>  Since it seems to me that static typing is always better, we can wrap the creation of an associative array of parameters into something like BunderParamsBuilder: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BundlerParamsBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;String, Object&gt; params = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">BundlerParamsBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setParam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BundlerParamInfo&lt;T&gt; param, T value)</span></span></span><span class="hljs-function"> </span></span>{ params.put(param.getID(), value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BundlerParamsBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unsafeSetParam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String key, Object value)</span></span></span><span class="hljs-function"> </span></span>{ params.put(key, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(params); } }</code> </pre><br>  Thus, the project build will be approximately as follows (it implies the existence of starting /tmp/helloWorld.jar): <br><br><pre> <code class="java hljs">List&lt;Bundler&gt; bundlers = getSuitableBundlers(); Path directoryWithBundles = Files.createTempDirectory(<span class="hljs-string"><span class="hljs-string">"bundles"</span></span>); Path jar = Paths.get(<span class="hljs-string"><span class="hljs-string">"/tmp/helloWorld.jar"</span></span>); RelativeFileSet mainJar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelativeFileSet(jar.getParent().toFile(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;File&gt;( Arrays.asList(jar.toFile()) )); Map&lt;String, Object&gt; params = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BundlerParamsBuilder() .setParam(StandardBundlerParam.APP_NAME, <span class="hljs-string"><span class="hljs-string">"HelloWorld"</span></span>) .setParam(StandardBundlerParam.APP_RESOURCES, mainJar) .build(); bundlers.forEach(bundler -&gt; bundler.execute(params, directoryWithBundles.toFile())); System.out.println(<span class="hljs-string"><span class="hljs-string">"Bundles are created in "</span></span> + directoryWithBundles); System.out.println(<span class="hljs-string"><span class="hljs-string">"Parameters after bundling: "</span></span> + params);</code> </pre><br>  Exhaust after launch will be about the following: <br><pre> The bundles are created in / tmp / bundles5791581710818077755
 Parameters after bundling: {appVersion = 1.0, copyright = Copyright (C) 2015, stopOnUninstall = true, .mac-jdk.runtime.rules = [Lcom.oracle.tools.packager.JreUtils $ Rule; @ 4c3e4790, mac.app. bundler = Mac Application Image, linux.deb. , linux.deb.licenseText = Unknown, linux.deb.maintainer = Unknown &lt;Unknown&gt;, jvmProperties = {}, mac.signing-key-user-name =, licenseFile = [], identifier = HelloWorld, linux.rpm.imageDir = / tmp / fxbundler6592356981290936843 / images / linux-rpm.image, runtime = RelativeFileSet {basedir: /home/dginzburg/soft/jdk1.8.0_25/jre, files: [&lt;very big list of files&gt;]}, shortcutHint = false , mainJar = RelativeFileSet {basedir: / tmp, files: [helloWorld.jar]}, jvmOptions = [], name.fs = HelloWorld, fxPackaging = false, name = HelloWorld, appResources = RelativeFileSet {basedir: / tmp, files: [ helloWorld.jar]}, mac.category = Unknown, linux.deb.imageDir = / tmp  /fxbundler6592356981290936843/images/linux-deb.image/helloworld-1.0, .mac.default.icns = GenericAppHiDPI.icns, runAtStartup = false, linux.app.bundler = Linux Application Image, mac.signing-key-developer-id- app = null, linux.launcher.url = jar: file: /home/dginzburg/soft/jdk1.8.0_25/lib/ant-javafx.jar! / com / oracle / tools / packager / linux / JavaAppLauncher, description = HelloWorld , configRoot = / tmp / fxbundler6592356981290936843 / macosx, preferencesID = Hello, if you want to have a ceo, why = = helloworld-1.0, mac.CFBundleIdentifier = HelloWorld, serviceHint = false, vendor = Unknown, email = Unknown, applicationCategory = Unknown, mac.app.imageRoot = / tmp / fxbundler6592356981290936843 / images / dmg.image, userJvmOptions =} =, linux.deb.configDir = / tmp / fxbundler6592356981290936843 / images / linux-deb.image / helloworld-1.0 / DEBIAN, verbose = false, imagesRoot = / tmp / fxbundler6592  356981290936843 / images, mac.daemon.image = / tmp / fxbundler6592356981290936843 / images / pkg.daemon, applicationClass = HelloWorld, .linux.runtime.rules = [Lcom.oracle.tools.packager.JreUtils $ Rule; 38ccce, 38.cref, $ 38.3; true}
</pre><br><br>  Oh, where did we get all this here?  We kind of put in params only 2 parameters.  To understand this, you need to look at the BunderParamInfo.fetchFrom method, which is used to get the parameter value from params: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//... if (getDefaultValueFunction() != null) { T result = getDefaultValueFunction().apply(params); if (result != null) { params.put(getID(), result); } return result; } //...</span></span></code> </pre><br>  Yeah, if the parameter was not found in params and it can be obtained through other parameters (the defaultValueFunction function is responsible for this), then the value obtained in this way is pushed in params.  For example, we did not specify the MAIN_JAR parameter, but MAIN_JAR is required in order to create a launch file.  Let's take a look at how MAIN_JAR is defined: as defaultValueFunction we see: <br><br><pre> <code class="java hljs">params -&gt; { extractMainClassInfoFromAppResources(params); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (RelativeFileSet) params.get(<span class="hljs-string"><span class="hljs-string">"mainJar"</span></span>); }</code> </pre><br>  This is the answer where the mainJar value comes from. <br><br><h4>  Full list of parameters </h4><br>  In order not to look for the parameters each time, I made a <a href="http://ginz.bitbucket.org/bundlerParams.html">label</a> , into which I output information on all the found static instances of BundlerParamInfo. <br><br><h4>  Conclusion </h4><br>  The very minimum and the most obvious features are described, so feel free to read JavaDoc and even code. <br>  The article will be improved and corrected at the request of commentators. </div><p>Source: <a href="https://habr.com/ru/post/257363/">https://habr.com/ru/post/257363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257345/index.html">The principle of heart rate variability analysis in MATLAB</a></li>
<li><a href="../257347/index.html">SLA: build bridges, not walls</a></li>
<li><a href="../257349/index.html">Alternative HLS for iOS Safari - streaming video through Websocket</a></li>
<li><a href="../257355/index.html">ES6 and beyond. Chapter 1: ES? Present and Future</a></li>
<li><a href="../257361/index.html">Browser extension from Kinogo site</a></li>
<li><a href="../257371/index.html">How was the JPoint 2015: a full house and interesting details</a></li>
<li><a href="../257375/index.html">‚ÄúLaundry, why are you calling me?‚Äù - we released a new 2GIS Dialer</a></li>
<li><a href="../257377/index.html">How 3CX Phone System Solves Security Issues in VoIP (Part 1)</a></li>
<li><a href="../257379/index.html">Promoting your indie game: the most important nuances that nobody knows about</a></li>
<li><a href="../257383/index.html">Navigation Drawer + Fragments: Finish the Google Guide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>