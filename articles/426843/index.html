<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We calculate by IP: how to deal with spam in a social network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Spam on social networks and instant messengers is a pain. Pain for honest users and developers. How they are fighting in Badoo, said Mikhail Ovchinnik...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We calculate by IP: how to deal with spam in a social network</h1><div class="post__text post__text-html js-mediator-article">  Spam on social networks and instant messengers is a pain.  Pain for honest users and developers.  How they are fighting in Badoo, said Mikhail Ovchinnikov on Highload ++, then the text version of this report. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VknD3bQXuYU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>About the speaker:</strong> Mikhail Ovchinnikov works in Badoo and has been engaged in antispam for the last five years. <br><br>  Badoo has 390 million registered users (data as of October 2017).  If we compare the size of the service audience with the population of Russia, then we can say that in our country, according to statistics, every 100 million people are protected by 500 thousand police officers, and in Badoo every 100 million users are protected from spam by just one Antispam employee.  But even such a small number of programmers can protect users from various troubles on the Internet. <br><a name="habracut"></a><br>  We have a large audience, and there may be different users: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Good and very good, our favorite paying customers; </li><li>  The bad ones are those who, on the contrary, are trying to make money on us: they send spam, lure money, engage in fraud. </li></ul><br><h2>  Who have to fight <br></h2><br>  Spam can be different, often it can not be distinguished at all from the behavior of an ordinary user.  It can be manual or automatic - we also want to get bots that are engaged in automatic mailing. <br><br><blockquote>  Perhaps you, too, once wrote bots - were engaged in the creation of scripts for automatic posting.  If you are doing this now, it is better not to read further - you cannot in any way find out what I am about to tell. <br></blockquote><br>  This, of course, is a joke.  The article will not have information that will simplify the life of spammers. <br><br><img src="https://habrastorage.org/webt/kr/3c/7v/kr3c7vtm241m6npyzo7ej4bcams.jpeg"><br><br>  So who do we have to fight?  These are spammers and scammers. <br><br>  Spam appeared a long time ago, from the very beginning of the development of the Internet.  In our service, spammers, as a rule, try to register an account by uploading a <strong>photo of an attractive girl</strong> .  In the simplest form, they begin to send the most obvious types of spam links. <br><br>  A more complicated option is when people do not send anything overt, do not send any links, do not advertise anything, but <strong>lure the user to a more convenient place for them, for example, in instant messengers</strong> : Skype, Viber, WhatsApp.  There, they can, without our control, sell anything to the user, promote, etc. <br><br>  But <strong>spammers are not the biggest problem</strong> .  They act obviously, and it is easy to fight them.  Much more complex and interesting characters are <strong>scammers</strong> who impersonate another person and try to deceive users by all means available on the Internet. <br><br>  Of course, the actions of both spammers and scammers are not always very different from the behavior of ordinary users, who also sometimes do this.  There are many formal signs for those and others that do not allow a clear boundary between them.  It is almost never impossible to do. <br><br><h2>  How to fight spam in the Mesozoic era <br></h2><br><ol><li>  The simplest thing you could do was write <strong>separate regular expressions for each type of spam</strong> and enter every bad word and every single domain in this regular program.  All this was done manually, and, of course, it was the most inconvenient and inefficient. <br></li><li>  You can manually <strong>find questionable IP addresses and enter them into the server config</strong> , so that suspicious users will never visit your resource again.  This is inefficient because IP addresses are constantly reassigned, redistributed. <br></li><li>  Write one-time scripts for each type of spammer or bot, run their logs, manually find patterns.  If a little something changes in the behavior of the spammer, everything stops working - also completely ineffective. <br></li></ol><img src="https://habrastorage.org/webt/ak/3l/ls/ak3llsljdhla9k_myprwxpmjc_y.jpeg"><br><br>  First, I will show the simplest methods of dealing with spam, which everyone can implement.  Then I will tell you in detail about more complex systems that we developed using machine learning and other heavy artillery. <br><br><h2>  The simplest ways to deal with spam <br></h2><br><h3>  Manual Moderation <br></h3><br>  In any service, you can hire moderators who will manually view the user's content and profile, and decide what to do with this user.  Usually such a process looks like finding a needle in a haystack.  We have a huge number of users, moderators less. <br><br><img src="https://habrastorage.org/webt/xv/aa/ak/xvaaakhzi0pnnvltii7wcpf2uci.jpeg"><br><br>  In addition to the fact that moderators obviously need a lot, they need a large infrastructure.  But, in fact, the most difficult thing is that there is a problem: how, on the contrary, to protect users from moderators. <br><br>  It is necessary to make so that moderators did not get access to personal data.  This is important because, in theory, moderators can also try to harm.  That is, we need antispam for antispam so that the moderators are under tight control. <br><br>  Obviously, all users cannot be verified this way.  Nevertheless, <strong>moderation is in any case necessary</strong> , because any systems need further training and a human hand, which will determine what to do with the user. <br><br><h3>  Statistics collection <br></h3><br>  You can try to use statistics - for each user to collect various parameters. <br><br><img src="https://habrastorage.org/webt/n2/yq/ck/n2yqckqwqt8ttzvjtmtc3vgnbza.jpeg"><br><br>  User Innocent logs in from his IP address.  The first thing we do is log what IP address it came from.  Then we build a direct and reverse index between all IP addresses and all users so that you can get all the IP addresses from which a particular user logs in, as well as all users who logged in from a specific IP address. <br><br>  This way we get the link between the attribute and the user.  Such attributes can be quite a lot.  We can begin to collect information not only about IP-addresses, but also photos, devices from which the user came - about everything that we can determine. <br><br><img src="https://habrastorage.org/webt/i3/kw/8e/i3kw8el8s0_psz5w_d1hoxwui_s.jpeg"><br><br>  We collect such statistics and associate them with the user.  For each of the attributes, we can collect detailed counters. <br><br>  We have a manual moderation that decides which user is good, which is bad, and at some point the user is blocked or recognized as normal.  For each attribute, we can separately obtain data, how many users, how many of them are blocked, and how many are recognized as normal. <br><br>  Possessing such statistics on each of the attributes, we can roughly determine who the spammer is, who does not. <br><br><img src="https://habrastorage.org/webt/og/tj/tk/ogtjtkfpogqabof2yd_reen33ts.jpeg"><br><br>  Let's say we have two IP addresses - on one 80% of spammers, on the second 1%.  Obviously, the first one is much more spamming, you need to do something with it and apply some sanctions. <br><br>  The simplest is to write <strong>heuristic rules</strong> .  For example, if the blocked users are more than 80%, and those who are considered normal - less than 5%, then this IP address is considered bad.  Then we do something else with all the users with the same IP address. <br><br><h3>  Collecting statistics from texts <br></h3><br>  In addition to the obvious attributes that users have, you can also do text analysis.  You can automatically parse user messages, isolate from them everything that is relevant to spam: mentions of instant messengers, phones, email, links, domains, etc., and collect exactly the same statistics on them. <br><br><img src="https://habrastorage.org/webt/wr/t2/oo/wrt2oo4ybijxo1cx3odkuf917pi.jpeg"><br><br>  For example, if a domain name was sent in messages by 100 users, 50 of them were blocked, then this domain name is bad.  It can be blacklisted. <br><br>  We will receive a large number of additional statistics for each of the users on the basis of message texts.  No machine learning is needed for this. <br><br><h3>  Stop words <br></h3><br>  In addition to the obvious things - phones and links - you can isolate phrases or words from the text, which are especially characteristic of spammers.  You can keep such a list of stop words manually. <br><br>  For example, on the accounts of spammers and scammers, the phrase is often found: "There are a lot of fakes here."  They write that they are generally the only ones here who are set up for something serious, all other fakes who cannot be trusted in any way. <br><br>  On dating sites on statistics, spammers more often than ordinary people use the phrase: ‚ÄúI'm looking for a serious relationship.‚Äù  It is unlikely that an ordinary person would write like this on a dating site - with a probability of 70%, this is a spammer who is trying to lure someone. <br><br><h3>  Search for similar accounts <br></h3><br>  With statistics on the attributes and stop words found in the texts, you can build a system to search for similar accounts.  It is necessary to find and ban all accounts created by the same person.  A spammer who has been blocked can immediately register a new account. <br><br>  For example, the user Harold logs in, registers on the site and provides his own rather unique attributes: IP address, photo, stop word that he used.  Maybe he even signed up with a fake Facebook account. <br><br><img src="https://habrastorage.org/webt/qr/he/g-/qrheg-lipc_-e6qakgidkfcz7lu.jpeg"><br><br>  We can find all users who are similar to it, in which one or several of these attributes match.  When we know for sure that these users are connected, using the very direct and reverse index we find the attributes, and by them all users, and rank them.  If, say, the first Harold is blocked, then the rest are also easy to ‚Äúkill‚Äù with this system. <br><br>  All the methods that I have described are very simple: it is easy to collect statistics, then it is easy to search for these attributes by these attributes.  But, despite the ease, with the help of such simple things ‚Äî simple moderation, simple statistics, simple stop words ‚Äî <strong>50% of spam</strong> can be <strong>defeated</strong> . <br><br>  In our company, in the first six months of work, the Anti-spam department won 50% of spam.  The remaining 50%, as you know, are much more complicated. <br><br><h2>  How to make life difficult for spammers <br></h2><br>  Spammers invent something, trying to make life difficult for us, and we try to deal with them.  This is an endless war.  There are much more of them than us, and for each of our steps they invent their own multi-path. <br><br><blockquote> I am sure that spammer conferences are taking place somewhere, where the speakers tell how they defeated Anti-Spam Badoo, about their KPIs, or how to build scalable, fault-tolerant spam using the latest technologies. <br></blockquote><br>  Unfortunately, we are not invited to such conferences. <br><br>  But we can make life difficult for spammers.  For example, instead of directly showing the ‚ÄúYou are blocked‚Äù window to the user, you can use the so-called <strong>Stealth banning</strong> - this is when we do not tell the user that he is banned.  He should not even suspect it. <br><br><img src="https://habrastorage.org/webt/pt/3b/xm/pt3bxmfuyowj_0nkhjxnh3-yn14.jpeg"><br><br>  The user enters the sandbox (Silent Hill), where everything seems to be real: you can send messages, vote, but in fact it all goes into the void, into the fog.  No one will ever see or hear, no one will receive his messages and votes. <br><br>  We had a case where one spammer spammed for a long time, promoted his bad goods and services, and six months later decided to use the service as intended.  He registered his real account: real photos, name, etc.  Naturally, our search system for similar accounts quickly calculated it and placed it on Stealth ban.  After that, for six months, he wrote into the void that he was very lonely, no one answered.  In general, he poured his whole soul into the mist of Silent Hill, but received no response. <br><br>  Spammers, of course, are not fools.  They are trying to somehow determine that they hit the sandbox and that they were blocked, to quit the old account and find a new one.  Sometimes we even have the idea that it would be nice if several such spammers were sent to the sandbox together so that they could sell each other whatever they wanted and have fun whatever they wanted.  But so far we have not reached this point, but we invent other methods, for example, photo and telephone verification. <br><br><img src="https://habrastorage.org/webt/dz/7h/hc/dz7hhcjzwil1qnx_xtgg5itrxy4.jpeg"><br><br>  As you know, a spammer who is a bot and not a person is difficult to verify by phone or photo. <br><br>  In our case, the verification by the photo looks like this: the user is asked to take a picture with a certain gesture, the resulting photo is compared with the photos that are already uploaded to the profile.  If the faces are the same, then most likely the person is a real person who has uploaded his real photos and can be left behind for a while. <br><br>  Spammers pass this test is not easy.  We even had a small game inside the company called Guess Who the Spammer was.  Four photos are given, you need to understand which of them is a spammer. <br><br><img src="https://habrastorage.org/webt/qm/h_/yp/qmh_ypmte7ptgnoyjjjmdudpheg.jpeg"><br><br>  At first glance, these girls look completely harmless, but as soon as they begin to pass the photo-verification, then at some point it becomes clear that one of them is completely not what she claims to be. <br><br>  In any case, spammers struggle with photo-verification.  They are really suffering, trying to somehow get around it, to deceive, and demonstrate all their photoshop skills. <br><br><img src="https://habrastorage.org/webt/bc/gp/hg/bcgphg5m2v4zh5q5aqaqhxx7wtk.jpeg"><br><br>  Spammers do everything they can, and sometimes they think, probably, that this is all completely handled by some incredible modern technologies that are so poorly built that they are so easily deceived. <br><br>  They do not know that each photo is then manually checked by the moderators. <br><br><h2>  No time! <br></h2><br>  In fact, despite the fact that we come up with various ways to make life difficult for spammers, there is usually not enough time, because anti-spam should work instantly.  He must find and neutralize the user before he began his negative activity. <br><br>  The best thing to do is to determine at the registration stage that the user is not very good.  This can be done, for example, using clustering. <br><br><h3>  User clustering <br></h3><br>  We can collect all possible information right after registration.  We still have no devices from which the user comes in, no photos, there is no statistics.  We have nothing to send it for verification, he has not done anything suspicious yet.  But we already have primary information: <br><br><ul><li>  floor; </li><li>  age; </li><li>  country of registration; </li><li>  country and IP provider; </li><li>  email domain; </li><li>  telephone operator (if any); </li><li>  data from fb (if any) - how many friends does he have, how many photos has he uploaded, how long has he been registered there, etc. </li></ul><br>  All this information can be used to find clusters of users.  We use the simple and popular <strong>K-means</strong> clustering algorithm.  It is perfectly implemented everywhere, supported in any MachineLearning libraries, perfectly parallel, works quickly.  There are streaming variants of this algorithm that allow users to be distributed into clusters on the fly.  Even in our volumes, it all works quite quickly. <br><br>  Having received such user groups (clusters), we can do any actions.  If users are very similar (the cluster is strongly connected), then, most likely, this is a mass registration, it should be immediately stopped.  The user has not yet had time to do anything, just clicked the ‚ÄúRegister‚Äù button - and that‚Äôs all, he already got into the sandbox. <br><br>  You can collect statistics on clusters - if 50% of the cluster is blocked, then the remaining 50% can be sent for verification, or separately, all clusters can be moderated manually, view the attributes for which they match, and make a decision.  Based on such data, analysts can highlight patterns. <br><br><h3>  Patterns <br></h3><br>  Patterns are sets of the simplest attributes of users that are immediately known to us.  Some of the patterns actually work very effectively against certain types of spammers. <br><br>  For example, consider the combination of three completely independent, fairly general attributes: <br><br><ol><li>  User is registered in the USA; <br></li><li>  Its provider Privax LTD (VPN operator); <br></li><li>  Email-Domain: [mail.ru, list.ru, bk.ru, inbox.ru]. <br></li></ol><br>  These three attributes, it would seem, separately from themselves not representing anything, together give the likelihood that this is a spammer, almost 90%. <br><br>  Such patterns can be extracted any number for each type of spammer.  It is much more efficient and easier than manually viewing all accounts or even clusters. <br><br><h3>  Text clustering <br></h3><br>  In addition to clustering users by attributes, you can find users who write the same texts.  Of course, this is not so easy.  The fact is that our service works in very many languages.  Moreover, users often write with abbreviations in slang, sometimes with errors.  But the messages themselves are usually very short, literally 3-4 words (approximately 25 characters). <br><br>  Accordingly, if we want to find similar texts among the billions of messages that users write, we need to come up with something unusual.  If you try to use classical methods based on the analysis of morphology and true honest processing of the language, then with all these restrictions, slangs, abbreviations and a bunch of languages, it is very difficult to do. <br><br>  You can do a little more simply - apply the algorithm <strong>n-gram</strong> .  Each message that appears is broken down into n-grams.  If n = 2, then these are bigrams (pairs of letters).  Gradually, the entire message is divided into pairs of letters and statistics are collected, how many times each digram is found in the text. <br><br><img src="https://habrastorage.org/webt/co/4f/st/co4fst5xivvfiyxlxu8jzy0m2a4.jpeg"><br><br>  On bigrams you can not stop, but add trigrams, skipgrams (statistics by letters after 1, 2, etc. letters).  The more information we get, the better.  But even bigrams already work quite well. <br><br>  Next, from the digrams of each message, we obtain a vector whose length is equal to the square of the length of the alphabet. <br><br>  It is very convenient to work with this vector and cluster it, because: <br><br><ul><li>  consists of numbers; </li><li>  compressed, there are no voids; </li><li>  always fixed size. </li><li>  The k-means algorithm with such compressed fixed-size vectors runs very fast.  Our billions of messages are clustered in just a few minutes. </li></ul><br>  But that is not all.  Unfortunately, if we just collect all the messages that are similar in frequency to bigrams, we will get messages that are similar in frequency to bigrams.  At the same time, they do not have to be in fact at least somehow similar in meaning.  Often there are long texts in which the vectors are very close, almost the same, but the texts themselves are completely different.  Moreover, starting from a certain length of text, this clustering method will cease to work altogether, since  frequencies of digrams will be equal. <br><img src="https://habrastorage.org/webt/n5/cz/x1/n5czx1j8fb0hoskjlrwcqfi4gmg.jpeg"><br><br>  Therefore, you need to add filtering.  Since the clusters are already there, they are quite small, we can easily do filtering within the cluster using Stemming or Bag of Words.  Inside a small cluster, you can literally compare all messages with everyone, and get that cluster, which is guaranteed to contain the same messages, which match not only in statistics, but in fact. <br><br>  So, we made clustering - and, nevertheless, it is very important for us (and for clustering) to know the truth about the user.  If he tries to hide the truth from us, then we need to take some action. <br><br><h3>  Information hiding <br></h3><br>  The typical type of information hiding is VPN, TOR, Proxy, Anonymizer.  The user uses them, trying to pretend that he is from America, although in fact he is from Nigeria. <br><br>  In order to defeat this problem, we took the most famous textbook "How to calculate by IP." <br><br><img src="https://habrastorage.org/webt/4f/mm/cz/4fmmczwlvswrgpf2lwenmap_ojg.jpeg"><br><br>  With the help of this tutorial, we wrote a VPN classifier - that is, a classifier that receives an IP address as an input and at the output says whether this IP address is VPN, Proxy or not. <br><br>  To implement the classifier, we need several ingredients: <br><br><ol><li>  <strong>The ISP</strong> (Internet Service Provider) <strong>database</strong> , that is, the matching of IP addresses to all existing providers.  Such a base can be purchased, it is not very expensive. <br></li><li>  <strong>Information from whois</strong> .  There is a lot of different information available on the Whois IP address: country;  provider;  subnet, which includes the IP address;  sometimes the fact that this IP address belongs to the hosting, etc.  You can analyze the text on specific words and see what the IP address is all about. <br></li><li>  <strong>Base GeolP.</strong>  If the base tells us that the IP address is in Norway, and all users who use this Norwegian IP address are scattered across Africa, then there‚Äôs probably something wrong with that IP address. <br></li><li>  <strong>User statistics</strong> - how many users of our service are blocked on this IP-address, how many of them coincide with the data of GeolP, Whois, how many do not match. <br></li></ol><br>  By taking all this information, you can build a classifier that will eventually say whether the IP address is a VPN or not. <br><br><img src="https://habrastorage.org/webt/xn/3-/3r/xn3-3rzsxwp1j8vkwfzqbqwf2ia.jpeg"><br><br>  We chose <strong>decision trees</strong> because they are very good at finding the very patterns ‚Äî specific combinations of providers, countries, statistics, etc., which ultimately make it possible to determine that the IP address is a VPN. <br><br>  Of course, this data is very general.  No matter how well we train the classifier, no matter how hard we try to use advanced technology, it will still not work with 100% accuracy.  Therefore, additional network checks are a key factor here. <br><br>  As soon as we received information that the IP address allegedly belongs to a VPN, we can actually check what this IP address is.  You can try to connect to it, see what ports are open on it.  If there is a SOCKS-proxy, you can try to open the connection and accurately determine whether the given IP address is anonymizer or not. <br><br>  In addition, there is a great technology, the introduction of which we have in the plans, which is called <strong>p0f</strong> .  This is a utility that, at the network level, does fingerprinting traffic and allows you to immediately determine what is on that side of the connection: a normal user client, a VPN client, a proxy, etc.  The utility contains a large set of patterns that define all this. <br><br><h2>  Most suspicious action <br></h2><br>  After we wrote various systems, clusters, classifiers, collected statistics, we thought: what can the most suspicious user do on our service?  Sign up - this is already suspicious!  If a user is registered, we immediately start looking at him with a very cunning squint and analyze it in every possible way, trying to understand what he meant. <br><br>  We often have an inner desire - and not to ban us immediately after registration?  This would greatly facilitate the work of the Anti-Spam department.  We will immediately be able to drink tea 2 times longer, and we will have no problems. <br><br>  In order to stop such thoughts not only from ourselves, but also from the systems we write, and not to ban all good users, especially immediately after registration, we have to create systems that fight with our other systems, that is, organize themselves restrictions. <br><br><img src="https://habrastorage.org/webt/kh/ta/q4/khtaq4exl7jt9eqlx_7bkbq0toq.jpeg"><br><br>  How can you limit yourself not to ban good users, not to be mistaken and not to get confused? <br><br><h3>  "User Decency" <br></h3><br>  We classify users according to honesty - we will make an isolated model that will take all the positive characteristics of the user and analyze them. <br><br>  An example of the characteristics of "good" behavior: <br><br><ul><li>  the length of the dialogs; </li><li>  prescription of registration; </li><li>  lack of complaints; </li><li>  passed verifications; </li><li>  purchases. </li></ul><br>  A classifier or regression can be trained on the data set of all individual exceptionally good user characteristics.  We have a <strong>simple logistic regression</strong> .  This model is easily portable, since it is simply a set of coefficients, and it is easy to implement in any system and in any language, it is very well tolerated between platforms and infrastructures. <br><br>  Taking the user and chasing him through this model, we get the coefficient, which we call the " <strong>honesty coefficient</strong> ".  If it is zero, then, as a rule, this means that we have almost no information about this user.  Then we do not get any additional information from the classification. <br><br>  If the user‚Äôs honesty ratio is 1, then most likely the user is a good guy, we will not touch him - no verification and a ban will not come to him. <br><br><img src="https://habrastorage.org/webt/fn/oq/27/fnoq274iaylcaenxrn7ne2xbluk.jpeg"><br><br>  Such an isolated thing allows us to prevent many common mistakes. <br><br><h3>  False positive <br></h3><br>  The second thing you can do is look for various false positives.  It happens that users accidentally log in from the same IP address.  For example, two sit in an Internet cafe, even the computer may be the same.  Browser, fingerprint, which we consider on the computer, on the browser, on the device - everything will be absolutely the same, and we can consider that both users are spammers, although it‚Äôs not a fact that they are somehow connected. <br><br>  Another example: a good user in a dialogue with a spammer can ask again in response to an advertisement: ‚ÄúHey, I didn‚Äôt understand what Pornhub is ‚Äî why do you advertise it to me?‚Äù At that moment, the system sees that the user has written a stop word and can calculate that this user is a spammer and should be banned as soon as possible. <br><br>  Therefore, we have to search for anomalies.  We take users, their attributes, and look for among them those users who got into a bad company completely by accident. <br><br>  For example, take the stop word "Pornhub".  For each stop word, we have statistics of all users who have ever used it. <br><br><img src="https://habrastorage.org/webt/hc/-b/sr/hc-bsrvrndwftksm6hpepc_jyhi.jpeg"><br><br>  At some point, the new user Patrick uses the same stop word, and we have to add it to this bad company and ban it. <br><br>  Here you need to check whether the new user Patrick is different from all the old, already known spammers.  You can compare its typical attributes: gender, age, provider, application, country, etc.  Here it is important for us to understand how large the ‚Äúdistance‚Äù in this attribute space is between the user and the main group.  If it is very large, then Patrick most likely got there by accident.  He didn‚Äôt mean anything wrong, he shouldn‚Äôt be banned right away, but it‚Äôs better to send it for manual check. <br><br>  When we built such a system, we had much less typical false positives happening. <br><br><h2>  Universal Mega Classifier <br></h2><br>  You can ask - why not immediately make a great class system with MachineLearning, neural networks and decision trees, which will receive all information about users at the input and give out just 0 or 1 - a spammer or not. <br><img src="https://habrastorage.org/webt/bg/oa/tb/bgoatbaeeo_0zxpxfafc-d7qxl0.jpeg"><br><br>  Trying to create one universal model, it is very easy to come to a situation when we face a <strong>black box</strong> that is difficult to control.  In it, the good from the bad is not separated, the system is not isolated from itself, and only manual checking and indirect metrics are protected from errors.  In addition, it is quite difficult to collect all the information and statistics on a large amount of data in order to feed the mega-system to the input. <br><br>  Moreover, all known machine learning systems are more than one model - a dozen models.  Any voice assistant or face recognition system are several models that are combined into one very complex system. <br><br>  As a result, it became clear to us that a much more correct (from our point of view) is the way, when separate classifiers and clustering systems are created, which solve their individual problems.  Ideally, as in our case, a separate model is created for each type of spam and controlled separately in various ways: by other models, indirect metrics, and also manually.  Only in this way will it be possible to hope to avoid most false positives. <br><br><blockquote>  Come to <a href="http://www.highload.ru/moscow/2018/">HighLoad ++ 2018</a> , this year there will be a lot of reports on machine learning and artificial intelligence, for example: <br><br><ul><li>  Sergey Vinogradov will present the standardization of the life cycle of the ML-model and <a href="http://www.highload.ru/moscow/2018/abstracts/4251">show</a> how to exploit them in production without incident. <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dmitry Korobchenko from NVIDIA </font></font><a href="http://www.highload.ru/moscow/2018/abstracts/4209"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will talk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> about algorithmic tricks that are used under the hood of real combat neural networks.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artem Kondyukov </font></font><a href="http://www.highload.ru/moscow/2018/abstracts/4331"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will make an</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interesting use case of machine learning in the pharmaceutical industry.</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We collect videos of past reports on the </font></font><a href="https://www.youtube.com/c/profyclub"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">youtube channel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , publish news on future topics in the </font></font><a href="http://eepurl.com/VYVaf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newsletter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - subscribe if you want to be aware of everything in the world of high loads.</font></font><br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/426843/">https://habr.com/ru/post/426843/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426827/index.html">Mobile operators have bothered to secret communication</a></li>
<li><a href="../426831/index.html">Unpleasant conversation, herpetologist and complete surprise</a></li>
<li><a href="../426835/index.html">Comparative and detailed analysis of caching plugins for WordPress</a></li>
<li><a href="../426837/index.html">Video broadcast on your site that works</a></li>
<li><a href="../426839/index.html">Lost Total.js?</a></li>
<li><a href="../426849/index.html">4 tools for simultaneous execution of commands on multiple Linux servers</a></li>
<li><a href="../426851/index.html">Modern Web Development: Choose Your Adventure</a></li>
<li><a href="../426853/index.html">"S in IoT Stands for Security": the world's first law on the protection of smart gadgets is adopted - we understand what the essence</a></li>
<li><a href="../426861/index.html">New hunt for dark matter passes under the mountain</a></li>
<li><a href="../426863/index.html">Available on quaternions and their benefits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>