<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bible movements doom. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello and welcome to the Doom Movements Bible! The article sorted out and sorted into categories all the quirks and whims of the movement code in Doom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bible movements doom. Part 1</h1><div class="post__text post__text-html js-mediator-article">  Hello and welcome to the Doom Movements Bible!  The article sorted out and sorted into categories all the quirks and whims of the movement code in Doom, including intricate tricks describing their work. <br><br><img src="https://habrastorage.org/files/c05/065/c64/c05065c643d54288bfedf8edb0b5aae8.png"><br><br><h4>  Metrics </h4><br>  Let's start with the basics.  The engine code for Doom player movements is as follows: <br><ul><li>  Collecting player baseline data </li><li>  Applying driving force vectors to the player based on raw data </li><li>  Squeeze the speed of the player if it is too high </li><li>  Check, calculations and movements </li><li>  Using acceleration through friction for the next movement of the player </li></ul><br>  Consider all the details. <br>  Thanks only to this and a couple of variables we will be able to determine the possible maximum speeds of the player‚Äôs character. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For obvious reasons, the maximum player speed is achieved when the acceleration specified by the player is equal and opposite to the deceleration from friction. <br><br><a name="habracut"></a>  For each tick, the player receives a push equal to 0.03125 units in the calculation of the value of the entered command.  Since teams are (usually) limited to a maximum of 50. This gives us a maximum acceleration of friction of 1.5625 units / tick ^ 2. <br><br>  After calculating the movement for a tick, the player slows down using the friction coefficient.  The specific value is 0.90625 - in other words, each player‚Äôs movement slows down by 90.625% of his current speed. <br><br>  For the equivalence of acceleration and deceleration of each tick, with a speed of 50, we need to find the "x" at (1 - 0.90625) x = 1.5625.  This leads us to a theoretical peak of a progressive speed of 16.666 units per tick.  (Note that the actual empirical maximum speed, for certain reasons, is a little less than this value. But it is nevertheless close enough to the indicated indicator). <br><br>  Also note that the player has a constant maximum speed given by the code.  Even before the actual calculation of the player‚Äôs movement is performed, at the beginning of the code, the game checks whether the X- and Y-coordinates do not exceed a speed indicator of 30 units / movement ^ 2 (or less than -30).  If you exceed, the game reduces the speed to 30 (or -30, respectively).  We will not dwell on the speed limit, but you should note that this happens only before the start of the movement code and does not interfere with reaching a speed above 30 inside the movement code itself. <br><br><img src="https://habrastorage.org/files/c9e/27e/1a3/c9e27e1a36c742daa11eb5da9550d729.jpg"><br><br>  Summing up, I should note the following.  The collision box of the player is actually square, and, more importantly, the bounding box is always aligned on the coordinate axes, regardless of which path the player follows.  Later, this detail becomes very important for many things. <br><br><h4>  Strafe running </h4><br>  Another oddity of the Doom engine (as in essence and many other game engines) is that the X- and Y-coordinates are stored and calculated separately.  This leads to one small but amusing effect.  When a player moves forward and to the side at the same time, both motion vectors are used in the calculation and the direction of the general motion gets a greater magnitude than in the vectors separately. <br><br>  In a normal gameplay, Doom Streyf has a maximum driving force of 50 units, and in lateral movement - 40. Thus, with a streyfe, an indicator of driving force per tick reaches 1.25 units and a maximum speed of 13.333 units / movements.  If we consider the lateral and direct motion vectors as the sides of a right-angled triangle, you will find that the maximum theoretical velocity with a strafe is 21.34 units per motion.  And this is 28% higher than normal speed, which is not very bad. <br><br><h4>  "SR50" strafe running </h4><br>  But there is a way to move even faster.  According to some features of the code, it is possible to simultaneously hold several keys at once in such a way as to obtain a driving force when stretching 50 units, instead of 40. Thus you have the opportunity to accelerate to a maximum speed of 23.57 units / movement (that is 41% higher normal speed with normal running and 10% - with strafe running). <br><br>  Such a variety of run stretch is usually associated with the abbreviation "SR50" for rather mysterious reasons.  Professionals in speeding through the games have created various tools that are used to analyze demo versions.  And with the help of some tools you can disassemble every tick.  Actually, one of the creators was called ‚ÄúSR‚Äù - strafe right (strafe right), followed by the command argument.  Since this technique made it possible to achieve a running run with a score of 50 instead of 40, the tools showed ‚ÄúSR50‚Äù instead of ‚ÄúSR40‚Äù.  It was the ‚ÄúSR50‚Äù that became widely used as a synecdoche for this technique. <br><br>  Oh, and, so to speak, for future generations - let's calculate the maximum running speed in the "real world": <br><br>  23.57 units / movement * 35 movements / second = 825 units / second <br>  825 units / second / 16 units / foot (total conversion factor) = 51.5 feet / second <br>  51.5 feet / second = 35 miles per hour (about 56 km / hour). <br><br><h4>  Skip glide </h4><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Dx-q9xNBj1s%3Ffeature%3Doembed&amp;xid=17259,15700002,15700019,15700186,15700191,15700248,15700253&amp;usg=ALkJrhii8KWFO6YMib7y6x_hhctfj-swOA" frameborder="0" allowfullscreen=""></iframe><br><br>  <i>trick at 0:02</i> <br><br>  Now let's go to specific techniques.  The first of these is considered the most difficult to implement in practice.  But at the same time, its easiest to explain from the position of the engine.  I call this trick ‚Äúskip glide‚Äù (skipping jump), although sometimes it is also called ‚Äúbar glide‚Äù, which can create confusion because there is another trick with the same name. <br><br>  To understand this trick, you first need to disassemble the basic way in which Doom tries to process movements.  In each tick, DoomGuy has a defined x- and y-coordinates of the pulse (inertia direction).  However, I will not call this ‚Äúimpulse‚Äù, since such a term implies certain properties that Doom does not have (you can move beyond the possibilities of ‚Äúimpulse‚Äù, or vice versa, you may have an ‚Äúimpulse‚Äù even if there is no movement at all) .  Instead, I will speak about the ‚Äúimpulse‚Äù from the point of view of a potentially new position to which the player wants to go and refer to it as the ‚ÄúTeleport Attempt Position‚Äù or the SPT.  (From this point on, when you see the abbreviation ‚ÄúSPT‚Äù in the text, you can mentally replace it with ‚Äúimpulse.‚Äù But I hope the use of another term will help you remember that in reality this is not a ‚Äúreal‚Äù impulse, but some fancy pseudo- An analogue that has other properties.) <br><br>  The reason is that the player is essentially inactive during a tick.  Instead, the game simply removes the player from one point on the map and instantly puts it to another.  This kind of discrete movement is probably universal for games.  But at the same time, a reasonable question arises: how to determine that you ran into something in front of you? <br><br>  This feature helps to understand exactly how skip glide works.  Consider the canonical example of Doom 2 when passing Map 21. The player takes a completely natural position right in front of the diagonal barrier, which closes the gap.  On the next tick, the engine conducts a test to determine whether it is possible to teleport a player to a position immediately * behind * a diagonal barrier.  With careful choice of direction, you can designate a position that does not contradict the conditions of the "teleport" and the engine will transfer the player to the desired point without any problems. <br><br><h4>  Squeeze glide </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/1-7Ig-1FTiE%3Ffeature%3Doembed&amp;xid=17259,15700002,15700019,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhzPa83D4mgp3jG_XJKWOULTIKiRQ" frameborder="0" allowfullscreen=""></iframe><br><br>  <i>trick at 0:25</i> <br><br>  Also in the arsenal there is another, even more common trick, which is associated with the reception of "bar glide", because it is also based on the movement between the barriers, located at a distance of 32 units.  For me, the term ‚Äúsqueeze glide‚Äù (sliding with ‚Äúsqueezing‚Äù) seems to be more adequate for memorization and less confusing. <br><br>  For squeeze glide, the player must be perfectly aligned with a gap of the same size as the character (32 units).  Then, after a series of unsuccessful attempts, which seem to last forever, he finally manages to squeeze into this gap! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a5/f6f/9c3/7a5f6f9c3c272ecb2ef7881a181fdc0e.gif" alt="image"><br><br>  In the theory of ‚Äúsqueeze glide‚Äù it should be quite simple and clear: the player has a width of 32 units (along the axes).  And that means if you find a space that is clearly aligned along the axes and with a width of 32 units, you should be able to pass through it.  But with the Doom engine rarely everything is so simple. <br><br>  The main problem is that the motion in the Doom engine is quantized and, moreover, it is not completely quantized.  I will not go into details and tell how the player's motion vector was calculated.  But in short, the vector uses sines and cosines to combine the direction of the player with the motion vectors to match the final X and Y vectors of the driving force.  For example, when a player pushes a key forward and heads north, the X-coordinate of the motion vector should be a value multiplied by the cosine of 90, which is necessary for zeroing.  Unfortunately, Doom is not strong in saving angles and cosines, it uses calculated tables of values ‚Äã‚Äãand, as it turned out, the sine / cosine table does not actually include 0 as a value (the closest is ¬± 0.0002). <br><br>  Thus, even at the maximum approaching to the north, a quantity appears that is still too small for a side step to the east or west. <br><br>  So, knowing how SPT works for players, you can see what happens: <br><ul><li>  The player is trying to move in space directly between obstacles. </li><li>  The engine uses SPT, which has a certain quantized coefficient of elongation, and determines the possibility of moving to one or another position </li><li>  Since the gap has the same width as the player, the latter must EXACTLY match the space being traveled (inaccurate values ‚Äã‚Äãof the angle make the task really difficult).  This means that for successful passage you need with perfect accuracy of 0.0002 units to be located west of the place between obstacles. </li></ul><br>  Understanding how to make squeeze glide work smoothly is not science, but real art.  Speed-wise, hour after hour, learn the subtleties of moving to perform it in a reasonable amount of time. <br><br><h4>  Line skipping (south / west) </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/QPXX-z1fiZ0%3Ffeature%3Doembed&amp;xid=17259,15700002,15700019,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiUlE0q2VqviSRs4TPEEzItnLizMg" frameborder="0" allowfullscreen=""></iframe><br><br>  <i>trick at 19:06</i> <br><br>  Understanding how the engine uses SPT players to test a new position will only bring us a little closer to understanding the line skip.  It may seem that the player does the impossible when he performs a line skip: runs directly across the border line without actually activating it. <br><br>  To understand how this works, you need to look at the order of events in the engine: <br><ul><li>  He uses the SPT player to test him in a potentially new position. </li><li>  As part of the process, the engine makes a list of any overlap of a segment of a potentially new position. </li><li>  If possible, move them to the position in question. <br></li><li>  It draws the connecting line between the centers of the old and new player positions, and then checks each boundary in the already compiled list to see if the connection line crosses one of them. </li><li>  If it crosses, checks these lines for special actions with their further activation. </li></ul><br>  Thus, as you can see, there are two possibilities for crossing the special boundary line: 1) touching the boundary line at the updated position, and 2) the border intersects with the line connecting the old and updated positions. <br><br>  So, the algorithm is set.  How can you get around it?  Somehow like this. <br><br>  Tick ‚Äã‚Äã1: SPT of players seeks to move them to the point where their center practically, but still not quite, crosses the border. <br>  Tick ‚Äã‚Äã1: the engine determines that this new point touches the border and adds it to the list <br>  Tick ‚Äã‚Äã1: after a successful move, the engine throws the intersection line, but it does not cross the border, so it does not matter <br>  Tick ‚Äã‚Äã2: SPT of players moves them far enough, so that they move entirely * beyond * the border line and no longer touch it <br>  Tick ‚Äã‚Äã2: the special boundary line is not even in the new compiled list of crossed borders, as a result of which it cannot be activated. <br><br>  So you see that while you are moving faster than half the player's width per tick (having a good location and a bit of luck), it‚Äôs not unbelievable to slip the border line without activating its special actions.  However, remember that the player's bounding box is always aligned with reference to the coordinate axes.  In other words, this technique is easier to perform along the axes, where the player‚Äôs radius is 16 units.  However, even diagonally at 45 degrees, where the player‚Äôs radius is 22.6 units, the SR50 run with his 23+ units per move is still done. <br><br>  I want to draw your attention to the fact that the above describes only the movement to the "south / west."  For reasons that we have not yet discussed, this trick WILL NOT WORK when moving north or east. <br><br><h4>  Item bumping </h4><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/EIzvocAt6W8%3Ffeature%3Doembed&amp;xid=17259,15700002,15700019,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjECSgPQT3Om0hj2lXX-F-_E6J8mA" frameborder="0" allowfullscreen=""></iframe><br><br>  <i>trick at 0:16</i> <br><br>  Here is another absurdity that occurs because of Doom‚Äôs strange and bizarre testing of a potentially new player position.  The algorithm is built as follows: <br><ul><li>  Used SPT player to determine a potential new position. </li><li>  Checks if there are any obstacles in the landing zone in order to occupy this point. </li><li>  At the same time, a check is made for the presence of any other things that overlap the landing zone. <br></li><li>  And also, if one of these things can be reached, the player picks them up </li></ul><br>  Do you see the problem?  The player will take things concerning the potential SPT landing zone, even if the movement does not ultimately occur.  This means that if you rush at full speed to an impassable border with an object located directly on the other side of it, the engine (at the time of the collision with the border) will attempt to move the player (SPT) to the other side of the wall.  This will give the opportunity to pick up any things that will fall on the site of a potential landing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/866/583/75f/86658375fe2c8d7dfee8c94aa4b97229.gif" alt="image"><br><br><h4>  Monsters opening doors </h4><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/W73VgN-J0kk%3Ffeature%3Doembed&amp;xid=17259,15700002,15700019,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhme5m2RRipFgHBHcyKKSeFkvjIWg" frameborder="0" allowfullscreen=""></iframe><br><br>  <i>trick at 0:09</i> <br><br>  Despite the fact that this paragraph does not apply to the direct movement of the player, it is still remarkable and is largely guided by the same principles.  For the most part, the engine considers the movement of a monster identical to that of a player.  In other words, the SPT tracks the monster, and then uses this SPT to test a potential landing zone for further movement of the monster. <br><br>  In this case, the reception is triggered if the door was created in a way where one side, for example, is locked with a key, and the other side is a ‚Äúnormal‚Äù door.  While the fast monster (like the archvile) passes near the door, its huge SPT indicates the engine‚Äôs attempts to place this monster at a considerable distance from the unclosed side of the door.  And so the monster is able to open it. </div><p>Source: <a href="https://habr.com/ru/post/306556/">https://habr.com/ru/post/306556/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306544/index.html">Universal https using GOST certificate</a></li>
<li><a href="../306548/index.html">Distributed execution of Python tasks using Apache Mesos. Yandex experience</a></li>
<li><a href="../306550/index.html">JavaScript in 2016: functional programming has come seriously and for a long time</a></li>
<li><a href="../306552/index.html">Features of application promotion in the CIS, in Western markets and in Asia</a></li>
<li><a href="../306554/index.html">How to optimize the game using polygonal atlases</a></li>
<li><a href="../306558/index.html">Is it beneficial for Apple to be an ally of Google in the fight for the online advertising market?</a></li>
<li><a href="../306560/index.html">Cloud storage: new API functions</a></li>
<li><a href="../306562/index.html">The story ‚ÄúNIICHOSHI. Duty night "</a></li>
<li><a href="../306564/index.html">Ruby Ecosystem (on Rails) with a bitter aftertaste, or ‚ÄúHow we love to poke PHP‚Äù</a></li>
<li><a href="../306566/index.html">How we made the converter and player for CinemaDNG to CUDA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>