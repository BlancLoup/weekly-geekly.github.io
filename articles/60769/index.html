<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The course of the young fighter: defended by the router. Continued: IPS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intrusion Prevention System (IPS). 

 In general, the line of products on the intrusion prevention system of cisco is quite wide. These include the st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The course of the young fighter: defended by the router. Continued: IPS</h1><div class="post__text post__text-html js-mediator-article">  <b>Intrusion Prevention System (IPS).</b> <br><br>  In general, the line of products on the intrusion prevention system of cisco is quite wide.  These include the standalone IPS 42XX series sensors, the 6500 module - IDSM2, the module in ASA - AIP-SSM, the module in the router (ISR) - NME-IPS, the "card" in the ISR - AIM-IPS.  The tsiska tries to bring the same ideology into software solutions based on ISR, adding the corresponding functionality to IOS. <br><br>  The whole ideology of intrusion detection and prevention is based on the concept of a signature.  A signature is essentially a ‚Äúwrong‚Äù pattern in one package or stream. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚ÄúIrregularities‚Äù are different, ranging from typical intelligence methods to network worms.  These templates are carefully written by tsisk programmers and reach the user in the form of updates.  Those.  the system is reactive in its essence and is based on constant updates that cost money.  Licenses for updates are tied to each piece of hardware directly.  Without a license, you can change the OS, but you can not roll up signature updates. <br><br>  <b>A little history of intrusion detection and prevention systems based on routers.</b> <br><a name="habracut"></a><br>  The first IDS (Intrusion Detection System) system was implemented on IOS 12.2.8T routers with a firewall feature set.  Then these were the 26XX and 36XX routers.  The system consisted of several dozen (maximum 105) signatures.  They could only be disabled or set to not work for all traffic. <br><br>  This system was activated by the teams. <br><br>  <i>ip audit name IDS attack action {alarm, drop, reset}</i> <i><br></i>  <i>ip audit name IDS info action {alarm, drop, reset}</i> <i><br><br></i>  <i>int f0 / 0</i> <i><br></i>  <i>ip audit IDS {in | out}</i> <i><br></i> <br><br>  It was a thing in itself.  No agile customization, no updates, no clue about what is in the signatures. <br><br>  The next step was made with the introduction of a separate signature definition file.  This special file was loaded onto the router, it was pointed out in the configuration, it contained all the signatures and their parameters.  This construction was configured as follows: <br><br>  <i>ip ips sdf location flash: {256MB.sdf | 128MB.sdf | attack-drop.sdf}</i> <br><br>  The file is selected based on the amount of RAM on the router.  The largest file - 256MB.sdf - contained more than 1500 signatures and required at least 256 megabytes of RAM <br><br>  <i>ip ips name IPS</i> <i><br><br></i>  <i>int f0 / 0</i> <i><br></i>  <i>ip ips ips {in | out}</i> <i><br></i> <br>  After attaching the IPS rules to the interface, the tsiska loaded the signatures from the file into memory and made it possible to configure them both via the console and via the web GUI (by the way, the GUI called Security Device Manager, SDM, is very convenient when setting up IPS) <br><br>  For backwards compatibility in IOSs (up to 12.4.T (11)), embedded signatures remained.  When using an external file, it was recommended to disable them. <br><br>  <i>no ip ips sdf builtin</i> <i><br></i> <br>  It was possible to demand that traffic be blocked if it is impossible to load the sdf file or if the IPS subsystem failed <br><br>  <i>ip ips fail close</i> <i><br></i> <br>  But the format of the signatures here was the same as in the sensors of IPS version 4. This format did not allow deeper analysis of traffic and cut off new tricky attacks.  On the IPS sensors themselves, a new format appeared by that time - 5, in which you can adjust the accumulative parameters of the risk of attack (Risk Rating), create zones of closer attention (Target Value Rating) and much more. <br><br>  Therefore, since version 12.4.T (11), the old format is no longer supported, updates of format 4 signatures ceased in August 2008. <br><br>  To switch to a new format and flexibly protect the network using the IPS system, you must now load another file. <br>  <b>IOS-S ### - CLI.pkg</b> <br>  in which the encrypted actual signatures and their parameters are stored.  Number ### is constantly increasing, updates need to be constantly uploaded.  By the way, this can be done automatically with the command <br><br>  <i>ip ips auto-update</i> <i><br></i> <br>  Next, you need to install a cisco key on the router to decrypt (or rather, verify the digital signature) the downloaded file <br><br>  We do this: <br><br>  <i>crypto key pubkey-chain rsa</i> <i><br><br></i>  <i>named-key realm-cisco.pub signature</i> <i><br><br></i>  <i>key-string</i> <i><br></i>  <i>30820122 300D0609 2A864886 F70D0101 01050003 82010F00 3082010A 02820101</i> <i><br></i>  <i>00C19E93 A8AF124A D6CC7A24 5097A975 206BE3A2 06FBA13F 6F12CB5B 4E441F16</i> <i><br></i>  <i>17E630D5 C02AC252 912BE27F 37FDD9C8 11FC7AF7 DCDD81D9 43CDABC3 6007D128</i> <i><br></i>  <i>B199ABCB D34ED0F9 085FADC1 359C189E F30AF10A C0EFB624 7E0764BF 3E53053E</i> <i><br></i>  <i>5B2146A9 D7A5EDE3 0298AF03 DED7A5B8 9479039D 20F30663 9AC64B93 C0112A35</i> <i><br></i>  <i>FE3F0C87 89BCB7BB 994AE74C FA9E481D F65875D6 85EAF974 6D9CC8E3 F0B08B85</i> <i><br></i>  <i>50437722 FFBE85B9 5E4189FF CC189CB9 69C46F9C A84DFBA5 7A0AF99E AD768C36</i> <i><br></i>  <i>006CF498 079F88F8 A3B3FB1F 9FB7B3CB 5539E1D1 9693CCBB 551F78D2 892356AE</i> <i><br></i>  <i>2F56D826 8918EF3C 80CA4F4D 87BFCA3B BFF668E9 689782A5 CF31CB6E B4B094D3</i> <i><br></i>  <i>F3020301 0001</i> <i><br></i>  <i>quit</i> <i><br><br></i>  These commands can simply be driven into the mode <br>  Ro (config) # <br>  copy-paste  The key is one for all. <br><br>  It is advisable to create a separate folder in the router‚Äôs flash for IPS files. <br><br>  <i>Ro # mkdir flash: / IPS</i> <i><br></i> <br>  There you need to copy the file IOS-S ### - CLI.pkg, and also indicate that it will store the necessary files for work <br><br>  <i>Ro (config) # ip ips config location flash: / IPS /</i> <br><br>  Now it remains to install these most necessary files.  This is done by a tricky team. <br><br>  <i>Ro # copy flash: / IPS / IOS-S ### - CLI.pkg idconf</i> <br><br>  This procedure will take significant time (a few minutes) and you will see the results in the flash <br><br>  21 0 May 27 2009 14:22:58 +04: 00 IPS <br>  22 8662169 May 27 2009 14:24:22 +04: 00 IPS / IOS-S399-CLI.pkg <br>  23 284871 May 28 2009 22:48:00 +04: 00 IPS / ccmt-2811-sigdef-default.xml <br>  24 255 May 27 2009 16:35:56 +04: 00 IPS / ccmt-2811-sigdef-delta.xml <br>  25 34761 May 28 2009 22:43:44 +04: 00 IPS / ccmt-2811-sigdef-category.xml <br>  26 304 May 27 2009 16:35:56 +04: 00 IPS / ccmt-2811-seap-delta.xml <br>  27 8509 May 28 2009 22:43:40 +04: 00 IPS / ccmt-2811-sigdef-typedef.xml <br>  28 491 May 27 2009 17:05:00 +04: 00 IPS / ccmt-2811-seap-typedef.xml <br><br>  These xml files contain default settings, your changes, blocking parameters, etc. <br><br>  Almost everything.  You just need to create a rule and hang it on the interface, as it was done before: <br><br>  <i>ip ips name IPS</i> <i><br><br></i>  <i>int f0 / 0</i> <i><br></i>  <i>ip ips ips {in | out}</i> <i><br><br></i>  After that, the signatures will be loaded into memory, and those that are enabled by default will immediately begin to work. <br><br>  Remember that many signatures, they eat a lot of memory and processor, so the tsiska strongly recommends that you do the following. <br><br>  1. Disable signature category all <br><br>  <i>Ro (config) # ip ips signature-category</i> <i><br></i>  <i>Ro (config-ips-category) # category all</i> <i><br></i>  <i>Ro (config-ips-category-action) # retired true</i> <i><br></i> <br>  2. Include for starters a category designed for IOS, and in the basic version <br><br>  <i>Ro (config) # ip ips signature-category</i> <i><br></i>  <i>Ro (config-ips-category) # category ios_ips basic</i> <i><br></i>  <i>Ro (config-ips-category-action) # retired false</i> <i><br></i>  <i>Ro (config-ips-category-action) # enabled true</i> <i><br><br></i>  The config is updated after exiting back to the mode (config) # <br><br>  3. Further, following the memory and CPU usage, you can add other categories of signatures.  Setting the signatures themselves is possible as a console from the mode <br><br>  <i>ip ips signature-definition</i> <br><br>  so through SDM or newer WEB-GUI - CCE (Cisco Configuration Expert) <br><br>  The parameters and the signature setting mechanism are as close as possible to the settings on the sensors, so if you have experience in setting up AIP-SSM, 42XX or IDMS2 sensors, you can safely get down to business.  If there is no such experience, it is better to read about signature configuration.  Or go to the course IPS 6.0 :) <br><br><h5>  To be continued... </h5></div><p>Source: <a href="https://habr.com/ru/post/60769/">https://habr.com/ru/post/60769/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../60757/index.html">Data URI [CSS] Sprites 1.1 - Automate the process of assembling css sprites</a></li>
<li><a href="../60759/index.html">GoogleApps + Postfix + Fetchmail (preparation)</a></li>
<li><a href="../60763/index.html">GiftWrap 0.1 released</a></li>
<li><a href="../60766/index.html">How to become an "early bird" (Part II)</a></li>
<li><a href="../60767/index.html">BDD practice example when working with Specter Framework</a></li>
<li><a href="../60772/index.html">12 minutes of ghost hunting</a></li>
<li><a href="../60777/index.html">Where is better: in a large company or in a small one?</a></li>
<li><a href="../60779/index.html">Job in Moscow</a></li>
<li><a href="../60780/index.html">Excursion to nic.lv - continuation of the topic of ‚Äúdomain theft‚Äù</a></li>
<li><a href="../60782/index.html">Face Detection on Java is easy!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>