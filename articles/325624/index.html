<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>13 years of bad code in games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On a solitary Friday night in search of inspiration, you decide to recall your past victories on the programmer front. The archive from the old hard d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>13 years of bad code in games</h1><div class="post__text post__text-html js-mediator-article">  On a solitary Friday night in search of inspiration, you decide to recall your past victories on the programmer front.  The archive from the old hard drive slowly opens and now the code of the glorious distant times unfolds before you ... <br><br>  Oh no.  This is not what you expected to see.  Is it true that everything was so bad?  Why didn't anyone tell you?  How was it possible to go so far?  Such a number of go-to operators in a single function - is this generally legal?  You hastily close the project.  For a second, you are tempted to delete the file, and all the contents of the hard drive at the same time. <br><br><img src="https://habrastorage.org/files/b8d/12d/aeb/b8d12daeb29f42f895555c26da49f11f.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below you will find a collection of lessons, instructive examples and warnings that I have taken from my own journey into the past.  All names are given without change to expose the perpetrators. <br><a name="habracut"></a><br><h3>  2004 </h3><br>  I was thirteen years old.  The project called ‚Äú <a href="https://www.youtube.com/watch%3Fv%3DwsnY0JrjbDM">Red Moon</a> ‚Äù was a very ambitious game about third-person air battles.  Those few code fragments that I did not copy a symbol into a symbol from the ‚Äú <a href="https://www.amazon.com/Developing-Games-Java-David-Brackeen/dp/1592730051">Developing Games in Java</a> ‚Äù manual were a disgrace.  Let's see concrete examples. <br><br>  I wanted the players to have several weapon options and the ability to choose.  In the plans, it all looked like this: the weapon model moves down and inside the player model, replaced with the next one, and so on.  Here is the animation code.  Better not much to understand. <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateAnimation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eTime)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(group.getGroup(<span class="hljs-string"><span class="hljs-string">"gun"</span></span>) == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { group.addGroup((PolygonGroup)gun.clone()); } changeTime -= eTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(changing &amp;&amp; changeTime &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { group.removeGroup(<span class="hljs-string"><span class="hljs-string">"gun"</span></span>); group.addGroup((PolygonGroup)gun.clone()); weaponGroup = group.getGroup(<span class="hljs-string"><span class="hljs-string">"gun"</span></span>); weaponGroup.xform.velocityAngleX.set(.<span class="hljs-number"><span class="hljs-number">003f</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); changing = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br>  I would like to draw your attention to a couple of interesting facts.  First, estimate how many variables are here: <br><br><ul><li>  changeTime </li><li>  changing </li><li>  weaponGroup </li><li>  weaponGroup.xform.velocityAngleX </li></ul><br>  But with all this, something seemed to be lacking ... oh yeah, we also need a variable to keep track of which weapon is in use at the moment.  And, of course, this requires a separate file. <br><br>  And one more thing: in the end, I was not going to make more than one model of weapon.  That is, the same model was used for each of these types.  From all this code there was absolutely no proc. <br><br><h4>  How to fix it </h4><br>  Remove unnecessary variables.  In this case, the state of the weapon could be described with only two: weaponSwitchTimer and weaponCurrent.  All other information could be extracted from them. <br><br>  Explicitly initialize everything you can.  This function checks whether the weapon is null and, if necessary, starts the initialization process.  After thinking for at least thirty seconds, I could figure out that in this game the user always has some kind of weapon, and if not, then it is simply impossible to play and it is possible with a clear conscience to crash the entire program. <br><br>  Obviously, at some point I ran into a NullPointerException in this function, but instead of wondering where it came from, I quickly checked for a null value, and this ended the matter. <br><br>  Take the initiative and make decisions yourself!  Do not let your computer figure it out. <br><br><h4>  Titles </h4><br><pre> <code class="cpp hljs">boolean noenemies = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// why oh why</span></span></code> </pre> <br>  Call variables of type Boolean without using negation.  If you are writing something like this in the code, then it‚Äôs time to rethink your approach to life: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!noenemies) { <span class="hljs-comment"><span class="hljs-comment">// are there enemies or not?? }</span></span></code> </pre> <br><h4>  Error processing </h4><br>  Similar things come across in the code all the time: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { gun = Resources.parseModel(<span class="hljs-string"><span class="hljs-string">"images/gun.txt"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException e) {} <span class="hljs-comment"><span class="hljs-comment">// *shrug* catch (IOException e) {} }</span></span></code> </pre> <br>  You probably are thinking now: ‚ÄúWe need to handle this error in a more elegant way!  Well, at least a message to the user to withdraw or something like that. ‚Äù  But I, frankly, hold the opposite point of view. <br><br>  Eliminating errors is really never superfluous, but with the processing you can easily overdo it.  In this case, it is still impossible to play without a weapon model, so you can just as well crash the game.  Do not try with dignity to get out of the situation, if it is obviously hopeless. <br><br>  In addition, returning to the above, here you need to independently decide which errors to consider as correctable and which ones should not be.  Unfortunately, Sun believes that almost all errors in Java simply have to be fixed, and as a result we have cases of lazy processing - one of them is given above. <br><br><h3>  2005-2006 </h3><br>  By this time I had already mastered C ++ and DirectX.  I decided to create a reusable engine so that humanity could safely fall into a storehouse of wisdom and experience that I had accumulated during my long fourteen-year life. <br><br>  Do you think it was painful to watch the first trailer?  <a href="https://www.youtube.com/watch%3Fv%3DkAYWx1K_YlM">You have not seen anything yet</a> . <br><br>  At that time, I already knew that object-oriented programming is awesome.  This knowledge led to horrors of this kind: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mesh</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;Mesh*&gt; meshes; <span class="hljs-comment"><span class="hljs-comment">// Static list of meshes; used for caching and rendering Mesh(LPCSTR file); // Loads the x file specified Mesh(); Mesh(const Mesh&amp; vMesh); ~Mesh(); void LoadMesh(LPCSTR xfile); // Loads the x file specified void DrawSubset(DWORD index); // Draws the specified subset of the mesh DWORD GetNumFaces(); // Returns the number of faces (triangles) in the mesh DWORD GetNumVertices(); // Returns the number of vertices (points) in the mesh DWORD GetFVF(); // Returns the Flexible Vertex Format of the mesh int GetNumSubsets(); // Returns the number of subsets (materials) in the mesh Transform transform; // World transform std::vector&lt;Material&gt;* GetMaterials(); // Gets the list of materials in this mesh std::vector&lt;Cell*&gt;* GetCells(); // Gets the list of cells this mesh is inside D3DXVECTOR3 GetCenter(); // Gets the center of the mesh float GetRadius(); // Gets the distance from the center to the outermost vertex of the mesh bool IsAlpha(); // Returns true if this mesh has alpha information bool IsTranslucent(); // Returns true if this mesh needs access to the back buffer void AddCell(Cell* cell); // Adds a cell to the list of cells this mesh is inside void ClearCells(); // Clears the list of cells this mesh is inside protected: ID3DXMesh* d3dmesh; // Actual mesh data LPCSTR filename; // Mesh file name; used for caching DWORD numSubsets; // Number of subsets (materials) in the mesh std::vector&lt;Material&gt; materials; // List of materials; loaded from X file std::vector&lt;Cell*&gt; cells; // List of cells this mesh is inside D3DXVECTOR3 center; // The center of the mesh float radius; // The distance from the center to the outermost vertex of the mesh bool alpha; // True if this mesh has alpha information bool translucent; // True if this mesh needs access to the back buffer void SetTo(Mesh* mesh); }</span></span></code> </pre> <br>  In addition, I learned that comments are awesome, and this made me leave words like: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">D3DXVECTOR3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCenter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// Gets the center of the mesh</span></span></code> </pre> <br>  However, there are more serious problems with this class.  The Mesh concept is a kind of hazy abstraction that cannot be matched with the equivalent of reality.  Even when I wrote it, I did not understand anything.  What is it - a container that contains vertices, indices and other data?  A resource manager that loads and uploads data to disk?  What are the rendering tools that the data sends to the GPU?  All at once. <br><br><h4>  How to fix it </h4><br>  The Mesh class must be a simple data structure.  It should not be smart types.  And this means that you can throw out all the getters and setters with peace of mind and make all the fields public. <br><br>  Next, you can separate the resource management and rendering into separate systems that work with inert data.  Yes, it is systems, not objects.  Do not try to tailor each problem to an object-oriented abstraction if another type of abstraction may be better suited. <br><br>  The surest way to correct comments is to delete them, as a rule.  Comments quickly become irrelevant white noise, which only confuses - the compiler does not look at them anyway.  I insist that comments should be disposed of unless they belong to one of the following groups: <br><br><ul><li>  Comments that answer the question ‚Äúwhy?‚Äù And not ‚Äúwhat?‚Äù.  From them the most confusing. </li><li>  Comments that describe in a few words what makes a huge piece of code that follows.  They facilitate the process of reading and navigation; </li><li>  Comments in the data structure declaration explaining what each field contains.  Often they are superfluous, but in some cases it is not intuitive to understand how the structure is located in memory, and then comments with a similar description are necessary. </li></ul><br><h3>  2007-2008 </h3><br>  This period of my life I call the ‚Äúdark ages of PHP‚Äù. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a1d/548/59e/a1d54859e6ca462aadcb12a9f01022dc.png"></div><br><h3>  2009-2010 </h3><br>  I'm already in college.  I am working on a third-person Python multiplayer shooter called Acquire, Attack, Asplode, Pwn.  I can not say anything in my defense.  Still more shameful, only now with a spicy aftertaste of copyright infringement. <br><br>  When I wrote this game, I was just enlightened that global variables are evil.  They turn code into a jumble.  They allow function A, changing the global state, to break / violate function B, which has nothing to do with it.  They do not work with threads. <br><br>  However, almost the entire gameplay code requires access to the state of the world matrix entirely.  I ‚Äúsolved‚Äù this problem by saving everything in this object and transferring it to each of the functions.  And no global variables for you!  It seemed to me that I had a great idea, because it turns out that in theory you can run several autonomous world matrices at the same time. <br><br>  In fact, the world, in fact, was a container of a global state.  The concept with several world was, of course, completely meaningless, no one ever tested it, and I strongly suspect that it could work only if it was seriously refactored. <br>  Those who enter into a sect of opponents of global variables are discovering a whole world of creative methods of self-deception.  The worst of them is singleton. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Instance</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(i == null)</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class">; } } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">thing</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Instance</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">;</span></span></code> </pre> <br>  Krible krable booms!  Not a single global variable in sight!  But there is one ‚Äúbut‚Äù: singleton is much worse for the following reasons: <br><br><ul><li>  All potential flaws of global variables persist here.  If you think that singleton is not global, then stop lying to yourself; </li><li>  At best, singleton adds a resource-intensive branching operator to your program.  At worst, this is a full function call; </li><li>  Until you start the program, it is not known when singleton is initialized.  This is another example of how lazy programmers let the system decide what they should have planned at the design stage. </li></ul><br><h4>  How to fix it </h4><br>  If something should be global, let it be.  When making this decision, consider how it will affect the project as a whole.  With experience, it becomes easier. <br><br>  The problem, in fact, lies in the interdependencies in the code.  Global variables can lead to invisible dependencies between fragmented code fragments.  Group related pieces of code into a complete system to minimize these invisible dependencies.  A good way to achieve this is to drop everything that relates to one system into a single thread and force the rest of the code to interact with it through messages. <br><br><h4>  Boolean Type Parameters </h4><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectEntity</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, killed, local)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... if killed: # ... if local: # ...</span></span></code> </pre> <br>  Perhaps you had to write code like this: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectEntity</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, killed, local)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... if killed: # ... if local: # ...</span></span></code> </pre> <br>  Here we have four separate delete operations that are very similar to each other - all minor differences are tied to two Boolean type parameters.  It seems to be all logical.  And now let's look at the client code that calls this function: <br><br><pre> <code class="python hljs">obj.delete(<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre> <br>  It doesn't look particularly readable, does it? <br><br><h4>  How to fix it </h4><br>  Here you need to look at a specific case.  But there is one <a href="https://mollyrocket.com/casey/index.html">piece of</a> advice from <a href="https://mollyrocket.com/casey/index.html">Casey Muratori</a> , which is always relevant: start with client code.  I am convinced that no person in his mind will write such a client code as mentioned above.  Rather, it will write the following: <br><br><pre> <code class="python hljs">obj.killLocal()</code> </pre> <br>  And then he will register the implementation of the killLocal () function. <br><br><h4>  Titles </h4><br>  It may seem strange that I am pushing on the names so much, but, as the old joke says, this is one of two unresolved programming problems (the second is invalidation of the cache and an error by one). <br><br>  Take a close look at these features: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TeamEntityController</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Controller)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildSpawnPacket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def readSpawnPacket(self): # ... def serverUpdate(self): # ... def clientUpdate(self): # ...</span></span></code> </pre> <br>  It is clear that the first two functions are interconnected, just like the last two.  But their names do not indicate this fact.  If I start typing self in the IDE, these functions will not appear one after another in the autocomplete menu. <br><br>  Accordingly, it is better to start the name with a general, and finish privately.  Like this: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TeamEntityController</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Controller)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packetSpawnBuild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def packetSpawnRead(self): # ... def updateServer(self): # ... def updateClient(self): # ...</span></span></code> </pre> <br>  With this code, the autofill menu will look much more logical. <br><br><h3>  2010-2015 </h3><br>  Some 12 years of work - <a href="https://www.youtube.com/watch%3Fv%3D1ox5cwNVqtQ">and I finished the game</a> .  Suppose I learned a lot in the process, in the final version there were still serious punctures. <br><br><h4>  Data binding </h4><br>  At that time, the fever of reactive UI frameworks such as Microsoft‚Äôs MVVM and Google‚Äôs Angular UI was just beginning.  Today, this programming style is preserved mainly in React. <br><br>  All these frameworks work according to the same scheme.  You see a text field for HTML, an empty element and a single line of code that inextricably links them.  Enter text in the field - and voila!  magically updated. <br><br>  In the context of the game, it will look something like this: <br><br><pre> <code class="python hljs">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Property</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Name</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Property</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Value</span></span></span><span class="hljs-class"> = "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ryu</span></span></span><span class="hljs-class">" }; } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextElement</span></span></span><span class="hljs-class"> :</span></span> UIComponent { public Property&lt;string&gt; Text = new Property&lt;string&gt; { Value = <span class="hljs-string"><span class="hljs-string">""</span></span> }; } label.add(new Binding&lt;string&gt;(label.Text, player.Name));</code> </pre> <br>  Wow, the interface is now automatically updated when you enter the player's name!  The interface and code of the game can be completely independent of each other.  This is tempting: we get rid of the state of the interface, taking it out of the state of the game. <br><br>  However, there were some alarm bells.  I had to turn each field in the game into a Propert-object, which included a number of dependent links. <br><br><pre> <code class="python hljs">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Property</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class">&gt; :</span></span> IProperty { protected Type _value; protected List&lt;IPropertyBinding&gt; bindings; public Type Value { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this._value; } set { this._value = value; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = this.bindings.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; i = Math.Min(this.bindings.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>, i - <span class="hljs-number"><span class="hljs-number">1</span></span>)) this.bindings[i].OnChanged(this); } } }</code> </pre> <br>  Absolutely behind each field, down to the last Boolean, a bulky dynamic array was assigned. <br><br>  Take a look at the cycle that notifies the associated data of a property change, and you will immediately understand what problems I ran into because of this paradigm.  It has to iterate the list of related data in the reverse order, since the binding can add or remove interface elements, which leads to changes in the list. <br><br>  However, I was so imbued with data binding that I built the whole game on it.  I have broken objects into components and related their properties.  The situation began to spin out of control. <br><br><pre> <code class="python hljs">jump.Add(new Binding&lt;bool&gt;(jump.Crouched, player.Character.Crouched)); jump.Add(new TwoWayBinding&lt;bool&gt;(player.Character.IsSupported, jump.IsSupported)); jump.Add(new TwoWayBinding&lt;bool&gt;(player.Character.HasTraction, jump.HasTraction)); jump.Add(new TwoWayBinding&lt;Vector3&gt;(player.Character.LinearVelocity, jump.LinearVelocity)); jump.Add(new TwoWayBinding&lt;BEPUphysics.Entities.Entity&gt;(jump.SupportEntity, player.Character.SupportEntity)); jump.Add(new TwoWayBinding&lt;Vector3&gt;(jump.SupportVelocity, player.Character.SupportVelocity)); jump.Add(new Binding&lt;Vector2&gt;(jump.AbsoluteMovementDirection, player.Character.MovementDirection)); jump.Add(new Binding&lt;WallRun.State&gt;(jump.WallRunState, wallRun.CurrentState)); jump.Add(new Binding&lt;float&gt;(jump.Rotation, rotation.Rotation)); jump.Add(new Binding&lt;Vector3&gt;(jump.Position, transform.Position)); jump.Add(new Binding&lt;Vector3&gt;(jump.FloorPosition, floor)); jump.Add(new Binding&lt;float&gt;(jump.MaxSpeed, player.Character.MaxSpeed)); jump.Add(new Binding&lt;float&gt;(jump.JumpSpeed, player.Character.JumpSpeed)); jump.Add(new Binding&lt;float&gt;(jump.Mass, player.Character.Mass)); jump.Add(new Binding&lt;float&gt;(jump.LastRollKickEnded, rollKickSlide.LastRollKickEnded)); jump.Add(new Binding&lt;Voxel&gt;(jump.WallRunMap, wallRun.WallRunVoxel)); jump.Add(new Binding&lt;Direction&gt;(jump.WallDirection, wallRun.WallDirection)); jump.Add(new CommandBinding&lt;Voxel, Voxel.Coord, Direction&gt;(jump.WalkedOn, footsteps.WalkedOn)); jump.Add(new CommandBinding(jump.DeactivateWallRun, (Action)wallRun.Deactivate)); jump.FallDamage = fallDamage; jump.Predictor = predictor; jump.Bind(model); jump.Add(new TwoWayBinding&lt;Voxel&gt;(wallRun.LastWallRunMap, jump.LastWallRunMap)); jump.Add(new TwoWayBinding&lt;Direction&gt;(wallRun.LastWallDirection, jump.LastWallDirection)); jump.Add(new TwoWayBinding&lt;bool&gt;(rollKickSlide.CanKick, jump.CanKick)); jump.Add(new TwoWayBinding&lt;float&gt;(player.Character.LastSupportedSpeed, jump.LastSupportedSpeed)); wallRun.Add(new Binding&lt;bool&gt;(wallRun.IsSwimming, player.Character.IsSwimming)); wallRun.Add(new TwoWayBinding&lt;Vector3&gt;(player.Character.LinearVelocity, wallRun.LinearVelocity)); wallRun.Add(new TwoWayBinding&lt;Vector3&gt;(transform.Position, wallRun.Position)); wallRun.Add(new TwoWayBinding&lt;bool&gt;(player.Character.IsSupported, wallRun.IsSupported)); wallRun.Add(new CommandBinding(wallRun.LockRotation, (Action)rotation.Lock)); wallRun.Add(new CommandBinding&lt;float&gt;(wallRun.UpdateLockedRotation, rotation.UpdateLockedRotation)); vault.Add(new CommandBinding(wallRun.Vault, delegate() { vault.Go(true); })); wallRun.Predictor = predictor; wallRun.Add(new Binding&lt;float&gt;(wallRun.Height, player.Character.Height)); wallRun.Add(new Binding&lt;float&gt;(wallRun.JumpSpeed, player.Character.JumpSpeed)); wallRun.Add(new Binding&lt;float&gt;(wallRun.MaxSpeed, player.Character.MaxSpeed)); wallRun.Add(new TwoWayBinding&lt;float&gt;(rotation.Rotation, wallRun.Rotation)); wallRun.Add(new TwoWayBinding&lt;bool&gt;(player.Character.AllowUncrouch, wallRun.AllowUncrouch)); wallRun.Add(new TwoWayBinding&lt;bool&gt;(player.Character.HasTraction, wallRun.HasTraction)); wallRun.Add(new Binding&lt;float&gt;(wallRun.LastWallJump, jump.LastWallJump)); wallRun.Add(new Binding&lt;float&gt;(player.Character.LastSupportedSpeed, wallRun.LastSupportedSpeed)); player.Add(new Binding&lt;WallRun.State&gt;(player.Character.WallRunState, wallRun.CurrentState)); input.Bind(rollKickSlide.RollKickButton, settings.RollKick); rollKickSlide.Add(new Binding&lt;bool&gt;(rollKickSlide.EnableCrouch, player.EnableCrouch)); rollKickSlide.Add(new Binding&lt;float&gt;(rollKickSlide.Rotation, rotation.Rotation)); rollKickSlide.Add(new Binding&lt;bool&gt;(rollKickSlide.IsSwimming, player.Character.IsSwimming)); rollKickSlide.Add(new Binding&lt;bool&gt;(rollKickSlide.IsSupported, player.Character.IsSupported)); rollKickSlide.Add(new Binding&lt;Vector3&gt;(rollKickSlide.FloorPosition, floor)); rollKickSlide.Add(new Binding&lt;float&gt;(rollKickSlide.Height, player.Character.Height)); rollKickSlide.Add(new Binding&lt;float&gt;(rollKickSlide.MaxSpeed, player.Character.MaxSpeed)); rollKickSlide.Add(new Binding&lt;float&gt;(rollKickSlide.JumpSpeed, player.Character.JumpSpeed)); rollKickSlide.Add(new Binding&lt;Vector3&gt;(rollKickSlide.SupportVelocity, player.Character.SupportVelocity)); rollKickSlide.Add(new TwoWayBinding&lt;bool&gt;(wallRun.EnableEnhancedWallRun, rollKickSlide.EnableEnhancedRollSlide)); rollKickSlide.Add(new TwoWayBinding&lt;bool&gt;(player.Character.AllowUncrouch, rollKickSlide.AllowUncrouch)); rollKickSlide.Add(new TwoWayBinding&lt;bool&gt;(player.Character.Crouched, rollKickSlide.Crouched)); rollKickSlide.Add(new TwoWayBinding&lt;bool&gt;(player.Character.EnableWalking, rollKickSlide.EnableWalking)); rollKickSlide.Add(new TwoWayBinding&lt;Vector3&gt;(player.Character.LinearVelocity, rollKickSlide.LinearVelocity)); rollKickSlide.Add(new TwoWayBinding&lt;Vector3&gt;(transform.Position, rollKickSlide.Position)); rollKickSlide.Predictor = predictor; rollKickSlide.Bind(model); rollKickSlide.VoxelTools = voxelTools; rollKickSlide.Add(new CommandBinding(rollKickSlide.DeactivateWallRun, (Action)wallRun.Deactivate)); rollKickSlide.Add(new CommandBinding(rollKickSlide.Footstep, footsteps.Footstep));</code> </pre> <br>  This caused a lot of problems.  I created loops of connections that loop back.  It turned out that the order of initialization is often of great importance, and when data is bound, initialization becomes a real hell, since as links are added, some properties are initialized several times. <br><br>  When it came time to add animation, it turned out that with data binding, to animate the transition between two states is a complex and non-intuitive process.  And I'm not the only one who thinks so.  You can watch this video with a Netflix programmer, who crumbles in praises of React, and then tells you how to turn it off whenever they start the animation. <br><br>  I also guessed to use the full power of disabling connections.  And added another field: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Binding</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enabled</span></span></span><span class="hljs-class">; }</span></span></code> </pre> <br>  Unfortunately, this lost all meaning of binding.  I wanted to get rid of the states, but with such a code there are only more of them.  Here's how to remove this state? <br><br>  I know!  With the help of binding! <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Binding</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Property</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enabled</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Property</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class">&gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Value</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> }; }</span></span></code> </pre> <br>  Yes, there was a moment when I seriously tried to implement something like this.  I connected everything that is connected.  But I quickly came to my senses and realized that this was crazy. <br><br>  How can I fix the binding situation?  Try to make your interface function normally without states.  A good example is <a href="https://github.com/ocornut/imgui">dear imgui</a> .  Separate behavior and state as much as possible.  Avoid the technician with whom it is easy to create states.  Creating a state should be a painful step for you. <br><br><h3>  Conclusion </h3><br>  One could go on, this is not all my dumb mistakes.  I wrote another ‚Äúoriginal‚Äù method to avoid global variables.  There was a period when I was obsessed with closures.  I created the so-called entity-object system, and it was anything but an entity-object system.  I tried to implement multithreading in a voxel engine, generously setting locks. <br><br>  Here are the conclusions I came to: <br><br><ul><li>  Make decisions yourself, do not delegate them to the computer; </li><li>  Separate behavior and state; </li><li>  Write clean functions; </li><li>  Start with client code; </li><li>  Write a boring code. </li></ul><br>  Here is my story.  Do you have a dark past that you are willing to share? </div><p>Source: <a href="https://habr.com/ru/post/325624/">https://habr.com/ru/post/325624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325612/index.html">MoscowCSS</a></li>
<li><a href="../325614/index.html">MBLT17 preliminary program</a></li>
<li><a href="../325616/index.html">How to accelerate the deployment of IoT-projects in a corporate environment?</a></li>
<li><a href="../325618/index.html">The release of the integration platform Ensemble 2017.1</a></li>
<li><a href="../325622/index.html">Apache Spark Mitap</a></li>
<li><a href="../325626/index.html">Build a project in python3 & PyQT5 for Windows using PyInstaller</a></li>
<li><a href="../325628/index.html">React Native: another ‚Äúsilver bullet‚Äù for cross-platform development?</a></li>
<li><a href="../325630/index.html">Details that matter</a></li>
<li><a href="../325632/index.html">Second honorary. Notes of the participant of the contest Dstl Satellite Imagery Feature Detection</a></li>
<li><a href="../325634/index.html">Google Benchmark Library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>