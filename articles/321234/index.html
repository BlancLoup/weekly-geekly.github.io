<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Brave new messenger API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to everyone who follows the adventures of Pavlov in telephony. A few days ago we added a new subsystem to Voximplant. As a developer involved in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Brave new messenger API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/117/fc4/944/117fc49448ca4cd88a5cafce5da8b83c.jpg"><br><br>  Hello to everyone who follows the adventures of Pavlov in telephony.  A few days ago we added a new subsystem to Voximplant.  As a developer involved in this pikachu, I want to share the inner kitchen of the development.  We have added a platform to build messenger apps.  Whether it is chats, corporate communication systems, messaging devices - all that is enough to transfer text information. <br><a name="habracut"></a><br>  I hope that the technical information and all sorts of dry figures about the server part of the platform will be told to you by one of my colleagues a little later in our blog. <br><br>  Connecting a WebSDK library with a helper 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//cdn.voximplant.com/edge/voximplant.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//cdn.voximplant.com/edge/voximplant-websdk-helper.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  If you have been familiar with VoxImplant WebSDK before, it will be strange for you that there is an additional library: voximplant-websdk-helper.  This is a small lib that I use in internal development and testing.  It reduces event subscriptions for regular operations, such as login and initialization. <br><br><pre> <code class="javascript hljs">VoxImplantHelper.Login.LoginWithPass({ <span class="hljs-attr"><span class="hljs-attr">micRequired</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-string"><span class="hljs-string">'pavel_a@bar.foo.voximplant.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'foobar123456'</span></span>, {}, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { log(<span class="hljs-string"><span class="hljs-string">'Connection successful'</span></span>); }).catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { log(<span class="hljs-string"><span class="hljs-string">'ERR:'</span></span> + e, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); });</code> </pre><br>  Now it is easy and natural to get an instance of the messenger: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> msgInst; VoxImplantHelper.Login.LoginWithPass({ <span class="hljs-attr"><span class="hljs-attr">micRequired</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-string"><span class="hljs-string">'pavel_a@bar.foo.voximplant.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'foobar123456'</span></span>, {}, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(<span class="hljs-string"><span class="hljs-string">'Connection successful'</span></span>); msgInst = VoxImplant.getMessenger(); initMessenger(); }).catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(<span class="hljs-string"><span class="hljs-string">'ERR:'</span></span> + e, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initMessenger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     }</span></span></code> </pre><br>  This is a little easier and faster than through standard events.  But if you want to add messaging to an already ready application, then simply add this code to any convenient place after login: <br><br><pre> <code class="javascript hljs">msgInst = VoxImplant.getMessenger(); initMessenger(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initMessenger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     }</span></span></code> </pre><br>  First, let's subscribe to the Event of creating a new dialogue in order to receive an instance of the created dialogue when it is ready: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> conversations = []; msgInst.on(VoxImplant.MessagingEvents.onCreateConversation,(e)=&gt;{ conversations.push(e.conversation); })</code> </pre><br>  Our API is based on Conversation.  These are conversations between 1 or more users.  We did not limit the creation of dialogs to at least 2 users, so you can do service and buffer dialogues between devices of the same user. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> participants = [{<span class="hljs-attr"><span class="hljs-attr">user_id</span></span>:<span class="hljs-string"><span class="hljs-string">"pavel_b@bar.foo"</span></span>}]; <span class="hljs-comment"><span class="hljs-comment">//      . ( ,   .voximplant.com   const title = "    "; //  -    const isDistinct = false; //   true,          ,    1-1  const enablePublicJoin = true; //      (    uuid) msgInst.createConversation(participants,title,isDistinct,enablePublicJoin); //    </span></span></code> </pre><br>  We made the message sending system minimalistic.  There are no additional notifications that the system received, processes and processed your request for the message.  Everything happens too fast to send such a bunch of messages. <br><br><img src="https://habrastorage.org/files/8f0/8d9/c17/8f08d9c1734a4a7798af0a3410ab4338.png"><br><br>  You simply send a message to the dialogue, and all participants in the dialogue, including you, receive a new message. <br><br>  Sending a message is done in 1 line, without additional preparation.  A step earlier, we saved the new dialogue into an array of conversations.  We will receive it and send a message. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentConv = conversations[<span class="hljs-number"><span class="hljs-number">0</span></span>]; currentConv.sendMessage(<span class="hljs-string"><span class="hljs-string">", !"</span></span>);</code> </pre><br>  Do not forget to add new messages.  Well, you can then display the results somewhere <br><br><pre> <code class="javascript hljs">msgInst.on(VoxImplant.MessagingEvents.onSendMessage,(e)=&gt;{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e.message.conversation); <span class="hljs-comment"><span class="hljs-comment">//       console.log(e.message.sender); //  id  console.log(e.message.text); //       })</span></span></code> </pre><br>  This is the first article in a cycle of tutorials on developing web applications for our platform.  Pavel and I will try to make the articles come out weekly on Wednesdays. </div><p>Source: <a href="https://habr.com/ru/post/321234/">https://habr.com/ru/post/321234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321224/index.html">Sport is dead! (based on "Agile died" and other obituaries)</a></li>
<li><a href="../321226/index.html">How we created a hosting provider with our own data center (continued)</a></li>
<li><a href="../321228/index.html">Visual C ++ for Linux Development: Practicing for Windows Developers</a></li>
<li><a href="../321230/index.html">Translation of excerpts from Robert Heinlein‚Äôs book, Take Your Government Back - part 21</a></li>
<li><a href="../321232/index.html">We continue testing: on the queue server Fujitsu PRIMERGY RX2540 M2</a></li>
<li><a href="../321236/index.html">Angular - setting up the development and production environment for assemblies with AOT compilation and tree-shaking (Gulp, Rollup, SystemJS)</a></li>
<li><a href="../321238/index.html">Electronic ink for Wirenboard 5 or paint barcodes on Go</a></li>
<li><a href="../321240/index.html">What is traffic arbitration?</a></li>
<li><a href="../321242/index.html">Why I do not like synthetic tests</a></li>
<li><a href="../321244/index.html">Work with Flexbox in gifs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>