<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>When we wrote the 100th API, we understood ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We at Perfect Solutions last week wrote the 100th API. During all this time, at the cost of a rake, crutches, bicycles and refactoring, we realized th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>When we wrote the 100th API, we understood ...</h1><div class="post__text post__text-html js-mediator-article">  We at <a href="https://perfect-inc.com/">Perfect Solutions</a> last week wrote the 100th API.  During all this time, at the cost of a rake, crutches, bicycles and refactoring, we realized that we had developed an excellent strategy "how to write an API and stop pain and suffering." <br><br>  This post is about versioning, support, bugfixing and full life cycle API. <br><br>  Under the cut there are no photos with a lot of traffic, no silver bullets, there is not even a picture to attract attention - only a useful squeeze of our experience.  Under the cat methodology developed on the actual experience of development, stuffed cones and broken rakes. <br><a name="habracut"></a><br><h4>  Product approach </h4><br>  The API is not a ‚Äúset of functions for everyone‚Äù, not a ‚Äúset for solving any tasks‚Äù, not ‚Äúmake and forget‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      An API is a product, with a product that developers will use.  You will not be able to "sell" them a bad API, passing it off as a good one.  Time will answer all questions. <br><br>  What is the API product approach?  This means that the API consists of features <s>and bugs</s> .  Features should be simple and atomic: one API method is perceived as one feature.  Whether a feature, user registration through the API?  Yes, feature!  Whether a feature, sending push notifications?  Feature! <br><br>  And this means that all API methods must be <b>thought out, described, developed and tested</b> - to go through a full development cycle.  The biggest trouble in terms of the attitude of developers to the API is its lack of thought. <br><br><h4>  Atomicity of operations </h4><br>  If your API does in one method 3 INSERT in a DBMS - there must be a transaction.  If it does not exist, it will not just cause problems, but also cause problems that are <i>not found and not reproducible from the interface</i> . <br><br>  And another important point in the concept of atormarnost.  The feature is atomic.  If, when registering a new user from the API, roles must be specified (from the system of rights), then the API method is required to do both things to register a user in one request: <br><br><ul><li>  Create user </li><li>  Do assign the transferred list of roles. </li></ul><br><br>  For example, here is such a method, in the case of yii2: <br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionRegister</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($username, $password, array $roleNames)</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br><br><h4>  Verification of all incoming parameters and compliance with protocols </h4><br>  Like any data received from the user, everything that comes to the API must be validated.  The API is used by developers, but they are the same users, people. <br><br>  Standard http-responses corresponding to realities is an important point to simplify support and debug.  Invalid request, non-validation - ‚Äú400 Bad Request‚Äù, Internal error - ‚Äú500 Internal Server Error‚Äù.  This is very important for logging (in the nginx logs) and repairing all future bugs.  If the API always gives status 200, it will be very difficult to find the cause of errors in the logs. <br><br><h4>  You will fix bugs </h4><br>  You do not throw out the API, do not "make a new version later."  You will fix bugs in this version of the API, in this code, and right tomorrow. <br><br>  I say this to the fact that, like any product, an API is something that will have to be debugged, tested and maintained.  So there is the most common set of rules: <br><ul><li>  Follow the protocol (at least Status Code) </li><li>  Log everything - on the API side, log requests and responses, on the client side - the same.  Funny moment - it can also be different ;-) </li><li>  Test it, review the code and remember that the API is a product whose users are developers. </li><li>  Make a special parameter for debugging - so that on the client side you can get not only the response from the API, but also all debug information.  Next to the answer. </li></ul><br><br><h4>  Never believe that you invented the API versioning method </h4><br><br>  API versioning helps to lose backward compatibility in new methods without discarding old methods, leaving them in the old version.  The Internet offers a lot of ways to version API.  Ways for different frameworks, approaches and all the rest, but there is no silver bullet.  For that is, a store in which almost any bullet easily fits is a location in nginx. <br><pre> <code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /api/v1/ { ... } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /api/v2/ { ... }</code> </pre><br>  Such an approach will not only allow the old API to be thrown out at the right time, but will also allow the new API to be moved to another server, to a separate application, or anywhere else.  This is not a "solution to all problems", it is a box in which you can add up a lot of your decisions that will change with time. <br><br><h4>  Document Drive Development </h4><br>  Documenting the API is often a pain.  Documentation is almost always irrelevant, and tools like swagger still require support.  This issue is easily solved if obryat grocery approach - start with the documentation.  That's right when you start a task in your jira / redmine - there and describe everything you want from the API.  Directly in the documentation format. <br><br>  Put a new method on the combat server - just copy the documentation from the task to your documentation repository.  And voila - your documentation is always relevant. <br><br><h4>  OP as analogy </h4><br>  Write simple API methods.  Imagine writing a function on Erlang.  A decent part of the problems are "methods of all Russia", "method for the whole" or any method overloaded with logic. <br><br>  API methods must be atomic, but sufficient.  And too small broken and the reverse side - will lead to problems. <br><br><h4>  Good luck! </h4><br>  I briefly outlined <a href="http://solutions.perfect-inc.com/howto.html">our subjective</a> experience of developing an API, but did not provide any meaningful code ‚Äî you will still have your code. <br><br>  But all this is short in the form of theses: <br><ul><li>  Product approach </li><li>  Atomicity of operations </li><li>  Verification of all incoming parameters and compliance with protocols </li><li>  Log everything </li><li>  Never believe that you invented the API versioning method </li><li>  Document Drive Development </li><li>  OP as analogy </li></ul></div><p>Source: <a href="https://habr.com/ru/post/283092/">https://habr.com/ru/post/283092/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283080/index.html">Do I need a development standard?</a></li>
<li><a href="../283082/index.html">My 1st WEB App</a></li>
<li><a href="../283084/index.html">Security Week 18: VirusTotal for justice, vulnerability in Android, leak of Slack tokens</a></li>
<li><a href="../283086/index.html">Full lazyload on node.js</a></li>
<li><a href="../283090/index.html">Quick object cloning in JavaScript</a></li>
<li><a href="../283096/index.html">Talk about MVC and web application architecture</a></li>
<li><a href="../283100/index.html">The future is here: Will robots push out financial analysts from Wall Street</a></li>
<li><a href="../283102/index.html">Creating a continuous deployment system: the Instagram experience</a></li>
<li><a href="../283104/index.html">Various experiments with the reception and transmission of radio signals in the FPGA</a></li>
<li><a href="../283106/index.html">Swift and compile time</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>