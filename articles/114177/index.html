<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring the balance of cell phones, providers - or never again forget to pay for the phone and the Internet on time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is an opinion that the main working quality of a real sysadmin is laziness. When a sysadmin has a server and this server provides a service ‚Äî us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring the balance of cell phones, providers - or never again forget to pay for the phone and the Internet on time</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/b9/e8/b9e8be914811ffa02880a2caf2f782da.png" align="right"><br>  There is an opinion that the main working quality of a real sysadmin is laziness.  When a sysadmin has a server and this server provides a service ‚Äî usually the admin puts this service on monitoring ‚Äî in order to know that the service is ok, to find out that the guard-all-lost-all-broke in the number first and sleep peacefully, knowing that if something happens, it will be awakened by an alert, and not the call of the disgruntled boss. <br><br>  But what about when the server and service are not their own, but others?  After all, this situation happens all the time.  A typical small organization: one or two sites on a hosting (for which you have to pay on time, and often also monitor whether the tariffs have changed), a pack of domain names (which also need to be paid on time, or you can even lose) then the number of cell phones (for which the balance should be monitored), contracts (and, accordingly, accounting and settlements) with providers of city telephony, with a VOIP-provider, and in the end - just with an Internet provider for the office. <br><br>  A sysadmin usually does not pay for all of this himself, but he receives mostly reminder letters to replenish the balance and he will be the last to forget if he forgets to remind those who pay.  Who among us at least once in his life did not forget to pay for something like that (for example, because the reminder letter got into spam) and remained without communication, without a website, without a domain, without a bonus, <s>without a salary, without work</s> , etc.  and promised solemnly to himself that next time it will be neater. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  The casket actually opens simply and, one may say, roughly.  In almost any monitoring system (tested on Nagios, Zabbix, Remstats, Ganglia, Zenoss - it‚Äôs difficult to imagine a system where it wouldn‚Äôt exist) it is possible to execute an external program and the result of its execution (exit exit if we collect data ‚Äúbroke-no "Or output to stdout) register as the value of some parameter in the monitoring. <br><br>  Suppose we have a cell phone connected to, um, let's say MTS - how would we check the balance on this phone, having only the Internet available?  Very simple - go to the site mts.ru, we find an <a href="https://ihelper.mts.ru/selfcare/">Internet assistant there</a> , we leave from there for a lighter <a href="https://ihelper.mts.ru/selfcarepda/security.mvc/logon">PDA version</a> : <br><img src="https://habrastorage.org/storage/habraeffect/46/88/4688827d3a5188b316b0b7ff6516a3e2.png"><br><br>  We have a phone number, but you will need to set a password for this wonderful ‚ÄúInternet Assistant‚Äù - we do this by dialing * 111 * 25 # and setting the password.  Enter the phone number and password in the form, and, oh miracle, on the next page will be the desired numbers: <br><img src="https://habrastorage.org/storage/habraeffect/12/a6/12a66652c856fe92e0c2b7e716f0f1eb.png"><br><br>  Now it remains to teach this simple procedure the server and tell it to repeat it several times a day. <br><br>  Armed with our favorite tools for analyzing HTML and HTTP traffic, we rather quickly understand that: <br><ul><li>  The user opens the login form, they give him a certain cookie - obviously, to identify the session </li><li> The user enters the login (phone number) and password in the form, clicks "Login" - the received cookie and 2 completed form parameters are sent - <code>username</code> and <code>password</code> . </li><li>  After a system of clever redirects and reverie, the user eventually gets a page with the word ‚ÄúBalance:‚Äù and the required figure. </li></ul>  Armed with a wonderful program like wget (suitable for curl, lftp or any similar tool) for sending HTTP requests and a universal line preparation called sed, you can write and debug a script with 3 lines and one function similar to this for two cups of coffee: <br><br><pre> <code class="perl hljs">request() { wget \ --load-cookies cookies.txt \ --save-cookies cookies.txt \ --keep-session-cookies \ --quiet \ $@ } request -O <span class="hljs-number"><span class="hljs-number">1</span></span>.html \ <span class="hljs-string"><span class="hljs-string">'https://ihelper.mts.ru/SELFCAREPDA/Security.mvc/LogOn'</span></span> request -O <span class="hljs-number"><span class="hljs-number">2</span></span>.html \ --post-data=<span class="hljs-string"><span class="hljs-string">"username=$LOGIN&amp;password=$PASSWORD"</span></span> \ <span class="hljs-string"><span class="hljs-string">'https://ihelper.mts.ru/SELFCAREPDA/Security.mvc/LogOn'</span></span> sed -<span class="hljs-keyword"><span class="hljs-keyword">ne</span></span> <span class="hljs-string"><span class="hljs-string">'/&lt;br\/&gt;:/ { s,.*&gt;\([0-9.]*\)&lt;/.*$,\1,; p }'</span></span> &lt;<span class="hljs-number"><span class="hljs-number">2</span></span>.html</code> </pre><br>  It is not very beautiful, it litters temporary files, but it works: <br><pre> <code class="hljs pgsql">$ <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span>=<span class="hljs-number"><span class="hljs-number">9161234567</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span>=<span class="hljs-number"><span class="hljs-number">012345</span></span> ./monitor <span class="hljs-number"><span class="hljs-number">1234.56</span></span></code> </pre><br>  Now you need to slightly elevate it and can be connected to your favorite monitoring system.  The cell phone balance chart will look something like the one shown in the picture that opened the article: slow downs (gradual expenditure of funds on the balance sheet, subscriber charge) and peaks up (balance replenishment - depositing funds). <br><br>  In such a simple way - in fact, by simulating a person‚Äôs actions in entering and reading in the web interface, you can automatically monitor a lot of external services.  Here is another, slightly more banal example from another monitoring system, this time - based on Zabbix: <br><img src="http://habrastorage.org/storage/habraeffect/f5/17/f517fa75ba9bfb4db233fa7e36b0c1e1.png"><br>  Here you can see the number of days before the end of the paid period at the Internet provider.  5 days before the end of the term, the trigger is triggered and one reminder is sent, in 1 day the second one with a higher priority.  The schedule, of course, is more predictable than that of a cell phone balance, but, nevertheless, these reminders on the triggers have more than once saved a large number of nerve cells for me personally. <br><br><h1>  Aftermath </h1>  It so happened that I had to accumulate a non-zero number of such scripts - and I thought - why everyone writes them himself and spends on it every half an hour of his time - why not create some kind of common repository of free software in which such scripts?  I searched, maybe something is already there - the closest one I found is the <a href="http://4pda.ru/forum/index.php%3Fshowtopic%3D164376">BalanceRobot</a> project for Android ‚Äî a program similar in principle (true, proprietary and closed) that monitors the balance of cellular operators ‚Äî and created <a href="https://github.com/GreyCat/spmon">the SPMon project on github</a> . <br><br>  Right now he knows how to maintain a <a href="https://github.com/GreyCat/spmon/tree/master/services">relatively modest set of services</a> : <br><ul><li>  <a href="http://moscow.megafon.ru/">Moscow Megaphone</a> - balance check </li><li>  <a href="http://www.mts.ru/">MTS</a> - balance check </li><li>  <a href="http://www.netbynet.ru/">A large conglomerate of NetByNet Internet service providers</a> - checking the number of days until maturity </li><li>  <a href="http://www.skype.com/">Skype</a> Internet Telephony - Balance Check </li><li>  <a href="http://www.sipnet.ru/">SIPNET</a> Internet Telephony <a href="http://www.sipnet.ru/">SIPNET</a> - Balance Check </li><li>  <a href="http://www.w1.ru/">Wallet One W1</a> - Wallet Account Balance Check </li></ul>  The project structure is very simple: there is a <code>services</code> directory, in which there are scripts in different subdirectories (named for the domain name).  The scripts are written in the shell, usually consist of 3-4 lines and connect to work the common part, located in the <code>_spmon_init</code> file.  This file for work can be either in the current directory, or in a directory one level up, or in some public location (in PATH). <br><br>  There is a simple test infrastructure in the form of one Makefile (which I, unfortunately, cannot share for obvious reasons), which I launch from time to time and it bypasses all the above services, substituting my personal logins and passwords and by the results of its launch I will check that the scripts are still working. <br><br>  Anyone who has a desire to share with the community ways to monitor some other Internet services - I invite :) <br><br>  <b>PS</b> Some time ago, <a href="https://habrahabr.ru/users/zuskin/" class="user_link">zuskin</a> <a href="http://habrahabr.ru/blogs/development/113878/">had already considered the issue of connecting such scripts to Nagios</a> using php scripts.  I offer a slightly more general and minimalist solution that likewise connects to Nagios, Zabbix, Remstats, etc. </div><p>Source: <a href="https://habr.com/ru/post/114177/">https://habr.com/ru/post/114177/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../114168/index.html">In honor of the # Jan25 revolution, the Egyptian named his daughter Facebook</a></li>
<li><a href="../114169/index.html">MMO mouse from Razer: Naga Molten and Naga Epic</a></li>
<li><a href="../114171/index.html">Blackberry - development site: Eclipse + CVS hosting</a></li>
<li><a href="../114173/index.html">Assword</a></li>
<li><a href="../114174/index.html">Cultural differences: Finns</a></li>
<li><a href="../114180/index.html">4X Games: in search of the fifth</a></li>
<li><a href="../114181/index.html">Cultural differences: Japanese (another look)</a></li>
<li><a href="../114182/index.html">Auto-change textarea when entering text</a></li>
<li><a href="../114183/index.html">Cultural differences 2. Colleagues from India</a></li>
<li><a href="../114186/index.html">Text analyzer: recognition of authorship (start)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>