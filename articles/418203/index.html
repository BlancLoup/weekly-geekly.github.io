<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GraphQL API (CRUD) on Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! About GraphQL many articles on Habr√©, but running over them found that they all bypass such a wonderful language as Go. Today I will try to cor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GraphQL API (CRUD) on Go</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/f74/bcd/465/f74bcd465f0e443b05c1d417b58c3a42.jpg" alt="image"></p><br><p>  Hello!  About GraphQL many articles on Habr√©, but running over them found that they all bypass such a wonderful language as Go.  Today I will try to correct this misunderstanding.  To do this, write an API on Go using GraphQL. <a name="habracut"></a></p><br><p>  In short: GraphQL is a query language for building an API that describes how to request and return data (for more information, see the official <a href="http://graphql.github.io/">graphql.github.io</a> resource and <a href="https://habr.com/post/326986/">on the habr</a> ). </p><br><p>  Argue about whether GraphQL or REST is better <a href="https://habr.com/post/335158/">here.</a> </p><br><p>  We will have a classic API: CRUD (Create, Read, Update, Delete) adding, receiving, editing and deleting products in the online store. <br>  On the server side, we will use the ready-made <a href="https://github.com/graphql-go/graphql">graphql-go</a> implementation of GraphQL </p><br><p>  First you need to download graphql-go, this can be done with the command </p><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> get github.com/graphql-<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/graphql</code> </pre> <br><p>  Next, we describe the structure of the goods (in simplified form) </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Product <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { ID <span class="hljs-keyword"><span class="hljs-keyword">int64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> Name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"name"`</span></span> Info <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"info,omitempty"`</span></span> Price <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"price"`</span></span> }</code> </pre> <br><p>  <code>ID</code> - unique identifier, <code>Name</code> - name, <code>Info</code> - product information, <code>Price</code> - price </p><br><p>  The first thing that needs to be done is to call the <code>Do</code> method, which takes the data schema and the request parameters as input parameters.  And will return the resulting data to us (for further transmission to the client) </p><br><pre> <code class="go hljs">result := graphql.Do(graphql.Params{ Schema: schema, RequestString: query, })</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Full code</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(query </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, schema graphql.Schema)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphql</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Result</span></span></span></span> { result := graphql.Do(graphql.Params{ Schema: schema, RequestString: query, }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(result.Errors) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> { fmt.Printf(<span class="hljs-string"><span class="hljs-string">"errors: %v"</span></span>, result.Errors) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/product"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { result := executeQuery(r.URL.Query().Get(<span class="hljs-string"><span class="hljs-string">"query"</span></span>), schema) json.NewEncoder(w).Encode(result) }) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre> </div></div><br><p>  <code>Schema</code> is the data schema, <code>RequestString</code> is the value of the query string parameter, in our case the value of <code>query</code> </p><br><h2 id="schema-shema">  Schema </h2><br><p>  The schema accepts two root data types: <code>Query</code> - immutable data, <code>Mutation</code> - mutable data </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> schema, _ = graphql.NewSchema( graphql.SchemaConfig{ Query: queryType, Mutation: mutationType, }, )</code> </pre> <br><h2 id="query-zaprosy">  Query (Queries) </h2><br><p>  <code>Query</code> is used to read (and only read) data.  Using <code>Query</code> we specify what data the server should return. <br>  Let's write the implementation of the <code>Query</code> data type, in our case it will contain fields with information about a single product (product) and a list of products (list) </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> queryType = graphql.NewObject( graphql.ObjectConfig{ Name: <span class="hljs-string"><span class="hljs-string">"Query"</span></span>, Fields: graphql.Fields{ <span class="hljs-comment"><span class="hljs-comment">/*    ID http://localhost:8080/product?query={product(id:1){name,info,price}} */</span></span> <span class="hljs-string"><span class="hljs-string">"product"</span></span>: &amp;graphql.Field{ Type: productType, Description: <span class="hljs-string"><span class="hljs-string">"Get product by id"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   ,    Args: graphql.FieldConfigArgument{ //       id "id": &amp;graphql.ArgumentConfig{ Type: graphql.Int, }, }, Resolve: func(p graphql.ResolveParams) (interface{}, error) { id, ok := p.Args["id"].(int) if ok { //    ID for _, product := range products { if int(product.ID) == id { return product, nil } } } return nil, nil }, }, /*    http://localhost:8080/product?query={list{id,name,info,price}} */ "list": &amp;graphql.Field{ Type: graphql.NewList(productType), Description: "Get product list", Resolve: func(params graphql.ResolveParams) (interface{}, error) { return products, nil }, }, }, })</span></span></code> </pre> <br><p>  The queryType type contains the required <code>Name</code> and <code>Fields</code> fields, as well as an optional <code>Description</code> (used for documentation) <br>  In turn, the <code>Fields</code> field also contains the required <code>Type</code> field and the optional <code>Args</code> , <code>Resolve</code> and <code>Description</code> fields. </p><br><h2 id="args-argumenty">  Args </h2><br><p>  Arguments - the list of parameters transmitted from the client to the server and affecting the result of the returned data.  Arguments are tied to a specific field.  And the arguments can be passed in <code>Query</code> as well as in <code>Mutation</code> . </p><br><pre> <code class="go hljs">?query={product(id:<span class="hljs-number"><span class="hljs-number">1</span></span>){name,info,price}}</code> </pre> <br><p>  In this case, the <code>id</code> argument for the <code>product</code> field with a value of 1, says that it is necessary to return the product with the specified identifier. <br>  For <code>list</code> arguments are omitted, but in a real application, this may be, for example: <code>limit</code> and <code>offset</code> . </p><br><h2 id="resolve-raspoznavateli">  Resolve (Recognizers) </h2><br><p>  All the logic of working with data (for example, requests to the database, processing and filtering) is in the recognizers, they return the data that will be transmitted to the client as a response to the request. </p><br><h2 id="type-sistema-tipov">  Type (Type System) </h2><br><p>  GraphQL uses its type system to describe data.  You can use both the basic types of <code>String</code> , <code>Int</code> , <code>Float</code> , <code>Boolean</code> , and your own (custom).  For our example, we need a custom <code>Product</code> type that will describe all the properties of the product. </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productType = graphql.NewObject( graphql.ObjectConfig{ Name: <span class="hljs-string"><span class="hljs-string">"Product"</span></span>, Fields: graphql.Fields{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>: &amp;graphql.Field{ Type: graphql.Int, }, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: &amp;graphql.Field{ Type: graphql.String, }, <span class="hljs-string"><span class="hljs-string">"info"</span></span>: &amp;graphql.Field{ Type: graphql.String, }, <span class="hljs-string"><span class="hljs-string">"price"</span></span>: &amp;graphql.Field{ Type: graphql.Float, }, }, }, )</code> </pre> <br><p>  For each field, a base type is specified, in this case, it is <code>graphql.Int</code> , <code>graphql.String</code> , <code>graphql.Float</code> . <br>  The number of nested fields is unlimited, so you can implement a graph system of any level. </p><br><h2 id="mutation-mutacii">  Mutation </h2><br><p>  The mutations are these mutable data, which include: add, edit, and delete.  In all other respects, mutations are very similar to regular queries: they also take <code>Args</code> arguments and return <code>Resolve</code> data as a response to a query. </p><br><div class="spoiler">  <b class="spoiler_title">Let's write mutations for our products.</b> <div class="spoiler_text"><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mutationType = graphql.NewObject(graphql.ObjectConfig{ Name: <span class="hljs-string"><span class="hljs-string">"Mutation"</span></span>, Fields: graphql.Fields{ <span class="hljs-comment"><span class="hljs-comment">/*    http://localhost:8080/product?query=mutation+_{create(name:"Tequila",info:"Alcohol",price:99){id,name,info,price}} */</span></span> <span class="hljs-string"><span class="hljs-string">"create"</span></span>: &amp;graphql.Field{ Type: productType, Description: <span class="hljs-string"><span class="hljs-string">"Create new product"</span></span>, Args: graphql.FieldConfigArgument{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: &amp;graphql.ArgumentConfig{ Type: graphql.NewNonNull(graphql.String), <span class="hljs-comment"><span class="hljs-comment">//     }, "info": &amp;graphql.ArgumentConfig{ Type: graphql.String, //    }, "price": &amp;graphql.ArgumentConfig{ Type: graphql.NewNonNull(graphql.Float), }, }, Resolve: func(params graphql.ResolveParams) (interface{}, error) { rand.Seed(time.Now().UnixNano()) product := Product{ ID: int64(rand.Intn(100000)), //   ID Name: params.Args["name"].(string), Info: params.Args["info"].(string), Price: params.Args["price"].(float64), } products = append(products, product) return product, nil }, }, /*    id http://localhost:8080/product?query=mutation+_{update(id:1,price:195){id,name,info,price}} */ "update": &amp;graphql.Field{ Type: productType, Description: "Update product by id", Args: graphql.FieldConfigArgument{ "id": &amp;graphql.ArgumentConfig{ Type: graphql.NewNonNull(graphql.Int), }, "name": &amp;graphql.ArgumentConfig{ Type: graphql.String, }, "info": &amp;graphql.ArgumentConfig{ Type: graphql.String, }, "price": &amp;graphql.ArgumentConfig{ Type: graphql.Float, }, }, Resolve: func(params graphql.ResolveParams) (interface{}, error) { id, _ := params.Args["id"].(int) name, nameOk := params.Args["name"].(string) info, infoOk := params.Args["info"].(string) price, priceOk := params.Args["price"].(float64) product := Product{} for i, p := range products { //     if int64(id) == p.ID { if nameOk { products[i].Name = name } if infoOk { products[i].Info = info } if priceOk { products[i].Price = price } product = products[i] break } } return product, nil }, }, /*    id http://localhost:8080/product?query=mutation+_{delete(id:1){id,name,info,price}} */ "delete": &amp;graphql.Field{ Type: productType, Description: "Delete product by id", Args: graphql.FieldConfigArgument{ "id": &amp;graphql.ArgumentConfig{ Type: graphql.NewNonNull(graphql.Int), }, }, Resolve: func(params graphql.ResolveParams) (interface{}, error) { id, _ := params.Args["id"].(int) product := Product{} for i, p := range products { if int64(id) == p.ID { product = products[i] //     products = append(products[:i], products[i+1:]...) } } return product, nil }, }, }, })</span></span></code> </pre> </div></div><br><p>  All similar to <code>queryType</code> .  There is only one small feature: the <code>graphql.NewNonNull(graphql.Int)</code> type <code>graphql.NewNonNull(graphql.Int)</code> , which tells us that this field cannot be empty (similar to <code>NOT NULL</code> in MySQL) </p><br><p>  Everything.  Now we have a simple CRUD API on Go to work with products.  We did not use the database for this example, but we looked at how to create a data model and manipulate them with mutations. </p><br><h2 id="primery">  Examples </h2><br><p>  If you downloaded the source through </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> get github.com/graphql-<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/graphql</code> </pre> <br><p>  just go to the directory with an example </p><br><pre> <code class="go hljs">cd examples/crud</code> </pre> <br><p>  and run the application </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> run main.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span></code> </pre> <br><p>  <strong>You can use the following queries:</strong> <br>  Getting product by ID <br> <code>http://localhost:8080/product?query={product(id:1){name,info,price}}</code> </p> <br><p>  Getting a list of products <br> <code>http://localhost:8080/product?query={list{id,name,info,price}}</code> </p> <br><p>  Adding a new product <br> <code>http://localhost:8080/product?query=mutation+_{create(name:"Tequila",info:"Strong alcoholic beverage",price:999){id,name,info,price}}</code> </p> <br><p>  Product editing <br> <code>http://localhost:8080/product?query=mutation+_{update(id:1,price:195){id,name,info,price}}</code> </p> <br><p>  Product removal by id <br> <code>http://localhost:8080/product?query=mutation+_{delete(id:1){id,name,info,price}}</code> </p> <br><p>  If you are using REST you should pay attention to GraphQL as a possible alternative.  Yes, at first glance it seems more difficult, but it is worth starting and in a couple of days you will master this technology.  At least it will be useful. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/418203/">https://habr.com/ru/post/418203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418193/index.html">How does it feel to create a game for Game Boy in 2017</a></li>
<li><a href="../418195/index.html">MIT course "Computer Systems Security". Lecture 4: "Separation of privileges", part 1</a></li>
<li><a href="../418197/index.html">MIT course "Computer Systems Security". Lecture 4: "Separation of privileges", part 2</a></li>
<li><a href="../418199/index.html">How to make a simple technical task and not lose money and nerves</a></li>
<li><a href="../418201/index.html">Can we revive the "Duck Hunt"?</a></li>
<li><a href="../418205/index.html">Cosmic language, Part 2: Welcome, GJ273b</a></li>
<li><a href="../418207/index.html">Review of gaming laptops ASUS ROG Strix GL504GS SCAR II and ASUS ROG Strix GL504GM HERO II</a></li>
<li><a href="../418209/index.html">Receive data from the counters Mercury 203.2T via RS-485</a></li>
<li><a href="../418211/index.html">MIT course "Computer Systems Security". Lecture 4: "Separation of privileges", part 3</a></li>
<li><a href="../418213/index.html">MIT course "Computer Systems Security". Lecture 5: "Where Security Errors Come From", Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>