<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Again asynchronous on callbacks. In arrays</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="var nodes = arrayThatLeaks( linklist ) .leakMap( xhrLoad ) .leakFilter( responseNotEmpty ) .leakMap( insertInDocument ); // Promise.resolve( arrayThat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Again asynchronous on callbacks. In arrays</h1><div class="post__text post__text-html js-mediator-article"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nodes = arrayThatLeaks( linklist ) .leakMap( xhrLoad ) .leakFilter( responseNotEmpty ) .leakMap( insertInDocument ); <span class="hljs-comment"><span class="hljs-comment">//      Promise.resolve( arrayThatLeaks( linklist ) .leakMap( xhrLoad ) .leakFilter( responseNotEmpty ) .leakMap( makeDomNode ) ) .then( insertNodesInDocument );</span></span></code> </pre> <br>  Such a note was met once in the comments, and then she was inspired by the experiment - an exercise for the brain.  Asynchronous array operations in the form of a chained record. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Links, warnings and excuses</b> <div class="spoiler_text">  <a href="http://codepen.io/anon/pen/yMXPdO%3Feditors%3D0012">Pass and destroy</a> , and if you fall off <a href="">download and thresh</a> . <br><br>  It is definitely that another bike is represented here, and someone will consider the fact of the appearance of this code for ignorance.  But as mentioned, this experiment is an attempt of the next coder to ‚Äúride‚Äù single-threaded asynchrony javascript.  Those who look into the code will be discouraged by its quality, and the names of functions and variables can confuse the reader in attempts to make sense.  But there is hope that this code will be useful to someone and will not be wasted. </div></div><br>  Naturally, method handlers must be written taking into account the asynchrony of what is happening.  Here it is done in a simple way: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">responseNotEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> r, v </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* - cv*/</span></span> ) r( <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> r( <span class="hljs-literal"><span class="hljs-literal">false</span></span> ); }</code> </pre> <br>  The first argument in the handler is the service procedure - the result receiver, the second argument is the array element.  The resulting array of nodes will be populated with values ‚Äã‚Äãas they pass through the chain of procedures.  The order of the elements in the resulting array depends on which of the elements is processed earlier, that is, the values ‚Äã‚Äãof the initial array lose their index, even on map (). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The idea was to turn to the modern approaches of the Promises and Asynchronous expectations, but they were rejected for inexplicable reasons.  As a result, a code was obtained consisting of potential leaks in half of the functions.  And its structure is the monstrous embodiment of callback-hell - 5 steps per hundred lines. <br><br><h3>  Thought out two ways </h3><br>  At first, I wanted to create a large object with internal control of the state and execution of the entire chain of asynchronous processors.  It was represented as a multidimensional array, a whole map with results and flags, and microfunctions, and flags, and counters, and flags.  This was good for a single map () method, where the length of the array does not change.  But the filtering method will make part of the map unnecessary.  Even if the interpreter makes unnecessary references phantom for physical memory, it‚Äôs also necessary to try in the code so as not to touch these references.  Plus, the implementation of parallel branches of the methods makes the map expand in several dimensions almost uncontrollably. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a1 = arrayThatLeaks( [<span class="hljs-comment"><span class="hljs-comment">/**/</span></span>] ); a1.leakMap(<span class="hljs-comment"><span class="hljs-comment">/**/</span></span>).leakFilter(<span class="hljs-comment"><span class="hljs-comment">/**/</span></span>).leakMap(<span class="hljs-comment"><span class="hljs-comment">/**/</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  1 a1.leakFilter(/**/).leakReduce(/**/); //  2</span></span></code> </pre> <br>  The second and current option is to create a separate set of control data for each call to the array method.  Here, the mentioned difficulties collapse into a variable counter (almost).  And for a bunch of methods, a takeforward () exchange procedure was introduced in the chain, all the ‚Äúmagic‚Äù of local asynchronism.  This procedure inside the closure of one method gets the internal procedures from the closure of the next method.  What specifically to transfer was found out in the course of writing, it turned out that it is enough procedure of start of the processor and synchronizing control procedure of counters. <br><br><h3>  In detail </h3><br>  First of all, as it should be, it was necessary to separate the general auxiliary procedures from the specifics of different methods into the chain () function.  Here the handlers and receivers from the methods are wrapped, and the previous method is linked through the giveback () argument, which is usually the previous takeforward () procedure.  From the chain () comes the resulting array, extended by "leak" methods.  The array is expanded in the expa () function, where each method is the result of chain () operation.  At the same time, to create a method in chain (), the synchronizer, receiver, and preprocessor of the method are passed, which turn around and get some links from the closure of chain (). <br><br>  This scheme works for simple in terms of the map () and filter () methods.  But for reduce () you need to create external storages of intermediate values, which creates an anonymous letter above chain ().  Perhaps, in the future, when there are more methods, chain () will become more complicated for a better description of methods with tightly bound values, such as sorting. <br><br><h4>  Procedures defining the logic of the method: </h4><br>  <b>The</b> method <b>synchronizer is</b> launched from the internal counter control procedure and receives the counters of its own and previous chain () closure, the completion flag of the previous method, the reference to the launch of its own processor, the link to the next method, and the link to the results array.  For simple methods, only the completeness of the method execution is calculated here.  For complex ones, the order of launching handlers is additionally determined with the substitution of all necessary values, therefore, links to launch are sent to the synchronizer.  Every time one method is synchronized, all subsequent ones are synchronized - this allows you to work out the logic of methods in advance. <br><br>  <b>The</b> result <b>receiver is</b> inserted by the argument into the external handler (method argument) and gets the value from there.  Each receiver in a wrapper is associated with a specific index, it can send some value further along the chain and starts synchronization.  The start of the chain is optional here because the received value does not always need to continue processing.  And you can insert any index, if only without repetitions. <br><br>  <b>The</b> method <b>preprocessor</b> arose only for the implementation of convolution logic, of course, it will be useful for some other methods.  The essence of the pre-processor in the interception of values ‚Äã‚Äãfrom the processing chain.  For reduce (), this is important, because the handler requires two values, and one comes from the chain, and more importantly, the reduce () logic requires that the chain be completely stopped.  In addition, the preprocessor can start synchronization - but this is more likely a crutch, so as not to disperse the launch references by procedures. <br><br><h3>  Eventually </h3><br>  Thus, the chain of methods is deployed and compacted by hidden procedures to provide controlled asynchronous execution (and how else?), And the values ‚Äã‚Äãof the array are processed by it, somewhere they pass without waiting for the others, somewhere they wait, they disappear somewhere.  Leaks here are logical due to the chain of closures, and any curve link will hold the entire chain.  There is also a conceptual question of behavior in cases of emptying an array, throwing an error or saving to the results. <br><br>  <b>UPD:</b> Now you can combine with promises.  To do this, there was a check in the data receiver wrapper and an external method .then (), which only pretends to be a promise. </div><p>Source: <a href="https://habr.com/ru/post/323848/">https://habr.com/ru/post/323848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323836/index.html">Banal AB-test</a></li>
<li><a href="../323838/index.html">Pink spacesuit, cryptocurrency and genetically modified iOS: tasks of the online-stage NeoQUEST-2017 and some statistics</a></li>
<li><a href="../323840/index.html">Webinar: Julia - A fresh approach to numerical computing and data science</a></li>
<li><a href="../323842/index.html">Prime investor Runet and its packages</a></li>
<li><a href="../323846/index.html">Create React App (aka React Scripts) and server rendering with Redux and Router</a></li>
<li><a href="../323850/index.html">How to add reference tables in the Advanced Reporting Tool</a></li>
<li><a href="../323852/index.html">What was at the ISE-2017 exhibition (displays, LEDs, software for screens)</a></li>
<li><a href="../323854/index.html">Fresh KDE from developers plus stability Ubuntu 16.04 -> KDE Neon</a></li>
<li><a href="../323856/index.html">The story of how I am a master parser for the diary</a></li>
<li><a href="../323858/index.html">Overview of the HPE Aruba Switch Family, ArubaOS 16.X New Features</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>