<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Improve multimedia application performance with hardware acceleration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intel's processor architecture is becoming increasingly GP-oriented, which opens up amazing opportunities for dramatic performance improvements simply...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Improve multimedia application performance with hardware acceleration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/09c/ad0/38b/09cad038b65745609fd5e2c508e0835c.jpg"><br>  Intel's processor architecture is becoming increasingly GP-oriented, which opens up amazing opportunities for dramatic performance improvements simply by offloading media processing from CPU to GPU.  There are many tools available to developers to improve the performance of multimedia applications.  These tools include free and easy to use. <br>  In this publication you will find: <br><ul><li>  Overview of computing architectures and current capabilities of Intel GP </li><li>  Implement hardware acceleration with FFmpeg </li><li>  Implement hardware acceleration using the <a href="https://software.intel.com/en-us/media-sdk">Intel Media SDK</a> or similar component of the <a href="https://software.intel.com/en-us/intel-media-server-studio">Intel Media Server Studio</a> (depending on the target platform) </li></ul><a name="habracut"></a><br>  If you feel the need to improve multimedia processing performance, but do not know where to start, start with FFmpeg.  Measure the performance during software processing, then just turn on hardware acceleration and check how much the performance has changed.  Then add the use of the Intel Media SDK and compare again when using different codecs and in different configurations. <br><br><h2>  <font color="#0071c5">Computational architecture: from superscalar to heterogeneous</font> </h2><br>  To appreciate the importance of GP, let's start with the history of improving the architecture of the CPU. <br>  Let's go back to the nineties.  The first serious stage in development is the emergence of a superscalar architecture, in which high throughput was achieved due to parallel processing at the instruction level within one processor. <br><br><img src="https://habrastorage.org/files/50b/579/3d8/50b5793d8fdf45899fae42f9318a8abb.jpg"><br>  <i>Figure 1. Superscalar architecture</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then, at the beginning of zero, a multi-core architecture appeared (when there may be more than one computational core within a single processor).  Homogeneous kernels (all completely identical) made it possible to simultaneously perform several threads (parallel processing at the thread level). <br>  At the same time, the performance of a multi-core architecture was limited due to a number of obstacles. <br><ul><li>  Memory: the gap between processor speed and memory speed increased. </li><li>  Parallel processing at the instruction level (ILP): it has become increasingly difficult to detect instructions available for parallel processing within one thread in order to fully occupy the resources of one high-performance core. </li><li>  Power consumption: with a gradual increase in the clock frequency of the processors, power consumption has increased exponentially. </li></ul><br><br><img src="https://habrastorage.org/files/e65/b43/d3d/e65b43d3d9f4485cb518ce32b7e0e8a2.jpg"><br>  <i>Figure 2. Multicore architecture</i> <br><br><h2>  <font color="#0071c5">Modern heterogeneous architecture</font> </h2><br>  In a heterogeneous architecture, there may be several processors using a common data pipeline that can be optimized for individual functions of encoding, decoding, transforming, scaling, using interlaced scanning, etc. <br><br>  In other words, thanks to this architecture, we have gained tangible benefits in terms of both performance and power consumption, which were previously unavailable.  In fig.  3 shows the development of GP for the last five generations: graphics processors are becoming increasingly important.  Both when using h.264 and when switching to the most up-to-date h.265 codecs, graphics processors provide significant computational power, thanks to which video processing with a 4K resolution and even with a higher resolution not only becomes possible, but also runs quite fast. <br><br><img src="https://habrastorage.org/files/b69/eea/3e6/b69eea3e67bb4874b320e939ed83b674.jpg"><br>  <i>Figure 3. Development of heterogeneous architecture</i> <br><br><h2>  <font color="#0071c5">GP generation performance</font> </h2><br>  In fig.  Figure 4 shows a dramatic increase in computational power in just a few generations, in which graphics processors were structurally placed on the same chip as the CPU.  If your application uses multimedia processing, you must enable unloading on the GP to achieve acceleration of 5 times or more (depending on age and system configuration). <br><br><img src="https://habrastorage.org/files/e9f/1cb/98e/e9f1cb98eecc4cc0a1866926ca67a758.jpg"><br>  <i>Figure 4. Improved graphics processing for each generation of Intel processors.</i> <br><br><h2>  <font color="#0071c5">Getting to programming GP</font> </h2><br>  In step 1, H.264 performance is usually measured, so that you can further evaluate the performance change as the code is refined.  FFmpeg is often used to measure performance and to compare speed when using hardware acceleration.  FFmpeg is a very powerful, yet easy to use tool. <br><br>  In step 2, testing is carried out with different codecs and in different configurations.  You can enable hardware acceleration by simply replacing the codec (replace libx264 with h264_qsv) with <a href="http://www.intel.com/content/www/us/en/architecture-and-technology/quick-sync-video/quick-sync-video-general.html%3Fwapkw%3Dintel%2Bquick%2Bsync%2Bvideo">Intel Quick Sync Video</a> . <br><br>  In step 3, the use of the Intel Media SDK is added. <br><br>  Note.  This publication discusses the use of these tools in the Windows * operating system.  If you're interested in implementing for Linux *, see <a href="https://software.intel.com/en-us/articles/accessing-intel-media-server-studio-for-linux-codecs-with-ffmpeg">Accessing Intel Media Server Studio for Linux codecs using FFmpeg</a> . <br><br><h3>  <font color="#0071c5">‚ñç Encoding and decoding FFmpeg</font> </h3><br>  Start with H.264 (AVC), since h264: libx264 is a software implementation in FFmpeg by default and produces high quality software-only.  Create your own test, then measure the performance again, changing the codec from libx264 to h264_qsv.  Later we will talk about H.265 codecs. <br><br>  It should be noted that when working with video streams, one has to choose between quality and speed.  With faster processing, the quality is almost always reduced and the file size increases.  You will have to find your own acceptable level of quality based on the amount of time required for encoding.  There are 11 presets for selecting a specific combination of quality and speed - from ‚ÄúFastest‚Äù to ‚ÄúSlowest‚Äù.  There are several data rate control algorithms: <br><ul><li>  coding in 1 pass with a constant data rate (set -b: v); </li><li>  2-pass encoding with a constant data rate; </li><li>  constant speed ratio (CRF). </li></ul><br>  Intel Quick Sync Video supports decoding and encoding using Intel CPUs and integrated GP1.  Note that the Intel processor must be compatible with Quick Sync Video and with OpenCL *.  For more information, see <a href="https:/software.intel.com/en-us/articles/intel-sdk-for-opencl-applications-2013-release-notes">the Intel SDK Release Notes for OpenCL * Applications</a> .  Decoding and encoding support is embedded in FFmpeg using codecs with the <b>_qsv</b> suffix.  Currently, Quick Sync Video is supported by the following codecs: MPEG2 video, VC1 (decoding only), H.264 and H.265. <br><br>  If you want to experiment with Quick Sync Video in FFmpeg, you need to add libmfx.  The easiest way to install this library is to use the <a href="https://github.com/lu-zero/mfx_dispatch">version of libmfx</a> packaged by the developer lu_zero. <br>  Quick Sync Video hardware accelerated encoding example: <br><br> <code>ffmpeg -I INPUT -c:v h264_qsv -preset:v faster out.qsv.mp4 <br></code> <br>  FFmpeg can also use <a href="https://trac.ffmpeg.org/wiki/HWAccelIntro">hardware acceleration</a> when decoding with the <b>-hwaccel</b> parameter. <br><br>  The h264_qsv codec is very fast, but it is clear that even the slowest mode of operation with hardware acceleration is much faster than software coding with the lowest quality and the highest speed. <br>  When testing with H.265 codecs, you will either need to access the build with support for libx265, or build your own version according to the instructions in the <a href="">Coding Guide for FFmpeg and H.265</a> or in the <a href="http://x265.readthedocs.org/en/default/introduction.html">X265 documentation</a> . <br>  Example H.265: <br><br> <code>ffmpeg -I input -c:v libx265 - preset medium -x265-params crf=28 -c:a aac -strict experimental -b:a 128k output.mp4 <br></code> <br>  For more information about using FFmpeg and Quick Sync Video, see <a href="http://www.intel.com/content/dam/www/public/us/en/documents/white-papers/cloud-computing-quicksync-video-ffmpeg-white-paper.pdf">Cloud Computing Intel QuickSync Video and FFmpeg</a> . <br><br><h2>  <font color="#0071c5">Using the Intel Media SDK (sample_multi_transcode)</font> </h2><br>  To further improve performance when using FFmpeg, you need to optimize the application using the Intel Media SDK.  The Media SDK is a cross-platform API for developing and optimizing multimedia applications in such a way as to use Intel hardware acceleration with fixed functions. <br><ul><li>  If your applications and multimedia solutions are for client devices, use the <a href="https://software.intel.com/en-us/media-sdk">Intel Media SDK</a> .  It can be <a href="https://registrationcenter.intel.com/en/forms/%3Fproductid%3D2602">downloaded for free</a> . </li><li>  If your solutions are designed for embedded systems, servers, or cloud platforms, you can access the Intel Media SDK using <a href="https://software.intel.com/en-us/intel-media-server-studio">Intel Media Server Studio</a> .  This solution has a <a href="https://registrationcenter.intel.com/RegCenter/comform.aspx%3Fproductid%3D2411">free Community Edition</a> and two paid editions: <a href="https://software.intel.com/en-us/intel-media-server-studio/try-buy">Essentials and Professional</a> (they can also be used to speed up the transition to HEVC and 4K / UHD). </li></ul><br>  To get started with the Intel Media SDK, just follow a few simple steps: <br><ol><li>  Download the <a href="https://software.intel.com/en-us/articles/installing-and-running-intel-media-sdk-2014-on-windows">Intel Media SDK</a> for the target device. </li><li>  Download tutorials and read them to understand how to customize the software using the SDK. </li><li>  Install the Intel Media SDK.  If you are using Linux, see the <a href="https://software.intel.com/sites/default/files/media_server_studio_getting_started_guide.pdf">installation guide for Linux</a> . </li><li>  Download the <a href="https://software.intel.com/en-us/intel-media-server-studio-support/code-samples">sample SDK code</a> to experiment with already compiled sample applications. </li><li>  Build and run the Video Transcoding application: <i>sample_multi_transcode</i> </li></ol><br>  Commands are similar to FFmpeg commands.  Examples: <br><br> <code>VideoTranscoding_folder\_bin\x64&gt;\sample_multi_transcode.exe -hw -i::h264 in.mpeg2 -o::h264 out.h264 <br> VideoTranscoding_folder\_bin\x64&gt;\sample_multi_transcode.exe -hw -i::h265 in.mpeg2 -o::h265 out.h265 <br></code> <br>  Note that to use hardware acceleration, you must specify the <b>-hw</b> parameter in the argument list. <br>  This example also works with the HEVC decoder and encoder (h.265), but it needs to be installed from the release of Intel Media Server Studio Pro. <br>  There are many options that can be specified on the command line.  Using the <i>-u &lt;quality, speed, balanced&gt;</i> parameter <i>,</i> you can set the target usage (TU), as when using the FFmpeg presets.  TU = 4 is used by default.  In fig.  5 shows performance metrics for different TU settings. <br><br><img src="https://habrastorage.org/files/8ae/22e/2d0/8ae22e2d0e78408b8838aad57b135119.jpg"><br>  <i>Figure 5. Examples of H264 performance characteristics relative to intended use</i> <br><br>  <b>Use other Intel software tools.</b> <br>  To further refine the code, you can use Intel optimization and profiling tools, including the <a href="https://software.intel.com/en-us/gpa">Intel Graphics Performance Analyzer</a> (GPA) and <a href="https://software.intel.com/en-us/intel-vtune-amplifier-xe">Intel VTune Amplifier</a> .  In addition, the <a href="https://software.intel.com/en-us/intel-video-pro-analyzer">Intel Video Pro Analyzer</a> and <a href="https://software.intel.com/en-us/intel-stress-bitstreams-and-encoder">Intel Stress Bitstreams and Encoder</a> tools can help you achieve high quality video and streaming, improve the performance of encoders and decoders, and speed up testing so that solutions can be released to the market faster. <br><br><h2>  <font color="#0071c5">Conclusion</font> </h2><br>  Computer architecture has undergone significant changes over the past 20 years, and its development only in the last five years has given a significant increase in productivity.  Now Intel CPUs can handle multimedia directly on GP, ‚Äã‚Äãso that new usage models become available for both end users and companies. <br><br>  You can independently measure performance improvements with FFmpeg, as well as further optimize the code using the free Intel Media SDK APIs.  The transition from software processing to hardware acceleration improves system performance and reduces power consumption (and costs), and also provides additional computing resources sufficient to switch to the H.265 codec family over time. <br><br><h2>  <font color="#0071c5">Additional resources</font> </h2><br><ol><li>  <a href="https://software.intel.com/en-us/articles/installing-and-running-intel-media-sdk-2014-on-windows">Install and run the Intel Media SDK on Windows</a> </li><li>  <a href="http://ffmpeg.org/">FFMPEG.ORG</a> </li><li>  <a href="https://software.intel.com/en-us/articles/integrating-intel-media-sdk-with-ffmpeg-for-muxdemuxing-and-audio-encodedecode-usages">Intel Media SDK Integration with FFMPEG for multiplexing, demultiplexing, audio encoding, and decoding</a> </li><li>  <a href="https://software.intel.com/en-us/articles/media-sdk-tutorials-for-client-and-server">Intel Media SDK Tutorials for Clients and Servers</a> </li><li>  <a href="https://software.intel.com/en-us/gpa">Intel Graphics Performance Analyzers</a> </li><li>  <a href="https://software.intel.com/en-us/intel-vtune-amplifier-xe">Intel VTune Amplifier</a> </li><li>  <a href="https://software.intel.com/en-us/intel-media-server-studio">Intel Media Server Studio</a> </li><li>  <a href="https://communities.intel.com/community/itpeernetwork/datastack/blog/2016/02/25/accelerating-your-ffmpeg-based-applications-with-intel-quick-sync-video">Accelerate FFmpeg-based Applications with Intel Quick Sync Video</a> </li><li>  <a href="http//www.intel.com/content/dam/www/public/us/en/documents/white-papers/cloud-computing-quicksync-video-ffmpeg-white-paper.pdf">Intel QuickSync Video and FFmpeg *</a> </li><li>  <a href="http://www.intel.com/content/dam/www/public/us/en/documents/white-papers/quicksync-video-ffmpeg-install-valid.pdf">Intel QuickSync Video and FFmpeg: Installation and Verification</a> </li><li>  <a href="https://software.intel.com/en-us/articles/accessing-intel-media-server-studio-for-linux-codecs-with-ffmpeg">Access to Intel Media Server Studio for Linux codecs using FFmpeg</a> </li><li>  <a href="https://software.intel.com/en-us/blogs/2015/12/11/codecs-are-they-slowing-you-down">HEVC Codec (H.265) Value</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/301698/">https://habr.com/ru/post/301698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301676/index.html">Broadcaster for MacBook. Pivot</a></li>
<li><a href="../301682/index.html">Nutanix SX-1065 Xpress: Nutanix for the SMB Market</a></li>
<li><a href="../301684/index.html">Node-SPICE: Simulation of transients in the electrical network</a></li>
<li><a href="../301692/index.html">DevCon 2016. Opening of the conference at 10:00! Connect to the online broadcast today</a></li>
<li><a href="../301696/index.html">Implementing an auto attendant based on Cisco solutions</a></li>
<li><a href="../301700/index.html">HowTo: Connect to Cisco VPN using Aladdin eToken on Linux (Ubuntu)</a></li>
<li><a href="../301702/index.html">Functional testing of Qt programs</a></li>
<li><a href="../301706/index.html">Local positioning methods</a></li>
<li><a href="../301708/index.html">Record incoming calls</a></li>
<li><a href="../301710/index.html">How to choose ITshnika in Russia: myth number 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>