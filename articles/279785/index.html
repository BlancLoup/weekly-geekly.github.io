<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Make an autonomous photo booth on raspberry pi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the ‚Äúonline‚Äù age, print photography has become more of a curiosity, as it used to be with digital photography. Recently, various types of photo boo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Make an autonomous photo booth on raspberry pi</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/65f/672/176/65f672176371432aa7fbd2fb7c5c0ef7.jpg">  In the ‚Äúonline‚Äù age, print photography has become more of a curiosity, as it used to be with digital photography.  Recently, various types of photo booths have begun to gain popularity as an interesting way to entertain guests and get a souvenir in the form of photography.  I am a photographer who is interested in programming, and with this combination, it would be strange not to try to make a photo booth. <br>  Unlike commercial models of photo booths that are on sale, I wanted to make a really compact and autonomous system.  So that I am parallel to the main work, I could install it in a field in a couple of minutes and not carry extra tens of kilograms of weight with me.  And I did it. <br>  Under the cut there will be a story about hardware, raspberry pi and programming all of this under linux and of course my favorite python.  Looking ahead, I would say that I just wanted high-quality photos, so shooting is not on a webcam, but on a DSLR, so the article should get even more and more interesting. <br><br><a name="habracut"></a><br><br><h4>  Iron.  From simple to complex. </h4><br>  When I started this project, it was winter.  In winter, I have a lot of free time and little work, so the project should be as cheap as possible.  Besides the financial component, I love the KISS principle - the system should be as simple as possible.  From simplicity depends also on such components as reliability, size and, importantly, power consumption. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And I will begin the story about iron with how it could be done much easier, and then, in the course of working on the project, ‚Äúsimpler‚Äù was replaced with a more complex one.  Perhaps the implementation of "easier" someone come in handy. <br><br>  And so, we have a DSLR camera and the task: at the command of a person, take a picture and send it to print.  With this is actually very, very simple.  Take a button, connect it to any MK (but at least completely insert arduino).  When a person presses a button, count the number of seconds, and after this time, take a picture.  It‚Äôs also easy to take a picture on a DSLR - it‚Äôs enough to ‚Äúpretend‚Äù either with a wired remote (connects to the camera via the 2.5 jack connector and, in fact, ‚Äúcloses‚Äù two contacts), or ‚Äúpretend‚Äù with a wireless IR remote control (there are a lot of implementations under the MK).  For timing, you can use any segment indicator, or LCD display, but I planned to make an ‚Äúanalog‚Äù indication ‚Äî servo-drive and arrow.  Sending photos from the camera to print should also be no problem.  There are wonderful SD memory cards with a built-in WiFi transmitter.  By the way, I have already <a href="https://habrahabr.ru/post/216039/">written</a> in detail about this in Habr√©.  Further, on a laptop, one could already write a simple script that sends the resulting photos to print. <br><br>  Further, in my ‚Äúmental‚Äù work on the project, it was necessary to complicate the system.  In the first version, one photo is taken, but I want to make a series like in ‚Äúreal‚Äù photo booths, and print it on one sheet of paper.  This can be realized with the help of the second button (a person chooses, take one photo, or several at once).  There is a problem - how the laptop finds out which button was pressed, and accordingly print this photo, or wait another 3, for placement on one sheet.  This is also easy to solve - beloved esp8266, which can be connected to the same network as the SD card with WiFi.  It will "inform" the laptop about the choice of the user. <br><br>  The project would have remained so if I had not thought about a very important thing - people should see themselves during the shooting.  They do not know at what distance you need to approach, how many people fit into the frame, etc. There is of course the display of the camera itself, which can be included in the LiveView mode, I have already started thinking about the system of mirrors and lenses so that this picture was visible to people (the task was simplified the fact that the display on the camera is turning), but I remembered that there is an HDMI output in the camera and on the well-known ‚ÄúChinese‚Äù electronics store, there must be something I need.  As a result, a 7-inch LCD display was ordered with a controller that can receive signals from various sources, including HDMI. <br><br>  While the display was on, I decided that I really didn't want to carry a laptop with me.  It occurred to make a truly autonomous system.  And then the ‚Äúbrain‚Äù of the entire system comes on the scene - the Raspberry Pi.  With his appearance, I decided to completely entrust all the work to him: to give up the buttons, allowing the user to make buttons on the touchscreen, show him a picture from LiveView and most importantly ‚Äúapprove‚Äù the photos for printing, since it is not uncommon for a person, for example, corny "blinks" during the shooting. <br><br>  When all the parts came, I started to put everything together.  From the tools I had a soldering iron, glue gun and siding (!).  The first unit was ready display - a kind of homemade monitor. <br><br><img src="https://habrastorage.org/files/eaf/5d7/a65/eaf5d7a65b1a4c3da5cb547825a6af4a.jpg"><br><br>  In the photo above is the display controller, below is the USB touchscreen controller.  The whole set was bought on aliexpress (search <a href="http://ru.aliexpress.com/wholesale%3FcatId%3D202001115%26initiative_id%3DAS_20160321001932%26SearchText%3D7%2Binch%2Blcd%2Btouch%2Bhdmi">this way</a> ) <br>  From the display side, it looks like this: <br><br><img src="https://habrastorage.org/files/3ae/b2f/d24/3aeb2fd24c894fa6b83d08977f314b73.jpg"><br><br>  It eats the whole thing from 5 volts and consumes 700-800 milliamperes in peak. <br><br>  I made the ‚Äúcase‚Äù for raspberry pi from the same siding (this is the first thing that caught my eye, and it is very easy to work with it). <br><br><img src="https://habrastorage.org/files/0f9/125/369/0f9125369f62441cb99e299c726c8951.jpg"><br><br>  Let me explain what the "pie" turned out.  On top there is a 5 volt cooler.  I was afraid of overheating, and it turns on when the temperature reaches 55 degrees, a simple script that runs from the crown. <br><br><div class="spoiler">  <b class="spoiler_title">The script is very simple</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python import RPIO import subprocess RPIO.setwarnings(False) RPIO.setup(18,RPIO.OUT) sub=subprocess.Popen(['/opt/vc/bin/vcgencmd', 'measure_temp'],stdout=subprocess.PIPE,stderr=subprocess.PIPE,shell=False) temp=float(sub.stdout.read().split('=')[1].split("'")[0]) if temp&gt;55: RPIO.output(18,1) if temp&lt;45: RPIO.output(18,0)</span></span></code> </pre> <br><br></div></div><br><br>  On the left you can see the relay module.  It is designed to turn on the diode backlight during operation.  Let me explain why this is necessary: ‚Äã‚Äãat various banquets, during a break for dancing it can be very dark.  Illumination is needed both for autofocus operation when shooting and for people to see themselves during the ‚Äúposing‚Äù, and not the darkness on the screen.  During shooting indoors, I have a stand with a flash and a soft box, which work through a regular radio synchronizer, which is connected to the hot bashkama camera.  This way I get good light in the pictures.  Although it would be possible to leave just a diode backlight, but the quality of the pictures would be worse. <br><br>  The prototype enclosures were assembled from the same siding, in order to assess the requirements and dimensions for the final version. <br><br><img src="https://habrastorage.org/files/f44/fac/840/f44fac8406ea419e83b741b3ea08473f.jpg"><br><br>  I wanted to stylize the body itself as an old camera.  I did not dare to do it myself and ordered the production of friends who are engaged in decor.  The body is made of laminate, using kozhzam for "accordion". <br><br><img src="https://habrastorage.org/files/258/234/3fa/2582343fab5449808dd7c72be8be5807.jpg"><br><br>  The cats liked it very much, but they still had to be driven out to accommodate all the stuffing. <br><br><img src="https://habrastorage.org/files/305/197/3c4/3051973c40e441d3a04859187d8e6e39.jpg"><br><br>  It feeds the whole thing from two banks.  In theory, one would suffice for 10,000 mA / h for 5-6 hours of operation, but if both the display and the raspberry are connected simultaneously, the current load is greater and the batteries give less capacity. <br><br>  A few words about the printing of photos, for which it was started.  You can print photos on anything, even on an ordinary household inkjet printer.  But again, I needed a compact.  In addition to compactness, for autonomous work, you need more reliability.  I do not really want to worry about the level of ink, clogged nozzles, and so on. As a result, a cheap and compact thermal sublimation printer was chosen.  From the pros: small size of the printer, trouble-free printing (you can forget about the bands, stains of paint, etc.), the ability to transport and print at least upside down, durability of pictures (immediately after printing a picture dipped into the water, and he had nothing).  Of the minuses: high cost of printing and the need to replace the paper every 18 shots and tape cartridges every 36 shots.  Consumables are only original (complete, except special paper, also a special cartridge with a tape), the cost per print is 25 rubles, although this is included in the final cost of the service.  The printer works over WiFi; for this, a ‚ÄúWiFi whistle‚Äù is connected to the raspberry pi. <br><br><img src="https://habrastorage.org/files/b8b/082/f75/b8b082f75a014c73a273c6fac22aa0c4.jpg"><br><br><h4>  Soft </h4><br>  For "serial" photo booth there is a software for sale, which exists naturally only under PC and Windows.  For linux under the arm I had to write everything from scratch (oh well I had to, I just like it!).  Python was chosen as the programming language (in fact, I don't know anything else). <br><br>  First, you need to learn how to interact with a camera that is connected via USB.  I was not surprised when I discovered that there are already ready-made tools for linux.  This is a <a href="http://gphoto.sourceforge.net/">gphoto2</a> console utility. <br><br>  First of all, the settings screen was needed, which starts immediately after the system starts. <br><br><img src="https://habrastorage.org/files/5ca/cd5/d8d/5cacd5d8d35f4966909edaa301466503.jpg"><br><br>  GUI is written on Tkinter, which is more than suitable for these tasks. <br>  Here you can customize the camera for specific shooting conditions, run the main program, adjust its behavior (take one large photo, or allow you to select ‚Äúone photo‚Äù and ‚Äú4 in 1‚Äù, print or just save, as well as print mode, but about this later), and take a test snapshot.  About this in more detail. <br><br>  First, you need to write the settings in the camera, it is done simply: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     bb_list=['','','','','.','. ','',''] sub=subprocess.Popen(['gphoto2', '--set-config', 'whitebalance='+str(bb_list.index(settings['bb'])), '--set-config', 'iso='+t_iso, '--set-config', 'aperture='+settings['a'], '--set-config', 'imageformat=7' #   (jpeg  19201080) ],stdout=subprocess.PIPE,stderr=subprocess.PIPE,shell=False) err=sub.stderr.read()</span></span></code> </pre><br><br>  Now you need to take a test picture and show it on the screen. <br><br><pre> <code class="python hljs">sub=subprocess.Popen([<span class="hljs-string"><span class="hljs-string">'gphoto2'</span></span>,<span class="hljs-string"><span class="hljs-string">'--capture-image-and-download'</span></span>,<span class="hljs-string"><span class="hljs-string">'--filename'</span></span>,<span class="hljs-string"><span class="hljs-string">'/tmp/booth.jpg'</span></span>,<span class="hljs-string"><span class="hljs-string">'--force-overwrite'</span></span>],stdout=subprocess.PIPE,stderr=subprocess.PIPE,shell=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) err=sub.stderr.read()</code> </pre><br>  The camera will take a picture and it will be written to the file /tmp/booth.jpg (to speed up the work and save the resource of the memory card in raspberry, such things are better done in / tmp, which is mounted by default in tmpfs, that is, it works in RAM).  After that, the picture is displayed on the screen for evaluation, and the settings are written to the file using the usual open ('/ home / pi / settings.dat', 'wb'). Write (repr (settings)) <br><br>  So, the camera is set up, it's time to start the user interface. <br><br><img src="https://habrastorage.org/files/960/858/9c8/9608589c8c51434fa04689d303bcb32f.jpg"><br><br>  The interface itself is written using the well-known pygame library. <br>  Naturally, so that users could not click "where not to", the application runs full screen: <br><pre> <code class="python hljs">pygame.init() pygame.mouse.set_visible(<span class="hljs-number"><span class="hljs-number">0</span></span>) screen = pygame.display.set_mode((<span class="hljs-number"><span class="hljs-number">800</span></span>,<span class="hljs-number"><span class="hljs-number">480</span></span>), pygame.HWSURFACE | pygame.FULLSCREEN,<span class="hljs-number"><span class="hljs-number">32</span></span>)</code> </pre><br><br>  The architecture of the application is painfully simple: the interface is drawn from pre-stored images, and the program itself works according to the state machine method, with predetermined states.  In more detail, I would like to tell about the interaction with the camera. <br><br>  The first thing we need is to get a LiveView image from the camera so that users can see themselves while preparing for the shoot.  I tried to do it with the help of the gphoto2 utility, but for reasons I don‚Äôt remember, I didn‚Äôt succeed.  A library was found for the piggyphoto <a href="https://github.com/alexdu/piggyphoto">python</a> , where this problem is solved simply: <br><pre> <code class="python hljs">cam = piggyphoto.camera() cam.leave_locked() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> WORK: s=self.cam.capture_preview() s.save(<span class="hljs-string"><span class="hljs-string">'/tmp/preview.jpg'</span></span>) s.clean() <span class="hljs-comment"><span class="hljs-comment">#    ,       https://github.com/alexdu/piggyphoto/issues/2 from_camera = pygame.image.load('/tmp/preview.jpg') #   from_camera=pygame.transform.scale(from_camera, (800, 530)) #     from_camera=pygame.transform.flip(from_camera,1,0) #    ,        )</span></span></code> </pre><br><br>  Under the LiveView mode, you also need to configure the camera.  For example, if the shooting itself is carried out with ISO 100, then this may not be enough on LiveView.  Before switching on, you need to do something like this: <br><pre> <code class="python hljs"> sub=subprocess.Popen([<span class="hljs-string"><span class="hljs-string">'gphoto2'</span></span>, <span class="hljs-string"><span class="hljs-string">'--set-config'</span></span>, <span class="hljs-string"><span class="hljs-string">'whitebalance=0'</span></span>, <span class="hljs-comment"><span class="hljs-comment">#     '--set-config', 'iso=0', # ISO   '--set-config', 'aperture=2.8', #   '--set-config', 'imageformat=7' ],stdout=subprocess.PIPE,stderr=subprocess.PIPE,shell=False)</span></span></code> </pre><br><br>  After completing the timer, you can already do the frame itself, as described above.  If the ‚Äú4 frames in 1‚Äù mode is selected, then this is all repeated 4 times to get 4 different photos, which are then glued together into one.  The Pillow library is already engaged in this (I strongly recommend using it rather than an outdated PIL, at least because of performance), which in addition to merging several photos onto one sheet, imposes a logo, and makes it possible to do some branding: <br><br><img src="https://habrastorage.org/files/401/f21/8f2/401f218f293f4e66b807296b2d343710.jpg"><br><br>  For the demo, I made a short video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/4ulU6VZrmlg%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhi8z62JVVSkVDZFTBHf2PxzPe90EQ" frameborder="0" allowfullscreen=""></iframe><br><br>  The photo is ready, you can send it to print.  In linux, this is done with just one command: lpr FILENAME.  Sending a photo for printing over WiFi to a canon selphie printer has one nuance: the photo must be sent to print ‚Äúdirectly‚Äù, that is, the printer accepts a ready-made jpg file: lpr -o RAW filename. <br><br>  Actually, the main functionality is ready.  Later several more features were added.  The first thing that I wanted to realize was the delivery of photographs in electronic form.  Since WiFi is already working in the access point mode to which the printer is connected, why not open it.  On raspberry a web server was raised, with a simple gallery.  In order to avoid problems with the search for this web server, I configured the Captive Portal - when connected to an access point, the page with the gallery opens itself.  This is done by installing a DNS server, which for all requests gave the IP address of the web server. <br><br><img src="https://habrastorage.org/files/912/f04/20a/912f0420ac3549e8be53b44adffa1fad.jpg"><br><br>  In fact, in one article, it is impossible to tell about all the nuances.  As far as possible, I will try to answer your questions in the comments.  My next article also promises to be interesting, in which we will cross the old unusual technologies in photo printing, and new technologies in the field of software. </div><p>Source: <a href="https://habr.com/ru/post/279785/">https://habr.com/ru/post/279785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279771/index.html">MoscowJS # 29 (March 31, 2016)</a></li>
<li><a href="../279775/index.html">Report from the conference Data Fest</a></li>
<li><a href="../279777/index.html">"Gentle" balancing between multiple providers on the office gateway</a></li>
<li><a href="../279779/index.html">Case design: Coral Order e-commerce website</a></li>
<li><a href="../279781/index.html">Reg.ru fell along with all its services</a></li>
<li><a href="../279787/index.html">The main threats to site security</a></li>
<li><a href="../279789/index.html">Game development digest</a></li>
<li><a href="../279791/index.html">We go around the antivirus with ten lines of code</a></li>
<li><a href="../279793/index.html">April 8 - learn everything about the Microsoft Azure cloud in one cloudy day</a></li>
<li><a href="../279797/index.html">How to use parquet and not slip</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>