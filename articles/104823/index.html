<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript perl template engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We started with ( javascript template engine ) that it‚Äôs convenient to use the same template on the client side and on the server side. The finished r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript perl template engine</h1><div class="post__text post__text-html js-mediator-article">  We started with ( <a href="http://habrahabr.ru/blogs/webdev/104643/">javascript template engine</a> ) that it‚Äôs convenient to use the same template on the client side and on the server side.  The finished rationalization of this approach cat wept.  Blood rushes to the head, we decide to write our decision. <br><br><h4>  Outline the source data and the task </h4><br><br>  Suppose we have templates from our template engine.  On the server, they are processed by perl.  In the end, we want to use some of the available templates, or parts of them that are <b>not</b> transferred to a single file, on the client side.  It is necessary to reproduce the html generation procedures with minimal expenses (in the loss of functionality).  As a result of processing templates, we want to get a set of predefined templates and blocks, designed in the form of a javascript library.  No sooner said than done. <br><a name="habracut"></a><br><h4>  Disclaimer on ... </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below are examples of the implementation of the described parser, with the amendment that the <i>description</i> of the parser in the server language is simply not there ... That is, now you can look at the work, source code and examples of the template engine, according to the scheme: templates on the server -&gt; compilation in tmpl. js -&gt; html generation based on data in JSON format.  Well, then, if the plane takes off, you can go to the sixteenth act of Merleonsky ballet. <br><br><h4>  What do we need? </h4><br><br>  The template engine runs under perl.  We will need: <br>  - a configuration file in which we describe the matching of templates with .js libraries (we do not want all the templates in one file) and some necessary data for the template engine; <br>  - the .pm module itself which contains various methods for parsing templates; <br>  - the script, running which we will compile our libraries; <br>  - oddly enough, patterns; <br>  In accordance with the requirements, we have the following structure of files and directories (if you do not mind, then I will not rewrite the path to anonymous, in order to simplify your life, and immediately bring my working version): <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#    <br> /Users/zaur/www/blacktiger <br> #   <br> /Users/zaur/www/blacktiger/bin/Core/JS/Config.pm <br> #     <br> /Users/zaur/www/blacktiger/bin/Core/JS/Parse.pm <br> #     <br> /Users/zaur/www/blacktiger/bin/jsgen <br> #    <br> /Users/zaur/www/blacktiger/tpl <br> /Users/zaur/www/blacktiger/inc <br> #       ( ) <br> /Users/zaur/www/blacktiger/source_js <br> # ,      <br> /Users/zaur/www/blacktiger/js/tpl <br> #    html ,   <br> /Users/zaur/www/blacktiger/html</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  What can we realize? </h4><br><br>  Before describing the functional, I will tell you a little about what is actually happening.  We compiled javascript code.  By calling various functions, operators, conditions using a simple concatenation of alternating strings and variables, the variable value of the output variable (out) is formed.  In the course of executing the code, we iterate the elements of the arrays (we mostly run through the arrays of hashes, which in turn also contain references to nested structures) and fill the <i>stack</i> with the current hashes, <i>inside</i> which we are.  In the examples, I will try to decipher this puzzle, by outputting the values ‚Äã‚Äãof internal variables.  Cheer up. <br><br>  Here is a list of what we can embody in our templates, having in addition to the above listed JSON data: <br>  - access to variables with different levels of nesting; <br>  - iteration of array elements; <br>  - conditional operators if / else if / else; <br>  - inclosions; <br>  - reuse of blocks within the template; <br>  - use for generating html blocks allocated in templates (analog of the inclusion, with the only exception that you do not need to create a separate file); <br><br><h4>  Let's get started ... </h4><br>  Template <br>  /Users/zaur/www/blacktiger/tpl/sambuka.htm <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">&lt;</font> <font color="#800000">h3</font> <font color="#0000ff">&gt;</font> {$ cfg.host} <font color="#0000ff">&lt;/</font> <font color="#800000">h3</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font> {#title} <font color="#0000ff">&lt;/</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> </li><li>  {% topics} </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">= "li - {# id}"</font> {? # <font color="#ff0000">id</font> == <font color="#ff0000">3</font> } <font color="#ff0000">class</font> <font color="#0000ff">= "sel"</font> {/?} <font color="#0000ff">&gt;</font> {#title} <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> </li><li>  {/% topics} </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  Our javascript code and data: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> d1 = { <br> title: <font color="#A31515">'   ‚Äì !'</font> , <br> topics: [ <br> {title: <font color="#A31515">''</font> , id: 1}, <br> {title: <font color="#A31515">''</font> , id: 2}, <br> {title: <font color="#A31515">''</font> ,  id: 3}, <br> {title: <font color="#A31515">''</font> ,  id: 4} <br> ] <br> }; <br> <font color="#0000ff">var</font> jstpl = <font color="#0000ff">new</font> myfirst(); <br> <font color="#0000ff">var</font> html1 = jstpl.tpl( <font color="#A31515">'tpl_sambuka'</font> ,d1); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h4>  Result html </h4><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">h3</font> <font color="#0000ff">&gt;</font> blacktiger <font color="#0000ff">&lt;/</font> <font color="#800000">h3</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font>    ‚Äì ! <font color="#0000ff">&lt;/</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-1"</font> <font color="#0000ff">&gt;</font>  <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-2"</font> <font color="#0000ff">&gt;</font>  <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-3"</font> <font color="#ff0000">class</font> <font color="#0000ff">="sel"</font> <font color="#0000ff">&gt;</font>  <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-4"</font> <font color="#0000ff">&gt;</font>  <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h4>  We will understand ... </h4><br>  Go through the lines of the template: <br>  1. In the Config.pm file there is a hash% jsd.  By writing {$ cfg.host}, we got the value of $ jsd {'host'}.  If we complicate this expression like {$ cfg.path.to.element}, then we will substitute the value $ jsd {'path'} {'to'} {'element'}.  This is <i>access to variables with different levels of access</i> . <br>  2. In the template, we passed the hash <i>d1</i> .  The {#title} entry is equivalent to d1.title in this case.  In this case, jstpl.data.cur_arg.title was actually transferred there. <br>  3. Easy, this is a simple html. <br>  4., 6. {% topics} {/% topics} Turned into a type construction <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i=0; i&lt;d1.topics.length; i++) { <br> <font color="#008000">//...</font> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Weighed down with utility operations to stack, iterator calculations, etc. <br>  This construct is referred to as <i>a data object</i> .  This is usually a hash array, but perhaps using an array of arrays.  The following describes the complete syntax for invoking an object, including specifying the data source, slice, method, executed at each iteration. <br>  5. a.  We see the variable call {#title}.  Unlike the previous time, here the context of calling this variable is the current iterated hash of the topics array.  How within this context to get d1.title value?  You need to use the template argument 'tpl_sambuka', it looks like this {@ tpl_sambuka.title}.  The variable d1.topics [i] .title has the full syntax of the call {# topics.title}, i.e.  it always starts with the name of the object.  Accessing an object's nested elements always begins with specifying the object name. <br>  5 B.  Conditional if (exp) {then} operator.  As <i>exp</i> , the above described variables (but without braces) and javascript operators can be used.  And here you need to be careful.  We remember that templates are also used by the server language, so you need to remember about compatibility. <br>  7. And here it is, again html, just html. <br><br><h5>  Now a little more about the operators </h5><br>  - Variables, what they eat and how you can use: <br>  1. {$ cfg.path.to.element} access to $ jsd {'path'} {'to'} {'element'} <br>  {#title}, {# topics.title}, {# _current.title} are all references to the same variable. <br>  {# list.path.to.element} nested elements of the list object <br>  2. {@irow [# topics._level_irow-1] title} stack of current object hashes and pattern arguments.  # topics._level_irow nesting level of the current hash of the object of topics.  The total is the value of the d1.title variable. <br>  3. Variable loop iterator. <br>  {#}, {# topics. #}, {#_iterator}, {# topics._iterator} <br>  These are all the values ‚Äã‚Äãof one variable (i in the cycle) with the only condition (for human, not computer logic) that starts from 1. That is, for a cycle with indices 0 ... 5, the variable will take the value 1 ... 6 <br>  4. Full object syntax <br>  {% nameobj =&gt; # source.obj [3..5]: myloopfunction} ... {/% nameobj} <br>  This is the complete syntax for calling an object. <br>  If we do not specify the source (# source.obj), then the data will be taken from the {#nameobj} variable of the current hash. <br>  5. Blocks <br>  If we enclose some part of the code in the tags {@myblockname} html {/ @ myblockname}, then later in the same template we can use this block {@ block.myblockname.html} - this place will be replaced by what we have framed tags earlier.  In this case, the modifier .sub will insert a framed area, while performing the template enclosed in tags. <br>  6. Blocks from external templates <br>  An example of our entry in Config.pm <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@jslib = ( <br> { <br> name = <font color="#0000ff">&gt;</font> 'myfirst', <br> list_tpl = <font color="#0000ff">&gt;</font> [ <br> 'tpl_sambuka' <br> ], <br> blocks = <font color="#0000ff">&gt;</font> { <br> tpl_auth = <font color="#0000ff">&gt;</font> [ <br> 'auth_form' <br> ] <br> } <br> } <br> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  We recorded that we want to use the auth_form block from the tpl_auth template.  In the template, you can use <br>  {@ block.tpl_auth.auth_form.html} insert simply as html <br>  {@ block.tpl_auth.auth_form.sub} insert into the template by executing the specified code <br>  6. Inclodes <br>  {&amp; tpl_myother_tpl} <br>  Inserts the tpl_myother_tpl template into the current template, while the <i>current</i> hash will be the hash from the called context in it.  Oh, how confusing. <br>  {&amp; tpl_myother_tpl =&gt; # source.data} <br>  By invoking an incloud in this way - we indicate to it as the current hash # source.data, this will also be included in the arguments <br>  {@ tpl_myother_tpl.title} within the myother template is equivalent to # source.data.title <br><br><h4>  Example with blocks, inclusions and recursion </h4><br><br>  Here is the last example in which we will use blocks from external templates, inclusions, blocks from the current template to create a recursive walk through the <i>tree.</i> <br>  Tpl / area.htm template <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">&lt;</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font> {#title} <font color="#0000ff">&lt;/</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font> </li><li>  {&amp; inc_header = <font color="#0000ff">&gt;</font> #headerinfo} </li><li></li><li>  {@tree} </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> </li><li>  {% menu = <font color="#0000ff">&gt;</font> #childs} </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">= "li - {# id}"</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [{#}] {#title} <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> </li><li>  {? #childs} </li><li>  {@ block.tree.sub} </li><li>  {/?} </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> </li><li>  {/% menu} </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> </li><li>  {/ @ tree} </li><li></li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font> Here‚Äôs a block from another template <font color="#0000ff">&lt;/</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font> </li><li>  {@ block.tpl_auth.auth_form.html} </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  The auth_form block from the tpl / auth.htm template <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">{@auth_form} <br> <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="d-auth"</font> <font color="#0000ff">&gt;</font> <br> : <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">type</font> <font color="#0000ff">="text"</font> <font color="#ff0000">value</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">br</font> <font color="#0000ff">&gt;</font> <br> : <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">type</font> <font color="#0000ff">="password"</font> <font color="#ff0000">value</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">br</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">type</font> <font color="#0000ff">="button"</font> <font color="#ff0000">value</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> <br> {/@auth_form}</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Javascript code and data <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> d2 = { <br> headerinfo : { <br> title: <font color="#A31515">'  '</font> <br> }, <br> title: <font color="#A31515">'   ‚Äì !'</font> , <br> childs : [ <br> { id : 1, title : <font color="#A31515">'  '</font> }, <br> { <br> id : 2, <br> title : <font color="#A31515">'  '</font> , <br> childs : [ <br> { id : 5, title : <font color="#A31515">'  '</font> }, <br> { <br> id : 6, <br> title : <font color="#A31515">'  '</font> , <br> childs : [ <br> { id : 8, title : <font color="#A31515">'  '</font> }, <br> { id : 9, title : <font color="#A31515">'  '</font> } <br> ] <br> }, <br> { id : 7, title : <font color="#A31515">'  '</font> } <br> ] <br> }, <br> { id : 3, title : <font color="#A31515">'  '</font> }, <br> { id : 4, title : <font color="#A31515">'  '</font> } <br> <br> ] <br> <br> }; <br> <font color="#0000ff">var</font> jstpl = <font color="#0000ff">new</font> myfirst(); <br> <font color="#0000ff">var</font> html2 = jstpl.tpl( <font color="#A31515">'tpl_area'</font> ,d2);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Let's get this html: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font>    ‚Äì ! <font color="#0000ff">&lt;/</font> <font color="#800000">h1</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">h3</font> <font color="#0000ff">&gt;</font>    <font color="#0000ff">&lt;/</font> <font color="#800000">h3</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-1"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 1 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-2"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 2 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-5"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 1 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-6"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 2 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-8"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 1 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-9"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 2 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-7"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 3 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-3"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 3 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#ff0000">id</font> <font color="#0000ff">="li-4"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> [ 4 ]    <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font>       <font color="#0000ff">&lt;/</font> <font color="#800000">h4</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="d-auth"</font> <font color="#0000ff">&gt;</font> <br> : <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">id</font> <font color="#0000ff">="login"</font> <font color="#ff0000">class</font> <font color="#0000ff">="inp"</font> <font color="#ff0000">value</font> <font color="#0000ff">=""</font> <font color="#ff0000">type</font> <font color="#0000ff">="text"</font> <font color="#0000ff">&gt;</font> <br> : <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">id</font> <font color="#0000ff">="pswd"</font> <font color="#ff0000">class</font> <font color="#0000ff">="inp "</font> <font color="#ff0000">value</font> <font color="#0000ff">=""</font> <font color="#ff0000">type</font> <font color="#0000ff">="password"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">id</font> <font color="#0000ff">="btn-login"</font> <font color="#ff0000">value</font> <font color="#0000ff">=""</font> <font color="#ff0000">type</font> <font color="#0000ff">="button"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  Let's figure it out ... </h4><br><br>  I have never mentioned anywhere that after editing the templates, you need to run the script ./bin/jsgen every time - this is one of the dark sides of the solution.  Only modified templates will be regenerated (timestamp of file modification time is tracked).  To force regeneration of all templates, you need to run a script with the -all key <br>  ./bin/jsgen -all <br>  Do not forget to set the rights to jsgen corresponding <br>  chmod 775 <br>  One more thing.  In Config.pm we have an array <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@templates = ( <br> { pm  = <font color="#0000ff">&gt;</font> "Tpl", ext  = <font color="#0000ff">&gt;</font> '.htm',  dir  = <font color="#0000ff">&gt;</font> "tpl" }, <br> { pm  = <font color="#0000ff">&gt;</font> "Inc", ext  = <font color="#0000ff">&gt;</font> '.inc',  dir  = <font color="#0000ff">&gt;</font> "inc" } <br> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  He tells us that there are two folders in the root directory, <i>tpl</i> and <i>inc</i> , which contain template files with the extensions .htm and .inc, respectively.  There may be subfolders in these folders (this doesn‚Äôt need to be reflected in the config file).  Suppose we created a file <br>  inc / news / rubric / index.inc <br>  Refer to this template need to name 'inc_news_rubric_index' <br><br>  The file myfirst.js is located in the / js / tpl directory (Config.pm =&gt; $ cfg {jstpl}) <br><br>  As mentioned above, we want to do different assemblies of templates. <br>  I‚Äôll give an example of our entry in Config.pm again. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@jslib = ( <br> { <br> name = <font color="#0000ff">&gt;</font> 'myfirst', <br> list_tpl = <font color="#0000ff">&gt;</font> [ ... ], <br> blocks = <font color="#0000ff">&gt;</font> {...} <br> },{ <br> name = <font color="#0000ff">&gt;</font> 'mysecond', <br> list_tpl = <font color="#0000ff">&gt;</font> [ ... ], <br> blocks = <font color="#0000ff">&gt;</font> {...} <br> } <br> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The @jslib array contains information about such assemblies. <br>  name - the name of the file and class at the same time. <br>  list_tpl - all templates (both from the tpl folder, and from inc, and any other ones added by you (not embedded in the data) and described in the config file) <br>  blocks - names of templates and blocks in them that will be used in the assembly <br><br>  By line numbers in the area.htm template: <br>  2. Call incl header / inc.inc and transfer it to d2.headerinfo as the current hash <br>  4., 15.  Declare a tree block <br>  6., 13.  We declare a menu object, the #childs from the current hash is passed as the data source.  For recursion, it is important that this is equally indicated in the root element and in the descendants.  Sample data is shown above. <br>  10. Call the indicated block as a function.  That is, all code framed by block tags will be executed with the current hash (the condition checks for the descendants of #childs) <br>  18. Call the external block auth_form from the template tpl / auth.htm as a simple html <br><br><h4>  the end </h4><br><br>  So, rather cumbersome in appearance, we get a rather multi-functional template for javascript.  It is not much less than the template engine that runs on server scripts (its own nuances).  And due to the absence of regular expressions in the compiled code, it can boast a solid speed.  The minus that kills me sometimes is the need to run the regeneration script after changing the template ... <br><br>  I apologize if everything is complicatedly explained, there is no detailed documentation yet.  If someone is interested, you can continue the description, but already with the template engine on perl on the server side, to cover the whole bunch <br><br>  Source code of all mentioned files, <a href="">link</a> <br>  Do not forget to fix the file bin / Core / JS / Config.pm </div><p>Source: <a href="https://habr.com/ru/post/104823/">https://habr.com/ru/post/104823/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../104812/index.html">Google Voice Search on Galaxy S</a></li>
<li><a href="../104813/index.html">Google go!</a></li>
<li><a href="../104814/index.html">unix dev</a></li>
<li><a href="../104816/index.html">The capital of Russian electric vehicles</a></li>
<li><a href="../104820/index.html">Microsoft Security Essentials is now available for small businesses.</a></li>
<li><a href="../104825/index.html">Web Standards Days in Kiev - reports and reports</a></li>
<li><a href="../104829/index.html">Marvell Announces Triple-Core ARM Processor</a></li>
<li><a href="../104830/index.html">The Japanese have created a robot actor</a></li>
<li><a href="../104831/index.html">For Ubuntu, an interface is created that responds to the user's movement through the webcam.</a></li>
<li><a href="../104835/index.html">In the US, they opened the "white frequencies" for providers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>