<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hacker's guide to neural networks. Schemes of real values. Become a master back propagation error</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Content: 
 Chapter 1: Real Value Schemes  Part 1: 


 : ‚Ññ1:   
 Part 2: 


  ‚Ññ2:  
 Part 3: 


  ‚Ññ3:  
 Part 4: 


   
 Part 5: 


  ¬´¬ª " " 
 Part 6: ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hacker's guide to neural networks. Schemes of real values. Become a master back propagation error</h1><div class="post__text post__text-html js-mediator-article">  Content: <br><div class="spoiler">  <b class="spoiler_title">Chapter 1: Real Value Schemes</b> <div class="spoiler_text">  <a href="http://habrahabr.ru/company/paysto/blog/244723/">Part 1:</a> <br><pre><code class="html hljs xml">  :        ‚Ññ1:   </code> </pre> <br>  <a href="http://habrahabr.ru/company/paysto/blog/244935/">Part 2:</a> <br><pre> <code class="html hljs xml">  ‚Ññ2:  </code> </pre><br>  <a href="http://habrahabr.ru/company/paysto/blog/245051/">Part 3:</a> <br><pre> <code class="html hljs xml">  ‚Ññ3:  </code> </pre><br>  <a href="http://habrahabr.ru/company/paysto/blog/245403/">Part 4:</a> <br><pre> <code class="javascript hljs">        </code> </pre><br>  <a href="http://habrahabr.ru/company/paysto/blog/246093/">Part 5:</a> <br><pre> <code class="javascript hljs">   ¬´¬ª   <span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre><br>  <a href="http://habrahabr.ru/company/paysto/blog/246397/">Part 6:</a> <br><pre> <code class="javascript hljs">     </code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Chapter 2: Machine Learning</b> <div class="spoiler_text">  <a href="http://habrahabr.ru/company/paysto/blog/246523/">Part 7:</a> <br><pre> <code class="javascript hljs">  </code> </pre><br>  <a href="http://habrahabr.ru/company/paysto/blog/246849/">Part 8:</a> <br><pre> <code class="javascript hljs">        (SVM)</code> </pre><br>  <a href="http://habrahabr.ru/company/paysto/blog/246973/">Part 9:</a> <br><pre> <code class="javascript hljs">  SVM   </code> </pre><br>  <a href="http://habrahabr.ru/company/paysto/blog/247033/">Part 10:</a> <br><pre> <code class="javascript hljs">   :  </code> </pre><br></div></div><br><br>  Over time, you can write back passages much more efficiently, even for complex circuits and for everything at once.  Let's practice a little backtracking on a few examples.  In the following, we will simply use variables such as a, b, c, x, and their gradients will be called da, db, dc, dx, respectively.  Again, we represent variables as a ‚Äúforward flow,‚Äù and their gradients as a ‚Äúreverse flow‚Äù along each line.  Our first example was the logical element *: <br><a name="habracut"></a><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a * b; <span class="hljs-comment"><span class="hljs-comment">//     x (dx),  ,          : var da = b * dx; var db = a * dx;</span></span></code> </pre><br>  In the above code, I assume that we have been given the variable dx, which comes from somewhere above the scheme, while we perform backward error propagation (or otherwise, it defaults to +1).  I write it out, because I want to clearly show how the gradients are related.  Note that in equations, the logic element * acts as a switch in the process of backward pass.  He remembers what his original values ‚Äã‚Äãwere, and the gradients for each value will be equal to the other in the process of backward passage.  And then, of course, we will have to multiply it by the gradient above, which is a chain rule.  This is what the logical element + looks like in a compressed form: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a + b; <span class="hljs-comment"><span class="hljs-comment">// -&gt; var da = 1.0 * dx; var db = 1.0 * dx;</span></span></code> </pre><br>  Where 1.0 is a local gradient, and multiplication is our chain rule.  But what about the addition of three numbers ?: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   x = a + b + c   : var q = a + b; //   1 var x = q + c; //   2 //  : dc = 1.0 * dx; //       dq = 1.0 * dx; da = 1.0 * dq; //       db = 1.0 * dq;</span></span></code> </pre><br>  You understand what is happening?  If you remember <a href="http://habrahabr.ru/company/paysto/blog/245403/">the reverse flow scheme</a> , the logical element + just takes the gradient from above and sends it equally to all its original values ‚Äã‚Äã(since its local gradient is always just 1 for all its original values, regardless of their actual values).  Therefore, we can do it much faster: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a + b + c; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> da = <span class="hljs-number"><span class="hljs-number">1.0</span></span> * dx; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> db = <span class="hljs-number"><span class="hljs-number">1.0</span></span> * dx; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dc = <span class="hljs-number"><span class="hljs-number">1.0</span></span> * dx;</code> </pre><br>  Well, what about combining logical elements ?: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a * b + c; <span class="hljs-comment"><span class="hljs-comment">//  dx,           =&gt; da = b * dx; db = a * dx; dc = 1.0 * dx;</span></span></code> </pre><br>  If you do not understand what is happening above, let's enter a temporary variable q = a * b, then we calculate x = q + c to check everything.  And here is our neuron, so let's calculate everything in two stages: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       : var q = a*x + b*y + c; var f = sig(q); // sig ‚Äì    //    ,   df, : var dq = (q * (1 - q)) * df; //         var da = x * dq; var dx = a * dq; var dy = b * dq; var db = y * dq; var dc = 1.0 * dq;</span></span></code> </pre><br>  I hope something clears up here.  And now, how about this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a * a; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> da = <span class="hljs-comment"><span class="hljs-comment">//???</span></span></code> </pre><br>  You can consider this example as a value moving towards the logical element *, but the line is divided and represents both of the original values.  This is actually simple, as the backflow of gradients is always added.  In other words, nothing changes: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> da = a * dx; <span class="hljs-comment"><span class="hljs-comment">//  a    da += a * dx; //       </span></span></code> </pre><br>  // shorter form looks like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> da = <span class="hljs-number"><span class="hljs-number">2</span></span> * a * dx;</code> </pre><br>  I hope you remember that the derivative of the function <i>f (a) = a ^ 2</i> is <i>2a</i> , which is exactly the value that we get if we represent it as a line divided into two initial values ‚Äã‚Äãof the logical element. <br>  Let's look at another example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = a*a + b*b + c*c; <span class="hljs-comment"><span class="hljs-comment">//  : var da = 2*a*dx; var db = 2*b*dx; var dc = 2*c*dx;</span></span></code> </pre><br>  Well, now let's complicate things a bit: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(((a * b + c) * d), <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">// pow(x,2)      JS</span></span></code> </pre><br>  When more complex cases come across in practice, I like to divide the expression into parts that are easy to solve, which almost always consist of simpler expressions, after which I link them using the chain rule: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x1 = a * b + c; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x2 = x1 * d; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = x2 * x2; <span class="hljs-comment"><span class="hljs-comment">//      x //         : var dx2 = 2 * x2 * dx; //     x2 var dd = x1 * dx2; //     d var dx1 = d * dx2; //     x1 var da = b * dx1; var db = a * dx1; var dc = 1.0 * dx1; // !</span></span></code> </pre><br>  It was easy.  These are backpropagation equations for the whole expression, and we did it bit by bit, and then we did the backward propagation for all variables.  Again, note that for each variable in the process of going forward, we had an equivalent variable during the backward pass, which contains a gradient with respect to the final result of the circuit.  Here are some more useful features and their local gradients that can be useful in practice: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">1.0</span></span>/a; <span class="hljs-comment"><span class="hljs-comment">//  var da = -1.0/(a*a);      : var x = (a + b)/(c + d); //    : var x1 = a + b; var x2 = c + d; var x3 = 1.0 / x2; var x = x1 * x3; //    //     ,    : var dx1 = x3 * dx; var dx3 = x1 * dx; var dx2 = (-1.0/(x2*x2)) * dx3; //  ,   ,    var da = 1.0 * dx1; // , ,    var db = 1.0 * dx1; var dc = 1.0 * dx2; var db = 1.0 * dx2;</span></span></code> </pre><br>  I hope you understand that we split the expressions, perform forward passage, after which for each variable (for example, a) we look for the derivative of its gradient da when moving in the opposite direction, taking turns using simple local gradients and associating them with the upper gradients.  Here is another example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(a, b); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> da = a === x ? <span class="hljs-number"><span class="hljs-number">1.0</span></span> * dx : <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> db = b === x ? <span class="hljs-number"><span class="hljs-number">1.0</span></span> * dx : <span class="hljs-number"><span class="hljs-number">0.0</span></span>;</code> </pre><br>  Here, a very simple expression becomes hard to read.  The max function passes the initial value that was the largest and ignores the rest.  During the backward pass, the logic element max will simply take the gradient from the top and direct it to the original value, which actually flowed through it as it passes forward.  The logical element acts as a simple switch based on which source element had the most value when going forward.  Other initial values ‚Äã‚Äãwill have a zero gradient.  That is what it means ===, since we check what the initial value was actually maximum, and just direct the gradient to it. <br><br>  Finally, let's look at the non-linearity of the rectified linear element (ReLU), which you probably heard about.  It is used in neural networks instead of sigmoid function.  It simply crosses the threshold at zero: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(a, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">//           : var da = a &gt; 0 ? 1.0 * dx : 0.0;</span></span></code> </pre><br>  In other words, this logical element simply passes the value if it is greater than 0, or stops the stream and sets it equal to zero.  During the backward pass, the logic element will transmit the gradient from above, if it is activated during the forward passage, or if the original initial value was below zero, it will stop the flow of the gradient. <br><br>  At this moment I will stop.  I hope you understand a little bit how you can calculate whole expressions (which consist of many logical elements) and how you can calculate the inverse error propagation for each of them. <br>  All that we have done in this chapter comes down to the following: We realized that we can enter some initial value through a complex arbitrary scheme with real values, push the end of the scheme with some force, and the reverse propagation of error will transmit this impetus to the entire scheme back to the original values.  If the initial values ‚Äã‚Äãreact slightly along the opposite direction of their push, the circuit will ‚Äúfeed‚Äù slightly towards the original direction of tension.  Perhaps this is not so obvious, but such an algorithm is a powerful hammer for learning the machine. </div><p>Source: <a href="https://habr.com/ru/post/246397/">https://habr.com/ru/post/246397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246385/index.html">Outside net neutrality</a></li>
<li><a href="../246387/index.html">The digest of interesting materials for mobile developer # 84 (December 15-21)</a></li>
<li><a href="../246389/index.html">How did the outgoing year affect our salaries?</a></li>
<li><a href="../246391/index.html">PyCon UK 2014</a></li>
<li><a href="../246395/index.html">Urban Airship closes free license</a></li>
<li><a href="../246399/index.html">Math auctions. Lecture in Yandex</a></li>
<li><a href="../246401/index.html">Impact Mapping in practice</a></li>
<li><a href="../246403/index.html">GPS monitoring for personal use (part 4. Systems Overview)</a></li>
<li><a href="../246405/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ27 (December 15 - 21, 2014)</a></li>
<li><a href="../246407/index.html">ZeptoLab started building a corporate university</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>