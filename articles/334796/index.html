<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Android works, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this series of articles, I will talk about the internal Android device ‚Äî about the boot process, about the contents of the file system, about Binde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Android works, part 1</h1><div class="post__text post__text-html js-mediator-article"><p> <a href=""><img src="https://habrastorage.org/web/87e/057/428/87e057428c6a414e9981373293affc51.png"></a> </p><br><p>  In this series of articles, I will talk about the internal Android device ‚Äî about the boot process, about the contents of the file system, about Binder and Android Runtime, about what the applications consist of, how they are installed, run, work and interact, about the Android Framework, and how Android is secured. </p><a name="habracut"></a><br><p>  Articles series: </p><br><ul><li>  How Android works, part 1 </li><li>  <a href="https://habrahabr.ru/company/solarsecurity/blog/338292/">How Android works, part 2</a> </li><li>  <a href="https://habrahabr.ru/company/solarsecurity/blog/338494/">How Android works, part 3</a> </li><li>  <a href="https://habr.com/company/solarsecurity/blog/427431/">How Android works, part 4</a> </li><li>  ... </li></ul><br><hr><br><h2 id="nemnogo-faktov">  Some facts </h2><br><p>  Android is the most popular operating system and application platform, with <a href="https://www.blog.google/products/android/2bn-milestone/">more than two <em>billion</em></a> active users.  It employs completely different devices, from the ‚ÄúInternet of Things‚Äù and smart watches to TVs, laptops and cars, but most often Android is used on smartphones and tablets. </p><br><p>  Android is a free and open source project.  Most of the source code (which can be found at <a href="https://source.android.com/">https://source.android.com</a> ) is distributed under the free Apache 2.0 license. </p><br><p>  Android Inc.  was founded in 2003 and purchased in 2005 by Google.  The Android public beta <a href="https://android-developers.googleblog.com/2007/11/posted-by-jason-chen-android-advocate.html">was released</a> in 2007, and the <a href="https://android-developers.googleblog.com/2008/09/announcing-android-10-sdk-release-1.html">first stable version</a> is in 2008, since then major releases are released about once a year.  The latest stable version of Android at the time of writing is 7.1.2 Nougat. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f40/9d9/469/f409d9469fbdfd3e1453470403ddb98e.png"></p><br><h2 id="android-islinux">  Android is Linux </h2><br><p>  There was a lot of controversy about this wording, so I‚Äôll explain at once what I mean by this phrase: Android is based on the Linux kernel, but differs significantly from most other Linux systems. </p><br><p>  Among the original Android development team was Robert Love, one of the most famous Linux kernel developers, and even now Google remains one of the most active contributors to the core, so it‚Äôs not surprising that Android is based on Linux. </p><br><p>  As with other Linux systems, the Linux kernel provides such low-level things as memory management, data protection, support for multiprocessing and multithreading.  But - with a few exceptions - you will not find other familiar components of GNU / Linux systems in Android: there is nothing from the GNU project, X.Org, or even systemd is not used.  All of these components are replaced by analogs that are more suitable for use in conditions of limited memory, low processor speed and minimal power consumption ‚Äî thus, Android looks more like a embedded Linux system than GNU / Linux. </p><br><p>  Another reason that GNU software is not used by Android is the well-known ‚Äúno GPL in userspace‚Äù policy: </p><br><blockquote>  We are sometimes asked why the Apache Software License 2.0 is the preferred license for Android.  For userspace (that is, non-kernel) software, as well as other licenses like BSD, MIT, etc. over other licenses such as the LGPL. <br><br>  Android is about freedom and choice.  It is possible to make it possible.  We want you to make it so.  Using the LGPL libraries would often not do that. </blockquote><p>  The Linux kernel itself in Android is also <em>slightly</em> modified: several small components were added, including <a href="https://lwn.net/Articles/452035/">ashmem</a> (anonymous shared memory), Binder driver (part of the large and important Binder framework, which I will discuss below), wakelocks (hibernation management), and low memory killer.  Initially, they were patches to the kernel, but their code was quickly added back to the upstream core.  However, you will not find them in ‚Äúnormal Linux‚Äù: most other distributions disable these components during assembly. </p><br><p>  Android is not using the GNU C library ( <a href="https://www.gnu.org/software/libc/">glibc</a> ) as the libc (standard C library), but its own minimalistic implementation called <a href="https://android.googlesource.com/platform/bionic/">bionic</a> , optimized for embedded (embedded) systems ‚Äî it is much faster, smaller and less demanding on memory than glibc, which is overgrown with multiple layers of compatibility. </p><br><p>  In Android, there is a command line shell (shell) and many standard for Unix-like systems of commands / programs.  Embedded systems typically use the <a href="https://www.busybox.net/">Busybox</a> package, which implements the functionality of many commands in one executable file;  Android uses an analogue called <a href="http://landley.net/toybox/">Toybox</a> .  As in the "normal" distributions of Linux (and unlike embedded systems), the main way to interact with the system is a graphical interface, not the command line.  However, it is very easy to get to the command line - just run the terminal emulator application.  By default, it is usually not installed, but it is easy, for example, to download from the Play Store ( <a href="https://play.google.com/store/apps/details%3Fid%3Djackpal.androidterm">Terminal Emulator for Android</a> , <a href="https://play.google.com/store/apps/details%3Fid%3Dyarolegovich.materialterminal">Material Terminal</a> , <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.termux">Termux</a> ).  In many "advanced" Android distributions, such as <a href="https://lineageos.org/">LineageOS</a> (formerly CyanogenMod), the terminal emulator is preinstalled. </p><br><p> <a href=""><img src="https://habrastorage.org/web/33e/8ed/367/33e8ed36725e4c66834ac2d85ca9cf21.png" alt="Terminal emulator on android"></a> </p><br><p>  The second option is to connect to an Android device from a computer via the <a href="https://developer.android.com/studio/command-line/adb.html">Android Debug Bridge</a> (adb).  This is very similar to connecting via SSH: </p><br><pre><code class="bash hljs">user@desktop-linux$ adb shell android$ uname Linux</code> </pre> <br><p>  Of the other familiar components, Android uses the <a href="https://www.freetype.org/">FreeType</a> library (for displaying text), the <a href="https://developer.android.com/guide/topics/graphics/opengl.html">OpenGL ES</a> , EGL and <a href="https://developer.android.com/ndk/guides/graphics/index.html">Vulkan</a> graphic APIs, as well as the lightweight <a href="https://developer.android.com/training/basics/data-storage/databases.html">SQLite</a> DBMS. </p><br><p>  In addition, earlier <a href="https://webkit.org/">WebKit</a> browser engine was used to implement <a href="https://developer.android.com/reference/android/webkit/WebView.html">WebView</a> , but <a href="https://developer.android.com/about/versions/nougat/android-7.0.html">starting from version 7.0</a> , the installed Chrome application is used instead (or another; the list of applications allowed to act as a WebView provider is <a href="">configured</a> at the system compilation stage).  Inside, Chrome also uses WebKit-based <a href="https://www.chromium.org/blink">Blink</a> engine, but unlike the system library, Chrome is updated via the Play Store ‚Äî so all applications that use WebView automatically receive the latest improvements and fixes for vulnerabilities. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0b2/bf0/c59/0b2bf0c598d522c3d3b132eae27e7aca.png" alt="Android technology stack"></p><br><h2 id="its-all-aboutapps">  It's all about apps </h2><br><p>  As you can easily see, using Android is fundamentally different from using ‚Äúregular Linux‚Äù - you do not need to open and close applications, you just switch between them, as if all applications are always running.  Indeed, one of the unique features of Android is that applications do not directly control the process in which they are running.  Let's talk about this in more detail. </p><br><p>  The basic unit in Unix-like systems is the process.  Both low-level system services, and individual commands in the shell, and graphical applications are processes.  In most cases, the process is a black box for the rest of the system ‚Äî the other components of the system do not know and do not care about its condition.  The process starts with a call to the <code>main()</code> function <code>main()</code> actually <code>_start</code> ), and then implements some of its own logic, interacting with the rest of the system through system calls and simple interprocess communication (IPC). </p><br><p>  Since Android is also Unix-like, all this is true for it, but while low-level parts - at the Unix level - operate on the concept of a process, at a higher level - the Android Framework level - the main unit is the <em>application</em> .  The application is not a black box: it consists of individual components well known to the rest of the system. </p><br><p>  Android applications have no <code>main()</code> function, no single entry point.  In general, Android abstracts as much as possible the concept of an <em>application launched</em> from both the user and the developer.  Of course, the application process needs to be started and stopped, but Android does it automatically (I will talk more about this in the next articles).  The developer is invited to implement several separate components, each of which has its own life cycle. </p><br><blockquote>  In Android, however, we‚Äôve been a function () function, because we‚Äôve been running.  It‚Äôs not always a problem. it can be used even if it isn‚Äôt currently running. </blockquote><p>  To implement such a system, applications need to be able to communicate with each other and with system services ‚Äî in other words, you need a very advanced and fast IPC mechanism. </p><br><p>  This mechanism is Binder. </p><br><h2 id="binder">  Binder </h2><br><p>  Binder is a platform for fast, convenient and object-oriented interprocess communication. </p><br><p>  Binder development began at Be Inc.  (for BeOS), then it was ported to Linux and opened.  The main developer of Binder, Dianne Hackborn, has been and remains one of the main developers of Android.  During the development of Android, Binder has been completely rewritten. </p><br><p>  Binder does not work on top of System V IPC (which is not even supported in bionic), but uses its own small kernel module, which userspace interacts with through user calls (mainly <code>ioctl</code> ) on the ‚Äúvirtual device‚Äù <code>/dev/binder</code> .  From the userspace side, low-level work with Binder, including interaction with <code>/dev/binder</code> and marshalling / unmarshalling data, is implemented in the <a href="https://android.googlesource.com/platform/frameworks/native/%2B/master/libs/binder/">libbinder</a> library. </p><br><p>  The low-level parts of the binder operate in terms of objects that can be sent between processes.  This uses reference counting to automatically release unused shared resources and notify of the completion of a remote process (link-to-death) to release resources within the process. </p><br><p>  The high-level parts of a binder work in terms of interfaces, services, and proxies.  The description of the interface provided by the program to other programs is written in a special <a href="https://developer.android.com/guide/components/aidl.html">AIDL</a> (Android Interface Definition Language) language, which looks very similar to the interface declaration in Java.  This description automatically generates a real Java interface, which can then be used by clients and the service itself.  In addition, two special classes are automatically generated for the <code>.aidl</code> : Proxy (for use by the client) and Stub (for the service side) that implement this interface. </p><br><p>  For Java code in the client process, the proxy object looks like a normal Java object that implements our interface, and this code can simply call its methods.  At the same time, the generated implementation of the proxy object automatically serializes the passed arguments, communicates with the service process via libbinder, deserializes the result of the call passed back and returns it from the Java method. </p><br><p>  Stub works the other way around: it accepts incoming calls via libbinder, deserializes the arguments, calls the abstract implementation of the method, serializes the return value, and passes it to the client process.  Accordingly, to implement a service, it is enough for a programmer to implement abstract methods in the class inherited from Stub. </p><br><p>  Such a Binder implementation at the Java level allows most code to use a proxy object, without even thinking about the fact that its functionality is implemented in another process.  To ensure full transparency, Binder supports nested and recursive interprocess calls.  Moreover, the use of Binder on the client‚Äôs side looks exactly the same, regardless of whether the implementation of the used service is located in the same or in a separate process. </p><br><p>  In order for different processes to ‚Äúfind‚Äù each other‚Äôs services, Android has a special ServiceManager service that stores, registers and issues tokens of all other services. </p><br><p>  Binder is widely used in Android to implement system services (for example, the package manager and the clipboard), but the details of this are hidden from the application developer by the high-level classes in the Android Framework, such as <a href="https://developer.android.com/reference/android/app/Activity.html">Activity</a> , <a href="https://developer.android.com/reference/android/content/Intent.html">Intent,</a> and <a href="https://developer.android.com/reference/android/content/Context.html">Context</a> .  Applications can also use Binder to provide each other with their own services ‚Äî for example, the <a href="https://www.wikiwand.com/en/Google_Play_Services">Google Play Services</a> application does not have its own graphical user interface at all, but provides developers of other applications with the opportunity to use Google Play services. </p><br><p>  More details about Binder can be found on these links: </p><br><ul><li>  <a href="http://elinux.org/Android_Binder">Android Binder - Embedded Linux Wiki</a> </li><li>  <a href="https://developer.android.com/guide/components/aidl.html">Android Interface Definition Language</a> , <a href="https://developer.android.com/reference/android/os/IBinder.html">IBinder</a> </li><li>  <a href="https://events.linuxfoundation.org/images/stories/slides/abs2013_gargentas.pdf">Deep Dive into Android IPC / Binder Framework</a> </li><li>  <a href="https://www.nds.rub.de/media/attachments/files/2011/10/main.pdf">Android Binder - Android Interprocess Communication</a> </li><li>  <a href="http://codetheory.in/an-overview-of-android-binder-framework/">An Overview of Android Binder Framework</a> </li><li>  <a href="http://www.androiddesignpatterns.com/2013/07/binders-window-tokens.html">Binders &amp; Window Tokens</a> </li></ul><br><p>  In the <a href="https://habrahabr.ru/company/solarsecurity/blog/338292/">next article,</a> I‚Äôll talk about some of the ideas on which the high-level parts of Android are built, some of its predecessors, and basic security mechanisms. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/334796/">https://habr.com/ru/post/334796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334786/index.html">MMO from scratch. Part 2. Building functionality + Diamond Square algorithm</a></li>
<li><a href="../334788/index.html">Offshore and foreign trade transactions: advantages and pitfalls</a></li>
<li><a href="../334790/index.html">As I made the fastest resize of images. Part 3, fixed-point numbers</a></li>
<li><a href="../334792/index.html">Microsoft did not isolate Windows Defender in the sandbox, so I did</a></li>
<li><a href="../334794/index.html">Bluetooth mesh - network architecture and security</a></li>
<li><a href="../334798/index.html">1C and ETL</a></li>
<li><a href="../334800/index.html">DataGrip 2017.2: Supports Redshift and Azure, several databases in PostgreSQL, transaction control and more</a></li>
<li><a href="../334802/index.html">Music licensing for indie developers</a></li>
<li><a href="../334804/index.html">Finding the best place in the world for a windmill</a></li>
<li><a href="../334806/index.html">New V8 and Node.js speed: optimization techniques today and tomorrow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>