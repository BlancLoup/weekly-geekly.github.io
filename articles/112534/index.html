<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>One computer for two (or more) or multiseat based on Ubuntu 10.04 LTS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article discusses the implementation of multiseat based on Ubuntu 10.04 LTS with hardware acceleration. The example considered in this article ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>One computer for two (or more) or multiseat based on Ubuntu 10.04 LTS</h1><div class="post__text post__text-html js-mediator-article">  This article discusses the implementation of multiseat based on Ubuntu 10.04 LTS with hardware acceleration.  The example considered in this article has already been put into operation and has been working for about six months in a regular Minsk office.  Describes the problems of implementation and implementation of the finished system in the work from the point of view of the ordinary student electrician, who earns part-time job as a system administrator. <br><br><h4>  Introduction </h4><br><br>  Here is the time when the system administrator works in a small office when updating the computer park, there is a small problem.  Modern computers give a performance level that is much higher than what is needed for office computers.  Moreover, the realities of the market are such that differences in performance have little effect on price.  And the seemingly cheap Atom-based computers do not differ in price from the more productive computers based on conventional Amd and Intel processors (a motherboard with an Atom processor costs about 100-150 cu for May 2010, Minsk, and the same price for October 2010 in the same Minsk). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The same situation with hard drives: for office work there is no need for a disk size of more than 40-80 GB.  But such hard drives are practically not represented on the market.  At the time of this writing, 160 GB ($ 38), 250 GB ($ 39), 320 GB ($ 40), 500 GB ($ 41) hard drives were on sale, further price differences are more noticeable.  The price per gigabyte of small hard drives is quite high.  The same situation with all other components. <br><br>  A natural question arises, how is it rational to use all this?  Let's go logically - to reduce the cost of the system, you can either buy components worse (not much cheaper), or abandon some components.  In fact, in the workplace, input devices (keyboard, mouse, tablet, etc.) and information display devices (monitor, projector, etc.) are required.  The rest of the user system is not particularly relevant, and you can get rid of it.  Of course, get rid of everything will not work.  Let's look under the cover of the system unit.  Here we always see the motherboard, the video card (maybe already on the motherboard), the processor (also on the motherboard) and memory.  But the rest of the components are not so important.  The optical drive is of little demand, and therefore it probably will not. <br>  The hard disk is also an interesting situation.  It may not be, then we will have a so-called diskless station.  Here all information is downloaded over the network from the server (implementation of PXE + NFS and a little tambourine).  But I want something more. <br>  Then the idea arose to connect two keyboards, two mice and two monitors to one computer and make them work independently.  In foreign sources, such systems are called <a href="http://en.wikipedia.org/wiki/Multiseat_configuration">multiseat</a> . <br>  But you can not limit yourself on this, but make a diskless multiseat station.  This option is perfect for a pair of multiseat stations with a server.  This article is not covered. <br><br><a name="habracut"></a><br><br>  Let's take a closer look at multiseat.  To connect the necessary number of keyboards and mice, we will have to use USB ports.  Now this is not a problem.  To connect multiple monitors, we need either several ports on a video card, or several video cards, or we can combine these options. <br><br>  After setting all this up, we should get the number of workplaces we need, which can satisfy all user needs.  Processor time and memory is divided between these users, and the situation when all users simultaneously need all system performance is very rare. <br><br>  At first glance, it turns out very profitable system.  But why, then, about such systems, few have heard?  The answer is quite simple - setting up such systems is quite complicated.  And not every administrator (even a professional) will be able to put all these components together and make them work. <br><br><h4>  Implementation options </h4><br><br>  Let's try to start implementing such a system.  Let's start with the choice of operating system.  Multiseat can be built on the basis of modern OS: Linux, Windows and, possibly, others. <br><br>  Immediately, an interesting option for many based on Windows OS is in fact impractical.  First, the license prohibits installing one copy of Windows into such systems, so it requires the purchase of two licenses, which immediately kills many advantages, including cost savings.  Secondly, it‚Äôs very problematic to make such a system, since  need to write or buy additional software.  For the price, this option comes close to the option of buying two independent computers, or even exceeds it.  This option is considered <a href="http://habrahabr.ru/company/onlinepro/blog/109183/">here</a> .  It also has advantages - you don‚Äôt have to think and do much.  Everything is ready, just put the software and get the result. <br><br>  The second option - multiseat based on Linux - has many solutions.  Among them it is possible to distinguish both a solution without hardware acceleration (XGL, Xephyr, Xnest, etc.), and with hardware acceleration (xorg).  This article describes the implementation of multiseat with hardware acceleration based on Ubuntu Linux 10.04 LTS. <br><br>  The system is quite flexible and can work with any number of monitors.  In theory, each of the video cards runs on its own graphic X-server.  Next, each server launches a graphical desktop environment (Gnome, KDE, etc.) ... profit :).  Therefore, the PC on which the multiseat system will be based must have the necessary number of video cards. <br><br>  In essence, the Linux kernel assumes all the functions of allocating hardware resources.  Graphic servers take the video card to their full use and receive CPU time from the Linux kernel. <br><br><h4>  Implementation </h4><br><br>  And now for the practice.  Oddly enough, it is different from theory.  In my case, the system was an ASUS M3A78-CM motherboard with an integrated ATI Radeon 3100 video card. A second ATI Radeon 2600 video card was purchased and installed in a single PCI Express 16x slot.  Install more video cards is not a problem, the problem is to get a PCI Express 1x video card.  But there is a wonderful <a href="http://habrahabr.ru/blogs/DIY/105406/">solution</a> .  Next step: make sure that the two video cards are working simultaneously.  It is assumed that at this moment you already have the Linux operating system installed, where there is a great console command lspci, which shows all the pci devices on your system.  To restrict to devices in which the word VGA is present, you can make the following structure: lspci |  grep vga.  In my case, the picture was: <br><br> <code>andrey@k211-multiseat:~$ lspci | grep VGA <br> 01:05.0 VGA compatible controller: ATI Technologies Inc Radeon 3100 Graphics <br> 02:00.0 VGA compatible controller: ATI Technologies Inc RV630 [Radeon HD 2600 Series]</code> <br> <br>  Here we see our two video cards.  Of course, they did not appear here immediately.  I had to get into the BIOS a couple of times and change the settings.  The result met expectations. <br>  Further, by inertia, the proprietary ATI driver was installed.  This was a very gross mistake.  But I understood about it later.  And I will tell you too later :). <br><br>  Now some more theory.  Consider how the system boots.  Until the display manager is loaded (GDM, KDM, etc.), a lot of things happen, but this will remain outside the scope of this article.  Once the display manager has loaded, it will require you to enter a username and password (or will not require it if you configured it that way).  And then he starts the Xorg server and the working environment you have chosen.  If you ask him well, he can run several Xorg servers with different settings and for different users and, if desired, with different desktop managers. <br><br><h5>  KDM setup </h5><br><br>  And now to practice.  Some display managers are very difficult to persuade and even patch them (GDM), so choose KDM, which is more compliant.  By default, it is not installed in the system.  Installation is solved by a simple command in the console: sudo apt-get install kdm.  We agree and wait.  If all is successful, KDM is installed.  Now we will start to persuade him :).  The file responsible for configuring the manager is in / etc / kde4 / kdm and is called kdmrc.  It has a lot of settings, but we are only interested in a couple.  In the [General] section, we change two parameters in this way: <br><br> <code>[General] <br> StaticServers=:0,:1 <br> ReserveServers=:2,:3</code> <br> <br>  This means that KDM will start servers 0 and 1, and servers 2 and 3 will not touch.  Next, look for the [X-: 0-Core] section and change the setting in it in this way: <br><br> <code>[X-:0-Core] <br> ServerAttempts=2 <br> ServerArgsLocal= -br -nolisten tcp -layout seat1 -isolateDevice PCI:2:0:0 vt6 <br> AutoLoginEnable=true <br> AutoLoginUser=alexandr</code> <br> <br>  The first parameter, ServerAttempts = 2, probably does not affect anything, it appeared by long knocking on a tambourine and attempts to start the system.  As they say, it happened historically :). <br>  The most important parameter is the following, ServerArgsLocal = -br -nolisten tcp -layout seat1 -isolateDevice PCI: 2: 0: 0 vt6.  Consider it.  These are the launch arguments for the Xorg graphical server.  Let's look at them: <br>  ‚ÄìBr - instead of a gray pattern there will be a black background.  So a little prettier. <br>  -nolisten tcp - this option says that it is not necessary to use tcp / ip to work, or that the server is started locally. <br>  -layout seat1 tells you which configuration to use from the xorg.conf file (about it later). <br>  -isolateDevice PCI: 2: 0: 0 - the main option, asks the server to use only one video card, which is PCI: 2: 0: 0. <br>  vt6 indicates that the server will start on the sixth virtual terminal. <br><br>  The next option (AutoLoginEnable = true) enables automatic login to the system under the user AutoLoginUser = alexandr.  Do not forget to change it in the name of your user :). <br><br>  Next, we modify the file this way: <br><br> <code>[X-:1-Core] <br> ServerAttempts=2 <br> ServerArgsLocal= -br -nolisten tcp -layout seat0 -sharevts -novtswitch -isolateDevice PCI:1:5:0 vt5 <br> AutoLoginEnable=true <br> AutoLoginUser=andrey</code> <br> <br>  We are already familiar with almost all options.  Pay attention to -layout seat0.  This is another configuration of seat0 from the xorg.conf file.  Two identical configurations can not be, because  nothing will work.  Also changed is the -isolateDevice PCI device: 1: 5: 0 and the virtual terminal vt5.  The -sharevts option causes the server to work simultaneously on one terminal, and -novtswitch prohibits changing the current terminal by pressing the Ctrl + Alt + n keys, where n is the virtual terminal number.  More details about the x-server launch options can be found in the console (man xserver).  Next comes the option to enable autologin and the user name (andrey). <br>  Oh, and do not forget to create two users.  This can be done with the command in the ADDUSER console.  There is also a graphical shell.  At the first launch, you should disable the autologin option so that you can select the graphical environment manually. <br>  There is another important point.  Probably you have already noticed that virtual terminals 5 and 6 are used, and not 7, which is the default for the xorg server.  This is due to the fact that if you press the key combination Ctrl + c (a fairly common combination) on the keyboard of the second workstation, then xorg on vt7 drops.  Very unpleasant feature.  But it is solved by simply mixing xorg from vt7 to any other vt. <br><br><h5>  Configure xorg.conf </h5><br><br>  We now proceed to the basic configuration, namely, we will set those same seat0 and seat1.  For this we need the file /etc/X11/xorg.conf, which you may not have, but you can create it.  We write the following lines into it: <br><br> <code>Section "ServerLayout" <br> Identifier "seat0" <br> Screen 0 "Screen0" 0 0 <br> InputDevice "Mouse0" "CorePointer" <br> InputDevice "Keyboard0" "CoreKeyboard" <br> EndSection</code> <br> <br>  This means that we have defined the profile seat0 with the Screen0 screen, the mouse Mouse0 and the Keyboard0 keyboard.  The second profile is determined in the same way: <br><br> <code>Section "ServerLayout" <br> Identifier "seat1" <br> Screen 1 "Screen1" 0 0 <br> InputDevice "Mouse1" "CorePointer" <br> InputDevice "Keyboard1" "CoreKeyboard" <br> EndSection</code> <br> <br>  The thoughtful reader has probably already wondered: ‚ÄúWhat is Screen1, Mouse1, Keyboard1, Screen0, Mouse0, Keyboard0?‚Äù These devices are defined in the same file. <br><br> <code>Section "InputDevice" <br> Identifier "Keyboard0" <br> Driver "evdev" <br> Option "Device" "/dev/input/by-path/platform-i8042-serio-0-event-kbd" <br> Option "XkbModel" "pc105" <br> Option "XkbRules" "xorg" <br> Option "XkbLayout" "us,ru(winkeys)" <br> Option "XkbOptions" "grp:alt_shift_toggle,grp_led:scroll" <br> EndSection</code> <br> <br>  In modern Linux, evdev is responsible for input devices, so it is indicated as a driver.  One of the most difficult stages of setup is to determine the identifier for the keyboard that you need.  All input devices are located in the / dev / input / folder, where they are duplicated in the by-path and by-id folders.  Or there are event0 - event5 files for keyboards.  You need to choose one of the keyboards that you enjoy.  Determining the correctness of the choice is quite simple: just type sudo cat / dev / input / eventX in the console, where X is your keyboard number.  When you press a key on this keyboard, a symbol should appear in the console. <br>  Each such event is the same as the keyboard in / dev / input / by-path / and / dev / input / by-id /.  So do it because it is more convenient for you.  I have two different keyboards, so it‚Äôs more convenient for me to navigate by model, but with the same keyboards, it‚Äôs probably more convenient to work with event. <br>  The "XkbModel" option "pc105" says that we will have a standard 105-key keyboard.  The ‚ÄúXkbLayout‚Äù option ‚Äúus, ru (winkeys)‚Äù adds two layouts: us and ru (English and Russian). <br>  The ‚ÄúXkbOptions‚Äù option ‚Äúgrp: alt_shift_toggle, grp_led: scroll‚Äù means that the switching of the layouts is performed by the alt + shift combination, and the scroll lock LED will light up on the Russian layout. <br><br>  For the second keyboard, everything is almost the same: <br><br> <code>Section "InputDevice" <br> Identifier "Keyboard1" <br> Driver "evdev" <br> Option "Device" "/dev/input/by-id/usb-Chicony_USB_Keyboard-event-kbd" <br> Option "XkbModel" "pc105" <br> Option "XkbRules" "xorg" <br> Option "XkbLayout" "us,ru(winkeys)" <br> Option "XkbOptions" "grp:alt_shift_toggle,grp_led:scroll" <br> EndSection</code> <br> <br>  Go to the mice. <br><br> <code>Section "InputDevice" <br> Identifier "Mouse0" <br> Driver "evdev" <br> Option Device" "/dev/input/by-id/usb-PIXART_USB_OPTICAL_MOUSE-event-mouse" <br> Option "GrabDevice" "on" <br> Option "Buttons" "12" <br> EndSection <br></code> <br>  It seems everything is like in the keyboard, but there is an Option Option "GrabDevice" "on", which captures all the events from the device in exclusive use.  And Option "Buttons" "12", which says that our mouse will have 12 keys. <br><br>  Now the screens. <br><br> <code>Section "Screen" <br> Identifier "Screen0" <br> Device "Device0" <br> DefaultDepth 24 <br> EndSection</code> <br> <br>  We define the device to which the screen is connected (Device0) and, in every case, the depth of color.  We do the same with the second screen. <br><br> <code>Section "Screen" <br> Identifier "Screen1" <br> Device "Device1" <br> DefaultDepth 24 <br> EndSection</code> <br> <br>  And here are the devices. <br><br> <code>Section "Device" <br> Identifier "Device0" <br> Driver "radeon" <br> VendorName "ATI Technologies Inc" <br> BoardName "ATI 3100" <br> BusID "PCI:1:5:0" <br> Option "Int10" "off" <br> EndSection</code> <br> <br>  Once again I draw attention to the driver "radeon".  In no case is the ATI proprietary driver (I can‚Äôt say anything about Nvidia cards, but there‚Äôs just the opposite).  A little later, I will tell you more about why.  BusID "PCI: 1: 5: 0" - those same figures for this video card, obtained with the command lspci |  grep vga.  Option "Int10" "off" disables the initialization of the video card using a BIOS interrupt.  This option is required.  Without it, you will not succeed. <br><br>  And for the second video card. <br><br> <code>Section "Device" <br> Identifier "Device1" <br> Driver "radeon" <br> VendorName "ATI Technologies Inc" <br> BoardName "ATI 2600" <br> BusID "PCI:2:0:0" <br> Option "Int10" "off" <br> EndSection</code> <br> <br>  Also in the xorg.conf file you must specify the server settings. <br><br> <code>Section "ServerFlags" <br> Option "DefaultServerLayout" "seat0" <br> Option "AllowMouseOpenFail" "true" <br> Option "AutoAddDevices" "false" <br> Option "AllowEmptyInput" "false" <br> EndSection</code> <br> <br>  Consider all the options: <br><br>  ‚ÄúDefaultServerLayout‚Äù ‚Äúseat0‚Äù - if something happens to kdm and xorg starts up without parameters, the server needs to know which configuration to load. <br>  ‚ÄúAllowMouseOpenFail‚Äù ‚Äútrue‚Äù - even if there is no mouse, then consider the mouse working and not confuse the server.  In fact, it shouldn't seem to work when using evdev.  Perhaps no longer in use.  But historically it happened :) <br>  ‚ÄúAutoAddDevices‚Äù ‚Äúfalse‚Äù - prohibits adding devices automatically, only those that are registered in the xorg.conf file.  Otherwise, a kind person will come and connect the mouse to the computer, and, logically, it will appear in all workplaces and will interrupt the mouse defined by the corresponding desktop.  We do not need this, and therefore disable.  And let a kind person look at a mouse and think: ‚ÄúWhat is it not working for?‚Äù There is no need for an authorized person to install mice in complex systems.  Breaks something else :) <br>  ‚ÄúAllowEmptyInput‚Äù ‚Äúfalse‚Äù - does not add a standard driver for the mouse and keyboard, if suddenly we forgot to register the mouse and keyboard in xorg.conf. <br><br><h4>  First start </h4><br><br>  Here is the first stage and finished.  Now you can reboot and, if everything went well, you will see a KDM prompt to enter your login and password.  It remains to enter the username and password, choose the working environment, then, if everything is good, enable autologin in the / etc / kde4 / kdm / kdmrc file and configure the system further :). <br><br>  My graphics server load looks like this: <br><br><img src="https://habrastorage.org/storage/habraeffect/1b/87/1b8760a8794ac4cf6fd3874901fb108f.png" alt="image"><br><br>  Such a beautiful picture is obtained by the wonderful bootchart program.  Here is the <a href="">full version of the chart</a> . <br><br>  And now I will tell you why it was impossible to install a proprietary ATI driver.  This driver is very difficult to persuade.  It takes the -isolateDevice option somewhat differently.  A long analysis of the xorg server logs showed that something like this happens. <br><br>  Runs the first X server (xorg1), which launches the proprietary ATI driver (fglrx1). <br>  fglrx1 - wow, video card, wow, it suits me.  We will work with her. <br>  fglrx1 - wow, second.  Class, I want.  In general, I like it, I take it too. <br>  Xorg1 - ok, working. <br>  Run the second X server (xorg2), which launches the proprietary ATI driver (fglrx2). <br>  fglrx2 - uh-uh, and where is the video card?  No, man, I do not understand where the video card? <br>  fglrx2 - well, work yourself without a video card. <br>  Xorg2 - uh ... who offended the driver, why did he leave me (running away from the computer)?  Come back, fglrx2, I will forgive everything. <br><br>  There is no such thing with an open driver.  It perfectly recognizes the launch option on a separate device. <br><br><h4>  Solved problems </h4><br><br>  Continue to configure the system further.  Although everything works, but there are always a lot of little things that are not noticeable at first glance.  When we were just taking the setting, we could not even assume that in this configuration the computer would refuse to restart and shut down.  It would seem, why?  And all because of such interesting pieces as <a href="http://www.freedesktop.org/software/ConsoleKit/doc/ConsoleKit.html">ConsoleKit</a> and <a href="http://www.freedesktop.org/wiki/Software/PolicyKit">PolicyKit</a> .  Information on them is not very much, but it all comes down to the fact that PolicyKit allows unprivileged processes to communicate with privileged ones.  Or, more simply, he controls the policy of the system.  In our case, it is he who does not allow us to turn off the computer, because we do not have rights to it.  Information for PolicyKit about who we are is given by the same ConsoleKit, and the task of this subsystem is to keep track of users, their sessions and those sets.  But that's bad luck, there is a very bad addition in the documentation: ‚ÄúTrue, hardware, multi-seat capabilities will be added later.‚Äù  And we want multiseat now.  You can patch ConsoleKit, but let's get a little deeper and see if we can do without it.  When a user logs in, a session is created for him, and the session is marked as active.  But when two users simultaneously log in (our multiseat), it creates two sessions, but ConsoleKit is lost and makes them inactive.  You can view current sessions by typing ck-list-sessions in the console. <br><br> <code>andrey@k211-multiseat:~$ ck-list-sessions <br> Session1: <br> unix-user = '1000' <br> realname = '' <br> seat = 'Seat3' <br> session-type = '' <br> active = FALSE <br> x11-display = ':1' <br> x11-display-device = '' <br> display-device = '' <br> remote-host-name = '' <br> is-local = TRUE <br> on-since = '2010-10-25T14:14:04.812473Z' <br> login-session-id = '' <br> Session2: <br> unix-user = '1001' <br> realname = '' <br> seat = 'Seat4' <br> session-type = '' <br> active = FALSE <br> x11-display = ':0' <br> x11-display-device = '' <br> display-device = '' <br> remote-host-name = '' <br> is-local = TRUE <br> on-since = '2010-10-25T14:14:05.146443Z' <br> login-session-id = ''</code> <br> <br>  I tried to persuade ConsoleKit to make sessions active for a long time, until I decided to enter from the other end.  The computer does not allow you to turn off PolicyKit, which has rules to turn off the computer, and an inactive user does not resemble it.  We are looking for a file that is responsible for turning off the computer policy, and find all the policies in this folder / usr / share / polkit-1 / actions.  The file responsible for shutdown, reboot, etc.  called org.freedesktop.consolekit.policy.  Open it.  And we see the usual xml-file.  In the section we see a lot of events.  Let's look at the first. <br><br> <code>Stop the system <br> System policy prevents stopping the system <br> &lt;allow_inactive&gt;no&lt;/allow_inactive&gt; <br> &lt;allow_active&gt;yes&lt;/allow_active&gt; <br> <br></code> <br><br>  The action id field indicates the action.  In this case, the system shutdown.  Next is a description, that is, a description of what it is.  This text will be displayed if necessary authorization for this action.  The message field indicates the message that the person will receive if necessary authorization.  Next comes the section that manages permissions on actions.  It has two fields: allow_inactive - the condition for permission to perform an action to an inactive user (both, but this is our inactive session in the ConsoleKet) and allow_active - to the active one.  In general, the <a href="http://hal.freedesktop.org/docs/polkit/polkit.8.html">documentation also</a> says about the allow_any field.  But at the time of the creation of this system, I have not heard anything about it, perhaps the option appeared later.  The parameters can be such keys: <br><br>  no - refuse action <br>  yes - allow actions <br>  auth_self - request user password <br>  auth_admin - request administrator password <br>  auth_self_keep - request a user password and remember it for a while <br>  auth_admin_keep - request an administrator password and remember it for a while. <br><br>  Now we change the &lt;allow_inactive&gt; no &lt;/ allow_inactive&gt; option to &lt;allow_inactive&gt; yes &lt;/ allow_inactive&gt; and we can turn off the computer from any user, but under the condition that we have only one session on the computer, and not two.  For other actions, change the options to the following: <br> <code>Stop the system when multiple users are logged in <br> System policy prevents stopping the system when other users are logged in <br> &lt;message xml:lang="ru"&gt;!    .     ? <br> &lt;allow_inactive&gt;auth_admin_keep&lt;/allow_inactive&gt; <br> &lt;allow_active&gt;auth_admin_keep&lt;/allow_active&gt; <br> <br></code> <br><br>  Here, this is our case.  We have two users, and when one wants to turn off the computer, a window is displayed with a request to enter a password.  If there is one user in the system, the window will not appear. <br><br>  Many will ask, why password?  Let's imagine the situation.  Here are two people working at the computer.  One goes home and turns off the computer, forgetting that the second person is still working.  As a result, the computer shuts down to the great indignation of the second, who is not ready for such a development.  The warning with the requirement to once again enter the password still saves nerves to both users. <br><br>  The remaining parameters are similar. <br><br> <code>Restart the system <br> System policy prevents restarting the system <br> &lt;allow_inactive&gt;yes&lt;/allow_inactive&gt; <br> &lt;allow_active&gt;yes&lt;/allow_active&gt; <br> <br> <br> <br> Restart the system when multiple users are logged in <br> System policy prevents restarting the system when other users are logged in <br> &lt;message xml:lang="ru"&gt;!    .     ? <br> &lt;allow_inactive&gt;auth_admin_keep&lt;/allow_inactive&gt; <br> &lt;allow_active&gt;auth_admin_keep&lt;/allow_active&gt; <br> <br></code> <br><br>  With the shutdown and restart of the computer sorted out. <br><br><h4>  Usb drives </h4><br><br>  Another interesting situation occurs when using a USB drive.  We insert the flash drive, and two copies of Gnome (in my case) fight for who will mount it.  Only one of them wins, and the second offendedly swears an error.  Moreover, the first one mounts it with the rights only for its user, and the second one does not start up on the flash drive.  A rather unpleasant situation that can destroy the whole multiseat venture.  We will deal with it. <br><br>  The option that immediately came to mind is to go down a little lower to the hardware and mount the flash drive before Gnome.  I had to read the manuals and consult with Google.  And the answer was found.  His name is UDEV.  UDEV is a device manager that takes care of the maintenance of the device when it appears in the system before the component is used.  Also on his conscience, the return path - a neat withdrawal of the device from the system. <br><br>  But for any drive has its own characteristics.  It is necessary not only to mount it, but also to unmount it.  And the situation is this - the drive is mounted when a flash drive is attached, and to unmount it, it is necessary to give a command from the user (by right-clicking the mouse ‚Üí it is safe to disconnect the drive).  If the device tag is in the / etc / fstab file, then any user can unmount the device, otherwise only the user with administrative rights can do that.  Our plan is as follows: when connecting a flash drive, write the parameter to mount in / etc / fstab, call mount, we get a flash drive.  When you click secure device delete, call umount.  The basic idea was found <a href="http://thegeekbird.blogspot.com/2008/04/udev-usb-flash-automount.html">in this blog</a> . <br><br><h5>  UDEV Setup </h5><br><br>  All UDEV rules are located in the /etc/udev/rules.d folder.  The rules start to work in alphabetical order.  The name of the rules does not matter.  For myself, I created a 40-usbmount.rules file with the following content: <br><br> <code>ACTION=="add", KERNEL=="sd[bz][0-9]", RUN+="/bin/mkdir -p /media/%k" <br> ACTION=="add", KERNEL=="sd[bz][0-9]", RUN+="/bin/sed -i '/\/dev\/%k.*/d' /etc/fstab" <br> ACTION=="add", KERNEL=="sd[bz][0-9]", RUN+="/bin/sed -i '$a\/dev/%k /media/%k auto rw,noauto,noexec,nodev,noatime,users,iocharset=utf8,uid=1000,gid=100,umask=0, 0 0' /etc/fstab" <br> ACTION=="add", KERNEL=="sd[az][0-9]", RUN+="/bin/mount /dev/%k" <br> ACTION=="remove", KERNEL=="sd[bz][0-9]", RUN+="/bin/umount -l /dev/%k" <br> ACTION=="remove", KERNEL=="sd[bz][0-9]", RUN+="/bin/rmdir /media/%k" <br> ACTION=="remove", KERNEL=="sd[bz][0-9]", RUN+="/bin/sed -i '/\/dev\/%k.*/d' /etc/fstab"</code> <br> <br>  Let's see what is happening here.  Let's look at the first four lines.  They are triggered when a device is added (ACTION == "add"), that is, our flash drive (KERNEL == "sd [bz] [0-9]"), and then the RUN + = "command" command is run.  The == icon indicates a condition.  If true, then the line is executed further, if false, then skipped.  I have one hard drive in my system - sda.  As most linux users know (I, at least, I think so), disks in linux are indicated by sd [X] [Y], where X is the letter of the Latin alphabet, in order of the disks (a-first, b-second and t .d.), and Y is the partition number of the disk.  Therefore, in my case, it is KERNEL == "sd [bz] [0-9]".  If you have two hard drives, then you should change the record to the following KERNEL == "sd [s-z] [0-9]".  And so on.  The commands that follow the RUN + = operator will be discussed a little later. <br><br>  The last three commands are triggered when the device is disconnected (ACTION == "remove"), whether it is safe extraction or just a pulled flash drive.  It works on the same removable drives. <br><br>  Consider now the commands coming after the operator RUN + =.  This statement indicates which applications are used, which should start if all past conditions are true.  There is also a small nuance: you must specify the full path to the executable file. <br>  The / bin / mkdir -p / media /% k command creates a folder for further mounting of the drive.  % k is a UDEV variable that indicates the name of the device that triggered the rule.  That is, when you connect a flash drive, it will be sdb1 (in my case).  And when this command is triggered, the folder / media / sdb1 should be created.  Create a folder in / media, because in Ubuntu it is so accepted.  And we want to make a system with minimal differences. <br><br>  The following command is / bin / sed -i '/\/dev\/%k.*/d' / etc / fstab.  The team already has a little difficulty.  It should remove all references to our device from the / etc / fstab file.  If suddenly we accidentally turned off the computer with a flash drive in it, then we will have a small problem with the further mounting of flash drives.  This line is designed to combat this.  Let us analyze it in order.  The / bin / sed command is run with the -i switch, which means that you need to edit the file specified at the end of the command (in our case / etc / fstab).    '/\/dev\/%k.*/d' ‚Äî   ,  ,      /dev/sdb.* (  ) ,   ,  . <br><br>  /bin/sed -i '$a\/dev/%k /media/%k auto rw,noauto,noexec,nodev,noatime,users,iocharset=utf8,uid=1000,gid=100,umask=0, 0 0' /etc/fstab      ($a)   /etc/fstab.      /dev/sdb1 /media/sdb1 auto rw,noauto,noexec,nodev,noatime,users,iocharset=utf8,uid=1000,gid=100,umask=0, 0 0 <br><br> ,    sdb1,    ,      . <br><br>       /bin/mount /dev/%k.   .     /dev/sdb1 (  )  ,    /etc/fstab.    ,        .        :)       . <br><br>     ,      ,     .  /bin/umount -l /dev/%k  . <br><br>  -l  ¬´¬ª .   .  ,    ,      .        . <br> /bin/rmdir /media/%k  ,    . <br><br> /bin/sed -i '/\/dev\/%k.*/d' /etc/fstab       fstab.      . <br><br>    . ,     ,     USB CD-ROM.   - .  ,  ,      KERNEL==¬´sd[bz][0-9]¬ª    .       .       ,    .    ,     ,     . <br><br>     UDEV    Linux.       man udev. <br><br>     ,      /etc/fstab. <br>    fstab    ‚Äú ‚Äî  ‚Äî   ‚Äî  --  dump ‚Äî  ‚Äù. <br>        /dev/sdb1 /media/sdb1 auto rw,noauto,noexec,nodev,noatime,users,iocharset=utf8,uid=1000,gid=100,umask=0, 0 0 <br><br>  /dev/sdb1-- ,    . /media/sdb1-- ,     . <br><br>     . Auto ,       .  ,     Windows        : fat  ntfs. <br><br>     : <br> rw ‚Äî     ,    . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noauto - this entry will not be perceived by the mount -a command. That is, mount all available devices. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noexec - the permission flag for launching binary files is set to 0. That is, you cannot run binary files directly from this flash drive. You will have to set the start file permission flag. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodev - says that devices cannot be placed on this file system (folder / dev). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noatime - do not update file access time. According to the description, it should work faster. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users - a regular user can mount this device, not just root. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iocharset = utf8 - file system encoding. The option is typical only for file systems fat and ntfs.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid = 1000 - user id, whose rights will be distributed to the file. The option is characteristic only for the file systems fat and ntfs </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gid = 100 - id of the group, the rights of which will extend to the file. Do not forget to add two or more users to one group so that they can work with a flash drive without any problems, because it is mounted by everyone at once. If users belong to different groups, then one of the groups will not be able to work with a flash drive. The option is typical only for file systems fat and ntfs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">umask = 0 - file access mask. Zero means it remains the default. Learn more about this in </font></font><a href="http://ru.wikipedia.org/wiki/Umask"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wikipedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The penultimate zero means that you do not need to backup the file system with the dump utility. And the last one is that you do not need to check the file system with the fsck utility.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can learn more about all other mount options using the man fstab and man mount commands in the console. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After we figured out how to mount the flash drive and create a new rule, we need to somehow say something about this UDEV, but how does it know about our changes. To do this, you can type the command udevadm control ‚Äîreload-rules in the console. Now you can insert a flash drive and look at the result of the work.</font></font><br><br><h4>  Experience of use </h4><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That's all about it. Behind the scenes, of course, there are many questions. Let's say I did not solve the problem with the audio system, that is, with the separation of sound from two workplaces into different audio outputs. For half a year of work, this was never necessary for anyone. The computer is still office. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Among the known problems of the system, it should be noted that flash-video is played at double speed, and the standard video playback all plays at double speed. VLC reproduces everything fine. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now perhaps the most interesting - the experience of using the system. Two users are sitting at this computer.</font></font> Man and woman.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Both of these people are just over 50 years old. They are familiar with computers at the level of a noisy box, in which there are office documents and a pair of office toys. Before that, they used Windows XP. There were no problems with the transition. In total, I spent about an hour consulting these people, this is a total time in a couple of weeks. Most of the questions arose in the first time - still unusual. The man had already figured out on his own how to install his favorite card toys in the application center, and even pleased the woman with toys for her. Although still this person does not really understand how to put the program in Windows. So the system can be called quite user friendly. The internal network uses a normal server (non-shutdown computer :)). The link to it was successfully created in the transition menu, and from there it is already used.The woman really wanted to see the program Consultant +. The program started perfectly through wine.</font></font><br><br>     ,    .       ,   , ,    .  , ,     .     .  ,     .       .        ,     .       .     (    )       .        -,   ,      .            ,      .     ,                 .        .         :). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of technical problems, nothing was noted. Although, of course, if something breaks, then very few people can fix it. Therefore, such a system is not very recommended to install without a competent system administrator who understands Linux. Although, on the other hand, if everything is set up and taken away from user rights, the system works like a clock. For half a year there were no technical problems caused by users. And, in principle, it should not arise.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probably the most valuable thing in this system is a significant money saving. And both on components, and on electricity. And given that the computer is office and is turned on for about 9 hours a day (8 workers plus lunch), then the savings on electricity are noticeable. As for the price of components, the system unit with a keyboard and mouse in my case costs $ 407, the monitor is $ 162, that is, the cost of one workplace was $ 569. The second monitor ($ 162), the keyboard ($ 8), the mouse ($ 7) and the video card ($ 48) together cost $ 225, which is 40% of the cost of the first workplace. If we calculate the cost of one workplace, we get $ 397. Somehow not bad for a normal computer. And if in percent, then one job becomes 30% cheaper.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhaps I missed some points in the description. </font><font style="vertical-align: inherit;">Therefore, all the files that are mentioned in the article can be downloaded in full form </font></font><a href="http://webfile.ru/5076724"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the </font></font><a href="http://habrahabr.ru/blogs/linux/112534/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comments</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an important addition.</font></font></div><p>Source: <a href="https://habr.com/ru/post/112534/">https://habr.com/ru/post/112534/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112528/index.html">Firefox 4 beta 10 released</a></li>
<li><a href="../112529/index.html">The alpha version of the Qwiki service is open.</a></li>
<li><a href="../112530/index.html">Javascript obfuscation</a></li>
<li><a href="../112531/index.html">Choosing a mass mailing service</a></li>
<li><a href="../112532/index.html">15,000 day unix era</a></li>
<li><a href="../112535/index.html">What is 1G, 2G, 3G, 4G and everything in between?</a></li>
<li><a href="../112536/index.html">Screw GTD to Remember The Milk</a></li>
<li><a href="../112537/index.html">Russian game Doodle God is a worldwide partner of LG and # 6 rated WP7</a></li>
<li><a href="../112538/index.html">Uploading files using HTML5 and how many times we said bad words</a></li>
<li><a href="../112539/index.html">Job management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>