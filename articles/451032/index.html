<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write HTTP / 1.1 & HTTP / 2 client and server on Golang</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Golang is a great programming language with a wide range of features. This article shows you how to write a client and a server for Go for HTTP / 1.1 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write HTTP / 1.1 & HTTP / 2 client and server on Golang</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d3a/039/afd/d3a039afd1ba2d00298f26b62c2a3624.png"><br><br>  Golang is a great programming language with a wide range of features.  This article shows you how to write a client and a server for Go for HTTP / 1.1 and HTTP / 2 protocols on Go. <br><a name="habracut"></a><br><blockquote>  <b>Skillbox recommends:</b> Practical course <a href="https://skillbox.ru/python/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DPTNDEV%26utm_content%3Darticles%26utm_term%3Dgoserver">"Python-developer from scratch</a> . <a href="https://skillbox.ru/python/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DPTNDEV%26utm_content%3Darticles%26utm_term%3Dgoserver">"</a> <br><br>  <b>We remind:</b> <i>for all readers of "Habr" - a discount of 10,000 rubles when writing to any Skillbox course on the promotional code "Habr".</i> <br></blockquote><br>  HTTP / 2 is the second major version of the HTTP network protocol used to access the World Wide Web.  The protocol is based on SPDY.  Learn more about this version <a href="http2.github.io/faq/">on GitHub</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  HTTP / 1.1 Server </h3><br>  The code below demonstrates how to write an HTTP / 1.1 server on Go.  The main function starts the HTTP (S) service with port 9191 and the path / hello / sayHello.  echoPayload is responsible for echo logic, analyzing incoming traffic and responding accordingly.  If necessary, echoPayload can be modified. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"io/ioutil"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/hello/sayHello"</span></span>, echoPayload) log.Printf(<span class="hljs-string"><span class="hljs-string">"Go Backend: { HTTPVersion = 1 }; serving on https://localhost:9191/hello/sayHello"</span></span>) log.Fatal(http.ListenAndServeTLS(<span class="hljs-string"><span class="hljs-string">":9191"</span></span>, <span class="hljs-string"><span class="hljs-string">"./cert/server.crt"</span></span>, <span class="hljs-string"><span class="hljs-string">"./cert/server.key"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoPayload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span></span></span> { log.Printf(<span class="hljs-string"><span class="hljs-string">"Request connection: %s, path: %s"</span></span>, req.Proto, req.URL.Path[<span class="hljs-number"><span class="hljs-number">1</span></span>:]) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> req.Body.Close() contents, err := ioutil.ReadAll(req.Body) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalf(<span class="hljs-string"><span class="hljs-string">"Oops! Failed reading body of the request.\n %s"</span></span>, err) http.Error(w, err.Error(), <span class="hljs-number"><span class="hljs-number">500</span></span>) } fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"%s\n"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(contents))</code> </pre> <br>  Since the HTTP (S) service is already running, you need to provide a certificate and server key.  Both objects are stored in the cert directory with the names server.crt and server.key. <br><br>  An example of a certificate and key is below. <br><br>  ./cert/server.crt <br><br>  ----- BEGIN CERTIFICATE ----- <br>  MIID + zCCAuOgAwIBAgIJAPsvGCCAC2i + MA0GCSqGSIb3DQEBCwUAMIGTMQswCQYD <br>  VQQGEwJMSzEQMA4GA1UECAwHV2VzdGVybjEQMA4GA1UEBwwHQ29sb21ibzESMBAG <br>  A1UECgwJTERDTEFLTUFMMRQwEgYDVQQLDAtFbmdpbmVlcmluZzESMBAGA1UEAwwJ <br>  bG9jYWxob3N0MSIwIAYJKoZIhvcNAQkBFhNsZGNsYWttYWxAZ21haWwuY29tMB4X <br>  DTE5MDQyMDA1MjczM1oXDTIwMDQxOTA1MjczM1owgZMxCzAJBgNVBAYTAkxLMRAw <br>  DgYDVQQIDAdXZXN0ZXJuMRAwDgYDVQQHDAdDb2xvbWJvMRIwEAYDVQQKKAlMRENM <br>  QUtNQUwxFDASBgNVBAsMC0VuZ2luZWVyaW5nMRIwEAYDVQQDDAlsb2NhbGhvc3Qx <br>  IjAgBgkqhkiG9w0BCQEWE2xkY2xha21hbEBnbWFpbC5jb20wggEiMA0GCSqGSIb3 <br>  DQEBAQUAA4IBDwAwggEKAoIBAQC9PKAOlJcOBUI9CGnVjMjQHNRqYv01CaUdC4 / e <br>  YFyegxLpoMpYvEC + nYlHT2j7BOhQBV + TkH1D4YOK2WP3V0FLv5hM7Nxsgf25WNHa <br>  zi2DTBvcBgB9sDJA / avIvF + 63 + Btnyggp3xq6MaHy5DNH0kPnSiPiy7PRKToEUn6 <br>  oqPnB10rRBFZqs3ePmEDxVL3T / TUZSXR3P95fV1vDCqrJbr3YwWOzFCq8kEJFslK <br>  B7GSEKpPgmK0g5krmAQqUOuCJ3 / xFlCP4trKg / lvSJZ5S / LZD5teDDg6Ax3Mvthj <br>  kMh9 / OM5GGTTjRwhct9dHjFI8POj + TMbLZvoPVXjsmATEgtLAgMBAAGjUDBOMB0G <br>  A1UdDgQWBBQ1CmWXmrHOv6b8f763 / bk80EpbajAfBgNVHSMEGDAWgBQ1CmWXmrHO <br>  v6b8f763 / bk80EpbajAMBgNVHRMEBTADAQH / MA0GCSqGSIb3DQEBCwUAA4IBAQAH <br>  D51Uoe2K4N9 / GxRgww5mMW2dUJ7Hc / tGsr / J1fNqHY8SXNAn5i + GwI + xBvwxFHL3 <br>  KZHbfq7eYDE5EItt3cZp5ySSscdTEay9ReH2 + 8k32gpH46CMwPV3XvtQuBVVAC4u <br>  szrq1eWKhYI2zf4iUVpwvq89OynVGIp0atng + q3A2cBhi3NGo6Ho1s2rywQyqiq8 <br>  up4PUSVQ6WBoJFx5PEEDxD84VMS7Pan6dT34b9n56tq5R06retZTUZ8jMM88CGX4 <br>  88pSPU + XImp6DdNVBmW6Lz76jiSNHLkZGm4jumjeyUGzBjBEBOgSegeWlinMtWE9 <br>  gaVxeUHrqHk8xzwJ4oIu <br>  ----- END CERTIFICATE ----- <br><br>  ./cert/server.key <br><br>  ----- BEGIN PRIVATE KEY ----- <br>  MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC9PKAOlJcOBUI9 <br>  CGnVjMjQHNRqYv01CaUdC4 / eYFyegxLpoMpYvEC + nYlHT2j7BOhQBV + TkH1D4YOK <br>  2WP3V0FLv5hM7Nxsgf25WNHazi2DTBvcBgB9sDJA / avIvF + 63 + Btnyggp3xq6MaH <br>  y5DNH0kPnSiPiy7PRKToEUn6oqPnB10rRBFZqs3ePmEDxVL3T / TUZSXR3P95fV1v <br>  DCqrJbr3YwWOzFCq8kEJFslKB7GSEKpPgmK0g5krmAQqUOuCJ3 / xFlCP4trKg / lv <br>  SJZ5S / LZD5teDDg6Ax3MvthjkMh9 / OM5GGTTjRwhct9dHjFI8POj + TMbLZvoPVXj <br>  smATEgtLAgMBAAECggEAbaS2yDvn2cPKQTqit4y + vXY2zP1V4GkaNd4BGcOTZnRj <br>  fOIg25EXoln8tEiadva888BpREKvkakUYlraxPDVcGIuiEOk42nd7Io97R0Q2cY7 <br>  ThxcJHb2ZxmTctdSUCBvFJTm1ySzve3pOb0ExRSfbGCOo7zs / kKzmZKK3qFlffGS <br>  Ga9O7hyLOuXPU22CM + 5Lq0JPTER73z0DpAweZc0L14j6dzhcG3qUwk0K6K47VZgE <br>  NhEORul7xDj91bh2iEoSbaQe8HxLaMQoMXOC / 9oey2UKKTe9WZE3 + XCvg + vkw / sS <br>  biQ + b4EZ9LuhAhCZ0UE6 + y7PZY + 8G / YsbGg0Zo8cAQKBgQDyTuG47rWBgbdHsEB / <br>  MSKGU6w + a1SdLk6jG + Enji5Q624 / h0xt5nF9ah2eRf3Rlhn9WEKM / uE9ouEODBKE <br>  8rnIDsjufEMI8moPEloRBSsxPNw + fNMSSCZjL + qPtTJUbRio7WA23sfdnE57ygBa <br>  wlPQ9UBBWSm2se4veEZtHjtngQKBgQDH7gnH5Att6ZYazRTgD72g0C5v1l4LYVEQ <br>  jxdBcs6TJA8wHfifZ45F67W95QunmM813UxfS + ybdjytlb8 / lmi2BnK6lDx5HWIL <br>  31jnbg2CxCrNv9oZLjKVDmkp4WUcEp5W33R1 / MGDTRfyARP + 6QYQO / ATMdqtm5Uu <br>  cD6clrL4ywKBgQCQ0niy0WmGaAMlQ8CoxLM / 2c6 + 1 + OQtlalwkoGHEKudqhELBeQ <br>  MAVw0fW13Vtg4vfRpejQ4J26 + xjMDocbEv / bBIsvjvF57XlaXLucJJy2Jwv0BSMa <br>  cCkRa1gkYEYek74DaSzyXqDSYVO / RPKFTFRQNeUbqbD20s3rbVWablFPAQKBgB5y <br>  zUCJJYh2w6qPQzegjhO4wOm9bxMyngL0l + ka0AUuv7VnSx8TyWIytLoX8P90UVJ1 <br>  wpTc3ksK5dDV9ot7n7ThJIXv34nehLkkKckNRLd + oro1FsUw + PkkebWsIxb0avL2 <br>  EymI9fvGOPhdW6s91 / OO / VAfDpvUDxNEevSkKtujAoGAcMOsXtn / UyT3Lssxgla3 <br>  K + DCaFhAQPSUXOmpZwEbQ0yQlksDe4flsam8bEDI5D5iHx1ziSfh583qJl3BEZ5u <br>  VZTEO2YLvT9QRz7pv2qspqj7nzSyBU2BFAajq43 / G1b8FHfVgN + YdVtzVrigfql5 <br>  2a + JxOxFfpjnGQ7RfSxSb + Q = <br>  ----- END PRIVATE KEY ----- <br><br>  It is time to test run the service using the following command: <br><br><pre> <code class="plaintext hljs">$ go run http_server.go</code> </pre> <br>  The answer should be: <br><br><pre> <code class="plaintext hljs">Go Backend: { HTTPVersion = 1 }; serving on https://localhost:9191/hello/sayHello</code> </pre> <br>  Now we initiate the service using an HTTP / 1.1 POST request (insecure and secure modes): <br><br><pre> <code class="plaintext hljs">$ curl -k -v https://localhost:9191/hello/sayHello -d "Hello Go!" $ curl -v --cacert ./cert/server.crt https://localhost:9191/hello/sayHello -d "Hello Go!"</code> </pre> <br>  Below is the result of the program.  The first part is the details of the handshake TLS server and client.  The second is the details of the HTTP / 1.1 request and response.  At the end - the text message "Hello Go!". <br><br>  * Trying 127.0.0.1 ... <br>  * Connected to localhost (127.0.0.1) port 9191 (# 0) <br>  * ALPN, offering http / 1.1 <br>  * Cipher selection: ALL:! EXPORT:! EXPORT40:! EXPORT56:! ANULL:! LOW:! RC4: @STRENGTH <br>  * successfully set certificate verify locations: <br>  * CAfile: /etc/ssl/certs/ca-certificates.crt <br>  CApath: none <br>  * TLSv1.2 (OUT), TLS header, Certificate Status (22): <br>  * TLSv1.2 (OUT), TLS handshake, Client hello (1): <br>  * TLSv1.2 (IN), TLS handshake, Server hello (2): <br>  * TLSv1.2 (IN), TLS handshake, Certificate (11): <br>  * TLSv1.2 (IN), TLS handshake, Server key exchange (12): <br>  * TLSv1.2 (IN), TLS handshake, Server finished (14): <br>  * TLSv1.2 (OUT), TLS handshake, Client key exchange (16): <br>  * TLSv1.2 (OUT), TLS change cipher, Client hello (1): <br>  * TLSv1.2 (OUT), TLS handshake, Finished (20): <br>  * TLSv1.2 (IN), TLS change cipher, Client hello (1): <br>  * TLSv1.2 (IN), TLS handshake, Finished (20): <br>  * SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 <br>  * ALPN, server accepted to use http / 1.1 <br>  * Server certificate: <br>  * subject: C = LK;  ST = Western;  L = Colombo;  O = LDCLAKMAL;  OU = Engineering;  CN = Chanaka Lakmal;  emailAddress=ldclakmal@gmail.com <br>  * start date: Apr 20 03:03:58 2019 GMT <br>  * expire date: Apr 19 03:03:58 2020 GMT <br>  * issuer: C = LK;  ST = Western;  L = Colombo;  O = LDCLAKMAL;  OU = Engineering;  CN = Chanaka Lakmal;  emailAddress=ldclakmal@gmail.com <br>  * SSL certificate verify result: self signed certificate (18), continuing anyway. <br>  &gt; POST / hello / sayHello HTTP / 1.1 <br>  &gt; Host: localhost: 9191 <br>  &gt; User-Agent: curl / 7.46.0 <br>  &gt; Accept: * / * <br>  &gt; Content-Length: 9 <br>  &gt; Content-Type: application / x-www-form-urlencoded <br>  &gt; <br>  * upload completely sent off: 9 out of 9 bytes <br>  &lt;HTTP / 1.1 200 OK <br>  &lt;Date: Sat, 20 Apr 2019 06:56:19 GMT <br>  &lt;Content-Length: 10 <br>  &lt;Content-Type: text / plain;  charset = utf-8 <br>  &lt; <br>  Hello go! <br>  * Connection # 0 to host localhost left intact <br><br><h3>  HTTP / 1.1 Client </h3><br>  The new code is an example of writing a simple HTTP / 1.1 client on Go.  This client sends an HTTP (S) POST request to <a href="https://localhost/">localhost</a> : 9191 / hello / sayHello with the message ‚ÄúHello Go!‚Äù. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"bytes"</span></span> <span class="hljs-string"><span class="hljs-string">"crypto/tls"</span></span> <span class="hljs-string"><span class="hljs-string">"crypto/x509"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"io/ioutil"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { client := &amp;http.Client{} <span class="hljs-comment"><span class="hljs-comment">// Create a pool with the server certificate since it is not signed // by a known CA caCert, err := ioutil.ReadFile("./cert/server.crt") if err != nil { log.Fatalf("Reading server certificate: %s", err) } caCertPool := x509.NewCertPool() caCertPool.AppendCertsFromPEM(caCert) // Create TLS configuration with the certificate of the server tlsConfig := &amp;tls.Config{ RootCAs: caCertPool, } // Use the proper transport in the client client.Transport = &amp;http.Transport{ TLSClientConfig: tlsConfig, } // Perform the request resp, err := client.Post("https://localhost:9191/hello/sayHello", "text/plain", bytes.NewBufferString("Hello Go!")) if err != nil { log.Fatalf("Failed get: %s", err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) if err != nil { log.Fatalf("Failed reading response body: %s", err) } fmt.Printf("Got response %d: %s %s", resp.StatusCode, resp.Proto, string(body))</span></span></code> </pre> <br>  Since the HTTP (S) service also starts here, you need to provide a certificate and a key.  The necessary data is located in the cert directory with the names server.crt and server.key. <br><br>  In order to start the client, you need to initialize the server.  To do this, perform the actions described in the first section, or launch any HTTP (S) service with port 9191 and the / hello / sayHello path. <br><br><pre> <code class="plaintext hljs">$ go run http_client.go</code> </pre> <br>  The output should be: <br><br><pre> <code class="plaintext hljs">Got response 200: HTTP/1.1 Hello Go!</code> </pre> <br>  The client shows the work of the curl command: <br><br><pre> <code class="plaintext hljs">$ curl -v --cacert ./cert/server.crt https://localhost:9191/hello/sayHello -d "Hello Go!"</code> </pre> <br>  After you finish working with HTTP / 1.1, you should try repeating the same for HTTP / 2. <br><br><h3>  HTTP / 2 Server </h3><br>  As in the previous section, you first need to create an echo server. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"golang.org/x/net/http2"</span></span> <span class="hljs-string"><span class="hljs-string">"io/ioutil"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpServer = http.Server{ Addr: <span class="hljs-string"><span class="hljs-string">":9191"</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http2Server = http2.Server{} _ = http2.ConfigureServer(&amp;httpServer, &amp;http2Server) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/hello/sayHello"</span></span>, echoPayload) log.Printf(<span class="hljs-string"><span class="hljs-string">"Go Backend: { HTTPVersion = 2 }; serving on https://localhost:9191/hello/sayHello"</span></span>) log.Fatal(httpServer.ListenAndServeTLS(<span class="hljs-string"><span class="hljs-string">"./cert/server.crt"</span></span>, <span class="hljs-string"><span class="hljs-string">"./cert/server.key"</span></span>)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoPayload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span></span></span> { log.Printf(<span class="hljs-string"><span class="hljs-string">"Request connection: %s, path: %s"</span></span>, req.Proto, req.URL.Path[<span class="hljs-number"><span class="hljs-number">1</span></span>:]) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> req.Body.Close() contents, err := ioutil.ReadAll(req.Body) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatalf(<span class="hljs-string"><span class="hljs-string">"Oops! Failed reading body of the request.\n %s"</span></span>, err) http.Error(w, err.Error(), <span class="hljs-number"><span class="hljs-number">500</span></span>) } fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"%s\n"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(contents))</code> </pre> <br>  In order to test the server, you need to send the command: <br><br><pre> <code class="plaintext hljs">$ go run http2_server.go</code> </pre> <br>  The answer should be: <br><br><pre> <code class="plaintext hljs">Go Backend: { HTTPVersion = 2 }; serving on https://localhost:9191/hello/sayHello</code> </pre> <br>  Now the server is running, you can initialize it using HTTP / 1.1 or HTTP / 2 requests.  HTTP / 1.1 POST commands for testing server operation are listed below: <br><br><pre> <code class="plaintext hljs">$ curl -k -v https://localhost:9191/hello/sayHello -d "Hello Go!" $ curl -v --cacert ./cert/server.crt https://localhost:9191/hello/sayHello -d "Hello Go!"</code> </pre> <br>  And the same thing, but with HTTP / 2 POST: <br><br><pre> <code class="plaintext hljs">$ curl -k -v --http2 https://localhost:9191/hello/sayHello -d "Hello Go!" $ curl -v --http2 --cacert ./cert/server.crt https://localhost:9191/hello/sayHello -d "Hello Go!"</code> </pre> <br>  Below is an example of server output.  The first part is the TLS handshake between the server and the client, the second is the details of the HTTP / 2 request and response. <br><br>  * Trying 127.0.0.1 ... <br>  * Connected to localhost (127.0.0.1) port 9191 (# 0) <br>  * ALPN, offering h2 <br>  * ALPN, offering http / 1.1 <br>  * Cipher selection: ALL:! EXPORT:! EXPORT40:! EXPORT56:! ANULL:! LOW:! RC4: @STRENGTH <br>  * successfully set certificate verify locations: <br>  * CAfile: src / hello / cert / server.crt <br>  CApath: none <br>  * TLSv1.2 (OUT), TLS header, Certificate Status (22): <br>  * TLSv1.2 (OUT), TLS handshake, Client hello (1): <br>  * TLSv1.2 (IN), TLS handshake, Server hello (2): <br>  * TLSv1.2 (IN), TLS handshake, Certificate (11): <br>  * TLSv1.2 (IN), TLS handshake, Server key exchange (12): <br>  * TLSv1.2 (IN), TLS handshake, Server finished (14): <br>  * TLSv1.2 (OUT), TLS handshake, Client key exchange (16): <br>  * TLSv1.2 (OUT), TLS change cipher, Client hello (1): <br>  * TLSv1.2 (OUT), TLS handshake, Finished (20): <br>  * TLSv1.2 (IN), TLS change cipher, Client hello (1): <br>  * TLSv1.2 (IN), TLS handshake, Finished (20): <br>  * SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256 <br>  * ALPN, server accepted to use h2 <br>  * Server certificate: <br>  * subject: C = LK;  ST = Western;  L = Colombo;  O = LDCLAKMAL;  OU = Engineering;  CN = localhost;  emailAddress=ldclakmal@gmail.com <br>  * start date: Apr 20 05:27:33 2019 GMT <br>  * expire date: Apr 19 05:27:33 2020 GMT <br>  * common name: localhost (matched) <br>  * issuer: C = LK;  ST = Western;  L = Colombo;  O = LDCLAKMAL;  OU = Engineering;  CN = localhost;  emailAddress=ldclakmal@gmail.com <br>  * SSL certificate verify ok. <br>  * Using HTTP2, server supports multi-use <br>  * Connection state changed (HTTP / 2 confirmed) <br>  * TCP_NODELAY set <br>  * Copying HTTP / 2 data for connection buffer after upgrade: len = 0 <br>  * Using Stream ID: 1 (easy handle 0x10ddf20) <br>  &gt; POST / hello / sayHello HTTP / 1.1 <br>  &gt; Host: localhost: 9191 <br>  &gt; User-Agent: curl / 7.46.0 <br>  &gt; Accept: * / * <br>  &gt; Content-Length: 9 <br>  &gt; Content-Type: application / x-www-form-urlencoded <br>  &gt; <br>  * We are completely uploaded and fine <br>  &lt;HTTP / 2.0 200 <br>  &lt;content-type: text / plain;  charset = utf-8 <br>  &lt;content-length: 10 <br>  &lt;date: Sat, 20 Apr 2019 06:54:50 GMT <br>  &lt; <br>  Hello go! <br>  * Connection # 0 to host localhost left intact <br><br><h3>  HTTP / 2 Client </h3><br>  The last part is creating an HTTP / 2 client.  Here is the implementation of sending an HTTP (S) POST request for <a href="https://localhost/">localhost</a> : 9191 / hello / sayHello: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"bytes"</span></span> <span class="hljs-string"><span class="hljs-string">"crypto/tls"</span></span> <span class="hljs-string"><span class="hljs-string">"crypto/x509"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"golang.org/x/net/http2"</span></span> <span class="hljs-string"><span class="hljs-string">"io/ioutil"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { client := &amp;http.Client{} <span class="hljs-comment"><span class="hljs-comment">// Create a pool with the server certificate since it is not signed // by a known CA caCert, err := ioutil.ReadFile("./cert/server.crt") if err != nil { log.Fatalf("Reading server certificate: %s", err) } caCertPool := x509.NewCertPool() caCertPool.AppendCertsFromPEM(caCert) // Create TLS configuration with the certificate of the server tlsConfig := &amp;tls.Config{ RootCAs: caCertPool, } // Use the proper transport in the client client.Transport = &amp;http2.Transport{ TLSClientConfig: tlsConfig, } // Perform the request resp, err := client.Post("https://localhost:9191/hello/sayHello", "text/plain", bytes.NewBufferString("Hello Go!")) if err != nil { log.Fatalf("Failed get: %s", err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) if err != nil { log.Fatalf("Failed reading response body: %s", err) } fmt.Printf("Got response %d: %s %s", resp.StatusCode, resp.Proto, string(body))</span></span></code> </pre> <br>  As before, you need a key and a certificate.  They are saved in cert with the names server.crt and server.key. <br><br>  Client start: <br><br><pre> <code class="plaintext hljs">$ go run http2_client.go</code> </pre> <br>  And the expected answer: <br><br><pre> <code class="plaintext hljs">Got response 200: HTTP/2 Hello Go!</code> </pre> <br>  Details of the client's work: <br><br><pre> <code class="plaintext hljs">$ curl -v --http2 --cacert ./cert/server.crt https://localhost:9191/hello/sayHello -d "Hello Go!"</code> </pre> <br>  That's all.  The job is relatively simple, but it gives you an understanding of how to implement basic network services in Go. <br><br><blockquote>  <b>Skillbox recommends:</b> <br><br><ul><li>  Two-year practical course <a href="https://iamwebdev.skillbox.ru/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DWEBDEVPRO%26utm_content%3Darticles%26utm_term%3Dgoserver">"I am a web developer PRO"</a> . </li><li>  Educational online course <a href="https://skillbox.ru/java/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DJAVDEV%26utm_content%3Darticles%26utm_term%3Dgoserver">"Profession Java developer"</a> . </li><li>  Practical annual course <a href="https://skillbox.ru/php/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DPHPDEV%26utm_content%3Darticles%26utm_term%3Dgoserver">"PHP developer from 0 to PRO"</a> . <br></li></ul></blockquote></div><p>Source: <a href="https://habr.com/ru/post/451032/">https://habr.com/ru/post/451032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451004/index.html">Technosphere. Course of lectures "Management of IT-projects and product"</a></li>
<li><a href="../451008/index.html">End2End-approach to speaking</a></li>
<li><a href="../451012/index.html">Random permutations and random partitions</a></li>
<li><a href="../45102/index.html">One billion downloads addons</a></li>
<li><a href="../45103/index.html">Photosynty and panorama of Yekaterinburg</a></li>
<li><a href="../45104/index.html">my.opera.com loves Habrahabr</a></li>
<li><a href="../451040/index.html">Unrestrained fun in May, or Standoff approaching</a></li>
<li><a href="../451042/index.html">The Basics of Database Design - PostgreSQL, Cassandra and MongoDB Comparison</a></li>
<li><a href="../451044/index.html">IMaskjs - 3 years in open source</a></li>
<li><a href="../45105/index.html">Russian group order for Neo FreeRunners arrived</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>