<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ducks, Thailand, and T-SQL ... or what might lurk programmers when working with SQL Server?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started quite mundanely ... Richter read out and strenuously studied Schild. I thought that I would be engaged in developing for .NET , but fat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ducks, Thailand, and T-SQL ... or what might lurk programmers when working with SQL Server?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/175/993/204/175993204615473ebce2501d20d9ad8f.png"></div><br>  It all started quite mundanely ... Richter read out and strenuously studied Schild.  I thought that I would be engaged in developing for <i>.NET</i> , but fate in the first month of work decided otherwise.  One of the employees unexpectedly left the project and threw fresh human material into the newly formed hole.  That's when my acquaintance with <i>SQL Server began</i> . <br><br>  A little less than 6 years have passed since then and much can be remembered ... <br><br>  About a former client of Joseph from England, who rethought life, during a vacation in Thailand, and Josephine began to sign on my Skype.  About cheerful office neighbors who had to sit in the same room: one suffered from allergies to fresh air, and the other toiled with unrequited love for C ++, complementing this with allergies to sunlight.  Once upon a command from above, it was necessary for the time being to become Alexander the father of two children, in order to pretend to be a senior senior with <i>JS</i> . <br><a name="habracut"></a><br>  But the most fierce trash is probably connected with the story of a rubber duck-squeaker.  One colleague took off her stress and, once, in a fit of emotion, bit her head off.  Since then, the duck has lost its former gloss and was soon replaced with a ball, which he sometimes tried to gnaw ... alas, without success. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Why was this told?  If you want to devote your life to working with databases, then the first thing you need to learn ... is stress resistance.  The second is to adopt a few rules when writing queries for <i>T-SQL</i> , which many of the novice developers do not know or simply ignore, and then sit and puzzle ... why is something not working? <br><br><h3>  Content: </h3><br>  1. <a href="https://habr.com/ru/post/315142/">Data Types</a> <br>  2. <a href="https://habr.com/ru/post/315142/">*</a> <br>  3. <a href="https://habr.com/ru/post/315142/">Alias</a> <br>  4. <a href="https://habr.com/ru/post/315142/">Column order</a> <br>  5. <a href="https://habr.com/ru/post/315142/">NOT IN vs NULL</a> <br>  6. <a href="https://habr.com/ru/post/315142/">Date format</a> <br>  7. <a href="https://habr.com/ru/post/315142/">Date filter</a> <br>  8. <a href="https://habr.com/ru/post/315142/">Calculation</a> <br>  9. <a href="https://habr.com/ru/post/315142/">Convert implicit</a> <br>  10. <a href="https://habr.com/ru/post/315142/">LIKE &amp; Suppressed index</a> <br>  11. <a href="https://habr.com/ru/post/315142/">Unicode vs ANSI</a> <br>  12. <a href="https://habr.com/ru/post/315142/">COLLATE</a> <br>  13. <a href="https://habr.com/ru/post/315142/">BINARY COLLATE</a> <br>  14. <a href="https://habr.com/ru/post/315142/">Code style</a> <br>  15. <a href="https://habr.com/ru/post/315142/">[var] char</a> <br>  16. <a href="https://habr.com/ru/post/315142/">Data length</a> <br>  17. <a href="https://habr.com/ru/post/315142/">ISNULL vs COALESCE</a> <br>  18. <a href="https://habr.com/ru/post/315142/">Math</a> <br>  19. <a href="https://habr.com/ru/post/315142/">UNION vs UNION ALL</a> <br>  20. <a href="https://habr.com/ru/post/315142/">Re-read</a> <br>  21. <a href="https://habr.com/ru/post/315142/">SubQuery</a> <br>  22. <a href="https://habr.com/ru/post/315142/">CASE WHEN</a> <br>  23. <a href="https://habr.com/ru/post/315142/">Scalar func</a> <br>  24. <a href="https://habr.com/ru/post/315142/">VIEWs</a> <br>  25. <a href="https://habr.com/ru/post/315142/">CURSORs</a> <br>  26. <a href="https://habr.com/ru/post/315142/">STRING_CONCAT</a> <br>  27. <a href="https://habr.com/ru/post/315142/">SQL Injection</a> <br>  <a href="https://habr.com/ru/post/315142/">Video with examples</a> <br><br><h3>  1. Data Types </h3><a name="b1"></a><br>  The most basic thing with which most problems begin when working with <i>SQL Server</i> is the wrong choice of data types.  Take a hypothetical example with two identical tables in essence: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @Employees1 <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( EmployeeID <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> , IsMale <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) , BirthDate <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @Employees1 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-string"><span class="hljs-string">'YES'</span></span>, <span class="hljs-string"><span class="hljs-string">'2012-09-01'</span></span>)</code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @Employees2 <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( EmployeeID <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> , IsMale <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> , BirthDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @Employees2 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'2012-09-01'</span></span>)</code> </pre> <br>  Perform a query and see what the difference is: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @BirthDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> = <span class="hljs-string"><span class="hljs-string">'2012-09-01'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @Employees1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> BirthDate = @BirthDate <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @Employees2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> BirthDate = @BirthDate</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/bae/485/ee0/bae485ee0ca64c3f9d309885a7aee735.png"></div><br>  In the first case, the data types are more redundant than they could be.  Why store the bit sign as a string <i>YES / NO</i> ?  Why keep the date as a string?  Why <i>BIGINT</i> according to the table with employees?  Than simple <i>int</i> did not fit? <br><br>  This is bad for several reasons: the tables will take up more disk space, you need to read more pages from the disk and place more pages in the <i>BufferPool</i> to handle this data.  In addition, there may be more serious performance problems - a question mark easily hints at this, but we'll talk about this later. <br><br><h3>  2. * </h3><a name="b2"></a><br>  Often we had to meet the ‚Äúoil painting‚Äù: all data is taken from the table, and then on the client through the <i>DataReader</i> only those columns that are really needed are selected.  It is extremely inefficient, so it is better not to use this practice: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID , FirstName , MiddleName , LastName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span></code> </pre> <br>  The difference will be both in the time the query is executed and in the fact that it will be possible to do less logical readings due to the covering index: <br><br><pre> <code class="1c hljs">Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">3819</span></span>, physical reads <span class="hljs-number"><span class="hljs-number">3</span></span>, ... SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">31</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">1235</span></span> ms. Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">109</span></span>, physical reads <span class="hljs-number"><span class="hljs-number">1</span></span>, ... SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">0</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">227</span></span> ms.</code> </pre> <br><h3>  3. Alias </h3><a name="b3"></a><br>  Create a table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> OBJECT_ID(<span class="hljs-string"><span class="hljs-string">'Sales.UserCurrency'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Sales.UserCurrency <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Sales.UserCurrency ( CurrencyCode <span class="hljs-keyword"><span class="hljs-keyword">NCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> Sales.UserCurrency <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'USD'</span></span>)</code> </pre> <br>  Suppose we have a query that returns the number of identical rows in both tables: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.Currency <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CurrencyCode <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CurrencyCode <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.UserCurrency )</code> </pre> <br>  And everything will work, as we expect, until someone wants to rename a column in the <i>Sales.UserCurrency</i> table: <br><br><pre> <code class="sql hljs">EXEC sys.sp_rename 'Sales.UserCurrency.CurrencyCode', 'Code', 'COLUMN'</code> </pre> <br>  Let's execute the query and see that it is not 1 row that is returned, but all that are in <i>Sales.Currency</i> .  When building a <i>SQL Server</i> execution plan at the binding stage, it will look at the columns. <i>Sales.UserCurrency</i> will not find the <i>CurrencyCode</i> there and will think that this column refers to the <i>Sales.Currency</i> table and then the optimizer will omit the condition <i>CurrencyCode = CurrencyCode</i> . <br><br>  Moral - use aliases: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.Currency c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.CurrencyCode <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> u.CurrencyCode <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.UserCurrency u )</code> </pre> <br><h3>  4. Column order </h3><a name="b4"></a><br>  Suppose we have some kind of table: <br><br><pre> <code class="sql hljs">IF OBJECT_ID('dbo.DatePeriod') IS NOT NULL <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.DatePeriod <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.DatePeriod ( StartDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> , EndDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> )</code> </pre> <br>  And we always insert the data into it from the assumption that we know how the columns are arranged in order: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.DatePeriod <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'2015-01-01'</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-01-31'</span></span></code> </pre> <br>  Then one fine day, someone reverses the order of the columns: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.DatePeriod ( EndDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> , StartDate <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> )</code> </pre> <br>  And the data will already be inserted in the wrong columns in which the developer expects.  Therefore, it is always recommended to explicitly specify columns in the <i>INSERT</i> construct: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.DatePeriod (StartDate, EndDate) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'2015-01-01'</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-01-31'</span></span></code> </pre> <br>  There is another interesting example: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatePeriod <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br>  Which column will be sorted?  And it all depends on the current order in the table.  If someone changes it, then the request will not display what we expect. <br><br><h3>  5. NOT IN vs NULL </h3><a name="b5"></a><br>  The undisputed leader among the questions at the interview <i>Junior DB Developer</i> - construction <i>NOT IN</i> . <br><br>  For example, you need to write a couple of queries: return all records from the first table that are not in the second and vice versa.  Very often, novice developers do not bother and use <i>IN</i> and <i>NOT IN</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @t1 <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (t1 <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> CLUSTERED(t1)) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @t1 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @t2 <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (t2 <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> CLUSTERED(t2)) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @t2 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1 <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t2) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1 <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t2)</code> </pre> <br>  The first request returned us a deuce, the second - one.  Let's now add another value to the second table ‚Äî <i>NULL</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @t2 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)</code> </pre> <br>  When executing a query with <i>NOT IN,</i> we will not get any results.  Has any magic intervened - <i>IN</i> works, and <i>NOT IN</i> refuses.  This is the first thing that you need to ‚Äúunderstand and forgive‚Äù when working with <i>SQL Server</i> , which is guided by tertiary logic during a comparison operation: <i>TRUE</i> , <i>FALSE</i> , <i>UNKNOWN</i> . <br><br>  When running, <i>SQL Server</i> interprets the <i>IN</i> clause: <br><br><pre> <code class="1c hljs">a IN (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) == a=<span class="hljs-number"><span class="hljs-number">1</span></span> OR a=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre> <br>  <i>NOT IN</i> : <br><br><pre> <code class="1c hljs">a NOT IN (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) == a&lt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span> AND a&lt;&gt;<span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre> <br>  Comparing any value with <i>NULL</i> returns <i>UNKNOWN</i> .  <i>1 = NULL</i> , <i>NULL = NULL</i> .  The result will be one - <i>UNKNOWN</i> .  And since we use the <i>AND</i> operator in the condition, the whole expression will return an undefined value and, as a result, will be empty. <br><br>  Written a bit boring.  But it is important to understand that this situation occurs quite often.  For example, before a column was declared <i>NOT NULL</i> , then some kind person allowed to write a <i>NULL</i> value to it.  The result: the client stops working report after at least one <i>NULL</i> value gets into the table. <br><br>  What to do?  You can explicitly discard <i>NULL</i> values: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1 <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t2 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> )</code> </pre> <br>  You can use <i>EXCEPT</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t1 <span class="hljs-keyword"><span class="hljs-keyword">EXCEPT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t2</code> </pre> <br>  If there is no desire to think a lot, then it is easier to use <i>NOT EXISTS</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t1 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @t2 <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t1 = t2 )</code> </pre> <br>  Which query option is more optimal?  Preferred is the last option with <i>NOT EXISTS</i> , which generates a more optimal <i>predicate pushdown</i> statement when accessing data from the second table. <br><br>  In general, with <i>NULL</i> values, many jokes.  You can play around with such queries: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Production.Product <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Production.Product <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Color = <span class="hljs-string"><span class="hljs-string">'Grey'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Production.Product <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Color &lt;&gt; <span class="hljs-string"><span class="hljs-string">'Grey'</span></span></code> </pre> <br>  and not to get the expected result just because separate comparison operators are provided for <i>NULL</i> values: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Production.Product <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Color <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Production.Product <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Color <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre> <br>  Even more interesting is the situation with <i>CHECK</i> constraints: <br><br><pre> <code class="sql hljs">IF OBJECT_ID('tempdb.dbo.<span class="hljs-comment"><span class="hljs-comment">#temp') IS NOT NULL DROP TABLE #temp GO CREATE TABLE #temp ( Color VARCHAR(15) --NULL , CONSTRAINT CK CHECK (Color IN ('Black', 'White')) )</span></span></code> </pre> <br>  We create a table in which we allow recording only white and black colors: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#temp VALUES ('Black')</span></span></code> </pre> <br><pre> <code class="1c hljs">(<span class="hljs-number"><span class="hljs-number">1</span></span> row(s) affected)</code> </pre> <br>  Everything works as we expect: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#temp VALUES ('Red')</span></span></code> </pre> <br><pre> <code class="1c hljs">The INSERT statement conflicted with the CHECK constraint... The statement has been terminated.</code> </pre> <br>  But let's insert <i>null</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#temp VALUES (NULL)</span></span></code> </pre> <br><pre> <code class="1c hljs">(<span class="hljs-number"><span class="hljs-number">1</span></span> row(s) affected)</code> </pre> <br>  Our <i>CHECK</i> constraint did not work, because <i>NOT FALSE is</i> enough for writing, i.e.  and <i>TRUE</i> and <i>UNKNOWN</i> are suitable for a sweet soul.  There are several options to bypass this behavior: explicitly declare a column as <i>NOT NULL</i> or consider <i>NULL</i> in the constraint. <br><br><h3>  6. Date format </h3><a name="b6"></a><br>  More often stumble on different nuances with data types.  For example, you need to get the current time.  Executed the GETDATE function: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GETDATE</span></span>()</code> </pre> <br>  Copied the result, pasted it into the query as it is and removed the time: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> create_date &lt; <span class="hljs-string"><span class="hljs-string">'2016-11-14'</span></span></code> </pre> <br>  Is it correct to do so? <br><br>  The date is set to a string constant, and to some extent, <i>SQL Server</i> allows freedom when writing it: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> English <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> DATEFORMAT DMY <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @d1 DATETIME = <span class="hljs-string"><span class="hljs-string">'05/12/2016'</span></span> , @d2 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016/12/05'</span></span> , @d3 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016-12-05'</span></span> , @d4 DATETIME = <span class="hljs-string"><span class="hljs-string">'05-dec-2016'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @d1, @d2, @d3, @d4</code> </pre> <br>  All values ‚Äã‚Äãare almost everywhere interpreted uniquely: <br><br><pre> <code class="1c hljs">----------- ----------- ----------- ----------- <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span></code> </pre> <br>  And this will not lead to problems until the request with such business logic is started on another server, on which the settings may differ: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> DATEFORMAT MDY <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @d1 DATETIME = <span class="hljs-string"><span class="hljs-string">'05/12/2016'</span></span> , @d2 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016/12/05'</span></span> , @d3 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016-12-05'</span></span> , @d4 DATETIME = <span class="hljs-string"><span class="hljs-string">'05-dec-2016'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @d1, @d2, @d3, @d4</code> </pre> <br>  All these options can lead to misinterpretation of the date: <br><br><pre> <code class="1c hljs">----------- ----------- ----------- ----------- <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">05</span></span></code> </pre> <br>  Moreover, such code can lead to an error both explicitly and hidden.  For example, we need to insert data into a table.  On the test server, everything works fine: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @t <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (a DATETIME) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @t <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'05/13/2016'</span></span>)</code> </pre> <br>  And the client, due to the difference in server settings, such a request will lead to problems: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @t <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (a DATETIME) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> DATEFORMAT DMY <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @t <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'05/13/2016'</span></span>)</code> </pre> <br><pre> <code class="1c hljs">Msg <span class="hljs-number"><span class="hljs-number">242</span></span>, Level <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">3</span></span>, Line <span class="hljs-number"><span class="hljs-number">28</span></span> The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.</code> </pre> <br>  So in what format to set constants for dates?  Let's look at another example: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> DATEFORMAT YMD <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> English <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @d1 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016/01/12'</span></span> , @d2 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016-01-12'</span></span> , @d3 DATETIME = <span class="hljs-string"><span class="hljs-string">'12-jan-2016'</span></span> , @d4 DATETIME = <span class="hljs-string"><span class="hljs-string">'20160112'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @d1, @d2, @d3, @d4 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> Deutsch <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @d1 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016/01/12'</span></span> , @d2 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016-01-12'</span></span> , @d3 DATETIME = <span class="hljs-string"><span class="hljs-string">'12-jan-2016'</span></span> , @d4 DATETIME = <span class="hljs-string"><span class="hljs-string">'20160112'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @d1, @d2, @d3, @d4</code> </pre> <br>  Depending on the language set, constants can also be interpreted differently: <br><br><pre> <code class="1c hljs">----------- ----------- ----------- ----------- <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> ----------- ----------- ----------- ----------- <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span></code> </pre> <br>  And the conclusion suggests the use of the last two options.  At once I will say that explicitly setting the month is a good opportunity to stumble upon the ‚Äúnot a manj pa sys jour‚Äù error: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> French <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @d DATETIME = <span class="hljs-string"><span class="hljs-string">'12-jan-2016'</span></span></code> </pre> <br><pre> <code class="1c hljs">Msg <span class="hljs-number"><span class="hljs-number">241</span></span>, Level <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, Line <span class="hljs-number"><span class="hljs-number">29</span></span> √âchec de la conversion de la date et/ou de l'heure √† partir d'une cha√Æne de caract√®res.</code> </pre> <br>  Total - remains the last option.  If you want constants with dates to be unambiguously interpreted in the system, regardless of the settings and phase of the moon, then specify them in the format <i>YYYYMMDD</i> without any tildes, quotes and slashes. <br><br>  Another thing to note is the difference in the behavior of some data types: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> English <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> DATEFORMAT YMD <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @d1 <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> = <span class="hljs-string"><span class="hljs-string">'2016-01-12'</span></span> , @d2 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016-01-12'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @d1, @d2 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> Deutsch <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> DATEFORMAT DMY <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @d1 <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> = <span class="hljs-string"><span class="hljs-string">'2016-01-12'</span></span> , @d2 DATETIME = <span class="hljs-string"><span class="hljs-string">'2016-01-12'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @d1, @d2</code> </pre> <br>  Unlike <i>DATETIME</i> , the <i>DATE</i> type is correctly interpreted with different settings on the server: <br><br><pre> <code class="1c hljs">---------- ---------- <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> ---------- ---------- <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span></code> </pre> <br>  But do you need to keep this nuance in your head?  Hardly.  The main thing to remember is that you need to set the dates in the format <i>YYYYMMDD</i> and there will be no problems. <br><br><h3>  7. Date filter </h3><a name="b7"></a><br>  Next, consider how to effectively filter data.  For some reason, the <i>DATETIME / DATE</i> columns have the largest number of crutches, so we will start with this data type: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> PostTime = <span class="hljs-string"><span class="hljs-string">'20140716 12:12:12'</span></span></code> </pre> <br>  Now let's try to find out how many rows the query will return for a certain day: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> PostTime = <span class="hljs-string"><span class="hljs-string">'20140716'</span></span></code> </pre> <br>  Request returns 0. Why?  When building a plan, <i>SQL Server</i> tries to convert a string constant to the data type of the column that is filtered: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a8c/dfe/49b/a8cdfe49b2b54b73ab70bf0658c2c0a5.png"></div><br>  Create an index: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> IX_PostTime <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.DatabaseLog (PostTime)</code> </pre> <br>  There are correct and incorrect options to display the required data.  For example, trim time: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONVERT</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>), PostTime, <span class="hljs-number"><span class="hljs-number">112</span></span>) = <span class="hljs-string"><span class="hljs-string">'20140716'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(PostTime <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>) = <span class="hljs-string"><span class="hljs-string">'20140716'</span></span></code> </pre> <br>  Or set the range: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> PostTime <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-string"><span class="hljs-string">'20140716'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">'20140716 23:59:59.997'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> PostTime &gt;= <span class="hljs-string"><span class="hljs-string">'20140716'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> PostTime &lt; <span class="hljs-string"><span class="hljs-string">'20140717'</span></span></code> </pre> <br>  The last two queries are more correct from the point of view of optimization.  And the fact is that all conversions and calculations on the index columns being searched can dramatically reduce performance and increase logical readings (the first and last three variants of the query): <br><br><pre> <code class="1c hljs">Table 'DatabaseLog'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">7</span></span>, ... Table 'DatabaseLog'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">2</span></span>, ...</code> </pre> <br>  The <i>PostTime</i> field was <i>not</i> previously included in the index, and we would not be able to see any special effect from using the ‚Äúcorrect‚Äù approach for filtering.  Another thing, when we need to display data for the month.  What just did not see: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONVERT</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>), PostTime, <span class="hljs-number"><span class="hljs-number">112</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'201407%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">YEAR</span></span>, PostTime) = <span class="hljs-number"><span class="hljs-number">2014</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MONTH</span></span>, PostTime) = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">YEAR</span></span>(PostTime) = <span class="hljs-number"><span class="hljs-number">2014</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MONTH</span></span>(PostTime) = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EOMONTH</span></span>(PostTime) = <span class="hljs-string"><span class="hljs-string">'20140731'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> PostTime &gt;= <span class="hljs-string"><span class="hljs-string">'20140701'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> PostTime &lt; <span class="hljs-string"><span class="hljs-string">'20140801'</span></span></code> </pre> <br>  And again, the last option is more acceptable than all the others: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7c0/021/c84/7c0021c849a14d0ab9d2acaa7a9bf71d.png"></div><br>  In addition, you can always make a calculated field and create an index based on it: <br><br><pre> <code class="sql hljs">IF COL_LENGTH('dbo.DatabaseLog', 'MonthLastDay') IS NOT NULL <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> MonthLastDay <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> MonthLastDay <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EOMONTH</span></span>(PostTime) <span class="hljs-comment"><span class="hljs-comment">--PERSISTED GO CREATE INDEX IX_MonthLastDay ON dbo.DatabaseLog (MonthLastDay)</span></span></code> </pre> <br>  In comparison with the previous query, the difference in logical readings will be significant (if we are talking about large tables): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> PostTime &gt;= <span class="hljs-string"><span class="hljs-string">'20140701'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> PostTime &lt; <span class="hljs-string"><span class="hljs-string">'20140801'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.DatabaseLog <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> MonthLastDay = <span class="hljs-string"><span class="hljs-string">'20140731'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span></code> </pre> <br><pre> <code class="1c hljs">Table 'DatabaseLog'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">7</span></span>, ... Table 'DatabaseLog'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">3</span></span>, ...</code> </pre> <br><h3>  8. Calculation </h3><a name="b8"></a><br>  As I already said, any calculations on the index fields degrade performance and lead to an increase in logical reads: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> BusinessEntityID * <span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> BusinessEntityID = <span class="hljs-number"><span class="hljs-number">2500</span></span> * <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> BusinessEntityID = <span class="hljs-number"><span class="hljs-number">5000</span></span></code> </pre> <br><pre> <code class="1c hljs">Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">67</span></span>, ... Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">0</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">3</span></span>, ...</code> </pre> <br>  If you look at the execution plans, in the first case <i>SQL Server</i> has to run <i>IndexScan</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/12d/53b/f6b/12d53bf6bcbc4f99ba2343255541293f.png"></div><br>  In the second and third cases, when the calculations are on the index field, no, we will see <i>IndexSeek</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bc1/673/eb9/bc1673eb9ed6417b9b674da64608fd80.png"></div><br><h3>  9. Convert implicit </h3><a name="b9"></a><br>  First, let's look at these two queries, which are filtered by the same value: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID, NationalIDNumber <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> NationalIDNumber = <span class="hljs-number"><span class="hljs-number">30845</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID, NationalIDNumber <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> NationalIDNumber = <span class="hljs-string"><span class="hljs-string">'30845'</span></span></code> </pre> <br>  If you look at the execution plans: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0f7/cff/067/0f7cff06737f472db1abbcd9125737ae.png"></div><br>  In the first case - a warning and <i>IndexScan</i> , in the second - <i>IndexSeek</i> : <br><br><pre> <code class="1c hljs">Table 'Employee'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">4</span></span>, ... Table 'Employee'. Scan count <span class="hljs-number"><span class="hljs-number">0</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">2</span></span>, ...</code> </pre> <br>  What happened?  The <i>NationalIDNumber</i> column has the data type <i>NVARCHAR (15)</i> .  The constant, by the value of which you need to filter the data, we pass as <i>INT</i> and as a result we get an implicit type conversion, which can degrade performance.  This happens very often when someone changes the data type on a column, but the queries remain the same. <br><br>  However, it is important to understand that not only performance problems can wait for us.  Implicit type conversion can lead to runtime errors.  For example, earlier the PostalCode field was numeric, then an indication came from above that the postal code may contain letters.  The data type was changed, but as soon as the letter postal code is inserted, the old query will no longer work: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> PostalCode = <span class="hljs-number"><span class="hljs-number">92700</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> PostalCode = <span class="hljs-string"><span class="hljs-string">'92700'</span></span></code> </pre> <br><pre> <code class="1c hljs">Msg <span class="hljs-number"><span class="hljs-number">245</span></span>, Level <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, Line <span class="hljs-number"><span class="hljs-number">16</span></span> Conversion failed when converting the nvarchar value 'K4B 1S2' to data type int.</code> </pre> <br>  Even more interesting is when the project uses <i>EntityFramework</i> , which interprets all string fields as <i>Unicode</i> by default: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CustomerID, AccountNumber <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.Customer <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AccountNumber = N<span class="hljs-string"><span class="hljs-string">'AW00000009'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CustomerID, AccountNumber <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.Customer <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AccountNumber = <span class="hljs-string"><span class="hljs-string">'AW00000009'</span></span></code> </pre> <br>  And as a result, we have generated not quite optimal requests: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/05b/f9e/67f/05bf9e67f1b447d3a32e8f48b1a0a124.png"></div><br>  The solution to the problem is quite simple - you need to control that the data types match when comparing. <br><br><h3>  10. LIKE &amp; Suppressed index </h3><a name="b10"></a><br>  Even when you have a covering index, it‚Äôs not a fact that it will be used effectively.  For example, we need to print all the lines that start with ... <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(AddressLine1, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) = <span class="hljs-string"><span class="hljs-string">'100'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span>(AddressLine1, <span class="hljs-number"><span class="hljs-number">3</span></span>) = <span class="hljs-string"><span class="hljs-string">'100'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>)) = <span class="hljs-string"><span class="hljs-string">'100'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'100%'</span></span></code> </pre> <br>  We get the following logical reads: <br><br><pre> <code class="1c hljs">Table 'Address'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">216</span></span>, ... Table 'Address'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">216</span></span>, ... Table 'Address'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">216</span></span>, ... Table 'Address'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">4</span></span>, ...</code> </pre> <br>  Fulfillment plans for quickly finding a winner: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5f0/a23/9d2/5f0a239d29194e5d96ba559b4fc598ff.png"></div><br>  The result is the sum we talked about so long before.  If there is an index, then it should not have any calculations and type conversions, functions, and other things.  Only then will it be effectively used by <i>SQL Server</i> . <br><br>  But what if you need to find all occurrences of a substring in a string?  This problem is obviously more interesting: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%100%'</span></span></code> </pre> <br>  But first we need to learn a lot of interesting things about strings and their properties. <br><br><h3>  11. Unicode vs ANSI </h3><a name="b11"></a><br>  The first thing to remember is that strings are <i>UNICODE</i> and <i>ANSI</i> .  For the first types, data types <i>NVARCHAR / NCHAR are provided</i> (2 bytes per symbol - alas, <i>UTF8 was</i> not delivered).  To store <i>ANSI</i> strings - <i>VARCHAR / CHAR</i> (1 byte - 1 character).  There is also <i>TEXT / NTEXT</i> , but it is better to forget about them initially (because by using them you can significantly reduce performance). <br><br>  And it seems that this could be completed, but no ... <br><br>  If a unicode constant is specified in the query, then it is necessary to put the symbol <i>N</i> in front of it.  To show the difference, a simple query is enough: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'ÊñáÊú¨ ANSI'</span></span> , N<span class="hljs-string"><span class="hljs-string">'ÊñáÊú¨ UNICODE'</span></span></code> </pre> <br><pre> <code class="1c hljs">------- ------------ ?? ANSI ÊñáÊú¨ UNICODE</code> </pre> <br>  If you do not specify <i>N</i> before a constant, <i>SQL Server</i> will try to search for a suitable character in <i>ANSI</i> encoding.  If not found, then substitute a question mark. <br><br><h3>  12. COLLATE </h3><a name="b12"></a><br>  I recalled one very interesting example that people like to ask during an interview for the position of <i>Middle / Senior DB Developer</i> .  Will the data return the next request? <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @a <span class="hljs-keyword"><span class="hljs-keyword">NCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">''</span></span> , @b <span class="hljs-keyword"><span class="hljs-keyword">NCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @a, @b <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> @a = @b</code> </pre> <br>  And yes ... and no ... Then how lucky.  I usually answer like that. <br><br>  Why such an ambiguous answer?  First, the string constants should not be N, so they will be interpreted as <i>ANSI</i> .  Second, a lot depends on the current <i>COLLATE</i> , which is a set of rules for sorting and comparing string data. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> DB_ID(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> SINGLE_USER <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IMMEDIATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_100_CI_AS <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @a <span class="hljs-keyword"><span class="hljs-keyword">NCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">''</span></span> , @b <span class="hljs-keyword"><span class="hljs-keyword">NCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @a, @b <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> @a = @b</code> </pre> <br>  With this <i>COLLATE</i> instead of Cyrillic, we get question marks, because the symbols of the question mark are equal to each other: <br><br><pre> <code class="1c hljs">---- ---- ? ?</code> </pre> <br>  If we change <i>COLLATE</i> to something else: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Cyrillic_General_100_CI_AS</code> </pre> <br>  And the request will not return anything, because the Cyrillic alphabet will be correctly interpreted. <br><br>  Therefore, the moral here is simple: if the string constant should take <i>UNICODE</i> , then do not be lazy to put <i>N</i> in front of it.  There is also the flip side of the medal, where <i>N is</i> molded wherever possible, and the optimizer has to perform type conversions, which, as I said before, lead to suboptimal execution plans (this was shown above). <br><br>  What else did I forget to mention about the lines?  Another good question from the ‚Äúlet's do an interview‚Äù cycle: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @a <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) = <span class="hljs-string"><span class="hljs-string">'TEXT'</span></span> , @b <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) = <span class="hljs-string"><span class="hljs-string">'text'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IIF</span></span>(@a = @b, <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span>, <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span>)</code> </pre> <br>  Are these lines equal?  And yes ... and no ... I would answer again.  If we want a one-to-one comparison, we need to explicitly specify <i>COLLATE</i> <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @a <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) = <span class="hljs-string"><span class="hljs-string">'TEXT'</span></span> , @b <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) = <span class="hljs-string"><span class="hljs-string">'text'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IIF</span></span>(@a <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_CS_AS = @b <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_CS_AS, <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span>, <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span>)</code> </pre> <br>  Because <i>COLLATE</i> can be either case-sensitive ( <i>CS</i> ) or not case-sensitive ( <i>CI</i> ) when comparing and sorting strings.  Different <i>COLLATE</i> at the client and on the test base is a potential source not only of logical errors in business logic. <br><br>  Even more fun when the <i>COLLATE</i> between the target base and <i>tempdb</i> does not match.  Create a database with <i>COLLATE</i> , different from the default: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> DB_ID(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> SINGLE_USER <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IMMEDIATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Albanian_100_CS_AS <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> t (c <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'a'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> OBJECT_ID(<span class="hljs-string"><span class="hljs-string">'tempdb.dbo.#t1'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-comment"><span class="hljs-comment">#t1 IF OBJECT_ID('tempdb.dbo.#t2') IS NOT NULL DROP TABLE #t2 IF OBJECT_ID('tempdb.dbo.#t3') IS NOT NULL DROP TABLE #t3 GO CREATE TABLE #t1 (c CHAR(1)) INSERT INTO #t1 VALUES ('a') CREATE TABLE #t2 (c CHAR(1) COLLATE database_default) INSERT INTO #t2 VALUES ('a') SELECT c = CAST('a' AS CHAR(1)) INTO #t3 DECLARE @t TABLE (c VARCHAR(100)) INSERT INTO @t VALUES ('a') SELECT 'tempdb', DATABASEPROPERTYEX('tempdb', 'collation') UNION ALL SELECT 'test', DATABASEPROPERTYEX(DB_NAME(), 'collation') UNION ALL SELECT 't', SQL_VARIANT_PROPERTY(c, 'collation') FROM t UNION ALL SELECT '#t1', SQL_VARIANT_PROPERTY(c, 'collation') FROM #t1 UNION ALL SELECT '#t2', SQL_VARIANT_PROPERTY(c, 'collation') FROM #t2 UNION ALL SELECT '#t3', SQL_VARIANT_PROPERTY(c, 'collation') FROM #t3 UNION ALL SELECT '@t', SQL_VARIANT_PROPERTY(c, 'collation') FROM @t</span></span></code> </pre> <br>  When creating a table, <i>COLLATE is</i> inherited from the database.  The only difference is for the first temporary table, for which we explicitly define the structure without specifying <i>COLLATE</i> .  In this case, it inherits <i>COLLATE</i> from the <i>tempdb</i> database. <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">------ -------------------------- tempdb Cyrillic_General_CI_AS test Albanian_100_CS_AS t Albanian_100_CS_AS #t1 Cyrillic_General_CI_AS #t2 Albanian_100_CS_AS #t3 Albanian_100_CS_AS @t Albanian_100_CS_AS</span></span></code> </pre> <br>  Now let's take a look at our example with <i># t1</i> , because if <i>COLLATE</i> does not match, this can lead to potential problems. <br><br>  For example, data will not be correctly filtered due to the fact that <i>COLLATE</i> may be case insensitive: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">#t1 WHERE c = 'A'</span></span></code> </pre> <br>  Or <i>SQL Server</i> will swear on the impossibility of joining tables due to different <i>COLLATE</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">#t1 JOIN t ON [#t1].c = tc</span></span></code> </pre> <br>  The last example is very common.  On the test server, everything is perfect, and when the backup is deployed on the client's server, we get the error: <br><br><pre> <code class="1c hljs">Msg <span class="hljs-number"><span class="hljs-number">468</span></span>, Level <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">9</span></span>, Line <span class="hljs-number"><span class="hljs-number">93</span></span> Cannot resolve the collation conflict between <span class="hljs-string"><span class="hljs-string">"Albanian_100_CS_AS"</span></span> and <span class="hljs-string"><span class="hljs-string">"Cyrillic_General_CI_AS"</span></span> in the equal to operation.</code> </pre> <br>  Then you have to do crutches everywhere: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">#t1 JOIN t ON [#t1].c = tc COLLATE database_default</span></span></code> </pre> <br><h3>  13. BINARY COLLATE </h3><a name="b13"></a><br>  Now, when the ‚Äúfly in the ointment‚Äù is over, let's see how <i>COLLATE</i> can be <i>used</i> to advantage for itself.  Remember an example about searching for a substring in a string? <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%100%'</span></span></code> </pre> <br>  This query can be significantly optimized and shorten its execution time. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> But in order to see the difference, we need to generate a large table: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> DB_ID(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> SINGLE_USER <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IMMEDIATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_100_CS_AS <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FILE</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> = N<span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SIZE</span></span> = <span class="hljs-number"><span class="hljs-number">64</span></span>MB) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FILE</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> = N<span class="hljs-string"><span class="hljs-string">'test_log'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SIZE</span></span> = <span class="hljs-number"><span class="hljs-number">64</span></span>MB) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> t ( ansi <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> , unicod <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> ;<span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> E1(N) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>) ) t(N) ), E2(N) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> E1 a, E1 b), E4(N) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> E2 a, E2 b), E8(N) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> E4 a, E4 b) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> v, v <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">50000</span></span>) v = <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(NEWID() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>)) + <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(NEWID() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>)), <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> E8 ) t</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create computed columns with binary </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLLATE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , without forgetting to create indices:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ansi_bin <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPPER</span></span>(ansi) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_100_Bin2 <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> unicod_bin <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPPER</span></span>(unicod) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_100_BIN2 <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> ansi <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t (ansi) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> unicod <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t (unicod) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> ansi_bin <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t (ansi_bin) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> unicod_bin <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t (unicod_bin)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Perform filtering: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ansi <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%AB%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> unicod <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%AB%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT_BIG</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ansi_bin <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%AB%'</span></span> <span class="hljs-comment"><span class="hljs-comment">--COLLATE Latin1_General_100_BIN2 SELECT COUNT_BIG(*) FROM t WHERE unicod_bin LIKE '%AB%' --COLLATE Latin1_General_100_BIN2 SET STATISTICS TIME, IO OFF</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And we can see the results of implementation, which will pleasantly surprise: </font></font><br><br><pre> <code class="1c hljs">SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">350</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">354</span></span> ms. SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">335</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">355</span></span> ms. SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">16</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">18</span></span> ms. SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">17</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">18</span></span> ms.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The whole point is that the search based on a binary comparison is much faster, and if you need to frequently and quickly search for the occurrence of rows, you can store data with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLLATE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which ends in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIN</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The only thing you need to remember is that all binary </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLLATE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> case-sensitive when comparing.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14. Code style </font></font></h3><a name="b14"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The style of writing code is strictly individual, but in order not to bring havoc into the development, everyone has long adhered to certain rules. </font><font style="vertical-align: inherit;">The most paradoxical thing is that for all the time I have not seen any imputed code of practice when writing requests. </font><font style="vertical-align: inherit;">All of them are written according to the principle: ‚Äúthe main thing is that it should work‚Äù. </font><font style="vertical-align: inherit;">Although then risk a good sip when you deploy the database on the client server. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's create a separate database and a table in it:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> DB_ID(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> SINGLE_USER <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IMMEDIATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_CI_AS <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Employee (EmployeeID <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and write this query: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> employeeid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> employee</code> </pre> <br>  Works?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now try changing </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLLATE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to some case-sensitive:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> Latin1_General_CS_AI</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And try to re-execute the query: </font></font><br><br><pre> <code class="1c hljs">Msg <span class="hljs-number"><span class="hljs-number">208</span></span>, Level <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, Line <span class="hljs-number"><span class="hljs-number">19</span></span> Invalid object name 'employee'.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The optimizer uses the rules of the current </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLLATE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> when building the execution plan. </font><font style="vertical-align: inherit;">More precisely, at the binding stage, when a check is made for the existence of tables, columns and other objects and the comparison of each object of the syntax tree with the real object of the system catalog. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you want to generate pens requests that will work everywhere, then you should always adhere to the correct register in the names of objects that are used in the request. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The situation with variables is even more interesting ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For them, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLLATE is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inherited from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> database </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Therefore, you must observe the correct register when working with variables:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DATABASEPROPERTYEX(<span class="hljs-string"><span class="hljs-string">'master'</span></span>, <span class="hljs-string"><span class="hljs-string">'collation'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @EmpID <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @empid</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> That error probably will not be: </font></font><br><br><pre> <code class="1c hljs">----------------------- Cyrillic_General_CI_AS ----------- <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> At the same time on another server, an error in the register can make itself felt: </font></font><br><br><pre> <code class="1c hljs">-------------------------- Latin1_General_CS_AS</code> </pre> <br><pre> <code class="1c hljs">Msg <span class="hljs-number"><span class="hljs-number">137</span></span>, Level <span class="hljs-number"><span class="hljs-number">15</span></span>, State <span class="hljs-number"><span class="hljs-number">2</span></span>, Line <span class="hljs-number"><span class="hljs-number">4</span></span> Must declare the scalar variable <span class="hljs-string"><span class="hljs-string">"@empid"</span></span>.</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15. [var] char </font></font></h3><a name="b15"></a><br>  ,        ( <i>CHAR</i> , <i>NCHAR</i> )    ( <i>VARCHAR</i> , <i>NVARCHAR</i> ): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @a <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) = <span class="hljs-string"><span class="hljs-string">'text'</span></span> , @b <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) = <span class="hljs-string"><span class="hljs-string">'text'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(@a) , <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(@b) , <span class="hljs-keyword"><span class="hljs-keyword">DATALENGTH</span></span>(@a) , <span class="hljs-keyword"><span class="hljs-keyword">DATALENGTH</span></span>(@b) , <span class="hljs-string"><span class="hljs-string">'"'</span></span> + @a + <span class="hljs-string"><span class="hljs-string">'"'</span></span> , <span class="hljs-string"><span class="hljs-string">'"'</span></span> + @b + <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [a = b] = <span class="hljs-keyword"><span class="hljs-keyword">IIF</span></span>(@a = @b, <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span>, <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span>) , [b = a] = <span class="hljs-keyword"><span class="hljs-keyword">IIF</span></span>(@b = @a, <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span>, <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span>) , [a <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> b] = <span class="hljs-keyword"><span class="hljs-keyword">IIF</span></span>(@a <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @b, <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span>, <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span>) , [b <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> a] = <span class="hljs-keyword"><span class="hljs-keyword">IIF</span></span>(@b <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @a, <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span>, <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span>)</code> </pre> <br>        20 ,      4,     <i>SQL Server</i>   16   (     LEN  DATALENGTH   -): <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--- --- ---- ---- ---------------------- ---------------------- 4 4 20 4 "text " "text"</span></span></code> </pre> <br>  ,   ‚Äî         : <br><br><pre> <code class="sql hljs">a = bb = aa LIKE bb LIKE a <span class="hljs-comment"><span class="hljs-comment">----- ----- -------- -------- TRUE TRUE TRUE FALSE</span></span></code> </pre> <br>    <i>LIKE</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">'a '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'a '</span></span> <span class="hljs-comment"><span class="hljs-comment">-- !!! SELECT 1 WHERE 'a' LIKE 'a' SELECT 1 WHERE 'a' LIKE 'a%'</span></span></code> </pre> <br>        . <br><br><h3> 16. Data length </h3><a name="b16"></a><br>     ,       : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @a <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span> , @b <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) = <span class="hljs-string"><span class="hljs-string">'0.1'</span></span> , @c SQL_VARIANT <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @a = @b , @c = @a <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @a , @c , <span class="hljs-keyword"><span class="hljs-keyword">SQL_VARIANT_PROPERTY</span></span>(@c,<span class="hljs-string"><span class="hljs-string">'BaseType'</span></span>) , <span class="hljs-keyword"><span class="hljs-keyword">SQL_VARIANT_PROPERTY</span></span>(@c,<span class="hljs-string"><span class="hljs-string">'Precision'</span></span>) , <span class="hljs-keyword"><span class="hljs-keyword">SQL_VARIANT_PROPERTY</span></span>(@c,<span class="hljs-string"><span class="hljs-string">'Scale'</span></span>)</code> </pre> <br>     ?           ¬´ ¬ª: <br><br><pre> <code class="1c hljs">---- ---- ---------- ----- ----- <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> decimal <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @t1 <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) = <span class="hljs-string"><span class="hljs-string">'123456789_123456789_123456789_123456789_'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @t2 <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span> = @t1 <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(@t1) , @t1 , <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(@t2) , @t2 , <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CONVERT</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>, @t1)) , <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(@t1 <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>))</code> </pre> <br>     ,      1 : <br><br><pre> <code class="1c hljs">----- ------------------------------------------ ---- ---- ---- ---- <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">123456789</span></span>_123456789_123456789_123456789_ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre> <br>        :     <i>CAST/CONVERT</i> ,     30 . <br><br><h3> 17. ISNULL vs COALESCE </h3><a name="b17"></a><br>      ?   : <i>ISNULL</i>  <i>COALESCE</i> .      ‚Äî    <i>NULL</i> ,      ,     <i>COALESCE</i> .   ,     . <br><br>    ? <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @a <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>(@a, <span class="hljs-string"><span class="hljs-string">'NULL'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(@a, <span class="hljs-string"><span class="hljs-string">'NULL'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @i <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>(@i, <span class="hljs-number"><span class="hljs-number">7.1</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(@i, <span class="hljs-number"><span class="hljs-number">7.1</span></span>)</code> </pre> <br>      : <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">---- ---- N NULL ---- ---- 7 7.1</span></span></code> </pre> <br>  Why?  <i>ISNULL</i>       . <i>COALESCE</i>    .      ,            , ¬´  ¬ª. <br><br>    , <i>ISNULL</i>       , <i>COALESCE</i>    <i>CASE WHEN</i>     . <br><br><h3> 18. Math </h3><a name="b18"></a><br>  ,      <i>SQL Server</i> .      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br>    ,    ‚Äî    ,     .  ,     : <br><br><pre> <code class="1c hljs">----------- <span class="hljs-number"><span class="hljs-number">0</span></span> ----------- <span class="hljs-number"><span class="hljs-number">0.333333</span></span></code> </pre> <br>   ,          : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) , <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) , <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(val) , <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> val) , <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(val) , <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> val) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>), (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) ) t (val) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(val) , <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(val) / <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(val) , <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(val * <span class="hljs-number"><span class="hljs-number">1.</span></span>) , <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(val <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">FLOAT</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>), (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) ) t (val)</code> </pre> <br>   ? <i>COUNT(*)/COUNT(1)</i>    . <i>COUNT</i>      <i>NULL</i> .   <i>DISTINCT</i> ,    ,   <i>NULL</i> . <br><br>    .  <i>AVG</i>    <i>SUM</i>  <i>COUNT</i> .        ‚Äî       <i>NULL</i> .  ,   ,    ? .    . <br><br><h3> 19. UNION vs UNION ALL </h3><a name="b19"></a><br>   :   ,    ,     , ,    ,   <i>UNION ALL</i> .    ,    <i>UNION</i> . <br><br> ,          <i>UNION ALL</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [object_id] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.system_objects <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [object_id] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [object_id] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.system_objects <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [object_id] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b28/a10/166/b28a10166199426bad971ce29d2f7881.png"></div><br>          :  <i>UNION</i>  ,  <i>UNION ALL</i> ‚Äî .       ,       ,     . <br><br> ,    1 ,     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @AddressLine <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @AddressLine = <span class="hljs-string"><span class="hljs-string">'4775 Kentucky Dr.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) AddressID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AddressLine1 = @AddressLine <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> AddressLine2 = @AddressLine</code> </pre> <br>     <i>OR</i>      <i>IndexScan</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/501/d93/2d1/501d932d1c2b41f78e7c468de51f16e7.png"></div><br><br><pre> <code class="1c hljs">Table 'Address'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">90</span></span>, ...</code> </pre> <br>     <i>UNION ALL</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) AddressID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) AddressID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AddressLine1 = @AddressLine <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) AddressID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AddressLine2 = @AddressLine ) t</code> </pre> <br>    , <i>SQL Server</i> ,   1 ,  ,   ,        : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a9d/317/35b/a9d31735b4f94356b7c22f8866b7dc2d.png"></div><br><pre> <code class="1c hljs">Table 'Worktable'. Scan count <span class="hljs-number"><span class="hljs-number">0</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">0</span></span>, ... Table 'Address'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">3</span></span>, ...</code> </pre> <br><h3> 20. Re-read </h3><a name="b20"></a><br>     ,        <i>JOIN</i>       : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.BusinessEntityID , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.LastName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e.BusinessEntityID = p.BusinessEntityID ) , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.FirstName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> e.BusinessEntityID = p.BusinessEntityID ) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee e <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.BusinessEntityID , p.LastName , p.FirstName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee e <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> e.BusinessEntityID = p.BusinessEntityID</code> </pre> <br>         ‚Äî    : <br><br><pre> <code class="1c hljs">Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">0</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">1776</span></span>, ... Table 'Employee'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">2</span></span>, ... Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">0</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">888</span></span>, ... Table 'Employee'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">2</span></span>, ...</code> </pre> <br><h3> 21. SubQuery </h3><a name="b21"></a><br>    ,          --. <br><br>       <i>Person.Person</i>  <i>Sales.SalesPersonQuotaHistory</i>   ,            . <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.BusinessEntityID , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.SalesQuota <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.SalesPersonQuotaHistory s <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> s.BusinessEntityID = p.BusinessEntityID ) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person p</code> </pre> <br>      -        : <br><br><pre> <code class="1c hljs">Msg <span class="hljs-number"><span class="hljs-number">512</span></span>, Level <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, Line <span class="hljs-number"><span class="hljs-number">6</span></span> Subquery returned more than <span class="hljs-number"><span class="hljs-number">1</span></span> value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , &gt;, &gt;= or when the subquery is used as an expression.</code> </pre> <br>    ? <br><br>  <i>TOP(1)</i>  <i>ORDER BY</i> ,   .     ,   .   <i>TOP</i>     <i>IndexSeek</i> .       <i>OUTER/CROSS APPLY</i>   <i>TOP</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.BusinessEntityID , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) s.SalesQuota <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.SalesPersonQuotaHistory s <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> s.BusinessEntityID = p.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.QuotaDate <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.BusinessEntityID , t.SalesQuota <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">APPLY</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) s.SalesQuota <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.SalesPersonQuotaHistory s <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> s.BusinessEntityID = p.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.QuotaDate <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) t</code> </pre> <br>           ‚Äî  <i>IndexSeek</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/81a/11a/ca0/81a11aca043940d4a9382db76ba8ebc2.png"></div><br><pre> <code class="1c hljs">Table 'SalesPersonQuotaHistory'. Scan count <span class="hljs-number"><span class="hljs-number">19972</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">39944</span></span>, ... Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">67</span></span>, ...</code> </pre> <br>   ,  : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.BusinessEntityID , t.SalesQuota <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.BusinessEntityID , s.SalesQuota , <span class="hljs-keyword"><span class="hljs-keyword">RowNum</span></span> = ROW_NUMBER() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.QuotaDate <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.SalesPersonQuotaHistory s ) t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.BusinessEntityID = t.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> t.RowNum = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/585/349/1e9/5853491e956c4102a44af1e6e4948684.png"></div><br><pre> <code class="1c hljs">Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">67</span></span>, ... Table 'SalesPersonQuotaHistory'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">4</span></span>, ...</code> </pre> <br><h3> 22. CASE WHEN </h3><a name="b22"></a><br>       ?          ,    .         <i>CASE WHEN</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID , Gender , Gender = <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> Gender <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'M'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Male'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'F'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Female'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'Unknown'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee</code> </pre> <br> <i>SQL Server</i>      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID , Gender , Gender = <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> Gender = <span class="hljs-string"><span class="hljs-string">'M'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Male'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> Gender = <span class="hljs-string"><span class="hljs-string">'F'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Female'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'Unknown'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee</code> </pre> <br>       ‚Äî               <i>TRUE</i>       <i>ELSE</i> . <br><br>  ,   .     ,       : <br><br><pre> <code class="sql hljs">IF OBJECT_ID('dbo.GetMailUrl') IS NOT NULL <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> dbo.GetMailUrl <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> dbo.GetMailUrl ( @Email <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(@Email, <span class="hljs-keyword"><span class="hljs-keyword">CHARINDEX</span></span>(<span class="hljs-string"><span class="hljs-string">'@'</span></span>, @Email) + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(@Email)) <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br>  <i>SQL Profiler</i>    <i>SQL:StmtStarting / SP:StmtCompleted</i> (      <i>XEvents</i> : <i>sp_statement_starting / sp_statement_completed</i> ). <br><br>  Run the query: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">10</span></span>) EmailAddressID , EmailAddress , <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> dbo.GetMailUrl(EmailAddress) <span class="hljs-comment"><span class="hljs-comment">--WHEN 'microsoft.com' THEN 'Microsoft' WHEN 'adventure-works.com' THEN 'AdventureWorks' END FROM Person.EmailAddress</span></span></code> </pre> <br>   10 .      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">10</span></span>) EmailAddressID , EmailAddress , <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> dbo.GetMailUrl(EmailAddress) <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'microsoft.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Microsoft'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'adventure-works.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'AdventureWorks'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.EmailAddress</code> </pre> <br>    20 .   ,    <i>CASE</i>    .    -  .   ,  <i>CASE</i>  ‚Äî           . <br><br>        : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> EmailAddressID , EmailAddress , <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> MailUrl <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'microsoft.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Microsoft'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'adventure-works.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'AdventureWorks'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">10</span></span>) EmailAddressID , EmailAddress , MailUrl = dbo.GetMailUrl(EmailAddress) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.EmailAddress ) t</code> </pre> <br>   10 . <br><br>  ,     <i>CASE</i>  : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> Gender = <span class="hljs-string"><span class="hljs-string">'M'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Male'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> Gender = <span class="hljs-string"><span class="hljs-string">'M'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> Gender = <span class="hljs-string"><span class="hljs-string">'M'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'......'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> Gender = <span class="hljs-string"><span class="hljs-string">'F'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Female'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> Gender = <span class="hljs-string"><span class="hljs-string">'F'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'Unknown'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee</code> </pre> <br>    <i>CASE</i>    (      ).        <i>SQL Server</i>   : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @i <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> @i = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @i <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> @i = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br><h3> 23. Scalar func </h3><a name="b24"></a><br>     ‚Äî        <i>T-SQL</i> ,     . <br><br>    ,   - ,         : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> AdventureWorks2014 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> TOP(<span class="hljs-number"><span class="hljs-number">1</span></span>) Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> AddressLine2 = AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> OBJECT_ID(<span class="hljs-string"><span class="hljs-string">'dbo.isEqual'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> dbo.isEqual <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> dbo.isEqual ( @val1 <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>), @val2 <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> (@val1 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> @val2 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> @val1 = @val2 <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br>    : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressID, AddressLine1, AddressLine2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> dbo.IsEqual(AddressLine1, AddressLine2) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressID, AddressLine1, AddressLine2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (AddressLine1 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> AddressLine2 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> AddressLine1 = AddressLine2 <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AddressID, AddressLine1, AddressLine2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.[Address] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AddressLine1 = <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>(AddressLine2, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span></code> </pre> <br>   ,       ,    : <br><br><pre> <code class="1c hljs">SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">63</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">57</span></span> ms. SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">0</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">1</span></span> ms. SQL Server Execution Times: CPU time = <span class="hljs-number"><span class="hljs-number">0</span></span> ms, elapsed time = <span class="hljs-number"><span class="hljs-number">1</span></span> ms.</code> </pre> <br>  ,       <i>SQL Server</i>    ,         . <br><br>       ‚Äî  ?  Not.      <i>SCHEMABINDING</i>     : <br><br><pre> <code class="sql hljs">IF OBJECT_ID('dbo.GetPI') IS NOT NULL <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> dbo.GetPI <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> dbo.GetPI () <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">FLOAT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> SCHEMABINDING <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PI</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dbo.GetPI() <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Sales.Currency</code> </pre> <br>   ,        1 . <br><br><h3> 24. VIEWs </h3><a name="b24"></a><br> -  ‚Ä¶ - .      ‚Äì  ,           . <br><br>        : <br><br><pre> <code class="sql hljs">IF OBJECT_ID('dbo.tbl', 'U') IS NOT NULL <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.tbl <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.tbl (a <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>, b <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.tbl <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> OBJECT_ID(<span class="hljs-string"><span class="hljs-string">'dbo.vw_tbl'</span></span>, <span class="hljs-string"><span class="hljs-string">'V'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> dbo.vw_tbl <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> dbo.vw_tbl <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.tbl <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.vw_tbl</code> </pre> <br>   : <br><br><pre> <code class="1c hljs">ab ----------- ----------- <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>             : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.tbl <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> c <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.vw_tbl</code> </pre> <br>    : <br><br><pre> <code class="1c hljs">ab ----------- ----------- <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>   ,      ,    : <br><br><pre> <code class="sql hljs">EXEC sys.sp_refreshview @viewname = N'dbo.vw_tbl' GO <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.vw_tbl</code> </pre> <br>    : <br><br><pre> <code class="1c hljs">abc ----------- ----------- ----------- <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>         . <br><br>               .      ,    ¬´ ¬ª  <i>AdventureWorks</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> HumanResources.vEmployee <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.BusinessEntityID , p.Title , p.FirstName , p.MiddleName , p.LastName , p.Suffix , e.JobTitle , pp.PhoneNumber , pnt.[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PhoneNumberType , ea.EmailAddress , p.EmailPromotion , a.AddressLine1 , a.AddressLine2 , a.City , sp.[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> StateProvinceName , a.PostalCode , cr.[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CountryRegionName , p.AdditionalContactInfo <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee e <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.BusinessEntityID = e.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.BusinessEntityAddress bea <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> bea.BusinessEntityID = e.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.[Address] a <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> a.AddressID = bea.AddressID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.StateProvince sp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sp.StateProvinceID = a.StateProvinceID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.CountryRegion cr <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> cr.CountryRegionCode = sp.CountryRegionCode <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.PersonPhone pp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pp.BusinessEntityID = p.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.PhoneNumberType pnt <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pp.PhoneNumberTypeID = pnt.PhoneNumberTypeID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Person.EmailAddress ea <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.BusinessEntityID = ea.BusinessEntityID</code> </pre> <br>   ‚Ä¶        ,    ? ,     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID , FirstName , LastName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.vEmployee <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.BusinessEntityID , p.FirstName , p.LastName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Person.Person p <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> p.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee e )</code> </pre> <br>        : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/997/40b/7e9/99740b7e99e946d6bfa35e404c1c7537.png"></div><br><pre> <code class="1c hljs">Table 'EmailAddress'. Scan count <span class="hljs-number"><span class="hljs-number">290</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">640</span></span>, ... Table 'PersonPhone'. Scan count <span class="hljs-number"><span class="hljs-number">290</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">636</span></span>, ... Table 'BusinessEntityAddress'. Scan count <span class="hljs-number"><span class="hljs-number">290</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">636</span></span>, ... Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">0</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">897</span></span>, ... Table 'Employee'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">2</span></span>, ...</code> </pre> <br>    ,     : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/87e/649/067/87e6490676b142c69f2ff3134170c9f4.png"></div><br><pre> <code class="1c hljs">Table 'Person'. Scan count <span class="hljs-number"><span class="hljs-number">0</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">897</span></span>, ... Table 'Employee'. Scan count <span class="hljs-number"><span class="hljs-number">1</span></span>, logical reads <span class="hljs-number"><span class="hljs-number">2</span></span>, ...</code> </pre> <br>   <i>SQL Server</i>         ,    ,     . <br><br>        .         ,     ¬´      ¬ª. , ,        ‚Ä¶      ,         . <br><br><h3> 25. CURSORs </h3><a name="b25"></a><br>    <i>SQL Server</i>    ‚Äî       .   <i>Oracle</i> ! <br><br>      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @BusinessEntityID <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> cur <span class="hljs-keyword"><span class="hljs-keyword">CURSOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> HumanResources.Employee <span class="hljs-keyword"><span class="hljs-keyword">OPEN</span></span> cur <span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> cur <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">WHILE</span></span> @@FETCH_STATUS = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> HumanResources.Employee <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> VacationHours = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> BusinessEntityID = @BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> cur <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> @BusinessEntityID <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOSE</span></span> cur <span class="hljs-keyword"><span class="hljs-keyword">DEALLOCATE</span></span> cur</code> </pre> <br>      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> HumanResources.Employee <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> VacationHours = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> VacationHours &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>         ,  ,   .  ,       .  ,      .         ,      38 .          600.    ‚Äî 200. <br><br>   <i>SQL Server</i> ‚Äî ! <br><br><h3> 26. STRING_CONCAT </h3><a name="b26"></a><br>     ‚Äî      ,      .      ? <br><br>        <i>STRING_CONCAT</i> ,    ‚Ä¶   2016 ,      ,  SQL Server    .   -   ? <br><br>   : <br><br><pre> <code class="sql hljs">IF OBJECT_ID('tempdb.dbo.<span class="hljs-comment"><span class="hljs-comment">#t') IS NOT NULL DROP TABLE #t GO CREATE TABLE #t (i CHAR(1)) INSERT INTO #t VALUES ('1'), ('2'), ('3')</span></span></code> </pre> <br>     ¬´¬ª ‚Äî       : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @txt <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @txt += i <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">#t SELECT @txt</span></span></code> </pre> <br><pre> <code class="1c hljs">-------- <span class="hljs-number"><span class="hljs-number">123</span></span></code> </pre> <br>  ,   <i>MS</i> ,    ,       : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @txt <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @txt += i <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">#t ORDER BY LEN(i) SELECT @txt</span></span></code> </pre> <br><pre> <code class="1c hljs">-------- <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br>  ,      ,           .       : <i>CLR</i> , <i>UPDATE</i> ,  , , ‚Ä¶      . <br><br>  ,  90%    XML: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>()] = i <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">#t FOR XML PATH('')</span></span></code> </pre> <br><pre> <code class="1c hljs">-------- <span class="hljs-number"><span class="hljs-number">123</span></span></code> </pre> <br>        . -,        - ,     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">STUFF</span></span>(( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">', '</span></span> + c.[<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.columns c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.[object_id] = t.[object_id] <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">XML</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PATH</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span>).value(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">'NVARCHAR(MAX)'</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t.[<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] = <span class="hljs-string"><span class="hljs-string">'U'</span></span></code> </pre> <br><pre> <code class="1c hljs">------------------------ ------------------------------------ ScrapReason ScrapReasonID, Name, ModifiedDate Shift ShiftID, Name, StartTime, EndTime</code> </pre> <br>       XML   ,    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8b6/68c/0ce/8b668c0ceabe40a291504adda4ef584e.png"></div><br>     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">STUFF</span></span>(( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">', '</span></span> + c.[<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.columns c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.[object_id] = t.[object_id] <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">XML</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PATH</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span>).value(<span class="hljs-string"><span class="hljs-string">'(./text())[1]'</span></span>, <span class="hljs-string"><span class="hljs-string">'NVARCHAR(MAX)'</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t.[<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] = <span class="hljs-string"><span class="hljs-string">'U'</span></span></code> </pre> <br>      .      <i>value</i> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t.name , <span class="hljs-keyword"><span class="hljs-keyword">STUFF</span></span>(( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">', '</span></span> + c.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.columns c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.[object_id] = t.[object_id] <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">XML</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PATH</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>)), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t.[<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] = <span class="hljs-string"><span class="hljs-string">'U'</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/ead/a22/71e/eada2271eb044fdd873dde61982538d6.png"></div><br>        ,    ¬´¬ª.     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t.name , <span class="hljs-keyword"><span class="hljs-keyword">STUFF</span></span>(( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">', '</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">13</span></span>) + c.name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.columns c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.[object_id] = t.[object_id] <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">XML</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PATH</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>)), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> t.[<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] = <span class="hljs-string"><span class="hljs-string">'U'</span></span></code> </pre> <br>     ,  ,    ,        . <br><br>      :   ,       <i>value</i> ,           <i>value('(./text())[1]'...</i> . <br><br><h3> 27. SQL Injection </h3><a name="b27"></a><br>      <i>sql injection</i> ,     .      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @param <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @param = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> = <span class="hljs-string"><span class="hljs-string">'SELECT TOP(5) name FROM sys.objects WHERE schema_id = '</span></span> + @param PRINT @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> EXEC (@<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>)</code> </pre> <br>    : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> schema_id = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>       - : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @param = <span class="hljs-string"><span class="hljs-string">'1; select ''hack'''</span></span></code> </pre> <br>     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> schema_id = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'hack'</span></span></code> </pre> <br>    ,   <i>sql injection</i> ,        - ¬´¬ª.    ‚Äî     :) <br><br>        <i>String.Format</i> ( ),    ,      <i>sql injection</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (SqlConnection conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlConnection()) { conn.ConnectionString = <span class="hljs-string"><span class="hljs-string">@"Server=.;Database=AdventureWorks2014;Trusted_Connection=true"</span></span>; conn.Open(); SqlCommand command = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlCommand( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"SELECT TOP(5) name FROM sys.objects WHERE schema_id = {0}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>), conn); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (SqlDataReader reader = command.ExecuteReader()) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (reader.Read()) {} } }</code> </pre> <br>  ,   <i>sp_executesql</i>  : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @param <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @param = <span class="hljs-string"><span class="hljs-string">'1; select ''hack'''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> = <span class="hljs-string"><span class="hljs-string">'SELECT TOP(5) name FROM sys.objects WHERE schema_id = @schema_id'</span></span> PRINT @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> EXEC sys.sp_executesql @<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> , N<span class="hljs-string"><span class="hljs-string">'@schema_id INT'</span></span> , @schema_id = @param</code> </pre> <br>   ,    -    . <br><br>      : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (SqlConnection conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlConnection()) { conn.ConnectionString = <span class="hljs-string"><span class="hljs-string">@"Server=.;Database=AdventureWorks2014;Trusted_Connection=true"</span></span>; conn.Open(); SqlCommand command = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlCommand( <span class="hljs-string"><span class="hljs-string">"SELECT TOP(5) name FROM sys.objects WHERE schema_id = @schema_id"</span></span>, conn); command.Parameters.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlParameter(<span class="hljs-string"><span class="hljs-string">"schema_id"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); ... }</code> </pre> <br>     ,     ‚Ä¶ <br><br><h3>    38     </h3><br>     ‚Äî         8- .   ,          <i>T-SQL</i> .      ,       . <br><br> ,     ¬´ ¬ª    <i>SQL Server</i> ,     ,     - .            . <br><br>        : <br> <a href="http://codingsight.com/sql-server-useful-tips-for-newbies/"><i>SQL Server: Useful Tips for Newbies</i></a> <br><br><h3>  Video </h3><a name="video"></a><br>      ,    ¬´¬ª       <a href="https://www.youtube.com/user/russianvc"><i>russianVC</i></a> : <a href="https://www.youtube.com/watch%3Fv%3DC1I5v1xxJv4"><i>   </i></a> .        . <br><br><h3>    ? </h3><br>            .        ,      . <br><br>  ,     <i>parameter sniffing</i> ,              : <a href="http://www.somewheresomehow.ru/fast-in-ssms-slow-in-app-part1/"><i>  ,   SSMS</i></a> . <br><br>   ,     ,     . </div><p>Source: <a href="https://habr.com/ru/post/315142/">https://habr.com/ru/post/315142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315132/index.html">We explain to grandma: How to encrypt in an hour</a></li>
<li><a href="../315134/index.html">We accept email on Node.js</a></li>
<li><a href="../315136/index.html">As I added 30,000 people to the first circle of contacts, they will block this social network in the Russian Federation</a></li>
<li><a href="../315138/index.html">Deconstruction of the myth of deep learning. Lecture in Yandex</a></li>
<li><a href="../315140/index.html">Interfaces: My, Your, Your, Our or This</a></li>
<li><a href="../315144/index.html">The digest of interesting materials for the mobile # 179 developer (November 7-13)</a></li>
<li><a href="../315146/index.html">Texel density. Why and how to use it</a></li>
<li><a href="../315148/index.html">Y. Schmidhuber: ‚ÄúIt's great to be part of the future of artificial intelligence‚Äù</a></li>
<li><a href="../315150/index.html">Overclocking the performance of iOS applications</a></li>
<li><a href="../315152/index.html">Your programming language sucks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>