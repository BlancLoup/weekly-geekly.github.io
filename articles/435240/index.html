<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unreal Engine4 - PostProcess scan effect</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This weekend I had some free time between classes (note, the author at the time of the article received a Master of Science degree) , and I decided to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unreal Engine4 - PostProcess scan effect</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/eb/kt/at/ebktatsje1u5a3pyfbaqwl39u1w.png"><br><br>  This weekend I had some free time between classes <i>(note, the author at the time of the article received a Master of Science degree)</i> , and I decided to go back to creating shaders, inventing this postprocess scanning effect.  I imagined that it was used in the game as a kind of effect of scanning at a distance.  We also use some simple noise distortion to make the effect look a bit more interesting. <br><br>  In this article I will explain how to implement this effect on UE4.  There are several ways you can create this effect.  One of these methods was chosen by me. <br><a name="habracut"></a><br><blockquote>  You can open the images in a new tab to view them in higher resolution. </blockquote><br><h2>  Main components </h2><br>  The main idea of ‚Äã‚Äãthis effect is to create a version of the scene render using <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_%25D0%25A1%25D0%25BE%25D0%25B1%25D0%25B5%25D0%25BB%25D1%258F">the Sobel operator</a> , and then mix it with the usual scene render based on SphereMask, which we will animate to create a scanning effect. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This effect consists of 3 main components: <br><br><ul><li>  SphereMask scalable field </li><li>  The Sobel-Edge function (I will not explain how this function works, since it is a separate topic, but I refer to the code that I used) </li><li>  Overlaying the projected texture onto the mesh of the world </li></ul><br><h2>  SphereMask scalable field </h2><br>  This part is about how we create a scalable SphereMask.  To do this, we transfer the position of the blueprint to the set of material parameters, after which we use it as follows <br><br><img src="https://habrastorage.org/webt/jz/-d/fk/jz-dfkjptn55desctdqp4t45olw.jpeg"><br><br>  Connect the result of the <b>Clamp</b> node to the <b>emissive</b> output of your material, and you will see something like this <br><br><img src="https://habrastorage.org/webt/h3/qf/oe/h3qfoekicbzn3kxngd84oryuhyq.jpeg"><br><br>  ‚ÄúTexLoc‚Äù is a <b>vector3</b> that determines the location of the source of the sphere, in my case it is read from the set of material parameters, so that it can be read from the game itself, for example, to determine the position of the player. <br><br>  The set of node parameters specified above creates a field with a sphere radius of 1024 units.  I used it only to show the result in the preview window.  If you want to learn more about working with remote functions and understand the methods of using them, I strongly recommend checking out <a href="http://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm">the Inigo Quilez website</a> . <br><br>  Now we will use <b>Time</b> to scale the sphere with a set period of time. <br><br><img src="https://habrastorage.org/webt/cn/sd/7j/cnsd7j2jzs1k5igdjrz0yz5tuae.png"><br><br>  This will give us the following result. <br><br><img src="https://habrastorage.org/webt/b5/v3/wm/b5v3wmsatvch4ezgkzfwvrtz8hy.gif"><br><br>  <b>Frac</b> (time) basically gives us a constant period, which continues to go 0-1.0-1.0-1.  We multiply the time by 0.25 to control the speed of scaling, and then multiply the result by the radius of the sphere, which leads to a change in radius from 0 to 1024, and gives us an animated mask. <br><br>  This is a good result, but it is not what we want from the effect.  We need a scaling ring.  This can be easily done with simple calculations. <br><br><img src="https://habrastorage.org/webt/ms/vc/et/msvcetcx-nbivesju-m9hi10vum.png"><br><br>  This will give us what we want, a growing ring, with good gradient damping that can be controlled. <br><br><img src="https://habrastorage.org/webt/wj/qf/bi/wjqfbikt-dezu6jcd_hnwjfqct8.gif"><br><br>  Mathematical operations in the ‚ÄúEdge_Mask‚Äù block basically choose the position in the gradient mask, in this case the value 0.5, and determine the edge of the mask from the current position with the specified width, which allows us to get a ring.  I will not go into technical details getting the edges of the mask, most likely I will tell about it in one of the following posts. <br><br>  As you can see, you have full control over the width of the ring without a scalar parameter, and if we wanted, we could even control the edge attenuation, but in this effect we do not need it. <br><br>  The next step is to use noise to create a visually interesting version of the ring. <br><br>  To do this, we will use the <b>Vector Noise</b> node, which is part of UE4.  You can read about it <a href="https://docs.unrealengine.com/latest/INT/Engine/Rendering/Materials/ExpressionReference/Vector/">here</a> , or you can use the noise texture, which contains World Aligned UV coordinates. <br><br>  In my shader, I set the <b>Function</b> parameter in Cellnoise in the <b>Vector Noise</b> <b>node</b> ; feel free to experiment with other types of this parameter to get your own unique effect. <br><br><img src="https://habrastorage.org/webt/pt/pz/ty/ptpztyghnv7d1eehiegmrtncxlg.png"><br><br>  The result will look like this. <br><br><img src="https://habrastorage.org/webt/xb/em/pa/xbemparkbyjeaya1lldu8aikd_s.gif"><br><br>  At this point, the first stage of our shader is completed, then we will look at the implementation of the Sobel-Edge function. <br><h2>  Sobel-Edge feature </h2><br>  There are many different variations of this feature, some of which are more optimized than others, I will not explain its essence, since this is a separate topic, but a simple Google search for the keywords "Sobel Edge" or "Sobel Operator" will give you many options .  Or use article on <a href="https://habr.com/users/gepard_vvk/" class="user_link">Habr√©</a> from <a href="https://habr.com/users/gepard_vvk/" class="user_link">Gepard_vvk</a> - <a href="https://habr.com/post/114452/">Algorithms for image contour selection</a> . <br><br>  The main idea of ‚Äã‚Äãthe Sobel operator is as follows: we take a <b>RenderTarget of the</b> scene (imagine that this is a texture that contains what you currently see in your viewport) and compare each pixel with all adjacent pixels around it.  Next, we compare the difference in brightness, and if the difference is above a certain threshold, we mark it as an edge, and in this process we get a black and white <b>RenderTarget</b> texture <b>mask</b> , in which the mask is adjusted to the edges. <br><br>  The code below is a simple example of the function of the Sobel operator, which <a href="https://www.shadertoy.com/view/4t3XDM">RebelMoogle</a> created on Shadertoy (most likely this option is not fully optimized, so you can try another implementation), we will recreate it in UE4 in our material. <br><br><pre><code class="plaintext hljs">void mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec2 uv = fragCoord.xy / iResolution.xy; vec3 TL = texture(iChannel0, uv + vec2(-1, 1)/ iResolution.xy).rgb; vec3 TM = texture(iChannel0, uv + vec2(0, 1)/ iResolution.xy).rgb; vec3 TR = texture(iChannel0, uv + vec2(1, 1)/ iResolution.xy).rgb; vec3 ML = texture(iChannel0, uv + vec2(-1, 0)/ iResolution.xy).rgb; vec3 MR = texture(iChannel0, uv + vec2(1, 0)/ iResolution.xy).rgb; vec3 BL = texture(iChannel0, uv + vec2(-1, -1)/ iResolution.xy).rgb; vec3 BM = texture(iChannel0, uv + vec2(0, -1)/ iResolution.xy).rgb; vec3 BR = texture(iChannel0, uv + vec2(1, -1)/ iResolution.xy).rgb; vec3 GradX = -TL + TR - 2.0 * ML + 2.0 * MR - BL + BR; vec3 GradY = TL + 2.0 * TM + TR - BL - 2.0 * BM - BR; fragColor.r = length(vec2(GradX.r, GradY.r)); fragColor.g = length(vec2(GradX.g, GradY.g)); fragColor.b = length(vec2(GradX.b, GradY.b)); }</code> </pre> <br><br>  In UE4, it looks like this. <br><br><img src="https://habrastorage.org/webt/fi/eb/ib/fiebib30po02dkdnichwx2cf024.png"><br><br>  A <b>quick</b> note about the implementation of the function - make sure that your <b>SceneTexture</b> nodes <b>are</b> configured to use <b>PostProcessInput0</b> <br><br><img src="https://habrastorage.org/webt/ov/jr/vf/ovjrvfg2ifgorbtscy3k8haowg0.png"><br><br>  Two <b>Custom</b> nodes <b>GradX</b> and <b>GradY</b> , configure them in a similar way <br><br><img src="https://habrastorage.org/webt/gn/zu/wx/gnzuwx4ri_uwhpm53i78mksu85c.png"><br><br>  <b>GradX</b> : <br><br><pre> <code class="plaintext hljs">return -TL + TR - 2.0 * ML + 2.0 * MR - BL + BR;</code> </pre> <br>  <b>GradY</b> : <br><br><pre> <code class="plaintext hljs">return TL + 2.0 * TM + TR - BL - 2.0 * BM - BR;</code> </pre> <br>  This does not necessarily have to be done in <b>Custom</b> , I used it just for convenience, since otherwise there would be too many nodes and spaghetti is formed. <br><br>  If you connect the result of the function in the <b>emissive</b> output of the material, you will see the following <br><br><img src="https://habrastorage.org/webt/_n/3w/qt/_n3wqteobpqlyz11yeynr_b-lbm.png"><br><br>  We also multiply the result by the usual <b>vector3</b> to make the edges of any color we want. <br><br><img src="https://habrastorage.org/webt/lf/ds/xm/lfdsxmpztfwvruscn3d8qvzuyvw.png"><br><br>  As a result, the edge color changes. <br><br><img src="https://habrastorage.org/webt/pn/qw/uf/pnqwufgzqldvv6oaktj7r4hk5uw.jpeg"><br><br><h2>  Texture overlay world mesh </h2><br>  The simplest part: we just use the grid texture and project it around the world, and then combine it with the Sobel-Edge function to get a cool effect. <br><br><img src="https://habrastorage.org/webt/by/v3/j0/byv3j0lb_k-uigmefr3i0wr6_n0.png"><br><br>  If you connect the result of the function to the <b>emissive</b> output, you will see <br><br><img src="https://habrastorage.org/webt/m0/0a/nx/m00anxzujqqnujris_krdkkc6s8.png"><br><br><h2>  Putting it all together </h2><br>  Now we will put all three parts together for our post effect! <br><br>  First, we combine the Sobel-Edge and World-Aligned-Grid feature, adding them together <br><br><img src="https://habrastorage.org/webt/-a/vb/zw/-avbzwdxn7c50pqhjdnnveqiezm.png"><br><br>  Then we create the <b>SceneTexture</b> node and add the result from Sobel-Edge and World-Aligned-Grid to it. <br><br>  Then we interpolate between the normal scene and the added one, using the result of the ring mask we created in the first part. <br><br><img src="https://habrastorage.org/webt/mb/r_/bs/mbr_bsbhkbyvsz3xskjmshfwf4e.png"><br><br>  And voila, we did it.  The final result will look something like this.  You can, of course, adjust the parameters and try changing their values ‚Äã‚Äãto get more interesting options. <br><br><img src="https://habrastorage.org/webt/oe/ar/9f/oear9ft9pqe7cjbjfpvizihi3mu.gif"><br><br>  I hope this information is useful to you, all the best :) <br><br>  An example of a project with this shader can be found on <a href="https://github.com/UnrealPlayground/PostProcessScanEffect">github</a> . </div><p>Source: <a href="https://habr.com/ru/post/435240/">https://habr.com/ru/post/435240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435224/index.html">How to communicate in an English-speaking office: 14 useful idioms</a></li>
<li><a href="../435226/index.html">Recover data from empty space</a></li>
<li><a href="../435228/index.html">Kubernetes Cluster for $ 20 per month</a></li>
<li><a href="../435234/index.html">Smarter, more, more precisely: how does AI change flights into space</a></li>
<li><a href="../435236/index.html">Byte-machine for the fort (and not only) in Indian (Part 3)</a></li>
<li><a href="../435242/index.html">Why am I afraid of becoming a "pumped man"</a></li>
<li><a href="../435244/index.html">ITER Project in 2018</a></li>
<li><a href="../435246/index.html">Tesla has opened pre-orders for Model 3 in Europe and China</a></li>
<li><a href="../435248/index.html">Navigation inside the Android application</a></li>
<li><a href="../435250/index.html">How ITMO University works: a tour of our cyber-physical systems lab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>