<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CleanTalk, WordPress Security Launch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being engaged in the development of Anti-Spam service , we often face other issues related to the security of web sites. The most common questions wer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CleanTalk, WordPress Security Launch</h1><div class="post__text post__text-html js-mediator-article">  Being engaged in the development of <a href="https://cleantalk.org/">Anti-Spam service</a> , we often face other issues related to the security of web sites.  The most common questions were about brute force attacks.  In addition to problems with the selection of passwords for the administrator account, often brute-force attacks cause a high load on the server, and users receive a notification from the hosting provider about exceeding the permissible values ‚Äã‚Äãof the processor load. <br><br>  We thought, if we receive such requests, then why don't we solve them?  Since the tasks are related to security functions, the decision to launch a separate security service was obvious. <br><a name="habracut"></a><br>  At the moment, the Security service is designed only for WordPress, there are several reasons for this: the greatest demand, a large number of web sites use this particular CMS, the complexity of development right under several CMS. <br><br>  Despite the fact that anti-spam protection is part of security, we decided to separate these two services.  There are several reasons for this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Complicating the plugin, which leads to an increase in errors, compatibility problems with other plugins / themes </li><li>  Search promotion </li><li>  Easier development and independent release of updates </li><li>  The interface of the plugin is not complicated by a bunch of add.  options that are not needed if the user uses only one function </li><li>  Separate management and logging interface in CleanTalk control panel </li></ol><br>  We decided to start with the implementation of protection against brute force attacks and then gradually expand the functionality. <br><br>  <b>Protection against brute-force attacks</b> - implemented by adding delays between incorrect authorization attempts.  On the first attempts a delay of 3 seconds is set, for the next 10 seconds.  If within an hour there were 10 unsuccessful authorization attempts, the IP address will be added to the FireWall database for 24 hours.  To protect against hackers trying to find a password for your account, this is enough, since they significantly increase the time between attempts, and there may be tens and hundreds of thousands of them.  All logs of access attempts are available in the weekly report and in the service control panel, which allows you to quickly add IP addresses to the FireWall blacklist.  Protection against brute-force attacks applies only to users with administrator rights. <br><br>  <b>Traffic control</b> - allows you to view information about visitors, such as: <br><br><ul><li>  IP </li><li>  A country </li><li>  Last Request Date / Time </li><li>  Number of allowed / blocked HTTP requests </li><li>  Status - Banned or Allowed </li><li>  Visit Page URL </li><li>  User Agent </li></ul><br>  Another option in <b>Traffic Control</b> - ‚ÄúBlock a visitor if the number of requests is more than‚Äù - blocks access to the site for any IP that has exceeded the number of HTTP requests per hour.  The number of requests can be set in the settings, the default is 1000. If you exceed the IP, it will be added to the Firewall Blacklist for 24 hours. <br><br>  This will help to solve the problem of DoS attacks on the site, when a large number of HTTP requests are sent to the site, because of which it stops responding or starts to work very slowly.  This situation is possible due to a massive brute force attack. <br><br>  <b>Audit log</b> - allows you to monitor user actions in the WordPress admin panel, keeps a log of page visits with the date / time and duration of stay.  Allows you to control the actions of administrators and unauthorized access and in case of problems to understand where, by whom and what changes have been made. <br><br>  <b>Malware Scanner</b> - scans WordPress files, plugins and themes for malicious code and changes made.  If changes to the files were made unauthorized, it allows you to restore the original files. <br><br>  Scanning in automatic mode occurs once every 24 hours, and can also be started manually. <br><br>  <b>Security FireWall</b> - blocks access to the site for POST / GET requests by IP addresses.  The base of IP addresses for FireWall, is formed from the common base of Black Lists CleanTalk.  It gets IP addresses that have high spam activity or were seen in attempts to brute-force attacks.  It is possible to use your own blacklists, both by individual IP addresses / subnets and by countries.  Due to this, you can reduce the load on the site or block DOS attacks. <br><br>  <b>Preparing for release</b> : <br><br><ul><li>  outbound link scanner </li><li>  checking links on a database of domains that are promoted by spam </li><li>  XSS and SQL injection protection </li></ul><br><h3>  Development notes </h3><br>  Everything was written from scratch, not peeping to other solutions.  This was done specifically so as not to grab the mistakes of others and to develop your own vision for the application. <br><br>  Further development for other CMS is planned, so it was decided to develop a modular design.  Use an object-oriented approach and stuff like that.  Of course, the process had to solve various problems that did not fit into this concept and could not do without ‚Äúcrutches‚Äù. <br><br>  The result was a few classes that without significant modifications can be used on other CMS (including self-written) using a pair of wrappers, for example, for the database. <br><br>  A custom Cron class was written independent of Cron Wordpress.  Still, an application for security and should not rely on functionality that may or may not work, or third-party developers may interfere with the work. <br><br>  To implement the heuristic code analysis, we wrote our own parser <i>minimizer of</i> code, which will be further developed.  With it, you can track dangerous variables, functions, structures.  Not sure whether other plug-ins / antiviruses / applications use similar solutions (most likely not), but this is the pros and cons of independent development, our approach probably turned out to be unique. <br><br>  Example of the ‚Äúminimizer‚Äù: <br><br>  Source: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//$some = 'n'.'o'.'t' $some = 's'.'o'.'m'.'e'; // String concatenation $stuff = 'stuff'; $first = 'first'; $func = 'func'; $first_func = $some."$first$func"; // Variable replacement </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> $some = 'n'.'o'.'t'; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> // Variable replacement $i = 'i'; $c = 'c'; $o = 'o'; $co = $c. // some obfuscating comment $o; $ico = $i/* some obfuscating comment */.$co; require($some.'_'.$stuff.'.'.$ico); require($some.'_'.$stuff.'.php'); require($some.'_'.$stuff.'.p'.$ico); $first_func(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  Result: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $some=<span class="hljs-string"><span class="hljs-string">'some'</span></span>;$stuff=<span class="hljs-string"><span class="hljs-string">'stuff'</span></span>;$first=<span class="hljs-string"><span class="hljs-string">'first'</span></span>;$func=<span class="hljs-string"><span class="hljs-string">'func'</span></span>;$first_func=<span class="hljs-string"><span class="hljs-string">'somefirstfunc'</span></span>;$i=<span class="hljs-string"><span class="hljs-string">'i'</span></span>;$c=<span class="hljs-string"><span class="hljs-string">'c'</span></span>;$o=<span class="hljs-string"><span class="hljs-string">'o'</span></span>;$co=<span class="hljs-string"><span class="hljs-string">'co'</span></span>;$ico=<span class="hljs-string"><span class="hljs-string">'ico'</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">require</span></span><span class="hljs-string"><span class="hljs-string">'some_stuff.ico'</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">require</span></span><span class="hljs-string"><span class="hljs-string">'some_stuff.php'</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">require</span></span><span class="hljs-string"><span class="hljs-string">'some_stuff.pico'</span></span>;somefirstfunc();<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  If you bring in a clearer view: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $some=<span class="hljs-string"><span class="hljs-string">'some'</span></span>; $stuff=<span class="hljs-string"><span class="hljs-string">'stuff'</span></span>; $first=<span class="hljs-string"><span class="hljs-string">'first'</span></span>; $func=<span class="hljs-string"><span class="hljs-string">'func'</span></span>; $first_func=<span class="hljs-string"><span class="hljs-string">'somefirstfunc'</span></span>; $i=<span class="hljs-string"><span class="hljs-string">'i'</span></span>;$c=<span class="hljs-string"><span class="hljs-string">'c'</span></span>;$o=<span class="hljs-string"><span class="hljs-string">'o'</span></span>; $co=<span class="hljs-string"><span class="hljs-string">'co'</span></span>; $ico=<span class="hljs-string"><span class="hljs-string">'ico'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span><span class="hljs-string"><span class="hljs-string">'some_stuff.ico'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span><span class="hljs-string"><span class="hljs-string">'some_stuff.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span><span class="hljs-string"><span class="hljs-string">'some_stuff.pico'</span></span>; somefirstfunc(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  Some things he can do: concatenate, substitute variables, track the origin of variables (say if they used unreliable $ _POST and $ _GET), track and check file connections (include, require) using various parameters and much more.  We can say that this is the basis on which the functionality will be added. <br><br>  I especially did not like to support WPMS, since for each functional I had to make exceptions, taking into account whether this is the main site, whether the user of the secondary site inherits the key from the main one or enters its own access key, allowed the secondary site to activate plug-ins and the like.  Unfortunately, we had to remove some of the functionality for WPMS and secondary sites due to incompatibility. <br><br>  In general, it turned out to be a beautiful application in some places in terms of code, which we will develop in the future. <br><br>  <a href="https://wordpress.org/plugins/security-malware-firewall/">The plugin itself can be found in the directory.</a> <a href="https://wordpress.org/plugins/security-malware-firewall/"><br></a> </div><p>Source: <a href="https://habr.com/ru/post/349420/">https://habr.com/ru/post/349420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349408/index.html">Yii 2.0.14</a></li>
<li><a href="../349412/index.html">Experience of transition of the project to phalcon from php 5.6 to 7.1</a></li>
<li><a href="../349414/index.html">The digest of interesting materials for the mobile developer # 241 (February 12 ‚Äî February 18)</a></li>
<li><a href="../349416/index.html">Proportional time management</a></li>
<li><a href="../349418/index.html">Spam Attack to CleanTalk Service</a></li>
<li><a href="../349422/index.html">Webpack 4, import () and CommonJS</a></li>
<li><a href="../349426/index.html">Modeling dynamic systems: solving nonlinear equations</a></li>
<li><a href="../349428/index.html">Chrome 68 will mark all HTTP sites as ‚Äúunsafe‚Äù</a></li>
<li><a href="../349430/index.html">NetApp storage systems - generational continuity, problems and solutions</a></li>
<li><a href="../349432/index.html">How to try on a crown</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>