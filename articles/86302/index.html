<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Database. Parallel Access Conflicts (Part 1 - Problem Search)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dear colleagues, in this article we will not consider the types of locks in SQL, but the ways to solve problems when accessing the same data from diff...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Database. Parallel Access Conflicts (Part 1 - Problem Search)</h1><div class="post__text post__text-html js-mediator-article"> Dear colleagues, in this article we will not consider the types of locks in SQL, but the ways to solve problems when accessing the same data from different connections, and some updates may be lost.  The article does not depend on a specific database and may be equally interesting to many. <br><br>  There can always be such a situation when we read some records in one connection and then tried to update them.  But for the moment when we edited them, and then tried to save, in another connection, the same records were already updated.  In other words, the first process reads the data, after which the second process reads the same data, and the second process updates the same data before the first process can do it, a conflict will arise when the first process tries to update this data. <br><br>  If the database is accessed from several connections and changes are made, then the occurrence of conflicts is only a matter of time and luck. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The application itself must decide what actions it needs to do to resolve this conflict.  For example, the situation may be as follows: the site administrator has visited a page displaying data of a regular user (the administrator has the ability to update this data). If after the page of the administrator reads user data from the database, and the normal user access the page displaying his user data , and will make changes, then a conflict will arise when the administrator saves their changes.  If the conflict does not arise - then the changes of the normal user will be blocked and lost.  It may be otherwise - the administrator changes are lost.  What kind of behavior should be true in each case - this is a difficult problem.  The first step is to discover it.  The second is to allow.  There are two basic approaches to resolving concurrent access conflicts - optimistic and pessimistic. <br><a name="habracut"></a><br>  The first part of this article is devoted to the problem itself and how to solve it.  The second part of the article will describe how to resolve conflicts in LINQ to SQL.  It may be the third part, if I manage to persuade a colleague to describe ways to resolve conflicts in Hibernate (but this will be known later).  These articles will occupy much more space, so the first part is described separately, although it is rather short. <br><br>  <b>Optimistic solution</b> <br><br>  The optimistic way comes from the fact that in most cases conflicts do not occur.  Therefore, no lock on the record is not installed.  And when suddenly a conflict happens when you try to update the same data, then we will do it.  Optimistic handling of concurrent access conflicts is more complicated than pessimistic, but it works more efficiently in modern applications with a large number of users.  Imagine that in order to look at a product from a store, you would have to wait, because someone else is looking at it at the moment. <br><br>  <b><i>Conflict detection</i></b> <br><br>  If you have a special Version field (or for example, the last update date), then when prompted, you can simply check if the entry has changed since you read it.  If you do not have this field, then you need to decide which fields are involved in conflict detection. <br><br>  When you need to update a record, instead of specifying only the primary key in the <i>WHERE clause</i> , you specify with it all the columns involved in the update. <br><br>  For example, suppose you want to update a <i>Customer</i> object and assign new values ‚Äã‚Äãto the fields <i>CompanyName, ContactTitle, ContactName</i> .  And let's say that you want the <i>CompanyName</i> (always), <i>ContactName</i> (only when updating) <i>fields</i> , and <i>ContactTitle</i> to participate in the search for a conflict.  In this case, the request may be as follows: <br><br> <code>UPDATE Customers <br> SET CompanyName = 'Art Sanders Park', <br> ContactName = 'Samuel Arthur Sanders', <br> ContactTitle = 'President' <br> WHERE CompanyName = 'Lonesome Pine Restaurant' AND <br> ContactName = 'Fran Wilson' AND <br> CustomerID = 'LONEP' <br></code> <br><br>  In this example, the column values ‚Äã‚Äãin the <i>where clause</i> are the original column values ‚Äã‚Äãthat were read from the database.  As you can see, the <i>ContactTitle</i> field <i>was</i> not involved in the search for conflicts, because  we decided that it was less important to us. <br><br>  Instead of specifying columns, we can also use the Version ... field in which to store the version number, or the date of the last update.  In this case, this field will be updated when the version is updated in any of the connections. <br><br>  If someone updated the record after we read it, then our query will not change the records in the database.  To do this, after the requests we will check <i>@@ ROWCOUNT</i> and find out if the record has been updated.  And if not, then there was a concurrent access conflict. <br><br>  After the conflict has been found - it is necessary to solve it.  Conflict resolution can be different, but in the second part of the article we will look at how this is done in LINQ to SQL, and maybe my colleague will describe how it is done in Hibernate (for the third part of the article). <br><br>  <b>Pessimistic way to solve</b> <br><br>  As the name suggests, the pessimistic approach suggests the worst thing is that the post you are reading will cause a conflict at the time it is updated.  Fortunately, this is easy to do; you just need to put the reading and update in the database inside a single transaction. <br><br>  With a pessimistic approach to concurrency, there are no conflicts that need to be resolved because the database is locked by your transaction, so no one else can modify it behind you. <br><br>  But as I said, this method is less suitable for applications that require the ability to work simultaneously with data from several connections, since  When locks are set, nobody can update the data until the lock is released. </div><p>Source: <a href="https://habr.com/ru/post/86302/">https://habr.com/ru/post/86302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86288/index.html">Fresh breath of air for Ubuntu</a></li>
<li><a href="../86292/index.html">Adobe shows Flash on Android</a></li>
<li><a href="../86295/index.html">MiniCap - Command Line Screenshot</a></li>
<li><a href="../86299/index.html">Translator</a></li>
<li><a href="../86301/index.html">Some apple company</a></li>
<li><a href="../86303/index.html">We define the "wrong" words in the fight against spam</a></li>
<li><a href="../86308/index.html">How to form the habit of drinking more water</a></li>
<li><a href="../86309/index.html">How IE8 defines Document Mode, which then renders sites</a></li>
<li><a href="../86310/index.html">Spanish police have arrested the instigators of a massive bot-net</a></li>
<li><a href="../86312/index.html">Andoroid and Multitouch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>