<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integrating Honeywell security system (Ademco) VISTA 10 with home automation Fibaro</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Honeywell (Ademco) develops popular VISTA security systems, ranging from simple VISTA-10s to those rich in VISTA-250 functionality. Multifunctional se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integrating Honeywell security system (Ademco) VISTA 10 with home automation Fibaro</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b54/e79/4ae/b54e794aea1d416d969d1748072f0fb6.jpg"><br><br>  Honeywell (Ademco) develops popular VISTA security systems, ranging from simple VISTA-10s to those rich in VISTA-250 functionality.  Multifunctional security systems VISTA-128/250 contain an RS232 port, which allows integrating them into any other system. <br><br>  I was given the task: " <i>Integrate the VISTA-10 L security system into the Fibaro home automation system, from one mobile application you need to control both the lighting and the garage doors and set the house to be armed</i> ." 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At a cursory study of VISTA-10 L, it turned out that there was no UART and there was no mention of it.  Fortunately, the company <a href="http://">www.alarmdecoder.com</a> , which develops boards simulating the operation of the control panel, was found on the expanses of the American Internet.  The board exists in 3 connection options: USB, RS-232, UART shield for the Raspberry Pi.  I chose the AD2Pi shield for the Raspberry Pi. <br><br><img src="https://habrastorage.org/files/e14/e54/91e/e14e5491e7f54733b7940bc4afb5016a.jpg"><a name="habracut"></a><br><br>  The AD2Pi board is connected to the terminals of the control panel and for the security system it is presented as another control and display panel. <br><br><img src="https://habrastorage.org/files/e50/f48/fef/e50f48fef8574a3993dbd4fb27ebac1f.jpg"><br>  <i>Control and display panel (control panel)</i> <br><br>  The wiring diagram is simple: <br><table><tbody><tr><td>  AD2Pi </td><td>  VISTA control panel </td></tr><tr><td>  - </td><td>  4 - KEYPAD GROUND (-) </td></tr><tr><td>  + </td><td>  5 - KEYPAD PWD (+) </td></tr><tr><td>  DI </td><td>  6 - DATA IN TO KEYPAD </td></tr><tr><td>  Do </td><td>  7 - DATA OUT TO KEYPAD </td></tr></tbody></table><br><img src="https://habrastorage.org/files/5a9/d39/830/5a9d398300404448a30e52672bbdf1d0.jpg"><br><br><img src="https://habrastorage.org/files/82f/284/278/82f28427842c41ca92d5650a89749b8d.JPG"><br><br>  After connecting the AD2Pi to the VISTA control panel, go to work with the software.  alarmdecoder allows you to fully manage and monitor the security system. <br><br><h5>  1) Install python library alarmdecoder </h5><br>  <b>alarmdecoder</b> allows <b>you</b> to receive all system messages in parsed form, send control commands and settings. <br><br><pre><code class="bash hljs">pip install alarmdecoder</code> </pre> <br>  or from git <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nutechsoftware/alarmdecoder.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> alarmdecoder python setup.py install</code> </pre> <br><h5>  2) Install ser2sock - Serial to Socket Redirector </h5><br>  <b>ser2sock</b> allows you to connect to the serial port remotely, it is necessary to control the security system not only from Raspberry Pi, but also from any other computer / device directly. <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nutechsoftware/ser2sock.git</code> </pre> <br>  Installation details here: <a href="https://github.com/nutechsoftware/ser2sock">https://github.com/nutechsoftware/ser2sock</a> <br><br><h5>  3) Configure the AD2Pi Board </h5><br>  First of all, you need to configure the AD2Pi board so that it sends us all the events of interest.  Connect to the serial port of AD2Pi via minicom and enter "!" To enter setup mode.  Note that the address of the virtual control panel should be 31, the LRR should be Y, and the mask at the addresses ffffffff, i.e.  receive messages from everyone. <br><br><pre> <code class="bash hljs">sudo minicom -d /dev/ttyAMA0</code> </pre> <br><img src="https://habrastorage.org/files/29b/c72/ac9/29bc72ac9f514b76971d4ee46ebc0ea3.png"><br><br>  On the control panel, you need to activate the function of sending messages via LRR / GSM, then we will know which user removed and armed. <br><br><img src="https://habrastorage.org/files/c0e/ed2/860/c0eed28609a64734a86c80f1a4b00d79.png"><br><br><h5>  4) Verifying system performance </h5><br>  Start ser2sock and listen on port 10000: <br><br><pre> <code class="bash hljs">sudo /etc/init.d/ser2sock start nc localhost 10000</code> </pre> <br>  Must see messages from the system: <br><br><img src="https://habrastorage.org/files/db0/9f5/865/db09f58653934905a8fd6a582a514603.png"><br><br><h5>  5) Processing messages from the security system </h5><br><img src="https://habrastorage.org/files/56b/7ca/401/56b7ca401cfc40f7870ab0cb9199c888.png"><br><br><div class="spoiler">  <b class="spoiler_title">Python script to send messages from alarmdecoder to Home Center 2 automation controller</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python # -*- coding: utf-8 -*- import json import base64 import time from time import gmtime, strftime import requests from requests.auth import HTTPBasicAuth from alarmdecoder import AlarmDecoder from alarmdecoder.devices import SocketDevice # Configuration values HOSTNAME = 'localhost' PORT = 10000 # Fibaro access username = "admin" password = "admin" def main(): """ Example application that prints messages from the panel to the terminal. """ try: # Retrieve an AD2 device that has been exposed with ser2sock on localhost:10000. device = AlarmDecoder(SocketDevice(interface=(HOSTNAME, PORT))) # Set up an event handler and open the device device.on_message += handle_message device.on_lrr_message += handle_lrr_message with device.open(): while True: time.sleep(1) except Exception, ex: print 'Exception:', ex def handle_message(sender, message): """ Handles message events from the AlarmDecoder. """ print message.text jsonData = {"value":message.text} requests.put('http://10.0.1.43/api/globalVariables/AlarmStatus', json = jsonData, auth=HTTPBasicAuth(username, password)) def handle_lrr_message(sender, message): """ Handles message events from the AlarmDecoder. """ lrr_message = message.event_data + " " + message.event_type print lrr_message jsonData = {"value":lrr_message} requests.put('http://10.0.1.43/api/globalVariables/AlarmUsers', json = jsonData, auth=HTTPBasicAuth(username, password)) if __name__ == '__main__': main()</span></span></code> </pre> <br></div></div><br>  To process the message, I wrote a small python script that I put in autoload. <br>  The script connects to the ser2sock service, receives messages from it and sends them to the Home Center 2 automation controller. On the controller, I process the messages, display them in the virtual device and send a push notification about the security system status. <br><br><h5>  6) Widget for managing Home Center 2 security system </h5><br><img src="https://habrastorage.org/files/254/5c4/6e9/2545c46e970448d3889a46d2eaca0572.jpg"><br><br>  On Home Center 2, I created a virtual device with which you can arm in different modes, disarm and display system status and information about who armed or disarmed. <br><br>  To arm or disarm, you only need to send a TCP request with an arm / disarm code. <br><br><img src="https://habrastorage.org/files/97e/33a/f8b/97e33af8b5544dfd87f155179fe8fbe6.png"><br><br><div class="spoiler">  <b class="spoiler_title">Lua script to process messages from alarmdecoder</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">-- Check alarm status securityStatus = fibaro:getGlobalValue('AlarmStatus') lastSecurityStatus = fibaro:getGlobalValue('lastSecurityStatus') -- Show messages from alarm system if (lastSecurityStatus ~= securityStatus) then fibaro:call(108, "setProperty", "ui.Label1.value", os.date("%x %X ") .. securityStatus) fibaro:setGlobal('lastSecurityStatus',securityStatus) fibaro:debug(fibaro:getValue(108, 'ui.Label1.value')) end -- Check alarm user and event alarmUsers = fibaro:getGlobalValue('AlarmUsers') lastAlarmUsers = fibaro:getGlobalValue('lastAlarmUsers') -- If security status changed then show new status and send push if (lastAlarmUsers ~= alarmUsers) then fibaro:setGlobal('lastAlarmUsers',alarmUsers) userID = string.sub(alarmUsers, 3, 3) event = string.sub(alarmUsers, 5) -- set user name if userID == "4" then userID = "Raspberry" elseif userID == "3" then userID = "" elseif userID == "2" then userID = "" end -- set translated event if event == "ARM_AWAY" then event = "  " elseif event == "ARM_STAY" then event = "   " elseif event == "OPEN" then event = "  " end fibaro:call(108, "setProperty", "ui.Label2.value", event .. " " .. userID) fibaro:debug(fibaro:getValue(108, 'ui.Label2.value')) fibaro:call(100, "sendPush", fibaro:getValue(108, 'ui.Label2.value')) fibaro:call(25, "sendPush", fibaro:getValue(108, 'ui.Label2.value')) end</span></span></code> </pre><br></div></div><br>  It also took several global variables to Home Center 2, which store the current state of the system and users. <br><br><img src="https://habrastorage.org/files/856/81b/056/85681b05650241c699f9d6d1b7c13ca9.png"><br><br>  All information that is displayed on the control panel: removed / armed, sensor triggering, low sensor battery charge, switching to backup power, etc., can be processed and sent to the automation system for further action. <br><br>  All Home Center 2 devices are broadcast in the <a href="https://geektimes.ru/post/276706/">homebridge</a> , which allows you to arm and shoot using the Siri voice assistant. <br><br>  The alarmdecoder boards can be used with any automation system, <a href="http://www.alarmdecoder.com/wiki/index.php/Protocol">detailed documentation</a> and a <a href="http://alarmdecoder.readthedocs.io/en/latest/">convenient API</a> allow you to quickly and easily integrate the security system into any smart home! </div><p>Source: <a href="https://habr.com/ru/post/399833/">https://habr.com/ru/post/399833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../399823/index.html">Pseudoscience and speculators. Perpetual motion machine</a></li>
<li><a href="../399825/index.html">Physics in the animal world: chameleons and their color</a></li>
<li><a href="../399827/index.html">Mapping and localization of a mobile robot in ROS without odometry using laser_scan_matcher</a></li>
<li><a href="../399829/index.html">The history of Konami: from jukeboxes to the largest holding with anime, games and arcade machines</a></li>
<li><a href="../399831/index.html">Peace atom breaks ice: our atomic icebreaking fleet</a></li>
<li><a href="../399835/index.html">Boston Dynamics suggests using SpotMini to deliver your robot.</a></li>
<li><a href="../399837/index.html">QEMU Advent Calendar - an easy way to get familiar with unusual operating systems.</a></li>
<li><a href="../399839/index.html">We connect a wireless radiation dosimeter to the ‚ÄúPeople's monitoring‚Äù service via Raspberry PI</a></li>
<li><a href="../399841/index.html">Galaxy Note 7 battery explodes due to aggressive design</a></li>
<li><a href="../399843/index.html">Lectures on bioinformatics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>