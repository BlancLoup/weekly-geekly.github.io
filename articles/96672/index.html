<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco 7912G IP Phone Firmware Change from SIP to Skinny</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of writing a continuation to the first part of the topic on setting up telephony on Cisco, it was necessary to tie two phones to the CM...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco 7912G IP Phone Firmware Change from SIP to Skinny</h1><div class="post__text post__text-html js-mediator-article">  In the process of writing a continuation to the <a href="http://habrahabr.ru/blogs/cisconetworks/95802/">first part of the</a> topic on setting up telephony on Cisco, it was necessary to tie two phones to the CME, but I ran into one problem.  Phones were stitched under SIP and at this stage I wanted to do everything on Skinny.  And if there are no special problems with the Skinny-phone firmware in SIP (this process has already been described on <a href="http://habrahabr.ru/blogs/voip/37473/">Habr√©</a> ), then the reverse procedure turned out to be quite non-trivial. <br><a name="habracut"></a><br>  So, there are 2 ways to solve this problem, one of them is to use the full-fledged Cisco Unified Call Manager deployed on the server.  Since his hands have not yet reached him, this option was unacceptable. <br>  The second solution is firmware by means of a router with CME. <br>  First you need the firmware itself, the latest version on Cisco is now 8.0 (4), the file for downloading is called <b>cmterm-7912G-sccp.8-0-4.zip</b> .  But there is a problem. To download it, you need the privileges of a CCO account, which I do not have, so I had to look for an alternative <a href="">source</a> .  The archive contains the file CP7912080003SCCP070409A.sbin. <br>  Next, upload the file via TFTP to the router and create a DHCP configuration for the phone: <br><blockquote><code>ip dhcp pool PHONES <br> network 10.13.6.0 255.255.255.0 <br> default-router 10.13.6.10 <br> <font color="gray"># 150   TFTP-</font> <br> option 150 ip 10.13.6.10</code> </blockquote> <br>  After that, we launch the necessary debugs <strong>debug ip dhcp server events</strong> and <strong>debug tftp events</strong> and see what happens. <br><blockquote> <code>CME# <br> Jun 1 02:41:05.447: DHCPD: Sending notification of ASSIGNMENT: <br> Jun 1 02:41:05.447: DHCPD: address 10.13.6.22 mask 255.255.255.0 <br> Jun 1 02:41:05.447: DHCPD: htype 1 chaddr 0019.2f9c.554e <br> Jun 1 02:41:05.447: DHCPD: lease time remaining (secs) = 86400 <br> Jun 1 02:41:05.527: TFTP: Looking for gk00192f9c554e <br> Jun 1 02:41:05.539: TFTP: Looking for gkdefault.cfg</code> </blockquote> <br>  It can be seen that the phone normally received the DHCP address 10.13.6.22 and correctly sends requests to the router, which acts as a TFTP server.  The phone asks for a configuration file either specifically for itself (gkxxxxxxxxxxxx, where xxxx is the mac-address of the phone) or the default config.  According to official sources, the CP7102 will request files starting with <strong>ff</strong> , and the CP7105 will request files with <strong>id</strong> <br><br>  At this stage, our task is to slip the phone with the desired configuration file so that it can change into SCCP.  You can read about what this file is and what fields it contains <a href="http://www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7905g_7912g/3_3/english/administration/guide/7900alt7.html">here</a> . <br><br>  So, create the configuration file gkdefault.txt 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code>#txt <br> upgradecode:3,0x601,0x0400,0x0100, <strong>10.13.6.10</strong> ,69,0x <strong>070409A</strong> ,CP7912080003SCCP <strong>070409A</strong> .sbin</code> </blockquote> <br>  Since you need to download it in binary form, you need to convert it with the <strong>cfgfmt.exe</strong> utility, which can be found <a href="http://www.razametal.org/asterisk/hardware/cisco/Cisco_IP_Phone_7905/sip/sip/">here</a> .  The utility also needs to work the file <strong>sip_ptag.dat</strong> , which lies in the same place. <br>  Run the program <br><blockquote> <code>cfgfmt -tsip_ptag.dat gkdefault.txt gkdefault.cfg</code> </blockquote> <br>  The resulting file is also uploaded to the CME <br><br>  So, after all the procedures, we should have the following on the flash: <br><br><blockquote> <code>CME#sh flash: <br> <br> System flash directory: <br> File Length Name/status <br> 1 18296372 c1700-ipvoicek9-mz.124-25.bin <br> 2 341023 CP7912080003SCCP070409A.sbin <br> 3 62 gkdefault.cfg</code> </blockquote> <br>  Now we add the necessary files to our tftp-server: <br><br><blockquote> <code>tftp-server flash:CP7912080003SCCP070409A.sbin <br> tftp-server flash:gkdefault.cfg</code> </blockquote> <br>  At this stage, you can distort the power of the phone and if everything is configured correctly, the following will be seen in the debugs: <br><blockquote> <code>Jun 1 03:48:33.495: DHCPD: Sending notification of ASSIGNMENT: <br> Jun 1 03:48:33.495: DHCPD: address 10.13.6.22 mask 255.255.255.0 <br> Jun 1 03:48:33.495: DHCPD: htype 1 chaddr 0019.2f9c.554e <br> Jun 1 03:48:33.495: DHCPD: lease time remaining (secs) = 86400 <br> Jun 1 03:48:33.575: TFTP: Looking for gk00192f9c554e <br> Jun 1 03:48:33.587: TFTP: Looking for gkdefault.cfg <br> Jun 1 03:48:33.587: TFTP: Opened flash:gkdefault.cfg, fd 0, size 62 for process 127 <br> Jun 1 03:48:33.595: TFTP: Finished flash:gkdefault.cfg, time 00:00:00 for process 127 <br> Jun 1 03:48:33.599: TFTP: Looking for CP7912080003SCCP070409A.sbin <br> Jun 1 03:48:33.603: TFTP: Opened flash:CP7912080003SCCP070409A.sbin, fd 0, size 341023 for process 151 <br> Jun 1 03:48:40.279: TFTP: Finished flash:CP7912080003SCCP070409A.sbin, time 00:00:06 for process 151</code> </blockquote> <br>  After that, the phone will display <strong>Write flash ... Please wait</strong> , it will jump over and become a Skinny-phone! <br><br>  <strong>PS</strong> <br>  Alternatively, you could use the <strong>tftpd32.exe</strong> DHCP server to configure the 150th option and upload the CP7912080003SCCP070409A.sbin and gkdefault.cfg files to the root folder of the TFTP server. </div><p>Source: <a href="https://habr.com/ru/post/96672/">https://habr.com/ru/post/96672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96662/index.html">Kaspersky vs. DDoS</a></li>
<li><a href="../96663/index.html">Search for such a search</a></li>
<li><a href="../96667/index.html">Sony Presentation at E3 2010</a></li>
<li><a href="../96669/index.html">Alternative method of working at the computer</a></li>
<li><a href="../96671/index.html">ITunes 9.2 has been released!</a></li>
<li><a href="../96676/index.html">BitTorrent and DHT: Client Mutual Compatibility</a></li>
<li><a href="../96682/index.html">Real-time sunlight - a planet in real time on your desktop</a></li>
<li><a href="../96683/index.html">QuikOrdersDOM - automated stock trading</a></li>
<li><a href="../96684/index.html">Making hardcover for favorite books</a></li>
<li><a href="../96685/index.html">Easy way to lose (not acquire) a potential client</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>