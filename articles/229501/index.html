<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is grep and what it eats</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is inspired by the posts of two topics that have recently flashed on Habr√© - ‚Äúinteresting unix commands‚Äù and ‚Äúhow I selected a programmer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is grep and what it eats</h1><div class="post__text post__text-html js-mediator-article">  This article is inspired by the posts of two topics that have recently flashed on Habr√© - ‚Äúinteresting unix commands‚Äù and ‚Äúhow I selected a programmer‚Äù.  And the teams described there, of course, are interesting in some places, but rarely practically useful, and it turns out that we really do not know how to use useful tools. <br>  Small lyrical digression: <br>  About three years ago I was asked to conduct an interview with applicants for the position of unix-sysadmin.  At the two largest freelance exchanges at the time, eight applicants responded to the vacancy, two of which were in the TOP-5 rating of these exchanges.  I never require administrators to memorize configs and I believe that the necessary software is always comfortable, if there is a desire to read, logic in actions and the ability to correctly use the tools of the system.  Therefore, for the beginning, the applicants were given two tasks, something like this: <br>  - put the task in crowns, which will be performed at each even hour and at 3 o'clock; <br>  - print processor information from the /var/run/dmesg.boot file. <br><br>  To my surprise, none of the applicants with both questions failed.  Two, in principle, did not know about the existence of grep. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/015/ffc/e81/015ffce8105acc4f130164d9677ca12c.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Therefore ... Summer ... Friday ... Before the kebabs, let's talk a little about grep. <br><a name="habracut"></a><br>  Knowing the local public and in order not to cause unnecessary insinuations, I inform you that all of the following is true for <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># grep --version | grep grep grep (GNU grep) 2.5.1-FreeBSD</span></span></code> </pre> <br>  This is important in connection with <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># man grep | grep -iB 2 freebsd -P, --perl-regexp Interpret PATTERN as a Perl regular expression. This option is not supported in FreeBSD.</span></span></code> </pre><br><br>  First of all, about how we usually grep'ay files. <br>  Using cat: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># cat /var/run/dmesg.boot | grep CPU: CPU: Intel(R) Core(TM)2 Quad CPU Q9550 @ 2.83GHz (2833.07-MHz K8-class CPU)</span></span></code> </pre><br>  But why?  After all, you can and so <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep CPU: /var/run/dmesg.boot CPU: Intel(R) Core(TM)2 Quad CPU Q9550 @ 2.83GHz (2833.07-MHz K8-class CPU)</span></span></code> </pre><br>  Or like this (I hate this construction): <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># &lt;/var/run/dmesg.boot grep CPU: CPU: Intel(R) Core(TM)2 Quad CPU Q9550 @ 2.83GHz (2833.07-MHz K8-class CPU)</span></span></code> </pre><br>  For some reason, we consider selected rows using wc: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep WARNING /var/run/dmesg.boot | wc -l 3</span></span></code> </pre><br>  Although you can: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep WARNING /var/run/dmesg.boot -c 3</span></span></code> </pre><br>  Let's make a test file: <br><div class="spoiler">  <b class="spoiler_title">test.txt</b> <div class="spoiler_text"><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep ".*" test.txt one two three seven eight one eight three thirteen fourteen fifteen sixteen seventeen eighteen seven sixteen seventeen eighteen twenty seven one 504 one one 503 one one 504 one one 504 one #comment UP twentyseven #comment down twenty1 twenty3 twenty5 twenty7</span></span></code> </pre><br></div></div><br>  And begin to search: <br>  The <b>-w</b> option allows you to search by word entirely: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -w 'seven' test.txt seven eight one eight three sixteen seventeen eighteen seven twenty seven</span></span></code> </pre><br>  And if you need at the beginning or end of the word? <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep '\&lt;seven' test.txt seven eight one eight three sixteen seventeen eighteen seven sixteen seventeen eighteen twenty seven root@nm3:/ # grep 'seven\&gt;' test.txt seven eight one eight three sixteen seventeen eighteen seven twenty seven twentyseven</span></span></code> </pre><br>  Standing at the beginning or end of the line? <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep '^seven' test.txt seven eight one eight three root@nm3:/ # grep 'seven$' test.txt sixteen seventeen eighteen seven twenty seven twentyseven root@nm3:/ #</span></span></code> </pre><br>  Want to see the lines in the neighborhood you are looking for? <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -C 1 twentyseven test.txt #comment UP twentyseven #comment down</span></span></code> </pre><br>  Only bottom or top? <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -A 1 twentyseven test.txt twentyseven #comment down root@nm3:/ # grep -B 1 twentyseven test.txt #comment UP twentyseven</span></span></code> </pre><br>  And we can do it <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep "twenty[1-4]" test.txt twenty1 twenty3</span></span></code> </pre><br>  Conversely, excluding these <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep "twenty[^1-4]" test.txt twenty seven twentyseven twenty5 twenty7</span></span></code> </pre><br>  Of course, grep supports other basic quantifiers, metacharacters, and other delights of regulars. <br>  A couple of practical examples: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># cat /etc/resolv.conf #options edns0 #nameserver 127.0.0.1 nameserver 8.8.8.8 nameserver 77.88.8.8 nameserver 8.8.4.4</span></span></code> </pre><br>  We select only lines with ip: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -E "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}" /etc/resolv.conf #nameserver 127.0.0.1 nameserver 8.8.8.8 nameserver 77.88.8.8 nameserver 8.8.4.4</span></span></code> </pre><br>  It works, but it's more attractive: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -E '\b[0-9]{1,3}(\.[0-9]{1,3}){3}\b' /etc/resolv.conf #nameserver 127.0.0.1 nameserver 8.8.8.8 nameserver 77.88.8.8 nameserver 8.8.4.4</span></span></code> </pre><br>  Remove line with a comment? <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -E '\b[0-9]{1,3}(\.[0-9]{1,3}){3}\b' /etc/resolv.conf | grep -v '#' nameserver 8.8.8.8 nameserver 77.88.8.8 nameserver 8.8.4.4</span></span></code> </pre><br>  And now we will choose only ip themselves <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -oE '\b[0-9]{1,3}(\.[0-9]{1,3}){3}\b' /etc/resolv.conf | grep -v '#' 127.0.0.1 8.8.8.8 77.88.8.8 8.8.4.4</span></span></code> </pre><br>  That is bad luck ... The commented line has returned.  This is due to the pattern processing feature.  How to be?  Like this: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -v '#' /etc/resolv.conf | grep -oE '\b[0-9]{1,3}(\.[0-9]{1,3}){3}\b' 8.8.8.8 77.88.8.8 8.8.4.4</span></span></code> </pre><br>  Here we‚Äôll focus on inverting the search with <b>-v</b> <br>  Suppose we need to run <i>‚Äúps -afx |</i>  <i>grep ttyv ¬ª</i> <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># ps -afx | grep ttyv 1269 v1 Is+ 0:00.00 /usr/libexec/getty Pc ttyv1 1270 v2 Is+ 0:00.00 /usr/libexec/getty Pc ttyv2 1271 v3 Is+ 0:00.00 /usr/libexec/getty Pc ttyv3 1272 v4 Is+ 0:00.00 /usr/libexec/getty Pc ttyv4 1273 v5 Is+ 0:00.00 /usr/libexec/getty Pc ttyv5 1274 v6 Is+ 0:00.00 /usr/libexec/getty Pc ttyv6 1275 v7 Is+ 0:00.00 /usr/libexec/getty Pc ttyv7 48798 2 S+ 0:00.00 grep ttyv</span></span></code> </pre><br>  All anything, but the line <i>"48798 2 S + 0: 00.00 grep ttyv"</i> we do not need.  Use <b>-v</b> <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># ps -afx | grep ttyv | grep -v grep 1269 v1 Is+ 0:00.00 /usr/libexec/getty Pc ttyv1 1270 v2 Is+ 0:00.00 /usr/libexec/getty Pc ttyv2 1271 v3 Is+ 0:00.00 /usr/libexec/getty Pc ttyv3 1272 v4 Is+ 0:00.00 /usr/libexec/getty Pc ttyv4 1273 v5 Is+ 0:00.00 /usr/libexec/getty Pc ttyv5 1274 v6 Is+ 0:00.00 /usr/libexec/getty Pc ttyv6 1275 v7 Is+ 0:00.00 /usr/libexec/getty Pc ttyv7</span></span></code> </pre><br>  Ugly design?  Shuffle a bit: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># ps -afx | grep "[t]tyv" 1269 v1 Is+ 0:00.00 /usr/libexec/getty Pc ttyv1 1270 v2 Is+ 0:00.00 /usr/libexec/getty Pc ttyv2 1271 v3 Is+ 0:00.00 /usr/libexec/getty Pc ttyv3 1272 v4 Is+ 0:00.00 /usr/libexec/getty Pc ttyv4 1273 v5 Is+ 0:00.00 /usr/libexec/getty Pc ttyv5 1274 v6 Is+ 0:00.00 /usr/libexec/getty Pc ttyv6 1275 v7 Is+ 0:00.00 /usr/libexec/getty Pc ttyv7</span></span></code> </pre><br>  Also, do not forget about |  (OR) <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># vmstat -z | grep -E "(sock|ITEM)" ITEM SIZE LIMIT USED FREE REQ FAIL SLEEP socket: 696, 130295, 30, 65, 43764, 0, 0</span></span></code> </pre><br>  well, the same thing, otherwise: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># vmstat -z | grep "sock\|ITEM" ITEM SIZE LIMIT USED FREE REQ FAIL SLEEP socket: 696, 130295, 30, 65, 43825, 0, 0</span></span></code> </pre><br>  Well, if many people remember the use of regulars in grep'e, they somehow forget about using POSIX classes, and this is also sometimes convenient. <br><div class="spoiler">  <b class="spoiler_title">Posix</b> <div class="spoiler_text">  [: alpha:] Any alphabetical character, regardless of case <br>  [: digit:] Any numerical character <br>  [: alnum:] Any alphabetical or numerical character <br>  [: blank:] Space or tab characters <br>  [: xdigit:] Hexadecimal characters;  any number or a ‚Äì f or a ‚Äì f <br>  [: punct:] Any punctuation symbol <br>  [: print:] Any printable character (not control characters) <br>  [: space:] Any whitespace character <br>  [: graph:] Exclude whitespace characters <br>  [: upper:] Any uppercase letter <br>  [: lower:] Any lowercase letter <br>  [: cntrl:] Control characters <br></div></div><br>  Select the lines with uppercase characters: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep "[[:upper:]]" test.txt #comment UP</span></span></code> </pre><br>  Poor see what you found?  Highlight: <br><img src="https://habrastorage.org/getpro/habr/post_images/5c8/f2d/d09/5c8f2dd093f5e494fc84a82a4e5336ee.png" alt="image"><br><br>  Well, a couple of tricks for the seed. <br>  The first is rather academic.  For 15 years I have never used it: <br>  It is necessary to choose from our test file the lines containing six or seven or eight: <br>  So far, everything is simple: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -E "(six|seven|eight)" test.txt seven eight one eight three sixteen seventeen eighteen seven sixteen seventeen eighteen twenty seven twentyseven</span></span></code> </pre><br>  And now only those lines in which six or seven or eight occur several times.  This feature is called <i>Backreferences.</i> <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -E "(six|seven|eight).*\1" test.txt seven eight one eight three sixteen seventeen eighteen seven</span></span></code> </pre><br>  Well, the second trick, much more useful.  It is necessary to display lines in which 504 on both sides is limited to tabs. <br>  Oh, how it lacks PCRE support ... <br>  Using POSIX classes does not save: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep "[[:blank:]]504[[:blank:]]" test.txt one 504 one one 504 one one 504 one</span></span></code> </pre><br>  The [CTRL + V] [TAB] construction comes to the rescue: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep " 504 " test.txt one 504 one</span></span></code> </pre><br>  What else did not say?  Of course, grep can search in files / directories and, of course, recursively.  We‚Äôll find in the source code where Intel uses third-party SFP-NIS.  How do I spell <i>allow_unsupported_sfp</i> or <i>unsupported_allow_sfp</i> I do not remember.  Well, okay - these are grep's problems: <br><pre> <code class="bash hljs">root@nm3:/ <span class="hljs-comment"><span class="hljs-comment"># grep -rni allow /usr/src/sys/dev/ | grep unsupp /usr/src/sys/dev/ixgbe/README:75:of unsupported modules by setting the static variable 'allow_unsupported_sfp' /usr/src/sys/dev/ixgbe/ixgbe.c:322:static int allow_unsupported_sfp = TRUE; /usr/src/sys/dev/ixgbe/ixgbe.c:323:TUNABLE_INT("hw.ixgbe.unsupported_sfp", &amp;allow_unsupported_sfp); /usr/src/sys/dev/ixgbe/ixgbe.c:542: hw-&gt;allow_unsupported_sfp = allow_unsupported_sfp; /usr/src/sys/dev/ixgbe/ixgbe_type.h:3249: bool allow_unsupported_sfp; /usr/src/sys/dev/ixgbe/ixgbe_phy.c:1228: if (hw-&gt;allow_unsupported_sfp == TRUE) {</span></span></code> </pre><br><br>  I hope not tired.  And that was just the tip of the grep iceberg.  Enjoy your reading, and my appetite on kebabs! <br>  Well and good luck to you grep'a! </div><p>Source: <a href="https://habr.com/ru/post/229501/">https://habr.com/ru/post/229501/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229489/index.html">How do DVRs in Russia: a report from the AdvoCam factory in the Vladimir region</a></li>
<li><a href="../229491/index.html">Pebble My Data. ‚ÄúIf you want to do well, do it yourself!‚Äù</a></li>
<li><a href="../229495/index.html">po.js is a super simple utility for i18n</a></li>
<li><a href="../229497/index.html">Welcome to GeekFest Night July 26</a></li>
<li><a href="../229499/index.html">Guaranteed and non-guaranteed channel: what to choose?</a></li>
<li><a href="../229505/index.html">Panel discussion ‚ÄúWill the Internet destroy university education?‚Äù</a></li>
<li><a href="../229507/index.html">A / B testing and its results that shocked experts: intuition sometimes fails</a></li>
<li><a href="../229511/index.html">How to develop willpower</a></li>
<li><a href="../229513/index.html">Displays: myths and reality, present and future</a></li>
<li><a href="../229515/index.html">Testing of linguistic technologies: competition for the automatic resolution of coreference and anaphor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>