<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LastPass gave passwords from Chrome / FF / Edge and allowed remote code execution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Choosing a password manager is not an easy task. Other than Notepad with text file encryption, there is no clear leader in this area. The fundamental ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LastPass gave passwords from Chrome / FF / Edge and allowed remote code execution</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4e3/01f/5d5/4e301f5d539042f0b96134ab49d10beb.png"><br><br>  Choosing a password manager is not an easy task.  Other than Notepad with text file encryption, there is no clear leader in this area.  The fundamental question is: is it safe to use cloud services or is it fundamentally stored passwords only locally?  Someone believes that the use of cloud services still increases the risks.  And here came another argument in this dispute.  The LastPass password manager just <a href="https://blog.lastpass.com/2017/03/important-security-updates-for-our-users.html/">closed three vulnerabilities</a> ( <a href="https://bugs.chromium.org/p/project-zero/issues/detail%3Fid%3D1209%26can%3D1%26q%3Dlastpass">one</a> for expansion under Chrome, <a href="https://bugs.chromium.org/p/project-zero/issues/detail%3Fid%3D1188%26can%3D1%26q%3Dlastpass">two</a> <a href="https://bugs.chromium.org/p/project-zero/issues/detail%3Fid%3D1217">for</a> extension under Firefox), which allowed the malicious website to directly extract LastPass passwords.  As usual, the cause of the vulnerability is a programmers error. <br><br>  What kind of password manager is better now?  Maybe go back to the "Notebook"? <br><a name="habracut"></a><br>  The corporate blog LastPass reported that they were informed about the vulnerabilities by security specialist Tavis Ormandi (surprisingly, the same people find the lion's share of all the bugs in the popular software) from the Google Project Zero hacker team. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      LastPass says that it did not notice the theft of user passwords and advises to upgrade to the latest versions of the extension, where this vulnerability is closed, if they have not yet been updated automatically: <br><br><ul><li>  Firefox 4.1.36 </li><li>  Chrome: 4.1.43 </li><li>  Edge: 4.1.30 </li><li>  Opera: 4.1.28 </li></ul><br>  Suppose that the password theft really did not happen.  But how exactly could attackers make such a theft? <br><br>  The first vulnerability (Firefox 3.3.2 message-hijacking) for the old extension branch under Firefox exploits the URL parsing scheme in 3.3.2, which allowed the malicious website to impersonate a legitimate website and thus force LastPass to provide credentials.  Information about this bug <a href="https://blog.lastpass.com/2016/07/lastpass-security-updates.html/">came in LastPass last year</a> - in July, the vulnerability was closed, but only for the new 4.X branch, and it was simply forgotten to be transferred to the 3.X branch. <br><br>  Last year, security specialist Mathias Karlsson <a href="https://labs.detectify.com/2016/07/27/how-i-made-lastpass-give-me-all-your-passwords/">spoke</a> in detail about this shameful bug with URL parser in LastPass. <br><br>  Here is what the parser looked like (the lpParseUri function in the LastPass extension): <br><br><pre><code class="hljs mel">var fixedURL = URL.<span class="hljs-keyword"><span class="hljs-keyword">match</span></span>(/^(.*:\/\/[^\/]+\/.*)@/); fixedURL &amp;&amp; (url = url.<span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, fixedURL[<span class="hljs-number"><span class="hljs-number">1</span></span>].length) + url.<span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(fixedURL[<span class="hljs-number"><span class="hljs-number">1</span></span>].length).replace(/@/g, <span class="hljs-string"><span class="hljs-string">"%40"</span></span>));</code> </pre> <br>  Such ‚Äúdoggie‚Äù treatment means that the URL of the <code>http://avlidienbrunn.se/@twitter.com/@hehe.php</code> type was perceived by the browser as an address on the domain <code>avlidienbrunn.se</code> , and the LastPass extension was perceived as the address <code>twitter.com/@hehe.php</code> .  Accordingly, the auto-complete function transferred the password for the domain <code>twitter.com</code> to the domain <code>avlidienbrunn.se</code> . <br><br>  This vulnerability was closed a year ago in the actual branch of LastPass, everyone laughed and forgot.  Now it turned out that in the 3.X branch still remained.  LastPass developers explain that the branch was formally closed back in April, that is, nobody was engaged in its support.  And if there are still users of old versions, they are strongly recommended to switch to 4.1.36. <br><br><h1>  Second bug </h1><br>  The second vulnerability, which LastPass closed yesterday, is already fresh.  And it affects not only versions for Firefox, but also versions for Chrome and Edge.  Like the last bug, here the malicious site can impersonate itself and get a password.  Moreover, in the case of using the LastPass binary component, it was even possible to execute the code remotely, which is completely unacceptable. <br><br>  In a Chromium bug tracker <a href="https://bugs.chromium.org/p/project-zero/issues/detail%3Fid%3D1209%26can%3D1%26q%3Dlastpass">report,</a> Tavis Ormandi explained that the problem is in the script websiteConnector.js, which is used only on the 1min-ui-prod.service.lastpass.com domain.  Here it is listed in the manifest: <br><br><pre> <code class="hljs objectivec">{ <span class="hljs-string"><span class="hljs-string">"matches"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"https://1min-ui-prod.service.lastpass.com/*"</span></span> ], <span class="hljs-string"><span class="hljs-string">"js"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"1minsignup/chrome/websiteConnector.js"</span></span> ], <span class="hljs-string"><span class="hljs-string">"all_frames"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"run_at"</span></span>: <span class="hljs-string"><span class="hljs-string">"document_end"</span></span> },</code> </pre> <br>  Script content: <br><br><pre> <code class="hljs actionscript">$ uglifyjs --beautify &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>minsignup/chrome/websiteConnector.js ... window.addEventListener(<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function"> </span></span>{ e.data.fromExtension || chrome.runtime.sendMessage(e.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function"> </span></span>{}); });</code> </pre> <br>  Passing unauthenticated window objects into an extension from the websiteConnector.js script allows anyone to use this function: <br><br><pre> <code class="hljs pgsql">win = <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>("https://1min-ui-prod.service.lastpass.com/"); win.postMessage({}, "*");</code> </pre> <br>  And get access to all the internal LastPass RPC commands.  There are hundreds of calls, including the transfer of passwords.  When using the LastPass <a href="https://lastpass.com/support.php%3Fcmd%3Dshowfaq%26id%3D5576">binary component,</a> you can even run arbitrary code: <br><br><pre> <code class="hljs pgsql">win = <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>("https://1min-ui-prod.service.lastpass.com/"); win.postMessage({fromExtension: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, cmd: "openattach", attachkey: "d44479a4ce97554c24399f651ca76899179dec81c854b38ef2389c3185ae8eec", data: "!8uK7g5j8Eq08Nr86mhmMxw==|1dSN0jXZSQ51V1ww9rk4DQ==", mimetype: "other:.bat"}, "*");</code> </pre> <br><img src="https://habrastorage.org/files/4a8/a6e/29e/4a8a6e29e03b4c57a311dbac76e09671.png"><br><br>  The closed bug in the extension for Chrome coincides with one of the closed bugs in the extension for Firefox, only there it was necessary to make some additions. <br><br>  As Mathias Karlsson said last year, finding such vulnerabilities is not a reason to abandon password managers. <br><br>  By the way, Microsoft has not yet approved a new version of the extension for Edge.  It seems that LastPass users can still be exploited on this browser. </div><p>Source: <a href="https://habr.com/ru/post/357304/">https://habr.com/ru/post/357304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357294/index.html">USA accuses hackers from Russia and Kazakhstan of hacking Yahoo servers in 2014</a></li>
<li><a href="../357296/index.html">Study: sound attack on accelerometers replaces readings</a></li>
<li><a href="../357298/index.html">The court of Minnesota ordered Google to provide the police with search logs of residents of the whole city</a></li>
<li><a href="../357300/index.html">WikiLeaks is ready to share information about the CIA tools so that companies close vulnerabilities</a></li>
<li><a href="../357302/index.html">Moscow authorities are concerned about the Internet literacy of schoolchildren</a></li>
<li><a href="../357306/index.html">WikiLeaks has published a selection of 12 CIA documents about hacking iPhone and Mac in 2008-2013</a></li>
<li><a href="../357308/index.html">Let's Encrypt issued 14,766 certificates for phishing PayPal</a></li>
<li><a href="../357310/index.html">WikiLeaks uncovered the method used by the CIA to conceal the country of origin of spyware malware</a></li>
<li><a href="../357312/index.html">The Shadow Brokers Group has published new NSA exploits</a></li>
<li><a href="../357314/index.html">In Dallas, an hour and a half could not turn off 156 sirens of civil defense</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>