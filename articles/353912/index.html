<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another tool to check your npm dependencies is wtfwith</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you ever wondered how many versions of the same library your client or server builds drag out? Me here at some point it became interesting. Offha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another tool to check your npm dependencies is wtfwith</h1><div class="post__text post__text-html js-mediator-article">  Have you ever wondered how many versions of the same library your client or server builds drag out?  Me here at some point it became interesting.  Offhand to find a ready-made tool for this did not work, and looking at the package-lock eyes is too exhausting.  As we know, in any incomprehensible situation, you need to write your npm package, so I did just that ... Further in the post I will review the result of the analysis of the live project and make a couple of controversial conclusions. <br><br>  Well, you can not do without this classic image: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fu/4y/hq/fu4yhqs70molq5wp_efppaek7a4.png"></div><a name="habracut"></a><br><h2>  How does it work </h2><br>  In general, no rocket science - we take package.json and package-lock.json and run through all the dependencies that are there, collecting identical modules or forks.  Forks, of course, you have to register with your hands, so now they only indicate lodash and undescore.  But you can always help and expand this list. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/ow/ew/7s/owew7sgqidwzkp8ejwkzfqtjemk.gif"><br><br><h2>  How to use </h2><br>  The module is <a href="https://www.npmjs.com/package/wtfwith">published</a> on npm, it is easiest to run using <a href="https://blog.npmjs.org/post/162869356040/introducing-npx-an-npm-package-runner">npx</a> , although no one bothers you to install it locally or even globally.  I will continue to consider the option of running via npx.  For example, I will take one of my old projects, which is essentially a monolith on the node (this was before the microservice boom, and then it was too lazy to cut it and it was inexpedient). <br><br>  1. <code>npx wtfwith moduleName</code> (for example, <code>npm wtfwith lodash</code> ) - check the number of occurrences of a particular module, displays the results, if there are more than two.  The result can be, for example, like this: <br><br><div class="spoiler">  <b class="spoiler_title">example</b> <div class="spoiler_text"> <code>npx wtfwith lodash <br> npx: installed 3 in 2.047s <br> Searching for lodash <br> Checking path /web/xxx/package-lock.json <br> Huston, we have a problem: <br> <br> 30 versions of lodash: <br> - 2.4.2 from root, cheerio@0.18.0 <br> - 3.10.1 from xmlbuilder@2.6.4 <br> - 4.0.0 from twilio@3.15.0 <br> - 4.17.4 from graphlib@2.1.1, sway@1.0.0 <br> - 4.17.5 from aws-sdk@2.211.0, xmlbuilder@4.2.1, request-promise-core@1.1.1, requestretry@1.13.0 <br> - lodash.assign:4.2.0 from ioredis@3.2.2 <br> - lodash.bind:4.2.1 from ioredis@3.2.2 <br> - lodash.clone:4.5.0 from ioredis@3.2.2 <br> - lodash.clonedeep:4.5.0 from ioredis@3.2.2 <br> - lodash.defaults:4.2.0 from ioredis@3.2.2 <br> - lodash.difference:4.5.0 from ioredis@3.2.2 <br> - lodash.flatten:4.4.0 from ioredis@3.2.2 <br> - lodash.foreach:4.5.0 from ioredis@3.2.2 <br> - lodash.get:4.4.2 from z-schema@3.18.4 <br> - lodash.includes:4.3.0 from jsonwebtoken@8.2.1 <br> - lodash.isboolean:3.0.3 from jsonwebtoken@8.2.1 <br> - lodash.isempty:4.4.0 from ioredis@3.2.2 <br> - lodash.isequal:4.5.0 from z-schema@3.18.4 <br> - lodash.isinteger:4.0.4 from jsonwebtoken@8.2.1 <br> - lodash.isnumber:3.0.3 from jsonwebtoken@8.2.1 <br> - lodash.isplainobject:4.0.6 from jsonwebtoken@8.2.1 <br> - lodash.isstring:4.0.1 from jsonwebtoken@8.2.1 <br> - lodash.keys:4.2.0 from ioredis@3.2.2 <br> - lodash.noop:3.0.1 from ioredis@3.2.2 <br> - lodash.once:4.1.1 from jsonwebtoken@8.2.1 <br> - lodash.partial:4.2.1 from ioredis@3.2.2 <br> - lodash.pick:4.4.0 from ioredis@3.2.2 <br> - lodash.sample:4.2.1 from ioredis@3.2.2 <br> - lodash.shuffle:4.2.0 from ioredis@3.2.2 <br> - lodash.values:4.3.0 from ioredis@3.2.2 <br> <br> Advice: Sometimes it is good to make a fresh start: rm ./ -rf &amp;&amp; git commit -am 'nevermore' &amp;&amp; git push origin master</code> <br> </div></div><br>  2. <code>npx wtfwith everything</code> (you can simply omit the argument and write ‚Äúnpx wtfwith‚Äù, but this is depressing) - it generally checks all dependencies, of which there are more than two versions.  Maybe, for example, this result: <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"> <code>npx wtfwith lodash <br> npx: installed 3 in 1.813s <br> Searching all strange things... <br> Checking path /web/xxx/package-lock.json <br> Huston, we have a problem: <br> <br> 30 versions of lodash: <br> // ,     <br> <br> 4 versions of punycode: <br> - 1.2.4 from dkim-signer@0.1.2 <br> - 1.3.2 from url@0.10.3 <br> - 1.4.1 from tough-cookie@2.3.3 <br> - 2.1.0 from uri-js@3.0.2 <br> <br> 4 versions of xmlbuilder: <br> - 0.4.2 from nodemailer@0.7.1, aws-sdk@2.0.5 <br> - 2.6.4 from root, xml2js@0.4.8 <br> - 4.2.1 from aws-sdk@2.211.0, xml2js@0.4.17 <br> - 9.0.1 from twilio@3.15.0 <br> <br> 3 versions of xmldom: <br> - 0.1.19 from xml-crypto@0.10.1 <br> - 0.1.27 from pdf2json@0.6.2 <br> - 0.1.7 from ws.js@2.0.22 <br> <br> 3 versions of mime: <br> - 1.2.11 from mailcomposer@0.2.12 <br> - 1.4.1 from superagent@3.8.0 <br> - 2.3.1 from root <br> <br> 3 versions of sax: <br> - 0.4.2 from xml2js@0.2.6 <br> - 0.6.1 from xml2js@0.4.8 <br> - 1.2.1 from aws-sdk@2.211.0, xml2js@0.4.17 <br> <br> 3 versions of uuid: <br> - 1.4.2 from root <br> - 3.1.0 from aws-sdk@2.211.0 <br> - 3.2.1 from request@2.83.0, request@2.85.0, requestretry@1.13.0, twilio@3.15.0 <br> <br> 3 versions of xml2js: <br> - 0.2.6 from nodemailer@0.7.1, aws-sdk@2.0.5 <br> - 0.4.17 from aws-sdk@2.211.0 <br> - 0.4.8 from root <br> <br> 3 versions of moment: <br> - 2.19.3 from twilio@3.15.0 <br> - 2.20.1 from moment-timezone@0.5.14 <br> - 2.22.1 from root, joi@4.9.0, moment-range@1.0.9, moment-timezone@0.4.0, moment-timezone@0.5.15 <br> <br> 3 versions of readable-stream: <br> - 1.0.34 from match-stream@0.0.2, pullstream@0.4.1, slice-stream@1.0.0, unzip@0.1.11 <br> - 1.1.14 from dicer@0.2.5, ftp@0.3.10, htmlparser2@3.8.3, nodemailer@0.7.1 <br> - 2.3.3 from mysql@2.14.1, superagent@3.8.0 <br> <br> Advice: What about lunch? <br> <br></code> <br></div></div><br>  3. You can also specify the option <code>--dev</code> - if you, for example, collect a bundle of dependency <code>--dev</code> .  Although for this it is better to use front-line tools for analyzing bundles.  I will not show an example of use, the command looks like <code>npx wtfwith everything --dev</code> , and you can imagine what the hell is coming out of. <br><br><h2>  Real examples </h2><br>  Of course, it would be interesting to analyze several popular packages, which I did. <br><br>  1. <b>express</b> - surprisingly, nothing interesting was found. <br><br>  2. <b>gulp</b> - there were all sorts of little things: <br><br><div class="spoiler">  <b class="spoiler_title">look?</b> <div class="spoiler_text"> <code>4 versions of kind-of: <br> - 3.2.2 from is-accessor-descriptor@0.1.6, is-data-descriptor@0.1.4, is-number@3.0.0, make-iterator@1.0.0, object-copy@0.1.0, snapdragon-util@3.0.1, to-object-path@0.3.0 <br> - 4.0.0 from has-values@1.0.0 <br> - 5.1.0 from array-sort@1.0.0, class-utils@0.3.6, is-descriptor@0.1.6, default-compare@1.0.0, expand-brackets@2.1.4, snapdragon@0.8.2, static-extend@0.1.2 <br> - 6.0.2 from braces@2.3.1, is-accessor-descriptor@1.0.0, is-data-descriptor@1.0.0, is-descriptor@1.0.2, micromatch@3.1.10, nanomatch@1.2.9, use@3.1.0 <br> <br> 3 versions of define-property: <br> - 0.2.5 from class-utils@0.3.6, expand-brackets@2.1.4, object-copy@0.1.0, snapdragon@0.8.2, static-extend@0.1.2 <br> - 1.0.0 from base@0.11.2, braces@2.3.1, extglob@2.0.4, snapdragon-node@2.1.1 <br> - 2.0.2 from micromatch@3.1.10, nanomatch@1.2.9, to-regex@3.0.2</code> <br> </div></div><br><br>  3. <b>npm</b> is a pretty funny result: <br><div class="spoiler">  <b class="spoiler_title">look!</b> <div class="spoiler_text"> <code>14 versions of lodash: <br> - 3.10.1 from cli-table2@0.2.0 <br> - lodash._baseindexof:3.1.0 from root <br> - lodash._baseuniq:4.6.0 from root <br> - lodash._bindcallback:3.0.1 from root <br> - lodash._cacheindexof:3.0.2 from root <br> - lodash._createcache:3.1.2 from root <br> - lodash._createset:4.0.3 from lodash._baseuniq@4.6.0 <br> - lodash._getnative:3.9.1 from root, lodash._createcache@3.1.2 <br> - lodash._root:3.0.1 from lodash._baseuniq@4.6.0 <br> - lodash.clonedeep:4.5.0 from root <br> - lodash.restparam:3.6.1 from root <br> - lodash.union:4.6.0 from root <br> - lodash.uniq:4.5.0 from root <br> - lodash.without:4.4.0 from root <br> <br> 3 versions of mississippi: <br> - 1.3.1 from make-fetch-happen@2.6.0 <br> - 2.0.0 from cacache@10.0.4 <br> - 3.0.0 from root, pacote@7.6.1 <br> <br> 3 versions of pump: <br> - 1.0.3 from mississippi@1.3.1 <br> - 2.0.1 from mississippi@2.0.0, pumpify@1.4.0 <br> - 3.0.0 from mississippi@3.0.0</code> <br> </div></div><br>  At the very least, it‚Äôs funny that npm is obviously trying to minimize the use of lodash, but one of its dependencies is dragging it all down ... <br><br><h2>  Todo </h2><br>  The project was written in the evening on the knee, so there are some number of things that are not implemented there: <br><br>  1. There is no work with the shrinkwrap file - but this is not very necessary, you can simply generate a package-lock for verification; <br>  2. Only node 6+ is supported.  Also not very critical, because there is nvm; <br>  3. Lock file from yarn is not supported.  Again, not too critical; <br>  4. Surely there are a number of bugs and inaccuracies. <br><br>  In general, if the tool is relevant to you, then pull requests are welcome. <br><br><h2>  findings </h2><br>  The results do not look very nice, but, honestly, I expected more hell.  Apparently, many still use tools for analyzing updates and dependency protection. <br><br>  From controversial recommendations: <br><br>  1. I would not recommend for knowingly backing modules to tighten dependencies like lodash with chunks - anyway, someone will surely pull the full version of the library to itself.  Well, don't forget about semantic versioning - of course, without exact version restrictions everything can break at some point, but this should be solved by fixing dependencies in package-lock and interaction between developers, and not exact restrictions.  That is, if you find yourself breaking a change in some kind of addiction, then it would be good to go to the author of the package and say that he is wrong - this will save others a lot of effort and terabytes of disk space. <br><br>  Although the author of ioredis respected by me does <a href="https://github.com/luin/ioredis/pull/494">exactly the opposite</a> . <br><br>  2. It is necessary to periodically run over your dependencies and look at what is suspicious in them, and then unsubscribe issues or make pull requests to problem modules. <br><br>  If you are close to the problem of updating dependencies, then finally I can advise a few useful tools: <br><br>  1. <a href="https://www.npmjs.com/package/npm-check-updates">npm-check-updates</a> - we quickly see updates for package versions, quickly install them.  Just be careful! <br>  2. <a href="https://www.npmjs.com/package/snyk">snyk</a> - check security packages, about him I wrote a <a href="https://habrahabr.ru/post/347934/">little earlier</a> . <br>  3. <a href="https://www.npmjs.com/package/nsp">node security project</a> is another dependency security tool that can be considered native to the ecosystem because it was recently acquired by npm. <br>  4. In case you are working with the front, then you probably use something like webpack-bundle-analyzer, which will tell you what exactly you got as a result.  But I do not work with the front, so I cannot give any intelligible recommendations here. <br>  5. It is also useful to have all sorts of badges and CI integration, which you will visually show and notify if something is outdated or has become unsafe.  I will not give examples of badges, there are plenty of them, and you can look at a <a href="https://shields.io/">part of shields.io</a> .  There are a lot of integrations too, and if you have a opensource project, then travis-ci can run almost any checks. <br><br>  Periodically, such posts appear, but time passes ‚Äî so tell us what useful checks and tools you use in your projects now. </div><p>Source: <a href="https://habr.com/ru/post/353912/">https://habr.com/ru/post/353912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353902/index.html">Newman and Continuous Integration on the example of Atlassian Bamboo. The invention of the bicycle</a></li>
<li><a href="../353904/index.html">Pedro Uria: "The problem for information security will not be malware, but hackers"</a></li>
<li><a href="../353906/index.html">CIO or how to build an IT department of the organization</a></li>
<li><a href="../353908/index.html">7 days left to influence the Highload ++ Siberia program</a></li>
<li><a href="../353910/index.html">Professional or life skills: what is more important in the IT industry today and in the future (survey results)</a></li>
<li><a href="../353914/index.html">Sometimes the answer is not "42"</a></li>
<li><a href="../353916/index.html">Features of games that had to be abandoned - developer analysis</a></li>
<li><a href="../353918/index.html">Concept: logo for Yekaterinburg from "Log machines"</a></li>
<li><a href="../353920/index.html">Fight for a smooth display in the video surveillance system: find jerks and neutralize</a></li>
<li><a href="../353924/index.html">9 Tips to Improve React Application Code Quality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>