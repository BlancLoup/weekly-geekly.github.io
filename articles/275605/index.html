<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenShift: some gear internals</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Little high 
 Gear is the ‚Äúengine‚Äù of Openshift, the actual execution environment of your application. With free registration immediately give three. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenShift: some gear internals</h1><div class="post__text post__text-html js-mediator-article"><h2>  Little high </h2><br>  Gear is the ‚Äúengine‚Äù of Openshift, the actual execution environment of your application.  With free registration immediately give three.  In fact, the device can not know anything.  But it is harmful. <br><br>  1. There is a certain directory structure.  ~ / App-root is reserved for your application. <br><br>  type ls 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> build-dependencies -&gt; runtime / build-dependencies
 data
 dependencies -&gt; runtime / dependencies
 logs
 repo -&gt; runtime / repo
 runtime
</pre><br>  Strictly speaking, data and repo are interesting.  The fun part is that the three directories are links to the runtime subdirectories, and the runtime / data links to data in the current directory.  runtime / .state contains the current state of the gear: a: started, idle, deploing. <br><br>  2. All addresses, passwords, directories, etc. are contained in the environment variables, and then work is to be done with them.  Details of the variables are described <a href="https://developers.openshift.com/en/managing-environment-variables.html">here</a> . <br><br><h2>  Now closer to the ground </h2><a name="habracut"></a><br>  In general, there are two main options for installing applications. <br><br>  1. For development.  In this case, the contents of your repository and the contents of the ~ app-root / repo directory are the same.  You deploy the application at home, edit it, push it into the cloud and launch it there. <br>  (example below). <br><br>  2. If you are mainly involved in the operation of the application and you only need to have access to the configuration, the installation is done using scripts from ~ / myapp / .openshift / action_hooks / <br>  Several scripts pre_buld, build, deploy, post_deploy.  In general, you can write them on bash, perl, python, ruby, and so on. The task of these scripts: <br><br>  - deflate and unpack the application; <br>  - check the liveliness of the database; <br>  - connect configs; <br>  - impose patches, if necessary; <br><br>  In practice, half of the scripts do nothing.  Scripts you write yourself.  You and cards in hand.  Unlike the first case, the data is put in ~ / app-root / data, links are made to them, and you get empty directories when cloning (git does not tolerate emptiness, therefore there are stubs - .gitkeeper files - they are just content and work) . <br><br>  3. Actually the ability to adjust what exactly you will rule.  and that "it works that way" is great convenience. <br><br>  But let's look at the practice. <br><br><h2>  For example </h2><br>  For example, take LAMP.  LAMP itself on PaaS OpenSift is already at its best.  I chose vTigerCRM (SalesPlatform).  What is the difference between such applications?  After deployment, the configuration scripts are run, which interactively ask for the settings for connecting to the database and other parameters.  But we remember that OpenShift operates with environment variables, that is, the application must receive the values ‚Äã‚Äãof these variables, whatever it wants.  Plus, you need to give the necessary parameters php.  Access to the head php.ini is not, it remains. Htaccess. <br><br>  So we create LAMP (for option 1). <br><br><pre><code class="plaintext hljs">$ rhc app create spddevel php-5.3 mysql-5.5 clone  ,  $ cd spdevel</code> </pre> <br>  There is already a repository here, so: <br><br><pre> <code class="plaintext hljs">rm index.php git add . git commit -m "remove original index.php" $ wget http://downloads.sourceforge.net/project/salesplatform/salesplatform-vtigercrm-6.4.0-201512.tar.gz $ tar --strip-components=1 xf sales-platform-vtigercrm-6.4.0-201512.tar.gz -C ~/spdevel rm salesplatform-vtigercrm-6.4.0-201512.tar.gz</code> </pre><br>  Now in our repository folder is a fully expanded directory.  It remains to do two things.  Put a patch to replace the original input of parameters from the keyboard with openshift variables. <br><br>  Actually patch: <br><br><pre> <code class="plaintext hljs">--- Index.php 2015-12-23 15:44:07.000000000 +0300 +++ Index.php.new 2016-01-13 09:00:18.272322263 +0300 @@ -98,11 +98,11 @@ $timeZone = new UserTimeZones(); $viewer-&gt;assign('TIMEZONES', $timeZone-&gt;userTimeZones()); - $defaultParameters = Install_Utils_Model::getDefaultPreInstallParameters(); - $viewer-&gt;assign('DB_HOSTNAME', $defaultParameters['db_hostname']); - $viewer-&gt;assign('DB_USERNAME', $defaultParameters['db_username']); - $viewer-&gt;assign('DB_PASSWORD', $defaultParameters['db_password']); - $viewer-&gt;assign('DB_NAME', $defaultParameters['db_name']); + # $defaultParameters = Install_Utils_Model::getDefaultPreInstallParameters(); + $viewer-&gt;assign('DB_HOSTNAME', $_ENV['OPENSHIFT_MYSQL_DB_HOST']); + $viewer-&gt;assign('DB_USERNAME', $_ENV['OPENSHIFT_MYSQL_DB_USERNAME']); + $viewer-&gt;assign('DB_PASSWORD', $_ENV['OPENSHIFT_MYSQL_DB_PASSWORD']); + $viewer-&gt;assign('DB_NAME', $_ENV['OPENSHIFT_APP_NAME']); $viewer-&gt;assign('ADMIN_NAME', $defaultParameters['admin_name']); $viewer-&gt;assign('ADMIN_LASTNAME', $defaultParameters['admin_lastname']); $viewer-&gt;assign('ADMIN_PASSWORD', $defaultParameters['admin_password']);</code> </pre><br>  Save it to any file, say db.patch.  Further: <br><br><pre> <code class="plaintext hljs">$ patch modules/Install/views/Index.php db.patch</code> </pre><br>  Now we will drop the necessary parameters php. <br><br><pre> <code class="plaintext hljs">vi .htaccess Options -Indexes php_value date.timezone 'Europe/Moscow' php_value error_reporting 22519 php_value max_input_vars 100000 php_value max_execution_time 600 php_flag log_errors on php_flag display_errors off php_flag allow_call_time_pass_reference on $ git status $ git add . $ git commit -m "All ready to deploy" $ git push</code> </pre><br>  Everything.  We start our website spdevel-ourdomain.rhcloud.com. <br><br>  We reach the step 4 installation: <br><br><img src="https://habrastorage.org/files/cd9/b2a/865/cd9b2a865f32463885d239507200d4d0.png"><br><br>  It can be seen that the database parameters have already been entered.  Everything, we fill in the data on the administrator, further everything is trivial. <br><br>  The same thing in one step.  In your home directory: <br><br><pre> <code class="plaintext hljs">$ rhc app create spdevel php-5.3 mysql-5.5 --from-code=https://github.com/zirf0/openshift-salesplatform</code> </pre><br>  And you also get spdevel-ourdomain.rhcloud.com.  And the spdevel / directory. <br><br>  Option 2. There will not be wise, so the principle is clear. <br><br><pre> <code class="plaintext hljs">$ rhc app create sp php-5.3 mysql-5.5 --from-code=https://github.com/zirf0/openshift-salesplatform-example cd sp/ ls -al</code> </pre><br>  Modestly so, the application itself does not exist, it is there in ~ app-root / data / current (the subdirectory is added for convenience), <br><br>  Actually, what is the convenience of this option: <br><br><pre> .openshift /
 Action‚îÄ‚îÄ action_hooks
 ‚îÇ ‚îú‚îÄ‚îÄ build
 ‚îÇ ‚îú‚îÄ deploy
 Post ‚îú‚îÄ‚îÄ post_deploy
 ‚îÇ ‚îî‚îÄ‚îÄ pre_build
 Config‚îÄ‚îÄ config
 ‚îÇ ‚îú‚îÄ‚îÄ db_conf.patch
 ‚îÇ ‚îî‚îÄ‚îÄ .htaccess
 ...
</pre><br>  The scripts will be executed on the platform, the data can be placed in the config, that is, when working with the same database, the sql script can be placed in the config, WordPress 4 has the most necessary - plug-ins and themes are available, that is, this scheme is more convenient.  Actually in the contents of db_cong.patch and .htaccess above. <br><br><h2>  Summary </h2><br>  What is convenient PaaS (before IaaS) eliminates the developer from the work of the system administrator - no need to mess around with the setting.  Yes, with industrial deployment, sysadmin is a must.  It's one thing to read some written instructions, another is to understand how it works.  Let everyone do their own thing. </div><p>Source: <a href="https://habr.com/ru/post/275605/">https://habr.com/ru/post/275605/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275593/index.html">Rust 1.6 Preview</a></li>
<li><a href="../275595/index.html">Linux in your pocket - in the service of the photographer</a></li>
<li><a href="../275599/index.html">Entity vs Value Object: full list of differences</a></li>
<li><a href="../275601/index.html">Engineer's opinion: Why not use Docker anytime and anywhere</a></li>
<li><a href="../275603/index.html">Selection: 40+ useful tools, resources and research on working with email</a></li>
<li><a href="../275607/index.html">Entity Framework in WinForms. Part 1</a></li>
<li><a href="../275609/index.html">Efficient index management in Azure SQL Database using Index Advisor</a></li>
<li><a href="../275611/index.html">How I Fought Death Screens on Legacy Blade Servers</a></li>
<li><a href="../275613/index.html">Digital sound: DSD vs PCM</a></li>
<li><a href="../275615/index.html">Desktop JavaScript applications. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>