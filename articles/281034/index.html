<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zenity in the service of a system administrator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Somehow one company decided to switch to free software. And they downloaded Linux to all computers, and they set up a server with overseas disks, and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zenity in the service of a system administrator</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  Somehow one company decided to switch to free software.  And they downloaded Linux to all computers, and they set up a server with overseas disks, and made user accounts.  And he ordered the head to all employees set themselves intricate passwords.  And even though they listened to stories about what kind of beast is in front of them, they don‚Äôt know where to change the password.  Or they cannot be found in the settings.  And run from the console headlong.  And they begin to run to the admin with the words "admin admin, help me find a button," and the admin begins to run and be nervous, distracted from important thoughts ... </blockquote><br>  It is no secret that for many users (especially those not directly connected with IT), the transition to a new operating system and software is often painful.  And this is largely due to habits.  People remember what is on their computer and, if you rearrange everything, they are lost.  As a result, many simple actions can cause difficulties, such as loss of time and nerves. <br><br>  An idea emerged: what if, for a task that requires immediate user intervention (such as changing the password from the epic above) who is not yet familiar with the system interface, he will obviously be given a window with the ability to solve this problem?  In search of a simple solution, I stumbled upon <a href="https://help.gnome.org/users/zenity/stable/">zenity</a> . <a name="habracut"></a>  This is a small utility that allows you to display dialog boxes.  It uses GTK + and, as it turned out, in most popular Linux distributions comes bundled.  In addition to this, it can be used directly in scripts on BASH, which makes it possible to quickly create a script ‚Äúon the lap‚Äù and start it from the user at a certain time.  Consider an example: <br><br><pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">change_password</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> passwords=$(zenity --forms --title=<span class="hljs-string"><span class="hljs-string">"Change your password"</span></span> \ --text=<span class="hljs-string"><span class="hljs-string">"Set new password (minimum length 8 characters)"</span></span> \ --separator=<span class="hljs-string"><span class="hljs-string">","</span></span> \ --add-password=<span class="hljs-string"><span class="hljs-string">"Your password"</span></span> \ --add-password=<span class="hljs-string"><span class="hljs-string">"Repeate password"</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> password1=$( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$passwords</span></span> | awk -F <span class="hljs-string"><span class="hljs-string">','</span></span> <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span> ) <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> password2=$( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$passwords</span></span> | awk -F <span class="hljs-string"><span class="hljs-string">','</span></span> <span class="hljs-string"><span class="hljs-string">'{print $2}'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$password1</span></span> == <span class="hljs-variable"><span class="hljs-variable">$password2</span></span> ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">${#password1}</span></span> == 0 ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> zenity --warning --text <span class="hljs-string"><span class="hljs-string">"Please, select Your password"</span></span> change_password <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">${#password1}</span></span> &lt; 8 ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> zenity --warning --text <span class="hljs-string"><span class="hljs-string">"Your password too easy."</span></span> change_password <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> username=$(whoami) <span class="hljs-comment"><span class="hljs-comment">#     #    Ctrl+C - Ctrl+V      #echo "$username:$password1" | chpasswd local expire_time=$(chage -l $username | awk 'FNR==2{print $4}') local full_name=$(cat /etc/passwd | grep "^$username" \ | awk -F ':' '{print $5}' | awk -F ',' '{print $1}') zenity --info --text "$full_name, Your password has been changed. Your new password expires: $expire_time" else zenity --warning --text "Passwords does not match" change_password return fi } change_password</span></span></code> </pre> <br>  As a result, we get a window with a form for the password, which ‚Äúwill seem‚Äù by itself, <s>probably using the at utility or its equivalent to the</s> user, and he will only have to enter his new password, saving time for him and the administrator.  It looks like this (using the standard design of windows from your system): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/85d/acd/7aa/85dacd7aa83a42c4b2e9877aa0875c16.png" alt="image"><br><br>  Zenity not only shows the window, but also outputs to the standard output what the user did in the window.  In our case, he filled out two fields in the form.  We need to capture this very conclusion.  Thus, we can get the values ‚Äã‚Äãof all fields from the dialog box in one line through the separator - by default, the symbol "|", in the example, we replace it with a comma.  The assignment of zenity parameters speak for themselves, especially if you immediately look at the result. <br><br><pre> <code class="bash hljs">passwords=$(zenity --forms --title=<span class="hljs-string"><span class="hljs-string">"Change your password"</span></span> \ --text=<span class="hljs-string"><span class="hljs-string">"Set new password (minimum length 8 characters)"</span></span> \ --separator=<span class="hljs-string"><span class="hljs-string">","</span></span> \ --add-password=<span class="hljs-string"><span class="hljs-string">"Your password"</span></span> \ --add-password=<span class="hljs-string"><span class="hljs-string">"Repeate password"</span></span>)</code> </pre><br>  Then we just have to process the received data (checking for a length of less than 8 characters for the password is for example, never do that!), And inform the user about the results.  For this, windows with messages that are created even easier than with forms turned out to be very helpful: <br><br><pre> <code class="bash hljs">zenity --warning --text <span class="hljs-string"><span class="hljs-string">"Your password too easy."</span></span> --width=300</code> </pre><br><img src="https://habrastorage.org/files/fc1/eb8/023/fc1eb80235c64a0daa7274934de5b9be.png" alt="image"><br><br>  In conclusion, we can reassure the user with the help of another message, already referring to him by name: <br><br><pre> <code class="bash hljs">username=$(whoami) expire_time=$(chage -l <span class="hljs-variable"><span class="hljs-variable">$username</span></span> | awk <span class="hljs-string"><span class="hljs-string">'FNR==2{print $4}'</span></span>) full_name=$(cat /etc/passwd | grep <span class="hljs-string"><span class="hljs-string">"^</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$username</span></span></span><span class="hljs-string">"</span></span> \ | awk -F <span class="hljs-string"><span class="hljs-string">':'</span></span> <span class="hljs-string"><span class="hljs-string">'{print $5}'</span></span> | awk -F <span class="hljs-string"><span class="hljs-string">','</span></span> <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>) zenity --info --width=400 --text <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$full_name</span></span></span><span class="hljs-string">, Your password has been changed. Your new password expires: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$expire_time</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><img src="https://habrastorage.org/files/004/499/da8/004499da846b42488b409a24dc223eb8.png" alt="image"><br><br>  Alternatively, standard notifications can be used: <br><br><pre> <code class="bash hljs">zenity --notification --window-icon=<span class="hljs-string"><span class="hljs-string">"info"</span></span> \ --text=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$full_name</span></span></span><span class="hljs-string">, Your password has been changed. Your new password expires: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$expire_time</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><img src="https://habrastorage.org/files/019/f2c/5f5/019f2c5f58e940258ede720066c22553.png" alt="image"><br><br>  <b>WARNING</b> !  In older versions of the zenity package, there is a <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi%3Fbug%3D612683">bug</a> that prevents the process creating the notification window from completing.  This is solved by adding a non-zero timeout: <br><br><pre> <code class="bash hljs">zenity --notification --window-icon=<span class="hljs-string"><span class="hljs-string">"info"</span></span> --text=<span class="hljs-string"><span class="hljs-string">"..."</span></span> --timeout=1</code> </pre><br>  The idea of ‚Äã‚Äãusing such windows was well received and soon the thought arose of asking the user to evaluate the performance of their computer on a five-point scale.  This is generally a very useful activity - it allows you to track the rate of increase of satisfied people and to highlight those who have the most difficulties in mastering the new environment, and, accordingly, take measures to eliminate difficulties.  In its simplest form, it looked like this: <br><br><pre> <code class="bash hljs">mark=$(zenity --scale \ --text <span class="hljs-string"><span class="hljs-string">"Rate your experience"</span></span> \ --value=3 \ --min-value=1\ --max-value=5 \ --step=1) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ $? == 0 ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> zenity --notification --window-icon=<span class="hljs-string"><span class="hljs-string">"info"</span></span> --text=<span class="hljs-string"><span class="hljs-string">"Thank You!"</span></span> --timeout=1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>  The names of the options are intuitive and do not require explanation. <br><br><img src="https://habrastorage.org/files/4e7/49a/59d/4e749a59dbab4e6cad2b9bc1b144825a.png" alt="image"><br><br>  Unfortunately, zenity does not know how to replace such a scale with asterisks (it is believed that asterisks are more intuitive), but soon there was an analogue with a list: <br><br><pre> <code class="bash hljs">zenity --list --text=<span class="hljs-string"><span class="hljs-string">"What do you think about your PC?"</span></span> \ --radiolist --column <span class="hljs-string"><span class="hljs-string">"Pick"</span></span> --column <span class="hljs-string"><span class="hljs-string">"Opinion"</span></span> \ TRUE <span class="hljs-string"><span class="hljs-string">"All is good"</span></span> \ FALSE <span class="hljs-string"><span class="hljs-string">"All is good, but..."</span></span> \ FALSE <span class="hljs-string"><span class="hljs-string">"I don't know"</span></span> \ FALSE <span class="hljs-string"><span class="hljs-string">"Too dificult to use it"</span></span> \ FALSE <span class="hljs-string"><span class="hljs-string">"AAA \(O_O)/ AAA"</span></span> \ --height=350</code> </pre><br><img src="https://habrastorage.org/files/20a/386/7a1/20a3867a1d68484e8974f88cce0aca25.png" alt="image"><br><br>  Using cron ªa, you can run and watch the results once a day.  It remains only to solve the problem of transferring the collected data to the server.  It seems to be a good idea to introduce a monitoring system that already has an agent on each computer as part of the experiment - and draw graphs for user surveys. <br><br>  Despite the fact that the examples in this article are clearly not the most relevant, I hope that they will guide someone to interesting thoughts about the use of graphical interfaces in small scripts to communicate with users.  Perhaps it will be important messages for all workers (in the spirit of the wall team, only with a window), notifications about the beginning of the lunch break <s>or a vote about the place of the corporate party</s> .  I would also like to note that if you know ready-made software solutions for such tasks, you can share them in the comments, and my scripts ‚Äúon the knee‚Äù are nothing more than an interesting experiment that can later grow into something more. <br><br>  In conclusion, once again I provide a link to the zenity manual: <a href="https://help.gnome.org/users/zenity/stable/">https://help.gnome.org/users/zenity/stable/</a> </div><p>Source: <a href="https://habr.com/ru/post/281034/">https://habr.com/ru/post/281034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281022/index.html">A couple of words about cloud computing ecology</a></li>
<li><a href="../281024/index.html">How we implemented DevOps: continuous integration with GitHub and the Visual Studio Team Services build system</a></li>
<li><a href="../281026/index.html">Java 8 lambdas are closures?</a></li>
<li><a href="../281028/index.html">Azure-IaaS-Digest number 4 (March-April)</a></li>
<li><a href="../281032/index.html">ServerSide section on DUMP-2016</a></li>
<li><a href="../281036/index.html">Explaining the inexplicable. Part 4</a></li>
<li><a href="../281038/index.html">Intel RealSense Smartphone Developer Kit: Details</a></li>
<li><a href="../281040/index.html">Python production calendar</a></li>
<li><a href="../281042/index.html">Hacking Team deprived of the license to export their cyber services</a></li>
<li><a href="../281044/index.html">Plugin for Redmine: redmine_chat_telegram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>