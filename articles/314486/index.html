<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How enum is available for everyone to do, but write to the meta-type</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Preamble 
 In the process of software development, I had to define enum enumerators in a centralized header file, whereas their use could be in many s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How enum is available for everyone to do, but write to the meta-type</h1><div class="post__text post__text-html js-mediator-article"><h3>  Preamble </h3><br>  In the process of software development, I had to define enum enumerators in a centralized header file, whereas their use could be in many source files.  This is very convenient from the point of view of source organization and dependencies.  However, my tasks also required enumeration registration in the Qt metatypes system.  About how I did such a registration and will be discussed. <br><br><h3>  Qt Interview </h3><br>  - I need you to understand my <b>enum</b> . <a name="habracut"></a><br><blockquote>  <i>- To declare enum as a meta type for <b>QVariant,</b> <b>Q_DECLARE_METATYPE () is</b> suitable.</i>  <i>Macros should be called immediately after the <b>enum</b> declaration.</i> </blockquote>  - Well!  And if I want to throw my <b>enum</b> from signals to slots, but shove properties? <br><blockquote>  <i>- To register <b>enum</b> in the meta-type system, <b>qRegisterMetaType &lt;T&gt; () is</b> required.</i>  <i>Please note this is a feature.</i>  <i>It must be called somewhere.</i>  <i>Preferably, before any flinging and shoving.</i>  <i>In <b>main ()</b> , for example.</i>  <i>And, yes, without <b>Q_DECLARE_METATYPE ()</b> nothing happens.</i> </blockquote>  - Hmm ... This is not convenient.  I want the whole registration to be limited to one place in the source ... <br><blockquote>  <i>- What didn't you say right away ?!</i>  <i>Use <b>Q_ENUM ()</b> !</i>  <i>This wonderful macro will do everything for you!</i>  <i>And even more!</i>  <i>He will register the conversion from your <b>enum</b> to a <b>QString</b> for <b>QVariant</b> !</i>  <i>You just need to call the macro immediately after the <b>enum</b> declaration inside the class definition inherited from <b>QObject</b> ...</i> </blockquote>  - Wait, what?  Need to do this in the classroom? .. And I wanted it globally and for everyone ... <br><br><h3>  Opportunities </h3><br><ol><li>  If it's enough for us to simply store instances of our <b>enum</b> in <b>QVariant</b> , then we need the <b>Q_DECLARE_METATYPE ()</b> macro.  You can transfer the value through signal slots, you can store it in properties in <b>int</b> , and, if necessary, you can bring it explicitly to our <b>enum</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  If it is very important for us to distinguish just <b>int</b> from our <b>enum</b> , or we want to have a pack of <b>invokable</b> methods with the same name, but a difference in the type of the argument, then we can‚Äôt do without additional registration in the system of meta-types.  You can do this by calling <b>qRegisterMetaType &lt;T&gt; ()</b> somewhere before actual use. <br><br></li><li>  Well, if enum is part of some <b>QObject</b> class, then everything is decided by <b>Q_ENUM ()</b> , then you can do anything with it.  Even use properties or parameters of a slot in another class as a full type name ( <b>ClassName :: EnumName</b> ). </li></ol><br><h3>  Decision </h3><br>  My target task, formulated earlier, required full registration in the meta-type system.  The last two possibilities suited me.  At opportunity number 2, there is a drawback in having to register <b>enum by</b> explicitly calling a function somewhere in the code.  Possibility number 3 lacks the potential complication of source dependencies if you place the <b>enum</b> inside one of the existing classes that work with it. <br>  But no one bothers us to create a new <b>QObject-</b> class!  In general, for all the header file.  And you can disable instantiation of this class.  I will give an example (and for a warm-up, there is also a small example of the capabilities of the c ++ 11 standard): <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">///    class Enums : public QObject { public: ///   std=++11, 'class'       EnumA, ':int'     int enum class EnumA: int { A, B, C, }; Q_ENUM(EnumA) enum EnumB { A,///&lt;   EnumA::A  , EnumA::A    A,    EnumB::A D, }; Q_ENUM(EnumB) Q_OBJECT Enums() = delete; ///&lt; std=c++11,       Enums };</span></span></code> </pre> <br>  As a result, we have the <b>Enums</b> class available to everyone, having the necessary <b>enum</b> , known to the system of meta-types, and not having the ability to create instances of itself! <br><br>  However, it has some drawbacks.  The macro <b>Q_OBJECT</b> creates, besides a static meta-object, a bundle of never static functions.  And our class will never be created!  And these functions will never be needed.  Alas, this is some waste inevitable.  However, starting with Qt 5.5, the <b>Q_GADGET</b> macro is described in the documentation. <blockquote>  <i>Yes, yes, it is easier than <b>Q_OBJECT</b> , and does not require inheritance from <b>QObject</b> .</i>  <i>Allows <b>Q_ENUM</b> , <b>Q_PROPERTY</b> , <b>Q_INVOKABLE only</b> .</i>  <i>And for a long time he already exists, we just were silent about him!</i> </blockquote><br>  Indeed, why were you silent!  This is where it will perfectly suit us!  Just a couple of changes, and the pants turn into ... <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">///    class Enums { /// &lt;  ,  Enums    ! public: ///   std=++11, 'class'       EnumA, ':int'     int enum class EnumA: int { A, B, C, }; Q_ENUM(EnumA) enum EnumB { A,///&lt;   EnumA::A  , EnumA::A    A,    EnumB::A D, }; Q_ENUM(EnumB) Q_GADGET ///&lt;   Q_OBJECT   ! Enums() = delete; ///&lt; std=c++11,       Enums };</span></span></code> </pre><br>  We really do not need the ability to declare properties and <b>invokable</b> methods.  But they are an integral part of the meta-objects, cut off will not work.  But now, if you compare the old and the new moc * .cpp to this header file, you can detect the loss of the implementation of static <b>qt_static_metacall ()</b> static and standard <b>metaObject ()</b> , <b>qt_metacast ()</b> , <b>qt_metacall ()</b> .  Trifle, but nice.  For the sake of curiosity, I compared the sizes of binaries, a trifle turned out to be 512 bytes (build Release). <br><br><h3>  Conclusion </h3><br>  It is quite easy to define <b>enum</b> in one header file, in the same place and throwing it into the system of meta-types, and then use it in other classes.  For example, I had a task to use such an enum in some of the basic logic of the system, while providing the opportunity to select the values ‚Äã‚Äãof this <b>enum</b> through the interface.  The additional <b>Q_ENUM</b> feature in the form of enum name registration allowed not to reinvent the wheel, but this is another story.  With models and patterns. </div><p>Source: <a href="https://habr.com/ru/post/314486/">https://habr.com/ru/post/314486/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314472/index.html">We encode music in the browser</a></li>
<li><a href="../314474/index.html">How I tried to enable http2 in my project with nginx</a></li>
<li><a href="../314476/index.html">Microsoft will provide antiviruses with the ability to monitor the activity of the Linux subsystem on Windows 10</a></li>
<li><a href="../314478/index.html">Transfer domain? Get ready for trouble</a></li>
<li><a href="../314484/index.html">Basics of computer networks. Subject number 5. The concept of IP addressing, subnet masks and their calculation</a></li>
<li><a href="../314490/index.html">Recommendations based on product images</a></li>
<li><a href="../314492/index.html">Problems with the image: image tag in site maps. Bypass misunderstanding Yandex validator</a></li>
<li><a href="../314494/index.html">Implementation of the performance indicator of queries, stored procedures and triggers in MS SQL Server. Autotrace</a></li>
<li><a href="../314496/index.html">How important is mathematical training in promising areas of software development</a></li>
<li><a href="../314500/index.html">Comparing objects by value - 2, or Features of the implementation of the Equals method</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>