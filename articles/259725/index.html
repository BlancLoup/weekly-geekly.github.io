<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vim in full: Plugin Manager without fatal flaws</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Table of contents 


1. Introduction (vim_lib) 
2. Plugin Manager without fatal flaws (vim_lib, vim_plugmanager) 
3. Project level and file system (vi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vim in full: Plugin Manager without fatal flaws</h1><div class="post__text post__text-html js-mediator-article"><h1>  Table of contents </h1><br><ol><li>  <a href="http://habrahabr.ru/post/259701/">Introduction</a> (vim_lib) </li><li>  <b>Plugin Manager without fatal flaws</b> (vim_lib, vim_plugmanager) </li><li>  <a href="http://habrahabr.ru/post/259995/">Project level and file system</a> (vim_prj, nerdtree) </li><li>  <a href="http://habrahabr.ru/post/260591/">Snippets and File Templates</a> (UltiSnips, vim_template) </li><li>  <a href="http://habrahabr.ru/post/261179/">Compiling and doing anything</a> (vim-quickrun) </li><li>  <a href="http://habrahabr.ru/post/261783/">Work with Git</a> (vim_git) </li><li>  <a href="http://habrahabr.ru/post/263487/">Deploy</a> (vim_deploy) </li><li>  <a href="http://habrahabr.ru/post/264297/">Testing with xUnit</a> (vim_unittest) </li><li>  <a href="http://habrahabr.ru/post/264351/">The library on which everything is kept</a> (vim_lib) </li><li>  Other useful plugins </li></ol><br>  I probably used all the popular plugin managers for Vim and I didn't have the slightest desire to write my own, as these were fine with me, but it was a little but about which I will cover in this article. <br><br><a name="habracut"></a><br><h1>  <s>Bad</s> Other Managers </h1><br>  How does the plugin manager for Vim work?  Everything is trivial.  During the start of the editor, the <i>.vimrc is</i> read in which all the currently used plugins are declared.  These names are concatenated with the address of the directory that the plugins should store and the resulting lines are added to the <i>runtimepath</i> - the Vim variable, which determines where the editor gets the start scripts, plugins and everything else. <br><br>  The main problem with most popular plugin managers for Vim is that they populate the <i>runtimepath</i> variable as <i>they</i> like.  What does this lead to?  The plugins are loaded randomly, there is no possibility to override the plugin settings for a specific project, the plugins override your own Vim settings, etc.  It is even more aggravated by the inability to control the order of loading plug-ins, when you first need to load plug-in A, and only then the blessing dependent on it B. In a word, pain. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  What we need ideally </h1><br>  I have already spoken before and will dwell on this issue in more detail in the next article, and now I will only touch it a little.  The structure proposed by me adds another level of initialization of the Vim editor.  This means that your Vim configurations and plugins will exist on three levels: <br><ol><li>  System ( <i>$ VIMRUNTIME /</i> ) - configurations and plugins that apply to all users of the system </li><li>  User ( <i>~ / .vim /</i> ) - configurations and plugins for a specific user </li><li>  Project ( <i>./.vim/</i> ) - configurations and plugins available only in this project.  This level is not in Vim, or rather, it is, but it is implemented rather weakly. </li></ol><br>  This will allow, for example, to customize templates for Java classes and then redefine them for a particular project.  You can also install some plugin only for a specific project, and this plugin will not load Vim in other projects, which will save memory and increase editor's performance (for example, you decided to start working with Lua and do not want to install plugins in <i>~ / .vim /</i> ).  Just imagine, one editor for all occasions and no lags. <br><br><h1>  Plug-in Standards </h1><br>  The vim_lib library defines both the structure of Vim plug-ins (but does not limit you to just this structure, any plug-in can be used) and the order in which they are connected and loaded, for this the <i>sys / Plugin</i> and <i>sys / Autoload</i> classes are implemented, respectively. <br><br>  If we implement the plugin in strict accordance with the requirements of the <i>sys / Plugin</i> class, we will get the following structure: <br><pre><code class="bash hljs">myPlugin/ plugin/ myPlugin.vim <span class="hljs-built_in"><span class="hljs-built_in">autoload</span></span>/ ... myPlugin.vim doc/ myPlugin.rux</code> </pre> <br>  The <i>plugin / myPlugin.vim file</i> contains the logic for initializing and connecting the plugin. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">" Date Create: 2015-02-23 22:45:56 "</span></span> Last Change: 2015-06-07 18:21:15 <span class="hljs-string"><span class="hljs-string">" Author: Artur Sh. Mamedbekov (Artur-Mamedbekov@yandex.ru) "</span></span> License: GNU GPL v3 (http://www.gnu.org/copyleft/gpl.html) <span class="hljs-string"><span class="hljs-string">"  use  VimLanguage let s:Plugin = vim_lib#sys#Plugin# let s:System = vim_lib#sys#System#.new() let s:p = s:Plugin.new('vim_write', '1') "</span></span>          <span class="hljs-string"><span class="hljs-string">"   "</span></span><span class="hljs-string"><span class="hljs-string">" {{{ "</span></span> @var bool          . <span class="hljs-string"><span class="hljs-string">""</span></span> }}} <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> s:p.preplace = 1 <span class="hljs-string"><span class="hljs-string">""</span></span> {{{ <span class="hljs-string"><span class="hljs-string">" @var bool     . "</span></span><span class="hljs-string"><span class="hljs-string">" }}} let s:p.aw = 0 "</span></span><span class="hljs-string"><span class="hljs-string">" {{{ "</span></span> @var string|array ,    ,      .      <span class="hljs-string"><span class="hljs-string">'all'</span></span>,      . <span class="hljs-string"><span class="hljs-string">""</span></span> }}} <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> s:p.awTypes = <span class="hljs-string"><span class="hljs-string">'all'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !exists(<span class="hljs-string"><span class="hljs-string">'g:vim_write#replacement'</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span> {{{ <span class="hljs-string"><span class="hljs-string">" @var hash  ,        .    : {: [regexp, ...]}.  'all'    . "</span></span><span class="hljs-string"><span class="hljs-string">" }}} let g:vim_write#replacement = {} endif "</span></span>   ,       <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>! s:p.run() <span class="hljs-string"><span class="hljs-string">" {{{ call s:System.au('BufWritePre,FileWritePre', function('vim_write#_writePre')) call s:System.au('CursorHold', function('vim_write#_autowrite')) endfunction "</span></span> }}} <span class="hljs-string"><span class="hljs-string">"    .    Plugins.. call s:p.menu('Aw_start', 'awstart', '1') call s:p.menu('Aw_stop', 'awstop', '2') "</span></span>    call s:p.comm(<span class="hljs-string"><span class="hljs-string">'VimWriteAwStart'</span></span>, <span class="hljs-string"><span class="hljs-string">'awstart()'</span></span>) call s:p.comm(<span class="hljs-string"><span class="hljs-string">'VimWriteAwStop'</span></span>, <span class="hljs-string"><span class="hljs-string">'awstop()'</span></span>) call s:p.reg() <span class="hljs-string"><span class="hljs-string">"  ,      </span></span></code> </pre><br></div></div><br>  The <i>autoload / myPlugin.vim file</i> contains plugin methods.  Experienced users of Vim will immediately notice that the main code of the plug-in will be loaded when it is first used, and not during the launch of the editor.  This is done through a global call to plugin methods.  For example, when executing the <i>VimWriteAwStart command</i> from the previous example, the <i>Plugin name</i> method <i># awstart ()</i> will be called. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">" Date Create: 2015-02-23 22:48:37 "</span></span> Last Change: 2015-06-07 18:21:15 <span class="hljs-string"><span class="hljs-string">" Author: Artur Sh. Mamedbekov (Artur-Mamedbekov@yandex.ru) "</span></span> License: GNU GPL v3 (http://www.gnu.org/copyleft/gpl.html) <span class="hljs-string"><span class="hljs-string">"  use  VimLanguage let s:Publisher = vim_lib#sys#Publisher#.new() let s:Content = vim_lib#sys#Content#.new() "</span></span><span class="hljs-string"><span class="hljs-string">" {{{ "</span></span>    . <span class="hljs-string"><span class="hljs-string">""</span></span> }}} <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>! vim_write<span class="hljs-comment"><span class="hljs-comment">#awstart() " {{{ let g:vim_write#.autowrite = 1 endfunction " }}} ...</span></span></code> </pre><br></div></div><br>  The <i>doc / myPlugin.rux file</i> contains plugin documentation. <br><br>  Why is all this necessary?  First, standardization.  Writing, changing and understanding plugins is easier.  Secondly, it's easier to turn them off. <br><br>  You can read more <a href="">here</a> . <br><br><h1>  Autoload </h1><br>  The library <i>sys / Authoload</i> class defines the initialization order of both the Vim editor itself and its plug-ins.  Initialization is performed in several stages: <br><ol><li>  Connecting the main editor configuration files ( <i>$ VIMRUNTIME</i> ) </li><li>  Connecting system-wide plugins ( <i>$ VIMRUNTIME / plugin /</i> ) </li><li>  Connecting file-dependent configurations ( <i>$ VIMRUNTIME / ftplugin /</i> ) </li><li>  Connecting the main user configuration files ( <i>~ / .vimrc</i> ) </li><li>  Connecting custom plugins ( <i>~ / .vim / plugin /</i> ) </li><li>  Connecting user-specific plug-ins ( <i>~ / .vim / ftplugin /</i> ) </li><li>  Connecting the main project configuration files ( <i>./.vimrc</i> ) </li><li>  Connecting project plugins ( <i>./.vim/plugin/</i> ) </li><li>  Connecting file-dependent project plugins ( <i>./.vim/ftplugin</i> ) </li></ol><br>  This is done using the <i>runtimepath</i> variable already familiar to us, but the order of loading plugins, their localization (system, user or project) is taken into account, and the mechanism for overriding configurations of both the editor and any plug-ins at each level is supported (the design level is the highest priority) . <br><br>  In general, the <i>sys / Authoload class</i> allows <i>you</i> to implement any hierarchy of nesting and priority configurations, not just a three-step, but I did not see the need to add new levels. <br><br>  To use the autoload offered by the <i>sys / Authoload class</i> , just add the following lines to your <i>.vimrc</i> file: <br><pre> <code class="bash hljs">filetype off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> rtp=~/.vim/bundle/vim_lib call vim_lib<span class="hljs-comment"><span class="hljs-comment">#sys#Autoload#init('~/.vim', 'bundle') "    ~/.vim/bundle Plugin 'vim_lib' "   filetype indent plugin on</span></span></code> </pre><br>  This can be done not only at the user level ( <i>~ / .vimrc</i> ), but also at the system <i>level</i> ( <i>$ VIMRUNTIME / .vimrc</i> ) or project level ( <i>./.vimrc</i> ), while the startup logic will be distributed only from this level and ‚Äúbelow‚Äù.  At all lower levels it is enough just to connect new plugins available only to this level: <br><pre> <code class="bash hljs">filetype off call vim_lib<span class="hljs-comment"><span class="hljs-comment">#sys#Autoload#init('.vim', 'bundle') "      Plugin 'myPlugin' filetype indent plugin on</span></span></code> </pre><br>  To disable the plugin, simply comment out the line <i>Plugin 'name'</i> . <br><br>  You can configure the plugin directly during its connection: <br><pre> <code class="bash hljs">Plugin <span class="hljs-string"><span class="hljs-string">'vim_deploy'</span></span>, { \ <span class="hljs-string"><span class="hljs-string">'options'</span></span>: {<span class="hljs-string"><span class="hljs-string">'adapter'</span></span>: <span class="hljs-string"><span class="hljs-string">'shipit'</span></span>}, <span class="hljs-string"><span class="hljs-string">"    \ 'map': {'deploy': '&lt;Leader&gt;d'}, "</span></span>    \}</code> </pre><br>  At lower levels, you can override these configurations: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">let</span></span> g:vim_deploy<span class="hljs-comment"><span class="hljs-comment">#options = {'adapter': 'gradle'}</span></span></code> </pre><br>  Everything is very flexible and convenient. <br><br><h1>  Plugin Manager </h1><br>  It would seem that what prevents other plug-in managers from installing plug-ins in the directories we need (system, user, or project)?  The problem here is that other managers do not just install third-party plug-ins, but also determine the order from initialization, but we don‚Äôt need it (already implemented by the library <i>sys / Authoload</i> class).  The same incompatibility problem Vim plug-ins, which I mentioned in the previous article.  I had to write my decision. <br><br>  <a href="https://github.com/Bashka/vim_plugmanager">vim_plugmanager</a> has a fairly simple interface and allows you to install plugins from GitHub into the system directory, user directory or project directory, depending on where you are currently. <br><div class="spoiler">  <b class="spoiler_title">Plugin list window</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/663/157/f84/663157f84eb844ba899daf9288057925.png"><br></div></div><br>  As can be seen in the figure, vim_plugmanager is implemented as a window in which it displays a list of currently installed plug-ins (installed and not connected) grouped by levels.  To add a new plug-in, just press the <i>a</i> key, and to delete, move the cursor over the plug-in and press <i>dd</i> (very familiar, isn't it?). <br><br>  After installing a new plug-in, you must connect it.  For this, as mentioned above, it is enough to add to the current <i>.vimrc</i> (current level) <i>Plugin</i> entry <i>'Plugin name'</i> .  This is necessary because the installation of the plug-in is copying it to the directory with plug-ins, and the connection adds it to <i>vimruntime</i> , after which it can be loaded by the editor. <br><br>  You can read more <a href="">here</a> . <br><br><h1>  Bye all </h1><br>  In this article, I have highlighted far from all the problems I encountered when using Vim plugins, as well as not all the features of the described solutions.  I don‚Äôt think it's worth copying the documentation when it is publicly available. <br><br>  Perhaps I could get by with the existing solutions, crossing them among themselves, but in this case there was a risk of spending much more time, and as a result I didn‚Äôt get what I needed. </div><p>Source: <a href="https://habr.com/ru/post/259725/">https://habr.com/ru/post/259725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259709/index.html">Port i2cdevlib on STM32 HAL</a></li>
<li><a href="../259717/index.html">Start using GTKD</a></li>
<li><a href="../259719/index.html">OS Development on Go + asm Part 0x00</a></li>
<li><a href="../259721/index.html">SIP phone from stm32f4-discovery</a></li>
<li><a href="../259723/index.html">How to create Pixel Perfect images in Adobe Illustrator</a></li>
<li><a href="../259727/index.html">Python and D</a></li>
<li><a href="../259729/index.html">SQL Server 2016 RC0</a></li>
<li><a href="../259737/index.html">Common Lisp IDE</a></li>
<li><a href="../259739/index.html">The digest of interesting materials for the mobile developer # 106 (June 1-7)</a></li>
<li><a href="../259745/index.html">Google expands its data centers in Asia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>