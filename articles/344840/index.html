<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tutorial on the Unreal Engine. Part 6: Animation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today it is rare to find a game without animation, because it is an important aspect of motion transmission. Without animation it will seem that the c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tutorial on the Unreal Engine. Part 6: Animation</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40f/33e/907/40f33e9078774c39e6c0e34f6c5040d1.png" alt="image"></div><br>  Today it is rare to find a game without animation, because it is an important aspect of motion transmission.  Without animation it will seem that the character is not running, but sliding. <br><br>  Fortunately, Unreal allows you to quickly and conveniently animate characters! <br><br>  In this part of the tutorial, you will learn the following: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Import Skeleton Mesh </li><li>  Import animations </li><li>  Create an animation blueprint for transitions between different animations. </li><li>  Perform smooth transitions animations </li></ul><a name="habracut"></a><br>  Please note that in this part we will use Blueprints.  If you need to refresh your knowledge, then read the article about <a href="https://habrahabr.ru/post/344446/">Blueprints</a> . <br><br>  <em>Note:</em> this post is one of the eight parts of the tutorial on the Unreal Engine: <br><br><ul><li>  <a href="https://habrahabr.ru/post/344394/">Part 1: Introduction to the engine</a> </li><li>  <a href="https://habrahabr.ru/post/344446/">Part 2: Blueprints</a> </li><li>  <a href="https://habrahabr.ru/post/344522/">Part 3: Materials</a> </li><li>  <a href="https://habrahabr.ru/post/344600/">Part 4: UI</a> </li><li>  <a href="https://habrahabr.ru/post/344690/">Part 5: How to create a simple game</a> </li><li>  Part 6: Animation </li><li>  <a href="https://habrahabr.ru/post/345018/">Part 7: Sound</a> </li><li>  <a href="https://habrahabr.ru/post/345110/">Part 8: Particle Systems</a> </li><li>  <a href="https://habrahabr.ru/post/346498/">Part 9: Artificial Intelligence</a> </li><li>  <a href="https://habrahabr.ru/post/347036/">Part 10: How to create a simple FPS</a> </li></ul><br><h2>  Getting Started </h2><br>  Download the <a href="">project blank</a> and unpack it.  In the root directory there is a folder <em>Animation Assets</em> .  This folder contains the character and animations that we will import. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cc/a79/683/3cca79683aa18c7636283c0145c2e365.jpg"></div><br>  Open the project by going to the project folder and running <em>SkywardMuffin.uproject</em> . <br><br>  <em>Note:</em> if a window opens indicating that the project was created in an earlier version of the Unreal editor, then everything is fine (the engine is often updated).  You can either choose the option to create a copy, or the option to convert the project itself. <br><br>  Click on <em>Play</em> to start the game.  The goal of the game is to touch as many clouds as possible without falling.  To jump to the first cloud, click the <em>left mouse button</em> . <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e8/9d3/939/3e89d3939a816a1ef3f70ffa2f5dcedf.gif"></div></div></div><br>  Instead of a simple red circle, let's control this cute muffin: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b80/5e2/141/b805e21417df00a57c654f9b4236498d.jpg"></div><br>  This muffin has a <em>skeleton</em> that allows us to animate it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/882/89b/199/88289b199ed57d9af91366a2b6537e24.jpg"></div><br><h2>  What is a skeleton? </h2><br>  In 3D editors, a skeleton is a set of interconnected points called <em>hinges</em> .  In the image below, each sphere is a hinge. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a99/ec6/8b6/a99ec68b6de30cf45c0b1c8cc7b26804.jpg"></div><br>  <em>Note:</em> Unreal uses the interchangeable terms <em>joint</em> and <em>bone</em> . <br><br>  By controlling these hinges, you can create different character poses. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/849/6cf/a20/8496cfa20a8c24c815d20f1e2dbf931a.jpg"></div><br>  When moving from one pose to another, an <em>animation</em> is created. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5d/56f/17a/b5d56f17a68116e36f60ca236e0400f4.gif"></div><br>  If you create even more poses between the previous ones, you can get something like this: <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87c/179/6cf/87c1796cfe666de4c0800a42060793e2.gif"></div></div></div><br>  In Unreal, any skeleton mesh is called <em>Skeletal Mesh</em> .  Let's start by importing Skeletal Mesh for muffin. <br><br><h2>  Import Skeletal Mesh </h2><br>  Go to the Content Browser and go to <em>Characters \ Muffin</em> .  Click on <em>Import</em> and go to <em>SkywardMuffinStarter \ Animation Assets</em> .  Select <em>SK_Muffin.fbx</em> and click <em>Open</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb1/7b1/b56/cb17b1b561e3579547c68a3230e9a53b.jpg"></div><br>  In the import window, go to the <em>Mesh</em> section and uncheck the <em>Create Physics Asset</em> option.  Physics Asset helps create a ragdoll effect.  In this tutorial we will not use it, so we will not need it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/888/5f8/1f5/8885f81f5ae96495a9867d2d0aed069e.jpg"></div><br>  The project already contains the material and texture of the muffin, so you do not need to import them.  <em>Uncheck the</em> options for <em>Import Materials</em> and <em>Import Textures</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ba/094/d4a/9ba094d4a57c937b1abea6e3d12ec82b.jpg"></div><br>  Leave all other settings as default and click on <em>Import</em> .  This will create the following assets: <br><br><ul><li>  <em>SK_Muffin:</em> Asset Skeletal Mesh.  This is just a mesh referring to the Skeleton asset. </li><li>  <em>SK_Muffin_Skeleton:</em> Skeleton Asset.  It contains a list of hinges and other information, such as their hierarchy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/593/7c3/e0a/5937c3e0ab1642f331ff45508ab09b63.jpg"></div></li></ul><br>  Having imported a muffin, we are ready to use it. <br><br><h2>  Using Skeletal Mesh </h2><br>  Before using the new Skeletal Mesh, you need to give it material so that it is not just a gray spot.  <em>Double click</em> on <em>SK_Muffin</em> to open it. <br><br>  Go to the Asset Details panel and find the <em>Material Slots</em> section.  Assign material <em>M_Muffin</em> and close <em>SK_Muffin</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/adb/774/c42/adb774c42e209fe43f7f6ad84b5db60a.jpg"></div><br>  Now let's use <em>SK_Muffin</em> as a player character.  Return to the Content Browser and <em>double-click</em> on <em>BP_Muffin</em> to open it. <br><br>  Go to the Components panel and select the <em>Mesh</em> component <em>(Inherited)</em> .  Switch to the Details panel and find the <em>Mesh</em> section.  For the <em>Skeletal Mesh</em> property, select <em>SK_Muffin</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/399/cd2/5d4/399cd25d4e19fcfb9a526fe7ef85925f.jpg"></div><br>  Click on <em>Compile</em> and return to the main editor.  Click on <em>Play</em> and you can control the muffin in the game! <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c8/e48/2b4/5c8e482b41bc21c925b94461e23dee91.gif"></div></div></div><br>  The game already looks much better!  The next step is to import animations that will breathe life into the muffin. <br><br><h2>  Import animations </h2><br>  Go to the Content Browser and click on <em>Import</em> .  Go to <em>SkywardMuffinStarter \ Animation Assets</em> .  Select the following files: <br><br><ul><li>  SK_Muffin_Death.fbx </li><li>  SK_Muffin_Fall.fbx </li><li>  SK_Muffin_Idle.fbx </li><li>  SK_Muffin_Jump.fbx </li><li>  SK_Muffin_Walk.fbx </li></ul><br>  After selecting them, click on <em>Open</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a8/5c9/a7a/0a85c9a7a4b4e474c2def853ef0348cc.jpg"></div><br>  In the import window, go to the <em>Mesh</em> section and <em>deselect the</em> <em>Import Mesh</em> option.  Thanks to this, Skeletal Mesh will not be imported again. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c16/fdb/622/c16fdb622afb06b7ebe5b4c99b53afef.jpg"></div><br>  Now check that the <em>Skeleton</em> property is <em>SK_Muffin_Skeleton</em> .  This defines the skeleton to be used in the animation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49f/e39/1d8/49fe391d8f0759d4a7a873ab10bcbfbc.jpg"></div><br>  Then click on <em>Import All</em> .  So you import all the animations with the settings you just specified. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b43/1c7/4f4/b431c74f45a06e640b908c521a3d346b.jpg"></div><br>  Now that we have all the animations, we need a way to play them.  You can use for this <em>Animation Blueprint</em> . <br><br><h2>  Creating an Animation Blueprint </h2><br>  Animation Blueprint is similar to ordinary Blueprint.  However, it also has a graph intended only for animation tasks. <br><br>  To create it, go to the Content Browser and click on the <em>Add New</em> button.  Select <em>Animation \ Animation Blueprint</em> . <br><br>  In the popup window, locate the <em>Target Skeleton</em> property and select <em>SK_Muffin_Skeleton</em> .  Then click on the <em>OK</em> button to create an animation blueprint. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e10/31a/3ef/e1031a3ef86628dda763a43a2020c9cf.jpg"></div><br>  Rename the asset to <em>ABP_Muffin</em> .  After that, <em>double click</em> on it to open it in the Animation Blueprint editor. <br><br><h3>  Animation Blueprint Editor </h3><br>  The Animation Blueprint editor is similar to the Blueprint editor, but it has four additional panels: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b97/cfd/c30/b97cfdc30d9392fdc236c5282a3e01b0.jpg"></a> </div><br><ol><li>  <em>Anim Graph:</em> This is a special graph for animations.  All animations are played here. </li><li>  <em>Preview Scene Settings:</em> this panel allows you to customize the preview scene in Viewport </li><li>  <em>Anim Preview Editor:</em> created variables will also be displayed here.  Use this panel to preview how your variables affect the final animation. </li><li>  <em>Asset Browser:</em> this panel contains a list of animations that the current skeleton can use. </li></ol><br>  To specify the situations in which each animation should play, you can use a state machine ( <em>State Machine</em> ). <br><br><h2>  What is a state machine? </h2><br>  A finite state machine is a set of <em>states</em> and <em>rules</em> .  In our tutorial, you can consider the state of animation. <br><br>  State machines can only be in one state at a time.  To move to the next state, certain conditions specified by the rules must be met. <br><br>  Below is a simple example of a finite state machine.  It shows the state of the jump and the rules of transition to each state. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/027/ba6/04c/027ba604c5d319d9de1964b6e22bc331.jpg"></div><br>  States can also have a bilateral relationship.  In the example below, the states of Jump and Fall can go into each other. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bd/0ea/d05/7bd0ead0576116c40e315cff4ad26a64.jpg"></div><br>  Without this two-way communication, the character would not be able to perform a double jump, because he could only enter the Jump state from the Idle state. <br><br>  Well, enough about the state machines, let's create them. <br><br><h3>  Create a state machine </h3><br>  Go to Anim Graph and <em>right-click</em> on an empty area.  In the menu, select <em>Add New State Machine</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04b/75f/d92/04b75fd927f78915a526c14f5a67499b.jpg"></div><br>  This will add a State Machine node to the graph.  Rename the State Machine to <em>Locomotion</em> .  Then connect the <em>Locomotion</em> state machine to the <em>Final Animation Pose</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b98/911/252/b98911252a3039fb42ccc031f52e8c83.jpg"></div><br>  Now the <em>Locomotion</em> state machine will determine the final muffin animation. <br><br>  <em>Double click</em> on the <em>Locomotion</em> slot machine to open it.  Inside you will see the <em>Entry</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a76/794/b23/a76794b234c5c33663e6de9b5e88b36b.jpg"></div><br>  The state connected to this node is the <em>default</em> state.  In our tutorial, the default state is the wait animation.  Create this state <em>by right-clicking</em> on an empty area of ‚Äã‚Äãthe graph.  In the menu, select <em>Add State</em> and rename it to <em>Idle</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81d/e6e/6f0/81de6e6f06ae60e43d0e74c7aed82296.jpg"></div><br>  Now we need to connect the <em>Entry</em> node with the <em>Idle</em> state.  <em>Drag the</em> <em>Entry</em> contact to the <em>gray</em> <em>Idle</em> status area.  Release the <em>left mouse button</em> to connect them. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d11/971/cb1/d11971cb1e7fd722b145bd3345027845.gif"></div><br>  When creating a state through the context menu, no animation will be associated with it.  Let's fix it. <br><br><h3>  Attaching animation to state </h3><br>  <em>Double click</em> on the <em>idle</em> state to open it. <br><br>  To snap an animation, go to the Asset Browser and <em>drag the</em> <em>SK_Muffin_Idle</em> animation.  Release the <em>left mouse button</em> on an empty area of ‚Äã‚Äãthe graph to add it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2dd/ce5/1ae/2ddce51ae1515366daacc10d0182b1b8.gif"></div><br>  Then attach the <em>Play SK_Muffin_Idle</em> node to the <em>Final Animation Pose</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c35/463/42c/c3546342c0862fd8bdd1dab970297fec.jpg"></div><br>  To use Animation Blueprint, we need to update <em>BP_Muffin</em> . <br><br><h3>  Using Animation Blueprint </h3><br>  Click on <em>Compile</em> and switch to <em>BP_Muffin</em> . <br><br>  Go to the Components panel and select the <em>Mesh</em> component <em>(Inherited)</em> .  Go to the panel and find the section <em>Animation</em> . <br><br>  Select for <em>Animation Mode</em> to <em>Use Animation Blueprint</em> .  For <em>Anim Class,</em> select <em>ABP_Muffin</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/477/d56/fae/477d56faeec66551c4945836dd165969.jpg"></div><br>  Skeletal Mesh will now use <em>ABP_Muffin</em> as its Animation Blueprint. <br><br>  Click on <em>Compile</em> and close <em>BP_Muffin</em> .  Go to the main editor and click on <em>Play</em> to check out the Animation Blueprint.  Since <em>Idle</em> is the default state, the muffin immediately uses the wait animation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de3/88c/53a/de388c53afb0e81ceef0c47a0c9cdb15.gif"></div><br>  In the next section, we will create states for jumping and falling. <br><br><h2>  Creating jump and fall states </h2><br>  Return to <em>ABP_Muffin</em> and switch to the <em>Locomotion</em> state machine graph.  This can be done by clicking on the word <em>Locomotion</em> , located at the top of the graph. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6dd/5c0/3c9/6dd5c03c95d1e47788b48e6d5f7d6f23.jpg"></div><br>  Instead of creating a state and attaching an animation to it, you can create a state with an animation already attached.  Let's do this for the jump state. <br><br>  Go to the Asset Browser and <em>drag the</em> <em>SK_Muffin_Jump</em> animation.  Release the <em>left mouse button</em> on an empty area of ‚Äã‚Äãthe graph.  This will create a state with an animation already attached to it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/147/4c2/607/1474c2607bdbb5bbb8a5e5376307f611.gif"></div><br>  Rename the state to <em>Jump</em> . <br><br>  Repeat the process with the <em>SK_Muffin_Fall</em> animation and rename the state <em>Fall</em> . <br><br>  Now we have three states: <em>Idle</em> , <em>Jump</em> and <em>Fall</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c9/fb4/9b1/0c9fb49b188fd2d0e46e8cbda8efe06c.jpg"></div><br>  Now we link the states with each other.  You can do this by <em>dragging the</em> <em>gray</em> status area <em>from</em> which you want to make the transition.  Release the <em>left mouse button</em> on the <em>gray</em> area of ‚Äã‚Äãthe <em>target</em> state to create a transition. <br><br>  Create the following transitions: <br><br><ul><li>  From <em>Idle</em> to <em>Jump</em> </li><li>  <em>Jump</em> to <em>Fall</em> </li><li>  From <em>Fall</em> to <em>Jump</em> </li><li>  From <em>Fall</em> to <em>Idle</em> </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce5/00b/a08/ce500ba08c4057d3d5b709a43c33b2bd.jpg"></div><br>  Now that we have transitions, we need to set the conditions under which they occur.  This can be done using <em>Transition Rules</em> . <br><br><h2>  Transition Rules </h2><br>  This icon indicates the Transition Rule: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/960/48d/c4d/96048dc4dc889d3be0e412ccd65281f0.jpg"></div><br>  Each transition rule contains a <em>Result</em> node with a single boolean input. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/956/47b/29b/95647b29b6de27d1a6aedfd43a3b4fba.jpg"></div><br>  If this input is <em>true</em> , then a transition occurs. <br><br>  Next, you need to create variables that tell us whether the player is jumping or falling.  We will apply these variables in the transition rules. <br><br><h3>  Determine whether character is jumping or falling </h3><br>  Create two <em>Boolean</em> variables with the names <em>IsJumping</em> and <em>IsFalling</em> . <br><br>  First, we will set the <em>IsJumping</em> value.  Switch to the Event Graph and find the <em>Event Blueprint Update Animation</em> node.  This node works like an <em>Event Tick</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa9/1cc/9f7/aa91cc9f7f4ce5ee4fbd3f627d289c0a.jpg"></div><br>  To check whether the character is jumping, create the following scheme: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d8b/e72/2e8/d8be722e8d70c921fbc31902f531a6cc.jpg"></a> </div><br>  So we will check if <em>the</em> character's <em>Z</em> <em>speed is</em> greater than zero.  If so, the character jumps, and <em>IsJumping</em> should be <em>true</em> . <br><br>  <em>Note:</em> bring it to a class that will use Animation Blueprint.  This is very important in order to be able to preview variables using the Anim Preview Editor. <br><br>  To check if a character is falling, we just need to do the opposite check.  Add selected nodes: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d41/37e/89f/d4137e89fadbce7c9c55d6c13c96c27a.jpg"></a> </div><br><br>  Now <em>IsFalling</em> will be equal to <em>true</em> when <em>the</em> character's <em>Z speed is</em> less than zero. <br><br>  It is time to use these variables to set the transition rules. <br><br><h3>  Defining transition rules </h3><br>  First, we need to set the transition rule <em>Idle to Jump</em> .  Switch back to the <em>Locomotion</em> state machine.  <em>Double click</em> on the <em>Idle to Jump</em> rule to open it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/298/f79/9ef/298f799ef2af1d934dc8c44655b4c3da.jpg"></div><br>  Create an <em>IsJumping</em> node and connect it to the <em>Result</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/174/90e/222/17490e2223d5f86e2d2dc411b2de138e.jpg"></div><br>  Now the <em>Idle</em> state can go to the <em>Jump</em> state when <em>IsJumping</em> is <em>true</em> . <br><br>  Repeat the process for <em>Jump to Fall</em> and <em>Fall to Jump</em> .  Use the following variables: <br><br><ul><li>  <em>Jump to Fall:</em> IsFalling </li><li>  <em>Fall to Jump:</em> IsJumping </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49e/188/dff/49e188dffe6b0d82d79b06185f334b15.jpg"></div><br>  Now the state of <em>Jump</em> and <em>Fall</em> can go into each other. <br><br>  It remains to assign another transition rule.  Open the <em>Fall to Idle</em> transition rule. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7af/a2e/fa4/7afa2efa46a5a995fc937c80506a1b6d.jpg"></div><br>  To go to the <em>Idle</em> state, the player must not jump or fall.  To perform this check, you can use the <em>NOR</em> node.  This node returns <em>true</em> only when both entries are <em>false</em> . <br><br>  Create a <em>NOR</em> node and connect the <em>IsJumping</em> and <em>IsFalling nodes to it</em> .  After that, connect the <em>NOR</em> node to the <em>Result</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0e/72a/a8e/e0e72aa8ee685e9240349df4bbdc5a8e.jpg"></div><br>  Now the <em>Fall</em> state can transition to the <em>Idle</em> state when <em>IsJumping</em> and <em>IsFalling</em> are <em>false</em> . <br><br>  Click on <em>Compile</em> and return to the main editor.  Click on <em>Play</em> to check transitions. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c6/291/a37/2c6291a37f737f0d0ca6c23eb5c301c0.gif"></div></div></div><br>  <em>Note:</em> You can also check transitions by changing variables in the Anim Preview Editor. <br><br>  While the muffin only moves on the ground, because we haven‚Äôt applied the walking animation yet! <br><br>  Instead of creating a new state for walking, you can mix it with the waiting animation using <em>Blend Space</em> . <br><br><h2>  What is Blend Space? </h2><br>  Blend Space is a type of animation resource.  It interpolates between different animations based on input values.  In this tutorial, we will use the player's <em>speed</em> as input. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad5/182/d55/ad5182d555829d1c8e7081c2f3e6a786.gif"></div></div></div><br>  Blend Space also helps to simplify state machines.  Here‚Äôs what the <em>Locomotion</em> state machine will look like if you don‚Äôt use Blend Space for walking: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d5/bc8/92b/9d5bc892b5732a7037c5d1c483de9905.jpg"></div><br>  Thanks to Blend Space, you simply replace the waiting animation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc2/3f8/5ab/fc23f85ab00de3be1576acc406266ddb.jpg"></div><br>  Now that you've learned the magic of Blend Space, it's time to create it. <br><br><h3>  Creating Blend Space </h3><br>  Go to the Content Browser and click on <em>Add New</em> .  Select <em>Animation \ Blend Space 1D</em> . <br><br>  <em>Note: the</em> difference between <em>Blend Space</em> and <em>Blend Space 1D</em> is that the first has <em>two</em> inputs.  The latter has only <em>one</em> entrance. <br><br>  In the popup window, select <em>SK_Muffin_Skeleton</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fb/e47/e27/3fbe47e2788c013fa9e14e64b3418cef.jpg"></div><br>  Rename the asset to <em>BS_IdleWalk</em> and <em>double-click</em> it to open it in the Animation editor. <br><br>  When Blend Space opens, you will see a panel at the bottom of the screen.  This is the Blend Space editor, in which we will add animations. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f02/fe8/449/f02fe84497f8b408d38543215c03df33.jpg"></div><br>  Let's add animations to Blend Space. <br><br><h3>  Adding animations to Blend Space </h3><br>  First, you need to change the name of the value axis (input).  Go to the Asset Details panel and find the <em>Axis Settings</em> section.  Change the <em>Horizontal Axis \ Name</em> property to <em>Speed</em> . <br><br>  Now we will add animations.  Go to the Asset Browser and <em>drag the</em> <em>SK_Muffin_Idle</em> animation.  Move it to the <em>left</em> on the Blend Space grid so that it is tied to the value <em>0.0</em> .  Release the <em>left mouse button</em> to add an animation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/295/97d/f26/29597df26df160c05e5c32f01838aa0f.gif"></div><br>  <em>Note:</em> To display animation titles, click the <em>tag</em> icon in the <em>upper left</em> corner of the Blend Space grid. <br><br>  After that add the <em>SK_Muffin_Walk</em> animation to the value <em>100.0</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/449/620/8ee/4496208ee7b3f9a48489729e197026e5.jpg"></div><br>  Now Blend Space will mix waiting and walking animations depending on the input value.  If the input value is <em>0</em> , only the wait animation will play.  If the input value is <em>100</em> , only the walk animation will play.  All intermediate values ‚Äã‚Äãwill be mixed. <br><br>  <em>Note:</em> these values ‚Äã‚Äãare arbitrary.  For example, you can change the maximum value by making it equal to 500. In this case, the walk animation will play only at higher speeds. <br><br>  You can change the values ‚Äã‚Äãof the <em>Axis Settings</em> section in the Asset Details panel. <br><br>  It's time to use Blend Space. <br><br><h2>  Apply Blend Space </h2><br>  Close <em>BS_IdleWalk</em> and open <em>ABP_Muffin</em> .  Switch to the <em>Locomotion</em> state machine and open the <em>Idle</em> state. <br><br>  First, delete the <em>Play</em> node <em>SK_Muffin_Idle</em> . <br><br>  Then add Blend Space <em>BS_IdleWalk</em> using drag and drop.  Connect the <em>BS_IdleWalk</em> node to the <em>Final Animation Pose</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26f/a8a/a30/26fa8aa307797690b11bf4c265935119.jpg"></div><br>  Now <em>BS_IdleWalk</em> will play automatically because it is the default state.  However, it will only display a wait animation.  This is because the <em>Speed</em> input remains at <em>0</em> . <br><br>  To fix this, you need to give him the speed of the player. <br><br><h3>  Getting player speed </h3><br>  Create a new variable of type <em>float</em> named <em>Speed</em> .  Then switch to Event Graph. <br><br>  Add a new contact to the <em>Sequence</em> node, and then add selected nodes to it: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b5a/1ce/5b9/b5a1ce5b9cb3042c7c2b94129e3924b7.jpg"></a> </div><br>  This scheme will constantly equate the variable <em>Speed</em> to the player's speed value. <br><br>  Switch back to the <em>Idle</em> status column.  Connect the <em>Speed</em> variable to the <em>Speed</em> input of the <em>BS_IdleWalk</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b64/f74/421/b64f74421347ccf9bf14f33285b591cb.jpg"></div><br>  Now <em>BS_IdleWalk</em> will be able to mix between the wait and walk animations. <br><br>  Click on <em>Compile</em> and return to the main editor.  Click on <em>Play</em> to test Blend Space. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1e/e17/289/b1ee17289e419b640a8d6b47a512f03d.gif"></div></div></div><br>  There is another animation that we need to use: the animation of death! <br><br><h2>  Use death animation </h2><br>  In this game, you can die only in the <em>Idle</em> state (on the ground).  However, let's imagine that a player can die in any state.  The first thought is to create a state of <em>Death</em> and connect with it all the states.  This can be done, but it will quickly lead to a confusing graph. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/492/fba/9b9/492fba9b9b90b7b847b6d99fc24822d6.jpg"></div><br>  The solution could be to use the <em>Blend Poses by bool</em> node.  This node can switch between two animations depending on the value of the input boolean value. <br><br>  Before creating this node, we need a variable containing the player‚Äôs death status. <br><br><h3>  Check if a player is dead </h3><br>  Go back to <em>ABP_Muffin</em> and create a <em>boolean</em> variable called <em>IsDead</em> .  Then switch to Event Graph. <br><br>  Add a new contact to the <em>Sequence</em> node, and then add selected nodes to it: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c6a/6f7/563/c6a6f7563a41ff0c104122eac017b1aa.jpg"></a> </div><br>  So we will set the variable <em>IsDead</em> , depending on the state of death of the player. <br><br>  Then we use the <em>Blend Poses</em> node <em>by bool</em> . <br><br><h3>  Using the Blend Poses by Bool node </h3><br>  Switch to Anim Graph and add an <em>SK_Muffin_Death</em> animation.  After selecting it, go to the Details panel and <em>uncheck the</em> <em>Loop Animation</em> property. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0cc/972/05e/0cc97205ec3b08fcc5a93e3bb25d17b5.jpg"></div><br>  Due to this, the death animation will play only once. <br><br>  Then create the node <em>Blend Poses by bool</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffa/0b9/029/ffa0b902984c1d4fb1887acb82e75bad.jpg"></div><br>  Select the <em>Blend Poses by bool</em> node and go to the Details panel.  In the <em>Option</em> section, <em>check</em> the <em>Reset Child on Activation</em> property. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b5/769/ee1/4b5769ee198de7482052440ba9ab3c57.jpg"></div><br>  Since the death animation is played only once, this option ensures that the animation is reset before playback. <br><br>  Finally, add the <em>IsDead</em> variable and connect everything as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e09/181/00d/e0918100d5795ead308eab329eed7709.jpg"></div><br>  Now, if the <em>IsDead</em> variable is <em>true</em> , then the death animation will start playing.  If <em>IsDead</em> is <em>false</em> , then the current animation of the <em>Locomotion</em> state machine will play. <br><br>  Click on <em>Compile</em> and close <em>ABP_Muffin</em> .  Click on <em>Play</em> and test the new death animation! <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/023/1e2/f10/0231e2f1058ce6ab7fca591d128cb0f5.gif"></div></div></div><br><h2>  Where to go next? </h2><br>  Download the finished project <a href="">here</a> . <br><br>  Now the game looks much better, right?  Much can be done on the basis of the knowledge already gained, but this is not the end!  Examine the Unreal Engine <a href="https://docs.unrealengine.com/latest/INT/Engine/Animation/">Skeletal Mesh Animation System</a> page.  Here you can learn about other types of animation assets and how to use them. <br><br>  If you want to continue learning, then read the <a href="https://habrahabr.ru/post/345018/">next part of the tutorial</a> , in which I will show you how to add music and sound effects to the game. </div><p>Source: <a href="https://habr.com/ru/post/344840/">https://habr.com/ru/post/344840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344826/index.html">Microkernel vs. monolith and the "triumph" of MINIX</a></li>
<li><a href="../344830/index.html">Quantum computing: annealing with switches and other fun</a></li>
<li><a href="../344832/index.html">Stay lazy with angular / cli</a></li>
<li><a href="../344834/index.html">In France, bitcoins are not money</a></li>
<li><a href="../344836/index.html">Lack of RAM in Linux on a working PC: optimization and actions when it hangs</a></li>
<li><a href="../344842/index.html">Description of business processes. Use caution</a></li>
<li><a href="../344844/index.html">Surrogates</a></li>
<li><a href="../344848/index.html">Irreparable consequences of HolyJS 2017 Moscow</a></li>
<li><a href="../344852/index.html">How to make friends with Skype and proxy</a></li>
<li><a href="../344856/index.html">Two analyst competencies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>