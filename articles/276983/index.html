<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VK vulnerability: access to previews of photos from dialogues and hidden albums of any user</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Short 
 A vulnerability was discovered in the mobile version of the site vk.com. It allowed viewing previews of hidden photos, including photos from u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VK vulnerability: access to previews of photos from dialogues and hidden albums of any user</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/0d2/f02/32d/0d2f0232d30d4fa9a8c7f33836ecf11b.png" align="right"><h4>  Short </h4><br>  A vulnerability was discovered in the mobile version of the site vk.com.  It allowed viewing previews of hidden photos, including photos from user dialogues, plus it was possible to get information about users who liked this hidden photo.  At the moment, the vulnerability is no longer - it was eliminated six months ago.  VKontakte expressed gratitude in the amount of $ 700 (no, not in votes). <br><a name="habracut"></a><br><h4>  How it all began </h4><br>  During the session you are distracted by everything, just not to prepare for exams.  So I, seeing <a href="https://habrahabr.ru/post/259137/">an article</a> about the Bug Bounty program from VKontakte on hackerone.com, instead of preparing for exams, took to look for vulnerabilities.  For some reason, immediately pulled to look for vulnerabilities associated with photos hidden privacy settings, and as it turned out - not in vain. <br><br><h4>  Search for vulnerabilities in the full version of the site </h4><br>  Assuming that the id of the hidden photo is known to me (I‚Äôm looking for it below), I began to try to substitute this id in various requests with curl ‚Äî I tried to save the hidden images in my album, mark myself on them, like, repost, etc.  nothing gave a positive result until I tried to just send a hidden photo to myself on the wall.  The result was strange - in the console the request returned the correct result and a new post appeared on the wall, but its contents were empty.  As I did not try, the server stopped all attempts to send a hidden photo to the wall - the posts were empty. <br><br><h4>  Switch to mobile version </h4><br><img src="https://habrastorage.org/files/9d5/45f/762/9d545f762bfe4ab99cb9471d0a4dcd31.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then, I remembered <a href="https://habrahabr.ru/post/257951/">this</a> comment and decided to try to do the same in the mobile version of the site. <br><br>  Send a photo to the wall: <br><br><pre><code class="bash hljs">curl <span class="hljs-string"><span class="hljs-string">'http://m.vk.com/wall53083705'</span></span> -H <span class="hljs-string"><span class="hljs-string">'Cookie: remixsid=#remixsid'</span></span> --data <span class="hljs-string"><span class="hljs-string">'act=post&amp;hash=#hash&amp;attach1_type=photo&amp;attach1=id_id'</span></span> <span class="hljs-comment"><span class="hljs-comment"># id         id_id</span></span></code> </pre> <br>  This request was executed incorrectly, but by refreshing the page, I was surprised to find that an attached small copy of the photo appeared on the submission form. <br><br><img src="https://habrastorage.org/files/60e/e20/d16/60ee20d1617b4c00b4d750b0b34234a0.png"><br><br>  The maximum photo size is 130x130, but this is enough to, for example, recognize faces in a photo.  Attempts to get a link to the full photo did not lead to anything.  Apparently, after the closure of <a href="http://habrahabr.ru/post/257951">this</a> vulnerability, from the mobile version of the site direct links to the full size just do not get. <br><br><h4>  Enumerate photos </h4><br>  Vulnerability found.  To exploit the found vulnerability, you need to get the id of the attacked photo. <br><br>  The photo id consists of two parts: photo12345_330000000 (idPlacer_idPhoto), the second part is growing from photo to photo, but this is not an ordinary autoincrement.  Since the algorithm for selecting the step is unknown, we will go through with step 1. <br><br>  To iterate, we use the api <a href="https://vk.com/dev/photos.delete">photos.delete</a> method.  This method for all existing photos (including hidden ones) will return <b>error_code</b> : 15. And for all non-existing id photos, one will be returned. <br><br><h5>  Brute force </h5><br>  From <a href="http://habrahabr.ru/post/257951/">this article,</a> you can learn how to quickly sort through photos.  Yes, the data in it is not the newest, but even if we consider that in a year there were twice as many photos, the search time still remains acceptable. <br><blockquote>  in order to find out direct links to pictures of the user, for example, last year, you need to sort through only 30 million (from _320000000 to _350000000) of various link variations </blockquote><br><br>  Taking advantage of the acceleration of enumeration from this article, the user‚Äôs photos could be iterated: <br><blockquote>  1 minute to get all your yesterday's photos, 7 minutes - all photos uploaded last week, 20 minutes - last month, 2 hours - last year. </blockquote><br><br><h5>  Dropout open / hidden </h5><br>  Having received links to all (both hidden and open) photos of the user, you can select only the hidden ones, having tried to get information about the photo using the photos.getById method.  Those photos, information about which is not returned by this method - are hidden. <br><br><h4>  Likes </h4><br>  You could also find out the users who liked the hidden photo.  The likes.getList method returns all users who added the specified object to my list, even if this object is hidden for the user who runs this method. <br><br><h4>  Report on hackerone </h4><br>  My report was opened in June.  We closed the vulnerability in two and a half months without telling me anything.  A month later I received a reply that the vulnerability was confirmed and closed.  And after some time he received a reward. <br><br>  PS: for those who, for the first time, are trying to bring rewards from hackerone.com to a new paypal account, I advise you to carefully read the terms and conditions.  Paypal, when transferring funds, may, without your consent, convert the remuneration into the currency of the country specified in your profile. </div><p>Source: <a href="https://habr.com/ru/post/276983/">https://habr.com/ru/post/276983/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276973/index.html">Explaining the inexplicable. Part 2</a></li>
<li><a href="../276975/index.html">FRUSDR update for optimal server performance (INTEL platform)</a></li>
<li><a href="../276977/index.html">Domain telephony</a></li>
<li><a href="../276979/index.html">PRIMEFLEX vShape - turnkey solution for the implementation of virtualization</a></li>
<li><a href="../276981/index.html">Crash course on interfaces in go</a></li>
<li><a href="../276987/index.html">Part-to-whole ratio in temporal / event ontology</a></li>
<li><a href="../276989/index.html">Checking WPF source code for examples from Infragistics</a></li>
<li><a href="../276991/index.html">List of technical and IT conferences 2016. Part # 2</a></li>
<li><a href="../276995/index.html">Technologies: death and rebirth</a></li>
<li><a href="../276997/index.html">Creating your own theme for Visual Studio Code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>