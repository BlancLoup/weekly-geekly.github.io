<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Matlab features for developing and testing mechanistic trading systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think that there is no need to substantiate the need for thorough testing and selection of parameters for trading strategies ... I‚Äôd better explain ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Matlab features for developing and testing mechanistic trading systems</h1><div class="post__text post__text-html js-mediator-article">  I think that there is no need to substantiate the need for thorough testing and selection of parameters for trading strategies ... I‚Äôd better explain why Matlab. <br><br>  The MetaTrader trading terminal has a built-in system for testing and setting trading strategies that allows you to run a strategy on a given part of history and look at the results of trading both in graphical representation and in the form of a sign with the performance characteristics of this strategy in this part of history.  How it looks for the Nova strategy, see below. <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/266/1fc/589/2661fc589d664272a276b92dd0a9fbe9.png" alt="image"><br><img src="https://habrastorage.org/files/d7d/d9b/0e3/d7dd9b0e3df544f8bb6240967cc725dd.png" alt="image"><br><br>  In my opinion, this testing system has a number of significant drawbacks: <br>  1) You cannot use real tick data, you can only model them for data of minute, 5-minute, 15-minute, etc. stored on the server.  timeframes; <br>  2) For the selection of the optimal parameters of the strategy is quite a scant set of available optimization procedures; <br>  3) A little more diverse, but still insufficient set of target indicators of the trading strategy that can be optimized; <br>  4) The trading strategy development environment itself is suitable for the most minimal programming, not impressive with the variety of possibilities and accessible tools. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And I would like to be able to use tick (or even every second) data to accurately simulate trading situations, create trading strategies of any level of mathematical complexity, describe my own criteria for evaluating the quality of a strategy, search for optimal parameters using various optimization procedures, etc. <br><br>  All this is possible using Matlab as a platform for developing and testing strategies.  From MetaTrader, we will need source data (in my example: every second current prices for 27 currency pairs).  Then MetaTrader will still be used to work with a ready-made trading strategy implemented, for example, in the form of a DLL, but all the most creative part of creating a system will occur in a more mathematical environment. <br><br>  The data is collected by a custom indicator, whose code in MQL4 looks like this: <br><br><pre><code class="hljs smalltalk">//+------------------------------------------------------------------+ //| pack_collector.mq4 | //| <span class="hljs-type"><span class="hljs-type">Copyright</span></span> <span class="hljs-number"><span class="hljs-number">2014</span></span>, <span class="hljs-type"><span class="hljs-type">JamaGava</span></span> | //| | //+------------------------------------------------------------------+ <span class="hljs-symbol"><span class="hljs-symbol">#property</span></span> copyright <span class="hljs-comment"><span class="hljs-comment">"Copyright 2014, JamaGava"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#property</span></span> link <span class="hljs-comment"><span class="hljs-comment">""</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#property</span></span> version <span class="hljs-comment"><span class="hljs-comment">"1.00"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#property</span></span> strict int filehandleData; int filehandleHead; int filehandleVolHead; int filehandleVolData; //+------------------------------------------------------------------+ //| <span class="hljs-type"><span class="hljs-type">Expert</span></span> initialization function | //+------------------------------------------------------------------+ int <span class="hljs-type"><span class="hljs-type">OnInit</span></span>() { <span class="hljs-type"><span class="hljs-type">EventSetTimer</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); filehandleData = <span class="hljs-type"><span class="hljs-type">FileOpen</span></span>(<span class="hljs-comment"><span class="hljs-comment">"tickPack.csv"</span></span>,<span class="hljs-type"><span class="hljs-type">FILE_WRITE</span></span>|<span class="hljs-type"><span class="hljs-type">FILE_CSV</span></span>); filehandleHead = <span class="hljs-type"><span class="hljs-type">FileOpen</span></span>(<span class="hljs-comment"><span class="hljs-comment">"tickPackHead.csv"</span></span>,<span class="hljs-type"><span class="hljs-type">FILE_WRITE</span></span>|<span class="hljs-type"><span class="hljs-type">FILE_CSV</span></span>); filehandleVolHead = <span class="hljs-type"><span class="hljs-type">FileOpen</span></span>(<span class="hljs-comment"><span class="hljs-comment">"tickPackVolumeHead.csv"</span></span>,<span class="hljs-type"><span class="hljs-type">FILE_WRITE</span></span>|<span class="hljs-type"><span class="hljs-type">FILE_CSV</span></span>); filehandleVolData = <span class="hljs-type"><span class="hljs-type">FileOpen</span></span>(<span class="hljs-comment"><span class="hljs-comment">"tickPackVolume.csv"</span></span>,<span class="hljs-type"><span class="hljs-type">FILE_WRITE</span></span>|<span class="hljs-type"><span class="hljs-type">FILE_CSV</span></span>); <span class="hljs-type"><span class="hljs-type">FileWrite</span></span>(filehandleHead, <span class="hljs-comment"><span class="hljs-comment">"bid:AUD/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:AUD/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:EUR/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:EUR/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:GBP/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:GBP/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:NZD/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:NZD/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:USD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:USD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:USD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:USD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:USD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:USD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:AUD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:AUD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:AUD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:AUD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:AUD/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:AUD/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:CAD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:CAD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:EUR/AUD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:EUR/AUD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:EUR/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:EUR/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:EUR/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:EUR/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:EUR/GBP"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:EUR/GBP"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:EUR/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:EUR/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:GBP/AUD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:GBP/AUD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:GBP/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:GBP/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:GBP/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:GBP/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:GBP/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:GBP/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:NZD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:NZD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:NZD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:NZD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:AUD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:AUD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:CAD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:CAD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:CHF/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:CHF/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:EUR/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:EUR/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:GBP/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:GBP/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bid:NZD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"ask:NZD/JPY"</span></span> ); <span class="hljs-type"><span class="hljs-type">FileWrite</span></span>(filehandleVolHead, <span class="hljs-comment"><span class="hljs-comment">"volume:AUD/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:EUR/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:GBP/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:NZD/USD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:USD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:USD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:USD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:AUD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:AUD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:AUD/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:CAD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:EUR/AUD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:EUR/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:EUR/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:EUR/GBP"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:EUR/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:GBP/AUD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:GBP/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:GBP/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:GBP/NZD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:NZD/CAD"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:NZD/CHF"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:AUD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:CAD/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:CHF/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:EUR/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:GBP/JPY"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"volume:NZD/JPY"</span></span> ); <span class="hljs-type"><span class="hljs-type">FileClose</span></span>(filehandleHead); <span class="hljs-type"><span class="hljs-type">FileClose</span></span>(filehandleVolHead); return(<span class="hljs-type"><span class="hljs-type">INIT_SUCCEEDED</span></span>); } //+------------------------------------------------------------------+ //| <span class="hljs-type"><span class="hljs-type">Expert</span></span> deinitialization function | //+------------------------------------------------------------------+ void <span class="hljs-type"><span class="hljs-type">OnDeinit</span></span>(const int reason) { <span class="hljs-type"><span class="hljs-type">EventKillTimer</span></span>(); <span class="hljs-type"><span class="hljs-type">FileClose</span></span>(filehandleData); } //+------------------------------------------------------------------+ //| <span class="hljs-type"><span class="hljs-type">Timer</span></span> function | //+------------------------------------------------------------------+ void <span class="hljs-type"><span class="hljs-type">OnTimer</span></span>() { <span class="hljs-type"><span class="hljs-type">FileWrite</span></span>(filehandleData, <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"USDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"USDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"USDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"USDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"USDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"USDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"CADCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"CADCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURAUD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURAUD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURGBP"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURGBP"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPAUD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPAUD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"AUDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"CADJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"CADJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"CHFJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"CHFJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"EURJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"GBPJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_BID</span></span>), <span class="hljs-type"><span class="hljs-type">MarketInfo</span></span>(<span class="hljs-comment"><span class="hljs-comment">"NZDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">MODE_ASK</span></span>) ); <span class="hljs-type"><span class="hljs-type">FileWrite</span></span>(filehandleVolData, iVolume(<span class="hljs-comment"><span class="hljs-comment">"AUDUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"EURUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"GBPUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"NZDUSD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"USDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"USDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"USDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"AUDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"AUDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"AUDNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"CADCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"EURAUD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"EURCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"EURCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"EURGBP"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"EURNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"GBPAUD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"GBPCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"GBPCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"GBPNZD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"NZDCAD"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"NZDCHF"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"AUDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"CADJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"CHFJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"EURJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"GBPJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), iVolume(<span class="hljs-comment"><span class="hljs-comment">"NZDJPY"</span></span>, <span class="hljs-type"><span class="hljs-type">PERIOD_H1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) ); } //+------------------------------------------------------------------+</code> </pre> <br>  So, the data is collected and saved in CSV files.  The rows are recorded current quotes, in columns: the entire range of bid and ask quotes for each currency pair.  Total, columns in 2 times more than the considered currency pairs. <br><br>  Suppose we do not have the opportunity to keep the computer running MetaTrader continuously, then the data will be received in blocks: downloaded, closed the program, renamed the file, so as not to get stuck, we can run it again, etc. <br><br>  At the moment, I have collected data for 16 weeks.  Moreover, the size of the data is different due to the fact that the collection began "somewhere in the morning" on Monday, and ended on Friday "approximately after lunch."  Therefore it is necessary to put up with the fact that all arrays with data blocks of different sizes.  In Matlab, I upload them as follows: <br><br>  Script loadPrices.m: <br><br><pre> <code class="matlab hljs"><span class="hljs-keyword"><span class="hljs-keyword">global</span></span> PRICES; N = <span class="hljs-number"><span class="hljs-number">16</span></span>; PRICES = cell( N, <span class="hljs-number"><span class="hljs-number">1</span></span> ); fNames = { <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\1\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\2\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\3\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\4\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\5\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\6\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\7\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\8\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\9\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\10\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\11\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\12\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\13\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\14\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\15\tickPack.csv'</span></span>; <span class="hljs-string"><span class="hljs-string">'C:\matlabR2008a_win\work\frx\DATA\16\tickPack.csv'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>:N PRICES{ <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> } = load( fNames{ <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> } ); display( <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  As a result, all data blocks are stored in the global variable PRICES, which represents 16 cells. <br><br>  Now, the basic idea: strategies should be created in such a way that they only accept their parameters as input.  All source data is passed through global variables.  In the course of executing a strategy, each time a deal is closed, global variables are adjusted that characterize the quality of the strategy‚Äôs work.  To optimize these characteristics, we create a ‚Äúshell‚Äù within which global variables are initialized, which of the indicators of the strategy‚Äôs performance will be returned as a parameter, and the strategy will be invoked. <br><br>  Script testStrat.m: <br><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[R]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testStrat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recovery</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sharp</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitFactor</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnParamIndex</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stratName</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 0 )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">feval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( stratName, P )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( returnParamIndex )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recovery</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 5 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 6 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 7 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sharp</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 8 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitFactor</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 9 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 10 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 11 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 12 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 13 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 14 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function"> 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">struct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ... 'DrawDown', DrawDown, ... 'Recovery', Recovery, ... 'Equity', Equity, ... 'DealsNumber', DealsNumber, ... 'MeanDeal', MeanDeal, ... 'DealsSigma', DealsSigma, ... 'Sharp', Sharp, ... 'ProfitFactor', ProfitFactor, ... 'ProfitDealsNumber', ProfitDealsNumber, ... 'ProfitDealsRate', ProfitDealsRate, ... 'ProfitMean', ProfitMean, ... 'LossDealsNumber', LossDealsNumber, ... 'LossDealsRate', LossDealsRate, ... 'LossMean', LossMean ... )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  The name of the script that implements the strategy is passed through the global variable stratName.  The characteristic of the strategy that will be returned is determined by the variable returnParamIndex, if the value is 0, then all characteristics within the structure are returned. <br><br>  Please note that all the values ‚Äã‚Äã‚Äúthe more the better‚Äù are with a minus, this is done for universal optimization: always minimize the target parameter. <br><br>  Actually, the characteristics of the system: <br>  DrawDown - maximum drawdown (maximum difference between the previous maximum and the current value); <br>  Recovery - recovery factor (the ratio of the final gain to the maximum drawdown); <br>  Equity - the final win; <br>  DealsNumber - the number of transactions; <br>  MeanDeal - the average income per transaction; <br>  DealsSigma - standard deviation of income for each transaction from the average value; <br>  Sharp - Sharpe ratio (the ratio of the average income per transaction to the standard deviation of income from transactions from the average value); <br>  ProfitFactor - profit factor (the ratio of total profit to total loss); <br>  ProfitDealsNumber - the number of winning trades; <br>  ProfitDealsRate - the proportion of winning transactions; <br>  ProfitMean - average win (for a successful transaction); <br>  LossDealsNumber - the number of losing trades; <br>  LossDealsRate - share of losing trades; <br>  LossMean - average loss (for a losing trade). <br><br>  These indicators are initialized by the initRates.m function <br><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( mode )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recovery</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sharp</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitFactor</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maxEquity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealSqr</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalProfit</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalLoss</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mode</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maxEquity</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealSqr</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalProfit</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalLoss</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mode</span></span></span><span class="hljs-function"> == 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recovery</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sharp</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitFactor</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitMean</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsRate</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossMean</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function"> = 1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recovery</span></span></span><span class="hljs-function"> = -1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> = -1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function"> = -1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function"> = 1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sharp</span></span></span><span class="hljs-function"> = -1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitFactor</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitMean</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function"> = 100000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsRate</span></span></span><span class="hljs-function"> = 1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossMean</span></span></span><span class="hljs-function"> = 1000; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Moreover, both 0 and obviously bad values ‚Äã‚Äãcan be initialized (determined by the input parameter).  Why bad initialization is needed will be shown below when considering a specific strategy.  Note that several auxiliary variables are initialized: <br><br>  <i>maxEquity, dealSqr, totalProfit, totalLoss,</i> <br><br>  which are used in the following listing. <br><br>  During the execution of the strategy, at each closing of the transaction, we will update the characteristics of the work strategy.  To do this, use the updateStratRates.m function: <br><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStratRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dealResult )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dealResult )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recovery</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sharp</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitFactor</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsRate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossMean</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maxEquity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealSqr</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalProfit</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalLoss</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealResult</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maxEquity</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maxEquity</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">down</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maxEquity</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">down</span></span></span><span class="hljs-function"> &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">down</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recovery</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawDown</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function"> + 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealSqr</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealSqr</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealResult</span></span></span><span class="hljs-function">^2; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( (dealSqr / DealsNumber)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function">^2 ); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sharp</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeanDeal</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsSigma</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealResult</span></span></span><span class="hljs-function"> &gt; 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function"> + 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalProfit</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalProfit</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealResult</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitMean</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalProfit</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function"> + 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalLoss</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalLoss</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealResult</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossMean</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalLoss</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitFactor</span></span></span><span class="hljs-function"> = -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalProfit</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalLoss</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsNumber</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DealsNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LossDealsRate</span></span></span><span class="hljs-function"> = 1 - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfitDealsRate</span></span></span><span class="hljs-function">;</span></span></code> </pre><br>  Actually, that's the whole infrastructure for testing strategies.  Now you can describe the strategy as a function that takes as input a set of parameters, calling initRates at the beginning and updateStratRates with the result of each closing deal. <br><br>  Baseline data can be obtained, for example: <br><br><pre> <code class="matlab hljs"><span class="hljs-keyword"><span class="hljs-keyword">global</span></span> pairIndex; <span class="hljs-comment"><span class="hljs-comment">% /   / global DATA; %   global dataBlocksNumber; %    (   16)</span></span></code> </pre><br>  Now more about the trading system, twoEMA, by the example of which I will show how it all works. <br>  The idea of ‚Äã‚Äãthe system is to use two exponential moving averages.  Entry into the market is subject to the following conditions: <br><br>  Purchase / sale is carried out if all the conditions are met: <br>  1) Fast moving average above / below slow for at least a certain number of 4-digit points; <br>  2) The opening price of the timeframe is higher / lower than the fast moving average; <br>  3) No current open deals. <br><br>  Closing with any of the following conditions: <br>  1) Achievement of the established profit value for the current transaction; <br>  2) Achievement of the established value of the loss on the current transaction (tralling stop-loss as the income on the transaction increases, it pulls up to the current price, until breakeven values ‚Äã‚Äãare reached); <br>  3) The appearance of conditions 1 and 2 on the opening of the transaction in the opposite direction. <br><br>  The input parameters for the transaction are: the length of the timeframe in seconds, the parameters of moving averages in units of measurement 0.0001, the ‚Äúgap‚Äù between moving averages for opening a trade, the values ‚Äã‚Äãof profit and loss in four-digit points. <br><br>  In addition, we will consider two modes of operation of the strategy: debugging and demonstration. <br>  In the demonstration mode, unlike debugging, not only closed transactions are evaluated, but also open ones, for which the maximum profit on the transaction, the maximum loss on the transaction, as well as the final income / loss at the time of closing the transaction are estimated. <br><br>  Thus, each transaction can be represented by a standard ‚Äúbar‚Äù instead of the traditional line graph Equity.  Profit is counted in 4-digit points. <br><br>  twoEMA.m: <br><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Z]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">twoEma</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P )</span></span></span><span class="hljs-function"> %{ +---------------------------------------------------------------+ ! ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parameters</span></span></span><span class="hljs-function">: ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timeframe</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E1</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EMA</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alpha</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function"> ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fast</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EMA</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alpha</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3)</span></span></span><span class="hljs-function"> ! ! ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Open</span></span></span><span class="hljs-function">: ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deal</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(openPrice &gt;= E2 &gt; E1)</span></span></span><span class="hljs-function"> &amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E1 - E2)</span></span></span><span class="hljs-function"> &gt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(4)</span></span></span><span class="hljs-function"> ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">short</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deal</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(openPrice &lt;= E2 &lt; E1)</span></span></span><span class="hljs-function"> &amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E1 - E2)</span></span></span><span class="hljs-function"> &gt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(4)</span></span></span><span class="hljs-function"> ! ! ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Close</span></span></span><span class="hljs-function">: ! ! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">by</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trailing</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loss</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">by</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Take</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profit</span></span></span><span class="hljs-function"> ! ! ! +---------------------------------------------------------------+ %} </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pairIndex</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DATA</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataBlocksNumber</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WithPlot</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EQ</span></span></span><span class="hljs-function">; %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eqCounter</span></span></span><span class="hljs-function">; %   %       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P( 1 )</span></span></span><span class="hljs-function"> &lt; 0, ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P( 4 )</span></span></span><span class="hljs-function"> * 0.0001 &lt;= 0, ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P( 5 )</span></span></span><span class="hljs-function"> * 0.0001 &lt;= 0, ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P( 6 )</span></span></span><span class="hljs-function"> * 0.0001 &lt;= 0, ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ... or( P( 2 )</span></span></span><span class="hljs-function"> * 0.0001 &lt;= 0, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 2 )</span></span></span><span class="hljs-function"> * 0.0001 &gt;= 1 ), ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P( 3 )</span></span></span><span class="hljs-function"> * 0.0001 &lt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 2 )</span></span></span><span class="hljs-function"> * 0.0001, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 3 )</span></span></span><span class="hljs-function"> * 0.0001 &gt;= 1 ) ... ) ... ) ... ) ... ) ... ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 1 )</span></span></span><span class="hljs-function">; %     ,    %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Z</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 0 )</span></span></span><span class="hljs-function">; %     %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQopen</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmin</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmax</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQclose</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TF</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">round</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( P( 1 )</span></span></span><span class="hljs-function"> ); %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currBlock</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataBlocksNumber</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currData</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DATA</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currBlock</span></span></span><span class="hljs-function"> }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataSize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currData )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataLen</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 1 )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tfNumb</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ceil</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dataLen / TF )</span></span></span><span class="hljs-function">; %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bid</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ask</span></span></span><span class="hljs-function">     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( :, 2 * ( pairIndex - 1)</span></span></span><span class="hljs-function"> + 1 ); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( :, 2 * pairIndex )</span></span></span><span class="hljs-function">; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDealPrice</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoss</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">takeProfit</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currDeal</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 1 )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 1 )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currTime</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-function"> = 2:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tfNumb</span></span></span><span class="hljs-function"> %   ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currTime</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currTime</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TF</span></span></span><span class="hljs-function">; %    </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(    %  )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">barLen</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TF</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tfNumb</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">barLen</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataLen</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TF</span></span></span><span class="hljs-function"> * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( tfNumb - 1 )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tick</span></span></span><span class="hljs-function"> = 2:</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(barLen - 1)</span></span></span><span class="hljs-function"> %     ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> == 1 %     %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currDeal</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDealPrice</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmin</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal, currEQmin )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmax</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal, currEQmax )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQclose</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currDeal</span></span></span><span class="hljs-function">; %   - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoss</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( stopLoss, bidPrices( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 5 )</span></span></span><span class="hljs-function"> * 0.0001 ); %     -  - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( bidPrices( currTime + tick )</span></span></span><span class="hljs-function"> &lt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoss</span></span></span><span class="hljs-function">, ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> &gt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">takeProfit</span></span></span><span class="hljs-function"> ... ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> = 0; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStratRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal )</span></span></span><span class="hljs-function">; %   ,    %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WithPlot</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[EQ, eqCounter]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateSeries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( EQ, eqCounter, [currEQopen, currEQmax, currEQmin, currEQclose] )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> == -1 %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currDeal</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDealPrice</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmin</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal, currEQmin )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmax</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal, currEQmin )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQclose</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currDeal</span></span></span><span class="hljs-function">; %   - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoss</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( stopLoss, askPrices( currTime + tick )</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 5 )</span></span></span><span class="hljs-function"> * 0.0001 ); %     -  - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( askPrices( currTime + tick )</span></span></span><span class="hljs-function"> &gt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoss</span></span></span><span class="hljs-function">, ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> &lt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">takeProfit</span></span></span><span class="hljs-function"> ... ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> = 0; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStratRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal )</span></span></span><span class="hljs-function">; %   ,    %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WithPlot</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[EQ, eqCounter]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateSeries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( EQ, eqCounter, [currEQopen, currEQmax, currEQmin, currEQclose] )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> %        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E1</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 2 )</span></span></span><span class="hljs-function"> * 0.0001 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( bidPrices( currTime )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E1</span></span></span><span class="hljs-function"> ); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 3 )</span></span></span><span class="hljs-function"> * 0.0001 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( bidPrices( currTime )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function"> ); %       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( and( bidPrices( currTime )</span></span></span><span class="hljs-function"> &gt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function"> &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E1</span></span></span><span class="hljs-function"> ), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( E1 - E2 )</span></span></span><span class="hljs-function"> &gt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 4 )</span></span></span><span class="hljs-function"> * 0.0001 ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( and( bidPrices( currTime )</span></span></span><span class="hljs-function"> &lt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E2</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">E1</span></span></span><span class="hljs-function"> ), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( E1 - E2 )</span></span></span><span class="hljs-function"> &gt;= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 4 )</span></span></span><span class="hljs-function"> * 0.0001 ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal</span></span></span><span class="hljs-function"> = -1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % ,         %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ... and( dealDir == 1, signal == -1 )</span></span></span><span class="hljs-function">, ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dealDir == -1, signal == 1 )</span></span></span><span class="hljs-function"> ... ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> = 0; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStratRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal )</span></span></span><span class="hljs-function">; %   ,    %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WithPlot</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[EQ, eqCounter]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateSeries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( EQ, eqCounter, [currEQopen, currEQmax, currEQmin, currEQclose] )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dealDir == 0, signal == 1 )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDealPrice</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime )</span></span></span><span class="hljs-function">; %   % -  - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoss</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 5 )</span></span></span><span class="hljs-function"> * 0.0001; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">takeProfit</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 6 )</span></span></span><span class="hljs-function"> * 0.0001; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQopen</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmin</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmax</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQclose</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dealDir == 0, signal == -1 )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> = -1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDealPrice</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime )</span></span></span><span class="hljs-function">; %   % -  - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoss</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 5 )</span></span></span><span class="hljs-function"> * 0.0001; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">takeProfit</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( 6 )</span></span></span><span class="hljs-function"> * 0.0001; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equity</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQopen</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmin</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQmax</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currEQclose</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bidPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currTime + tick )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dealDir</span></span></span><span class="hljs-function"> ~= 0 %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStratRates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( currDeal )</span></span></span><span class="hljs-function">; %   ,    %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WithPlot</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[EQ, eqCounter]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateSeries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( EQ, eqCounter, [currEQopen, currEQmax, currEQmin, currEQclose] )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Z</span></span></span><span class="hljs-function"> = 0;</span></span></code> </pre><br>  In the listing above, the updateSeries helper function is used; it is a kind of "push_back". <br><br>  Function updateSeries.m: <br><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[S, I]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateSeries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s, i, v)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> == 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">S</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">I</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">I</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> + 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">S</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[s; v]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Finally, how can all this be used together? <br><br>  Script mainScript.m: <br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% loadPrices; %   global stratName; global returnParamIndex; global pairIndex; global DATA; global PRICES; global dataBlocksNumber; global WithPlot; global EQ; global eqCounter; stratName = 'twoEma'; %  twoEMA pairIndex = 2; %    (EUR/USD) DATA = PRICES; dataBlocksNumber = 16; WithPlot = false; %   P = [900, 100, 310, 25, 100, 40]; %   returnParamIndex = 7; %    P = fminsearch( 'testStrat', P ); display(P); WithPlot = true; %   EQ = 0; eqCounter = 0; returnParamIndex = 0; R = testStrat( P ); display(R); for i = 2:eqCounter %        EQ( i, 1 ) = EQ( i, 1 ) + EQ( i - 1, 4 ); EQ( i, 2 ) = EQ( i, 2 ) + EQ( i - 1, 4 ); EQ( i, 3 ) = EQ( i, 3 ) + EQ( i - 1, 4 ); EQ( i, 4 ) = EQ( i, 4 ) + EQ( i - 1, 4 ); end candle(EQ(:, 2), EQ(:, 3), EQ(:, 4), EQ(:, 1)); title('Equity');</span></span></code> </pre><br>  As a result, the equity trading system will look like this: <br><br><img src="https://habrastorage.org/files/694/89b/154/69489b1546e64b59b12f6a211c9c0636.png" alt="image"><br><br>  And the characteristics are as follows: <br><br>  DrawDown: 0.0105 <br>  Recovery: 12.6103 <br>  Equity: 0.1320 <br>  DealsNumber: 47 <br>  MeanDeal: 0.0028 <br>  DealsSigma: 0.0056 <br>  Sharp: 0.5034 <br>  ProfitFactor: 3.3393 <br>  ProfitDealsNumber: 34 <br>  ProfitDealsRate: 0.7234 <br>  ProfitMean: 0.0055 <br>  LossDealsNumber: 13 <br>  LossDealsRate: 0.2766 <br>  LossMean: -0.0043 <br><br>  It could have been better ... Not surprisingly, at a minimum, we need to use a more intelligent search function for optimum than fminsearch, given that we have no reason to consider the objective function smooth, continuously differentiable and unimodal ... <br><br>  But we didn‚Äôt have a goal to create a super system.  And the possibilities of using Matlab are demonstrated. </div><p>Source: <a href="https://habr.com/ru/post/260635/">https://habr.com/ru/post/260635/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260621/index.html">Multiple / Class Table Inheritance in Rails</a></li>
<li><a href="../260623/index.html">High-performance code on the .NET platform</a></li>
<li><a href="../260629/index.html">Digest news of the gaming industry</a></li>
<li><a href="../260631/index.html">We pump HP t5325 thin client</a></li>
<li><a href="../260633/index.html">What to tell at the training on service h. 1</a></li>
<li><a href="../260637/index.html">Retrospective development of Crash Bandicoot, or how the developers packed the whole game in 2MB RAM</a></li>
<li><a href="../260639/index.html">Sensors and microcontrollers. Part 3. We measure current and voltage.</a></li>
<li><a href="../260641/index.html">200 design and engineering blogs</a></li>
<li><a href="../260643/index.html">My little relays: Autowatering is magic</a></li>
<li><a href="../260645/index.html">We use SVG on the site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>