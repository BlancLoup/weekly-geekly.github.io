<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cross-platform application on Qt: Distribution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Building the distribution is the final stage of preparing a program for publication. Unfortunately, there is no talk of any standardization in this ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cross-platform application on Qt: Distribution</h1><div class="post__text post__text-html js-mediator-article">  Building the distribution is the final stage of preparing a program for publication.  Unfortunately, there is no talk of any standardization in this area, moreover, on some operating systems (we will not point the finger), so generally a whole zoo of formats. <br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/962/b29/9cf/962b299cff27eb6233b01bfef2f58895.png"><br>  So ideally we need distributions: <br><ul><li>  Windows </li><li>  OS X ( <b>.dmg</b> ) </li><li>  OS X ( <b>.pkg - App Store</b> ) </li><li>  Linux ( <b>.deb</b> ) </li><li>  Linux ( <b>.rpm</b> ) </li><li>  Linux ( <b>.tar.gz - universal</b> ) </li></ul><a name="habracut"></a><br><h4>  Qt Installer Framework </h4><br>  In fairness it should be noted that Qt has its own, of course, cross-platform <a href="http://qt-project.org/wiki/Qt-Installer-Framework">framework</a> for creating installers.  It allows you to create both regular and online installers that can download additional components from the repository.  It is also possible to insert your own widgets, add new actions (pages).  You probably installed Qt Creator, which means you saw this system in operation.  However, when creating an installer, you have to write an xml config, work with keys on the command line, in general, the setting has a rather high threshold of entry, especially compared to other solutions.  At the same time, I did not find in the <a href="http://doc-snapshot.qt-project.org/qtifw-1.4/index.html">documentation any</a> mention of how to skip the component selection page.  In general, it turned out to be a very specific product, the disadvantage of which is that this installation method is considered native only on the Windows platform. <br><br><h4>  Windows </h4><br>  Accordingly, the options for creating installers for this OS weight, but I stopped at a fairly convenient open source product - Inno setup.  Creating an installer in it is no more difficult than the actual installation of ‚Äúfurther, further, ready.‚Äù <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ad/658/012/9ad65801214484a2b6f8cccb9a05799b.png"></div><br>  After going through the creation wizard, we get a script at the output that can be easily changed for the next versions of our program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Linux </h4><br>  Historically, software for Linux is distributed through repositories, and the distribution of each program is a special type of package containing the actual program files, dependency information, and some other metadata.  Despite all attempts at standardization, other than mainstream .deb and .rpm, there are many other <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B_%25D0%25BF%25D0%25B0%25D0%25BA%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B2_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC_Linux">formats</a> specific to individual Linux distributions.  Canonical is experimenting with the <a href="http://habrahabr.ru/post/179751/">.click</a> format, reminiscent of application <a href="http://habrahabr.ru/post/179751/">bundles</a> in OS X, but it‚Äôs still premature to consider this option among the <a href="http://xkcd.ru/927/">main ones</a> .  Since Ubuntu is the de facto Linux standard on the desktop, I will describe package creation on this platform.  It should also be noted that, more often than not, the third-party software distribution kit carries with it everything that is necessary for its operation; therefore, the advanced capabilities of the package system remain untapped. <br><br><h5>  .tar.gz </h5><br>  What is common between distros?  Of course the command shell!  So we will make a script installer that will run on any system, regardless of the intended package format.  In order for the system to ‚Äúsee‚Äù that a new program is installed, each file must take its proper place.  The minimum set consists of: an icon, an executable file, and a special config with the extension .desktop <br><br>  <b>Icon:</b> According to the <a href="http://standards.freedesktop.org/icon-theme-spec/icon-theme-spec-latest.html">specification</a> , Linux does not require to convert the source of the icon into any build, you just need to copy (during installation) files in a subdirectory like: <br><blockquote>  / usr / share / icons / hicolor / RxR / apps, where R is the resolution of the icon <br>  <b>or</b> <br>  / usr / share / icons / hicolor / scalable / apps - if you want to install a vector image in .svg format </blockquote>  However, this is not all, each icon theme has its own cache, and if it is not updated, it‚Äôs impossible to see the new icon.  The cache is automatically updated during the regular installation of packages, or you can do it manually by running the command: <br><blockquote><code>gtk-update-icon-cache /usr/share/icons/hicolor</code> </blockquote>  <b>Executable</b> file <blockquote> <code>/usr/bin</code> </blockquote>  <b>Configuration</b> file .desktop <blockquote> <code>/usr/share/applications</code> </blockquote>  contains all information about the program - the name and description of the application, its category, the name of the icon, etc. <br><br>  For example: <br><pre> <code class="markdown hljs">[Desktop Entry] Name=iStodo Comment=iStodo is an organizer for students with scheduling and planning features. GenericName=Organizer for students Exec=istodo Icon=istodo Categories=Office;Qt; Terminal=false Type=Application Version=1.2 Name[ru]= iStodo Comment[ru]=     GenericName[ru]=  </code> </pre><br>  You can learn more by reading the <a href="http://standards.freedesktop.org/desktop-entry-spec/desktop-entry-spec-1.1.html">standard</a> . <br><br>  The rule of good tone when installing third-party programs with a non-standard method of installation will be to store all of their files in the <code>/opt/myapp</code> subdirectory, where you should also install uninstaller. <br><br>  So, in the end, I got the following script, which assumes that next to it is a binary, a .desktop file, a delete script, a folder with icons (in it are subdirectories by size): <br><div class="spoiler">  <b class="spoiler_title">install.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash iconsPath="/usr/share/icons/hicolor" desktopPath="/usr/share/applications" installPath="/opt/myapp" linkPath="/usr/bin/myapp" #Check user if [[ $EUID -ne 0 ]]; then echo "This script must be run as root" exit 1 fi #Remove old version if [ -d $installPath ]; then $installPath'/uninstall.sh' &gt; /dev/null fi echo "myapp install..." mkdir -v $installPath cp -v myapp $installPath cp -v uninstall.sh $installPath cp -v myapp.desktop $desktopPath ln -sv $installPath'/myapp' $linkPath chmod a+x $linkPath echo "---" cp -v icons/32x32/myapp.png $iconsPath'/32x32/apps' cp -v icons/48x48/myapp.png $iconsPath'/48x48/apps' cp -v icons/64x64/myapp.png $iconsPath'/64x64/apps' cp -v icons/128x128/myapp.png $iconsPath'/128x128/apps' cp -v icons/256x256/myapp.png $iconsPath'/256x256/apps' gtk-update-icon-cache /usr/share/icons/hicolor update-desktop-database echo "...finished!"</span></span></code> </pre></div></div><br>  It is logical that you need a script to remove the program: <br><div class="spoiler">  <b class="spoiler_title">uninstall.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash iconsPath="/usr/share/icons/hicolor" desktopPath="/usr/share/applications" installPath="/opt/myapp" linkPath="/usr/bin/myapp" echo "myapp uninstall" #Check user if [[ $EUID -ne 0 ]]; then echo "This script must be run as root" exit 1 fi rm -v $iconsPath'/32x32/apps/myapp.png' rm -v $iconsPath'/48x48/apps/myapp.png' rm -v $iconsPath'/64x64/apps/myapp.png' rm -v $iconsPath'/128x128/apps/myapp.png' rm -v $iconsPath'/256x256/apps/myapp.png' rm -v $desktopPath'/myapp.desktop' #Remove app folder echo "---" rm -rfv $installPath rm -v $linkPath echo "Uninstall finished!"</span></span></code> </pre></div></div><br><h5>  .deb </h5><br>  Despite the frighteningly monstrous format specifications, the simplest package requires only one configuration file - control.  But first we need to make some preparations: <br>  <b>a)</b> Create a project folder with the version of the program and package, for example myapp-1.1-1 <br>  <b>b)</b> Add the DEBIAN folder to it (the register is important!), which will contain all service files, in particular control <br><div class="spoiler">  <b class="spoiler_title">Example for control</b> <div class="spoiler_text"><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Package</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">istodo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Version</span></span>: 1<span class="hljs-selector-class"><span class="hljs-selector-class">.2-1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Section</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">misc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Architecture</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">amd64</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Installed-Size</span></span>: 16500 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Maintainer</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Yakov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Eremin</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">support</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">istodo</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">ru</span></span>&gt; Description: Organizer for students iStodo is an organizer for students with scheduling and planning features.</code> </pre></div></div>  Everything is obvious, you just need to note that the full description begins with a space <br>  <b>c)</b> Create a directory structure that repeats the position of the files of the installed program in the file system, something like <br><br><pre> <code class="markdown hljs">myapp-1.1-1 ‚îú‚îÄ‚îÄ DEBIAN ‚îÇ  ‚îî‚îÄ‚îÄ control ‚îî‚îÄ‚îÄ usr ‚îú‚îÄ‚îÄ bin ‚îÇ  ‚îî‚îÄ‚îÄ myapp ‚îî‚îÄ‚îÄ share ‚îú‚îÄ‚îÄ applications ‚îÇ  ‚îî‚îÄ‚îÄ myapp.desktop ‚îî‚îÄ‚îÄ icons ‚îî‚îÄ‚îÄ hicolor ‚îú‚îÄ‚îÄ 128x128 ‚îÇ  ‚îî‚îÄ‚îÄ apps ‚îÇ  ‚îî‚îÄ‚îÄ myapp.png ‚îú‚îÄ‚îÄ 256x256 ‚îÇ  ‚îî‚îÄ‚îÄ apps ‚îÇ  ‚îî‚îÄ‚îÄ myapp.png ‚îú‚îÄ‚îÄ 32x32 ‚îÇ  ‚îî‚îÄ‚îÄ apps ‚îÇ  ‚îî‚îÄ‚îÄ myapp.png ‚îú‚îÄ‚îÄ 48x48 ‚îÇ  ‚îî‚îÄ‚îÄ apps ‚îÇ  ‚îî‚îÄ‚îÄ myapp.png ‚îî‚îÄ‚îÄ 64x64 ‚îî‚îÄ‚îÄ apps ‚îî‚îÄ‚îÄ myapp.png</code> </pre><br>  In order to create packages without elevating privileges to the superuser, you should use the fakeroot utility, which emulates the appropriate environment. <br><br>  Well, we collect the package with the command: <br><pre> <code class="bash hljs">fakeroot dpkg-deb --build myapp-1.1-1/</code> </pre><br>  If you need additional features, you can read a detailed review here. <br><br><h5>  .rpm </h5><br>  As they say, there are two ways - simple and correct. <br>  <b>Simple</b> : if the .deb package does not contain any dependencies and scripts, then you can simply convert it, as a result you will certainly get a correctly working package of the .rpm format.  To do this, use the alien utility, which can be installed from the repository. <br><pre> <code class="bash hljs">fakeroot alien -kr myapp-1.0-1.deb</code> </pre><br>  The disadvantage of this approach is the inoperability of packages on Fedora 18 and later.  As far as I understand, the problem is caused by the difference in access rights to system directories, which is why a conflict occurs.  There are two options: either fix the packages by hand (an installed Fedora is required), or build the .rpm packages as expected. <br>  <b>Correct</b> : Unfortunately, there is no three and a half lines to get rid of here, because ‚ÄúBuild rpm for dummies‚Äù is the topic of a separate article.  In this case, the full <a href="http://www.opennet.ru/docs/RUS/rpm_guide/">manual is</a> available in Russian. <br><br>  More information about assembling packages can be read <a href="http://tigro.info/wp/%3Fp%3D375">here</a> . <br><br><h4>  OS X </h4><br>  As mentioned above, there are two main methods of distribution - a disk image with a program, or download from a directory.  Both methods are already well disassembled, it is worth noting only a few fundamental points. <br><br><ul><li>  <a href="http://habrahabr.ru/post/152677/">Creating a beautiful image .dmg</a> </li><li>  <a href="http://habrahabr.ru/company/istodo/blog/215971/">Adding to the Mac App Store</a> </li></ul><br>  In order for the program to run not only on systems with the Qt SDK installed, you need to use a specialized utility - macdeployqt, which copies all the necessary plug-ins and frameworks into the application bundle.  When adding the "-d" key, a .dmg image will be generated, which can be used as a base for customization. <br><br><ul><li>  Open it via disk utility, convert to read / write </li><li>  Open the resulting image in the Finder </li><li>  In the "View" menu, hide the extra items (status bar, etc.) </li><li>  Add a link to / Applicatons </li><li>  Create a hidden folder, copy the background image into it </li><li>  In the "view parameters" (PCM) adjust the size of the icons, grid, background </li><li>  Convert image back </li></ul><br>  <a href="http://habrahabr.ru/company/istodo/blog/215053/">The contents of the series of articles</a> </div><p>Source: <a href="https://habr.com/ru/post/217071/">https://habr.com/ru/post/217071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217055/index.html">The logic of thinking. Part 17. The relational data model.</a></li>
<li><a href="../217057/index.html">How to fight off the "software troll" or how much is now calculators?</a></li>
<li><a href="../217063/index.html">LG Smart Bulb</a></li>
<li><a href="../217065/index.html">Mylar - Platform for secure web applications based on Meteor.js</a></li>
<li><a href="../217069/index.html">Through the eyes of subscribers. Rating of mobile operators for February 2014</a></li>
<li><a href="../217073/index.html">PgTune - PostgreSQL performance tuning for a given hardware configuration (online version)</a></li>
<li><a href="../217075/index.html">The option of an ergonomic computer keyboard and the problem of ‚Äúpacking‚Äù several ‚Äúfunctional zones‚Äù of a standard keyboard into one</a></li>
<li><a href="../217079/index.html">Edward Snowden on TED: How to get the Internet back (voiceovers)</a></li>
<li><a href="../217081/index.html">Microsoft opens source code for early versions of MS-DOS and Word</a></li>
<li><a href="../217083/index.html">‚ÄúHopeless‚Äù project or 8 ‚Äústick lessons‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>