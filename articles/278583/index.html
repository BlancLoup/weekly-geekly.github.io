<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with FireBird from 1C. Collection of proven recipes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 
 This material is intended to summarize and show the main techniques and techniques for working with InterBase / FireBird databases from progr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with FireBird from 1C. Collection of proven recipes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ce1/2c6/ef7/ce12c6ef704a41ed8c303abe15350dea.jpg"><br>  Hello. <br>  This material is intended to summarize and show the main techniques and techniques for working with InterBase / FireBird databases from programs running on the 1C platform.  Almost everything that is stated here is somehow found in other Internet sources.  However, in this article, the material is quite complete.  It is possible that something from the stated topic is missed, but all the same, the material presented (in my understanding) is enough to solve most of the tasks (by the way, something did not work out - someone can tell the solution, and it will be possible to add material).  In addition, a demo, attached to the article, can be used by those who wish as a framework for developing their own similar programs.  Despite the fact that most of the tasks for access from 1C to third-party databases are limited by the need to load any data from an adjacent information system, we will show here more diverse options for access to databases, including various types of recording information in the database. <br>  This post will tell you about: <br>  - how to connect to the server (database) and disconnect when shutting down; <br>  - how to execute SQL queries (to receive and transmit data, including those that cannot be placed directly in the query text (long lines, BLOB fields)); <br>  - how to perform data conversion, incl.  text encodings when transferring data to and from the database; <br>  - how to access the server database logic (call stored procedures); <br>  - how to protect your program from automatically breaking a TCP connection by the database server; <br>  - other interesting tricks related to programming in general (how to do all the above actions is convenient, reliable and portable). <br><br>  So let's get started ... <br><a name="habracut"></a><br><h1>  Introduction. </h1><br>  The demo turned out to be quite large.  Nevertheless, the structure of the program is quite clear - so it’s quite realistic to understand. <br>  In the program (this is external processing), a special technique of structured programming, conventionally called "OOP in 1C" (described in more detail <a href="https://habrahabr.ru/post/271731/">here</a> ), is actively used.  In fact, almost the entire general processing module (a part of the program that is not directly related to the user interface) consists of such structures. <br>  Also used such an interface "adapt", as the "list of informational messages" (described in more detail <a href="https://habrahabr.ru/post/278521/">here</a> ). <br><br>  The program was tested on versions of <b>FireBird 1.5</b> and <b>FireBird 2.1</b> .  Most likely, it will work for any other version of the database.  This database access mechanism uses <b>ADO</b> technology.  Accordingly, the “ <b>Firebird_ODBC</b> ” driver and the “ <b>gds32.dll</b> ” client library must be installed on the computer where the 1C client is running. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will not give full source codes of the program (even source codes of separate classes will be given with abbreviations).  To view the source code, it is better to open a test sample directly in 1C - the quality of viewing will be much higher than what is available by means of HTML publishing. <br><br><h1>  Problem statement (the essence of a demo). </h1><br>  We will consider as an example a simple information system, conventionally called the “Notebook”.  It will be somewhat similar to a directory that can be created in the platform.  We will have a directory of contact information.  The directory will have a tree of groups (directories) - you can create an arbitrary tree of any nesting.  The elements of such a directory will be the so-called "Cards", i.e.  actually records with contact information.  In addition, in this information system there will be users (accounts) with their own access rights.  No search (only data entry and navigation through the group tree).  There is also no binding of users to the data that they entered (like the Primary Responsible in the 1C standard solutions documents) fields, and there is also no logging (logging) of user actions.  To demonstrate the work with the base of this functionality is enough, and even more complicated the implementation of the user interface just did not want. <br><br>  Here is how this application will look like (show on a series of slide-screenshots): <br>  <i>Main program window:</i> <br><img src="https://habrastorage.org/files/8ae/991/090/8ae991090f994c66af84c6dccc23eeca.jpg"><br>  <i>At the top</i> is the main menu and toolbar with commands. <br>  <i>In the middle</i> are the main elements of the contact directory display: in the left column is the directory group tree, and in the right column are the contents (groups and elements) of the current (selected in the left column) group. <br>  <i>At the bottom</i> there is a field for displaying messages that occur during the program operation (in this case, these are error messages). <br><br>  Further we will consider that: <br>  - “ <i>Current group</i> ” is the group selected in the group tree (in the left column); <br>  - “ <i>Contents of the current group</i> ” is a list of groups and elements displayed in the right column; <br>  - “The <i>current object of the current group</i> ” is the group or element selected in the right column; <br><br>  All commands (add, edit, delete, move) refer to the contents of the right column (either to the current group or to the current element of the current group) - just like in the standard interface for working with 1C directories. <br><br>  The main menu and toolbar contain the following commands: <br><table><tbody><tr><th>  Fig. </th><th>  Team name </th><th>  Description </th></tr><tr><td></td><td>  “Base” → “Connection” </td><td>  Connects to the database (closes the previous connection, if it was) </td></tr><tr><td><img src="https://habrastorage.org/files/8d8/675/6e3/8d86756e385d478fbaef2e9859da80b8.jpg"></td><td>  “Base” → “Exit” </td><td>  Exit from the program </td></tr><tr><td><img src="https://habrastorage.org/files/0e4/227/ef6/0e4227ef672d4826b2579a2a3ed8e705.jpg"><br></td><td>  “Actions” → “Add” </td><td>  Create a new item (card) in the current directory group. </td></tr><tr><td><img src="https://habrastorage.org/files/7de/2a3/b29/7de2a3b29d264962b111c12a265b47bc.jpg"><br></td><td>  “Actions” → “New Group” </td><td>  Create a new group in the current directory group. </td></tr><tr><td><img src="https://habrastorage.org/files/5bb/5ec/2c1/5bb5ec2c1ff84450a9e4396bd0fccee0.jpg"><br></td><td>  “Actions” → “Copy” </td><td> Create a new object in the current directory group based on the data of the currently selected object.  What exactly is created (group or card) depends on which object was selected in the current group. </td></tr><tr><td><img src="https://habrastorage.org/files/336/593/916/336593916e424c56b180e0444b00e153.jpg"></td><td>  “Actions” → “Change” </td><td>  Open for editing the current object of the current group (group or card). </td></tr><tr><td><img src="https://habrastorage.org/files/fb0/e39/dfa/fb0e39dfab2c46b5a739ed06b3da0fca.jpg"><br></td><td>  “Actions” → “Delete” </td><td>  Delete the current object of the current group (group or card). </td></tr><tr><td><img src="https://habrastorage.org/files/fa3/6ec/29c/fa36ec29c38c49f0aef6849b011f7af3.jpg"><br></td><td>  “Actions” → “Move to group” </td><td>  Move to another group the current object of the current group (group or card). </td></tr><tr><td><img src="https://habrastorage.org/files/2a8/fad/fca/2a8fadfca5d946f684f1bffdb7da93f2.jpg"><br></td><td>  “Actions” → “Refresh” </td><td>  Reload all data (both the group tree and the contents of the current group). </td></tr><tr><td></td><td>  “Settings” → “Change Password” </td><td>  Change current user password </td></tr><tr><td></td><td>  “Settings” → “User List” </td><td>  Editing the list of users of the database. </td></tr><tr><td></td><td>  “Settings” → “Connection Profiles” </td><td>  Editing database connection profiles </td></tr></tbody></table><br>  <i>Program window before connecting to the database:</i> <br><img src="https://habrastorage.org/files/772/b40/873/772b40873e5046aea10f0491e5a79cab.jpg"><br><br>  <i>Dialogue of the connection:</i> <br>  (Team: “Base” → “Connection”) <br><img src="https://habrastorage.org/files/a84/192/125/a8419212598b4fc1bdbaea19091a20a0.jpg"><br><br>  <i>Program window after connecting to the database:</i> <br><img src="https://habrastorage.org/files/a38/403/f85/a38403f8504e4d4591f0ad779c6b9c1b.jpg"><br><br>  <i>Dialog for setting database connection profiles:</i> <br>  (Team: “Settings” → “Connection Profiles”) <br><img src="https://habrastorage.org/files/9b0/c56/023/9b0c560239e245628e6e254d1d35ef18.jpg"><br><br>  <i>Dialog change password:</i> <br>  (Team: “Settings” → “Change Password”) <br><img src="https://habrastorage.org/files/5cb/5b7/76d/5cb5b776d2fd4e8792f53b86ea777d38.jpg"><br><br>  <i>User list settings:</i> <br>  (Team: “Settings” → “List of Users”) <br><img src="https://habrastorage.org/files/045/b48/ebd/045b48ebd9ce4c9a801df4497484d4d1.jpg"><br><br>  <i>Editing contact directory group:</i> <br>  (Commands: “Actions” → “New Group”, “Actions” → “Copy”, “Actions” → “Edit”) <br><img src="https://habrastorage.org/files/a79/e9d/56e/a79e9d56e42d4a05a670637bc6182399.jpg"><br><br>  <i>Editing a contact directory item (card):</i> <br>  (Commands: “Actions” → “Add”, “Actions” → “Copy”, “Actions” → “Edit”) <br><img src="https://habrastorage.org/files/4a6/a29/c2d/4a6a29c2de1649be9c8e3a3f0fb28c6a.jpg"><br><br>  <i>Group selection dialog in the group tree:</i> <br>  It is used to specify the parent group in the group and card editing dialogs, as well as to indicate the group to values ​​when the current object of the current group (an object selected in the right list of the main program window) is moved to a new group. <br><img src="https://habrastorage.org/files/f47/cf0/9d8/f47cf09d8069474ab88b88f2ee0e276f.jpg"><br><br><h1>  Database structure </h1><br>  The main entities of the system: <br>  1. Reference system users (accounts).  Consists only of elements (accounts).  Accordingly, the database is represented by a single table. <br>  2. Actually the very targeted directory of contact information.  Consists of groups (directory tree) and elements (cards).  In the database, the directory will be represented by a separate table of groups (the directory level tree will be stored in it) and a separate table of elements (cards with contacts will be stored in it). <br><br>  In the database, create the following tables: <br>  - the table “GROUPS” - storage of the group tree; <br><table><tbody><tr><th>  Field name </th><th>  Data type </th><th>  Description </th></tr><tr><td>  GRID </td><td>  INTEGER </td><td>  Table entry identifier - tree node identifier (all values&gt; 0). </td></tr><tr><td>  Pgraid </td><td>  INTEGER </td><td>  Parent node ID.  Thus, a connection is established between nodes in a single tree.  A value of 0 means that this node is included in the "root" of the tree.  The root itself is not stored in the database (it is always in the program - it cannot be changed). </td></tr><tr><td>  GRNAME </td><td>  VARCHAR (255) </td><td>  The name of the tree node.  The uniqueness of these values ​​(within the table) is not tracked, as in the 1C references. </td></tr></tbody></table><br>  - “CARDS” table - storage of reference items - cards with contact data; <br><table><tbody><tr><th>  Field name </th><th>  Data type </th><th>  Description </th></tr><tr><td>  CDID </td><td>  INTEGER </td><td>  The entry identifier in the table is the card identifier (all values&gt; 0). </td></tr><tr><td>  GRID </td><td>  INTEGER </td><td>  Identifier of the parent tree node (link to GROUPS.GRID).  Thus, the connection of the card with the tree is established.  A value of 0 means that this card is included in the "root" of the tree (although there is no entry in the GROUPS table with GRID = 0). </td></tr><tr><td>  GRNAME </td><td>  VARCHAR (255) </td><td>  The name of the card.  The uniqueness of these values ​​(within the table) is not tracked, as in the 1C references. </td></tr><tr><td>  CDDESCRIPT </td><td>  VARCHAR (255) </td><td>  Description field. </td></tr><tr><td>  CDCONTACTS </td><td>  BLOB (TEXT - 1) </td><td>  Contact Information.  In fact, a text field in the form of the MEMO type is a large text of variable length, stored separately from the main table.  All rules of automatic work with encodings (as in CHAR and VARCHAR) are applied to it. </td></tr><tr><td>  CDNOTE </td><td>  BLOB (BINARY - 0) </td><td>  Notes.  In fact, the text field, but described as a binary blob.  This should not be done, but since the format of the database is often not chosen by us, this option is quite possible.  In this example, we will show how to work with text (encodings) in case the database does not know that it is text. </td></tr><tr><td>  CDIMAGE </td><td>  BLOB (BINARY - 0) </td><td>  Here is the image attached to the card.  In fact, it contains the same as the corresponding graphic file. </td></tr></tbody></table><br>  - table "USERS" - the credentials of the information system; <br><table><tbody><tr><th>  Field name </th><th>  Data type </th><th>  Description </th></tr><tr><td>  UID </td><td>  INTEGER </td><td>  Record ID in the table. </td></tr><tr><td>  UNAME </td><td>  VARCHAR (255) </td><td>  The name of the user account (login).  The program controls the uniqueness (within the table) of this field (case-insensitive — that is, if you have the user “admin”, you cannot create an account “AdMiN”). </td></tr><tr><td>  UPWD </td><td>  VARCHAR (255) </td><td>  User password (stored in clear text, because the md5 function is absent in the younger versions of FireBird, and the implementation of this algorithm in 1C is also voluminous - I didn’t want to “bother”). </td></tr><tr><td>  URIGHTS </td><td>  VARCHAR (255) </td><td>  User authority - a string of characters "0" and "1", which, being in the corresponding position, indicate the absence ("0") or the presence ("1") of the corresponding authority of the user. <br>  This version uses the following user rights: <br>  -Position 1 - the ability to view data; <br>  -Position 2 - the ability to edit data; <br>  -Position 3 - the ability to edit the list of users (administration) <br></td></tr></tbody></table><br>  Also in the database will be placed the following stored procedures: <br><table><tbody><tr><th>  Procedure name </th><th>  Parameter name </th><th>  Parameter type </th><th>  Description </th></tr><tr><td>  SAVE_GROUP </td><td colspan="3">  The procedure saves (adding or updating) a group to the database. </td></tr><tr><td rowspan="7"></td><td colspan="3">  <b>Input parameters:</b> </td></tr><tr><td>  GRID </td><td>  INTEGER </td><td>  ID of the group to be saved (0 if the group was not saved before) </td></tr><tr><td>  Pgraid </td><td>  INTEGER </td><td>  Parent Group ID </td></tr><tr><td>  GRNAME </td><td>  VARCHAR (255) </td><td>  Group name </td></tr><tr><td colspan="3">  <b>Output Parameters:</b> </td></tr><tr><td>  RESULT </td><td>  INTEGER </td><td>  The identifier of the saved group, if it was possible to save it; <br>  0 - if the group was not saved <br></td></tr><tr><td>  ERRMSG </td><td>  VARCHAR (255) </td><td>  Error message text if an error occurred (RESULT = 0) </td></tr><tr><td>  DELETE_GROUP </td><td colspan="3">  The procedure removes the group from the database. </td></tr><tr><td rowspan="5"></td><td colspan="3">  <b>Input parameters:</b> </td></tr><tr><td>  GRID </td><td>  INTEGER </td><td>  ID of the group to be deleted </td></tr><tr><td colspan="3">  <b>Output Parameters:</b> </td></tr><tr><td>  RESULT </td><td>  INTEGER </td><td>  ID of the deleted group, if it was deleted; <br>  0 - if the group has not been deleted <br></td></tr><tr><td>  ERRMSG </td><td>  VARCHAR (255) </td><td>  Error message text if an error occurred (RESULT = 0) </td></tr><tr><td>  MOVE_GROUP_TO_GROUP </td><td colspan="3">  The procedure transfers the specified group and all of its contents (subgroups and embedded cards) to another specified group. </td></tr><tr><td rowspan="6"></td><td colspan="3">  <b>Input parameters:</b> </td></tr><tr><td>  SRC_GRID </td><td>  INTEGER </td><td>  ID of the group to migrate </td></tr><tr><td>  DST_GRID </td><td>  INTEGER </td><td>  ID of the group to which the source group is to be transferred </td></tr><tr><td colspan="3">  <b>Output Parameters:</b> </td></tr><tr><td>  RESULT </td><td>  INTEGER </td><td>  Group ID (SRC_GRID), if it has been migrated; <br>  0 - if the group transfer did not take place (it was not transferred) <br></td></tr><tr><td>  ERRMSG </td><td>  VARCHAR (255) </td><td>  Error message text if an error occurred (RESULT = 0) </td></tr><tr><td>  MOVE_GROUP_CONTENTS_TO_GROUP </td><td colspan="3">  The procedure transfers the contents of the specified group (subgroups and embedded cards) to another specified group.  At the same time, the original group itself remains in its place. </td></tr><tr><td rowspan="6"></td><td colspan="3">  <b>Input parameters:</b> </td></tr><tr><td>  SRC_GRID </td><td>  INTEGER </td><td>  ID of the group whose contents you want to transfer </td></tr><tr><td>  DST_GRID </td><td>  INTEGER </td><td>  ID of the group to which the group contents should be transferred </td></tr><tr><td colspan="3">  <b>Output Parameters:</b> </td></tr><tr><td>  RESULT </td><td>  INTEGER </td><td>  Group identifier (SRC_GRID), if its content has been transferred; <br>  0 - if the group content transfer did not take place. <br></td></tr><tr><td>  ERRMSG </td><td>  VARCHAR (255) </td><td>  Error message text if an error occurred (RESULT = 0) </td></tr><tr><td>  MOVE_CARD_TO_GROUP </td><td colspan="3">  The procedure performs the transfer of the card to the specified group. </td></tr><tr><td rowspan="6"></td><td colspan="3">  <b>Input parameters:</b> </td></tr><tr><td>  SRC_CDID </td><td>  INTEGER </td><td>  ID of the card you want to transfer </td></tr><tr><td>  DST_GRID </td><td>  INTEGER </td><td>  ID of the group to which the card is to be transferred </td></tr><tr><td colspan="3">  <b>Output Parameters:</b> </td></tr><tr><td>  RESULT </td><td>  INTEGER </td><td>  Card ID (SRC_CDID), if it was transferred; <br>  0 - if the transfer of the card did not take place (it was not transferred) <br></td></tr><tr><td>  ERRMSG </td><td>  VARCHAR (255) </td><td>  Error message text if an error occurred (RESULT = 0) </td></tr><tr><td>  TEST_GROUP_PARENT_HIERARCHY </td><td colspan="3">  The procedure checks whether the PGRID group is hierarchical (possibly through several intermediate nodes) the parent of the GRID group or not.  This procedure is not called from the program, but is used in other procedures. </td></tr><tr><td rowspan="5"></td><td colspan="3">  <b>Input parameters:</b> </td></tr><tr><td>  GRID </td><td>  INTEGER </td><td>  Identifier of the group whose entry into the PGRID group should be checked </td></tr><tr><td>  Pgraid </td><td>  INTEGER </td><td>  ID of the group for which the GRID group is to be checked </td></tr><tr><td colspan="3">  <b>Output Parameters:</b> </td></tr><tr><td>  RESULT </td><td>  SMALLINT </td><td>  Result of checking: <br>  1 - if the PGRID group is the hierarchical parent of the GRID group; <br>  0 - if the PGRID group is not the parent of the GRID group <br></td></tr></tbody></table><br>  There will be no procedures for working with cards (SAVE_CARD, DELETE_CARD) and users (SAVE_USER, DELETE_USER).  We implement their functionality directly in 1C to show the call from 1C not only stored procedures, but also various queries. <br><br><h1>  Representation of information system entities in the program. </h1><br>  In our system there are the following informational entities: <br>  - contact reference <i>group</i> (a set of groups forming a tree (subtree) of groups - full or partial presentation of the GROUPS table data); <br>  - <i>an element (card) of</i> the contact directory (a set of cards - a full or partial presentation of the data in the CARDS table); <br>  - system <i>account</i> (set of accounts - full or partial presentation of USERS table data) <br><br>  The model is presented in 1C code by the following classes: <br>  - <i>BaseObj (Base Entity)</i> - class - an abstract parent for all other classes from this group.  Contains common fields and methods. <br>  - <i>ObjGroup (EntityGroup)</i> - a descendant from <i>BaseObj</i> , is an implementation of the “ <i>contact directory group</i> ” entity. <br>  - <i>ObjCard (Entity Card)</i> - a descendant from <i>BaseObj</i> , is an implementation of the entity " <i>contact directory entry</i> ". <br>  - <i>ObjUser (EntityUser)</i> - a descendant from <i>BaseObj</i> , is an implementation of the “ <i>system user</i> ” entity. <br>  - <i>ObjSet (Set of Objects)</i> is also a descendant from <i>BaseObj</i> , but is not an entity, but a universal collection of entities, which can represent a set of objects of any type (ObjGroup, ObjCard, ObjUser).  Naturally, you can not mix in the same set of entities of different types. <br><br>  The corresponding implementation of these classes in 1C will look like this: <br><div class="spoiler">  <b class="spoiler_title">Class code</b> <div class="spoiler_text"><pre><code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">/////////////////////////////////////////////////////////////////////////////////////////////////// // //                                    // /////////////////////////////////////////////////////////////////////////////////////////////////// //////////////////////////////////////////////////////////////////////////////// //    (BaseObj) //      . // // : // . // : //    //  BaseObj_()  BaseObj =  ; //    BaseObj.("ClassID", 0); //    (INT) BaseObj.("ChangeInfo", );//       BaseObj.("ErrMsg", ""); //     (STR) BaseObj.ClassID = .ClassIDs.CLN_UNKNOWN; //     BaseObj;  //   . // // : // ClassID -  ,  .   ,   //   -   // : // () -     //  BaseObj_(ClassID=0)  BaseObj = ;  ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup BaseObj = ObjGroup_()  ClassID = .ClassIDs.CLN_CARD  //  ObjCard BaseObj = ObjCard_()  ClassID = .ClassIDs.CLN_USER  //  ObjUser BaseObj = ObjUser_() ;  BaseObj =   //     BaseObj = BaseObj_(); ;  BaseObj;  //    -  . // // : // BaseObj -   ,     //  BaseObj_(BaseObj)   BaseObj.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup ObjGroup_(BaseObj)  BaseObj.ClassID = .ClassIDs.CLN_CARD  //  ObjCard ObjCard_(BaseObj)  BaseObj.ClassID = .ClassIDs.CLN_USER  //  ObjUser ObjUser_(BaseObj)   //      . // // : // BaseObj -    //  BaseObj_SetDefAttr(BaseObj)  BaseObj.ErrMsg = "";  BaseObj.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup ObjGroup_SetDefAttr(BaseObj)  BaseObj.ClassID = .ClassIDs.CLN_CARD  //  ObjCard ObjCard_SetDefAttr(BaseObj)  BaseObj.ClassID = .ClassIDs.CLN_USER  //  ObjUser ObjUser_SetDefAttr(BaseObj)   //     BaseObj2   BaseObj1. //     BaseObj1  . // // : // BaseObj1 -    // BaseObj2 -      //  BaseObj_Assign(BaseObj1, BaseObj2)   (BaseObj1 &lt;&gt; )  (BaseObj2 &lt;&gt; )  (BaseObj1.ClassID = BaseObj2.ClassID)  (BaseObj_IsEqual(BaseObj1, BaseObj2) = )   BaseObj1.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup ObjGroup_Assign(BaseObj1, BaseObj2)  BaseObj1.ClassID = .ClassIDs.CLN_CARD  //  ObjCard ObjCard_Assign(BaseObj1, BaseObj2)  BaseObj1.ClassID = .ClassIDs.CLN_USER  //  ObjUser ObjUser_Assign(BaseObj1, BaseObj2)    //     . // // : // BaseObj1 -    // BaseObj2 -      //  // ,   BaseObj2   ,   //  BaseObj1   -    //  BaseObj_IsEqual(BaseObj1, BaseObj2)   = ;  (BaseObj1 &lt;&gt; )  (BaseObj2 &lt;&gt; )  (BaseObj1.ClassID = BaseObj2.ClassID)   BaseObj1.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup  = ObjGroup_IsEqual(BaseObj1, BaseObj2)  BaseObj1.ClassID = .ClassIDs.CLN_CARD  //  ObjCard  = ObjCard_IsEqual(BaseObj1, BaseObj2)  BaseObj1.ClassID = .ClassIDs.CLN_USER  //  ObjUser  = ObjUser_IsEqual(BaseObj1, BaseObj2)  ;    //       . // // : // BaseObj1 -    // BaseObj2 -      //  // ,   BaseObj2     ,   //  BaseObj1   -    //  BaseObj_IsEqualKeys(BaseObj1, BaseObj2)   = ;  (BaseObj1 &lt;&gt; )  (BaseObj2 &lt;&gt; )  (BaseObj1.ClassID = BaseObj2.ClassID)   BaseObj1.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup  = ObjGroup_IsEqualKeys(BaseObj1, BaseObj2)  BaseObj1.ClassID = .ClassIDs.CLN_CARD  //  ObjCard  = ObjCard_IsEqualKeys(BaseObj1, BaseObj2)  BaseObj1.ClassID = .ClassIDs.CLN_USER  //  ObjUser  = ObjUser_IsEqualKeys(BaseObj1, BaseObj2)  ;    // ,        (), // ..     ,      . // // : // BaseObj -    //  // ,   BaseObj       -    //  BaseObj_IsKeyEmpty(BaseObj)   = ;  BaseObj &lt;&gt;    BaseObj.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup  = ObjGroup_IsKeyEmpty(BaseObj)  BaseObj.ClassID = .ClassIDs.CLN_CARD  //  ObjCard  = ObjCard_IsKeyEmpty(BaseObj)  BaseObj.ClassID = .ClassIDs.CLN_USER  //  ObjUser  = ObjUser_IsKeyEmpty(BaseObj)  ;    //      . // // : // BaseObj -    //  BaseObj_GetErrorMsg(BaseObj)   BaseObj.ErrMsg  //     . // // : // BaseObj -    //  //     //  BaseObj_GetChangeInfo(BaseObj)   BaseObj.ChangeInfo  //      //  . // // : // BaseObj -    // ChangeInfo -     //  BaseObj_SetChangeInfo(BaseObj, ChangeInfo)   BaseObj &lt;&gt;    BaseObj.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup ObjGroup_SetChangeInfo(BaseObj, ChangeInfo)  BaseObj.ClassID = .ClassIDs.CLN_CARD  //  ObjCard ObjCard_SetChangeInfo(BaseObj, ChangeInfo)  BaseObj.ClassID = .ClassIDs.CLN_USER  //  ObjUser ObjUser_SetChangeInfo(BaseObj, ChangeInfo)    //         DS. // // : // BaseObj -    // DS -    ADORecordSet // : // ,      ,    //  BaseObj_LoadFromDataSet(BaseObj, DS)   = ; //     BaseObj.ErrMsg = ""; //   ,        BaseObj.ClassID = .ClassIDs.CLN_GROUP  //  ObjGroup  = ObjGroup_LoadFromDataSet(BaseObj, DS)  BaseObj.ClassID = .ClassIDs.CLN_CARD  //  ObjCard  = ObjCard_LoadFromDataSet(BaseObj, DS)  BaseObj.ClassID = .ClassIDs.CLN_USER  //  ObjUser  = ObjUser_LoadFromDataSet(BaseObj, DS) ;    //////////////////////////////////////////////////////////////////////////////// //    (ObjSet) -    BaseObj // (  -  ClassID     , //     ) //      . // // : // . // : //    //  ObjSet_()  ObjSet = BaseObj_(); //    ObjSet.("ItemsList",  ); //      ObjSet;  //   . // // : // ClassID -  ,     . // : // () -     //  ObjSet_(ClassID=0)  ObjSet = ObjSet_(); ObjSet.ClassID = ClassID; //    ObjSet_SetDefAttr(ObjSet);  ObjSet;  //    -  . // // : // ObjSet -    //  ObjSet_(ObjSet)  ObjSet_Clear(ObjSet)  //      . // // : // ObjSet -    //  ObjSet_SetDefAttr(ObjSet)  ObjSet.ErrMsg = ""  //   Obj       ObjSet. // // : // ObjSet -     // Obj -   ,      // : // ,   Obj     ObjSet   -    //  ObjSet_TestItemForAdd(ObjSet, Obj)   = ; //    ObjSet.ErrMsg = "";  Obj &lt;&gt;    ObjSet.ClassID = Obj.ClassID  //             = ;     ObjSet.ItemsList   BaseObj_IsEqualKeys(, Obj)   = ;   ;      =   ObjSet.ErrMsg = "     "   ObjSet.ErrMsg = "     "   ObjSet.ErrMsg = "   " ;    //  -   . // // : // ObjSet -    // : //     //  ObjSet_GetCount(ObjSet)   ObjSet.ItemsList.()  //       Index (  0). // // : // ObjSet -    // Index -    // : //     (  Index)  ,  //    //  ObjSet_GetItemByIndex(ObjSet, Index)   = ; ObjSet.ErrMsg = "";  (Index &gt;= 0)  (Index &lt; ObjSet.ItemsList.())   = ObjSet.ItemsList[Index]  ObjSet.ErrMsg = "  "; ;    //       Index (  0), //     . // // : // ObjSet -     // Index -    // Obj -        // : // ,       ,  //     //  ObjSet_SetItemToIndex(ObjSet, Index, Obj)   = ; ObjSet.ErrMsg = "";  Obj &lt;&gt;    ObjSet.ClassID = Obj.ClassID   (Index &gt;= 0)  (Index &lt; ObjSet.ItemsList.())  // ,        //   BaseObj_IsKeyEmpty(Obj)  //    (  ) -       =    BaseObj_IsEqualKeys(ObjSet.ItemsList[Index], Obj)  //   ,      -    =   //     = ;     ObjSet.ItemsList   BaseObj_IsEqualKeys(, Obj)   = ;   ;      =   ObjSet.ErrMsg = "      "   ; //        //    -    BaseObj_Assign(ObjSet.ItemsList[Index], Obj)   ObjSet.ErrMsg = "      "   ObjSet.ErrMsg = "     "   ObjSet.ErrMsg = "   " ;    //    Obj  . // // : // ObjSet -     // Obj -     // : // ,       -    //  ObjSet_Add(ObjSet, Obj)   = ; ObjSet.ErrMsg = "";  Obj &lt;&gt;   //      ObjSet_TestItemForAdd(ObjSet, Obj)  //   ObjSet.ItemsList.(Obj); ObjSet.ChangeInfo = ;  =  //      ObjSet.ErrMsg = "   " ;    //       . // // : // ObjSet -    // Index -    (  0) // : // ,        -    //  ObjSet_Delete(ObjSet, Index)   = ; ObjSet.ErrMsg = "";  (Index &gt;= 0)  (Index &lt; ObjSet.ItemsList.())  BaseObj_(ObjSet.ItemsList[Index]); ObjSet.ItemsList.(Index);  =   ObjSet.ErrMsg = "  "; ;    //     . // // : // ObjSet -    // : //  ObjSet_Clear(ObjSet)   ObjSet.ItemsList.() &gt; 0    Item  ObjSet.ItemsList  BaseObj_(Item); ; ObjSet.ItemsList.(); ObjSet.ChangeInfo =    //      //       // // : // ObjSet -    // : //     //  ObjSet_GetChangeInfo(ObjSet)    ObjSet.ChangeInfo  // ,      Item  ObjSet.ItemsList   BaseObj_GetChangeInfo(Item)  ObjSet.ChangeInfo = ;    ;  ObjSet.ChangeInfo  //      //        ChangeInfo // // : // ObjSet -    // ChangeInfo -     //  ObjSet_SetChangeInfo(ObjSet, ChangeInfo)  ObjSet.ChangeInfo = ChangeInfo;   ChangeInfo    Item  ObjSet.ItemsList  BaseObj_SetChangeInfo(Item, ChangeInfo)    //        //       // // : // ObjSet -    // : //      //  ObjSet_GetErrorMsg(ObjSet)   ObjSet.ErrMsg = ""  // ,       Item  ObjSet.ItemsList   Item.ErrMsg &lt;&gt; ""  ObjSet.ErrMsg = Item.ErrMsg;    ;  ObjSet.ErrMsg  //       . // // : // ObjSet -    // : // ,        -    //  ObjSet_TestSet(ObjSet)   = ; //    ObjSet.ErrMsg = ""; //      (ObjSet.ClassID = .ClassIDs.CLN_GROUP)  (ObjSet.ClassID = .ClassIDs.CLN_CARD)  (ObjSet.ClassID = .ClassIDs.CLN_USER)  //     1=0  ObjSet.ItemsList.()-1  1 = ObjSet.ItemsList[1];  ObjSet.ClassID = 1.ClassID   = ;  2=1+1  ObjSet.ItemsList.()-1  2 = ObjSet.ItemsList[2];  BaseObj_IsEqualKeys(1, 2)   = ;   ;    ObjSet.ErrMsg = "    ";    //        ObjSet.ErrMsg = "        "    //     ObjSet.ErrMsg = "   " ; //      ObjSet.ErrMsg = ""   =  ;    //      DS.    . //          // (      )    //  . // : // ObjSet -    // DS -    ADORecordSet // RowCount -  ,        // ( RowCount=-1,         // ) // : //       //  ObjSet_LoadFromDataSet(ObjSet, DS, RowCount=-1)   = 0; ObjSet.ErrMsg = ""; ObjSet_Clear(ObjSet);  ObjSet.ErrMsg = ""   = ObjSet_AddFromDataSet(ObjSet, DS, RowCount) ;    //      DS,       . //          // (      )    //  . // : // ObjSet -    // DS -    ADORecordSet // RowCount -  ,        // ( RowCount=-1,         // ) // : //       //  ObjSet_AddFromDataSet(ObjSet, DS, RowCount=-1)   = 0; ObjSet.ErrMsg = "";  RowCount &lt;&gt; 0   (DS.EOF = 0)  ((RowCount &lt; 0)  ( &lt; RowCount))  //   Obj = BaseObj_(ObjSet.ClassID);  Obj &lt;&gt;   //       BaseObj_LoadFromDataSet(Obj, DS)  //     -      ObjSet_Add(ObjSet, Obj)  //       =  + 1  //        //     -   ObjSet.ErrMsg = Obj.ErrMsg; BaseObj_(Obj);    //     ObjSet.ErrMsg = "      " ; //     DS.MoveNext();  ;    //////////////////////////////////////////////////////////////////////////////// //    (ObjGroup) //      . // // : // . // : //    //  ObjGroup_()  ObjGroup = BaseObj_(); ObjGroup.ClassID = .ClassIDs.CLN_GROUP; //  ObjGroup //    ObjGroup.("GRID", ); //   (INT) ObjGroup.("PGRID", ); //    (INT) ObjGroup.("GRName", ); //   (STR)  ObjGroup;  //   . // // : // . // : // () -     //  ObjGroup_()  ObjGroup = ObjGroup_(); //    ObjGroup_SetDefAttr(ObjGroup);  ObjGroup;  //    -  . // // : // ObjGroup -    //  ObjGroup_(ObjGroup)   //      . // // : // ObjGroup -    //  ObjGroup_SetDefAttr(ObjGroup)  ObjGroup.GRID = 0; ObjGroup.PGRID = 0; ObjGroup.GRName = "";  //     ObjGroup2   ObjGroup1. //     ObjGroup1  . // // : // ObjGroup1 -    // ObjGroup2 -      //  ObjGroup_Assign(ObjGroup1, ObjGroup2)   (ObjGroup1 &lt;&gt; )  (ObjGroup2 &lt;&gt; )  (ObjGroup_IsEqual(ObjGroup1, ObjGroup2) = )  ObjGroup1.GRID = ObjGroup2.GRID; ObjGroup1.PGRID = ObjGroup2.PGRID; ObjGroup1.GRName = ObjGroup2.GRName; ObjGroup1.ChangeInfo =    //  ,   ObjGroup2   ,   //  ObjGroup1   -    // // : // ObjGroup1 -    // ObjGroup2 -       // : // ,      -    //  ObjGroup_IsEqual(ObjGroup1, ObjGroup2)  IsEqual = ;  (ObjGroup1 &lt;&gt; )  (ObjGroup2 &lt;&gt; )   (ObjGroup2.GRID = ObjGroup1.GRID)  (ObjGroup2.PGRID = ObjGroup1.PGRID)  (ObjGroup2.GRName = ObjGroup1.GRName)  IsEqual =  //      ;  IsEqual  //       . // // : // ObjGroup1 -    // ObjGroup2 -      //  // ,   ObjGroup2     ,   //  ObjGroup1   -    //  ObjGroup_IsEqualKeys(ObjGroup1, ObjGroup2)  IsEqual = ;  (ObjGroup1 &lt;&gt; )  (ObjGroup2 &lt;&gt; )   ((ObjGroup2.GRID = ObjGroup1.GRID)  (ObjGroup1.GRID &gt; 0))  IsEqual =  //      ;  IsEqual  // ,        (), // ..     ,      . // // : // ObjGroup -    //  // ,   ObjGroup       -    //  ObjGroup_IsKeyEmpty(ObjGroup)   = ; IsEmpty = ;  ObjGroup &lt;&gt;    ObjGroup.GRID &lt;= 0  IsEmpty =   ;  IsEmpty  //        . // // : // ObjGroup -    // GRID -   // PGRID -    // GRName -   //  ObjGroup_SetAttr(ObjGroup, GRID, PGRID, GRName)  //     ,  , //       TmpObjGroup = ObjGroup_(); TmpObjGroup.GRID = GRID; TmpObjGroup.PGRID = PGRID; TmpObjGroup.GRName = GRName; ObjGroup_Assign(ObjGroup, TmpObjGroup); ObjGroup_(TmpObjGroup);  //      //  . // // : // ObjGroup -    // ChangeInfo -     //  ObjGroup_SetChangeInfo(ObjGroup, ChangeInfo)  ObjGroup.ChangeInfo = ChangeInfo  //         DS. // // : // ObjGroup -    // DS -    ADORecordSet // : // ,      ,    //  ObjGroup_LoadFromDataSet(ObjGroup, DS)   = ; //     ObjGroup.ErrMsg = "";  ObjGroup.GRID = DS.Fields("GRID").Value; ObjGroup.PGRID = DS.Fields("PGRID").Value; ObjGroup.GRName = DS.Fields("GRNAME").Value; ObjGroup_SetChangeInfo(ObjGroup, ); //   , .. //       = ; //     //      ObjGroup.ErrMsg = ().; ;    //////////////////////////////////////////////////////////////////////////////// //    (ObjCard) //      . // // : // . // : //    //  ObjCard_()  ObjCard = BaseObj_(); ObjCard.ClassID = .ClassIDs.CLN_CARD; //  ObjCard //    ObjCard.("CDID", ); //   (INT) ObjCard.("GRID", ); //   (INT) ObjCard.("CDName", ); //   (STR) ObjCard.("CDDescript", ); //  (STR) ObjCard.("CDContacts", ); //   (STR) ObjCard.("CDNote", ); //  (STR) ObjCard.("CDImage", );//  () //  ,       BLOB- ObjCard.("ChangeCDContacts", );//     CDContacts ObjCard.("ChangeCDNote", ); //     CDNote ObjCard.("ChangeCDImage", ); //     CDImage  ObjCard;  //   . // // : // . // : // () -     //  ObjCard_()  ObjCard = ObjCard_(); //    ObjCard_SetDefAttr(ObjCard);  ObjCard;  //    -  . // // : // ObjCard -    //  ObjCard_(ObjCard)   //      . // // : // ObjCard -    //  ObjCard_SetDefAttr(ObjCard)  ObjCard.CDID = 0; ObjCard.GRID = 0; ObjCard.CDName = ""; ObjCard.CDDescript = ; ObjCard.CDContacts = ; ObjCard.CDNote = ; ObjCard.CDImage = ; ObjCard.ChangeCDContacts = ; ObjCard.ChangeCDNote = ; ObjCard.ChangeCDImage = ;  //     ObjCard2   ObjCard1. //     ObjCard1  . // // : // ObjCard1 -    // ObjCard2 -      //  ObjCard_Assign(ObjCard1, ObjCard2)   (ObjCard1 &lt;&gt; )  (ObjCard2 &lt;&gt; )  (ObjCard_IsEqual(ObjCard1, ObjCard2) = )  ObjCard1.CDID = ObjCard2.CDID; ObjCard1.GRID = ObjCard2.GRID; ObjCard1.CDName = ObjCard2.CDName; ObjCard1.CDDescript = ObjCard2.CDDescript;  ObjCard1.CDContacts &lt;&gt; ObjCard2.CDContacts  ObjCard1.CDContacts = ObjCard2.CDContacts; ObjCard1.ChangeCDContacts =  ;  ObjCard1.CDNote &lt;&gt; ObjCard2.CDNote  ObjCard1.CDNote = ObjCard2.CDNote; ObjCard1.ChangeCDNote =  ;   (ObjCard1.CDImage, ObjCard2.CDImage)  ObjCard1.CDImage= ObjCard2.CDImage; ObjCard1.ChangeCDImage =  ; ObjCard1.ChangeInfo =    //  ,   ObjCard2   ,   //  ObjCard1   -    // // : // ObjCard1 -    // ObjCard2 -       // : // ,      -    //  ObjCard_IsEqual(ObjCard1, ObjCard2)  IsEqual = ;  (ObjCard1 &lt;&gt; )  (ObjCard2 &lt;&gt; )   (ObjCard2.CDID = ObjCard1.CDID)  (ObjCard2.GRID = ObjCard1.GRID)  (ObjCard2.CDName = ObjCard1.CDName)  (ObjCard2.CDDescript = ObjCard1.CDDescript)  (ObjCard2.CDContacts = ObjCard1.CDContacts)  (ObjCard2.CDNote = ObjCard1.CDNote)  (ObjCard2.CDImage, ObjCard1.CDImage)  IsEqual =  //      ;  IsEqual  //       . // // : // ObjCard1 -    // ObjCard2 -      //  // ,   ObjCard2     ,   //  ObjCard1   -    //  ObjCard_IsEqualKeys(ObjCard1, ObjCard2)  IsEqual = ;  (ObjCard1 &lt;&gt; )  (ObjCard2 &lt;&gt; )   ((ObjCard2.CDID = ObjCard1.CDID)  (ObjCard1.CDID &gt; 0))  IsEqual =  //      ;  IsEqual  // ,        (), // ..     ,      . // // : // ObjCard -    //  // ,   ObjCard       -    //  ObjCard_IsKeyEmpty(ObjCard)   = ; IsEmpty = ;  ObjCard &lt;&gt;    ObjCard.CDID &lt;= 0  IsEmpty =   ;  IsEmpty  //        . // // : // ObjCard -    // CDID -   // GRID -   // GRName -   // CDDescript -  // CDContacts -   // CDNote -  // CDImage -  //  ObjCard_SetAttr(ObjCard, CDID, GRID, CDName, CDDescript = , CDContacts = , CDNote = , CDImage = )  //     ,  , //       TmpObjCard = ObjCard_(); TmpObjCard.CDID = CDID; TmpObjCard.GRID = GRID; TmpObjCard.CDName = CDName;  CDDescript &lt;&gt;   TmpObjCard.CDDescript = CDDescript; ;  CDContacts &lt;&gt;   TmpObjCard.CDContacts = CDContacts; ;  CDNote &lt;&gt;   TmpObjCard.CDNote = CDNote ;  CDImage &lt;&gt;   TmpObjCard.CDImage = CDImage; ; ObjCard_Assign(ObjCard, TmpObjCard); ObjCard_(TmpObjCard);  //      //  . // // : // ObjCard -    // ChangeInfo -     //  ObjCard_SetChangeInfo(ObjCard, ChangeInfo)  ObjCard.ChangeInfo = ChangeInfo;  ChangeInfo =   ObjCard.ChangeCDContacts = ; ObjCard.ChangeCDNote = ; ObjCard.ChangeCDImage =    //         DS. // // : // ObjCard -    // DS -    ADORecordSet // : // ,      ,    //  ObjCard_LoadFromDataSet(ObjCard, DS)   = ; //     ObjCard.ErrMsg = "";   ObjCard.CDID = DS.Fields("CDID").Value;  ;  ObjCard.GRID = DS.Fields("GRID").Value;  ;  ObjCard.CDName = DS.Fields("CDNAME").Value;  ;  ObjCard.CDDescript = DS.Fields("CDDESCRIPT").Value;  ;  ObjCard.CDContacts = DS.Fields("CDCONTACTS").Value;  ;  CDNoteArray = DS.Fields("CDNOTE").Value; ObjCard.CDNote = COMSafeArrayWIN1251_UTF8(CDNoteArray);  ;  CDImageArray = DS.Fields("CDIMAGE").Value; ObjCard.CDImage = COMSafeArray_(CDImageArray)  ; ObjCard_SetChangeInfo(ObjCard, ); //   , .. //       = ; //     //      ObjCard.ErrMsg = ().; ;    //////////////////////////////////////////////////////////////////////////////// //    (ObjUser) //      . // // : // . // : //    //  ObjUser_()  ObjUser = BaseObj_(); ObjUser.ClassID = .ClassIDs.CLN_USER; //  ObjUser //    ObjUser.("UID", ); //   (INT) ObjUser.("UName", ); //  (STR) ObjUser.("UPwd", ); //  (STR) ObjUser.("URights", ); //   (STR)  ObjUser;  //   . // // : // . // : // () -     //  ObjUser_()  ObjUser = ObjUser_(); //    ObjUser_SetDefAttr(ObjUser);  ObjUser;  //    -  . // // : // ObjUser -    //  ObjUser_(ObjUser)   //      . // // : // ObjUser -    //  ObjUser_SetDefAttr(ObjUser)  ObjUser.UID = 0; ObjUser.UName = ""; ObjUser.UPwd = ; ObjUser.URights = "";  //     ObjUser2   ObjUser1. //     ObjUser1  . // // : // ObjUser1 -    // ObjUser2 -      //  ObjUser_Assign(ObjUser1, ObjUser2)   (ObjUser1 &lt;&gt; )  (ObjUser2 &lt;&gt; )  (ObjUser_IsEqual(ObjUser1, ObjUser2) = )  ObjUser1.UID = ObjUser2.UID; ObjUser1.UName = ObjUser2.UName; ObjUser1.UPwd = ObjUser2.UPwd; ObjUser1.URights = ObjUser2.URights; ObjUser1.ChangeInfo =    //  ,   ObjUser2   ,   //  ObjUser1   -    // // : // ObjUser1 -    // ObjUser2 -       // : // ,      -    //  ObjUser_IsEqual(ObjUser1, ObjUser2)  IsEqual = ;  (ObjUser1 &lt;&gt; )  (ObjUser2 &lt;&gt; )   (ObjUser2.UID = ObjUser1.UID)  (ObjUser2.UName = ObjUser1.UName)  (ObjUser2.UPwd = ObjUser1.UPwd)  IsEqualUserRights(ObjUser2.URights, ObjUser1.URights)  IsEqual =  //      ;  IsEqual  //       . // // : // ObjUser1 -    // ObjUser2 -      //  // ,   ObjUser2     ,   //  ObjUser1   -    //  ObjUser_IsEqualKeys(ObjUser1, ObjUser2)  IsEqual = ;  (ObjUser1 &lt;&gt; )  (ObjUser2 &lt;&gt; )   ((ObjUser2.UID = ObjUser1.UID)  (ObjUser1.UID &gt; 0))  ((ObjUser2.UName) = (ObjUser1.UName))  IsEqual =  //      ;  IsEqual  // ,        (), // ..     ,      . // // : // ObjUser -    //  // ,   ObjUser       -    //  ObjUser_IsKeyEmpty(ObjUser)   = ; IsEmpty = ;  ObjUser &lt;&gt;    (ObjUser.UID &lt;= 0)  ((ObjUser) = "")  IsEmpty =   ;  IsEmpty  //        . // // : // ObjUser -    // UID -   // UName -   // UPwd -   // URights -   //  ObjUser_SetAttr(ObjUser, UID, UName, UPwd, URights)  //     ,  , //       TmpObjUser = ObjUser_(); TmpObjUser.UID = UID; TmpObjUser.UName = UName; TmpObjUser.UPwd = UPwd; TmpObjUser.URights = URights; ObjUser_Assign(ObjUser, TmpObjUser); ObjUser_(TmpObjUser);  //      //  . // // : // ObjUser -    // ChangeInfo -     //  ObjUser_SetChangeInfo(ObjUser, ChangeInfo)  ObjUser.ChangeInfo = ChangeInfo  //         DS. // // : // ObjUser -    // DS -    ADORecordSet // : // ,      ,    //  ObjUser_LoadFromDataSet(ObjUser, DS)   = ; //     ObjUser.ErrMsg = "";  ObjUser.UID = DS.Fields("UID").Value; ObjUser.UName = DS.Fields("UNAME").Value; //ObjUser.UPwd = DS.Fields("UPWD").Value; //     ObjUser.UPwd = ; ObjUser.URights = DS.Fields("URIGHTS").Value; ObjUser_SetChangeInfo(ObjUser, ); //   , .. //       = ; //     //      ObjUser.ErrMsg = ().; ;   </span></span></code> </pre> <br></div></div><br><br><h1>  Work with the database.  ADO technology. </h1><br>  To access the database, we use the technology that is most well described on the Internet in relation to 1C - “ <i>Microsoft ADO</i> ”.  And this is of course reasonable, because  This technology is the most stable available on Windows computers.  This not only concerns 1C, but also other development tools, for example, “ <i>Visual Studio</i> ”.  These are <i>Delphi</i> programmers accustomed to a variety of database technologies.  For other developers, the choice of tools is more limited.  I will not describe ADO as such, as there are a lot of excellent articles on the Internet that have accumulated over the past 10-15 years.  We will look at the interfaces and data types that we need for the implementation described in this article (see the MSDN documentation for details). <br><table><tbody><tr><th>  Interface name </th><th>  Description </th><th>  Used properties and methods </th></tr><tr><td>  Connection </td><td>  Provides a connection to the database. </td><td>  <b>State</b> (property) - shows the current connection status (established or not); <br><br>  <b>Open</b> (method) - allows you to connect to the database; <br>  <b>Close</b> (method) - performs disconnection from the database <br></td></tr><tr><td>  Command </td><td>  It provides the execution of commands (we are only interested in SQL queries) within the specified connection (Connection). </td><td>  <b>ActiveConnection</b> (property) - indicates the connection with which the command execution object is connected; <br>  <b>CommandType</b> (property) - indicates the type of command (we are interested in the type - "SQL query"); <br>  <b>CommandText</b> (property) - command text (in our case - request text); <br>  <b>Parameters</b> (property) - a collection of command parameters (query) for transmitting data to the database; <br><br>  <b>Execute</b> (method) - executes the command (request).  Returns the result dataset; <br>  <b>CreateParameter</b> (method) - allows you to create a new command parameter (query) <br></td></tr><tr><td>  Recordset </td><td>  The data set (table) resulting from the query.  Provides data transfer from the database to the client application. </td><td>  <b>State</b> (property) - shows the status of the data set (available or not); <br>  <b>EOF</b> (property) - a sign of the end of the data set (indicates whether the internal pointer is on the last row of the set or not); <br>  <b>Fields</b> (property) - collection of fields - access to the columns of the current row of the set; <br><br>  <b>MoveNext</b> (method) - shifts the internal set pointer by one line towards the end of the set; <br>  <b>Close</b> (method) - closes the dataset <br></td></tr><tr><td>  Fields </td><td>  A collection of fields that provides access to the fields of the current row in the dataset. </td><td>  <b>Fields (FieldInd)</b> , <b>Fields (FieldName)</b> - access to a specific field Field by its index (sequence number) or by name (string value of the field name) </td></tr><tr><td>  Field </td><td>  A field that provides access to the column in the current row of the dataset. </td><td>  <b>Value</b> (property) - field value (gives access to the value of the corresponding column in the current row of the associated Recordset) </td></tr><tr><td>  Parameters </td><td>  A collection of values ​​representing query parameters — for transferring data from a client application to the database. </td><td>  <b>Count</b> (property) - shows the number of parameters in the collection; <br><br>  <b>Append</b> (method) - adds a parameter to the end of the collection; <br>  <b>Delete</b> (method) - removes the specified parameter from the collection <br></td></tr></tbody></table><br>  A full description of the ADO data types used in this program is given below: <br><div class="spoiler">  <b class="spoiler_title">Implementing enumerated types</b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//   ,    COM- ADO // // : // . // // : //    -      ADO //  ADO()  ADO =  ; //         Connection, Record  Stream ConnectModeEnum =  ; ConnectModeEnum.("adModeRead", 1); //   "  " ConnectModeEnum.("adModeReadWrite", 3); //   "  " ConnectModeEnum.("adModeRecursive", 4194304); // ConnectModeEnum.("adModeShareDenyNone", 16); //   "       " ConnectModeEnum.("adModeShareDenyRead", 4); //   "     " ConnectModeEnum.("adModeShareDenyWrite", 8); //   "     " ConnectModeEnum.("adModeShareExclusive", 12); //   "  -   " ConnectModeEnum.("adModeUnknown", 0); // ConnectModeEnum.("adModeWrite", 2 ); //   "  " ADO.("ConnectModeEnum", ConnectModeEnum); //     Command (,     ) CommandTypeEnum =  ; CommandTypeEnum.("adCmdUnspecified", -1); //     CommandTypeEnum.("adCmdText", 1); //   CommandText  //   SQL-, //   CommandTypeEnum.("adCmdTable", 2); //   CommandText  //  ,   //     SQL- CommandTypeEnum.("adCmdStoredProc", 4); //   CommandText  //   , //   CommandTypeEnum.("adCmdUnknown", 8); //      //  (adCmdText, adCmdTable, adCmdStoredProc) //     CommandText CommandTypeEnum.("adCmdFile", 256); //   CommandText  //  ,   //     Recordset CommandTypeEnum.("adCmdTableDirect", 512);//   CommandText  //  ,   //    ,  SQL- ADO.("CommandTypeEnum", CommandTypeEnum); //      , : Field, Parameter  Property DataTypeEnum =  ; DataTypeEnum.("AdArray", 8192); //    , ,    ( "" ) DataTypeEnum.("adBigInt", 20); // 64-    DataTypeEnum.("adBinary", 128); //   DataTypeEnum.("adBoolean", 11); //  DataTypeEnum.("adBSTR", 8); //  ,    Null (  Unicode) DataTypeEnum.("adChapter", 136); // DataTypeEnum.("adChar", 129); //   DataTypeEnum.("adCurrency", 6); //  . 8-   ,  10000 DataTypeEnum.("adDate", 7); // .  ,  - ,   12/30/1899 DataTypeEnum.("adDBDate", 133); //      DataTypeEnum.("adDBTime", 134); //      DataTypeEnum.("adDBTimeStamp", 135); //            DataTypeEnum.("adDecimal", 14); //         DataTypeEnum.("adDouble", 5); //       DataTypeEnum.("adEmpty", 0); //   (  ) DataTypeEnum.("adError", 10); // 32-    DataTypeEnum.("adFileTime", 64); // 64-  ,  -   100,   01/01/1601 DataTypeEnum.("adGUID", 72); //    GUID DataTypeEnum.("adIDispatch", 9); //    COM- IDispatch.    -  . DataTypeEnum.("adInteger", 3); // 32-    DataTypeEnum.("adIUnknown", 13); //    COM- IUnknown.    -  . DataTypeEnum.("adLongVarBinary", 205); //    (   Parameter) DataTypeEnum.("adLongVarChar", 201); //    (   Parameter) DataTypeEnum.("adLongVarWChar", 203); //   ,   Null -  Unicode (   Parameter) DataTypeEnum.("adNumeric", 131); //     DataTypeEnum.("adPropVariant", 138); // DataTypeEnum.("adSingle", 4); //       DataTypeEnum.("adSmallInt", 2); // 16-    DataTypeEnum.("adTinyInt", 16); // 8-    DataTypeEnum.("adUnsignedBigInt", 21); // 64-    DataTypeEnum.("adUnsignedInt", 19); // 32-    DataTypeEnum.("adUnsignedSmallInt", 18); // 16-    DataTypeEnum.("adUnsignedTinyInt", 17); // 8-    DataTypeEnum.("adUserDefined", 132); //    DataTypeEnum.("adVarBinary", 204); //   (   Parameter) DataTypeEnum.("adVarChar", 200); //   (   Parameter) DataTypeEnum.("adVariant", 12); //  .    -  . DataTypeEnum.("adVarNumeric", 139); //     (   Parameter) DataTypeEnum.("adVarWChar", 202); //   Unicode,   Null (   Parameter) DataTypeEnum.("adWChar", 130); //   Unicode,   Null ADO.("DataTypeEnum", DataTypeEnum); //       ParameterDirectionEnum =  ; ParameterDirectionEnum.("adParamInput", 1); //   ParameterDirectionEnum.("adParamInputOutput", 3);//     ParameterDirectionEnum.("adParamOutput", 2); //   ParameterDirectionEnum.("adParamReturnValue", 4);// -  ParameterDirectionEnum.("adParamUnknown", 0); //    ADO.("ParameterDirectionEnum", ParameterDirectionEnum); //    (   )     //  ,      ObjectStateEnum =  ; ObjectStateEnum.("adStateClosed", 0); // ,    ObjectStateEnum.("adStateOpen", 1); // ,    ObjectStateEnum.("adStateConnecting", 2); // ,    ObjectStateEnum.("adStateExecuting", 4); // ,     ObjectStateEnum.("adStateFetching", 8); // ,     ADO.("ObjectStateEnum", ObjectStateEnum); //       Stream StreamTypeEnum =  ; StreamTypeEnum.("adTypeBinary", 1); //   StreamTypeEnum.("adTypeText", 2); //  ,  //  ,   Stream.Charset ADO.("StreamTypeEnum", StreamTypeEnum); //         Stream SaveOptionsEnum =  ; SaveOptionsEnum.("adSaveCreateNotExist", 1); //  ,       SaveOptionsEnum.("adSaveCreateOverWrite",2); //     ,     // (  ,  ) ADO.("SaveOptionsEnum", SaveOptionsEnum);  ADO </span></span></code> </pre><br></div></div><br><h1>  Work with the database.  Subprograms on 1C. </h1><br>  For the convenience of users with several databases, “ <i>Connection Profiles</i> ” are provided, i.e.  groups of parameters associated with the database, united under one name.  Most often these are the parameters for connecting to the DBMS (the address of the database server, the name of the database, the login and password for connecting to the database at the DBMS level), but it is possible to add some other parameters <br>  For working with profiles, there are classes: “ <i>Connection Profile KBase</i> ” and “ <i>Connection Profiles KDB</i> ” in the main processing module, as well as the form “ <i>Setting Connection Profiles</i> ”, which implements the dialog for editing profiles.  All this can be seen in the demo.  The scope of this functionality is a program to access any external database on any DBMS. <br><br>  The main class for working with the database is the <i>ConnectionCBase</i> class.  It allows you to connect to disconnect to the database and execute queries. <br><br>  Also a convenient aid is the " <i>Set Parameters Request</i> " class.  This set allows you to conveniently embed various values ​​into the text of SQL queries.  We prepare a request template, add named values ​​(parameters) to the set, and then process the request text template, which contains instructions on where to insert a particular request value.  The set processes the request template, inserts specific values ​​into it, and thus receives the final text of the request.  In the query template, the place where the parameter value is substituted is indicated as <b>: parameter_name</b> (a colon, and then the name of the parameter — this is done in Delphi). <br>  Here is how it looks in an example: <br><pre> <code class="1c hljs"> = _(); ... <span class="hljs-comment"><span class="hljs-comment">//   //   QSelectGroupTmpl = "SELECT grid, pgid, grname FROM groups WHERE grid = :grid;"; //      _(.); //       grid   10 _(, "grid", 10); //    –     //      grid  20.   - 1  _(, "grid", 20); //    –    –  //    – //  : "SELECT grid, pgid, grname FROM groups WHERE grid = 20;"  = _(, QSelectGroupTmpl);</span></span></code> </pre><br>  In more detail, the use of this mechanism (query templates) can be viewed in a demo example in <i>subcategories of the</i> “ <i>Sub-Base</i> ” class, starting with the “ <i>Sub-Base_SelectGroup</i> ” function. <br><br>  The set of parameters analyzes the type of value (it understands "Undefined", "Number", "String", "Date", "Boolean") and substitutes the values ​​in the query in the syntax correct for this DBMS. <br><br>  The source code of the class " <i>SetParameter SetInquiry</i> ": <br><div class="spoiler">  <b class="spoiler_title">Source text</b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//////////////////////////////////////////////////////////////////////////////// //    () //      . // // : // . // : //    //  _()   =  ; .("",  ); //    ;  //   . // // : // . // : // () -     //  _()   = _();  ;  //    -  . // // : //  -    //  _()  _()  //    .    ,    // // : //  -    //  -   (  ) //  -    //  _(,  ,  )   ( &lt;&gt; )  (() = (""))  (() &lt;&gt; "")   = (); //         .   (.) = ()  //   -   . = ;   ; //     =  ; .("", ); .("", ); ..()   //      // // : //  -    // : //     //  _()   ..()  //    -      // // : //  -    //  _()  ..()  //       // (? -   , * -  -  ) //   SQL- Like (  _  %) // // : //  -      : ?  * // : //      : _  % //  _Like( )   = "";  ( &lt;&gt; )  (() = (""))  ( &lt;&gt; "")   = ;  = (, "_", "");  = (, "%", "");  = (, "?", "_");  = (, "*", "%"); ;    //     ,     // SQL- FireBird // -           // -     0  1 // -      dd.mm.yyyy hh:mm:ss,    // -          // -    Null   NULL // // : //  -  // : //   ,       //  _( )   = "";  ( = )  ( = Null)   = "NULL"   () = ("")  //    = (, "=0; ='.'; =''")   () = ("")  //  -   = "'" + (, "='dd.MM.yyyy HH:mm:ss'") + "'"   () = ("")  //    = (, "=0; =1")   () = ("")  //    = (, "'", "''"); //   = "'" +  + "'"     ;    //     ,     . // // : //  -    //  -  ,       ":_" // : //   ,     //  _(,  )   = "";  ( &lt;&gt; )  (() = (""))  ( &lt;&gt; "")   = ;     .   = (, ":" + ., _(.))  ;   </span></span></code> </pre><br></div></div><br>  So, let us consider, finally, the main class of working with the database - the class “Connecting BaseBase”. <br>  The class has the following subroutines: <br><table><tbody><tr><th>  Subprogram name </th><th>  Description </th><th>  Note </th></tr><tr><td colspan="3">  <b>General purpose subprogram group.</b>  <b>Here, the object constructor, subroutines for connecting to the database and disconnecting from the database, as well as subprograms that return the current values ​​of the general properties of the object.</b> </td></tr><tr><td>  SubCBase_CreateObject () function </td><td>  Creating an object structure </td><td></td></tr><tr><td>  Sub BaseB_Constructor function () </td><td>  Object constructor </td><td></td></tr><tr><td>  _() </td><td>   </td><td></td></tr><tr><td>  _GetDBAddr() </td><td>     </td><td></td></tr><tr><td>  _GetDBUserName() </td><td>     ,     </td><td></td></tr><tr><td>  _GetConnect() </td><td>       </td><td></td></tr><tr><td>  _ConnectToDB(, FBDBAddr, FBUserName, FBUserPass) </td><td>      </td><td></td></tr><tr><td>  _Disconnect() </td><td>     </td><td></td></tr><tr><td>  _GetUserRegister() </td><td>     </td><td></td></tr><tr><td>  _RegisterUser (, UserName, UserPass) </td><td>    </td><td>       </td></tr><tr><td>  _UnregisterUser() </td><td>     </td><td></td></tr><tr><td>  _GetRegLogin() </td><td>     ,    </td><td></td></tr><tr><td>  _GetUserID() </td><td>           </td><td></td></tr><tr><td>  _GetUserName() </td><td>           </td><td></td></tr><tr><td>  _GetUserRights() </td><td>      </td><td></td></tr><tr><td>  _TestUserRight(, RightIndex) </td><td> ,       </td><td></td></tr><tr><td>  _GetErrorMsg() </td><td>      . </td><td></td></tr><tr><td colspan="3"> <b> ,      ADO –     -   .        (   ).</b> </td></tr><tr><td>  _ClearCommandParameters() </td><td>     ADODB.Command </td><td></td></tr><tr><td>  _ExecSQL(, ) </td><td>  SQL-,  <br>    <br></td><td></td></tr><tr><td>  _GetRecordSet(, ) </td><td>  SQL-,  <br>    <br></td><td></td></tr><tr><td>  _CheckRestConnect(, =) </td><td>      . </td><td></td></tr><tr><td colspan="3"> <b>          ,     .        .</b> </td></tr><tr><td>  _CheckRights(, RightsMask="") </td><td>        . </td><td></td></tr><tr><td>  _SelectDataSet(, , DstDataSet, RightsMask="") </td><td>           </td><td></td></tr><tr><td>  _SelectSingleVal(, , OutVal, OutValName, RightsMask="") </td><td>          </td><td></td></tr><tr><td>  _SelectPair(, , OutVal1, OutVal2, OutValName1, OutValName2, RightsMask="") </td><td>         </td><td></td></tr><tr><td>  _SelectList(, , List, RightsMask="") </td><td>           </td><td></td></tr><tr><td>  _SelectListPair(, , List, RightsMask="") </td><td>            </td><td></td></tr><tr><td>  _SelectObject(, , Obj, RightsMask="") </td><td>          </td><td></td></tr><tr><td>  _SelectObjects(, , ClassID, ObjectsSet, RightsMask="") </td><td>           </td><td></td></tr><tr><td>  _WriteQuery(, , RightsMask="") </td><td>           </td><td></td></tr><tr><td colspan="3"> <b>   ,            .</b> </td></tr><tr><td>  _SelectGroup(, GRID, ObjGroup) </td><td>     </td><td></td></tr><tr><td>  _SelectGroups(, PGRID, ObjSetGroups) </td><td>   ,     </td><td></td></tr><tr><td>  _SelectCard(, CDID, ObjCard) </td><td>        </td><td></td></tr><tr><td>  _SelectCardsNames(, GRID, ObjSetCards) </td><td>   ,     </td><td>     (BLOB-  ) </td></tr><tr><td>  _SelectUser(, UID, ObjUser) </td><td>     </td><td></td></tr><tr><td>  _SelectUsers(, ObjSetUsers) </td><td>    —    </td><td></td></tr><tr><td>  _SaveGroup(, ObjGroup) </td><td>     —  INSERT     UPDATE    </td><td></td></tr><tr><td>  _DeleteGroup(, GRID) </td><td>         (  ) </td><td></td></tr><tr><td>  _SaveCard(, ObjCard) </td><td>     —  INSERT     UPDATE   . </td><td></td></tr><tr><td>  _DeleteCard(, CDID) </td><td>      </td><td></td></tr><tr><td>  _MoveGroupToGroup(, SrcGRID, DstGRID) </td><td>          .        . </td><td></td></tr><tr><td>  _MoveGroupContentsToGroup(, SrcGRID, DstGRID) </td><td>       .        . </td><td></td></tr><tr><td>  _MoveCardToGroup(, SrcCDID, DstGRID) </td><td>      . </td><td></td></tr><tr><td>  _UpdatePassword(, OldPassword, NewPassword) </td><td>   (  )    . </td><td></td></tr><tr><td>  _SaveUsers(, ObjSetUsers, DelUsersIDs) </td><td>      —  INSERT     UPDATE <br>   .     —  DELETE. <br></td><td></td></tr></tbody></table><br>   ,      ADO: <br> — <i>     (     ,    ) –  «_ConnectToDB», «_RegisterUser»</i> . <br>      (        ,       ): <br> —     « <i>ADODB.Connection</i> »; <br> —     « <i>ADODB.Command</i> »   .    –    SQL- (CommandType = CommandTypeEnum.adCmdText).    (,    ..)   ; <br> —   ,         (         ). <br>                .      ,            . <br>    : <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//      // // : //  -    // FBDBAddr -    (   ) // FBUserName -    // FBUserPass -    // : // ,      -    //  _ConnectToDB(, FBDBAddr, FBUserName, FBUserPass)  //       QGetTab = "SELECT RDB$RELATION_NAME AS tabname FROM RDB$RELATIONS " + "WHERE ((RDB$SYSTEM_FLAG = 0)AND(RDB$VIEW_SOURCE IS NULL)) " + "ORDER BY RDB$RELATION_NAME;";  = ; .FBDBAddr = FBDBAddr; //  .FBUserName = FBUserName; //  .FBUserPass = FBUserPass; //    .FBSrvConn = ; //     .FBCommand = ; //       .IsDBConnect = ; //    .LastTestTime = 0; //     _UnregisterUser(); //    .ErrMsg = ""; //    //      FireBird _Driver = "driver={" + "Firebird/InterBase(r) driver" + "}"; _UID = "uid=" + FBUserName; _PWD = "pwd=" + FBUserPass; _DataBase = "database=" + FBDBAddr;  = _Driver + ";" + _UID + ";" + _PWD + ";" + _DataBase;  //   .FBSrvConn =  COM("ADODB.Connection"); //   .FBSrvConn.open(); .IsDBConnect = ; //      .FBCommand =  COMObject("ADODB.Command"); .FBCommand.ActiveConnection = .FBSrvConn; .FBCommand.NamedParameters = True; .FBCommand.CommandType = ADO.CommandTypeEnum.adCmdText; //      // ,      = QGetTab;  .FBCommand.CommandText = ;  = .FBCommand.Execute();   =  ;   &lt;&gt;    .State = ADO.ObjectStateEnum.adStateOpen    =  ; //     .EOF = 0  .((.Fields("TABNAME").Value)); //     .MoveNext(); ; //       TabName  .QTabsLst   .(TabName) =   //       .ErrMsg = "   " + TabName + "  ";   ;  //       .ErrMsg = "     "   //       .ErrMsg = "     "; ; //    .Close();  =   //       .ErrMsg = "     " ;  //   .ErrMsg = "     FireBird: " + () ;  .ErrMsg = ""  //    -    =   //     -  _Disconnect() ;  ;  //    -   //    UserName   UserPass    //  . // // : //  -    // UserName -   // UserPass -   // : // ,     // (     )   -    //  _RegisterUser(, UserName, UserPass)  //        QGetUsr = "SELECT * FROM USERS WHERE " + "((UPPER(UNAME COLLATE PXW_CYRL) = :upname)OR(UNAME = :name)) AND (UPWD = :pass);";  = ; .ErrMsg = ""; //     .IsDBConnect  //   -     _UnregisterUser(); //     //     //     _(.); _(., "upname", (UserName)); _(., "name", UserName); _(., "pass", UserPass);  = _(., QGetUsr);  .FBCommand.CommandText = ;  = .FBCommand.Execute();   =  ;   &lt;&gt;    (.State = ADO.ObjectStateEnum.adStateOpen)  (.EOF = 0)   .UID = .Fields("UID").Value; .UName = .Fields("UNAME").Value; .Rights = .Fields("URIGHTS").Value;  ; .IsRegister =  ; //    .Close();  =  ;  .IsRegister  //    .RegLogin = UserName; .RegPass = UserPass;  =   //    .UID = 0; .UName = ""; .Rights = "";  .ErrMsg = ""  .ErrMsg = "  "    //    .ErrMsg = "  " ;   </span></span></code> </pre><br></div></div><br> — <i>      (     ,    ) –  «_Disconnect», «_UnregisterUser»</i> . <br>               «  » <br>          « <i>ADODB.Command</i> »,      « <i>ADODB.Connection</i> » (         TCP)    ; <br>    : <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//     // // : //  -    //  _Disconnect()  //    _UnregisterUser(); //     .IsDBConnect = ; .LastTestTime = 0; .FBCommand = ;  .FBSrvConn &lt;&gt;    .FBSrvConn.State = ADO.ObjectStateEnum.adStateOpen  .FBSrvConn.Close() ; .FBSrvConn = ;   //     // // : //  -    //  _UnregisterUser()  .IsRegister = ; .RegLogin = ""; .RegPass = ""; .UID = 0; .UName = ""; .Rights = ""; </span></span></code> </pre><br></div></div><br> — <i>       –  «_ExecSQL», «_GetRecordSet», «_CheckRestConnect»</i> . <br>        « <i>ADODB.Command</i> »,      –   « <i>Execute</i> ».        « <i>ADODB.Recordset</i> »   . <br>     .    :              (15-20 .),   ( TCP-)      .     ,       –      (         ),    ,    .        .   ,   . <br>        .        «»,      –       .   ,     ()   ,   .   ,       (   localhost, ..      ,     ,    ). <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The communication protocol between the database server and its client does not provide for any additional confirmation requests (sometimes called NOP requests) of the physical TCP connection health, which would periodically run in the background (for example, from the server to the client, the request for a connection, and back answer). In general, Firebird provides so-called. DUMMY-packages (in principle, this should be exactly what I described above), but they are disabled by default in the server configuration. Moreover, there is a postscript in the comments of the “config” that it is impossible to turn it on, otherwise Windows may crash. In confirmation, there is a link to an article from the Microsoft website that talks about such problems when using sockets too heavily (why sockets are used so much by DUMMY packages ???), and, moreover, for Windows 2000 only,and even then only before installing the appropriate KB-update. However, a comment about the inadmissibility of enabling DUMMY-mode passes through all versions of FireBird (maybe it is not only in the newest ones).</font></font><br>  ,     FireBird ,       (  )   TCP- (   ASK-   TCP),       SO_KEEPALIVE. , -,   «KEEP ALIVE» (  Windows  )     2-      (   15-20.,     ).  -,   ,      ,        , ..  ASK-     .  ,    . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But it is clear how to solve this problem. When executing each request, we will evaluate the existence of the connection, and if it is broken, we will try to restore it (reopen) imperceptibly (in the background) from the query execution routine itself. Let's call a subroutine that monitors the presence of the connection (and attempt to restore it) " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Function SubCB_CheckRestConnect</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". It will return “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” if the connection exists (or it was possible to reopen it while the function is running) and “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” if the connection cannot be restored at all (in this case the request will not be completed and the user interface of the program should handle the situation loss of connection). How does </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CheckRestConnect</font></font></i> »       ,        ,   «ADODB.Command»?   –   ,         InterBase/FireBird,   «SELECT 1 FROM RDB$DATABASE».     ,        .  « <i>CheckRestConnect</i> »     .  « <i>CheckRestConnect</i> »      ,   ,      2  (   + 1 )      .          « <i>CheckRestConnect</i> »,           –    5. ,    ,    . ,      « <i>_ExecSQL</i> »  « <i>_GetRecordSet</i> »,  « <i>CheckRestConnect</i> »    2-  (  1-   ,   2- ).     ,     (   5.) -  ,   « <i>CheckRestConnect</i> »     ,      .   ,   « <i>CheckRestConnect</i> »   . <br>    : <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source text</font></font></b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//  SQL-       //    ( ,   ). //  ,      -    // // : //  -    //  -     // : // ,      -    //  _ExecSQL(, )  .ErrMsg = ""; //      = ;  _CheckRestConnect()   .FBCommand.CommandText = ; .FBCommand.Execute(); //     = ;  //    .ErrMsg = "  : " + (); // ,   -     _CheckRestConnect(, )   .FBCommand.CommandText = ; .FBCommand.Execute(); //     = ;  //    .ErrMsg = "  : " + ();    ;    //  SQL-      //     ( ,    //  ). // // : //  -    //  -     // : //    ,      //  _GetRecordSet(, )  .ErrMsg = ""; //      = ;  _CheckRestConnect()   .FBCommand.CommandText = ;  = .FBCommand.Execute();  //    .ErrMsg = "  : " + (); // ,   -     _CheckRestConnect(, )   .FBCommand.CommandText = ;  = .FBCommand.Execute();  //    .ErrMsg = "  : " + ();    ;    //       FireBird // (   ).    ,    . //  ,      -    // // : //  -    //  -  (),     , //          // (5 .) // : // ,        -    //  _CheckRestConnect(, =) //     QTestConnect = "SELECT 1 FROM RDB$DATABASE;"; .ErrMsg = ""; //      = ;  (.FBSrvConn &lt;&gt; )  .IsDBConnect  //      = 300000; //   ( ),   = ();    (.LastTestTime = )  (.LastTestTime = 0)  ( - .LastTestTime &gt;= )  //       .FBCommand.CommandText = QTestConnect; .FBCommand.Execute(); //    .LastTestTime = ;  =   //    -   //    FBDBAddr = .FBDBAddr; //  FBUserName = .FBUserName; //  FBUserPass = .FBUserPass; //    IsRegister = .IsRegister; //  UserName = .RegLogin; //   UserPass = .RegPass; //    _Disconnect(); //     _ConnectToDB(, FBDBAddr, FBUserName, FBUserPass)  //   -      IsRegister   _RegisterUser(, UserName, UserPass)  //    -   .LastTestTime = ;  =   //    -    _Disconnect();   //     -   .LastTestTime = ;  =      //        =    //      .ErrMsg = "   "; ;   </span></span></code> </pre><br></div></div><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Auxiliary routines for working with BLOB-parameters. </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In InterBase / FireBird, there are 2 types of blob fields: TEXT and BINARY. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TEXT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is essentially the same as MEMO in other DBMSs. </font><font style="vertical-align: inherit;">This is an indeterminate text that is stored separately from the main table. </font><font style="vertical-align: inherit;">You can work with him through ADO as well as with CHAR / VARCHAR - as with a text string (all transcoding is performed automatically). </font><font style="vertical-align: inherit;">At the SQL level, you can make comparisons with other text strings (comparison operators and LIKE). </font><font style="vertical-align: inherit;">There is one such field in our database - this is “CARDS.CDCONTACTS”. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BINARY</font></font></b> –   BLOB,    .     ,      .     1   («ADO.Recordset», «ADO.Parameters»)       COMSafeArray (     ). <br>       ,        .          –  «CARDS.CDNOTE».      ,      –     .        WIN-1251,   1   «» –   UTF-8.       : <br><pre> <code class="1c hljs">WIN1251_UTF8 UTF8_WIN1251 COMSafeArrayWIN1251_UTF8 UTF8_COMSafeArrayWIN1251</code> </pre><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//     (  Windows-1251) //    1C ( UTF-8) // // : // WIN1251 -      Windows-1251 // : //    "",      //  WIN1251_UTF8(WIN1251)   = "";  (WIN1251) = ("")      WIN1251   () = ("")  //    Windows-1251  UTF-8  ( &gt;= 192)  ( &lt;= 223)  //  -   =  + 848  ( &gt;= 224)  ( &lt;= 239)  //  -   =  + 848  ( &gt;= 240)  ( &lt;= 255)  //  -   =  + 848  ( = 184)  //   = 1105  ( = 168)  //   = 1025  ( = 185)  // №  = 8470 ; //      =  + ()   ;    //    1 ( UTF-8)  //    (  Windows-1251) // // : // UTF8 -     UTF-8 // : //      Windows-1251 //  UTF8_WIN1251(UTF8)   =  ;  (UTF8) = ("")   =1  (UTF8)   = ((UTF8, , 1)); //    UTF-8  Windows-1251   &lt; 192   =   ( &gt;= 192+848)  ( &lt;= 223+848)  //  -   =  - 848  ( &gt;= 224+848)  ( &lt;= 239+848)  //  -   =  - 848  ( &gt;= 240+848)  ( &lt;= 255+848)  //  -   =  - 848  ( = 1105)  //   = 184  ( = 1025)  //   = 168  ( = 8470)  // №  = 185  //     = -1 ; //        &gt;= 0  .()   ;    //      COMSafeArray (   Windows-1251) //    1C ( UTF-8) // // : // COMSafeArray -      COMSafeArray // (    1) //   -      //   Windows-1251 // : //    "",      //  COMSafeArrayWIN1251_UTF8(COMSafeArray)   = "";  (COMSafeArray) = ("COMSafeArray")  (COMSafeArray.GetDimensions() = 1)  (COMSafeArray.GetLength(0) &gt; 0)   = COMSafeArray.();  = WIN1251_UTF8() ;    //    1C ( UTF-8)  //    ( Windows-1251)    COMSafeArray // // : // UTF8 -     UTF-8 // : //      COMSafeArray       Windows-1251 //  ,     //  UTF8_COMSafeArrayWIN1251(UTF8)   = ;  (UTF8) = ("")   = UTF8_WIN1251(UTF8);  =  COMSafeArray(, "VT_UI1", .()) ;   </span></span></code> </pre><br></div></div><br>     <b>BLOB(BINARY)</b>     () — «CARDS.CDIMAGE».     ,         « <i></i> »  « <i>COMSafeArray</i> ». « <i>COMSafeArray</i> »      « <i></i> ». « <i></i> »        ,    «»,            « <i>BASE64</i> »       « <i>Base64</i> »  « <i>Base64</i> ».      (  )     : « <i>COMSafeArray</i> »« <i></i> »« <i></i> »« <i></i> ».     « <i>Base64</i> »  « <i>Base64</i> ». <br>  ,   : <br><pre> <code class="1c hljs">Base64 Base64 COMSafeArray_ _COMSafeArray</code> </pre><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//       BASE64. // // : //  -     (  0..255),  //  ; //  -   BASE64,      //     (   ). //   -    72 .   0, //      (   ); // Base64 -     -  BASE64; //  -    ,    //     (  0),   //   ( -1,      //  ) //  -    ,     //    . // : // ,     ,    (  //        ) //  Base64(, =72, Base64, , )  Base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";  = ;  = -1;  = "";  () = ("")   (() = (""))  ( &gt;= 0)   = .(); Base64 = "";  = 0; //  Base64     //  ,   .     = 0; //  (0..2)        = 0;// ,    3-    =0    //      = [];  ( &gt;= 0)  ( &lt;= 255)  //     = 256* + ;  =  + 1;  ( &gt; 2)  ( = )  //       //  (  ) -  //     BASE64 //    ,    //   =  2   = 256* ; //    BASE64  = ""; //      BASE64 //    (   ), //     "="  =+1  3   =  % 64;  = "=" + ;  = ( - ) / 64 ; //   BASE64    =0     =  % 64;  = (Base64, +1, 1) + ;  = ( - ) / 64 ; //        = 0  //      Base64 = Base64 +   //       //      &gt;=   Base64 = Base64 + (13) + (10);  = 0 ; //      = (); //    4    +  &lt;=   Base64 = Base64 + ;  =  + ;   =1      &gt;=   Base64 = Base64 + (13) + (10);  = 0 ; Base64 = Base64 + (, , 1);  =  + 1   ;  = 0;  = 0   // :      0.255  = ;  = "       (0..255)";     // :      = "     "   // :      = "   " ; //  ,       = ""   =  ;    //    BASE64   . // // : // Base64 -     BASE64,   ; //  -     (  0..255),   //    (  Base64) //  -    ,    //     Base64 (  1),   //   ( 0,      //  ) //  -    ,     //    . // : // ,     ,    (  //        ) //  Base64(Base64, , , )  Base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";  = ;  = 0;  = "";  (Base64) = ("")  Base64 = (Base64);  =  ;  = 0; // ,    3-    4-    = 0; //  (1..4)       // (   "=")  = 0; // -      (   "=")  =1  Base64   = (Base64, , 1);  ( = " ")  ( = .)  ( = .)  ( = .)  //  -    = "="  //   -      2-      (=Base64-1)  (=Base64)  //   "=" //        = 64* + 0;  =  + 1;  // :       = ;  = "    ";    // ,      BASE64 Base64 = (Base64, )-1;  (Base64 &gt;= 0)  (Base64 &lt;= 63)  //      //        = 64* + Base64;  =  + 1;  =  + 1  // :       = ;  = "    ";   ; //        -     &gt;= 4  //    ,  ,   //    =  % 256; 2 = ;  = ( - ) / 256;  =  % 256; 1 = ;  = ( - ) / 256;  =  % 256; 0 = ;   &gt;= 2  .(0);   &gt;= 3  .(1);   &gt;= 4  .(2)   ; //       = 0;  = 0;  = 0;   ; // ,       &gt; 0    = ""  // :       = "    "    // :      = "   " ; //  ,       = ""   =  ;    //      COMSafeArray (BLOB-   //  )     // // : // COMSafeArray -      COMSafeArray // (    1) //   -       //     // : //       ,      //  COMSafeArray_(COMSafeArray)   = ;  (COMSafeArray) = ("COMSafeArray")  (COMSafeArray.GetDimensions() = 1)  (COMSafeArray.GetLength(0) &gt; 0)    = COMSafeArray.(); Base64 = "";  = 0;  = "";  Base64(, 0, Base64, , )   = Base64(Base64);  =  ();  =     ;    //      //        COMSafeArray // // : //  -      // : //      COMSafeArray      //  ,     //  _COMSafeArray()   = ;  (() = (""))  (. &lt;&gt; .)    = .(); Base64 = Base64();  =  ;  = 0;  = "";  Base64(Base64, , , )   =  COMSafeArray(, "VT_UI1", .())    ;   </span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nothing came of this idea, since the functions “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MassiveByteVStringBase64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” and “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StringBase64VA MassivByte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” turned out to be too slow, and the conversion of images of tens of kilobytes in size took tens of seconds. I never got to the bottom of the reason - was it possible to improve my algorithm or did everything rest on the platform limitations (execution through the interpreter + the need to work with strings through the “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">function </font><font style="vertical-align: inherit;">(since there is no index access to string characters, since data type " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Symbol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " is also not), as well as the function " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Find</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "). In general, in the end I decided to do the “like all” data exchange “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMSafeArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Picture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">I also used the “ADO.Stream” COM object for saving to a file and downloading it from a file as recommended from the Internet. </font><font style="vertical-align: inherit;">As a result, the conversion is performed almost instantly. </font><font style="vertical-align: inherit;">Here is the code:</font></font><br><pre> <code class="1c hljs">COMSafeArray_ _COMSafeArray</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source text</font></font></b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//      COMSafeArray (BLOB-   //  )     // // : // COMSafeArray -      COMSafeArray // (    1) //   -       //     // : //       ,      //  COMSafeArray_(COMSafeArray)   = ;  (COMSafeArray) = ("COMSafeArray")  (COMSafeArray.GetDimensions() = 1)  (COMSafeArray.GetLength(0) &gt; 0)    = (); //  BLOB    StreamOut =  COM("ADODB.Stream"); StreamOut.Type = ADO.StreamTypeEnum.adTypeBinary; //     StreamOut.Mode = ADO.ConnectModeEnum.adModeReadWrite; //    -     StreamOut.Open(); StreamOut.Write(COMSafeArray); StreamOut.SaveToFile(, ADO.SaveOptionsEnum.adSaveCreateOverWrite); StreamOut.Close(); //       =  ();  = ; //    ()   ;    //      //        COMSafeArray // // : //  -      // : //      COMSafeArray      //  ,     //  _COMSafeArray()   = ;  (() = (""))  (. &lt;&gt; .)    = (); //      .(); //  BLOB    StreamIn =  COM("ADODB.Stream"); StreamIn.Type = ADO.StreamTypeEnum.adTypeBinary; //     StreamIn.Mode = ADO.ConnectModeEnum.adModeReadWrite; //    -     StreamIn.Open(); StreamIn.LoadFromFile();  = StreamIn.Read(); StreamIn.Close(); //    ()   ;   </span></span></code> </pre><br></div></div><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Note on the program interface. </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is important to ensure the consistency of the state of the data model and its display interface. </font></font> Those.   - ,        ,        .  ,      ,      .  1      ,              .     (   ),    . , ,              «» .  ,        ( ),         .      ,    (    ). <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this test example, the subroutines that allow linking the data model and the display interface for the “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">group tree</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” and the “ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">group content list</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” are separated into a separate block, i.e. </font><font style="vertical-align: inherit;">isolated and portable. </font><font style="vertical-align: inherit;">In principle, the code is quite typical and universal - for application in its programs, only minor modifications are required, performed “on the machine”, without thinking. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These subroutines look like this:</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source text</font></font></b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">/////////////////////////////////////////////////////////////////////////////////////////////////// // //                                            // /////////////////////////////////////////////////////////////////////////////////////////////////// //////////////////////////////////////////////////////////////////////////////// //       () //     (  ). //   . // // : //  - ,   ; //  _()    &lt;&gt;   //    ,     =  (10, 0);  =  ();  =  ; .(); .((""));  =  (); //  "" .(); .((""));  =  (, , ,); //  "" .(); .((""));  =  (); //  "" .(); .((""));  =  (, , ); //  "" //   ..(); ..("", ); ..("", ); ..("", ); ..("", )   //         . // // : //  -   ,     //  -  ,     ; // : //   ,     ,    //  //  _(, )   = ;   &lt;&gt;    (. &lt;&gt; )  (..GRID = )   =       .   (. &lt;&gt; )  (..GRID = )   = ;    = _(, );   &lt;&gt;        ;    //        . // // : //  - ,   ; //  -  ,     ; //  -   ,      //    ,     (   ,   //     ); // : //   ,     ,    //  //  _(, , =)   = ;   &lt;&gt;   //        = _(, ) ;   =   //          .   (. &lt;&gt; )  (..GRID = )   =    = _(, ) ;   &lt;&gt;      ;    //       ,  . // // : //  - ,   ; //  -   ObjGroup; //  -   ,      //    ,     (   ,   //     ); // : //   ,     ,    //  //  _(, , =)   = ;   &lt;&gt;   _(, .GRID, ) ;    //   ,      //  ( ,     //  )  .     . // // : //  - ,   ; //  -     ; //  -     ; // : // ,          , //         //  _(, , )   = ;  ( &gt; 0)  ( &gt;= 0)  ( &lt;&gt; )    = 0  //        =   //     = _(, );   &lt;&gt;   //    ,      //        = .;   &lt;&gt;    ..GRID =   // ,          = ;  ;  = .    ;    //         . //    ,      .   // ,    .       ( // ),       . // // : //  - ,   ; //  -   ObjGroup,     ; //  -   ,     //    ,     (   ,   //     ); // : //   ,          // ,       //  _(, , =)   = ; //  ,          ( &lt;&gt; )  ( &lt;&gt; )   = _(, .GRID, );   =   //      -      = _(, .PGRID, );   &lt;&gt;    = ..(); . = ; . = 0; . = ; . = .GRName;  =    //       = .;  (( = )  (.PGRID &lt; 0))  (( &lt;&gt; )  (..GRID = .PGRID))  //       . = ; . = .GRName;  =   //         &lt;&gt;   ..() ;  = _(, .PGRID);   &lt;&gt;    = ..(); . = ; . = 0; . = ; . = .GRName;  =     ;    //    ,    // (    ). // // : //  - ,   ; //  -   ObjGroup,      ; //  -   ,      //    ,     (   ,   //     ); // : //   ,        //      ,      //  _(, , =)   = ;  ( &lt;&gt; )  ( &lt;&gt; )   = _(, .GRID, );   &lt;&gt;    = .;   &lt;&gt;    = ..(); ..();  = ..();   &gt; 0    &lt;    = .[]   = .[-1]    =     ;    //         . // // : //  -    ; //  -          ; //  - ,   ; //  -   ,     ; //  -    ,    //          - //        (  ,  //        ); //  -  -  ,   , //     ( =0,      - //   ). //  _(, , , , =, =0)   ( &lt;&gt; )  ( &gt;= 0)  ( &gt;= 0)  //   ,        = ;  ( &lt;&gt; )  (..GRID = )   =  ;   =    = _(, , ) ;   &lt;&gt;   //       . = ; ..(); //        = ObjSet_(.ClassIDs.CLN_GROUP);  _SelectGroups(, , )  //        //        , //        =0  ObjSet_GetCount()-1   = ObjSet_GetItemByIndex(, );  = ..(); . = ; . = 0; . = ; . = .GRName; ; . = ; //     &lt;&gt; 1      .  //      = 0  _(, , , ..GRID, , )   &gt; 1  _(, , , ..GRID, , -1)     //        _(, ._1, "   ", ._, _GetErrorMsg()) ; ObjSet_()    //       ,    . //      . // // : //  -    ; //  -          ; //  - ,   ; //  -  -  ,   , //     ( =0,      - //   ). // : //      ,       // //  _(, , , =0)   = ;  ( &lt;&gt; )  ( &gt;= 0)  //     ..(); //     = ObjGroup_(); ObjGroup_SetAttr(, 0, -1, "");  = ..(); . = ; . = 0; . = ; . = .GRName; //  ,     (  2-  ) _(, , , .GRID, , );  =  ;    //////////////////////////////////////////////////////////////////////////////// //        () //      -     // (   ).   . // // : //  - ,    ; //  _()    &lt;&gt;   //    ,     =  (10, 0);  =  ();  =  ; .(); .((""));  =  (); //  "" .(); .((""));  =  (, , ,); //  "" .(); .((""));  =  (); //  "" .(); .((""));  =  (, , ); //  "" //   ..(); ..("", ); ..("", ); ..("", ); ..("", )   //          . // // : //  -   ObjGroup  ObjCard,   ; //  -  ,     ; // : // ,          -   //  //  _(, )   = ;  ( &lt;&gt; )  ( &gt;= 0)   = ((.ClassID = .ClassIDs.CLN_GROUP)  (.PGRID = ))  ((.ClassID = .ClassIDs.CLN_CARD)  (.GRID = )) ;    // ,          . // // : //  -   ObjGroup  ObjCard,   ; //  -  ,   ; // : // ,         -   //  //  _(, )   = ;  ( &lt;&gt; )  ( &lt;&gt; )   = ((.ClassID = .ClassIDs.CLN_GROUP)  (. = )  (.GRID = ..GRID))  ((.ClassID = .ClassIDs.CLN_CARD)  (. = )  (.CDID = ..CDID)) ;    //    ,    . // // : //  - ,    ; //  -   ObjGroup  ObjCard,    ; //  -  ,     //       (  ,    //    ); // : //  ,       ,   //    //  _(, , )   = ;  ( &lt;&gt; )  ( &lt;&gt; )   ( &lt;&gt; )  _(, )  // ,  -     =   //             _(, )   = ;     ;    //       (  ) //    . // // : //  -    ; //  -          ; //  - ,    ; //  -   ,     ; //  _(, , , )    &lt;&gt;   //     .();   &gt;= 0  //      = ObjSet_(.ClassIDs.CLN_GROUP);  _SelectGroups(, , )  //       =0  ObjSet_GetCount()-1   = ObjSet_GetItemByIndex(, );  = .(); . = ; . = 0; . = ; . = .GRName;   //        _(, ._1, "    ", ._, _GetErrorMsg()) ; ObjSet_(); //      = ObjSet_(.ClassIDs.CLN_CARD);  _SelectCardsNames(, , )  //       =0  ObjSet_GetCount()-1   = ObjSet_GetItemByIndex(, );  = .(); . = ; . = 1; . = ; . = .CDName;   //        _(, ._1, "    ", ._, _GetErrorMsg()) ; ObjSet_()    //        . //    ,      .   // ,    .       ( // ),        . // // : //  - ,    ; //  -  ,     ; //  -   ObjGroup,     ; //  -  ,      //   ,     (  ,    //    ); // : //  ,       (  ) // ,       //  _(, , , =)   = ;  ( &lt;&gt; )  ( &gt;= 0)  ( &lt;&gt; )   = _(, , );   =   //      -      _(, )  //     -      .ClassID = .ClassIDs.CLN_GROUP  //     1-  //     = 0;   &lt; .()   = [];   .     =  + 1  ; //    = .(); . = ; . = 0; . = ; . = .GRName;  =   .ClassID = .ClassIDs.CLN_CARD  //        = .(); . = ; . = 1; . = ; . = .CDName;  =     //       _(, )  //       -     . = ;  .  . = .GRName  . = .CDName   //      (    )  = _(, , )   ;    //    ,   . // // : //  - ,    ; //  -   ObjGroup  ObjCard,    ; //  -  ,      //   ,     (  ,    //    ); // : //  ,        //      ,      //  _(, , =)   = ;  ( &lt;&gt; )  ( &lt;&gt; )   = _(, , );   &lt;&gt;    = .(); .();  = .();   &gt; 0    &lt;    = []   = [-1]    ;   </span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How specifically these subroutines are used can be seen in the code of the modules of the corresponding forms (for example, the module of the main form) from the demo. </font></font><br><br>   .       (     ),       ,     2       (1-         ,  2-    ,    ,     1-   –    ).  , ,      ,     .        «».  ,   ,   «»          ,   «»   .    ,      . <br><br><h1>     FireBird. </h1><br> ,          FireBird   : <br> 1.    ,   ,   : <br> —         «ADO.Connection»    «ADO.Command»       ; <br> —        SQL- (    ) <br><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//      FireBird _Driver = "driver={" + "Firebird/InterBase(r) driver" + "}"; _UID = "uid=" + FBUserName; _PWD = "pwd=" + FBUserPass; _DataBase = "database=" + FBDBAddr;  = _Driver + ";" + _UID + ";" + _PWD + ";" + _DataBase; //   .FBSrvConn =  COM("ADODB.Connection"); //   .FBSrvConn.open(); .IsDBConnect = ; //      .FBCommand =  COMObject("ADODB.Command"); .FBCommand.ActiveConnection = .FBSrvConn; .FBCommand.CommandType = ADO.CommandTypeEnum.adCmdText;</span></span></code> </pre><br> —     –  , ,       <br><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//     .IsDBConnect = ; .LastTestTime = 0; .FBCommand = ;  .FBSrvConn &lt;&gt;    .FBSrvConn.State = ADO.ObjectStateEnum.adStateOpen  .FBSrvConn.Close() ; .FBSrvConn = ; </span></span></code> </pre><br> 2.    . <br>          .         SQL-,       .    ,      ,     . ,            (       –   ),     ,      (    )         .   ,      – 5.     «_CheckRestConnect»,        . <br> 3.  : <br> —    ,       ,      «ADO.Recordset»,         ; <br> —     –     (, /,   )     (,         65535 ),     BLOB-    «ADO.Parameter»; <br> —        «SELECT»   «EXECUTE PROCEDURE» (       SQL-); <br> 4.    : <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- when working with data declared in the database as text (CHAR, VARCHAR, BLOB (TEXT)) - do not worry about the conversion of encodings; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- when placing the text in the data that is not intended for this (BLOB (BINARY)) - perform the transcoding itself (1C lines are stored in UTF-8). In principle, transcoding can not be done at all - for a DBMS this is not text, but simply a set of bytes. But of course, it is more correct to store these data in the database in the same encoding as the rest of the text fields. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Storage of images in the database (in BLOB):</font></font><br> —   (   BLOB(BINARY)-)     (  )     COMSafeArray (,  BLOB(TEXT)    ).    «»  «COMSafeArray»   (  ),          .             «» .           «COMSafeArray»,  COM-  «ADO.Stream». <br> 6.     BLOB-    : <br> —   ,         ,    « <i>Parameters</i> »  « <i>ADO.Command</i> ».  ,   ,          « <i>:prm_name</i> » (    ).    ADO FireBird         (   …).    – ,   .       –  ADO FireBird    .     ,        « <i>?</i> » ( ).     ,           ,          « <i>Parameters</i> ».       (     )     —      « <i></i> ». <br><br>  That's all.  Good luck to all.  . <br><br><h1>  PS </h1>    (  1 8.2 +  )  <a href="https://yadi.sk/d/PXkUs8dYpuanW"></a> . <br>         FireBird 1.5  2.1.      :    FireBird,        « <i>script.sql</i> » (      ). </div><p>Source: <a href="https://habr.com/ru/post/278583/">https://habr.com/ru/post/278583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278573/index.html">Adaptive Split View Controller and Popover in iOS 9 (Swift). Part 1</a></li>
<li><a href="../278575/index.html">Superscalar Stacking Processor: We Cross Horror And Hedgehog</a></li>
<li><a href="../278577/index.html">Automation of easy database 1C list management</a></li>
<li><a href="../278579/index.html">Using the Chromium project codebase as an SDK for developing cross-platform applications</a></li>
<li><a href="../278581/index.html">History of Chatto</a></li>
<li><a href="../278585/index.html">Margaret Hamilton: "Guys, I'll send you to the moon"</a></li>
<li><a href="../278589/index.html">libuniset2 is a library for creating ACS. It’s better to see once ... Part 4 (Adjustment)</a></li>
<li><a href="../278593/index.html">We get acquainted with web standards. Work with audio. - Video and creation history</a></li>
<li><a href="../278595/index.html">SQL engine for generating reports. Idea</a></li>
<li><a href="../278597/index.html">Decomposition of the affine transformation matrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>