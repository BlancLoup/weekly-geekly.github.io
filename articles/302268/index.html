<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Email - not a sparrow, fly out - you won't catch it or how we did email marketing with a machine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over 40% of Lingualeo's revenue comes from an email channel. In 2015, we sent 300 million letters. It is extremely important for us that this sales ch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Email - not a sparrow, fly out - you won't catch it or how we did email marketing with a machine</h1><div class="post__text post__text-html js-mediator-article">  Over 40% of Lingualeo's revenue comes from an email channel.  In 2015, we sent 300 million letters.  It is extremely important for us that this sales channel work efficiently: predictable, scalable, and ROI mailing is maximized. <br><br><img src="https://habrastorage.org/files/733/f6e/05e/733f6e05e8634938bf22dc7c3a9ac6eb.png"><br><br>  Today we will tell in general about our complicated email marketing system, about moving from one platform to another, about the localization system and about the technical nuances of moving.  In this collectively prepared article ( <a href="https://habrahabr.ru/users/mrloki/">Roman Domrachev</a> , Backend Team Leader Lingualeo; Ivan Zelenin, ex-head of email marketing and CRM Lingualeo, now operational director of the cool CRM marketing agency WIM.Agency; <a href="https://habrahabr.ru/users/vitkovskii/">Vladimir Vitkovsky</a> , monetization manager of Lingualeo; Konstantin Shimanaev, a leading marketing manager for Lingualeo) there are interesting things for both marketers and techies! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In 2015, Lingualeo was faced with the need to move to a new platform and technology to send letters, as the current resource (the agency that worked with the ExpertSender platform) could no longer cope with our volumes and Wish lists.  It was a good quality platform.  But Lingualeo has grown out of it.  Plus, it was important for us to control the entire e-mailing process: from design to dispatch.  Therefore, we decided to transfer work to another platform and start preparing in-house mailings.  We wanted to do email-marketing machine. <br><a name="habracut"></a><br>  To select a new system, we formed the following criteria: <br><ul><li>  cost per 1000 letters; </li><li>  the ability to work with different language locales; </li><li>  maximum deliverability to email-domains worldwide; </li><li>  convenience of the interface for administering a large number of email chains; </li><li>  the delivery time of large volumes of letters within a few hours (up to this we could send as much as 1-2 million per day, while it was necessary to ask the agency to do manual ‚Äútwists‚Äù in the system); </li><li>  detailed analytics (we wanted to know what is happening with our letters, what actions customers take in relation to them, but were not ready to build an analytical system on their side); </li><li>  uptime&gt; 99.5%; </li><li>  easy integration with the Lingualeo backend; </li><li>  Russian-language technical support and its physical presence in Russia, including technical personnel. </li></ul><br>  We opted for the Emarsys platform. <br>  But choosing a platform based on the TK was a small fraction.  The next step was integration with Lingualeo. <br><br><h2>  Integration scheme </h2><br>  Any integration with the Email service provider (hereinafter - ESP) involves 3 steps: <br><ul><li>  regular synchronization of the contact database using CSV uploads; </li><li>  instant synchronization using the API .; </li><li>  setting up API triggers to send events. </li></ul><br>  In our case, Lingualeo also added automatic unloading of analytics from ESP, since it was important for us to understand everything that happens on the ESP side (sent letters, opening letters, clicks, non-delivery), and compare this with the actions of users on the site.  Plus localization system.  This is from the <b>technical</b> side. <br><br>  With <b>marketing</b> it was required: <br><ul><li>  Customize the logic of the triggers and chains of letters; </li><li>  Update, test and roll out the design and layout of letters; </li><li>  Track deliverability, adjust postmasters and ensure smooth warm-up; </li><li>  Update analytics format and increase its semantic significance. </li></ul><br>  At the initial stage of integration, ExpertSender and Emarsys were connected in parallel on different mail subdomains. <br><br>  Users are synchronized to both ESPs, and triggers are sent through one.  To which provider the trigger belongs, configures the administrator.  So we could gradually transfer the old triggers to Emarsys, and make new ones right away in it. <br><br>  This scheme assumes that user <b>synchronization</b> should be done to all ESPs simultaneously.  And also there should be an opportunity to send triggers to both systems, but send letters only from one.  However, as an error protection, <b>triggers</b> should only be <b>sent</b> to one of the connected ESPs to prevent the same email from being sent again from another ESP.  The administrator can manage the configuration: through what ESP, what type of letters to send. <br><br>  Synchronize users and send triggers - requests to Emarsys.  During synchronization, we send values ‚Äã‚Äãthat are stored in the ESP database, and when sending triggers, we send the identifier and data from which the provider collects the letter. <br><br>  Localization of templates - two tasks that run on the crown: one takes the templates from ESP, parses them and sends the segments for translation to WebTranslateIt (hereinafter WTI), and the second receives the translated segments from WTI and uploads them to ESP.  More on localization below. <br><br>  Requests for creating, updating users, and sending triggers are done via the RabbitMQ queue.  The request from the site in ESP can be presented in two parts: <br><ul><li>  request hit the queue; </li><li>  processing and execution of the request. </li></ul><br><h4>  Send request to queue </h4><br>  Sending requests from the site is done via emailing'a service.  It sticks together the same type of messages in one request, so that the load on the ESP is less.  Messages are sent through the queue, so we don‚Äôt have to keep the user waiting for ESP to respond. <br><br>  While the application is running, we are dealing with user data, and each of the changes is repeated in ESP.  The application code "subscribes" to save the user and sends the necessary data.  But if you send a request with each save, we create a lot of small requests.  This problem was solved in Lingualeo by redoing sending requests.  Now, when changing user data, we do not send a request, but fold it into a ‚Äúpocket‚Äù.  When the http request is completed, we collect the requests that are in the ‚Äúpocket‚Äù and process it so that as many changes of the same user turn into a single data update request in ESP. <br><br><img src="https://habrastorage.org/files/6b5/13c/af5/6b513caf5b4a4a5486c569e090095f4f.png"><br><br><h4>  Processing and execution of the request </h4><br>  The request is taken from the queue by the workers. <br><br>  Workers are applications that get jobs from a queue and execute.  The worker processes 1000 tasks, after which it dies and is restarted by the supervisor (supervisord.org). <br><br>  Here the messages of the e-mailing service turn into requests that are clear to each of the providers. <br>  In the queues you can not show the user the page ‚Äúsomething amiss is going on in the jungle,‚Äù in case of an error, the worker must handle the situation on his own.  In the queue there is no one to ask ‚Äúwhat to do?‚Äù.  It remains to fall with an error that is written to the log.  The log handles Gralylog2 (www.graylog.org), which is able to send alerts to the mail and show message flows. <br><br>  Logs save if the application crashes, but if it slows down, the logs do not help to understand what happened.  Pinba (pinba.org) helps us detect such messages, to which we send application timers.  We have a monitor in the center of the office that shows the site metrics from the data received by the pinboy. <br><br><h2>  Letter preparation </h2><br>  Stages of preparation of letters: <ul><li>  forming an idea </li><li>  lock-up letters, </li><li>  copywriting </li><li>  design, </li><li>  layout, </li><li>  typesetting testing, </li><li>  personalization and customization, </li><li>  testing, </li><li>  localization. </li></ul><br><h4>  Idea, mock-up, copywriting, design and layout </h4><br>  We have a monthly mailing plan.  The cycle of letter preparation takes an average week.  Although periodically there are urgent letters, and we do them in 1 day.  Based on the e-mail plan, the manager makes applications to jira for the design, prescribes the project, and at the same time sets the task of copywriting.  As soon as copywriting is ready, we add texts to the task for designers in jira.  If the designers are busy, the email manager uses a ready-made base of pictures and tries to ‚Äúblind‚Äù the image with the hands based on the ready-made layout templates, so as not to draw from scratch, but to do a minimum of changes in the finished layout.  In case the designers have prepared a unique template, the latter goes to the layout makers.  The layout is very fast.  A few hours - and we have already laid out the layout.  Email-manager will check it in a specialized system (we have emailonacid) and tests how letters look in the mobile version and in different clients. <br><br>  Layout has certain difficulties.  Email layout is very specific.  You can only use the old standards, you can not div, therefore, have to use only certain tags.  Maker-ups do not really like email, because there are big restrictions and there is no possibility to use new technologies. <br><br><h4>  Personalization </h4><br>  To get the most out of email marketing, it‚Äôs not enough to send 300 million letters a year, you need to send them as much as possible targeted (more letters to small segments) and personalized (having more specifics about the recipient in the body of the letter - name, gender, and even and recommended activities).  Analytics show that this is the right step - personalized letters are converted 20% higher. <br><br><h4>  <i>Mailings to user groups</i> </h4><br>  We synchronize two types of data in Emarsys - static (gender, age, etc.) and behavioral data.  Static data is more suitable for filtering, and for deeper personalization we use additional fields in which the application loads data periodically.  For example, a letter with user statistics on occupations is formed several hours before being sent in order to remain relevant when it reaches the user! <br><br><h4>  <i>Trigger mailings</i> </h4><br>  Triggers are an order for Emarsys to send an email <b>immediately</b> using the transferred data, or <b>after the time</b> specified in the control panel.  Triggers can be used to create mailings yourself.  To do this, you need to prepare a list of users and send a request to Emarsys for each of them with the necessary data.  This method of mailing support more difficult than normal.  But we can respond to user actions at the same moment when he performs these actions on the site. <br><br>  An example of a trigger mailing is a motivational letter that a user receives after working with a dictionary.  For example, a user adds words to his ‚ÄúDictionary‚Äù, but does not train for the next 2 days.  In this case, on the second day after the addition, he receives a motive letter with a reminder that he should learn these words.  Letters of this kind have one of the best indicators of the involvement of users of the service. <br><br><h4>  <i>Localization</i> </h4><br>  One of the features of the work of Lingualeo is a wide geography.  Our students live not only in Russia and the near abroad, but also in Brazil and Turkey.  Therefore, our email communications should be localized. <br>  It is very important that everyone leaves their letter.  The localization system works as follows: we have a template, it is divided into certain lines that we want to translate.  This text is transmitted to the system for translation - this is WTI.  (More information about the localization system of the product Lingualeo <a href="https://habrahabr.ru/company/lingualeo/blog/273223/">in the post of</a> <a href="https://habrahabr.ru/users/harrylyu/">Igor Lyubimov</a> , Head of Localization Lingualeo.) In this system, translators get the lines, then "magic" happens.  According to the results of ‚Äúwitchcraft,‚Äù the translation comes to Emarsys as templates.  Next, we check by sending to localization managers: how truthful the letter is, and whether it is worth changing something visually. <br><br>  <b>The technical</b> side of the localization ‚Äúmagic‚Äù is as follows: marketers create a master-template in Russian.  Then this template is picked up by the localization service, and on its basis localized slave templates are created.  The user's locale is stored in his card in Emarsys. <br><br>  The task of localization is divided into two stages: <br><ul><li>  Parsing master templates and exporting segments to WTI. </li><li>  Retrieving translations from WTI and creating / updating localized slave templates. </li></ul><br>  Both tasks are solved by the localization service: EmarsysLocalizationService.  The launch of the localization system occurs every hour. <br>  <i>Algorithm for exporting segments from Emarsys to WTI:</i> <br><ol><li>  All templates come from Emarsys. </li><li>  The system filters out only master templates. </li><li>  For each master template its content is requested from Emarsys. </li><li>  Segments are parsed from the template content (key = value of the data-translate-segment attribute, value = content inside the tag). </li><li>  A set of segments from a template is sent to WTI (each template has its own file in WTI). </li></ol><br>  <i>Algorithm for importing segments from WTI to Emarsys:</i> <br><ol><li>  All data for the Lingualeo-Email-Templates project is requested from WTI. </li><li>  All templates come from Emarsys. </li><li>  The system filters out only master templates. </li><li>  For each master template its content is requested from Emarsys: </li></ol><ul><li>  From the WTI project, information about the WTI master file is extracted that matches the current template. </li><li>  For each enabled locale, segments are requested from WTI (by the ID of the wti-master file). </li></ul>  - The contents of the master template are taken and the segments in it are replaced with those received for the specified locale. <br>  - The content is saved in the slave template (the template is created if it was not or is updated if it is already <br>  existed). <br><br>  WTI-Emarsys interaction diagram: <br><br><img src="https://habrastorage.org/files/835/35a/f5c/83535af5c02142c8bd0e3595946c028a.jpg"><br><br><h2>  ANALYTICS </h2><br>  To assess the effectiveness of mailings, in addition to the basic metrics (open rate, click rate, unsubsribe rate, etc.) available in the Emarsys office, we use a number of additional ones that are calculated based on the user's activity on the service after switching from the letter. <br>  This is possible due to the fact that information about all shipments, discoveries of letters and following links from them is loaded into our analytical repository, where you can calculate any metrics and funnels in arbitrary sections.  For each mailing you can build, for example, such a funnel: <br>  Step 1. Number of shipments. <br>  Step 2. The number of discoveries. <br>  Step 3. The number of transitions from the letters. <br>  Step 4. The number of users who received XP during the day after the transition from the letter. <br>  Step 5. Number of purchases during the day + revenue from each shipment during the day after mailing. <br><br>  All listed metrics can be arbitrarily segmented, for example, by gender, age, number of days from the moment of registration (newcomers / oldies), registration platform, etc.  Based on this information, we optimize the list. <br><br><h2>  TOTAL </h2><br>  <b>On the technical side:</b> <br><ul><li>  Increased the possible volume of sent messages to 45 million monthly and more; </li><li>  Received the ability to send up to 20 million letters per day; </li><li>  The delivery time of 2 million messages has been reduced from days to 1-2 hours and is limited only by the ability to receive a certain number of students on the site; </li><li>  The process of preparing letters for different locales simplified and began to occupy at least half the time and resources; </li><li>  To introduce new triggers, intervention from the backend development team is less necessary. </li></ul><br>  <b>On the business marketing side:</b> <br><ul><li>  Access to advanced analytics, including a list of specific actions for each email campaign; </li><li>  Accelerated the process of creating and sending an urgent letter from a week to one day if necessary; </li><li>  Accelerated the process of implementing a regular letter from two weeks to a week; </li><li>  Improved the quality of letters by involving internal designers in the process of creating letters and control on their part; </li><li>  Significantly reduced the cost of sending a letter. </li><li>  <b>Tens of percent improved product and marketing metrics related to emailing (and we still have work to do)</b> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/302268/">https://habr.com/ru/post/302268/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302258/index.html">How to take screenshots faster: create your own free storage on Amazon S3</a></li>
<li><a href="../302260/index.html">‚ÄúAttack to the fuel depot‚Äù or break the SCADA system on PHDays VI</a></li>
<li><a href="../302262/index.html">Why geymindustry need marketing research</a></li>
<li><a href="../302264/index.html">Three approaches to building a data center from Louros Project, Keystone NAP and Iron Mountain</a></li>
<li><a href="../302266/index.html">Developer in the project management triangle</a></li>
<li><a href="../302270/index.html">ESET specialists released a tool to decrypt TeslaCrypt files</a></li>
<li><a href="../302272/index.html">HPE StoreVirtual VSA Architecture</a></li>
<li><a href="../302274/index.html">We get control back to Jenkins Pipeline</a></li>
<li><a href="../302276/index.html">Virus living exclusively in PLC</a></li>
<li><a href="../302278/index.html">Docker Container Development with Sparrow Multipurpose Scripting System</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>