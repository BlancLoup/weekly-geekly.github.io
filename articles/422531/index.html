<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimizing graphics for the web: the most important</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author of the e-book is Eddie Osmani, one of the managers of Google Chrome. 

 tl; dr 
 Image compression should always be automated. 
 Optimizati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimizing graphics for the web: the most important</h1><div class="post__text post__text-html js-mediator-article">  <font color="gray">The author of the e-book is Eddie Osmani, one of the managers of Google Chrome.</font> <br><br><h1>  tl; dr </h1><br><h4>  Image compression should always be automated. </h4><br>  Optimization of graphics must be automated.  It's easy to forget about it, the recommendations change, and the content itself can easily slip past the assembly line.  To automate the build, use <a href="https://github.com/imagemin/imagemin">imagemin</a> or <a href="https://github.com/jcupitt/libvips">libvips</a> .  There are many others. <br><br>  Most CDNs (for example, <a href="https://www.akamai.com/us/en/solutions/why-akamai/image-management.jsp">Akamai</a> ) and third-party solutions like <a href="https://cloudinary.com/">Cloudinary</a> , <a href="https://imgix.com/">imgix</a> , <a href="https://www.fastly.com/io/">Fastly Image Optimizer</a> , <a href="https://www.instartlogic.com/technology/machine-learning/smartvision">Instart Logic</a> <a href="https://imageoptim.com/api">SmartVision,</a> and the <a href="https://imageoptim.com/api">ImageOptim API</a> offer comprehensive automated solutions for image optimization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You will spend time reading articles and configuration setting, which is more expensive than paying for their services (Cloudinary has a <a href="http://cloudinary.com/pricing">free</a> tariff).  But if you still don‚Äôt want to outsource your work for reasons of cost or due to additional latency, then choose the above open source options.  Projects <a href="https://github.com/imazen/imageflow">Imageflow</a> or <a href="https://github.com/thumbor/thumbor">Thumbor</a> offer an alternative on their own hosting. <br><a name="habracut"></a><br><h4>  All must effectively compress images </h4><br>  At a minimum, use <a href="https://imageoptim.com/">ImageOptim</a> .  It significantly reduces the size while maintaining visual quality.  There are <a href="https://imageoptim.com/versions.html">versions</a> for Windows and Linux. <br><br>  A more thorough approach: run JPEG files through <a href="https://github.com/mozilla/mozjpeg">MozJPEG</a> (for web content, <code>q=80</code> or lower quality is acceptable) and consider support for <a href="http://cloudinary.com/blog/progressive_jpegs_and_green_martians">Progressive JPEG</a> .  PNG files pass through <a href="https://pngquant.org/">pngquant</a> , and SVG - through <a href="https://github.com/svg/svgo">SVGO</a> .  Explicitly specify metadata clearing ( <code>--strip</code> for pngquant) to avoid files being blown up.  Instead of crazy giant animated GIF, give <a href="https://en.wikipedia.org/wiki/H.264/MPEG-4_AVC">H.264</a> videos to users (or <a href="https://www.webmproject.org/">WebM</a> for Chrome, Firefox and Opera)!  If you can't afford it, then at least use <a href="https://github.com/pornel/giflossy">Giflossy</a> .  When there is an opportunity to spend a couple of CPU cycles, and you need a better quality image and you are ready to put up with a long coding time, then try <a href="https://research.googleblog.com/2017/03/announcing-guetzli-new-open-source-jpeg.html">Guetzli</a> . <br><br>  Some browsers announce support for image formats via the Accept header.  This can be used when choosing a format for output: for example, the <a href="https://developers.google.com/speed/webp/">WebP</a> format for Blink-based browsers, such as Chrome, and the JPEG / PNG option for other browsers. <br><br>  Compression can always be improved.  There are tools for generating and issuing <code>srcset</code> .  In Blink-based browsers, the choice of resources is automated with the help of <a href="https://developers.google.com/web/updates/2015/09/automating-resource-selection-with-client-hints">client-hints</a> - and you will save traffic on users who indicated the ‚Äúdata saving‚Äù option in the browser using the <a href="https://developers.google.com/web/updates/2016/02/save-data">Save-Data</a> prompt. <br><br>  The smaller the image size, the more convenient it is for users - especially with mobile phones.  In this article, we will consider how to compress graphics with modern methods with minimal impact on quality. <br><br><h1>  Content </h1><br><ul><li>  <a href="https://habr.com/ru/post/422531/">Introduction</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How to find out whether to optimize images?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How to choose a format?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Modest jpeg</a> </li><li>  <a href="https://habr.com/ru/post/422531/">JPEG compression modes</a> <ul><li>  <a href="https://habr.com/ru/post/422531/">Benefits of Progressive JPEG</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Who uses progressive jpeg in production?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Disadvantages of Progressive JPEG</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How to encode files in progressive jpeg format?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Color downsampling</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Improved JPEG</a> </li><li>  <a href="https://habr.com/ru/post/422531/">JPEG optimizers</a> </li><li>  <a href="https://habr.com/ru/post/422531/">What is MozJPEG?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">What is Guetzli?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Comparing MozJPEG with Guetzli?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Butteraugli</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/422531/">What is WebP?</a> <ul><li>  <a href="https://habr.com/ru/post/422531/">How does webp work?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Who uses webp in production?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How does WebP coding work?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">WebP Browser Support</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How to convert images to webp?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How to view WebP images on my OS?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How to give WebP?</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/422531/">SVG Optimization</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Avoid pinching graphics with loss of quality.</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Reduce unnecessary decoding and resizing costs</a> <ul><li>  <a href="https://habr.com/ru/post/422531/">HiDPI image delivery using srcset</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Artistic transformation</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/422531/">Color management</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Sprites</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Lazy loading of non-critical images</a> </li><li>  <a href="https://habr.com/ru/post/422531/">How to avoid the trap display: none</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Does it make sense to use CDN for image processing?</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Image caching</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Preloading important resources</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Web performance budgets for images</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Final Recommendations</a> </li><li>  <a href="https://habr.com/ru/post/422531/">Little things</a> </li></ul><br><a name="01"></a><h1>  Introduction </h1><br><h4>  Graphics remain the leading cause of web page obesity. </h4><br>  Images make up a huge proportion of internet traffic.  According to the <a href="httparchive.org/">HTTP Archive</a> , 60% of the volume of web pages is JPEG, PNG and GIF graphics.  As of July 2017, the images were 1.7 MB on an average web page of 3.0 MB. <br><br>  An experiment by Tammy Everts <a href="https://calendar.perfplanet.com/2014/images-are-king-an-image-optimization-checklist-for-everyone-in-your-organization/">proved</a> that adding images to a page or increasing existing images increases the conversion rate (percentage of visitors who become customers - approx. Lane).  So the pictures will not go anywhere - that is why it is important to invest in an effective strategy for compressing them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a3/3b0/2b6/4a33b02b6a5429884129920cb5795047.jpg"><br>  <i><font color="gray"><a href="https://www.thinkwithgoogle.com/marketing-resources/experience-design/mobile-page-speed-load-time/">The 2016 Soasta / Google</a> study showed that the illustrations are the second predictor of conversion, and effective pages have 38% fewer images.</font></i> <br><br>  Image optimization includes a number of measures.  The choice depends on the quality loss considered acceptable. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/717/0e8/588/7170e85883225b9e08b09ea84cc3ae72.jpg"><br>  <i><font color="gray">Optimization: choose the right format, gently compress and prioritize the loading of different images</font></i> <br><br>  Typical optimization includes compression, correct output of images based on size using <code>&lt;picture&gt;/&lt;img srcset&gt;</code> and resizing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ba/36c/69c/8ba36c69c745b99a1bb0b25d803ae15c.jpg"><br>  <i><font color="gray">According to the <a href="http://jsfiddle.net/rviscomi/rzneberp/embedded/result/">HTTP Archive</a> , at the 95th percentile (in the cumulative distribution function), each picture can be reduced by 30 KB!</font></i> <br><br>  We still have a lot of images that can be optimized. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/640/bb3/f22/640bb3f22116b34da321bc72f5ffd360.jpg"><br>  <i><font color="gray">Free program ImageOptim reduces the size of graphics using modern methods of compression and removal of unnecessary metadata EXIF</font></i> <br><br>  If you are a designer, there is also <a href="https://github.com/ImageOptim/Sketch-plugin">an ImageOptim plugin for Sketch</a> that optimizes resources when exporting.  I found it saves a ton of time. <br><br><a name="02"></a><h1>  How to find out whether to optimize images? </h1><br>  Audit the site using <a href="https://www.webpagetest.org/">WebPageTest.org</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd7/5ed/eb7/bd75edeb7a6ded48fcb74b79acc9b01f.jpg"><br>  <i><font color="gray">The Compress Images section of the WebPageTest report lists images that can be squeezed more efficiently, while evaluating potential gains by file size.</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c45/d66/afa/c45d66afa348cb8c00124c6d3c95bb99.jpg"><br><br>  The <a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a> service also audits performance, including checking image optimization.  It shows pictures that can be squeezed stronger and which can be put into a lazy download. <br><br>  Starting from Chrome 60, this service works in <a href="https://developers.google.com/web/updates/2017/05/devtools-release-notes">the</a> Chrome DevTools <a href="https://developers.google.com/web/updates/2017/05/devtools-release-notes">audit</a> panel: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f98/cbe/eb0/f98cbeeb0a10a2faf610981cecf07400.jpg"><br>  <i><font color="gray">Lighthouse conducts an audit with an eye on performance, best practices, or advanced web application features (optional)</font></i> <br><br>  You may be aware of other audit tools, such as Cloudinary <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed ‚Äã‚ÄãInsights</a> and <a href="https://webspeedtest.cloudinary.com/">Website Speed ‚Äã‚ÄãTest</a> , which includes a detailed image audit. <br><br><a name="03"></a><h1>  How to choose a format? </h1><br>  As Ilya Grigorik noted in his excellent <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/image-optimization">guide on image optimization</a> , the ‚Äúright format‚Äù combines the desired visual result and functional requirements.  Do you have a raster or vector graphics? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/69b/fc1/e44/69bfc1e44304fbf9877fe53a86ff80b2.png"><br><br>  <a href="https://en.wikipedia.org/wiki/Raster_graphics">Raster graphics</a> encodes the values ‚Äã‚Äãof each pixel on a rectangular grid of pixels.  They do not depend on resolution or scale.  Such graphics work well with WebP or widely supported formats such as JPEG or PNG.  Raster graphics are used where photorealism is needed.  Guetzli, MozJPEG and other mentioned tools are suitable for raster graphics. <br><br>  <a href="https://en.wikipedia.org/wiki/Vector_graphics">Vector graphics</a> use points, lines, and polygons to represent images with simple geometric shapes (such as logos).  It offers high resolution and scaling.  For this option, better suited formats like SVG. <br><br>  Choosing the wrong format will cost you dearly.  The format should be changed with caution, conducting experiments with possible savings in different formats. <br><br>  Jeremy Wagner in his lecture <a href="http://jlwagner.net/talks/these-images/">highlighted the compromises</a> that should be considered when evaluating different formats in the optimization process. <br><br><a name="04"></a><h1>  Modest jpeg </h1><br>  <a href="https://en.wikipedia.org/wiki/JPEG">JPEG</a> is probably the world's most popular graphics format.  As noted earlier, <a href="httparchive.org/interesting.php">45% of the images</a> on sites in the HTTP Archive are JPEG images.  Your phone, digital camera, old webcam - they all usually support this codec.  It is very ancient, it has been used since 1992.  During this time, a huge amount of research has been done on how to improve JPEG compression. <br><br>  JPEG is a lossy compression algorithm that discards ‚Äúextra‚Äù information to save space.  The challenge is to maximize visual accuracy while minimizing file sizes. <br><br><h4>  What image quality is acceptable in your case? </h4><br>  Formats like JPEG are best suited for photos or images with lots of color.  Most optimization tools will allow you to choose an acceptable level of compression: stronger compression reduces the size of the files, but may introduce artifacts: halo or blockiness. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef8/c24/b8e/ef8c24b8ea845d7f5ba216762c72f60c.jpg"><br>  <i><font color="gray">The visible JPEG compression artifacts are growing as the transition from best quality to worst.</font></i>  <i><font color="gray">Note that the image quality indicators in different tools may vary greatly.</font></i> <br><br>  When choosing the level of compression, you should consider what quality is necessary for images: <br><br><ul><li>  <b>The best thing</b> : when quality is more important than file size.  This may be due to the fact that the image is prominent in the design or displayed in full resolution. </li><li>  <b>Good</b> : when you think about saving traffic, but do not want to significantly affect the quality of the picture.  The users are still important and the quality of illustrations. </li><li>  <b>Low</b> : when you take care of minimal traffic and tolerate image degradation.  This profile is suitable for networks with poor coverage and thin channels. </li><li>  <b>Lowest</b> : bandwidth savings are paramount.  Users agree on a rather poor quality for the sake of faster loading pages. </li></ul><br>  Next, let's talk about the JPEG compression modes, which greatly affect the result. <br><br><blockquote>  <b>Note:</b> it is possible that we sometimes overestimate the quality of the image that users need.  Quality can be considered as a deviation from the ideal source.  This is a subjective indicator. </blockquote><br><a name="05"></a><h1>  JPEG compression modes </h1><br>  JPEG has a number of different compression modes.  Three popular: basic (sequential), progressive JPEG (PJPEG) and lossless compression. <br><br><h4>  What is the difference between basic (or sequential) and progressive JPEG? </h4><br>  Basic JPEG (the default mode in most editors and optimizers) encodes and decodes relatively simple: top to bottom.  When a baseline JPEG is loaded over a slow or unstable connection, the user will first see the top of the picture.  The lossless JPEG compression mode is similar to the baseline, with only a lesser degree of compression. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d23/6db/cbe/d236dbcbedb51e84a7ab3531543008f9.jpg"><br>  <i><font color="gray">Baseline JPEG (baseline JPEG) is loaded from top to bottom, and progressive JPEG is loaded from blurred to sharp</font></i> <br><br>  Progressive JPEG divides the image into a series of passes.  The first pass shows the image in a blurred form and low quality, and subsequent passages gradually improve the quality.  Each pass increases the level of detail.  In the end, a full image is created. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/576/cd4/82c/576cd482ced17692a2dd98fc68cf7eb7.jpg"><br>  <i><font color="gray">Baseline JPEG loads the image from top to bottom.</font></i>  <i><font color="gray">PJPEG first shows a blurry image, and then increases the resolution.</font></i>  <i><font color="gray">Pat Minan has developed <a href="https%253A%252F%252Fwww.nps.gov%252Fplanyourvisit%252Fimages%252FGrandCanyonSunset_960w.jpg">an interactive tool</a> for testing and learning progressive JPEG files.</font></i> <br><br>  Lossless JPEG optimization is achieved by <a href="http://www.verexif.com/en/">removing EXIF ‚Äã‚Äãheaders</a> from digital cameras and editors, optimizing <a href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman tables,</a> and rescanning the image.  Tools like <a href="http://jpegclub.org/jpegtran/">jpegtran</a> provide lossless compression by rearranging the compressed data without degrading the image quality.  <a href="https://github.com/kud/jpegrescan">jpegrescan</a> , <a href="https://github.com/tjko/jpegoptim">jpegoptim</a> and <a href="https://github.com/mozilla/mozjpeg">mozjpeg</a> (which we will soon discuss) also support lossless JPEG compression. <br><br><a name="06"></a><h2>  Benefits of Progressive JPEG </h2><br>  The ability of PJPEG to show previews when loading improves performance ‚Äî it seems to users that the image loads faster than standard graphics. <br><br>  On slow 3G connections, this allows you to approximately see the picture when only part of the file is received - and decide whether to wait for it to fully load or not.  This may be more convenient than loading the image from top to bottom, as in basic JPEG. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f54/39b/acc/f5439bacc4fb55239d2895ac9817b492.png"><br>  <i><font color="gray">In 2015, <a href="https://code.facebook.com/posts/857662304298232/faster-photos-in-facebook-for-ios/">Facebook switched to PJPEG (for its iOS application)</a> and traffic decreased by 10%.</font></i>  <i><font color="gray">They were able to show a good quality image 15% faster than before by optimizing the perceived load time, as shown in the figure above.</font></i> <br><br>  PJPEG can reduce the file size by 2‚àí10% compared to basic / simple JPEG for images larger than 10 KB.  A higher compression ratio is achieved due to the fact that on each pass a separate <a href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman table</a> can be compiled.  Modern JPEG encoders (for example, <a href="http://libjpeg-turbo.virtualgl.org/">libjpeg-turbo</a> , MozJPEG, and others) use the flexibility of PJPEG for better data compression. <br><br><blockquote>  <b>Note:</b> Why does PJPEG compress better?  Because basic JPEG blocks are encoded one by one, and in PJPEG, <a href="https://en.wikipedia.org/wiki/Discrete_cosine_transform">discrete cosine transform</a> coefficients from several blocks can be encoded together, which results in better compression. </blockquote><br><a name="07"></a><h2>  Who uses progressive jpeg in production? </h2><br><ul><li>  <a href="https://www.webpagetest.org/performance_optimization.php%3Ftest%3D170717_NQ_1K9P%26run%3D2">Twitter.com produces progressive JPEGs</a> with a basic quality level of 85%.  They measured the subjective delay perceived by the user (the time to the first pass and the total load time), and decided that PJPEG is generally suitable based on compression quality, encoding and decoding rates. </li><li>  <a href="https://code.facebook.com/posts/857662304298232/faster-photos-in-facebook-for-ios/">Facebook produces progressive JPEGs in an iOS application</a> .  This reduced traffic by 10% and accelerated the delivery of ‚Äúgood quality‚Äù images by 15%. </li><li>  <a href="https://engineeringblog.yelp.com/2017/06/making-photos-smaller.html">Yelp switched to progressive jpeg</a> .  This is one of the measures that reduced the size of images by about 4.5%.  It fell another 13.8% due to MozJPEG. </li></ul><br>  Many other sites with a large number of graphic files, such as <a href="https://pinterest.com/">Pinterest</a> , also use progressive JPEG in production. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/106/3da/c22/1063dac226ca94466d408d5eb660ebce.png"><br>  <i><font color="gray">Pinterest website images are encoded only in progressive JPEG.</font></i>  <i><font color="gray">For users it is more convenient when the picture appears gradually</font></i> <br><br><a name="08"></a><h2>  Disadvantages of Progressive JPEG </h2><br>  PJPEG decoding is slower than basic JPEG ‚Äî sometimes three times slower.  On desktop machines with powerful processors, this is not as important as on mobile devices with limited resources.  Displaying incomplete layers requires work, since you are actually decoding the image several times.  These multiple passes eat up CPU cycles. <br><br>  Also pictures in progressive jpeg are <i>not always</i> smaller in size.  Progressive encoding of very small images (for example, thumbnails for preview) can increase their size.  And for such images, rendering in several passes generally makes little sense. <br><br>  So, before choosing PJPEG, it is advisable to experiment and find the right balance between file size, network latency and CPU usage. <br><br><blockquote>  <b>Note:</b> PJPEG (and all JPEG) hardware decoding can be supported on mobile devices.  This does not reduce memory consumption, but reduces the load on the processor.  Not all Android smartphones have hardware acceleration, but they are on high-end devices and iOS devices. </blockquote><br>  Some users may consider progressive download a disadvantage, as it makes it difficult to understand when the image has finished loading.  Try to evaluate how your audience relates to this. <br><br><a name="09"></a><h2>  How to encode files in progressive jpeg format? </h2><br>  Tools and libraries like <a href="https://www.imagemagick.org/">ImageMagick</a> , <a href="http://libjpeg.sourceforge.net/">libjpeg</a> , <a href="http://jpegclub.org/jpegtran/">jpegtran</a> , <a href="https://github.com/danielgtaylor/jpeg-archive">jpeg-recompress</a> and <a href="https://github.com/imagemin/imagemin">imagemin</a> support progressive JPEG.  If you already have an optimization pipeline, then it is likely that changing the JPEG encoding method will not be a problem: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imagemin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-imagemin'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'images'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gulp.src(<span class="hljs-string"><span class="hljs-string">'images/*.jpg'</span></span>) .pipe(imagemin({ <span class="hljs-attr"><span class="hljs-attr">progressive</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> })) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'dist'</span></span>)); });</code> </pre> <br>  Most editors save to default jpeg by default. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1fe/8fe/189/1fe8fe189888206150a2c92ad28b590f.jpg"><br>  <i><font color="gray">Most editors save to default jpeg by default, but this can be changed in the settings.</font></i>  <i><font color="gray">In Photoshop, you need to select the command ‚ÄúFile‚Äù ‚Üí ‚ÄúExport‚Äù ‚Üí ‚ÄúSave for the Web‚Äù, and then specify the format of progressive JPEG.</font></i>  <i><font color="gray">Sketch also supports Progressive JPEG export by checking the JPG export menu.</font></i> <br><br><a name="10"></a><h2>  Color downsampling </h2><br>  Our eyes notice worse loss of color than brightness.  <a href="https://en.wikipedia.org/wiki/Chroma_subsampling">Color subsampling</a> (chroma subsampling) - a type of compression that reduces color accuracy due to brightness (luma).  This reduces the file size <a href="https://calendar.perfplanet.com/2015/why-arent-your-images-using-chroma-subsampling/">to 15‚Äì17%</a> without noticeably affecting the image quality.  Downsampling also reduces memory usage. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/41b/040/dd9/41b040dd91221b76f82d9f207646ef4a.jpg"><br><br>  The contrast is responsible for the sharpness in the picture, so luma is very important.  In black and white photographs there is no color, but thanks to the brightness they look as detailed as the color counterparts.  Chroma affects visual perception less. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d7/518/d2e/1d7518d2e4020bf3c7b4f58500d2b4e5.jpg"><br>  <i><font color="gray">JPEG supports various subsample types: no subsample, horizontal, horizontal + vertical.</font></i>  <i><font color="gray">Here is an illustration from Frederick Kaiser <a href="http://frdx.free.fr/JPEG_for_the_horseshoe_crabs.pdf">'s JPEG for Crab</a> article.</font></i> <br><br>  When discussing a subsample, there are usually a number of common examples: 4: 4: 4, 4: 2: 2 and 4: 2: 0.  What are they?  Suppose a subsample has the format A: B: C.  Here A is the number of pixels in a line, for JPEG it is usually 4, B is the number of colors in the first line, and C is the number of colors in the second. <br><br><ul><li>  In <code>4:4:4</code> there is no compression, color and brightness are transmitted completely. </li><li>  In <code>4:2:2</code> half-sampling horizontally and vertically full. </li><li>  In <code>4:2:0</code> colors are used from half the pixels of the first row. </li></ul><br><blockquote>  <b>Note:</b> jpegtran and cjpeg support separate luma and chroma configurations via the <code>-sample</code> flag (for example, <code>-sample 2x1</code> ).  Some common rules: <code>-sample 2x2</code> sampling ( <code>-sample 2x2</code> ) is great for photos.  It is better to disable it ( <code>-sample 1x1</code> ) for screenshots, banners and buttons.  Finally, <code>2x1</code> in case you are not sure which option to use. </blockquote><br>  By reducing the number of pixels, you can significantly reduce the size of the color components, ultimately reducing the file size. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d5/cbd/8d3/6d5cbd8d354285776369025a20c3390c.jpg"><br>  <i><font color="gray">Color subsampling options for JPEG with 80 quality</font></i> <br><br>  Color subsampling is useful for most images, although there are obvious exceptions: it is better not to use it where color detail is as important as brightness (for example, medical images). <br><br>  Suffer and pictures with the image of fonts.  Sharp edges are harder to compress using JPEG because it is designed to better handle photographic scenes with softer transitions. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/792/434/e28/792434e286dd698afecc7de662c8ab18.jpg"><br>  <i><font color="gray">When working with text, the <a href="http://compress-or-die.com/Understanding-JPG/">JPEG Study</a> Textbook recommends adhering to 4: 4: 4 (1 √ó 1) subsampling.</font></i> <br><br>  By the way: the JPEG specification does not specify the exact method of color sub-sampling, therefore different encoders / decoders come in different ways.  MozJPEG and libjpeg-turbo use one method, and older versions of libjpeg use another method, which adds artifacts. <br><br><blockquote>  <b>Note:</b> Photoshop automatically chooses color subsampling when ‚Äúsave to web‚Äù.  If the quality is set in the range of 51‚Äì100, then downsampling is not used (4: 4: 4).  When quality is lower, 4: 2: 0 is set.  This is one of the reasons why file size decreases dramatically when switching quality from 51 to 50. </blockquote><br><blockquote>  <b>Note: The</b> term <a href="https://en.wikipedia.org/wiki/YCbCr">YCbCr</a> is often mentioned in the discussion of downsampling.  This is a model of <a href="https://en.wikipedia.org/wiki/RGB_color_model">RGB</a> color space with gamma correction.  Y is the brightness with gamma correction, Cb is the chroma component of blue, and Cr is red.  If you look at ExifData, you will see YCbCr next to the sample levels. </blockquote><br>  For more information, see the article <a href="https://calendar.perfplanet.com/2015/why-arent-your-images-using-chroma-subsampling/">‚ÄúWhy don't you use color subsampling?‚Äù</a> <br><br><a name="11"></a><h2>  Improved JPEG </h2><br><h4>  What is the current state of jpeg formats on the internet? </h4><br> <i>tl;dr:     .    ,        .</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e2/26c/f29/3e226cf294bca6151e7ab29b3cc8e05d.jpg"><br> <i><font color="gray">   ( )        26 .    <a href="https://en.wikipedia.org/wiki/Structural_similarity">SSIM</a> ( )  <a href="https://github.com/google/butteraugli">Butteraugli</a> ,      .</font></i> <br><br><ul><li> <b><a href="https://en.wikipedia.org/wiki/JPEG_2000">JPEG 2000</a> (2000)</b> ‚Äî          . <b>  :  Safari  iOS</b> . </li><li> <b><a href="https://en.wikipedia.org/wiki/JPEG_XR">JPEG XR</a> (2009)</b> ‚Äî  JPEG  JPEG 2000,  <a href="http://wikivisually.com/wiki/High_dynamic_range_imaging">HDR</a>    <a href="http://wikivisually.com/wiki/Gamut"></a> .    ,  JPEG,      /. <b>  : Edge, IE</b> . </li><li> <b><a href="https://en.wikipedia.org/wiki/WebP">WebP</a> (2010)</b> ‚Äî       Google       .   ,  JPEG,   ,  PNG.        .   ,   JPEG. <b>  : Chrome, Opera.    Safari  Firefox</b> . </li><li> <b><a href="https://en.wikipedia.org/wiki/Free_Lossless_Image_Format">FLIF</a> (2015)</b> ‚Äî    ,  PNG, WebP  , BPG    JPEG 2000     . <b>  : ,   <a href="https://github.com/UprootLabs/poly-flif">JS-</a></b> . </li><li> <b>HEIF  BPG</b> .      ,     : </li><li> <b><a href="https://en.wikipedia.org/wiki/Better_Portable_Graphics">BPG</a> (2015)</b> ‚Äî  JPEG      HEVC ( <a href="http://wikivisually.com/wiki/High_Efficiency_Video_Coding">High Efficiency Video Coding</a> ). ,        MozJPEG  WebP.      -   . <b>  : ,   <a href="https://bellard.org/bpg/">JS-</a></b> . </li><li> <b><a href="https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format">HEIF</a> (2015)</b> ‚Äî      ,  HEVC   . Apple   <a href="https://www.cnet.com/news/apple-ios-boosts-heif-photos-over-jpeg-wwdc/">WWDC</a> ,     c JPEG  HEIF    iOS,        . <b>  :     .     Safari  iOS 11</b> . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you like to perceive information in graphical form, you can rate </font></font><a href="https://people.xiph.org/~xiphmont/demo/daala/update1-tool2b.shtml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of </font></font><a href="http://xooyoozoo.github.io/yolo-octo-bugfixes/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">these</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> visual comparison tools for some of the above formats. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">browser support is very different</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . To use any of the above formats, you may have to give different copies to each of the target browsers. We see certain perspectives of WebP at Google, so we‚Äôll take a closer look at this format in more detail. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can also produce different formats (for example, WebP, JPEG 2000) with the same .jpg extension (or any other) because the browser can choose a content-type to render regardless of the extension. This allows you to </font></font><a href="https://www.igvita.com/2012/12/18/deploying-new-image-formats-on-the-web/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specify a content-type.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the server side without changing the HTML document at all. </font><font style="vertical-align: inherit;">Services like Instart Logic use this approach. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, let's talk about situations where it is impossible to produce images in different formats: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPEG-optimizers</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will help here </font><font style="vertical-align: inherit;">.</font></font><br><br><a name="12"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JPEG optimizers </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modern JPEG codecs are trying to reduce the size of JPEG files, while maintaining the highest quality and compatibility with existing browsers and applications. </font><font style="vertical-align: inherit;">They eliminate the need to use new image formats and make changes to the ecosystem. </font><font style="vertical-align: inherit;">Two such encoders are MozJPEG and Guetzli. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tl; dr: Which optimized JPEG codec to use?</font></font></b> <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Most files: MozJPEG </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If quality is important and you agree on long coding: Guetzli </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If configurability is needed: </font></font></li></ul><br><a name="13"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is MozJPEG? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mozilla offers an upgraded JPEG encoder - </font></font><a href="https://github.com/mozilla/mozjpeg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MozJPEG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . According </font></font><a href="https://research.mozilla.org/2014/03/05/introducing-the-mozjpeg-project/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> developers, it reduces the size of JPEG files to 10%. Files compressed with MozJPEG open in all browsers, and among the supported features are progressive scanning, </font></font><a href="https://en.wikipedia.org/wiki/Trellis_quantization"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trellis quantization</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (removing parts that are worst compressed) and several advanced </font></font><a href="https://calendar.perfplanet.com/2014/mozjpeg-3-0/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quantization table templates</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that help create smoother High-DPI images (although this is possible with ImageMagick, if you are ready to wade through the wilds of the XML configuration). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MozJPEG is supported by </font></font><a href="https://github.com/ImageOptim/ImageOptim/issues/45"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageOptim</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and for it there is a relatively reliable custom </font></font><a href="https://github.com/imagemin/imagemin-mozjpeg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagemin plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Here is an example implementation using Gulp:</font></font><br><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> gulp = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imagemin = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-imagemin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imageminMozjpeg = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'imagemin-mozjpeg'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'mozjpeg'</span></span>, () =&gt; gulp.src(<span class="hljs-string"><span class="hljs-string">'src/*.jpg'</span></span>) .pipe(imagemin([imageminMozjpeg({ quality: <span class="hljs-number"><span class="hljs-number">85</span></span> })])) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'dist'</span></span>)) );</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/4f4/7fe/93a/4f47fe93a97da4bb6e0d1fb491f99d32.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c90/265/8a2/c902658a2ad04db50cf3a5e76d8cffb5.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MozJPEG: Comparison of file size and visual similarity scores on different qualities</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To calculate the SSIM scores (structural similarity with the original image), I used</font></font><a href="https://github.com/imagemin/imagemin-jpeg-recompress"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jpeg-compress</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the</font></font><a href="https://github.com/danielgtaylor/jpeg-archive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jpeg-archive</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project</font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In my experience, MozJPEG is a good option for compressing images for the Internet with high quality while reducing file size. For small and medium-sized images, MozJPEG (with a quality of 80‚Äì85) reduces files by 30‚Äì40% while maintaining acceptable SSIM and an improvement of 5‚Äì6% in jpeg-turbo. It encodes</font></font><a href="http://www.libjpeg-turbo.org/About/Mozjpeg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> more slowly than basic jpeg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but the difference is not critical.</font></font><br><br><blockquote> <b>:</b>    ,  MozJPEG          ,   <a href="https://github.com/danielgtaylor/jpeg-archive">jpeg-recompress</a> .   ¬´-  ¬ª        <a href="https://twitter.com/malchata/status/884836650563579904"></a> . </blockquote><br><a name="14"></a><h2>   Guetzli? </h2><br> <a href="https://github.com/google/guetzli"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guetzli</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is </font><a href="https://github.com/google/guetzli"><font style="vertical-align: inherit;">Google</font></a><font style="vertical-align: inherit;"> 's promising, but very slow, perceptual JPEG codec. He is trying to find the smallest JPEG, perceptually indistinguishable from the original. The codec performs a series of experiments, offering options for comparison, and takes into account the psycho-visual error of each option. The final result is the one with the highest score. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To measure the differences between images, Guetzli uses </font></font><a href="https://github.com/google/butteraugli"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Butteraugli</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a model based on human perception (discussed below). Guetzli takes into account some properties of human vision that are not taken into account by other JPEG codecs. For example, there is a relationship between the amount of visible green light and the sensitivity to blue, so changes in blue around green can be encoded less accurately.</font></font><br><br><blockquote> <b>:</b>   <b></b>     <b> </b> ,    .         JPEG ,  √≥ ,    .       .      ,      . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guetzli </font></font><a href="https://research.googleblog.com/2017/03/announcing-guetzli-new-open-source-jpeg.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">claims</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a difference in file size of 20‚Äì30% without reducing Butteraugli‚Äôs score compared to other compressors. Guetzli's big drawback is its extreme slowness, so at the moment it is only suitable for static content. A large amount of consumed memory is indicated in the README: encoding takes about 1 minute and 200 MB of RAM per megapixel. GitHub has a </font></font><a href="https://github.com/google/guetzli/issues/50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">good thread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with a discussion of actual Guetzli experience. The codec is ideal for optimizing images when building a static site, but to a lesser extent suitable for running on demand. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tools like ImageOptim support Guetzli optimizations (in </font></font><a href="https://imageoptim.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recent versions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> gulp = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imagemin = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-imagemin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imageminGuetzli = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'imagemin-guetzli'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'guetzli'</span></span>, () =&gt; gulp.src(<span class="hljs-string"><span class="hljs-string">'src/*.jpg'</span></span>) .pipe(imagemin([ imageminGuetzli({ quality: <span class="hljs-number"><span class="hljs-number">85</span></span> }) ])) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'dist'</span></span>)) );</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/734/9a0/698/7349a069854fef62982512c8e3a08f1a.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding Guetzli images of 3000 √ó 3000 pixels with different levels took almost seven minutes. </font><font style="vertical-align: inherit;">It makes sense for archival storage of high-resolution photos. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b2b/6a4/1a8/b2b6a41a8799620ebc175fb9c63c1bb0.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guetzli: comparing file sizes and assessing visual similarities for different qualities</font></font></font></i> <br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: It is</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recommended to run Guetzli on high-quality images (for example, uncompressed source images, PNG or JPEG with about 100% quality). </font><font style="vertical-align: inherit;">Although the effect is on other images (for example, JPEG quality 84 or lower), but the results are worse.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guetzli spends very (very) a lot of time and will make the CPU cooler unwind, but worth it. </font><font style="vertical-align: inherit;">I saw a number of examples when the file size was reduced by 40% while maintaining visual accuracy. </font><font style="vertical-align: inherit;">This makes it an ideal choice for archiving photos. </font><font style="vertical-align: inherit;">On images of small and medium size, there is also some savings (in the range of 10‚àí15 KB), but not so significant. </font><font style="vertical-align: inherit;">When compressing very small images, Guetzli can introduce ‚Äúliquid-like‚Äù distortions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For a variety of use </font><font style="vertical-align: inherit;">cases </font><font style="vertical-align: inherit;">, you might be interested in </font></font><a href="https://cloudinary.com/blog/a_closer_look_at_guetzli"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Guetzli with Cloudinary's automatic compression in Eric Portis research.</font></font><br><br><a name="15"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comparing MozJPEG and Guetzli </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is difficult to compare different JPEG codecs: it is necessary to evaluate both the quality and accuracy of the compressed image, not just the size. </font><font style="vertical-align: inherit;">As the image compression expert Corneille Lesinski notes, the benchmark of only one, and not both, aspects can lead to </font></font><a href="https://kornel.ski/faircomparison"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wrong</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conclusions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What do Guetzli and MozJPEG look like in comparison? </font><font style="vertical-align: inherit;">Corneille approach:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Guetzli is suitable for higher quality images (the optimal butteraugli score is calculated for q = 90 +, and for MozJPEG - around q = 75) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Guetzli is much slower (both produce standard JPEGs, so decoding is equally fast, as usual) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MozJPEG does not automatically select the quality setting, but you can find the optimum quality using an external tool, for example, </font></font><a href="https://github.com/danielgtaylor/jpeg-archive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jpeg-archive</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are a number of methods for determining the visual or perceptual similarity of compressed images with the source code. </font></font><a href="https://en.wikipedia.org/wiki/Structural_similarity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSIM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (structural similarity) is </font><font style="vertical-align: inherit;">often used in research </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">However, Guetzli is optimized for Butteraugli.</font></font><br><br><a name="16"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Butteraugli </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Butteraugli system determines the moment when a person begins to notice the difference (psycho-visual similarity) between the two images. Butteraugli not only gives an estimate, but also makes a spatial map of the level of differences. While SSIM summarizes all the errors, Butteraugli looks for the maximum. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/798/5b0/df8/7985b0df81227135fd3b432abf490a1b.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this example, Butteraugli searches for a minimum JPEG quality threshold so that the user does not notice the visual difference between the images. This reduced the file size by 65%.</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In practice, you determine the level of visual quality, and then run several image optimization strategies, looking at Butteraugli estimates, before choosing a result that matches the optimal balance between file size and compression level.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf8/9e1/b18/bf89e1b182b3c5e8b89ffab674e1488d.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It took me about 30 minutes to localize the Butteraugli setup after installing Bazel and building the C ++ source code for correct compilation on a Mac. </font><font style="vertical-align: inherit;">Its use is relatively simple: specify two images for comparison (source and compressed version) - and get an estimate</font></font></font></i> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How does Butteraugli differ from other ways of assessing visual similarity? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of the developers of Guetzli </font></font><a href="https://github.com/google/guetzli/issues/10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">says</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that Guetzli is better for Butteraugli, worse for SSIM, and MozJPEG is about equally good for both metrics. </font><font style="vertical-align: inherit;">This is the strategy I use to optimize images. </font><font style="vertical-align: inherit;">I run Butteraugli and a Node module like </font></font><a href="https://www.npmjs.com/package/img-ssim"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">img-ssim</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to compare SSIM ratings before / after Guetzli and MozJPEG.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Encoder Association? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As practice has shown, the combination of Guetzli and MozJPEG </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without loss</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (jpegtran, not cjpeg, so as not to discard the work done by Guetzli) allows you to further reduce the file size by 10‚àí15% (55% overall) with a very slight decrease in the SSIM score. </font><font style="vertical-align: inherit;">This requires verification and analysis, but other specialists like </font></font><a href="https://ariya.io/2017/03/squeezing-jpeg-images-with-guetzli"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aria Hidayat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tried - and got the same promising result. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MozJPEG is a convenient beginner codec that compresses files for the web relatively quickly and provides good image quality. </font><font style="vertical-align: inherit;">At the same time, Guetzli is resource intensive and works best on large, high-quality images: I would recommend this option to advanced and professional users.</font></font><br><br><a name="17"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is WebP? </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP is Google‚Äôs latest graphic format that seeks to reduce file sizes under lossless and lossy compression, providing an acceptable visual quality. </font><font style="vertical-align: inherit;">Supports alpha channel (transparency) and animation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP is improving: over the past year it added a few percent in lossless and lossy compression, the coding speed was twice as fast, and the decoding speed increased by 10%. </font><font style="vertical-align: inherit;">WebP is not a universal tool, but its popularity is growing. </font><font style="vertical-align: inherit;">Let's take a look at why. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9a/25d/5ca/f9a25d5cafa3418ab89008985e8784d4.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP: comparing file sizes and evaluating visual similarities at different quality levels</font></font></font></i> <br><br><a name="18"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How does webp work? </font></font></h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lossy compression </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Developers say that with lossy compression using the VP8 or VP9 codec, files are reduced by an average of </font></font><a href="https://developers.google.com/speed/webp/docs/webp_study"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25‚Äì34%</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compared to JPEG. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the low quality range (0‚Äì50), WebP has a great advantage over JPEG, because it blurs ugly blockiness artifacts. </font><font style="vertical-align: inherit;">Medium quality setting (-m 4 -q 75) ‚Äîthe default balance of speed and file size. </font><font style="vertical-align: inherit;">In the high quality range (80‚Äì99), the advantages of WebP are minimal. </font><font style="vertical-align: inherit;">WebP is recommended where speed is more important than quality.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lossless compression </font></font></h4><br> <a href="https://developers.google.com/speed/webp/docs/webp_lossless_alpha_study"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP files with lossless compression are 26% smaller than PNG files</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Download time is reduced by 3% compared to PNG. </font><font style="vertical-align: inherit;">However, lossless compression is not commonly used on the Internet. </font><font style="vertical-align: inherit;">This option is better suited for archival storage.</font></font><br><br><h4>  Transparency </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP has an 8-bit transparency channel with lossless compression of only 22% more bytes than PNG. </font><font style="vertical-align: inherit;">It also supports lossy RGB transparency; this is a unique feature of WebP.</font></font><br><br><h4>  Metadata </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The WebP format supports metadata of EXIF ‚Äã‚Äãphotos and digital XMP documents, and also contains an ICC color profile. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP provides better compression due to higher CPU utilization. </font><font style="vertical-align: inherit;">Back in 2013, WebP compression was about 10 times slower than that of JPEG, but now the difference is not so significant (some images can be compressed twice as slowly). </font><font style="vertical-align: inherit;">For static images that are processed during the build process, this should not be a big problem. </font><font style="vertical-align: inherit;">Dynamically generated images are likely to cause noticeable use of the CPU, which will have to be considered.</font></font><br><br><blockquote> <b>:</b>   WebP      JPEG. , JPEG   70%      WebP   70%,   WebP    ,   . </blockquote><br><a name="19"></a><h2>   WebP  ? </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many large companies use WebP in production to reduce costs and increase page loading speed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google reported a 30‚Äì35% savings on WebP compared to other lossy compression schemes. Google produces 43 billion images per day, 26% of which are compressed without loss. These are many requests and significant savings. Undoubtedly, it will increase even more when browsers improve </font></font><a href="http://caniuse.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support for WebP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Google uses this format on Google Play, YouTube and other sites. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netflix, Amazon, Quora, Yahoo, Walmart, Ebay, The Guardian, Fortune, and USA Today compress and display WebP images for browsers that support it. The VoxMedia publisher </font></font><a href="https://product.voxmedia.com/2015/8/13/9143805/performance-update-2-electric-boogaloo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reduced the download time for </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Verge </font></font></i><font style="vertical-align: inherit;"><a href="https://product.voxmedia.com/2015/8/13/9143805/performance-update-2-electric-boogaloo"><font style="vertical-align: inherit;">pages by 1-3 seconds by</font></a><font style="vertical-align: inherit;"> switching to WebP for Chrome users. Site</font></font><a href="https://iso.500px.com/500px-color-profiles-file-formats-and-you/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500px</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recorded a decrease in file sizes by an average of 25% with the same or better quality. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to the above, other companies use WebP. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c9f/2a1/51f/c9f2a151ff30b5a3dd8b20178a78e64b.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using WebP with Google: 43 billion pictures of WebP are issued daily on YouTube, Google Play, Chrome Data Saver and G +</font></font></font></i> <br><br><a name="20"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How does WebP coding work? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For static images, WebP is an alternative to JPEG. In lossy coding, there are three key stages: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Macro-blocking</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äî splitting an image into (macro) blocks of 16 √ó 16 pixels of brightness and blocks of 8 √ó 8 pixels of chromaticity. This is similar to how JPEG converts a color space, breaking it into blocks and lowering the number of pixels on the color channels. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/65f/45b/705/65f45b70532300058c0e9a00fe08b6de.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prediction</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äî For each 4 √ó 4 subblock, a prediction model is compiled that effectively performs filtering. It is determined by two sets of pixels around the block: A (the line immediately above) and L (left column). Using these two sets, the encoder fills the 4 √ó 4 test block with pixels and determines which values ‚Äã‚Äãare closest to the source block. Colt Macanlis talks about this in more detail in an </font></font><a href="https://medium.com/%40duhroach/how-webp-works-lossly-mode-33bd2b1d0670"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> how WebP works in lossy compression mode. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd2/863/50a/cd286350a67629c8fa14233af6973893.png"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The discrete cosine transform (DCT) is applied in several steps, as in JPEG. </font><font style="vertical-align: inherit;">The key difference is the use of </font></font><a href="https://www.youtube.com/watch%3Fv%3DFdMoL3PzmSA%26index%3D7%26list%3DPLOU2XLYxmsIJGErt5rrCqaSGTMyyqNt2H"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arithmetic compression</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , not a Huffman algorithm, as in JPEG. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For more information, I recommend the article </font></font><a href="https://developers.google.com/speed/webp/docs/compression"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"WebP Compression Methods"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from Google Developer.</font></font><br><br><a name="21"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WebP Browser Support </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not all browsers support WebP, but according </font></font><a href="http://caniuse.com/webp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to CanIUse.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , global support is about 74%. </font><font style="vertical-align: inherit;">Chrome and Opera support the format. </font><font style="vertical-align: inherit;">Safari, Edge and Firefox are experimenting, but have not yet implemented support in official versions. </font><font style="vertical-align: inherit;">Because of this, WebP issuance often depends on the web developer. </font><font style="vertical-align: inherit;">More on this later. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here are the main browsers and support information for each of them:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chrome: full support from version 23 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chrome for Android: starting with Chrome 50 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Android: from 4.2 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Opera: from 12.1 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Opera Mini: all versions </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Firefox: some beta support </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Edge: some beta support </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Internet Explorer: no </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Safari: some beta support </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP is not without flaws. </font><font style="vertical-align: inherit;">It lacks full-resolution color space options and does not support progressive decoding. </font><font style="vertical-align: inherit;">However, a decent toolkit has been created for WebP, and browser support is enough to consider WebP output as one of the options.</font></font><br><br><a name="22"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to convert images to webp? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Several commercial and free editors support WebP. </font><font style="vertical-align: inherit;">One of the most useful applications is XnConvert: a free cross-platform batch converter.</font></font><br><br><blockquote> <b>:</b>      WebP  JPEG    .   ,      WebP    JPEG.    WebP,      , <i>  JPEG</i> ,      .      ,  . </blockquote><br><h4> XnConvert </h4><br> <a href="http://www.xnview.com/en/xnconvert/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XnConvert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> batch processes images in more than 500 formats. </font><font style="vertical-align: inherit;">You can combine more than 80 separate actions to convert or edit images in different ways. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/507/572/44f/50757244ffc4338222e3960f09485c31.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XnConvert supports batch image optimization by performing direct conversion from source files to WebP and other formats. </font><font style="vertical-align: inherit;">In addition to compression, XnConvert can remove metadata, crop images, adjust color depth, and perform other transformations.</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Some of the parameters listed on the xnview website:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Metadata: Editing </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transformations: rotate, cut, resize </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adjustments: brightness, contrast, saturation </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Filters: blur, relief, sharpness </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effects: masks, watermarks, vignetting (partial dimming) </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Results of operations can be exported to approximately 70 different file formats, including WebP. </font><font style="vertical-align: inherit;">XnConvert is a free program for Linux, Mac, and Windows. </font><font style="vertical-align: inherit;">This is a great option, especially for small businesses.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Node Modules </font></font></h4><br> <a href="https://github.com/imagemin/imagemin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagemin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a popular image compression module that has an extension to convert to WebP ( </font></font><a href="https://github.com/imagemin/imagemin-webp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagemin-webp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Lossy and lossless compression is supported. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To install imagemin and imagemin-webp, run: </font></font><br><br> <code>&gt; npm install --save imagemin imagemin-webp</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then we can add () in both modules and run them on any images (for example, JPEG) in the project directory. </font><font style="vertical-align: inherit;">Below we use lossy coding with the quality of the WebP 60 encoder:</font></font><br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imagemin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'imagemin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imageminWebp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'imagemin-webp'</span></span>); imagemin([<span class="hljs-string"><span class="hljs-string">'images/*.{jpg}'</span></span>], <span class="hljs-string"><span class="hljs-string">'images'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ imageminWebp({<span class="hljs-attr"><span class="hljs-attr">quality</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>}) ] }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Images optimized'</span></span>); });</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As in JPEG, you can notice compression artifacts in the final image. </font><font style="vertical-align: inherit;">See for yourself what level of compression is adequate for your files. </font><font style="vertical-align: inherit;">Imagemin-webp can also be used to encode WebP images without loss of quality (with 24-bit color support and full transparency) by specifying the parameter </font></font><code>lossless: true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imagemin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'imagemin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imageminWebp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'imagemin-webp'</span></span>); imagemin([<span class="hljs-string"><span class="hljs-string">'images/*.{jpg,png}'</span></span>], <span class="hljs-string"><span class="hljs-string">'build/images'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ imageminWebp({<span class="hljs-attr"><span class="hljs-attr">lossless</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) ] }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Images optimized'</span></span>); });</code> </pre> <br> <a href="https://github.com/sindresorhus/gulp-webp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP plugin for Gulp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from Sindre Sorgus is based on imagemin-webp, there is also </font></font><a href="https://www.npmjs.com/package/webp-loader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a WebP uploader for WebPack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The Gulp plugin understands all the imagemin extension options:</font></font><br><br><pre> <code class="hljs coffeescript">const gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); const webp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-webp'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'webp'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> gulp.src(<span class="hljs-string"><span class="hljs-string">'src/*.jpg'</span></span>) .pipe(webp({ quality: <span class="hljs-number"><span class="hljs-number">80</span></span>, preset: <span class="hljs-string"><span class="hljs-string">'photo'</span></span>, method: <span class="hljs-number"><span class="hljs-number">6</span></span> })) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'dist'</span></span>)) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Or lossless compression: </font></font><br><br><pre> <code class="hljs coffeescript">const gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); const webp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-webp'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'webp-lossless'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> gulp.src(<span class="hljs-string"><span class="hljs-string">'src/*.jpg'</span></span>) .pipe(webp({ lossless: <span class="hljs-literal"><span class="hljs-literal">true</span></span> })) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'dist'</span></span>)) );</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Batch Image Optimization with Bash </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XNConvert supports batch compression, but everything can be done from the command line. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batch image conversion to WebP format using </font></font><a href="https://developers.google.com/speed/webp/docs/cwebp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cwebp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs">find ./ -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.jpg'</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> cwebp -q 70 {} -o {}.webp \;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimization codec MozJPEG using </font></font><a href="https://github.com/danielgtaylor/jpeg-archive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jpeg-recompress</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs">find ./ -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.jpg'</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> jpeg-recompress {} {} \;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and trimming SVG using the </font></font><a href="https://github.com/svg/svgo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">svgo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> program </font><font style="vertical-align: inherit;">(which we will look at later):</font></font><br><br><pre> <code class="bash hljs">find ./ -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.svg'</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> svgo {} \;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeremy Wagner wrote a more complete article on </font></font><a href="https://jeremywagner.me/blog/bulk-image-optimization-in-bash"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimizing images in Bash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and another one on </font></font><a href="https://jeremywagner.me/blog/faster-bulk-image-optimization-in-bash"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parallelizing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this task.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Other applications for processing and editing WebP </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leptonica is a whole web site of free applications for image processing and analysis. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sketch supports saving to webp. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GIMP is an open source free alternative to Photoshop. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageMagick - create, layout, transform and edit raster graphics. </font><font style="vertical-align: inherit;">Free, running from the command line.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pixelmator is a commercial image editor for Mac. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photoshop WebP Plugin is a free plugin from Google. </font><font style="vertical-align: inherit;">Import and export images in Photoshop.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For Android, you can convert existing BMP, JPG, PNG and static GIF images to WebP format using Android Studio. </font><font style="vertical-align: inherit;">See </font></font><a href="https://developer.android.com/studio/write/convert-webp.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúCreating WebP Images Using Android Studio‚Äù for more information</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="23"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to view WebP images on my OS? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although WebP images always open in a browser on the Blink engine (Chrome, Opera, Brave), they can be viewed directly from the OS using an add-in for Mac or Windows. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Several years ago, </font></font><a href="https://www.cnet.com/news/facebook-tries-googles-webp-image-format-users-squawk/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facebook experimented with WebP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and noticed a problem: some users saved pictures to disk, and then they could not open them. </font><font style="vertical-align: inherit;">Here are three key issues:</font></font><br><br><ul><li>       WebP .    Chrome,       .webp. </li><li>        ,    Chrome. Facebook  ,    ¬´¬ª,    JPEG. </li><li>  URL         <a href="https://www.igvita.com/2012/12/18/deploying-new-image-formats-on-the-web/"> content-type</a> . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Your users may not have such problems, but this is an interesting note in the margins. </font><font style="vertical-align: inherit;">Fortunately, today there are utilities for viewing WebP under different operating systems. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On a Mac, try the </font></font><a href="https://github.com/Nyx0uf/qlImageSize"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quick Look WebP plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (qlImageSize). </font><font style="vertical-align: inherit;">It works well: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/31f/440/5f5/31f4405f5b2c5e9fe146d00c77566621.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Under Windows, you can download </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the WebP codec pack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which adds the WebP viewing option to File Explorer and Windows Photo Viewer.</font></font><br><br><a name="24"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to give WebP? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browsers without WebP support will not show any pictures. </font><font style="vertical-align: inherit;">To avoid this, there are several strategies. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/921/075/af2/921075af2ee07862f7dc586ee402793d.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Chrome DevTools Network panel with selection of WebP type files that are sent to browsers on the Blink </font></font></font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a88/8c9/56d/a888c956d80db06c0b4a170be510135e.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Play Store </font></font></font></i> <font style="vertical-align: inherit;"><i><font color="gray"><font style="vertical-align: inherit;">engine </font></font></i><i><font color="gray"><font style="vertical-align: inherit;">gives WebP browsers to Blink and JPEG to others, such as Firefox.</font></font></i></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here are some options for delivering WebP images to users:</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Use .htaccess for issuing copies of WebP </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here's how to use .htaccess to output WebP files in supported browsers, if the server has a webp version of the JPEG / PNG file. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vincent Orbach recommended this approach: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browsers can explicitly </font></font><a href="http://vincentorback.se/blog/using-webp-images-with-htaccess/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signal support for WebP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> through the </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept header</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In this case, you can give the server a WebP version of the image. </font><font style="vertical-align: inherit;">But this is not always possible (for example, for static hosts, such as GitHub or S3 pages), so be sure to check before considering this option. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Below is an example .htaccess file for the Apache web server:</font></font><br><br><pre> <code class="hljs pgsql">&lt;IfModule mod_rewrite.c&gt; RewriteEngine <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">Check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> browser support WebP images RewriteCond %{HTTP_ACCEPT} image/webp # <span class="hljs-keyword"><span class="hljs-keyword">Check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> WebP replacement image <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> RewriteCond %{DOCUMENT_ROOT}/<span class="hljs-meta"><span class="hljs-meta">$1</span></span>.webp -f # Serve WebP image <span class="hljs-keyword"><span class="hljs-keyword">instead</span></span> RewriteRule (.+)\.(jpe?g|png)$ <span class="hljs-meta"><span class="hljs-meta">$1</span></span>.webp [T=image/webp,E=accept:<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt;/IfModule&gt; &lt;IfModule mod_headers.c&gt; <span class="hljs-keyword"><span class="hljs-keyword">Header</span></span> append Vary Accept env=REDIRECT_accept &lt;/IfModule&gt; AddType image/webp .webp</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If there are problems with displaying WebP graphics, make sure that the image / webp MIME type is enabled on the server. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On Apache, add the following code to the .htaccess file:</font></font><br><br><pre> <code class="hljs mel">AddType <span class="hljs-keyword"><span class="hljs-keyword">image</span></span>/webp .webp</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> On Nginx, add the following code to the mime.types file: </font></font><br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">image</span></span>/webp webp;</code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vincent Orback provides a </font></font><a href="https://github.com/vincentorback/WebP-images-with-htaccess"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sample htaccess</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for issuing WebP, and Ilya Grigorik maintains a collection of </font></font><a href="https://github.com/igrigorik/webp-detect"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configuration scripts for issuing WebP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which can be useful.</font></font></blockquote><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using the &lt;picture&gt; tag </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The browser itself is able to select the image format using the &lt;picture&gt; tag. </font><font style="vertical-align: inherit;">Inside &lt;picture&gt; there is a set of &lt;source&gt; elements, with one &lt;img&gt; tag for each where the image is actually contained. </font><font style="vertical-align: inherit;">The browser scans the &lt;source&gt; and requests the first matching one. </font><font style="vertical-align: inherit;">If the &lt;picture&gt; tag is not supported, then the &lt;div&gt; is rendered using the &lt;img&gt; tag.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Be careful with the order of the &lt;source&gt; elements. </font><font style="vertical-align: inherit;">Do not place image / webp sources after obsolete formats, but place them in front of them. </font><font style="vertical-align: inherit;">You can also place the images in ascending file size if they have the same size in pixels (when the attribute is not used </font></font><code>media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Usually it turns out the same order as when first specifying newer formats.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here are some HTML examples: </font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/path/to/image.webp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image/webp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/path/to/image.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'paul_irish.jxr'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'image/vnd.ms-photo'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'paul_irish.jp2'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'image/jp2'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'paul_irish.webp'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'image/webp'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'paul_irish.jpg'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'paul'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"photo.jxr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image/vnd.ms-photo"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"photo.jp2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image/jp2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"photo.webp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image/webp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"photo.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My beautiful face"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">picture</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Automatic conversion to WebP on the CDN side </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some CDNs support automatic conversion and WebP output at the client‚Äôs request </font></font><a href="http://cloudinary.com/documentation/responsive_images"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whenever possible</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Check your CDN for support. </font><font style="vertical-align: inherit;">Perhaps the problem is solved very simply.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WordPress support </font></font></h4><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetpack</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a popular WordPress plugin, includes a CDN image service called </font></font><a href="https://jetpack.com/support/photon/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with WebP support. It is included in the free version of the Jetpack, which is very practical and useful. The disadvantage is that Photon automatically resizes the image, puts the query string in the URL, and for each image an additional DNS query is performed. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache Enabler and Optimizer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : if you are using WordPress, there is at least one open source option. In the menu plug </font></font><a href="https://wordpress.org/plugins/cache-enabler/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache Enabler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a checkbox for caching and displaying WebP images, if the user's browser supports them. </font><font style="vertical-align: inherit;">This makes it easier to work with WebP. </font><font style="vertical-align: inherit;">There is also a disadvantage here: Cache Enabler requires the use of a related program Optimizer, for which an annual fee is charged. </font><font style="vertical-align: inherit;">This is not very typical of open source solutions. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Short Pixel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : another version of the optimizer for Cache Enabler, also paid. </font><font style="vertical-align: inherit;">In terms of functionality, Short Pixel is very similar to the Optimizer mentioned. </font><font style="vertical-align: inherit;">Allows you to optimize for free up to 100 photos per month.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compress GIF animations and why &lt;video&gt; is better </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animated GIFs are still widely used, despite their narrow specialization. Although everything from social networks to popular media sites, using GIF-animation abundantly, this format was </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">never</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> meant for video or animation. In fact, </font></font><a href="https://www.w3.org/Graphics/GIF/spec-gif89a.txt"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the GIF89a specification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clearly indicates that "GIF is not intended to serve as a platform for animation." </font></font><a href="http://gifbrewery.tumblr.com/post/39564982268/can-you-recommend-a-good-length-of-clip-to-keep-gifs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The number of colors, the number of frames and proportions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - all this affects the size of the animated GIF. Replacing video format gives maximum savings. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/56b/bda/eb7/56bbdaeb754a883674dc575a36542d8e.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparing the size of GIF-animation and video in equivalent quality.</font></font></font></i> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The output of the same video in MP4 format reduces the file size by 80% or more.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Besides the fact that GIF files waste traffic, they take longer to load, contain fewer colors and usually do not look very nice. You may have noticed that GIF animations uploaded to Twitter work better there than on other sites. This is because </font></font><a href="http://mashable.com/2014/06/20/twitter-gifs-mp4/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter animated GIFs are not really GIFs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . To improve quality and reduce traffic, Twitter automatically converts them to video. Similarly, </font></font><a href="https://thenextweb.com/insider/2014/10/09/imgur-begins-converting-gif-uploads-mp4-videos-new-gifv-format/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imgur converts GIF to MP4 when loaded</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why are GIFs so many times larger? </font><font style="vertical-align: inherit;">Because they store each frame as a GIF without loss - yes, without loss. </font><font style="vertical-align: inherit;">Poor GIF quality is not caused by compression, but by a palette of 256 colors. </font><font style="vertical-align: inherit;">The format does not analyze adjacent frames for compression, unlike video codecs like H.264. </font><font style="vertical-align: inherit;">MP4 video stores each keyframe as a lossy JPEG, discarding some of the original data to achieve better compression.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you can switch to video </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use </font></font><a href="https://www.ffmpeg.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffmpeg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to convert animated GIFs (or source files) to MP4 (H.264). </font><font style="vertical-align: inherit;">I run such a one-liner from </font></font><a href="http://rigor.com/blog/2015/12/optimizing-animated-gifs-with-html5-video"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rigor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br> <code>ffmpeg -i animated.gif -movflags faststart -pix_fmt yuv420p -vf "scale=trunc(iw/2)2:trunc(ih/2)2" video.mp4</code> </li> <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The ImageOptim API also supports the conversion of animated GIF to WebM / H.264 and removes GIF anti-aliasing, which further enhances compression. </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you have to use animated gifs </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tools like Gifsicle remove metadata, unused palette colors and minimize changes between frames. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consider lossy GIF encoding. </font><font style="vertical-align: inherit;">Giflossy - fork Gifsicle, which supports the flag </font></font><code>-lossy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and compresses the animation by 60‚àí65%. </font><font style="vertical-align: inherit;">On its basis, a good tool made </font></font><a href="https://github.com/vvo/gifify"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gifify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Convert non-animated GIFs to PNG or WebP format.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For more information, see the </font><font style="vertical-align: inherit;">Rigor </font></font><a href="https://rigor.com/wp-content/uploads/2017/03/TheBookofGIFPDF.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIF Book</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="25"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SVG Optimization </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimizing SVG files means removing everything that is unnecessary. </font><font style="vertical-align: inherit;">As a rule, the SVG from the editor contains a lot of redundant information (metadata, comments, hidden layers, and so on). </font><font style="vertical-align: inherit;">Often it can be safely removed or minimized without affecting the visual result. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb6/e7e/747/cb6e7e747134071886e39623f818a8b1.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the </font></font><a href="https://jakearchibald.github.io/svgomg/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVGOMG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> service </font><font style="vertical-align: inherit;">from Jake Archibald, you can choose different optimization methods with an instant view of the result.</font></font></font></i> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Some common rules for optimizing SVG (SVGO) </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minify SVG files and compress to gzip, because SVG is just text-based XML resources like CSS, HTML and JavaScript. </font><font style="vertical-align: inherit;">To improve performance, they should be minimized and compressed.</font></font></li><li>      SVG,   <code>&lt;rect&gt;</code> , <code>&lt;circle&gt;</code> , <code>&lt;ellipse&gt;</code> , <code>&lt;line&gt;</code>  <code>&lt;polygon&gt;</code> .              . </li><li>    ,   .      ,  .  <a href="http://jlwagner.net/talks/these-images/">simplify</a>  Illustrator        ,  . </li><li>  .   ,   . </li><li>   . </li><li>   Photoshop  Illustrator.       . </li><li>      ,     SVG. </li><li>     SVG,   - <a href="https://jakearchibald.github.io/svgomg/">SVGOMG</a>  <a href="https://github.com/svg/svgo">SVGO</a> .   Sketch,   <a href="https://www.sketchapp.com/extensions/plugins/svgo-compressor/"> Sketch  SVGO</a>     . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/d9f/f9c/4d9/d9ff9c4d9f37684e7997d4a4fc3fcfee.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVGO efficiency in high accuracy mode (‚àí29% of the original file size) and low accuracy (‚àí38%)</font></font></font></i> <br><br> <a href="https://github.com/svg/svgo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SVGO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is an SVG optimization tool for Node. </font><font style="vertical-align: inherit;">It reduces file size by lowering the precision of numbers in the definitions. </font><font style="vertical-align: inherit;">Each digit after a point is an extra byte, so a change in accuracy (number of digits) greatly influences the file size. </font><font style="vertical-align: inherit;">But be very careful, because the decrease in accuracy can visually affect the shape of the image. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/928/573/607/9285736076b2d09166f936d1595ffe81.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is important to note: although SVGO succeeded in the previous example without unduly simplifying the ways and forms, it often happens otherwise. </font><font style="vertical-align: inherit;">See how rocket flare distorts with decreasing accuracy</font></font></font></i> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SVGO from the command line: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVGO can be </font></font><a href="https://www.npmjs.com/package/svgo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set up as a CLI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if you prefer the command line: </font></font><br><br> <code>npm i -g svgo</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimizing the SVG file: </font></font><br><br> <code>svgo input.svg -o output.svg</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All possible parameters are supported, including the floating point precision setting: </font></font><br><br> <code>svgo input.svg --precision=1 -o output.svg</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See the </font></font><a href="https://github.com/svg/svgo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for a complete list of supported parameters.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Do not forget to squeeze SVG! </font></font></h4><br><img src="https://habrastorage.org/getpro/habr/post_images/ea1/243/9dc/ea12439dcd3c53d5e99931e019593306.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, do not forget to </font></font><a href="https://calendar.perfplanet.com/2014/tips-for-optimising-svg-delivery-for-the-web/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zip the SVG files</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or issue them using the Brotli protocol. </font><font style="vertical-align: inherit;">The text format will compress very well (~ 50% of the source code). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When Google released the new logo, we announced that its </font></font><a href="https://twitter.com/addyosmani/status/638753485555671040"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minimum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> version only takes 305 bytes. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/817/219/f48/817219f4818aab93aa611df402f5db60.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are </font></font><a href="https://www.clicktorelease.com/blog/svg-google-logo-in-305-bytes/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">many advanced tricks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to even more shrink the file (up to 146 bytes)!</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SVG sprites </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVG is </font></font><a href="https://css-tricks.com/icon-fonts-vs-svg/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">great</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for icons, offering visualization in the form of a sprite without the quirky workarounds required for fonts. It has better control of CSS styles than fonts (SVG stroke properties), better control of positioning (no need to bother with pseudo-elements and </font></font><code>display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), and SVG is much better </font></font><a href="http://www.sitepoint.com/tips-accessible-svg/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supported in browsers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tools like </font></font><a href="https://github.com/jkphl/svg-sprite"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">svg-sprite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://icomoon.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IcoMoon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> automate the integration of SVG into sprites that can be used in the </font></font><a href="https://css-tricks.com/css-sprites/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS Sprite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://css-tricks.com/svg-use-with-external-reference-take-2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Symbol Sprite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="http://simurai.com/blog/2012/04/02/svg-stacks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stacked Sprite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Worth learning </font></font><a href="https://una.im/svg-icons/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">practical tips</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from Una Kravets, how to use gulp-svg-sprite in your workflow. </font><font style="vertical-align: inherit;">Sarah Sudein in her blog describes the </font></font><a href="https://www.sarasoueidan.com/blog/icon-fonts-to-svg/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transition from icon fonts to SVG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Additional materials </font></font></h4><br> <a href="https://calendar.perfplanet.com/2014/tips-for-optimising-svg-delivery-for-the-web/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sarah Soayeidan‚Äôs SVG Issuing Optimization Tips</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font><font style="vertical-align: inherit;">Chris Koyer's </font></font><a href="https://abookapart.com/products/practical-svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúThe SVG Practice Book‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are excellent. </font><font style="vertical-align: inherit;">I found very helpful articles by Andreas Larsen on SVG optimization ( </font></font><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-1-67e8f2d4035"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-2-6711cc15df46"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">I can also recommend the article </font></font><a href="https://medium.com/sketch-app-sources/preparing-and-exporting-svg-icons-in-sketch-1a3d65b239bb"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúPreparing and exporting SVG icons to Sketch‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="26"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avoid pinching graphics with loss of quality. </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is always recommended to compress the image from source. Re-clamping is fraught with unpleasant consequences. Suppose you take a JPEG that is already compressed with a quality of 60. If you re-compress it with a loss, it will look worse. Each additional round of compression will lead to an additional loss of quality - information is removed, and artifacts accumulate. Even if you pinch with high quality settings. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To avoid this trap, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">immediately set the minimum acceptable quality</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and get the maximum savings from the outset. Then you will not re-compress, because any lossy file compression will look bad, although it will reduce the file size. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa9/6dc/866/fa96dc866135f21f0a9bfe022ab8211f.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example from </font></font><a href="https://www.youtube.com/watch%3Fv%3Dw7vXJbLhTyI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excellent video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="http://cloudinary.com/blog/why_jpeg_is_like_a_photocopier"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accompanying article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John Snayers shows the effect of clamping in different formats. Such a problem can be encountered if you save (already compressed) pictures from social networks and re-upload them (with repeated compression). The loss of quality is growing</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MozJPEG (perhaps by accident) is more resistant to such degradation due to trellis quantization. Instead of compressing all DCT values ‚Äã‚Äãas they are, it looks for close values ‚Äã‚Äãin the + 1 / -1 range to compress them into fewer bits. A lossy FLIF uses a hack similar to a lossy PNG, where before (re) compression the codec analyzes the data and decides what to throw away.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Source files store them in a lossless format, such as PNG or TIFF, to maintain maximum quality.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Then the assembly tools or compressors will prepare a compressed version that you will give to users with minimal loss in quality.</font></font><br><br><a name="27"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reduce unnecessary decoding and resizing costs </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We all gave users large images with too high resolution. You have to pay for it. Decoding and resizing - resource-intensive operations for the browser on a regular mobile phone. If you give large images, scaling them with CSS or width / height attributes, you will see how this affects performance. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/750/7de/e00/7507dee00658db123ac3a0519cbacd86.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the browser receives an image, it must decode it from the original source format (for example, JPEG) into a bitmap image in memory. Often the image requires resizing (for example, the width is set as a percentage). Decoding and resizing images - demanding operations that slow down rendering</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ideally, give the images that the browser displays without resizing. So give the minimum size pictures for the relevant screens and resolutions, using </font></font><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images"><code>srcset/sizes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- in the near future we will consider </font></font><code>srcset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skipping attributes </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">may also adversely affect performance. Without them, the browser assigns the smallest filler area to the image until it has received enough bytes to determine the correct size. At this point, the markup of the document must be updated using the resource-intensive operation reflow. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebb/33b/9ab/ebb33b9abfffafce7253dffa0c637175.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browsers need to take a few steps to draw a picture on the screen. Having received the image, it needs to be decoded and often resized. These events can be tracked on the </font></font><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/performance-reference"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timeline.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome DevTools</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Large images also take up memory: about 4 bytes per pixel after decoding. If you are not too careful, you can literally hang the browser; on low-end devices it‚Äôs not so difficult to bring the situation to a swap. So watch out for decode, resize, and memory consumption.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/97b/2cb/a04/97b2cba04d8de16112c91508bfe387f1.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Image decoding can be incredibly resource intensive on mobile phones in the middle and lower levels. In some cases, it is 5 or more times slower than on the desktop.</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When developing a new</font></font><a href="https://medium.com/%40paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mobile version,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Twitter greatly increased the speed of image decoding by setting the correct dimensions. For many images, the decoding time has decreased from ~ 400 ms to ~ 19 ms!</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/695/cfe/d7c/695cfed7c10f6fde08830c7783c874a5.jpg"><br> <i><font color="gray"> Timeline/Performance  Chrome DevTools      Twitter Lite    </font></i> <br><br><a name="28"></a><h2>   HiDPI   <code>srcset</code> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Users can access the site through various mobile and desktop devices with high-resolution screens. </font></font><a href="https://stackoverflow.com/a/21413366"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The device pixel ratio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (DPR) (also called ‚ÄúCSS pixel ratio‚Äù) determines how CSS should interpret the screen resolution. The DPR standard was created by phone manufacturers to increase the resolution and sharpness of mobile screens without reducing the elements. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For maximum quality, you should give the image with the most appropriate resolution. On devices with high-resolution screens, high-definition images (with DPR 2 √ó, 3 √ó) are given, and on standard screens - ordinary images, since pictures with DPR 2 √ó and 3 √ó are much heavier. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d00/ca2/7b1/d00ca27b1325ed096734db4e125cdf31.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Device pixel ratio: many sites track DPR of popular devices via </font></font><a href="https://material.io/devices/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">material.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><a href="https://mydevice.io/devices/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mydevice.io</font></font></a></font></i> <br><br> <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> srcset</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> allows the browser to select the optimal image for each device. </font><font style="vertical-align: inherit;">For example, take a 2 √ó picture for a mobile display with a DPR 2 √ó. </font><font style="vertical-align: inherit;">Browsers without support</font></font><code>srcset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can take the default</font></font><code>src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specified in the tag</font></font><code>&lt;img&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"paul-irish-320w.jpg, paul-irish-640w.jpg 2x, paul-irish-960w.jpg 3x"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"paul-irish-960w.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Paul Irish cameo"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDN for images like </font></font><a href="http://cloudinary.com/blog/how_to_automatically_adapt_website_images_to_retina_and_hidpi_devices"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudinary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://docs.imgix.com/apis/url/dpr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imgix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> support DPR for issuing images with optimal resolution from a single source.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Learn more about the pixel ratio of the device and responsive images in this </font></font><a href="https://www.udacity.com/course/responsive-images--ud882"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free Udacity course</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font><font style="vertical-align: inherit;">Web Fundamentals </font></font><a href="https://developers.google.com/web/fundamentals/design-and-ui/responsive/images"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image guide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I remind you that </font></font><a href="https://www.smashingmagazine.com/2016/01/leaner-responsive-images-client-hints/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Client Hints</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is also a suitable alternative to specifying all possible DPR and formats in responsive markup. </font><font style="vertical-align: inherit;">Instead, the relevant information is added to the HTTP request so that the web server chooses the most appropriate option for a particular screen.</font></font><br><br><a name="29"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Artistic transformation </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although choosing the right resolution is important, some sites still think about beauty. </font><font style="vertical-align: inherit;">If the user has a small screen, you can trim or zoom in - and display the object differently, making the best use of the available space. </font><font style="vertical-align: inherit;">Although the </font></font><a href="http://usecases.responsiveimages.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artistic transformation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (art direction) beyond the scope of this article, some services like </font></font><a href="http://cloudinary.com/blog/automatically_art_directed_responsive_images%2520"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudinary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> provide API-interfaces to automate such tasks. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/812/9d1/081/8129d10818e6ffb6cae71fca47a071fb.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eric Portis showed a great </font></font><a href="https://ericportis.com/etc/cloudinary/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> how to creatively use responsive images. </font><font style="vertical-align: inherit;">In this example, the characteristics of the main object in the illustration are modified to make the best use of the available space.</font></font></font></i> <br><br><a name="30"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Color management </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color can be viewed from at least three perspectives: biology, physics and printing. </font><font style="vertical-align: inherit;">In biology, color is a </font></font><a href="http://hubel.med.harvard.edu/book/ch8.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">phenomenon of perception</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Objects reflect light in various combinations of wavelengths. </font><font style="vertical-align: inherit;">Light receptors in the eyes translate these waves into a color sensation. </font><font style="vertical-align: inherit;">In physics, wave frequencies and energy (brightness) are important. </font><font style="vertical-align: inherit;">Printing is more about color gamut, colors and art models. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ideally, all the screens and web browsers in the world should display the same color exactly. </font><font style="vertical-align: inherit;">Unfortunately, this is not the case. </font><font style="vertical-align: inherit;">Color management allows you to reach a compromise in the display of colors with the help of color models, spaces and profiles.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Color models </font></font></h3><br> <a href="https://en.wikipedia.org/wiki/Gamma_correction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color models</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are a system for creating a full spectrum from a smaller set of primary colors. There are different types of color spaces with different parameters for managing colors. Some spaces have fewer control parameters than others - for example, for all shades of gray, only one brightness parameter between black and white is sufficient. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two common types of color models are additive and subtractive. Additive color models of the RGB type display the color with a glow, and subtractive CMYK types show the reflection (subtraction). </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/831/b9c/52c/831b9c52cc2059f46e5c63ba3c6d5624.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In RGB, red, green, and blue light are added in various combinations to produce a wide range of colors. CMYK (cyan, magenta, yellow and black) works with ink of different colors, taking away part of the white paper spectrum</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Article</font></font><a href="https://www.designersinsights.com/designer-resources/understanding-color-models/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúThe concept of color models and color systems‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> describes well other color models and modes, such as HSL, HSV and LAB.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Color spaces </font></font></h1><br> <a href="http://www.dpbestflow.org/color/color-space-and-color-profiles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color spaces</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are a specific range of colors that can be displayed for a given image. For example, in an image up to 16.7 million colors, and different color spaces allow you to narrow or expand this range. Some developers believe that color models and color spaces are one and the same. </font></font><br><br> <a href="https://en.wikipedia.org/wiki/SRGB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sRGB is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> developed based on RGB as a </font></font><a href="https://www.w3.org/Graphics/Color/sRGB.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for the Internet. This is a small color space, which is usually considered the lowest common denominator and the safest option for color management in browsers. Other color spaces (for example, </font></font><a href="https://en.wikipedia.org/wiki/Adobe_RGB_color_space"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adobe RGB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://en.wikipedia.org/wiki/ProPhoto_RGB_color_space"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProPhoto RGB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">used in Photoshop and Lightroom) contain more diverse colors, but since sRGB is common in browsers, games, and monitors, it is usually used. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6dd/0bf/4f0/6dd0bf4f0a627d651a95f94ba30a4d26.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gamma - color range visualization in color space</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Three color channels are used </font><i><font color="gray"><font style="vertical-align: inherit;">in the color spaces</font></font></i><font style="vertical-align: inherit;"> (red, green, and blue), each with 255 colors in 8-bit mode, which gives 16.7 million colors. 16-bit pictures can display trillions of colors. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/90d/d1b/a5590dd1bf6c059ec89e984d0108f878.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparing sRGB, Adobe RGB and ProPhoto RGB in a </font></font><a href="https://yardstick.pictures/tags/img%253Adci-p3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yardstick image</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . It is incredibly difficult to illustrate this concept if your screen shows only sRGB colors. When comparing a normal photo in sRGB and a wide range, everything will be the same, except for the most saturated "rich" colors.</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color spaces differ in their gamma (range of colors that they can reproduce with hues), spectrum and </font></font><a href="http://blog.johnnovak.net/2016/09/21/what-every-coder-should-know-about-gamma/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gamma curve</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . sRGB is about 20% smaller than Adobe RGB, ProPhoto RGB is </font></font><a href="http://www.petrvodnakphotography.com/Articles/ColorSpace.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">about 50% wider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> than Adobe RGB. The photos above are taken from the </font></font><a href="http://clippingpathzone.com/blog/essential-photoshop-color-settings-for-photographers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clipping Path</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <a href="http://www.astramael.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A wide gamut</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (wide-gamut) is a term meaning color spaces wider than sRGB. These types of displays are becoming more common. However, many digital displays are still simply not capable of displaying color profiles that are significantly better than sRGB. When saving for web in Photoshop, use the option to convert to sRGB, unless you are counting on displays with a wide color gamut.</font></font><br><br><blockquote> <b>:</b>        sRGB     .  ,           .        (, ProPhoto RGB),    sRGB     . </blockquote><br><h4>   ,       -? </h4><br>  Yes.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the image contains a very saturated / juicy / bright color - and you want to display it on compatible screens. </font><font style="vertical-align: inherit;">However, in real photos this rarely happens. </font><font style="vertical-align: inherit;">Often, you can easily tweak the settings so that the color looks bright, without going beyond the gamut of sRGB. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The reason is that human perception of color is not absolute. </font><font style="vertical-align: inherit;">Perception works in relation to the environment - and it is easy to deceive. </font><font style="vertical-align: inherit;">But if on the picture there is a trace of a fluorescent marker, then of course it is easier to show it in a wide range.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gamma Correction and Compression </font></font></h3><br> <a href="https://en.wikipedia.org/wiki/Gamma_correction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gamma correction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (or simply gamma) controls the overall brightness of the image. Changing the gamut can also change the ratio of red and green colors. Images without gamma correction often appear faded or dark. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In video and computer graphics, gamma is used for compression, similar to data compression. This allows you to compress useful brightness levels in fewer bits (8, not 12 or 16). The human perception of brightness is non-linearly proportional to the physical amount of light. Representing colors in their true physical form would be wasteful when coding for the human eye. Gamma compression (gamma compression) is used to encode brightness on a scale closer to human perception.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With gamma compression, the useful grayscale fits in with 8 bits of precision (0‚Äì255 in most RGB colors) because the luminance units are not linearly encoded. Imagine that you are in a dark room with one candle. Light the second - and notice a significant increase in brightness. Add a third candle and the room will become even brighter. Now imagine yourself in a room with a hundred candles. Light the 101st, 102nd candles - and you will not notice any changes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In both cases, the same amount of light was physically added. But since the eyes are less sensitive to bright light, gamma-compression ‚Äúcompresses‚Äù bright values, so in physical units less accuracy is encoded there, but the scale itself is adjusted for people ‚Äî and from a human point of view all values ‚Äã‚Äãare equally accurate.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gamma correction or compression is different here from the gamma curves in Photoshop, the correct gamma compression is not similar.</font></font></blockquote><br><h3>  Color profiles </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A color profile is information that describes the color space of a device. </font><font style="vertical-align: inherit;">It is used to convert between different color spaces. </font><font style="vertical-align: inherit;">The task of profiles - so that the images were as similar as possible on all types of screens and carriers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Images may have an embedded color profile according to the </font></font><a href="http://www.color.org/icc_specs2.xalter"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">International Color Consortium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ICC) </font><font style="vertical-align: inherit;">standard in </font><font style="vertical-align: inherit;">order to accurately determine colors. </font><font style="vertical-align: inherit;">Profiles are supported in various formats, including JPEG, PNG, SVG, and WebP, and most major browsers also support embedded ICC profiles. </font><font style="vertical-align: inherit;">If the picture opens in the program and the monitor profile is known, the colors are adjusted accordingly.</font></font><br><br><blockquote> <b>:</b>      sRGB,           .         .     . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The embedded color profiles also significantly increase the size of the images (sometimes by 100 KB or more), so be careful. </font><font style="vertical-align: inherit;">Tools like ImageOptim automatically remove all color profiles that they find. </font><font style="vertical-align: inherit;">If the ICC profile is deleted, the browser will start displaying the image in the color space of your monitor, which can lead to a change in saturation and contrast. </font><font style="vertical-align: inherit;">So it makes sense to look for a compromise for each specific case. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><a href="https://ninedegreesbelow.com/photography/articles.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nine Degrees Below</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website has </font><font style="vertical-align: inherit;">an excellent selection of resources for managing ICC color profiles if you need more information.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Color profiles and browsers </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In previous versions of Chrome, there was not much support for color management, but the situation was corrected in 2017 by implementing the </font></font><a href="https://groups.google.com/a/chromium.org/forum/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color Correct Rendering</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> feature </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If the display profile is different from sRGB (latest MacBook Pro), then it converts the colors from sRGB to a display profile. </font><font style="vertical-align: inherit;">This means that the colors will become more similar in different systems and browsers. </font><font style="vertical-align: inherit;">Safari, Edge and Firefox browsers also take into account ICC profiles, so images with different profiles are now displayed correctly, regardless of whether you have a wide color gamut or not.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: An</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> excellent guide to the various ways to use color on the web is </font><font style="vertical-align: inherit;">Sarah Drazner's </font></font><a href="https://css-tricks.com/nerds-guide-color-web/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúGuide to Color on the Internet‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br><a name="31"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sprites </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In </font></font><a href="https://developers.google.com/web/fundamentals/design-and-ui/responsive/images"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image sprites</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (or CSS-sprite) has a long history, they are supported by all browsers and have been a popular way to reduce the number of uploaded images by combining them into one larger image, which is cut into pieces. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc1/d7c/68f/dc1d7c68f3fdeef1c56234d17122d7bc.jpg"><br> <font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image sprites are still widely used on large production sites, including the Google homepage.</font></font></font> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> According to the HTTP / 1.x standard, some used sprites to reduce the number of HTTP requests. This had a number of advantages, but it required accuracy due to the problem of invalidating the cache ‚Äî changes to any small part of the sprite would invalidate the entire image in the cache. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now splitting into sprites is against </font><a href="http2/"><font style="vertical-align: inherit;">HTTP / 2</font></a><font style="vertical-align: inherit;"> recommendations </font></font><a href="http2/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Since it has become possible to send many requests in one connection, it is better </font></font><a href="http2/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to upload images individually</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Evaluate options for your situation.</font></font><br><br><a name="32"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lazy loading of non-critical images </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy (delayed) loading is a practice of increasing productivity, when loading images to the browser is delayed until the user actually needs it. </font><font style="vertical-align: inherit;">For example, images are loaded asynchronously when scrolling through a page. </font><font style="vertical-align: inherit;">This can save traffic in addition to compressing images. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d04/326/c74/d04326c7499058e1cff821d707cb53dd.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pictures on the screen are loaded immediately. </font><font style="vertical-align: inherit;">But the rest at this moment is not yet visible. </font><font style="vertical-align: inherit;">They should not be downloaded immediately, but later - this is a lazy download. </font><font style="vertical-align: inherit;">It occurs only if and when the user scrolls down the page. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy loading is not supported by the browsers themselves (although </font></font><a href="https://discourse.wicg.io/t/a-standard-way-to-lazy-load-images/1153/10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this has been discussed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the past </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">JavaScript is used instead.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Why is delayed loading useful? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> She has many advantages: </font></font><br><br><ul><li> <b> </b> .     .   ,       . </li><li> <b>  </b> .     ‚Äî   . </li><li> <b>  </b> .                . ,       ,       . </li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, as with other tools, great responsibility comes with great force. </font></font></b> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoid deferred loading of images in scope.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Use it for long lists (for example, products or custom avatars). Do not use it for the main picture on the page. Lazy loading in scope can slow down loading, both technically and for human perception. It kills preloading and progressive loading, and JavaScript generates extra work for the browser. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Be very careful with lazy loading images when scrolling.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you wait for the scrolling event directly, the user can see placeholders instead of pictures or get pictures before scrolling on them. </font><font style="vertical-align: inherit;">One of the recommendations is to start a lazy download of the following images immediately after the previous one is displayed on the screen, regardless of user interaction.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Who uses deferred loading? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy loading is applied by the majority of large sites with a large number of images. For example, </font></font><a href="https://medium.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://www.pinterest.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinterest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd8/c9d/134/fd8c9d134f3bf1b461cd66b8edddc29d.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example of a preview with a Gaussian blur of illustrations on the Medium.</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> On some sites (for example, Medium) a small blurry image (about 100 bytes) is displayed for preview, which, after delayed loading, turns into an illustration of normal quality. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jos√© M. Perez talked about how to implement the Medium effect using </font></font><a href="https://jmperezperez.com/medium-image-progressive-loading-placeholder/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS filters</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . He experimented with </font></font><a href="https://jmperezperez.com/webp-placeholder-images/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">different graphic formats</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Facebook also described its famous </font></font><a href="https://code.facebook.com/posts/991252547593574/the-technology-behind-preview-photos/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">approach</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with 200-byte placeholders for capital photos. If you use webpack, then</font></font><a href="https://lqip-loader.firebaseapp.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LQIP loader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will help automate some of these procedures. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To see a lazy download, just open your favorite catalog of high-quality photos, and then scroll down the page. Almost always you will see that the site loads only a few full-resolution images, and the rest is placeholders. As you scroll, the placeholders are replaced with full resolution images. This is a lazy download. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recently, a new technique of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vector</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , rather than raster, aggregates </font><font style="vertical-align: inherit;">has become popular </font><font style="vertical-align: inherit;">. She was offered by Tobias Baldauf in his </font></font><a href="https://github.com/technopagan/sqip"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tool </font><font style="vertical-align: inherit;">. There, the </font></font><a href="https://github.com/fogleman/primitive"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primitive</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utility </font><font style="vertical-align: inherit;">generates an SVG preview of several simple forms, approximate with the main features of the image. The SVG is then optimized using</font></font><a href="https://github.com/svg/svgo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SVGO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - and applies a Gaussian blur filter. </font><font style="vertical-align: inherit;">The result is a SVG placeholder that is only 800‚Äì1000 bytes in size, which looks sharp on any screens and gives a meaningful idea of ‚Äã‚Äãwhat is on the real picture. </font><font style="vertical-align: inherit;">Obviously, </font></font><a href="https://calendar.perfplanet.com/2017/progressive-image-loading-using-intersection-observer-and-sqip/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you can combine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lazy loading and previewing images in low quality.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to apply delayed loading? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For deferred loading there are a number of methods and plugins. </font><font style="vertical-align: inherit;">I recommend </font><font style="vertical-align: inherit;">Alexander Farkas </font></font><a href="https://github.com/aFarkas/lazysizes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lazysizes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> due to its decent performance, functionality, additional integration with the </font></font><a href="https://developers.google.com/web/updates/2016/04/intersectionobserver"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intersection Observer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and plugin support.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What can Lazysizes? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazysizes is a JavaScript library, it does not require any configuration. </font><font style="vertical-align: inherit;">Just download the minified js file and include it in the web page. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Below is a sample code from the README file: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add the 'lazyload' class to images / frames in combination with the data-src attribute and / or data-srcset. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Additionally, you can add the src attribute with a low-quality image:</font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- non-responsive: --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lazyload"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- responsive example with automatic sizes calculation: --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-sizes</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image2.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-srcset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image1.jpg 300w, image2.jpg 600w, image3.jpg 900w"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lazyload"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- iframe example --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">frameborder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lazyload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allowfullscreen</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//www.youtube.com/embed/ZfV-aYdU4uE"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the web version of this book, I linked Lazysizes with Cloudinary (although you can use any alternative). </font><font style="vertical-align: inherit;">This allows you to experiment freely and with minimal effort with various scales, quality, formats and regardless of whether you need a progressive download:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/f20/d09/377f20d09d2e11b1037a62777ad25e3e.jpg"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Features Lazysizes: </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Automatically detects changes in visibility of current and future elements of lazy loading. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Support for standard responsive images (picture and srcset) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Automatic sizing and aliases for media queries </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Works with hundreds of CSS image / frames, scripted pages and web applications. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extensibility: supports plugins </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Easy but mature decision </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SEO Improvement: Don't hide images / assets from crawlers </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Other ways of lazy loading </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazysizes is not the only option. </font><font style="vertical-align: inherit;">There are other libraries:</font></font><br><br><ul><li> <a href="http://ressio.github.io/lazy-load-xt/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy load xt</font></font></a> </li><li> <a href="https://github.com/dinbror/blazy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLazy.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (or [Be] Lazy)</font></font></li><li> <a href="http://luis-almeida.github.io/unveil/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unveil</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yall.js (Yet Another Lazy Loader)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is about 1 kilobyte in size and uses the Intersection Observer where possible.</font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What are the disadvantages of lazy loading? </font></font></h4><br><ul><li>    ,        JavaScript   ,    JavaScript.        &lt;noscript&gt;. </li><li>         .      (redraw),             .     ‚Äî Intersection Observer,     lazysizes. </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delayed loading is a common way to save traffic, reduce costs and improve user interaction. </font><font style="vertical-align: inherit;">Evaluate how useful it is in your case. </font><font style="vertical-align: inherit;">For more information, see the articles </font></font><a href="https://jmperezperez.com/lazy-loading-images/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Lazy loading images"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://jmperezperez.com/medium-image-progressive-loading-placeholder/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Implementing progressive loading in Medium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><a href="https://jmperezperez.com/medium-image-progressive-loading-placeholder/"><font style="vertical-align: inherit;">"</font></a></font><br><br><a name="33"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to avoid the trap display: none </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Older solutions for responsive images mistakenly processed image requests when setting the CSS property </font></font><code>display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This could lead to a significant increase in the number of requests, which is another reason why it is preferable to use &lt;picture&gt; and &lt;img srcset&gt;. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have you ever written a media query that, under certain conditions, hides a picture in </font></font><code>display:none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> @</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">media</span></span></span><span class="css"> (max-width: </span><span class="hljs-number"><span class="css"><span class="hljs-number">640px</span></span></span><span class="css">) { </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">img</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">: none; } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or hide images with a class </font></font><code>display:none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.hidden</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">: none; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äúimg-hidden.jpg</span></span></span><span class="hljs-tag">" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A quick check in the Chrome DevTools network panel shows that such ‚Äúhidden‚Äù images are still loaded. </font><font style="vertical-align: inherit;">In fact, this is the correct behavior of the browser according to the specification of embedded resources.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a67/471/222/a67471222582a069b511993bab0c0b51.jpg"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Does display: none help avoid src request? </font></font></h4><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display:none"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Not.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The specified image will still be requested. </font><font style="vertical-align: inherit;">Here, the library cannot rely on display: none, because the request is sent before JavaScript changes src.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Does display: none help avoid the request background: url ()? </font></font></h4><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display:none"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"background: url(img.jpg)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affirmative answer. </font><font style="vertical-align: inherit;">The CSS background is not extracted when parsing an element. </font><font style="vertical-align: inherit;">The calculation of CSS styles for children with </font></font><code>display:none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">less useful, since they do not affect the rendering of the document. </font><font style="vertical-align: inherit;">Background images of child elements are not calculated and loaded. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jake Archibald has a great </font></font><a href="https://jakearchibald.github.io/request-quest/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quest quiz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on traps </font></font><code>display:none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If in doubt, how a particular browser handles image requests, open DevTools and check for yourself. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Again, where possible, use &lt;picture&gt; and &lt;img srcset&gt; instead of relying on &lt;display: none&gt;.</font></font><br><br><a name="34"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Does it make sense to use CDN for image processing? </font></font></h1><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The time spent reading articles to set up your image processing pipeline and its subsequent refinement is often much more expensive than the fee for this service. </font></font><a href="http://cloudinary.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudinary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> offers a free service, </font></font><a href="https://www.imgix.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imgix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gives a free trial, there is a free alternative to </font></font><a href="https://github.com/thumbor/thumbor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thumbor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , so there are a lot of options. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the fastest page load, you need to optimize image loading, including providing responsive images with compression on the server side, automatic selection of the optimal format and resizing. </font><font style="vertical-align: inherit;">It is important to give the image the correct size to the correct device in the correct resolution - and as soon as possible. </font><font style="vertical-align: inherit;">This is not as easy as it seems.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Your server or CDN? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image manipulation is a specific topic. </font><font style="vertical-align: inherit;">Here everything is constantly changing, so let's start with a quote from an experienced specialist, and then continue. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúIf your product itself is not related to image processing, then do not do it yourself. </font><font style="vertical-align: inherit;">Services like Cloudinary [or Imgix, approx. </font><font style="vertical-align: inherit;">auth.] cope much better and more efficiently. </font><font style="vertical-align: inherit;">And if you're worried about the price, think about the cost of development and maintenance, as well as hosting, storage and delivery. ‚Äù- </font></font><a href="https://medium.com/%40cmgmyr/moving-from-self-hosted-image-service-to-cloudinary-bd7370317a0d"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chris Hmyr</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> At the moment, we tend to agree that it is better to use CDN for image processing. </font><font style="vertical-align: inherit;">Consider two such services - as they correspond to the list of mentioned tasks.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cloudinary and Imgix </font></font></h4><br> <a href="http://cloudinary.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudinary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://www.imgix.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imgix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are well-known image processing CDNs. They are used by hundreds of thousands of developers and companies around the world, including Netflix and Red Bull.</font></font><br><br><h4>  Main </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first huge advantage CDN has over its own solution is that they use a distributed global network system to keep your images closer to your users. And with CDN, it is much easier for you to guarantee the relevance of the service with future changes in technology, because not everyone can independently monitor trends, make changes - this requires maintenance, tracking by browser support for new formats and immersion into the life of the image compression community. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Second: each service has a multi-level tariff plan: Cloudinary has a </font></font><a href="http://cloudinary.com/pricing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free tariff</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Imgix has an inexpensive starting plan. Imgix offers a free </font></font><a href="https://www.imgix.com/pricing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is almost the same as the free fare.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Third: both services have an API. </font><font style="vertical-align: inherit;">Developers can programmatically connect to a CDN and automate the process. </font><font style="vertical-align: inherit;">Client libraries, framework plug-ins and API documentation are available, although some options are only available at expensive rates.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Let's move on to image processing. </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We restrict discussion to static images. </font><font style="vertical-align: inherit;">Cloudinary and Imgix offer a wide range of image processing methods. </font><font style="vertical-align: inherit;">In standard and free tariffs, both support basic functions: compression, resizing, cropping, and generation of reduced copies. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e27/b9f/e79/e27b9fe792a444abd15ed71fa10387ae.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudinary Media Library: By default, Cloudinary produces </font></font><a href="http://cloudinary.com/blog/progressive_jpegs_and_green_martians"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regular, not progressive JPEGs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">To activate this option, put the corresponding icon in the ‚ÄúAdvanced Settings‚Äù or use the fl_progressive flag</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cloudinary names </font></font><a href="http://cloudinary.com/documentation/image_transformations"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seven broad conversion categories</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a total of 48 subcategories. </font><font style="vertical-align: inherit;">Imgix has over </font></font><a href="https://docs.imgix.com/apis/url%3F_ga%3D2.52377449.1538976134.1501179780-2118608066.1501179780"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 image processing operations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What happens by default? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cloudinary by default performs the following optimizations: </font></font><br><br><ul><li> <a href="https://twitter.com/etportis/status/891529495336722432"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPEG encoding using MozJPEG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (chosen instead of Guetzli by default).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clearing metadata (original image remains intact). </font><font style="vertical-align: inherit;">To change this behavior and give pictures with metadata, add a flag keep_iptc.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ability to generate WebP, GIF, JPEG and JPEG-XR with automatic quality. </font><font style="vertical-align: inherit;">To change the default settings, set the quality parameter manually.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Optimize file size with minimal impact on quality when generating PNG, JPEG or GIF. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imgix by default does not launch optimizations such as Cloudinary, but allows you to set the default quality. </font><font style="vertical-align: inherit;">In Imgix, automatic parameters help automate the basic level of optimization in the image catalog. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Currently </font></font><a href="https://docs.imgix.com/apis/url/auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">four methods are used</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compression </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Visual improvement </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> File Format Conversion </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remove red eye </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imgix supports the following image formats: JPEG, JPEG2000, PNG, GIF, animated GIF, TIFF, BMP, ICNS, ICO, PDF, PCT, PSD, AI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudinary supports the following formats: JPEG, JPEG 2000, JPEG XR, PNG, GIF, animated GIF, WebP, animated WebP, BMP, TIFF, ICO, PDF, EPS, PSD, SVG, AI, DjVu, FLIF, TARGA.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What about performance? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDN performance mainly depends on </font></font><a href="https://docs.google.com/a/chromium.org/viewer%3Fa%3Dv%26pid%3Dsites%26srcid%3DY2hyb21pdW0ub3JnfGRldnxneDoxMzcyOWI1N2I4YzI3NzE2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">latency</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and speed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The delay is always a bit longer for fully uncached images. </font><font style="vertical-align: inherit;">But as soon as the picture gets into the cache and diverges across the servers on the network, the global CDN finds the closest route to the user. </font><font style="vertical-align: inherit;">Together with the savings in file size, this almost always eliminates latency problems compared to non-optimized images or single servers that try to serve the entire planet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Both CDNs have wide coverage and fast servers, which reduces latency and increases download speed. </font><font style="vertical-align: inherit;">Speed ‚Äã‚Äãaffects page load time, and this is one of the most important user and conversion metrics.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is better? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudinary has about </font></font><a href="http://cloudinary.com/customers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">160,000 customers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , including Netflix, eBay and Dropbox. Imgix does not report the number of users, but it is less than that of Cloudinary. However, Imgix includes heavyweights like Kickstarter, Exposure, unsplash, and Eventbrite. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In image processing, so many parameters cannot be objectively assessed, which makes it difficult to compare the performance of the two services. Much depends on how you want to process the image (it will take different time), what size and resolution is needed in the end. In the end, the most important factor for you may be the cost.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDN cost money. </font><font style="vertical-align: inherit;">A heavy site with a lot of traffic can pay hundreds of dollars per month on CDN. </font><font style="vertical-align: inherit;">A certain level of knowledge and programming skills is needed to get the most out of these services. </font><font style="vertical-align: inherit;">But if you do not do anything unusual, then there will be no particular problems.</font></font><br><br><h4>  Conclusion </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you are now giving away images from your own server or planning to do so, you may need to think about a CDN. </font></font><br><br><a name="35"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Image caching </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resources can set caching rules via </font></font><a href="http-caching"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP cache headers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In particular, it </font></font><code>Cache-Control</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">determines who should cache responses for how long. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most of the images are static resources that will </font></font><a href="http://kean.github.io/post/image-caching"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not change</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the future. The best strategy for them is aggressive caching. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When configuring HTTP caching headers, set Cache-Control with a </font></font><code>max-age</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one-year </font><font style="vertical-align: inherit;">term </font><font style="vertical-align: inherit;">(for example, </font></font><code>Cache-Control:public; max-age=31536000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Such aggressive caching works well for most images, especially for long-lived ones, such as avatars and images in page headers.</font></font><br><br><blockquote> <b>:</b>       PHP,    -   <a href="http://php.net/manual/en/function.session-cache-limiter.php">session_cache_limiter</a> .   <a href="https://stackoverflow.com/a/3905468"></a>   <code>session_cache_limiter('public')</code> ,  <code>public</code>  <code>max-age=</code> .  ,        . </blockquote><br><a name="36"></a><h1>     </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Critical resources can be preloaded with </font></font><a href="https://www.w3.org/TR/preload/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;link rel = preload&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <code>&lt;link rel=preload&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- this is a declarative download that forces the browser to send a request for a resource without blocking the event </font></font><code>onload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the document. </font><font style="vertical-align: inherit;">This raises the priority of requests for resources that would otherwise only be found later during the parsing. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For preloading images, the value is </font></font><code>as</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicated as </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="hljs swift">&lt;link rel=<span class="hljs-string"><span class="hljs-string">"preload"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>=<span class="hljs-string"><span class="hljs-string">"image"</span></span> href=<span class="hljs-string"><span class="hljs-string">"logo.jpg"</span></span>/&gt;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this way, optimized resource utilization for </font></font><code>&lt;img&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>&lt;picture&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>srcset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and SVG.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: </font></font></b> <code>&lt;link rel=preload&gt;</code> <a href="http://caniuse.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supported</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Chrome and browsers on the Blink engine, such as Opera and </font></font><a href="https://developer.apple.com/safari/technology-preview/release-notes/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari Tech Preview</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and also </font></font><a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D1222633"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implemented</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Firefox.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sites such as </font></font><a href="https://www.usa.philips.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Philips</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://www.flipkart.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flipkart</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://www.xerox.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xerox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are used </font></font><code>&lt;link rel=preload&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to preload their logos (often used at the beginning of the document). </font></font><a href="https://kayak.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kayak</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> also applies a preload to the main image in the title loaded as quickly as possible.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/492/932/3d3/4929323d36c4089f7c5ab7d94ced76c0.jpg"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is the Link preload header? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link preloading is specified by an HTML tag or in an </font></font><a href="https://www.w3.org/wiki/LinkHeader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP Link Header</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In any case, the link tells the browser to start loading the resource into the cache memory, because the page is highly likely to expect this resource and you cannot wait until the preload scanner or the parser detects it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The caption for images will look like this:</font></font><br><br><pre> <code class="hljs objectivec">Link: &lt;https:<span class="hljs-comment"><span class="hljs-comment">//example.com/logo-hires.jpg&gt;; rel=preload; as=image</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the Financial Times introduced such a title on its website, users began to open content </font></font><a href="https://twitter.com/wheresrhys/status/843252599902167040"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 second faster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e6/1f8/9ad/5e61f89ad2148c7ed6ab04d1a226c986.jpg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the bottom: with &lt;link rel = preload&gt;, above: without. </font><font style="vertical-align: inherit;">Comparison for Moto G4 on the 3G channel under the WebPageTest test </font></font><a href="https://www.webpagetest.org/result/170319_Z2_GFR/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">before</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://www.webpagetest.org/result/170319_R8_G4Q/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> optimization</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Similarly, Wikipedia accelerated the download of ‚Äúbefore the logo‚Äù, as described in their </font></font><a href="https://phabricator.wikimedia.org/phame/post/view/19/improving_time-to-logo_performance_with_preload_links/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">study</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What are the pitfalls in this optimization? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You need to be sure that the preloading of this particular resource is absolutely necessary, because it shifts the rest of the content to the end of the queue. </font><font style="vertical-align: inherit;">Maybe you should focus on other content? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is important to avoid </font></font><code>rel=preload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preloading images without wide support in browsers (eg WebP) and avoid using responsive images defined in srcset, where the source of the image depends on the type of device. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For more information, read the articles </font></font><a href="https://medium.com/reloading/preload-prefetch-and-priorities-in-chrome-776165961bbf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Preloading and Priorities in Chrome"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://www.smashingmagazine.com/2016/02/preload-what-is-it-good-for/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Preloading: what is it good for?"</font></font></a> <br><br><a name="37"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Web performance budgets for images </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance budget is the maximum limit that developers try not to exceed. For example, "no more than 200 KB of pictures on one page" or "the user interface should load in less than 3 seconds." When the budget is not executed - learn why this is happening and how to remedy the situation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Budgets help discuss performance. When a design or business decision affects performance, check with the budget. If the change does not fit into the budget, this is the reason to postpone or revise it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I found that the performance budget is best performed if monitoring is automated. Instead of exploring networks, a service is started manually, which automatically signals a budget overrun. Two such useful services -</font></font><a href="https://calibreapp.com/docs/metrics/budgets"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caliber</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://speedcurve.com/blog/tag/performance-budgets/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpeedCurve</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As soon as a budget is determined by the size of the images, SpeedCurve starts monitoring and warns you of excess: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7b7/ecb/206/7b7ecb2062b83d9a3af42d0c8f1a2b4d.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caliber suggests setting a budget for each class of device. </font><font style="vertical-align: inherit;">This is useful because the budget for the size of pictures for a desktop PC via WiFi may be very different from the budget for mobile phones.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac9/a20/dfd/ac9a20dfdeb3a76f937b298c83994feb.jpg"><br><br><a name="38"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Final Recommendations </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ultimately, the choice of image optimization strategy comes down to the types of images that you give to users, and a reasonable set of evaluation criteria to choose from. </font><font style="vertical-align: inherit;">It can be SSIM or Butteraugli, and on a small set of illustrations you can trust your own eye: what looks better and what looks worse.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here are my final recommendations: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can not</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> give images in different formats, depending on the support in the browser:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Guetzli + jpegtran from MozJPEG is well optimized with a JPEG quality of more than 90. </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the web, quality is </font></font><code>q=90</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">too wasteful. </font><font style="vertical-align: inherit;">For ordinary pictures it is enough </font></font><code>q=80</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and for DPR 2 √ó even </font></font><code>q=50</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Since Guetzli does not go to such a low level, you can use MozJPEG for the web.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Corneille Lesinski recently improved the cjpeg team at mozjpeg by adding a tiny sRGB profile to help Chrome display natural color on wide color gamut displays. </font></font></li></ul></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PNG pngquant + advpng provides a pretty good speed / compression ratio. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> render images in different formats, depending on browser support, using &lt;picture&gt;, </font></font><a href="https://www.igvita.com/2013/05/01/deploying-webp-via-accept-content-negotiation/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://scottjehl.github.io/picturefill/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Picturefill header</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Give away WebP for browsers that support it. </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create WebP from original images of 100% quality. </font><font style="vertical-align: inherit;">Otherwise, you will be sending to the browsers images of lower quality and larger volume with JPEG </font><font style="vertical-align: inherit;">distortions </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WebP distortions! </font><font style="vertical-align: inherit;">If you compress the original images with the WebP codec, the distortions will be less noticeable, and the compression level will be higher.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP default settings </font></font><code>-m 4 -q 75</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are good for most cases, as the optimal ratio of speed and compression ratio.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebP has a special lossless compression mode ( </font></font><code>-m 6 -q 100</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), which reduces files by examining all combinations of parameters. </font><font style="vertical-align: inherit;">This is an order of magnitude slower, but worth it for static resources.</font></font></li></ul></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The backup option is Guetzli / MozJPEG for browsers that do not support WebP. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Successful compression! </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for more practical image optimization tips, I highly recommend the book </font></font><i><a href="https://www.manning.com/books/web-performance-in-action"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Performance in Action by</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jeremy Wagner. </font><font style="vertical-align: inherit;">The book </font></font><i><a href="http://shop.oreilly.com/product/0636920039730.do"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">High Performance Images is</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> also a lot of great tips and nuances.</font></font></blockquote><br><a name="39"></a><h1>  Little things </h1><br><ul><li> <a href="https://jpeg.org/jpegxt/">JPEG XT</a>    JPEG 1992 .           1992 ,   <a href="https://libjpeg-turbo.org/">libjpeg-turbo</a>      (  ). </li><li> <a href="https://github.com/google/pik">PIK</a> ‚Äî    ,    .    JPEG,         Guetzli.    33%  JPEG,      54%   ,  libjpeg.    Guetzli  . <a href="https://encode.ru/threads/2814-Psychovisual-analysis-on-modern-lossy-image-codecs"></a>     ,  PIK   .  ,      ,      (    2017 ). </li><li>      <a href="https://www.imagemagick.org/script/index.php">ImageMagick</a> .   ,         ,     .   <a href="https://github.com/jcupitt/libvips">libvips</a> ,            .  ImageMagick   <a href="https://imagetragick.com/"></a>   ,    . </li><li> Blink (   Chrome)     .             .     .               ,          . <a href="https://html.spec.whatwg.org/multipage/embedded-content.html">img.decode()</a> API    . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/422531/">https://habr.com/ru/post/422531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422519/index.html">Distributing freebies: non-braking threads in Java. Project loom</a></li>
<li><a href="../422521/index.html">Premonition of the inevitable</a></li>
<li><a href="../422525/index.html">"The matrix of friendship." The oldest social graph for the smallest</a></li>
<li><a href="../422527/index.html">Digest news from the world of PostgreSQL. Issue number 10</a></li>
<li><a href="../422529/index.html">Special Course Group-IB: ‚ÄúMobile Application Security‚Äù</a></li>
<li><a href="../422533/index.html">Yandex Received New Claims from Gazprom-Media TV Channels</a></li>
<li><a href="../422535/index.html">See invisible. Polarization in the far infrared (8-12mkm)</a></li>
<li><a href="../422537/index.html">BEM'a should not exist</a></li>
<li><a href="../422539/index.html">About the digital economy, fires and the Internet</a></li>
<li><a href="../422541/index.html">The drama of the holes in the "Union" turned into a phantasmagoria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>