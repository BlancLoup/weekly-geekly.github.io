<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WhoIsMafia is a new kind of online entertainment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surely some of you remember my post two weeks ago, in which I showed how you can organize a multiplayer video conference using peer-to-peer Flash plat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WhoIsMafia is a new kind of online entertainment</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.whoismafia.com/"><img src="https://habrastorage.org/storage/habraeffect/44/3e/443e1396d8b7111aa14bfa0c768af30d.jpg" alt="WhoIsMafia - webcam-game"></a> <br><br>  Surely some of you remember my <a href="http://habrahabr.ru/blogs/flex/103427/">post</a> two weeks ago, in which I showed how you can organize a multiplayer video conference using peer-to-peer Flash platform technology.  Today I represent to the public not just the end - now a startup.  Get acquainted. <br><br>  <a href="http://www.whoismafia.com/">WhoIsMafia.com</a> is a service that allows you to play the most popular salon game Mafia without leaving your home.  Not only that - without leaving the browser.  To do this, it is enough to have Flash Player 10.1+, a webcam and at least a two megabit unlimited channel.  What is the service, technical details and game details can be read under the cut. <br><a name="habracut"></a><br><h4>  Idea of ‚Äã‚Äãthe game </h4><br>  The idea of ‚Äã‚Äãthe game was born the next day after feeling with real-time handles of flash technology.  The idea was so clear and understandable that the very next day I started this crazy two-week marathon without sleep and fresh air.  Judge for yourself: <br><ol><li>  Mafia is a very simple, clear and damn popular game. </li><li>  So far, in-net multi-user videoconferencing is an absolute innovation. </li><li>  Browser games based on real face-to-face communication of a large number of people, even the Americans do not yet have </li><li>  For a normal game, according to preliminary calculations, you need a more or less sane computer, webcam and mediocre Internet (at least by the standards of Default City) </li><li>  Research of the newest technologies is exactly what any adequate IT specialist wants in my opinion.  This is something that does not allow our brains to dry out and makes them smile from ear to ear. </li><li>  The president said - you need to make toys.  No sooner said than done :) </li></ol><br><h4>  Game process </h4><br>  It looks like a room filled with people.  Some are alive, some are in prison, some are dead.  The link is a big picture. <br> <a href=""><img src="https://habrastorage.org/storage/habraeffect/74/b0/74b050842457d6e9ed1fdea9a6f4b6fe.jpg" alt="Screenshot WhoIsMafia.com"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Start </h5><br>  After the application loads (about 800Kb), the Flash player connects to the Adobe Stratus - RTMFP platform, which helps to organize p2p connections between players.  <b>You need to allow the player to use p2p and webcam</b> .  Otherwise, nothing will work.  The presence of a camera (must have) is checked, the user enters his name and enters the lobby (common room), where you can create or select a suitable room for the game.  Please note, users are anonymous here, no registration is required, because  people are so reluctant to show their faces on the Internet.  While the Internet public is not ready for total de-anonymization.  I think a couple of years, and people will not be afraid of this :) <br><br><h5>  Room selection </h5><br>  Each room has a description, a language of communication (I hope to infect the whole world with Mafia), the preferred age of the players and the minimum number of players.  If the number of players turns out to be more than expected when creating the room, you can either kick some or play in such a composition. <br><br>  As you know, in every anonymous video chat there is a jerk off.  I don‚Äôt understand at all why it is impossible to make a dick on the Internet, but I cannot protect the game from such gentlemen.  The only reasonable thing that came to mind is Ban.  So far, this is just a restriction on the entrance to this particular room, but in the future it will be possible to think out and implement something more cruel. <br><br><h5>  Chat </h5><br>  In the lobby, as in every room, it is possible to correspond.  Only in the lobby, the user name and message are displayed, and in the room - a message and a photo at the time of writing the message.  This is done in order to protect the lobby from jerking.  In the room during the game are unlikely to swing pisyuny.  In addition, all official information is displayed in the chat. <br><br><h5>  A game </h5><br>  After enough players are typed, the creator of the room (admin) starts the game.  Users receive a card.  While the game has 4 types of cards: <br><br><h6>  1. Civilians (green card) </h6><br>  During the day, civilians are trying to figure out who the Maf is, and put him by jail vote.  At night, they sleep without doing anything.  This unorganized majority. <br><br><h6>  2. Mafia (red card) </h6><br>  They are an organized minority in the game.  Mafa see each other and know who is who.  In the daytime, with all my might, they are trying to lead the civilians astray and force them to plant each other, or even better, to put a police officer or a doctor.  At night, the mafas vote for the victim.  At this night, civilians do not see the video of the mafas, and the mafas can communicate with each other.  Mafes must come to a common opinion, so they can change their voice if the situation demands it. <br><br><h6>  3. Commissioner (dark blue card) </h6><br>  This civilian has a special opportunity - at night he can find out the status of any player.  The only thing - he must do it before the mafia will kill someone.  This innovation is exactly my implementation of the game, which gives it a special drive :) <br><br><h6>  4. Doctor (turquoise card) </h6><br>  It is also peaceful, but at night it can protect any player.  He also has to do this until the mafas have agreed on the sacrifice. <br><br><h5>  Voting </h5><br>  If as a result of day or night voting an equal number of votes is obtained, the result chooses a Holy Rend (excuse me, but this is IMHO the most appropriate decision in the intern).  In the future, you can do something more classic. <br><br><h5>  Victory </h5><br>  The team that completely destroyed the other, either the mafas or the inhabitants, won.  In the future, you can enter a lot of additional statuses, the fantasy of Mafia players is limitless :) <br><br>  After the end of the game all the cards become visible, the players have the opportunity to discuss the game.  Also, the game becomes available in the general list and everyone can join it. <br><br><h5>  Communication </h5><br>  In addition to video, customers also transmit audio content to each other.  So if you want a full-fledged game - stock up on microphones.  In order to avoid a wild echo (after all, 6+ players, each with their own bandwidth, their own lags), the sound is transmitted only if the user has pressed the ‚ÄúON AIR‚Äù button.  If two users speak at the same time, both will be heard.  But it's like interrupting each other in life - indecent.  If someone is completely crazy, you can turn off the sound on the receiving side.  The blessing is always visible who exactly says. <br><br><h5>  Tongue </h5><br>  The whole interface is clumsy in English.  This was not done by chance.  First, the entire Internet speaks English.  Secondly, localization is not very difficult to do later.  And thirdly, the word VOTE is translated into Russian. VOTE, but I wanted the buttons to be neat.  If you find errors - write, correct. <br><br><h4>  Technology </h4><br><h5>  AppEngine </h5><br>  The server part is made on GAE.  Although GAE is needed in general for very large loads, here it is used only at the initial stage - to acquaint clients with each other.  Further, all game operations occur within network groups (NetGroup).  The server does not take any part in them - on the video broadcast, or in the transmission of game messages. <br><br><h5>  Multicasting </h5><br>  The service is built on the Peer-to-Peer technology, or rather Multicasting, which appeared in Flash Player in version 10.1.  In the last post for the organization of broadcasts, I used a direct connection between clients.  As a result, if there were 8 people in the room, then each client had 14 flows open - 7 in one direction 7 in another.  Multicasting allows clients to optimize the network load by transferring received streams further to each other within a group. <br><br><h5>  Posting </h5><br>  All game logic is implemented on the client side, while all instances are both servers and clients at the same time.  The so-called self-organizing groups.  Clients in the same group communicate over an internal protocol, sending messages to each other with control commands.  As in the case of multicasting, posts are also transmitted not from one client to all at once, but by a chain. <br><br><h5>  Graphics / Code </h5><br>  Graphics are made in Adobe Illustrator (yes, I know, rustic), then transferred to Adobe Flash Catalyst.  There, it was turned into components (buttons, lists, custom components), animation was added to them when moving from one state to another, and then all this stuff was transferred to Flash Builder, where the functionality was added <br><br><h4>  Perspectives </h4><br>  I'm an optimist.  I see gigantic prospects for p2p technology in general, and for Flash-p2p in general, and for my game in particular.  After some time, I will definitely write off how much money the hosting cost me and how many people played games.  In the meantime, I will enjoy life and wait for lucrative offers :) <br><br><h4>  Summary </h4><br>  I just collected the game today, nobody has ever tested it, so there are a lot of bugs there.  Especially for this game there is an opportunity to leave feedback, please use it, I will be very grateful to you.  If you like the game - here is a <a href="http://www.facebook.com/">group on Facebook</a> , but on <a href="http://twitter.com/WhoIsMafia">Twitter</a> .  Join us, I will be glad to see everyone. <br><br>  <b>UPD 19:30</b> Updated both the server and the client - some of the bugs kicked out, took into account some wishes.  <b>Update client CTRL + F5</b> , if you have played before. <br><br>  Continued: <a href="http://habrahabr.ru/blogs/startup/104871/">Online video mafia</a> </div><p>Source: <a href="https://habr.com/ru/post/104498/">https://habr.com/ru/post/104498/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../104489/index.html">IE9 - Killer Feature # 1</a></li>
<li><a href="../104492/index.html">PopCornUA - Android app for movie theaters of Ukraine</a></li>
<li><a href="../104493/index.html">The logic of breaking the reference to three parts (with a combination of LTR and RTL)</a></li>
<li><a href="../104495/index.html">The Japanese have improved the exoskeleton HAL</a></li>
<li><a href="../104496/index.html">Fraudsters have learned to cheat CashCode bill acceptors?</a></li>
<li><a href="../104501/index.html">SIW-V - to visit or not? KINETICA shares thoughts</a></li>
<li><a href="../104502/index.html">HTML5 for web designers. Part 4: Forms 2.0</a></li>
<li><a href="../104503/index.html">All for $ 100. Who will be the first buyer?</a></li>
<li><a href="../104504/index.html">Some funny "404" pages by the version of Spiegel magazine</a></li>
<li><a href="../104505/index.html">Canon Mark I calculator overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>