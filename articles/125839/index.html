<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Through what hole hacked the site?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If the site is hacked, it is not enough to remove the virus and downloaded PHP Shell from it. We still need to find the reason for the hacking, otherw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Through what hole hacked the site?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/df7/c0b/d62/df7c0bd62037fd8fecdad3ee7ea09aaf.jpg" alt="image" align="left">  If the site is hacked, it is not enough to remove the virus and downloaded PHP Shell from it.  We still need to find the reason for the hacking, otherwise in a day or two the beautiful <s>Turkish</s> foreign flag will flutter on the site again with vigorous music.  The most common cause is a stolen FTP password, an outdated version of the CMS or a plugin for it, but how to find out what exactly was used for penetration? <br><br>  Having some experience in this area (on average, our technical support is looking for the reason for hacking the site once a week), we systematized the accumulated information. <br><br>  So why bother hacking sites at all?  And what if the site is hacked, how to find the cause and protect against subsequent attacks? <br><a name="habracut"></a><br><h4>  Why hack sites </h4><br>  The process of hacking sites is now on stream.  Botnets use known exploits to popular CMS, hack sites, install their scripts on them and can use the hacked site for any purpose.  Viruses steal FTP passwords, connect to sites and infect them with viruses, which in turn infect site visitors, after which the circle repeats.  Most often after hacking the site the following occurs: <br><ol><li>  Site deface.  This can be called, rather, mischief, things often do not go beyond deface. </li><li>  Infection of the site pages with a virus.  Viruses can be as simple as being added to the end of each page of the site, and to be quite sophisticated.  For example, we encountered a virus that infected a specific Joomla class that is responsible for displaying data in the browser. </li><li>  Search for other sites in neighboring folders and their infection. </li><li>  Spamming. </li><li>  Download PHP Shell and perform arbitrary actions - for example, an attempt to hack a server using existing exploits to operating systems. </li><li>  Installing bots that connect to the IRC server and can execute arbitrary host commands ‚Äî for example, produce DDoS from other sites. </li></ol>  That is, the actions of hackers are aimed at the further distribution of bots, the creation of a network (botnet) and its further use for their own purposes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Algorithm for finding the cause of hacking </h4><br>  The algorithm itself is very simple: <br><ol><li>  Find traces of hacking. </li><li>  Determine the exact time of hacking. </li><li>  According to the logs to find how exactly broke the site. </li></ol>  The complexity of the implementation of paragraphs 1 and 3. We will focus on them in more detail. <br><br><h4>  How to look for traces of hacking </h4><br>  Tracking almost always leaves traces: files that the attacker used to work, for example, PHP Shell.  The classic way of hacking CMS: <br><ol><li>  Download PHP Shell through any vulnerability (or get CMS administrator access via the vulnerability and download PHP Shell through the file manager). </li><li>  Through PHP Shell do the rest. </li></ol>  Therefore, the first step is to look for such files - files that obviously do not belong to the site.  As a rule, downloaded scripts are called rather unusual and stand out among their own CMS scripts: <br><ul><li>  wzxp.php </li><li>  gwd.php </li><li>  a10881d.php.2046 </li></ul>  The result of an exploit running to hack a server might look like this: <br><ul><li>  ./w.sh </li><li>  ./env </li><li>  ./env.c </li><li>  ./program.c </li><li>  ./program.o </li><li>  ./w00t.so.1.0 </li><li>  / tmp / sh </li><li>  / tmp / sh2 </li></ul> These files can be located either in the root of the site or in the tmp / or cache / folder.  You should also search for them in folders like images /, upload /, user_files /, etc. - often through vulnerabilities in editors or photo libraries, scripts are loaded into the place where photos are usually loaded or temporary files are stored. <br><br>  In addition to the site files, you should also check the common / tmp server - it may contain temporary files used for hacking or launching bots. <br><br>  Be sure to take a look at the <b>.htaccess</b> file - it can add redirects to other sites that spread the virus.  In this case, the .htaccess file can be placed both in the root of the site and above, so do not be lazy to look at all the directories of your account. <br><br>  In other words, it is necessary to look for all the unusual / incomprehensible and look inside all suspicious files.  PHP Shell might look like this: <br><br> <code>&lt;?php #v2.3 //Version <br> $auth_pass = ""; //75b43eac8d215582f6bcab4532eb854e <br> $color = "#00FF66"; //Colour <br> $default_action = "FilesMan"; <br> $default_charset = "Windows-1251"; <br> preg_replace("/.*/e","\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65 <br> \x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28'7b1tVxs50jD8OXvO9R9Er3fanhhjm2Q2Y7ADIZCQSSAD5 <br> GUC3N623bZ7aLs93W0Mk+W/31Wll5b6xZhkdq/7OedhJtDdKpVKUkkqlapK3rDM1tzJLL4tl7qn+ycf90/ <br> // ...    base64 <br></code> <br>  Key points to pay attention to in PHP scripts: <br><ul><li>  Co0lHaZZkeR style of writing text. </li><li>  The presence of the words Exploit and Shell. </li><li>  The presence of a large amount of code in base64. </li><li>  The presence of eval () or the function preg_replace () with the / e key in the first argument. </li></ul>  In the end, you can simply go to the browser and see what this script does. <br><br>  Files can also be searched manually, but faster, if a hack has occurred recently, use the find command: <br><br> <code># find ./public_html -mtime -3d <br> # find ./public_html -mtime -10h <br></code> <br>  (find syntax specified for FreeBSD).  These commands will show files that have changed in the last three days and the last 10 hours, respectively. <br><br>  If all else fails, you can simply search for all files that contain base64-encoded content, for example: <br><br> <code># find ./ -name '*.php' | xargs grep -E '[0-9a-zA-Z/]{80}' <br></code> <br>  This command will find all PHP scripts that contain lines that are similar to base64 with a length of at least 80 characters. <br><br><h4>  Break time determination </h4><br>  When files are found, it is very easy to determine the time of hacking - just look at the time when the earliest file was modified. <br><br>  If no suspicious files are found, but the site is infected with a virus, look at the date of the change of the index.php, index.html files or those in which you find a virus.  Most likely in this case, the site was hacked, stealing the password from FTP. <br><br><h4>  Search logs hacking site </h4><br>  Now the most important thing is for these magazines to be available! <br><br>  If a site only has a deface or a virus has been added to all index.html files, the site is most likely hacked through theft of the FTP password (or, much less often, SSH).  View FTP and SSH connection logs during hacking - the presence of unknown IP addresses or a large number of different IP addresses that made a successful connection to the site means that the password has been stolen. <br><br>  In this case, it is enough to check the computers from which the site was accessed for viruses, change FTP passwords and never save passwords in FTP clients again. <br><br>  If the site contains PHP Shell or malicious scripts (for example, to send spam), most likely the site was hacked through a vulnerability in CMS or any of its plugins.  In this case, you will need to analyze the web server logs. <br><br>  To better understand what needs to be looked for, consider how a CMS is hacked. <br><ol><li>  The attacker determines that the site has CMS installed or its plug-ins, or other software (outdated Joomla, phpMyAdmin, WYSIWYG editor, photo gallery, etc.) potentially vulnerable to vulnerabilities. </li><li>  He begins to sort out known exploits for this software.  The goal - in any way upload your file to the site. </li><li>  When a vulnerability is found, the cracker downloads PHP Shell. </li><li>  Having connected to PHP Shell, the hacker gets full access to the site and can then use it for any purpose. </li></ol>  An important point - download PHP Shell.  In the previous section, we determined the time at which malicious scripts were uploaded to the site.  Now it suffices to find references to them in the web server log.  In this way we will be able to determine the IP address of the attacker.  This can be done with a simple grep in access.log by the name of the PHP Shell file. <br><br><h5>  If you managed to determine the IP address </h5><br>  Having determined the IP address of the hacker, we search for this IP address using the web server log and see all the actions that he did.  Somewhere close to accessing PHP Shell, the site vulnerability will be successful. <br><br><h5>  If the determine the IP address failed </h5><br>  The method described above works if you know the specific name of the file through which the work with the site was performed after hacking.  However, this name is not always known.  In this case, you will have to look for the moment of hacking a little longer, but you can still find it. <br><br>  Most, the overwhelming majority of hacks are peculiar to HTTP POST requests, as they are used to upload files to the hacked site.  Through POST, an attacker can also attempt to crack a password entry form or simply enter the administration section with a stolen password. <br><br>  If you know the time of hacking the site (and we already know it), it is necessary to search in the web server log all POST requests that are close to the time of the hack.  There are no specific tips here - they can look completely different, but they will look unusual anyway.  For example, it may be queries containing '../../../../' or long queries containing file names or SQL queries. <br><br><h4>  If nothing could be found </h4><br>  This can also be.  In this case, you can only recommend a clean reinstall of the CMS and its extensions and the subsequent import of data.  Be sure to make sure that the version of the CMS and its extensions is the latest. <br><br>  And its extensions!  Most often, hacks are not made through the core of the site management system, but through some obsolete plugin, the author of which abandoned its development a long time ago. <br><br>  Well, of course, change all the passwords that have any relation to the site. <br><br><h4>  Mistress note </h4><ul><li>  In the process of searching for vulnerabilities on the site, if it is not possible to block access to it for visitors, block at least POST requests.  This will prevent the use of most standard exploits. </li><li>  Do not use outdated versions of CMS and plugins to them.  Stay tuned! </li><li>  After determining the cause of hacking, do not limit yourself to deleting the found scripts - the penetration points added by the attacker can be well hidden.  The best scheme for recovering a site after hacking is to close access to it for visitors, find the reason for hacking, restore the site from a backup (we exclude any site changes that an attacker could have done), update the CMS, making sure that the vulnerable component was also updated, after which open access to the site again. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/125839/">https://habr.com/ru/post/125839/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125831/index.html">A new interface has appeared in Google Docs.</a></li>
<li><a href="../125832/index.html">HTML5 Audio Visualization</a></li>
<li><a href="../125833/index.html">Page Visibility API and Visibility.js</a></li>
<li><a href="../125835/index.html">QNX RTOS: Flow Planning</a></li>
<li><a href="../125836/index.html">Quick change of network settings</a></li>
<li><a href="../125841/index.html">9 useful applications for amateurs</a></li>
<li><a href="../125845/index.html">Qt for Android (Necessitas Framework) - does it really work?</a></li>
<li><a href="../125846/index.html">Extendable Classes - Extendable Builders!</a></li>
<li><a href="../125849/index.html">DefCon: 10-year-old girl told about 0-day vulnerabilities in games on iOS and Android platforms</a></li>
<li><a href="../125851/index.html">Flexible, very flexible forms ... at ABBYY FlexiLayout Studio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>