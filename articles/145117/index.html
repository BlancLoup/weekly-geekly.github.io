<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenLayers or doing transport monitoring service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now on the market a lot of proposals for the sale of mobile devices designed to control moving objects or trackers. Most of them have the function of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenLayers or doing transport monitoring service</h1><div class="post__text post__text-html js-mediator-article">  Now on the market a lot of proposals for the sale of mobile devices designed to control moving objects or trackers.  Most of them have the function of transmitting information via GPRS to any given web address after a certain time interval.  Most often the data transfer format is different.  Therefore, we will not consider the issue of downloading data from the tracker to the database.  Suppose there is data and we want to start creating a service for monitoring transport.  The basis of such a system is formed by the possibilities: <br>  -select map and its display <br>  -Display point or image and captions <br>  - display of the polygon and its editing <br>  - display of the line and its editing <br>  - display of information connected with polygons, lines, dots (tooltips) <br>  - a little mathematics (counting the distance traveled, the area of ‚Äã‚Äãthe polygon, the point belonging to the polygon) <br>  All of these functions are easy to implement using <a href="http://openlayers.org/" title="openlayers">OpenLayers</a> , a JavaScript library. <br><img src="http://coderstory.net/habr/.png"><br><a name="habracut"></a><br>  <strong>Map selection and display</strong> <br>  To do this, on your page you need to create a div element with the desired size.  It will display the map.  Example: <br><pre><code class="hljs objectivec">div <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>=<span class="hljs-string"><span class="hljs-string">"map"</span></span> style=<span class="hljs-string"><span class="hljs-string">"position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px;"</span></span></code> </pre> <br>  Connect OpenLayers: <br><pre> <code class="hljs scala">script <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"Scripts/OpenLayers.js"</span></span></code> </pre><br>  Create a global map variable in which the map object will be stored.  Create a function call on the page loading event, which will contain the code for creating the map directly.  Example: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">body</span></span> onload=<span class="hljs-string"><span class="hljs-string">"LoadMap()"</span></span></code> </pre><br>  Describe the LoadMap function: <br><pre> <code class="hljs pgsql">//    EPSG:<span class="hljs-number"><span class="hljs-number">900913.</span></span> var maxExtent = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Bounds(<span class="hljs-number"><span class="hljs-number">-20037508</span></span>, <span class="hljs-number"><span class="hljs-number">-20037508</span></span>, <span class="hljs-number"><span class="hljs-number">20037508</span></span>, <span class="hljs-number"><span class="hljs-number">20037508</span></span>); var restrictedExtent = maxExtent.clone(); var maxResolution = <span class="hljs-number"><span class="hljs-number">156543.0339</span></span>; //     EPSG:<span class="hljs-number"><span class="hljs-number">4326.</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> = { projection: <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:900913"), displayProjection: <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:4326"), numZoomLevels: <span class="hljs-number"><span class="hljs-number">18</span></span>, maxResolution: maxResolution, maxExtent: maxExtent, restrictedExtent: restrictedExtent }; //  map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Map(<span class="hljs-string"><span class="hljs-string">'map'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>); //  - VirtualEarth var veroad = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Layer.VirtualEarth("Virtual Earth Roads", { <span class="hljs-string"><span class="hljs-string">'type'</span></span>: VEMapStyle.Road, sphericalMercator: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }); var veaer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Layer.VirtualEarth("Virtual Earth Aerial", { <span class="hljs-string"><span class="hljs-string">'type'</span></span>: VEMapStyle.Aerial, hericalMercator: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }); var vehyb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Layer.VirtualEarth("Virtual Earth Hybrid", { <span class="hljs-string"><span class="hljs-string">'type'</span></span>: VEMapStyle.Hybrid, sphericalMercator: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }); //  - OpenStreet var mapnik = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Layer.OSM(); //       map.addControl(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Control.ScaleLine()); map.addControl(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Control.MousePosition()); //     OpenLayers.Map map.addLayers([ mapnik, veroad, veaer, vehyb]); //    map.addControl(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Control.LayerSwitcher()); //         var point0 = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Geometry.Point(<span class="hljs-number"><span class="hljs-number">37.600328</span></span>, <span class="hljs-number"><span class="hljs-number">55.574624</span></span>); //      ,       . point0.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:4326"), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:900913")); //       <span class="hljs-number"><span class="hljs-number">9.</span></span>    <span class="hljs-number"><span class="hljs-number">15.</span></span> map.setCenter(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.LonLat(point0.x, point0.y), <span class="hljs-number"><span class="hljs-number">9</span></span>); }</code> </pre><br>  On the project site openlayers you can find many <a href="http://openlayers.org/dev/examples/bing.html" title="examples">examples</a> , about two hundred.  An example of visualization of a map from a given service can be seen <a href="http://openlayers.org/dev/examples/bing.html" title="here">here</a> .  Most of the tasks in the article cover these examples.  In the presented code, there is no accession of google and yandex cards, these cards need keys to work.  You have to register, get the access key to the service and only after that you can connect to these services.  Result code above: <br><img src="http://www.coderstory.net/habr/habr1.jpg" alt="one"><br>  <strong>Display point or image and captions</strong> <br>  Create layers that our objects will store (dots and images). <br><pre> <code class="hljs pgsql">//    .   , ,     , (${} -   ,      ), url  ,  . var styleImage = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Style( { graphicWidth: <span class="hljs-number"><span class="hljs-number">21</span></span>, graphicHeight: <span class="hljs-number"><span class="hljs-number">25</span></span>, graphicYOffset: <span class="hljs-number"><span class="hljs-number">-28</span></span>, label: "${label}", externalGraphic: "http://www.openlayers.org/dev/img/marker.png", fontSize: <span class="hljs-number"><span class="hljs-number">12</span></span> }); //labelYOffset -       var stylePoint = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Style( { pointRadius: <span class="hljs-number"><span class="hljs-number">5</span></span>, strokeColor: "red", strokeWidth: <span class="hljs-number"><span class="hljs-number">2</span></span>, fillColor: "lime", labelYOffset: <span class="hljs-number"><span class="hljs-number">-16</span></span>, label: "${label}", fontSize: <span class="hljs-number"><span class="hljs-number">16</span></span> }); //   .   styleMap      .  <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>     . var vectorPoint = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Layer.Vector("", { styleMap: <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.StyleMap( { "default": stylePoint, "select": { pointRadius: <span class="hljs-number"><span class="hljs-number">20</span></span>} }) }); //     ,       ,         <span class="hljs-number"><span class="hljs-number">45</span></span>  var vectorImage = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Layer.Vector("", { styleMap: <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.StyleMap( { "default": styleImage, "select": { rotation: <span class="hljs-number"><span class="hljs-number">45</span></span>} }) }); //    map.addLayer(vectorImage ); map.addLayer(vectorPoint );</code> </pre><br>  Layers are created, we create functions that will work with layers. <br><pre> <code class="hljs pgsql">//    . : , , ,  , .  ,          . <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> addImg(lon,lat,title,ident, layr){ var ttt = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.LonLat(parseFloat(lon), parseFloat(lat)); ttt.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:4326"), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:900913")); // features-   .    : , , ,  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (var k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; layr.features.length; k++) { //   features  ,       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(layr.features[k].attributes.ImgId==ident) { // <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> -       layr.features[k].<span class="hljs-keyword"><span class="hljs-keyword">move</span></span>(ttt); layr.features[k].attributes.label=title; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } var point0 = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Geometry.Point(parseFloat(lon), parseFloat(lat)); point0.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:4326"), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:900913")); //   Feature   OpenLayers.Feature.Vector layr.addFeatures(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Feature.Vector(point0, { label: title, <span class="hljs-type"><span class="hljs-type">name</span></span>: title, ImgId: ident })); } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> addPoint(lon,lat,title,ident){ var ttt = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.LonLat(parseFloat(lon), parseFloat(lat)); ttt.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:4326"), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:900913")); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (var k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].features.length; k++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].features[k].attributes.PointId==ident) { map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].features[k].<span class="hljs-keyword"><span class="hljs-keyword">move</span></span>(ttt); map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].features[k].attributes.label=title; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } var point0 = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Geometry.Point(parseFloat(lon), parseFloat(lat)); point0.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:4326"), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Projection("EPSG:900913")); map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].addFeatures(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Feature.Vector(point0, { label: title, <span class="hljs-type"><span class="hljs-type">name</span></span>: title, PointId: ident })); } &lt;/code&gt;       : &lt;code&gt; addPoint(<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">55.5</span></span>,<span class="hljs-string"><span class="hljs-string">' 1'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>,map.layers[<span class="hljs-number"><span class="hljs-number">4</span></span>]); addPoint(<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">55.1</span></span>,<span class="hljs-string"><span class="hljs-string">' 2'</span></span>,<span class="hljs-string"><span class="hljs-string">'2'</span></span>,map.layers[<span class="hljs-number"><span class="hljs-number">4</span></span>]); addImg(<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">55.6</span></span>,<span class="hljs-string"><span class="hljs-string">' 1'</span></span>,<span class="hljs-string"><span class="hljs-string">'2'</span></span>,map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>]); addImg(<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">55.9</span></span>,<span class="hljs-string"><span class="hljs-string">' 2'</span></span>,<span class="hljs-string"><span class="hljs-string">'2'</span></span>,map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>]);</code> </pre><br>  Result: <br><img src="http://www.coderstory.net/habr/habr2.jpg" alt="one"><br>  Only one image was added because the function call was with the same image identifiers.  The object has shifted, the name has been changed to a new one. <br>  <strong>Polygon mapping and editing</strong> <br>  Polygon creation function: <br><pre> <code class="hljs haskell">//  :     ,      function addPoly(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">,title,ident,layr){ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">featuress</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Array</span></span></span><span class="hljs-class">(); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coords</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">split</span></span></span><span class="hljs-class">(';'); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class"> = 0; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coords</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">length</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class">++) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coords</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class">].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">split</span></span></span><span class="hljs-class">(' '); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ttt</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenLayers</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LonLat</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parseFloat</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">[0]), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parseFloat</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">[1])); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">point0</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenLayers</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Geometry</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Point</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ttt</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lon</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ttt</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lat</span></span></span><span class="hljs-class">); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">point0</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">transform</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenLayers</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Projection</span></span></span><span class="hljs-class">("</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EPSG</span></span></span><span class="hljs-class">:4326"), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenLayers</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Projection</span></span></span><span class="hljs-class">("</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EPSG</span></span></span><span class="hljs-class">:900913")); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">featuress</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">push</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">point0</span></span></span><span class="hljs-class">); } //   ,     var linearRing2 = new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenLayers</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Geometry</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LinearRing</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">featuress</span></span></span><span class="hljs-class">); var polygonFeature2 = new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenLayers</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Feature</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Vector</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenLayers</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Geometry</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Polygon</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">linearRing2</span></span></span><span class="hljs-class">]), { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PolyID</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ident</span></span></span><span class="hljs-class"> }); layr.addFeatures(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">polygonFeature2</span></span></span><span class="hljs-class">); }</span></span></code> </pre><br>  An example of calling the polygon drawing function: <br><pre> <code class="hljs go">addPoly(<span class="hljs-string"><span class="hljs-string">'37 55.9;37.5 55.4;37 55'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>]);</code> </pre><br>  Editing in OpenLayrs is done using OpenLayers.Control.ModifyFeature.  You need to create an instance of this class specifying the layer whose objects you want to modify: <br><pre> <code class="hljs vhdl">var modef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenLayers.Control.ModifyFeature(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>]) modef.clickout = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; modef.toggle = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; modef.standalone = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.addControls([ modef]); modef.activate(); //   modef.selectFeature(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].features[<span class="hljs-number"><span class="hljs-number">2</span></span>]); //   var centr = <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].features[<span class="hljs-number"><span class="hljs-number">2</span></span>].geometry.getCentroid() //     <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.setCenter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenLayers.LonLat(centr.x, centr.y));</code> </pre><br>  Each vertex of the polygon at the moment of editing is indicated by a point and due to the fact that we placed the polygon on the layer for points, the style of this layer was applied to them.  Result: the caption "undefined" at the vertices of the polygon.  This is an example of the fact that for each type of objects it is better to create separate layers.  Display mode example: <br><img src="http://www.coderstory.net/habr/habr3.jpg" alt="3"><br>  Exit edit mode: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">modef</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.deactivate</span></span>();</code> </pre><br>  <strong>Line display and editing</strong> <br>  As already mentioned, the polygon is created from the line, so in the AddPoly function you need to change one line: <br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">layr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.addFeatures</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">polygonFeature2</span></span>);</code> </pre> <br>  on <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">layr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.addFeatures</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">linearRing2</span></span> );</code> </pre> <br>  The editing process is no different. <br>  <strong>Tooltips</strong> <br>  To implement a tooltip, you need to add an event handler to the map, which is an instance of the class: OpenLayers.Control.SelectFeature. <br><pre> <code class="hljs go"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> selectControl = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Control.SelectFeature([<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>]]); <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>.addControls([selectControl], { clickout: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, toggle: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, multiple: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, hover: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, toggleKey: <span class="hljs-string"><span class="hljs-string">"ctrlKey"</span></span>, multipleKey: <span class="hljs-string"><span class="hljs-string">"shiftKey"</span></span> }); selectControl.activate();</code> </pre><br>  After that, the processing of clicks on layer objects will take place.  The points will increase in size, the pictures rotate 45 degrees.  Create a point selection event handler: <br><pre> <code class="hljs pgsql">// <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> -    map.layers[<span class="hljs-number"><span class="hljs-number">5</span></span>].events.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>( { "featureselected": <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (e) { var HTMLcontent; var <span class="hljs-type"><span class="hljs-type">point</span></span> //     HTMLcontent = <span class="hljs-string"><span class="hljs-string">'table style="width: 100%;" tr td    td tr table '</span></span>; //getCentroid() -   ,    ,         <span class="hljs-type"><span class="hljs-type">point</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.LonLat(e.feature.geometry.getCentroid().x, e.feature.geometry.getCentroid().y); //OpenLayers.Popup.AnchoredBubble -  ,     OpenLayers.Popup var popup = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Popup.AnchoredBubble("SDVegetationInfo", <span class="hljs-type"><span class="hljs-type">point</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OpenLayers.Size(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), HTMLcontent, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); popup.opacity = <span class="hljs-number"><span class="hljs-number">0.9</span></span>; popup.autoSize = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; popup.setBackgroundColor("#bcd2bb"); //   map.addPopup(popup, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } //   ,     , "featureunselected": <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (e) { setTimeout(<span class="hljs-string"><span class="hljs-string">'if(map.popups.length - 1&gt;-1){map.removePopup(map.popups[map.popups.length - 1]);}'</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } });</code> </pre><br>  <strong>Counting the distance traveled, the area of ‚Äã‚Äãthe polygon, the belonging point to the polygon</strong> <br>  Counting the distance traveled <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.layers</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.features</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.feature</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.geometry</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getLength</span></span>()</code> </pre> <br>  polygon area <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.layers</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.features</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.feature</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.geometry</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getArea</span></span>()</code> </pre> <br>  polygon point <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.layers</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.features</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.containsPoint</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.layers</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.features</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span>)</code> </pre> <br>  The result of all previous actions can be seen on the page: <a href="http://www.coderstory.net/habr/habr.htm" title="result">link</a> <br><br>  In conclusion, many companies have already made their trackers on OpenLayers is cheap and easy.  OpenLayers documentation can be found <a href="http://dev.openlayers.org/docs/files/OpenLayers-js.html">here</a> . </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/145117/">https://habr.com/ru/post/145117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145112/index.html">Again the accident in the cloud Selectel ... How long?</a></li>
<li><a href="../145113/index.html">Hexy - prefab robot based on Arduino</a></li>
<li><a href="../145114/index.html">Backward compatibility programs for ruby: support ruby ‚Äã‚Äã1.8 or score?</a></li>
<li><a href="../145115/index.html">Treatment of the site from the virus in javascript files and other examples</a></li>
<li><a href="../145116/index.html">iCade - turn Apple devices into game joysticks</a></li>
<li><a href="../145120/index.html">Do you have permanent access to your home computer from outside (for example, via ssh or vnc)?</a></li>
<li><a href="../145121/index.html">Location sharing application research</a></li>
<li><a href="../145122/index.html">Comparing Windows Azure Blob Storage and Amazon Simple Storage Service (S3) - Part II, Summary</a></li>
<li><a href="../145123/index.html">Droider Show # 43. iPhone 5 against slavery!</a></li>
<li><a href="../145124/index.html">Cubby - synchronize files with and without the cloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>