<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Changing the voice menu of a portable speaker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings dear reader! In this article I will try to tell you how I managed to modify the portable speaker firmware, despite the fact that I am not a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Changing the voice menu of a portable speaker</h1><div class="post__text post__text-html js-mediator-article">  Greetings dear reader!  In this article I will try to tell you how I managed to modify the portable speaker firmware, despite the fact that I am not a programmer.  Surely for someone the idea will not be new, but when I faced this task I did not find a quick answer.  At the end of the article I wrote down the video if anyone is too lazy to read. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q4/uz/_k/q4uz_kqlxnio5yliz-hdlvcifi0.jpeg"></div><a name="habracut"></a><br>  So, there is a kind of portable speaker (in this case, DEXP Phill), its main drawback is that the manufacturer stuck a voice menu at the maximum volume into a screaming voice that cannot be turned off or quieter.  What is the same let's look at what's inside. <br><br>  Speakers and battery: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/webt/-g/rc/0v/-grc0vnbsx8opiu_il2ioctaj4e.jpeg"></div><br>  These two microcircuits are sound power amplifiers (UMZCH): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ya/hr/lr/yahrlrd0en_q_tfrab8jazhuo3y.jpeg"></div><br>  Here is a large, multi-legged microcircuit - the player itself, at the bottom of the battery charge controller and in the middle of a 25q40ATIG 512 kB SPI-flash memory (4 mbps): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lc/6h/mn/lc6hmnu-hvnoufpjpcqruisbxgg.jpeg"></div><br>  It seems to me logical to assume that the voice menu files are protected in this flash drive, among other things.  Ok, we take the programmer CH341A desoldering chip and read the contents. <br><br>  The chip can not solder and just hold: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0p/za/-k/0pza-klac2wdifxdwid7wanlw1k.jpeg"></div><br>  Why choose CH341A?  1) It reads 25 series of flash drives, 2) costs ~ 2USD. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/so/_k/tu/so_ktuumnmtesmgn9uve6dlks9y.jpeg"></div><br>  So, reading the data, we received a binary (bin) file of 512 KB in size in which at first glance nothing is clear: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/67/-t/al/67-tal9ptak-u-ebqzse40msh_i.png"></div><br>  If anyone does not know, then here are shown: on the left - the addresses of memory cells, in the middle - bytes (data) presented in hexadecimal, where the maximum value of FF, or 255 in decimal.  On the right, the editor substitutes the ACSII characters, which sometimes help a lot! <br><br>  If you open any mp3 file in the hex editor, and before the heap also <a href="https://ru.wikipedia.org/wiki/ID3_(%25D0%25BC%25D0%25B5%25D1%2582%25D0%25B0%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B5)">google</a> on the ID3 tag device it becomes clear <s>where the dog is buried</s> where and how you can search for these same mp3 files of the voice menu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1i/fc/kv/1ifckvaxq55t77v8vydzxdpqan4.png"></div><br>  All mp3 files with ID3v2 begin with a sequence of bytes 49 44, because ID3v2 is written at the beginning of the file - this is the first key.  ID3v1 - spelled at the end - this is the second key.  I was lucky, either because of the excess memory, or laziness, the programmers did not delete the ID3 tags and byte by byte, I fished out the files I needed.  I explain: we find the initial and final bytes, select, copy to a new hex file and save with the mp3 extension: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q5/1j/o6/q51jo6kdgtymnwovve_bhmodr9q.png"></div><br>  I was surprised to find many other voice files in the firmware.  For example, the numbers are voiced, though in English, and later I understood why they are needed: the speaker has bluetooth and when it is connected to the phone, it pronounces the incoming number during a call.  Curve localization.  By the way, this is how the monstrous dynamic compression was the dubbing: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qg/fq/fw/qgfqfweqnmbep4zfnbghshd_h-e.png"></div><br>  The quick-witted reader, probably already understood what to do next, there are two ways: change the volume of the original files, do something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_u/k3/69/_uk369j37uvs2v7ao6xg8v7luta.png"></div><br>  Or replace with something more worthy.  I picked up in the free music banks new sounds.  Here the main thing is to fit the size of the file being replaced: less is possible, more is not.  It well reduces the size of resampling (for example, from 44100 -&gt; 22050) and the bitrate itself, but quality is a compromise.  Then we do everything in reverse order: open new mp3 files in the hex editor, copy them to the right places in the firmware, save the firmware, write to the microcircuit, solder the microcircuit into place, assemble the column.  Profit. <br><br>  To make a new file the size of bytes in bytes with replaceable impossible.  It's easier to make it smaller, and fill in the remains of the old 0x00 (with zeros).  In other words, you must first select the entire replaced area, fill in 0x00, and then insert new data with replacement (zeros) without shifting the memory cells and changing the size of the final firmware file. <br><br><h3>  Conclusion </h3><br>  Important note: specifically, in my case, the CH341A programmer could only read 25Q40ATIG, could not write it.  it is not in the list of supported.  So I had to buy an analogue: 25Q40BVSIG with which everything turned out. <br><br>  Promised video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1J1A24QbjLo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/358634/">https://habr.com/ru/post/358634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358622/index.html">Web Authentication API standard: passwordless web authentication</a></li>
<li><a href="../358624/index.html">A story about how I, with the help of Google, found passwords on dozens of Trello public boards</a></li>
<li><a href="../358626/index.html">5 differences analyst work in projects and product development</a></li>
<li><a href="../358630/index.html">RDP Three letter game</a></li>
<li><a href="../358632/index.html">JS DevDay. Record of reports</a></li>
<li><a href="../358636/index.html">Fujitsu ETERNUS Storage Lineup Update</a></li>
<li><a href="../358638/index.html">FPP via FPL: Accelerate FPGA download</a></li>
<li><a href="../358640/index.html">Telegram: block cannot be canceled</a></li>
<li><a href="../358642/index.html">Redesign with a capital letter: we are studying the restart of Smashing Magazine in 2017</a></li>
<li><a href="../358644/index.html">Custdev from Support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>