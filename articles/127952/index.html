<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Posting data from the script in Vkontakte to the public page</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, an idea occurred to me to publish weather data for a day on VKontakte, since in the summer before work I often forgot to look at the site wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Posting data from the script in Vkontakte to the public page</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/8065d0da/6d03a6b2/c9510153/2b84f1a6.png" align="left"><br>  Recently, an idea occurred to me to publish weather data for a day on VKontakte, since in the summer before work I often forgot to look at the site with the weather and did not dress like the weather forecasters.  In this topic there will be reasoning about the implementation of posting on VKontakte and the example with profit from what I managed to do. <br><br><h5>  Idea </h5>  It all started with an idea - at first it seemed a bit boring to me, and I didn‚Äôt see the point of implementation, but after thinking twice (or even three times) I realized that it could bring some profit to my skills.  But more on that below :) <br><a name="habracut"></a><br><h5>  Python or PHP </h5>  First of all, it was necessary to choose what I would write on - the choice was not great and limited: python, which I have known for just a couple of months or php - with which I have been practicing various small scripts for 4 years now. About a few hours, I decided that I was not old enough for implementation in python :) Therefore, the choice was obvious - php with its simple and sometimes excessive clumsiness in my implementation (I will be grateful if you specify errors in the scripts - the link will be at the end of the article). <br><br><h5>  Authorization in Vkontakte </h5>  I, of course, did not want to reinvent the bicycle and for a long time and persistently tried to google a good class for authorization on VKontakte, but there were also some ancient scripts or classes that did not work through the contact API.  The second option did not suit me for the reason that it would not be possible to post entries on behalf of the group - I thought so at the very beginning, relying on someone's old comment from the habr ... And in vain!  Already after implementation, I went into the official API documentation and read what is already possible, but the bike was already written ... Now we are planning to rewrite it under the VKontakte API.  The only good news is that the bike turned out to be completely unwieldy and working in the harsh realities of the current authorization implementation on the site. <br>  Authorization and posting code: <br><pre><code class="php hljs">define(<span class="hljs-string"><span class="hljs-string">'SCR_DIR'</span></span>, dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//   include_once(SCR_DIR . '/config.php'); //  (, ,   ) include_once(SCR_DIR . '/classes/minicurl.class.php'); //    curl,     include_once(SCR_DIR . '/classes/vk_auth.class.php'); //    $vk = new vk_auth($VKEMAIL, $VKPWD, $VKPPID, $SLEEPTIME); //    , $VKEMAIL -    , $VKPWD - , $VKPPID -   , $SLEEPTIME -      //       ,    ,   ,     /data/logfile.txt if(!$vk-&gt;check_auth()) { exit('Error! See logfile.'); } //   $message     if (!$vk-&gt;post_to_wall($message)) { exit('Error! Not Posted!'); } else { echo 'Posted!'; }</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Weather parser </h5>  Having finished writing the authorization, I switched to writing a weather parser - I didn‚Äôt want to use the regulars as I did before, because  I would have to invent them for a very long time and, if desired, change the site where the weather comes from ... At this stage, Dmitry Rodin's blog post about <a href="http://blog.madie.ru/2009/05/03/www-parsing-with-tidy-xmldom-simplexml/">data parsing through XPath</a> helped me a lot.  I have already heard about XPath a couple of times, but I never understood what it is ‚Äî and it‚Äôs time to get into this convenient way of getting data from any site.  After testing his class and slightly rewriting it for myself, I decided that this was exactly what I needed.  All XPath paths can be easily obtained from the FireBug, but some will be incorrect, because  the parser uses tidy, which clears non-valid html-code, therefore it is better to use the add-on for FireBug - FirePath. <br>  A couple of XPath requests to parse the weather with gismeteo: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span>(SCR_DIR . <span class="hljs-string"><span class="hljs-string">'/classes/htmlparser.class.php'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   $parser = new HTMLParser('http://www.gismeteo.ru/city/hourly/' . $CITY); // $CITY -   ,   $weather_temperature = $parser-&gt;getConvDataFromXPath(".//*[@id='weather']/div[1]/div/div[2]"); //          UTF-8 $weather_type = $parser-&gt;getConvDataFromXPath(".//*[@id='weather']/div[1]/div/dl/dd"); //    (, ,  ..)</span></span></code> </pre><br><br><h4>  What I got from the implementation of this small script: </h4><ol><li>  I wrote my own small bike for authorization in VKontakte (in plans to rewrite under API); </li><li>  Acquainted with XPath and learned to parse sites with much faster productivity than through regulars; </li><li>  More closely acquainted with git; </li><li>  Made a small useful "service" for your city. </li><li>  Soon I find out whether all visitors to the contact are such vegetables, that they are not interested in useful information, but only pictures, but funny statuses; </li></ol><br><br>  You can see my implementation on this page: <a href="http://vkontakte.ru/weather_in_vologda">weather in Vologda</a> . <br>  Look at the source code or make the same public weather page for your city: <a href="https://github.com/saippuakauppias/vkweather">github.com/saippuakauppias/vkweather</a> <br><br>  PS: if someone needs, I can make a separate fork only with the authorization class of VKontakte - write in a personal. </div><p>Source: <a href="https://habr.com/ru/post/127952/">https://habr.com/ru/post/127952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127947/index.html">".Toster" announces readiness</a></li>
<li><a href="../127948/index.html">Creating and monetizing blog</a></li>
<li><a href="../127949/index.html">Windows Phone Camp - conference results</a></li>
<li><a href="../127950/index.html">Guitar, computer, live (part 1: amplitube 3)</a></li>
<li><a href="../127951/index.html">How we created a laboratory stand for the overseas discipline "Informatics"</a></li>
<li><a href="../127954/index.html">Touch Z-Distance - the world's first online photo studio</a></li>
<li><a href="../127957/index.html">Repair AMD Athlon processor</a></li>
<li><a href="../127958/index.html">What posts do you have negative emotions?</a></li>
<li><a href="../127961/index.html">Beeline and Opera Mini: mini continued</a></li>
<li><a href="../127963/index.html">How do you feel about security-related updates?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>