<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking the Qt 5 framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Static code analysis tools allow you to eliminate a lot of errors at the stage of writing the program text. For example, you can quickly identify and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking the Qt 5 framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/adf/687/ae5/adf687ae5a0f73e1f7c1e3b18ed1444f.png" alt="Qt and PVS-Studio"><br>  Static code analysis tools allow you to eliminate a lot of errors at the stage of writing the program text.  For example, you can quickly identify and eliminate typos.  Some programmers sincerely believe that they do not make typos and stupid mistakes.  This is not true.  Such mistakes are made by everyone.  This article will serve as a good demo.  Errata can be found even in such a quality and tested project as Qt. <br><a name="habracut"></a><br><h2>  Qt </h2><br>  Qt is a cross-platform software development toolkit in the C ++ programming language.  It allows you to run software written with it in most modern operating systems by simply compiling the program for each OS without changing the source code.  It includes all the main classes that may be required in the development of application software, ranging from GUI elements and ending with classes for working with the network, databases and XML.  Qt is completely object-oriented, easily extensible, and supports component programming techniques.  [source: Wikipedia] <br><br>  References: <ul><li>  Wikipedia - <a href="http://www.viva64.com/go.php%3Furl%3D1375">Qt</a> ; </li><li>  <a href="http://qt-project.org/">Qt Project</a> site; </li><li>  <a href="http://www.viva64.com/ru/a/0075/">An article</a> about testing us Qt 4.7.3 in 2011. </li></ul>  We will work with Qt version 5.2.1.  For analysis, we use <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> version 5.15. <br><br>  I want to note that PVS-Studio managed to find errors, despite the fact that the Qt project was checked with the help of Klocwork and Coverity analyzers.  How regularly these analyzers are used, I do not know.  However, Klocwork and Coverity is mentioned in bugtracker and ChangeLog-xxx files.  I also found a mention on the Internet that Qt is regularly checked using PC-lint. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Features of Qt Project Verification </h2><br>  For a change, we checked Qt with the help of a new mechanism that appeared in PVS-Studio Standalone.  No one knows about the mechanism yet, and we will remind from time to time in articles about its existence.  What is this new mysterious and beautiful mechanism? <br><br>  Sometimes it is difficult to check a project with PVS-Studio if it is built with nmake and the like.  It is required to integrate PVS-Studio into the assembly, which is not so easy.  At least, this clearly makes it difficult to quickly try and evaluate the tool. <br><br>  Now, a new mode of operation has appeared in PVS-Studio, which will greatly facilitate the work with such projects.  The analyzer can monitor the parameters with which the compiler is launched and collects all the information necessary for verification.  It is enough to tell the analyzer when to start surveillance and when to stop it. <br><br>  You can monitor the compiler from both the GUI application and the command line.  How it all works and how to use the new mode is described in more detail in the article: <br><br>  Yevgeny Ryzhkov.  <a href="http://www.viva64.com/ru/b/0243/">PVS-Studio now supports any build system on Windows and any compiler.</a>  <a href="http://www.viva64.com/ru/b/0243/">Easy and out of the box</a> . <br><br>  This article describes how the Qt project was tested in the monitoring mode from the command line. <br><br>  Be sure to read this article so that there are fewer misunderstandings.  For example, while the compilation of a project is being monitored, it is not possible to program in parallel.  If you compile files from another project, information about them will be collected and they will also be checked.  As a result, messages related to another project will be included in the report.  Get a "mess". <br><br><h2>  Test results </h2><br>  In general, I got the following impression about the code: <br><br>  The Qt code is qualitative and contains almost no errors related to the dangerous features of the C ++ language.  But a lot of ordinary typos. <br><br>  This article will well demonstrate that regardless of professionalism, all developers make typos.  The benefits of static code analysis were, are and will be.  Suppose the analyzer found 10 typos on a single launch.  So, if you use it regularly, then by now it would have prevented hundreds or thousands of errors.  This is a huge time saver.  It is much more profitable to detect the error immediately after its appearance in the code, than to find it when debugging the code or thanks to the user's complaint. <br><br><h3>  Dive into the wonderful world of typos </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/240/745/8b0/2407458b0f78dce7b8f174a073136854.png" alt="Welcome to a wondrous world of typos"><br><br>  <b>Typo n1</b> <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QWindowsUser32DLL::initTouch() { <span class="hljs-function"><span class="hljs-function">QSystemLibrary </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">library</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QStringLiteral(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"user32"</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span></span>; registerTouchWindow = ....; unregisterTouchWindow = ....; getTouchInputInfo = ....; closeTouchInputHandle = ....; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> registerTouchWindow &amp;&amp; unregisterTouchWindow &amp;&amp; getTouchInputInfo &amp;&amp; getTouchInputInfo; }</code> </pre> <br>  PVS-Studio Warning: V501 There‚Äôs the '&amp;&amp;' operator.  qwindowscontext.cpp 216 <br><br>  Four variables are assigned values.  These four variables must be verified.  But because of a typo, only 3 are checked. In the last line, instead of 'getTouchInputInfo', it should say 'closeTouchInputHandle'. <br><br>  <b>Typo N2</b> <br><pre> <code class="cpp hljs">QWindowsNativeImage *QWindowsFontEngine::drawGDIGlyph(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iw = gm.width.toInt(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ih = gm.height.toInt(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iw &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> || iw &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; .... }</code> </pre> <br>  PVS-Studio Warning: V501 | || '  operator: iw &lt;= 0 ||  iw &lt;= 0 qwindowsfontengine.cpp 1095 <br><br>  There is no height check stored in the variable 'ih'. <br><br>  <b>Typo N3, N4</b> <br><br>  This error applies to tests.  A good example of how static analysis complements unit tests.  More on this topic: " <a href="http://www.viva64.com/ru/a/0080/">How does static analysis complement TDD</a> ?" <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">qCompare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QImage </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;t1, QImage </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;t2, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t1.width() != t2.width() || t2.height() != t2.height()) { .... }</code> </pre> <br>  PVS-Studio warning: V501 there is no need for a '! =' Operator: t2.height ()! = T2.height () qtest_gui.h 101 <br><br>  The function of comparing two pictures incorrectly compares their height.  Or rather, does not compare at all. <br><br>  Error reproduced using Copy-Paste.  Exactly the same comparison can be seen in the same file below (line 135). <br><br>  <b>Typo n5</b> <br><br>  I apologize that I formatted the code ugly.  The lines were too long. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QXmlSimpleReader::setFeature( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; name, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> enable) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( name == QLatin1String( <span class="hljs-string"><span class="hljs-string">"http://trolltech.com/xml/features/report-start-end-entity"</span></span>) || name == QLatin1String( <span class="hljs-string"><span class="hljs-string">"http://trolltech.com/xml/features/report-start-end-entity"</span></span>)) { .... }</code> </pre> <br>  PVS-Studio Warning: V501 | || '  operator.  qxml.cpp 3249 <br><br>  The variable 'name' is compared twice with the same string.  Above in the code, there is a similar comparison.  There, the variable is compared with these two lines: <ul><li>  http: // <b>trolltech.com</b> / xml / features / report-whitespace-only-CharData </li><li>  http: // <b>qt-project.org</b> / xml / features / report-whitespace-only-CharData </li></ul>  By analogy, we can assume that in the above code, the variable 'name' should be compared with: <ul><li>  http: // <b>trolltech.com</b> / xml / features / report-start-end-entity </li><li>  http: // <b>qt-project.org</b> / xml / features / report-start-end-entity </li></ul>  <b>Typo N6, N7, N8, N9</b> <br><pre> <code class="cpp hljs">QString DayTimeDuration::stringValue() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!m_hours &amp;&amp; !m_minutes &amp;&amp; !m_seconds &amp;&amp; !m_seconds) .... }</code> </pre> <br>  PVS-Studio warning: V501 There are identical sub-expressions '! M_seconds' of the operator.  qdaytimeduration.cpp 148 <br><br>  Forgot about milliseconds.  Milliseconds are stored in the 'm_mseconds' variable.  The check should be: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!m_hours &amp;&amp; !m_minutes &amp;&amp; !m_seconds &amp;&amp; !m_mseconds)</code> </pre> <br>  Identical error with milliseconds is still in three places: <ul><li>  qdaytimeduration.cpp 170 </li><li>  qduration.cpp 167 </li><li>  qduration.cpp 189 </li></ul>  <b>Typo n10</b> <br><pre> <code class="cpp hljs">QV4::ReturnedValue QQuickJSContext2DPrototype::method_getImageData( QV4::CallContext *ctx) { .... qreal x = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">0</span></span>].toNumber(); qreal y = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">1</span></span>].toNumber(); qreal w = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">2</span></span>].toNumber(); qreal h = ctx-&gt;callData-&gt;args[<span class="hljs-number"><span class="hljs-number">3</span></span>].toNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!qIsFinite(x) || !qIsFinite(y) || !qIsFinite(w) || !qIsFinite(w)) .... }</code> </pre> <br>  PVS-Studio warning: V501 There are identical sub-expressions! QIsFinite (w)  operator.  qquickcontext2d.cpp 3305 <br><br>  There is no check for the 'h' variable.  Instead, the variable 'w' is checked twice. <br><br>  <b>Typo n11</b> <br><pre> <code class="cpp hljs">AtomicComparator::ComparisonResult IntegerComparator::compare(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Item &amp;o1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AtomicComparator::Operator, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Item &amp;o2) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Numeric *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> num1 = o1.as&lt;Numeric&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Numeric *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> num2 = o1.as&lt;Numeric&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(num1-&gt;isSigned() || num2-&gt;isSigned()) .... }</code> </pre> <br>  V656 Variables 'num1', 'num2' are initialized.  It's probably not an error or un-optimized code.  Consider inspecting the 'o1.as &lt;Numeric&gt; ()' expression.  Check lines: 220, 221. qatomiccomparators.cpp 221 <br><br>  The variables 'num1' and 'num2' are initialized with the same value.  Below both of these variables are checked.  This is suspicious.  After all, it suffices to check the value of only one variable. <br><br>  Most likely, the variable 'num2' should be initialized by an expression where the argument 'o2' is used: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Numeric *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> num1 = o1.as&lt;Numeric&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Numeric *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> num2 = o2.as&lt;Numeric&gt;();</code> </pre> <br>  <b>Typo n12</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Atlas::uploadBgra(Texture *texture) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QRect &amp;r = texture-&gt;atlasSubRect(); QImage image = texture-&gt;image(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (image.format() != QImage::Format_ARGB32_Premultiplied || image.format() != QImage::Format_RGB32) { .... }</code> </pre> <br>  V547 Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  qsgatlastexture.cpp 271 <br><br>  The condition in this code does not make sense.  She is always true.  To make it easier to understand what is wrong here, I will give a simplified example: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = ...; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a != <span class="hljs-number"><span class="hljs-number">1</span></span> || a != <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  A variable will always be unequal. <br><br>  I don't know what the correct code should look like.  Maybe it should be like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (image.format() == QImage::Format_ARGB32_Premultiplied || image.format() == QImage::Format_RGB32) {</code> </pre> <br>  Or so: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (image.format() != QImage::Format_ARGB32_Premultiplied &amp;&amp; image.format() != QImage::Format_RGB32) {</code> </pre> <br>  <b>Typo n13</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QDeclarativeStateGroupPrivate::setCurrentStateInternal( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;state, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ignoreTrans) { .... QDeclarativeTransition *transition = (ignoreTrans || ignoreTrans) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : findTransition(currentState, state); .... }</code> </pre> <br>  PVS-Studio Warning: V501 | || '  operator: ignoreTrans ||  ignoreTrans qdeclarativestategroup.cpp 442 <br><br>  Something is wrong here.  How exactly wanted to write check, it is not clear to me. <br><br>  <b>Typo N14</b> <br><pre> <code class="cpp hljs">QV4::ReturnedValue QQuickJSContext2DPrototype::method_createPattern(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"repeat"</span></span>) || repetition.isEmpty()) { pattern-&gt;patternRepeatX = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"repeat-x"</span></span>)) { pattern-&gt;patternRepeatX = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"repeat-y"</span></span>)) { pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"no-repeat"</span></span>)) { pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> exception: SYNTAX_ERR } .... }</span></span></code> </pre> <br>  PVS-Studio warning: V519 The 'pattern-&gt; patternRepeatY' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1775, 1776. qquickcontext2d.cpp 1776 <br><br>  Two consecutive assignments are made to the variable 'patternRepeatY': <br><pre> <code class="cpp hljs">pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br>  I think it should be written here: <br><pre> <code class="cpp hljs">} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (repetition == QStringLiteral(<span class="hljs-string"><span class="hljs-string">"no-repeat"</span></span>)) { pattern-&gt;patternRepeatX = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; pattern-&gt;patternRepeatY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {</code> </pre> <br><h3>  Incorrect use of C ++ </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/a81/37a/528/a8137a528065a402994e80dae7ae01c2.png" alt="Misuse of the C ++ language"><br><br>  As I said before, most of the errors are common typos.  Almost no errors associated with improper use of the C ++ language.  But a couple of such errors still found. <br><br>  <b>Beautiful error associated with the priority of operations</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QConfFileSettingsPrivate::readIniLine(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &lt; dataLen &amp;&amp; ((ch = data.at(i) != <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) &amp;&amp; ch != <span class="hljs-string"><span class="hljs-string">'\r'</span></span>)) ++i; .... }</code> </pre> <br>  V593 Consider reviewing the A = B! = C 'kind.  The expression is calculated as the following: 'A = (B! = C)'.  qsettings.cpp 1702 <br><br>  The loop is designed to find the end of the line.  The sign of the end of the line is the symbol '\ n' or '\ r'. <br><br>  Inside the condition, the symbol must be taken and compared with '\ n' and '\ r'.  The error occurs because the priority of the '! =' Operator is higher than that of the '=' operator.  Because of this, not the character code is written to the 'ch' variable, but 'true' or 'false'.  As a result, the comparison of '\ r' no longer plays any role. <br><br>  Place brackets so that the error is more noticeable: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &lt; dataLen &amp;&amp; ((ch = (data.at(i) != <span class="hljs-string"><span class="hljs-string">'\n'</span></span>)) &amp;&amp; ch != <span class="hljs-string"><span class="hljs-string">'\r'</span></span>))</code> </pre> <br>  Due to an error, the end of the line is considered only the '\ n' character.  If strings end with a '\ r' character, the function will not work correctly. <br><br>  The correct code is: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &lt; dataLen &amp;&amp; (ch = data.at(i)) != <span class="hljs-string"><span class="hljs-string">'\n'</span></span> &amp;&amp; ch != <span class="hljs-string"><span class="hljs-string">'\r'</span></span>)</code> </pre> <br>  <b>Loss of accuracy</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QWindowsTabletSupport::translateTabletPacketEvent() { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> radAzim = (packet.pkOrientation.orAzimuth / <span class="hljs-number"><span class="hljs-number">10</span></span>) * (M_PI / <span class="hljs-number"><span class="hljs-number">180</span></span>); .... }</code> </pre> <br>  V636 The 'packet.pkOrientation.orAzimuth / 10' expression was implicitly casted from 'int' type to 'double' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  qwindowstabletsupport.cpp 467 <br><br>  The variable 'packet.pkOrientation.orAzimuth' is of type 'int'.  This integer variable is divided by the number 10. It is suspicious that the result of the division is then used in conjunction with the values ‚Äã‚Äãof the type 'double'.  The end result is also placed in a variable of type 'double'. <br><br>  Such an integer division is not necessarily a mistake.  Perhaps the code is written exactly as intended.  But as practice shows, this is often a flaw, leading to a loss of accuracy of calculations. <br><br>  For example, let the variable 'packet.pkOrientation.orAzimuth' be 55. Then the result of the calculations will be equal to: <br><br>  (55/10) * (3.14159 ... / 180) = 5 * 0.01745 ... = 0.087266 ... <br><br>  Accuracy can be significantly increased.  It is enough to declare a constant 10 as a double type: "(packet.pkOrientation.orAzimuth / <b>10.0</b> ) * (M_PI / 180)".  Now the result of the calculation is: <br><br>  (55 / 10.0) * (3.14159 ... / 180) = 5.5 * 0.01745 ... = 0.095993 ... <br><br>  Such inaccuracies occur frequently, as programmers do not pay attention to expressions where variables of different types are mixed.  Such inattention often leads also to 64-bit errors (see <a href="http://www.viva64.com/ru/l/0017/">mixed arithmetic</a> ). <br><br>  The analyzer detects another 51 suspicious integer divisions.  Perhaps some expressions will be less accurate than the developers wanted.  I give them a list: <a href="http://www.viva64.com/external-pictures/txt/qt-v636.txt">qt-v636.txt</a> . <br><br>  <b>Pointless pointer checks</b> <br><br>  If memory is allocated using the 'new' operator, it has long been pointless to check for a pointer to equality to zero.  If memory fails to allocate, an exception will be thrown.  Of course, you can make the 'new' operator return 0, but now it's not about these cases. <br><br>  However, programmers forget from time to time, and a meaningless check reappears in the code. <br><pre> <code class="cpp hljs">HRESULT STDMETHODCALLTYPE QWindowsEnumerate::Clone( IEnumVARIANT **ppEnum) { QWindowsEnumerate *penum = <span class="hljs-number"><span class="hljs-number">0</span></span>; *ppEnum = <span class="hljs-number"><span class="hljs-number">0</span></span>; penum = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QWindowsEnumerate(<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!penum) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E_OUTOFMEMORY; .... }</code> </pre> <br>  PVS-Studio warning: V668 um using um um allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated.  The exception will be generated in the case of memory allocation error.  qwindowsmsaaaccessible.cpp 141 <br><br>  There are a few more such checks: main.cpp 127, qaudiodevicefactory.cpp 236, qaudiodevicefactory, and scrp 263, qaudiobuffer.cpp 488, mfvideorendevelopes, and others. , positionpollfactory.cpp 60. <br><br><h3>  Dark side </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/896/796/d06/896796d06adb2981b3062b83f771e4ff.png" alt="The dark side"><br><br>  There are two code fragments about which I cannot say that this is exactly a mistake.  I do not know the project architecture and implementation features.  However, even if this is not an error, then this is the dark side of C ++ programming. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Q_CORE_EXPORT</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QObject</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~QObject(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QEvent *)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eventFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QObject *, QEvent *)</span></span></span></span>; .... }; QObject *QQmlVME::run(....) { .... QObject *o = (QObject *)<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>(instr.typeSize + <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(QQmlData)); ::<span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *&gt;(o), <span class="hljs-number"><span class="hljs-number">0</span></span>, instr.typeSize + <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(QQmlData)); .... }</code> </pre> <br>  PVS-Studio warning: V598 The 'memset' function is used to configure the fields of the 'QObject' class.  Virtual method table will be maintained by this.  qqmlvme.cpp 658 <br><br>  The QObject class has virtual functions.  This means that the object stores a pointer to a table of virtual methods.  It seems to me not a good idea to initialize such objects using the memset () function. <br><br>  Another caveat: V598 The 'memset' function is used to configure the fields of the 'QObject' class.  Virtual method table will be maintained by this.  qdeclarativevme.cpp 286 <br><br><h3>  Null pointer dereferencing </h3><br>  Perhaps these errors could be attributed to typos.  But I prefer to separate them into a separate group.  So they seem darker and more serious. <br><br>  Note.  The division of errors into groups is always quite conditional.  Often one and the same error can be classified as a typo, as a vulnerability, as an overrun of an array, and so on. <br><br>  Let's return to the null pointers. <br><br>  <b>Null pointer dereferencing due to typo</b> <br><pre> <code class="cpp hljs">QV4::ReturnedValue QQuickJSContext2DPixelData::getIndexed( QV4::Managed *m, uint index, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> *hasProperty) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!m) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m-&gt;engine()-&gt;currentContext()-&gt;throwTypeError(); .... }</code> </pre> <br>  PVS-Studio warning: V522 Dereferencing of the null pointer 'm' might take place.  qquickcontext2d.cpp 3169 <br><br>  Apparently, the operator '!'  here is superfluous.  A simple typo leading to a serious error. <br><br>  <b>The dereference of the null pointer in the error handler</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QDocIndexFiles::readIndexSection(....) { .... DocNode* dn = qdb_-&gt;findGroup(groupNames[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dn) { dn-&gt;addMember(node); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"DID NOT FIND GROUP:"</span></span> &lt;&lt; dn-&gt;name() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"for:"</span></span> &lt;&lt; node-&gt;name(); } .... }</code> </pre> <br>  PVS-Studio warning: V522 Dereferencing of the null pointer 'dn' might take place.  qdocindexfiles.cpp 539 <br><br>  If an error occurs, a diagnostic message should be printed.  It will try to take the name of a non-existent object: dn-&gt; name (). <br><br>  <b>82 potential null pointer dereferencing</b> <br><br>  In almost all projects, including Qt, there are flaws in working with null pointers.  Often the check is carried out after the pointer has been used.  It is not always a mistake.  It happens that the pointer in principle can not be equal to zero. <br><br>  In any case, such places deserve study and refactoring.  Even if there is no error, an extra pointer check confuses the programmer when reading the code. <br><br>  Consider one of the fragments of the dangerous code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gray_raster_render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QT_FT_Outline* outline = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QT_FT_Outline*)params-&gt;source; .... <span class="hljs-comment"><span class="hljs-comment">/* return immediately if the outline is empty */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( outline-&gt;n_points == <span class="hljs-number"><span class="hljs-number">0</span></span> || outline-&gt;n_contours &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !outline || !outline-&gt;contours || !outline-&gt;points ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ErrRaster_Invalid_Outline; .... }</code> </pre> <br>  PVS-Studio warning: V595 The 'outline' pointer was used before it was verified against nullptr.  Check lines: 1746, 1749. qgrayraster.c 1746 <br><br>  I think the error appeared at the moment when they wanted to optimize the function of gray_raster_render ().  Most likely, these lines were inserted into the already completed function code: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* return immediately if the outline is empty */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( outline-&gt;n_points == <span class="hljs-number"><span class="hljs-number">0</span></span> || outline-&gt;n_contours &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>  The trouble is that the 'outline' pointer may be null.  The check for pointer zero equality is slightly lower. <br><br>  The analyzer found 81 more potential errors.  I will <a href="http://www.viva64.com/external-pictures/txt/qt-v595.txt">give</a> diagnostic messages list: <a href="http://www.viva64.com/external-pictures/txt/qt-v595.txt">qt-v595.txt</a> . <br><br><h3>  Unanswered Questions </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/c93/754/8cd/c937548cdcc3b91711a0be4c3955db6a.png" alt="Questions without answers"><br><br>  There are strange code fragments about which it is difficult to say how they appeared and what was actually planned to write.  Probably, these are typos, possibly unfinished code, possibly unsuccessful refactoring. <br><br>  <b>Double check</b> <br><pre> <code class="cpp hljs">QWindowsFontEngine::~QWindowsFontEngine() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (QWindowsContext::verboseFonts) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (QWindowsContext::verboseFonts) qDebug(<span class="hljs-string"><span class="hljs-string">"%s: font='%s"</span></span>, __FUNCTION__, qPrintable(_name)); .... }</code> </pre> <br>  PVS-Studio warning: V571 Recurring check.  The 'if (QWindowsContext :: verboseFonts)' condition was already verified in line 369. qwindowsfontengine.cpp 370 <br><br>  Why double check the same thing?  Perhaps one check is superfluous.  Perhaps you forgot to check something else. <br><br>  <b>Double assignment</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Moc::parse() { .... index = def.begin + <span class="hljs-number"><span class="hljs-number">1</span></span>; namespaceList += def; index = rewind; .... }</code> </pre> <br>  PVS-Studio warning: V519 The 'index' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 568, 570. moc.cpp 570 <br><br>  Why are 'index' variables assigned to different values? <br><br>  There are some more similar strange code fragments: <ul><li>  V519 The 'exitCode' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 807, 815. qprocess.cpp 815 </li><li>  V519 The 'detecting' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 163, 164. qhoversensorgesturerecognizer.cpp 164 </li><li>  V519 The 'increaseCount' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 185, 186. qtwistsensorgesturerecognizer.cpp 186 </li></ul>  <b>Suspicion of missing 'break' statement</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> GSuggestCompletion::eventFilter(QObject *obj, QEvent *ev) { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (key) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_Enter: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_Return: doneCompletion(); consumed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_Escape: editor-&gt;setFocus(); popup-&gt;hide(); consumed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_Up: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_Down: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_Home: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_End: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_PageUp: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Qt::Key_PageDown: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  PVS-Studio warning: V519 The 'consumed' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 110, 115. googlesuggest.cpp 115 <br><br>  Is the break statement forgotten or not? <br><br>  It seemed to the analyzer that the variable 'consumed' could be assigned the value 'true' two times in a row.  There is a possibility that the break statement is forgotten.  But I'm not so sure.  Maybe you just need to delete the first assignment: "consumed = true;". <br><br>  <b>Suspicion of extra 'break' operator</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QHelpGenerator::registerVirtualFolder(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (d-&gt;query-&gt;next()) { d-&gt;namespaceId = d-&gt;query-&gt;value(<span class="hljs-number"><span class="hljs-number">0</span></span>).toInt(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  PVS-Studio warning: V612 An unconditional 'break' within a loop.  qhelpgenerator.cpp 429 <br><br>  Is it correct that the loop will immediately stop due to the 'break' operator? <br><br>  Another such code snippet lives here: qhelpgenerator.cpp 642 <br><br><h3>  miscellanea </h3><br>  Be patient.  The article will end soon.  There are still a few mixed errors. <br><br>  <b>Incorrect use of the toLower () function</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-function"><span class="hljs-function">QByteArray </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argv[a])</span></span></span></span>; .... arg = arg.mid(<span class="hljs-number"><span class="hljs-number">1</span></span>); arg.toLower(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg == <span class="hljs-string"><span class="hljs-string">"o"</span></span>) .... }</code> </pre> <br>  PVS-Studio warning: V530 The return value of the function 'toLower' is required to be utilized.  main.cpp 72 <br><br>  The 'toLower ()' function does not modify the object.  It returns a copy of the object that will hold the lowercase characters. <br><br>  Another error: V530 The return value of the function "toLower" is required to be utilized.  main.cpp 1522 <br><br>  <b>Array bounds</b> <br><br>  The situation is complicated.  Please focus. <br><br>  There is such a numbered type: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { JNone, JCausing, JDual, JRight, JTransparent } Joining;</code> </pre> <br>  Remember that JTransparent == 4. <br><br>  Now consider the getNkoJoining () function: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Joining </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNkoJoining</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uc &lt; <span class="hljs-number"><span class="hljs-number">0x7ca</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JNone; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uc &lt;= <span class="hljs-number"><span class="hljs-number">0x7ea</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JDual; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uc &lt;= <span class="hljs-number"><span class="hljs-number">0x7f3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JTransparent; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uc &lt;= <span class="hljs-number"><span class="hljs-number">0x7f9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JNone; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uc == <span class="hljs-number"><span class="hljs-number">0x7fa</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JCausing; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JNone; }</code> </pre> <br>  What matters to us is that this function can return a 'JTransparent'.  That is, the function can return 4. <br><br>  The program has a two-dimensional array 'joining_table': <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> JoiningPair joining_table[<span class="hljs-number"><span class="hljs-number">5</span></span>][<span class="hljs-number"><span class="hljs-number">4</span></span>] = { .... };</code> </pre> <br>  And now the actual place where the error may occur: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNkoProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... Joining j = getNkoJoining(chars[<span class="hljs-number"><span class="hljs-number">0</span></span>]); ArabicShape shape = joining_table[XIsolated][j].form2; .... }</code> </pre> <br>  PVS-Studio warning: V557 Array overrun is possible.  The value of 'j' index could reach 4. harfbuzz-arabic.c 516 <br><br>  As we remember, the getNkoJoining () function can return the value 4. Thus, we refer to the cell of the joining_table array [...] [4].  It is unacceptable.  There will be going beyond the array boundary. <br><br>  <b>Same conditions</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Node::setPageType(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; t) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((t == <span class="hljs-string"><span class="hljs-string">"API"</span></span>) || (t == <span class="hljs-string"><span class="hljs-string">"api"</span></span>)) pageType_ = ApiPage; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-string"><span class="hljs-string">"howto"</span></span>) pageType_ = HowToPage; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-string"><span class="hljs-string">"overview"</span></span>) pageType_ = OverviewPage; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-string"><span class="hljs-string">"tutorial"</span></span>) pageType_ = TutorialPage; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-string"><span class="hljs-string">"howto"</span></span>) pageType_ = HowToPage; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-string"><span class="hljs-string">"article"</span></span>) pageType_ = ArticlePage; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-string"><span class="hljs-string">"example"</span></span>) pageType_ = ExamplePage; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-string"><span class="hljs-string">"ditamap"</span></span>) pageType_ = DitaMapPage; }</code> </pre> <br>  PVS-Studio warning: V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 386, 392. node.cpp 386 <br><br>  Twice performed proving (t == "howto").  I think one of them is superfluous. <br><br>  Here are a couple of similar warnings: <ul><li>  V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 188, 195. q Maintainingreader_tpl_p.h 188 </li><li>  V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 299, 303. mfmetadatacontrol.cpp 299 <br></li></ul>  <b>Doing the same thing</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QBluetoothServiceDiscoveryAgentPrivate::_q_deviceDiscovered( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QBluetoothDeviceInfo &amp;info) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mode == QBluetoothServiceDiscoveryAgent::FullDiscovery) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; discoveredDevices.count(); i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(discoveredDevices.at(i).address() == info.address()){ discoveredDevices.removeAt(i); } } discoveredDevices.prepend(info); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; discoveredDevices.count(); i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(discoveredDevices.at(i).address() == info.address()){ discoveredDevices.removeAt(i); } } discoveredDevices.prepend(info); } }</code> </pre> <br>  PVS-Studio warning: V523 The 'then' statement is equivalent to the 'else' statement.  qbluetoothservicediscoveryagent.cpp 402 <br><br>  Regardless of the condition, the same actions are performed. <br><br>  Similarly: pcre_exec.c 5577, ditaxmlgenerator.cpp 1722, htmlgenerator.cpp 388. <br><br><h3>  Inherited errors </h3><br>  Qt uses several third-party libraries.  There are errors in these libraries too.  It turns out that these errors are in Qt.  I did not describe them in the article, but I decided that I could mention them. <br><br>  I did not look carefully at the third-party libraries, but I wrote out something: <a href="http://www.viva64.com/external-pictures/txt/qt-3rdparty.txt">qt-3rdparty.txt</a> . <br><br>  Note.  However, one should not think that, on the other hand, I watched Qt very carefully.  The project is large and even a superficial examination is enough to write just such an article. <br><br><h2>  findings </h2><br>  PVS-Studio is an excellent, powerful analyzer that is able to find errors even in such high-quality and polished projects as the Qt framework. <br><br>  It will help the development team save a lot of time, finding many errors at an early stage.  If you use <a href="http://www.viva64.com/ru/d/0218/">incremental analysis</a> , then errors will be detected immediately after the files are compiled. <br><br><h2>  Additional links </h2><br><ol><li>  We regularly check open-source projects.  For example, Tor, Chromium, Clang, Firebird, OpenCV.  To all who are interested, come here: "An <a href="http://www.viva64.com/ru/a/0084/">updated list of open-source projects that we tested with PVS-Studio</a> ." </li><li>  Here you can <a href="http://www.viva64.com/ru/pvs-studio-download/">download a trial version of PVS-Studio</a> .  At the beginning, 20 clicks are given to navigate the warnings.  After posting information about yourself, another 200 clicks. </li></ol><br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0251/">Checking the Qt 5 Framework</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6b/dd5/f59/b6bdd5f59497feb639fd7b29bd7f4b53.png" alt="Slowpoke Question"><br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/219869/">https://habr.com/ru/post/219869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219855/index.html">ImageLoaders: Continued</a></li>
<li><a href="../219857/index.html">Wireless power transmission at 5 meters</a></li>
<li><a href="../219859/index.html">GOST 34.11-2012 Stribog for flat assembler (x86)</a></li>
<li><a href="../219865/index.html">Features of the development of children's mobile applications. Practical advice</a></li>
<li><a href="../219867/index.html">Mobile phone based laboratory microscope</a></li>
<li><a href="../219871/index.html">How we broke docshell.ru</a></li>
<li><a href="../219873/index.html">15 template engines for front-end development</a></li>
<li><a href="../219875/index.html">Indexing AJAX sites</a></li>
<li><a href="../219879/index.html">Startup step by step: team and mentors</a></li>
<li><a href="../219881/index.html">Tizen Developer Lab in St. Petersburg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>