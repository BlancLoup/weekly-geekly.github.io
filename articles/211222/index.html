<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating project office tools based on Microsoft Project Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Today we will tell about our experience of using Project Server for planning and accounting of labor costs for projects, about how we quickl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating project office tools based on Microsoft Project Server</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  Today we will tell about our experience of using Project Server for planning and accounting of labor costs for projects, about how we quickly customized it for our tasks and achieved a clear picture as a result: managers see how the company works, how successfully projects are done, what is the efficiency of each individual employee for the requested time period, etc. <br><br><h5>  History and statistics of using Project Server in EastBanc Technologies </h5><br>  We have been using Project Server since 2005 to keep track of working time and work planning within the group of companies consisting of two offices in different time zones - in Russia and the USA.  We also take into account in the system of temporarily involved contractors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Sample statistics: </h6><br>  Total projects in the system - 603, <br><br>  Employees - 216, <br><br>  Time sheets of the accounting of working hours (they are the time sheets, they are the same timeshields) to check weekly - 140, <br><br>  Tasks per week 260. <br><br><a name="habracut"></a>  <b>Workflow looks like this</b> : we start each project in the Project, include all the project team members there, create a project plan (tasks, planned deadlines and labor costs).  Employees regularly enter information about how much work time has been spent on project tasks for each working day - fill out the so-called time sheet, the time sheet. <br><br>  For an employee, this simply looks like putting numbers on a table with tasks assigned to them by day.  If necessary, the tasks in the project they can start independently.  And since this is a ‚Äúbureaucratic‚Äù, routine procedure for an employee that is easy to forget, automatic email reminders are set up. <br><br>  Based on the data sent by employees, an OLAP-cube is built, which allows managers with a couple of clicks to construct reports of various formats - in fact, the report can be collected for any needs that occur to managers and analyze information in a convenient way from any angle. <br><br><h5>  Tools for implementing this solution on Project Server </h5><br>  What have we done to customize Project Server to our needs as described above? <br><br>  There are several technical possibilities for constructing reports in sections of interest to us, which are provided by Project Server 2010: <br><br>  1. Using one of the Project Server databases (how to configure <a href="http://msdn.microsoft.com/en-us/library/office/aa568342(v%3Doffice.12).aspx">here</a> ). <br><br>  In the end, a <a href="http://msdn.microsoft.com/en-us/library/office/bb428822(v%3Doffice.12).aspx">fairly simple query is made</a> . <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> EpmResource.ResourceTimesheetManagerUID, MSP_EpmResource.ResourceName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> MSP_EpmResource <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> MSP_EpmResource <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> EpmResource <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> MSP_EpmResource.ResourceUID = EpmResource.ResourceTimesheetManagerUID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> EpmResource.ResourceUID &lt;&gt; EpmResource.ResourceTimesheetManagerUID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span></code> </pre> <br><br>  The result using Pivot tables is published in Excel Services: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c1/20f/0ac/7c120f0ac608ec9193c71d4178fba69f.png"><br><br>  2. Using OLAP cubes embedded in Project Server (how to configure <a href="http://technet.microsoft.com/ru-ru/library/ff465339.aspx">here</a> ). <br><br>  In Excel it looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f31/1e2/2d4/f311e22d44fa0207fd695327e3c693b9.png"><br><br>  List of fields available in the analytic cube: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59e/9fe/078/59e9fe0782c19eebf4c0ebd221b1a3fc.png"><br><br>  In our case, we are faced with the fact that both methods have serious drawbacks. <br><br>  In terms of data structure: <br><br><ol><li>  You must be able to filter employees on the grounds of "fired" or "working", because  For 10 years of the company's history, the Project Server user base has accumulated a fairly large archive. </li><li>  In the time dimension, you need to be able to build reports on real months, and not on fiscal periods, since  they form the basis of time sheets for bookkeeping and are subsequently loaded with 1C. </li><li>  In an employee dimension, you need to understand the following things: a.  Affiliation to a company division: Russia, America or external contracting organizations;  b.  Personnel number of the employee in 1C;  c.  E-mail address for sending notifications about a report that was not filled in on time. </li><li>  Project Objectives </li></ol><br>  The publication in Excel Services has one, but an important drawback: with a large amount of data (see the number of projects, employees, tasks in our system above) any use of the filter leads to the execution of a database query, and this is the time to wait for the results and build report. <br><br>  OLAP cubes also have a nuance: they are divided into a series of different cubes with data scattered around them, for example, tasks in one and time sheets in another.  In general, cubes are more focused on portfolio analysis than on ad hoc work. <br><br><h6>  What we have done to meet our needs: </h6><br>  We took the standard sql query from MicroSoft to Project Server as a basis for building an OLAP cube, slightly modifying it for our needs.  In the frequency of made changes in time periods, because  It is important for us to have two dimensions - by real weeks and by working weeks, we added an employee's e-mail box and the sign ‚Äúfired‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> R.StartDate, R.EndDate, R.PeriodName, R.TimeByDay, R.TimeByDay_DayOfWeek, R.ActualWorkBillable, R.ProjectName, R.TS_LINE_CACHED_ASSIGN_NAME + <span class="hljs-string"><span class="hljs-string">' ('</span></span> + R.ProjectName + <span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TaskName, R.Status, R.ProjectAccount, R.Location, R.ResourceCompany, R.EmployeeID, R.TS_LINE_CLASS_NAME, R.Type, R.ProjectOwner, R.Firstname, R.LastName, R.ResourceName, R.ModifiedDate, R.ResourceNameUID, <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(yyyy, R.EndDate) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PeriodYear, <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(mm, R.EndDate) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PeriodMonth, <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(ww, R.EndDate) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PeriodWeek, <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(yyyy, R.TimeByDay) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RealPeriodYear, <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(mm, R.TimeByDay) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RealPeriodMonth, <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(ww, R.TimeByDay) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RealPeriodWeek, R.ProjectStatus, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>(R.RES_TERMINATION_DATE, <span class="hljs-keyword"><span class="hljs-keyword">GETDATE</span></span>()) &gt;= <span class="hljs-keyword"><span class="hljs-keyword">GETDATE</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> IsFire, R.WRES_EMAIL <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> Email <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> R_1.RES_HIRE_DATE, R_1.RES_TERMINATION_DATE, R_1.WRES_EMAIL, R_1.TODAY, R_1.IsActive, R_1.StartDate, R_1.EndDate, R_1.PeriodName, R_1.TimeByDay, R_1.TimeByDay_DayOfWeek, R_1.ActualWorkBillable, R_1.ProjectName, R_1.[Task <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>], R_1.Status, R_1.ProjectAccount, R_1.Location, R_1.ResourceCompany, R_1.EmployeeID, R_1.TS_LINE_CACHED_ASSIGN_NAME, R_1.TS_LINE_CLASS_NAME, R_1.Type, R_1.TimesheetClass, R_1.ProjectOwner, R_1.Firstname, R_1.LastName, R_1.ResourceName, R_1.ModifiedDate, R_1.ResourceNameUID, R_1.ResourceCC, R_1.CostCenter, R_1.ProjectType, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> R_1.ProjectStatus <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Undefined'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> R_1.ProjectStatus <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ProjectStatus, R_1.TS_LINE_UID, <span class="hljs-keyword"><span class="hljs-keyword">DATEADD</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">day</span></span>, - <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DATEDIFF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">day</span></span>, T.EFFECTIVE_DATE, R_1.TimeByDay)), R_1.TimeByDay) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> EFFECTIVE_DATE <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> res.RES_HIRE_DATE, res.RES_TERMINATION_DATE, res.WRES_EMAIL, <span class="hljs-keyword"><span class="hljs-keyword">GETDATE</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TODAY, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> (res.RES_TERMINATION_DATE &gt; <span class="hljs-keyword"><span class="hljs-keyword">GETDATE</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> res.RES_TERMINATION_DATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'Inactive'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> IsActive, tpr.WPRD_START_DATE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> StartDate, tpr.WPRD_FINISH_DATE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> EndDate, tpr.WPRD_NAME <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PeriodName, <span class="hljs-keyword"><span class="hljs-keyword">ISNULL</span></span>(tla.TS_ACT_START_DATE, tpr.WPRD_START_DATE) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TimeByDay, <span class="hljs-keyword"><span class="hljs-keyword">DATEPART</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">weekday</span></span>, tla.TS_ACT_START_DATE) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TimeByDay_DayOfWeek, tla.TS_ACT_VALUE / <span class="hljs-number"><span class="hljs-number">60000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ActualWorkBillable, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> tcl.TS_LINE_CLASS_NAME <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Standard'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> tp.PROJ_NAME <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> tcl.TS_LINE_CLASS_NAME <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ProjectName, tsk.TASK_NAME <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Task <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> t .TS_STATUS_ENUM <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'InProgress'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Submitted'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Acceptable'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Approved'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Rejected'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Pending'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'Missing'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Status</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> tcl.TS_LINE_CLASS_NAME <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Standard'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> PP.ProjectAccount <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Administrative &amp; General'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0700-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Bench time'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0702-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Holidays'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0500-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Internal Projects'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0701-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Pre-sales &amp; Overhead'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0600-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Recruitment (interview)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0703-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Sales activity'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0704-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Vacation'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'0209-000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> PP.ProjectAccount <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ProjectAccount, C.Location, RC.ResourceCompany, E.EmployeeID, tl.TS_LINE_CACHED_ASSIGN_NAME, tcl.TS_LINE_CLASS_NAME, tcl.TS_LINE_CLASS_TYPE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>, tcltop.TS_LINE_CLASS_NAME <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TimesheetClass, pr_owner.RES_NAME <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ProjectOwner, <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(tr.RES_NAME, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CHARINDEX</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>, tr.RES_NAME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> Firstname, <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(tr.RES_NAME, <span class="hljs-keyword"><span class="hljs-keyword">CHARINDEX</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>, tr.RES_NAME) + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(tr.RES_NAME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> LastName, <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(tr.RES_NAME, <span class="hljs-keyword"><span class="hljs-keyword">CHARINDEX</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>, tr.RES_NAME) + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">LEN</span></span>(tr.RES_NAME)) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(tr.RES_NAME, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CHARINDEX</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>, tr.RES_NAME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ResourceName, t.MOD_DATE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ModifiedDate, tr.RES_UID <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ResourceNameUID, tr.ResourceCC, PCC.CostCenter, PT.ProjectType, PPS.ProjectStatus <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ProjectStatus, tla.TS_LINE_UID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_WEB_TIME_PERIODS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tpr <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RES_UID, RES_NAME, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> tr.ResourceCC = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> tr.ResourceCC = <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Only DC'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> tr.ResourceCC = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'Only NSK'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'DC &amp; NSK'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ResourceCC <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RES_UID, RES_NAME, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> tr.CostCenter <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> tr.CostCenter = <span class="hljs-string"><span class="hljs-string">'DC'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ResourceCC <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> tr.RES_UID, tr.RES_NAME, PCC.CostCenter <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_RESOURCES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tr <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_PROJECT_RESOURCES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pr <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pr.RES_UID = tr.RES_UID <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_PROJECTS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.PROJ_UID = pr.PROJ_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pspPrjCFV.PROJ_UID, psLV.LT_VALUE_TEXT <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CostCenter <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_PROJ_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspPrjCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pspPrjCFV.MD_PROP_UID = pspCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_LOOKUP_TABLE_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> psLV <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> psLV.LT_STRUCT_UID = pspPrjCFV.CODE_VALUE <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (pspCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'Cost_Center'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PCC <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> PCC.PROJ_UID = p.PROJ_UID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (tr.RES_TYPE = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> tr.RES_TYPE = <span class="hljs-number"><span class="hljs-number">102</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tr <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> RES_UID, RES_NAME) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tr) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tr <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_RESOURCES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> res.RES_UID = tr.RES_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_TIMESHEETS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t.WPRD_UID = tpr.WPRD_UID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> t.RES_UID = tr.RES_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_TIMESHEET_LINES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tl.TS_UID = t.TS_UID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tl.TS_LINE_ACT_SUM_VALUE &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_TIMESHEET_ACTUALS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tla <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tla.TS_LINE_UID = tl.TS_LINE_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_TIMESHEET_CLASSES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tcl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tcl.TS_LINE_CLASS_UID = tl.TS_LINE_CLASS_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TS_LINE_CLASS_UID, TS_LINE_CLASS_IS_EDITABLE, TS_LINE_CLASS_NAME, TS_LINE_CLASS_TYPE, TS_LINE_CLASS_NEED_APPROVAL, TS_LINE_CLASS_ORGANIZATION, TS_LINE_CLASS_DESC, TS_LINE_CLASS_IS_DISABLED, TS_LINE_CLASS_ALWAYS_DISPLAY, CREATED_DATE, MOD_DATE, CREATED_REV_COUNTER, MOD_REV_COUNTER <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_TIMESHEET_CLASSES <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (TS_LINE_CLASS_TYPE = <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tcltop <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tcltop.TS_LINE_CLASS_UID = tl.TS_LINE_CLASS_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> PROJ_UID, PROJ_NAME, WRES_UID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_PROJECTS <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'E38038FA-F8CA-47D1-BFD4-6B45B8462972'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> Expr1, <span class="hljs-string"><span class="hljs-string">'Administrative'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> Expr2, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> Expr3) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tp.PROJ_UID = tl.PROJ_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_TASKS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tsk <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tsk.TASK_UID = tl.TASK_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_RESOURCES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pr_owner <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pr_owner.RES_UID = tp.WRES_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ppResCFV.RES_UID, ppResCFV.TEXT_VALUE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> EmployeeID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_RES_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ppResCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ppCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ppResCFV.MD_PROP_UID = ppCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (ppCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'employeeID'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> E <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tr.RES_UID = E.RES_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ppResCFV.RES_UID, ppResCFV.TEXT_VALUE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> Location <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_RES_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ppResCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ppCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ppResCFV.MD_PROP_UID = ppCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (ppCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'co'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> C <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tr.RES_UID = C.RES_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pspPrjCFV.PROJ_UID, pspPrjCFV.TEXT_VALUE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ProjectAccount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_PROJ_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspPrjCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pspPrjCFV.MD_PROP_UID = pspCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (pspCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'Project Account'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PP <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> PP.PROJ_UID = tp.PROJ_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pspPrjCFV.PROJ_UID, psLV.LT_VALUE_TEXT <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CostCenter <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_PROJ_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspPrjCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pspPrjCFV.MD_PROP_UID = pspCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_LOOKUP_TABLE_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> psLV <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> psLV.LT_STRUCT_UID = pspPrjCFV.CODE_VALUE <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (pspCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'Cost_Center'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PCC <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> PCC.PROJ_UID = tp.PROJ_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pspPrjCFV.PROJ_UID, psLV.LT_VALUE_TEXT <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ProjectStatus <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_PROJ_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspPrjCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pspPrjCFV.MD_PROP_UID = pspCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_LOOKUP_TABLE_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> psLV <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> psLV.LT_STRUCT_UID = pspPrjCFV.CODE_VALUE <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (pspCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'Project Status'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PPS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> PPS.PROJ_UID = tp.PROJ_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pspPrjCFV.PROJ_UID, psLV.LT_VALUE_TEXT <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ProjectType <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_PROJ_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspPrjCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> pspCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pspPrjCFV.MD_PROP_UID = pspCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_LOOKUP_TABLE_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> psLV <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> psLV.LT_STRUCT_UID = pspPrjCFV.CODE_VALUE <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (pspCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'ProjectType'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> PT.PROJ_UID = tp.PROJ_UID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ppResCFV.RES_UID, ppResCFV.TEXT_VALUE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ResourceCompany <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pub.MSP_RES_CUSTOM_FIELD_VALUES <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ppResCFV <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pub.MSP_CUSTOM_FIELDS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ppCF <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ppResCFV.MD_PROP_UID = ppCF.MD_PROP_UID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (ppCF.MD_PROP_NAME = <span class="hljs-string"><span class="hljs-string">'Resource Company'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RC <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tr.RES_UID = RC.RES_UID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (tpr.WPRD_START_DATE &lt; <span class="hljs-keyword"><span class="hljs-keyword">GETDATE</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (tpr.WPRD_START_DATE &gt;= <span class="hljs-string"><span class="hljs-string">'12.01.2008'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> R_1 <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CUSTOM_RES_PROJ_ASSIGNMENTS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> T.RES_NAME = R_1.ResourceName <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> T.PROJ_NAME = R_1.ProjectName <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (T.EFFECTIVE_DATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATEDIFF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">day</span></span>, T.EFFECTIVE_DATE, R_1.TimeByDay) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> R_1.RES_HIRE_DATE, R_1.RES_TERMINATION_DATE, R_1.WRES_EMAIL, R_1.TODAY, R_1.IsActive, R_1.StartDate, R_1.EndDate, R_1.PeriodName, R_1.TimeByDay, R_1.TimeByDay_DayOfWeek, R_1.ActualWorkBillable, R_1.ProjectName, R_1.[Task <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>], R_1.Status, R_1.ProjectAccount, R_1.Location, R_1.ResourceCompany, R_1.EmployeeID, R_1.TS_LINE_CLASS_NAME, R_1.Type, R_1.TimesheetClass, R_1.ProjectOwner, R_1.Firstname, R_1.LastName, R_1.ResourceName, R_1.ModifiedDate, R_1.ResourceNameUID, R_1.ResourceCC, R_1.CostCenter, R_1.ProjectStatus, R_1.ProjectType, R_1.TS_LINE_UID, R_1.TS_LINE_CACHED_ASSIGN_NAME) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> R <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CUSTOM_RES_PROJ_ASSIGNMENTS <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> T.RES_NAME = R.ResourceName <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> T.PROJ_NAME = R.ProjectName <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (R.EFFECTIVE_DATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> T.EFFECTIVE_DATE = R.EFFECTIVE_DATE <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> R.EFFECTIVE_DATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> T.EFFECTIVE_DATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)</code> </pre></div></div><br>  Due to the remoteness of the server, we had to make a small SSIS package to ‚Äútransfer‚Äù the data to a temporary table.  After that, we made the resulting table a data source for our cube, added the necessary measurements and measure. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba9/b1e/6c1/ba9b1e6c10de014afd59b94e45904642.jpg"><br><br>  To ensure up-to-date, sql-jobs were created for data acquisition, and then cube processing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97d/f39/722/97df39722ab12cf56e04f1deda340477.jpg"><br><br>  Practice has shown that employees tend to forget that they need to fill in reports on time spent weekly.  To do this, we wrote a small SSIS package that performs an MDX request to the cube, identifies "forgetful" employees and sends a letter with a request to fill in the timesheet.  Moreover, if today is Friday, then the current week is checked, and if Monday, Tuesday or Wednesday, then the past. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/330/ea4/f85/330ea4f856f8a8e4363dd5028e23350f.jpg"><br><br>  We will separately dwell on the problem that has arisen with this package.  It consisted in the fact that the sql-job that executes this package "lives" in the GMT + 6 time zone.  Our American colleagues need to send a reminder on their Friday at 5:00 pm, and in Novosibirsk it is already 5:00 am Saturday (or 4:00 am, depending on the transfer of hours to the USA), and since the work week in Cuba begins on Saturday, all colleagues a letter came from the United States that the report was not completed.  The solution to this problem lies on the surface and consists of adding an additional condition to checking the current day of the week. <br><br><h5>  Result </h5><br><h5>  Here are some examples of some reports: </h5><br>  1. Report for the period for all employees.  Weekly, managers look through the sheets of all employees - they control the fact of filling in and the correctness of posting work on projects. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a51/31d/282/a5131d282ea846fd6ef4211418190565.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/27e/99f/8ff/27e99f8ff11a56cc9a4a514dc19a44f8.png"><br><br>  2. Project report.  After the end of the project, managers can analyze how the implementation went: what tasks were actually done, how much resources were spent on them, how much this corresponds to our initial plans for the project.  The same can be controlled in the course of the project. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/037/be0/3ca/037be03ca835881c83fd28b9e4b5453b.png"><br><br>  3. Report on the employee.  At any time, you can analyze the activities of a single project officer for the period of interest. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a86/751/195/a86751195c9feaedc256b03450e651cd.png"><br><br>  As a result: <br><br><ol><li>  All EastBanc employees fill out at least 40 hours, since we have a 40-hour week.  Fill on time! </li><li>  Employees fill in time protection boards correctly: holidays, sick-lists, holidays, projects on which they work, including internal ones, are spread out according to the necessary columns. </li><li>  Tasks on projects correspond to the plan, since  they are quite detailed.  There are no tasks for more than 16 hours to catch up on time when something goes wrong. </li><li>  Upon completion of each project, managers receive a detailed analysis. </li><li>  Each manager monitors their projects.  The picture as a whole is being monitored by the project office manager. </li></ol><br>  Now we have a very convenient enterprise-tool that the whole company uses every day.  It was possible to do everything by improving the existing standard Project Server tools for a very limited time, because  There was a task, not deviating and not inventing a bicycle, to quickly solve the problem of accounting for labor costs. </div><p>Source: <a href="https://habr.com/ru/post/211222/">https://habr.com/ru/post/211222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211210/index.html">Browser Development - Functional Level</a></li>
<li><a href="../211214/index.html">Cybersquatting in new zones will not be a problem</a></li>
<li><a href="../211216/index.html">iOS leaves your phone number hostage</a></li>
<li><a href="../211218/index.html">Replication of data from MySQL to MongoDB</a></li>
<li><a href="../211220/index.html">20 professions of the future</a></li>
<li><a href="../211224/index.html">From Google Play removed for alternative methods of receiving payments</a></li>
<li><a href="../211226/index.html">About text adventures - back to basics</a></li>
<li><a href="../211228/index.html">Google banned the application for payment through PayPal</a></li>
<li><a href="../211230/index.html">Want to know about cutting-edge Computer Science? Take part in a series of webinars from Innopolis University!</a></li>
<li><a href="../211232/index.html">GoDaddy changed the security policy after the event with a ‚ÄúTwitter account priced at $ 50,000‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>