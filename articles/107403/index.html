<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating GTK + Applications Using the Glade Environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is about building applications using the GTK + cross-platform library. Is it mainly focused on beginners? Therefore, some things are possibl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating GTK + Applications Using the Glade Environment</h1><div class="post__text post__text-html js-mediator-article">  This post is about building applications using the GTK + cross-platform library.  Is it mainly focused on beginners?  Therefore, some things are possible for many seem very simple and banal, but I tried to describe everything as much as possible, so that it was clear to everyone. <br><br>  A considerable advantage of this library is that it is free for commercial use.  There are not so many documents and really high-quality articles on working with GTK + on the Internet.  In many examples, the program interface is written in "pens", which is sometimes very inconvenient.  I myself came across this and quite often spent more time on properly positioning widgets (objects) on the form, in containers, rather than focusing on solving the problem. <br><br>  I will demonstrate how to very quickly create an interface for GTK + using the <a href="http://glade.gnome.org/">Glade</a> GUI application for visual creation and integrate it into your program.  Glade is neither a compiler nor a debugger.  It only allows you to describe the interface and present it in GladeXML XML format files. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The base interface for the GTK + library is the C language. But I will use C ++ in this example.  Accordingly, there will be small features, which I will tell you.  The Linux distribution I use is Ubuntu 10.04. <br><br>  The task will be as follows: write a small application consisting of a canvas, a side menu (choose what to draw on the canvas), the main menu and the status bar.  At the same time, the side menu and the canvas when resizing the entire application window should remain a constant size.  But the container in which the canvas is located can change its size depending on increasing / decreasing the size of the main window.  And if necessary, scroll bars should appear. <br><a name="habracut"></a><br>  The plan will be: <br><ul><li>  Installing and running Glade3 </li><li>  Create a graphical interface of our application in Glade3, placing the main widgets (objects) in the main window and containers, defining events (Singnals, signals) for widgets and their handler (Handler), i.e.  procedure in the code of our program, which will be called when this signal occurs </li><li>  We will write the program code: we integrate the XML file with the graphical interface, we will write handlers and some functionality for demonstration </li><li>  we test our application a little </li></ul><br><h4>  Installing and running Glade3 </h4><br>  It is assumed that you have GTK + dev-package already installed, if not, then you can do it through the console: <br><pre><code class="bash hljs">sudo aptitude install libgtk2.0-dev</code> </pre> <br>  You can install Glade through the Ubuntu Update Center or again using the console: <br><pre> <code class="bash hljs">sudo apt-get install glade-gnome</code> </pre> <br>  After installation, run through Applications - Programming - Glade Interface Designer <br>  Set all parameters as shown in the figure.  Version toolkit (Toolkit Version) select 2.16 <br><br><img src="https://habrastorage.org/storage/habraeffect/00/26/0026a7d90ecd22860fa24cf41aec2bc4.png" alt="image"><br><br>  On the left you can see a window with a set of various widgets.  Those who worked with Windows Forms, or in the Delphi development environment will quickly understand.  To the right are two menus: one shows the hierarchy of the widgets, and the second window the widget properties window. <br><br><h4>  GUI creation </h4><br>  Creating a graphical interface for your GTK + application begins with specifying the main form - the main window of the program.  We find in the left menu in the TopLevels section the Window widget. <br><br>  In the Properties window on the right, set the properties of this widget: <br>  Name: <i>topWindow</i> <br>  Windows position: <i>Center</i> <br>  Default Width: <i>500</i> <br>  Default Height: <i>320</i> <br><br><img src="https://habrastorage.org/storage/habraeffect/8e/2c/8e2c58fb24adf5cd68756ee6693a0140.png" alt="image"><br><br>  Go to the Signals tab (signal, event) and GtkObject looking for destroy, in the Handler column (handler) write <i>topWindow_destroy_cb</i> or select from the list.  This will be the name of the procedure that will process the destroy signal - closing the main form. <br><br><img src="https://habrastorage.org/storage/habraeffect/49/d8/49d81a2394ca4f8ddc6cb495948d52c9.png" alt="image"><br><br>  Next, we plan to have in our application the main menu, the main functional part (this is the canvas and the menu for selecting what to draw) and the status bar.  We take the Vertical Box widget container in the left menu in the Containers section and put it in our main form.  In the dialog that appears, select Number of Items: 3. This means that you can put 3 widgets in the container we create. <br><br>  We have 3 so-called cells or bays in the vbox1 container.  In the second (center) compartment we put the Frame (the Containers section of the widget menu).  We look at the tree of widgets on the right.  Inside frame1 widget will be two widgets: alignment1 and label1 - they can be removed.  At this, we will deviate a little and turn to the theory. <br><br>  Understanding how GTK + controls the size of widgets is very important for creating correct and efficient graphical interfaces.  This process is often called the approval process, consisting of two components (2 stages): the requested size and the allocated size. <br><br>  The request stage is a recursive question: ‚ÄúHow much space do you need?‚Äù.  The main window sets its child windows, the child windows sets it to its child windows and so on until all the widgets are answered throughout this hierarchy. <br><br>  There are 2 important points here: <br><ol><li>  Child widgets do not know anything about the size of parent widgets </li><li>  The size of the parent widgets depends on the size of the child widgets. </li></ol><br>  Now that the main window knows how much space is needed ideally, a decision is made about how much space will actually be available.  If a reasonable value has come to the request, it is the default.  But if the window size is set to manual (for example, using gtk_window_setdefault_size) or otherwise, the window discards the requested size and sets another. <br><br>  At the second stage (size allocation), a command from parent to child widget occurs: "Here you have some space, do everything to fit in it."  If the widget has more than one child widget, then the task of this stage is to properly divide the free space between the child widgets. <br><br>  Now go to the main part of our application.  Go to the widget menu and select Horizontal Panes in the Containers section and put it on frame1.  We need our left side to be a fixed size, the right one not.  Go back to the widget menu and look for the Scrolled Window there.  And we put first one, and then the second Scrolled Window in the left and right hpand1 compartment (Horizontal Panes).  On the left Scrolled Window, which is called scrolledwindow1, set the property (in the Common tab) Width reguest equal to <i>145</i> - this will mean the requested size (for the matching process).  You should also check that in the Packing tab, the Resize property of scrolledwindow1 is <i>No</i> , and that of scrolledwindow2 is <i>Yes</i> . <br>  From the Containers section, we first put the first ViewPort widget, and then the second one on both our scrolledwindow1 and scrolledwindow2, respectively. <br><br><img src="https://habrastorage.org/storage/habraeffect/28/64/2864a5277d0caf71d2cf24207aa65502.png" alt="image"><br><br>  Let's do our side menu.  Add to ViewPort1 Vertical Box with 3 compartments.  And in each compartment add Radio Button.  For each Radio Button, set the Expand No property so that they do not stretch as the size of the parent widget increases.  Also in the Common tab, you can set the Width and Height request then they will be the size that we specify, and not by default.  But in any case, they will change in size.  Let's change their properties in the General tab: <br>  Name respectively on <i>rbutRectangle</i> , <i>rbutEllipse</i> , <i>rbutTriangle</i> <br>  Label respectively on <i>Rectangle</i> , <i>Ellipse</i> , <i>Triangle</i> <br>  and for rbutEllipse and rbutTriangle, specify the Group <i>rbutRectangle property</i> using a special dialog. <br><br><img src="https://habrastorage.org/storage/habraeffect/80/cb/80cb384217cb86cbb962f4bdff2664ee.png" alt="image"><br><br>  It should turn out like this: <br><br><img src="https://habrastorage.org/storage/habraeffect/3b/3c/3b3c1f5dae0c62ef3d14eb7b77b886a1.png" alt="image"><br><br>  Now you need to register events for each Radio Button.  In the Signals tab, no difference for either the GroupChanged event, or for toggled (I will do for it), we write the handler <i>rbutton_toggled_cb</i> : <br><br><img src="https://habrastorage.org/storage/habraeffect/aa/d8/aad83d40db83c07c64a8ba033aa03a8d.png" alt="image"><br><br>  Now turn to the right side of our window.  Add a vertical container with two compartments to the ViewPort2.  In the top we put the usual Label, and in the bottom Drawing Area it will be a canvas.  In Label1, in the label property, we write <i>a 300 x 200 Canvas</i> .  Go to the Packing tab and set Expand to <i>No.</i> <br>  Now our canvas. <br>  Name: <i>drawingarea</i> <br>  Expend: <i>No</i> <br>  Width request: <i>300</i> <br>  Height request: <i>200</i> <br>  Event: put a tick <i>Exposure</i> <br><br>  In Signals, look for an expose-event and write or select from the list: <br>  <i>drawingarea_expose_event_cb</i> <br><br><img src="https://habrastorage.org/storage/habraeffect/25/38/25383ed765a85fb3ff645ee8a2e9704a.png" alt="image"><br><br>  Now we need to add a status bar (to the lowest bay) and a main menu (to the uppermost bay).  In the uppermost we put the Menu Bar (the Containers section of the widgets menu), In the lowermost section of the Status Bar (the Control and Display section of the widgets menu), to add it, a dialog will appear, select Number of Items: 1. <br><br><img src="https://habrastorage.org/storage/habraeffect/24/b3/24b3628b7798269c44dfa1f49adef560.png" alt="image"><br><br>  In menubar1 for our example, we leave only one menu item - exit from the program.  Accordingly, you can delete: menuitem2, menuitem3, menuitem4.  Then open the menuitem1, go to menu1 and delete everything except imagemenuitem5.  This is a Quit item.  You can click on it and see the property in the General tab of the properties window of the Stock Item property, in which <i>gtk-quit is</i> written.  There you can "play".  You can generally select Custom label and image and set everything yourself.  This is not so important.  For imagemenuitem5 in the Signals tab, we set the same signal for the activate signal (by clicking on the menu item) as for closing the form: <i>topWindow_destroy_cb</i> . <br><br>  This is how our interface should look like.  We save our project with the name mainForm.  The file will be called mainForm.glade <br><br><img src="https://habrastorage.org/storage/habraeffect/35/41/3541dd31762f8dd311848a140dcee540.png" alt="image"><br><br><h4>  Code of our program </h4><br>  Create a file Example1.cpp in the same folder where mainForm.glade was saved.  First I will give the whole code, and then I will explain some important points. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Example1.cpp */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cairo.h&gt; #include &lt;gtk/gtk.h&gt; #define UI_FILE "mainForm.glade" //   GtkBuilder *builder; GtkWidget *topWindow; GtkRadioButton *rbutRectangle, *rbutEllipse, *rbutTriangle; GtkDrawingArea *drawingarea; //    extern "C" void topWindow_destroy_cb (GtkObject *object, gpointer user_data); extern "C" gboolean drawingarea_expose_event_cb(GtkWidget *widget, GdkEventExpose *event, gpointer data); extern "C" void rbutton_toggled_cb (GtkObject *object); int main( int argc, char **argv ) { GError *error = NULL; //  GTK+ gtk_init( &amp;argc, &amp;argv ); //   GtkBuilder  builder = gtk_builder_new(); //     ,     Glade if( ! gtk_builder_add_from_file( builder, UI_FILE, &amp;error ) ) { g_warning( "%s", error-&gt;message ); g_free( error ); return( 1 ); } //        GladeXML topWindow = GTK_WIDGET(gtk_builder_get_object(builder, "topWindow")); rbutRectangle = GTK_RADIO_BUTTON(gtk_builder_get_object(builder, "rbutRectangle")); rbutEllipse = GTK_RADIO_BUTTON(gtk_builder_get_object(builder, "rbutEllipse")); rbutTriangle = GTK_RADIO_BUTTON(gtk_builder_get_object(builder, "rbutTriangle")); drawingarea = GTK_DRAWING_AREA(gtk_builder_get_object(builder, "drawingarea")); //       gtk_builder_connect_signals (builder, NULL); //   g_object_unref( G_OBJECT( builder ) ); //       gtk_widget_show( topWindow ); //     gtk_main(); return( 0 ); } //   void topWindow_destroy_cb (GtkObject *object, gpointer user_data) { //     gtk_main_quit(); } //   gboolean drawingarea_expose_event_cb(GtkWidget *widget, GdkEventExpose *event, gpointer data) { cairo_t *cr; cr = gdk_cairo_create (widget-&gt;window); cairo_set_line_width (cr, 7); cairo_set_source_rgb (cr, 0, 0, 0); //     if (gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(rbutRectangle))) { //   cairo_rectangle (cr, 20, 20, 200, 100); cairo_stroke_preserve(cr); cairo_set_source_rgb(cr, 0, 0.8, 0); } //     if (gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(rbutEllipse))) { //   cairo_arc(cr, 150, 100, 90, 0, 2 * 3.14); cairo_stroke_preserve(cr); cairo_set_source_rgb(cr, 0.8, 0, 0); } //     if (gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(rbutTriangle))) { //   cairo_set_line_cap(cr, CAIRO_LINE_CAP_ROUND); cairo_move_to (cr, 40, 40); cairo_line_to (cr, 200, 40); cairo_line_to (cr, 120, 160); cairo_line_to (cr, 40, 40); cairo_set_line_join(cr, CAIRO_LINE_JOIN_ROUND); cairo_stroke_preserve(cr); cairo_set_source_rgb(cr, 0.8, 0, 0.8); } cairo_fill(cr); cairo_destroy(cr); return FALSE; } void rbutton_toggled_cb (GtkObject *object) { //  drawingarea gtk_widget_queue_draw (GTK_WIDGET(drawingarea)); }</span></span></span></span></code> </pre><br><br>  We first declare those objects.  with whom we will work.  Then we start to prescribe signal handlers.  Because  we write in C ++, using extern "C", declare topWindow_destroy_cb, drawingarea_expose_event_cb, rbutton_toggled_cb external functions and indicate that they should be linked according to the binding order in C. GtkBuilder contains references to all objects from the description in Glade.  The gtk_builder_get_object function gets a reference to an object with the corresponding name from GtkBuilder (in this case from the builder).  The gtk_builder_connect_signals function serves to connect handler functions in the code with prescribed corresponding signal handlers in GladeXML.  This happens automatically.  It is important that the names in Glade and in the code match.  The application will compile normally, signals will not be processed simply, and if you run a program through the console, warning's will be displayed there that it is impossible to find a handler for such a signal. <br><br>  Also, because  we write in C ++ very often we have to use explicit type conversion.  for example <br><pre> <code class="cpp hljs">rbutRectangle = GTK_RADIO_BUTTON(gtk_builder_get_object(builder, <span class="hljs-string"><span class="hljs-string">"rbutRectangle"</span></span>));</code> </pre><br><br>  if we wrote in C, then we could do without the explicit ghost GTK_RADIO_BUTTON. <br><br>  In order to compile your program you need to use either an automatic build system (for example, CMake), or to prescribe a makefile yourself.  I will not dwell on this in detail.  And just give an example of the description of the makefile.  At the end of the post, the two most recent links concern the creation of a make file. <br><br><pre> <code class="bash hljs">CC=g++ LDLIBS=`pkg-config --libs gtk+-2.0 gmodule-2.0` CFLAGS=-Wall -g `pkg-config --cflags gtk+-2.0 gmodule-2.0` Example1: Example1.o $(CC) $(LDLIBS) Example1.o -o Example1 Example1.o: Example1.cpp $(CC) $(CFLAGS) -c Example1.cpp clean: rm -f Example1 rm -f *.o</code> </pre><br><br>  Compilation is done with the command: <br><pre> <code class="bash hljs">make</code> </pre> <br><br><h4>  A little testing of our program </h4><br><br>  Running ... <br><br><img src="https://habrastorage.org/storage/habraeffect/f1/c9/f1c9bae8d157891a71bef938483083fd.png" alt="image"><br><br>  ... and then resize the window <br><br><img src="https://habrastorage.org/storage/habraeffect/fb/3f/fb3f9e3900c868e626bfe6f75d5ad934.png" alt="image"><br><br>  As we can see, the side menu and the canvas did not stretch out and remained in the same dimensions, but the container in which the canvas is resized.  And moreover, all the free space that appeared with an increase in the size of the form went to him.  This is all because we have set Width reguest = <i>145</i> and resize <i>Yes</i> for scrolledwindow1.  Here is an example of the appearance of scroll bars as the main window has become smaller <br><br><img src="https://habrastorage.org/storage/habraeffect/17/bb/17bba9b4e0b2533c46fd46f56a9beb69.png" alt="image"><br><br>  And now I‚Äôll go to Glade3 and change the Expand property to Yes in label1.  The project does not need to be recompiled.  Simply save the mainForm file.  And here is the result: <br><br><img src="https://habrastorage.org/storage/habraeffect/1e/e9/1ee981d0128c1cd708d63a60b54764f6.png" alt="image"><br><br>  Why is that?  Canvas we have a fixed size.  And all the space that is obtained by increasing the main window is given to the label1 widget.  You can play around with this whole thing.  For example, setting Expand back to No and specifying the exact Height value, for example 70. And then there will again be a fixed size, but not by default, but one that you specify. <br><br>  On this this post ends.  If this topic is interesting, I have a desire to write more posts in this direction. <br><br>  A bit of theory is taken from <a href="http://tadeboro.blogspot.com/2009/09/glade3-tutorial-3-size-negotiation.html">Glade3 tutorial - Size negotiation</a> . <br>  I advise you to read: <a href="http://www.gtk.org/tutorial1.2/gtk_tut-4.html">Packing Widgets</a> , <a href="http://zetcode.com/tutorials/cairographicstutorial/">The Cairo graphics tutorial</a> , <a href="http://mrbook.org/tutorials/make/">Makefiles by example</a> , <a href="http://www.gnu.org/software/make/manual/make.html">GNU `make '</a> </div><p>Source: <a href="https://habr.com/ru/post/107403/">https://habr.com/ru/post/107403/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107396/index.html">We prohibit the use of known UserJS</a></li>
<li><a href="../107397/index.html">WeVi.ru - Web Videos</a></li>
<li><a href="../107398/index.html">Accounting for personal finances: fun and useful!</a></li>
<li><a href="../107400/index.html">Donetsk coffee-and-code - digest and announcement</a></li>
<li><a href="../107401/index.html">Answers to questions about Unity on desktops</a></li>
<li><a href="../107405/index.html">Official W3C HTML5 Test Results</a></li>
<li><a href="../107406/index.html">Nginx + CentOS 5.5 + aio</a></li>
<li><a href="../107409/index.html">Trying to open a business</a></li>
<li><a href="../107410/index.html">New groups, old groups, Facebook pages</a></li>
<li><a href="../107411/index.html">Schedule conference published Platform 2011</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>