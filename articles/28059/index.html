<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chat on rails</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will create an application on Ruby on Rails, aka Rails, aka RoP. ( Ruby on Rails, RoR, Rails ). For the sake of brevity, I will use the expre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chat on rails</h1><div class="post__text post__text-html js-mediator-article"> Today we will create an application on Ruby on Rails, aka Rails, aka RoP.  ( <em>Ruby on Rails, RoR, Rails</em> ).  For the sake of brevity, I will use the expressions ‚Äúrails,‚Äù ‚Äúrails,‚Äù or ‚Äúrohr.‚Äù <br><br>  The application will be slightly different from most examples for dummies, and will focus on the demonstration of Ajax libraries intergrated into the rails for dynamic page refresh and special effects.  What could be more visible for this than chat?  Is that stock quotes.  But we still do <a name="habracut"></a>  chat <br><br>  Although this is not a tutorial, but a demonstration of possibilities, you can easily repeat all this on your system.  All you need is a mysql server, and at least version 2.0 rails.  The only difference from the earlier ones, in the framework of this example, is the pattern suffixes (.rhtml in the first, .html.erb in the second). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I did this on Ubuntu Hardy 8.04, but this should work on any platform, in the case of windows, with obvious differences in the form of a separator in the paths. <br><br>  I regret to say that Habr administrators have not bothered to ensure the normal input of unshielded CTML and SGML code (and screened too: try to enter ‚Äúless‚Äù -! DOCTYPE ...), therefore all the code that needs to be entered into the project files , I bring in the form of pictures, so you have to interrupt the code manually, if you want to repeat it.  On the other hand, I promise that no file goes beyond the standard 80x25 terminal, so there is not much work to do.  Again, re-use is useful for mastering. <br><br>  Before you begin, I strongly recommend that you make sure that your mysql server creates databases in the default utf-8 encoding, and it also uses it when connecting from clients.  If not, you'll have to add the key to the mysqladmin command below.  Also, I don‚Äôt like to write ‚Äú-u root‚Äù with every mysql call, so in the <code>[client]</code> section of the <code>my.cnf</code> file, I have <code>user=root</code> . <br><br>  Let's start: <blockquote>  rails chat;  cd chat </blockquote><br><br>  Now the base: <blockquote>  mysqladmin create chat_development </blockquote><br><br>  In this mega-project, we will have a whole one table about two columns: a nickname, and a message.  You can create it with your hands, but we don‚Äôt love it with our hands, so we‚Äôll do it properly, through the migration of rails.  This will help us in the future. <blockquote>  script / generate migration create_conversation </blockquote><br>  In <b>db / migrate / 001_create_conversation.rb</b> after <code>def self_up</code> add: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc4/1c6/134/cc41c6134bd3704ab223305a54201290.png"><br><br>  Rails will add us the columns ‚Äúid‚Äù, ‚Äúcreated_at‚Äù and ‚Äúupdated_at‚Äù, and will automatically take care of their content.  We start the migration, and the table will be created: <blockquote>  rake db: migrate </blockquote><br><br>  For decency, you sometimes need to display something to the user in a browser.  Create a common <b>app / views / layouts / chat.html.erb template like</b> this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7a/f45/272/d7af4527275534c8d74de4e1b8658967.png"><br><br>  The most interesting place is the sentence <code>&lt;%= yield -%&gt;</code> , which actually displays the contents of a particular template.  We describe them later. <br><br>  Now the controller.  Like the entire application, it is extremely primitive.  Let's create <br>  <b>app / controllers / chat_controller.rb with</b> this content: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ed/864/a51/2ed864a514973dd00095b023c5cb4523.png"><br>  <code>Message.find</code> displays the last 30 messages (Select From), focusing on the "id".  For good it would be necessary for ‚Äúcreated_at‚Äù, but it was too painful to write laziness. <br><br>  <code>Message.create</code> message adds (Insert Into) as easy to understand. <br><br>  As part of this entertainment, we cannot afford the user management system, so we simply assign a digital nickname to visitors.  If he bothers them, they shake "New nickname", and we give them another. <br><br>  We need templates.  A template is a file that is named by default in the same way as a controller share.  In other words, after working out <code>def say</code> by default (and we like the defaults), the template <code>say.html.erb</code> will be called (in the old script - <code>say.rhtml</code> ).  Create a template directory for our only <code>chat</code> controller. <br><blockquote>  mkdir app / views / chat </blockquote><br><br>  The center of this project is the output template <b>app / views / chat / index.html.erb</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a3/e6d/ce1/5a3e6dce17c2b85ad168a70c0bbcd184.png"><br><br>  That is written by everyone!  Let's sort it in pieces. <br><br>  The fact that <code>:partial</code> is simply inserting a code fragment from another file, see below. <br><br>  <code>form_remote_tag</code> will create for us the usual CTML form, but with attachments in the form of Ajax calls from the prototype and script.aculo.us libraries, due to which we can not issue normal POST and not redraw the screen.  The main parameter of the call is <code>:update</code> , which tells us which element with which id in our page will receive the result of the action specified in <code>:action</code> .  The default controller is the same ‚Äúchat‚Äù. <br><br>  <code>link_to_remote</code> works much the same way, we use it to replace the nickname. <br><br>  <code>periodically_call_remote</code> is our shame.  Never do chats like this.  And do them with the help of a plug-in for mongrel (or another web server), which can provide server-push in case of new messages.  But since everything is very primitive, we simply reboot the div with the chat body.  Every 10 seconds (default, yes). <br><br>  A fragment (partial) is a piece of a template that can be used repeatedly, like a function call.  We will need to redraw the main window with the contents of the chat in different places, so create a fragment <b>app / views / chat / _conversation.html.erb</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e74/f1c/34e/e74f1c34eb609f7df869c276326a4d77.png"><br><br>  <em>UPD: at the request of local hackers, we literally added a couple of characters to this fragment, so that the malware would not insert the code into its replicas.</em> <br><br>  In the index template, we have already seen his call.  It is also called in the say template.  Create <b>app / views / chat / say.html.erb</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/567/d79/48b/567d7948b6ce2919c668ea79e7f323ed.png"><br><br>  When you press enter after filling out the form, the action <code>say</code> called.  Find in the controller code <code>def say</code> . <br><br>  And the last.  The latest versions of ro ‚Äã‚Äãhave implemented ways to protect against substituting the contents of forms within a session.  By default, they are included, but they will interfere with us, since we can throw out the session, and then submit the same form, using the Ajax.  Therefore, you need to fix <b>app / controllers / application.rb</b> .  Find there the line starting at <code>protect_from_forgery</code> and comment out.  Oktotorpom in the first position. <br><br>  The project is ready.  We start the server: <br><blockquote>  script / server </blockquote><br><br>  See what happened: <code><a href="http://localhost/"></a> localhost:3000/chat</code>  <code><a href="http://localhost/"></a> localhost:3000/chat</code> . <br><br>  What did we do?  The code is, as usual in such cases, a bloody mess of a scripting language, ERB, HTML, CSS, esquel, and javascript.  But thanks to the efforts of the developers, Rohr, according to the general opinion (with whom I fully agree), the architecture and tools of the rails enable us to make this mess still less bloody than usual, and write as much code as possible in the most aesthetically preferable language, on ruby.  SQL has come down to the ‚Äúid DESC‚Äù stub, and javascript to the prototype $ ('sentence') call so that we always return the focus to the input box.  The prototype (and the rail wrapper around it) allowed us to update the page fragments in the background, and the scriptkulos lights the input field with hellish yellow fire after sending a replica, and also creates the effect of a new nickname arriving. <br><br>  It would be very instructive to look at the page code.  You will see how much of the faddish code on js we were saved by the rails.  Try it yourself.  You should have something similar to what I got: <a href="http://chat.gde.to/chat">chat.gde.to/chat</a> .  Successes you on rails. <br><br>  <em>Disclaimer: This is not a translation or adaptation.</em>  <em>All text is original, all code was created specifically for this article.</em> </div><p>Source: <a href="https://habr.com/ru/post/28059/">https://habr.com/ru/post/28059/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280580/index.html">Ostro Pot - open source multi-cooker based on OS Ostro</a></li>
<li><a href="../280582/index.html">Register for the webinar "How to guarantee and simply protect the company from encrypters and hidden threats"</a></li>
<li><a href="../280584/index.html">Microsoft has confirmed rumors about the integration of the Linux subsystem in Windows 10</a></li>
<li><a href="../280586/index.html">Saving Fragment State (Fragment)</a></li>
<li><a href="../280588/index.html">How to fly free to Paris with a girl and get a development contract</a></li>
<li><a href="../280596/index.html">How I VK Mobile Challenge accepted</a></li>
<li><a href="../280598/index.html">Trends in the development of cloud data centers</a></li>
<li><a href="../280602/index.html">As we broke up mobile Lenta.ru to the speed of light</a></li>
<li><a href="../280604/index.html">Legend of international avos</a></li>
<li><a href="../280606/index.html">Collection and analysis of the logs of demons in Badoo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>