<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Let's look at Source-Query.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Source-Query Concept 
 Source-Query, used to display information about the server, it is also used to manage the server through RCON commands. Source-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Let's look at Source-Query.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e81/6e8/0f0/e816e80f094a4eb8a9750269d90ae2eb.png"><br>  <b>Source-Query Concept</b> <br>  Source-Query, used to display information about the server, it is also used to manage the server through RCON commands.  Source-Query has developed xPaw.  The servers use the ‚ÄúSource‚Äù protocol, so the ‚ÄúSource-Query‚Äù receives data about the server. <a name="habracut"></a><br><br>  <b>Data types</b> <br>  All server requests consist of five basic data types packed together in a data stream.  All types have a slightly inverse byte order. <br>  <b>Example</b> <br>  1. Byte 8 bit symbol or unsigned integer <br>  2. Short-16-bit integer <br>  3. Long 32 bit integer <br>  4. Floating 32 bit floating point <br>  5. Long-long- 64 bit integer unsigned <br>  String-byte variable-length field, encoded in "UTF-8", which are terminated by "0x00" <br><br>  <b>Protocol</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since "Source-Query" was created to receive and manage servers "Steam".  Steam uses a packet size of 1400 bytes + "IP / UDP" headers  If the request or response needs more data packets, then it launches packets with an additional header. <br><br>  <b>Supported Games</b> <br> <code>Counter-Strike 1.6 <br> Counter-Strike: Global Offensive <br> Team Fortress 2 <br> Left 4 Dead 2 <br> Rag Doll Kung Fu <br> The Ship <br> Garry's Mod <br> Nuclear Dawn <br> Dino D-Day <br> Arma 3 <br> Call of Duty: Modern Warfare 3 <br> Starbound <br> Space Engineers <br> Rust <br> Quake Live <br> ARK: Survival Evolved <br> Minecraft <br></code> <br>  The list of supported games is updated and expanded.  If you want to find out if Source-Query supports the game of your choice, simply add the game to Steam as a favorite, if Steam shows you information about the server, it is supported by Source-Query <br><br>  <b>Functions</b> <br><pre> <code class="php hljs">Connect( $Ip, $Port, $Timeout, $Engine )     Disconnect( )       Ping( )   GetInfo( )       GetPlayers( )       GetRules( )    (CVars)   SetRconPassword( $Password )  RCON ,     RCON ()  RCON ,     RCON () Rcon( $Command )  RCON     RCON   </code> </pre><br><br>  <b>Requirements</b> <br><br> <code><a href="https://secure.php.net/manual/en/book.gmp.php"></a> PHP (5.5  ) <br> 64-bit PHP   "GMP" (sudo apt-get install php5-gmp) "PHP-GMP" <br> -   UDP  <br></code> <br><br>  <b>Usage example</b> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../SourceQuery/bootstrap.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">xPaw</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>; <span class="hljs-comment"><span class="hljs-comment">// For the sake of this example Header( 'Content-Type: text/plain' ); Header( 'X-Content-Type-Options: nosniff' ); // Edit this -&gt; define( 'SQ_SERVER_ADDR', 'localhost' ); define( 'SQ_SERVER_PORT', 27015 ); define( 'SQ_TIMEOUT', 1 ); define( 'SQ_ENGINE', SourceQuery::SOURCE ); // Edit this &lt;- $Query = new SourceQuery( ); try { $Query-&gt;Connect( SQ_SERVER_ADDR, SQ_SERVER_PORT, SQ_TIMEOUT, SQ_ENGINE ); print_r( $Query-&gt;GetInfo( ) ); print_r( $Query-&gt;GetPlayers( ) ); print_r( $Query-&gt;GetRules( ) ); } catch( Exception $e ) { echo $e-&gt;getMessage( ); } finally { $Query-&gt;Disconnect( ); }</span></span></code> </pre><br>  <b>Sample page</b> <br><div class="spoiler">  <b class="spoiler_title">Sample page</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../SourceQuery/bootstrap.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">xPaw</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Edit this -&gt; define( 'SQ_SERVER_ADDR', 'localhost' ); define( 'SQ_SERVER_PORT', 27015 ); define( 'SQ_TIMEOUT', 3 ); define( 'SQ_ENGINE', SourceQuery::SOURCE ); // Edit this &lt;- $Timer = MicroTime( true ); $Query = new SourceQuery( ); $Info = Array( ); $Rules = Array( ); $Players = Array( ); try { $Query-&gt;Connect( SQ_SERVER_ADDR, SQ_SERVER_PORT, SQ_TIMEOUT, SQ_ENGINE ); //$Query-&gt;SetUseOldGetChallengeMethod( true ); // Use this when players/rules retrieval fails on games like Starbound $Info = $Query-&gt;GetInfo( ); $Players = $Query-&gt;GetPlayers( ); $Rules = $Query-&gt;GetRules( ); } catch( Exception $e ) { $Exception = $e; } finally { $Query-&gt;Disconnect( ); } $Timer = Number_Format( MicroTime( true ) - $Timer, 4, '.', '' ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Source Query PHP Library&lt;/title&gt; &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt; &lt;style type="text/css"&gt; .table { table-layout: fixed; border-top-color: #428BCA; } .table td { overflow-x: auto; } .table thead th { background-color: #428BCA; border-color: #428BCA !important; color: #FFF; } .info-column { width: 120px; } .frags-column { width: 80px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class="jumbotron"&gt; &lt;div class="container"&gt; &lt;h1&gt;Source Query PHP Library&lt;/h1&gt; &lt;p class="lead"&gt;This library was created to query game server which use the Source (Steamworks) query protocol.&lt;/p&gt; &lt;p&gt; &lt;a class="btn btn-large btn-primary" href="https://xpaw.me"&gt;Made by xPaw&lt;/a&gt; &lt;a class="btn btn-large btn-primary" href="https://github.com/xPaw/PHP-Source-Query"&gt;View on GitHub&lt;/a&gt; &lt;a class="btn btn-large btn-danger" href="https://github.com/xPaw/PHP-Source-Query/blob/master/LICENSE"&gt;LGPL v2.1&lt;/a&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="container"&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if( isset( $Exception ) ): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;div class="panel panel-primary"&gt; &lt;div class="panel-heading"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo Get_Class( $Exception ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> at line </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $Exception-&gt;getLine( ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/div&gt; &lt;p&gt;&lt;b&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo htmlspecialchars( $Exception-&gt;getMessage( ) ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/b&gt;&lt;/p&gt; &lt;p&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo nl2br( $e-&gt;getTraceAsString(), false ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/p&gt; &lt;/div&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> else: </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;div class="row"&gt; &lt;div class="col-sm-6"&gt; &lt;table class="table table-bordered table-striped"&gt; &lt;thead&gt; &lt;tr&gt; &lt;th class="info-column"&gt;Server Info&lt;/th&gt; &lt;th&gt;&lt;span class="label label-</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $Timer &gt; 1.0 ? 'danger' : 'success'; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $Timer; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">s&lt;/span&gt;&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if( Is_Array( $Info ) ): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> foreach( $Info as $InfoKey =&gt; $InfoValue ): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo htmlspecialchars( $InfoKey ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if( Is_Array( $InfoValue ) ) { echo "&lt;pre&gt;"; print_r( $InfoValue ); echo "&lt;/pre&gt;"; } else { if( $InfoValue === true ) { echo 'true'; } else if( $InfoValue === false ) { echo 'false'; } else { echo htmlspecialchars( $InfoValue ); } } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endforeach; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> else: </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td colspan="2"&gt;No information received&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endif; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;div class="col-sm-6"&gt; &lt;table class="table table-bordered table-striped"&gt; &lt;thead&gt; &lt;tr&gt; &lt;th&gt;Player &lt;span class="label label-info"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo count( $Players ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/span&gt;&lt;/th&gt; &lt;th class="frags-column"&gt;Frags&lt;/th&gt; &lt;th class="frags-column"&gt;Time&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if( !empty( $Players ) ): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> foreach( $Players as $Player ): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo htmlspecialchars( $Player[ 'Name' ] ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $Player[ 'Frags' ]; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $Player[ 'TimeF' ]; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endforeach; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> else: </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td colspan="3"&gt;No players received&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endif; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;div class="col-sm-12"&gt; &lt;table class="table table-bordered table-striped"&gt; &lt;thead&gt; &lt;tr&gt; &lt;th colspan="2"&gt;Rules &lt;span class="label label-info"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo count( $Rules ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/span&gt;&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if( Is_Array( $Rules ) ): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> foreach( $Rules as $Rule =&gt; $Value ): </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo htmlspecialchars( $Rule ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo htmlspecialchars( $Value ); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endforeach; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> else: </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td colspan="2"&gt;No rules received&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endif; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;/div&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endif; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;</span></span></code> </pre><br></div></div><br><br>  <b>Rcon usage example</b> <br><div class="spoiler">  <b class="spoiler_title">Rcon example</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../SourceQuery/bootstrap.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">xPaw</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>; <span class="hljs-comment"><span class="hljs-comment">// For the sake of this example Header( 'Content-Type: text/plain' ); Header( 'X-Content-Type-Options: nosniff' ); // Edit this -&gt; define( 'SQ_SERVER_ADDR', 'localhost' ); define( 'SQ_SERVER_PORT', 27015 ); define( 'SQ_TIMEOUT', 1 ); define( 'SQ_ENGINE', SourceQuery::SOURCE ); // Edit this &lt;- $Query = new SourceQuery( ); try { $Query-&gt;Connect( SQ_SERVER_ADDR, SQ_SERVER_PORT, SQ_TIMEOUT, SQ_ENGINE ); $Query-&gt;SetRconPassword( 'my_awesome_password' ); var_dump( $Query-&gt;Rcon( 'say hello' ) ); } catch( Exception $e ) { echo $e-&gt;getMessage( ); } finally { $Query-&gt;Disconnect( ); }</span></span></code> </pre><br></div></div><br>  <b>Sample page {2}</b> <br><div class="spoiler">  <b class="spoiler_title">Sample page {2}</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//   require __DIR__ . '/SourceQuery/SourceQuery.class.php'; // IP $ip = '31.135.208.99'; //   $port = 27203; //  $timeout = 1; //  $Query = new SourceQuery(); //   - .         try { $Query-&gt;Connect($ip, $port, $timeout, SourceQuery :: GOLDSOURCE); } catch(Exception $e) { //   ,     ,        ,   exit($e-&gt;getMessage()); } //        $info = $Query-&gt;GetInfo(); //        $players = $Query-&gt;GetPlayers(); //    $Query-&gt;Disconnect(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt; &lt;title&gt;   &lt;/title&gt; &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"&gt; &lt;/head&gt; &lt;body&gt; &lt;div class="container"&gt; &lt;div class="panel panel-default"&gt; &lt;div class="panel-heading"&gt; &lt;h3&gt;&lt;/h3&gt; &lt;/div&gt; &lt;div class="panel-body"&gt; &lt;table class="table table-bordered"&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if($info):</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;th&gt; &lt;/th&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $info['HostName']</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th&gt;  &lt;/th&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $ip . ':' . $port</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th&gt;&lt;/th&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $info['Map']</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th&gt; &lt;/th&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $info['Players']</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th&gt; &lt;/th&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $info['MaxPlayers']</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> else:</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;th&gt;  .   &lt;/th&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endif;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/table&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="panel panel-default"&gt; &lt;div class="panel-heading"&gt; &lt;h3&gt;&lt;/h3&gt; &lt;/div&gt; &lt;div class="panel-body"&gt; &lt;table class="table table-bordered table-condenced"&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> if($players):</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;thead&gt; &lt;tr&gt; &lt;th&gt;&lt;/th&gt; &lt;th&gt;&lt;/th&gt; &lt;th&gt;&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> foreach($players as $player):</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo htmlspecialchars($player['Name'], ENT_QUOTES)</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo intval($player['Frags'])</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $player['TimeF']</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endforeach;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/tbody&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> else:</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt;&lt;td&gt; &lt;/td&gt;&lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> endif;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/table&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;</span></span></code> </pre><br></div></div><br>  <b>Teamspeak</b> <br><br>  You can also use Source-Query for your own purposes.  You can display information about the server, as in the header of the publication, the banner will be updated every 30 seconds.  after displaying the server information. <br><br>  <b>Example for "TeamSpeak"</b> <br><br><div class="spoiler">  <b class="spoiler_title">TS Example for TS</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'libraries/TeamSpeak3/TeamSpeak3.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'libraries/SourceQuery/bootstrap.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">xPaw</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>\<span class="hljs-title"><span class="hljs-title">SourceQuery</span></span>; $replacer = [ <span class="hljs-string"><span class="hljs-string">"ts3"</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">"%status%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_status"</span></span>, <span class="hljs-string"><span class="hljs-string">"%sid%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"%sport%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_port"</span></span>, <span class="hljs-string"><span class="hljs-string">"%platform%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_platform"</span></span>, <span class="hljs-string"><span class="hljs-string">"%servername%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"%serverversion%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_version"</span></span>, <span class="hljs-string"><span class="hljs-string">"%maxclients%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_maxclients"</span></span>, <span class="hljs-string"><span class="hljs-string">"%clientsonline%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_clientsonline"</span></span>, <span class="hljs-string"><span class="hljs-string">"%channelcount%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_channelsonline"</span></span>, <span class="hljs-string"><span class="hljs-string">"%packetloss%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_total_packetloss_total"</span></span>, <span class="hljs-string"><span class="hljs-string">"%ping%"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"virtualserver_total_ping"</span></span> ] ]; $package = [ <span class="hljs-string"><span class="hljs-string">'general'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'static'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'%timeHi%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%timeHis%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%date%'</span></span> ] ], <span class="hljs-string"><span class="hljs-string">'ts3'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'static'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'%status%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%sid%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%sport%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%platform%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%servername%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%serverversion%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%packetloss_floored%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%ping_floored%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%packetloss_00%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%maxclients%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%clientsonline%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%channelcount%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%packetloss%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%ping%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%realclients%'</span></span>, <span class="hljs-string"><span class="hljs-string">'%nickname%'</span></span> ], <span class="hljs-string"><span class="hljs-string">'regex'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">"%groupcount\[([0-9,]{0,})\]%"</span></span>, ], ], ]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_CLIENT_IP'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_CLIENT_IP'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_FORWARDED_FOR'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_FORWARDED_FOR'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_FORWARDED'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_FORWARDED'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'REMOTE_ADDR'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_SERVER[<span class="hljs-string"><span class="hljs-string">'REMOTE_ADDR'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paintText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($image, $fontsize, $xpos, $ypos, $color, $fontfile, $text)</span></span></span><span class="hljs-function"> </span></span>{ $hex = str_replace(<span class="hljs-string"><span class="hljs-string">"#"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, $color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(strlen($hex) == <span class="hljs-number"><span class="hljs-number">3</span></span>) { $r = hexdec(substr($hex,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>).substr($hex,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)); $g = hexdec(substr($hex,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>).substr($hex,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)); $b = hexdec(substr($hex,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>).substr($hex,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $r = hexdec(substr($hex,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)); $g = hexdec(substr($hex,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)); $b = hexdec(substr($hex,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)); } imagettftext($image,$fontsize,<span class="hljs-number"><span class="hljs-number">0</span></span>,$xpos,$ypos,imagecolorallocate($image, $r, $g, $b),$fontfile,$text); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $config; $packetmanager = json_decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">'cache/packages.json'</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>); $image = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">'cache/cached_img'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array(<span class="hljs-string"><span class="hljs-string">'ts3'</span></span>, $packetmanager[<span class="hljs-string"><span class="hljs-string">'packages'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'cache/clients.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($nicklist[getIp()])) { $nickname = $nicklist[getIp()]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($config[<span class="hljs-string"><span class="hljs-string">'textfield'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $field) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strpos($field[<span class="hljs-string"><span class="hljs-string">'text'</span></span>], <span class="hljs-string"><span class="hljs-string">'%nickname%'</span></span>) !== <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) { paintText($image, $field[<span class="hljs-string"><span class="hljs-string">'fontsize'</span></span>], $field[<span class="hljs-string"><span class="hljs-string">'xpos'</span></span>], $field[<span class="hljs-string"><span class="hljs-string">'ypos'</span></span>], $field[<span class="hljs-string"><span class="hljs-string">'color'</span></span>], $field[<span class="hljs-string"><span class="hljs-string">'fontfile'</span></span>], str_replace(<span class="hljs-string"><span class="hljs-string">'%nickname%'</span></span>, $nickname, $field[<span class="hljs-string"><span class="hljs-string">'text'</span></span>])); } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!function_exists(<span class="hljs-string"><span class="hljs-string">'imagettftext'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> (<span class="hljs-string"><span class="hljs-string">'PHP-GD not installed'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_writable(<span class="hljs-string"><span class="hljs-string">'cache/'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> (<span class="hljs-string"><span class="hljs-string">'    \'cache/\'  '</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists(<span class="hljs-string"><span class="hljs-string">'config.php'</span></span> )) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> (<span class="hljs-string"><span class="hljs-string">'config.php does not exist'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'config.php'</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists(<span class="hljs-string"><span class="hljs-string">'cache/packages.json'</span></span>) || filemtime(<span class="hljs-string"><span class="hljs-string">'cache/packages.json'</span></span>) &lt; filemtime(<span class="hljs-string"><span class="hljs-string">'config.php'</span></span>)) { $packages = []; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($config[<span class="hljs-string"><span class="hljs-string">'sourcequery'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $config[<span class="hljs-string"><span class="hljs-string">'sqenable'</span></span>]) $packages[] = <span class="hljs-string"><span class="hljs-string">'sq'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($config[<span class="hljs-string"><span class="hljs-string">'textfield'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $txt) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($package <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $pkg) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists(<span class="hljs-string"><span class="hljs-string">'static'</span></span>, $pkg)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($pkg[<span class="hljs-string"><span class="hljs-string">'static'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $static) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strpos($txt[<span class="hljs-string"><span class="hljs-string">'text'</span></span>], $static) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> !in_array($key, $packages)) $packages[] = $key; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists(<span class="hljs-string"><span class="hljs-string">'regex'</span></span>, $pkg)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($pkg[<span class="hljs-string"><span class="hljs-string">'regex'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $regex) { preg_match_all(<span class="hljs-string"><span class="hljs-string">'/'</span></span>.$regex.<span class="hljs-string"><span class="hljs-string">'/i'</span></span>, $txt[<span class="hljs-string"><span class="hljs-string">'text'</span></span>], $out); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($out[<span class="hljs-number"><span class="hljs-number">0</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> !in_array($key, $packages)) { $packages[] = $key; } } } } } $packagefile = fopen(<span class="hljs-string"><span class="hljs-string">'cache/packages.json'</span></span>, <span class="hljs-string"><span class="hljs-string">'w+'</span></span>); fwrite($packagefile, json_encode([<span class="hljs-string"><span class="hljs-string">'packages'</span></span> =&gt; $packages],<span class="hljs-number"><span class="hljs-number">1</span></span>)); fclose($packagefile); } $packetmanager = json_decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">'cache/packages.json'</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ( file_exists(<span class="hljs-string"><span class="hljs-string">'cache/cached_img'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> filemtime(<span class="hljs-string"><span class="hljs-string">'cache/cached_img'</span></span>) &gt; (time() - $config[<span class="hljs-string"><span class="hljs-string">'syncintervall'</span></span>]) <span class="hljs-comment"><span class="hljs-comment">//and strpos('TeamSpeak3', $_SERVER['HTTP_USER_AGENT']) !== FALSE ) || ( file_exists('cache/cache.lock') ) ){ $i = 0; while (file_exists('cache/cache.lock')) { if ($i &gt;= 10) throw new Exception ('Cache Lock exists... Please Remove the File \'cache.lock\' in Folder \'cache\' manually if it still exists after this Error!'); $i++; sleep(1); } header('Content-Type: image/png'); imagepng(getImage()); die(); } fclose(fopen("cache/cache.lock", "w+")); if (!file_exists($config['backgroundimage'])) throw new Exception ('Error! Background Image not found! Check your config! Searched at '.$config['backgroundimage']); $image = imagecreatefrompng($config['backgroundimage']); if (in_array('ts3', $packetmanager['packages'])) { try { $ts3 = TeamSpeak3::factory( "serverquery://". $config['teamspeak']['loginname'] .":". $config['teamspeak']['loginpass'] ."@". $config['teamspeak']['ip'] .":". $config['teamspeak']['queryport'] ."/?server_port=". $config['teamspeak']['serverport'] ."&amp;nickname=Banner%20Generator" ); } catch (Exception $e) { if (!strpos('TeamSpeak3-ImageFetcher', $_SERVER['HTTP_USER_AGENT'])) throw $e; $i = 0; while (file_exists('cache/cache.lock')) { if ($i &gt;= 10) throw new Exception ('Cache Lock exists... Please Remove the File \'cache.lock\' in Folder \'cache\' manually if it still exists after this Error!'); $i++; sleep(1); } header('Content-Type: image/png'); imagepng(getImage()); die(); } $groupcount = []; $serverinfo = $ts3-&gt;getInfo(); $clients = $ts3-&gt;clientList(['client_type' =&gt; 0]); foreach ($clients as $client) { $ts3clients[htmlentities($client-&gt;connection_client_ip)] = htmlentities($client-&gt;client_nickname); } $clientcache = fopen('cache/clients.php', 'w+'); fwrite($clientcache, '</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> $nicklist = json_decode(\''.str_replace("'", "\'", json_encode($ts3clients, 1)).'\',1);'); fclose($clientcache); } if (in_array('sq', $packetmanager['packages'])) { $sqinfo = []; foreach ($config['sourcequery'] as $server =&gt; $conf) { try { $sq = new SourceQuery(); $sq-&gt;Connect($conf['ip'], $conf['port'], $conf['timeout'], SourceQuery::SOURCE); $y = 12; foreach ($sq-&gt;GetInfo() as $key =&gt; $value) { $sqinfo[$server][$key] = $value; if ($conf['debug']) { $color = imagecolorallocate($image, 255, 0, 0); imagettftext($image, 9, 0, 4, $y, $color, $config['sqlistfont'], 'Use "%sqinfo['.$server.']['.$key.']%" in Textfield to Display "'.$value.'"'); $y = $y + 11; } } $sq-&gt;Disconnect(); } catch (Exception $e) { $color = imagecolorallocate($image, 255, 0, 0); imagettftext($image, 11, 0, 4, 15, $color, $config['sqlistfont'], 'SourceQuery Error on Server "'.$server.'":'.$e-&gt;getMessage() ); } } } foreach ($config['textfield'] as $field) { if (!file_exists($field['fontfile'])) throw new Exception ('Font File not found! Searched at '.$field['fontfile'].PHP_EOL.'You may need to set the absolute path (from root directory /var/www/...)'); if (strpos($field['text'], '%nickname%') !== FALSE) continue; if (in_array('sq', $packetmanager['packages'])) { $field['text'] = preg_replace_callback('/\%sqinfo\[(.*?)\]\[(.*?)\]\%/', function($matches) { global $sqinfo; return $sqinfo[$matches[1]][$matches[2]]; }, $field['text']); } if (in_array('ts3', $packetmanager['packages'])) { foreach ($replacer['ts3'] as $k =&gt; $v) { $field['text'] = str_replace($k, $serverinfo[$v], $field['text']); } $field['text'] = preg_replace_callback('/\%groupcount\[([0-9,]{0,})\]\%/', function($match) { global $ts3; $count = 0; $groups = explode(',',$match[1]); foreach ($ts3-&gt;clientList(['client_type' =&gt; 0]) as $client) { foreach (explode(',',$client-&gt;client_servergroups) as $g) { if (in_array($g,$groups)) { $count++; break; } } } return $count; }, $field['text']); foreach ($groupcount as $k =&gt; $v) { $field['text'] = str_replace($k, $groupcount[$k], $field['text']); } $field['text'] = str_replace('%realclients%', $serverinfo['virtualserver_clientsonline']-$serverinfo['virtualserver_queryclientsonline'], $field['text']); $field['text'] = str_replace('%ping_floored%', floor(htmlentities($serverinfo['virtualserver_total_ping'])), $field['text']); $field['text'] = str_replace('%packetloss_00%', round(htmlentities($serverinfo['virtualserver_total_packetloss_total']), 2, PHP_ROUND_HALF_DOWN), $field['text']); $field['text'] = str_replace('%packetloss_floored%', floor(htmlentities($serverinfo['virtualserver_total_packetloss_total'])), $field['text']); } $field['text'] = str_replace('%timeHi%', date("H:i"), $field['text']); $field['text'] = str_replace('%timeHis%', date("H:i:s"), $field['text']); $field['text'] = str_replace('%date%', date("dmY"), $field['text']); paintText($image, $field['fontsize'], $field['xpos'], $field['ypos'], $field['color'], $field['fontfile'], $field['text']); } imagepng($image, 'cache/cached_img'); unlink('cache/cache.lock'); header('Content-Type: image/png'); imagepng(getImage()); imagedestroy($image); } catch (Exception $e) { echo $e-&gt;getMessage(); if (file_exists('cache/cache.lock')) unlink('cache/cache.lock'); }</span></span></code> </pre><br>  <b>As well as config</b> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $config = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'textfield'</span></span> =&gt; [], <span class="hljs-string"><span class="hljs-string">'sourcequery'</span></span> =&gt; []); <span class="hljs-comment"><span class="hljs-comment">/* ** Teamspeak Configurations */</span></span> <span class="hljs-comment"><span class="hljs-comment">//Teamspeak Connection IP $config['teamspeak']['ip'] = '192.168.0.3'; //Teamspeak Query Port $config['teamspeak']['queryport'] = '10011'; //Teamspeak Connection/Voice Port $config['teamspeak']['serverport'] = '9987'; //Teamspeak Query Login Name $config['teamspeak']['loginname'] = 'serveradmin'; //Teamspeak Query Password $config['teamspeak']['loginpass'] = 'cgixTVmy'; //Background Image to use $config['backgroundimage'] = 'banner-layout.png'; //Refresh Intervall for the Image Generator in seconds $config['syncintervall'] = 60; //Source Query //  SourceQuery $config['sqenable'] = true; //         $config['sqlistfont'] = 'font/arial.ttf'; /* /* $config['sourcequery']['server1'] = [ // 'ip' =&gt; '192.168.0.3', // 'port' =&gt; '27015', // 'timeout' =&gt; 1, // 'debug' =&gt; true, ]; */ // Source Query /* $config['textfield'][] = [ 'text' =&gt; '', 'xpos' =&gt; '', 'ypos' =&gt; '', 'fontsize' =&gt; '', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '', ]; */ $config['textfield'][] = [ 'text' =&gt; '%channelcount%', 'xpos' =&gt; '595', 'ypos' =&gt; '230', 'fontsize' =&gt; '22', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#1C86EE', ]; $config['textfield'][] = [ 'text' =&gt; '%date%', 'xpos' =&gt; '570', 'ypos' =&gt; '320', 'fontsize' =&gt; '16', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#CD2626', ]; $config['textfield'][] = [ 'text' =&gt; '%clientsonline%/%maxclients%', 'xpos' =&gt; '570', 'ypos' =&gt; '65', 'fontsize' =&gt; '22', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#1C86EE', ]; $config['textfield'][] = [ 'text' =&gt; '%timeHi%', 'xpos' =&gt; '590', 'ypos' =&gt; '295', 'fontsize' =&gt; '16', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#CD2626', ]; $config['textfield'][] = [ 'text' =&gt; '%groupcount[9,203,204,79,102,111]%', 'xpos' =&gt; '610', 'ypos' =&gt; '150', 'fontsize' =&gt; '22', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#CD2626', ]; /*       */ $config['textfield'][] = [ 'text' =&gt; ' %nickname% &lt;3', 'xpos' =&gt; '100', 'ypos' =&gt; '430', 'fontsize' =&gt; '24', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#e74c3c', ]; /*   SourceQuery      ARMA III */ /* $config['textfield'][] = [ 'text' =&gt; 'SourceQuery Slots:', 'xpos' =&gt; '150', 'ypos' =&gt; '350', 'fontsize' =&gt; '24', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#ecf0f1', ]; $config['textfield'][] = [ 'text' =&gt; '%sqinfo[server1][Players]%/%sqinfo[server1][MaxPlayers]%', 'xpos' =&gt; '220', 'ypos' =&gt; '400', 'fontsize' =&gt; '24', 'fontfile' =&gt; 'font/bank.ttf', 'color' =&gt; '#ecf0f1', ]; */</span></span></code> </pre><br></div></div><br><br>  <b>Conclusion</b> <br>  These were examples of the use of Source-Query, but can you think of another purpose for them?  Thank you all, I hope you liked it, ask questions. <br><img src="https://habrastorage.org/files/485/058/de0/485058de0c2446bbb811b90edef5fb36"><br>  <a href="https://developer.valvesoftware.com/wiki/Server_queries">protocol data</a> </div><p>Source: <a href="https://habr.com/ru/post/303172/">https://habr.com/ru/post/303172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303160/index.html">10 rules that allow NASA to write millions of lines of code with minimal errors</a></li>
<li><a href="../303162/index.html">On the implementation of persistent processes in real-time control systems (part 1)</a></li>
<li><a href="../303164/index.html">Renewal of the old code or how to do well to an application that is bad</a></li>
<li><a href="../303166/index.html">Debriefing or how to clean up the state</a></li>
<li><a href="../303168/index.html">API hh.ru. Fast start</a></li>
<li><a href="../303174/index.html">How to call css-classes</a></li>
<li><a href="../303178/index.html">JS Programming Contest: Word Classifier (Preliminary Results)</a></li>
<li><a href="../303182/index.html">School of Data "Beeline", without a break for the summer</a></li>
<li><a href="../303186/index.html">jQuery UI Datepicker - adding the ability to select multiple dates on one calendar</a></li>
<li><a href="../303188/index.html">Computer science professor "hired" IBM Watson as his assistant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>