<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BindableConverter for WPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problem: WPF cool technology, but sometimes unfinished. For example, I‚Äôll spit out such code that I don‚Äôt remember exactly what Exception is, since Co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BindableConverter for WPF</h1><div class="post__text post__text-html js-mediator-article">  <b>Problem:</b> WPF cool technology, but sometimes unfinished.  For example, I‚Äôll spit out such code that I don‚Äôt remember exactly what Exception is, since ConverterParameter is not a successor of DependencyObject: <br><br><pre><code class="cs hljs">&lt;...Text={Binding SourceProperty, Converter={StaticResource SomethingToSomethingElseConverter} ConverterParameter={Binding AnotherSourceProperty}} /&gt;</code> </pre> <br>  Actually, this is a problem.  And below is her decision. <br><a name="habracut"></a><br>  <b>Update from 01/18/16:</b> <br>  <i>1) If the base class of the converter is inherited from Freezable, then the proxy is simply not needed.</i>  <i>In this case, the converter works exactly as usual would work:</i> <i><br></i> <pre> <i><code class="cs hljs">&lt;-.Resources&gt; &lt;converters:-_ x:Key=<span class="hljs-string"><span class="hljs-string">"-_"</span></span> BindingParameter1=<span class="hljs-string"><span class="hljs-string">"{Binding -_}"</span></span> /&gt; &lt;/-.Resources&gt;</code></i> </pre> <i><br></i>  <i>... please keep this in mind when reading!</i> <br><br>  In principle, the problem can be solved in two ways: the first DependencyProperty.Register (..), the second - .RegisterAttached (..).  The difference is that the second option is both conceptually and architecturally flawed.  Therefore, like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Globalization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Data; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">BindableConverter</span></span> { [ValueConversion(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BindableConverterBase</span></span> : <span class="hljs-title"><span class="hljs-title">DependencyObject</span></span>, <span class="hljs-title"><span class="hljs-title">IValueConverter</span></span>, <span class="hljs-title"><span class="hljs-title">IMultiValueConverter</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> BindableParameters #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> BindableParameter1 public object BindableParameter1 { get { return GetValue(BindableParameter1Property); } set { SetValue(BindableParameter1Property, value); } } public static readonly DependencyProperty BindableParameter1Property = DependencyProperty.Register( nameof(BindableParameter1), typeof(object), typeof(BindableConverterBase), new PropertyMetadata(String.Empty) ); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> BindableParameter2 public object BindableParameter2 { get { return GetValue(BindableParameter2Property); } set { SetValue(BindableParameter2Property, value); } } public static readonly DependencyProperty BindableParameter2Property = DependencyProperty.Register( nameof(BindableParameter2), typeof(object), typeof(BindableConverterBase), new PropertyMetadata(String.Empty) ); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> BindableParameter3 public object BindableParameter3 { get { return GetValue(BindableParameter3Property); } set { SetValue(BindableParameter3Property, value); } } public static readonly DependencyProperty BindableParameter3Property = DependencyProperty.Register( nameof(BindableParameter3), typeof(object), typeof(BindableConverterBase), new PropertyMetadata(String.Empty) ); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> IValueConverter public virtual object Convert(object value, Type targetType, object parameter, CultureInfo culture) { throw new NotImplementedException(); } public virtual object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture) { throw new NotImplementedException(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> IMultiValueConverter public virtual object Convert(object[] values, Type targetType, object parameter, CultureInfo culture) { throw new NotImplementedException(); } public virtual object[] ConvertBack(object value, Type[] targetTypes, object parameter, CultureInfo culture) { throw new NotImplementedException(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br><br>  Since the class has implemented both interfaces, it will work with ordinary Binding and MultiBinding.  Actually, it remains only to inherit from BindableConverter, overriding the right (or necessary, which is rare) methods. <br><br>  <b><u>There is one crucial point to use in XAML.</u></b>  <b><u>Naive attempt type:</u></b> <br><pre> <code class="cs hljs">&lt;Window.Resources&gt; &lt;local:NameAndAgeToVladimirPutinConverter x:Key=<span class="hljs-string"><span class="hljs-string">"NameAndAgeToVladimirPutin"</span></span> BindableParameter1=<span class="hljs-string"><span class="hljs-string">"{Binding FirstName}"</span></span> BindableParameter2=<span class="hljs-string"><span class="hljs-string">"{Binding Age}"</span></span> /&gt; &lt;/Window.Resources&gt;</code> </pre><br>  ... will result in both parameters being equal to the default value.  Always - no matter where exactly in the resources you declare a link to the converter. <br><br>  I confess, I don‚Äôt have a final understanding of why this is happening.  In general terms, the point is that the converter is out of Logical \ VisualTree UI-elements, so there is simply no one to attach to it.  Anyway, this is the explanation I unearthed at StackOverflow.  The solution to the problem looks like this: <br><br><pre> <code class="cs hljs">&lt;bc:BindingProxy x:Key=<span class="hljs-string"><span class="hljs-string">"BindingProxy"</span></span> Data=<span class="hljs-string"><span class="hljs-string">"{Binding}"</span></span> /&gt; &lt;local:NameAndAgeToVladimirPutinConverter x:Key=<span class="hljs-string"><span class="hljs-string">"NameAndAgeToVladimirPutin"</span></span> BindableParameter1=<span class="hljs-string"><span class="hljs-string">"{Binding Source={StaticResource BindingProxy}, Path=Data.FirstName}"</span></span> BindableParameter2=<span class="hljs-string"><span class="hljs-string">"{Binding Source={StaticResource BindingProxy}, Path=Data.Age}"</span></span>/&gt; ... &lt;TextBlock Grid.Row=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"{Binding Name, Converter={StaticResource NameAndAgeToVladimirPutin}}"</span></span> /&gt;</code> </pre><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">BindableConverter</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BindingProxy</span></span> : <span class="hljs-title"><span class="hljs-title">Freezable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Freezable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateInstanceCore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BindingProxy(); } <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Binding data. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public object Data { get { return GetValue(DataProperty); } set { SetValue(DataProperty, value); } } public static readonly DependencyProperty DataProperty = DependencyProperty.Register( nameof(Data), typeof(object), typeof(BindingProxy), new UIPropertyMetadata(null) ); } }</span></span></code> </pre><br><br>  PS There are plans to screw MarkupExtension so that you can get something like Converter = {bc: BindableConverter BindingProxy = {StaticResource Proxy}, Parameter1 = FirstName, Parameter2 = Age}.  If someone has an idea how to do it even more beautiful and concise, then please. <br><br>  Also very relevant is the question of why all the same without BindingProxy does not work. </div><p>Source: <a href="https://habr.com/ru/post/275223/">https://habr.com/ru/post/275223/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275207/index.html">VR and AR Digest: December</a></li>
<li><a href="../275211/index.html">Google Cloud Storage with Java: images and other files in the clouds</a></li>
<li><a href="../275215/index.html">How to start working with MIPSfpga</a></li>
<li><a href="../275217/index.html">A few stories about good customer support or how to create the best service in the world.</a></li>
<li><a href="../275219/index.html">How to make a contribution to the Open Source project: simple tips</a></li>
<li><a href="../275225/index.html">Application Configuration with github</a></li>
<li><a href="../275227/index.html">How to ReactJS</a></li>
<li><a href="../275229/index.html">Translation: full stack developer is a myth</a></li>
<li><a href="../275231/index.html">Your design sucks</a></li>
<li><a href="../275233/index.html">Nutanix OEM Partners: Dell and Lenovo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>