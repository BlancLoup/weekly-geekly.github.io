<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Eratosthenes Magic Sieve</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surely everyone who reads this post is not just used, or at least heard about the sieve of Eratosthenes - the method of finding prime numbers. The ver...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Eratosthenes Magic Sieve</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ac1/168/ff7/ac1168ff7ce8760b19591c2950dd357d.jpg" alt="image" align="left"><br>  Surely everyone who reads this post is not just used, or at least heard about the sieve of Eratosthenes - the method of finding prime numbers.  The very problem of obtaining prime numbers occupies a key place in mathematics; some cryptographic algorithms, such as RSA, are based on it.  There are quite a few approaches to this problem, but in this article I will focus on some modifications of the simplest of them - the sieve of Eratosthenes. <a name="habracut"></a><br>  The sieve principle is simple: let us need to find simple numbers in the interval from one to some <b>N &lt;= 10 ^ 6</b> .  We get an array of N elements and fill it with true.  Then we consistently go through it to the root of N, and meeting true, we delete all the numbers with this step up to N. The algorithm looks compact and simple, I quote it in java. <br><br><blockquote><ol><li> <code><font color="black">Arrays.fill(isPrime, <font color="#0000ff">true</font> ); isPrime[ <font color="#A31515">1</font> ] = <font color="#0000ff">false</font> ; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i= <font color="#A31515">2</font> ; i*i &lt; N; i++) <font color="#0000ff">if</font> (isPrime[i]) <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> j=i*i; j &lt; N; j+=i) isPrime[j] = <font color="#0000ff">false</font> ;</font></code> </li> <li> <code><font color="black">Arrays.fill(isPrime, <font color="#0000ff">true</font> ); isPrime[ <font color="#A31515">1</font> ] = <font color="#0000ff">false</font> ; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i= <font color="#A31515">2</font> ; i*i &lt; N; i++) <font color="#0000ff">if</font> (isPrime[i]) <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> j=i*i; j &lt; N; j+=i) isPrime[j] = <font color="#0000ff">false</font> ;</font></code> </li> <li> <code><font color="black">Arrays.fill(isPrime, <font color="#0000ff">true</font> ); isPrime[ <font color="#A31515">1</font> ] = <font color="#0000ff">false</font> ; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i= <font color="#A31515">2</font> ; i*i &lt; N; i++) <font color="#0000ff">if</font> (isPrime[i]) <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> j=i*i; j &lt; N; j+=i) isPrime[j] = <font color="#0000ff">false</font> ;</font></code> </li> <li> <code><font color="black">Arrays.fill(isPrime, <font color="#0000ff">true</font> ); isPrime[ <font color="#A31515">1</font> ] = <font color="#0000ff">false</font> ; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i= <font color="#A31515">2</font> ; i*i &lt; N; i++) <font color="#0000ff">if</font> (isPrime[i]) <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> j=i*i; j &lt; N; j+=i) isPrime[j] = <font color="#0000ff">false</font> ;</font></code> </li> <li> <code><font color="black">Arrays.fill(isPrime, <font color="#0000ff">true</font> ); isPrime[ <font color="#A31515">1</font> ] = <font color="#0000ff">false</font> ; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i= <font color="#A31515">2</font> ; i*i &lt; N; i++) <font color="#0000ff">if</font> (isPrime[i]) <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> j=i*i; j &lt; N; j+=i) isPrime[j] = <font color="#0000ff">false</font> ;</font></code> </li> <li> <code><font color="black">Arrays.fill(isPrime, <font color="#0000ff">true</font> ); isPrime[ <font color="#A31515">1</font> ] = <font color="#0000ff">false</font> ; <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i= <font color="#A31515">2</font> ; i*i &lt; N; i++) <font color="#0000ff">if</font> (isPrime[i]) <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> j=i*i; j &lt; N; j+=i) isPrime[j] = <font color="#0000ff">false</font> ;</font></code> </li> <li></li></ol></blockquote><br><habracut><br>  The algorithm works for <b>O (N * log (log (N)))</b> , so it is quite suitable for small numbers.  Consider the case when we need to find prime numbers not from one to N, but from n to m.  Let us have limitations <b>1 &lt;= m &lt;= n &lt;= 10 ^ 9;</b>  <b>nm &lt;= 10 ^ 6</b> .  Here we need to apply an algorithm called a double sieve.  It consists in finding primes from the root of n, then storing them in a separate array and ‚Äústriking out‚Äù these primes in the same way with a certain step, but from the interval [m, n] we need.  Briefly, this algorithm will look like this: <br><br><blockquote><ol><li>  <font color="#0000ff">int</font> primes = <font color="#0000ff">new int</font> [P];  <font color="#008000">// fill it simple to the root of n</font> </li><li>  <font color="#2b91af">boolean</font> sieve = <font color="#0000ff">new</font> <font color="#2b91af">boolean</font> [nm + <font color="#A31515">1</font> ];  <font color="#008000">// secondary sieve</font> </li><li>  Arrays.fill (sieve, <font color="#0000ff">true</font> ); </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = <font color="#A31515">0</font> ; i &lt;P; i ++) { </li><li>  <font color="#0000ff">int</font> h = m% primes [i]; </li><li>  <font color="#0000ff">int</font> j = h == <font color="#A31515">0</font> ?  <font color="#A31515">0</font> : primes [i] - h; </li><li>  <font color="#0000ff">for</font> (; j &lt;= nm; j + = primes [i]) </li><li>  sieve [j] = <font color="#0000ff">false</font> ; </li><li></li></ol></blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So you can cope with ranges sufficiently remote from zero.  Now we come to the most interesting point: what if we need to output prime numbers from 0 to <b>N = 10 ^ 8</b> ?  If we recall the asymptotics, then at first glance it seems real even for a regular sieve, but looking at the memory costs: 10 ^ 8 * 4 = 400MB, we see that the problem is not so trivial, especially if we have tight time constraints.  To solve this problem, we can distinguish two approaches, namely: <br><ul><li>  sieve packaging </li><li>  cache memory </li></ul><br>  Consider them in more detail.  Packing is this: in modern programming languages, the type of boolean takes on average from one to four bytes, although it can be encoded with just one bit.  Therefore, we can create an array of integers and work with each of them as a bitwise mask, thereby saving memory 8-30 times.  The advantages are immediately visible, but now let's dwell a little more on the second idea, which is guaranteed to speed up the sieve several times. <br>  Many people know that in our computer there is a cache memory between the processor and RAM, it is much faster to work with it than from the RAM, but its size is limited.  For example, when working with a large array, the processor loads a part of it into the cache, works with it, then transfers it back to the operational one, loads another, and so on.  And now let us remember our sieve algorithm: we erased every prime number from the entire array, walking along it from beginning to end.  Therefore, the processor will load the different segments of the array into the cache many times and the speed on this will be greatly lost.  This approach proposes to minimize the cost of copying an array from one memory to another.  This is easy to do if you divide our entire gap into pieces, up to 3 * 10 ^ 4 elements, which is approximately equal to the size of the cache and work with them in order.  Then we will deal with the entire array for the minimum number of downloads.  It will look something like this: <br><br><blockquote><ol><li>  <font color="#0000ff">int</font> CACHE = <font color="#A31515">30000</font> ;  <font color="#008000">// cache size</font> </li><li>  <font color="#0000ff">int</font> M = ( <font color="#0000ff">int</font> ) <font color="#2b91af">Math</font> .sqrt (N) + <font color="#A31515">1</font> ; </li><li></li><li>  <font color="#0000ff">int</font> primes = <font color="#0000ff">new int</font> [P];  <font color="#008000">// array of primes to the root of N</font> </li><li>  <font color="#2b91af">boolean</font> segment = <font color="#0000ff">new</font> <font color="#2b91af">boolean</font> [CACHE];  <font color="#008000">// secondary sieve</font> </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> I = M- <font color="#A31515">1</font> ; I &lt;N; I + = CACHE) { </li><li>  Arrays.fill (segment, <font color="#0000ff">true</font> ); </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = <font color="#A31515">0</font> ; i &lt;P; i ++) { </li><li>  <font color="#0000ff">int</font> h = I% primes [i]; </li><li>  <font color="#0000ff">int</font> j = h&gt; <font color="#A31515">0</font> ?  primes [i] - h: <font color="#A31515">0</font> ; </li><li>  <font color="#0000ff">for</font> (; j &lt;CACHE; j + = primes [i]) </li><li>  segment [j] = <font color="#0000ff">false</font> ; </li><li>  } </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = <font color="#A31515">0</font> ; i &lt;CACHE; i ++) { </li><li>  <font color="#0000ff">if</font> (segment [i] &amp;&amp; (i + I &lt;N)) { </li><li>  <font color="#0000ff">out</font> .println (i + i);  <font color="#008000">// print a prime number on the screen</font> </li><li>  } </li><li>  } </li><li>  } </li></ol></blockquote><br><br><br>  Using this method, we greatly accelerate our sieve, practically without complicating it, for many tasks it helps a lot, for example, one of them: <a href="http://www.spoj.pl/problems/TDPRIMES/">TDPRIMES</a> , you can practice on this task and see well that a regular sieve doesn‚Äôt fit in 2.8. </habracut></div><p>Source: <a href="https://habr.com/ru/post/91112/">https://habr.com/ru/post/91112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../91102/index.html">Apple iPad - the first computer for cats</a></li>
<li><a href="../91104/index.html">Published release schedule for Opera for Windows, Mac and Linux</a></li>
<li><a href="../91105/index.html">Google is much more than you imagine.</a></li>
<li><a href="../91109/index.html">Register a trademark in the US</a></li>
<li><a href="../91111/index.html">Seven rules for the entrepreneur from Steve Jobs</a></li>
<li><a href="../91120/index.html">New premium features: version history and 50 megabytes note</a></li>
<li><a href="../91121/index.html">Silverlight 4: download resources</a></li>
<li><a href="../91122/index.html">C ++ 0x support in Visual Studio 2010</a></li>
<li><a href="../91123/index.html">Information is not a product</a></li>
<li><a href="../91124/index.html">Design LiveJournal!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>