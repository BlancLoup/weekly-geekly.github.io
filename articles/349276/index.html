<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a game on Lua and L√ñVE - 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In this series of tutorials, we will cover the creation of a complete game using Lua and L√ñVE . The tutorial is intended for programmer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a game on Lua and L√ñVE - 1</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/625/305/a37/625305a37f81962551aed8611bab6bda.jpg" alt="image"></div><br><h2>  Introduction </h2><br>  In this series of tutorials, we will cover the creation of a complete game using <a href="https://www.lua.org/" rel="nofollow">Lua</a> and <a href="https://love2d.org/" rel="nofollow">L√ñVE</a> .  The tutorial is intended for programmers who have some experience, but are just beginning to master game development, or for game developers who have already had experience working with other languages ‚Äã‚Äãor frameworks, but who want to learn better Lua or L√ñVE. <br><br>  The game we are creating will be a combination of <a href="http://store.steampowered.com/app/433950/" rel="nofollow">Bit Blaster XL</a> and the <a href="https://www.pathofexile.com/passive-skill-tree" rel="nofollow">Path of Exile passive skill tree</a> .  It is simple enough to be considered in several articles that are not very large in size, but contain too much knowledge for a beginner. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://github.com/SSYGEN/blog/raw/master/images/bytepath-shielder.gif"></div></div></div><br>  In addition, the tutorial has a level of complexity that is not disclosed in most tutorials on creating games.  Most of the problems that newcomers have in game development are related to the scale of the project.  It is usually advised to start small and gradually expand the volume.  Although this is a good idea, but if you are interested in such projects that cannot be done less, then there are quite a few resources on the Internet that can help you in solving the problems encountered. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As for me, I was always interested in creating games with a lot of objects / passive capabilities / skills, so when I got to work, it was difficult for me to find a good way to structure the code so as not to get lost in it.  I hope my tutorial series will help someone with this. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://github.com/SSYGEN/blog/raw/master/images/bytepath-skill-tree.gif"></div></div></div><br><h2>  Requirements </h2><br>  Before starting, I will list some of the knowledge necessary to master this tutorial: <br><br><ul><li>  Basics of programming: variables, cycles, conditional statements, basic data structures, etc .; </li><li>  Basics of OOP, for example, understanding classes, instances, attributes, and methods; </li><li>  And the very basics of Lua;  <a href="https://learnxinyminutes.com/docs/lua/" rel="nofollow">This short tutorial</a> should be enough. </li></ul><br>  In fact, this tutorial is not intended for people taking the first steps in programming.  In addition, here I will give exercises.  If you have ever had a situation where you finished the tutorial and did not know where to go next, then perhaps it was because you didn‚Äôt have exercises.  If you do not want this to be repeated, then I recommend at least try to do them. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18d/5d1/e4e/18d5d1e4e4653f91943a561a620c396c.gif"></div></div></div><br><h2>  Table of contents </h2><br><ul><li>  <a href="https://habrahabr.ru/post/349276/">Article 1</a> <ul><li>  Part 1. Game cycle </li><li>  Part 2. Libraries </li><li>  Part 3. Rooms and areas </li><li>  Part 4. Exercises </li></ul></li><li>  <a href="https://habrahabr.ru/post/349440/">Article 2</a> <ul><li>  Part 5. Basics of the game </li><li>  Part 6. Basics of the Player Class </li></ul></li><li>  <a href="https://habrahabr.ru/post/349718/">Article 3</a> <ul><li>  Part 7. Player Parameters and Attacks </li><li>  Part 8. Enemies </li></ul></li><li>  <a href="https://habrahabr.ru/post/350316/">Article 4</a> <ul><li>  Part 9. Director and game cycle </li><li>  Part 10. Code Writing Practices </li><li>  Part 11. Passive skills </li></ul></li><li>  <a href="https://habrahabr.ru/post/350316/">Article 5</a> <ul><li>  Part 12. Other Passive Skills </li></ul></li></ul><br>  13. Skill Tree <br><br>  14. Console <br><br>  15. Final <br><br><h2>  Part 1: Game Cycle </h2><br><h2>  Getting Started </h2><br>  First, we need to install L√ñVE in the system and learn how to run L√ñVE projects.  We will use the L√ñVE version 0.10.2, which can be downloaded <a href="https://love2d.org/" rel="nofollow">here</a> .  If you are reading this article from the future and a new version of L√ñVE has already been released, then 0.10.2 can be downloaded <a href="https://bitbucket.org/rude/love/downloads/" rel="nofollow">from here</a> .  Detailed instructions are described on <a href="https://love2d.org/wiki/Getting_Started" rel="nofollow">this page</a> .  Having done everything necessary, create a file in your project <code>main.lua</code> with the following contents: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  If you run the project, you will see a pop-up window with a black screen.  In the code above, the L√ñVE project performs the function <code>love.load</code> once the program is started, and <code>love.update</code> and <code>love.draw</code> are executed in each frame.  That is, for example, if you want to upload an image and draw it, then write something like this: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> image = love.graphics.newImage(<span class="hljs-string"><span class="hljs-string">'image.png'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> love.graphics.draw(image, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  <a href="https://love2d.org/wiki/love.graphics.newImage" rel="nofollow"><code>love.graphics.newImage</code></a> loads the image texture into the <code>image</code> variable, and then in each frame it is drawn at position 0, 0. To see that <code>love.draw</code> actually draws the image in each frame, try this: <br><br><pre> <code class="lua hljs">love.graphics.draw(image, love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">800</span></span>), love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>))</code> </pre> <br>  By default, the window has a size of <code>800x600</code> , that is, this function will very quickly randomly draw an image on the screen: <br><br><div class="spoiler">  <b class="spoiler_title">Shimmering gif</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/5d2/cba/c56/5d2cbac566a004d17f6bc9bb3f37d6bd.gif"></div></div><br>  Note that before each frame the screen is cleared, otherwise the image being drawn would gradually fill the entire screen, drawing in random positions.  This is because L√ñVE provides its projects with a standard game loop that performs screen cleaning after each frame.  Now I will talk about the game cycle and how it can be changed. <br><br><h2>  Game cycle </h2><br>  The standard game loop used by L√ñVE is on <a href="" rel="nofollow"><code>love.run</code></a> .  It looks like this: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.setRandomSeed(<span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">--   ,   dt    ,   love.load. if love.timer then love.timer.step() end local dt = 0 --   . while true do --  . if love.event then love.event.pump() for name, a,b,c,d,e,f in love.event.poll() do if name == "quit" then if not love.quit or not love.quit() then return a end end love.handlers[name](a,b,c,d,e,f) end end --  dt,        update if love.timer then love.timer.step() dt = love.timer.getDelta() end --  update  draw if love.update then love.update(dt) end --  0,  love.timer  if love.graphics and love.graphics.isActive() then love.graphics.clear(love.graphics.getBackgroundColor()) love.graphics.origin() if love.draw then love.draw() end love.graphics.present() end if love.timer then love.timer.sleep(0.001) end end end</span></span></code> </pre> <br>  When the program <code>love.run</code> , <code>love.run</code> is <code>love.run</code> , and then everything else starts from here.  The function is well commented out, and the purpose of each function can be found in the L√ñVE wiki.  But we will go through the basics: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.setRandomSeed(<span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  In the first line, we check <code>love.math</code> for nil inequality.  All values ‚Äã‚Äãin Lua are true, except false and nil, so <code>if love.math</code> condition will be true if <code>love.math</code> defined.  In the case of L√ñVE, these variables are set in the <a href="https://love2d.org/wiki/Config_Files" rel="nofollow"><code>conf.lua</code></a> file.  You do not need to worry about this file yet, but I mentioned it because it is possible to enable and disable certain systems, such as <code>love.math</code> , in it, so before working with its functions, you need to make sure that it is enabled in this file. <br><br>  In general, if a variable is not defined in Lua and you somehow refer to it, then it will return the value nil.  That is, if you create an <code>if random_variable</code> condition, then it will be false if the variable has not been defined previously, for example <code>random_variable = 1</code> . <br><br>  Be that as it may, if the <code>love.math</code> module <code>love.math</code> enabled (and by default it is), then its initial number (seed) is set based on the current time.  See <a href="https://love2d.org/wiki/love.math.setRandomSeed" rel="nofollow"><code>love.math.setRandomSeed</code></a> and <a href="https://www.lua.org/pil/22.1.html" rel="nofollow"><code>os.time</code></a> .  After that, the <code>love.load</code> function is <code>love.load</code> : <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> love.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  <code>arg</code> is the command line argument passed to the executable L√ñVE file when it runs the project.  As you can see, <a href="" rel="nofollow"><code>love.load</code></a> is executed only once because it is called only once, and the update and draw functions are called in a loop (and each iteration of this loop corresponds to a frame). <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--   ,   dt    ,   love.load. if love.timer then love.timer.step() end local dt = 0</span></span></code> </pre> <br>  After calling <code>love.load</code> and performing the function of all our work, we check that <code>love.timer</code> set and call <a href="" rel="nofollow"><code>love.timer.step</code></a> , which measures the time spent between the last two frames.  As written in the comment, processing <code>love.load</code> can take a long time (because it can contain all sorts of things, such as images and sounds), and this time should not be the first value returned by <code>love.timer.getDelta</code> in the first frame of the game. <br><br>  Also, <code>dt</code> is initialized to 0. Variables in Lua are global by default, so by assigning <code>local dt</code> we assign the current block only a local scope, that is, we restrict it to the <code>love.run</code> function.  Read more about the blocks <a href="https://www.lua.org/pil/4.2.html" rel="nofollow">here</a> . <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--   . while true do --  . if love.event then love.event.pump() for name, a,b,c,d,e,f in love.event.poll() do if name == "quit" then if not love.quit or not love.quit() then return a end end love.handlers[name](a,b,c,d,e,f) end end end</span></span></code> </pre> <br>  This is where the main loop begins.  The first thing that happens every frame is event handling.  <a href="" rel="nofollow"><code>love.event.pump</code></a> passes events to the event queue and according to its description, these events are somehow generated by the user.  These can be keystrokes, mouse clicks, window resizing, window focus changes and the like.  The loop using <a href="" rel="nofollow"><code>love.event.poll</code></a> goes through the event queue and processes each event.  <code>love.handlers</code> is a table of functions that calls the appropriate event handling mechanisms.  For example, <code>love.handlers.quit</code> will call the function <code>love.quit</code> , if it exists. <br><br>  One of the features of L√ñVE is that you can define event handling mechanisms in the <code>main.lua</code> file that will be called when the event <code>main.lua</code> .  A full list of event handlers is available <a href="https://love2d.org/wiki/love" rel="nofollow">here</a> .  I‚Äôll no longer look at event handlers in detail, but will briefly explain how everything happens.  Arguments <code>a, b, c, d, e, f</code> passed to <code>love.handlers[name]</code> are all possible arguments that the corresponding functions can use.  For example, <a href="https://love2d.org/wiki/love.keypressed" rel="nofollow"><code>love.keypressed</code></a> gets the key pressed as an argument, its scancode and information about whether a keystroke event repeats.  That is, in the case of <code>love.keypressed</code> values ‚Äã‚Äãof <code>a, b, c</code> will be defined, and <code>d, e, f</code> will be nil. <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--  dt,        update if love.timer then love.timer.step() dt = love.timer.getDelta() end --  update  draw if love.update then love.update(dt) end --  0,  love.timer </span></span></code> </pre> <br>  <code>love.timer.step</code> measures the time between the last two frames and changes the value returned by <a href="https://love2d.org/wiki/love.timer.getDelta" rel="nofollow"><code>love.timer.getDelta</code></a> .  That is, in this case <code>dt</code> will contain the time it took to complete the last frame.  This is useful because then this value is passed to the <code>love.update</code> function, and from this point on it can be used by the game to provide constant speeds regardless of the change in the frame rate. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.graphics <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> love.graphics.isActive() <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> love.graphics.clear(love.graphics.getBackgroundColor()) love.graphics.origin() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.draw <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> love.draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> love.graphics.present() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  After calling <code>love.update</code> is <code>love.draw</code> .  But before that, we make sure that the <code>love.graphics</code> module exists and check with <a href="https://love2d.org/wiki/love.graphics.isActive" rel="nofollow"><code>love.graphics.isActive</code></a> that we can draw on the screen.  The screen is cleared, filled with the specified background color (initially black) using <a href="https://love2d.org/wiki/love.graphics.clear" rel="nofollow"><code>love.graphics.clear</code></a> , using <a href="https://love2d.org/wiki/love.graphics.origin" rel="nofollow"><code>love.graphics.origin</code></a> transformations are reset, <code>love.draw</code> is <code>love.draw</code> , and then <a href="https://love2d.org/wiki/love.graphics.present" rel="nofollow"><code>love.graphics.present</code></a> used to transfer everything drawn in <code>love.draw</code> on the screen.  And finally: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.timer <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> love.timer.sleep(<span class="hljs-number"><span class="hljs-number">0.001</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  I never understood why <a href="https://love2d.org/wiki/love.timer.sleep" rel="nofollow"><code>love.timer.sleep</code></a> should be here, at the end of the file, but the <a href="https://love2d.org/forums/viewtopic.php%3Ff%3D4%26amp%3Bt%3D76998%26amp%3Bp%3D198629%26amp%3Bhilit%3Dlove.timer.sleep" rel="nofollow">explanation from the L√ñVE developer</a> seems quite logical. <br><br>  And this is where the <code>love.run</code> function ends.  Everything that happens inside the <code>while true</code> refers to the frame, that is, <code>love.update</code> and <code>love.draw</code> are called once per frame.  The whole game is essentially a very fast repetition of the contents of the loop (for example, at 60 frames per second), so get used to this thought.  I remember that at first it took me some time to instinctively realize why everything is so arranged. <br><br>  If you want to read more about this, there is a helpful discussion of this feature on the <a href="https://love2d.org/forums/viewtopic.php%3Ft%3D83578" rel="nofollow">L√ñVE forums</a> . <br><br>  If you don‚Äôt want to, then you don‚Äôt have to figure it out right from the start, but it‚Äôs useful to change the game cycle in the right way.  There is an excellent article that discusses various techniques of gaming cycles with a qualitative explanation.  She is <a href="http://gafferongames.com/game-physics/fix-your-timestep/" rel="nofollow">here</a> . <br><br><h3>  Exercises for the game cycle </h3><br>  <strong>1.</strong> What role does Vsync play in the game loop?  By default, it is turned on and you can disable it by calling <a href="https://love2d.org/wiki/love.window.setMode" rel="nofollow"><code>love.window.setMode</code></a> with the <code>vsync</code> attribute <code>vsync</code> to false. <br><br>  <strong>2.</strong> Implement the <code>Fixed Delta Time</code> cycle from the Fix Your Timestep article by changing <code>love.run</code> . <br><br>  <strong>3.</strong> Implement the <code>Variable Delta Time</code> cycle from Fix Your Timestep by changing <code>love.run</code> . <br><br>  <strong>4.</strong> Implement the <code>Semi-Fixed Timestep</code> from the article Fix Your Timestep, changing <code>love.run</code> . <br><br>  <strong>5.</strong> Implement the <code>Free the Physics</code> cycle from Fix Your Timestep by changing <code>love.run</code> . <br><br><hr><br><h2>  Part 2: Libraries </h2><br><h2>  Introduction </h2><br>  In this part, we will look at some of the Lua / L√ñVE libraries that are necessary for the project, and we will also explore the principles that are unique to Lua that you need to start learning.  By the end of this part we will learn four libraries.  One of the goals of this part is to get used to the idea of ‚Äã‚Äãloading libraries collected by other people, to read their documentation, to study their work and how to use it in their project.  Lua and L√ñVE, by themselves, do not have extensive capabilities, so downloading and using code written by other people is a standard and necessary practice. <br><br><h2>  Object Orientation </h2><br>  The first thing I will consider here is the orientation of objects.  There are many ways to implement the orientation of objects in Lua, but we just use the library.  Most of all I like the <a href="https://github.com/rxi/classic">rxi / classic</a> OOP library because of its small size and efficiency.  To install it, simply download it and drag the <code>classic</code> folder into the project folder.  I usually create a <code>libraries</code> folder and drop all libraries there. <br><br>  Having finished with this, we can import the library into the game at the top of the <code>main.lua</code> file by doing the following: <br><br><pre> <code class="lua hljs">Object = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'libraries/classic/classic'</span></span></code> </pre> <br>  As it is written on the github page, you can perform all normal OOP actions with this library, and they should work fine.  When creating a new class, I usually do it in a separate file and put this file in the <code>objects</code> folder.  Then, for example, creating a <code>Test</code> class and one of its instances will look like this: <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--   objects/Test.lua Test = Object:extend() function Test:new() end function Test:update(dt) end function Test:draw() end</span></span></code> </pre> <br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--   main.lua Object = require 'libraries/classic/classic' require 'objects/Test' function love.load() test_instance = Test() end</span></span></code> </pre> <br>  That is, when you call <code>require 'objects/Test'</code> in <code>main.lua</code> , everything that is defined in the <code>Test.lua</code> file is <code>Test.lua</code> , which means that the global variable <code>Test</code> now contains the definition of the class Test.  In our game, each class definition will be performed in this way, that is, class names must be unique, as they are bound to a global variable.  If you do not want to do this, you can make the following changes: <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--   objects/Test.lua local Test = Object:extend() ... return Test</span></span></code> </pre> <br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--   main.lua Test = require 'objects/Test'</span></span></code> </pre> <br>  If we make the <code>Test</code> variable local in <code>Test.lua</code> , then it will not be bound to a global variable, that is, it will be possible to bind it to any name when it is needed in <code>main.lua</code> .  At the end of the <code>Test.lua</code> script, a local variable is returned, and therefore in <code>main.lua</code> when declaring <code>Test = require 'objects/Test'</code> definition of the class <code>Test</code> assigned to the global variable <code>Test</code> . <br><br>  Sometimes, for example, when writing libraries for other people, it is better to do so in order not to pollute their global state with the variables of their library.  The classic library also does this, which is why we need to initialize it by assigning it to the <code>Object</code> variable.  One of the good consequences of this is that if you assign a library to a variable, if we want, we can give <code>Object</code> name <code>Class</code> , and then our class definitions will look like <code>Test = Class:extend()</code> . <br><br>  The last thing I do is automate the require process for all classes.  To add a class to the environment, you need to <code>require 'objects/ClassName'</code> .  The problem here is that there may be a multitude of classes, and entering this string for each class can be tedious.  So to automate this process, you can do something like this: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> object_files = {} recursiveEnumerate(<span class="hljs-string"><span class="hljs-string">'objects'</span></span>, object_files) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">recursiveEnumerate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(folder, file_list)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> items = love.filesystem.getDirectoryItems(folder) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ipairs</span></span>(items) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file = folder .. <span class="hljs-string"><span class="hljs-string">'/'</span></span> .. item <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.filesystem.isFile(file) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(file_list, file) <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> love.filesystem.isDirectory(file) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> recursiveEnumerate(file, file_list) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Let's break this code down.  The <code>recursiveEnumerate</code> function recursively lists all the files within a given folder and adds them to the table as rows.  It uses the <a href="https://love2d.org/wiki/love.filesystem" rel="nofollow">L√ñVE filesystem module</a> , which contains many useful functions for performing such operations. <br><br>  The first line inside the loop creates a list of all files and folders in the specified folder and returns them using <a href="https/love2d.org/wiki/love.filesystem.getDirectoryItems"><code>love.filesystem.getDirectoryItems</code></a> as a string table.  Then it iterates through all of them and gets the full path to the file by concatenation (the concatenation of the lines in Lua is performed using <code>..</code> ) the <code>folder</code> string and the <code>item</code> string. <br><br>  Assume that the folder string is set to <code>'objects'</code> , and inside the <code>objects</code> folder there is a single file called <code>GameObject.lua</code> .  Then the <code>items</code> list will look like <code>items = {'GameObject.lua'}</code> .  When iterating through the list, the string <code>local file = folder .. '/' .. item</code> sparsya in <code>local file = 'objects/GameObject.lua'</code> , that is, in the full path to the corresponding file. <br><br>  This full path is then used to check, using the <a href="https://love2d.org/wiki/love.filesystem.isFile" rel="nofollow"><code>love.filesystem.isFile</code></a> and <a href="https://love2d.org/wiki/love.filesystem.isDirectory" rel="nofollow"><code>love.filesystem.isDirectory</code></a> functions, whether it is a file or a directory.  If this is a file, then we simply add it to the <code>file_list</code> table passed by the called function, otherwise we call <code>recursiveEnumerate</code> again, but this time we use this path as the <code>folder</code> variable.  When this process is completed, the <code>file_list</code> table will be filled with lines corresponding to the paths to all files within the <code>folder</code> .  In our case, the <code>object_files</code> variable will be a table filled with rows corresponding to all classes in the <code>objects</code> folder. <br><br>  There is one more step left: adding all these paths to require: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> object_files = {} recursiveEnumerate(<span class="hljs-string"><span class="hljs-string">'objects'</span></span>, object_files) requireFiles(object_files) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requireFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(files)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ipairs</span></span>(files) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file = file:<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-5</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(file) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  It's all much clearer.  The code simply goes through the files and calls for them.  The only thing left is to remove <code>.lua</code> from the end of the line, because the <code>require</code> function produces an error if you leave it.  This can be done with the string <code>local file = file:sub(1, -5)</code> , which uses one of the built-in Lua <a href="http://lua-users.org/wiki/StringLibraryTutorial" rel="nofollow">string functions</a> .  So after doing this, all classes defined inside the <code>objects</code> folder will be automatically loaded.  Later, the <code>recursiveEnumerate</code> function will also be used to automatically load other resources, such as images, sounds, and shaders. <br><br><h3>  OOP exercises </h3><br>  <strong>6.</strong> Create the <code>Circle</code> class, which in its constructor receives the <code>x</code> , <code>y</code> and <code>radius</code> arguments, which have the <code>x</code> , <code>y</code> , <code>radius</code> and <code>creation_time</code> attributes, as well as the <code>update</code> and <code>draw</code> methods.  The <code>x</code> , <code>y</code> and <code>radius</code> attributes must be initialized with the values ‚Äã‚Äãpassed from the constructor, and the <code>creation_time</code> attribute must be initialized with a relative instance creation time (see <a href="https://love2d.org/wiki/love.timer" rel="nofollow">love.timer</a> ).  The <code>update</code> method should take the argument <code>dt</code> , and the draw function should draw the filled-in cycle centered at <code>x, y</code> with a radius of <code>radius</code> (see <a href="https://love2d.org/wiki/love.graphics" rel="nofollow">love.graphics</a> ).  An instance of this <code>Circle</code> class must be created at position 400, 300 with a radius of 50. It must also be updated and drawn on the screen.  Here's what the screen should look like: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52e/9dc/6ed/52e9dc6ed41932bfff39837c23d9853c.png"></div><br>  <strong>7.</strong> Create a <code>HyperCircle</code> class that inherits from the <code>Circle</code> class.  <code>HyperCircle</code> is similar to <code>Circle</code> , only the outer circle is drawn around it.  It should receive additional <code>line_width</code> and <code>outer_radius</code> arguments in the constructor.  An instance of this <code>HyperCircle</code> class <code>HyperCircle</code> be created at position 400, 300 with a radius of 50, a line width of 10, and an outer radius of 120. The screen should look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c4/dfa/023/2c4dfa023a151fc7c47a6e632f092a61.png"></div><br>  <strong>8.</strong> What does the operator use in Lua:?  How is it different from <code>.</code>  and when should you use each of them? <br><br>  <strong>9.</strong> Suppose we have the following code: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCounterTable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { value = <span class="hljs-number"><span class="hljs-number">1</span></span>, increment = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span></span> self.value = self.value + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> counter_table = createCounterTable() counter_table:increment() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  What will be the value of <code>counter_table.value</code> ?  Why does the <code>increment</code> function take an argument called <code>self</code> ?  Can this argument have some other name?  And what is the variable that is represented by <code>self</code> in this example? <br><br>  <strong>10.</strong> Create a function that returns a table that contains the attributes <code>a</code> , <code>b</code> , <code>c</code> and <code>sum</code> .  <code>a</code> , <code>b</code> and <code>c</code> must be initialized with values ‚Äã‚Äãof 1, 2, and 3, and <code>sum</code> must be a function that adds <code>a</code> , <code>b</code> and <code>c</code> .  The value of the sum must be stored in the attribute <code>c</code> table (that is, after all operations are performed, the table must have the attribute <code>c</code> with a value of 6). <br><br>  <strong>11.</strong> If a class has a method called <code>someMethod</code> , can it have an attribute with the same name?  If not, why not? <br><br>  <strong>12.</strong> What is a ‚Äúglobal table‚Äù in Lua? <br><br>  <strong>13.</strong> Based on how we organized the automatic loading of classes, if one class inherits from another, the code will look like this: <br><br><pre> <code class="lua hljs">SomeClass = ParentClass:extend()</code> </pre> <br>  Is there a guarantee that when this line is processed, the <code>ParentClass</code> variable <code>ParentClass</code> already be defined?  Or, in other words, is there any guarantee that the required <code>ParentClass</code> will be earlier than <code>SomeClass</code> ?  If so, how is this guaranteed?  If not, how can you fix this problem? <br><br>  <strong>14.</strong> Suppose that all class files define a class not globally, but locally, something like this: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> ClassName = Object:extend() ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ClassName</code> </pre> <br>  How do I need to change the <code>requireFiles</code> function <code>requireFiles</code> that it can still automatically load all classes? <br><br><h2>  Input </h2><br>  We now turn to the processing of input.  By default, several event handlers are used in L√ñVE.  If these event-handling functions are defined, they can be called when the corresponding event is executed, after which you can intercept the execution of the game and take the necessary actions: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.keypressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(key) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.keyreleased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(key) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.mousepressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y, button)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(x, y, button) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.mousereleased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y, button)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(x, y, button) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  In this case, when you press a key or click the mouse anywhere on the screen, information will be displayed in the console.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of the biggest problems with this kind of processing is that it forces you to structure everything you need to get input to bypass these calls. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppose we have an object </font></font><code>game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">within which there is an object </font></font><code>level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, within which there is an object </font></font><code>player</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In order for the player object to receive keyboard input, all these three objects must have two call handlers associated with the keyboard, because at the top level we only want to call </font></font><code>game:keypressed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inside </font></font><code>love.keypressed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, because we don‚Äôt want lower levels to know about the level or the player. Therefore, I created a </font></font><a href="https://github.com/adonaac/boipushy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to solve this problem. You can download and install it like any other library we have reviewed. Here are some examples of how it works:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> = Input() <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>:bind(<span class="hljs-string"><span class="hljs-string">'mouse1'</span></span>, <span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>:pressed(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">'pressed'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>:released(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">'released'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>:down(<span class="hljs-string"><span class="hljs-string">'test'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">'down'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That's what the library does: instead of relying on input event handling functions, it simply asks if a particular key was pressed in this frame and receives a response in the form of true or false. In the example above, the frame where the button was pressed </font></font><code>mouse1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be printed on the screen </font></font><code>pressed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the button release frame will be printed </font></font><code>released</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In all other frames when pressing is not performed, the challenges </font></font><code>input:pressed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>input:released</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will return false, and everything will be performed inside the conditional. The same applies to the function </font></font><code>input:down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, only it returns true in each frame when the button is held down, and false otherwise.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Often we need behavior that is repeated when you hold the key at a certain interval, and not in each frame. </font><font style="vertical-align: inherit;">For this purpose, you can use the function </font></font><code>down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>:down(<span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">'test event'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this example, if the key associated with the action is held </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then every 0.5 seconds the console will be printed </font></font><code>test event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Typing exercises </font></font></h3><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suppose we have the following code:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> = Input() <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>:bind(<span class="hljs-string"><span class="hljs-string">'mouse1'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will something happen when pressed </font></font><code>mouse1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? And when you let go? And while holding? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bind the alphanumeric key </font></font><code>+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the action </font></font><code>add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; then, while holding the action key, </font></font><code>add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">increase the value of the variable </font></font><code>sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(initially 0) by 1 every </font></font><code>0,25</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">second. Print the value </font></font><code>sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the console with each increment. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Is it possible to attach several keys to a single action? If not, why not? And is it possible to attach several actions to one key? If not, why not? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you have a controller, you can tie him directions DPAD buttons (fup, fdown ...) to act </font></font><code>up</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and then output the action name to the console when each button is pressed. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you have a controller, then attach one of its trigger buttons (l2, r2) to the action </font></font><code>trigger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Trigger buttons return a Boolean value from 0 to 1, indicating a click. </font><font style="vertical-align: inherit;">How will you get this value? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Repeat the previous exercise, but for the horizontal and vertical position of the left and right sticks.</font></font><br><br><h2>  Timer </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another critical part of the code is general time-fixing functions. </font><font style="vertical-align: inherit;">For them, we will use </font></font><a href="https://github.com/vrld/hump"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hump</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and more specifically </font></font><a href="http://hump.readthedocs.io/en/latest/timer.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hump.timer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="lua hljs">Timer = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'libraries/hump/timer'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> timer:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">According to the documentation, it can be used directly through a variable </font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or create a new instance. I decided to choose the second option. I use a global variable for global timers </font></font><code>timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and when I need timers inside objects, for example, in the Player class, they will have their own instances of timers created locally. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most important timing functions used throughout the game are </font></font><a href="http://hump.readthedocs.io/en/latest/timer.html" rel="nofollow"><code>after</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="http://hump.readthedocs.io/en/latest/timer.html" rel="nofollow"><code>every</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><a href="http://hump.readthedocs.io/en/latest/timer.html" rel="nofollow"><code>tween</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. And although I personally do not use the function </font></font><a href="http://hump.readthedocs.io/en/latest/timer.html" rel="nofollow"><code>script</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for some it may be useful, so it is worth mentioning it. Let's look at the timing functions:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() timer:after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function is </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quite simple. </font><font style="vertical-align: inherit;">It receives the number and function, and performs the function after the specified number of seconds. </font><font style="vertical-align: inherit;">In the example above, two seconds after starting the game, a random number should be displayed in the console. </font><font style="vertical-align: inherit;">One of the convenient features </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is that this function can be connected in chains.</font></font> For example: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() timer:after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) timer:after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) timer:after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this example, two seconds after launch, a random number will be displayed, then another after one second (three seconds after launch), and finally, after one second another (four seconds after launch). </font><font style="vertical-align: inherit;">This is somewhat similar to how the function works </font></font><code>script</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, so you can choose the one that is most convenient for you.</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() timer:every(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this example, a random number will be displayed every second. </font><font style="vertical-align: inherit;">Like a function </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it receives a number and a function, and then performs the function after a specified number of seconds. </font><font style="vertical-align: inherit;">In addition, it may also receive a third argument, in which the number of operations is passed.</font></font> For example: <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() timer:every(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This code will output five random numbers for the first five operations. </font><font style="vertical-align: inherit;">One of the ways to complete the function triggering </font></font><code>every</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without explicitly specifying the number of retries is to force it to return false. </font><font style="vertical-align: inherit;">This is useful in situations where the stop condition is not fixed or unknown at the time of the call </font></font><code>every</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another way to use the behavior of a function </font></font><code>every</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is to use a function </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for example, like this:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() timer:after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) timer:after(<span class="hljs-number"><span class="hljs-number">1</span></span>, f) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I never studied the inner workings of this function, but the author of the library decided to implement it this way and documented it in the instructions, so I just used it. </font><font style="vertical-align: inherit;">The convenience of the implementation of the functional </font></font><code>every</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in this way lies in the fact that we can change the time between operations by changing the value in the second call </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inside the first:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() timer:after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) timer:after(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(), f) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this application, the time between each operation is variable (from 0 to 1, since </font></font><a href="https://love2d.org/wiki/love.math.random" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">love.math.random</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> returns values ‚Äã‚Äãin this interval by default). </font><font style="vertical-align: inherit;">This default behavior cannot be achieved with a function </font></font><code>every</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Triggering at variable intervals is very useful in a variety of situations, so you should know how they are implemented. </font><font style="vertical-align: inherit;">We now turn to the function </font></font><code>tween</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() circle = {radius = <span class="hljs-number"><span class="hljs-number">24</span></span>} timer:tween(<span class="hljs-number"><span class="hljs-number">6</span></span>, circle, {radius = <span class="hljs-number"><span class="hljs-number">96</span></span>}, <span class="hljs-string"><span class="hljs-string">'in-out-cubic'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> timer:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> love.graphics.circle(<span class="hljs-string"><span class="hljs-string">'fill'</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>, circle.radius) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function is </font></font><code>tween</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">harder to master, because it takes many arguments: it gets the number of seconds, the worktable, the target table, and the transition mode. </font><font style="vertical-align: inherit;">It jumps to the target table in the worksheet. </font><font style="vertical-align: inherit;">In the example above, the table </font></font><code>circle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">has a key </font></font><code>radius</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with an initial value of 24. For 6 seconds, the value will change to 96 in the transition mode </font></font><code>in-out-cubic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Here is a </font></font><a href="http://easings.net/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useful list of all transition modes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) It seems complicated, but it looks like this:</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/c12/35c/66bc1235c00da385752a590627d1f2c4.gif"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function </font></font><code>tween</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can also receive an additional argument after the transition mode - a function that will be called after the transition is completed. </font><font style="vertical-align: inherit;">It can be used in many cases, but if we take the previous example, we can use it to compress the circle after expanding back:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() circle = {radius = <span class="hljs-number"><span class="hljs-number">24</span></span>} timer:after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer:tween(<span class="hljs-number"><span class="hljs-number">6</span></span>, circle, {radius = <span class="hljs-number"><span class="hljs-number">96</span></span>}, <span class="hljs-string"><span class="hljs-string">'in-out-cubic'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer:tween(<span class="hljs-number"><span class="hljs-number">6</span></span>, circle, {radius = <span class="hljs-number"><span class="hljs-number">24</span></span>}, <span class="hljs-string"><span class="hljs-string">'in-out-cubic'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It will look like this: </font></font><br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/006/1b4/ec3/0061b4ec3111676526371969c997ddf6.gif"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These three functions - </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>every</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>tween</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- remain in the group of the most useful functions in my code base. </font><font style="vertical-align: inherit;">They are very flexible and with their help you can achieve a lot. </font><font style="vertical-align: inherit;">So understand them to have an intuitive understanding of what you are doing!</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An important aspect of the timer library is that each of these calls returns a handle. </font><font style="vertical-align: inherit;">You can use this handle in conjunction with a call </font></font><code>cancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to cancel a specific timer:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> handle_1 = timer:after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) timer:cancel(handle_1)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is what happens in this example: first, we call a </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">random number for output to the console two seconds later and store the handle of this timer in a variable </font></font><code>handle_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Then we cancel this call by calling </font></font><code>cancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with an argument </font></font><code>handle_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It is very important to learn how to do this, because often we have situations when we create timer calls based on certain events. For example, when a player presses a key </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we want to output a random number to the console in two seconds:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.keypressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key == <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> timer:after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you add this code to the file </font></font><code>main.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and run the project, then after clicking </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the screen with a delay, a random number should appear. If you press </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">several times, several numbers will appear with a delay, one after the other. But sometimes we need this behavior so that when you repeat an event several times, it would reset the timer and start counting from 0 again. This means that when you click on, </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we want all previous timers created during the execution of this event to be canceled in the past. One way to do this is to somehow store all the descriptors, somehow bind them to the event identifier and call a certain undo function for the event identifier itself, which will undo the descriptors of all the timers associated with this event. Here is the solution:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.keypressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key == <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> timer:after(<span class="hljs-string"><span class="hljs-string">'r_key_press'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(love.<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I created an extension to an existing timer module that supports adding event labels. Then in our case the event is </font></font><code>r_key_press</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attached to a timer that is created when the key is pressed </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If the key is pressed repeatedly several times, the module automatically sees that the event has other registered timers and, by default, cancels the previous timers, which is what we are striving for. If the label is not used, the default behavior is the usual module behavior. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The extended version can be downloaded </font></font><a href="https://github.com/SSYGEN/EnhancedTimer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and replace the import of the timer in </font></font><code>main.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><code>libraries/hump/timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the file location </font></font><code>EnhancedTimer.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Personally, I put it in </font></font><code>libraries/enhanced_timer/EnhancedTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This also means that the library </font></font><code>hump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is located inside the folder.</font></font><code>libraries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If you name your folders in some other way, then you need to change the path at the top of the file </font></font><code>EnhancedTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In addition, you can also use the </font></font><a href="https://github.com/SSYGEN/chrono"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> written by me </font><font style="vertical-align: inherit;">, which has the same functionality as hump.timer, plus handles event labels.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Timer Exercises </font></font></h3><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using only the loop </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and one function declaration </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">within this loop, print 10 random numbers on the screen with an interval of 0.5 seconds before each output. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suppose we have the following code:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() rect_1 = {x = <span class="hljs-number"><span class="hljs-number">400</span></span>, y = <span class="hljs-number"><span class="hljs-number">300</span></span>, w = <span class="hljs-number"><span class="hljs-number">50</span></span>, h = <span class="hljs-number"><span class="hljs-number">200</span></span>} rect_2 = {x = <span class="hljs-number"><span class="hljs-number">400</span></span>, y = <span class="hljs-number"><span class="hljs-number">300</span></span>, w = <span class="hljs-number"><span class="hljs-number">200</span></span>, h = <span class="hljs-number"><span class="hljs-number">50</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> timer:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> love.graphics.rectangle(<span class="hljs-string"><span class="hljs-string">'fill'</span></span>, rect_1.x - rect_1.w/<span class="hljs-number"><span class="hljs-number">2</span></span>, rect_1.y - rect_1.h/<span class="hljs-number"><span class="hljs-number">2</span></span>, rect_1.w, rect_1.h) love.graphics.rectangle(<span class="hljs-string"><span class="hljs-string">'fill'</span></span>, rect_2.x - rect_2.w/<span class="hljs-number"><span class="hljs-number">2</span></span>, rect_2.y - rect_2.h/<span class="hljs-number"><span class="hljs-number">2</span></span>, rect_2.w, rect_2.h) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using only the function </font></font><code>tween</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, move the attribute of the </font></font><code>w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first rectangle within 1 second in the transition mode </font></font><code>in-out-cubic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">After that, perform the transition attribute of the </font></font><code>h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">second triangle for 1 second in the transition mode </font></font><code>in-out-cubic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">After that, move both rectangles back to their original attributes after 2 seconds in transition mode </font></font><code>in-out-cubic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It should look like this:</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/488/4dd/10b/4884dd10b2bae245d3e382f8a607f8f7.gif"></div></div></div><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For this exercise, you will need to create a strip of energy. </font><font style="vertical-align: inherit;">Each time you press a key, an </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">energy bar should simulate the damage taken. </font><font style="vertical-align: inherit;">It should look like this:</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28e/1c6/e83/28e1c6e83da1ca693adf8d8684cf9686.gif"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see, there are two layers in this strip of energy and when receiving damage the upper layer moves faster, while the background layer lags behind it a little. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Consider the previous example with an expanding and tapering circle: it expands once and shrinks once too. How to change the code so that it expands and contracts infinitely? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Get the results of the previous exercise, using only the function </font></font><code>after</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Assign a key </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the expansion of the circle when it is pressed, and the key </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to compression when pressed. Each new keystroke should cancel the current expansion / contraction. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suppose we have the following code:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> timer = Timer() a = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> timer:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How is it possible, using only a function </font></font><code>tween</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and without placing a variable </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inside another table, to make the transition of its value to 20 within 1 second in the transition mode </font></font><code>linear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Table functions </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, the last library I want to consider is </font></font><a href="https://github.com/Yonaba/Moses/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yonaba / Moses</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which contains many functions for more convenient processing of tables in Lua. </font><font style="vertical-align: inherit;">Library documentation is </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Now you can read it yourself and understand how to install it and use it yourself. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But before proceeding to the exercises, you need to learn how to display a table in the console to check its values:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(some_table) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(k, v) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exercises with tables </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In all the exercises we will use the following tables: </font></font><br><br><pre> <code class="lua hljs">a = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'5'</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">2</span></span>, c = <span class="hljs-number"><span class="hljs-number">3</span></span>, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}} b = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>} c = {<span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>} d = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>}</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, in each exercise, you can use only one function from the library, unless otherwise stated. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Output the contents of the table </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the console using the function </font></font><code>each</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">29.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Count the number of values ‚Äã‚Äã1 inside the table </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add 1 to all values ‚Äã‚Äãof the table </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, using the function </font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using the function </font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apply the </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">following transformations </font><font style="vertical-align: inherit;">to the table </font><font style="vertical-align: inherit;">: if the value is a number, then it should be doubled; if the value is a string, then add to it by concatenation </font></font><code>'xD'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; if the value is boolean, then you need to switch its state; and finally, if the value is a table, you should skip it. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum all the values ‚Äã‚Äãin the list </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The result should be equal to 26. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">33.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suppose we have the following code:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _______ <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">'table contains the value 9'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What library function should be used in the underlined place to check if the table contains the </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">value 9? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">34.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Find the first index in which the value 7 of the table is located </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Filter the table </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">so that only the numbers less than 5 are left. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Filter the table </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">so that only the rows are left. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Check whether all of the values of tables </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">figures. The code should return false for the first table and true for the second. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Shuffle the table randomly </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Make the table </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">go in reverse order. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove all occurrences of values ‚Äã‚Äã1 and 4 from the table </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a combination of tables </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no duplicates. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Find the common values ‚Äã‚Äãin the tables </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attach a table </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to a table </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part 3: Rooms and Areas </font></font></h2><br><h2>  Introduction </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this part we will look at the structured code needed before moving on to the game itself. </font><font style="vertical-align: inherit;">We will study the principle </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Room), which are similar to scenes in other engines. </font><font style="vertical-align: inherit;">We will also study the principle </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Area), the type of construction for managing objects that may be inside the room. </font><font style="vertical-align: inherit;">As in the two previous parts, there will be no game-related code in this, we will only consider high-level architectural solutions.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Room </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I took the idea of ‚Äã‚Äãrooms from the </font></font><a href="https://docs.yoyogames.com/source/dadiospice/002_reference/rooms/index.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GameMaker documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">When thinking about approaches to solving the problem of the game's architecture, I like to watch how others solved it, and in this case, even though I never used GameMaker, the authors' idea of ‚Äã‚Äãthe concept of a room and the associated functions gave me good tips. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Judging by the description, rooms (Rooms) - this is the place where everything happens in the game. </font><font style="vertical-align: inherit;">These are spaces in which all game objects are created, updated and rendered. </font><font style="vertical-align: inherit;">It is possible to move from one room to another. </font><font style="vertical-align: inherit;">These rooms are also ordinary objects that are located inside the folder </font></font><code>rooms</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Here's what a room might look like </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="lua hljs">Stage = Object:extend() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stage:new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stage:update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stage:draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Simple rooms </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In its simplest form, the operation of this system requires only one additional variable and one additional function: </font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> current_room = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_room <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> current_room:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_room <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> current_room:draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gotoRoom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(room_type, ...)</span></span></span></span> current_room = <span class="hljs-built_in"><span class="hljs-built_in">_G</span></span>[room_type](...) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First </font></font><code>love.load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a global variable is defined </font></font><code>current_room</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The idea is that only one room can be active at a time, so this variable will store a link to the current active room object. </font><font style="vertical-align: inherit;">Then, if there is a current active room, it will be drawn in </font></font><code>love.update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>love.draw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This means that all rooms must have the update and draw functions defined. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can use the function to change rooms </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It receives </font></font><code>room_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is a simple string with the class name of the room to go to. </font><font style="vertical-align: inherit;">Therefore, if, for example, we have a class </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defined as a room, then this function can be passed a string</font></font><code>'Stage'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The implementation of this functionality depends on how the automatic loading of classes in the previous part of the tutorial was configured, that is, from loading all classes as global variables. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global variables in Lua are stored in a global environment table, called </font></font><code>_G</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, that is, they can be accessed like any other variable in a regular table. If the global variable </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contains the definition of the Stage class, then it can be accessed by simply using the program anywhere </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, or </font></font><code>_G['Stage']</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, or </font></font><code>_G.Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Since we want to be able to load any arbitrary room, it will be logical to get a row </font></font><code>room_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and get access to the class definition via the global table. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That is, as a result, if </font></font><code>room_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a string</font></font><code>'Stage'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the line inside the function </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parses it in </font></font><code>current_room = Stage(...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This means that a copy of the new room will be created </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It also means that every time you move to a new room, this new room is created from scratch, and the previous room is deleted. This works in Lua as follows: when no variable is referenced to a table, the garbage collector deletes it. And when a variable is no longer referenced to an instance of the previous room </font></font><code>current_room</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it will be deleted by the garbage collector. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are obvious limitations in this scheme. For example, we often do not need rooms to be removed when moving to the next room, and often we don‚Äôt want a new room to be created from scratch with each transition to it. With such a system, it is impossible to avoid this.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, in my game I use this scheme. </font><font style="vertical-align: inherit;">There will be only three or four rooms in the game, and all these rooms should not be connected with each other, that is, they can be created from scratch without any problems and deleted when switching between them.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at a small example of how we can integrate this system into a real-life game. </font><font style="vertical-align: inherit;">To do this, use Nuclear Throne:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eca/a24/883/ecaa248839f1c4afc1a1677351d78fac.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watch the first minute of </font></font><a href="https://www.youtube.com/watch%3Fv%3DSsD6oRQWM6k" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> until the hero dies to see what this game is about. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The game loop is quite simple and it fits perfectly to demonstrate a simple room layout, because none of the rooms need to be linked to the previous ones. </font><font style="vertical-align: inherit;">(For example, it is impossible to return to the previous map.) The first screen of the game is the main menu:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/522/f13/242/522f1324209f34b1b1b18cf942aeaa2f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I would make it a room </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and in it </font><font style="vertical-align: inherit;">I would </font><font style="vertical-align: inherit;">create all the logic necessary for the main menu, that is, the background, five options, the effect arising when choosing a new option, small lightning along the edges of the screen, etc. And when a player chooses an option, I would call </font></font><code>gotoRoom(option_type)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that would replace the current room with the one created for this option. In our case it would be an extra room </font></font><code>Play</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>CO-OP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Settings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Stats</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternatively, you can create one room </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that processes all these additional options without having to separate them into different rooms. It is often better to store everything in the same room and process the transitions inside, rather than in an external system. The choice depends on the situation and in this case I do not have enough information to say which is better.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anyway, the next thing that happens in the video is that the player chooses the Play option, and it looks like this: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd7/bc7/58d/fd7bc758d8b1e223aeb1edc7a00719a8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New options appear and the player can select the normal, daily or weekly mode. </font><font style="vertical-align: inherit;">As far as I remember, they only change the initial number of levels generated, that is, in this case we do not need new rooms for each of these options (we can simply pass different initial values ‚Äã‚Äãas an argument when calling </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">The player selects the normal option and the following screen appears:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/58e/4f8/1d758e4f832506bc27fec6f67010cf37.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I would call it a room </font></font><code>CharacterSelect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Like the others, she would do everything necessary on this screen: the background, the characters in the background, the effects that occur when changing the character, the choice of character and all the logic necessary for this. </font><font style="vertical-align: inherit;">After selecting a character, the boot screen appears:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d14/289/b78/d14289b7841bf123e27e5c54bd8eb845.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> During the game: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa2/5e0/11d/fa25e011d8c030cea4e47c3ab330406b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When the player finishes the current level, this screen appears before moving on to the next: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f39/407/c93/f39407c9303eefb5e55e898c53711168.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the player selects the passive skill on the previous screen, the loading screen reappears. </font><font style="vertical-align: inherit;">Then the game again goes to the next level. </font><font style="vertical-align: inherit;">And then when the player dies, this screen appears:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac6/4eb/f4a/ac64ebf4a386b904254e2b8d1d254683.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All these different screens, and if I had followed the same logic, I would have sold them as separate rooms: </font></font><code>LoadingScreen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>MutationSelect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>DeathScreen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. But if you think about it, some of them may be redundant. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, there is no reason to separate a room </font></font><code>LoadingScreen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The loading process most likely performs the generation of the level that should occur in the room </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, so there is no point in separating them from each other, because the loading would occur in the room </font></font><code>LoadingScreen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and not in the room </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and then the data created in the first one would have to be transferred in the second. In my opinion, this is an unnecessary over-complication.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another example: the screen of death is just another layer superimposed on top of the game (which is still running), that is, it is most likely running in the same room as the game. </font><font style="vertical-align: inherit;">I think that as a result the screen should remain the only separate room </font></font><code>MutationSelect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This means that from the point of view of the room system, the Nuclear Throne game loop from the video looked like this: </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; </font></font><code>Play</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; </font></font><code>CharacterSelect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; </font></font><code>MutationSelect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; ... When death happens, the player can either return to </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or try again and restart the new one </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">All these transitions can be implemented through a simple function </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Persisting rooms </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the sake of completeness, even though my game will not use this system, I will talk about it as supporting more situations:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> rooms = {} current_room = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_room <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> current_room:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_room <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> current_room:draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRoom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(room_type, room_name, ...)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> room = <span class="hljs-built_in"><span class="hljs-built_in">_G</span></span>[room_type](room_name, ...) rooms[room_name] = room <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> room <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gotoRoom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(room_type, room_name, ...)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_room <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> rooms[room_name] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_room.deactivate <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> current_room:deactivate() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> current_room = rooms[room_name] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_room.activate <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> current_room:activate() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> current_room = addRoom(room_type, room_name, ...) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, besides passing the string, the </font></font><code>room_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">value is also passed </font></font><code>room_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This is necessary because in this case I want to be able to refer to the rooms using an identifier, that is, each </font></font><code>room_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">must be unique. This </font></font><code>room_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can be a string or a number - if they are unique, then it does not matter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, in this new system there is a function </font></font><code>addRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that simply creates an instance of a room and stores it inside the table. Then, </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instead of creating a new instance of a room, the </font><font style="vertical-align: inherit;">function </font><font style="vertical-align: inherit;">can check this table, and if the room already exists, then simply restore it, and otherwise create it from scratch. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another difference here is the use of functions </font></font><code>activate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>deactivate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If the room already exists and you want to go into it again by calling </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the current room is deactivated first, then it changes to the target room, and then the target room is activated. </font><font style="vertical-align: inherit;">These calls are useful in many cases, for example, to save data or to load data from disk, dereference of variables (so that they can be deleted) and so on. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This new system allows you to save the state of the rooms and keep them in memory, even when they are not active. </font><font style="vertical-align: inherit;">Since the table always refers to them </font></font><code>rooms</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, when changing </font></font><code>current_room</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to another room, the previous one will not be deleted by the garbage collector and can be obtained in the future.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at an example in which this new system is very useful. </font><font style="vertical-align: inherit;">This time it will be The Binding of Isaac:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35a/06a/d49/35a06ad49ffeb4a5ac8af7e079719166.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watch the first minute of </font></font><a href="https://www.youtube.com/watch%3Fv%3De0C14deMcrY" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This time I‚Äôll skip all the menus and focus on the gameplay itself. It consists of moving from room to room, killing enemies and selecting items. The player can return to previous rooms and these rooms retain the state in which the player left them, so if he killed the enemies and destroyed the stones in the room, then returning to it, he will not see any enemies or stones. This is perfect for our system. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will create the following system: we will have a room </font></font><code>Room</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in which the whole gameplay of the room takes place. And there will be a common room </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that coordinates the data at a higher level. For example, the </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algorithm will generate levels </font><font style="vertical-align: inherit;">in the room </font><font style="vertical-align: inherit;">and from its results by calling</font></font><code>addRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiple instances will be created </font></font><code>Room</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Each of these instances will have its own unique ID and will be used </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to activate one of them </font><font style="vertical-align: inherit;">when the game starts </font><font style="vertical-align: inherit;">. In the process of moving the player and exploring the dungeons, further calls will be made </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the instances already created </font></font><code>Room</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be activated / deactivated as the player moves. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When moving from one room to another in Isaac, there is a small transition that looks like this:</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://github.com/adonaac/blog/raw/master/images/bytepath-isaac-2.gif"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I did not mention this in the Nuclear Throne example, but it also has small transitions between rooms. </font><font style="vertical-align: inherit;">These transitions can be implemented in various ways, but in the case of Isaac, this means that two rooms must be rendered at the same time, so using only one variable </font></font><code>current_room</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will not work. </font><font style="vertical-align: inherit;">I will not now consider ways to change the code to solve this problem, but I thought that it is worth mentioning that the code presented here will not fully correspond to what is happening in the game and I have simplified everything a bit. </font><font style="vertical-align: inherit;">When I move on to writing my own game and implementing transitions, I‚Äôll talk about this in more detail.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exercises with rooms </font></font></h3><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">44.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create three rooms: </font></font><code>CircleRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which draws a circle in the center of the screen, </font></font><code>RectangleRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which draws a rectangle in the center of the screen and </font></font><code>PolygonRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which draws a polygon in the center of the screen. Assign keys </font></font><code>F1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>F2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>F3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to switch between rooms. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">45.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is the closest analogue of a room in the following engines: </font></font><a href="https://docs.unity3d.com/Manual/index.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://docs.godotengine.org/en/stable/index.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GODOT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://haxeflixel.com/documentation/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HaxeFlixel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://www.scirra.com/manual/1/construct-2" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construct 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://phaser.io/docs/2.6.2/index" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phaser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Examine their documentation and try to figure it out. Also look at what methods objects have and how you can switch from one room to another. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">46.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choose two single-player games and break them into pieces from the point of view of the rooms, as I did with Nuclear Throne and Isaac. </font><font style="vertical-align: inherit;">Try to look at everything realistically and evaluate whether each aspect should have its own room or not. </font><font style="vertical-align: inherit;">And try to describe what will happen when you call </font></font><code>addRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">47.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How does the Lua garbage collector work in general? </font><font style="vertical-align: inherit;">(If you don‚Äôt know what a garbage collector is, read about it.) How do memory leaks occur in Lua? </font><font style="vertical-align: inherit;">What ways can you avoid their occurrence or recognize them?</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Areas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We now turn to the idea </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Area). One of the operations usually performed inside the room is the management of various objects. All objects must be updated and drawn, as well as added to the room and deleted after death. Sometimes it is also required to request objects in a certain area (for example, when an explosion occurs, we need to cause damage to all objects around it, that is, take all the objects inside the circle and cause them damage), and also apply certain general actions to them, for example, sorting by the depth of their layer so that they can be drawn in a specific order. All these functions were the same in different rooms and different games that I created, so I gathered them into a class called </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="lua hljs">Area = Object:extend() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area:new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(room)</span></span></span></span> self.room = room self.game_objects = {} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area:update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, game_object <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ipairs</span></span>(self.game_objects) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> game_object:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area:draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, game_object <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ipairs</span></span>(self.game_objects) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> game_object:draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The idea is that this instance of this object will be created in the room. At first, the above code will have only a list of potential game objects, and these game objects should be updated and drawn. All game objects in the game will inherit from a single class </font></font><code>GameObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that has several common attributes that all objects in the game have. This class looks like this:</font></font><br><br><pre> <code class="lua hljs">GameObject = Object:extend() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameObject:new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(area, x, y, opts)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> opts = opts <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> opts <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(opts) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> self[k] = v <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> self.area = area self.x, self.y = x, y self.id = UUID() self.dead = <span class="hljs-literal"><span class="hljs-literal">false</span></span> self.timer = Timer() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameObject:update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.timer <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> self.timer:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameObject:draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The constructor takes four arguments:, a </font></font><code>area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">position </font></font><code>x, y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and a table </font></font><code>opts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">containing additional optional arguments. The first thing that happens in the code is that this additional table is taken </font></font><code>opts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and all its attributes are assigned to this object. For example, if we create it </font></font><code>GameObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this way:, </font></font><code>game_object = GameObject(area, x, y, {a = 1, b = 2, c = 3})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then the line </font></font><code>for k, v in pairs(opts) do self[k] = v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essentially copies the ads </font></font><code>a = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>b = 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>c = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into this newly created instance. Now you should understand what is happening here, but if you do not understand, then reread the section on OOP in the previous part, and also about the work of the tables in Lua. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, the transmitted reference to this instance of the area is stored in </font></font><code>self.area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the position in</font></font><code>self.x, self.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Then this game object is assigned an ID. This ID must be unique for each object so that we can identify each object without conflict. A simple UUID generation function is quite suitable for our game. Such a function is in a library called </font></font><a href="https://github.com/rxi/lume"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lume</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><a href="https://github.com/rxi/lume"><code>lume.uuid</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. We will not use this library, we need only this one function, that is, it will be more logical to take only it, and not to install the entire library:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UUID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> fn = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(<span class="hljs-number"><span class="hljs-number">16</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span> r = (x == <span class="hljs-string"><span class="hljs-string">"x"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (r + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (r % <span class="hljs-number"><span class="hljs-number">4</span></span>) + <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"0123456789abcdef"</span></span>):<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(r, r) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((<span class="hljs-string"><span class="hljs-string">"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"</span></span>):<span class="hljs-built_in"><span class="hljs-built_in">gsub</span></span>(<span class="hljs-string"><span class="hljs-string">"[xy]"</span></span>, fn)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I copied this code to a file </font></font><code>utils.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This file will contain support functions that cannot be assigned to any particular category. This function produces a string of the form </font></font><code>'123e4567-e89b-12d3-a456-426655440000'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that will be unique for any purpose. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is worth noting that this function uses the function </font></font><code>math.random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If you use </font></font><code>print(UUID())</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to see what it generates, then we will see that when the project is executed, it will generate the same ID. This problem occurs because it always uses the same seed number. One way to solve this problem is that each time you start the program, you can randomize the seed number based on the time. You can do this with </font></font><code>math.randomseed(os.time())</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, I just instead </font></font><code>math.random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">used</font></font><code>love.math.random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. As we remember from the first part of the tutorial, the first function called in </font></font><code>love.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the </font></font><code>love.math.randomSeed(os.time())</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one that deals with the randomization of the seed, but only for the random number generator L√ñVE. Since I use L√ñVE, when I need randomness, I will use its functions, not the Lua functions. Having made such a change to a function </font></font><code>UUID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you will see that it will begin to generate different IDs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Returning to the game object, a variable is defined here </font></font><code>dead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The idea is that when </font></font><code>dead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is true, the game object is removed from the game. The same thing happens with a class instance.</font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assigned to each game object. I saw that time functions are used in almost every object, so it seemed logical to use them by default for all objects. Finally, the function </font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">updates the timer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Given all this, the class </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">must be changed as follows:</font></font><br><br><pre> <code class="lua hljs">Area = Object:extend() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area:new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(room)</span></span></span></span> self.room = room self.game_objects = {} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area:update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = #self.game_objects, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> game_object = self.game_objects[i] game_object:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> game_object.dead <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(self.game_objects, i) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area:draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, game_object <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ipairs</span></span>(self.game_objects) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> game_object:draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The update function now takes into account the state of the variable </font></font><code>dead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and acts accordingly. First, the game object is updated in the usual way, then it is checked for dead. If it is true, the object is simply removed from the list </font></font><code>game_objects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. It is important here that the loop is performed in reverse order, from the end of the list to the beginning. This is because if we delete the elements from the Lua table, moving in a straightforward order, as a result, we will skip some elements, as can be seen from </font></font><a href="http://stackoverflow.com/questions/12394841/safely-remove-items-from-an-array-table-while-iterating" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this discussion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, the last thing to add is a function </font></font><code>addGameObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that adds to the </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new game object:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area:addGameObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(game_object_type, x, y, opts)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> opts = opts <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> game_object = <span class="hljs-built_in"><span class="hljs-built_in">_G</span></span>[game_object_type](self, x <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, y <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, opts) <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(self.game_objects, game_object) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> game_object <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It will be called as follows: </font></font><code>area:addGameObject('ClassName', 0, 0, {optional_argument = 1})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The variable </font></font><code>game_object_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will work the same way as the lines in the function </font></font><code>gotoRoom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, that is, they are the class names of the object being created. </font></font><code>_G[game_object_type]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the example above, it performs the parsing into a global variable </font></font><code>ClassName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which will contain the definition of the class </font></font><code>ClassName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">An instance of the target class is created, added to the list </font></font><code>game_objects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and then returned. </font><font style="vertical-align: inherit;">Now this instance will be updated and drawn in each frame. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is how this class will work. </font><font style="vertical-align: inherit;">We will actively change it during the development of the game, but in general we have described its necessary basic behavior (adding, deleting, updating, and drawing objects).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exercises with Area </font></font></h3><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a room </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in which there is </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Then create an object </font></font><code>Circle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that inherits from </font></font><code>GameObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and add an instance of this object to the room </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in a random position every two seconds. The instance </font></font><code>Circle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">must destroy itself at a random time interval from 2 to 4 seconds. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">49.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a room </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that does not exist </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Create an object </font></font><code>Circle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that does not inherit from </font></font><code>GameObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and add an instance of this object to the scene </font></font><code>Stage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at a random position every two seconds. The instance </font></font><code>Circle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">must destroy itself at a random time interval from 2 to 4 seconds. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the solution to exercise 1, the function is applied</font></font><code>random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Improve this function so that it receives only one value instead of two and generates a random real number from 0 to a value in this case (when only one argument is obtained). </font><font style="vertical-align: inherit;">Also improve function so that values </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can be reversed, that is, to the first value may be greater than the second. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">51.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is the purpose of </font></font><code>local opts = opts or {}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the function </font></font><code>addGameObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part 4: Exercises </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous three parts, we looked at a lot of code that is not directly related to the game. All this code can be used regardless of the game you create, so I call it code for myself </font></font><code>engine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, although I understand that in fact it is not an engine. The further we progress in the game, the more and more I will add code belonging to this category, which can be used in various games. If you want to take the most important of these tutorials, then this should definitely be the code. He was very welcome to me many times. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before proceeding to the next part, where we proceed to the game itself, we need to fully master some of the concepts discussed in the previous parts, so I will give additional exercises. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function </font><font style="vertical-align: inherit;">inside a class.</font></font><code>getGameObjects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> which will work as follows: </font></font><br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--      Enemy all_enemies = area:getGameObjects(function(e) if e:is(Enemy) then return true end end) --        50 healthy_objects = area:getGameObjects(function(e) if e.hp and e.hp &gt;= 50 then return true end end)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It receives the function that receives the game object and performs its check. </font><font style="vertical-align: inherit;">If the check result is true, then the game object is added to the table that is returned after completion of execution </font></font><code>getGameObjects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What values are </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font><br><br><pre> <code class="lua hljs">a = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> b = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> c = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> d = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> e = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> f = (<span class="hljs-number"><span class="hljs-number">4</span></span> &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> g = (<span class="hljs-number"><span class="hljs-number">3</span></span> &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">54.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a function </font></font><code>printAll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that takes an unknown number of arguments and prints them all to the console. </font></font><code>printAll(1, 2, 3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will output 1, 2 and 3 </font></font><code>printAll(1, 2, 3, 4, 5, 6, 7, 8, 9)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the console </font><font style="vertical-align: inherit;">, and </font><font style="vertical-align: inherit;">will output numbers from 1 to 9 to the console. The number of arguments passed is unknown and may vary. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Similar to the previous exercise, create a function </font></font><code>printText</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that receives an unknown number of lines, which performs their concatenation into a common string and outputting this string to the console. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">56.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to start a garbage collection cycle? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">57.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to show how much memory your Lua program takes? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to cause an error that will stop the execution of the program and give an arbitrary error message? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a class</font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drawing a rectangle with a width and height at the creation position. Create 10 instances of this class at random positions with random width and height. When clicked, a </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">random instance should be deleted from the environment. When the number of copies reaches 0, 10 more new copies with random width and height should be created in random positions of the screen. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">60.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a class</font></font><code>Circle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drawing a circle with some radius in the creation position. Create 10 copies of this class in random positions on the screen with a random radius and with an interval of 0.25 seconds between each copy. After creating all instances (that is, after 2.5 seconds), start deleting one random instance every [0.5, 1] ‚Äã‚Äãseconds (random number from 0.5 to 1). After deleting all instances, repeat the entire process of recreating 10 instances and their sequential deletion. This process should be repeated endlessly. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">61.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function </font><font style="vertical-align: inherit;">inside the class </font></font><code>queryCircleArea</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that works as follows:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--     'Enemy'  'Projectile'    50   100, 100 objects = area:queryCircleArea(100, 100, 50, {'Enemy', 'Projectile'})</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">She gets the position </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>radius</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and a list of strings containing the names of the target classes. Then it returns all the objects that belong to these classes and are inside a circle </font></font><code>radius</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a </font><font style="vertical-align: inherit;">radius </font><font style="vertical-align: inherit;">centered on the position </font></font><code>x, y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">62.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a </font></font><code>Area</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function </font><font style="vertical-align: inherit;">inside the class </font></font><code>getClosestGameObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that works like this:</font></font><br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--     'Enemy'    50   100, 100 closest_object = area:getClosestObject(100, 100, 50, {'Enemy'})</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It takes the same arguments as the function </font></font><code>queryCircleArea</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but returns only one object (closest). </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">63.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How can we check if a method exists in an object before calling it? </font><font style="vertical-align: inherit;">And how to check if an attribute exists before using its value? </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How can I write the contents of one table to another with just a loop </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font></font><br><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you like this series of tutorials, then you can stimulate me to write something similar in the future:</font></font><br><br><ul><li> <a href="http://store.steampowered.com/app/760330/BYTEPATH/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BYTEPATH game on Steam</font></font></a> </li><li> <a href="https://ssygen.itch.io/bytepath-tutorial" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BYTEPATH tutorial on itch.io</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> By purchasing a tutorial on itch.io, you will have access to the complete source code of the game, answers to the exercises from parts 1-9, the code broken into parts of the tutorial (the code will look like it should look at the end of each part) and the key games on Steam. </font></font></div><p>Source: <a href="https://habr.com/ru/post/349276/">https://habr.com/ru/post/349276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349266/index.html">PaEndpointBundle - an alternative to symfony controllers</a></li>
<li><a href="../349268/index.html">Issue # 11: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../349270/index.html">Student Insider: Keyhole News</a></li>
<li><a href="../349272/index.html">Basic security practices for iOS applications</a></li>
<li><a href="../349274/index.html">"Calendar tester" for February. Know your customer</a></li>
<li><a href="../349280/index.html">Room: One to many</a></li>
<li><a href="../349282/index.html">Hamster Marketplace development team: how our outsourcer became a partner and why AI is to blame</a></li>
<li><a href="../349284/index.html">Sign symbol: iOS denial of service</a></li>
<li><a href="../349286/index.html">How to buy 1C</a></li>
<li><a href="../349288/index.html">RoboCon 2018: Robot Framework First Conference Report</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>