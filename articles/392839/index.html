<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal Controller Module for Internet of Things</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K66BLEZ1 - module board for the development of a wide class of devices mainly in the field of IoT , wearable electronics and small automation. It feat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal Controller Module for Internet of Things</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/62b/697/72e/62b69772e4f918cccbd28124f788ed80.png"><br><br>  <b><font color="#FF0000">K66BLEZ1</font></b> - module board for the development of a wide class of devices mainly in the field of <b>IoT</b> , wearable electronics and small automation.  It features a variety of I / O ports and interfaces, which gives it extraordinary versatility.  Created on the latest NXP microcontrollers from the <b>Kinetis</b> family.  It has onboard a radio module with support for <a href="https://ru.wikipedia.org/wiki/Bluetooth_%25D1%2581_%25D0%25BD%25D0%25B8%25D0%25B7%25D0%25BA%25D0%25B8%25D0%25BC_%25D1%258D%25D0%25BD%25D0%25B5%25D1%2580%25D0%25B3%25D0%25BE%25D0%25BF%25D0%25BE%25D1%2582%25D1%2580%25D0%25B5%25D0%25B1%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5%25D0%25BC"><b>Bluetooth LE 4.2</b></a> and <a href="https://ru.wikipedia.org/wiki/ZigBee"><b>ZigBee</b></a> .  There are also connectors for <b>microSD</b> cards and <b>USB 2.0 HS</b> with support for the <font color="#FFBF01"><b><i>device</i> , <font color="#FFBF01">host</font> , <font color="#FFBF01">OTG</font></b></font> modes and a 3.6 V lithium battery charger. On the bottom side there are two connectors of <b>60 contacts</b> each.  There is a non-volatile real-time clock with a separate battery.  The fee is accompanied by <b>open source software</b> . <br><a name="habracut"></a><br><br><h1>  Briefly about the board. </h1><br>  The board has two microcontrollers: <a href="http://www.nxp.com/products/microcontrollers-and-processors/arm-processors/kinetis-cortex-m-mcus/k-series/k6x-ethernet-mcus/kinetis-k66-180-mhz-ethernet-hs-usb-256kb-sram-microcontrollers-mcus:K66_180"><b>MK66FN2M0VLQ18</b></a> <b>(180 MHz, 2 MB Flash, 256 KB RAM)</b> and <a href="http://www.nxp.com/products/microcontrollers-and-processors/arm-processors/kinetis-cortex-m-mcus/w-series/kinetis-bluetooth-low-energy-802.15.4-wireless-mcu:KW40Z%3Flang_cd%3Den"><b>MKW40Z160VHT4</b></a> <b>(48 MHz, 160 KB Flash, 20 KB RAM)</b> .  The first for the main application and the second for wireless communication.  The 90 signal pins of the MK66 microcontroller are routed to two external connectors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table><tbody><tr><td>  Module board 6 layer with an integrated <b>PCB antenna</b> at 2.4 GHz. <br>  Material - high temperature textolite FR4, <br>  allowing repeated soldering. <br>  Coating - <font color="#FFC000"><b>Immersion</b> <font color="#FFC000">gold</font> <font color="#FFC000">ENIG</font></font> . <br><br> <a href=""><img align="left" width="272" src="https://habrastorage.org/getpro/geektimes/post_images/665/d7d/8f2/665d7d8f24ace19cd49cc243e13ae68d.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br></td><td>  The built-in antenna can be replaced with a remote soldered to the board connector type UMC. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/4a2/264/241/4a226424140da7df2e2bfe86a7d3f1ed.png"><br><br>  Dimensional drawing of the module. <br> <a href=""><img align="left" width="456" src="https://habrastorage.org/getpro/geektimes/post_images/c06/25d/b01/c0625db01bc10c33c6232986ce54b5a0.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br></td></tr><tr><td>  Created a schematic and <b>constructive (3D)</b> component of the module for the <b>Altium Designer</b> development environment. <br>  Module component files can be found in the repository at the link at the end of the article. <br><br> <a href=""><img align="left" width="432" src="https://habrastorage.org/getpro/geektimes/post_images/68e/242/812/68e242812defe0925bdb142ecb25562c.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br></td><td>  Representation of the module circuit element in the <b>Altium Designer</b> environment <br><br> <a href=""><img align="left" width="501" src="https://habrastorage.org/getpro/geektimes/post_images/60e/16e/156/60e16e156f146bbcc4784a9490ab0bae.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br></td></tr></tbody></table><br><br><h1>  Scheme of the module K66BLEZ1. </h1><br><div class="spoiler">  <b class="spoiler_title">Click here</b> <div class="spoiler_text"> <a href=""><img align="left" width="1010" src="https://habrastorage.org/getpro/geektimes/post_images/dad/661/0bd/dad6610bdd805842678e37742e60e402.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br> <a href=""><img align="left" width="1010" src="https://habrastorage.org/getpro/geektimes/post_images/4d1/2c5/214/4d12c5214997c3fc8f010a1acdcce6e4.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br> <a href=""><img align="left" width="1010" src="https://habrastorage.org/getpro/geektimes/post_images/4e3/f4c/1c6/4e3f4c1c6b2579a7fdb6229ac4d2edfb.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br></div></div><br>  Most of the conclusions of the microcontroller <a href="http://www.nxp.com/products/microcontrollers-and-processors/arm-processors/kinetis-cortex-m-mcus/k-series/k6x-ethernet-mcus/kinetis-k66-180-mhz-ethernet-hs-usb-256kb-sram-microcontrollers-mcus:K66_180"><b>MK66FN2M0VLQ18</b></a> are derived to two external connectors.  The connectors are selected so that it is convenient to connect and disconnect the module from the motherboard. <br>  Power is connected to the board either via a USB connector or via expansion connectors X6, X7.  The <b>BQ24296RGET</b> charger <b>chip</b> provides a reliable autonomous charge of a lithium battery from USB with control of current, voltage and battery temperature. <br><br><h1>  The procedure for starting the board to work. </h1><br><br><h1>  Step one.  Power supply to the module. </h1><br>  Power is supplied by connecting the USB cable.  The current consumption does not exceed 100 mA so any USB host interface of the computer is suitable.  While in the microcontroller there is no program, the computer does not react to the connection of the module via USB. <br>  But on the module the ‚ÄúPwrGood‚Äù LED should turn on.  The ‚ÄúCharger‚Äù LED should flash, this indicates that the battery is not connected.  LED "CPU" is serviced by software, so it also does not light up. <br><br><h1>  Step two.  Connecting the JTAG / SWD adapter and checking the operability of the SWD channels. </h1><br>  Microcontrollers on the board have separate connectors for connecting debug adapters via the <b>SWD</b> interface.  The K66 microcontroller allows for a 3-wire <b>SWD</b> connection with a <b>SWO</b> signal (X3 connector), and the MKW40 microcontroller allows only a 2-wire connection (X4 connector).  But this does not impose restrictions on the debug adapter, and it can be the same for both microcontrollers. <br>  I use the <a href="https://www.segger.com/jlink-ultra-plus.html"><b>J-Link</b></a> adapter for debugging.  Debug connectors on the module with 1.27 mm pitch.  Therefore, we had to make a special adapter from the standard adapter connector to the module connector as shown in the photo below. <br> <a href=""><img align="left" width="466" src="https://habrastorage.org/getpro/geektimes/post_images/b75/d64/739/b75d6473992a9354b813439a5210f864.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  Although the <a href="https://www.segger.com/jlink-ultra-plus.html"><b>J-Link</b></a> adapter is the best in its class, it is possible to use cheaper debuggers, such as <a href="http://www2.st.com/content/st_com/en/products/development-tools/hardware-development-tools/development-tool-hardware-for-mcus/debug-hardware-for-mcus/debug-hardware-for-stm32-mcus/st-link-v2.html"><b>ST-Link</b></a> , for debugging. <br>  To test the performance of debugging and programming channels, I use the utility from <b>Segger JFlash</b> . <br>  This utility allows you to view the status of all memory areas of the chip, test the speed of the interface, and program the flash memory of the chips. <br> <a href=""><img align="left" width="421" src="https://habrastorage.org/getpro/geektimes/post_images/4fd/691/aa2/4fd691aa2feb2f0d14518c11724598e2.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br> <a href=""><img align="left" width="238" src="https://habrastorage.org/getpro/geektimes/post_images/8b5/801/b04/8b5801b04f2aef5074006ff401a2ccc5.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  Using <b>JFlash, I</b> managed to connect and check both chips on the module. <br><br><h1>  Step three.  Testing the first program for the microcontroller K66 </h1><br>  However, the first program will not be Hello Word and not even a flashing LED. <br>  As a first test, we will immediately select an external disk emulator via USB and <font color="#FF0000"><b>a</b> <font color="#FF0000">video camera</font> <font color="#FF0000">USB</font> <b>emulator</b></font> . <br>  This is possible because the module circuit repeats the scheme of the debug board <a href="http://www.nxp.com/products/software-and-tools/hardware-development-tools/freedom-development-boards/freescale-freedom-development-platform-for-kinetis-k66-k65-and-k26-mcus:FRDM-K66F">FRDM-K66F.</a> <br><br>  But first you had to download the <b>SDK</b> with examples of programs. <br>  The <b>SDK</b> is created for the board with a special online tool on <i>NXP.com</i> at <a href="http://kex.freescale.com/en/summary%3Fcas_auth%3D1">http://kex.freescale.com/en/summary?cas_auth=1</a> (you will have to register on the site for this) <br>  In the dialogue, select the microcontroller <b>MK66FN2M0xxx18</b> <b><br></b>  The dialog box will look like below: <br> <a href=""><img align="left" width="1010" src="https://habrastorage.org/getpro/geektimes/post_images/b9c/b6d/bf0/b9cb6dbf0a89ce2d936c7997f9d91fab.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br>  At once it is necessary to determine the development environment in which the SDK will be compiled.  You can choose one of the list or all at once.  The list includes both commercial IDEs and freeware: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/f04/0d9/be0/f040d9be0414826cc98ab3ead744b94b.png"><br>  I traditionally choose <b>IAR</b> .  My <a href="https://geektimes.ru/post/264558/">recent research on compiler choice has</a> once again shown that IAR is still out of competition, at least for <b>ARM Cortex-M4</b> . <br>  <b>An SDK</b> will be created with embedded <b>sample</b> applications and peripheral tests for the <b>frdmk66f</b> and <b>twrk65f180m boards</b> .  Practically all the examples for the frdmk66f board are also suitable for our <b>K66BLEZ1</b> board.  Since the quartz resonators of these boards have the same frequency and the <b>K66BLEZ1</b> matches the connection of the SD card and the USB HS interface. <br><br>  Examples were tested: <font color="#7030A0">usb</font> _ <font color="#7030A0">device</font> _ <font color="#7030A0">cdc</font> _ <font color="#7030A0">vcom</font> , <font color="#7030A0">usb</font> _ <font color="#7030A0">device</font> _ <font color="#7030A0">cdc</font> _ <font color="#7030A0">vcom</font> _ <font color="#7030A0">lite</font> , <font color="#7030A0">usb</font> _ <font color="#7030A0">device</font> _ <font color="#7030A0">msc</font> _ <font color="#7030A0">sdcard</font> , <font color="#7030A0">usb</font> _ <font color="#7030A0">device</font> _ <font color="#7030A0">video</font> _ <font color="#7030A0">virtual</font> _ <font color="#7030A0">camera</font> . <br><br>  The <font color="#7030A0"><font color="#7030A0">write</font></font> to the SD card in the <font color="#7030A0"><b>usb</b> _ <font color="#7030A0">device</font> _ <font color="#7030A0">msc</font> _ <font color="#7030A0">sdcard example</font></font> was rather low - 200 KB / s., Reading - 1 MB / s. <br>  In the <font color="#7030A0"><b>usb</b> _ <font color="#7030A0">device</font> _ <font color="#7030A0">video</font> _ <font color="#7030A0">virtual</font> _ <font color="#7030A0">camera</font></font> example, <b>PotPlayer x64 was</b> used to view the video.  A screenshot of the video embedded in the microcontroller is shown below. <br> <a href=""><img align="left" width="418" src="https://habrastorage.org/getpro/geektimes/post_images/305/82e/9f0/30582e9f03c8ddd1746ddea78fe2f9dd.png"><br clear="left"></a>  <a href=""><em>(Click to enlarge)</em></a> <br><br><h1>  Total </h1><br>  The board showed reliable performance.  The USB interface was tested at full speed of 480 Mbps.  All USB drivers on the PC side are also working.  Debugging mechanisms of both processors work without failures including SWD, tracing and virtual COM port.  Further testing will be continued in the following articles. <br><br>  <b>All materials related to this project are stored here</b> - <a href="https://github.com/Indemsys/K66BLEZ1">https://github.com/Indemsys/K66BLEZ1</a> </div><p>Source: <a href="https://habr.com/ru/post/392839/">https://habr.com/ru/post/392839/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../392829/index.html">PO2RT: coworking on top</a></li>
<li><a href="../392831/index.html">Mobile weather station at Arduino</a></li>
<li><a href="../392833/index.html">Wireless adapter for programming Arduino or AVR with a bootloader based on ESP8266</a></li>
<li><a href="../392835/index.html">Right holders on Telegram to Google</a></li>
<li><a href="../392837/index.html">Maintaining servo position: slave control vs stepping mode</a></li>
<li><a href="../392841/index.html">Epson projectors and mobile presentations - tips on choosing a projector</a></li>
<li><a href="../392843/index.html">What distance should an autonomous car drive to prove its reliability?</a></li>
<li><a href="../392845/index.html">SpaceX has posted photos of the most successful launch of the Falcon 9 spacecraft in its history</a></li>
<li><a href="../392847/index.html">The project of the Angara A5B heavy launch vehicle approved, which will deliver the Russians to the moon</a></li>
<li><a href="../392851/index.html">Robots-waiters caused the closure of several restaurants in China</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>