<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Software generation of PDF forms on ABAP or how to get rid of problems with SPOOL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How it all began 
 The specifics of the company in which I work, implies close contact and cooperation with our clients. One of these business process...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Software generation of PDF forms on ABAP or how to get rid of problems with SPOOL</h1><div class="post__text post__text-html js-mediator-article"><h4>  How it all began </h4><br>  The specifics of the company in which I work, implies close contact and cooperation with our clients.  One of these business processes is sending out various documents both by mail and on paper to our <s>not favorite</s> mail in envelopes.  Standard functionality that allows you to generate printable PDF forms and print them or publish somewhere in binary form uses background tasks and SPOOL print data. <br>  At first everything was fine, the data was formed, the customers were satisfied.  But at one moment everything was covered with a ‚Äúcopper basin‚Äù, the volumes of the printed plates were significantly increased, and SPOOL began to ‚Äúbecome infected‚Äù, which led to terrible brakes of the entire server part.  I want to tell about one of the ways to solve this problem in this article. <br><a name="habracut"></a><br><h4>  Go </h4><br>  As is usually the case, first of all, everyone runs with similar problems to the basists, who are responsible for running the server side and optimizing a heap of various settings in the configuration files.  What is the result: a lot of SAP Notes was read, forums were studied, then changes of parameters began, something gave a small performance boost, somewhere in the opposite.  But in the end result, the desired effect was not received.  Of course, the pressure of management and dissatisfied customers increased, since the formation of documents took more and more time and there was no question of any customer focus, which adversely affected the company's prestige.  As a result, it was decided to try to deal with the problem at the program level. <br>  Enough preludes, let's move on to the technical side of the issue. <br><br><h4>  Base code analysis </h4><br>  At first, I decided to figure out how the standard functionality for generating PDF forms still works, as a result of Drill down, I came across a package of <b>SAFP</b> , which opened my eyes to everything that happens and it seems the floor of the matter has already been decided.  After analyzing the examples of programs, I found out that the following main tasks arose for me: <br><ol><li>  Create an XFT form file; </li><li>  Generate an XFD file containing the data; </li><li>  Get a binary file and a PDL file that the printer understands; </li></ol><br><h4>  Create an XFT Form File </h4><br>  There were two solutions for me, either to create this file myself and store it somewhere on the application server, which would be unwise from the point of view of support and updating, or not to invent a bicycle and immediately receive a link to a ready-made form that is convenient to edit and test through an SFP transaction.  Let's take the path of least resistance: <br><pre><code class="bash hljs">DATA: l_xdp TYPE fpwbformname VALUE <span class="hljs-string"><span class="hljs-string">'ZTEST'</span></span>, <span class="hljs-string"><span class="hljs-string">"   l_xft TYPE string, "</span></span>       l_except TYPE REF TO cx_fp_api_repository. <span class="hljs-string"><span class="hljs-string">"    TRY. cl_fp_wb_helper=&gt;form_layout_exists( i_name = l_xdp ). CATCH cx_fp_api_usage. "</span></span><span class="hljs-comment"><span class="hljs-comment">#EC NO_HANDLER CATCH cx_fp_api_repository INTO l_except. IF l_except-&gt;textid = cx_fp_api_repository=&gt;object_already_exists. l_xft = cl_fp_wb_helper=&gt;form_layout_url( i_name = l_xdp i_dest_path = 'X' ). ELSE. MESSAGE ID 'FPRUNX' TYPE 'E' NUMBER '050' WITH sy-langu. ENDIF. ENDTRY.</span></span></code> </pre> <br>  Here we check if there is a form in the system with the given name and if we get a positive answer, then we read the path to this form. <br><br><h4>  Generating an XFD file containing data </h4><br>  Generating a PDF file is still half the battle.  We need to fill it with data, in order to do this we need to generate a file with XFD data, which is a regular xml file.  The best solution for me was to use transformations.  So let's get started. <br>  How can we find out how the file should look like after transformation, so that it can be successfully applied to our form?  It is very simple to do this, go to the SFP transaction, open the form we need and enable debugging, as shown in the figures below: <br><div class="spoiler">  <b class="spoiler_title">Form debug mode</b> <div class="spoiler_text">  We select in the form Settings <br><img src="https://habrastorage.org/getpro/habr/post_images/15c/4a1/19c/15c4a119c8502f83b19b4262c83fc381.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, set the debug mode, it will allow us after the output of the printed form to get the files in the attachment <br><img src="https://habrastorage.org/getpro/habr/post_images/0f3/144/78d/0f314478d313c46ad17999f710f6f6aa.png"><br><br>  We launch the printed form for a test and get the necessary files in the PDF attachment, we are interested in XFD.xml <br><img src="https://habrastorage.org/getpro/habr/post_images/0dc/ac6/eb5/0dcac6eb5b2e1ee824aeb39c2cfd9261.png"><br></div></div><br>  So, we have received the data file for the printed form, now it will not be difficult for us to create a transformation and call it further: <br><pre> <code class="bash hljs">CALL TRANSFORMATION ztest_trans SOURCE is_data = it_data RESULT XML xstr.</code> </pre><br><h4>  Get a binary file and a PDL file that the printer understands </h4><br>  So, we have everything necessary to form a printed form.  The truth is there is one nuance.  In nature, as it turned out, there are various types of printers, some are color, others are not.  For a certain group of printers, so-called XSD templates are used, which are used to generate PDF files.  More details about their types and classification are written <a href="http://help.adobe.com/en_US/livecycle/9.0/workbenchHelp/help.htm%3Fcontent%3D001154.html">here</a> . <br>  We will use hppcl5c.xdc, as it is ideally suited for our task, including allowing it to print on a color printer.  What we got: <br><div class="spoiler">  <b class="spoiler_title">Some code</b> <div class="spoiler_text"><pre> <code class="bash hljs">DATA: l_fp TYPE REF TO if_fp, l_pdfobj TYPE REF TO if_fp_pdf_object, pdfresult TYPE xstring, pdlresult TYPE xstring. *  ADS- MOVE cl_fp=&gt;get_ads_connection( ) TO l_dest. *  FP reference l_fp = cl_fp=&gt;get_reference( ). TRY. *   PDF l_pdfobj = l_fp-&gt;create_pdf_object( connection = l_dest ). *   ,     l_pdfobj-&gt;set_template( xftfile = l_xft ). *     l_pdfobj-&gt;set_data( formdata = l_xfd ). *   PDF  PDF *       ,       l_pdfobj-&gt;set_task_renderpdf( ). *   PDF  PDL  CALL METHOD l_pdfobj-&gt;set_task_renderpdl EXPORTING pdltype = <span class="hljs-string"><span class="hljs-string">'pcl'</span></span> pdlfile = <span class="hljs-string"><span class="hljs-string">''</span></span> xdcname = <span class="hljs-string"><span class="hljs-string">'hppcl5c.xdc'</span></span>. DATA: form TYPE string. form = i_fpwbformname. l_pdfobj-&gt;set_application_form_identity( application = <span class="hljs-string"><span class="hljs-string">'SAFP'</span></span> form = form ). *   ,  ADS TRY. l_pdfobj-&gt;execute( ). CATCH cx_fp_runtime_internal cx_fp_runtime_system cx_fp_runtime_usage. <span class="hljs-string"><span class="hljs-string">"#EC NO_HANDLER ENDTRY. *     XSTRING l_pdfobj-&gt;get_pdf( IMPORTING pdfdata = pdfresult ). CALL METHOD l_pdfobj-&gt;get_pdl IMPORTING pdldata = pdlresult. ENDTRY.</span></span></code> </pre><br></div></div><br><h4>  Results </h4><br>  As a result, after applying this approach, it was possible to completely eliminate SPOOL as such in the chain.  This allowed us to create fairly large volumes of print forms in the background without loading the server, currently about 5000 documents in 3 hours.  It is worth noting that this approach also allows you to perform other operations with PDF, such as a digital signature on the server side.  You can learn more about the examples in the package I mentioned above in the <b>SAFP</b> article. </div><p>Source: <a href="https://habr.com/ru/post/201280/">https://habr.com/ru/post/201280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201264/index.html">Do-it-yourself duplicator slide</a></li>
<li><a href="../201266/index.html">Registration of participants of the InfoTeKS Academy program 2013-2014 has opened</a></li>
<li><a href="../201268/index.html">SqliteDog - modern SQLite database manager</a></li>
<li><a href="../201270/index.html">Is LTE in our area?</a></li>
<li><a href="../201272/index.html">Writing a bot for Grepolis</a></li>
<li><a href="../201282/index.html">How to find a logistics partner or why you do not need to wait for a steam locomotive</a></li>
<li><a href="../201284/index.html">Manageability of complex networks - translation of the article Controllability of complex networks</a></li>
<li><a href="../201286/index.html">COLT released with TypeScript support</a></li>
<li><a href="../201292/index.html">Using COLT annotations in front-end development</a></li>
<li><a href="../201296/index.html">Google Product Ads: Debriefing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>