<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I made a motion capture suit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 In my small town I deal with non-trivial technical problems. So this time, the organizers of one show, in which the gymnast was supposed to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I made a motion capture suit</h1><div class="post__text post__text-html js-mediator-article"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/CTQ7xARt_Kg%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhTwT1HpWXmpr004wbCT6E2TBVLFw" frameborder="0" allowfullscreen=""></iframe><br><br><h3>  Foreword </h3><br>  In my small town I deal with non-trivial technical problems.  So this time, the organizers of one show, in which the gymnast was supposed to perform with her program, decided to add some ‚Äúzest‚Äù to her performance.  Namely, to display the silhouette of a gymnast who would repeat her movements and somehow interact with other effects, so that everything would be interactive.  Solve the problem "in the forehead" failed.  Kinect was clearly unable to cope with his task and was not able to capture the movements of a person who is at least 10 meters away from him, also in the dark.  So it was decided to do something "own".  Looking ahead, I will say that the performance did not take place, but I was so excited about the idea that I continued my experiments as a separate project, which was later called <b>impulse</b> . <br><a name="habracut"></a><br><h3>  Beginning of work </h3><br><img src="https://habrastorage.org/files/f26/445/a19/f26445a193f1449c9e8e2857baf7405f.JPG"><br><br>  I started prototyping the future device as soon as I got the necessary components.  Namely: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>Arduino UNO</b> is a well-known designer controller that allows you to develop a prototype in a short time. </li><li>  <b>HC-06</b> - bluetooth module, will serve as a means of wireless communication.  The module is very simple, has a UART-interface. </li><li>  <b>The MPU-6050</b> is the only inertial sensor available to me at the time.  I got 2 at once to check how they work in pairs, because in the future it is necessary to use up to 15 sensors in one system.  This sensor combines an accelerometer and a gyroscope, as well as a temperature sensor to adjust the output data. </li></ul><br>  After getting everything from this list, I was already eager to see mpu in action.  The official Arduino forum was attended by several examples of using these sensors, one of which I used.  To connect the sensors using 5 pins (contacts): <br><br><ul><li>  <b>VCC, GND</b> - everything is clear, food and earth.  It is worth noting that the operating voltage of the sensor is 3.3v, but at 5v it feels good.  Power consumption less than 0.05Ah </li><li>  <b>SCL, SDA</b> - actually pins, which is "communication" with the sensor.  These pins are responsible for the i2c interface.  This interface implements switching between devices on one bus, in other words, a bus is a street, and at home there are devices. </li><li>  <b>INT</b> - pin for interrupts.  As soon as the data on the sensor is ready, the main controller takes it on interruption. </li></ul><br>  However, this example output only ‚Äúraw‚Äù values ‚Äã‚Äãfrom the accelerometer to the terminal, and the code was written to convert to familiar angles, and then the Kalman Filter was implemented, and all of this together took up about 70% of the Arduino UNO resources.  Nevertheless, quite smooth values ‚Äã‚Äãof angles came to the terminal, the device was rather quickly oriented in space, though only a couple of minutes, after which the FIFO buffer was full.  But It worked! <br><br><img src="https://habrastorage.org/files/259/340/395/2593403950cb4e3abab2545a926172db.jpg"><br><br><h3>  Stabilize! </h3><br>  Gradually, the joy of the working sensor was overshadowed by the duration of the entire system.  How much I did not struggle with the FIFO buffer, it overflowed.  Here it is worth noting that at that time there was little information about these sensors and similar systems in general, and it had to be collected literally bit by bit.  Having decided that the problem lies in the implementation of the i2c interface, I started to google in this direction and found the I2Cdev user library, designed to replace the standard wire library for arduino.  A nice surprise was the nested examples of using this library in conjunction with mpu-6050.  Having rebuilt the project at this library, I also received raw data and converted them to corners with my code, but there were no overflows anymore.  This was a small victory.  In the future, studying the insides of the library, I found a lot of useful.  So for example, data from both sensors - both the accelerometer and a gyroscope are now used.  The fact is that the accelerometer allows to determine the exact angles of inclination of the device only at rest, while external forces do not act on it, and the gyroscope is designed to compensate for these same forces.  Obvious was the use of data from both sensors, and here the complementary filter was used.  However, there was a problem of zero drift, but more on that later. <br><br><h3>  More sensors! </h3><br>  And again the underwater stone.  This time the problem that appeared before me was to use the second mpu-6050 sensor.  I have already given an analogy of the i2c interface in this article, where the bus is the street and the devices are at home.  Imagine that a data packet that must reach a certain device is a postman.  The postman needs 2 things - the package and the address, and each house has its own unique address, and the devices must have their own addresses.  The problem lies precisely in the address of the mpu-6050 sensor, it is one for all such sensors - 0x68.  This address is flashed to the sensor controller still at the factory, and it is not possible to find the firmware and change the address for each sensor.  Zabugornye forums gave one solution - connecting sensors one after another, one leg of the first sensor connects to pin AD0 of the second, and becomes available at 0x69, but this method involves using no more than 2 mpu and I immediately dropped it. <br><br>  The solution became transistors.  The idea was to put a pair of transistors on pins i2c in front of each sensor and open them alternately.  The algorithm is simple - it is necessary to read the data from the 5th sensor, close all the gates except the 5th (or open it if necessary) and read it, then in the same way we obtain data from the others.  The result can be seen on the first photo in this article, and it is quite a workable.  In a similar way, I managed to connect 4 sensors, this did not affect stability in the best way, and when I ran out of transistors, I decided to use more compact and stable chips. <br><br><div class="spoiler">  <b class="spoiler_title">connection diagram</b> <div class="spoiler_text"><img src="https://pp.vk.me/c623918/v623918632/242d1/rgAe7cYssRA.jpg" alt="image"><br></div></div><br>  The only surviving photo from that stage (I apologize for the quality): <br><br><img src="https://habrastorage.org/files/7d1/135/e07/7d1135e0756b487291d40f9bb676f84c.jpg"><br><br><h3>  Gate controller </h3><br>  A device that combines these chips and allows you to communicate with a variety of mpu sensors, I called the gate controller.  I was helped to make it by a good friend who already had experience with etching boards, and I needed a quality that my previous attempts at etching did not possess.  Because of the multitude of intersecting tracks, a two-layer board was required, but a multilevel one was used as a prototype.  The result of this work was such an unusual fee: <br><br><div class="spoiler">  <b class="spoiler_title">piping hot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/e2a/165/661/e2a165661f974469a314f11cc4c2e469.jpg"><br><br><img src="https://habrastorage.org/files/7f5/a40/6bf/7f5a406bf0804747870744a54c95fd16.jpg"><br><br><img src="https://habrastorage.org/files/62b/d84/c90/62bd84c907d84196980a3ac7436f91b6.jpg"><br></div></div><br>  Now it remains to check the device in action.  Having connected 10 sensors at once, exactly as many pleasant messages about successful initialization appeared in the monitor - the device works! <br><br><img src="https://habrastorage.org/files/b9b/d0b/6aa/b9bd0b6aa1dc4db594331cdb3ad68546.jpg"><br><br><h3>  Gimble lok, quaternions, visualization </h3><br>  Gimble lok, in Russian a hinged lock or folding frames is an unpleasant phenomenon in the field of gyroscopes and, in some cases, orientation in space.  Without a long explanation of this phenomenon (there are well-explained and illustrative videos on this topic), I would just say that this very hinged lock does not allow the sensor to turn all 360. The XZ axis (deviations from the horizontal plane) are limited from about -45 to 45 degrees, and are not identified correctly beyond these limits.  Having studied this topic in more detail, it turned out that the solution is under my nose.  The MPU-6050 is a six-axis sensor, and they have dmp on board.  Dmp (Digital Motion Processor) deals with everything that I have written for so long in the main code for the main controller firmware, and even filters the values.  In addition, dmp can output data in the form of quaternions, which allows you to bypass the hinge lock, as well as it allows to reduce the size of packets sent.  At this moment, my acquaintance with the Quaternions continued, earlier I worked with them in Unity3D and had some idea.  In simple terms, a quaternion is a system of numbers (4 numbers) that describes the rotation of something in space.  Just remembering about Unity, I tried to portray something like this: <br><br><img src="https://habrastorage.org/files/355/2f0/8af/3552f08af1894612a5b471b925bea04c.jpg"><br><br><h3>  Controller </h3><br>  Arduino and the gate controller were completely justified, but their use in the final version was not intended.  It's time to make the controller, specific and sharpened for a specific task.  By that moment, I pretty much modified the firmware for the future controller, configured the dmp in the optimal way, which made it possible to stop using interrupts.  Thus, each sensor was connected on four pins, not five, as before.  It also eliminated the need for two out of six microcircuits in the gate controller.  All these improvements led to the fact that the board for the future device was designed in 2 directions, and no ‚Äúhigher level‚Äù was required anymore. <br><br><img src="https://habrastorage.org/files/31f/775/f7c/31f775f7c79d4e48ae9040de639f7423.jpg"><br><br><h3>  Housing </h3><br>  The device gradually acquired its final appearance, and the next step was to make the body logical.  The obvious solution is to order or access 3D printing services.  But this is all simple and uninteresting, so for a couple of c friend purchased their own 3D printer.  Due to the absence of any instructions, it was collected on an intuitive level, but everything worked out.  In general, the assembly, configuration, and the preparation for printing itself deserve a separate article, but this is not about that now.  Using all the test material, it remained only to wait until the ABS-plastic came. <br><br><div class="spoiler">  <b class="spoiler_title">3D Printer</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/bbc/056/aaa/bbc056aaa4064ea78df1eeae31a18f2f.jpg"><br><br><img src="https://habrastorage.org/files/48b/036/d00/48b036d00adf413c91f7b181fb4467bc.jpg"><br></div></div><br>  Program 123D-Design was chosen for the simulation.  The program is intuitive, and anyone who has at least a little experience in editors of three-dimensional graphics will quickly master it. <br><br><img src="https://habrastorage.org/files/9f0/483/b37/9f0483b377fa412184e34da4279474d0.jpg"><br><br>  Then I printed all the cases, connected the sensors to the controller through thin 4-pin contact wires, made fixtures for the sensors, put everything together and got a ready-made, autonomous, wearable suit.  For the first prototype is quite suitable. <br><br><img src="https://habrastorage.org/files/79c/90d/563/79c90d5635b24bda8618413264aaafa8.jpg"><br><br><img src="https://habrastorage.org/files/406/73f/d6c/40673fd6c5734cd99790a620091cb83d.jpg"><br><br><img src="https://habrastorage.org/files/3cf/615/269/3cf615269a7f4406af3109ec5b46b023.jpg"><br><br><h3>  Soft </h3><br>  Due to some circumstances, I put Unity3D ‚Äúfor later‚Äù, time was running out and I needed to quickly write a program for visualization.  I have been working with the Xors3D graphics engine for a long time (Maybe someone knows this) and this time it did not let me down.  However, after he justified himself, I did not return to Unity, but continued to develop the visual environment for the costume on this engine. <br><br><img src="https://habrastorage.org/files/177/fd5/afd/177fd5afdc4743709864ba776b3cc63f.jpg"><br><br>  List of current features: <br><br><ul><li>  Visualization - the program displays a model of a person who repeats all movements behind a person in a suit in real time </li><li>  Auto-calibration - allows you to instantly calibrate a suit at any time </li><li>  Positioning - the model also moves in space as a person can squat, walk, etc. </li><li>  Record / Play - all movements can be recorded and played. </li><li>  First-person view mode - image output is provided for oculus rift and other virtual reality helmets. </li><li>  Interactivity - a person wearing a suit can affect the virtual world.  Kicking balls, opening doors, spinning a carousel, etc.  (physical engine) </li></ul><br><h3>  Conclusion </h3><br>  At the moment, the project has 1 fully working, autonomous, wearable and wireless prototype and all the necessary software.  The development of this costume took 8 months (2 of which I rested, totaling 6), but for me this is a whole epoch.  During the project, I pumped up my skills, tried and did a lot of things that I had little knowledge of before, and was able to earn some money. <br><br>  When I started, there was only an interest ‚Äúand how does it work?‚Äù And I did not know about the existence of such suits.  However, during the development of at least 3 such projects came to crowdfunding sites, and I wanted to somehow develop impulse as a commercial project, but it is extremely difficult to declare myself sitting in the Trans-Baikal Territory.  Now there is not enough motivation to sit down at the second prototype, already wireless and based on 9-axis sensors, so most likely this project will remain for me just a huge and rewarding experience.  In this article I would like to summarize all the work done, although 20% of it is not displayed here.  Not everyone will be interested in tons of code and hours of soldering, 3d-printing, lots of trial and error, a lot of material spent, but I will try to answer such questions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/392353/">https://habr.com/ru/post/392353/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../392343/index.html">Lamp Computers: MADDIDA</a></li>
<li><a href="../392345/index.html">Chinese company Baidu introduces AI in their products, ahead of Western competitors</a></li>
<li><a href="../392347/index.html">Video: Birds of the Antarctic are able to recognize a specific person.</a></li>
<li><a href="../392349/index.html">Ideas for startups: what projects need Bitcoin-industry in 2016</a></li>
<li><a href="../392351/index.html">By 2030, India plans to fully switch to electric transport.</a></li>
<li><a href="../392355/index.html">Meteorologists have discovered the ability of the ocean to predict extreme heat for 50 days before its arrival on the mainland</a></li>
<li><a href="../392357/index.html">Fire Extinguishing Ball from Thailand: Elide Fire Extinguishing Ball</a></li>
<li><a href="../392359/index.html">Lively Chinese smartphones. Part 1</a></li>
<li><a href="../392361/index.html">Anastasia Rezhepp: ‚ÄúThe industry has started to think less about beautiful buttons‚Äù</a></li>
<li><a href="../392363/index.html">AI sneaked up too close</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>