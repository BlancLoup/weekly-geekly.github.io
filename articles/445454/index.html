<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raspberry Pi Zero inside Handy Tech Active Star 40 Braille Display</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author placed the Raspberry Pi Zero, a Bluetooth ‚Äúwhistle‚Äù and a cable inside its new Handy Tech Active Star 40 Braille display. The built-in USB ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raspberry Pi Zero inside Handy Tech Active Star 40 Braille Display</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/5i/vv/tl/5ivvtlnh3-qi8x3gtk0kzgczlt4.jpeg"><br><br>  The author placed the Raspberry Pi Zero, a Bluetooth ‚Äúwhistle‚Äù and a cable inside its new Handy Tech Active Star 40 Braille display. The built-in USB port provides power.  The result was a self-contained, ARM-free computer with a Linux operating system, equipped with a keyboard and a braille display.  You can charge / power it via USB, incl.  from a power bank or solar charger.  Therefore, it can do without the power supply for several hours, but for several days. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/so/yo/ky/soyokywncc6nvduroz7wnbngtly.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Dimensional differentiation of braille displays </h1><br>  First of all, they differ in the length of the string.  Devices with 60 or more familiarity are good when working with a desktop computer, and 40 are convenient for carrying along with a laptop.  Now there are braille displays connected to smartphones and tablets, with a line length of 14 or 18 familiarity. <br><br>  In the past, braille displays were pretty massive.  40-familiar, for example, had the size and weight of a 13-inch laptop.  Now, with the same amount of familiarity, they are miniature enough to be able to put the display in front of the laptop, and not the laptop on the display. <br><br>  This, of course, is better, but it is still not very convenient to keep two separate devices on your lap.  When working at the table, there are no complaints, but it is worth remembering that the laptop is differently called a laptop, and try to justify this name, as it turns out that the miniature 40-familiar display is even less convenient. <br><br>  So the author waited for the release of the long-promised new model in the Handy Tech Star series.  Back in 2002, the previous model Handy Tech Braille Star 40 was released, where there is enough body area to put a laptop on top.  And if it does not fit - there is a retractable stand.  Now this model is replaced by Active Star 40, it is almost the same, but with modernized electronics. <br><br><img src="https://habrastorage.org/webt/mx/tx/ba/mxtxbaqpjfxzn_j_utlp5i8nxom.jpeg"><br><br>  And the retractable stand remained: <br><br><img src="https://habrastorage.org/webt/6-/ds/hq/6-dshqxvtaajiaqqddsv9jnyqaa.jpeg"><br><br>  But the most convenient thing in the novelty is a recess about the size of a smartphone (see KDPV).  It opens when you move the site back.  It was inconvenient to hold a smartphone there, but somehow it is necessary to use the empty compartment, inside which even the power outlet is provided. <br><br>  The first thing that the author invented was to place the Raspberry Pi there, but when the display was purchased, it turned out that with the ‚Äúraspberry‚Äù the stand covering the compartment does not move.  Now, if the board was only 3 mm thinner ... <br><br>  But a colleague told about the output of the Raspberry Pi Zero, which turned out to be so tiny that it would fit two in the compartment ... or perhaps even three.  It was immediately ordered along with a 64 GB memory card, Bluetooth, a ‚Äúwhistle‚Äù and a Micro USB cable.  A few days later all this arrived, and sighted friends helped the author to prepare a map.  Everything worked right away. <br><br><h1>  What was done for it </h1><br>  On the back of the Handy Tech Active Star 40 there are two USB ports for devices such as keyboards.  Compact magnetic keyboard included.  When the keyboard is connected, and the display itself works via Bluetooth, the computer additionally recognizes it as a Bluetooth keyboard. <br><br>  Thus, if you connect a Bluetooth ‚Äúwhistle‚Äù to the Raspberry Pi Zero, placed in the smartphone compartment, it can communicate with the Braille display via Bluetooth using <a href="http://brltty.com/">BRLTTY</a> , and if you also connect a keyboard to the display, the ‚ÄúMalinka‚Äù will work and with her. <br><br>  But that's not all.  The Malinka itself, in turn, can access the Internet via Bluetooth PAN from any device supporting it.  The author has properly set up his smartphone and computers at home and at work, but in the future he plans to adapt for this another ‚Äúraspberry‚Äù - a classic, not Zero, connected to Ethernet and another Bluetooth ‚Äúwhistle‚Äù. <br><br><h1>  BlueZ 5 and PAN </h1><br>  The way to configure PAN with <a href="http://www.bluez.org/">BlueZ</a> was not obvious.  The author found a bt-pan Pyhton script (see below) that allows you to configure PAN without a GUI. <br><br>  With it, you can configure both the server and the client.  Having received the appropriate command via D-Bus when working in client mode, he creates a new network device bnep0 immediately after the connection with the server is established.  Normally, DHCP is used to assign an IP address to this interface.  In server mode, BlueZ requires specifying the name of the bridge device to which it can add on the slave device to connect each of the clients.  Configuring the address for the bridge device and starting the DHCP server plus IP masquerading on the bridge is usually all that is required. <br><br><h1>  Bluetooth PAN Access Point with Systemd </h1><br>  To configure the bridge, the author applied systemd-networkd: <br><br>  File /etc/systemd/network/pan.netdev <br><br><pre><code class="plaintext hljs">[NetDev] Name=pan Kind=bridge ForwardDelaySec=0</code> </pre> <br>  File /etc/systemd/network/pan.network <br><br><pre> <code class="plaintext hljs">[Match] Name=pan [Network] Address=0.0.0.0/24 DHCPServer=yes IPMasquerade=yes</code> </pre> <br>  Now you need to force BlueZ to configure the NAP profile.  It turned out that BlueZ 5.36 regular utilities cannot do this.  If the author is mistaken, correct it: mlang (can move ears) blind (sometimes access and quantum) guru <br><br>  But he found <a href="http://blog.fraggod.net/2015/03/28/bluetooth-pan-network-setup-with-bluez-5x.html">a blog post</a> and <a href="https://github.com/mk-fg/fgtk/blob/master/bt-pan">a Python script</a> to make the necessary calls to the D-Bus. <br><br>  For convenience, the author used the Systemd service to run the script and verify dependency resolution. <br><br>  File /etc/systemd/system/pan.service <br><br><pre> <code class="plaintext hljs">[Unit] Description=Bluetooth Personal Area Network After=bluetooth.service systemd-networkd.service Requires=systemd-networkd.service PartOf=bluetooth.service [Service] Type=notify ExecStart=/usr/local/sbin/pan [Install] WantedBy=bluetooth.target</code> </pre> <br>  File / usr / local / sbin / pan <br><br><pre> <code class="plaintext hljs">#!/bin/sh # Ugly hack to work around #787480 iptables -F iptables -t nat -F iptables -t mangle -F iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE exec /usr/local/sbin/bt-pan --systemd --debug server pan</code> </pre> <br>  The second file would not be needed if there was IPMasquerade = support in Debian (see <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi%3Fbug%3D787480"># 787480</a> ). <br><br>  After executing the <i>systemctl daemon-reload</i> and <i>systemctl restart systemd-networkd commands,</i> you can start Bluetooth PAN with the <i>systemctl start pan</i> command <br><br><h1>  Bluetooth PAN Client using Systemd </h1><br>  The client part is also easy to configure using Systemd. <br><br>  File /etc/systemd/network/pan-client.network <br><br><pre> <code class="plaintext hljs">[Match] Name=bnep* [Network] DHCP=yes</code> </pre> <br>  File /etc/systemd/system/pan@.service <br><br><pre> <code class="plaintext hljs">[Unit] Description=Bluetooth Personal Area Network client [Service] Type=notify ExecStart=/usr/local/sbin/bt-pan --debug --systemd client %I --wait</code> </pre> <br>  Now, after reloading the configuration, you can connect to the specified Bluetooth access point like this: <br><br><pre> <code class="plaintext hljs">systemctl start pan@00:11:22:33:44:55</code> </pre> <br><h1>  Pairing with the command line </h1><br>  Of course, the configuration of the server and clients must be performed after pairing them via Bluetooth.  On the server, you need to run the bluetoothctl and give it commands: <br><br><pre> <code class="plaintext hljs">power on agent on default-agent scan on scan off pair XX:XX:XX:XX:XX:XX trust XX:XX:XX:XX:XX:XX</code> </pre> <br>  After starting the scan, wait a few seconds until the device you need appears in the list.  Write down his address and use it, giving the command pair, and if necessary - and the command trust. <br><br>  From the client‚Äôs side, you must do the same, but the trust command will not be needed for sure.  The server needs it to accept a connection over a NAP profile without manual confirmation by the user. <br><br>  The author is not sure that this is the optimal sequence of commands.  Perhaps all that is needed is to pair the client with the server and execute the trust command on the server, but he has not tried this yet. <br><br><h1>  Enable use of the HID Bluetooth profile </h1><br>  It is required that the ‚Äúraspberry‚Äù recognize the keyboard connected to the braille display with a wire and thrown by the display itself via Bluetooth.  It is done the same way, only instead of <i>agent on,</i> you must give the <i>agent KeyboardOnly</i> command, and the bluetoothctl will find the device with the HID profile. <br><br><h1>  But configuring Bluetooth via the command line is complicated </h1><br>  Although the author managed to configure everything, he understands that it is inconvenient to configure BlueZ via the command line.  At first, he thought that agents are only needed to enter PIN codes, but it turned out, for example, that to enable the HID profile, you need to dial "agent KeyboardOnly".  Surprisingly, to start Bluetooth PAN, you need to climb the repositories in search of the desired script.  He remembers that in the previous version of BlueZ there was a ready-made <i>pand</i> tool for this - where is he doing in BlueZ 5?  Suddenly a new solution appeared, unknown to the author, but lying on the surface? <br><br><h1>  Performance </h1><br>  The data transfer rate was about 120 kbps, which is quite enough.  The 1 GHz ARM processor is very fast for the command line interface.  The author still plans to use ssh and emacs on the device. <br><br><h1>  Console fonts and screen resolution </h1><br>  The screen resolution used by the framebuffer on the Raspberry Pi Zero by default is rather strange: fbset reports that it is 656x416 pixels (the monitor, of course, is not connected).  With the console font 8x16, we got 82 characters per line and 26 lines. <br><br>  It is inconvenient to work with the Braille display for 40 acquaintances in this mode.  Also, the author would like the display to display Braille unicode characters.  Fortunately, Linux supports 512 characters, and in most console fonts there are 256. With console-setup, you can use two 256-character fonts together.  The author added the following lines to the / etc / default / console-setup file: <br><br><pre> <code class="plaintext hljs">SCREEN_WIDTH=80 SCREEN_HEIGHT=25 FONT="Lat15-Terminus16.psf.gz brl-16x8.psf"</code> </pre> <br>  Note: to make the brl-16x8.psf font available, you need to install the console-braille. <br><br><h1>  What's next? </h1><br>  There is a 3.5mm jack on the Braille display, but the author doesn‚Äôt know any adapters for removing the audio signal from the Mini-HDMI.  The author did not manage to use the sound card built into the ‚Äúraspberry‚Äù (strangely, the translator was sure that there was no such thing in Zero, but there are ways to output sound by PWM to GPIO).  He plans to use a USB-OTG hub and connect an external card and output the sound to the column built into the braille display.  For some reason, two external cards did not work, now it is looking for a similar device on another chipset. <br><br>  It is still inconvenient to manually turn off the ‚Äúraspberry‚Äù, wait a few seconds and turn off the Braille display.  And all because when it is disconnected it removes power from the connector in the compartment.  The author plans to place a small buffer battery in the compartment and, through GPIO, inform the Malinka about turning off the display so that it can finish its work.  Such is the UPS in miniature. <br><br><h1>  System image </h1><br>  If you have the same braille display, and you want to do the same with it, the author is ready to provide a ready-made image of the system (based on Raspbian Stretch).  Write to him about it at the address indicated above.  If there are a lot of people willing, it is even possible to release sets that include everything needed for such a conversion. <br><br><h1>  Acknowledgments </h1><br>  Thank you Dave Mielke for reading the text. <br><br>  Thanks to Simon Kainz for the photo illustrations. <br><br>  Thanks to colleagues at the Graz University of Technology for the rapid introduction of the author to the world of Raspberry Pi. <br><br>  PS <a href="https://twitter.com/blindbird23/status/740169540018044928/photo/1">The</a> author‚Äôs <a href="https://twitter.com/blindbird23/status/740169540018044928/photo/1">first tweet</a> on this topic (the translator doesn‚Äôt open) was completed just five days before the original of this article was published, and we can assume that, with the exception of problems with sound, the task was practically solved.  By the way, the author edited the final version of the text from a ‚Äúself-sufficient braille display‚Äù made by him, connecting it via SSH to a home computer. </div><p>Source: <a href="https://habr.com/ru/post/445454/">https://habr.com/ru/post/445454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445444/index.html">Upgrade of high performance solar modules from REC and Trina (Solar)</a></li>
<li><a href="../445446/index.html">How we used deferred replication for disaster recovery with PostgreSQL</a></li>
<li><a href="../445448/index.html">Configuring automatic receipt of letsencrypt certificates using docker for linux</a></li>
<li><a href="../445450/index.html">Browser extension for the site toster.ru</a></li>
<li><a href="../445452/index.html">Useful repositories with Eloquent?</a></li>
<li><a href="../445456/index.html">Search at a speed of 1 TB / s</a></li>
<li><a href="../445458/index.html">Electronic Arts will deal with 350 employees and "reduce presence" in Russia</a></li>
<li><a href="../445460/index.html">Interactivity without gadgets</a></li>
<li><a href="../445464/index.html">Reducing the sample size of experimental data without losing information</a></li>
<li><a href="../445468/index.html">Team from Russia ranked third in the Imagine Cup competition in Europe, Africa and the Middle East</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>