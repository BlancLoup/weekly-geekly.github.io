<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>UniFi Controller, displaying RADIUS logins</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I read an article (on Habr√©, but could not be re-found), which described how to configure the display of logins of authorized RADIUS use...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>UniFi Controller, displaying RADIUS logins</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I read an article (on Habr√©, but could not be re-found), which described how to configure the display of logins of authorized RADIUS users in the web control panel of the controller installed on a * nix system.  I perceived that this particular solution is only suitable for * .nix, therefore, having inspired, I decided to implement this on Windows + NPS (aka RADIUS server). <br><br>  Also under the cut there is information on how to transfer data from Windows events to the task scheduler. <br><a name="habracut"></a><br><h4>  It was </h4><br><img src="https://habrastorage.org/files/e80/ea5/612/e80ea56127f54627b42061196106d8b6.png"><br><br><h4>  Will be </h4><br><img src="https://habrastorage.org/files/8ff/492/47d/8ff49247dd3f41eaa7f4814a94687eed.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I don‚Äôt provide information on how to configure APs and NPS, you can use the publication <a href="http://habrahabr.ru/post/142070/">‚ÄúAuthentication of wireless clients using Active Directory accounts‚Äù</a> .  I want to note that in my case NPS server is used only for Wi-Fi authorization, and Unifi Controller is on the same machine as it.  Below in the text there will be notes on what to do if your configuration is different. <br><br>  Let's proceed directly to the implementation of our plans.  First of all, we need to ‚Äúcatch‚Äù the moment of successful authorization of the user and get key information, by which I mean the MAC address of the client device and the login of the authorized user.  To do this, you need to create a task in the Windows scheduler, the trigger for which will be the event of successful authorization of the NPS server (Log: "Security", source: "Microsoft Windows security auditing.", Event code: 6272).  We specify our future CMD in actions (we will return to it later). <br><br><div class="spoiler">  <b class="spoiler_title">Trigger settings</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/99c/0a1/283/99c0a12835c9429f9eade3cf39c6da7f.png"><br></div></div><br>  Using the Windows GUI, you cannot configure data transfer from an event to a script, but no problem, export our task to XML and open it in a text editor.  We are interested in the EventTrigger block: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EventTrigger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Enabled</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Enabled</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Subscription</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">QueryList</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Query</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Security"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Security"</span></span></span><span class="hljs-tag">&gt;</span></span>*[System[Provider[@Name='Microsoft-Windows-Security-Auditing'] and EventID=6272]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Select</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Query</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">QueryList</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Subscription</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EventTrigger</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  You need to insert the ValueQueries block with the parameters ‚Äúborrowed‚Äù from the event: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EventTrigger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Enabled</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Enabled</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Subscription</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">QueryList</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Query</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Security"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Security"</span></span></span><span class="hljs-tag">&gt;</span></span>*[System[Provider[@Name='Microsoft-Windows-Security-Auditing'] and EventID=6272]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Select</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Query</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">QueryList</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Subscription</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><pre> <b><code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ValueQueries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SubjectUserName"</span></span></span><span class="hljs-tag">&gt;</span></span>Event/EventData/Data[@Name='SubjectUserName']<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CallingStationID"</span></span></span><span class="hljs-tag">&gt;</span></span>Event/EventData/Data[@Name='CallingStationID']<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ValueQueries</span></span></span><span class="hljs-tag">&gt;</span></span></code></b> </pre><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EventTrigger</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The full text of the task, without optional parameters (habrapriser ate &amp; gt; &amp; lt;, namely, they must be in the Subscription block instead of angle brackets, otherwise the import will not work)</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-16"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Task</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/windows/2004/02/mit/task"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Triggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EventTrigger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Enabled</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Enabled</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Subscription</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">QueryList</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Query</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Security"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Security"</span></span></span><span class="hljs-tag">&gt;</span></span>*[System[Provider[@Name='Microsoft-Windows-Security-Auditing'] and EventID=6272]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Select</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Query</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">QueryList</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Subscription</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ValueQueries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SubjectUserName"</span></span></span><span class="hljs-tag">&gt;</span></span>Event/EventData/Data[@Name='SubjectUserName']<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CallingStationID"</span></span></span><span class="hljs-tag">&gt;</span></span>Event/EventData/Data[@Name='CallingStationID']<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ValueQueries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EventTrigger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Triggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Actions</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Author"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Exec</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Command</span></span></span><span class="hljs-tag">&gt;</span></span>C:\name_for_mac_unifi.cmd<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Command</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Arguments</span></span></span><span class="hljs-tag">&gt;</span></span>$(SubjectUserName) $(CallingStationID)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Exec</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Task</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Go back to the scheduler, delete the task created earlier and import the corrected XML, add the following arguments to the script actions: <b>$ (SubjectUserName) $ (CallingStationID)</b> <br><br><div class="spoiler">  <b class="spoiler_title">About events and parameters</b> <div class="spoiler_text">  Information on the transfer of event parameters to the task was found <a href="http://www.osp.ru/win2000/2012/08/13033295/">here</a> . <br><br>  If the NPS server serves not only a Wi-Fi network and there are many policies on it, then the link above shows how to add additional filtering to the task conditions (Subscription block), in this case, you can filter by the name of the NPS policy. <br></div></div><br>  Now that we have all the necessary data, go to the script.  It is used to edit the mongo database used by the Unifi Controller, namely, the name property is set to the user login (regular update) in the user collection with MAC address of the client device.  In CMD, it looks like this: <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> user=%<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> mac=%<span class="hljs-number"><span class="hljs-number">2</span></span> ::    -  : <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> mac=<span class="hljs-variable"><span class="hljs-variable">%mac:-=:%</span></span> ::        -     ,  "sleep" <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> -n <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> :: mongo ,     mongo js      mongo.exe <span class="hljs-number"><span class="hljs-number">127</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">27117</span></span>/ace --eval "var mac='<span class="hljs-variable"><span class="hljs-variable">%mac%</span></span>'; db.user.update({ mac:mac.toLowerCase()},{$<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>:{name:'<span class="hljs-variable"><span class="hljs-variable">%user%</span></span>'} });"</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Some words about MONGO client and server</b> <div class="spoiler_text">  There is no client among the mongo binaries of the server supplied with Unifi Controller.  It needs to be downloaded separately, while the client offered for download was a fresh server and did not want to perform the update.  It is solved by downloading the client of the same version. <br><br>  You can check client and server versions as follows: <br><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mongo.exe</span></span></span><span class="hljs-function"> 127.0.0.1:27117/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ace</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MongoDB</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shell</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">version</span></span></span><span class="hljs-function">: 2.2.2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connecting</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function">: 127.0.0.1:27117/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ace</span></span></span><span class="hljs-function"> &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">db.version</span></span></span><span class="hljs-function">() 2.2.2 &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">version</span></span></span><span class="hljs-function">() </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">version</span></span></span><span class="hljs-function">: 2.2.2 &gt;</span></span></code> </pre><br>  There are no links to downloading this version <a href="https://www.mongodb.org/downloads">on the MongoDB website</a> , but no problem, we take the link to any version for the required platform: <br><br>  <i><a href="">fastdl.mongodb.org/win32/mongodb-win32-i386-2.2.7.zip</a></i> <br><br>  And we substitute the version of mongo we need: <br><br>  <b><i><a href="">fastdl.mongodb.org/win32/mongodb-win32-i386-2.2.2.zip</a></i></b> <br><br>  C 2.2.2 passed on "Hurray." <br><br>  And, yes, I did not manage to connect from a third-party machine, perhaps it was not my fault to adjust the database, as there was no need.  But even with the inability to remotely connect to the database, no one bothers to remotely execute a local command on the machine with the mongo server. <br></div></div><br>  That's all, good luck!  Accept corrections / criticism. <br><br><div class="spoiler">  <b class="spoiler_title">Unifi API</b> <div class="spoiler_text">  Already after the realization of the whole undertaking and proceeding to the article, I met the mention of <a href="http://www.ubnt.su/FAQ/index.htm">unifi api</a> (apparently, in the original article mentioned at the beginning, it was implemented on it), but the <a href="http://wiki.ubnt.com/UniFi_FAQ">links</a> and <a href="http://wiki.ubnt.com/index.php%3Fns0%3D1%26ns1%3D1%26ns2%3D1%26ns3%3D1%26ns4%3D1%26ns5%3D1%26ns6%3D1%26ns7%3D1%26ns8%3D1%26ns9%3D1%26ns10%3D1%26ns11%3D1%26ns12%3D1%26ns13%3D1%26ns14%3D1%26ns15%3D1%26search%3DAPI%26title%3DSpecial%253ASearch%26fulltext%3DAdvanced%2Bsearch%26fulltext%3DAdvanced%2Bsearch">search</a> on the official wiki did not reveal the information.  <a href="">Information in the repositories</a> opened the secret of some methods. <br><br>  I believe that to change the login, you can refer to <i><b>$ baseurl / api / cmd / stamgr</b></i> and pass the string <i><b>json = {'cmd': 'update-sta', 'mac': '$ {mac}', 'name': '$ 2 ',' email ':' $ 3 '}</b></i> . </div></div></div><p>Source: <a href="https://habr.com/ru/post/259139/">https://habr.com/ru/post/259139/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259127/index.html">My Internet of Things: Guest Castle</a></li>
<li><a href="../259129/index.html">Positive Hack Days V WAF Bypass Contest</a></li>
<li><a href="../259133/index.html">IBM cloud grant up to $ 120,000 awaits you at Startup Village</a></li>
<li><a href="../259135/index.html">What was on PHDays V: signs of interception of GSM-signal, the best time to hack Wi-Fi, the future of encryption</a></li>
<li><a href="../259137/index.html">VKontakte launches BugBounty program</a></li>
<li><a href="../259141/index.html">Russification and multilingual OpenStreetMap cards</a></li>
<li><a href="../259143/index.html">Yukon: 1st Annual Software Developer Conference</a></li>
<li><a href="../259145/index.html">Prototype OOP for Lua</a></li>
<li><a href="../259147/index.html">Network Evolution - New 25/50/100 GbE Standard</a></li>
<li><a href="../259149/index.html">SonarQube. We check the code for quality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>