<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Maps in the browser without a network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In my free time I am writing an application for finding ATMs in Minsk. And somehow going on vacation, I was left without the Internet o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Maps in the browser without a network</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  In my free time I am writing an application for finding ATMs in Minsk.  And somehow going on vacation, I was left without the Internet on the phone.  Everything would be fine, but I needed to find an ATM, withdraw money and not be late for the train.  I opened my application and was very disappointed that I could not use the map offline.  Of course, without connecting to the network in our time, it‚Äôs better not to go out of your home, but still the Internet on your favorite mobile device may be out at the wrong time. <br><br>  Looking at the other applications on my phone, I noticed that, at best, they cache parts of the map that were loaded before.  This could partly help me, but did not solve the problem completely.  After that, I wondered if it was worth having the opportunity to view the map offline.  Since my application is not native, but based on phonegap, those are browser based, then the story will be about how you can cache the map for browser applications in particular using google map api v3. <br><a name="habracut"></a><br><h4>  Idea </h4><br>  Somehow after all this, I remembered that google map api allows you to make your map implementation (for example, as I advise <a href="http://wiki.openstreetmap.org/wiki/Google_Maps_Example">OSM</a> ).  Immediately I got the idea to slip an implementation that will always be available, and this can be done either by downloading maps to the cache if there is a connection, or by supplying the cache cards with the application. <br><br>  At first I was thinking of using application cache, but I refused this idea, since its api does not provide wide possibilities for managing the loading of the cache. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the end, I decided to just deliver the cache with the application. <br><br>  I also had the idea to store sprites in localStorage, but this implementation has major flaws: <br><ol><li>  localStorage size limit; </li><li>  data must be stored in base64, which is about 30% larger than the actual size. </li></ol><br>  The idea of ‚Äã‚Äãstoring sprites in indexedDB or webSQL had to be abandoned due to the lack of synchronous api implementations. <br><br><h4>  To be or not to be </h4><br>  The first question I asked myself was it worth caching a card at all?  That is, whether a specific city map will be used and whether detailed detailing is necessary.  In my case, it was enough to have a cache of Minsk for a small zoom (10-15). <br><br>  The second question: how much space will the cache take?  If the average size of the sprite is 20 kb, then theoretically for a zoom of 10 (Minsk fully accommodates) you need 1 sprite (20 kb), for 11 - 4 (100 kb), for 12 - 16 (420 kb), for 13 - 64 (1.7 mb), for 14 - 256 (6.8 mb), 15 - 1024 (27 mb).  A cache with a zoom of 14 seemed sufficient. <br><br><h4>  Download </h4><br>  I decided to take a real map and real sprites to find out how much space the cache actually takes.  To do this, it was necessary to solve several school problems: create a polygon with a minimum perimeter from a set of points, <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F_%25D0%259C%25D0%25B5%25D1%2580%25D0%25BA%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580%25D0%25B0">translate the polar coordinates into the coordinates of the sprites of the map</a> and <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25B4%25D0%25B0%25D1%2587%25D0%25B0_%25D0%25BE_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25BB%25D0%25B5%25D0%25B6%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8_%25D1%2582%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B8_%25D0%25BC%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE%25D1%2583%25D0%25B3%25D0%25BE%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B8%25D0%25BA%25D1%2583">find the sprites located in the polygon</a> .  After the <a href="https://github.com/tbicr/OfflineMap/blob/master/parse.py">script</a> was ready I downloaded the sprites and got the following results (in brackets the total space occupied for this zoom): <br><table><tbody><tr><th>  Zoom </th><th>  Theoretical number of sprites </th><th>  Theoretical sprites size </th><th>  The actual number of sprites </th><th>  Real size sprites </th></tr><tr><td>  9 </td><td>  one </td><td>  20 kb (20 kb) </td><td>  2 </td><td>  52 kb (52 kb) </td></tr><tr><td>  ten </td><td>  one </td><td>  20 kb (40 kb) </td><td>  3 </td><td>  72 kb (124 kb) </td></tr><tr><td>  eleven </td><td>  four </td><td>  80 kb (100 kb) </td><td>  7 </td><td>  204 kb (328 kb) </td></tr><tr><td>  12 </td><td>  sixteen </td><td>  320 kb (420 kb) </td><td>  17 </td><td>  348 kb (676 kb) </td></tr><tr><td>  13 </td><td>  64 </td><td>  1.3 mb (1.7 mb) </td><td>  48 </td><td>  820 kb (1.5 mb) </td></tr><tr><td>  14 </td><td>  256 </td><td>  5.1 mb (6.8 mb) </td><td>  158 </td><td>  2.2 mb (3.7 mb) </td></tr><tr><td>  15 </td><td>  1024 </td><td>  20.5 mb (27 mb) </td><td>  586 </td><td>  5.5 mb (9.3 mb) </td></tr><tr><td>  sixteen </td><td>  4096 </td><td>  82 mb (109 mb) </td><td>  2264 </td><td>  15 mb (24.3 mb) </td></tr></tbody></table><br>  Sprites were downloaded if they were inside the Minsk ring road or if the objects I needed were on these sprites.  Thus it turned out to significantly reduce the space occupied by sprites. <br><br>  Since I had sprites, it remained to make the map work offline. <br><br><h4>  Without network </h4><br>  In order for the map to work with cached sprites, you need to tell it where to get the data, you can do it simply: <br><blockquote><ol><li>  map.  <font color="#660066">mapTypes</font> .  <font color="#660066">set</font> <font color="#009900">(</font> <font color="#3366CC">"LocalGmap"</font> <font color="#339933">,</font> <font color="#003366">new</font> google. <font color="#660066">maps</font> . <font color="#660066">ImageMapType</font> <font color="#009900">(</font> <font color="#009900">{</font> </li><li>  getTileUrl <font color="#339933">:</font> <font color="#003366">function</font> <font color="#009900">(</font> coord <font color="#339933">,</font> zoom <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000066">return</font> <font color="#3366CC">"cache /"</font> <font color="#339933">+</font> zoom <font color="#339933">+</font> <font color="#3366CC">"/"</font> <font color="#339933">+</font> coord.  <font color="#660066">x</font> <font color="#339933">+</font> <font color="#3366CC">"_"</font> <font color="#339933">+</font> coord.  <font color="#660066">y</font> <font color="#339933">+</font> <font color="#3366CC">".png"</font> </li><li>  <font color="#009900">}</font> <font color="#339933">,</font> </li><li>  tileSize <font color="#339933">:</font> <font color="#003366">new</font> google.  <font color="#660066">maps</font> .  <font color="#660066">Size</font> <font color="#009900">(</font> <font color="#CC0000">256</font> <font color="#339933">,</font> <font color="#CC0000">256</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#000066">name</font> <font color="#339933">:</font> <font color="#3366CC">"LocalGmap"</font> <font color="#339933">,</font> </li><li>  maxZoom <font color="#339933">:</font> <font color="#CC0000">15</font> </li><li>  <font color="#009900">}</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br>  The getTileUrl function returns a value that is inserted into the src attribute of the image, therefore, if we have a base64 view of images stored in localStorage, we can implement the map cache like this: <br><blockquote><ol><li>  map.  <font color="#660066">mapTypes</font> .  <font color="#660066">set</font> <font color="#009900">(</font> <font color="#3366CC">"WebStorageGmap"</font> <font color="#339933">,</font> <font color="#003366">new</font> google. <font color="#660066">maps</font> . <font color="#660066">ImageMapType</font> <font color="#009900">(</font> <font color="#009900">{</font> </li><li>  getTileUrl <font color="#339933">:</font> <font color="#003366">function</font> <font color="#009900">(</font> coord <font color="#339933">,</font> zoom <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000066">return</font> localStorage.  <font color="#660066">getItem</font> <font color="#009900">(</font> <font color="#009900">[</font> zoom <font color="#339933">,</font> coord. <font color="#660066">x</font> <font color="#339933">,</font> coord. <font color="#660066">y</font> <font color="#009900">]</font> . <font color="#660066">join</font> <font color="#009900">(</font> <font color="#3366CC">'_'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#339933">,</font> </li><li>  tileSize <font color="#339933">:</font> <font color="#003366">new</font> google.  <font color="#660066">maps</font> .  <font color="#660066">Size</font> <font color="#009900">(</font> <font color="#CC0000">256</font> <font color="#339933">,</font> <font color="#CC0000">256</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  <font color="#000066">name</font> <font color="#339933">:</font> <font color="#3366CC">"WebStorageGmap"</font> <font color="#339933">,</font> </li><li>  maxZoom <font color="#339933">:</font> <font color="#CC0000">15</font> </li><li>  <font color="#009900">}</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br>  But for now we are still tied to scripts, pictures and cursors google maps api. <br><br>  Let's start with the most important script: <a href="http://maps.googleapis.com/maps/api/js%3Fsensor%3Dfalse">http://maps.googleapis.com/maps/api/js?sensor=false</a> .  Download and replace the script with its local version, which we call gmapapi.js.  This script mentions many references to some data. <br><br>  Run again and see which scripts are loaded.  This is <a href="">http://maps.gstatic.com/cat_js/intl/en_us/mapfiles/api-3/8/5/main.js</a> and many more scripts similar to <a href="">http://maps.gstatic.com/cat_js/intl/ en_us / mapfiles / api-3/8/5 / {map, marker} .js</a> . <br><br>  The first script contains the kernel, the rest - additional components.  Downloading main.js and since there is no mention of additional components in gmapapi.js, then quickly looking at main.js we get all the components of interest that we download in components.js: <br><blockquote>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'common'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'controls'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'directions'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'distance_matrix'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'drawing_impl'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'elevation'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'geocoder'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'geometry'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'infowindow'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'kml'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'layers'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'map'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'marker'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'maxzoom'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'onion'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'overlay'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'places_impl'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'poly'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'search_impl'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'stats'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'streetview'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'usage'</font> <font color="#339933">,</font> ... <br>  google.  <font color="#660066">maps</font> .__ gjsload__ <font color="#009900">(</font> <font color="#3366CC">'util'</font> <font color="#339933">,</font> ... </blockquote><br>  Now, in gmapapi.js, we replace the load of main.js of an external file with a local file, and also we will load components.js, in order not to load the necessary components after initializing the map. <br><br>  Look further: some scripts are loaded from <a href="http://maps.googleapis.com/">http://maps.googleapis.com</a> , which make incomprehensible magic: <br><ul><li>  AuthenticationService.Authenticate </li><li>  QuotaService.RecordEvent </li><li>  StaticMapService.GetMapImage </li><li>  ViewportInfoService.GetViewportInfo </li><li>  gen_204 </li><li>  ft </li></ul><br>  We look for where they are mentioned, and this, as it turned out, is gmapapi.js.  We substitute links to these scripts with local ones (for the fallback in the application cache to work).  Add an empty.js script that will do nothing and add a bunch of ‚Äúmagic_ script empty.js‚Äù to the fallback section of our file manifest. <br><blockquote>  FALLBACK: <br>  gmapcache / googleapis / maps / api / js / AuthenticationService.Authenticate gmapcache / empty.js <br>  gmapcache / googleapis / maps / api / js / QuotaService.RecordEvent gmapcache / empty.js <br>  gmapcache / googleapis / maps / api / js / StaticMapService.GetMapImage gmapcache / empty.js <br>  gmapcache / googleapis / maps / api / js / ViewportInfoService.GetViewportInfo gmapcache / empty.js <br>  gmapcache / googleapis / maps / gen_204 gmapcache / empty.js <br>  gmapcache / googleapis / mapslt / ft gmapcache / empty.js </blockquote><br>  With all the scripts, now the pictures. <br><br>  All images that are not sprites are loaded from <a href="http://maps.gstatic.com/mapfiles/">http://maps.gstatic.com/mapfiles/</a> .  A quick search across all files says that the string is mentioned in one place in gmapapi.js.  We swing locally all pictures, we replace the found link with the local one. <br><br>  Now for full work offline we push everything into the manifest file. <br><blockquote>  CACHE MANIFEST <br><br>  NETWORK: <br>  * <br><br>  CACHE: <br>  index.html <br>  style.css <br><br>  script.js <br>  gmapapi.js <br>  gmapcache / main.js <br>  gmapcache / components.js <br>  gmapcache / empty.js <br><br>  gmapcache / gstatic / arrow-down.png <br>  gmapcache / gstatic / cb / mod_cb_scout / cb_scout_sprite_api_003.png <br>  gmapcache / gstatic / cb / target_locking.gif <br>  gmapcache / gstatic / google_white.png <br>  gmapcache / gstatic / iw3.png <br>  gmapcache / gstatic / iws3.png <br>  gmapcache / gstatic / mapcontrols3d7.png <br>  gmapcache / gstatic / markers2 / marker_sprite.png <br>  gmapcache / gstatic / mv / imgs8.png <br>  gmapcache / gstatic / rotate2.png <br>  gmapcache / gstatic / szc4.png <br>  gmapcache / gstatic / transparent.png <br><br>  gmapcache / gstatic / openhand_8_8.cur <br>  gmapcache / gstatic / closedhand_8_8.cur </blockquote><br>  Everything, fully working offline map is ready! <br><br>  Here are all the changes in gmapapi.js: <br><table><tbody><tr><th>  It was </th><th>  It became </th></tr><tr><td><blockquote>  <font color="#009900">[</font> <br>  <font color="#3366CC">" <a href="http://mt0.googleapis.com/mapslt/ft%3Fhl%3Den-USu0026">http://mt0.googleapis.com/mapslt/ft?hl=en-USu0026</a> "</font> <font color="#339933">,</font> <br>  <font color="#3366CC">" <a href="http://mt1.googleapis.com/mapslt/ft%3Fhl%3Den-USu0026">http://mt1.googleapis.com/mapslt/ft?hl=en-USu0026</a> "</font> <br>  <font color="#009900">]</font> </blockquote></td><td><blockquote>  <font color="#009900">[</font> <br>  <font color="#3366CC">"gmapcache / googleapis / mapslt / ft? hl = en-USu0026"</font> <br>  <font color="#009900">]</font> </blockquote></td></tr><tr><td><blockquote>  <font color="#009900">[</font> <br>  <font color="#3366CC">"en-US"</font> <font color="#339933">,</font> <font color="#3366CC">"US"</font> <font color="#339933">,</font> <font color="#003366">null</font> <font color="#339933">,</font> <font color="#CC0000">0</font> <font color="#339933">,</font> <font color="#003366">null</font> <font color="#339933">,</font> <font color="#003366">null</font> <font color="#339933">,</font> <br>  <font color="#3366CC">" <a href="http://maps.gstatic.com/mapfiles/">http://maps.gstatic.com/mapfiles/</a> "</font> <font color="#339933">,</font> <br>  <font color="#3366CC">" <a href="http://csi.gstatic.com/">http://csi.gstatic.com</a> "</font> <font color="#339933">,</font> <br>  <font color="#3366CC">" <a href="https://maps.googleapis.com/">https://maps.googleapis.com</a> "</font> <font color="#339933">,</font> <br>  <font color="#3366CC">" <a href="http://maps.googleapis.com/">http://maps.googleapis.com</a> "</font> <br>  <font color="#009900">]</font> </blockquote></td><td><blockquote>  <font color="#009900">[</font> <br>  <font color="#3366CC">"en-US"</font> <font color="#339933">,</font> <font color="#3366CC">"US"</font> <font color="#339933">,</font> <font color="#003366">null</font> <font color="#339933">,</font> <font color="#CC0000">0</font> <font color="#339933">,</font> <font color="#003366">null</font> <font color="#339933">,</font> <font color="#003366">null</font> <font color="#339933">,</font> <br>  <font color="#3366CC">"gmapcache / gstatic /"</font> <font color="#339933">,</font> <br>  <font color="#3366CC">" <a href="http://csi.gstatic.com/">http://csi.gstatic.com</a> "</font> <font color="#339933">,</font> <br>  <font color="#3366CC">" <a href="https://maps.googleapis.com/">https://maps.googleapis.com</a> "</font> <font color="#339933">,</font> <br>  <font color="#3366CC">"gmapcache / googleapis"</font> <br>  <font color="#009900">]</font> </blockquote></td></tr><tr><td><blockquote>  getScript <font color="#009900">(</font> <font color="#3366CC">" <a href="">http://maps.gstatic.com/intl/en_us/mapfiles/api-3/8/5/main.js</a> "</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote></td><td><blockquote>  getScript <font color="#009900">(</font> <font color="#3366CC">"gmapcache / main.js"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  getScript <font color="#009900">(</font> <font color="#3366CC">"gmapcache / components.js"</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote></td></tr></tbody></table><br>  In fact, gmapapi.js stores all settings for maps and there you can also specify links to sprites. <br><br><h4>  What's next? </h4><br>  Actually that's all. <br><br>  So what I did: <br><ol><li>  downloaded sprites locally; </li><li>  downloaded all the resources used locally (scripts, pictures, cursors); </li><li>  replaced the mention of external resources with local ones and added files to the cache section of the file manifest; </li><li>  made it so that the necessary scripts are not loaded after initialization; </li><li>  Replaced unnecessary files with dummies and added a file manifest section to the fallback. </li></ol><br>  This project is on github <a href="https://github.com/tbicr/OfflineMap">https://github.com/tbicr/OfflineMap</a> , it consists of a <a href="https://github.com/tbicr/OfflineMap/blob/master/parse.py">parser</a> and a <a href="https://github.com/tbicr/OfflineMap/tree/master/site">site</a> .  Lazy can see the map here <a href="http://offline-map.appspot.com/">http://offline-map.appspot.com</a> . <br><br>  To see the work offline in the browser right away, go to <a href="http://offline-map.appspot.com/">http://offline-map.appspot.com</a> , click ‚ÄúPrepare Web Storage‚Äù, wait a few seconds for the sprites to load, then turn off the Internet, click on WebStorageGmap and enjoy. <br><br>  The ‚ÄúPrepare Web Storage‚Äù button uploads sprites to localStorage, and ‚ÄúClear Web Storage‚Äù respectively clears it. <br><br>  Card types: <br><ul><li>  Map - standard google map map. </li><li> Satellite is a standard google map map from a satellite. </li><li>  OSM - implementation of OSM maps with google api. </li><li>  MyGmap - implementation of a standard google map map. </li><li>  LocalGmap - implementation of a map stored locally (on the same host as the site). </li><li>  WebStorageGmap - implementation of the map stored in localStorage (you must first run ‚ÄúPrepare Web Storage‚Äù). </li><li>  LocalMyGmap is a hybrid implementation of LocalGmap and MyGmap, if the data is in a specific area on the map, works as LocalGmap, except as MyGmap. </li><li>  WebStorageMyGmap - a hybrid implementation of WebStorageGmap and MyGmap, if the data is in localStorage, works like WebStorageGmap, other than MyGmap. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/141707/">https://habr.com/ru/post/141707/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141702/index.html">The art of negotiation is just business, nothing personal</a></li>
<li><a href="../141703/index.html">Remart: how I created my business</a></li>
<li><a href="../141704/index.html">Validation of datetime fields when translating a project from ASP.NET MVC 3 to ASP.NET MVC 4</a></li>
<li><a href="../141705/index.html">Organizing sharing of files in C # application</a></li>
<li><a href="../141706/index.html">The free and free Cuprum font is now available in four styles (regular, italic, bold, bold italic)</a></li>
<li><a href="../141709/index.html">Plesiochronous digital hierarchy and E1 stream</a></li>
<li><a href="../141710/index.html">Cleaning infected site files from malicious code</a></li>
<li><a href="../141712/index.html">The correct keyboard for information terminals</a></li>
<li><a href="../141713/index.html">1-wire smart home network and FreeBSD</a></li>
<li><a href="../141714/index.html">We write your php framework for the evening</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>