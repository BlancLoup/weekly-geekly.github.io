<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating an Excel file from a select with parameters using pure PL / SQL, as an alternative to Oracle * Reports</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Goals I wanted to achieve 


- Excel, as a result of a select, whose text the procedure only learns in runtime 
- The select before the modification i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating an Excel file from a select with parameters using pure PL / SQL, as an alternative to Oracle * Reports</h1><div class="post__text post__text-html js-mediator-article"><h4>  Goals I wanted to achieve </h4><br><ul><li>  Excel, as a result of a select, whose text the procedure only learns in runtime </li><li>  The select before the modification is changed in accordance with the parameters that the procedure receives </li><li>  The procedure is passed the parameters of the file to be created. </li><li>  The ability to get the resulting file in Excel Workbook, CSV, HTML, XML </li></ul><br>  Stored PL / SQL procedure gets in parameters <br><ul><li>  select text </li><li>  Excel file options </li><li>  execution parameters </li></ul>  and creates a full-fledged Excel with several tables (sheets). <br>  I know that there are Crystal Reports and Oracle BI Publisher. <br>  But, first of all, these are large products (with high prices ...), and Publisher, as far as I know, does not work as a separate module without Oracle Business Intelligence Enterprise Edition.  And besides, it was a fairly narrow task of creating a file without layout. <br><br>  At the end, I wrote one PL / SQL package that is in the database and can be called from any application.  In the course of writing, I was faced with many restrictions and I want to talk about how to overcome them. <br><br>  For those who doubt, I certainly could not have known this in advance, but for several years that the package has been working in a large company, I have not had problems reducing RDF of any complexity, with many triggers / formulas, in one select, praise Oraklu.  On the contrary, since the select is a string parameter and can be built dynamically, this gives greater flexibility.  In the parameters you can even set the name of the table. <br><a name="habracut"></a><br>  First of all, do not judge strictly for the abundance of anglicisms (so, in my opinion, this is called), I have just been outside the Russian software community for a long time and I don‚Äôt know what these words are replacing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Very often, applications written in Oracle Forms / Reports use Oracle * Reports to create an Excel file, because it is possible to use parameters and modify the selections before it is executed.  Then in the trigger at the level of the output line write the output to the file.  It turns out the csv file.  Well, you can, of course. <br>  If together with Excel you need to create a pdf, then there is no getting around, use Reports and do not complain about how this program got you.  But after all, often you <b>just</b> need Excel and you don‚Äôt feel like dodging for this RDF. <br><br>  So, to the point. <br><div class="spoiler">  <b class="spoiler_title">File options</b> <div class="spoiler_text">  It's simple <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DIR_NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DIR_NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FILE_NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FILE_NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OUT_TYPE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OUT_TYPE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LIMIT_ROWS</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LIMIT_ROWS</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LIMIT_LEN</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LIMIT_LEN</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EXCEL_TITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EXCEL_TITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SUBTITLE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SUBTITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SUBTITLE2</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SUBTITLE2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DIRECTION</span></span></span><span class="hljs-tag">&gt;</span></span> ltr/rtl <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DIRECTION</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CHARSET</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CHARSET</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LITERAL_PARAMS</span></span></span><span class="hljs-tag">&gt;</span></span> Y/N<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LITERAL_PARAMS</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DIVIDE_BY</span></span></span><span class="hljs-tag">&gt;</span></span>FILES|SHEETS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DIVIDE_BY</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PARAM_TITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PARAM_TITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PAR_NAME_HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PAR_NAME_HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PAR_VALUE_HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PAR_VALUE_HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NOT_FOUND_MSG</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NOT_FOUND_MSG</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LONG_OUT</span></span></span><span class="hljs-tag">&gt;</span></span>Y/N<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LONG_OUT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MULTI_VALUE_DELIMITER</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MULTI_VALUE_DELIMITER</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CURR_DATE_PROMPT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CURR_DATE_PROMPT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DEFAULT_DATE_MASK</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DEFAULT_DATE_MASK</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OUTPUT_DATE_FORMAT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OUTPUT_DATE_FORMAT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CURRENT_SHEET</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CURRENT_SHEET</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TOTAL_SHEETS</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TOTAL_SHEETS</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Approximately such a set.  I think everything is clear.  Few words: <br><br>  LIMIT_ROWS, LIMIT_LEN allow you to divide the resulting file in the creation process as you reach the limit values ‚Äã‚Äãby several Excel correct ones. <br><br>  LITERAL_PARAMS talks about how to use execution parameters ‚Äî insert values ‚Äã‚Äãor execute selections in dbms_sql with dbms_sql.bind_variable. <br><br>  OUT_TYPE sets the format: Excel Workbook, CSV, HTML, XML <br></div></div><br><br><h4>  How to ensure the dynamism of the select with the parameters obtained in runtime </h4><br><div class="spoiler">  <b class="spoiler_title">Execution options</b> <div class="spoiler_text">  Parameters are passed as: <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PARAMS</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PARAM</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DATATYPE</span></span></span><span class="hljs-tag">&gt;</span></span> [ALPHANUMERIC|CHAR|DATE|NUMBER|AS_IS] <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DATATYPE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORMAT_MASK</span></span></span><span class="hljs-tag">&gt;</span></span>[Date format]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORMAT_MASK</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PROMPT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PROMPT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LABEL</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LABEL</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VALUE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VALUE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PARAM</span></span></span><span class="hljs-tag">&gt;</span></span> .. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PARAMS</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br></div></div><br><h5>  Pre-fulfillment language </h5><br>  You need a certain language in which you can write instructions on what to do depending on the values ‚Äã‚Äãof the execution parameters. <br><ul><li>  We get the execution parameters. </li><li>  Compile the select text. </li><li>  Serve it for the next step. </li></ul><br><h5>  Here is the language that at the end covered all my needs. </h5><br>  In the select text it looks like a comment (hint) <br><pre> <code class="xml hljs">/*!<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HINT</span></span></span><span class="hljs-tag">&gt;</span></span> [{]operand1[}] [ [{]operand2[}][{]operand3[}] ] ; !*/</code> </pre><br>  The first word is hint, which defines the command <br>  <b>VAR</b> CHAR |  NUMBER |  AS_IS |  DATE [date format] {PL / SQL expression}; <br>  <b>IF_CONTINUE</b> {PL / SQL expression} <br>  <b>IF_EXECUTE</b> {PL / SQL expression} <br>  <b>EXPR</b> {PL / SQL expression}; <br>  <b>IIF_EXPR</b> {boolean expression} {String if true} {String if false}; <br>  <b>IS_NOT_NULL</b> {Bind variable} {String if Bind variable is not null}; <br>  <b>IS_NULL</b> {Bind variable} {String if Bind variable is null}; <br>  <b>BOTTOM_SUM</b> {Total bottom title} BC ... Z; <br>  <b>ROW_SUM</b> {Total column title} BCD ... Z; <br>  <b>BEFORE</b> {PL / SQL block}; <br>  <b>TITLE</b> {Title}; <br>  <b>ALIAS</b> {column_name} {alias}; <br>  <b>AFTER</b> {PL / SQL block}; <br><br>  The compilation step is that I find the command in the text, if one of the operands needs to be executed - I do it as a <b>select (expression) from dual</b> or as a PL / SQL block in execute immediate and replace the whole command with the result of the execution. <br><div class="spoiler">  <b class="spoiler_title">for example</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*! VAR :Max_salary_dep number {select department_id from (select ee.department_id, sum(ee.salary) from employee ee /*! IS_NOT_NULL :emp_id {where ee.employee_id = :emp_id}; !*/</span></span> group by ee.department_id order by sum(ee.salary) desc) where rownum = 1} !*/ <span class="hljs-comment"><span class="hljs-comment">/*! VAR :Debug_print char 'Y' ; !*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> e.first_name <span class="hljs-string"><span class="hljs-string">"First Name"</span></span>, e.last_name, d.name <span class="hljs-string"><span class="hljs-string">"Department name"</span></span>, j.function,e.hire_date,e.salary,e.commission <span class="hljs-comment"><span class="hljs-comment">/*! IS_NOT_NULL :loc_id {,l.regional_group}; !*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> department d,employee e,job j <span class="hljs-comment"><span class="hljs-comment">/*! IS_NOT_NULL :loc_id {,loc l}; !*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> e.department_id=d.department_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.job_id=j.job_id <span class="hljs-comment"><span class="hljs-comment">/*! IS_NOT_NULL :loc_id { and l.loc_id=d.loc_id}; !*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*! IS_NOT_NULL :hire_date { and hire_date &gt;= :hire_date}; !*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*! IS_NOT_NULL :function { and j.function=upper(:function)}; !*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*! IIF_EXPR {:dep_id is not null} {and d.department_id = :dep_id} {and d.department_id = :Max_salary_dep}; !*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*! IS_NOT_NULL :emp_id {and employee_id = :emp_id}; !*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*! ROW_SUM {Total row} FG; !*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*! BOTTOM_SUM Total FG /*! IS_NOT_NULL :loc_id I ; !*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*! IS_NULL :loc_id H; !*/</span></span> ; !*/</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Depending on the transmitted values, you can get any selects</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> e.first_name <span class="hljs-string"><span class="hljs-string">"First Name"</span></span>, e.last_name, d.name <span class="hljs-string"><span class="hljs-string">"Department name"</span></span>, j.function,e.hire_date,e.salary,e.commission <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> department d,employee e,job j <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> e.department_id=d.department_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.job_id=j.job_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> d.department_id = <span class="hljs-number"><span class="hljs-number">20</span></span></code> </pre><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> e.first_name <span class="hljs-string"><span class="hljs-string">"First Name"</span></span>, e.last_name, d.name <span class="hljs-string"><span class="hljs-string">"Department name"</span></span>, j.function,e.hire_date,e.salary,e.commission ,l.regional_group <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> department d,employee e,job j ,loc l <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> e.department_id=d.department_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.job_id=j.job_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> l.loc_id=d.loc_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hire_date &gt;= <span class="hljs-keyword"><span class="hljs-keyword">to_date</span></span>(<span class="hljs-string"><span class="hljs-string">'1985-09-08'</span></span>,<span class="hljs-string"><span class="hljs-string">'yyyy-mm-dd'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> j.function=<span class="hljs-keyword"><span class="hljs-keyword">upper</span></span>(<span class="hljs-string"><span class="hljs-string">'SALESPERSON'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> d.department_id = <span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre><br>  or <br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> e.first_name <span class="hljs-string"><span class="hljs-string">"First Name"</span></span>, e.last_name, d.name <span class="hljs-string"><span class="hljs-string">"Department name"</span></span>, j.function,e.hire_date,e.salary,e.commission <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> department d,employee e,job j <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> e.department_id=d.department_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.job_id=j.job_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hire_date &gt;= <span class="hljs-keyword"><span class="hljs-keyword">to_date</span></span>(<span class="hljs-string"><span class="hljs-string">'1985-09-08'</span></span>,<span class="hljs-string"><span class="hljs-string">'yyyy-mm-dd'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> j.function=<span class="hljs-keyword"><span class="hljs-keyword">upper</span></span>(<span class="hljs-string"><span class="hljs-string">'SALESPERSON'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> d.department_id = <span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre>  and so on ... <br></div></div><br>  I described this in order for you to believe that these techniques allow you to write really effective selects. <br>  No <i>"and (: param1 is null or table_field =: param1)"</i> <br><br><h4>  Parsing and execution </h4><br>  For the sake of this section, I started writing this article.  Here I will write about the experience that I have acquired, and which certainly is not needed by someone who did not go on the limits of acceptable in Orakle.  For example, everyone knows that the maximum length of a text field in a table is 4000, but how many people know that the limit for concatenating a string field in an oracle is also 4000 bytes. <br><div class="spoiler">  <b class="spoiler_title">Everybody knows</b> <div class="spoiler_text">  Maybe I'm wrong, maybe it was just me who did not know. <br></div></div><br>  Got select after precompilation with execution parameters.  We have it in the variable l_Stmt. <br>  Unfortunately, in PL / SQL there is no easy way to loop through select fields, as it could be done in Java.  We will use the dbms_sql.parse procedure, which returns the select fields as a table, using which we will make a cycle in the future. <br>  What do we want to do? <br>  Perform parsing and get a list of fields with datatype. <br>  For this we use <br><div class="spoiler">  <b class="spoiler_title">dbms_sql.parse</b> <div class="spoiler_text"><pre> <code class="sql hljs"> l_CursorId := dbms_sql.open_cursor; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> dbms_sql.parse(l_CursorId, <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(<span class="hljs-string"><span class="hljs-string">'select * from ('</span></span> || l_Stmt || <span class="hljs-string"><span class="hljs-string">')'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">32765</span></span>),<span class="hljs-number"><span class="hljs-number">1</span></span>); exception when others then v_Msg := '<span class="hljs-comment"><span class="hljs-comment">--After parse: ' || sqlerrm; put_str_to_output(substr('select * from (' || l_Stmt || ')',1,32765)); raise ParsingException; end;</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">dbms_sql.describe_columns</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> dbms_sql.describe_columns(l_CursorId, l_ColumnCnt, l_LogColumnTblInit); exception when others then v_Msg := '<span class="hljs-comment"><span class="hljs-comment">--After describe_columns: ' || sqlerrm; put_str_to_output(substr('select * from (' || l_Stmt || ')', 1, 32765)); raise ParsingException; end;</span></span></code> </pre></div></div><br>  We got the most important thing - the list of select fields in the PL / SQL table l_LogColumnTblInit. <br>  This is a great DBMS_SQL package for us.  Now we can organize a cycle on the select fields. <br>  Anyone who writes in Java (including me today) will laugh at such a victory, there it has always been - the search of fields in PreparedStatement. <br>  Now, knowing Java, I would write, maybe differently, but the basic things would not change. <br>  By the way, here I met a limit on the size of 32K, not immediately, during operation, when they began to write serious selections.  And here I was again pleased Orakl.  It turns out that a long select can be divided into 256 byte portions, loaded into PL / SQL with the l_LongSelectStmt <b>dbms_sql.varchar2s</b> table and transferred to overload the dbms_sql.parse version. <br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> dbms_sql.parse(l_CursorId ,l_LongSelectStmt ,<span class="hljs-number"><span class="hljs-number">1</span></span> ,l_LongSelectStmt.count ,<span class="hljs-literal"><span class="hljs-literal">false</span></span> ,<span class="hljs-number"><span class="hljs-number">1</span></span>); exception when others then v_Msg := '<span class="hljs-comment"><span class="hljs-comment">--After parse long 2: ' || sqlerrm; raise ParsingException; end;</span></span></code> </pre><br>  Now it's time to think about output formats. <br>  Let's say our select looks like this: <br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> a,b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> table1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ...</code> </pre><br>  To output in CSV format you need to write <br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> a||<span class="hljs-keyword"><span class="hljs-keyword">chr</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>)||b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> a,b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> table1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ... )</code> </pre><br>  To output in HTML format you need to write <br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;tr&gt;&lt;td&gt;'</span></span>||a||<span class="hljs-string"><span class="hljs-string">'&lt;/td&gt;&lt;td&gt;'</span></span>||b||<span class="hljs-string"><span class="hljs-string">'&lt;/td&gt;&lt;/tr&gt;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> a,b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> table1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ... )</code> </pre><br>  To create the most beautiful, but also the most complex Excel Workbook format, I had to experiment with Excel.  Excel Workbook is not a binary, but a text file, you can look at it and understand how everything is arranged there. <br>  There are CSS, Workbook definitions, Worksheet, table headers.  I will not go deep, it is not very difficult to understand if you have met before HTML. <br>  In Excel Workbook, the output line will look something like this. <br><pre> <code class="html hljs xml"> select '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:StyleID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"s24"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"String"</span></span></span><span class="hljs-tag">&gt;</span></span>'||a|| '<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag">&gt;</span></span>'|| '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:StyleID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"s25"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DateTime"</span></span></span><span class="hljs-tag">&gt;</span></span>'||b||'<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag">&gt;</span></span>'|| '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:StyleID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"s24"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"String"</span></span></span><span class="hljs-tag">&gt;</span></span>'||c||'<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Row</span></span></span><span class="hljs-tag">&gt;</span></span>' from ( select a,b,c from table2 )</code> </pre><br>  Here, as you can see, knowledge of data types from a virtual table obtained in <b>dbms_sql.describe_columns</b> may be useful to <b>us</b> . <br>  If we compare the types of output, we can say the following: <br>  CSV - small in size (this is a plus), ugly, there is no possibility of several tables (spreadshhets) <br>  HTML - medium in size, quite sexy, there is no possibility of several tables <br>  Excel Workbook - a large file, beautiful, you can create multiple tables <br><br><h4>  Work algorithm </h4><br><h5>  Cycle through fields </h5><br>  Moving on the table of output fields, we wrap the next field in the appropriate format tags or simply add tabulation (CSV).  Now you understand how I hit about these 4000 bytes.  I had to check the length of the result before merging the lines and, if it was more than 4000, I started a new output field, like this: <br><pre> <code class="html hljs xml"> select '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:StyleID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"s24"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"String"</span></span></span><span class="hljs-tag">&gt;</span></span>'||a|| '<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag">&gt;</span></span>'|| '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:StyleID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"s25"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DateTime"</span></span></span><span class="hljs-tag">&gt;</span></span>'||b||'<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag">&gt;</span></span>' 1, '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:StyleID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"s24"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ss:Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"String"</span></span></span><span class="hljs-tag">&gt;</span></span>'||c||'<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Data</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Cell</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Row</span></span></span><span class="hljs-tag">&gt;</span></span>' 2 from ( select a,b,c from table2 )</code> </pre><br>  When is built, we execute it.  If the select is large, then it must be loaded into the <b>dbms_sql.varchar2s</b> table and executed in dbms_sql.  If your DBA says that it does not tolerate literals and requires that the parameters be bind variable, then you also need to use dbms_sql with dbms_sql.bind_variable. <br>  Otherwise, if your select fits in 32K of your varchar2 variable l_Stmt you can open the ref cursor: <br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> l_RefCursor <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> l_Stmt; exception when others then v_Msg := '<span class="hljs-comment"><span class="hljs-comment">--After open: ' || sqlerrm; raise ParsingException; end;</span></span></code> </pre><br><h5>  Cursor cycle </h5><br>  We do fetch and write in utl_file.  We monitor the number of lines and the size of the output file, if necessary, complete it (nicely, Excel correctly) and start the next one. <br>  At the end, or, if it is an Excel Workbook in a separate sheet, we display the parameters with which the report was executed. <br><br>  Well, probably all by and large. <br>  Probably now you can show the result: <br><img src="https://habrastorage.org/getpro/habr/post_images/8f2/789/c1b/8f2789c1bf8a945e4a195164f67a5535.gif" alt="image"><br><br>  If anyone is interested, I can tell you how I wrapped this package in another one, which ziped the file, if it was large, sent it by mail as a link or as an attachment, but the main thing is the parameter definitions and the typical input screen. </div><p>Source: <a href="https://habr.com/ru/post/263323/">https://habr.com/ru/post/263323/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263305/index.html">NSA has posted on GitHub utility to ensure network security</a></li>
<li><a href="../263307/index.html">Genome search with Wolfram Language (Mathematica) and HadoopLink</a></li>
<li><a href="../263313/index.html">Introduction to the analysis of social networks on the example of VK API</a></li>
<li><a href="../263319/index.html">Turning off the strip above the tabs and dragging a new assembly for the tab bar Vivaldi 1.0.231.3</a></li>
<li><a href="../263321/index.html">EU regulators did not find a violation of the law in the activities of the Hacking Team</a></li>
<li><a href="../263325/index.html">How did Pixar solve problems with the filming of "The Puzzle" (The Inside Out)</a></li>
<li><a href="../263327/index.html">ESET & Hacking Team malware</a></li>
<li><a href="../263329/index.html">I resent: the difference between 3D and virtual reality</a></li>
<li><a href="../263331/index.html">Why programming is easy</a></li>
<li><a href="../263333/index.html">Pussy: Refactoring. Part three or brushing roughness</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>