<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple things. Settings file and a small utility trailer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is for those who write in C [/ C ++]. The rest can not read. 

 As always, working on projects I want to share the next technology. Probably...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple things. Settings file and a small utility trailer</h1><div class="post__text post__text-html js-mediator-article">  This post is for those who write in C [/ C ++].  The rest can not read. <br><br>  As always, working on projects I want to share the next technology.  Probably loudly said.  Rather, a simple solution in creating and working with the program settings file. <br><br>  There are many ready-made solutions in the world.  From XML format to ... In short, a lot.  This article does not claim to be something supernovae, does not encourage discussion of style, methods and implementation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I simply share a quick decision on how to read the parameters and values ‚Äã‚Äãseparated by "equal" signs from a format settings file similar to, say, php.ini <br><br><a name="habracut"></a><br><br><h6>  Some lyrics. </h6><br>  I'm lazy.  I'm damn lazy to spend my time analyzing XML, looking for tools for this, exploring the possibilities of various IDEs ... It‚Äôs easier for me to sit down and do it myself the way I like, the way I find it easier.  Long-term use of configuration files of the type &lt;parameter&gt; = &lt;value&gt; for UNIX-like operating systems justifies my choice. <br>  Yes, I reluctantly write on "two pluses". <br><br>  And I will not enter into discussions in the comments feed.  I‚Äôll uncheck message tracking suggestions for this post. <br>  If you like it, take it.  Get (have) better, look, thank you. <br>  The goal is to minimize the use of additional libraries other than stdlib. <br><br><h4>  More practice. </h4><br>  The description of this method is part of the library being created for personal use. <br>  So, we define the source data and settings. <br><div class="spoiler">  <b class="spoiler_title">cs_types.h</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CS_TYPES_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_TYPES_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined WIN32 || defined _WIN32 # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_CDECL __cdecl # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_STDCALL __stdcall #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_CDECL # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_STDCALL #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CS_EXTERN_C_FUNC_PTR # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __cplusplus # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_EXTERN_C_FUNC_PTR(x) extern </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C"</span></span></span><span class="hljs-meta"> { typedef x; } # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_EXTERN_C_FUNC_PTR(x) typedef x # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CS_INLINE # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined __cplusplus # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_INLINE inline # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> (defined WIN32 || defined _WIN32 || defined WINCE) &amp;&amp; !defined __GNUC__ # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_INLINE __inline # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_INLINE static # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* CS_INLINE */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __cplusplus extern </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C"</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (defined WIN32 || defined _WIN32 || defined WINCE) &amp;&amp; defined CSAPI_EXPORTS # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_EXPORTS __declspec(dllexport) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_EXPORTS #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CS_API # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CS_API(rettype) CS_EXPORTS rettype CS_CDECL #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __cplusplus } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//#define DEBUG_MODE #ifdef DEBUG_MODE static short debug_level = 3; #endif #endif /* CS_TYPES_H */</span></span></span></span></code> </pre> <br></div></div><br>  The basic ideas for defining macros I have ‚Äúslyamzil‚Äù in OpenCV. <br><br>  Now we will indicate the data preparation functions and various related utilities: file <br><div class="spoiler">  <b class="spoiler_title">cs_common.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> SC_COMMON_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SC_COMMON_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cs_types.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;getopt.h&gt; /*----------------------------------------------------------------------------*/ /** * @typedef opt_t * @brief    struct option (@see man 3 getopt) */ typedef struct option opt_t; /*----------------------------------------------------------------------------*/ /** * @fn [CS_API] int is_digital ( * const char* __restrict param_value, * long long* __restrict param_digit, * int* param_base ); * @brief ,     . * *     @a param_value     * ,       long long.  *         @a param_base, *     NULL * * @warning   " "  ,    *   (   ). * *    : *    - &lt;&gt;[.e[+|-]&lt;&gt;]&gt; *    - [&lt;&gt;&lt;[h|H]&gt; | [0x|0X]&lt;&gt;] *    - &lt;&gt;&lt;[o|O]&gt; *    - &lt;&gt;&lt;[b|B]&gt; * * @param param_value -   * @param param_digit -      * @param param_base -       * @return   : * 0,    @a param_value - . * 1,    @a param_value - . * -1,   . *    ,  -1,    errno *     : * EINVAL -     ; * ERANGE -       * ENOMEM -      * EBADE -       * */ CS_API(int) is_digital ( const char* __restrict param_value, long long* __restrict param_digit, int* param_base ); /*----------------------------------------------------------------------------*/ /** * @fn CS_API(char*) ltrim( const char* param_str ); * @brief     . * * @param param_str -   * @return    NULL. * *   -     @a param_str,   *  "". *    ,  NULL,    errno *   EINVAL (    ); */ CS_API(char*) ltrim( const char* param_str ); /*----------------------------------------------------------------------------*/ /** * @fn CS_API(char*) rtrim( const char* param_str ); * @brief     . * * @param param_str -   * @return  (static pointer)   NULL. *    ,  NULL,    errno *     : * EINVAL -     ; * ENOMEM -      * EBADE -       * * @warning    - static pointer.  ! */ CS_API(char*) rtrim( const char* param_str ); #ifdef __cplusplus } #endif #endif /* SC_COMMON_H */</span></span></span></span></code> </pre><br></div></div><br><br>  As an old sclerotic with the diagnosis ‚Äúcreated - tested - works - forgot‚Äù I always write comments.  I think the function descriptions are clear. <br><br>  And the main declaration of data and methods specifically for the configuration file is written in <br><div class="spoiler">  <b class="spoiler_title">cs_configfile.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CONFIG_UTILS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CONFIG_UTILS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../include/cs_types.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** * @typedef cfg_val_type_t * @brief    */</span></span></span><span class="hljs-meta"> typedef enum config_value_type { ptDigital = 0x01, </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;   -  */</span></span></span><span class="hljs-meta"> ptString = 0x02 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;   -   */</span></span></span><span class="hljs-meta"> } cfg_val_type_t; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** * @typedef config_t * @brief     */</span></span></span><span class="hljs-meta"> typedef struct { char* name; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;   */</span></span></span><span class="hljs-meta"> cfg_val_type_t type; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;   @a param_type*/</span></span></span><span class="hljs-meta"> union { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;   */</span></span></span><span class="hljs-meta"> char* str; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;   */</span></span></span><span class="hljs-meta"> struct { long long digit; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;   */</span></span></span><span class="hljs-meta"> int base; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;     */</span></span></span><span class="hljs-meta"> }; }; } config_t; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** * @typedef txt_cfg_t * @brief   . */</span></span></span><span class="hljs-meta"> typedef struct txt_cfg { config_t value; struct txt_cfg* prev;</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;      */</span></span></span><span class="hljs-meta"> struct txt_cfg* next;</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt;       */</span></span></span><span class="hljs-meta"> } txt_cfg_t; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __cplusplus extern </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C"</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** * @fn [CS_API] txt_cfg_t* config_Open (const char* __restrict param_filename); * @brief          @a txt_cfg_t. * * @param param_file_name -   * @return     ,   *      \a param_filename    (NULL). * *    NULL,    errno   *  . *     errno: * EINVAL -     param_filename * ENOMEM -    * ERANGE -  .  * EBADE -     * *      ,    *    &lt; &gt; = &lt; &gt;. * : * * # server_broadcast = ANY ( ) * server_broadcast = ANY * * #      * server_port = 8989 * * #   * #  : * # * # server_family = SOCKET_STREAM ( ) * server_family = SOCKET_STREAM * * #usb_vendor = 0x1111 * usb_vendor = 0xffff * usb_product = 0xaaaa * usb_ep_in = 0x01 * * @see config_Close */</span></span></span><span class="hljs-meta"> CS_API(txt_cfg_t*) config_Open (const char* __restrict param_filename); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** * @fn [CS_API] void config_Close (txt_cfg_t** param_item); * @brief   . * * @param param_item -    @a txt_cfg_t * *        @a param_item . *     NULL. * * @see @a config_Open * @see @a free */</span></span></span><span class="hljs-meta"> CS_API(void) config_Close (txt_cfg_t** param_item); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __cplusplus } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* CONFIG_UTILS_H */</span></span></span></span></code> </pre><br></div></div><br><br>  We see that there are only two functions for opening and initializing the structure of parameters and closing with clearing the memory. <br><br><h6>  Think about it. </h6><br>  Perhaps your tastes will allow you to add <code>cfg_val_type_t</code> to the enumeration, for example, <code>ptBool</code> , by creating a parameter processing branch.  Then you - lazier than I myself! <br><br><h5>  Implementations. </h5><br><h6>  For general utilities. </h6><br><div class="spoiler">  <b class="spoiler_title">cs_common.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../include/cs_common.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;errno.h&gt; #include &lt;limits.h&gt; #include &lt;string.h&gt; #include &lt;stdio.h&gt; //#include &lt;netdb.h&gt; /*----------------------------------------------------------------------------*/ int is_digital ( const char* __restrict param_value, long long* __restrict param_digit, int* param_base ) { char* c_endptr; char* c_value; int i_base; int i_ret = 1; size_t u_len; errno = 0; if(param_value == NULL || param_digit == NULL) { errno = EINVAL; return (-1); } *param_digit = 0; errno = 0; /*    */ switch(param_value[strlen(param_value)-1]) { case 'h' : case 'H' : i_base = 16; break; case 'o' : case 'O' : i_base = 8; break; case 'b' : case 'B' : i_base = 2; break; default : i_base = 10; } if(i_base == 10) { if(param_value[strlen(param_value)-1] &lt; (int)'0' || param_value[strlen(param_value)-1] &gt; (int)'9') { return (0); /**/ } } u_len = strlen(param_value); if(u_len &gt; 1) { if((c_value = malloc(u_len+1)) == NULL) { /* ,     ! */ errno = ENOMEM; return (-1); } if((c_value = strncpy(c_value, param_value, u_len)) == NULL) { errno = EBADE; i_ret = -1; } else { /*      16-  */ if(param_value[0] == '0') { switch(param_value[1]) { case 'X' : case 'x' : i_base = 16; break; default : ; } if(i_base == 16) { if((c_value = strncpy(c_value, param_value+2, u_len-2)) == NULL) { errno = EBADE; i_ret = -1; } else { if( strncpy(c_value+u_len-2, "h\0", 2) == NULL ) { errno = EBADE; i_ret = -1; } } } } } if(i_ret &gt; -1) { /*  -   */ *param_digit = strtoll(c_value, &amp;c_endptr, i_base); if(c_endptr == c_value) { /*  */ i_ret = 0; } else { /*   */ if( (errno == ERANGE &amp;&amp; (*param_digit == LLONG_MIN || *param_digit == LLONG_MAX)) || (errno != 0 &amp;&amp; *param_digit == 0) ) { /*   */ i_ret = -1; } } } /*        */ if(param_base != NULL) *param_base = i_base; /*   */ free(c_value); } return(i_ret); } /*----------------------------------------------------------------------------*/ char* ltrim ( const char* param_str ) { size_t i; size_t u_length; if(param_str == NULL) { errno = EINVAL; return (NULL); } errno = 0; u_length = strlen(param_str); if(0 == u_length) return (""); for(i = 0; i &lt; u_length; i++ ) if((int)(param_str[i]) != ' '/*  */) /*     ,   */ return ((char*)param_str+i); return (NULL); } /*----------------------------------------------------------------------------*/ char* rtrim( const char* param_str ) { size_t i; size_t u_length; char* ptr; /* !!! */ static /* !!! */ char* str; if(NULL == param_str) { errno = EINVAL; return (NULL); } u_length = strlen(param_str); if(u_length == 0) return (""); for(i = u_length, errno = 0; (0 == errno) &amp;&amp; (i &gt; 0); i--) { if((int)(param_str[i-1]) == ' ') continue; if(NULL != (ptr = malloc(i + 1))) { if(NULL != (str = strncpy(ptr, param_str, i))) { str[i] = '\0'; return(str); } else { free(ptr); errno = EBADE; } } else { errno = ENOMEM; } } return (NULL); }</span></span></span></span></code> </pre><br></div></div><br><br><h6>  To work with the settings file. </h6><br><div class="spoiler">  <b class="spoiler_title">cs_configfile.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../include/cs_configfile.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../include/cs_common.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;errno.h&gt; #include &lt;limits.h&gt; #include &lt;string.h&gt; /*----------------------------------------------------------------------------*/ /**@internal * @fn void free_cfg_data (txt_cfg_t* param_result); * @brief       @a txt_cfg_t. * * @param param_result -       . */ void free_cfg_data (txt_cfg_t* param_result) { txt_cfg_t* p; errno = 0; for(p = param_result; p != NULL; p = p-&gt;next) { free(p-&gt;value.name); if(p-&gt;value.type == ptString) free(p-&gt;value.str); } if(param_result) free(param_result); } /*----------------------------------------------------------------------------*/ /**@internal * @fn int alloc_cfg_data ( * const char* __restrict param_name, * const char* __restrict param_value, * txt_cfg_t** __restrict param_result * ); * @brief    param_result  txt_cfg_t. * * @param param_name -   * @param param_value -    * @param param_result -        *    txt_params_t. * * @return  0     -1   . *    ,  -1,    *  errno    . * * @warning     *param_result   *  ,         . *            * . */ int alloc_cfg_data ( const char* __restrict param_name, const char* __restrict param_value, txt_cfg_t** __restrict param_result ) { size_t u_length_n, u_length_v; if(param_name == NULL || param_value == NULL || param_result == NULL) { errno = EINVAL; return(-1); } errno = 0; if((*param_result = malloc(sizeof(txt_cfg_t))) == NULL) return(-1); /*  ""! *         ( * free_param(...))       * ,    str   NULL.  *     NULL, ..    . *  -     free() */ if(memset (*param_result, 0, sizeof(txt_cfg_t)) == NULL) return(-1); u_length_n = strlen(param_name); if(u_length_n == 0) return(-1); (*param_result)-&gt;value.name = malloc(u_length_n+1); if((*param_result)-&gt;value.name == NULL) /*    */ goto free; if(strncpy((*param_result)-&gt;value.name, param_name, u_length_n) != NULL) { /*    */ switch( is_digital( param_value, &amp;((*param_result)-&gt;value.digit), &amp;((*param_result)-&gt;value.base) ) ) { case 0 : { /*  */ u_length_v = strlen(param_value); if(u_length_v &gt; 0) { /*   */ (*param_result)-&gt;value.str = malloc(u_length_v+1); if((*param_result)-&gt;value.str == NULL) goto free; if(strncpy((*param_result)-&gt;value.str, param_value, u_length_v) == NULL) goto free; } (*param_result)-&gt;value.type = ptString; } break; case 1 : /*  */ (*param_result)-&gt;value.type = ptDigital; break; default : { /* -  */ errno = ERANGE; goto free; } } return (0); } free: free_cfg_data(*param_result); *param_result = NULL; return (-1); } /*----------------------------------------------------------------------------*/ /**@internal * *    &lt;&gt; = &lt;&gt;       *    . * * @param param_str -   [] = [] * @param param_name -     * @param param_value -     * @return  0     -1   . * *    ,  -1,    *  errno    . * * @warning    *param_value / *param_name  NULL, *      .     *     . */ int parse_string ( const char* param_str, char** param_name, char** param_value ) { if(param_name == NULL || param_value == NULL) { errno = EINVAL; return -1; } *param_value = *param_name = NULL; if(param_str == NULL) { errno = EINVAL; return -1; } switch(param_str[0]) { case '\n' : case '#' : case 0 : return (0); } char c_name[MAX_INPUT]; char c_value[MAX_INPUT]; errno = 0; int i = sscanf(param_str, "%s = %s", c_name, c_value); char* p_name = ltrim(rtrim(c_name)); char* p_value = ltrim(rtrim(c_value)); if(errno != 0 || i != 2 ) return (-1); *param_name = malloc(strlen(p_name)+1); if(*param_name != NULL) { *param_value = malloc(strlen(p_value)+1); if(*param_value != NULL) { if(strcpy(*param_name, p_name) == NULL) { /*   */ errno = EXFULL; goto freemem; } if(strcpy(*param_value, p_value) == NULL) { /*   */ errno = EXFULL; goto freemem; } #ifdef DEBUG_MODE if(debug_level &gt; 3) { printf("DEBUG parse_string(...). c_name = %s, c_value = %s, ", c_name, c_value); printf("*param_name = %s, *param_value = %s\n", *param_name, *param_value); } #endif return (0); } } freemem: if(*param_name != NULL) free(*param_name); if(*param_value != NULL) free(*param_value); *param_value = *param_name = NULL; return(-1); } /*----------------------------------------------------------------------------*/ /**@internal * *    . * * @param param_file_name -        *   * @param param_result -       * @return     0     *    @a param_result.   -1. * * @warning    *param_result  NULL,    *   .        *  . * *    ,     *    @a txt_params_t. *    (  -1)     *     errno.     *param_result *   NULL (    ) * */ int parse_config_file ( const char* param_file_name, txt_cfg_t** param_result ) { if(param_result == NULL || param_result == NULL) { errno = EINVAL; return (-1); } char c_str[MAX_INPUT]; txt_cfg_t* t_param; char* c_name; char* c_value; errno = 0; FILE* p_fd = fopen(param_file_name, "r"); if(p_fd == NULL) /*       */ return (-1); int i_res = 0; *param_result = NULL; errno = 0; /*       */ while(fgets(c_str,MAX_INPUT,p_fd) != NULL &amp;&amp; i_res == 0 ) { /*    */ i_res = parse_string(c_str, &amp;c_name, &amp;c_value); if(i_res == 0) { if(c_name == NULL) /*    (,  ,...) */ continue; #ifdef DEBUG_MODE if(debug_level &gt; 3) printf( "DEBUG parse_confif_file(...): source = \"%s\", name = %s, value = %s \n", c_str, c_name, c_value ); #endif if((i_res = alloc_cfg_data(c_name, c_value, &amp;t_param)) == 0 ) { /*   */ t_param-&gt;next = *param_result; if(*param_result != NULL) (*param_result)-&gt;prev = t_param; } /*        i_res */ /*  :   ! */ free(c_name); free(c_value); *param_result = t_param; }/*        i_res */ } if(i_res != 0) { free_cfg_data(*param_result); *param_result = NULL; } fclose(p_fd); return (i_res); } /*----------------------------------------------------------------------------*/ txt_cfg_t* config_Open (const char* param_filename) { txt_cfg_t* p_item = NULL; (void)parse_config_file(param_filename, &amp;p_item); return (p_item); } /*----------------------------------------------------------------------------*/ void config_Close (txt_cfg_t** param_item) { if(param_item) { if(*param_item) { free_cfg_data(*param_item); *param_item = NULL; } } }</span></span></span></span></code> </pre><br></div></div><br><h6>  Think about it! </h6><br>  In the body of the <code>parse_string</code> function <code>parse_string</code> try applying a regular expression parsing rule.  So you get rid of the obligation to put spaces on both sides of the equal sign. <br>  I was lazy. <br><br>  That's all.  :) <br><br><h4>  We are testing. </h4><br><br>  I use to work on NetBeans IDE C.  Why?  Like!  :) <br>  In this environment, I use Framework <a href="http://cunit.sourceforge.net/">CUnit</a> to build tests. <br><br><h6>  <code>ltrim</code> utility </h6><br><br>  <i>CUnit - A unit testing framework for C - Version 2.1-2</i> <i><br></i>  <i><a href="http://cunit.sourceforge.net/">cunit.sourceforge.net</a></i> <i><br><br></i>  <i>Test: test1 ...</i> <i><br></i>  <i>Check.</i> <i><br></i>  <i>The string "test1".</i>  <i>Result: "test1"</i> <i><br></i>  <i>The string "test 2".</i>  <i>Result: "test 2"</i> <i><br></i>  <i>The string "! 23test3".</i>  <i>Result: "23test3"</i> <i><br></i>  <i>passed</i> <i><br><br></i>  <i>suites 1 1 n / a 0 0</i> <i><br></i>  <i>tests 1 1 1 0 0</i> <i><br></i>  <i>asserts 1 1 1 0 n / a</i> <i><br><br></i>  <i>Elapsed time = 0.000 seconds</i> <i><br></i> <br><br><h6>  <code>rtrim</code> utility </h6><br>  <i>CUnit - A unit testing framework for C - Version 2.1-2</i> <i><br></i>  <i><a href="http://cunit.sourceforge.net/">cunit.sourceforge.net</a></i> <i><br><br></i>  <i>Test: test1 ...</i> <i><br></i>  <i>Check.</i> <i><br></i>  <i>The string "test1".</i>  <i>Result: "test1"</i> <i><br></i>  <i>The string "test 2".</i>  <i>Result: "test 2"</i> <i><br></i>  <i>The string "! 23test3 #".</i>  <i>Result: "! 23test3 #"</i> <i><br></i>  <i>passed</i> <i><br><br></i>  <i>suites 1 1 n / a 0 0</i> <i><br></i>  <i>tests 1 1 1 0 0</i> <i><br></i>  <i>asserts 1 1 1 0 n / a</i> <i><br><br></i>  <i>Elapsed time = 0.000 seconds</i> <i><br></i> <br><br><h6>  <code>is_digital</code> utility </h6><br>  <i>CUnit - A unit testing framework for C - Version 2.1-2</i> <i><br></i>  <i><a href="http://cunit.sourceforge.net/">cunit.sourceforge.net</a></i> <i><br><br></i>  <i>Enter a string to check for numeric value representation: 0xffff</i> <i><br><br></i>  <i>Your string: "0xffff"</i> <i><br><br></i>  <i>Suite: is_digital_test</i> <i><br></i>  <i>Test: test1 ... passed</i> <i><br></i>  <i>Test: test2 ... Test result:</i> <i><br></i>  <i>Number = 65535, Calculus = 16</i> <i><br></i>  <i>passed</i> <i><br><br></i>  <i>Run Summary: Type Total Ran Passed Failed Inactive</i> <i><br></i>  <i>suites 1 1 n / a 0 0</i> <i><br></i>  <i>tests 2 2 2 0 0</i> <i><br></i>  <i>asserts 2 2 2 0 n / a</i> <i><br><br></i>  <i>Elapsed time = 0.000 seconds</i> <i><br><br></i>  <i>CUnit - A unit testing framework for C - Version 2.1-2</i> <i><br></i>  <i><a href="http://cunit.sourceforge.net/">cunit.sourceforge.net</a></i> <i><br><br></i>  <i>Enter a string to check for numeric value representation: 1277o</i> <i><br><br></i>  <i>Your line: "1277o"</i> <i><br><br></i>  <i>Suite: is_digital_test</i> <i><br></i>  <i>Test: test1 ... passed</i> <i><br></i>  <i>Test: test2 ... Test result:</i> <i><br></i>  <i>Number = 703, Calculus = 8</i> <i><br></i>  <i>passed</i> <i><br><br></i>  <i>Run Summary: Type Total Ran Passed Failed Inactive</i> <i><br></i>  <i>suites 1 1 n / a 0 0</i> <i><br></i>  <i>tests 2 2 2 0 0</i> <i><br></i>  <i>asserts 2 2 2 0 n / a</i> <i><br><br></i>  <i>Elapsed time = 0.000 seconds</i> <i><br><br></i>  <i>CUnit - A unit testing framework for C - Version 2.1-2</i> <i><br></i>  <i><a href="http://cunit.sourceforge.net/">cunit.sourceforge.net</a></i> <i><br><br></i>  <i>Enter a string to check for numeric value representation: 4ret</i> <i><br><br></i>  <i>Your line: "4ret"</i> <i><br><br></i>  <i>Suite: is_digital_test</i> <i><br></i>  <i>Test: test1 ... passed</i> <i><br></i>  <i>Test: test2 ... Test result:</i> <i><br></i>  <i>Number = 0, Calculus = 0</i> <i><br></i>  <i>FAILED</i> <i><br></i>  <i>1. tests / is_digital_test.c: 59 - (i_result = is_digital (c_test, &amp; ll_digit, &amp; i_base)) == 1</i> <i><br><br></i>  <i>Run Summary: Type Total Ran Passed Failed Inactive</i> <i><br></i>  <i>suites 1 1 n / a 0 0</i> <i><br></i>  <i>tests 2 2 1 1 0</i> <i><br></i>  <i>asserts 2 2 1 1 n / a</i> <i><br><br></i>  <i>Elapsed time = 0.000 seconds</i> <i><br><br></i>  <i>CUnit - A unit testing framework for C - Version 2.1-2</i> <i><br></i>  <i><a href="http://cunit.sourceforge.net/">cunit.sourceforge.net</a></i> <i><br><br></i>  <i>Enter a string to check for numeric value representation: 1024</i> <i><br><br></i>  <i>Your line: "1024"</i> <i><br><br></i>  <i>Suite: is_digital_test</i> <i><br></i>  <i>Test: test1 ... passed</i> <i><br></i>  <i>Test: test2 ... Test result:</i> <i><br></i>  <i>Number = 1024, Calculus = 10</i> <i><br></i>  <i>passed</i> <i><br><br></i>  <i>Run Summary: Type Total Ran Passed Failed Inactive</i> <i><br></i>  <i>suites 1 1 n / a 0 0</i> <i><br></i>  <i>tests 2 2 2 0 0</i> <i><br></i>  <i>asserts 2 2 2 0 n / a</i> <i><br><br></i>  <i>Elapsed time = 0.000 seconds</i> <i><br><br></i> <br><br><h6>  Parsing configuration file. </h6><br>  File: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#------------------------------------------------------------------------------- # :          #    . #------------------------------------------------------------------------------- # #pid_file = ereusb.pid #    #  : bla, bla, bla... # # server_broadcast = ANY ( ) server_broadcast = ANY #      server_port = 8989 #   #  : # # server_family = SOCKET_STREAM ( ) server_family = SOCKET_STREAM #usb_vendor = 0x1111 usb_vendor = 0001b usb_product = 1234o usb_ep_in = 0x01 usb_ep_out = 0x82</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Result:</b> <div class="spoiler_text">  <i>CUnit - A unit testing framework for C - Version 2.1-2</i> <i><br></i>  <i><a href="http://cunit.sourceforge.net/">cunit.sourceforge.net</a></i> <i><br><br></i>  <i>Test: test_parse_confif_file ...</i> <i><br></i>  <i>Parameter:</i> <i><br></i>  <i>Name - "usb_ep_out"</i> <i><br></i>  <i>Type - number</i> <i><br></i>  <i>Value - 0x0082</i> <i><br></i>  <i>Base system - 16</i> <i><br><br></i>  <i>Parameter:</i> <i><br></i>  <i>The name is "usb_ep_in"</i> <i><br></i>  <i>Type - number</i> <i><br></i>  <i>Value - 0x0001</i> <i><br></i>  <i>Base system - 16</i> <i><br><br></i>  <i>Parameter:</i> <i><br></i>  <i>Name - "usb_product"</i> <i><br></i>  <i>Type - number</i> <i><br></i>  <i>Value - 1234</i> <i><br></i>  <i>Base system - 8</i> <i><br><br></i>  <i>Parameter:</i> <i><br></i>  <i>The name is "usb_vendor"</i> <i><br></i>  <i>Type - number</i> <i><br></i>  <i>Value - 1</i> <i><br></i>  <i>Basic system - 2</i> <i><br><br></i>  <i>Parameter:</i> <i><br></i>  <i>Name - "server_family"</i> <i><br></i>  <i>Type - string</i> <i><br></i>  <i>Value is "SOCKET_STREAM"</i> <i><br><br></i>  <i>Parameter:</i> <i><br></i>  <i>Name - "server_port"</i> <i><br></i>  <i>Type - number</i> <i><br></i>  <i>Value - 8989</i> <i><br></i>  <i>Basic system - 10</i> <i><br><br></i>  <i>Parameter:</i> <i><br></i>  <i>Name - "server_broadcast"</i> <i><br></i>  <i>Type - string</i> <i><br></i>  <i>Value - "ANY"</i> <i><br></i>  <i>passed</i> <i><br><br></i>  <i>suites 1 1 n / a 0 0</i> <i><br></i>  <i>tests 1 1 1 0 0</i> <i><br></i>  <i>asserts 1 1 1 0 n / a</i> <i><br><br></i>  <i>Elapsed time = 0.000 seconds</i> <i><br></i> <br></div></div><br><br><h4>  Thanks </h4><br><ul><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B8%25D1%2582%25D1%2587%25D0%25B8,_%25D0%2594%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B8%25D1%2581">Dennis Ritchie</a> (RIP) for the ingenious development of the C programming language; </li><li>  Sun Microsystems (RIP) for the development of <a href="http://netbeans.org/index_ru.html">NetBeans IDE</a> ; </li><li>  John Douglas Lord (RIP) for ‚ÄúConcerto For Group and Orchestra‚Äù, which accompanied the post. </li></ul><br>  All the best! </div><p>Source: <a href="https://habr.com/ru/post/148930/">https://habr.com/ru/post/148930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148925/index.html">Results and statistics of the first Habrakamp</a></li>
<li><a href="../148926/index.html">We write a simple map using Nokia Maps JS API</a></li>
<li><a href="../148927/index.html">Visual Studio 2012 will be available on September 12</a></li>
<li><a href="../148928/index.html">Creating and registering the Metro style component for WinRT</a></li>
<li><a href="../148929/index.html">Yandex.Money from Europe with a low commission</a></li>
<li><a href="../148933/index.html">Fast zombies</a></li>
<li><a href="../148937/index.html">Free ebooks from Microsoft</a></li>
<li><a href="../148938/index.html">Simple as java</a></li>
<li><a href="../148939/index.html">Habrastats</a></li>
<li><a href="../148940/index.html">Juggling. Theory. Practice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>