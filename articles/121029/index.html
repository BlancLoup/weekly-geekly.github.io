<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kana-captcha for PHP - it's easy!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this topic, I will briefly tell you about Kana-Capche, what it is, how it works and how to make it using PHP. 



 Katakana 
 In Japanese, two syll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kana-captcha for PHP - it's easy!</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage/a4457b01/588f79ac/ac689c3c/04ffd17f.png"></div><br>  In this topic, I will briefly tell you about Kana-Capche, what it is, how it works and how to make it using PHP. <br><br><a name="habracut"></a><br><br><h4>  Katakana </h4><br>  In Japanese, two syllable alphabets (katakana, hiragana) and pro-Chinese characters (kanji) are used for writing.  By the way, kanji have little in common in pronunciation with Chinese characters.  They were brought to Japan at the beginning of our era and they developed in their own way (man-yogan).  There are countless kanjas (knowledge of 2-4 thousand kanji is considered to be the limiting degree of education of the Japanese).  In the case of syllabic alphabets, everything is simpler, hiragana (can be used to write anything) has 47 basic characters, the same number of characters is also present in katakana (used mainly to write borrowed words, for example ニ タ (m-ni-ta) - monitor). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The syllabary alphabet is called so precisely because each character is a syllable consisting of one consonant and one vowel (with the exception of the vowels and the consonant "n", these signs have their own symbols).  Hiragana is considered to be the main one (in some cases, hiragana transcription is prescribed over kanjas, for the convenience of poorly educated people), katakana is secondary.  That is what we consider today. <br><br>  And we will consider it because the katakana characters are the easiest to write, therefore it will be easier for us, 外人, to enter and recognize them.  By the way, it is katakana that Japanese children study first of all, for the same reason. <br><br>  A small addition - in the picture at the beginning of the topic in Katakana it is written "チ ュ ー リ ン グ テ ス ト" (ti-yu-ri-n-hoo-te-s-something), which means "Turing Test".  "Turing" is written in Katakana, as this is a foreign name proper.  In the case of "Test" the reason is that this word is borrowed. <br><br><h4>  Development </h4><br>  In the meantime, let us remember what for us, 馬鹿 外人, kana-kapcha.  This is an image with the symbols of katakana \ hiragana, in the field you need to enter the <u>transcription</u> .  Just because not all 外人 in the system have support for entering the characters we need. <br><br>  I will take <a href="http://habrahabr.ru/blogs/php/120615/">my script</a> as a basis, and modify it only slightly.  To begin with, let us define what our kana-captcha will be.  These will be two or three black katakana symbols on a white background + intersecting black lines. <br><br>  First, I want to get rid of all indecency in my script.  I remove the eye-catching background, make the text and lines black.  We get this: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/3279f786/8720c445/68870bbb/73951d81.png"></div><br><br>  Now it's time to shove our katakana into our picture.  First of all, let's decide on the font, for Japanese syllabic alphabets, I think the best variant is <a href="http://www.microsoft.com/typography/fonts/font.aspx%3FFMID%3D1269">MS Gothic</a> , the cutest font.  To my surprise, the .TTC font was perceived by PHP absolutely normal.  Honestly, I expected a lot of hemorrhoids with this type of TrueType font. <br><br>  Next, you need to modify the script that generates the captcha code.  First, let's feed him new symbols, namely: "" イ ウ エ オ カ カ キ ク ケ. サ シ ス セ ソ ソ タ チ ツ テ ト ナ ニ ネ ヌ ノ ハ ヒ フ ヘ ホ マ マ ミ ム メ モ ヤ ユ ヨ ラ リ フ ヘ ホ マ ミ ム  These are all basic katakana characters.  The generation function will look like this: <pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $chars = <span class="hljs-string"><span class="hljs-string">'アイウエオカキクケコサシスセソタチツテトナニネヌノハヒフヘホマミムメモヤユヨラリルレロワン'</span></span>; $length = rand(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); $numChars = mb_strlen($chars, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); $str = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $length; $i++) { $str .= mb_substr($chars, rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, $numChars) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $str; }</code> </pre>  Note!  I use multi-byte variants of the strlen and substr functions. <br><br>  Then a little bit, let's randomize the random positions of the characters in the generation script, as well as introduce multibyte functions: <pre> <code class="php hljs"> $x = rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; mb_strlen($code, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); $i++) { $x+=<span class="hljs-number"><span class="hljs-number">27</span></span>; $letter=mb_substr($code, $i, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); imagettftext ($im, $font_arr[$n][<span class="hljs-string"><span class="hljs-string">"size"</span></span>], rand(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), $x, rand(<span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>), <span class="hljs-string"><span class="hljs-string">"000000"</span></span>, img_dir.$font_arr[$n][<span class="hljs-string"><span class="hljs-string">"fname"</span></span>], $letter); }</code> </pre>  As a result, we get this: <br><div style="text-align:center;"><img src="http://habrastorage.org/storage/cc9308f9/6050162f/faf2921f/9f77b30b.png"></div><br><br>  Almost done.  I checked the work of the captcha by entering the correct version of exactly what the katakana characters.  But what to do 馬鹿 外人 who do not have support for entering Japanese characters?  It is necessary to make so that validation would pass with transcription.  You need to write the whole function: <pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kanatoroma</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($str)</span></span></span></span>{ $replace_of = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ア'</span></span>,<span class="hljs-string"><span class="hljs-string">'イ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ウ'</span></span>,<span class="hljs-string"><span class="hljs-string">'エ'</span></span>,<span class="hljs-string"><span class="hljs-string">'オ'</span></span>,<span class="hljs-string"><span class="hljs-string">'カ'</span></span>,<span class="hljs-string"><span class="hljs-string">'キ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ク'</span></span>,<span class="hljs-string"><span class="hljs-string">'ケ'</span></span>,<span class="hljs-string"><span class="hljs-string">'コ'</span></span>, <span class="hljs-string"><span class="hljs-string">'サ'</span></span>,<span class="hljs-string"><span class="hljs-string">'シ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ス'</span></span>,<span class="hljs-string"><span class="hljs-string">'セ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ソ'</span></span>,<span class="hljs-string"><span class="hljs-string">'タ'</span></span>,<span class="hljs-string"><span class="hljs-string">'チ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ツ'</span></span>,<span class="hljs-string"><span class="hljs-string">'テ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ト'</span></span>,<span class="hljs-string"><span class="hljs-string">'ナ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ニ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ネ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ヌ'</span></span>, <span class="hljs-string"><span class="hljs-string">'ノ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ハ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ヒ'</span></span>,<span class="hljs-string"><span class="hljs-string">'フ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ヘ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ホ'</span></span>,<span class="hljs-string"><span class="hljs-string">'マ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ミ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ム'</span></span>,<span class="hljs-string"><span class="hljs-string">'メ'</span></span>,<span class="hljs-string"><span class="hljs-string">'モ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ヤ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ユ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ヨ'</span></span>, <span class="hljs-string"><span class="hljs-string">'ラ'</span></span>,<span class="hljs-string"><span class="hljs-string">'リ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ル'</span></span>,<span class="hljs-string"><span class="hljs-string">'レ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ロ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ワ'</span></span>,<span class="hljs-string"><span class="hljs-string">'ン'</span></span>); $replace_by = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'i'</span></span>,<span class="hljs-string"><span class="hljs-string">'u'</span></span>,<span class="hljs-string"><span class="hljs-string">'e'</span></span>,<span class="hljs-string"><span class="hljs-string">'o'</span></span>,<span class="hljs-string"><span class="hljs-string">'ka'</span></span>,<span class="hljs-string"><span class="hljs-string">'ki'</span></span>,<span class="hljs-string"><span class="hljs-string">'ku'</span></span>, <span class="hljs-string"><span class="hljs-string">'ke'</span></span>,<span class="hljs-string"><span class="hljs-string">'ko'</span></span>,<span class="hljs-string"><span class="hljs-string">'sa'</span></span>,<span class="hljs-string"><span class="hljs-string">'shi'</span></span>,<span class="hljs-string"><span class="hljs-string">'su'</span></span>,<span class="hljs-string"><span class="hljs-string">'se'</span></span>,<span class="hljs-string"><span class="hljs-string">'so'</span></span>,<span class="hljs-string"><span class="hljs-string">'ta'</span></span>,<span class="hljs-string"><span class="hljs-string">'chi'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsu'</span></span>,<span class="hljs-string"><span class="hljs-string">'te'</span></span>, <span class="hljs-string"><span class="hljs-string">'to'</span></span>,<span class="hljs-string"><span class="hljs-string">'na'</span></span>,<span class="hljs-string"><span class="hljs-string">'ni'</span></span>,<span class="hljs-string"><span class="hljs-string">'ne'</span></span>,<span class="hljs-string"><span class="hljs-string">'nu'</span></span>,<span class="hljs-string"><span class="hljs-string">'no'</span></span>,<span class="hljs-string"><span class="hljs-string">'ha'</span></span>,<span class="hljs-string"><span class="hljs-string">'hi'</span></span>,<span class="hljs-string"><span class="hljs-string">'fu'</span></span>,<span class="hljs-string"><span class="hljs-string">'he'</span></span>,<span class="hljs-string"><span class="hljs-string">'ho'</span></span>,<span class="hljs-string"><span class="hljs-string">'ma'</span></span>, <span class="hljs-string"><span class="hljs-string">'mi'</span></span>,<span class="hljs-string"><span class="hljs-string">'mu'</span></span>,<span class="hljs-string"><span class="hljs-string">'me'</span></span>,<span class="hljs-string"><span class="hljs-string">'mo'</span></span>,<span class="hljs-string"><span class="hljs-string">'ya'</span></span>,<span class="hljs-string"><span class="hljs-string">'yu'</span></span>,<span class="hljs-string"><span class="hljs-string">'yo'</span></span>,<span class="hljs-string"><span class="hljs-string">'ra'</span></span>,<span class="hljs-string"><span class="hljs-string">'ri'</span></span>,<span class="hljs-string"><span class="hljs-string">'ru'</span></span>,<span class="hljs-string"><span class="hljs-string">'re'</span></span>,<span class="hljs-string"><span class="hljs-string">'ro'</span></span>,<span class="hljs-string"><span class="hljs-string">'wa'</span></span>,<span class="hljs-string"><span class="hljs-string">'n'</span></span>); $_result = str_replace($replace_of, $replace_by, $str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_result; }</code> </pre> <br>  With this wonderful feature, we save the correct captcha solution in the form of romaji to the session. <br>  That's all :) Kana-Captcha is ready! <br>  <a href="http://xn--80aaaac9cp2ad7b.xn--p1ai/captcha/kana/">Test yourself for katakana knowledge</a> <br>  <a href="http://www.primitivestate.com/GetImage.ashx%3Ffile_id%3D761%26im%3D7">Cheat</a> <br><br>  By the way, I took this domain specifically, so that in the future I would host all kinds of nishtyaks under it, which I will publish in Habré :) <br><br>  And yes, this is not my last topic about captcha, the most interesting thing to come :) </div><p>Source: <a href="https://habr.com/ru/post/121029/">https://habr.com/ru/post/121029/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121021/index.html">SRP-6: authentication without sending a password</a></li>
<li><a href="../121022/index.html">Determining the area of ​​a complex figure using probability theory</a></li>
<li><a href="../121024/index.html">Skyrim presentation at E3</a></li>
<li><a href="../121025/index.html">Dev Derby - monthly demos contest</a></li>
<li><a href="../121028/index.html">Presentation of World of Tanks at E3</a></li>
<li><a href="../121030/index.html">IPO for dummies. Part III: the IPO process, its benefits for the company, the founders and owners, and why the company’s management has such a tortured look when opening trades</a></li>
<li><a href="../121031/index.html">NumPy, a guide for beginners. Part 1</a></li>
<li><a href="../121032/index.html">Hacking Matan Captcha in C # is Easy!</a></li>
<li><a href="../121033/index.html">Preliminary Program Development Program / CEE-SECR 2011 Conference Published</a></li>
<li><a href="../121034/index.html">Notification of unauthorized access to the web application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>