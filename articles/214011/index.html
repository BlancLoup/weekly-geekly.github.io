<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Weather Station on Ethernet (HTTP + Modbus) powered by POE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to the habr-community. 
 Much time has passed since my last post about the smart home . I decided to do it starting from the weather station....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Weather Station on Ethernet (HTTP + Modbus) powered by POE</h1><div class="post__text post__text-html js-mediator-article">  Good day to the habr-community. <br>  Much time has passed since my <a href="http://habrahabr.ru/post/187410/">last post about the smart home</a> .  I decided to do it starting from the weather station. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/468/8d5/ad5/4688d5ad5db8fe19d44691f537292a64.jpg"><br>  <i>Figure 1 - Photo of the prototype</i> <br><br>  Despite the abundance of articles about weather stations on the arduino (http://habrahabr.ru/post/165747/, <a href="http://habrahabr.ru/post/171525/">habrahabr.ru/post/171525</a> , <a href="http://habrahabr.ru/post/213405/">habrahabr.ru/post/213405</a> ) I still decided to publish my decision. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Functional </h5><br><br>  Functions that it performs: <br><ul><li>  Temperature measurement </li><li>  Moisture measurement </li><li>  Pressure measurement </li><li>  Light measurement </li><li>  Indication of measured parameters </li><li>  Delivery of measured parameters via the HTTP interface as an XML document </li><li>  HTTP XSLT processor output for XML styling when displayed by the browser </li><li>  Issuance of information on Modbus (I intend to use it as a smart home control protocol) </li><li>  Power through Passive POE </li></ul><br><a name="habracut"></a><br>  Functions that could not be implemented, but I wanted: <br><ul><li>  Measurement of precipitation </li><li>  Direction of the wind </li><li>  Wind speed </li><li>  DHCP client </li></ul><br>  The cost of ~ 1700 rubles (at the rate at the time of purchase), it included: <br><ol><li>  DHT22 Digital Temperature And Humidity Sensor $ 5.13 </li><li>  GY-65 BMP085 Atmospheric Pressure Altimeter Module $ 4.09 </li><li>  GY-302 BH1750 Chip Light Intensity Light Module $ 2.85 </li><li>  IBOARD W5100 Ethernet Module for Arduino Development Board with POE / Xbee and SD Card Slot Expansion $ 18.46 </li><li>  MAX7219 Digital Tube Display Module $ 4.74 </li><li>  40pcs 20cm 2.54mm 1p-1p pin Dupont wire cable Line connector $ 2.42 </li><li>  FT232RL USB To Serial Line Download Line Downloader USB TO 232 $ 4.47 </li><li>  Plastic case ~ 100 rubles </li></ol><br><br><h5>  Device implementation </h5><br>  The device was completely assembled from commercially available Arduino-based components.  All sensors were wired and located inside the purchased housing of the ale of electrical equipment.  Transparent windows in a prototype are made of transparent adhesive tape. <br><br>  The device has an LED-display that will work well at low temperatures, and allows you to use the device for its intended purpose without a computer.  For convenience of use at night - the feedback on illumination is organized in the software. <br><br>  The Iboard w5100 board was chosen as the brain, due to the fact that it already has all the arduino + Ethernet shield + sensor board for power and ground multiplication, when a large number of devices are connected.  Such a highly integrated fee saves money and space.  This board also supports Passiv POE. <br><br>  I decided to make the data transfer wired (unlike most smart home solutions) for the following reasons: <br><ol><li>  Wire anyway pull - whether it be power or data transfer </li><li>  If it is decided to power the device from chemical power sources, then the question of their replacement will arise </li><li>  Wired communications seem more reliable: <br><ol><li>  They will have no complaints from Roskomnadzor, since they do not emit anything </li><li>  There will be no problems with the mutual influence of other transceivers in the same frequency </li><li>  There will not be a huge number of problems associated with the implementation of radio communications (temporary separation of the ether, signal attenuation, the influence of other such systems when overlapping reception areas, etc.) </li><li>  There will be calm people with whom Wifi warms the brain. </li></ol></li></ol><br>  In order not to produce interfaces, and to do everything in a uniform way - I decided to use Ethernet for data transfer.  Power is transmitted over the same wire using Passiv POE technology.  Advantages of this method - if all devices are connected to a common Ethernet network - then there will be no issue with protocol convectors / gateways. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba5/cb8/71a/ba5cb871abea2de0b2cd915b68ba2a02.png"><br>  <i>Figure 2 - Block diagram of the device</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef1/d18/cc2/ef1d18cc2a711131303fd1a71db94e9b.png"><br>  <i>Figure 3 - Connection Diagram</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82d/c43/f42/82dc43f42659132c9dab756903a6fa57.jpg"><br>  <i>Figure 4 - Inside view</i> <br><br><h5>  Implementing Passiv POE </h5><br>  Passive POE - This is a special implementation of the POE modules.  In the original POE, a protocol implementation is required, while the injector determines the power of the remote equipment when the connection is established, and if it can power it, then write it down.  Passive POE was invented by cunning Chinese who did not want to make such a cunning implementation, but wanted to enter the market of POE equipment, and as a result they came up with stupidly applying voltage to unused twisted pairs of category 5E cable.  Some even write that they allegedly adhere to the IEEE 802.3af standard in terms of electrical characteristics, but even this is not always the case. <br><br>  The IBOARD W5100 works if a voltage of 6-20V is applied to pins 4.5 and 7.8 of the Ethernet connector.  I am serving 20 V. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb2/182/b1e/cb2182b1ed6a1e60ae6f5a0c40ade276.jpg"><br>  <i>Figure 5 - Connection Diagram for POE Injection</i> <br><br>  I built the injector into the D-LINK 320, installing a Chinese boost DC-DC converter into it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5c/a04/6a9/f5ca046a90c22720278636f377490c59.jpg"><br>  <i>Figure 6 - Photo modification</i> <br><br>  After installation - it all worked. <br><br>  Attention!  Before turning on, check that the power source is configured to issue 20V. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4e/c76/dad/c4ec76dad0b9d86cff0911c7f541e3db.jpg"><br>  <i>Figure 7 - Works of the whole structure</i> <br><br><h5>  WEB-interface implementation </h5><br>  The web-interface was made for the most convenient interaction with the device from the network without additional software on the client side.  For the possibility of automated data access, it would be convenient to provide information in the form of an XML file.  In this project, these two ways of accessing data were combined through the use of an XSLT processor. <br><br>  The web browser sends a request for <a href="http://192.168.0.20/">192.168.0.20</a> ;  Arduino responds with an XML document: <br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?xml-stylesheet type="text/xsl" href="http://192.168.0.20/z1.xsl"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">response</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">temperature</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">celsius</span></span></span><span class="hljs-tag">&gt;</span></span>30.70<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">celsius</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensor</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'BMP'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">unit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'C'</span></span></span><span class="hljs-tag">&gt;</span></span>32.62<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensor</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensor</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'DHT'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">unit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'C'</span></span></span><span class="hljs-tag">&gt;</span></span>30.70<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensor</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">temperature</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">humidity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">percentage</span></span></span><span class="hljs-tag">&gt;</span></span>21.60<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">percentage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">humidity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pressure</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pa</span></span></span><span class="hljs-tag">&gt;</span></span>99309<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pa</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mmHg</span></span></span><span class="hljs-tag">&gt;</span></span>745<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mmHg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pressure</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">illuminance</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lx</span></span></span><span class="hljs-tag">&gt;</span></span>11<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lx</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">illuminance</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">response</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  To display this information in a beautiful way, the browser loads the XSLT processor and generates an HTML document using it. <br><div class="spoiler">  <b class="spoiler_title">Source code</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:stylesheet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1.0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'http://www.w3.org/1999/XSL/Transform'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Weather station<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'refresh'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'5'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.z1</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-family</span></span></span><span class="css">:Arial, Helvetica, sans-serif; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">color</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">#666</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-size</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">12px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">text-shadow</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">0px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">#fff</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">#eaebec</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">#ccc</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> solid; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border-collapse</span></span></span><span class="css">:separate; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border-radius</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">3px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">box-shadow</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">2px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">#d1d1d1</span></span></span><span class="css">; } </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.z1</span></span></span><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">th</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-weight</span></span></span><span class="css">:bold; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">15px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border-bottom</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> solid </span><span class="hljs-number"><span class="css"><span class="hljs-number">#e0e0e0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">#ededed</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">: </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">linear-gradient</span></span></span><span class="css">(to top, #ededed, #ebebeb); } </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.z1</span></span></span><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">td</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">10px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">#f2f2f2</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">: </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">linear-gradient</span></span></span><span class="css">(to top, #f2f2f2, #f0f0f0); } </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.z1</span></span></span><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">tr</span></span></span><span class="hljs-selector-pseudo"><span class="css"><span class="hljs-selector-pseudo">:hover</span></span></span><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">td</span></span></span><span class="css">{ </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">#aaaaaa</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">: </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">linear-gradient</span></span></span><span class="css">(to top, #f2f2f2, #e0e0e0); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Weather station<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'z1'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Property<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Value<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> Temperature <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'response/temperature/celsius'</span></span></span><span class="hljs-tag">/&gt;</span></span> C<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> Humidity <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'response/humidity/percentage'</span></span></span><span class="hljs-tag">/&gt;</span></span> %<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> Pressure <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'response/pressure/mmHg'</span></span></span><span class="hljs-tag">/&gt;</span></span> mm.Hg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> Illuminance <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'response/illuminance/lx'</span></span></span><span class="hljs-tag">/&gt;</span></span> lx<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Termosensor<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'z1'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Sensor<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Value<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:for-each</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'response/temperature/sensors/sensor'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'@name'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'.'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'@unit'</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:for-each</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:stylesheet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br>  As a result of all these activities, this XML document in a Web browser looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/569/1d8/2b45691d86508670a85bcb962bd66816.png"><br>  <i>Figure 8 - The appearance of the web interface in Firefox</i> <br><br><h5>  Software </h5><br><br>  In software, I tried to use ready-made libraries to the maximum to speed up the process. <br><br>  The program logic is quite simple - we initialize all the devices by calling the corresponding functions from the libraries. <br><br>  In the cycle, we read all the sensor readings, if necessary - update the data on the 8-bit LED indicator and process the request via the Ethernet network. <br><br>  The following libraries were used in the project: <br><ul><li>  <a href="http://playground.arduino.cc/Main/DHTLib">DHTLib</a> - Temperature / Humidity <a href="http://playground.arduino.cc/Main/DHTLib">Sensor</a> Access Library </li><li>  <a href="https://github.com/adafruit/Adafruit-BMP085-Library">Adafruit-BMP085-Library</a> - Pressure / Temperature <a href="https://github.com/adafruit/Adafruit-BMP085-Library">Sensor</a> Access Library </li><li>  <a href="https://github.com/claws/BH1750">BH1750</a> - Library of access to the light sensor </li><li>  <a href="http://playground.arduino.cc/Main/LedControl">LedControl</a> - Library of work with LED indicator for SPI control panel </li><li>  <a href="https://github.com/sirleech/Webduino/">Webduino</a> - HTTP protocol implementation library </li><li>  <a href="http://code.google.com/p/mudbus/">Mudbus</a> - Modbus Protocol Implementation Library </li></ul><br><br>  It is worth noting that in order to display letters - I had to upgrade the symbol table in the LedControl library.  By default, this library can only display the letters af. <br><br><div class="spoiler">  <b class="spoiler_title">Source code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Ethernet.h&gt; #include &lt;SPI.h&gt; #include &lt;Wire.h&gt; #include "DHT.h" #include "BH1750.h" #include "Adafruit_BMP085.h" #include "LedControl.h" #include "Mudbus.h" #include "WebServer.h" #define WEATHER_STATION_Z1 0x20 // =============================================================== #define DHT_S1_PIN A0 //    DHT22 // =============================================================== // assign a MAC address for the ethernet controller. // fill in your address here: byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED}; // assign an IP address for the controller: IPAddress ip(192,168,0,20); IPAddress gateway(192,168,0,1); IPAddress subnet(255, 255, 255, 0); // =============================================================== float humidity = 0, temp_dht = 0, temp_bmp = 0, temp = 0; uint16_t light = 0; int32_t pressure_pa = 0, pressure_mm = 0; int mode = 0; dht dht_s1; BH1750 lightMeter; Adafruit_BMP085 bmp; /* This creates an instance of the webserver. By specifying a prefix * of "", all pages will be at the root of the server. */ #define PREFIX "" WebServer webserver(PREFIX, 80); //EthernetServer webserver(80); #define DEV_ID Mb.R[0] #define TEMPERATURE Mb.R[1] #define TEMPERATURE_DHT Mb.R[2] #define TEMPERATURE_BMP Mb.R[3] #define HUMIDITY Mb.R[4] #define PRESSURE_MM Mb.R[5] #define LIGHT Mb.R[6] Mudbus Mb; // pin A5 is connected to the DataIn // pin A6 is connected to the CLK // pin A7 is connected to LOAD LedControl lc=LedControl(A1,A2,A3,1); // ======================== Web pages ========================== void web_index(WebServer &amp;server, WebServer::ConnectionType type, char *, bool) { /* this line sends the standard "we're all OK" headers back to the browser */ server.httpSuccess("application/xml; charset=utf-8"); /* if we're handling a GET or POST, we can output our data here. For a HEAD request, we just stop after outputting headers. */ if (type != WebServer::HEAD) { /* this defines some HTML text in read-only memory aka PROGMEM. * This is needed to avoid having the string copied to our limited * amount of RAM. */ P(index_p1) = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;" "&lt;?xml-stylesheet type=\"text/xsl\" href=\"http://192.168.0.20/z1.xsl\"?&gt;" "&lt;response&gt;" " &lt;temperature&gt;" " &lt;celsius&gt;"; P(index_p2) = "&lt;/celsius&gt;" " &lt;sensors&gt;" " &lt;sensor name='BMP' unit='C'&gt;"; P(index_p3) = "&lt;/sensor&gt;" " &lt;sensor name='DHT' unit='C'&gt;"; P(index_p4) = "&lt;/sensor&gt;" " &lt;/sensors&gt;" " &lt;/temperature&gt;" " &lt;humidity&gt;" " &lt;percentage&gt;"; P(index_p5) = "&lt;/percentage&gt;" " &lt;/humidity&gt;" " &lt;pressure&gt;" " &lt;pa&gt;"; P(index_p6) = "&lt;/pa&gt;" " &lt;mmHg&gt;"; P(index_p7) = "&lt;/mmHg&gt;" " &lt;/pressure&gt;" " &lt;illuminance&gt;" " &lt;lx&gt;"; P(index_p8) = "&lt;/lx&gt;" " &lt;/illuminance&gt;" "&lt;/response&gt;"; /* this is a special form of print that outputs from PROGMEM */ server.printP(index_p1); server.print(temp); server.printP(index_p2); server.print(temp_bmp); server.printP(index_p3); server.print(temp_dht); server.printP(index_p4); server.print(humidity); server.printP(index_p5); server.print(pressure_pa); server.printP(index_p6); server.print(pressure_mm); server.printP(index_p7); server.print(light); server.printP(index_p8); } } void web_z1_xsl(WebServer &amp;server, WebServer::ConnectionType type, char *, bool) { server.httpSuccess("text/xsl; charset=utf-8"); if (type != WebServer::HEAD) { P(z1_xsl) = "&lt;?xml version='1.0' encoding='UTF-8'?&gt;" "&lt;xsl:stylesheet version='1.0' xmlns:xsl='http://www.w3.org/1999/XSL/Transform'&gt;" "&lt;xsl:template match='/'&gt;" " &lt;html&gt;" " &lt;head&gt;" " &lt;title&gt;Weather station&lt;/title&gt;" " &lt;meta http-equiv='refresh' content='5'/&gt;" " &lt;style&gt;" " .z1 {" " font-family:Arial, Helvetica, sans-serif;" " color:#666;" " font-size:12px;" " text-shadow: 1px 1px 0px #fff;" " background:#eaebec;" " margin:20px;" " border:#ccc 1px solid;" " border-collapse:separate; " " border-radius:3px;" " box-shadow: 0 1px 2px #d1d1d1;" " }" " .z1 th {" " font-weight:bold;" " padding:15px;" " border-bottom:1px solid #e0e0e0;" " background: #ededed;" " background: linear-gradient(to top, #ededed, #ebebeb);" " }" " .z1 td {" " padding:10px;" " background: #f2f2f2;" " background: linear-gradient(to top, #f2f2f2, #f0f0f0); " " }" " .z1 tr:hover td{" " background: #aaaaaa;" " background: linear-gradient(to top, #f2f2f2, #e0e0e0); " " }" " &lt;/style&gt;" " &lt;/head&gt;" " &lt;body&gt;" " &lt;h2&gt;Weather station&lt;/h2&gt;" " &lt;table class='z1'&gt;" " &lt;tr&gt;" " &lt;th&gt;Property&lt;/th&gt;" " &lt;th&gt;Value&lt;/th&gt;" " &lt;/tr&gt;" " &lt;tr&gt;" " &lt;td&gt; Temperature &lt;/td&gt;" " &lt;td&gt;&lt;xsl:value-of select='response/temperature/celsius'/&gt; C&lt;/td&gt;" " &lt;/tr&gt;" " &lt;tr&gt;" " &lt;td&gt; Humidity &lt;/td&gt;" " &lt;td&gt;&lt;xsl:value-of select='response/humidity/percentage'/&gt; %&lt;/td&gt;" " &lt;/tr&gt;" " &lt;tr&gt;" " &lt;td&gt; Pressure &lt;/td&gt;" " &lt;td&gt;&lt;xsl:value-of select='response/pressure/mmHg'/&gt; mm.Hg&lt;/td&gt;" " &lt;/tr&gt;" " &lt;tr&gt;" " &lt;td&gt; Illuminance &lt;/td&gt;" " &lt;td&gt;&lt;xsl:value-of select='response/illuminance/lx'/&gt; lx&lt;/td&gt;" " &lt;/tr&gt;" " &lt;/table&gt;" " &lt;h2&gt;Termosensor&lt;/h2&gt;" " &lt;table class='z1'&gt;" " &lt;tr&gt;" " &lt;th&gt;Sensor&lt;/th&gt;" " &lt;th&gt;Value&lt;/th&gt;" " &lt;/tr&gt;" " &lt;xsl:for-each select='response/temperature/sensors/sensor'&gt;" " &lt;tr&gt;" " &lt;td&gt; &lt;xsl:value-of select='@name'/&gt; &lt;/td&gt;" " &lt;td&gt;&lt;xsl:value-of select='.'/&gt; &lt;xsl:value-of select='@unit'/&gt;&lt;/td&gt;" " &lt;/tr&gt;" " &lt;/xsl:for-each&gt;" " &lt;/table&gt;" " &lt;/body&gt;" " &lt;/html&gt;" "&lt;/xsl:template&gt;" "&lt;/xsl:stylesheet&gt;"; /* this is a special form of print that outputs from PROGMEM */ server.printP(z1_xsl); } } // ===================================================== void setup(){ // Init LED display lc.shutdown(0,false); lc.setIntensity(0,2); lc.clearDisplay(0); lc.setChar(0,7,'L',false); lc.setChar(0,6,'O',false); lc.setChar(0,5,'A',false); lc.setChar(0,4,'d',false); // Ethernet SPI.begin(); Ethernet.begin(mac, ip); // Init Light sensor lightMeter.begin(); // Init pressure sensor if (!bmp.begin()) { Serial.println("ERROR: BMP085 sensor failed"); } //enable serial datada print Serial.begin(9600); Serial.println("Weather Z1 v 0.1"); //        webserver.setDefaultCommand(&amp;web_index); webserver.addCommand("index.html", &amp;web_index); webserver.addCommand("z1.xsl", &amp;web_z1_xsl); webserver.begin(); } void loop(){ char buff[64]; int len = 64; mode = (mode + 1) % 100; Z1_sensors_update(); Z1_SerialOutput(); Z1_ledDisplay(); Z1_modbus_tcp_slave(); // Z1_http_server(); webserver.processConnection(buff, &amp;len); } void Z1_sensors_update() { if (mode%30==0) { // BH1750 (light) light = lightMeter.readLightLevel(); // BMP085 (Temp and Pressure) temp_bmp = bmp.readTemperature(); pressure_pa = bmp.readPressure(); pressure_mm = pressure_pa/133.3; // DHT22 (Temp) if (dht_s1.read22(DHT_S1_PIN) == DHTLIB_OK) { humidity = dht_s1.humidity; temp_dht = dht_s1.temperature; temp = temp_dht; } else { temp = temp_bmp; } } } void Z1_SerialOutput() { Serial.print("T1= "); Serial.print(temp_dht); Serial.print(" *C \t"); Serial.print("T2= "); Serial.print(temp_bmp); Serial.print(" *C \t"); Serial.print("Pressure= "); Serial.print(pressure_mm); Serial.print(" mm \t"); Serial.print("Humidity= "); Serial.print(humidity); Serial.print(" %\t"); Serial.print("Light= "); Serial.print(light); Serial.print(" lx \t"); Serial.print("\n"); } void Z1_ledDisplay() { int v; if (light&lt;50) { lc.setIntensity(0,0); } else if (light&gt;80 &amp;&amp; light&lt;200) { lc.setIntensity(0,2); } else if (light&gt;250 &amp;&amp; light&lt;1000) { lc.setIntensity(0,5); } else if (light&gt;1100) { lc.setIntensity(0,15); } if (mode&lt;=25) { // lc.clearDisplay(0); lc.setChar(0,7,'t',false); if (temp&gt;=0) { lc.setChar(0,6,' ',false); } else { lc.setChar(0,6,'-',false); } v = (int)( temp / 10 ) % 10; lc.setDigit(0,5,(byte)v,false); v = (int)( temp ) % 10; lc.setDigit(0,4,(byte)v,true); v = (int)( temp * 10 ) % 10; lc.setDigit(0,3,(byte)v,false); lc.setChar(0,2,' ',false); lc.setChar(0,1,'*',false); lc.setChar(0,0,'C',false); delay(1); } else if (mode&lt;=50) { // lc.clearDisplay(0); lc.setChar(0,7,'H',false); lc.setChar(0,6,' ',false); v = (int)( humidity / 10 ) % 10; lc.setDigit(0,5,(byte)v,false); v = (int)( humidity ) % 10; lc.setDigit(0,4,(byte)v,true); v = (int)( humidity * 10 ) % 10; lc.setDigit(0,3,(byte)v,false); lc.setChar(0,2,' ',false); lc.setChar(0,1,'*',false); lc.setChar(0,0,'o',false); delay(1); } else if (mode&lt;=75) { // lc.clearDisplay(0); lc.setChar(0,7,'P',false); lc.setChar(0,6,' ',false); v = (int)( pressure_mm / 100 ) % 10; lc.setDigit(0,5,(byte)v,false); v = (int)( pressure_mm/10 ) % 10; lc.setDigit(0,4,(byte)v,false); v = (int)( pressure_mm ) % 10; lc.setDigit(0,3,(byte)v,false); lc.setChar(0,2,' ',false); lc.setChar(0,1,'n',false); lc.setChar(0,0,'n',false); delay(1); } else { // lc.clearDisplay(0); lc.setChar(0,7,'L',false); lc.setChar(0,6,' ',false); v = (int)( light / 1000 ) % 10; lc.setDigit(0,5,(byte)v,false); v = (int)( light / 100 ) % 10; lc.setDigit(0,4,(byte)v,false); v = (int)( light / 10 ) % 10; lc.setDigit(0,3,(byte)v,false); v = (int)( light ) % 10; lc.setDigit(0,2,(byte)v,false); lc.setChar(0,1,' ',false); lc.setChar(0,0,' ',false); delay(1); } } void Z1_modbus_tcp_slave() { Mb.Run(); DEV_ID = WEATHER_STATION_Z1; TEMPERATURE = temp*10; TEMPERATURE_DHT = temp_dht*10; TEMPERATURE_BMP = temp_bmp*10; HUMIDITY = humidity*10; PRESSURE_MM = pressure_mm; LIGHT = light; }</span></span></span></span></code> </pre><br></div></div><br><br>  Git-repository with Arduino controller software: <a href="https://github.com/krotos139/sh1_arduino_weather_station_v1">github.com/krotos139/sh1_arduino_weather_station_v1</a> <br><br><h5>  Conclusion </h5><br>  Smart weather station with an Ethernet interface can be easily implemented on arduino. <br>  The cost of the device in pilot production - ~ 1700 rubles <br>  Assembly time - ~ 1 day <br>  The functionality is fantastic - it can work as an independent device with power from POE and from a standard arduino-vsky power source, as well as a smart device - allowing you to receive all the necessary information from the browser.  For automated information processing, the device provides information in the form of an XML document and the modbus protocol. </div><p>Source: <a href="https://habr.com/ru/post/214011/">https://habr.com/ru/post/214011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213997/index.html">Testing retail systems</a></li>
<li><a href="../214001/index.html">New Graphene Application: High Efficiency Water Filters</a></li>
<li><a href="../214005/index.html">The experience of writing an article in a Chinese newspaper</a></li>
<li><a href="../214007/index.html">Rolls-Royce plans to build giant unmanned ships for maritime freight</a></li>
<li><a href="../214009/index.html">GitHab will soon launch a rich text editor.</a></li>
<li><a href="../214013/index.html">Develop Flappy Bird on Phaser</a></li>
<li><a href="../214015/index.html">Show Sound # 1-5 - Podcast about audio equipment, components, formats and technologies</a></li>
<li><a href="../214017/index.html">Business process simulator</a></li>
<li><a href="../214021/index.html">Why Intel will not leave the mobile market</a></li>
<li><a href="../214023/index.html">Voting and Information Security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>