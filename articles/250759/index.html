<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interesting moments of work Linq to Sql</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More than a year has passed since my previous post on a similar topic. During this time, we somehow didn‚Äôt come close to the transition to the Entity ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interesting moments of work Linq to Sql</h1><div class="post__text post__text-html js-mediator-article">  More than a year has passed since my <a href="http://habrahabr.ru/post/203836">previous post</a> on a similar topic.  During this time, we somehow didn‚Äôt come close to the transition to the Entity Framework (according to the current legend, we‚Äôll move on when a stable version of EF 7 appears), well, I have some experience that I would like to share.  I think that this article will be interesting to those who, like us, still use this generally not bad, but <a href="https://connect.microsoft.com/VisualStudio/feedback/details/793348/linq2sql-provider-bug">forgotten Microsoft</a> technology. <br><br><h4>  <b>Dbtype</b> </h4><br>  Specifying the <b>DbType</b> hint (with the exception of enum, see below) is not necessary for the properties of entities in Linq 2 Sql.  And you should definitely not use the wrong DbType.  For example, it is not necessary, if the column in the base is of the type <i>nvarchar (50)</i> , specify Linq 2 Sql that the column is of the type <i>nchar (50)</i> .  And especially not to do so, if this field is a discriminator, as in the following example: <br><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Table(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"directcrm.OperationSteps"</span></span></span><span class="hljs-meta">)</span></span>] [InheritanceMapping(Code = <span class="hljs-string"><span class="hljs-string">""</span></span>, Type = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(OperationStep), IsDefault = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-comment"><span class="hljs-comment">// ... [InheritanceMapping(Code = "ApplySegment", Type = typeof(ApplySegmentOperationStep))] public class OperationStep : INotifyPropertyChanging, INotifyPropertyChanged, IValidatable { //    ... [Column(Storage = "type", DbType = "nchar(50) NOT NULL", CanBeNull = false, IsDiscriminator = true)] public string Type { get { return type; } set { if ((type != value)) { SendPropertyChanging(); type = value; SendPropertyChanged(); } } } }</span></span></code> </pre> <br><a name="habracut"></a><br>  Well, let's try to read from the base an entity of type OperationStep and see if Inheritance Mapping can handle it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/257/b28/c96/257b28c96aa3ff23ab810d4a6bd5ebe0.png" alt="image"><br>  <i>Expected, no.</i> <br><br>  The <b>Type</b> property at first glance contains the correct value, but the type of the entity is incorrectly defined.  What does Inheritance Mapping expect to see in the field in order to correctly match the type?  Let's try <b>OfType</b> : <br><br><pre> <code class="cs hljs">modelContext.Repositories.Get&lt;OperationStepRepository&gt;().Items.OfType&lt;ApplySegmentOperationStep&gt;().FirstOrDefault();</code> </pre><br><br>  And SQL generated by the linq provider: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @p0 <span class="hljs-keyword"><span class="hljs-keyword">NChar</span></span> = <span class="hljs-string"><span class="hljs-string">'ApplySegment '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">1</span></span>) [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>], [t0].[SegmentationSystemName], [t0].[SegmentSystemName], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>], [t0].[OperationStepGroupId], [t0].[OperationStepTypeSystemName], [t0].[IsMarker] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[OperationSteps] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>] = @p0;</code> </pre><br><br>  The value of the parameter, in principle, was expected, but it was not very easy to detect such a bug.  Be careful.  It is clear that now the bug has manifested itself, but generally speaking, it can remain for a long time in the system, since entities will be correctly created and read from the database.  As long as you do not notice the strange tail of the discriminator values ‚Äã‚Äãor everything does not begin to fall after some script that updates the discriminators. <br><br>  <b>Now a few words about the storage of enums in linq to sql entities.</b> <br><br>  Linq to sql by default (if <b>DbType is</b> not specified) assumes that Enum has a column type of - <b>Int</b> .  Accordingly, it will be impossible to work with the following entity (the <b>Sex</b> field in the <b>directcrm.Customers</b> table is of the <b>nvarchar (15) type</b> ): <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Table(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"directcrm.Customers"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Customer</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanging</span></span>, <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span>, <span class="hljs-title"><span class="hljs-title">IValidatable</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    [Column(Storage = "sex", CanBeNull = true)] public Sex? Sex { get { return sex; } set { if (sex != value) { SendPropertyChanging(); sex = value; SendPropertyChanged(); } } } }</span></span></code> </pre><br><br>  If you try to subtract from the base, the Customer entity (in which the Sex field is filled with the string <b>‚Äúfemale‚Äù</b> ) will fall from <b>System.InvalidCastException</b> without any chance of understanding what exactly could not be achieved.  When saving the consumer with the specified gender, we will receive the following request: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @p20 <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> [directcrm].[Customers](..., [Sex], ...) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (..., @p7, ...)</code> </pre><br><br>  Remarkably, to subtract such a tuple from the table just will not work - all the same silent <b>System.InvalidCastException</b> will fall.  So if you store enum lines in the database using linq to sql, do not forget to specify DbType. <br>  By the way, the Entity Framework is not able to store enums in rows, so in the project where we decided to use it, we had to use a hack: an additional getter for each enum field that the enum parsil itself (while the enum value is assumed stored in the property of type string). <br><br><h4>  <b>Equality test</b> </h4><br>  Linq to sql is able to map both <b>the == operator</b> and the <b>object.Equals ()</b> call to <b>SQL</b> , however there are some differences in the mapping. <br><br>  So, the query of the <b>ActionTemplate</b> entity is filtered by the <b>SystemName</b> field: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> systemName = <span class="hljs-string"><span class="hljs-string">"SystemName"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actionTemplate = modelContext.Repositories.Get&lt;ActionTemplateRepository&gt;() .GetActionTemplatesIncludingNonRoot() .FirstOrDefault(at =&gt; at.SystemName == systemName);</code> </pre><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @p0 <span class="hljs-keyword"><span class="hljs-keyword">NVarChar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) = <span class="hljs-string"><span class="hljs-string">'SystemName'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">1</span></span>) [t0].[Discriminator], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t0].[CategoryId], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>], [t0].[RowVersion], [t0].[SystemName], [t0].[CreationCondition], [t0].[UsageDescription], [t0].[StartDateTimeUtcOverride], [t0].[EndDateTimeUtcOverride], [t0].[DateCreatedUtc], [t0].[DateChangedUtc], [t0].[CreatedById], [t0].[LastChangedById], [t0].[CampaignId], [t0].[MailingTemplateName], [t0].[UseCustomParameters], [t0].[TargetActionTemplateId], [t0].[ParentActionTemplateId], [t0].[IsTransactional], [t0].[MailingStartTime], [t0].[MailingEndTime], [t0].[IgnoreStopLists], [t0].[ReversedActionTemplateId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[ActionTemplates] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> [t0].[SystemName] = @p0</code> </pre><br><br>  Nothing unusual.  But what if <b>systemName</b> is <b>null</b> ? <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @p0 <span class="hljs-keyword"><span class="hljs-keyword">NVarChar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">1</span></span>) [t0].[Discriminator], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t0].[CategoryId], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>], [t0].[RowVersion], [t0].[SystemName], [t0].[CreationCondition], [t0].[UsageDescription], [t0].[StartDateTimeUtcOverride], [t0].[EndDateTimeUtcOverride], [t0].[DateCreatedUtc], [t0].[DateChangedUtc], [t0].[CreatedById], [t0].[LastChangedById], [t0].[CampaignId], [t0].[MailingTemplateName], [t0].[UseCustomParameters], [t0].[TargetActionTemplateId], [t0].[ParentActionTemplateId], [t0].[IsTransactional], [t0].[MailingStartTime], [t0].[MailingEndTime], [t0].[IgnoreStopLists], [t0].[ReversedActionTemplateId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[ActionTemplates] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> [t0].[SystemName] = @p0</code> </pre><br><br>  Matter of course, so we will not achieve anything good.  Let's try <b>object.equals</b> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> systemName = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actionTemplate = modelContext.Repositories.Get&lt;ActionTemplateRepository&gt;() .GetActionTemplatesIncludingNonRoot() .FirstOrDefault(at =&gt; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>.Equals(at.SystemName, systemName));</code> </pre><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">1</span></span>) [t0].[Discriminator], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t0].[CategoryId], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>], [t0].[RowVersion], [t0].[SystemName], [t0].[CreationCondition], [t0].[UsageDescription], [t0].[StartDateTimeUtcOverride], [t0].[EndDateTimeUtcOverride], [t0].[DateCreatedUtc], [t0].[DateChangedUtc], [t0].[CreatedById], [t0].[LastChangedById], [t0].[CampaignId], [t0].[MailingTemplateName], [t0].[UseCustomParameters], [t0].[TargetActionTemplateId], [t0].[ParentActionTemplateId], [t0].[IsTransactional], [t0].[MailingStartTime], [t0].[MailingEndTime], [t0].[IgnoreStopLists], [t0].[ReversedActionTemplateId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[ActionTemplates] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>  Brilliant <blockquote>  WHERE 0 = 1 </blockquote>  tells us that Linq to sql knows that <b>ActionTemplate.SystemName</b> cannot be <b>null</b> , so the query is useless.  This sacred knowledge of Linq to sql is derived from the value of ColumnAttribute.CanBeNull.  Unfortunately, from DbType he can not understand this. <br>  If the request is made on a column that admits the absence of a value, then the translation will be expected: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">1</span></span>) [t0].[Discriminator], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t0].[CategoryId], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>], [t0].[RowVersion], [t0].[SystemName], [t0].[CreationCondition], [t0].[UsageDescription], [t0].[StartDateTimeUtcOverride], [t0].[EndDateTimeUtcOverride], [t0].[DateCreatedUtc], [t0].[DateChangedUtc], [t0].[CreatedById], [t0].[LastChangedById], [t0].[CampaignId], [t0].[MailingTemplateName], [t0].[UseCustomParameters], [t0].[TargetActionTemplateId], [t0].[ParentActionTemplateId], [t0].[IsTransactional], [t0].[MailingStartTime], [t0].[MailingEndTime], [t0].[IgnoreStopLists], [t0].[ReversedActionTemplateId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[ActionTemplates] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> [t0].[SystemName] <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre><br><br>  Therefore, it is probably necessary to try to use not the equality operator, but <b>object.Equals</b> , since it is translated more ‚Äúqualitatively‚Äù. <br><br><h4>  <b>LeftOuterJoin</b> </h4><br>  As you know, Linq does not provide an extension method at all for connecting collections with the possibility of missing values ‚Äã‚Äãin one of them.  But sometimes when working with linq to sql, we need to get into the left outer join join in sql, for example, and in such situations we use combinations of linq methods that ultimately translate into a left outer join.  I know two ways to get the left outer join: <br>  First option: <br><pre> <code class="cs hljs">CustomerActions .GroupJoin(CustomerBalanceChanges, ca =&gt; ca, cbch =&gt; cbch.CustomerAction, (ca, cbchs) =&gt; cbchs .DefaultIfEmpty() .Select(cbch =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { ca, cbch })) .SelectMany(g =&gt; g) .Dump();</code> </pre><br><br>  The second option: <br><pre> <code class="cs hljs">CustomerActions .SelectMany(ca =&gt; CustomerBalanceChanges .Where(cbch =&gt; cbch.CustomerAction == ca) .DefaultIfEmpty(), (ca, cbch) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { ca, cbch}) .Dump();</code> </pre><br><br>  Both variants are translated into a completely identical SQL - left outer join with a subquery and a test column (to determine if an entity exists from the right set): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t0].[IsTimeKnown], [t0].[BrandName], [t0].[ActionTemplateId], [t0].[CustomerId], [t0].[StaffId], [t0].[PointOfContactId], [t0].[OriginalCustomerId], [t0].[IsOriginalCustomerIdExact], [t0].[TransactionalId], [t0].[DateTimeUtc], [t0].[CreationDateTimeUtc], [t2].[<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>], [t2].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id2], [t2].[ChangeAmount], [t2].[Comments], [t2].[CustomerActionId], [t2].[AdminSiteComments], [t2].[BalanceId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[CustomerActions] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>], [t1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t1].[ChangeAmount], [t1].[Comments], [t1].[CustomerActionId], [t1].[AdminSiteComments], [t1].[BalanceId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [promo].[CustomerBalanceChanges] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t1] ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] = [t2].[CustomerActionId]</code> </pre><br><br>  For reference: CustomerActions - consumer actions in the system, CustomerBalanceChanges - his changes in balance, by request we get changes in consumer balance with appropriate actions (or just an action if it was not a change in balance). <br><br>  Let's complicate the request: now we want to receive not only changes in the balance of consumers, but also their prizes: <br><pre> <code class="cs hljs">CustomerActions .SelectMany(ca =&gt; CustomerBalanceChanges .Where(cbch =&gt; cbch.CustomerAction == ca) .DefaultIfEmpty(), (ca, cbch) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { ca, cbch}) .SelectMany(cacbch =&gt; CustomerPrizes .Where(cp =&gt; cacbch.ca == cp.CustomerAction) .DefaultIfEmpty(), (cacbch, cp) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cacbch.ca, cacbch.cbch, cp}) .Dump();</code> </pre><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t0].[IsTimeKnown], [t0].[BrandName], [t0].[ActionTemplateId], [t0].[CustomerId], [t0].[StaffId], [t0].[PointOfContactId], [t0].[OriginalCustomerId], [t0].[IsOriginalCustomerIdExact], [t0].[TransactionalId], [t0].[DateTimeUtc], [t0].[CreationDateTimeUtc], [t2].[<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>], [t2].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id2], [t2].[ChangeAmount], [t2].[Comments], [t2].[CustomerActionId], [t2].[AdminSiteComments], [t2].[BalanceId], [t4].[<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [test2], [t4].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id3], [t4].[PrizeId], [t4].[SaleFactId], [t4].[PromoMechanicsName], [t4].[WonCustomerPrizeId], [t4].[PrizeType], [t4].[Published], [t4].[PromoMechanicsScheduleItemId], [t4].[CustomerActionId] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [CustomerActionId2] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[CustomerActions] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>], [t1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t1].[ChangeAmount], [t1].[Comments], [t1].[CustomerActionId], [t1].[AdminSiteComments], [t1].[BalanceId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [promo].[CustomerBalanceChanges] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t1] ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t2].[CustomerActionId] = [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>], [t3].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t3].[PrizeId], [t3].[SaleFactId], [t3].[PromoMechanicsName], [t3].[WonCustomerPrizeId], [t3].[PrizeType], [t3].[Published], [t3].[PromoMechanicsScheduleItemId], [t3].[CustomerActionId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [promo].[CustomerPrizes] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t3] ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t4] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] = [t4].[CustomerActionId]</code> </pre><br><br>  Nothing out of the ordinary, just another left outer join was added, as expected.  But generally speaking, we could build a query in a different way.  For example, since we know that for each prize there is exactly a change in balance, we could write this: <br><br><pre> <code class="cs hljs">CustomerActions .SelectMany(ca =&gt; CustomerPrizes .Join(CustomerBalanceChanges, cp =&gt; cp.CustomerAction, cbch =&gt; cbch.CustomerAction, (cp, cbch) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cbch, cp }) .Where(cbchcp =&gt; cbchcp.cbch.CustomerAction == ca) .DefaultIfEmpty(), (ca, cbchcp) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cbchcp.cbch, cbchcp.cp, ca}) .Dump();</code> </pre><br><br>  This will result in the following SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [t2].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t2].[ChangeAmount], [t2].[Comments], [t2].[CustomerActionId], [t2].[AdminSiteComments], [t2].[BalanceId], [t1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id2], [t1].[PrizeId], [t1].[SaleFactId], [t1].[PromoMechanicsName], [t1].[WonCustomerPrizeId], [t1].[PrizeType], [t1].[Published], [t1].[PromoMechanicsScheduleItemId], [t1].[CustomerActionId] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [CustomerActionId2], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id3], [t0].[IsTimeKnown], [t0].[BrandName], [t0].[ActionTemplateId], [t0].[CustomerId], [t0].[StaffId], [t0].[PointOfContactId], [t0].[OriginalCustomerId], [t0].[IsOriginalCustomerIdExact], [t0].[TransactionalId], [t0].[DateTimeUtc], [t0].[CreationDateTimeUtc] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[CustomerActions] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ([promo].[CustomerPrizes] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t1] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> [promo].[CustomerBalanceChanges] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t1].[CustomerActionId] = [t2].[CustomerActionId]) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t2].[CustomerActionId] = [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>]</code> </pre><br><br>  Notice in this SQL that <b>SELECT 1 as [test]</b> disappeared to check for the presence of an entity.  And this leads to the fact that such a request does not work, and ends with an <b>InvalidOperationException:</b> "A NULL value cannot be assigned to a member that is a System.Int32 type that does not allow NULL values.".  Since linq no longer tracks its test-flag, it tries to honestly compose CustomerBalanceChange and CustomerPrize entities from columns whose values ‚Äã‚Äãare NULL, but it cannot write NULL, for example, to CustomerBalanceChange.Id, which the text of the exception tells us. <br>  What workarounds for this problem exist?  Well, first, you can rephrase the query as it was written in the first case.  But this is absolutely not a universal solution, because who said that it can always be done.  Linq at the first complex query can fall in the same way, and you don‚Äôt feel like wasting time on rearranging the joines.  And the second query is semantically different from the first. <br>  Secondly, we could make a request not to entities, but to certain dto, for example like this: <br><br><pre> <code class="cs hljs">CustomerActions .SelectMany(ca =&gt; CustomerPrizes .Join(CustomerBalanceChanges, cp =&gt; cp.CustomerAction, cbch =&gt; cbch.CustomerAction, (cp, cbch) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cbch, cp }) .Where(cbchcp =&gt; cbchcp.cbch.CustomerAction == ca) .DefaultIfEmpty(), (ca, cbchcp) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cbchcp.cbch, cbchcp.cp, ca}) .Select(cacbchcp =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { CustomerActionId = cacbchcp.ca.Id, CustomerBalanceChangeId = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>?)cacbchcp.cbch.Id, CustomerPrizeId = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>?)cacbchcp.cp.Id, } )</code> </pre><br><br>  Since <b>CustomerBalanceChangeId</b> and <b>CustomerPrizeId are</b> now nullable, there are no problems.  But we may not be satisfied with such an approach, because we may need exactly entities (which we want to change, delete, or call functions on them).  So there is a straightforward third join method, in which a check for null will be performed on the sql side: <br><br><pre> <code class="cs hljs">CustomerActions .SelectMany(ca =&gt; CustomerPrizes .Join(CustomerBalanceChanges, cp =&gt; cp.CustomerAction, cbch =&gt; cbch.CustomerAction, (cp, cbch) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cbch, cp }) .Where(cbchcp =&gt; cbchcp.cbch.CustomerAction == ca) .DefaultIfEmpty(), (ca, cbchcp) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cbch = cbchcp == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-literal"><span class="hljs-literal">null</span></span> : cbchcp.cbch, cp = cbchcp == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-literal"><span class="hljs-literal">null</span></span> : cbchcp.cp, ca }) .Dump();</code> </pre><br><br>  This is not broadcast in such a terrible sql, as it may seem at first glance: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> [t3].[<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>], [t3].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t3].[ChangeAmount], [t3].[Comments], [t3].[CustomerActionId], [t3].[AdminSiteComments], [t3].[BalanceId], [t3].[Id2], [t3].[PrizeId], [t3].[SaleFactId], [t3].[PromoMechanicsName], [t3].[WonCustomerPrizeId], [t3].[PrizeType], [t3].[Published], [t3].[PromoMechanicsScheduleItemId], [t3].[CustomerActionId2], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id3], [t0].[IsTimeKnown], [t0].[BrandName], [t0].[ActionTemplateId], [t0].[CustomerId], [t0].[StaffId], [t0].[PointOfContactId], [t0].[OriginalCustomerId], [t0].[IsOriginalCustomerIdExact], [t0].[TransactionalId], [t0].[DateTimeUtc], [t0].[CreationDateTimeUtc] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[CustomerActions] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>], [t2].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t2].[ChangeAmount], [t2].[Comments], [t2].[CustomerActionId], [t2].[AdminSiteComments], [t2].[BalanceId], [t1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id2], [t1].[PrizeId], [t1].[SaleFactId], [t1].[PromoMechanicsName], [t1].[WonCustomerPrizeId], [t1].[PrizeType], [t1].[Published], [t1].[PromoMechanicsScheduleItemId], [t1].[CustomerActionId] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [CustomerActionId2] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [promo].[CustomerPrizes] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t1] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> [promo].[CustomerBalanceChanges] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t1].[CustomerActionId] = [t2].[CustomerActionId] ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t3] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t3].[CustomerActionId] = [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>]</code> </pre><br><br>  But, as you can see, there is a nuance.  The request was not very complicated, but linq to sql didn‚Äôt care, instead of just using [t3]. [Test] in the final sample, drew the <b>CASE ... WHEN</b> construct.  There is nothing to worry about until the request has become too large.  But if you try to combine tables 10 in this way, then the final SQL queries can reach several hundred kilobytes!  Several hundred kilobytes of <b>CASE ... WHEN</b> statements. <br><br>  In addition, constantly using any of the above-described constructions for a simple left-outer join is somewhat costly, it would be much easier to write the LeftOuterJoin extension-method yourself and use it in queries.  Here is how such an extension looks here: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IQueryable&lt;TResult&gt; LeftOuterJoin&lt;TOuter, TInner, TKey, TResult&gt;( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IQueryable&lt;TOuter&gt; outerValues, IQueryable&lt;TInner&gt; innerValues, Expression&lt;Func&lt;TOuter, TKey&gt;&gt; outerKeySelector, Expression&lt;Func&lt;TInner, TKey&gt;&gt; innerKeySelector, Expression&lt;Func&lt;TOuter, TInner, TResult&gt;&gt; fullResultSelector, Expression&lt;Func&lt;TOuter, TResult&gt;&gt; partialResultSelector) { Expression&lt;Func&lt;TOuter, IEnumerable&lt;TInner&gt;, IEnumerable&lt;TResult&gt;&gt;&gt; resultSelector = (outerValue, groupedInnerValues) =&gt; groupedInnerValues.DefaultIfEmpty().Select( innerValue =&gt; Equals(innerValue, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(TInner)) ? partialResultSelector.Evaluate(outerValue) : fullResultSelector.Evaluate(outerValue, innerValue)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outerValues .GroupJoin(innerValues, outerKeySelector, innerKeySelector, resultSelector.ExpandExpressions()) .SelectMany(result =&gt; result); }</code> </pre><br><br>  This extension is always broadcast, but it uses null checking on the sql side.  The following uses are intended: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cbchcas = customerActions .LeftOuterJoin( context.Repositories .Get&lt;CustomerBalanceChangeRepository&gt;() .Items .Join(context.Repositories .Get&lt;CustomerPrizeRepository&gt;() .Items, cbch =&gt; cbch.CustomerAction, cp =&gt; cp.CustomerAction, (cbch, cp) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { cbch, cp }), ca =&gt; ca, cbchcp =&gt; cbchcp.cbch.CustomerAction, (ca, cbchcp) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { ca, cbchcp.cbch, cbchcp.cp }, ca =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { ca, cbch = (CustomerBalanceChange)<span class="hljs-literal"><span class="hljs-literal">null</span></span>, cp = (CustomerPrize)<span class="hljs-literal"><span class="hljs-literal">null</span></span> }) .ToArray();</code> </pre><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> [t3].[<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>], [t3].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t3].[CustomerActionId], [t3].[ChangeAmount], [t3].[Comments], [t3].[AdminSiteComments], [t3].[BalanceId], [t3].[PrizeType], [t3].[Id2], [t3].[PrizeId], [t3].[PromoMechanicsName] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [PromoMechanicsSystemName], [t3].[Published], [t3].[PromoMechanicsScheduleItemId], [t3].[SaleFactId], [t3].[CustomerActionId2], [t3].[WonCustomerPrizeId], [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id3], [t0].[DateTimeUtc], [t0].[IsTimeKnown], [t0].[PointOfContactId], [t0].[BrandName] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [BrandSystemName], [t0].[CreationDateTimeUtc], [t0].[ActionTemplateId], [t0].[CustomerId], [t0].[StaffId], [t0].[OriginalCustomerId], [t0].[IsOriginalCustomerIdExact], [t0].[TransactionalId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [directcrm].[CustomerActions] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t0] <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>], [t1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [t1].[CustomerActionId], [t1].[ChangeAmount], [t1].[Comments], [t1].[AdminSiteComments], [t1].[BalanceId], [t2].[PrizeType], [t2].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Id2], [t2].[PrizeId], [t2].[PromoMechanicsName], [t2].[Published], [t2].[PromoMechanicsScheduleItemId], [t2].[SaleFactId], [t2].[CustomerActionId] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [CustomerActionId2], [t2].[WonCustomerPrizeId] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [promo].[CustomerBalanceChanges] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t1] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> [promo].[CustomerPrizes] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t1].[CustomerActionId] = [t2].[CustomerActionId] ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [t3] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [t0].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] = [t3].[CustomerActionId]</code> </pre><br><br>  You may have noticed that in the extension-method itself, the <b>Evaluate</b> and <b>ExpandExpressions</b> methods are used.  These are the extension methods from our <a href="https://www.nuget.org/packages/Mindbox.Expressions/">Mindbox.Expressions</a> library.  The ExpandExpressions method recursively traverses the entire expression tree on which it was called, recursively replacing Evaluate calls with the expression on which Evaluate was called.  The ExpandExpressions method can be called both on Expression objects and on IQueryable, which is sometimes more convenient (for example, if the query is built in several places).  The library also has a number of interesting functions for reflective work with the code.  Perhaps the library will be useful for someone. <br><br>  <b>UPD.</b>  A small remark from a colleague: <br><br><blockquote>  &gt; Therefore, apparently you need to try to use not the equality operator, but object.Equals, since it is translated more ‚Äúqualitatively‚Äù. <br><br>  Bad advice.  This, of course, will solve the null comparison problem.  But there are side effects: <br><ul><li>  You can write a comparison of the values ‚Äã‚Äãof incompatible types and the compiler will not swear </li><li>  if you compare two values, none of which can be precomputed by .NET (for example, two properties of an entity), you get bad and slow SQL (or they are equal, or both are null) </li><li>  may not work for enum.  There are mapping bugs - it does not always understand that the value needs to be converted to a string, not to an int.  For the comparison operation, he understands, and for passing as a parameter to object.Equals, it seems we have encountered problems </li></ul></blockquote></div><p>Source: <a href="https://habr.com/ru/post/250759/">https://habr.com/ru/post/250759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250745/index.html">The story of one failure (the development of the first mobile game) with conclusions and tips</a></li>
<li><a href="../250749/index.html">Where do the security gaps come from?</a></li>
<li><a href="../250753/index.html">How Linux works with memory. Yandex Workshop</a></li>
<li><a href="../250755/index.html">Configure autoscaling in InfoboxCloud</a></li>
<li><a href="../250757/index.html">5 invalid errors when collecting product reviews</a></li>
<li><a href="../250761/index.html">Brakes ng-repeat? No - just ngAnimate + transition to css</a></li>
<li><a href="../250763/index.html">Analysis of the problem ‚ÄúMirror in the corridor‚Äù and outrage</a></li>
<li><a href="../250765/index.html">Navigation Drawer in Material Design style in 5 minutes</a></li>
<li><a href="../250767/index.html">TLS1.1 + support for legacy CommuniGate versions</a></li>
<li><a href="../250769/index.html">A short course in computer graphics, addendum: ambient occlusion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>