<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Console windows- "zombies", or how to restart Windows without stupid questions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was not the first time yesterday that I encountered a funny problem in Windows Server 2008 - after I quit FAR Manager, I had to hang a zombie conso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Console windows- "zombies", or how to restart Windows without stupid questions</h1><div class="post__text post__text-html js-mediator-article"><img src="http://sergeypopov.info/Content/Shared/windows-force-reboot/windows-force-reboot.png" align="left"><br>  It was not the first time yesterday that I encountered a funny problem in Windows Server 2008 - after I quit FAR Manager, I had to hang a zombie console window. <br><br>  This window has a truly remarkable property - it can not be closed.  In addition, if you have such a window, you will not be able to restart Windows - all your attempts will end with the message in the Event Log <em>The attempt by user *** *** to restart / shutdown computer *** failed</em> . <br><br>  Against this background, the absence of an appropriate process in the task list seems such a trifle ... ;-) <br><a name="habracut"></a><br><img src="http://sergeypopov.info/Content/Shared/windows-force-reboot/zombie-console-window.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My yesterday's problem was aggravated by the fact that it appeared just after deploying a new version of the application, and for its successful completion, I definitely had to restart the server.  When I came across a zombie window problem earlier, I stopped all services and rebooted the server on power.  But yesterday I had no such opportunity - the server was, to put it mildly, very far, IP-KVM was not connected to it, and local staff who could apply extreme measures to the server were also unavailable. <br><br><blockquote>  <b>By the way, I tried the <a href="http://technet.microsoft.com/en-us/library/cc772947(WS.10).aspx">shutdown</a> and <a href="http://technet.microsoft.com/en-us/sysinternals/bb897541.aspx">psshutdown</a> utilities in the first few minutes, no effect.</b>  <b>Apparently, they use the same ExitWindowsEx () call, which sends out lots of notifications, waits for them to be answered, and so on.</b> </blockquote><br>  In a hurry, having thrown the application on another server, I began to search, how can I solve this problem? <br><br>  After talking with friends, I found out that I was not the only one who had encountered this problem, but they could not tell me the solution, because  just like me, they ‚Äúsolved‚Äù it by turning off the power to the server. <br><br>  After I had a little more digging into i-net, I had a suspicion who was to blame for my torment - <a href="http://blogs.msdn.com/b/debugger/archive/2010/03/11/help-my-console-windows-won-t-go-away.aspx">according to VS Debugger Team</a> , the problem was caused by an error in <a href="http://en.wikipedia.org/wiki/Client/Server_Runtime_Subsystem">csrss (Client / Server Runtime Subsystem)</a> , and it appeared more than a year ago, after The release of update <a href="http://support.microsoft.com/kb/978037/en-us">KB978037</a> , and in this same KB article is a link to hotfix ( <a href="http://support.microsoft.com/kb/982551/en-us">KB982551</a> ).  And despite the fact that in the list of operating systems that this error affects, Windows Server 2008 is missing, the symptoms are very similar. <br><br>  Unfortunately, installing a circle of suspects did not bring me much closer to solving the problem, and I continued my search.  Very quickly, I found information that in Windows 2000 there was an Emergency Shutdown feature: <br><br>  <em>HOW TO: Perform an Emergency Shutdown in Windows</em> <em><br></em>  <em><a href="http://support.microsoft.com/kb/279134/en-us">http://support.microsoft.com/kb/279134/en-us</a></em> <br><br>  Unfortunately, because of the changed interface, I could not find out whether such a function remained in Windows Server 2008 (the search for ‚Äúemergency shutdown windows 2008‚Äù did not bring any results), but here‚Äôs a <a href="http://www.codeguru.com/forum/showthread.php%3Ft%3D188554">discussion 10 years ago</a> on the CodeGuru website Dedicated to this function, gave me the idea to use the NtShutdownSystem () call to reboot. <br><br>  Having consulted just in case with Mark Russinovich (in his printed hypostasis ;-), I decided that yes, this is what we need!  And taking as a basis the code that Alex Fedotov (unfortunately, the link to his home page is not working now ... but maybe he will read this post and I can thank him? :) resulted in the discussion mentioned above, I wrote a small a utility, a slightly refined version of which can be downloaded from the link at the end of the post. <br><br>  And this utility helped me!  And if I still managed to check her work on a specially launched virtual machine, and not on my workstation, while losing some unsaved data, I would be just insanely happy!  ;-) <br><br>  By the way, after I solved the problem, on the <a href="http://social.technet.microsoft.com/Forums/en-US/winservergen/thread/0d8367de-d029-4ad2-8030-d73fe84f503a">TechNet forum</a> I was offered another option, namely, to execute the shutdown utility on behalf of the system account, but I haven‚Äôt checked the operation of this option yet. <br><br>  <a href="">Download Force Reboot Utility (source code + binary)</a> </div><p>Source: <a href="https://habr.com/ru/post/117083/">https://habr.com/ru/post/117083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117071/index.html">IT-portfolio: we are in open beta!</a></li>
<li><a href="../117074/index.html">Custom Document Sizes</a></li>
<li><a href="../117076/index.html">BizSpark Camp for startups on Windows Phone 7 with secret themes</a></li>
<li><a href="../117079/index.html">The results of the auction for the sale of domains in the zone. RF revise</a></li>
<li><a href="../117081/index.html">Fixber: software test results in 30 minutes</a></li>
<li><a href="../117084/index.html">A selection of 10 css3 buttons</a></li>
<li><a href="../117085/index.html">We invite you to the Russian final of the Imagine Cup - April 16 in Moscow</a></li>
<li><a href="../117087/index.html">What to read on the weekend? Recommended, issue number 6</a></li>
<li><a href="../117088/index.html">Scaffolding with pictures texts or how not to throw time in the trash</a></li>
<li><a href="../117089/index.html">Is the communicator ready to replace the navigator?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>