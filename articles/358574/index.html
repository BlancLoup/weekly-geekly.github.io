<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create your dataset with Kirkorov and Face on Yandex Toloka</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With neural networks you will not surprise anyone. Almost everyone knows what machine learning, linear regression, random forest. Every year, thousand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create your dataset with Kirkorov and Face on Yandex Toloka</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/fo/sp/tq/fosptq416v5mv5oshd6skrel4ys.jpeg"></p><br><p>  With neural networks you will not surprise anyone.  Almost everyone knows what machine learning, linear regression, random forest.  Every year, thousands of people take machine learning courses at <a href="https://habrahabr.ru/company/ods/blog/322626/">ODS</a> and <a href="https://www.coursera.org/learn/vvedenie-mashinnoe-obuchenie/home/welcome">Coursera</a> .  For a couple of weeks, any student can now master keras and rivet neuron points.  But in neural networks, as in all machine learning, in addition to creating a good algorithm, data are needed on which the algorithm will be trained. </p><a name="habracut"></a><br><p>  Let me introduce myself, my name is Kutsev Roman.  I work in the RnD team in Prisma AI and create datasets for our tasks. </p><br><p>  So, suddenly a grocery request arrives: we urgently need a neuron, which will distinguish Kirkorov from Faith (of course, a fictional example, we are not engaged in such nonsense). <br>  I ask Anton (the main for neurons) in what form the data is needed, in response I hear: ‚ÄúTwo folders, in one image of Faith, in another Kirkorov, preferably about 500 images per class, and 299x299 were‚Äù. </p><br><p>  Where to find data? </p><br><ol><li>  We look at public datasets, such as <a href="http://www.image-net.org/">ImageNet</a> , <a href="http://cocodataset.org/">COCO</a> , <a href="https://storage.googleapis.com/openimages/web/index.html">openimages</a> . </li><li>  If there is no necessary marked data in popular public datasets, then google, open articles on these topics on arxiv.org in the hope that somewhere there will be a link to the necessary dataset. </li><li>  If the first two points fail, then the necessary dataset does not exist, and it must be created! </li></ol><br><p>  Obviously, no one has previously dealt with the task of classifying Kirkorov and Feys.  Therefore it is necessary to create such a dataset. </p><br><p>  The pipeline is: </p><br><ol><li>  We download from Google on 1k images of Kirkorov and Faith. </li><li>  Resize to the right size. </li><li>  We check them with freelancers on Yandex Toloka. </li></ol><br><p>  For download, use <a href="https://github.com/hardikvasa/google-images-download">Google Images Download</a> . </p><br><p>  In the terminal we write: </p><br><pre><code class="bash hljs">googleimagesdownload -k <span class="hljs-string"><span class="hljs-string">''</span></span> -l 1000 -t photo -s <span class="hljs-string"><span class="hljs-string">'&gt;400*300'</span></span> -o <span class="hljs-string"><span class="hljs-string">'Kirkorov'</span></span> googleimagesdownload -k <span class="hljs-string"><span class="hljs-string">' Face'</span></span> -l 1000 -t photo -s <span class="hljs-string"><span class="hljs-string">'&gt;400*300'</span></span> -o <span class="hljs-string"><span class="hljs-string">'Face'</span></span></code> </pre> <br><p>  (in fact, everything is not so simple, for one request you can download only 100 images, so you have to download it with different settings) </p><br><p>  Immediately resize the image to a size of 299x299, for this I sketched the following function: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> multiprocessing, time, os <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_img</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(img_path)</span></span></span><span class="hljs-function">:</span></span> img = Image.open(os.path.join(<span class="hljs-string"><span class="hljs-string">'Kirkorov'</span></span>,img_path)) img = img.resize((<span class="hljs-number"><span class="hljs-number">299</span></span>,<span class="hljs-number"><span class="hljs-number">299</span></span>), Image.ANTIALIAS) img.save(os.path.join(<span class="hljs-string"><span class="hljs-string">'Kirkorov_resize'</span></span>,img_path)) num_processes = multiprocessing.cpu_count() pool = multiprocessing.Pool(processes=num_processes) st = time.time() pool.map(resize_img, os.listdir(<span class="hljs-string"><span class="hljs-string">'Kirkorov'</span></span>)) print(<span class="hljs-string"><span class="hljs-string">"Execution time: "</span></span>, time.time()-st)</code> </pre> <br><p>  Looking at the images, we see that the necessary images were mostly downloaded, but in some places there is garbage. </p><br><p><img src="https://habrastorage.org/webt/dd/bn/1s/ddbn1sswl_4svkhzhxa4fgaat1o.png"><br><img src="https://habrastorage.org/webt/zq/zs/0s/zqzs0sypisumye33gimt2ra2hji.png"><br><img src="https://habrastorage.org/webt/5x/ca/zx/5xcazxsdwc1snepfdjuk9w9djhs.png"><br><img src="https://habrastorage.org/webt/ij/2v/5y/ij2v5yz9x8m8jfeanyefdd8igha.png"></p><br><p>  Well, the first two points are ready, the third is left. </p><br><p>  If you still do not know what Yandex Toloka is, then I advise you to read <a href="https://habr.com/company/yandex/blog/305956/">this</a> and <a href="https://habr.com/company/yandex/blog/358462/">this</a> article. </p><br><p>  In a nutshell: Toloka - a freelance exchange on steroids, where the customer creates a task, loads data and freelancers perform it.  Of course, there are other markup <a href="https://habr.com/company/newprolab/blog/352572/">tools</a> , but for this task it is most convenient to use Toloka. </p><br><p>  How to start using Yandex Toloka: </p><br><p>  <strong>1. We</strong> register on <a href="https://sandbox.toloka.yandex.ru/">sandbox.toloka.yandex.ru</a> and <a href="https://toloka.yandex.ru/">toloka.yandex.ru</a> as a customer (sandbox is a sandbox in which you create tasks, check for correctness from freelancers, and if everything is good, transfer it to <a href="https://toloka.yandex.ru/">toloka.yandex .ru</a> ). </p><br><p>  <strong>2.</strong> In our <a href="https://toloka.yandex.ru/">toloka.yandex.ru</a> personal account <a href="https://toloka.yandex.ru/">we</a> replenish our balance. </p><br><p>  <strong>3.</strong> In <a href="https://sandbox.toloka.yandex.ru/">sandbox.toloka.yandex.ru</a> in the "Projects" tab, select "Create project". </p><br><p><img src="https://habrastorage.org/webt/m2/am/yn/m2amyniwlphub4vlpitzxok5kry.png"></p><br><p>  <strong>4.</strong> You will be offered ready-made templates.  Of all the templates, the "Image Categorization" template is best for us.  Choose it. </p><br><p><img src="https://habrastorage.org/webt/tt/2x/ck/tt2xckcorsitfxit1hlotgzneui.png"></p><br><p>  <strong>5.</strong> We create instructions for freelancers and the name of the project. </p><br><p><img src="https://habrastorage.org/webt/vn/-w/cm/vn-wcm43yg0lpp_ov4djezz1oyi.png"></p><br><p>  <strong>6.</strong> In the input parameters to the task we will have a URL to the image.  At the weekend: the output line.  The task interface is written in html and javascript (this is very convenient, since for almost any task we can create a page that will be shown to the performers).  Slightly change the template html, and you're done.  Save the project. </p><br><p><img src="https://habrastorage.org/webt/ho/hq/ho/hohqho6cuxazwjthwbh-hqxnrda.png"></p><br><p>  <strong>7.</strong> The project is ready.  Now you can add a <a href="https://yandex.ru/support/toloka-requester/concepts/pool-main.html">pool of tasks</a> .  In this article, I will not create a training pool (in the hope that freelancers are able to immediately complete our most complex task).  But you always create a learning pool in your assignment.  This will allow: </p><br><ul><li>  Weed out people who did not understand the task. </li><li>  Do not allow bots to the task, who always choose the same answer. </li><li>  Teach the performers correctly and efficiently perform the task. </li></ul><br><p>  We invent the name of the pool (it is visible only to us).  Set the price of $ 0.01 per page assignments.  Greedy Yandex takes a commission $ 0.005.  Task time: 10 minutes.  Overlap: 3 (each of our photos will be shown to three different people).  Let's turn on the "CONTENT FOR ADULTS", and then what else is bad that we could download from the Internet.  And activate the "POSTPONED ACCEPTANCE" to not give money to those freelancers who will perform the task poorly. </p><br><p><img src="https://habrastorage.org/webt/5t/om/2z/5tom2zwc1snbwgq5dihxtj2oxee.png"></p><br><p>  Next comes the clause: "REQUIREMENTS TO USERS", in which we can make demands on the performers.  In our case, the performer must be from Russia and speak Russian.  Each artist has its own rating and we can only choose artists with a good rating.  Choose 80% of the best performers. </p><br><p><img src="https://habrastorage.org/webt/8x/dh/bk/8xdhbkbibkmsaobvgqgfemztoye.png"></p><br><p>  The most important and most difficult in terms of development is <a href="https://yandex.ru/support/toloka-requester/concepts/control.html">the quality control unit</a> .  A separate description of him will draw on an entire article, so I recommend reading it yourself.  In our project, I chose a restriction for quick answers.  If the performer answers 3 times out of 5 in less than 40 seconds, the system will block it. </p><br><p><img src="https://habrastorage.org/webt/z8/5t/gy/z85tgy4jyg7q5efuwl1km0dlueg.png"></p><br><p>  Great, we're at the finish line, just a little bit left.  Save the pool. </p><br><p>  <strong>8.</strong> In the created pool we download an example of the boot file.  We upload our images to Yandex Disk or to our server, so that they can be accessed via the link.  Paste the URL to our images in the "INPUT: image" field.  Example: </p><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">INPUT:</span></span>image <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/kucev.ru/</span></span>Kirkorov/Kirkorov-pink_17<span class="hljs-number"><span class="hljs-number">_</span></span> <span class="hljs-number"><span class="hljs-number">21787_</span></span>l_jpg.jpg <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/kucev.ru/</span></span>Kirkorov/Kirkorov-green_82<span class="hljs-number"><span class="hljs-number">_</span></span> hqdefault_jpg.jpg <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/kucev.ru/</span></span>Kirkorov/Kirkorov-pink_25<span class="hljs-number"><span class="hljs-number">_</span></span> hqdefault_jpg.jpg</code> </pre> <br><p>  Download the resulting tsv file to Yandex Toloka.  Specify how many images will be shown to the artist at a time. </p><br><p><img src="https://habrastorage.org/webt/hm/bf/uu/hmbfuukiudogtvuilhmsjlowvx0.png"></p><br><p>  Great, no mistakes got out, so we did everything correctly and we can start our pool. </p><br><p><img src="https://habrastorage.org/webt/zt/yy/oo/ztyyooza5me7kbbiftnre7bvkoy.png"></p><br><p>  <strong>9.</strong> Now we need to check that from the performer everything is displayed correctly.  To do this, create a new account on <a href="https://sandbox.toloka.yandex.ru/">sandbox.toloka.yandex.ru</a> , only now as an artist.  In the customer‚Äôs account, select the Users tab and add our new account to the list of trusted users. </p><br><p><img src="https://habrastorage.org/webt/kp/xi/lg/kpxilgmbgximchgzkifpyvhgr7s.png"></p><br><p>  Well, if our pool is running, now our task is available from the test account of the executor. </p><br><p><img src="https://habrastorage.org/webt/bk/of/hy/bkofhyfuc28yv-uidpkqbuaidyu.png"></p><br><p>  Click "Continue."  This is how our performers page will look like: </p><br><p><img src="https://habrastorage.org/webt/xm/1l/k-/xm1lk-ubzyyitud8zallem8-h2o.png"></p><br><p>  We check that everything works correctly and no bugs arise. </p><br><p>  <strong>10.</strong> If you are satisfied with the result, then it‚Äôs time to release the baby to the big world, that is, to transfer our project from the sandbox to the main Toloka.  To do this, in the account of the executor in the tab "Actions over the project" choose "Export". </p><br><p><img src="https://habrastorage.org/webt/za/as/fj/zaasfjqq5jt1shjajmfxqppzkjw.png"></p><br><p>  We go to <a href="https://toloka.yandex.ru/">toloka.yandex.ru</a> and see that our project has been successfully exported. </p><br><p><img src="https://habrastorage.org/webt/ez/li/pd/ezlipdzhjlcuqm6ptnes2zxmujm.png"></p><br><p>  We open it, once again we check that everything is correct.  Once I made a mistake, having incorrectly formed a task and 2000 performers, having executed it, could not send the result (it is still unknown how many people I <a href="https://pikabu.ru/story/plokhoy_kod_ubivaet_4456988">killed</a> ). </p><br><p>  <strong>11.</strong> Start the pool, wait 20 minutes and get the result: </p><br><p><img src="https://habrastorage.org/webt/cb/fr/zv/cbfrzvy0uj-srvq-k5l3m9flbbi.png"></p><br><p>  Total: we had 1159 photos.  On one page for the freelancer placed 40 photos.  Those.  there were 1159/40 = 29 sets of tasks.  But we did with the overlap of 3, so it was only shown 29 x 3 = 87 pages.  For one page we pay $ 0.01 + $ 0.005.  Therefore, to check 1159 photos, it took us $ 1.3 or 80 rubles.  At the same time, freelancers received only $ 0.87 or 50 rubles, spending approximately 97 seconds x 87 tasks = 2 hours and 20 minutes.  Are you ready to work for 25 rubles per hour? </p><br><p>  <strong>12.</strong> Check the tasks and download the result. </p><br><p><img src="https://habrastorage.org/webt/hu/ff/8t/huff8tzlzyqgx6uv94dfsdbk0tu.png"></p><br><p>  Open the resulting file in pandas, group by "INPUT: image" </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd data = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'assignments_v0(14.05.18).tsv'</span></span>,sep = <span class="hljs-string"><span class="hljs-string">'\t'</span></span>) data[<span class="hljs-string"><span class="hljs-string">'OUTPUT:output'</span></span>] = data[<span class="hljs-string"><span class="hljs-string">'OUTPUT:output'</span></span>].map({<span class="hljs-string"><span class="hljs-string">'NO'</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">'YES'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>}) data_groupby = data.groupby(<span class="hljs-string"><span class="hljs-string">'INPUT:image'</span></span>).sum()</code> </pre> <br><p>  Got: </p><br><p><img src="https://habrastorage.org/webt/oz/ei/7o/ozei7opjphxabz27ifpvxm7wlfa.png"></p><br><pre> <code class="python hljs">data_groupby[<span class="hljs-string"><span class="hljs-string">'OUTPUT:output'</span></span>].value_counts() <span class="hljs-number"><span class="hljs-number">3.0</span></span> <span class="hljs-number"><span class="hljs-number">634</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-number"><span class="hljs-number">445</span></span> <span class="hljs-number"><span class="hljs-number">2.0</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span></code> </pre> <br><p>  Using the voting method, and considering that in the photo Kirkorov, if at least two performers voted for it, received 634 + 57 = 691 photos. </p><br><p><img src="https://habrastorage.org/webt/t9/wg/ve/t9wgvelkkwqumr4vqpqhtzocs48.png"></p><br><p>  To summarize, I want to say that: </p><br><ol><li>  Toloka - a flexible tool that can be customized for any task. </li><li>  Toloka is a very cheap labor force. </li><li>  There are about 10,000 performers on Toloka, which makes it possible to mark out huge amounts of data in a very short period of time. </li><li>  Toloka has very convenient tools for controlling performers, which allows you to create high-quality markup dataset. </li></ol><br><p>  Of the huge drawbacks: it is impossible to mark personal data on Toloka, since no NDAs sign with the performers and this will be a violation of 152-FZ and GDPR. </p><br><p>  If you are interested in the topic of creating datasets, then put the pros and in the next article I will tell you how to create datasets for the <a href="https://sticky-ai.com/">sticky-ai</a> application. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/358574/">https://habr.com/ru/post/358574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358564/index.html">Automatic generation of test scripts using neural networks</a></li>
<li><a href="../358566/index.html">Open webinar: "Scopes and invisibility"</a></li>
<li><a href="../358568/index.html">RIT ++: how the largest Russian technology festival appeared</a></li>
<li><a href="../358570/index.html">Critical vulnerabilities in PGP and S / MIME allow reading encrypted email messages</a></li>
<li><a href="../358572/index.html">If you really want: 10-gigabit on copper</a></li>
<li><a href="../358576/index.html">How we played the game ‚ÄúStone - Scissors - Paper‚Äù on the Ethereum blockchain</a></li>
<li><a href="../358580/index.html">IP PBX Zeon + RetailCRM = Effective Internet Sales</a></li>
<li><a href="../358582/index.html">We build an effective interaction between engineering and product teams.</a></li>
<li><a href="../358584/index.html">Error notification: from each circuit in its own way</a></li>
<li><a href="../358586/index.html">Announcement mitap Sync.NET # 6 in Kharkov</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>