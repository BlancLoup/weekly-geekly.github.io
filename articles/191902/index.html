<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create autonomous robot Frank. Part two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It took a little time and I have significant progress. If you have not read the background - welcome to ‚ÄúCreating an Autonomous Robot Frank. Part One ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create autonomous robot Frank. Part two</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage3/7c4/d96/bed/7c4d96bed4479e692f2503020ff4ce7c.jpeg"><br><br>  It took a little time and I have significant progress.  If you have not read the background - welcome to <a href="http://habrahabr.ru/post/191430/">‚ÄúCreating an Autonomous Robot Frank.</a>  <a href="http://habrahabr.ru/post/191430/">Part One</a> . <br><br>  So, in the first part I assembled a platform based on Lego Technic and HiTech servo motors.  Having ditched the only shield for prototyping for Arduino, I waited for me to get a replacement, plus a new solder, instead of the environmentally friendly one that I had - without any lead.  Also, I had at my disposal a pair of XBee for wireless communication, which needed to be sorted out and Arduino Due, which I wanted to experiment with. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  It turns out that lead-free solder is very difficult to solder, so I ordered another <a href="http://www.electronshik.ru/card/pripoy-sn60pb38cu2-96418">S-Sn60Pb39Cu2 2.5% Flux</a> from Felder.  The difference is just awesome.  He immediately melts and perfectly falls on the contacts.  This has accelerated the creation of the board many times. <br><br>  In order.  At first I made my shield for controlling servo motors.  Experiments with breadboard, of course, are required to make sure that everything works, but it always looks disgusting.  In order to solder the board, I ordered a prototyping board from <a href="http://www.electronshik.ru/card/maketnaya-plata-arduino-mega-114475">DFRobot for the Arduino Mega</a> , which fit perfectly with the Arduino Due.  To control the servo-motors, it is necessary to connect the yellow wire of the motor to the Arduino's PWM outputs via a resistor.  It should be noted that the Arduino Due 12 PWM outputs, which allows you to connect a lot of servo-motors without additional controllers.  In practice, of course, this must be checked.  It is possible that the board does not have enough timers to smoothly control 12 motors.  Plus, the ground must be connected to the battery and the earth of the battery must be combined with the ground from the Arduino.  I wrote about this in more detail in the previous article.  The board was clean enough and there was still a lot of room for other components - for example XBee. <br><br><img src="https://habrastorage.org/storage3/6db/72e/144/6db72e144da7f6f86409d5490ee229e9.jpg"><br><br>  As you can see, the board has four outputs for servo motors and a separate input for external power.  It looks quite clean and very convenient to connect. <br><br><img src="https://habrastorage.org/storage3/7f3/c81/228/7f3c8122805fbd460b2340546de7cae5.jpg"><br><br>  That's all, the simple thing is over and the experiments with XBee began.  Naturally, getting them out of the box and plug, nothing worked.  An Internet search gave only a couple of articles about the fact that they must first be configured.  Software for configuring XBee, of course, is written under Windows, and I have a Mac.  What to do?  Finally, I found an article that describes how this can be done through a serial interface. <br><br>  Included with the XBee are two small cards, which plug in wireless modules.  Both boards can be connected to the Arduino, pre-soldering the legs and using the breadboard.  One of the boards has a USB output (USB-to-Serial). <br><br><img src="https://habrastorage.org/storage3/0d4/7c6/99f/0d47c699f7a32ac5909a1dfc7f0f95c1.jpg"><br><br>  Since I was planning to interact and exchange information between Frank and my laptop, I started by writing a simple program to communicate with the XBee via a serial interface.  To do this, I downloaded the latest version of Qt (5.1), in which the QSerialPort class appeared, allowing you to communicate with external devices via the serial port.  The program looks like a terminal so far, but in the future I will expand it to fully manage Frank via the XBee connected to my computer.  All that the program is doing at the moment - it sends and receives messages on the serial port, which must be entered manually. <br><br><img src="https://habrastorage.org/storage3/c9d/311/6d1/c9d3116d15e5b4114d98bb090689d5fa.jpg"><br><br>  <a href="http://www.dennissedov.com/%3Fattachment_id%3D4178">Source Code</a> Since everything is written using Qt, it should work on any computer.  Qt5.1 is required for compilation.  The project file was generated by QtCreator. <br><br>  First you need to determine the name of the XBee connected to the computer.  To do this, look at the list of devices in the / dev folder and look for something similar to tty.usbserial-A9014B88 (as it is called by me).  In the code, we change the line ‚Äúport = new QSerialPort (" usbserial-A9014B88 ");"  your device name (without "tty."). <br><br>  If you yourself have not configured XBee before, then you need to change ‚Äúport-&gt; setBaudRate (19200);‚Äù to 9600 or just comment out this line, since this speed is by default written in the device.  Next, run the program by connecting the first module and enter "+++".  Three pluses wake the device for further commands.  In response, you should receive "OK", which will be displayed in the terminal window.  After a while (I still did not understand what) the device goes into sleep mode, so do not tighten it with the other commands.  In order to wake him up again, send again three pluses. <br><br>  Next, send the configuration to the first module.  "ATID4000, DH0, DL1, MY0, BD4, WR, CN".  This changes its ID to 4000 (can be any number), communication speed to 19200 and its address to ‚Äú0‚Äù.  For two devices to communicate with each other, their ID must match, and for one device the address must be ‚Äú0‚Äù and the other one ‚Äú1‚Äù.  After you send this command, you should come back 7 "OK" (or so).  If something went wrong, then one of ‚ÄúOK‚Äù will be ‚ÄúERROR‚Äù. <br><br>  Now we can pull the chip out of the board and put the second chip there, having previously disconnected the board from the computer.  Repeating all the same commands, except that MY0 should be MY1 "ATID4000, DH0, DL1, MY1, BD4, WR, CN".  Do not forget that now both devices operate at a frequency of 19200. Therefore, with further connection in the source code of the program, you must specify this speed when connecting - ‚Äúport-&gt; setBaudRate (19200);‚Äù. <br><br>  Now it remains to connect one device to the computer (you can simply leave the one that is already connected), and the second to the Arduino.  I will again resort to the prototyping board, but most likely, today I solder XBee to my prototype shield. <br><br>  The connection is quite simple - you need to connect the VSS to the ground of the Arduino, VCC from 3.3V, DOUT to the RX (port 0 to Arduino Due), and DIN to TX (1 port).  On other boards, there may be other ports - just find the RX and TX (serial interface).  Now we need to make them send messages to each other. <br><br>  Again, everything was not so simple.  SofwareSerial have not yet ported to ArduinoDue - it means that you can use only the hardware interface, and most of the examples on the Internet simply do not work.  The fact that I have an XBee Series1 has reduced the number of examples available on the Internet to a minimum.  <a href="http://code.google.com/p/xbee-arduino/downloads/list">This library</a> helped a <a href="http://code.google.com/p/xbee-arduino/downloads/list">lot</a> .  If you have Arduino Due, then you need to download "xbee-arduino-0.3.zip", since version 0.4 works through SoftwareSerial.  Install the library in Arduino (Sketch-&gt; Import Library-&gt; Add Library) and specify the folder that contains what you downloaded and unzipped.  After that, click (Sketch-&gt; Import Library-&gt; XBee), and you will have the line "#include &lt;XBee.h&gt;". <br><br>  Now we can load this sketch into the Arduino. <br><br><pre><code class="hljs dos">#include &lt;XBee.h&gt; // XBEE Code XBee xbee = XBee(); unsigned long <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> = millis(); uint8_t payload[] = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> }; Tx16Request tx = Tx16Request(<span class="hljs-number"><span class="hljs-number">0</span></span>x4000, payload, sizeof(payload)); void setup() { // XBee Code Serial.begin(<span class="hljs-number"><span class="hljs-number">19200</span></span>); xbee.setSerial(Serial); } void loop() { // XBee Code <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (millis() - <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> &gt; <span class="hljs-number"><span class="hljs-number">15000</span></span>) { // Wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> boot and connection to establish xbee.send(tx); } delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre> <br><br> <code>uint8_t payload[] = { 0, 0 };</code>  - this is an array of data that XBee will send. <br><br> <code>Tx16Request tx = Tx16Request(0x4000, payload, sizeof(payload));</code>  - This is a request to send information.  Pay attention to 0x4000 - this value should correspond to the ID that we set earlier when setting up a pair of XBee. <br><br>  All he does is send two characters with the ASCII code ‚Äú0‚Äù to another XBee.  By running iFrank, you can see how empty characters appear in the terminal window.  This is certainly not so interesting, but the goal was to check the connection between the modules.  By the next article, I hope to understand the camera, the exchange of information between the computer and the Arduino, solar panels, as well as write controls on Qt. <br><br>  Assembly now everything looks like this: <br><br><img src="https://habrastorage.org/storage3/f9c/d24/550/f9cd245502592f5205237de4a232ad6a.jpg"></div><p>Source: <a href="https://habr.com/ru/post/191902/">https://habr.com/ru/post/191902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191888/index.html">RailsClub'Moscow 2013. Interview with Ernie Miller</a></li>
<li><a href="../191892/index.html">To GIF or not to GIF?</a></li>
<li><a href="../191894/index.html">3CXPhone for Android user guide published</a></li>
<li><a href="../191896/index.html">MegaFon launches Russian accounting system in housing and public utilities</a></li>
<li><a href="../191898/index.html">Android component from scratch - 2 - Magnifier for image</a></li>
<li><a href="../191904/index.html">PowerLoader 64-bit updated with new LPE exploits</a></li>
<li><a href="../191906/index.html">Highscreen Omega Prime XL Review</a></li>
<li><a href="../191908/index.html">Loc Kit: localization management and machine translation</a></li>
<li><a href="../191910/index.html">Pixel-perfect layout of Android layouts</a></li>
<li><a href="../191912/index.html">OpenMP is now available in Clang!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>